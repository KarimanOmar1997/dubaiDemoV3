/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{Z as e}from"./vec4f64.js";import{n as t}from"./InterleavedLayout.js";import{i as s,d as r,b as i,e as o,S as a}from"./ShaderOutput.js";import{o as n}from"./Matrix4BindUniform.js";import{C as l}from"./basicInterfaces.js";import{b as p,J as c,K as h,S as u,o as d,t as f,j as v,C as m,m as g,R as _,L as O,s as T,p as C,q as A,r as P,u as y,v as S,w as b,x as I,M as w,N as D,E as R,P as j,V as E,i as N}from"./Matrix4PassUniform.js";import{V as x}from"./VertexAttribute.js";import{T as M,V as L,D as V}from"./VertexColor.glsl.js";import{T as F}from"./TriangleMaterial.js";import{O as U,D as q}from"./Material.js";import{g as B}from"./glsl.js";import{S as W}from"./ShaderBuilder.js";import{m as H,d as z,c as Q}from"./renderState.js";import{_ as G}from"./tslib.es6.js";import{p as J}from"./ShaderTechniqueConfiguration.js";import{a as K}from"./AlphaCutoff.js";const Z=Object.freeze(Object.defineProperty({__proto__:null,build:function(e){const t=new W,{vertex:s,fragment:r,attributes:i,varyings:o}=t,{vvColor:a,hasVertexColors:n}=e;return p(s,e),t.include(M,e),t.include(L,e),t.include(c,e),t.include(h,e),r.include(u,e),t.include(d,e),t.include(f,e),i.add(x.POSITION,"vec3"),a&&i.add(x.COLORFEATUREATTRIBUTE,"float"),n||o.add("vColor","vec4"),o.add("vpos","vec3",{invariant:!0}),s.uniforms.add(new v("uColor",(e=>e.color))),s.main.add(B`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${n?"vColor *= uColor;":a?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vpos);`),r.include(m),r.main.add(B`discardBySlice(vpos);
discardByTerrainDepth();
outputColorHighlightOID(vColor, vpos, vColor.rgb);`),t}},Symbol.toStringTag,{value:"Module"}));class $ extends g{constructor(e,t){super(e,t,new _(Z,(()=>Promise.resolve().then((()=>Z)))))}_createPipeline(e,t){const{oitPass:r,output:i,transparent:o,cullFace:a,draped:n,hasOccludees:l,polygonOffset:p}=e,c=r===U.NONE;return H({blending:s(i)&&o?b(r):null,culling:Q(a),depthTest:n?null:{func:S(r)},depthWrite:y(e),drawBuffers:P(i,I(r,i)),colorWrite:z,stencilWrite:l?A:null,stencilTest:l?t?T:C:null,polygonOffset:c?p?k:null:O(e)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const k={factor:1,units:1};class X extends q{constructor(){super(...arguments),this.cullFace=l.None,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=w.None,this.emissionSource=D.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1,this.snowCover=!1}}G([J({count:l.COUNT})],X.prototype,"cullFace",void 0),G([J()],X.prototype,"hasVertexColors",void 0),G([J()],X.prototype,"transparent",void 0),G([J()],X.prototype,"discardInvisibleFragments",void 0),G([J()],X.prototype,"polygonOffset",void 0),G([J()],X.prototype,"enableOffset",void 0),G([J()],X.prototype,"writeDepth",void 0),G([J()],X.prototype,"hasOccludees",void 0),G([J()],X.prototype,"terrainDepthTest",void 0),G([J()],X.prototype,"cullAboveTerrain",void 0),G([J()],X.prototype,"objectAndLayerIdColorInstanced",void 0),G([J()],X.prototype,"vvColor",void 0),G([J()],X.prototype,"draped",void 0);class Y extends F{constructor(e){super(e,te),this._configuration=new X,this.supportsEdges=!0,this.produces=new Map([[R.OPAQUE_MATERIAL,e=>this._isOpaqueMaterialPass(e)],[R.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>this._isOpaqueNoSSAODepthPass(e)],[R.TRANSPARENT_MATERIAL,e=>r(e)&&this._transparent&&this.parameters.writeDepth],[R.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,e=>i(e)&&this._transparent&&this.parameters.writeDepth],[R.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>r(e)&&this._transparent&&!this.parameters.writeDepth],[R.DRAPED_MATERIAL,e=>o(e)]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<j,this._configuration.terrainDepthTest=t.terrainDepthTest&&s(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=K}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===a.Highlight||r(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return i(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new ee(e)}createBufferWriter(){const e=t().vec3f(x.POSITION);return n()&&e.vec4u8(x.OLIDCOLOR),this.parameters.vvColor?e.f32(x.COLORFEATUREATTRIBUTE):e.vec4u8(x.COLOR),new V(e)}}class ee extends N{beginSlot(e){return this.getTechnique($,e)}}class te extends E{constructor(){super(...arguments),this.color=e,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=l.None,this.draped=!1,this.discardInvisibleFragments=!1}}export{Y as C};
