/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{v as e,w as t,F as r,x as o,y as s,z as i,B as n,C as a,D as l,E as u,G as p,H as m}from"./arcade.js";export{I as arcade}from"./arcade.js";import{A as c,D as f,T as j}from"./TimeOnly.js";import{D as d,t as y}from"./aiServices.js";import{Y as h,c as g,i as v,d as x,f as b,e as w}from"./languageUtils.js";import{A as S,E as P}from"./enum.js";import{I as _}from"./ImmutableArray.js";import{f as T,a as A,b as U,d as F,i as C}from"./guards.js";import{clone as E}from"../core/lang.js";import D from"../geometry/Extent.js";import $ from"../geometry/Multipoint.js";import z from"../geometry/Point.js";import L from"../geometry/Polygon.js";import O from"../geometry/Polyline.js";import"../core/Accessor.js";import"../core/Handles.js";import"./Logger.js";import"../config.js";import"./maybe.js";import"../core/accessorSupport/decorators/subclass.js";import"./Lifecycle.js";import"./metadata.js";import"./utils.js";import"./handleUtils.js";import"./tracking.js";import"./ensureType.js";import"./MapUtils.js";import"./Warning.js";import"../core/Error.js";import"./get.js";import"./ObjectPool.js";import"./ObservableBase.js";import"../core/accessorSupport/decorators/property.js";import"./watch.js";import"../core/scheduling.js";import"./nextTick.js";import"./PooledArray.js";import"../core/promiseUtils.js";import"./events.js";import"./SetUtils.js";import"./SimpleTrackingTarget.js";import"./deepClone.js";import"../geometry/support/jsonUtils.js";import"../geometry/Geometry.js";import"./tslib.es6.js";import"../core/JSONSupport.js";import"./reader.js";import"../geometry/SpatialReference.js";import"./unitUtils.js";import"./jsonMap.js";import"./pe.js";import"./assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"./jsonUtils.js";import"./persistableUrlUtils.js";import"./writer.js";import"../geometry/support/webMercatorUtils.js";import"./zmUtils.js";import"../core/accessorSupport/decorators/cast.js";import"./coordsUtils.js";import"./Axis.js";import"./extentUtils.js";import"./boundsUtils.js";import"./aaBoundingRect.js";import"./mathUtils.js";import"./featureConversionUtils.js";import"./aaBoundingBox.js";import"./OptimizedFeature.js";import"./memoryEstimations.js";import"./OptimizedGeometry.js";import"./OptimizedFeatureSet.js";import"./createFeatureId.js";import"../layers/support/FieldsIndex.js";import"./UnknownTimeZone.js";import"./datetime.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"./constants.js";import"./timeZoneUtils.js";import"./locale.js";import"./shared2.js";import"../layers/support/Field.js";import"./enumeration.js";import"./domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./fieldType.js";import"../core/sql/WhereClause.js";import"./unitConversion.js";import"./number.js";import"./hash.js";import"./uuid.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"./utils10.js";import"./commonProperties3.js";const R="Voxel.Position",k="Voxel.LocalTime";class M{constructor(e,t){this._graphic=e,this._timeZone=t,this.arcadeDeclaredClass="esri.arcade.Voxel",this._layer=e.sourceLayer}getPosition(){return void 0!==this._position?this._position:this._position=function(e){const t=e.getAttribute(R);if("string"!=typeof t)throw new S(null,P.InvalidParameter,null);const r=JSON.parse(t);if(!Array.isArray(r)||"number"!=typeof r[0]||"number"!=typeof r[1]||"number"!=typeof r[2])throw new S(null,P.InvalidParameter,null);return new _(r)}(this._graphic)}getLocalTime(){return void 0!==this._localTime?this._localTime:this._localTime=function(e,t){const r=e.getAttribute(k);if(null==r)return null;if(!T(r))throw new S(null,P.InvalidParameter,null);return c.dateJSAndZoneToArcadeDate(r,t)}(this._graphic,this._timeZone??"system")}keys(){return this._layer.fields.map((e=>e.name)).sort()}hasField(e){return this._layer.fieldsIndex.has(e)}field(e){const t=this._layer.fieldsIndex?.get(e)?.name;if(null==t)throw new S(null,P.FieldNotFound,null,{key:e});switch(t){case R:return this.getPosition();case k:return this.getLocalTime()}return this._graphic.attributes[t]??null}castToText(e=!1){const t={...this._graphic.attributes};t[R]=this.getPosition(),k in t&&(t[k]=this.getLocalTime());for(const e of Object.keys(t))this._layer.fieldsIndex?.has(e)||delete t[e];return h(t,{useNumbersForDates:e})}}const Z={vars:{$feature:"any",$view:"any"}};function J(e){return e.replaceAll(/[|\\{}()[\]^$+*?.]/g,"\\$&")}function G(e){return null==e?null:A(e)||g(e)?"array":v(e)?"date":U(e)?"text":F(e)?"boolean":C(e)?"number":e instanceof d?"dictionary":x(e)?"feature":e instanceof z?"point":e instanceof L?"polygon":e instanceof O?"polyline":e instanceof $?"multipoint":e instanceof D?"extent":e instanceof f?"dateOnly":e instanceof j?"time":b(e)?"featureSet":w(e)?"featureSetCollection":null}function V(t){if(!t)return null;try{return e(t)}catch(e){}return null}function B(e,r){const o="string"==typeof e?V(e):e;if(!o)return null;try{return r=r||E(Z),t(o,r)}catch(e){}return null}function N(e,t,o){return{vars:{$feature:null==e?new r:r.createFromGraphic(e,o),$view:t?.view},spatialReference:t?.sr,timeZone:o??null}}function q(e,t,o){return r.createFromGraphicLikeObject(t,e,o,null)}function H(e,t){null!=e.vars&&(e.vars.$feature=t)}function Q(e,t){let r;try{r=o(e,t)}catch(e){r=null}return r}function W(e,t){let r;try{r=e?e(t):null}catch(e){r=null}return r}function Y(e,t){try{return e?e(t):Promise.resolve(null)}catch(e){return Promise.resolve(null)}}const K=new Set(["$feature","$aggregatedFeatures","$voxel"].map((e=>y(e))));function X(e,t){if(!e)return[];const r="string"==typeof e?V(e):e;if(!r)return[];const o=s(r).filter((({varId:e})=>K.has(e))).map((({memberNamePattern:e})=>e)).flatMap((e=>{if(e.includes("*")){if(null==t)return[];const r=new RegExp(`^${e.split(/\*+/).map(J).join(".*")}$`,"i");return t.filter((e=>r.test(e)))}return e.toLowerCase()}));return[...new Set(o.sort())]}function ee(e){return i(e,"$view")}function te(e,t){return!!e&&i(e,t)}function re(e){if(!e||null==e.spatialReference&&(null==e.scale||null==e.viewingMode))return;let t,r;const{timeProperties:o,timeZone:s}=e;if(null!=o){const{currentStart:e,currentEnd:i}=o;null!=s?(t=null!=e?c.dateJSAndZoneToArcadeDate(e,s):null,r=null!=i?c.dateJSAndZoneToArcadeDate(i,s):null):(t=null!=e?c.dateJSToArcadeDate(e):null,r=null!=i?c.dateJSToArcadeDate(i):null)}return{view:e.viewingMode&&null!=e.scale?new d({__proto__:null,viewingMode:e.viewingMode,scale:e.scale,timeProperties:null!=t||null!=r?new d({__proto__:null,currentStart:t,currentEnd:r,startIncluded:!0,endIncluded:!0}):null}):null,sr:e.spatialReference}}function oe({url:e,spatialReference:t,lrucache:r,interceptor:o}){const s=u();return s?s.createFeatureSetCollectionFromService(e,t,r,o):null}function se({layer:e,spatialReference:t,outFields:r,returnGeometry:o,lrucache:s,interceptor:i}){if(null===e)return null;const n=u();return n?n.constructFeatureSet(e,t,r,o??!0,s,i):null}function ie(e){if(null===e?.map)return null;const t=u();return t?t.createFeatureSetCollectionFromMap(e.map,e.spatialReference,e.lrucache,e.interceptor):null}function ne(e,t){return d.convertJsonToArcade(e,t)}function ae(e,t,r=[]){return n(e,t,r)}function le(){return a()}function ue(){return l()}function pe(e,t){if(!e)return!1;if("string"==typeof e)return t(e);const r=e;if("type"in(o=r)&&("class-breaks"===o.type||"dictionary"===o.type||"dot-density"===o.type||"pie-chart"===o.type||"simple"===o.type||"unique-value"===o.type)){if("dot-density"===r.type){const e=r.attributes?.some((e=>t(e.valueExpression)));if(e)return e}const e=r.visualVariables,o=!!e&&e.some((e=>{let r=t(e.valueExpression);return"size"===e.type&&(de(e.minSize)&&(r=r||t(e.minSize.valueExpression)),de(e.maxSize)&&(r=r||t(e.maxSize.valueExpression))),r}));return!(!("valueExpression"in r)||!t(r.valueExpression))||o}var o;if("esri.layers.support.LabelClass"===r.declaredClass){const e=r.labelExpressionInfo?.expression;return!(!e||!t(e))||!1}return"esri.PopupTemplate"===r.declaredClass&&(!!r.expressionInfos&&r.expressionInfos.some((e=>t(e.expression)))||Array.isArray(r.content)&&r.content.some((e=>"expression"===e.type&&t(e.expressionInfo?.expression))))}function me(e){const t=V(e);return!!t&&p(t)}function ce(e){return pe(e,me)}function fe(e){const t=V(e);return!!t&&m(t)}function je(e){return pe(e,fe)}function de(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}export{d as Dictionary,M as Voxel,r as arcadeFeature,se as convertFeatureLayerToFeatureSet,ne as convertJsonToArcade,ie as convertMapToFeatureSetCollection,oe as convertServiceUrlToWorkspace,N as createExecContext,q as createFeature,B as createFunction,V as createSyntaxTree,ee as dependsOnView,ue as enableFeatureSetOperations,le as enableGeometryOperations,Q as evalSyntaxTree,Y as executeAsyncFunction,W as executeFunction,X as extractFieldNames,G as getArcadeType,re as getViewInfo,ce as hasGeometryFunctions,je as hasGeometryOperations,te as hasVariable,ae as loadScriptDependencies,H as updateExecContext};
