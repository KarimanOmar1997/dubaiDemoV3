/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{s as e,b as n,d as r}from"./screenUtils.js";import{c as t}from"./vec2f64.js";import{f as s,k as o,l,c as a,d as c,j as u,i}from"./vec3.js";import{c as d}from"./vec3f64.js";import f from"../geometry/Point.js";import{projectPoint as p}from"./projectionUtils.js";import{i as m,c as E,g as S,f as j}from"./plane.js";import{c as R,a as g}from"./ray.js";import{b as v,c as y}from"./vector.js";import{a as I}from"./elevationInfoUtils.js";import{f as x}from"./ray2.js";import{I as w}from"./Intersector2.js";import{S as H,I as U}from"./IntersectorResult.js";import{t as b}from"./verticalOffsetUtils.js";import{E as O}from"./dragEventPipeline.js";function C(e,n){return D(e,(()=>n))}function T(e){return D(e,(e=>e.plane))}function D(n,t){const s=d(),o=d();let l=!1;return a=>{const c=t(a);if("start"===a.action){const t=e(a.screenStart,r(v.get())),o=x(n.state.camera,t,J);null!=o&&(l=m(c,o,s))}if(!l)return null;const u=e(a.screenEnd,r(v.get())),i=x(n.state.camera,u,J);return null==i?null:m(c,i,o)?{...a,renderStart:s,renderEnd:o,plane:c,ray:i}:null}}function M(e,r,t,s=null,o=null){return function(e,r,t=0,s=null,o=null){let l=null;return a=>{if("start"===a.action&&(l=e.sceneIntersectionHelper.intersectElevationFromScreen(n(a.screenStart.x,a.screenStart.y),r,t,o),null!=l&&null!=s&&!p(l,l,s)))return null;if(null==l)return null;const c=e.sceneIntersectionHelper.intersectElevationFromScreen(n(a.screenEnd.x,a.screenEnd.y),r,t,o);return null==c||null!=s&&!p(c,c,s)?null:{...a,mapStart:l,mapEnd:c}}}(e,t,I(r,e,t),s,o)}function N(e,n,r,t){const s=r.toMap(e.screenStart);return null!=s?M(n,s,r.elevationInfo,t):null}function P(e,n,r){let t=null;const f=new O;return f.next(C(e,function(e,n){const r=z,t=B,l=E();e.renderCoordsHelper.worldUpAtPosition(n,r);const a=s(S(l),r,o(t,n,e.state.camera.eye));return s(a,a,r),j(n,a,l)}(e,n))).next(function(e,n){const r=d(),t=l(n);e.renderCoordsHelper.worldUpAtPosition(n,r);const s=d(),f=d(),p=s=>(o(s,s,n),y(r,s,s),"global"===e.viewingMode&&l(s)*Math.sign(c(r,s))<.001-t&&o(s,u(s,r,.001),n),i(s,s,n),s);return e=>(e.renderStart=p(a(s,e.renderStart)),e.renderEnd=p(a(f,e.renderEnd)),e)}(e,n)).next(h(e,r)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,t=e})),e=>(t=null,f.execute(e),t)}function G(n,t){const s=s=>{const o=e(s,r(q)),l=x(n.state.camera,o,J);if(null==l)return null;const a=g(t,l,z,B);return a?.[0]};return e=>{const n=s(e.screenStart);if(null==n)return null;const r=s(e.screenEnd);return null==r?null:{...e,renderStart:n,renderEnd:r}}}function h(e,n){const r=e.renderCoordsHelper;return e=>{const t=r.fromRenderCoords(e.renderStart,new f({spatialReference:n})),s=r.fromRenderCoords(e.renderEnd,new f({spatialReference:n}));return null!=t&&null!=s?{...e,mapStart:t,mapEnd:s}:null}}var k;function A(e){let n=null;return r=>{switch(r.action){case"start":n=e.disableDisplay();break;case"end":case"cancel":null!=n&&(n.remove(),n=null)}return r}}function F(r,t=null){const s=new w(r.state.viewingMode);s.options.selectionMode=!0,s.options.store=H.MIN,s.options.hud=!1;const o=n(),l={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},a=d(),c=t??r.spatialReference,u=n=>{r.map.ground&&r.map.ground.opacity<1?l.exclude.add(b):l.exclude.delete(b),r.sceneIntersectionHelper.intersectIntersectorScreen(e(n,o),s,l);const t=s.results.min;let u;if(t.getIntersectionPoint(a))u=t.intersector===U.TERRAIN?k.GROUND:k.OTHER;else{if(!s.results.ground.getIntersectionPoint(a))return null;u=k.GROUND}return{location:r.renderCoordsHelper.fromRenderCoords(a,new f({spatialReference:c})),surfaceType:u}};let i;return e=>{if("start"===e.action){const n=u(e.screenStart);i=null!=n?n.location:null}if(null==i)return null;const n=u(e.screenEnd);return null!=n?.location?{...e,mapStart:i,mapEnd:n.location,surfaceType:n.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(k||(k={}));const q=t(),z=d(),B=d(),J=R();export{k as S,M as a,P as b,F as c,G as d,N as e,T as f,h as g,A as h,C as s};
