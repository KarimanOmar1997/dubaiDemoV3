/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import"../intl.js";import{i as e,l as t,equalsShallow as n}from"../core/lang.js";import{t as s,r as a,L as r}from"./Logger.js";import{c as i}from"./formUtils.js";import{isTimeOnlyField as o,D as l,NumericRangeValidationError as u,TypeValidationError as m}from"../layers/support/fieldUtils.js";import{b as p,v as d}from"./layerUtils.js";import{i as f}from"./utils14.js";import{g as c,a as y}from"./dateUtils.js";import{I as b,b as g,s as x,c as T,n as N}from"./formUtils2.js";import{s as j}from"./substitute.js";const F=e=>"field"===e?.type,O=e=>"group"===e?.type,V=e=>"relationship"===e?.type,h=e=>"text"===e.type,v=e=>"utilityNetworkAssociations"===e.type,E=e=>!O(e)&&null!=e.group,_=(e,t)=>E(e)&&e.group===t,L=e=>e.reduce(((e,t)=>O(t)?[...e,...t.inputs]:[...e,t]),[]),U=e=>L(e).filter(F),A=e=>L(e).filter(V),I=e=>L(e).filter(v),w=e=>null!=e&&(C(e,"combo-box")||C(e,"radio-buttons")),C=(e,t)=>null!=e&&e.input?.type===t,$=({domain:e,inputType:t="text-box",dataType:n})=>"number"===n&&"text-box"===t&&(!e||"coded-value"!==e.type);function D(t){const{attributes:n,fieldsIndex:r,label:i,timeZone:o}=t;if(!n||"object"!=typeof n)return i;const l=Object.keys(n).filter((e=>s(i,e))),u=l.map((e=>n[e])),m=l.map((e=>r.get(e))).filter(e);return function(e,t){return a(a(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((([e,t])=>[e.toLowerCase(),t]))))}(i,P({values:u,fields:m,timeZone:o}))}const Z="expression/";function k(e){const[t,n]=e.split(Z);return""===t&&n?n:(r.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${e} is not a valid expression reference of the form '${Z}/expressionName'`),"")}function B(e){return`${Z}${e}`}function G(e){return`field/${e}`}function R(e){return e.startsWith(Z)}function S(e){return e.startsWith("expr/")}function P(e){const{fields:t,values:n}=e,s=e.timeZone??void 0,a=t.map(((e,t)=>{let a=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===a));t?.name&&(a=t.name)}return(f(e)||o(e))&&(a=c(e,a,{timeZone:s,...y(e)})),[e.name,a]}));return Object.fromEntries(a)}const W=e=>{const t={typeFieldName:null,types:[]};return e?(p(e)?(t.typeFieldName=e.parent?.subtypeField,t.types=e.parent?.subtypes??[]):"subtype-group"===e.type||"feature"===e.type&&e.subtypes?.length?(t.typeFieldName=e.subtypeField,t.types=e.subtypes??[]):"types"in e&&e.types&&(t.typeFieldName=e.typeIdField,t.types=e.types.map((({id:e,name:t,domains:n})=>({code:e,name:t,domains:n})))),null!=t.typeFieldName&&(t.typeFieldName=e.getField(t.typeFieldName)?.name??t.typeFieldName),t):t},Y=(e,t,n)=>{const{dataType:s,error:a,minLength:r}=e,i=t?.validationErrors;if(!i||!a)return null;if(a===b.CANNOT_BE_EMPTY)return i.cannotBeNull;if(a===l.VALUE_OUT_OF_RANGE||a===u.OUT_OF_RANGE){const{field:t,range:a}=e,r={type:"date",intlOptions:{timeZone:"date"===t.type&&n?n:void 0,...y(t)}},o=g(a,i);return j(o,a,{format:{max:"date"===s?r:null!=a.max&&x(a.max)?T:N,min:"date"===s?r:null!=a.min&&x(a.min)?T:N}})}return a===l.INVALID_CODED_VALUE?i.invalidCodedValue:a===m.INVALID_TYPE?i.invalidType:a===b.TOO_SHORT?j(i.tooShort,{min:r}):(b.TOO_LONG,null)},q=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,s=e.geometry?.type;return"polyline"===s||"polyline"===n?"line":"mesh"===s||"mesh"===n||"multipatch"===n?"cube":"multipoint"===s||"multipoint"===n?"point":s||n||"table"},z=e=>{const t=[];if(e.formTemplate){const{description:n,title:a}=e.formTemplate;e.fields?.forEach((e=>{const r=a&&s(a,e.name),i=n&&s(n,e.name);(r||i)&&t.push(e.name)}))}return t};function H(e,t){const n=t??("formTemplate"in e&&e.formTemplate);return!!n&&(n.elements?.filter(i)??[]).some((({fieldName:t})=>!e.fieldsIndex.get(t)))}function M(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function J(e,n){switch(n.objectType){case"any":return!0;case"null":return null==e;case"code":return e===n.codedValue?.code;case"range":return null!=e&&null!=n.minValue&&null!=n.maxValue&&+e>=n.minValue&&+e<=n.maxValue;default:return t(n.objectType),!1}}function K(e,t,s){const a=d(e),r=a?.find((e=>e.code===s));if(!r)return!1;const i=a?.find((e=>e.code===t));return!n(r.defaultValues,i?.defaultValues)&&Object.values(r.defaultValues).some((e=>null!=e))}export{k as A,S as B,H as C,w as a,F as b,z as c,v as d,O as e,V as f,P as g,h,C as i,L as j,E as k,Y as l,q as m,$ as n,_ as o,D as p,I as q,U as r,K as s,A as t,W as u,M as v,J as w,B as x,G as y,R as z};
