/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import e from"../config.js";import{version as t}from"../kernel.js";import{A as n,T as r,D as i,a}from"./TimeOnly.js";import{A as s,E as o}from"./enum.js";import{isPromiseLike as u}from"../core/promiseUtils.js";import{I as l}from"./ImmutableArray.js";import f from"../geometry/Point.js";import{e as c,a as m}from"./shared2.js";import{f as h,p as d}from"./number.js";import y from"../geometry/Extent.js";import p from"../geometry/Geometry.js";import g from"../geometry/Multipoint.js";import b from"../geometry/Polygon.js";import S from"../geometry/Polyline.js";import N from"../geometry/SpatialReference.js";import{i as Z}from"./coordsUtils.js";import{fromJSON as _}from"../geometry/support/jsonUtils.js";import{g as T}from"./locale.js";import{d as x,i as C,b as k,a as A,f as D,c as O,e as j}from"./guards.js";import{D as w}from"./datetime.js";class F{}class M{constructor(){}}function R(e,t,n){if(e instanceof M&&!(e instanceof v)){const r=new v;return r.fn=e,r.parameterEvaluator=n,r.context=t,r}return e}class J extends M{constructor(e){super(),this.fn=e}createFunction(e){return(...t)=>this.fn(e,{preparsed:!0,arguments:t})}call(e,t){return this.fn(e,t)}marshalledCall(e,t,n,r){return r(e,t,((t,i,a)=>{a=a.map((t=>t instanceof M&&!(t instanceof v)?R(t,e,r):t));const s=this.call(n,{args:a});return u(s)?s.then((e=>R(e,n,r))):s}))}}class v extends M{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(e){return this.fn.createFunction(this.context)}call(e,t){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}marshalledCall(e,t,n){return this.fn.marshalledCall(e,t,this.context,this.parameterEvaluator)}}class I extends l{constructor(e,t,n,r,i,a){super(e),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=t,this._hasZ=n,this._hasM=r,this._cacheId=i,this._partId=a}get(e){if(void 0===this._lazyPt[e]){const t=this._elements[e];if(void 0===t)return;const n=new f(t[0],t[1],this._spRef);this._hasZ&&(n.z=t[2]),this._hasM&&(n.m=this._hasZ?t[3]:t[2]),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+e.toString(),this._lazyPt[e]=n}return this._lazyPt[e]}equalityTest(e){return e===this||null!==e&&e instanceof I!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class P extends l{constructor(e,t,n,r,i){super(e),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=n,this._hasM=r,this._spRef=t,this._cacheId=i}get(e){if(void 0===this._lazyPath[e]){const t=this._elements[e];if(void 0===t)return;this._lazyPath[e]=new I(t,this._spRef,this._hasZ,this._hasM,this._cacheId,e)}return this._lazyPath[e]}equalityTest(e){return e===this||null!==e&&e instanceof P!=0&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class Y{constructor(e){this.value=e}}class L{constructor(e){this.value=e}}const G={type:"VOID"},z=Symbol("BREAK"),q=Symbol("CONTINUE");function V(e,t,n){return""===t||null==t||t===n||t===n?e:e=e.split(t).join(n)}function U(e){return e instanceof M}function E(e){return e instanceof F}function H(e){return!!(k(e)||C(e)||se(e)||oe(e)||ue(e)||x(e)||null===e||e===G||"number"==typeof e)}function $(e,t){return void 0===e?t:e}function B(e){return null==e?"":A(e)||ae(e)?"Array":se(e)?"Date":ue(e)?"Time":oe(e)?"DateOnly":k(e)?"String":x(e)?"Boolean":C(e)?"Number":"esri.arcade.Attachment"===e?.declaredClass?"Attachment":"esri.arcade.Portal"===e?.declaredClass?"Portal":"esri.arcade.Dictionary"===e?.declaredClass?"Dictionary":ie(e)?"KnowledgeGraph":e instanceof F?"Module":Q(e)?"Feature":e instanceof f?"Point":e instanceof b?"Polygon":e instanceof S?"Polyline":e instanceof g?"Multipoint":e instanceof y?"Extent":U(e)?"Function":ee(e)?"FeatureSet":re(e)?"FeatureSetCollection":X(e)?"Voxel":e===G?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognized Type"}function K(e){return e===G}function W(e){return e instanceof p}function Q(e){return"esri.arcade.Feature"===e?.arcadeDeclaredClass}function X(e){return"esri.arcade.Voxel"===e?.arcadeDeclaredClass}function ee(e){return"esri.arcade.featureset.support.FeatureSet"===e?.declaredRootClass}function te(e){return"esri.arcade.Dictionary"===e?.declaredClass}function ne(e){return te(e)||Q(e)||X(e)}function re(e){return"esri.arcade.featureSetCollection"===e?.declaredRootClass}function ie(e){return"esri.rest.knowledgeGraph.KnowledgeGraph"===e?.declaredClass}function ae(e){return e instanceof l}function se(e){return e instanceof n}function oe(e){return e instanceof i}function ue(e){return e instanceof r}function le(e){return null!=e&&"object"==typeof e}function fe(e,t,n,r,i){if(e.length<t||e.length>n)throw new s(r,o.WrongNumberOfParameters,i)}function ce(e){return e<0?-Math.round(-e):Math.round(e)}function me(e,t){return isNaN(e)||null==t||""===t?e.toString():(t=V(t,"‰",""),t=V(t,"¤",""),h(e,{pattern:t}))}function he(e,t){return null==t||""===t?e.toISOString(!0):e.toFormat(de(t),{locale:T(),numberingSystem:"latn"})}function de(e,t=!1){e=e.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let n="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const i of e.match(r)||[])switch(i){case"D":n+="d";break;case"DD":n+="dd";break;case"DDD":n+="o";break;case"d":n+="c";break;case"ddd":n+="ccc";break;case"dddd":n+="cccc";break;case"M":n+="L";break;case"MM":n+="LL";break;case"MMM":n+="LLL";break;case"MMMM":n+="LLLL";break;case"YY":n+="yy";break;case"Y":case"YYYY":n+="yyyy";break;case"Q":n+="q";break;case"Z":n+="Z";break;case"ZZ":n+="ZZ";break;case"ZZZ":n+="ZZZ";break;case"ZZZZ":n+=t?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":n+=t?"[ZZZZZ]":"ZZZZZ";break;case"S":n+="'S'";break;case"SS":n+="'SS'";break;case"SSS":n+="u";break;case"A":case"a":n+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":n+=i;break;default:i.length>=2&&"["===i.slice(0,1)&&"]"===i.slice(-1)?n+=`'${i.slice(1,-1)}'`:n+=`'${i}'`}return n}function ye(e,t,n){switch(n){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function pe(e,t,r){if(null===e){if(null===t||t===G)return ye(null,null,r);if(C(t))return ye(0,t,r);if(k(t))return ye(0,Te(t),r);if(x(t))return ye(0,Te(t),r);if(se(t))return ye(0,t.toNumber(),r);if(ue(t))return ye(e,t.toNumber(),r);if(oe(t))return ye(e,t.toNumber(),r)}if(e===G){if(null===t||t===G)return ye(null,null,r);if(C(t))return ye(0,t,r);if(k(t))return ye(0,Te(t),r);if(x(t))return ye(0,Te(t),r);if(se(t))return ye(0,t.toNumber(),r);if(ue(t))return ye(e,t.toNumber(),r);if(oe(t))return ye(e,t.toNumber(),r)}else if(C(e)){if(C(t))return ye(e,t,r);if(x(t))return ye(e,Te(t),r);if(null===t||t===G)return ye(e,0,r);if(k(t))return ye(e,Te(t),r);if(se(t))return ye(e,t.toNumber(),r);if(ue(t))return ye(e,t.toNumber(),r);if(oe(t))return ye(e,t.toNumber(),r)}else if(k(e)){if(k(t))return ye(Se(e),Se(t),r);if(se(t))return ye(Te(e),t.toNumber(),r);if(ue(t))return ye(Te(e),t.toNumber(),r);if(oe(t))return ye(Te(e),t.toNumber(),r);if(C(t))return ye(Te(e),t,r);if(null===t||t===G)return ye(Te(e),0,r);if(x(t))return ye(Te(e),Te(t),r)}else if(se(e)){if(se(t))return e.timeZone!==t.timeZone&&(e.isUnknownTimeZone?e=n.arcadeDateAndZoneToArcadeDate(e,t.timeZone):t.isUnknownTimeZone&&(t=n.arcadeDateAndZoneToArcadeDate(t,e.timeZone))),ye(e.toNumber(),t.toNumber(),r);if(null===t||t===G)return ye(e.toNumber(),0,r);if(C(t))return ye(e.toNumber(),t,r);if(x(t))return ye(e.toNumber(),Te(t),r);if(k(t))return ye(e.toNumber(),Te(t),r);if(ue(t))throw new s(null,o.CannotCompareDateAndTime,null);if(oe(t))return ye(e.toNumber(),t.toNumber(),r)}else if(x(e)){if(x(t))return ye(e,t,r);if(C(t))return ye(Te(e),Te(t),r);if(se(t))return ye(Te(e),t.toNumber(),r);if(ue(t))return ye(Te(e),t.toNumber(),r);if(oe(t))return ye(Te(e),t.toNumber(),r);if(null===t||t===G)return ye(Te(e),0,r);if(k(t))return ye(Te(e),Te(t),r)}else if(oe(e)){if(se(t))return ye(e.toNumber(),t.toNumber(),r);if(null===t||t===G)return ye(e.toNumber(),0,r);if(C(t))return ye(e.toNumber(),t,r);if(x(t))return ye(e.toNumber(),Te(t),r);if(k(t))return ye(e.toNumber(),Te(t),r);if(ue(t))throw new s(null,o.CannotCompareDateAndTime,null);if(oe(t))return ye(e.toNumber(),t.toNumber(),r)}else if(ue(e)){if(se(t))throw new s(null,o.CannotCompareDateAndTime,null);if(null===t||t===G)return ye(e.toNumber(),0,r);if(C(t))return ye(e.toNumber(),t,r);if(x(t))return ye(e.toNumber(),Te(t),r);if(k(t))return ye(e.toNumber(),Te(t),r);if(ue(t))return ye(e.toNumber(),t.toNumber(),r);if(oe(t))throw new s(null,o.CannotCompareDateAndTime,null)}return!!ge(e,t)&&("<="===r||">="===r)}function ge(e,t){if(e===t)return!0;if(null===e&&t===G||null===t&&e===G)return!0;if(se(e)&&se(t))return e.equals(t);if(ue(e)&&ue(t))return e.equals(t);if(oe(e)&&oe(t))return e.equals(t);if(e instanceof P)return e.equalityTest(t);if(e instanceof I)return e.equalityTest(t);if(e instanceof f&&t instanceof f){const n=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(null!=n)return n===r}if(le(e)&&le(t)){if(e._arcadeCacheId===t._arcadeCacheId&&void 0!==e._arcadeCacheId&&null!==e._arcadeCacheId)return!0;if(e._underlyingGraphic===t._underlyingGraphic&&void 0!==e._underlyingGraphic&&null!==e._underlyingGraphic)return!0}return!1}function be(e,{useNumbersForDates:t}){let n="";for(const r in e){""!==n&&(n+=",");const i=e[r];null==i?n+=JSON.stringify(r)+":null":x(i)||C(i)||k(i)?n+=JSON.stringify(r)+":"+JSON.stringify(i):W(i)?n+=JSON.stringify(r)+":"+Ze(i):ue(i)||oe(i)?n+=`${JSON.stringify(r)}:${JSON.stringify(i.toString())}`:ae(i)||Array.isArray(i)?n+=JSON.stringify(r)+":"+Ze(i,null,t):se(i)?n+=t?JSON.stringify(r)+":"+JSON.stringify(i.getTime()):JSON.stringify(r)+":"+i.stringify():null!==i&&"object"==typeof i&&"castToText"in i&&(n+=JSON.stringify(r)+":"+i.castToText(t))}return"{"+n+"}"}function Se(e,t){if(k(e))return e;if(null===e)return"";if(C(e))return me(e,t);if(x(e))return e.toString();if(se(e))return he(e,t);if(ue(e))return e.toFormat(t);if(oe(e))return e.toFormat(t);if(e instanceof p)return JSON.stringify(e.toJSON());if(A(e)){const t=[];for(let n=0;n<e.length;n++)t[n]=_e(e[n]);return"["+t.join(",")+"]"}if(e instanceof l){const t=[];for(let n=0;n<e.length();n++)t[n]=_e(e.get(n));return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&"castToText"in e?e.castToText():U(e)?"object, Function":e===G?"":E(e)?"object, Module":""}function Ne(e){const t=[];if(e instanceof l){for(let n=0;n<e.length();n++)t[n]=Te(e.get(n));return t}if(!A(e))return null;for(let n=0;n<e.length;n++)t[n]=Te(e[n]);return t}function Ze(e,t,n=!1){if(k(e))return e;if(null===e)return"";if(C(e))return me(e,t);if(x(e))return e.toString();if(se(e))return he(e,t);if(ue(e))return e.toFormat(t);if(oe(e))return e.toFormat(t);if(e instanceof p)return e instanceof y?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+Fe(e.spatialReference)+"}":Fe(e.toJSON(),((e,t)=>e.key===t.key?0:"spatialReference"===e.key?1:"spatialReference"===t.key||e.key<t.key?-1:e.key>t.key?1:0));if(A(e)){const t=[];for(let r=0;r<e.length;r++)t[r]=_e(e[r],n);return"["+t.join(",")+"]"}if(e instanceof l){const t=[];for(let r=0;r<e.length();r++)t[r]=_e(e.get(r),n);return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&"castToText"in e?e.castToText(n):U(e)?"object, Function":e===G?"":E(e)?"object, Module":""}function _e(e,t=!1){if(null===e)return"null";if(x(e)||C(e)||k(e))return JSON.stringify(e);if(e instanceof p)return Ze(e,null,t);if(e instanceof l)return Ze(e,null,t);if(Array.isArray(e))return Ze(e,null,t);if(se(e))return t?JSON.stringify(e.getTime()):JSON.stringify(he(e,""));if(ue(e))return JSON.stringify(e.toString());if(oe(e))return JSON.stringify(e.toString());if(null!==e&&"object"==typeof e){if("castToText"in e)return e.castToText(t)}else if(e===G)return"null";return"null"}function Te(e,t){return C(e)?e:null===e||""===e?0:se(e)||oe(e)||ue(e)?NaN:x(e)?e?1:0:A(e)||""===e||void 0===e?NaN:void 0!==t&&k(e)?(t=V(t,"‰",""),t=V(t,"¤",""),d(e,{pattern:t})):e===G?0:Number(e)}function xe(e,t){if(se(e))return e;if(k(e)){const r=function(e,t){const n=/ (\d\d)/,r=a(t);let i=w.fromISO(e,{zone:r});return i.isValid||n.test(e)&&(e=e.replace(n,"T$1"),i=w.fromISO(e,{zone:t}),i.isValid)?i:null}(e,t);if(r)return n.dateTimeToArcadeDate(r)}return null}function Ce(e){return x(e)?e:k(e)?"true"===(e=e.toLowerCase()):!!C(e)&&0!==e&&!isNaN(e)}function ke(e,t){return null==e?null:(null!==e.spatialReference&&void 0!==e.spatialReference||(e.spatialReference=t),e)}function Ae(e){if(null===e)return null;if(e instanceof f)return"NaN"===e.x||null===e.x||isNaN(e.x)?null:e;if(e instanceof b){if(0===(e.curveRings??e.rings).length)return null;for(const t of e.curveRings??e.rings)if(t.length>0)return e;return null}if(e instanceof S){if(0===(e.curvePaths??e.paths).length)return null;for(const t of e.curvePaths??e.paths)if(t.length>0)return e;return null}return e instanceof g?0===e.points.length?null:e:e instanceof y?"NaN"===e.xmin||null===e.xmin||isNaN(e.xmin)?null:e:null}function De(e,t){if(!e)return t;if(!e.domain)return t;let n=null,r=null;if(se(t))n=t.toNumber();else if(oe(t))n=t.toString();else if(ue(t))n=t.toStorageString();else if("string"===e.field.type||"esriFieldTypeString"===e.field.type)n=Se(t);else{if(null==t)return null;if(""===t)return t;n=Te(t)}for(let t=0;t<e.domain.codedValues.length;t++){const i=e.domain.codedValues[t];i.code===n&&(r=i)}return null===r?Se(t):r.name}function Oe(e,t){if(!e)return t;if(!e.domain)return t;let n=null;const r=Se(t);for(let t=0;t<e.domain.codedValues.length;t++){const i=e.domain.codedValues[t];i.name===r&&(n=i)}return null===n?t:n.code}function je(e,t,n=null,r=null){if(!t)return null;if(!t.fields)return null;let i,a,u=null;for(let n=0;n<t.fields.length;n++){const r=t.fields[n];r.name.toLowerCase()===e.toString().toLowerCase()&&(u=r)}if(null===u)throw new s(null,o.FieldNotFound,null,{key:e});let l=t.typeIdField,f="id",c=t.types;if(t.subtypeField&&(l=t.subtypeField,f="code",c=t.subtypes??[]),null===r&&n&&l)r=n.hasField(l)?n.field(l):null;else if(l&&null!==r){let e=!1;for(const t of c||[])if(r===t[f]){e=!0;break}if(!e)for(const t of c||[])if(r===t.name){r=t[f],e=!0;break}e||(r=null,n&&l&&(r=n.hasField(l)?n.field(l):null))}return null!=r&&c.some((e=>e[f]===r&&(i=e.domains?.[u.name],i&&"inherited"===i.type&&(i=we(u.name,t),a=!0),!0))),a||i||(i=we(e,t)),{field:u,domain:i}}function we(e,t){let n;return t.fields.some((t=>(t.name.toLowerCase()===e.toLowerCase()&&(n=t.domain),!!n))),n}function Fe(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const n="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(i=t.cmp,function(e){return function(t,n){const r={key:t,value:e[t]},a={key:n,value:e[n]};return i(r,a)}});var i;const a=[];return function e(t){if(t?.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let i,s;if(Array.isArray(t)){for(s="[",i=0;i<t.length;i++)i&&(s+=","),s+=e(t[i])||"null";return s+"]"}if(null===t)return"null";if(a.includes(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const o=a.push(t)-1,u=Object.keys(t).sort(r?.(t));for(s="",i=0;i<u.length;i++){const n=u[i],r=e(t[n]);r&&(s&&(s+=","),s+=JSON.stringify(n)+":"+r)}return a.splice(o,1),"{"+s+"}"}(e)}function Me(e){if(null===e)return null;const t=[];for(const n of e)Q(n)?t.push(n.geometry()):t.push(n);return t}function Re(e,t){if(!(t instanceof f))throw new s(null,o.InvalidParameter,null);e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function Je(e,t){if(A(e)||ae(e)){let n=!1,r=!1,i=[],a=t;if(A(e)){for(const t of e)Re(i,t);i.length>0&&(a=e[0].spatialReference,n=e[0].hasZ,r=e[0].hasM)}else if(e instanceof I)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else{if(!ae(e))throw new s(null,o.InvalidParameter,null);for(const t of e.toArray())Re(i,t);i.length>0&&(a=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===i.length?null:(Z(i)||(i=i.slice().reverse()),new b({rings:[i],spatialReference:a,hasZ:n,hasM:r}))}return e}function ve(e,t){if(A(e)||ae(e)){let n=!1,r=!1,i=[],a=t;if(A(e)){for(const t of e)Re(i,t);i.length>0&&(a=e[0].spatialReference,n=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof I)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else if(ae(e)){for(const t of e.toArray())Re(i,t);i.length>0&&(a=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===i.length?null:new S({paths:[i],spatialReference:a,hasZ:n,hasM:r})}return e}function Ie(e,t){if(A(e)||ae(e)){let n=!1,r=!1,i=[],a=t;if(A(e)){for(const t of e)Re(i,t);i.length>0&&(a=e[0].spatialReference,n=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof I)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,a=e.get(0).spatialReference);else if(ae(e)){for(const t of e.toArray())Re(i,t);i.length>0&&(a=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===i.length?null:new g({points:i,spatialReference:a,hasZ:n,hasM:r})}return e}function Pe(e,t=!0){if(null==e)return[];if(A(e)){const n=[];for(const r of e){const e=Se(r);(t||""!==e)&&n.push(e)}return n}if(ae(e)){const n=[];for(let r=0;r<e.length();r++){const i=Se(e.get(r));(t||""!==i)&&n.push(i)}return n}if(H(e)){const n=Se(e);if(t||""!==n)return[n]}return[]}let Ye=0;function Le(e){return Ye++,Ye%100==0?(Ye=0,new Promise((t=>{setTimeout((()=>{t(e)}),0)}))):e}function Ge(e,t,n){switch(n){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function ze(e,t=null){return null==e?null:x(e)||C(e)||k(e)?e:e instanceof p?!0===t?.keepGeometryType?e:e.toJSON():e instanceof l?e.toArray().map((e=>ze(e,t))):Array.isArray(e)?e.map((e=>ze(e,t))):D(e)?e:se(e)?e.toJSDate():ue(e)?e.toString():oe(e)?e.toJSDate():null!==e&&"object"==typeof e&&void 0!==e.castAsJson?e.castAsJson(t):null}async function qe(e,t,n,r,i){const a=await Ve(e,t,n);i[r]=a}async function Ve(e,t=null,n=null){if(e instanceof l&&(e=e.toArray()),null==e)return null;if(H(e)||e instanceof p||D(e)||se(e))return ze(e,n);if(Array.isArray(e)){const r=[],i=[];for(const a of e)null===a||H(a)||a instanceof p||D(a)||se(a)?i.push(ze(a,n)):(i.push(null),r.push(qe(a,t,n,i.length-1,i)));return r.length>0&&await Promise.all(r),i}return null!==e&&"object"==typeof e&&void 0!==e.castAsJsonAsync?e.castAsJsonAsync(t,n):null}function Ue(e){return Ee(e)?e.parent:e}function Ee(e){return e&&"declaredClass"in e&&"esri.layers.support.SubtypeSublayer"===e.declaredClass}function He(e,t,n){const r=Ue(e.fullSchema());return null===r?null:r.fields?je(t,r,e,n):null}function $e(e){const t=Ue(e.fullSchema());return null===t?null:t.fields?t.subtypeField?{subtypeField:t.subtypeField,subtypes:t.subtypes?t.subtypes.map((e=>({name:e.name,code:e.code}))):[]}:t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map((e=>({name:e.name,code:e.id}))):[]}:null:null}function Be(e,t,n,r){const i=Ue(e.fullSchema());if(null===i)return null;if(!i.fields)return null;const a=je(t,i,e,r);if(void 0===n)try{n=e.field(t)}catch(e){return null}return De(a,n)}function Ke(e,t,n,r){const i=Ue(e.fullSchema());if(null===i)return null;if(!i.fields)return null;if(void 0===n){try{n=e.field(t)}catch(e){return null}return n}return Oe(je(t,i,e,r),n)}function We(e){return e?.timeZone??"system"}function Qe(e){const t=Ue(e.fullSchema());if(null===t)return null;if(!t.fields)return null;const n=[];for(const e of t.fields)n.push(c(e));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField??"",geometryType:void 0===m[t.geometryType]?"":m[t.geometryType],fields:n}}function Xe(r,i){const a=n.systemTimeZoneCanonicalName;return"system"===r&&(r=a),{version:et,engineVersion:t,timeZone:r,userTimeZone:a,spatialReference:i instanceof N?i.toJSON():i,application:e.applicationName??"",engine:"web",locale:T()}}const et="1.32",tt=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:L,ReturnResult:Y,absRound:ce,arcadeVersion:et,autoCastArrayOfPointsToMultiPoint:Ie,autoCastArrayOfPointsToPolygon:Je,autoCastArrayOfPointsToPolyline:ve,autoCastFeatureToGeometry:Me,binaryOperator:Ge,breakResult:z,castAsJson:ze,castAsJsonAsync:Ve,castRecordToText:be,continueResult:q,defaultExecutingContext:Xe,defaultTimeZone:We,defaultUndefined:$,equalityTest:ge,featureDomainCodeLookup:Ke,featureDomainValueLookup:Be,featureFullDomain:He,featureSchema:Qe,featureSubtypes:$e,fixNullGeometry:Ae,fixSpatialReference:ke,formatDate:he,formatNumber:me,getDomain:je,getDomainCode:Oe,getDomainValue:De,getType:B,greaterThanLessThan:pe,isArray:A,isBoolean:x,isDate:se,isDateOnly:oe,isDictionary:te,isDictionaryLike:ne,isFeature:Q,isFeatureSet:ee,isFeatureSetCollection:re,isFunctionParameter:U,isGeometry:W,isGraphic:O,isImmutableArray:ae,isInteger:j,isJsDate:D,isKnowledgeGraph:ie,isModule:E,isNumber:C,isObject:le,isSimpleType:H,isString:k,isSubtypeGrouplayer:function(e){return e&&"declaredClass"in e&&"esri.layers.SubtypeGroupLayer"===e.declaredClass},isSubtypeSublayer:Ee,isTime:ue,isVoid:K,isVoxel:X,multiReplace:V,parseGeometryFromJson:function(e,t){const n=JSON.parse(e);return n&&!n.spatialReference&&(n.spatialReference=t),_(n)},pcCheck:fe,stableStringify:Fe,standardiseDateFormat:de,tick:Le,toBoolean:Ce,toDate:xe,toNumber:Te,toNumberArray:Ne,toString:Se,toStringArray:Pe,toStringExplicit:Ze,voidOperation:G},Symbol.toStringTag,{value:"Module"}));export{Le as $,F as A,ke as B,Je as C,ve as D,Ie as E,Ce as F,$ as G,We as H,L as I,xe as J,Pe as K,V as L,He as M,J as N,je as O,$e as P,Be as Q,Y as R,v as S,De as T,Ke as U,Oe as V,Ze as W,Qe as X,be as Y,ze as Z,Ve as _,H as a,Ee as a0,I as a1,P as a2,B as a3,de as a4,ce as a5,Ae as a6,X as a7,Ne as a8,Xe as a9,tt as aa,W as b,ae as c,Q as d,re as e,ee as f,te as g,ie as h,se as i,U as j,K as k,z as l,q as m,Se as n,pe as o,fe as p,ge as q,Ge as r,ne as s,Te as t,M as u,G as v,R as w,Me as x,ue as y,oe as z};
