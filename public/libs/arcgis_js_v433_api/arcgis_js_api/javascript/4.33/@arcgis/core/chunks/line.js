/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{s as t,k as e}from"./vec2.js";import{c as a}from"./vec2f64.js";import{O as n}from"./vec4f64.js";import{U as r}from"./unitUtils.js";import{l as o}from"./projectBuffer.js";import{h as i}from"./aaBoundingBox.js";import{G as s,a as u,n as l}from"./Matrix4PassUniform.js";import{g as c}from"./Indices.js";import{V as f}from"./ViewingMode.js";import{A as p}from"./orientedBoundingBox.js";import{V as m}from"./VertexAttribute.js";function h(a,h,b=null){const E=[],g=h.mapPositions;!function(t,e){const{attributeData:{position:a},removeDuplicateStartEnd:n}=t,r=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(a)&&n,o=a.length/3-(r?1:0),i=new Array(2*(o-1)),s=r?a.slice(0,-3):a;let u=0;for(let t=0;t<o-1;t++)i[u++]=t,i[u++]=t+1;e.push([m.POSITION,new p(s,i,3,r)])}(h,E);const I=E[0][1].data,d=E[0][1].indices.length,A=c(d);return function(t,e,a){if(null!=t.attributeData.colorFeature)return;const r=t.attributeData.color;e.push([m.COLOR,new p(r??n,a,4)])}(h,E,A),function(t,e,a){null==t.attributeData.sizeFeature&&e.push([m.SIZE,new p([t.attributeData.size??1],a,1,!0)])}(h,E,A),function(t,e,a){t.attributeData.normal&&e.push([m.NORMAL,new p(t.attributeData.normal,a,3)])}(h,E,A),function(t,e,a){null!=t.attributeData.colorFeature&&e.push([m.COLORFEATUREATTRIBUTE,new p([t.attributeData.colorFeature],a,1,!0)])}(h,E,A),function(t,e,a){null!=t.attributeData.sizeFeature&&e.push([m.SIZEFEATUREATTRIBUTE,new p([t.attributeData.sizeFeature],a,1,!0)])}(h,E,A),function(t,e,a){null!=t.attributeData.opacityFeature&&e.push([m.OPACITYFEATUREATTRIBUTE,new p([t.attributeData.opacityFeature],a,1,!0)])}(h,E,A),function(a,n,s){if(null==a.overlayInfo||a.overlayInfo.renderCoordsHelper.viewingMode!==f.Global||!a.overlayInfo.spatialReference.isGeographic)return;const u=i(s.length),c=r(a.overlayInfo.spatialReference);for(let t=0;t<u.length;t+=3)o(s,t,u,t,c);const h=s.length/3,b=l(h+1);let E=T,g=D,I=0,d=0;t(E,u[d++],u[d++]),d++,b[0]=0;for(let a=1;a<h+1;++a)a===h&&(d=0),t(g,u[d++],u[d++]),d++,I+=e(E,g),b[a]=I,[E,g]=[g,E];n.push([m.DISTANCETOSTART,new p(b,n[0][1].indices,1,!0)])}(h,E,I),new s(a,E,g,u.Line,b)}const T=a(),D=a();function b(t,e){if(null==t||0===t.length)return[];const a=[];return t.forEach((t=>{const n=t.length,r=i(3*n);t.forEach(((t,e)=>{r[3*e]=t[0],r[3*e+1]=t[1],r[3*e+2]=t[2]}));const o={attributeData:{position:r,normal:e},removeDuplicateStartEnd:!1};a.push(o)})),a}export{h as c,b as l};
