/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{g as t,m as e}from"./builderUtils.js";import{g as n,e as s,p as i,a,f as o,o as r,c as h}from"./shapeUtils.js";import{m as p}from"./createTemplateExecutor.js";import{execute as l}from"../geometry/operators/offsetOperator.js";import{isPolyline as g}from"../geometry/support/jsonUtils.js";var f,m;function c({templatePart:h,edits:l,relationships:m,shape:c,distance:d,isProportional:B,offsetDistance:A,vertexBeforeOffset:P,vertexPlacement:j,mode:v}){const x=P||0===A?c:u(c,A);if(null===x||!g(x))return;const E=t(x);A=P?A:0;let N=0,V=null,Z=0;for(let t=0;t<x.paths.length;t++){if(l.length>p&&"digitizing"===v)return;const g=x.paths[t].length,c=t===x.paths.length-1;for(let u=0;u<g;u++){if(l.length>p&&"digitizing"===v)return;if(u>0&&0!==d&&(N+=x.hasZ?n(x.paths[t][u-1],x.paths[t][u],E):s(x.paths[t][u-1],x.paths[t][u])),(0!==u||j!==f.NotBeginning)&&!(u===g-1&&j===f.NotEnd&&c||(0===u||u===g-1&&c)&&j===f.Interior||0===u&&d<0&&B||u===g-1&&d>0&&B)){if(0!==d){let e=1;if(B){const i=d<0?u-1:u+1;if(i>=g||i<0)continue;e=x.hasZ?n(x.paths[t][u],x.paths[t][i],E):s(x.paths[t][u],x.paths[t][i])}const o=N+e*d;V=x.hasZ?i(x,o,A,E):a(x,o,0)}else V=o(x,t,u),0!==A&&(V=r(V,u===g-1?[x.paths[t][u-1],x.paths[t][u]]:[x.paths[t][u],x.paths[t][u+1]],A));V&&e({templatePart:h,shape:V,edits:l,relationships:m,mode:v},`V${(Z+u).toString()}`)}}Z+=g}}function u(t,e){return l(t,e,{unit:"meters",joins:"miter",miterLimit:2})}function d(t){let e=0;for(const n of t.paths)e+=n.length;return e}function B({templatePart:p,edits:l,relationships:f,shape:c,distance:B,isProportional:A,offsetDistance:P,vertexBeforeOffset:j,vertexPlacement:v,mode:x}){const E=j||0===P?c:u(c,P);if(null===E||!g(E))return;const N=t(E);P=j?P:0;let V=null,Z="";if(0!==B){const t=v===m.AtBeginning?0:E.paths.length-1,e=v===m.AtBeginning?0:E.paths[E.paths.length-1].length-1,o=v===m.AtBeginning?0:h(E),r=v===m.AtBeginning?E.paths[0].length:E.paths[E.paths.length-1].length;let p=1;if(A){const i=B<0?e-1:e+1;if(i>=r||i<0)return;p=E.hasZ?n(E.paths[t][e],E.paths[t][i],N):s(E.paths[t][e],E.paths[t][i])}const l=o+p*B;V=E.hasZ?i(E,l,P,N):a(E,l,P),Z=v===m.AtBeginning?"V0":`V${(d(E)-1).toString()}`}else{if(V=v===m.AtBeginning?o(E,0,0):o(E,E.paths.length-1,E.paths[E.paths.length-1].length-1),0!==P)if(v===m.AtBeginning)V=r(V,[E.paths[0][0],E.paths[0][1]],P);else{const t=E.paths[E.paths.length-1];V=r(V,[t[t.length-2],t[t.length-1]],P)}Z=v===m.AtBeginning?"V0":`V${(d(E)-1).toString()}`}V&&e({templatePart:p,shape:V,edits:l,relationships:f,mode:x},Z)}!function(t){t[t.All=0]="All",t[t.NotBeginning=1]="NotBeginning",t[t.NotEnd=2]="NotEnd",t[t.Interior=3]="Interior"}(f||(f={})),function(t){t[t.AtBeginning=4]="AtBeginning",t[t.AtEnd=5]="AtEnd"}(m||(m={}));export{f as V,m as a,c as l,u as o,B as v};
