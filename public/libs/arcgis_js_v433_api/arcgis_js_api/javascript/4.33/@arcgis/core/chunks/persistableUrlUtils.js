/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{id as e}from"../kernel.js";import{changeDomain as t,makeAbsolute as r,makeRelative as s,isAbsolute as o,normalize as n,isDataProtocol as l,hasSameOrigin as a,getAppUrl as c,splitPathExtension as i,n as u}from"../core/urlUtils.js";function p(e,t){const o=t?.url?.path;if(e&&o&&(e=r(e,o,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=s(e,t.portalItem.itemUrl);null!=r&&v.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return(e=I(e,t?.portal))&&d.test(e)?R(e):e}function m(e,t,a=y.YES){if(null==(e=e&&d.test(e)?w(e):e))return e;!o(e)&&t?.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let c=r(e);if(t){const r=t.verifyItemRelativeUrls?.rootPath||t.url?.path;if(r){const o=I(r,t.portal),n=I(c,t.portal);c=s(n,o,o),null!=c&&c!==n&&c!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(c)}}return c=x(c,t?.portal),o(c)&&(c=n(c)),t?.resources&&t?.portalItem&&!o(c)&&!l(c)&&a===y.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(c),compress:!1}),c}function f(e,t,r){return p(e,r)}function h(e,t,r,s){const o=m(e,s);void 0!==o&&(t[r]=o)}const d=/\/items\/([^/]+)\/resources\/(.*)/,v=/^\.\/resources\//;function U(e){const t=e?.match(d)??null;return t?.[1]??null}function g(e){const t=e?.match(d)??null;if(null==t)return null;const r=t[2],s=r.lastIndexOf("/");if(-1===s){const{path:e,extension:t}=i(r);return{prefix:null,filename:e,extension:t}}const{path:o,extension:n}=i(r.slice(s+1));return{prefix:r.slice(0,s),filename:o,extension:n}}function x(e,r){return r&&!r.isPortal&&r.urlKey&&r.customBaseUrl?t(e,`${r.urlKey}.${r.customBaseUrl}`,r.portalHostname):e}function I(e,r){if(!r||r.isPortal||!r.urlKey||!r.customBaseUrl)return e;const s=`${r.urlKey}.${r.customBaseUrl}`,o=c();return a(o,`${o.scheme}://${s}`)?t(e,r.portalHostname,s):t(e,s,r.portalHostname)}function R(t){if(!t)return t||null;let r=t;return r&&e&&!e.findCredential(r)&&(r=u(r),r=r.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),r=r.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),r=r.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),r}function w(t){if(!t)return t||null;let r=t;return r=r.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),r=r.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),r=r.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),r&&e&&!e.findCredential(r)&&(r=u(r)),r}var y;!function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"}(y||(y={}));const P=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return y},ensureMainOnlineDomain:x,fromCDNUrl:w,fromJSON:p,itemIdFromResourceUrl:U,prefixAndFilenameFromResourceUrl:g,read:f,toCDNUrl:R,toJSON:m,write:h},Symbol.toStringTag,{value:"Module"}));export{y as M,R as a,g as b,x as e,p as f,U as i,P as p,f as r,m as t,h as w};
