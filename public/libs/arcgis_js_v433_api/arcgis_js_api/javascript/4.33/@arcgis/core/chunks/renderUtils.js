/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import a from"../Color.js";import{id as e}from"../kernel.js";import t from"../request.js";import{a as m,t as c}from"./colorUtils.js";import n from"../core/Error.js";import{h as s}from"../core/lang.js";import{c as o}from"./projector.js";import{r as l}from"./svgUtils.js";import{f as u}from"./utils4.js";var i;!function(a){a[a.size=22]="size",a[a.lineWidth=50]="lineWidth",a[a.maxSize=120]="maxSize",a[a.maxOutlineSize=80]="maxOutlineSize",a[a.tallSymbolWidth=20]="tallSymbolWidth"}(i||(i={}));const d={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],meshSymbol3DFill:[{type:"path",path:"M -10,-8 L 6,0 L 6,6 L -10,6 L -10,-8 Z"},{type:"path",path:"M -10,-8 L -7,-10 L 9,-2 L 6,0 L -10,-8 Z"},{type:"path",path:"M 6,0 L 9,-2 L 9,4 L 6,6 L 6,0 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}]};function p(a,e,t){const m=i.size;let c=m,n=m;a<1?c*=.75:a>1&&(n*=1.25);let s=m,o=m;return e&&t&&(c=n=s=o=0),[{type:"path",path:[{command:"M",values:[s,0]},{command:"L",values:[t?s:.875*s,0]},{command:"L",values:[t?c-.5*s:0,n-.5*o]},{command:"L",values:[c-.5*s,n-.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[s,0]},{command:"L",values:[s,e?0:.125*o]},{command:"L",values:[c-.5*s,e?n-.5*o:o]},{command:"L",values:[c-.5*s,n-.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[c-.5*s,n-.5*o]},{command:"L",values:[t?c-.5*s:0,n-.5*o]},{command:"L",values:[t?c-.5*s:0,e?n-.5*o:o]},{command:"L",values:[c-.5*s,e?n-.5*o:o]},{command:"Z",values:[]}]}]}function r(a){const e=i.size,t=.5*a;return[{type:"path",path:[{command:"M",values:[0,.7*e*.5]},{command:"L",values:[.3*e,.7*e]},{command:"L",values:[.3*e,.7*e+t]},{command:"L",values:[0,.7*e+t-.7*e*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*e,.7*e]},{command:"L",values:[.3*e,.7*e+t]},{command:"L",values:[e,t]},{command:"L",values:[e,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*e,0]},{command:"L",values:[e,0]},{command:"L",values:[.3*e,.7*e]},{command:"L",values:[0,.7*e*.5]},{command:"Z",values:[]}]}]}function h(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function v(a,e){let t=e?i.tallSymbolWidth:a;const m=a,c=e?4:6;t<=i.size?t-=.5*c:t-=c;const n=e?.35*t:.5*t;return[{type:"path",path:[{command:"M",values:[.5*t,0]},{command:"L",values:[t,.5*n]},{command:"L",values:[.5*t,n]},{command:"L",values:[0,.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[.5*t,n]},{command:"L",values:[.5*t,m]},{command:"L",values:[0,m-.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*t,n]},{command:"L",values:[.5*t,m]},{command:"L",values:[t,m-.5*n]},{command:"L",values:[t,.5*n]},{command:"Z",values:[]}]}]}function L(a,e){let t=e?i.tallSymbolWidth:a;const m=a,c=e?4:6;t<=i.size?t-=.5*c:t-=c;const n=.5*t,s=.15*t,o=m-s;return[{type:"ellipse",cx:.5*t,cy:o,rx:n,ry:s},{type:"path",path:[{command:"M",values:[0,s]},{command:"L",values:[0,o]},{command:"L",values:[t,o]},{command:"L",values:[t,s]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:s,rx:n,ry:s}]}function y(a,e){let t=e?i.tallSymbolWidth:a;const m=a,c=e?4:6;t<=i.size?t-=.5*c:t-=c;const n=.15*t,s=m-n;return[{type:"ellipse",cx:.5*t,cy:s,rx:.5*t,ry:n},{type:"path",path:[{command:"M",values:[.5*t,0]},{command:"L",values:[t,s]},{command:"L",values:[0,s]},{command:"Z",values:[]}]}]}function f(a){let e=a;const t=a;e<i.size?e-=3:e-=6;const m=.15*e;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[e,0]},{command:"L",values:[.5*e,t-m]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*e,cy:0,rx:.5*e,ry:m}]}function M(a){let e=a;const t=a;e<i.size?e-=2:e-=4;const m=e,c=t,n=Math.floor(a/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*m,0]},{command:"L",values:[m,.5*c-n]},{command:"L",values:[.45*m-n,.5*c+n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*m,0]},{command:"L",values:[.45*m-n,.5*c+n]},{command:"L",values:[0,.5*c-n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*c-n]},{command:"L",values:[.45*m-n,.5*c+n]},{command:"L",values:[.45*m,t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*m,t]},{command:"L",values:[m,.5*c-n]},{command:"L",values:[.45*m-n,.5*c+n]},{command:"Z",values:[]}]}]}function g(a){const e=a;let t=a;return t<i.size?t-=1:t-=2,[{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[e,t]},{command:"L",values:[.45*e,.6*t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[0,t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,t]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[e,t]},{command:"Z",values:[]}]}]}function Z(a,e){return Math.round(Math.min(Math.max(a+255*e*.75,0),255))}function x(e,t){if(null==e)return new a;if("type"in e&&("linear"===e.type||"pattern"===e.type))return e;const m=new a(e);return new a([Z(m.r,t),Z(m.g,t),Z(m.b,t),m.a])}const z=o();function w(a,e){z.append(a,e),z.detach(e)}function b(a,e,t){const m=Math.ceil(e[0]),c=Math.ceil(e[1]);if(!a.some((a=>!!a.length)))return null;const n=t?.node||document.createElement("div");return null!=t.opacity&&(n.style.opacity=t.opacity.toString()),null!=t.effectView&&(n.style.filter=u(t.effectView)),w(n,(()=>l(a,m,c,t))),n}function S(a,e,t,n,s){switch(s){case"multiply":a[e]*=t[0],a[e+1]*=t[1],a[e+2]*=t[2],a[e+3]*=t[3];break;default:{const s=m({r:a[e],g:a[e+1],b:a[e+2]});s.h=n.h,s.s=n.s,s.v=s.v/100*n.v;const o=c(s);a[e]=o.r,a[e+1]=o.g,a[e+2]=o.b,a[e+3]*=t[3];break}}}function j(a,c,o,l,u){return function(a,e,m){return a?t(a,{responseType:"image"}).then((a=>{const t=a.data,c=t.width,n=t.height,s=c/n;let o=e;if(m){const a=Math.max(c,n);o=Math.min(o,a)}return{image:t,width:s<=1?Math.ceil(o*s):o,height:s<=1?o:Math.ceil(o/s)}})):Promise.reject(new n("renderUtils: imageDataSize","href not provided."))}(a,c,u).then((t=>{const n=t.width??c,u=t.height??c;if(t.image&&function(a,e){return!(!a||"ignore"===e||"multiply"===e&&255===a.r&&255===a.g&&255===a.b&&1===a.a)}(o,l)){let e=t.image.width,c=t.image.height;s("edge")&&/\.svg$/i.test(a)&&(e-=1,c-=1);const i=function(a,e){a=Math.ceil(a),e=Math.ceil(e);const t=document.createElement("canvas");t.width=a,t.height=e,t.style.width=a+"px",t.style.height=e+"px";const m=t.getContext("2d");return m.clearRect(0,0,a,e),m}(n,u);i.drawImage(t.image,0,0,e,c,0,0,n,u);const d=i.getImageData(0,0,n,u),p=[o.r/255,o.g/255,o.b/255,o.a],r=m(o);for(let a=0;a<d.data.length;a+=4)S(d.data,a,p,r,l);i.putImageData(d,0,0),a=i.canvas.toDataURL("image/png")}else{const t=e?.findCredential(a);if(t?.token){const e=a.includes("?")?"&":"?";a=`${a}${e}token=${t.token}`}}return{url:a,width:n,height:u}})).catch((()=>({url:a,width:c,height:c})))}export{i as S,x as a,Z as b,p as c,g as d,M as e,L as f,r as g,v as h,f as i,y as j,h as k,w as l,b as r,d as s,j as t};
