/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import e from"../core/Collection.js";import{b as t,E as n,a4 as i,a5 as r,a6 as l}from"./unitUtils.js";import{x as o}from"./layerUtils.js";import{V as a}from"./ViewingMode.js";import s from"../core/Error.js";import{d as c,c as u}from"./aaBoundingRect.js";import{g as f,T,m as S}from"./TerrainConst.js";function p(e){return null!=e&&"type"in e&&"vector-tile"===e.type}function m(e){return null!=e&&"type"in e&&"raster-tile"===e.type}function h(e){return null!=e&&"type"in e&&"tile-texture"===e.type}function E(e){return null!=e&&"type"in e&&"image+type"===e.type}var g;function O(e){return H(e)||i(e)||r(e)}function H(e){return t(e)||n(e)}!function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(g||(g={}));const d=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function(e,t,n,i){if(null==e)return f();const r=e.spatialReference;if(r.isGeographic&&!H(r))return new s("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const l=T.checkUnsupported(e);if(null!=l)return l;if(null==n)return new s("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const o=function(e,t){const n=e.lods,i=n[0].resolution*2**n[0].level,r=[i*e.size[0],i*e.size[1]],l=[e.origin.x,e.origin.y],o=c(t),a=u();T.computeRowColExtent(o,r,l,a);const f=(a[2]-a[0])*(a[3]-a[1]);if(f>S){const t=n[0].scale*2**n[0].level;let r=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*t/i;const l=Math.floor(Math.log(r)/Math.log(10));return r=Math.ceil(r/10**l)*10**l,new s("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(t).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+r.toLocaleString()+".",{level0Scale:t,suggestedLevel0Scale:r,requiredNumRootTiles:f,allowedNumRootTiles:S})}return null}(e,n);return o||(null==t||r.equals(t)||t.isWGS84&&r.isWebMercator?null:new s("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"))}},Symbol.toStringTag,{value:"Module"})),_=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:function(e,t,n,i){if(null==e)return f();const r=e?.lods.length-1,l=e.spatialReference;if(l.isWebMercator){if(!T.makeWebMercatorAuxiliarySphere(r).compatibleWith(e,i))return new s("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!O(l))return new s("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!T.makeGCSWithTileSize(e.spatialReference,e.size[0],r).compatibleWith(e,i))return e.spatialReference.isWGS84?new s("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new s("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return null==t||e.spatialReference.equals(t)?null:new s("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}},Symbol.toStringTag,{value:"Module"})),y={[a.Global]:_,[a.Local]:d};function R(e,t){e||console.warn("Terrain: "+t)}let W=!1,b=!1;function w(e){b=e,W=W||e}function I(e){W=e}function A(e,t){if(W&&!e){const e=(new Error).stack?.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+e),new Error("Assertion failed"+(t?": "+t:""))}}function N(e){return"imagery-tile"===e?.type||"wcs"===e?.type}function x(e){return"imagery-tile-3d"===e?.type}function U(e){return"tile-3d"===e?.type}function M(e){return"vector-tile-3d"===e?.type}function v(e){return"wmts-3d"===e?.type}function L(e){return"elevation-3d"===e?.type}function j(e){return"group"===e?.type}function C(e){return e&&(U(e)||v(e)||x(e)||M(e))}function G(e){return e&&(U(e)||x(e)||M(e)||v(e))}function k(e){return G(e)||L(e)}function z(e){return m(e?.sourceLayerInfo?.data)}function V(e){return B(e?.sourceLayerInfo)||!!e?.isVTLBackground}function F(e){return h(e?.sourceLayerInfo?.data)}function q(e){const t=e?.sourceLayerInfo?.data;return E(t)||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData}function B(e){return p(e?.data)}function D(e){return null!=e&&"release"in e&&e.release(),null}function P(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function J(e,t,n,i,r){return y[i].checkIfTileInfoSupportedForViewSR(e,n,t,r)}function K(e,t,n){let i=null,r=null;if("wmts"===e?.type){const l=Q(e,t,n);i=l.tileInfo,r=l.fullExtent}else{r=N(e)?e.getCompatibleFullExtent(t):e.fullExtent;const l=n===a.Local;i=N(e)?e.getCompatibleTileInfo(t,r,l):"vector-tile"===e?.type?l&&!X(t)||Y.force512VTL?e.tileInfo:e.tileInfo.getCompatibleForVTL(256):e.tileInfo}const l="tilemapCache"in e?e.tilemapCache?.effectiveMaxLOD:void 0;return null!=i&&null!=r&&null==J(i,r,t,n,l)?{tileInfo:i,fullExtent:r}:null}function Q(t,n,i){const r=o(t);if(null!=r){if(!e.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const e=r.find((e=>null==J(e.tileInfo,e.fullExtent,n,i)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}function X(e){return e.isWGS84||e.isWebMercator||n(e)||!l(e)}const Y={force512VTL:!1};function Z(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function $(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function ee(e,t,n=fe){return Math.abs(e-t)<n}function te(e){return e===g.NORTH_EAST?g.SOUTH_WEST:e===g.NORTH_WEST?g.SOUTH_EAST:e===g.SOUTH_WEST?g.NORTH_EAST:g.NORTH_WEST}function ne(e){return e===g.NORTH?g.SOUTH:e===g.EAST?g.WEST:e===g.SOUTH?g.NORTH:g.EAST}function ie(e){return e===g.NORTH_WEST||e===g.SOUTH_WEST}function re(e){return e===g.NORTH_WEST||e===g.NORTH_EAST}function le(e){return e===g.NORTH_WEST||e===g.WEST||e===g.SOUTH_WEST}function oe(e){return e===g.NORTH_EAST||e===g.EAST||e===g.SOUTH_EAST}function ae(e){return e===g.SOUTH_EAST||e===g.SOUTH||e===g.SOUTH_WEST}function se(e){return e===g.NORTH_EAST||e===g.NORTH||e===g.NORTH_WEST}const ce=[g.NORTH,g.EAST,g.SOUTH,g.WEST],ue=[g.NORTH_EAST,g.SOUTH_EAST,g.SOUTH_WEST,g.NORTH_WEST],fe=1e-5;export{oe as A,ee as B,b as C,ie as D,re as E,M as F,V as G,z as H,q as I,F as J,B as K,H as L,O as M,g as N,k as O,j as P,G as Q,L as R,I as S,w as T,K as a,N as b,J as c,A as d,x as e,ue as f,Q as g,W as h,E as i,$ as j,p as k,Z as l,h as m,ce as n,ne as o,m as p,C as q,D as r,te as s,Y as t,P as u,X as v,R as w,se as x,ae as y,le as z};
