/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{A as e,E as r,t}from"./enum.js";import"../core/lang.js";import{Q as a,a9 as s}from"./unitUtils.js";import"./Logger.js";import"../config.js";import"./jsonMap.js";import"./pe.js";import"./assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/Error.js";import"./jsonUtils.js";import"./MapUtils.js";import"../core/promiseUtils.js";import"./handleUtils.js";import"./events.js";import"./maybe.js";import"./persistableUrlUtils.js";const n=new Map([[1025,109452],[1033,109451],[9001,109404],[9002,109405],[9003,109406],[9005,109407],[9014,109408],[9030,109409],[9031,109410],[9033,109411],[9034,109412],[9035,109413],[9036,109414],[9037,109415],[9038,109416],[9039,109417],[9040,109418],[9041,109419],[9042,109420],[9043,109421],[9050,109422],[9051,109423],[9052,109424],[9053,109425],[9060,109426],[9061,109427],[9062,109428],[9063,109429],[9070,109430],[9080,109431],[9081,109432],[9082,109433],[9083,109434],[9084,109435],[9085,109436],[9086,109437],[9087,109438],[9093,109439],[9094,109440],[9095,109441],[9096,109442],[9097,109444],[9098,109445],[9099,109446],[9300,109447],[9301,109448],[9302,109449],[109001,109442],[109002,109443],[109003,109444],[109004,109445],[109005,109450],[109006,109451],[109007,109452],[109008,109453],[109009,109454],[109010,109455],[109011,109456],[109012,109457],[109013,109458],[109014,109459],[109015,109462],[109016,109464],[109017,109465],[109018,109466],[109030,109460],[109031,109461]]);function c(e){return(r,t)=>[r,{type:e,wkid:r,factor:t}]}const i=c("angular"),u=new Map([i(1031,4.84813681109536e-9),i(9101,1),i(9102,.017453292519943295),i(9103,.0002908882086657216),i(9104,484813681109536e-20),i(9105,.015707963267948967),i(9106,.015707963267948967),i(9109,1e-6),i(9112,.00015707963267948965),i(9113,15707963267948967e-22),i(9114,.0009817477042468104)]),l=c("linear"),o=new Map([l(1025,.001),l(1033,.01),l(9001,1),l(9002,.3048),l(9003,.30480060960121924),l(9005,.3047972654),l(9014,1.8288),l(9030,1852),l(9031,1.0000135965),l(9033,20.11684023368047),l(9034,.2011684023368047),l(9035,1609.3472186944375),l(9036,1e3),l(9037,.9143917962),l(9038,20.1166195164),l(9039,.201166195164),l(9040,.9143984146160287),l(9041,.3047994715386762),l(9042,20.116765121552632),l(9043,.2011676512155263),l(9050,.9143992),l(9051,.3047997333333333),l(9052,20.1167824),l(9053,.201167824),l(9060,.9143992042898124),l(9061,.30479973476327077),l(9062,20.116782494375872),l(9063,.2011678249437587),l(9070,.30480083333333335),l(9080,.30479951024814694),l(9081,.30479841),l(9082,.3047996),l(9083,.3047995),l(9084,.9143985307444408),l(9085,.91439523),l(9086,.9143988),l(9087,.9143985),l(9093,1609.344),l(9094,.3047997101815088),l(9095,.3048007491),l(9096,.9144),l(9097,20.1168),l(9098,.201168),l(9099,.914398),l(9300,.30479933333333337),l(9301,20.116756),l(9302,.20116756),l(109001,.9144),l(109002,.9144018288036576),l(109003,20.1168),l(109004,.201168),l(109005,.1),l(109006,.01),l(109007,.001),l(109008,.0254),l(109009,.025400050800101603),l(109010,5.0292),l(109011,5.029210058420118),l(109012,1853.248),l(109013,1853.184),l(109014,1.7018),l(109015,.8466683600033867),l(109016,.00035277777777777776),l(109017,1e-6),l(109018,1e-9),l(109030,5e4),l(109031,15e4)]),m=o.get(9001),f=c("area"),p=new Map([f(109401,1e4),f(109402,4046.8564224),f(109403,4046.872609874252),f(109404,1),f(109405,.09290304),f(109406,.09290341161327487),f(109407,.09290137299531805),f(109408,3.34450944),f(109409,3429904),f(109410,1.000027193184865),f(109411,404.6872609874253),f(109412,.04046872609874252),f(109413,2589998.470319522),f(109414,1e6),f(109415,.8361123569578626),f(109416,404.6783807676053),f(109417,.04046783807676053),f(109418,.8361244606523066),f(109419,.09290271785025629),f(109420,404.6842389557165),f(109421,.04046842389557164),f(109422,.83612589696064),f(109423,.0929028774400711),f(109424,404.6849341289498),f(109425,.04046849341289498),f(109426,.836125904805842),f(109427,.09290287831176021),f(109428,404.6849379260275),f(109429,.04046849379260275),f(109430,.09290354800069446),f(109431,.09290274144751023),f(109432,.09290207073852812),f(109433,.09290279616016),f(109434,.09290273520025),f(109435,.836124673027592),f(109436,.8361186366467529),f(109437,.8361251654414399),f(109438,.83612461680225),f(109439,2589988.110336),f(109440,.09290286332673177),f(109441,.09290349665192114),f(109442,.83612736),f(109443,.8361307045194736),f(109444,404.68564224),f(109445,.040468564224),f(109446,.836123702404),f(109447,.09290263360044447),f(109448,404.683871963536),f(109449,.0404683871963536),f(109450,.01),f(109451,1e-4),f(109452,1e-6),f(109453,64516e-8),f(109454,.0006451625806477421),f(109455,25.29285264),f(109456,25.29295381171408),f(109457,3434528.149504),f(109458,3434290.937856),f(109459,2.89612324),f(109460,25e8),f(109461,225e8),f(109462,.7168473118308245),f(109463,100),f(109464,1.244521604938271e-7),f(109465,1e-12),f(109466,1e-18)]),g=p.get(109404),q=[];function y(e){return 0===e.length?'""':'"'===e[0]||"."===e[0]||e[0]>="0"&&e[0]<="9"?e:'"'+e.trim()+'"'}function d(e){try{for(let r=0;r<q.length;r++)if(q[r].spatialReferenceWkt===e)return q[r].unit;const r=h(function(e){let r="",t="",a=!1;for(let s=0;s<e.length;s++){const n=e[s];a?'"'===n?'"'===e[s+1]?(r+=`\\${n}`,s+=1):a=!1:r+=n:/\s/.test(n)||(","===n?(t+=""!==r?y(r)+",":",",r=""):")"===n||"]"===n?(t+=""!==r?y(r)+"]}":"]}",r=""):"("===n||"["===n?(t+='{ "entity": "'+r.toUpperCase().trim()+'", "values":[',r=""):'"'===n?(a=!0,r=""):r+=n)}return JSON.parse(t)}(e));if(null===r)return null;let t=null;for(const e of r.values)if("object"==typeof e&&("UNIT"===e.entity||"ANGLEUNIT"===e.entity||"LENGTHUNIT"===e.entity)){t=e;break}if(null===t)return null;const a=function(e,r,t){if(null!=t)try{if("EPSG"===t.values[0])return{type:e,wkid:Number.parseInt(t.values[1],10),factor:r}}catch(e){}return{type:e,factor:r}}("GEOGCS"===r.entity||"GEOGCRS"===r.entity?"angular":"linear",t.values[1],t.values[2]);return q.push({spatialReferenceWkt:e,unit:a}),q.length>10&&q.shift(),a}catch(e){return null}}function h(e){if(null===e)return null;switch(e.entity){case"GEOGCRS":case"GEOGCS":case"PROJCRS":case"PROJCS":return e}const r=[];for(const t of e.values)if("object"==typeof t&&void 0!==t.entity)switch(t.entity){case"GEOGCRS":case"GEOGCS":case"PROJCRS":case"PROJCS":return t;default:r.push(t)}for(const e of r){const r=h(e);if(null!=r)return r}return null}function w(e,r){let t;switch(e){case"linear":t=o;break;case"angular":t=u;break;case"area":t=p;break;default:return null}return t.get(r)}function k(e){const r=e.wkid;if(null!=r){const e=a.units[a[r]];if(null!=e)switch(e){case"Meter":return w("linear",9001);case"Foot":return w("linear",9002);case"Foot_US":return w("linear",9003);case"Foot_Clarke":return w("linear",9005);case"Yard_Clarke":return w("linear",9037);case"Link_Clarke":return w("linear",9039);case"Yard_Sears":return w("linear",9040);case"Foot_Sears":return w("linear",9041);case"Chain_Sears":return w("linear",9042);case"Chain_Benoit_1895_B":return w("linear",9062);case"Yard_Indian":return w("linear",9084);case"Yard_Indian_1937":return w("linear",9085);case"Foot_Gold_Coast":return w("linear",9094);case"Chain":return w("linear",9097);case"Chain_Sears_1922_Truncated":return w("linear",9301);case"50_Kilometers":return w("linear",109030);case"150_Kilometers":return w("linear",109031);default:throw new Error(`Unknown unit name: ${e}`)}return s.has(r)?w("angular",9105):w("angular",9102)}const t=e.wkt2||e.wkt;if(null!=t){const e=d(t);if(null!=e){if(null!=e.wkid){const r=w(e.type,e.wkid);if(null!=r)return r}return{type:e.type,wkid:-1,factor:e.factor}}}return null}function j(e){if("linear"!==e.type)return null;if(-1===e.wkid)return{type:"area",wkid:-1,factor:e.factor**2};const r=n.get(e.wkid);return null==r?null:w("area",r)}function _(a){if(null!=a){if("number"==typeof a)return p.get(a)??o.get(a)??u.get(a);if("string"!=typeof a)throw new e(null,r.InvalidParameter,null);switch(t(a)){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return p.get(109404);case"miles":case"mile":case"squaremile":case"squaremiles":return p.get(109439);case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return p.get(109414);case"acres":case"acre":case"ac":return p.get(109402);case"hectares":case"hectare":case"ha":return p.get(109401);case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return p.get(109442);case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return p.get(109405);case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return p.get(109409);case"millimeter":case"millimeters":case"squaremillimeter":case"squaremillimeters":return p.get(109452);case"centimeter":case"centimeters":case"squarecentimeter":case"squarecentimeters":return p.get(109451);case"decimeter":case"decimeters":case"squaredecimeter":case"squaredecimeters":return p.get(109450);case"inch":case"inches":case"squareinch":case"squareinches":return p.get(109453);case"usfoot":case"usfeet":case"squareusfoot":case"squareusfeet":return p.get(109406);case"usmile":case"usmiles":case"squareusmile":case"squareusmiles":return p.get(109413)}}}function C(a){if(null!=a){if("number"==typeof a)return o.get(a)??u.get(a)??p.get(a);if("string"!=typeof a)throw new e(null,r.InvalidParameter,null);switch(t(a)){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":case"hectares":case"hectare":case"ha":return o.get(9001);case"miles":case"mile":case"squaremile":case"squaremiles":return o.get(9093);case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return o.get(9036);case"yard":case"yd":case"yards":case"squareyards":case"squareyard":case"acres":case"acre":case"ac":return o.get(9096);case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return o.get(9002);case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return o.get(9030);case"millimeter":case"millimeters":case"squaremillimeter":case"squaremillimeters":return o.get(109007);case"centimeter":case"centimeters":case"squarecentimeter":case"squarecentimeters":return o.get(109006);case"decimeter":case"decimeters":case"squaredecimeter":case"squaredecimeters":return o.get(109005);case"inch":case"inches":case"squareinch":case"squareinches":return o.get(109008);case"usfoot":case"usfeet":case"squareusfoot":case"squareusfeet":return o.get(9003);case"usmile":case"usmiles":case"squareusmile":case"squareusmiles":return o.get(9035)}}}function U(e,r,t){if(e.type!==r.type)throw new Error(`Incompatible unit types. src=${e.type} dest=${r.type}`);return t*(e.factor/r.factor)}function E(e,r,t){if(null==e||null==r)return t;const a=k(e);if(null==a)throw new Error("Unknown spatial reference unit.");const s="area"===r.type&&"linear"===a.type?j(a):a;if(null==s)throw new Error(`Unknown spatial reference ${r.type} unit.`);return U(s,r,t)}function S(e,r,t){if(null==e||null==r)return t;const a=k(r);if(null==a)throw new Error("Unknown spatial reference unit.");const s="area"===e.type&&"linear"===a.type?j(a):a;if(null==s)throw new Error(`Unknown spatial reference ${e.type} unit.`);return U(e,s,t)}function G(e,r,t){return null==e||null==r?t:U(e,r,t)}export{G as convert,E as convertFromSpatialReferenceUnit,S as convertToSpatialReferenceUnit,k as getSpatialReferenceUnit,m as meters,g as squareMeters,_ as toAreaUnit,C as toLengthUnit};
