/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{h as e,clone as t,equals as s}from"./lang.js";import r from"./Handles.js";import{L as i}from"../chunks/Logger.js";import{d as n}from"../chunks/maybe.js";import{subclass as o,d as a}from"./accessorSupport/decorators/subclass.js";import{g as c}from"../chunks/get.js";import{L as l}from"../chunks/Lifecycle.js";import{a as h}from"../chunks/metadata.js";import{O as u}from"../chunks/ObjectPool.js";import{O as d}from"../chunks/ObservableBase.js";import{T as p,F as f,t as m,r as _,a as g,b as y,i as v}from"../chunks/tracking.js";import{property as E,s as w}from"./accessorSupport/decorators/property.js";import{r as O,b as A}from"../chunks/watch.js";import"../config.js";import"../chunks/ensureType.js";import"../chunks/MapUtils.js";import"../chunks/Warning.js";import"./Error.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"./scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"./promiseUtils.js";import"../chunks/events.js";import"../chunks/SetUtils.js";import"../chunks/SimpleTrackingTarget.js";const N=new WeakMap,T="https://www.esriurl.com/";function S(t,s,r,i={}){e("esri-deprecation-warnings")&&D(t,`This widget is deprecated. Use the ${s} component instead.`,{see:[`${s} component reference: ${T}${r}/`,`Esri's move to web components: ${T}components-transition-plan/`],replacement:`<${r}></${r}>`,warnOnce:!0,...i})}function I(t,s,r,i={}){e("esri-deprecation-warnings")&&D(t,`This view model is deprecated. Use the ${s} component directly instead.`,{see:[`${s} component reference: ${T}${r}/`,`Esri's move to web components: ${T}components-transition-plan/`],replacement:`<${r}></${r}>`,warnOnce:!0,...i})}function b(t,s,r={}){e("esri-deprecation-warnings")&&D(t,`Module: ${s}`,r)}function C(t,s,r={}){if(e("esri-deprecation-warnings")){const{moduleName:e}=r;D(t,"Function: "+(e?e+"::":"")+s+"()",r)}}function k(t,s,r={}){if(e("esri-deprecation-warnings")){const{moduleName:e}=r;D(t,"Property: "+(e?e+"::":"")+s,r)}}function j(t,s,r,i={}){if(e("esri-deprecation-warnings")){const{moduleName:e}=i;D(t,`'${(e?e+"::":"")+s}' value: ${r}`,i)}}function B(t,s,r={}){e("esri-deprecation-warnings")&&D(t,`Multiple argument constructor: ${s}`,{warnOnce:!0,replacement:`new ${s}({ <your properties here> })`,...r})}function D(t,s,r={}){if(e("esri-deprecation-warnings")){const{replacement:e,version:i,see:n,warnOnce:o}=r;let a=s;if(e&&(a+=`\n\t🛠️ Replacement: ${e}`),i&&(a+=`\n\t⚙️ Version: ${i}`),n)if(Array.isArray(n)){a+="\n\t🔗 See for more details:";for(const e of n)a+=`\n\t\t${e}`}else a+=`\n\t🔗 See ${n} for more details.`;!function(e,t,s=!1){const r=`🛑 DEPRECATED - ${t}`;if(!s)return void e.warn(r);let i=N.get(e);i||(i=new Set,N.set(e,i)),i.has(t)||(i.add(t),e.warn(r))}(t,a,o)}}var $;!function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.LINK_CHART=6]="LINK_CHART",e[e.USER=7]="USER"}($||($={}));const R=$.USER+1;function U(e){switch(e){case"defaults":return $.DEFAULTS;case"service":return $.SERVICE;case"portal-item":return $.PORTAL_ITEM;case"web-scene":return $.WEB_SCENE;case"web-map":return $.WEB_MAP;case"link-chart":return $.LINK_CHART;case"user":return $.USER;default:return null}}function L(e){switch(e){case $.DEFAULTS:return"defaults";case $.SERVICE:return"service";case $.PORTAL_ITEM:return"portal-item";case $.WEB_SCENE:return"web-scene";case $.WEB_MAP:return"web-map";case $.LINK_CHART:return"link-chart";case $.USER:return"user"}}function M(e){return L(e)}function P(e){return U(e)}function z(e){return L(e)}class H extends d{constructor(e,t){super(),this.propertyName=e,this.metadata=t,this.trackingTarget=new p(this),this.flags=0,this.flags=f.Dirty|(t.nonNullable?f.NonNullable:0)|(t.hasOwnProperty("value")?f.HasDefaultValue:0)|(void 0===t.get?f.DepTrackingInitialized:0)|(void 0===t.dependsOn?f.AutoTracked:0)}destroy(){this.flags&f.Dirty&&this.onCommitted(),super.destroy(),this.trackingTarget.destroy()}getComputed(e){e.mutable&&m(this);const t=e.store,s=this.propertyName,r=this.flags,i=t.get(s);if(r&f.Computing)return i;if(~r&f.Dirty&&t.has(s))return i;this.flags|=f.Computing;const n=e.host;let o;r&f.AutoTracked?o=_(this.trackingTarget,this.metadata.get,n):(g(n,this),o=this.metadata.get.call(n)),this.flags|=f.DepTrackingInitialized,t.set(s,o,$.COMPUTED);const a=t.get(s);return a===i?this.flags&=-2:y(this.commit,this),this.flags&=-5,a}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=-2,this.onCommitted()}onInvalidated(){~this.flags&f.Overridden&&(this.flags|=f.Dirty);const e=this._observers;if(e&&e.length>0)for(const t of e)t.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const t=e.slice();for(const e of t)e.onCommitted()}}}class W{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const s=new W;return this._values.forEach(((r,i)=>{e&&e.has(i)||s.set(i,t(r))})),s}get(e){return this._values.get(e)}originOf(){return $.USER}keys(){return[...this._values.keys()]}set(e,t){this._values.set(e,t)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}isAtOrigin(e,t){return this.has(e)}isBelowOrigin(e,t){return!this.has(e)}forEach(e){this._values.forEach(e)}}function F(e,t,s){return void 0!==e}function G(e,t,s,r){return!(void 0===e||null==s&&e.flags&f.NonNullable&&(r.lifecycle,l.INITIALIZING,1))}class V{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=l.INITIALIZING,this.store=new W,this.mutable=!0,this._origin=$.USER;const t=this.host.constructor.__accessorMetadata__;for(const e in t){const s=new H(e,t[e]);this.propertiesByName.set(e,s)}this.metadata=t}initialize(){this.lifecycle=l.CONSTRUCTING}constructed(){this.lifecycle=l.CONSTRUCTED}destroy(){this.lifecycle=l.DESTROYED,this.propertiesByName.forEach((e=>e.destroy()))}get initialized(){return this.lifecycle!==l.INITIALIZING}get(e){const t=this.propertiesByName.get(e);if(!F(t))return;if(t.metadata.get)return t.getComputed(this);this.mutable&&m(t);const s=this.store;return s.has(e)?s.get(e):t.metadata.value}originOf(e){const t=this.store.originOf(e);if(void 0===t){const t=this.propertiesByName.get(e);if(void 0!==t&&t.flags&f.HasDefaultValue)return"defaults"}return L(t)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const t=this.propertiesByName.get(e);if(F(t))return this.store.has(e)?this.store.get(e):t.metadata.value}internalSet(e,t){const s=this.propertiesByName.get(e);F(s)&&this._internalSet(s,t)}getDependsInfo(e,t,s){const r=this.propertiesByName.get(t);if(!F(r))return"";const i=new p,n=_(i,(()=>r.metadata.get?.call(e)));let o=`${s}${e.declaredClass.split(".").pop()}.${t}: ${n}\n`;const a=i.accessed??new Set;if(0===a.size)return o;s+="  ";for(const e of a)e instanceof H&&(o+=`${s}${e.propertyName}: undefined\n`);return o}setAtOrigin(e,t,s){const r=this.propertiesByName.get(e);if(F(r))return this._setAtOrigin(r,t,s)}isOverridden(e){const t=this.propertiesByName.get(e);return void 0!==t&&!!(t.flags&f.Overridden)}clearOrigin(e,t){const s=this.store,r=this.propertiesByName.get(e);if(!F(r))return;const i=s.isAtOrigin(e,t)&&!(r.flags&f.Overridden);s.delete(e,t),i&&r.notifyChange()}clearOverride(e){const t=this.propertiesByName.get(e);t&&t.flags&f.Overridden&&(t.flags&=-3,t.notifyChange())}override(e,t){const s=this.propertiesByName.get(e);if(!G(s,0,t,this))return;const r=s.metadata.cast;if(r){const e=this._cast(r,t),{valid:s,value:i}=e;if(x.release(e),!s)return;t=i}s.flags|=f.Overridden,this._internalSet(s,t)}set(e,t){const s=this.propertiesByName.get(e);if(!G(s,0,t,this))return;const r=s.metadata.cast;if(r){const e=this._cast(r,t),{valid:s,value:i}=e;if(x.release(e),!s)return;t=i}const i=s.metadata.set;i?i.call(this.host,t):this._internalSet(s,t)}setDefaultOrigin(e){this._origin=U(e)}getDefaultOrigin(){return L(this._origin)}notifyChange(e){const t=this.propertiesByName.get(e);void 0!==t&&t.notifyChange()}invalidate(e){const t=this.propertiesByName.get(e);void 0!==t&&t.invalidate()}commit(e){const t=this.propertiesByName.get(e);void 0!==t&&t.commit()}_internalSet(e,t){const s=this.lifecycle!==l.INITIALIZING?this._origin:$.DEFAULTS;this._setAtOrigin(e,t,s)}_setAtOrigin(e,t,r){const i=this.store,n=e.propertyName;if(i.isAtOrigin(n,r)&&s(t,i.get(n))&&~e.flags&f.Overridden)return;const o=i.isBelowOrigin(n,r)||i.isAtOrigin(n,r);o&&e.invalidate(),i.set(n,t,r),o&&e.commit(),v(this.host,e)}_cast(e,t){const s=x.acquire();return s.valid=!0,s.value=t,e&&(s.value=e.call(this.host,t,s)),s}}const x=new u(class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}});var K,Z,q;function Y(e){if(null==e)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return e.constructor?.__accessorMetadata__||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}!function(e){e[e.Ignore=0]="Ignore",e[e.Destroy=1]="Destroy",e[e.ThrowError=2]="ThrowError"}(K||(K={}));const J=Symbol("Accessor-Handles"),Q=Symbol("Accessor-Initialized");class X{static{Z=J,q=Q}static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:t,declaredClass:s,constructor:r}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const i=this;class n extends i{constructor(...e){super(...e),this.inherited=null,r&&r.apply(this,e)}}h(n.prototype);for(const t in e){const s=e[t];n.prototype[t]="function"==typeof s?function(...e){const r=this.inherited;let n;this.inherited=function(...e){if(i.prototype[t])return i.prototype[t].apply(this,e)};try{n=s.apply(this,e)}catch(e){throw this.inherited=r,e}return this.inherited=r,n}:e[t]}for(const e in t){const s=Y(t[e]);E(s)(n.prototype,e)}return o(s)(n)}static freeze(e){return e instanceof X?e.__accessor__.mutable=!1:Object.freeze(e),e}static isFrozen(e){return e instanceof X?!e.__accessor__.mutable:Object.isFrozen(e)}constructor(...e){if(this[Z]=null,this[q]=!1,this.constructor===X)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const t=new V(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:t}),e.length>0&&(t.ctorArgs=this.normalizeCtorArgs?.apply(this,e)??e[0])}postscript(){const e=this.__accessor__,t=e.ctorArgs;e.initialize(),t&&(this.set(t),e.ctorArgs=null),e.constructed(),this.initialize(),this[Q]=!0}initialize(){}[a](){this[J]=n(this[J])}destroy(){this.destroyed||(O(this),this.__accessor__.destroy())}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[Q]}get destroyed(){return this.__accessor__?.lifecycle===l.DESTROYED||!1}get destroying(){return this.__accessor__?.lifecycle===l.DESTROYING||!1}commitProperty(e){c(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,t){return w(this,e,t),this}watch(e,t,s){return C(i.getLogger(this),"`watch` is deprecated in favor of reactiveUtils.watch",{replacement:"reactiveUtils.watch",version:"4.32",see:"https://arcg.is/1vaqf42#watch",warnOnce:!0}),A(this,e,t,s)}addHandles(e,t){if(this.destroyed){const t=Array.isArray(e)?e:[e];for(const e of t)e.remove()}else(this[J]??=new r).add(e,t)}removeHandles(e){this[J]?.remove(e)}removeAllHandles(){this[J]?.removeAll()}removeHandlesReference(e){this[J]?.removeReference(e)}hasHandles(e){return!0===this[J]?.has(e)}_override(e,t){void 0===t?this.__accessor__.clearOverride(e):this.__accessor__.override(e,t)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,t){null==t?this.__accessor__.clearOverride(e):this.__accessor__.override(e,t)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,t){return this.__accessor__.internalSet(e,t),this}}export{$ as O,C as a,k as b,B as c,D as d,X as default,b as e,I as f,S as g,M as h,L as i,z as j,j as k,U as n,R as o,P as w};
