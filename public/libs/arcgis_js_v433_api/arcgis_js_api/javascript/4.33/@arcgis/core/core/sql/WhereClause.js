/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{h as e}from"../lang.js";import{D as t,T as r}from"../../chunks/TimeOnly.js";import{r as n,e as a}from"../../chunks/Logger.js";import{D as o,Z as i,F as s}from"../../chunks/datetime.js";import{s as l,U as u,i as c}from"../../chunks/UnknownTimeZone.js";import{u as p}from"../../chunks/mathUtils.js";import{i as d,b as f,f as m}from"../../chunks/guards.js";import"../../chunks/enum.js";import"../../chunks/locale.js";import"../../chunks/handleUtils.js";import"../../geometry/Extent.js";import"../../chunks/tslib.es6.js";import"../accessorSupport/decorators/property.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/metadata.js";import"../Error.js";import"../../config.js";import"../accessorSupport/decorators/subclass.js";import"../../chunks/Lifecycle.js";import"../../chunks/tracking.js";import"../../chunks/Warning.js";import"../../geometry/Geometry.js";import"../JSONSupport.js";import"../Accessor.js";import"../Handles.js";import"../../chunks/maybe.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/watch.js";import"../scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../promiseUtils.js";import"../../chunks/events.js";import"../../chunks/SetUtils.js";import"../../chunks/SimpleTrackingTarget.js";import"../../chunks/reader.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/jsonMap.js";import"../../chunks/pe.js";import"../../chunks/assets.js";import"../../request.js";import"../../kernel.js";import"../urlUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../accessorSupport/decorators/cast.js";import"../../geometry/support/webMercatorUtils.js";var h;!function(e){e.InvalidFunctionParameters="InvalidFunctionParameters",e.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction",e.UnsupportedSqlFunction="UnsupportedSqlFunction",e.UnsupportedOperator="UnsupportedOperator",e.UnsupportedSyntax="UnsupportedSyntax",e.UnsupportedIsRhs="UnsupportedIsRhs",e.UnsupportedIsLhs="UnsupportedIsLhs",e.InvalidDataType="InvalidDataType",e.CannotCastValue="CannotCastValue",e.FunctionNotRecognized="FunctionNotRecognized",e.InvalidTime="InvalidTime",e.InvalidParameterCount="InvalidParameterCount",e.InvalidTimeStamp="InvalidTimeStamp",e.InvalidDate="InvalidDate",e.InvalidOperator="InvalidOperator",e.IllegalInterval="IllegalInterval",e.YearMonthIntervals="YearMonthIntervals",e.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers",e.MissingStatisticParameters="MissingStatisticParameters"}(h||(h={}));const v={[h.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[h.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[h.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[h.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[h.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[h.UnsupportedOperator]:"Unsupported operator - {operator}",[h.UnsupportedSyntax]:"Unsupported syntax - {node}",[h.UnsupportedSqlFunction]:"Sql function not found = {function}",[h.InvalidDataType]:"Invalid sql data type",[h.InvalidDate]:"Invalid date encountered",[h.InvalidOperator]:"Invalid operator encountered",[h.InvalidTime]:"Invalid time encountered",[h.IllegalInterval]:"Illegal interval",[h.FunctionNotRecognized]:"Function not recognized",[h.InvalidTimeStamp]:"Invalid timestamp encountered",[h.InvalidParameterCount]:"Invalid parameter count for call to {name}",[h.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[h.YearMonthIntervals]:"Year-Month Intervals not supported",[h.CannotCastValue]:"Cannot cast value to the required data type"};class w extends Error{constructor(e,t){super(n(v[e],t)),this.declaredRootClass="esri.arcade.featureset.support.sqlerror",Error.captureStackTrace&&Error.captureStackTrace(this,w)}}function I(e){return Number.isNaN(e)||0===e?e:Math.trunc(e)}const g="esri.core.sql.SqlTimeStampOffset";class y{constructor(e){this._timeStampOffset=e,this.declaredRootClass=g,this._date=null}static isTimestampOffset(e){return"object"==typeof e&&null!=e&&"declaredRootClass"in e&&e.declaredRootClass===g}toDateTime(){return this._date??=o.fromISO(this._timeStampOffset,{setZone:!0}),this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return I(this.toDateTime().offset/60)}get timezoneOffsetMinutes(){return I(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return y.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(e){return new y(o.fromJSDate(e).toISO({includeOffset:!0}))}static fromDateTime(e){return new y(e.toISO({includeOffset:!0}))}static fromParts(e,t,r=0,n=0,a=0,o=0,i=0,s=!1,l=0,u=0){const c=`${e.toString().padStart(4,"0")}-${t.toString().padStart(2,"0")}-${r.toString().padStart(2,"0")}`;let p="";o<10&&(p="0");let d=`${n.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${p+o.toString()}`;0!==i&&(d+="."+i.toString().padStart(3,"0"));const f=`${s?"-":"+"}${l.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`;return new y(c+"T"+d+f)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let e=this.toDateTime().toSQL({includeOffset:!0,includeOffsetSpace:!0});return e&&(e=e.replace(".000","")),e}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(e){const t=this.toDateTime().plus(e);return y.fromDateTime(t)}}function T(e,t){const r=O[e.toLowerCase()];if(null==r)throw new w(h.FunctionNotRecognized);if(t.length<r.minParams||t.length>r.maxParams)throw new w(h.InvalidParameterCount,{name:e.toUpperCase()});return r.evaluate(t)}function N(e,t){const r=O[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}const O={min:{minParams:1,maxParams:1,evaluate:e=>E(e[0],"min")},max:{minParams:1,maxParams:1,evaluate:e=>E(e[0],"max")},avg:{minParams:1,maxParams:1,evaluate:e=>S(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>function(e){if(null===e)return null;let t=0;for(let r=0;r<e.length;r++){const n=e[r];if(null!==n){if(!x(n))throw new w(h.InvalidValueForAggregateFunction);t+=n}}return t}(e[0])},stddev:{minParams:1,maxParams:1,evaluate:e=>function(e){if(null===e)return null;const t=C(e);return null===t?null:Math.sqrt(t)}(e[0])},count:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>C(e[0])}};function S(e){if(null===e)return null;let t=0,r=0;for(let n=0;n<e.length;n++){const a=e[n];if(null!==a){if(!x(a))throw new w(h.InvalidValueForAggregateFunction);r++,t+=a}}return 0===r?null:t/e.length}function x(e){return"number"==typeof e}function E(e,n){if(null===e)return null;let a=null,i=null;for(const s of e){let e=s;e=t.isDateOnly(s)||r.isTimeOnly(s)?s.toNumber():o.isDateTime(s)?s.toMillis():y.isTimestampOffset(s)?s.toMilliseconds():s,(null===a||"max"===n&&null!==i&&null!==e&&i<=e||"min"===n&&null!==i&&null!==e&&i>=e)&&(a=s,i=e)}return a}function C(e){if(null===e)return null;if(0===(e=e.filter((e=>null!==e))).length)return null;const t=S(e);if(null===t)return null;let r=0;for(const n of e){if(!x(n))throw new w(h.InvalidValueForAggregateFunction);r+=(t-n)**2}return r/(e.length-1)}function D(e){if(null!==e.precision||null!==e.secondary)throw new w(h.PrimarySecondaryQualifiers)}function _(e,t){if(t.includes(".")){const r=t.split(".");e.second=parseFloat(r[0]),e.millis=parseInt(r[1],10)}else e.second=parseFloat(t)}const M="esri.core.sql.SqlInterval";class b{constructor(){this.declaredRootClass=M,this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}static isInterval(e){return"object"==typeof e&&null!=e&&"declaredRootClass"in e&&e.declaredRootClass===M}static createFromMilliseconds(e){const t=new b;return t.second=e/1e3,t}static createFromValueAndQualifier(e,t,r){let n=null;const a=new b;if(a.op="-"===r?"-":"+","interval-period"===t.type){D(t);const r=new RegExp("^[0-9]{1,}$");if("year"===t.period||"month"===t.period)throw new w(h.YearMonthIntervals);if("second"===t.period){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(e))throw new w(h.IllegalInterval);_(a,e)}else{if(!r.test(e))throw new w(h.IllegalInterval);a[t.period]=parseFloat(e)}}else{if(D(t.start),D(t.end),"year"===t.start.period||"month"===t.start.period||"year"===t.end.period||"month"===t.end.period)throw new w(h.YearMonthIntervals);switch(t.start.period){case"day":switch(t.end.period){case"hour":if(n=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!n.test(e))throw new w(h.IllegalInterval);a[t.start.period]=parseFloat(e.split(" ")[0]),a[t.end.period]=parseFloat(e.split(" ")[1]);break;case"minute":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!n.test(e))throw new w(h.IllegalInterval);{a[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");a.hour=parseFloat(r[0]),a.minute=parseFloat(r[1])}break;case"second":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new w(h.IllegalInterval);{a[t.start.period]=parseFloat(e.split(" ")[0]);const r=e.split(" ")[1].split(":");a.hour=parseFloat(r[0]),a.minute=parseFloat(r[1]),_(a,r[2])}break;default:throw new w(h.IllegalInterval)}break;case"hour":switch(t.end.period){case"minute":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!n.test(e))throw new w(h.IllegalInterval);a.hour=parseFloat(e.split(":")[0]),a.minute=parseFloat(e.split(":")[1]);break;case"second":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new w(h.IllegalInterval);{const t=e.split(":");a.hour=parseFloat(t[0]),a.minute=parseFloat(t[1]),_(a,t[2])}break;default:throw new w(h.IllegalInterval)}break;case"minute":if("second"!==t.end.period)throw new w(h.IllegalInterval);if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new w(h.IllegalInterval);{const t=e.split(":");a.minute=parseFloat(t[0]),_(a,t[1])}break;default:throw new w(h.IllegalInterval)}}return a}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}const F=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,A=/^(\d{1,2}):(\d{1,2})$/,P=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,L=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,R=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,k=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,U=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|-)(\d{1,2}):(\d{1,2})$/,$=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function j(e,t){if(t instanceof i)return t===u.instance?o.fromMillis(e.getTime(),{zone:u.instance}):o.fromJSDate(e,{zone:t});switch(t){case"system":case"local":case null:return o.fromJSDate(e);default:return"unknown"===t?.toLowerCase()?o.fromMillis(e.getTime(),{zone:u.instance}):o.fromJSDate(e,{zone:t})}}function V(e){return b.isInterval(e)}function z(e){return o.isDateTime(e)}function q(e){return t.isDateOnly(e)}function H(e){return r.isTimeOnly(e)}function Z(e){return y.isTimestampOffset(e)}function Y(e){let t=F.exec(e);if(null!==t){const[,e,n,a]=t,o=r.fromParts(parseInt(e,10),parseInt(n,10),parseInt(a,10),0);if(null!==o)return o;throw new w(h.InvalidTime)}if(t=A.exec(e),null!==t){const[,e,n]=t,a=r.fromParts(parseInt(e,10),parseInt(n,10),0,0);if(null!==a)return a;throw new w(h.InvalidTime)}if(t=P.exec(e),null!==t){const[,e,n,a,o]=t,i=r.fromParts(parseInt(e,10),parseInt(n,10),parseInt(a,10),parseInt(o,10));if(null!==i)return i;throw new w(h.InvalidTime)}throw new w(h.InvalidTime)}function W(e,t,r=!1){let n=R.exec(e);if(null!==n){const[,e,r,a,i,s,u,c]=n,p=o.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(a,10),hour:parseInt(i,10),minute:parseInt(s,10),second:parseInt(u,10),millisecond:c?parseInt(c.replace(".",""),10):0},{zone:l(t)});if(!1===p.isValid)throw new w(h.InvalidTimeStamp);return p}if(n=k.exec(e),null!==n){const[,e,t,r,a,o,i,s,l,u,c]=n,p=y.fromParts(parseInt(e,10),parseInt(t,10),parseInt(r,10),parseInt(a,10),parseInt(o,10),parseInt(i,10),s?parseInt(s.replace(".",""),10):0,"-"===l,parseInt(u,10),parseInt(c,10));if(!1===p.isValid)throw new w(h.InvalidTimeStamp);return p}if(n=U.exec(e),null!==n){const[,e,t,r,a,o,i,s,l]=n,u=y.fromParts(parseInt(e,10),parseInt(t,10),parseInt(r,10),parseInt(a,10),parseInt(o,10),0,0,"-"===i,parseInt(s,10),parseInt(l,10));if(!1===u.isValid)throw new w(h.InvalidTimeStamp);return u}if(n=$.exec(e),null!==n){const[,e,r,a,i,s]=n,u=o.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(a,10),hour:parseInt(i,10),minute:parseInt(s,10),second:0},{zone:l(t)});if(!1===u.isValid)throw new w(h.InvalidTimeStamp);return u}if(n=L.exec(e),null!==n){const[,e,r,a]=n,i=o.fromObject({year:parseInt(e,10),month:parseInt(r,10),day:parseInt(a,10),hour:0,minute:0,second:0},{zone:l(t)});if(!1===i.isValid)throw new w(h.InvalidTimeStamp);return i}throw new w(h.InvalidTimeStamp)}function J(e,r){const n=L.exec(e);if(null===n)try{return W(e,r)}catch{throw new w(h.InvalidDate)}const[,a,o,i]=n,s=t.fromParts(parseInt(a,10),parseInt(o,10),parseInt(i,10));if(null===s)throw new w(h.InvalidDate);return s}function B(e){return!!z(e)||!!Z(e)}function G(e){return!!(z(e)||q(e)||Z(e)||H(e))}function Q(e){if(z(e))return e.toMillis();if(q(e))return e.toNumber();if(Z(e))return e.toMilliseconds();throw new w(h.InvalidDataType)}function K(e,t,r){if(null==e||null==t)return null;if(d(e)){if(d(t))return X(e,t,r);if(f(t))return function(e,t,r){const n=parseFloat(t);if(!isNaN(n))return X(e,n,r);const a=e.toString();switch(r){case"<>":return a!==t;case"=":return a===t;case">":return a>t;case"<":return a<t;case">=":return a>=t;case"<=":return a<=t}}(e,t,r);if(G(t))throw new w(h.InvalidOperator);if(q(t))throw new w(h.InvalidOperator)}else if(f(e)){if(d(t))return function(e,t,r){const n=parseFloat(e);if(!isNaN(n))return X(n,t,r);const a=t.toString();switch(r){case"<>":return e!==a;case"=":return e===a;case">":return e>a;case"<":return e<a;case">=":return e>=a;case"<=":return e<=a}}(e,t,r);if(f(t))return function(e,t,r){switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}(e,t,r);if(z(t))throw new w(h.InvalidOperator);if(q(t))throw new w(h.InvalidOperator);if(H(t))throw new w(h.InvalidOperator);if(Z(t))throw new w(h.InvalidOperator)}else if(z(e)){if(B(t)){if(c(e.zone)){if(o.isDateTime(t)&&!c(t.zone))return ee(e,t,r);if(y.isTimestampOffset(t))return ee(e,t,r)}else if(o.isDateTime(t)&&c(t.zone)){if(!c(e.zone))return ee(e,t,r);if(y.isTimestampOffset(e))return ee(e,t,r)}return X(Q(e),Q(t),r)}if(f(t))throw new w(h.InvalidOperator);if(q(t))return function(e,t,r){const n=t.toDateTimeLuxon(e.zone);return X((e=e.startOf("day")).toMillis(),n.toMillis(),r)}(e,t,r);if(H(t))throw new w(h.InvalidOperator);if(d(t))throw new w(h.InvalidOperator)}else if(q(e)){if(Z(t))return function(e,t,r){const n=e.toDateTimeLuxon(t.toDateTime().zone);return t=t.startOfDay(),X(n.toMillis(),t.toMilliseconds(),r)}(e,t,r);if(z(t))return function(e,t,r){const n=e.toDateTimeLuxon(t.zone);return t=t.startOf("day"),X(n.toMillis(),t.toMillis(),r)}(e,t,r);if(f(t))throw new w(h.InvalidOperator);if(q(t))return X(e.toNumber(),t.toNumber(),r);if(H(t))throw new w(h.InvalidOperator);if(d(t))throw new w(h.InvalidOperator)}else if(H(e)){if(H(t))return X(e.toNumber(),t.toNumber(),r);if(f(t))throw new w(h.InvalidOperator);if(d(t))throw new w(h.InvalidOperator);if(q(t))throw new w(h.InvalidOperator);if(B(t))throw new w(h.InvalidOperator)}else if(Z(e)){if(B(t))return o.isDateTime(t)&&c(t.zone)?ee(e,t,r):X(Q(e),Q(t),r);if(f(t))throw new w(h.InvalidOperator);if(q(t))return function(e,t,r){const n=t.toDateTimeLuxon(e.toDateTime().zone);return X((e=e.startOfDay()).toMilliseconds(),n.toMillis(),r)}(e,t,r);if(H(t))throw new w(h.InvalidOperator);if(d(t))throw new w(h.InvalidOperator)}switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}function X(e,t,r){switch(r){case"<>":return e!==t;case"=":return e===t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}}function ee(e,t,r){y.isTimestampOffset(e)&&(e=e.toDateTime()),y.isTimestampOffset(t)&&(t=t.toDateTime());const n=te(e),a=te(t);switch(r){case"<>":return n!==a;case"=":return n===a;case">":return n>a;case"<":return n<a;case">=":return n>=a;case"<=":return n<=a}}function te(e){return 321408e5*e.year+26784e5*e.month+864e5*e.day+36e5*e.hour+6e4*e.minute+1e3*e.second+e.millisecond}function re(e,t,r){const n=oe[e.toLowerCase()];if(null==n)throw new w(h.FunctionNotRecognized);if(t.length<n.minParams||t.length>n.maxParams)throw new w(h.InvalidParameterCount,{name:e.toUpperCase()});return n.evaluate(t,r)}function ne(e){return!(m(e)||q(e)||z(e)||H(e)||Z(e))}function ae(e){return q(e)||H(e)?e.toString():Z(e)?e.toSQLValue():z(e)?0===e.millisecond?e.toFormat("yyyy-LL-dd HH:mm:ss"):e.toSQL({includeOffset:!1}):m(e)?ae(o.fromJSDate(e)):e.toString()}const oe={extract:{minParams:2,maxParams:2,evaluate:([e,t])=>{if(null==t)return null;if(m(t))switch(e.toUpperCase()){case"SECOND":return t.getSeconds();case"MINUTE":return t.getMinutes();case"HOUR":return t.getHours();case"DAY":return t.getDate();case"MONTH":return t.getMonth()+1;case"YEAR":return t.getFullYear();case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":return 0;case"DOW":return o.fromJSDate(t,{zone:"system"}).weekday;case"DOY":return o.fromJSDate(t,{zone:"system"}).ordinal;case"WEEK":return o.fromJSDate(t,{zone:"system"}).weekNumber}else if(z(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour;case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new w(h.InvalidFunctionParameters,{function:"EXTRACT"});case"DOW":return t.weekday;case"DOY":return t.ordinal;case"WEEK":return t.weekNumber}else if(q(t))switch(e.toUpperCase()){case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new w(h.InvalidFunctionParameters,{function:"EXTRACT"});case"DOW":return t.toDateTime("unknown").weekday;case"DOY":return t.toDateTime("unknown").ordinal;case"WEEK":return t.toDateTime("unknown").weekNumber}else if(H(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour}else if(Z(t))switch(e.toUpperCase()){case"SECOND":return t.second;case"MINUTE":return t.minute;case"HOUR":return t.hour;case"DAY":return t.day;case"MONTH":return t.month;case"YEAR":return t.year;case"TIMEZONE_HOUR":return t.timezoneOffsetHour;case"TIMEZONE_MINUTE":return t.timezoneOffsetMinutes;case"DOW":return t.toDateTime().weekday;case"DOY":return t.toDateTime().ordinal;case"WEEK":return t.toDateTime().weekNumber}throw new w(h.InvalidFunctionParameters,{function:"EXTRACT"})}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(2===e.length){const[t,r]=e;return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){const[t,r,n]=e;return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,t])=>null==e||null==t?null:t.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{const t=3===e.length,r=t?e[1]:" ",n=t?e[2]:e[1];if(null==r||null==n)return null;const o=`(${a(r)})`;switch(e[0]){case"BOTH":return n.replaceAll(new RegExp(`^${o}*|${o}*$`,"g"),"");case"LEADING":return n.replaceAll(new RegExp(`^${o}*`,"g"),"");case"TRAILING":return n.replaceAll(new RegExp(`${o}*$`,"g"),"")}throw new w(h.InvalidFunctionParameters,{function:"TRIM"})}},abs:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0]>0?1:e[0]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]**e[1]},mod:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const t=e[0],r=2===e.length?10**e[1]:1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:e=>null==e[0]?null:1===e.length||0===e[1]?Math.trunc(e[0]):p("trunc",e[0],-Number(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>f(e[0])?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{let t="";for(let r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:e=>{for(const t of e)if(null!==t)return t;return null}},cosh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cosh(e[0])},sinh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sinh(e[0])},tanh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tanh(e[0])},nullif:{minParams:2,maxParams:2,evaluate:e=>K(e[0],e[1],"=")?null:e[0]},cast:{minParams:2,maxParams:2,evaluate:(e,n)=>{const a=e[0],o=e[1];if(null===a)return null;switch(o.type){case"integer":{if(!ne(a))throw new w(h.CannotCastValue);const e=parseInt(a,10);if(isNaN(e))throw new w(h.CannotCastValue);return e}case"smallint":{if(!ne(a))throw new w(h.CannotCastValue);const e=parseInt(a,10);if(isNaN(e))throw new w(h.CannotCastValue);if(e>32767||e<-32767)throw new w(h.CannotCastValue);return e}case"float":case"real":{if(!ne(a))throw new w(h.CannotCastValue);const e=parseFloat(a);if(isNaN(e))throw new w(h.CannotCastValue);return e}case"time":return function(e){if(m(e))return r.fromDateJS(e);if(z(e))return r.fromDateTime(e);if(q(e))throw new w(h.CannotCastValue);if(H(e))return e;if(Z(e))return r.fromSqlTimeStampOffset(e);if(f(e))return Y(e);throw new w(h.CannotCastValue)}(a);case"date":return function(e){if(m(e))return t.fromDateJS(e);if(z(e))return t.fromParts(e.year,e.month,e.day);if(q(e))return e;if(H(e))throw new w(h.CannotCastValue);if(Z(e)&&null===t.fromParts(e.year,e.month,e.day))throw new w(h.CannotCastValue);if(f(e)){const r=t.fromReader(e);if(null!==r&&r.isValid)return r}throw new w(h.CannotCastValue)}(a);case"timestamp":return function(e,t,r){if(m(e))return j(e,t);if(z(e))return e;if(q(e))return e.toDateTimeLuxon("unknown");if(H(e))throw new w(h.CannotCastValue);if(Z(e))return e;if(f(e))return W(e,"unknown",r);throw new w(h.CannotCastValue)}(a,n,!0===o.withtimezone);case"varchar":{const e=ae(a);if(e.length>o.size)throw new w(h.CannotCastValue);return e}default:throw new w(h.InvalidDataType)}}}};function ie(e,t,r,n){if("||"===e)return re("concat",[t,r],n);if(null===t||null===r)return null;if(d(t)){if(d(r))return se(t,r,e);if(V(r))return function(e,t,r){switch(r){case"+":return b.createFromMilliseconds(e+t.valueInMilliseconds());case"-":return b.createFromMilliseconds(e-t.valueInMilliseconds());case"*":return b.createFromMilliseconds(e*t.valueInMilliseconds());case"/":return b.createFromMilliseconds(e/t.valueInMilliseconds())}throw new w(h.InvalidOperator)}(t,r,e);if(H(r))return function(){throw new w(h.InvalidOperator)}();if(q(r))return function(){throw new w(h.InvalidOperator)}();if(Z(r))return function(){throw new w(h.InvalidOperator)}();if(z(r))return function(){throw new w(h.InvalidOperator)}();if(f(r))return function(e,t,r){const n=parseFloat(t);if(isNaN(n))throw new w(h.InvalidOperator);return se(e,n,r)}(t,r,e);throw new w(h.InvalidOperator)}if(q(t)){if(d(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus("milliseconds",n);case"-":return e.plus("milliseconds",-1*n)}throw new w(h.InvalidOperator)}(t,r,e);if(V(r))return function(e,t,r){switch(r){case"+":return e.plus("milliseconds",t.valueInMilliseconds());case"-":return e.plus("milliseconds",-1*t.valueInMilliseconds())}throw new w(h.InvalidOperator)}(t,r,e);if(H(r))return function(){throw new w(h.InvalidOperator)}();if(q(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon("UTC").diff(t.toDateTimeLuxon("UTC")).as("days");throw new w(h.InvalidOperator)}(t,r,e);if(Z(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon(t.toDateTime().zone).diff(t.toDateTime()).as("days");throw new w(h.InvalidOperator)}(t,r,e);if(z(r))return function(e,t,r){if("-"===r)return e.toDateTimeLuxon(t.zone).diff(t).as("days");throw new w(h.InvalidOperator)}(t,r,e);if(f(r))return function(){throw new w(h.InvalidOperator)}();throw new w(h.InvalidOperator)}if(H(t)){if(d(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus("milliseconds",n);case"-":return e.plus("milliseconds",-1*n)}throw new w(h.InvalidOperator)}(t,r,e);if(V(r))return function(e,t,r){switch(r){case"+":return e.plus("milliseconds",t.valueInMilliseconds());case"-":return e.plus("milliseconds",-1*t.valueInMilliseconds())}throw new w(h.InvalidOperator)}(t,r,e);if(H(r))return function(){throw new w(h.InvalidOperator)}();if(q(r))return function(){throw new w(h.InvalidOperator)}();if(Z(r))return function(){throw new w(h.InvalidOperator)}();if(z(r))return function(){throw new w(h.InvalidOperator)}();if(f(r))return function(){throw new w(h.InvalidOperator)}();throw new w(h.InvalidOperator)}if(V(t)){if(d(r))return function(e,t,r){switch(r){case"+":return b.createFromMilliseconds(e.valueInMilliseconds()+t);case"-":return b.createFromMilliseconds(e.valueInMilliseconds()-t);case"*":return b.createFromMilliseconds(e.valueInMilliseconds()*t);case"/":return b.createFromMilliseconds(e.valueInMilliseconds()/t)}throw new w(h.InvalidOperator)}(t,r,e);if(V(r))return function(e,t,r){switch(r){case"+":return b.createFromMilliseconds(e.valueInMilliseconds()+t.valueInMilliseconds());case"-":return b.createFromMilliseconds(e.valueInMilliseconds()-t.valueInMilliseconds());case"*":return b.createFromMilliseconds(e.valueInMilliseconds()*t.valueInMilliseconds());case"/":return b.createFromMilliseconds(e.valueInMilliseconds()/t.valueInMilliseconds())}throw new w(h.InvalidOperator)}(t,r,e);if(H(r))return function(e,t,r){if("+"===r)return t.plus("milliseconds",e.valueInMilliseconds());throw new w(h.InvalidOperator)}(t,r,e);if(q(r))return function(e,t,r){if("+"===r)return t.plus("milliseconds",e.valueInMilliseconds());throw new w(h.InvalidOperator)}(t,r,e);if(Z(r))return function(e,t,r){if("+"===r)return t.addMilliseconds(e.valueInMilliseconds());throw new w(h.InvalidOperator)}(t,r,e);if(z(r))return function(e,t,r){switch(r){case"+":return t.plus({milliseconds:e.valueInMilliseconds()});case"-":return e.valueInMilliseconds()-t.toMillis()}throw new w(h.InvalidOperator)}(t,r,e);if(f(r))return function(){throw new w(h.InvalidOperator)}();throw new w(h.InvalidOperator)}if(z(t)){if(d(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.plus({milliseconds:n});case"-":return e.minus({milliseconds:n})}throw new w(h.InvalidOperator)}(t,r,e);if(V(r))return function(e,t,r){switch(r){case"+":return e.plus({milliseconds:t.valueInMilliseconds()});case"-":return e.minus({milliseconds:t.valueInMilliseconds()})}throw new w(h.InvalidOperator)}(t,r,e);if(H(r))return function(){throw new w(h.InvalidOperator)}();if(q(r))return function(e,t,r){if("-"===r)return e.diff(t.toDateTimeLuxon(e.zone)).as("days");throw new w(h.InvalidOperator)}(t,r,e);if(Z(r))return function(e,t,r){if("-"===r)return e.diff(t.toDateTime()).as("days");throw new w(h.InvalidOperator)}(t,r,e);if(z(r))return function(e,t,r){if("-"===r)return e.diff(t).as("days");throw new w(h.InvalidOperator)}(t,r,e);if(f(r))return function(){throw new w(h.InvalidOperator)}();throw new w(h.InvalidOperator)}if(Z(t)){if(d(r))return function(e,t,r){const n=1e3*t*24*60*60;switch(r){case"+":return e.addMilliseconds(n);case"-":return e.addMilliseconds(-1*n)}throw new w(h.InvalidOperator)}(t,r,e);if(V(r))return function(e,t,r){switch(r){case"+":return e.addMilliseconds(t.valueInMilliseconds());case"-":return e.addMilliseconds(-1*t.valueInMilliseconds())}throw new w(h.InvalidOperator)}(t,r,e);if(H(r))return function(){throw new w(h.InvalidOperator)}();if(q(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t.toDateTimeLuxon(e.toDateTime().zone)).as("days");throw new w(h.InvalidOperator)}(t,r,e);if(Z(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t.toDateTime()).as("days");throw new w(h.InvalidOperator)}(t,r,e);if(z(r))return function(e,t,r){if("-"===r)return e.toDateTime().diff(t).as("days");throw new w(h.InvalidOperator)}(t,r,e);if(f(r))return function(){throw new w(h.InvalidOperator)}();throw new w(h.InvalidOperator)}if(f(t)){if(d(r))return function(e,t,r){const n=parseFloat(e);if(isNaN(n))throw new w(h.InvalidOperator);return se(n,t,r)}(t,r,e);if(V(r))return function(){throw new w(h.InvalidOperator)}();if(H(r))return function(){throw new w(h.InvalidOperator)}();if(q(r))return function(){throw new w(h.InvalidOperator)}();if(Z(r))return function(){throw new w(h.InvalidOperator)}();if(z(r))return function(){throw new w(h.InvalidOperator)}();if(f(r))return function(e,t,r){if("+"===r)return e+t;throw new w(h.InvalidOperator)}(t,r,e);throw new w(h.InvalidOperator)}throw new w(h.InvalidOperator)}function se(e,t,r){switch(r){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":return e/t}throw new w(h.InvalidOperator)}class le extends SyntaxError{constructor(e,t,r,n){super(e),this.expected=t,this.found=r,this.location=n,this.name="SyntaxError"}format(e){let t="Error: "+this.message;if(this.location){let r=null;const n=e.find((e=>e.source===this.location.source));n&&(r=n.text.split(/\r\n|\n|\r/g));const a=this.location.start,o=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(a):a,i=this.location.source+":"+o.line+":"+o.column;if(r){const e=this.location.end,n="".padEnd(o.line.toString().length," "),s=r[a.line-1],l=(a.line===e.line?e.column:s.length+1)-a.column||1;t+="\n --\x3e "+i+"\n"+n+" |\n"+o.line+" | "+s+"\n"+n+" | "+"".padEnd(a.column-1," ")+"".padEnd(l,"^")}else t+="\n at "+i}return t}static buildMessage(e,t){function r(e){return e.codePointAt(0).toString(16).toUpperCase()}const n=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function a(e){return n?e.replace(n,(e=>"\\u{"+r(e)+"}")):e}function o(e){return a(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+r(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+r(e))))}function i(e){return a(e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+r(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+r(e))))}const s={literal:e=>'"'+o(e.text)+'"',class(e){const t=e.parts.map((e=>Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)));return"["+(e.inverted?"^":"")+t.join("")+"]"+(e.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:e=>e.description};function l(e){return s[e.type](e)}return"Expected "+function(e){const t=e.map(l);if(t.sort(),t.length>0){let e=1;for(let r=1;r<t.length;r++)t[r-1]!==t[r]&&(t[e]=t[r],e++);t.length=e}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(e)+" but "+function(e){return e?'"'+o(e)+'"':"end of input"}(t)+" found."}}class ue{static parse(e){return function(e,t){const r={},n=(t=void 0!==t?t:{}).grammarSource,a={start:yr};let o=yr;const i="!",s="=",l=">=",u=">",c="<=",p="<>",d="!=",f="||",m="@",h="'",v="N'",w="''",I=".",g="null",y="true",T="false",N="in",O="is",S="like",x="escape",E="not",C="and",D="or",_="between",M="from",b="for",F="substring",A="extract",P="trim",L="position",R="timestamp",k="date",U="time",$="leading",j="trailing",V="both",z="cast",q="as",H="integer",Z="int",Y="smallint",W="float",J="real",B="varchar",G="to",Q="interval",K="year",X="timezone_hour",ee="timezone_minute",te="month",re="day",ne="hour",ae="minute",oe="second",ie="dow",se="doy",ue="week",ce="case",pe="end",de="when",fe="then",me="else",he=",",ve="(",we=")",Ie="`",ge=/^[<-=]/,ye=/^[+\-]/,Te=/^[*\/]/,Ne=/^[A-Za-z_\x80-\uFFFF]/,Oe=/^[A-Za-z0-9_]/,Se=/^[A-Za-z0-9_.\x80-\uFFFF]/,xe=/^["]/,Ee=/^[^']/,Ce=/^[0-9]/,De=/^[eE]/,_e=/^[ \t\n\r]/,Me=/^[^`]/,be=hr("!",!1),Fe=hr("=",!1),Ae=hr(">=",!1),Pe=hr(">",!1),Le=hr("<=",!1),Re=hr("<>",!1),ke=vr([["<","="]],!1,!1,!1),Ue=hr("!=",!1),$e=vr(["+","-"],!1,!1,!1),je=hr("||",!1),Ve=vr(["*","/"],!1,!1,!1),ze=vr([["A","Z"],["a","z"],"_",["","￿"]],!1,!1,!1),qe=vr([["A","Z"],["a","z"],["0","9"],"_"],!1,!1,!1),He=vr([["A","Z"],["a","z"],["0","9"],"_",".",["","￿"]],!1,!1,!1),Ze=vr(['"'],!1,!1,!1),Ye=hr("@",!1),We=hr("'",!1),Je=hr("N'",!1),Be=hr("''",!1),Ge=vr(["'"],!0,!1,!1),Qe=hr(".",!1),Ke=vr([["0","9"]],!1,!1,!1),Xe=vr(["e","E"],!1,!1,!1),et=hr("NULL",!0),tt=hr("TRUE",!0),rt=hr("FALSE",!0),nt=hr("IN",!0),at=hr("IS",!0),ot=hr("LIKE",!0),it=hr("ESCAPE",!0),st=hr("NOT",!0),lt=hr("AND",!0),ut=hr("OR",!0),ct=hr("BETWEEN",!0),pt=hr("FROM",!0),dt=hr("FOR",!0),ft=hr("SUBSTRING",!0),mt=hr("EXTRACT",!0),ht=hr("TRIM",!0),vt=hr("POSITION",!0),wt=hr("TIMESTAMP",!0),It=hr("DATE",!0),gt=hr("TIME",!0),yt=hr("LEADING",!0),Tt=hr("TRAILING",!0),Nt=hr("BOTH",!0),Ot=hr("CAST",!0),St=hr("AS",!0),xt=hr("INTEGER",!0),Et=hr("INT",!0),Ct=hr("SMALLINT",!0),Dt=hr("FLOAT",!0),_t=hr("REAL",!0),Mt=hr("VARCHAR",!0),bt=hr("TO",!0),Ft=hr("INTERVAL",!0),At=hr("YEAR",!0),Pt=hr("TIMEZONE_HOUR",!0),Lt=hr("TIMEZONE_MINUTE",!0),Rt=hr("MONTH",!0),kt=hr("DAY",!0),Ut=hr("HOUR",!0),$t=hr("MINUTE",!0),jt=hr("SECOND",!0),Vt=hr("DOW",!0),zt=hr("DOY",!0),qt=hr("WEEK",!0),Ht=hr("CASE",!0),Zt=hr("END",!0),Yt=hr("WHEN",!0),Wt=hr("THEN",!0),Jt=hr("ELSE",!0),Bt=hr(",",!1),Gt=hr("(",!1),Qt=hr(")",!1),Kt=vr([" ","\t","\n","\r"],!1,!1,!1),Xt=hr("`",!1),er=vr(["`"],!0,!1,!1);function tr(e,t,r){return{op:t,expr:r,location:fr()}}function rr(e,t,r){return{op:t,expr:r,location:fr()}}function nr(e,t){return{op:e,expr:t,location:fr()}}function ar(e,t,r){return{op:t,expr:r,location:fr()}}function or(e,t,r){return{op:t,expr:r,location:fr()}}let ir=0|t.peg$currPos,sr=ir;const lr=[{line:1,column:1}];let ur,cr=ir,pr=t.peg$maxFailExpected||[],dr=0|t.peg$silentFails;if(t.startRule){if(!(t.startRule in a))throw new Error("Can't start parsing from rule \""+t.startRule+'".');o=a[t.startRule]}function fr(){return Ir(sr,ir)}function mr(e,t){throw function(e,t){return new le(e,null,null,t)}(e,t=void 0!==t?t:Ir(sr,ir))}function hr(e,t){return{type:"literal",text:e,ignoreCase:t}}function vr(e,t,r,n){return{type:"class",parts:e,inverted:t,ignoreCase:r,unicode:n}}function wr(t){let r,n=lr[t];if(n)return n;if(t>=lr.length)r=lr.length-1;else for(r=t;!lr[--r];);for(n=lr[r],n={line:n.line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return lr[t]=n,n}function Ir(e,t,r){const a=wr(e),o=wr(t);return{source:n,start:{offset:e,line:a.line,column:a.column},end:{offset:t,line:o.line,column:o.column}}}function gr(e){ir<cr||(ir>cr&&(cr=ir,pr=[]),pr.push(e))}function yr(){let e,t;return e=ir,Mn(),t=Nr(),t!==r?(Mn(),sr=e,e=t):(ir=e,e=r),e}function Tr(){let e,t,n,a,o,i,s,l;if(e=ir,t=Dn(),t!==r){for(Mn(),n=[],a=Nr();a!==r;)n.push(a),a=ir,o=ir,i=Mn(),s=Cn(),s!==r?(l=Mn(),i=[i,s,l],o=i):(ir=o,o=r),o!==r?(o=Nr(),o===r?(ir=a,a=r):a=o):a=o;a=Mn(),o=_n(),o!==r?(sr=e,u=n,e={type:"expression-list",location:fr(),value:u}):(ir=e,e=r)}else ir=e,e=r;var u;return e}function Nr(){let e,t,n,a,o,i;if(e=ir,t=Or(),t!==r){for(n=[],a=ir,Mn(),o=un(),o!==r?(Mn(),i=Or(),i!==r?(sr=a,a=tr(0,o,i)):(ir=a,a=r)):(ir=a,a=r);a!==r;)n.push(a),a=ir,Mn(),o=un(),o!==r?(Mn(),i=Or(),i!==r?(sr=a,a=tr(0,o,i)):(ir=a,a=r)):(ir=a,a=r);sr=e,e=Pn(t,n)}else ir=e,e=r;return e}function Or(){let e,t,n,a,o,i;if(e=ir,t=Sr(),t!==r){for(n=[],a=ir,Mn(),o=ln(),o!==r?(Mn(),i=Sr(),i!==r?(sr=a,a=rr(0,o,i)):(ir=a,a=r)):(ir=a,a=r);a!==r;)n.push(a),a=ir,Mn(),o=ln(),o!==r?(Mn(),i=Sr(),i!==r?(sr=a,a=rr(0,o,i)):(ir=a,a=r)):(ir=a,a=r);sr=e,e=Pn(t,n)}else ir=e,e=r;return e}function Sr(){let t,n,a,o,l;return t=ir,n=sn(),n===r&&(n=ir,33===e.charCodeAt(ir)?(a=i,ir++):(a=r,0===dr&&gr(be)),a!==r?(o=ir,dr++,61===e.charCodeAt(ir)?(l=s,ir++):(l=r,0===dr&&gr(Fe)),dr--,l===r?o=void 0:(ir=o,o=r),o!==r?(a=[a,o],n=a):(ir=n,n=r)):(ir=n,n=r)),n!==r?(a=Mn(),o=Sr(),o!==r?(sr=t,t=function(e,t,r){return{type:"unary-expression",location:r,operator:"NOT",expr:t}}(0,o,fr())):(ir=t,t=r)):(ir=t,t=r),t===r&&(t=function(){let t,n,a,o;var i,s;return t=ir,n=Dr(),n!==r?(a=ir,Mn(),o=function(){let t;return t=function(){let e,t,n,a,o;if(e=ir,t=[],n=ir,Mn(),a=xr(),a!==r?(Mn(),o=Dr(),o!==r?(sr=n,n=nr(a,o)):(ir=n,n=r)):(ir=n,n=r),n!==r)for(;n!==r;)t.push(n),n=ir,Mn(),a=xr(),a!==r?(Mn(),o=Dr(),o!==r?(sr=n,n=nr(a,o)):(ir=n,n=r)):(ir=n,n=r);else t=r;return t!==r&&(sr=e,t={type:"arithmetic",tail:t}),e=t,e}(),t===r&&(t=function(){let e,t,n;return e=ir,t=Cr(),t!==r?(Mn(),n=Tr(),n!==r?(sr=e,e={op:t,right:n}):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=Cr(),t!==r?(Mn(),n=$r(),n!==r?(sr=e,e={op:t,right:n}):(ir=e,e=r)):(ir=e,e=r)),e}(),t===r&&(t=function(){let e,t,n,a,o,i,s,l;var u,c;return e=ir,t=sn(),t!==r?(Mn(),n=cn(),n!==r?(a=Mn(),o=ir,i=Dr(),i!==r?(Mn(),s=ln(),s!==r?(Mn(),l=Dr(),l!==r?(sr=o,u=i,c=l,o=An(fr(),u,c)):(ir=o,o=r)):(ir=o,o=r)):(ir=o,o=r),o!==r?(sr=e,e={op:"NOT"+n,right:o}):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=cn(),t!==r?(Mn(),n=ir,a=Dr(),a!==r?(o=Mn(),i=ln(),i!==r?(Mn(),s=Dr(),s!==r?(sr=n,n=function(e,t,r){return An(fr(),t,r)}(0,a,s)):(ir=n,n=r)):(ir=n,n=r)):(ir=n,n=r),n!==r?(sr=e,e={op:t,right:n}):(ir=e,e=r)):(ir=e,e=r)),e}(),t===r&&(t=function(){let e,t,n,a;return e=ir,t=an(),t!==r?(Mn(),n=sn(),n!==r?(Mn(),a=Dr(),a!==r?(sr=e,e={op:t+"NOT",right:a}):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=an(),t!==r?(Mn(),n=Dr(),n!==r?(sr=e,e={op:t,right:n}):(ir=e,e=r)):(ir=e,e=r)),e}(),t===r&&(t=function(){let t,n,a,o,i;return t=ir,n=Er(),n!==r?(Mn(),a=Wr(),a!==r?(Mn(),o=function(){let t,n,a,o;return t=ir,n=e.substr(ir,6),n.toLowerCase()===x?ir+=6:(n=r,0===dr&&gr(it)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="ESCAPE"):(ir=t,t=r)):(ir=t,t=r),t}(),o!==r?(Mn(),i=Jr(),i!==r?(sr=t,t={op:n,right:a,escape:i.value}):(ir=t,t=r)):(ir=t,t=r)):(ir=t,t=r)):(ir=t,t=r),t===r&&(t=ir,n=Er(),n!==r?(Mn(),a=Wr(),a!==r?(sr=t,t={op:n,right:a,escape:""}):(ir=t,t=r)):(ir=t,t=r)),t}())))),t}(),o!==r?a=o:(ir=a,a=r),a===r&&(a=null),sr=t,i=n,t=""==(s=a)||null==s||null==s?i:"arithmetic"==s.type?Pn(i,s.tail):Fn(s.op,i,s.right,s.escape,fr())):(ir=t,t=r),t}()),t}function xr(){let t;return e.substr(ir,2)===l?(t=l,ir+=2):(t=r,0===dr&&gr(Ae)),t===r&&(62===e.charCodeAt(ir)?(t=u,ir++):(t=r,0===dr&&gr(Pe)),t===r&&(e.substr(ir,2)===c?(t=c,ir+=2):(t=r,0===dr&&gr(Le)),t===r&&(e.substr(ir,2)===p?(t=p,ir+=2):(t=r,0===dr&&gr(Re)),t===r&&(t=e.charAt(ir),ge.test(t)?ir++:(t=r,0===dr&&gr(ke)),t===r&&(e.substr(ir,2)===d?(t=d,ir+=2):(t=r,0===dr&&gr(Ue))))))),t}function Er(){let e,t,n,a,o;var i;return e=ir,t=ir,n=sn(),n!==r?(a=Mn(),o=on(),o!==r?(n=[n,a,o],t=n):(ir=t,t=r)):(ir=t,t=r),t!==r&&(sr=e,t=(i=t)[0]+" "+i[2]),e=t,e===r&&(e=on()),e}function Cr(){let e,t,n,a,o;var i;return e=ir,t=ir,n=sn(),n!==r?(a=Mn(),o=nn(),o!==r?(n=[n,a,o],t=n):(ir=t,t=r)):(ir=t,t=r),t!==r&&(sr=e,t=(i=t)[0]+" "+i[2]),e=t,e===r&&(e=nn()),e}function Dr(){let e,t,n,a,o,i;if(e=ir,t=Mr(),t!==r){for(n=[],a=ir,Mn(),o=_r(),o!==r?(Mn(),i=Mr(),i!==r?(sr=a,a=ar(0,o,i)):(ir=a,a=r)):(ir=a,a=r);a!==r;)n.push(a),a=ir,Mn(),o=_r(),o!==r?(Mn(),i=Mr(),i!==r?(sr=a,a=ar(0,o,i)):(ir=a,a=r)):(ir=a,a=r);sr=e,e=Pn(t,n)}else ir=e,e=r;return e}function _r(){let t;return t=e.charAt(ir),ye.test(t)?ir++:(t=r,0===dr&&gr($e)),t===r&&(e.substr(ir,2)===f?(t=f,ir+=2):(t=r,0===dr&&gr(je))),t}function Mr(){let e,t,n,a,o,i;if(e=ir,t=Fr(),t!==r){for(n=[],a=ir,Mn(),o=br(),o!==r?(Mn(),i=Fr(),i!==r?(sr=a,a=or(0,o,i)):(ir=a,a=r)):(ir=a,a=r);a!==r;)n.push(a),a=ir,Mn(),o=br(),o!==r?(Mn(),i=Fr(),i!==r?(sr=a,a=or(0,o,i)):(ir=a,a=r)):(ir=a,a=r);sr=e,e=Pn(t,n)}else ir=e,e=r;return e}function br(){let t;return t=e.charAt(ir),Te.test(t)?ir++:(t=r,0===dr&&gr(Ve)),t}function Fr(){let t,n,a,o;var i;return t=function(){let t;return t=Jr(),t===r&&(t=function(){let e,t,n,a;var o;return e=ir,t=function(){let e,t,n,a;return e=ir,t=Kr(),t!==r?(n=Xr(),n!==r?(a=en(),a!==r?(sr=e,e=parseFloat(t+n+a)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=Kr(),t!==r?(n=Xr(),n!==r?(sr=e,e=parseFloat(t+n)):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=Kr(),t!==r?(n=en(),n!==r?(sr=e,e=parseFloat(t+n)):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=Kr(),t!==r&&(sr=e,t=parseFloat(t)),e=t))),e}(),t!==r?(n=ir,dr++,a=Pr(),dr--,a===r?n=void 0:(ir=n,n=r),n!==r?(sr=e,o=t,e={type:"number",location:fr(),value:o}):(ir=e,e=r)):(ir=e,e=r),e}(),t===r&&(t=function(){let t,n;return t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===y?ir+=4:(n=r,0===dr&&gr(tt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(n=[n,a],t=n):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r&&(sr=t,n={type:"boolean",location:fr(),value:!0}),t=n,t===r&&(t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,5),n.toLowerCase()===T?ir+=5:(n=r,0===dr&&gr(rt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(n=[n,a],t=n):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r&&(sr=t,n={type:"boolean",location:fr(),value:!1}),t=n),t}(),t===r&&(t=function(){let t,n;return t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===g?ir+=4:(n=r,0===dr&&gr(et)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(n=[n,a],t=n):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r&&(sr=t,n={type:"null",location:fr(),value:null}),t=n,t}(),t===r&&(t=function(){let e,t,n;var a,o;return e=ir,t=mn(),t!==r?(Mn(),n=Wr(),n!==r?(sr=e,"string"===(a=n).type&&(o=a.value,!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(o)&&mr("Date literal is invalid")),e={type:"date",location:fr(),value:a.value}):(ir=e,e=r)):(ir=e,e=r),e}(),t===r&&(t=function(){let e,t,n;var a,o;return e=ir,t=fn(),t!==r?(Mn(),n=Wr(),n!==r?(sr=e,"string"===(a=n).type&&(o=a.value,!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(o)&&mr("Timestamp literal is invalid")),e={type:"timestamp",location:fr(),value:a.value}):(ir=e,e=r)):(ir=e,e=r),e}(),t===r&&(t=function(){let t,n,a,o,i;var s,l,u;return t=ir,n=vn(),n!==r?(Mn(),a=e.charAt(ir),ye.test(a)?ir++:(a=r,0===dr&&gr($e)),a!==r?(Mn(),o=Wr(),o!==r?(Mn(),i=qr(),i!==r?(sr=t,s=a,l=o,u=i,t={type:"interval",location:fr(),value:l,qualifier:u,op:s}):(ir=t,t=r)):(ir=t,t=r)):(ir=t,t=r)):(ir=t,t=r),t===r&&(t=ir,n=vn(),n!==r?(Mn(),a=Wr(),a!==r?(Mn(),o=qr(),o!==r?(sr=t,t=function(e,t){return{type:"interval",location:fr(),value:e,qualifier:t,op:""}}(a,o)):(ir=t,t=r)):(ir=t,t=r)):(ir=t,t=r)),t}(),t===r&&(t=function(){let e,t,n;var a,o;return e=ir,t=hn(),t!==r?(Mn(),n=Wr(),n!==r?(sr=e,"string"===(a=n).type&&(o=a.value,!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(o)&&mr("Time literal is invalid")),e={type:"time",location:fr(),value:a.value}):(ir=e,e=r)):(ir=e,e=r),e}()))))))),t}(),t===r&&(t=function(){let e,t,n,a,o,i,s,l;var u,c,p;return e=ir,t=dn(),t!==r?(Mn(),n=ir,a=Dn(),a!==r?(Mn(),o=zr(),o!==r?(Mn(),i=pn(),i!==r?(Mn(),s=Nr(),s!==r?(Mn(),l=_n(),l!==r?(sr=n,c=o,p=s,n=An(fr(),c,p)):(ir=n,n=r)):(ir=n,n=r)):(ir=n,n=r)):(ir=n,n=r)):(ir=n,n=r),n===r&&(n=ir,a=Dn(),a!==r?(Mn(),o=zr(),o!==r?(Mn(),i=Cn(),i!==r?(Mn(),s=Nr(),s!==r?(Mn(),l=_n(),l!==r?(sr=n,n=function(e,t){return An(fr(),e,t)}(o,s)):(ir=n,n=r)):(ir=n,n=r)):(ir=n,n=r)):(ir=n,n=r)):(ir=n,n=r)),n!==r?(sr=e,u=n,e={type:"function",location:fr(),name:"extract",args:u}):(ir=e,e=r)):(ir=e,e=r),e}(),t===r&&(t=function(){let t,n,a,o,i,s,l,u,c,p,d;var f,m,h,v;return t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,9),n.toLowerCase()===F?ir+=9:(n=r,0===dr&&gr(ft)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="SUBSTRING"):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r?(Mn(),a=ir,o=Dn(),o!==r?(Mn(),i=Nr(),i!==r?(Mn(),s=pn(),s!==r?(Mn(),l=Nr(),l!==r?(Mn(),u=ir,c=function(){let t,n,a,o;return t=ir,n=e.substr(ir,3),n.toLowerCase()===b?ir+=3:(n=r,0===dr&&gr(dt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="FOR"):(ir=t,t=r)):(ir=t,t=r),t}(),c!==r?(p=Mn(),d=Nr(),d!==r?(Mn(),u=d):(ir=u,u=r)):(ir=u,u=r),u===r&&(u=null),c=_n(),c!==r?(sr=a,m=i,h=l,v=u,a=An(fr(),m,h,...v?[v]:[])):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r),a===r&&(a=ir,o=Dn(),o!==r?(Mn(),i=Nr(),i!==r?(Mn(),s=Cn(),s!==r?(Mn(),l=Nr(),l!==r?(Mn(),u=Cn(),u!==r?(c=Mn(),p=Nr(),p!==r?(d=_n(),d!==r?(sr=a,a=function(e,t,r){return An(fr(),e,t,r)}(i,l,p)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)),a!==r?(sr=t,f=a,t={type:"function",location:fr(),name:"substring",args:f}):(ir=t,t=r)):(ir=t,t=r),t}(),t===r&&(t=function(){let t,n,a,o,i,s,l,u,c;var p,d,f,m;return t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===P?ir+=4:(n=r,0===dr&&gr(ht)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="TRIM"):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r?(Mn(),a=ir,o=Dn(),o!==r?(Mn(),i=Vr(),Mn(),s=Nr(),s!==r?(Mn(),l=pn(),l!==r?(Mn(),u=Nr(),u!==r?(Mn(),c=_n(),c!==r?(sr=a,d=i,f=s,m=u,a=An(fr(),d,f,m)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r),a===r&&(a=ir,o=Dn(),o!==r?(Mn(),i=Vr(),Mn(),s=Nr(),s!==r?(Mn(),l=_n(),l!==r?(sr=a,a=function(e,t){return An(fr(),e,t)}(i,s)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)),a!==r?(sr=t,p=a,t={type:"function",location:fr(),name:"trim",args:p}):(ir=t,t=r)):(ir=t,t=r),t}(),t===r&&(t=function(){let t,n,a,o,i,s,l,u;var c,p,d;return t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,8),n.toLowerCase()===L?ir+=8:(n=r,0===dr&&gr(vt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="POSITION"):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r?(Mn(),a=ir,o=Dn(),o!==r?(Mn(),i=Nr(),i!==r?(Mn(),s=nn(),s!==r?(Mn(),l=Nr(),l!==r?(Mn(),u=_n(),u!==r?(sr=a,p=i,d=l,a=An(fr(),p,d)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r),a===r&&(a=ir,o=Dn(),o!==r?(Mn(),i=Nr(),i!==r?(Mn(),s=Cn(),s!==r?(Mn(),l=Nr(),l!==r?(Mn(),u=_n(),u!==r?(sr=a,a=function(e,t){return An(fr(),e,t)}(i,l)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)),a!==r?(sr=t,c=a,t={type:"function",location:fr(),name:"position",args:c}):(ir=t,t=r)):(ir=t,t=r),t}(),t===r&&(t=function(){let t,n,a,o,i,s,l,u;var c,p,d;return t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===z?ir+=4:(n=r,0===dr&&gr(Ot)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="CAST"):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r?(Mn(),a=ir,o=Dn(),o!==r?(Mn(),i=Nr(),i!==r?(Mn(),s=function(){let t,n,a,o;return t=ir,n=e.substr(ir,2),n.toLowerCase()===q?ir+=2:(n=r,0===dr&&gr(St)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="AS"):(ir=t,t=r)):(ir=t,t=r),t}(),s!==r?(Mn(),l=jr(),l!==r?(Mn(),u=_n(),u!==r?(sr=a,p=i,d=l,a=An(fr(),p,d)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r),a===r&&(a=ir,o=Dn(),o!==r?(Mn(),i=Nr(),i!==r?(Mn(),s=Cn(),s!==r?(Mn(),l=jr(),l!==r?(Mn(),u=_n(),u!==r?(sr=a,a=function(e,t){return An(fr(),e,t)}(i,l)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)):(ir=a,a=r)),a!==r?(sr=t,c=a,t={type:"function",location:fr(),name:"cast",args:c}):(ir=t,t=r)):(ir=t,t=r),t}(),t===r&&(t=function(){let t,n,a,o;var i,s;return t=ir,n=ir,dr++,a=dn(),dr--,a===r?n=void 0:(ir=n,n=r),n!==r?(a=function(){let t,n,a,o;if(t=ir,n=Ar(),n!==r&&(sr=t),t=n,t===r)if(t=ir,96===e.charCodeAt(ir)?(n=Ie,ir++):(n=r,0===dr&&gr(Xt)),n!==r){if(a=[],o=e.charAt(ir),Me.test(o)?ir++:(o=r,0===dr&&gr(er)),o!==r)for(;o!==r;)a.push(o),o=e.charAt(ir),Me.test(o)?ir++:(o=r,0===dr&&gr(er));else a=r;a!==r?(96===e.charCodeAt(ir)?(o=Ie,ir++):(o=r,0===dr&&gr(Xt)),o!==r?(sr=t,t=a.join("")):(ir=t,t=r)):(ir=t,t=r)}else ir=t,t=r;return t}(),a!==r?(Mn(),o=Tr(),o!==r?(sr=t,i=a,s=o,t={type:"function",location:fr(),name:i,args:s}):(ir=t,t=r)):(ir=t,t=r)):(ir=t,t=r),t}(),t===r&&(t=function(){let e;return e=function(){let e,t,n,a,o,i,s;if(e=ir,t=On(),t!==r)if(Mn(),n=Nr(),n!==r){for(Mn(),a=[],o=ir,i=Gr(),i!==r?(s=Mn(),o=i):(ir=o,o=r);o!==r;)a.push(o),o=ir,i=Gr(),i!==r?(s=Mn(),o=i):(ir=o,o=r);o=Sn(),o!==r?(sr=e,l=n,u=a,e={type:"case-expression",location:fr(),format:"simple",operand:l,clauses:u,else:null,elseLocation:null}):(ir=e,e=r)}else ir=e,e=r;else ir=e,e=r;var l,u;if(e===r)if(e=ir,t=On(),t!==r)if(Mn(),n=Nr(),n!==r){for(Mn(),a=[],o=ir,i=Gr(),i!==r?(s=Mn(),o=i):(ir=o,o=r);o!==r;)a.push(o),o=ir,i=Gr(),i!==r?(s=Mn(),o=i):(ir=o,o=r);o=Qr(),o!==r?(i=Mn(),s=Sn(),s!==r?(sr=e,e=function(e,t,r){return{type:"case-expression",location:fr(),format:"simple",operand:e,clauses:t,else:r.value,elseLocation:r.location}}(n,a,o)):(ir=e,e=r)):(ir=e,e=r)}else ir=e,e=r;else ir=e,e=r;return e}(),e===r&&(e=function(){let e,t,n,a,o,i;if(e=ir,t=On(),t!==r){for(Mn(),n=[],a=ir,o=Br(),o!==r?(i=Mn(),a=o):(ir=a,a=r);a!==r;)n.push(a),a=ir,o=Br(),o!==r?(i=Mn(),a=o):(ir=a,a=r);a=Sn(),a!==r?(sr=e,s=n,e={type:"case-expression",location:fr(),format:"searched",clauses:s,else:null,elseLocation:null}):(ir=e,e=r)}else ir=e,e=r;var s;if(e===r)if(e=ir,t=On(),t!==r){for(Mn(),n=[],a=ir,o=Br(),o!==r?(i=Mn(),a=o):(ir=a,a=r);a!==r;)n.push(a),a=ir,o=Br(),o!==r?(i=Mn(),a=o):(ir=a,a=r);a=Qr(),a!==r?(o=Mn(),i=Sn(),i!==r?(sr=e,e=function(e,t){return{type:"case-expression",location:fr(),format:"searched",clauses:e,else:t.value,elseLocation:t.location}}(n,a)):(ir=e,e=r)):(ir=e,e=r)}else ir=e,e=r;return e}()),e}(),t===r&&(t=function(){let e,t;var n,a;return e=ir,t=function(){let e,t;return e=ir,t=function(){let e,t,n,a;if(e=ir,t=Pr(),t!==r){for(n=[],a=Rr();a!==r;)n.push(a),a=Rr();sr=e,e=t+n.join("")}else ir=e,e=r;return e}(),t!==r&&(sr=e),e=t,e}(),t!==r&&(sr=e,t=/^CURRENT_DATE$/i.test(n=t)?{type:"current-time",location:fr(),mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(n)?{type:"current-time",location:fr(),mode:"timestamp"}:/^CURRENT_TIME$/i.test(n)?{type:"current-time",location:fr(),mode:"time"}:/^CURRENT_USER$/i.test(n)?{type:"current-user",location:fr()}:{type:"column-reference",location:fr(),table:"",column:n}),e=t,e===r&&(e=ir,t=function(){let e,t,n,a;return e=ir,t=Ur(),t!==r?(n=function(){let e,t,n;for(e=ir,t=[],n=kr();n!==r;)t.push(n),n=kr();return sr=e,t=t.join(""),e=t,e}(),a=Ur(),a!==r?(sr=e,e=n):(ir=e,e=r)):(ir=e,e=r),e}(),t!==r&&(sr=e,a=t,t={type:"column-reference",location:fr(),table:"",column:a,delimited:!0}),e=t),e}(),t===r&&(t=$r(),t===r&&(t=ir,n=Dn(),n!==r?(Mn(),a=Nr(),a!==r?(Mn(),o=_n(),o!==r?(sr=t,(i=a).paren=!0,t=i):(ir=t,t=r)):(ir=t,t=r)):(ir=t,t=r))))))))))),t}function Ar(){let e,t,n,a;if(e=ir,t=Pr(),t!==r){for(n=[],a=Lr();a!==r;)n.push(a),a=Lr();sr=e,e=t+n.join("")}else ir=e,e=r;return e}function Pr(){let t;return t=e.charAt(ir),Ne.test(t)?ir++:(t=r,0===dr&&gr(ze)),t}function Lr(){let t;return t=e.charAt(ir),Oe.test(t)?ir++:(t=r,0===dr&&gr(qe)),t}function Rr(){let t;return t=e.charAt(ir),Se.test(t)?ir++:(t=r,0===dr&&gr(He)),t}function kr(){let t;return t=function(){let t;return t=e.charAt(ir),Se.test(t)?ir++:(t=r,0===dr&&gr(He)),t}(),t===r&&(t=function(){let e,t,n;return e=ir,t=Ur(),t!==r?(n=Ur(),n!==r?(sr=e,e='"'):(ir=e,e=r)):(ir=e,e=r),e}()),t}function Ur(){let t;return t=e.charAt(ir),xe.test(t)?ir++:(t=r,0===dr&&gr(Ze)),t}function $r(){let t,n,a,o;var i;return t=ir,n=ir,64===e.charCodeAt(ir)?(a=m,ir++):(a=r,0===dr&&gr(Ye)),a!==r?(o=Ar(),o!==r?(a=[a,o],n=a):(ir=n,n=r)):(ir=n,n=r),n!==r&&(sr=t,i=n,n={type:"parameter",location:fr(),value:i[1]}),t=n,t}function jr(){let t,n,a,o,i;var s;return t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,7),n.toLowerCase()===H?ir+=7:(n=r,0===dr&&gr(xt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="INTEGER"):(ir=t,t=r)):(ir=t,t=r),t}(),n===r&&(n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,3),n.toLowerCase()===Z?ir+=3:(n=r,0===dr&&gr(Et)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="INT"):(ir=t,t=r)):(ir=t,t=r),t}()),n!==r&&(sr=t,n={type:"data-type",location:fr(),value:{type:"integer"}}),t=n,t===r&&(t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,8),n.toLowerCase()===Y?ir+=8:(n=r,0===dr&&gr(Ct)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="SMALLINT"):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r&&(sr=t,n={type:"data-type",location:fr(),value:{type:"smallint"}}),t=n,t===r&&(t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,5),n.toLowerCase()===W?ir+=5:(n=r,0===dr&&gr(Dt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="FLOAT"):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r&&(sr=t,n={type:"data-type",location:fr(),value:{type:"float"}}),t=n,t===r&&(t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===J?ir+=4:(n=r,0===dr&&gr(_t)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="REAL"):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r&&(sr=t,n={type:"data-type",location:fr(),value:{type:"real"}}),t=n,t===r&&(t=ir,n=mn(),n!==r&&(sr=t,n={type:"data-type",location:fr(),value:{type:"date"}}),t=n,t===r&&(t=ir,n=fn(),n!==r&&(sr=t,n={type:"data-type",location:fr(),value:{type:"timestamp"}}),t=n,t===r&&(t=ir,n=hn(),n!==r&&(sr=t,n={type:"data-type",location:fr(),value:{type:"time"}}),t=n,t===r&&(t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,7),n.toLowerCase()===B?ir+=7:(n=r,0===dr&&gr(Mt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="VARCHAR"):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r?(Mn(),a=Dn(),a!==r?(Mn(),o=tn(),o!==r?(Mn(),i=_n(),i!==r?(sr=t,s=o,t={type:"data-type",location:fr(),value:{type:"varchar",size:parseInt(s)}}):(ir=t,t=r)):(ir=t,t=r)):(ir=t,t=r)):(ir=t,t=r)))))))),t}function Vr(){let t,n;var a;return t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,7),n.toLowerCase()===$?ir+=7:(n=r,0===dr&&gr(yt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="LEADING"):(ir=t,t=r)):(ir=t,t=r),t}(),n===r&&(n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,8),n.toLowerCase()===j?ir+=8:(n=r,0===dr&&gr(Tt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="TRAILING"):(ir=t,t=r)):(ir=t,t=r),t}(),n===r&&(n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===V?ir+=4:(n=r,0===dr&&gr(Nt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="BOTH"):(ir=t,t=r)):(ir=t,t=r),t}())),n===r&&(n=null),sr=t,a=n,n={type:"string",location:fr(),value:a??"BOTH"},t=n,t}function zr(){let t,n;var a;return t=ir,n=wn(),n===r&&(n=In(),n===r&&(n=gn(),n===r&&(n=yn(),n===r&&(n=Tn(),n===r&&(n=Nn(),n===r&&(n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,13),n.toLowerCase()===X?ir+=13:(n=r,0===dr&&gr(Pt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="TIMEZONE_HOUR"):(ir=t,t=r)):(ir=t,t=r),t}(),n===r&&(n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,15),n.toLowerCase()===ee?ir+=15:(n=r,0===dr&&gr(Lt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="TIMEZONE_MINUTE"):(ir=t,t=r)):(ir=t,t=r),t}(),n===r&&(n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,3),n.toLowerCase()===ie?ir+=3:(n=r,0===dr&&gr(Vt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="DOW"):(ir=t,t=r)):(ir=t,t=r),t}(),n===r&&(n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,3),n.toLowerCase()===se?ir+=3:(n=r,0===dr&&gr(zt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="DOY"):(ir=t,t=r)):(ir=t,t=r),t}(),n===r&&(n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===ue?ir+=4:(n=r,0===dr&&gr(qt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="WEEK"):(ir=t,t=r)):(ir=t,t=r),t}())))))))))),n!==r&&(sr=t,a=n,n={type:"string",location:fr(),value:a}),t=n,t}function qr(){let t,n,a,o;var i,s;return t=ir,n=function(){let e,t,n,a,o;var i,s;return e=ir,t=Hr(),t!==r?(Mn(),n=Dn(),n!==r?(Mn(),a=Yr(),a!==r?(Mn(),o=_n(),o!==r?(sr=e,i=t,s=a,e={type:"interval-period",location:fr(),period:i.value,precision:s,secondary:null}):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=Hr(),t!==r&&(sr=e,t=function(e){return{type:"interval-period",location:fr(),period:e.value,precision:null,secondary:null}}(t)),e=t),e}(),n!==r?(Mn(),a=function(){let t,n,a,o;return t=ir,n=e.substr(ir,2),n.toLowerCase()===G?ir+=2:(n=r,0===dr&&gr(bt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="TO"):(ir=t,t=r)):(ir=t,t=r),t}(),a!==r?(Mn(),o=function(){let e,t,n,a,o,i,s;var l,u,c;return e=ir,t=Hr(),t!==r&&(sr=e,l=t,t={type:"interval-period",location:fr(),period:l.value,precision:null,secondary:null}),e=t,e===r&&(e=ir,t=Nn(),t!==r?(Mn(),n=Dn(),n!==r?(Mn(),a=Yr(),a!==r?(Mn(),o=Cn(),o!==r?(Mn(),i=Zr(),i!==r?(Mn(),s=_n(),s!==r?(sr=e,u=a,c=i,e={type:"interval-period",location:fr(),period:"second",precision:u,secondary:c}):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=Nn(),t!==r?(Mn(),n=Dn(),n!==r?(Mn(),a=Yr(),a!==r?(Mn(),o=_n(),o!==r?(sr=e,e=function(e){return{type:"interval-period",location:fr(),period:"second",precision:e,secondary:null}}(a)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=Nn(),t!==r&&(sr=e,t={type:"interval-period",location:fr(),period:"second",precision:null,secondary:null}),e=t))),e}(),o!==r?(sr=t,i=n,s=o,t={type:"interval-qualifier",location:fr(),start:i,end:s}):(ir=t,t=r)):(ir=t,t=r)):(ir=t,t=r),t===r&&(t=function(){let e,t,n,a,o,i,s;var l,u;return e=ir,t=Hr(),t!==r?(Mn(),n=Dn(),n!==r?(Mn(),a=Zr(),a!==r?(Mn(),o=_n(),o!==r?(sr=e,l=t,u=a,e={type:"interval-period",location:fr(),period:l.value,precision:u,secondary:null}):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=Hr(),t!==r&&(sr=e,t=function(e){return{type:"interval-period",location:fr(),period:e.value,precision:null,secondary:null}}(t)),e=t,e===r&&(e=ir,t=Nn(),t!==r?(Mn(),n=Dn(),n!==r?(Mn(),a=Yr(),a!==r?(Mn(),o=Cn(),o!==r?(Mn(),i=Zr(),i!==r?(Mn(),s=_n(),s!==r?(sr=e,e=function(e,t){return{type:"interval-period",location:fr(),period:"second",precision:e,secondary:t}}(a,i)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=Nn(),t!==r?(Mn(),n=Dn(),n!==r?(Mn(),a=Zr(),a!==r?(Mn(),o=_n(),o!==r?(sr=e,e=function(e){return{type:"interval-period",location:fr(),period:"second",precision:e,secondary:null}}(a)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r),e===r&&(e=ir,t=Nn(),t!==r&&(sr=e,t={type:"interval-period",location:fr(),period:"second",precision:null,secondary:null}),e=t)))),e}()),t}function Hr(){let e,t;return e=ir,t=gn(),t!==r&&(sr=e,t={type:"string",location:fr(),value:"day"}),e=t,e===r&&(e=ir,t=yn(),t!==r&&(sr=e,t={type:"string",location:fr(),value:"hour"}),e=t,e===r&&(e=ir,t=Tn(),t!==r&&(sr=e,t={type:"string",location:fr(),value:"minute"}),e=t,e===r&&(e=ir,t=In(),t!==r&&(sr=e,t={type:"string",location:fr(),value:"month"}),e=t,e===r&&(e=ir,t=wn(),t!==r&&(sr=e,t={type:"string",location:fr(),value:"year"}),e=t)))),e}function Zr(){let e,t;return e=ir,t=tn(),t!==r&&(sr=e,t=parseFloat(t)),e=t,e}function Yr(){let e,t;return e=ir,t=tn(),t!==r&&(sr=e,t=parseFloat(t)),e=t,e}function Wr(){let e;return e=Jr(),e===r&&(e=$r()),e}function Jr(){let t,n,a,o,i;if(t=ir,39===e.charCodeAt(ir)?(n=h,ir++):(n=r,0===dr&&gr(We)),n===r&&(e.substr(ir,2)===v?(n=v,ir+=2):(n=r,0===dr&&gr(Je))),n!==r){for(a=[],o=ir,e.substr(ir,2)===w?(i=w,ir+=2):(i=r,0===dr&&gr(Be)),i!==r&&(sr=o,i="'"),o=i,o===r&&(o=e.charAt(ir),Ee.test(o)?ir++:(o=r,0===dr&&gr(Ge)));o!==r;)a.push(o),o=ir,e.substr(ir,2)===w?(i=w,ir+=2):(i=r,0===dr&&gr(Be)),i!==r&&(sr=o,i="'"),o=i,o===r&&(o=e.charAt(ir),Ee.test(o)?ir++:(o=r,0===dr&&gr(Ge)));39===e.charCodeAt(ir)?(o=h,ir++):(o=r,0===dr&&gr(We)),o!==r?(sr=t,s=a,t={type:"string",location:fr(),value:s.join("")}):(ir=t,t=r)}else ir=t,t=r;var s;return t}function Br(){let e,t,n,a,o;var i,s;return e=ir,t=xn(),t!==r?(Mn(),n=Nr(),n!==r?(Mn(),a=En(),a!==r?(Mn(),o=Nr(),o!==r?(sr=e,i=n,s=o,e={type:"when-clause",location:fr(),operand:i,value:s}):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r),e}function Gr(){let e,t,n,a,o;var i,s;return e=ir,t=xn(),t!==r?(Mn(),n=Nr(),n!==r?(Mn(),a=En(),a!==r?(Mn(),o=Nr(),o!==r?(sr=e,i=n,s=o,e={type:"when-clause",location:fr(),operand:i,value:s}):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r)):(ir=e,e=r),e}function Qr(){let t,n,a;var o;return t=ir,n=function(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===me?ir+=4:(n=r,0===dr&&gr(Jt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="ELSE"):(ir=t,t=r)):(ir=t,t=r),t}(),n!==r?(Mn(),a=Nr(),a!==r?(sr=t,o=a,t={type:"else-clause",location:fr(),value:o}):(ir=t,t=r)):(ir=t,t=r),t}function Kr(){let t,n,a;var o;return t=tn(),t===r&&(t=ir,n=e.charAt(ir),ye.test(n)?ir++:(n=r,0===dr&&gr($e)),n!==r?(a=tn(),a!==r?(sr=t,o=a,t=n[0]+o):(ir=t,t=r)):(ir=t,t=r)),t}function Xr(){let t,n,a;var o;return t=ir,46===e.charCodeAt(ir)?(n=I,ir++):(n=r,0===dr&&gr(Qe)),n!==r?(a=tn(),a===r&&(a=null),sr=t,t="."+(null!=(o=a)?o:"")):(ir=t,t=r),t}function en(){let t,n,a;return t=ir,n=function(){let t,n,a;var o;return t=ir,n=e.charAt(ir),De.test(n)?ir++:(n=r,0===dr&&gr(Xe)),n!==r?(a=e.charAt(ir),ye.test(a)?ir++:(a=r,0===dr&&gr($e)),a===r&&(a=null),sr=t,t="e"+(null===(o=a)?"":o)):(ir=t,t=r),t}(),n!==r?(a=tn(),a!==r?(sr=t,t=n+a):(ir=t,t=r)):(ir=t,t=r),t}function tn(){let e,t,n;if(e=ir,t=[],n=rn(),n!==r)for(;n!==r;)t.push(n),n=rn();else t=r;return t!==r&&(sr=e,t=t.join("")),e=t,e}function rn(){let t;return t=e.charAt(ir),Ce.test(t)?ir++:(t=r,0===dr&&gr(Ke)),t}function nn(){let t,n,a,o;return t=ir,n=e.substr(ir,2),n.toLowerCase()===N?ir+=2:(n=r,0===dr&&gr(nt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="IN"):(ir=t,t=r)):(ir=t,t=r),t}function an(){let t,n,a,o;return t=ir,n=e.substr(ir,2),n.toLowerCase()===O?ir+=2:(n=r,0===dr&&gr(at)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="IS"):(ir=t,t=r)):(ir=t,t=r),t}function on(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===S?ir+=4:(n=r,0===dr&&gr(ot)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="LIKE"):(ir=t,t=r)):(ir=t,t=r),t}function sn(){let t,n,a,o;return t=ir,n=e.substr(ir,3),n.toLowerCase()===E?ir+=3:(n=r,0===dr&&gr(st)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="NOT"):(ir=t,t=r)):(ir=t,t=r),t}function ln(){let t,n,a,o;return t=ir,n=e.substr(ir,3),n.toLowerCase()===C?ir+=3:(n=r,0===dr&&gr(lt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="AND"):(ir=t,t=r)):(ir=t,t=r),t}function un(){let t,n,a,o;return t=ir,n=e.substr(ir,2),n.toLowerCase()===D?ir+=2:(n=r,0===dr&&gr(ut)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="OR"):(ir=t,t=r)):(ir=t,t=r),t}function cn(){let t,n,a,o;return t=ir,n=e.substr(ir,7),n.toLowerCase()===_?ir+=7:(n=r,0===dr&&gr(ct)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="BETWEEN"):(ir=t,t=r)):(ir=t,t=r),t}function pn(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===M?ir+=4:(n=r,0===dr&&gr(pt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="FROM"):(ir=t,t=r)):(ir=t,t=r),t}function dn(){let t,n,a,o;return t=ir,n=e.substr(ir,7),n.toLowerCase()===A?ir+=7:(n=r,0===dr&&gr(mt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="EXTRACT"):(ir=t,t=r)):(ir=t,t=r),t}function fn(){let t,n,a,o;return t=ir,n=e.substr(ir,9),n.toLowerCase()===R?ir+=9:(n=r,0===dr&&gr(wt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="TIMESTAMP"):(ir=t,t=r)):(ir=t,t=r),t}function mn(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===k?ir+=4:(n=r,0===dr&&gr(It)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="DATE"):(ir=t,t=r)):(ir=t,t=r),t}function hn(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===U?ir+=4:(n=r,0===dr&&gr(gt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="TIME"):(ir=t,t=r)):(ir=t,t=r),t}function vn(){let t,n,a,o;return t=ir,n=e.substr(ir,8),n.toLowerCase()===Q?ir+=8:(n=r,0===dr&&gr(Ft)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="INTERVAL"):(ir=t,t=r)):(ir=t,t=r),t}function wn(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===K?ir+=4:(n=r,0===dr&&gr(At)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="YEAR"):(ir=t,t=r)):(ir=t,t=r),t}function In(){let t,n,a,o;return t=ir,n=e.substr(ir,5),n.toLowerCase()===te?ir+=5:(n=r,0===dr&&gr(Rt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="MONTH"):(ir=t,t=r)):(ir=t,t=r),t}function gn(){let t,n,a,o;return t=ir,n=e.substr(ir,3),n.toLowerCase()===re?ir+=3:(n=r,0===dr&&gr(kt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="DAY"):(ir=t,t=r)):(ir=t,t=r),t}function yn(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===ne?ir+=4:(n=r,0===dr&&gr(Ut)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="HOUR"):(ir=t,t=r)):(ir=t,t=r),t}function Tn(){let t,n,a,o;return t=ir,n=e.substr(ir,6),n.toLowerCase()===ae?ir+=6:(n=r,0===dr&&gr($t)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="MINUTE"):(ir=t,t=r)):(ir=t,t=r),t}function Nn(){let t,n,a,o;return t=ir,n=e.substr(ir,6),n.toLowerCase()===oe?ir+=6:(n=r,0===dr&&gr(jt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="SECOND"):(ir=t,t=r)):(ir=t,t=r),t}function On(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===ce?ir+=4:(n=r,0===dr&&gr(Ht)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="CASE"):(ir=t,t=r)):(ir=t,t=r),t}function Sn(){let t,n,a,o;return t=ir,n=e.substr(ir,3),n.toLowerCase()===pe?ir+=3:(n=r,0===dr&&gr(Zt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="END"):(ir=t,t=r)):(ir=t,t=r),t}function xn(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===de?ir+=4:(n=r,0===dr&&gr(Yt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="WHEN"):(ir=t,t=r)):(ir=t,t=r),t}function En(){let t,n,a,o;return t=ir,n=e.substr(ir,4),n.toLowerCase()===fe?ir+=4:(n=r,0===dr&&gr(Wt)),n!==r?(a=ir,dr++,o=Lr(),dr--,o===r?a=void 0:(ir=a,a=r),a!==r?(sr=t,t="THEN"):(ir=t,t=r)):(ir=t,t=r),t}function Cn(){let t;return 44===e.charCodeAt(ir)?(t=he,ir++):(t=r,0===dr&&gr(Bt)),t}function Dn(){let t;return 40===e.charCodeAt(ir)?(t=ve,ir++):(t=r,0===dr&&gr(Gt)),t}function _n(){let t;return 41===e.charCodeAt(ir)?(t=we,ir++):(t=r,0===dr&&gr(Qt)),t}function Mn(){let e,t;for(e=[],t=bn();t!==r;)e.push(t),t=bn();return e}function bn(){let t;return t=e.charAt(ir),_e.test(t)?ir++:(t=r,0===dr&&gr(Kt)),t}function Fn(e,t,r,n,a){const o={type:"binary-expression",location:a,operator:e,left:t,right:r};return void 0!==n&&(o.escape=n),o}function An(e,...t){return{type:"expression-list",location:e,value:t}}function Pn(e,t){let r=e;for(const{op:e,expr:n,location:{end:a}}of t)r=Fn(e,r,n,void 0,{...r.location,end:a});return r}ur=o();const Ln=ur!==r&&ir===e.length;function Rn(){throw ur!==r&&ir<e.length&&gr({type:"end"}),function(e,t,r){return new le(le.buildMessage(e,t),e,t,r)}(pr,cr<e.length?function(t=ir){const r=e.codePointAt(t);return void 0===r?"":String.fromCodePoint(r)}(cr):null,cr<e.length?Ir(cr,cr+1):Ir(cr,cr))}return t.peg$library?{peg$result:ur,peg$currPos:ir,peg$FAILED:r,peg$maxFailExpected:pr,peg$maxFailPos:cr,peg$success:Ln,peg$throw:Ln?void 0:Rn}:Ln?ur:void Rn()}(e)}}function ce(e,t){if(null!=e)switch(t(e),e.type){case"when-clause":ce(e.operand,t),ce(e.value,t);break;case"case-expression":for(const r of e.clauses)ce(r,t);"simple"===e.format&&ce(e.operand,t),null!==e.else&&ce(e.else,t);break;case"expression-list":for(const r of e.value)ce(r,t);break;case"unary-expression":ce(e.expr,t);break;case"binary-expression":ce(e.left,t),ce(e.right,t);break;case"function":ce(e.args,t);break;case"interval":ce(e.value,t),ce(e.qualifier,t);break;case"interval-qualifier":ce(e.start,t),ce(e.end,t)}}const pe=new Set(["current_timestamp","current_date","current_time"]);class de{constructor(e){this.staticData=e}makeBool(e){return Se(e)}featureValue(e,t,r,n){return Re(e,t,r,n)}equalsNull(e){return null===e}applyLike(e,t,r){return Le(e,t,r)}ensureArray(e){return xe(e)}applyIn(e,t){return _e(e,t)}currentTimestamp(e){return Me(e)}currentDate(e){return be(e)}currentTime(e){return Fe(e)}makeSqlInterval(e,t,r){return b.createFromValueAndQualifier(e,t,r)}convertInterval(e){return b.isInterval(e)?e.valueInMilliseconds():e}compare(e,t,r){return K(t,r,e)}calculate(e,t,r,n){return ie(e,t,r,n)}evaluateTime(e){return Y(e)}evaluateTimestamp(e,t,r){return W(e,t,r)}evaluateDate(e,t){return J(e,t)}evaluateFunction(e,t,r){return re(e,t,r)}lookup(e,t){const r=t[e];return void 0===r?null:r}between(e,t){return null==e||null==t[0]||null==t[1]?null:K(e,t[0],">=")&&K(e,t[1],"<=")}notbetween(e,t){return null==e||null==t[0]||null==t[1]?null:K(e,t[0],"<")||K(e,t[1],">")}ternaryNot(e){return Ee(e)}ternaryAnd(e,t){return Ce(e,t)}ternaryOr(e,t){return De(e,t)}}function fe(e,...t){return`this.${e}(${t.join(", ")})`}function me(e){return void 0===e?"void 0":JSON.stringify(e)}function he({type:e,period:t,precision:r,secondary:n}){return JSON.stringify({type:e,period:t,precision:r,secondary:n})}const ve="feature",we="lookups",Ie="attributeAdapter",ge="fieldsIndex",ye="timeZone",Te="currentUser";class Ne{constructor(e){this._parseTree=e,this._staticData=Object.create(null),this._nextStaticDataId=0,this._tempVars=new Set,this._nextTempVarId=0}compile(){const e=this._compileNode(this._parseTree),t=`\n      ${this._tempVars.size>0?`var ${Array.from(this._tempVars).join(", ")};`:""}\n      return this.convertInterval(${e});\n    `;return new Function(ve,we,Ie,ge,ye,Te,t).bind(new de(this._staticData))}_storeStaticData(e){const t="static$"+this._nextStaticDataId++;return this._staticData[t]=e,t}_compileRefStaticData(e){return`this.staticData[${me(e)}]`}_generateTempVar(){const e="temp$"+this._nextTempVarId++;return this._tempVars.add(e),e}_compileSimpleCase(e){const t=this._compileNode(e.operand),r=this._generateTempVar(),n=[];for(const t of e.clauses){const e=fe("compare",me("="),r,this._compileNode(t.operand)),a=this._compileNode(t.value);n.push(`${e} ? (${a}) :`)}return null!=e.else?n.push(this._compileNode(e.else)):n.push(me(null)),`(${r} = ${t}, ${n.join(" ")})`}_compileSearchedCase(e){const t=[];for(const r of e.clauses){const e=fe("makeBool",this._compileNode(r.operand)),n=this._compileNode(r.value);t.push(`${e} ? (${n}) :`)}return null!=e.else?t.push(this._compileNode(e.else)):t.push(me(null)),t.join(" ")}_compileInExpr(e,t){const r=new Set,n=[];for(const e of t.value)"number"===e.type||"string"===e.type?r.add(e.value):n.push(e);const a=this._compileNode(e),o=fe("ensureArray",this._compileNode({type:"expression-list",location:t.location,value:n}));if(r.size>0){const e=this._compileRefStaticData(this._storeStaticData(r)),t=this._generateTempVar();return n.length>0?`(${t} = ${a}, ${e}.has(${t}) || ${fe("applyIn",t,o)})`:`(${t} = ${a}, ${t} == null ? null : ${e}.has(${t}))`}return fe("applyIn",a,o)}_compileNode(e){switch(e.type){case"interval":return fe("makeSqlInterval",this._compileNode(e.value),"interval-qualifier"===e.qualifier.type?function({type:e,start:t,end:r}){return`{type: ${me(e)}, start: ${he(t)}, end: ${he(r)}}`}(e.qualifier):he(e.qualifier),me(e.op));case"case-expression":return"simple"===e.format?this._compileSimpleCase(e):this._compileSearchedCase(e);case"parameter":return fe("lookup",me(e.value.toLowerCase()),we);case"expression-list":return`[${e.value.map((e=>this._compileNode(e))).join(", ")}]`;case"unary-expression":return fe("ternaryNot",this._compileNode(e.expr));case"binary-expression":switch(e.operator){case"AND":return fe("ternaryAnd",this._compileNode(e.left),this._compileNode(e.right));case"OR":return fe("ternaryOr",this._compileNode(e.left),this._compileNode(e.right));case"IS":if("null"!==e.right.type)throw new w(h.UnsupportedIsRhs);return fe("equalsNull",this._compileNode(e.left));case"ISNOT":if("null"!==e.right.type)throw new w(h.UnsupportedIsRhs);return`!${fe("equalsNull",this._compileNode(e.left))}`;case"IN":return this._compileInExpr(e.left,e.right);case"NOT IN":return fe("ternaryNot",this._compileInExpr(e.left,e.right));case"BETWEEN":return fe("between",this._compileNode(e.left),this._compileNode(e.right));case"NOTBETWEEN":return fe("notbetween",this._compileNode(e.left),this._compileNode(e.right));case"LIKE":return fe("applyLike",this._compileNode(e.left),this._compileNode(e.right),me(e.escape));case"NOT LIKE":return fe("ternaryNot",fe("applyLike",this._compileNode(e.left),this._compileNode(e.right),me(e.escape)));case"<>":case"<":case">":case">=":case"<=":case"=":return fe("compare",me(e.operator),this._compileNode(e.left),this._compileNode(e.right));case"*":case"-":case"+":case"/":case"||":return fe("calculate",me(e.operator),this._compileNode(e.left),this._compileNode(e.right),ye);default:throw new w(h.UnsupportedOperator,{operator:e.operator})}case"null":case"boolean":case"string":case"number":return me(e.value);case"time":try{return this._compileRefStaticData(this._storeStaticData(Y(e.value)))}catch{return fe("evaluateTime",me(e.value))}case"date":try{return this._compileRefStaticData(this._storeStaticData(J(e.value,"unknown")))}catch{return fe("evaluateDate",me(e.value),me("unknown"))}case"timestamp":try{return this._compileRefStaticData(this._storeStaticData(W(e.value,"unknown")))}catch{return fe("evaluateTimestamp",me(e.value),me("unknown"))}case"current-time":return"date"===e.mode?fe("currentDate",ye):"time"===e.mode?fe("currentTime",ye):fe("currentTimestamp",ye);case"current-user":return Te;case"column-reference":return fe("featureValue",ve,me(e.column),ge,Ie);case"data-type":return function({type:e,size:t,withtimezone:r}){return JSON.stringify({type:e,size:t,withtimezone:r})}(e.value);case"function":return fe("evaluateFunction",me(e.name),this._compileNode(e.args),ye)}throw new w(h.UnsupportedSyntax,{node:e.type})}}class Oe{static create(e,t={}){return new Oe(e,t.fieldsIndex,t.timeZone??void 0,t.currentUser)}constructor(e,t,r="UTC",n=null){this.fieldsIndex=t,this.timeZone=r,this.currentUser=n,this.parameters={},this._compiledExecutor=null,this._hasDateFunctions=void 0,this.parseTree=ue.parse(e);const{isStandardized:a,isAggregate:o,currentUserRequired:i,referencedFieldNames:s}=this._extractExpressionInfo(t);this._referencedFieldNames=s,this.isStandardized=a,this.isAggregate=o,this.currentUserRequired=i}static convertValueToStorageFormat(e,n=null){if(null===n)return m(e)?e.getTime():z(e)?e.toMillis():Z(e)?e.toStorageFormat():H(e)?e.toStorageString():q(e)?e.toStorageFormat():e;switch(n){case"date":return m(e)?e.getTime():z(e)?e.toMillis():Z(e)?e.toMilliseconds():q(e)?e.toNumber():e;case"date-only":return m(e)?t.fromDateJS(e).toString():Z(e)?t.fromSqlTimeStampOffset(e).toString():z(e)?t.fromDateTime(e).toString():e;case"time-only":return m(e)?r.fromDateJS(e).toStorageString():z(e)?r.fromDateTime(e).toStorageString():Z(e)?r.fromSqlTimeStampOffset(e).toStorageString():H(e)?e.toStorageString():e;case"timestamp-offset":if(m(e))return y.fromJSDate(e).toStorageFormat();if(z(e))return y.fromDateTime(e).toStorageFormat();if(Z(e))return e.toStorageFormat()}return e}get fieldNames(){return this._referencedFieldNames}testSet(e,t=ke,r=this.currentUser){return!!this._evaluateNode(this.parseTree,null,t,e,r)}calculateValue(e,t=ke,r=this.currentUser){const n=this._evaluateNode(this.parseTree,e,t,null,r);return b.isInterval(n)?n.valueInMilliseconds()/864e5:n}tryGetCompiledExecutor(){if(null!=this._compiledExecutor)return this._compiledExecutor;if(e("esri-csp-restrictions"))return null;const t=new Ne(this.parseTree);return this._compiledExecutor=t.compile(),this._compiledExecutor}calculateValueCompiled(e,t=ke,r=this.currentUser){const n=this.tryGetCompiledExecutor();return null==n?this.calculateValue(e,t):n(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null)}testFeature(e,t=ke,r=this.currentUser){return!!this._evaluateNode(this.parseTree,e,t,null,r)}testFeatureCompiled(e,t=ke,r=this.currentUser){const n=this.tryGetCompiledExecutor();return null==n?this.testFeature(e,t):!!n(e,this.parameters,t,this.fieldsIndex,this.timeZone,r??null)}get hasDateFunctions(){return null!=this._hasDateFunctions||(this._hasDateFunctions=!1,ce(this.parseTree,(e=>{"current-time"===e.type?this._hasDateFunctions=!0:"function"===e.type&&(this._hasDateFunctions=this._hasDateFunctions||pe.has(e.name.toLowerCase()))}))),this._hasDateFunctions}getFunctions(){const e=new Set;return ce(this.parseTree,(t=>{"function"===t.type&&e.add(t.name.toLowerCase())})),Array.from(e)}getExpressions(){const e=new Map;return ce(this.parseTree,(t=>{if("function"===t.type){const r=t.name.toLowerCase(),n=t.args.value[0];if("column-reference"===n.type){const t=n.column,a=`${r}-${t}`;e.has(a)||e.set(a,{aggregateType:r,field:t})}}})),[...e.values()]}getVariables(){const e=new Set;return ce(this.parseTree,(t=>{"parameter"===t.type&&e.add(t.value.toLowerCase())})),Array.from(e)}_extractExpressionInfo(e){const t=[],r=new Set;let n=!0,a=!1,o=!1;return ce(this.parseTree,(i=>{switch(i.type){case"column-reference":{const n=e?.get(i.column);let a,o;n?a=o=n.name??"":(o=i.column,a=o.toLowerCase()),r.has(a)||(r.add(a),t.push(o)),i.column=o;break}case"current-user":o=!0;break;case"function":{const{name:e,args:t}=i,r=t.value.length;n&&(n=function(e,t){const r=oe[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(e,r)),!1===a&&(a=N(e,r));break}}})),{referencedFieldNames:Array.from(t),isStandardized:n,isAggregate:a,currentUserRequired:o}}_evaluateNode(e,t,r,n,a){let i;switch(e.type){case"interval":{const o=this._evaluateNode(e.value,t,r,n,a);return b.createFromValueAndQualifier(o,e.qualifier,e.op)}case"case-expression":if("simple"===e.format){const o=this._evaluateNode(e.operand,t,r,n,a);for(let i=0;i<e.clauses.length;i++)if(K(o,this._evaluateNode(e.clauses[i].operand,t,r,n,a),"="))return this._evaluateNode(e.clauses[i].value,t,r,n,a);if(null!==e.else)return this._evaluateNode(e.else,t,r,n,a)}else{for(let o=0;o<e.clauses.length;o++)if(Se(this._evaluateNode(e.clauses[o].operand,t,r,n,a)))return this._evaluateNode(e.clauses[o].value,t,r,n,a);if(null!==e.else)return this._evaluateNode(e.else,t,r,n,a)}return null;case"parameter":return i=this.parameters[e.value.toLowerCase()],m(i)?o.fromJSDate(i):null!=i&&"object"==typeof i&&"toDateTime"in i?i.toDateTime():i;case"expression-list":{const o=[];for(const i of e.value)o.push(this._evaluateNode(i,t,r,n,a));return o}case"unary-expression":return Ee(this._evaluateNode(e.expr,t,r,n,a));case"binary-expression":switch(e.operator){case"AND":return Ce(this._evaluateNode(e.left,t,r,n,a),this._evaluateNode(e.right,t,r,n,a));case"OR":return De(this._evaluateNode(e.left,t,r,n,a),this._evaluateNode(e.right,t,r,n,a));case"IS":if("null"!==e.right.type)throw new w(h.UnsupportedIsRhs);return null===this._evaluateNode(e.left,t,r,n,a);case"ISNOT":if("null"!==e.right.type)throw new w(h.UnsupportedIsRhs);return null!==this._evaluateNode(e.left,t,r,n,a);case"IN":{const o=xe(this._evaluateNode(e.right,t,r,n,a));return _e(this._evaluateNode(e.left,t,r,n,a),o)}case"NOT IN":{const o=xe(this._evaluateNode(e.right,t,r,n,a));return Ee(_e(this._evaluateNode(e.left,t,r,n,a),o))}case"BETWEEN":{const o=this._evaluateNode(e.left,t,r,n,a),i=this._evaluateNode(e.right,t,r,n,a);return null==o||null==i[0]||null==i[1]?null:K(o,i[0],">=")&&K(o,i[1],"<=")}case"NOTBETWEEN":{const o=this._evaluateNode(e.left,t,r,n,a),i=this._evaluateNode(e.right,t,r,n,a);return null==o||null==i[0]||null==i[1]?null:K(o,i[0],"<")||K(o,i[1],">")}case"LIKE":return Le(this._evaluateNode(e.left,t,r,n,a),this._evaluateNode(e.right,t,r,n,a),e.escape);case"NOT LIKE":return Ee(Le(this._evaluateNode(e.left,t,r,n,a),this._evaluateNode(e.right,t,r,n,a),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return K(this._evaluateNode(e.left,t,r,n,a),this._evaluateNode(e.right,t,r,n,a),e.operator);case"-":case"+":case"*":case"/":case"||":return ie(e.operator,this._evaluateNode(e.left,t,r,n,a),this._evaluateNode(e.right,t,r,n,a),this.timeZone)}case"null":case"boolean":case"string":case"number":return e.value;case"date":return e.parsedValue??=J(e.value,"unknown"),e.parsedValue;case"timestamp":return e.parsedValue??=W(e.value,"unknown"),e.parsedValue;case"time":return Y(e.value);case"current-time":return"date"===e.mode?be(this.timeZone):"time"===e.mode?Fe(this.timeZone):Me(this.timeZone);case"current-user":return a??null;case"column-reference":return Re(t,e.column,this.fieldsIndex,r);case"data-type":return e.value;case"function":{if(this.isAggregate&&N(e.name,e.args.value.length)){const t=[];for(const o of e.args?.value||[]){const e=[];for(const t of n||[])e.push(this._evaluateNode(o,t,r,null,a));t.push(e)}return T(e.name,t)}const o=this._evaluateNode(e.args,t,r,n,a);return re(e.name,o,this.timeZone)}}throw new w(h.UnsupportedSyntax,{node:e.type})}}function Se(e){return!0===e}function xe(e){return Array.isArray(e)?e:[e]}function Ee(e){return null!==e?!0!==e:null}function Ce(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function De(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function _e(e,t){if(null==e)return null;let r=!1;for(const n of t)if(null==n)r=null;else{if(e===n){r=!0;break}if(G(e)&&G(n)&&(r=K(e,n,"="),r))break}return r}function Me(e){return j(new Date,e)}function be(e){return t.fromNow(e)}function Fe(e){const t=j(new Date,e);return r.fromDateTime(t)}const Ae="-[]/{}()*+?.\\^$|";var Pe;function Le(e,t,r){if(null==e)return null;const n=function(e,t){const r=t;let n="",a=Pe.Normal;for(let t=0;t<e.length;t++){const o=e.charAt(t);switch(a){case Pe.Normal:o===r?a=Pe.Escaped:Ae.includes(o)?n+="\\"+o:n+="%"===o?".*":"_"===o?".":o;break;case Pe.Escaped:Ae.includes(o)?n+="\\"+o:n+=o,a=Pe.Normal}}return new RegExp("^"+n+"$","m")}(t,r);return n.test(e)}function Re(e,n,a,o){if("getAttributeSQL"in o)return o.getAttributeSQL(e,n);const i=o.getAttribute(e,n);if(null==i)return i;const l=a?.get(n);switch(l?.type){case"esriFieldTypeDate":case"date":return j(new Date(i),a?.getLuxonTimeZone(l.name)??s.utcInstance);case"esriFieldTypeDateOnly":case"date-only":return t.fromReader(i);case"esriFieldTypeTimeOnly":case"time-only":return r.fromReader(i);case"esriFieldTypeTimestampOffset":case"timestamp-offset":return new y(i)}return i}!function(e){e[e.Normal=0]="Normal",e[e.Escaped=1]="Escaped"}(Pe||(Pe={}));const ke={getAttribute(e,t){var r;return((r=e)&&"object"==typeof r.attributes?e.attributes:e)[t]}},Ue=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"}));export{y as S,Ue as W,w as a,h as b,T as c,Oe as default};
