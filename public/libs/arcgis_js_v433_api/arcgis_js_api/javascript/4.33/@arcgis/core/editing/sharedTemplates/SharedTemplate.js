/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import{l as o}from"../../core/lang.js";import e from"../../core/Error.js";import i from"../../core/Loadable.js";import s from"../../core/Promise.js";import{property as r}from"../../core/accessorSupport/decorators/property.js";import"../../chunks/Logger.js";import{r as p}from"../../chunks/reader.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";import a,{n as l}from"./SharedTemplateMetadata.js";import{S as m,g as u,a as c,b as y,c as d}from"../../chunks/SharedTemplateProvider.js";import j from"../../core/JSONSupport.js";import{e as h}from"../../chunks/enumeration.js";import{J as f}from"../../chunks/jsonMap.js";import{fromJSON as g}from"../../geometry/support/jsonUtils.js";import{g as k}from"../../chunks/typeUtils2.js";import b from"../../geometry/Point.js";import S from"../../geometry/SpatialReference.js";import{k as _}from"../../chunks/templateUtils2.js";import"../../config.js";import"../../chunks/maybe.js";import"../../core/promiseUtils.js";import"../../chunks/handleUtils.js";import"../../chunks/events.js";import"../../chunks/Warning.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/Lifecycle.js";import"../../chunks/metadata.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/tracking.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../chunks/SetUtils.js";import"../../chunks/SimpleTrackingTarget.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../core/reactiveUtils.js";import"../../chunks/layerUtils.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../layers/catalog/catalogUtils.js";import"../../chunks/utils8.js";import"../../chunks/Version2.js";import"../../chunks/Version.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../chunks/unitUtils.js";import"../../chunks/pe.js";import"../../chunks/assets.js";import"../../chunks/writer.js";import"../../geometry/support/webMercatorUtils.js";import"../../core/accessorSupport/decorators/cast.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/Axis.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../chunks/mathUtils.js";import"../../geometry/Polyline.js";import"../../chunks/ReactiveMap.js";import"../../chunks/UpdatingHandles.js";import"../../portal/Portal.js";import"../../chunks/locale.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../chunks/utils9.js";import"../../rest/featureService/FeatureService.js";import"../../core/Identifiable.js";import"../../chunks/applyEditsUtils.js";import"../../Graphic.js";import"../../PopupTemplate.js";import"../../core/Clonable.js";import"../../layers/support/fieldUtils.js";import"../../core/sql.js";import"../../chunks/guards.js";import"../../chunks/datetime.js";import"../../popup/content.js";import"../../popup/content/AttachmentsContent.js";import"../../popup/content/Content.js";import"../../popup/support/AttachmentsOrderByInfo.js";import"../../popup/content/CustomContent.js";import"../../popup/content/ExpressionContent.js";import"../../popup/ElementExpressionInfo.js";import"../../popup/content/FieldsContent.js";import"../../popup/FieldInfo.js";import"../../popup/support/FieldInfoFormat.js";import"../../chunks/date.js";import"../../chunks/constants.js";import"../../popup/content/MediaContent.js";import"../../popup/content/BarChartMediaInfo.js";import"../../popup/content/mixins/ChartMediaInfo.js";import"../../popup/content/mixins/MediaInfo.js";import"../../popup/content/support/ChartMediaInfoValue.js";import"../../Color.js";import"../../chunks/colorUtils2.js";import"../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../chunks/chartMediaInfoUtils.js";import"../../popup/content/ColumnChartMediaInfo.js";import"../../popup/content/ImageMediaInfo.js";import"../../popup/content/support/ImageMediaInfoValue.js";import"../../popup/content/LineChartMediaInfo.js";import"../../popup/content/PieChartMediaInfo.js";import"../../popup/content/RelationshipContent.js";import"../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../popup/content/TextContent.js";import"../../popup/content/UtilityNetworkAssociationsContent.js";import"../../popup/support/UtilityNetworkAssociationType.js";import"../../popup/ExpressionInfo.js";import"../../popup/LayerOptions.js";import"../../popup/RelatedRecordsInfo.js";import"../../support/actions/ActionBase.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import"../../chunks/createFeatureId.js";import"../../chunks/typeUtils.js";import"../../symbols/CIMSymbol.js";import"../../symbols/Symbol.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/utils5.js";import"../../symbols/edges/Edges3D.js";import"../../chunks/screenUtils.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../../symbols/FillSymbol3DLayer.js";import"../../symbols/patterns/LineStylePattern3D.js";import"../../symbols/patterns/StylePattern3D.js";import"../../chunks/utils6.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/vec3f64.js";import"../../chunks/aaBoundingBox.js";import"../../symbols/IconSymbol3DLayer.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/LineStyleMarker3D.js";import"../../chunks/lineMarkers.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/Font.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/support/StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../symbols/support/Symbol3DVerticalOffset.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MeshSymbol3D.js";import"../../symbols/PictureFillSymbol.js";import"../../symbols/FillSymbol.js";import"../../symbols/SimpleLineSymbol.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";import"../../chunks/projectionUtils.js";import"../../chunks/projectBuffer.js";import"../../chunks/geodesicConstants.js";import"../../chunks/projectXYZToVector.js";import"../../geometry/support/GeographicTransformation.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../chunks/zscale.js";import"../../geometry/support/MeshTransform.js";import"../../chunks/mat4.js";import"../../chunks/common.js";import"../../chunks/mat4f64.js";import"../../chunks/quat.js";import"../../chunks/vec3.js";import"../../chunks/vec4.js";import"../../chunks/quatf64.js";import"../../chunks/axisAngleDegrees.js";import"../../chunks/editingSupport.js";import"../../chunks/uuid.js";import"../../geometry/support/normalizeUtils.js";import"../../chunks/normalizeUtilsCommon.js";import"../../chunks/simplify.js";import"../../chunks/utils10.js";import"../../chunks/utils11.js";import"../../chunks/EditBusLayer.js";import"../../chunks/infoFor3D.js";import"../../chunks/featureLayerUtils.js";import"../../chunks/asyncUtils.js";import"../../layers/support/CodedValueDomain.js";import"../../layers/support/Domain.js";import"../../chunks/featureQueryAll.js";import"../../rest/support/Query.js";import"../../chunks/DataLayerSource.js";import"../../layers/support/Field.js";import"../../chunks/domains.js";import"../../layers/support/InheritedDomain.js";import"../../layers/support/RangeDomain.js";import"../../chunks/fieldType.js";import"../../chunks/FullTextSearch.js";import"../../chunks/spatialRelationships.js";import"../../rest/support/StatisticDefinition.js";import"../../time/TimeExtent.js";import"../../chunks/timeUtils.js";import"../../renderers/SimpleRenderer.js";import"../../renderers/Renderer.js";import"../../renderers/support/AuthoringInfo.js";import"../../renderers/support/AuthoringInfoVisualVariable.js";import"../../chunks/colorRamps.js";import"../../rest/support/AlgorithmicColorRamp.js";import"../../rest/support/ColorRamp.js";import"../../rest/support/MultipartColorRamp.js";import"../../renderers/mixins/VisualVariablesMixin.js";import"../../renderers/visualVariables/ColorVariable.js";import"../../renderers/visualVariables/VisualVariable.js";import"../../renderers/visualVariables/support/ColorStop.js";import"../../renderers/visualVariables/OpacityVariable.js";import"../../renderers/visualVariables/support/OpacityStop.js";import"../../renderers/visualVariables/RotationVariable.js";import"../../renderers/visualVariables/SizeVariable.js";import"../../renderers/visualVariables/support/SizeStop.js";import"../../chunks/visualVariableUtils.js";import"../../chunks/lengthUtils.js";import"../../chunks/commonProperties2.js";import"../../symbols/support/jsonUtils.js";import"../../chunks/defaults.js";import"../../chunks/defaultsJSON.js";import"../../renderers/UniqueValueRenderer.js";import"../../chunks/diffUtils.js";import"../../chunks/RendererLegendOptions.js";import"../../renderers/support/UniqueValue.js";import"../../renderers/support/UniqueValueClass.js";import"../../renderers/support/UniqueValueGroup.js";import"../../renderers/support/UniqueValueInfo.js";import"../../chunks/styleUtils.js";import"../../rest/support/AttachmentQuery.js";import"../../rest/support/NormalizationBinParametersMixin.js";import"../../rest/support/RelationshipQuery.js";import"../../chunks/serviceCapabilitiesUtils.js";import"../../portal/PortalItem.js";import"../../portal/PortalItemResource.js";import"../../portal/PortalRating.js";import"../../chunks/portalItemUtils.js";import"../../chunks/editsZScale.js";let v=class extends(i.LoadableMixin(s.EsriPromiseMixin(j))){constructor(){super(...arguments),this.excludedTools=[],this.featureService=null,this.makeSharedTemplateFromJSON=null,this.view=null}readExcludedTools(t){return t.map((t=>l.fromJSON(t)))}load(t){return this.addResolvingPromise(this._load(t)),Promise.resolve(this)}async _load(t){const o=this.allParts,{featureService:i,makeSharedTemplateFromJSON:s,view:r}=this;if(null==i||null==s||null==r)throw new m;for(const t of o)t.assertIsSupportedPart();const p=u(r,{makeSharedTemplateFromJSON:s}),n=o.filter((t=>null==t.template)),a=await p.getTemplates({templateIds:n.map((t=>t.templateId)),featureService:i,signal:t?.signal}),l=new Map(a.map((t=>[t.templateId,t])));for(const t of n){const o=l.get(t.templateId);if(null==o)throw new e("internal:missing-template",`Failed to retrieve template for template ID ${t.templateId}`);t.template=o}await Promise.all(o.map((o=>o.template?.load(t))))}};t([r({readOnly:!0})],v.prototype,"type",void 0),t([r({constructOnly:!0})],v.prototype,"excludedTools",void 0),t([p("excludedTools")],v.prototype,"readExcludedTools",null),t([r()],v.prototype,"featureService",void 0),t([r()],v.prototype,"makeSharedTemplateFromJSON",void 0),t([r()],v.prototype,"view",void 0),v=t([n("esri.editing.sharedTemplates.templateDefinitions.TemplateDefinitionBase")],v);let P=class extends j{constructor(t){super(t),this.template=null}};t([r()],P.prototype,"template",void 0),t([r()],P.prototype,"templateGlobalId",void 0),t([r()],P.prototype,"templateId",void 0),t([r({readOnly:!0,json:{read:!1,write:!1}})],P.prototype,"type",void 0),P=t([n("esri.editing.sharedTemplates.templateDefinitions.parts.TemplatePartBase")],P);let T=class extends P{constructor(t){super(t),this.relationshipCatalogId="",this.relationshipMetadata=null,this.template=null,this.type="relationship"}assertIsSupportedPart(){}};t([r({json:{name:"relationshipClassID"}})],T.prototype,"relationshipCatalogId",void 0),t([r()],T.prototype,"relationshipMetadata",void 0),t([r()],T.prototype,"template",void 0),t([r()],T.prototype,"type",void 0),T=t([n("esri.editing.sharedTemplates.templateDefinitions.parts.FeatureTemplateRelationshipPart")],T);const I=T;let U=class extends v{constructor(t){super(t),this.type="feature",this.defaultValues=null,this.relationships=[]}get allParts(){return this.relationships}initializeRelationshipMetadata(t){for(const o of this.relationships){const{relationshipCatalogId:e}=o,i=o.template?.layer,s=t.relationships?.find((t=>t.catalogId===e)),r=i?.relationships?.find((t=>t.catalogId===e));if(!s||!i||!r)throw new c(e);o.relationshipMetadata={destinationField:r.keyField,destinationLayerId:i.layerId,sourceField:s.keyField,sourceLayerId:t.layerId}}}};t([r({readOnly:!0})],U.prototype,"type",void 0),t([r()],U.prototype,"allParts",null),t([r()],U.prototype,"defaultValues",void 0),t([r({constructOnly:!0,type:[I]})],U.prototype,"relationships",void 0),U=t([n("esri.editing.sharedTemplates.templateDefinitions.FeatureTemplateDefinition")],U);const D=U,w=new f({esri_editing_transformation_bufferLineToPolygon:"buffer-line-to-polygon",esri_editing_transformation_bufferPointToPolygon:"buffer-point-to-polygon",esri_editing_transformation_bufferPolygonToPolygon:"buffer-polygon-to-polygon",esri_editing_transformation_connectionPoint:"connection-point",esri_editing_transformation_equallySpaced:"equally-spaced",esri_editing_transformation_offsetLine:"offset-line",esri_editing_transformation_offsetPrimaryLine:"offset-primary-line",esri_editing_transformation_pointAtAllVerticesOfLine:"point-at-all-vertices-of-line",esri_editing_transformation_pointAtBeginningOfLine:"point-at-beginning-of-line",esri_editing_transformation_pointAtBeginningOfRadial:"point-at-beginning-of-radial",esri_editing_transformation_pointAtEndOfLine:"point-at-end-of-line",esri_editing_transformation_pointAtInteriorVertices:"point-at-interior-vertices",esri_editing_transformation_pointAtIntersectionVerticesOfLine:"point-at-intersection-vertices-of-line",esri_editing_transformation_pointAtNotBeginningOfLine:"point-at-not-beginning-of-line",esri_editing_transformation_pointAtNotEndOfLine:"point-at-not-end-of-line",esri_editing_transformation_pointAtPolygonCentroid:"point-at-polygon-centroid",esri_editing_transformation_pointAtPolygonNotStart:"point-at-polygon-not-start",esri_editing_transformation_pointAtPolygonStart:"point-at-polygon-start",esri_editing_transformation_pointIdentity:"point-identity",esri_editing_transformation_pointPrimaryIdentity:"point-primary-identity",esri_editing_transformation_polygonBoundary:"polygon-boundary",esri_editing_transformation_polygonBoundaryTwoPoint:"polygon-boundary-two-point",esri_editing_transformation_polygonIdentity:"polygon-identity",esri_editing_transformation_polygonPrimaryIdentity:"polygon-primary-identity",esri_editing_transformation_polygonVertices:"polygon-vertices",esri_editing_transformation_radialLines:"radial-lines",esri_editing_transformation_twoPointLines:"two-point-lines"}),L={"buffer-line-to-polygon":"polyline","buffer-point-to-polygon":"point","buffer-polygon-to-polygon":"polygon","connection-point":"polyline","equally-spaced":"polyline","offset-line":"polyline","offset-primary-line":"polyline","point-at-all-vertices-of-line":"polyline","point-at-beginning-of-line":"polyline","point-at-beginning-of-radial":"polyline","point-at-end-of-line":"polyline","point-at-interior-vertices":"polyline","point-at-intersection-vertices-of-line":"polyline","point-at-not-beginning-of-line":"polyline","point-at-not-end-of-line":"polyline","point-at-polygon-centroid":"polygon","point-at-polygon-not-start":"polygon","point-at-polygon-start":"polygon","point-identity":"point","point-primary-identity":"point","polygon-boundary":"polygon","polygon-boundary-two-point":"polygon","polygon-identity":"polygon","polygon-primary-identity":"polygon","polygon-vertices":"polygon","radial-lines":"polyline","two-point-lines":"polyline"};let O=class extends P{constructor(t){super(t),this.builderConfig={},this.type="group"}assertIsSupportedPart(){const{builderType:t}=this;if(!w.apiValues.includes(t))throw new y(t)}};t([h(w,{ignoreUnknown:!1,name:"type"})],O.prototype,"builderType",void 0),t([r({json:{name:"options"}})],O.prototype,"builderConfig",void 0),t([r()],O.prototype,"type",void 0),O=t([n("esri.editing.sharedTemplates.templateDefinitions.parts.GroupTemplatePart")],O);const C=O;let M=class extends v{constructor(t){super(t),this.type="group",this.createUtilityNetworkAssociations=!1,this.parts=[],this.utilityNetwork=null,this.utilityNetworkAssociationsTable=null}get allParts(){return[this.basePart,...this.parts]}get inputGeometryType(){return L[this.basePart.builderType]}};t([r({readOnly:!0})],M.prototype,"type",void 0),t([r()],M.prototype,"allParts",null),t([r({constructOnly:!0,type:C})],M.prototype,"basePart",void 0),t([r({constructOnly:!0})],M.prototype,"createUtilityNetworkAssociations",void 0),t([r()],M.prototype,"inputGeometryType",null),t([r({constructOnly:!0,type:[C]})],M.prototype,"parts",void 0),t([r()],M.prototype,"utilityNetwork",void 0),t([r()],M.prototype,"utilityNetworkAssociationsTable",void 0),M=t([n("esri.editing.sharedTemplates.templateDefinitions.GroupTemplateDefinition")],M);const x=M;let V=class extends P{constructor(t){super(t),this.geometry=null,this.type="preset"}assertIsSupportedPart(){}};t([r({types:k,json:{read:g}})],V.prototype,"geometry",void 0),t([r()],V.prototype,"type",void 0),V=t([n("esri.editing.sharedTemplates.templateDefinitions.parts.PresetTemplatePart")],V);const A=V;let R=class extends v{constructor(t){super(t),this.type="preset",this.parts=[]}get allParts(){return this.parts}};t([r({readOnly:!0})],R.prototype,"type",void 0),t([r()],R.prototype,"allParts",null),t([r({constructOnly:!0,type:b})],R.prototype,"origin",void 0),t([r({constructOnly:!0,type:[A],json:{name:"features"}})],R.prototype,"parts",void 0),t([r({type:S})],R.prototype,"spatialReference",void 0),R=t([n("esri.editing.sharedTemplates.templateDefinitions.PresetTemplateDefinition")],R);const F=R,N=t=>E.fromJSON(t);let E=class extends(i.LoadableMixin(s.EsriPromiseMixin(a))){constructor(t){super(t),this.definition=null,this.layer=null,this.type="feature",this.view=null}readDefinition(t,i){switch(i.type){case"feature":return D.fromJSON(t);case"group":return x.fromJSON(t);case"preset":return F.fromJSON(t);default:throw o(i.type),new e("shared-template:no-definition","No value for 'definition' provided to 'SharedTemplate' constructor")}}load(t){return this.addResolvingPromise(this._load(t)),Promise.resolve(this)}async _load(t){const{definition:o,featureService:e,layer:i,view:s}=this;if(!(o&&e&&i&&s))throw new d;o.featureService=e,o.makeSharedTemplateFromJSON=N,o.view=s,await(this.definition?.load(t)),_(o)&&o.initializeRelationshipMetadata(i)}};t([r()],E.prototype,"definition",void 0),t([p("definition")],E.prototype,"readDefinition",null),t([r()],E.prototype,"layer",void 0),t([r()],E.prototype,"type",void 0),t([r()],E.prototype,"view",void 0),E=t([n("esri.editing.sharedTemplates.SharedTemplate")],E);const B=E;export{B as default};
