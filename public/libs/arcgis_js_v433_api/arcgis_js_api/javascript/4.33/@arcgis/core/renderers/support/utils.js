/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{u as s,i as o}from"../../core/lang.js";import{L as e}from"../../chunks/Logger.js";import{g as t}from"../../chunks/MapUtils.js";import{c as i,f as r}from"../../chunks/date.js";import{isTimeOnlyField as l}from"../../layers/support/fieldUtils.js";import{f as n,r as a}from"../../chunks/numberUtils.js";import m from"../visualVariables/support/ColorStop.js";import{i as u,f as p}from"../../chunks/utils14.js";import{e as c}from"../../chunks/utils4.js";import{getRampStops as y}from"../../chunks/colorRampUtils2.js";import f from"./HeatmapColorStop.js";import"../../config.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/handleUtils.js";import"../../chunks/constants.js";import"../../chunks/datetime.js";import"../../core/Error.js";import"../../chunks/SetUtils.js";import"../../core/sql.js";import"../../chunks/maybe.js";import"../../chunks/guards.js";import"../../intl.js";import"../../chunks/number2.js";import"../../chunks/substitute.js";import"../../chunks/messages.js";import"../../core/promiseUtils.js";import"../../chunks/events.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/assets.js";import"../../chunks/tslib.es6.js";import"../../Color.js";import"../../chunks/colorUtils2.js";import"../../chunks/mathUtils.js";import"../../chunks/ensureType.js";import"../../core/JSONSupport.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/Lifecycle.js";import"../../chunks/metadata.js";import"../../chunks/utils.js";import"../../chunks/tracking.js";import"../../chunks/Warning.js";import"../../chunks/get.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../chunks/SimpleTrackingTarget.js";import"../../chunks/writer.js";import"../../chunks/basemapUtils.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../chunks/utils2.js";import"../../chunks/screenUtils.js";import"../../chunks/mat4.js";import"../../chunks/common.js";import"../../chunks/basemapDefinitions.js";import"../../chunks/timeZoneUtils.js";import"../../chunks/asyncUtils.js";import"../../chunks/vec3f64.js";import"../../chunks/jsonUtils2.js";import"../../chunks/parser.js";import"../../symbols/support/cimSymbolUtils.js";import"../../chunks/utils3.js";import"../../chunks/defaultCIMValues.js";import"../../chunks/enums2.js";import"../../chunks/gfxUtils.js";import"../../chunks/LRUCache.js";import"../../chunks/MemCache.js";import"../../chunks/Symbol3DMaterial.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../../chunks/typeUtils.js";import"../../symbols/CIMSymbol.js";import"../../chunks/enumeration.js";import"../../chunks/reader.js";import"../../symbols/Symbol.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../core/accessorSupport/decorators/cast.js";import"../../portal/Portal.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/pe.js";import"../../geometry/Point.js";import"../../geometry/support/webMercatorUtils.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/utils5.js";import"../../symbols/edges/Edges3D.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../symbols/FillSymbol3DLayer.js";import"../../symbols/patterns/LineStylePattern3D.js";import"../../symbols/patterns/StylePattern3D.js";import"../../chunks/utils6.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/aaBoundingBox.js";import"../../chunks/aaBoundingRect.js";import"../../symbols/IconSymbol3DLayer.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/LineStyleMarker3D.js";import"../../core/Clonable.js";import"../../chunks/lineMarkers.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/Font.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/support/StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../symbols/support/Symbol3DVerticalOffset.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MeshSymbol3D.js";import"../../symbols/PictureFillSymbol.js";import"../../symbols/FillSymbol.js";import"../../symbols/SimpleLineSymbol.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../core/reactiveUtils.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";import"../../chunks/utils17.js";import"../../chunks/timeUtils.js";function j(s){if(!s.colorStops)return[];const o=[...s.colorStops].filter((s=>s.color?.a>0));let e=o.length-1;if(o&&o[0]){const s=o[e];s&&1!==s.ratio&&(o.push(new f({ratio:1,color:s.color})),e++)}return o.map(((o,t)=>{let i="";return 0===t?i=s.legendOptions?.minLabel||"low":t===e&&(i=s.legendOptions?.maxLabel||"high"),{color:o.color,label:i,ratio:o.ratio}})).reverse()}const d={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},b={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"},h=i("short-date");async function k(s,o,e){t(s,o,(()=>[])).push(...e)}async function g(o){const e=new Map;if(!o)return e;if("visualVariables"in o&&o.visualVariables)for(const s of o.visualVariables)if(M(s)){const o=(await y(s)??[]).map((s=>s.color));await k(e,s.field||s.valueExpression,o)}if("heatmap"===o.type){const s=j(o).map((s=>s.color));await k(e,o.field||o.valueExpression,s)}else if("pie-chart"===o.type){for(const s of o.attributes)await k(e,s.field||s.valueExpression,[s.color]);await k(e,"default",[o?.othersCategory?.color,c(o.backgroundFillSymbol,null)])}else if("dot-density"===o.type){for(const s of o.attributes)await k(e,s.field||s.valueExpression,[s.color]);await k(e,"default",[o.backgroundColor])}else if("unique-value"===o.type)if("predominance"===o.authoringInfo?.type)for(const s of o.uniqueValueInfos??[])await k(e,s.value.toString(),[c(s.symbol,null)]);else{const s=(o.uniqueValueInfos??[]).map((s=>c(s.symbol,null))),{field:t,field2:i,field3:r,valueExpression:l}=o;(t||l)&&await k(e,t||l,s),i&&await k(e,i,s),r&&await k(e,r,s)}else if("class-breaks"===o.type){const s=o.classBreakInfos.map((s=>c(s.symbol,null))),{field:t,valueExpression:i}=o;await k(e,t??i,s)}else"simple"===o.type&&await k(e,"default",[c(o.symbol,null)]);return"defaultSymbol"in o&&o.defaultSymbol&&await k(e,"default",[c(o.defaultSymbol,null)]),e.forEach(((o,t)=>{const i=s(o.filter(Boolean),((s,o)=>JSON.stringify(s)===JSON.stringify(o)));e.set(t,i)})),e}async function S(s,o,e){const i=t(s,o,(()=>new Map));for(const s of e)i.set(s.value,s.color)}async function v(s){const o=new Map;if(!s)return o;if("unique-value"!==s.type||s.authoringInfo?.type)if("class-breaks"===s.type){const e=s.classBreakInfos.map((s=>({value:s.minValue,color:c(s.symbol,null)}))).reverse(),{field:t,valueExpression:i}=s;await S(o,t??i,e)}else"simple"===s.type&&await S(o,"default",[{value:"default",color:c(s.symbol,null)}]);else{const e=(s.uniqueValueInfos??[]).map((s=>({value:s.value,color:c(s.symbol,null)}))),{field:t,field2:i,field3:r,valueExpression:l,fieldDelimiter:n}=s,a=[t,i,r].filter(Boolean).join(n||"");(a||l)&&await S(o,a||l,e)}if("defaultSymbol"in s&&s.defaultSymbol&&await S(o,"default",[{value:"default",color:c(s.defaultSymbol,null)}]),"visualVariables"in s&&s.visualVariables){const e=s.visualVariables.filter((s=>"color"===s.type));for(const s of e){const e=await y(s)??[];await S(o,s.field||s.valueExpression,e)}}return o}function x(s){const{values:o,colors:e,labelIndexes:t,isDate:i}=s;return o.map(((s,l)=>{let a=null;if(!t||t.includes(l)){const e=i?r(s):n(s);e&&(a=function(s,o,e){let t="";return 0===o?t="< ":o===e&&(t="> "),t+s}(e,l,o.length-1))}return new m({value:s,color:e[l],label:a})}))}function U(s){let o=s.minValue,e=s.maxValue;const t=s.isFirstBreak?"":"> ",i="percent-of-total"===s.normalizationType?"%":"";return o=null==o?"":n(o),e=null==e?"":n(e),t+o+i+" â€“ "+e+i}function D(s){const o=s.classBreakInfos,t=s.normalizationType;let i=[];if(o?.length)if("standard-deviation"!==s.classificationMethod)if(s.round){i.push(o[0].minValue);for(const s of o)i.push(s.maxValue);i=a(i),o.forEach(((s,o)=>{s.label=U({minValue:0===o?i[0]:i[o],maxValue:i[o+1],isFirstBreak:0===o,normalizationType:t})}))}else o.forEach(((s,o)=>{s.label=U({minValue:s.minValue,maxValue:s.maxValue,isFirstBreak:0===o,normalizationType:t})}));else e.getLogger("esri.renderers.support.utils").warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.")}function w(s){const o=s.map((s=>new Date(s))),e=o.length;let t=1/0,i=null;for(let s=0;s<e-1;s++){const r=o[s];let l=1/0,n=null;for(let t=s+1;t<e;t++){const s=o[t],e=(r.getFullYear()!==s.getFullYear()?"year":r.getMonth()!==s.getMonth()&&"month")||r.getDate()!==s.getDate()&&"day"||r.getHours()!==s.getHours()&&"hour"||r.getMinutes()!==s.getMinutes()&&"minute"||r.getSeconds()!==s.getSeconds()&&"second"||"millisecond",i=d[e];i<l&&(l=i,n=e)}l<t&&(t=l,i=n)}return i}function L(s){const{value:o,domain:e,fieldInfo:t,dateFormatOptions:i}=s;let r=String(o);const a=e&&"codedValues"in e&&e.codedValues?e.getName(o):null;return a?r=a:null!=o&&t&&(u(t)||l(t))?r=p(o,i??{fieldType:t.type}):"number"==typeof o&&(r=n(o)),r}function V(s,o){return"normalizationField"in s&&s.normalizationField?{type:"normalized-field",field:s.field,normalizationField:s.normalizationField}:"field"in s&&s.field?E(s.field):"valueExpression"in s&&s.valueExpression?{type:"expression",expression:s.valueExpression,title:s.valueExpressionTitle,returnType:o}:null}function E(s){return{type:"field",field:s}}function F(e,t){const i=[];if("class-breaks"===e.type||"heatmap"===e.type)i.push(V(e,"number"));else if("unique-value"===e.type){const s=e.authoringInfo;if(s&&"relationship"===s.type){if(s.field1&&s.field2){const o=s.field1.field,e=s.field2.field,t=s.field1.normalizationField,r=s.field2.normalizationField;i.push(V({field:o,normalizationField:t})),i.push(V({field:e,normalizationField:r}))}}else{const s=e.uniqueValueInfos?.[0];let o=null;if(s?.value){const e=typeof s.value;"string"!==e&&"number"!==e||(o=e)}i.push(V(e,o)),[e.field2,e.field3].forEach((s=>s&&i.push(E(s))))}}else"attributes"in e&&e.attributes?.forEach((s=>i.push(V(s,"number"))));const r=t?t(e):"visualVariables"in e?e.visualVariables:null;return r&&r.forEach((s=>i.push(V(s,"number")))),s(i.filter(o),((s,o)=>"field"===s.type&&"field"===o.type?s.field===o.field:"normalized-field"===s.type&&"normalized-field"===o.type?s.field===o.field&&s.normalizationField===o.normalizationField:"expression"===s.type&&"expression"===o.type&&s.expression===o.expression))}function M(s){return"color"===s.type}export{w as calculateDateFormatInterval,U as createClassBreakLabel,x as createColorStops,L as createUniqueValueLabel,b as dateFormatIntervalOptions,j as g,V as getAttribute,F as getAttributes,v as getColorsForRendererValues,g as getColorsFromRenderer,D as setLabelsForClassBreaks,h as timelineDateFormatOptions};
