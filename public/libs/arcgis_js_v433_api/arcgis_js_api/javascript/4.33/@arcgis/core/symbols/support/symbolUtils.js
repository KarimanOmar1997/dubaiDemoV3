/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import"../../core/lang.js";import{p as e,a as t}from"../../chunks/screenUtils.js";import{a as s}from"../../chunks/layerUtils.js";import{l}from"../../layers/support/fieldUtils.js";import{d as r,e as a,c as o,a as i,g as n}from"../../chunks/gfxUtils.js";import{S as c,b as u,g as m,s as p,r as h,c as f,t as y,d as b,e as d,f as k,h as j,i as g,j as S,k as w,l as L}from"../../chunks/renderUtils.js";import{f as v,i as M,h as x,c as C,a as U,b as q,e as T,j as R}from"../../chunks/utils4.js";import{b as H,d as $,e as D,g as V,c as z,a as _,f as P}from"../../chunks/svgUtils.js";import{a as F,c as E}from"../../chunks/widgetUtils.js";import{t as O}from"../../chunks/jsxFactory.js";import{g as I}from"../../chunks/assets.js";import{a as W,t as A}from"../../chunks/colorUtils.js";import B from"../../core/Error.js";import{L as G}from"../../chunks/Logger.js";import{d as X}from"../IconSymbol3DLayer.js";import{d as N}from"../ObjectSymbol3DLayer.js";import{r as Z}from"../../chunks/webStyleSymbolUtils.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../config.js";import"../../chunks/jsonUtils.js";import"../../request.js";import"../../chunks/MapUtils.js";import"../../core/promiseUtils.js";import"../../chunks/handleUtils.js";import"../../chunks/events.js";import"../../chunks/maybe.js";import"../../chunks/persistableUrlUtils.js";import"../../core/Collection.js";import"../../chunks/tslib.es6.js";import"../../chunks/watch.js";import"../../chunks/ObjectPool.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../chunks/SetUtils.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/Lifecycle.js";import"../../chunks/tracking.js";import"../../chunks/SimpleTrackingTarget.js";import"../../core/Evented.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/metadata.js";import"../../chunks/ensureType.js";import"../../chunks/Warning.js";import"../../chunks/ObservableBase.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../layers/catalog/catalogUtils.js";import"../../core/reactiveUtils.js";import"../../core/sql.js";import"../../chunks/guards.js";import"../../chunks/datetime.js";import"../../Color.js";import"../../chunks/colorUtils2.js";import"../../chunks/mathUtils.js";import"../../chunks/LRUCache.js";import"../../chunks/MemCache.js";import"./cimSymbolUtils.js";import"../../chunks/utils3.js";import"../../chunks/defaultCIMValues.js";import"../../chunks/enums2.js";import"../../chunks/projector.js";import"../../chunks/sanitizerUtils.js";import"../../chunks/asyncUtils.js";import"../../chunks/vec3f64.js";import"../../chunks/jsonUtils2.js";import"../../chunks/parser.js";import"../../chunks/utils2.js";import"../../chunks/mat4.js";import"../../chunks/common.js";import"../../chunks/Symbol3DMaterial.js";import"../../core/JSONSupport.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../../chunks/typeUtils.js";import"../CIMSymbol.js";import"../../chunks/enumeration.js";import"../../chunks/jsonMap.js";import"../../chunks/reader.js";import"../../chunks/writer.js";import"../Symbol.js";import"../LabelSymbol3D.js";import"../Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../core/accessorSupport/decorators/cast.js";import"../../portal/Portal.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/pe.js";import"../../geometry/Point.js";import"../../geometry/support/webMercatorUtils.js";import"../../chunks/locale.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../ExtrudeSymbol3DLayer.js";import"../Symbol3DLayer.js";import"../../chunks/utils5.js";import"../edges/Edges3D.js";import"../edges/SketchEdges3D.js";import"../edges/SolidEdges3D.js";import"../FillSymbol3DLayer.js";import"../patterns/LineStylePattern3D.js";import"../patterns/StylePattern3D.js";import"../../chunks/utils6.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/aaBoundingBox.js";import"../../chunks/aaBoundingRect.js";import"../LineSymbol3DLayer.js";import"../LineStyleMarker3D.js";import"../../core/Clonable.js";import"../../chunks/lineMarkers.js";import"../PathSymbol3DLayer.js";import"../TextSymbol3DLayer.js";import"../Font.js";import"../WaterSymbol3DLayer.js";import"./StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../callouts/Callout3D.js";import"../callouts/LineCallout3D.js";import"./Symbol3DVerticalOffset.js";import"../LineSymbol3D.js";import"../MeshSymbol3D.js";import"../PictureFillSymbol.js";import"../FillSymbol.js";import"../SimpleLineSymbol.js";import"../LineSymbol.js";import"../LineSymbolMarker.js";import"../../chunks/urlUtils.js";import"../PictureMarkerSymbol.js";import"../MarkerSymbol.js";import"../PointSymbol3D.js";import"../PolygonSymbol3D.js";import"../SimpleFillSymbol.js";import"../SimpleMarkerSymbol.js";import"../TextSymbol.js";import"../WebStyleSymbol.js";import"../../chunks/mat2df32.js";import"../../chunks/mat2d.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/vec4.js";import"../../chunks/vec4f64.js";import"../../chunks/devEnvironmentUtils.js";import"./jsonUtils.js";import"../../chunks/defaults.js";import"../../chunks/defaultsJSON.js";import"../../chunks/styleUtils.js";const J="esri-relationship-ramp",Q=`${J}--diamond`,Y=`${J}--square`,K={diamondContainer:`${Q}__container`,diamondLeftCol:`${Q}__left-column`,diamondRightCol:`${Q}__right-column`,diamondMidCol:`${Q}__middle-column`,diamondMidColLabel:`${Q}__middle-column--label`,diamondMidColRamp:`${Q}__middle-column--ramp`,squareTable:`${Y}__table`,squareTableRow:`${Y}__table-row`,squareTableCell:`${Y}__table-cell`,squareTableLabel:`${Y}__table-label`,squareTableLabelLeftBottom:`${Y}__table-label--left-bottom`,squareTableLabelRightBottom:`${Y}__table-label--right-bottom`,squareTableLabelLeftTop:`${Y}__table-label--left-top`,squareTableLabelRightTop:`${Y}__table-label--right-top`};function ee(e,t,s={}){const{focus:l,labels:r}=e,a=!!l,o=function(e,t,s={}){const{focus:l,numClasses:r,colors:a,rotation:o}=e,{opacity:i,effectList:n,ariaLabel:c}=s,u=s.size??60,m=!!l,p=Math.sqrt(u**2+u**2)+(m?0:5),h=[],f=[],y=[],b=(u||75)/r;for(let e=0;e<r;e++){const t=e*b;for(let s=0;s<r;s++){const l=s*b,r=H(a[e][s]),o=P(null),i={type:"rect",x:l,y:t,width:b,height:b},n=$(r);n&&h.push(n);const c=D(i,r.fill,o,null);c&&f.push(c),y.push(V(i))}}let d=null;m||(d="margin: -15px -15px -18px -15px");const k=te("left",l,t),j=te("right",l,t),g=z(y),S=_(g,p,p,0,!1,o,!1),w=_(g,p,p,0,!1,m?-45:null,!1),L={filter:v(n)??void 0,opacity:null==i?"":`${i}`};return O("div",{class:m?K.diamondMidColRamp:K.squareTableCell,styles:L},O("svg",{"aria-label":c,focusable:!1,height:p,role:"image",style:d,width:p,xmlns:"http://www.w3.org/2000/svg"},O("defs",null,O("marker",{id:`${t}_arrowStart`,markerHeight:"10",markerUnits:"strokeWidth",markerWidth:"10",orient:"auto",refX:"5",refY:"5"},O("polyline",{fill:"none",points:"0,0 5,5 0,10",stroke:"#555555","stroke-width":"1"})),O("marker",{id:`${t}_arrowEnd`,markerHeight:"10",markerUnits:"strokeWidth",markerWidth:"10",orient:"auto",refX:"0",refY:"5"},O("polyline",{fill:"none",points:"5,0 0,5 5,10",stroke:"#555555","stroke-width":"1"})),h),O("g",{transform:S},f),O("g",{transform:w},O("line",{fill:"none","marker-end":k.markerEnd,"marker-start":k.markerStart,stroke:"#555555","stroke-width":"1",x1:-10,x2:-10,y1:u-15,y2:15}),O("line",{fill:"none","marker-end":j.markerEnd,"marker-start":j.markerStart,stroke:"#555555","stroke-width":"1",x1:15,x2:u-15,y1:u+10,y2:u+10}))))}(e,t,s),i=F(),n=s.key??t;return a?O("div",{class:K.diamondContainer,key:`${n}-container`,styles:{justifyContent:"center"}},O("div",{class:K.diamondLeftCol},i?r.right:r.left),O("div",{class:K.diamondMidCol},O("div",{class:K.diamondMidColLabel},r.top),o,O("div",{class:K.diamondMidColLabel},r.bottom)),O("div",{class:K.diamondRightCol},i?r.left:r.right)):O("div",{class:K.squareTable,key:`${n}-container`},O("div",{class:K.squareTableRow},O("div",{class:E(K.squareTableCell,K.squareTableLabel,K.squareTableLabelRightBottom)},i?r.top:r.left),O("div",{class:K.squareTableCell}),O("div",{class:E(K.squareTableCell,K.squareTableLabel,K.squareTableLabelLeftBottom)},i?r.left:r.top)),O("div",{class:K.squareTableRow},O("div",{class:K.squareTableCell}),o,O("div",{class:K.squareTableCell})),O("div",{class:K.squareTableRow},O("div",{class:E(K.squareTableCell,K.squareTableLabel,K.squareTableLabelRightTop)},i?r.right:r.bottom),O("div",{class:K.squareTableCell}),O("div",{class:E(K.squareTableCell,K.squareTableLabel,K.squareTableLabelLeftTop)},i?r.bottom:r.right)))}function te(e,t,s){const l=`${s}_arrowStart`,r=`${s}_arrowEnd`,a="left"===e,o={markerStart:null,markerEnd:null};switch(t){case"HL":a?o.markerStart=`url(#${r})`:o.markerEnd=`url(#${l})`;break;case"LL":o.markerStart=`url(#${r})`;break;case"LH":a?o.markerEnd=`url(#${l})`:o.markerStart=`url(#${r})`;break;default:o.markerEnd=`url(#${l})`}return o}const se=c.size,le=c.maxSize,re=c.maxOutlineSize,ae=c.lineWidth,oe=c.tallSymbolWidth;function ie(t){const s=t.outline,l=null!=t.material?t.material.color:null,r=null!=l?l.toHex():null;if(null==s||"pattern"in s&&null!=s.pattern&&"style"===s.pattern.type&&"none"===s.pattern.style)return"fill"===t.type&&"#ffffff"===r?{color:"#bdc3c7",width:.75}:null;const o=e(s.size)||0;return{color:"rgba("+(null!=s.color?s.color.toRgba():"255,255,255,1")+")",width:Math.min(o,re),style:"pattern"in s&&null!=s.pattern&&"style"===s.pattern.type?a(s.pattern.style):null,join:"butt",cap:"patternCap"in s?s.patternCap:"butt"}}function ne(e,t=1){const s=e.a,l=W(e),r=l.h,a=l.s/t,o=100-(100-l.v)/t,{r:i,g:n,b:c}=A({h:r,s:a,v:o});return[i,n,c,s]}function ce(e){return"water"===e.type?null==e.color?null:e.color:null==e.material?.color?null:e.material.color}function ue(e,t=0){const s=ce(e);if(!s){if("fill"===e.type)return null;const s=r.r,l=u(s,t);return[l,l,l,100]}const l=s.toRgba();for(let e=0;e<3;e++)l[e]=u(l[e],t);return l}async function me(e,t){const s=e.style;return"none"===s?null:{type:"pattern",x:0,y:0,src:await o(I(`esri/symbols/patterns/${s}.png`),t.toCss(!0)),width:5,height:5}}function pe(e){return e.outline?ie(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function he(e,t){const s=ce(e);if(!s)return null;let l="rgba(";return l+=u(s.r,t)+",",l+=u(s.g,t)+",",l+=u(s.b,t)+",",l+s.a+");"}function fe(t,s){const l=he(t,s);return l?"pattern"in t&&null!=t.pattern&&"style"===t.pattern.type&&"none"===t.pattern.style?null:{color:l,width:Math.min(t.size?e(t.size):.75,re),style:"pattern"in t&&null!=t.pattern&&"style"===t.pattern.type?a(t.pattern.style):null,cap:"cap"in t?t.cap:null,join:"join"in t?"miter"===t.join?e(2):t.join:null}:{}}function ye(e,t,s){const l=null!=s?.75*s:0;return{type:"linear",x1:l?.25*l:0,y1:l?.5*l:0,x2:l||4,y2:l?.5*l:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function be(t){const s="number"==typeof t?.size?t?.size:null;return s?e(s):null}const de=Object.freeze(Object.defineProperty({__proto__:null,getPatternDescriptor:me,getSizeFromOptions:be,getSymbolLayerFill:ue,previewSymbol3D:function(t,s){if(0===t.symbolLayers.length)return Promise.reject(new B("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(t.type){case"point-3d":return async function(t,s){const l=be(s),r=s?.maxSize?e(s.maxSize):null,a=s?.disableUpsampling??!1,o=t.symbolLayers,i=[],n=[];let c=!1,u=0,m=0,p=0;o.forEach((o=>{if("icon"!==o.type&&"object"!==o.type)return;o&&"icon"===o.type&&(p=Math.max(o.size&&e(o.size),p));const h="icon"===o.type?o.size&&e(o.size):0,f=l||h?Math.ceil(Math.min(l||h,r||le)):se;let w="icon"===o.type?o.angle:null;if(null!=s?.rotation&&(w=(w??0)+s.rotation),n.push(w),o?.resource?.href){const e=async function(e,t){if(e.thumbnail?.url)return e.thumbnail.url;if("icon"===t.type){const e=t?.resource?.href;if(e)return x(t)}const s=I("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){const t=await Z(e.styleOrigin,{portal:e.styleOrigin.portal}).catch((()=>null));if(t&&"thumbnail"in t&&t.thumbnail?.url)return t.thumbnail.url}return s}(t,o).then((e=>{const t=o?.material?.color,s=function(e){return"icon"===e.type?"multiply":"tint"}(o);return y(e,f,t,s,a)})).then((e=>{const t=e.width,s=e.height;return u=Math.max(u,t),m=Math.max(m,s),w&&(c=!0),[{shape:{type:"image",x:0,y:0,width:t,height:s,src:e.url},fill:null,stroke:null}]}));i.push(e)}else{let e=f;"icon"===o.type&&l&&(e=f*(h/p));const t="tall"===s?.symbolConfig||s?.symbolConfig?.isTall||"object"===o.type&&function(e){const t=e.depth,s=e.height,l=e.width;return 0!==l&&0!==t&&0!==s&&l===t&&null!=l&&null!=s&&l<s}(o);u=Math.max(u,t?oe:e),m=Math.max(m,e),w&&o.resource?.primitive&&["square","triangle","x"].includes(o.resource?.primitive)&&(c=!0),i.push(Promise.resolve(function(e,t,s){const l=[];if(!e)return l;switch(e.type){case"icon":{const s=0,r=0,a=t,o=t;switch(e.resource?.primitive??X){case"circle":l.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:ue(e,0),stroke:ie(e)});break;case"square":l.push({shape:{type:"path",path:[{command:"M",values:[s,o]},{command:"L",values:[s,r]},{command:"L",values:[a,r]},{command:"L",values:[a,o]},{command:"Z",values:[]}]},fill:ue(e,0),stroke:ie(e)});break;case"triangle":l.push({shape:{type:"path",path:[{command:"M",values:[s,o]},{command:"L",values:[.5*a,r]},{command:"L",values:[a,o]},{command:"Z",values:[]}]},fill:ue(e,0),stroke:ie(e)});break;case"cross":l.push({shape:{type:"path",path:[{command:"M",values:[.5*a,r]},{command:"L",values:[.5*a,o]},{command:"M",values:[s,.5*o]},{command:"L",values:[a,.5*o]}]},stroke:pe(e)});break;case"x":l.push({shape:{type:"path",path:[{command:"M",values:[s,r]},{command:"L",values:[a,o]},{command:"M",values:[a,r]},{command:"L",values:[s,o]}]},stroke:pe(e)});break;case"kite":l.push({shape:{type:"path",path:[{command:"M",values:[s,.5*o]},{command:"L",values:[.5*a,r]},{command:"L",values:[a,.5*o]},{command:"L",values:[.5*a,o]},{command:"Z",values:[]}]},fill:ue(e,0),stroke:ie(e)})}break}case"object":switch(e.resource?.primitive??N){case"cone":{const r=ye(ue(e,0),ue(e,-.6),s?oe:t),a=S(t,s);l.push({shape:a[0],fill:r},{shape:a[1],fill:r});break}case"inverted-cone":{const s=ue(e,0),r=ye(s,ue(e,-.6),t),a=g(t);l.push({shape:a[0],fill:r},{shape:a[1],fill:s});break}case"cube":{const r=j(t,s);l.push({shape:r[0],fill:ue(e,0)},{shape:r[1],fill:ue(e,-.3)},{shape:r[2],fill:ue(e,-.5)});break}case"cylinder":{const r=ye(ue(e,0),ue(e,-.6),s?oe:t),a=k(t,s);l.push({shape:a[0],fill:r},{shape:a[1],fill:r},{shape:a[2],fill:ue(e,0)});break}case"diamond":{const s=d(t);l.push({shape:s[0],fill:ue(e,-.3)},{shape:s[1],fill:ue(e,0)},{shape:s[2],fill:ue(e,-.3)},{shape:s[3],fill:ue(e,-.7)});break}case"sphere":{const s=ye(ue(e,0),ue(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,l.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{const s=b(t);l.push({shape:s[0],fill:ue(e,-.3)},{shape:s[1],fill:ue(e,0)},{shape:s[2],fill:ue(e,-.6)});break}}}return l}(o,e,t)))}}));const f=await Promise.allSettled(i),w=[];return f.forEach((e=>{"fulfilled"===e.status?w.push(e.value):e.reason&&G.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",e.reason)})),h(w,[u,m],{node:s?.node,scale:!1,opacity:s?.opacity,ariaLabel:s?.ariaLabel,rotations:n,useRotationSize:c})}(t,s);case"line-3d":return function(t,s){const l=t.symbolLayers,r=[],a=M(t),o=be(s),i=(s?.maxSize?e(s.maxSize):null)||re;let n,c=0,u=0;return l.forEach(((e,t)=>{if(!e)return;if("line"!==e.type&&"path"!==e.type)return;const s=[];switch(e.type){case"line":{const l=fe(e,0);if(null==l)break;const r=l?.width||0;0===t&&(n=r);const a=Math.min(o||r,i),m=0===t?a:o?a*(r/n):a,p=m>ae/2?2*m:ae;u=Math.max(u,m),c=Math.max(c,p),l.width=m,s.push({shape:{type:"path",path:[{command:"M",values:[0,.5*u]},{command:"L",values:[c,.5*u]}]},stroke:l});break}case"path":{const t=Math.min(o||se,i),l=ue(e,0),r=ue(e,-.2),a=he(e,-.4),n=a?{color:a,width:1}:{};if("quad"===e.profile){const t=e.width,a=e.height,o=f(t&&a?t/a:1,0===a,0===t),i={...n,join:"bevel"};s.push({shape:o[0],fill:r,stroke:i},{shape:o[1],fill:r,stroke:i},{shape:o[2],fill:l,stroke:i})}else s.push({shape:p.pathSymbol3DLayer[0],fill:r,stroke:n},{shape:p.pathSymbol3DLayer[1],fill:l,stroke:n});u=Math.max(u,t),c=u}}r.push(s)})),Promise.resolve(h(r,[c,u],{node:s?.node,scale:a,opacity:s?.opacity,ariaLabel:s?.ariaLabel}))}(t,s);case"polygon-3d":case"mesh-3d":return async function(t,s){const l="mesh-3d"===t.type,r=t.symbolLayers,a=be(s),o=s?.maxSize?e(s.maxSize):null,i=a||se,n=[];let c=0,u=0,f=!1;for(let e=0;e<r.length;e++){const t=r.at(e),s=[];if(!l||"fill"===t.type){switch(t.type){case"fill":{const e=Math.min(i,o||le);if(c=Math.max(c,e),u=Math.max(u,e),f=!0,l){const e=p.meshSymbol3DFill,l=he(t,-.4),r=l?{color:l,width:1,join:"round"}:{};s.push({shape:e[0],fill:ue(t,0),stroke:r},{shape:e[1],fill:ue(t,-.2),stroke:r},{shape:e[2],fill:ue(t,-.6),stroke:r})}else{let e=ue(t,0);const l="pattern"in t?t.pattern:null,r=ie(t),a=ce(t);null!=l&&"style"===l.type&&"solid"!==l.style&&a&&(e=await me(l,a)),s.push({shape:p.fill[0],fill:e,stroke:r})}break}case"line":{const e=fe(t,0);if(null==e)break;const l={stroke:e,shape:p.fill[0]};c=Math.max(c,se),u=Math.max(u,se),s.push(l);break}case"extrude":{const e={join:"round",width:1,...fe(t,-.4)},l=ue(t,0),r=ue(t,-.2),a=Math.min(i,o||le),n=m(a);e.width=1,s.push({shape:n[0],fill:r,stroke:e},{shape:n[1],fill:r,stroke:e},{shape:n[2],fill:l,stroke:e});const p=se,h=.7*se+.5*a;c=Math.max(c,p),u=Math.max(u,h);break}case"water":{const e=ce(t),l=ne(e),r=ne(e,2),a=ne(e,3),n=w();f=!0,s.push({shape:n[0],fill:l},{shape:n[1],fill:r},{shape:n[2],fill:a});const m=Math.min(i,o||le);c=Math.max(c,m),u=Math.max(u,m);break}}n.push(s)}}return h(n,[c,u],{node:s?.node,scale:f,opacity:s?.opacity,ariaLabel:s?.ariaLabel})}(t,s)}return Promise.reject(new B("symbolPreview: swatchInfo3D","symbol not supported."))}},Symbol.toStringTag,{value:"Module"})),ke={HH:315,HL:45,LL:135,LH:225},je={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function ge(e){if(!e)return;const{type:t}=e;if(t.includes("3d"))return ue(e.symbolLayers.at(0));if("simple-line"===t){const t=i(e);return t&&t.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){const t=i(e);return t&&t.color}return n(e)}function Se(e){const{focus:t,infos:s,numClasses:l}=e,r=je[l],a={};s.forEach((e=>{a[e.value]={label:e.label,fill:ge(e.symbol)}}));const o=[];for(let e=0;e<l;e++){const t=[];for(let s=0;s<l;s++){const l=a[r[e][s]];t.push(l.fill)}o.push(t)}const i=function(e,t){const s=t.HH.label,l=t.LL.label,r=t.HL.label,a=t.LH.label;switch(e){case"HH":default:return{top:s,bottom:l,left:r,right:a};case"HL":return{top:r,bottom:a,left:l,right:s};case"LL":return{top:l,bottom:s,left:a,right:r};case"LH":return{top:a,bottom:r,left:s,right:l}}}(t,a);return{type:"relationship-ramp",numClasses:l,focus:t,colors:o,labels:i,rotation:we(t)}}function we(e){let t=ke[e];return e&&null==t&&(t=ke.HH),t||0}let Le=null;const ve=[255,255,255];function Me(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function xe(e,t,s){const{backgroundColor:l,outline:r,dotSize:a}=e,o=s?.swatchSize||c.size,i=Math.round(o*o/Math.max(a,.5)**2*.8),n=window.devicePixelRatio,u=document.createElement("canvas"),m=o*n;u.width=m,u.height=m,u.style.width=u.width/n+"px",u.style.height=u.height/n+"px";const p=u.getContext("2d");if(l&&(p.fillStyle=l.toCss(!0),p.fillRect(0,0,m,m),p.fill()),p.fillStyle=t?.toCss(!0)??"",Le&&Le.length/2===i)for(let e=0;e<2*i;e+=2){const t=Le[e],s=Le[e+1];p.fillRect(t,s,a*n,a*n),p.fill()}else{Le=[];for(let e=0;e<2*i;e+=2){const e=Me(0,m),t=Me(0,m);Le.push(e,t),p.fillRect(e,t,a*n,a*n),p.fill()}}r&&(r.color&&(p.strokeStyle=r.color.toCss(!0)),p.lineWidth=r.width,p.strokeRect(0,0,m,m));const h=new Image(o,o);return h.src=u.toDataURL(),h.ariaLabel=s?.ariaLabel??null,h.alt=s?.ariaLabel??"",h}function Ce(e,t={}){const s=t.radius||40,l=2*Math.PI*s,r=e.length,a=l/r,o=[],n=i(t.outline);null!=n?.width&&(n.width*=2),(n||t.backgroundColor)&&o.push({shape:{type:"circle",cx:s,cy:s,r:s},fill:t.backgroundColor,stroke:n,offset:[0,0]});const c=t.values,u=c&&c.length===r&&100===c.reduce(((e,t)=>e+t),0),m=[0];for(let t=0;t<r;t++){let r=null;u&&(r=c[t]*l/100,m.push(r+m[t])),o.push({shape:{type:"circle",cx:s,cy:s,r:s/2},fill:[0,0,0,0],stroke:{width:s,dashArray:`${(r??a)/2} ${l}`,dashoffset:"-"+(u?m[t]/2:t*(a/2)),color:e[t]},offset:[0,0]})}let p=null;const f=2*s+(n?.width||0),y=t.holePercentage;if(y){n&&o.push({shape:{type:"circle",cx:s,cy:s,r:s*y},fill:null,stroke:n,offset:[0,0]});const e=f/2;p=[[{shape:{type:"circle",cx:e,cy:e,r:e},fill:ve,stroke:n?{...n,color:ve}:null,offset:[0,0]},{shape:{type:"circle",cx:e,cy:e,r:s*y},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return h([o],[f,f],{effectView:t.effectList,ignoreStrokeWidth:!0,masking:p,rotations:[-90],ariaLabel:t.ariaLabel})}function Ue(e,t={}){const s=e?.authoringInfo;if("relationship"!==s?.type||!s?.numClasses||!e.uniqueValueInfos)return null;const{focus:l,numClasses:r}=s,a=Se({focus:l,numClasses:r,infos:e.uniqueValueInfos}),o=t?.node||document.createElement("div");return L(o,(()=>ee(a,t.id||"relationship",{opacity:t.opacity||1,effectList:t.effectList,ariaLabel:t.ariaLabel}))),o}function qe(e,t={}){const s="horizontal"===t.align,l=s?75:24,r=s?24:75,a=t.width??l,o=t.height??r,i=t.gradient??!0,n=window.devicePixelRatio,c=a*n,u=o*n,m=document.createElement("canvas");m.width=c,m.height=u,m.ariaLabel=t.ariaLabel??null,m.style.width=`${a}px`,m.style.height=`${o}px`;const p=m.getContext("2d"),h=s?c:0,f=s?0:u;if(i){const t=p.createLinearGradient(0,0,h,f),s=e.length,l=1===s?0:1/(s-1);e.forEach(((e,s)=>t.addColorStop(s*l,e.toString()))),p.fillStyle=t,p.fillRect(0,0,c,u)}else{const t=s?c/e.length:c,l=s?u:u/e.length;let r=0,a=0;for(const o of e)p.fillStyle=o.toString(),p.fillRect(r,a,t,l),r=s?r+t:0,a=s?0:a+l}const y=document.createElement("div");return y.style.width=`${a}px`,y.style.height=`${o}px`,function(e,t){if(!t)return;e.style.filter=v(t);const s=t.effects;if(s)for(const t of s)if("drop-shadow"===t?.type){t.offsetX<0?e.style.marginLeft=`${Math.abs(t.offsetX)}px`:e.style.marginRight=`${t.offsetX}px`;break}}(y,t?.effectList),y.appendChild(m),y}async function Te(e,t){switch(e.type){case"web-style":{const{previewWebStyleSymbol:s}=await import("../../chunks/previewWebStyleSymbol.js");return s(e,Te,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:s}=await Promise.resolve().then((()=>de));return s(e,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:s}=await import("../../chunks/previewSymbol2D.js");return s(e,t)}case"cim":{const{previewCIMSymbol:s}=await import("../../chunks/previewCIMSymbol.js");return s(e,t)}default:return}}function Re(e){return e&&"opacity"in e?e.opacity*Re(e.parent):1}async function He(e,t){if(!e)return;const s=e.sourceLayer,r=(null!=t&&t.useSourceLayer?s:e.layer)??s,a=t?.ignoreOpacity?1:Re(r);if(null!=e.symbol&&(null==t||!0!==t.ignoreGraphicSymbol)){const s="web-style"===e.symbol.type?await e.symbol.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats,cache:t?.webStyleCache}):e.symbol.clone();return C(s,null,a),s}const o=t?.renderer??De(r);let i=o&&"getSymbolAsync"in o?await o.getSymbolAsync(e,t):null;if(!i)return;if(i="web-style"===i.type?await i.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats,cache:t?.webStyleCache}):i.clone(),!o||!("visualVariables"in o)||!o.visualVariables?.length)return C(i,null,a),i;if("arcadeRequiredForVisualVariables"in o&&o.arcadeRequiredForVisualVariables&&null==t?.arcade){const e={...t};e.arcade=await l(),t=e}const{getColor:n,getOpacity:c,getAllSizes:u,getRotationAngle:m}=await import("../../chunks/visualVariableUtils.js").then((e=>e.l)),p=[],h=[],f=[],y=[];for(const e of o.visualVariables)switch(e.type){case"color":p.push(e);break;case"opacity":h.push(e);break;case"rotation":y.push(e);break;case"size":e.target||f.push(e)}const b=!!p.length&&p[p.length-1],d=b?n(b,e,t):null,k=!!h.length&&h[h.length-1];let j=k?c(k,e,t):null;if(null!=a&&(j=null!=j?j*a:a),t?.ignoreOpacity&&(j=1),null!=d&&k&&null!=j&&(d.a=1),C(i,d,j),f.length&&!0!==t?.ignoreSizeVariables){const s=u(f,e,t);await U(i,s)}if(!0!==t?.ignoreRotationVariables)for(const s of y)q(i,m(s,e,t),s.axis);return i}async function $e(e,t){if(!e)return;const{layer:s,sourceLayer:r}=e,a=Re(s??r);if(null!=e.symbol&&(null==t||!0!==t.ignoreGraphicSymbol)){const s="web-style"===e.symbol.type?await e.symbol.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats}):e.symbol.clone();return T(s,a)}const o=t?.renderer??De(s)??De(r);let i=o&&"getSymbolAsync"in o?await o.getSymbolAsync(e,t):void 0;if(!i)return;i="web-style"===i.type?await i.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats}):i.clone();const n=T(i,a);if(!o||!("visualVariables"in o)||"visualVariables"in o&&!o.visualVariables||"visualVariables"in o&&!o.visualVariables?.length)return n;if("arcadeRequiredForVisualVariables"in o&&o.arcadeRequiredForVisualVariables&&null==t?.arcade){const e={...t};e.arcade=await l(),t=e}const{getColor:c,getOpacity:u}=await import("../../chunks/visualVariableUtils.js").then((e=>e.l)),m=[],p=[];if(o.visualVariables)for(const e of o.visualVariables)switch(e.type){case"color":m.push(e);break;case"opacity":p.push(e)}const h=m.length>0?m[m.length-1]:null,f=h?c(h,e,t):n,y=p.length>0?p[p.length-1]:null;let b=y?u(y,e,t):null;return null!=a&&(b=null!=b?b*a:a),f?R(f,b):null}function De(e){if(e)return"renderer"in e?e.renderer:void 0}async function Ve(e,t,s){if(!e)return;const{layer:l,sourceLayer:r}=e,a=s?.renderer??De(l)??De(r);if(!a)return null;if("visualVariables"in a&&a.visualVariables?.length){const{getRampStops:r}=await import("../../chunks/colorRampUtils2.js"),{getRampStops:o}=await import("../../chunks/sizeRampUtils.js"),{getDateFormatOptions:i}=await import("../../chunks/utils17.js");let n=null;for(const c of a.visualVariables){const u=t?i(l,c,t.timeZone):null;let m=null;switch(c.type){case"color":m=await r(c,null,u);break;case"opacity":m=await r(c);break;case"size":c.target||(m=await o(a,c,null,s?.scale||t?.scale,t,u))}if(m?.length){const t=m.find(((t,s)=>{const l=e.attributes[c.field];return 0===s?l>=t.value:s===m?.length-1?l<=t.value:t.value===l}));if(t){n=t.label;break}}}if(n)return n}switch(a.type){case"class-breaks":{const t="getClassBreakInfo"in a?await a.getClassBreakInfo(e,s):null;return t?.label??(t&&a.classBreakInfos?.length>1)?`${t.minValue} - ${t.maxValue}`:null}case"unique-value":{const t="getUniqueValueInfo"in a?await a.getUniqueValueInfo(e,s):null;return t?.label}}return null}async function ze(e,l){e?.layer&&s(e.layer)&&((e=e.cloneShallow()).layer=e.layer.findSublayerForFeature(e)??null);const r=null===e?l?.fallbackSymbol??null:await He(e,{ignoreGraphicSymbol:!!e.layer,ignoreOpacity:l?.ignoreOpacity??!0,ignoreRotationVariables:l?.ignoreRotationVariables??!0,ignoreSizeVariables:l?.ignoreSizeVariables??!0})??l?.fallbackSymbol??null;if(!r)return null;const a=await Te(r,{geometry:l.useGeometryForShape?e?.geometry??null:null,useMarkerSymbolSize:!1!==l.useMarkerSymbolSize,size:{width:t(l.widthInPixels??16),height:t(l.heightInPixels??16)},..."cim"===r?.type?{cimOptions:{feature:{attributes:e?.attributes??{}}}}:{}});return a?"element"===(l?.format??"element")?a:a.outerHTML:null}export{Se as a,we as g,$e as getDisplayedColor,He as getDisplayedSymbol,Ve as getLegendLabel,ze as previewGraphic,ee as r,qe as renderColorRampPreviewHTML,xe as renderDotDensityPreviewHTML,Ce as renderPieChartPreviewHTML,Te as renderPreviewHTML,Ue as renderRelationshipRampPreviewHTML};
