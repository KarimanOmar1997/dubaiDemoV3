/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import e from"../../../core/Accessor.js";import{d as i,h as n,m as s}from"../../../chunks/handleUtils.js";import{equals as o}from"../../../core/lang.js";import{L as r}from"../../../chunks/Logger.js";import{m as a}from"../../../chunks/mapCollectionUtils.js";import{c as l,d as p,r as c,a as m}from"../../../chunks/maybe.js";import{property as u}from"../../../core/accessorSupport/decorators/property.js";import{subclass as d}from"../../../core/accessorSupport/decorators/subclass.js";import{A as h,a as g,c as f,r as y,s as j}from"../../../chunks/analysisViewUtils.js";import v,{L as S,l as _}from"../../../analysis/LengthDimension.js";import{watch as k,syncAndInitial as M,initial as b,sync as w,when as P}from"../../../core/reactiveUtils.js";import{ab as C,aa as D,c as O}from"../../../chunks/unitUtils.js";import{g as T}from"../../../chunks/getDefaultUnitForView.js";import{e as x,r as A}from"../../../chunks/mathUtils.js";import{t as R}from"../../../chunks/quantityUtils.js";import{a as H}from"../../../chunks/ensureType.js";import{d as U,k as z,s as L,j as V}from"../../../chunks/mat4.js";import{c as E}from"../../../chunks/mat4f64.js";import{c as I,t as G,a as F,f as B,d as N,A as q,n as W,b as Q,C as Z,v as $,j as Y,e as J,l as X,s as K,k as tt}from"../../../chunks/vec3.js";import{c as et,Z as it,f as nt}from"../../../chunks/vec3f64.js";import st from"../../../geometry/Point.js";import{A as ot}from"../../../chunks/Axis.js";import{a as rt}from"../../../chunks/vector.js";import{m as at}from"../../../chunks/dehydratedPoint.js";import{c as lt}from"../../../chunks/hydratedFeatures.js";import{E as pt,L as ct}from"../../../chunks/Segment.js";import{g as mt,h as ut}from"../../../chunks/geodesicLengthMeasurementUtils.js";import{g as dt}from"../../../chunks/geodesicMeasurementUtils.js";import{ignoreAbortErrors as ht,c as gt}from"../../../core/promiseUtils.js";import ft from"../../../Color.js";import{c as yt}from"../../../chunks/Cyclical.js";import{p as jt}from"../../../chunks/screenUtils.js";import{c as vt,Z as St}from"../../../chunks/vec4f64.js";import{f as _t,c as kt,o as Mt,g as bt}from"../../../chunks/plane.js";import{m as wt,f as Pt}from"../../../chunks/colorUtils.js";import{M as Ct,d as Dt,R as Ot,w as Tt,b as xt,r as At,c as Rt,L as Ht,O as Ut,a as zt,l as Lt}from"../../../chunks/RenderObject.js";import{h as Vt,c as Et,s as It}from"../../../chunks/dragEventPipeline3D.js";import{R as Gt,g as Ft,b as Bt}from"../../../chunks/RibbonLineMaterial.js";import{A as Nt}from"../../../chunks/orientedBoundingBox.js";import{G as qt}from"../../../chunks/Matrix4PassUniform.js";import{f as Wt,c as Qt}from"../../../chunks/GeometryUtil.js";import{R as Zt}from"../../../chunks/Material.js";import{V as $t}from"../../../chunks/VertexAttribute.js";import{c as Yt,g as Jt,E as Xt}from"../../../chunks/dragEventPipeline.js";import{M as Kt,a as te}from"../../../chunks/interfaces2.js";import ee from"../../../core/Handles.js";import{m as ie}from"../../../chunks/memoize.js";import{U as ne}from"../../../chunks/UpdatingHandles.js";import{g as se}from"../../../chunks/Factory.js";import{S as oe}from"../../../chunks/SnappingVisualizer3D.js";import{V as re}from"../../../chunks/VerticesVisualElement.js";import{I as ae}from"../../../chunks/ImageMaterial.js";import{c as le}from"../../../chunks/lineStippleUtils.js";import{E as pe,a as ce,c as me}from"../../../chunks/EditGeometryOperations.js";import{S as ue}from"../../../chunks/SnappingContext.js";import{c as de}from"../../../chunks/SnappingDragPipelineStep.js";import{a as he}from"../../../chunks/SnappingManagerPool.js";import{S as ge}from"../../../chunks/SnappingOperation.js";import{a as fe}from"../../../chunks/constraints.js";import{s as ye}from"../../../chunks/keybindings.js";import{n as je}from"../../../chunks/ToolIntersector.js";import{b as ve}from"../../../chunks/screenUtils2.js";import"../../../intl.js";import{c as Se}from"../../../chunks/quantityFormatUtils.js";import{f as _e,c as ke}from"../../../chunks/vec4f32.js";import{l as Me,c as be}from"../../../chunks/line.js";import{L as we}from"../../../chunks/LineMarkerMaterial.js";import{o as Pe}from"../../../chunks/locale.js";import{f as Ce}from"../../../chunks/messages.js";import De from"../../analysis/LengthDimensionResult.js";import{l as Oe}from"../../../chunks/automaticLengthMeasurementUtils.js";import"../../../chunks/get.js";import"../../../chunks/utils.js";import"../../../chunks/Lifecycle.js";import"../../../chunks/metadata.js";import"../../../chunks/ObjectPool.js";import"../../../chunks/ObservableBase.js";import"../../../chunks/tracking.js";import"../../../chunks/watch.js";import"../../../core/scheduling.js";import"../../../chunks/nextTick.js";import"../../../chunks/PooledArray.js";import"../../../core/Error.js";import"../../../config.js";import"../../../chunks/events.js";import"../../../chunks/SetUtils.js";import"../../../chunks/SimpleTrackingTarget.js";import"../../../chunks/MapUtils.js";import"../../../chunks/Warning.js";import"../../../chunks/asyncUtils.js";import"../../../core/Collection.js";import"../../../core/Evented.js";import"../../../chunks/shared.js";import"../../../chunks/SimpleObservable.js";import"../../../chunks/jsonUtils.js";import"../../../core/Promise.js";import"../../../chunks/InteractiveToolBase.js";import"../../../core/Clonable.js";import"../../../core/JSONSupport.js";import"../../../core/accessorSupport/decorators/cast.js";import"../../../chunks/reader.js";import"../../../chunks/writer.js";import"../../../geometry/Geometry.js";import"../../../geometry/SpatialReference.js";import"../../../chunks/jsonMap.js";import"../../../chunks/pe.js";import"../../../chunks/assets.js";import"../../../request.js";import"../../../kernel.js";import"../../../core/urlUtils.js";import"../../../chunks/persistableUrlUtils.js";import"../../../geometry/support/webMercatorUtils.js";import"../../../portal/Portal.js";import"../../../core/Loadable.js";import"../../../geometry/Extent.js";import"../../../portal/PortalGroup.js";import"../../../portal/PortalQueryParams.js";import"../../../portal/PortalQueryResult.js";import"../../../portal/PortalUser.js";import"../../../portal/PortalFolder.js";import"../../../chunks/common.js";import"../../../chunks/mat3f64.js";import"../../../chunks/quatf64.js";import"../../../chunks/vec2f64.js";import"../../../Graphic.js";import"../../../PopupTemplate.js";import"../../../layers/support/fieldUtils.js";import"../../../core/sql.js";import"../../../chunks/guards.js";import"../../../chunks/datetime.js";import"../../../popup/content.js";import"../../../popup/content/AttachmentsContent.js";import"../../../popup/content/Content.js";import"../../../popup/support/AttachmentsOrderByInfo.js";import"../../../popup/content/CustomContent.js";import"../../../popup/content/ExpressionContent.js";import"../../../popup/ElementExpressionInfo.js";import"../../../popup/content/FieldsContent.js";import"../../../popup/FieldInfo.js";import"../../../chunks/enumeration.js";import"../../../popup/support/FieldInfoFormat.js";import"../../../chunks/date.js";import"../../../chunks/constants.js";import"../../../popup/content/MediaContent.js";import"../../../popup/content/BarChartMediaInfo.js";import"../../../popup/content/mixins/ChartMediaInfo.js";import"../../../popup/content/mixins/MediaInfo.js";import"../../../popup/content/support/ChartMediaInfoValue.js";import"../../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../../chunks/colorUtils2.js";import"../../../chunks/chartMediaInfoUtils.js";import"../../../popup/content/ColumnChartMediaInfo.js";import"../../../popup/content/ImageMediaInfo.js";import"../../../popup/content/support/ImageMediaInfoValue.js";import"../../../popup/content/LineChartMediaInfo.js";import"../../../popup/content/PieChartMediaInfo.js";import"../../../popup/content/RelationshipContent.js";import"../../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../../popup/content/TextContent.js";import"../../../popup/content/UtilityNetworkAssociationsContent.js";import"../../../popup/support/UtilityNetworkAssociationType.js";import"../../../popup/ExpressionInfo.js";import"../../../popup/LayerOptions.js";import"../../../popup/RelatedRecordsInfo.js";import"../../../support/actions/ActionBase.js";import"../../../core/Identifiable.js";import"../../../support/actions/ActionButton.js";import"../../../support/actions/ActionToggle.js";import"../../../geometry/support/jsonUtils.js";import"../../../geometry/Multipoint.js";import"../../../chunks/zmUtils.js";import"../../../geometry/Polygon.js";import"../../../chunks/coordsUtils.js";import"../../../chunks/extentUtils.js";import"../../../chunks/boundsUtils.js";import"../../../chunks/aaBoundingRect.js";import"../../../geometry/Polyline.js";import"../../../chunks/typeUtils2.js";import"../../../chunks/createFeatureId.js";import"../../../chunks/typeUtils.js";import"../../../symbols/CIMSymbol.js";import"../../../symbols/Symbol.js";import"../../../symbols/LabelSymbol3D.js";import"../../../symbols/Symbol3D.js";import"../../../chunks/collectionUtils.js";import"../../../symbols/ExtrudeSymbol3DLayer.js";import"../../../symbols/Symbol3DLayer.js";import"../../../chunks/utils5.js";import"../../../symbols/edges/Edges3D.js";import"../../../chunks/materialUtils.js";import"../../../chunks/opacityUtils.js";import"../../../symbols/edges/SketchEdges3D.js";import"../../../symbols/edges/SolidEdges3D.js";import"../../../chunks/Symbol3DMaterial.js";import"../../../symbols/FillSymbol3DLayer.js";import"../../../symbols/patterns/LineStylePattern3D.js";import"../../../symbols/patterns/StylePattern3D.js";import"../../../chunks/utils6.js";import"../../../chunks/colors.js";import"../../../chunks/symbolLayerUtils3D.js";import"../../../chunks/aaBoundingBox.js";import"../../../symbols/IconSymbol3DLayer.js";import"../../../symbols/LineSymbol3DLayer.js";import"../../../symbols/LineStyleMarker3D.js";import"../../../chunks/lineMarkers.js";import"../../../symbols/ObjectSymbol3DLayer.js";import"../../../symbols/PathSymbol3DLayer.js";import"../../../symbols/TextSymbol3DLayer.js";import"../../../symbols/Font.js";import"../../../symbols/WaterSymbol3DLayer.js";import"../../../symbols/support/StyleOrigin.js";import"../../../chunks/Thumbnail.js";import"../../../chunks/calloutUtils.js";import"../../../symbols/callouts/Callout3D.js";import"../../../symbols/callouts/LineCallout3D.js";import"../../../symbols/support/Symbol3DVerticalOffset.js";import"../../../symbols/LineSymbol3D.js";import"../../../symbols/MeshSymbol3D.js";import"../../../symbols/PictureFillSymbol.js";import"../../../symbols/FillSymbol.js";import"../../../symbols/SimpleLineSymbol.js";import"../../../symbols/LineSymbol.js";import"../../../symbols/LineSymbolMarker.js";import"../../../chunks/urlUtils.js";import"../../../symbols/PictureMarkerSymbol.js";import"../../../symbols/MarkerSymbol.js";import"../../../symbols/PointSymbol3D.js";import"../../../symbols/PolygonSymbol3D.js";import"../../../symbols/SimpleFillSymbol.js";import"../../../symbols/SimpleMarkerSymbol.js";import"../../../symbols/TextSymbol.js";import"../../../symbols/WebStyleSymbol.js";import"../../../chunks/vec2.js";import"../../../chunks/SnappingManager.js";import"../../../chunks/projectionUtils.js";import"../../../chunks/projectBuffer.js";import"../../../chunks/geodesicConstants.js";import"../../../chunks/projectXYZToVector.js";import"../../../geometry/support/GeographicTransformation.js";import"../../../geometry/support/GeographicTransformationStep.js";import"../../../chunks/zscale.js";import"../../../chunks/elevationInfoUtils.js";import"../../../chunks/unitConversionUtils.js";import"../../../chunks/lengthUtils.js";import"../../../chunks/normalizedPoint.js";import"../../../chunks/Settings.js";import"../../../chunks/RightAngleSnappingHint.js";import"../../interactive/snapping/SnappingOptions.js";import"../../interactive/snapping/FeatureSnappingLayerSource.js";import"../../../chunks/VisualElement.js";import"../../../chunks/projector.js";import"../../../chunks/sanitizerUtils.js";import"../../../chunks/TextOverlayItem.js";import"../../../chunks/spatialReferenceEllipsoidUtils.js";import"../../../chunks/projectVectorToVector.js";import"../../../chunks/projectPointToVector.js";import"../../../chunks/mathUtils2.js";import"../../../geometry/operators/geodeticLengthOperator.js";import"../../../chunks/geodeticCurveType.js";import"../../../geometry/support/geodesicUtils.js";import"../../../chunks/vec4.js";import"../../../chunks/Intersector2.js";import"../../../chunks/dehydratedFeatureUtils.js";import"../../../chunks/ray.js";import"../../../chunks/mat3.js";import"../../../chunks/ViewingMode.js";import"../webgl/RenderCamera.js";import"../../../chunks/frustum.js";import"../../../chunks/HUDIntersectorResult.js";import"../../../chunks/IntersectorResult.js";import"../../../chunks/verticalOffsetUtils.js";import"../../../chunks/sphere.js";import"../../../chunks/computeTranslationToOriginAndRotation.js";import"../../../chunks/lineSegment.js";import"../../../chunks/ray2.js";import"../../../chunks/graphicUtils.js";import"../../../chunks/meshVertexSpaceUtils.js";import"../../../geometry/support/MeshGeoreferencedVertexSpace.js";import"../../../geometry/support/MeshLocalVertexSpace.js";import"../../../chunks/basicInterfaces.js";import"../../../chunks/ColorMaterial.js";import"../../../chunks/InterleavedLayout.js";import"../../../chunks/BufferView.js";import"../../../chunks/types.js";import"../../../chunks/ShaderOutput.js";import"../../../chunks/Matrix4BindUniform.js";import"../../../chunks/BindType.js";import"../../../chunks/VertexColor.glsl.js";import"../../../chunks/Matrix3DrawUniform.js";import"../../../chunks/glsl.js";import"../../../chunks/ShaderTechniqueConfiguration.js";import"../../../chunks/TriangleMaterial.js";import"../../../chunks/ShaderBuilder.js";import"../../../chunks/renderState.js";import"../../../chunks/enums.js";import"../../../chunks/AlphaCutoff.js";import"../../../chunks/Octree.js";import"../../../chunks/Float4DrawUniform.js";import"../../../chunks/floatRGBA.js";import"../../../chunks/Texture.js";import"../../../chunks/FBOAttachmentType.js";import"../../../chunks/getDataTypeBytes.js";import"../../../chunks/quat.js";import"../../../chunks/Indices.js";import"../../../chunks/triangle.js";import"../../../chunks/debugFlags2.js";import"../../../chunks/videoUtils.js";import"../../../chunks/requestImageUtils.js";import"../../../chunks/TextureFormat.js";import"../../../chunks/vec3f32.js";import"../../../chunks/boundedPlane.js";import"../../../chunks/ExtendedLineVisualElement.js";import"../../../chunks/EngineVisualElement.js";import"../../../chunks/GridLocalOriginFactory.js";import"../../../chunks/RenderGeometry.js";import"../../../chunks/SceneLighting.js";import"../../../chunks/signal.js";import"../../../chunks/axisAngleDegrees.js";import"../../../chunks/weather.js";import"../environment/CloudyWeather.js";import"../environment/FoggyWeather.js";import"../environment/RainyWeather.js";import"../environment/SnowyWeather.js";import"../environment/SunnyWeather.js";import"../../../chunks/BooleanBindUniform.js";import"../webgl.js";import"../webgl/RenderNode.js";import"../../../chunks/HighlightDefaults.js";import"../../../chunks/VertexElementDescriptor.js";import"../../../chunks/VertexArrayObject2.js";import"../../../chunks/VertexArrayObject.js";import"../../../chunks/memoryEstimations.js";import"../../../chunks/NestedMap.js";import"../../../chunks/HUDRenderStyle.js";import"../../../chunks/Scheduler.js";import"../../../chunks/debugFlags.js";import"../../../chunks/LaserlineVisualElement.js";import"../../../chunks/BlendColorsPremultiplied.glsl.js";import"../../../chunks/glUtil.js";import"../../../chunks/PointVisualElement.js";import"../../../chunks/ElevationContext.js";import"../../../chunks/HUDMaterial.js";import"../../../chunks/HUDVisibility.glsl.js";import"../../../chunks/VerticalOffset.glsl.js";import"../../../chunks/SnappingVisualizer.js";import"../../../chunks/PointSnappingHint.js";import"../../../chunks/ITexture.js";import"../../../chunks/DefaultLayouts.js";import"../../../chunks/geometry2dUtils.js";import"../../../chunks/dehydratedFeatureComparison.js";import"../../../chunks/timeUtils.js";import"../../../rest/support/Query.js";import"../../../chunks/DataLayerSource.js";import"../../../layers/support/Field.js";import"../../../chunks/domains.js";import"../../../layers/support/CodedValueDomain.js";import"../../../layers/support/Domain.js";import"../../../layers/support/InheritedDomain.js";import"../../../layers/support/RangeDomain.js";import"../../../chunks/fieldType.js";import"../../../chunks/FullTextSearch.js";import"../../../chunks/spatialRelationships.js";import"../../../rest/support/StatisticDefinition.js";import"../../../time/TimeExtent.js";import"../../../chunks/InputManager.js";import"../../../chunks/Queue.js";import"../../../chunks/utils8.js";import"../../../chunks/Version2.js";import"../../../chunks/Version.js";import"../../../chunks/number2.js";import"../../../chunks/substitute.js";import"../../../chunks/unitFormatUtils.js";import"../../../chunks/ByteSizeUnit.js";class Te{constructor(t,e,i,n,s,o){this.elevationAlignedStartPoint=t,this.elevationAlignedEndPoint=e,this.directSegment=i,this.dimensionSegment=n,this.primaryOffsetAxis=s,this.spatialReference=o}}const xe=H(st);function Ae(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i,dimension:{offset:n,measureType:s,orientation:o}}=t;return{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i,offset:n,measureType:s,orientation:o}}function Re({elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,offset:i,measureType:n,orientation:s},o,r=null){if(null==t||null==e)return null;const a=Le(r?.directSegment??new pt,{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e},o),l=r?.primaryOffsetAxis??et();Ie(l,{measureType:n,elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,directSegment:a,orientation:s,renderCoordsHelper:o});const p=r?.dimensionSegment??new pt;return Fe({elevationAlignedStartPoint:t,elevationAlignedEndPoint:e})&&n===S.Vertical?(I(p.startRenderSpace,a.startRenderSpace),I(p.endRenderSpace,a.endRenderSpace)):Be(p,l,i,a,o),new Te(t,e,a,p,l,o.spatialReference)}function He(t,e,i,n){return e===Ue.Start?(I(t.startRenderSpace,i.startRenderSpace),I(t.endRenderSpace,n.startRenderSpace)):(I(t.startRenderSpace,i.endRenderSpace),I(t.endRenderSpace,n.endRenderSpace)),t}var Ue;function ze(t,e,i,n){switch(e){case S.Direct:return Le(t,i,n);case S.Horizontal:case S.Vertical:{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,dimension:r,geometry:a}=i;let l;if(r.measureType===S.Direct){const t=function(t,e){const i=t.directSegment.eval(.5,rt.get()),n=e.worldUpAtPosition(i,rt.get()),s=t.dimensionSegment.eval(.5,rt.get()),o=F(rt.get(),s,i);return!q(o,it)&&N(o,n)>0}(a,n);l=t===s.z>o.z,e===S.Horizontal&&(l=!l)}else l=!function(t){const{startRenderSpace:e,endRenderSpace:i}=t.dimensionSegment,{startRenderSpace:n,endRenderSpace:s}=t.directSegment;return Z(n,e)<Z(s,i)}(a);const[p,c]=l?[s,o]:[o,s],m=lt(c,Ve);return e===S.Horizontal?m.z=p.z:(m.x=p.x,m.y=p.y),n.toRenderCoords(p,t.startRenderSpace),n.toRenderCoords(m,t.endRenderSpace),t}}}function Le(t,e,i){return i.toRenderCoords(e.elevationAlignedStartPoint,t.startRenderSpace),i.toRenderCoords(e.elevationAlignedEndPoint,t.endRenderSpace),t}!function(t){t[t.Start=0]="Start",t[t.End=1]="End"}(Ue||(Ue={}));const Ve=at(0,0,0,null),Ee=new pt;function Ie(t,e){const{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:s,directSegment:{startRenderSpace:o,endRenderSpace:r},directSegment:a,renderCoordsHelper:l}=e,p=a.eval(.5,rt.get()),c=l.worldUpAtPosition(p,rt.get()),m=l.worldBasisAtPosition(p,ot.Y,rt.get());switch(i){case S.Horizontal:I(t,c);break;case S.Vertical:N(o,c)<N(r,c)?F(t,r,o):F(t,o,r),B(t,t,c),B(t,t,c);break;case S.Direct:{const i=e.orientation??0;if(Fe({elevationAlignedStartPoint:n,elevationAlignedEndPoint:s}))U(Ge,-x(i),c),G(t,m,Ge);else{const e=F(rt.get(),r,o),n=B(rt.get(),e,c);B(n,n,e),U(Ge,x(i),e),G(t,n,Ge)}break}}return q(t,it)?I(t,m):W(t,t)}const Ge=E();function Fe({elevationAlignedStartPoint:t,elevationAlignedEndPoint:e}){return null!=t&&null!=e&&t.x===e.x&&t.y===e.y}function Be(t,e,i,n,s){const{startRenderSpace:o,endRenderSpace:r}=n,a=i/s.unitInMeters,[l,p]=function(t,e,i,n=0){const s=N(e,i),o=N(t,i),r=Math.abs(s-o)+n;return s>o?[r,n]:[n,r]}(o,r,e,a);return Q(t.startRenderSpace,n.startRenderSpace,e,l),Q(t.endRenderSpace,n.endRenderSpace,e,p),t}function Ne(t,e,i){const n=e.directSegment.eval(.5,rt.get());return i.worldUpAtPosition(n,t)}function qe(t,e){const{startRenderSpace:i,endRenderSpace:n}=e.directSegment;return F(t,n,i)}function We(t,e,i={invert:!1}){const{startRenderSpace:n,endRenderSpace:s}=e.dimensionSegment;return i.invert?F(t,n,s):F(t,s,n)}function Qe(t,e){const i=t.directSegment.eval(.5,rt.get());return e.headingAtPosition(i,t.primaryOffsetAxis)}const Ze=et();function $e(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i}=t;if(null==e||null==i)return!1;const n=mt(e,i);return null!=n&&R(n,"meters").value>dt}function Ye(t){return null!=t.geometry}let Je=class extends e{constructor(t){super(t)}initialize(){const t=a((()=>this.analysisViewData.computations),(({computation:t})=>this._watchComputation(t)));this.addHandles(i(t))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return T(this.view)}_watchComputation(t){return k((()=>Ae(t)),(e=>{const{measureType:i}=e;if($e(e)&&i!==S.Direct){const e=Math.round(O(dt,"meters","kilometers"));return r.getLogger(this).warnOnce(`A ${i} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${e} km. Update the measureType of the affected dimension to "direct" to display it.`),void(t.geometry=null)}const n=Re(e,this.view.renderCoordsHelper,t.geometry);t.geometry=n,t.result.length=function(t,e,i,n){if(null==t)return null;let s;if(e===S.Horizontal)s=n.autoDistanceBetweenPoints2D(xe(t.elevationAlignedStartPoint),xe(t.elevationAlignedEndPoint));else{const{startRenderSpace:e,endRenderSpace:i}=t.dimensionSegment;s=ut(e,i,t.spatialReference)}if(null==s)return null;const o=e===S.Vertical?C(s.value,s.unit,i):D(s.value,s.unit,i);return R(s,o)}(n,i,this._defaultUnit,this.automaticLengthMeasurementUtils)}),M)}};function Xe(t){return wt(t.accentColor,.5)}function Ke(t){return Pt(t.accentColor)}t([u({constructOnly:!0})],Je.prototype,"analysisViewData",void 0),t([u({constructOnly:!0})],Je.prototype,"view",void 0),t([u({constructOnly:!0})],Je.prototype,"automaticLengthMeasurementUtils",void 0),t([u()],Je.prototype,"analysis",null),t([u()],Je.prototype,"_defaultUnit",null),Je=t([d("esri.views.3d.analysis.Dimension.DimensionController")],Je);const ti=new ft([127,127,127,.5]);class ei{constructor(t){this.start=t.start,this.end=t.end,this.offset=t.offset,this.heading=t.heading,this.rotation=t.rotation,this.direct=t.direct,this.horizontal=t.horizontal,this.vertical=t.vertical}manipulatorName(t){return Object.keys(this).find((e=>this.hasOwnProperty(e)&&t===this[e]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(t){for(const e of _)t(this.manipulatorForMeasureType(e),e)}manipulatorForMeasureType(t){switch(t){case S.Direct:return this.direct;case S.Horizontal:return this.horizontal;case S.Vertical:return this.vertical}}}class ii extends Ct{constructor(t,e){const i=Dt(ft.toUnitRGBA(Xe(t.effectiveTheme))),n=[new Ot(Wt(i,1,32,32),yi)];super({view:t,renderObjects:n,metadata:e.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=k((()=>({color:ft.toUnitRGBA(Xe(t.effectiveTheme))})),(t=>i.setParameters(t)))}destroy(){this._themeHandle.remove(),super.destroy()}}class ni extends Ct{constructor(t,{lineSizePt:e,material:i,metadata:n}){super({view:t,autoScaleRenderObjects:!1,collisionPriority:1,metadata:n}),this._options={calloutColor:vt(),lineSizePt:e,material:i},this._themeHandle=k((()=>ft.toUnitRGBA(Xe(t.effectiveTheme))),(t=>{this._options.calloutColor=t,fi(this,si({...this._options,metadata:this.metadata}))}),b)}update({lineSizePt:t,material:e}){this._options.lineSizePt=t,this._options.material=e,fi(this,si({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function si({calloutColor:t,lineSizePt:e,material:i,metadata:n}){return{calloutLength:.25*Ft*.8*jt(e)+18,calloutColor:t,calloutWidth:2,customStateMask:yi,discScale:.3,focusMultiplier:2,material:i,metadata:n}}function oi(t){const{cancel:e,computation:i,settingHeading:n,steps:s,view:o}=t;if(!Ye(i))return;const{renderCoordsHelper:r}=o,{dimension:a,geometry:l}=i,p=et(),c=mi(et(),l,l.directSegment,r),m=ui(rt.get(),{forHeading:n,geometry:l,renderCoordsHelper:r}),u=_t(c,m,kt()),d=n?a.orientation??Qe(l,o.renderCoordsHelper):a.orientation??0;s.next(It(o,u)).next((t=>{"start"===t.action&&I(p,t.renderStart);const e=bt(u),i=Rt(p,t.renderEnd,c,e);let s=d-A(i);n||(s=function(t){const e=yt.normalize(t)%90;return e<5?t-e:90-e<5?t+(90-e):t}(s)),a.orientation=s})),e.next(Jt(a,["orientation"]))}function ri(t,e,i,n){const s=tt(rt.get(),i.endRenderSpace,i.startRenderSpace);B(s,s,n);const o=_t(i.startRenderSpace,s,kt()),r=_t(i.startRenderSpace,n,kt()),a=e.offset;let l,p=0;const c=new Xt;return c.next(It(t,o)).next((i=>{"start"===i.action&&(p=Mt(r,i.renderStart));const n=(Mt(r,i.renderEnd)-p)*t.renderCoordsHelper.unitInMeters;e.offset=a+n,l=i})),t=>(c.execute(t),l)}function ai(t,e){const{directSegment:i}=t,{renderCoordsHelper:n}=e,s=Ne(rt.get(),t,n),o=qe(rt.get(),t),r=B(rt.get(),o,s),{viewForward:a}=e.state.camera;N(r,a)>0&&Y(r,r,-1);const l=i.eval(.5,rt.get());return n.headingAtPosition(l,r)}function li(t,e,i,{forHeading:n}){const{dimension:s,geometry:o}=e,{primaryOffsetAxis:r}=o,a=Y(pi,r,s.offset>=0?1:-1),l=ui(ci,{forHeading:n,geometry:o,renderCoordsHelper:i});B(l,l,a);const p=xt(a,l,it,Si);t.modelTransform=p,t.renderLocation=mi(ji,o,o.dimensionSegment,i)}const pi=et(),ci=et();function mi(t,e,i,n){const{startRenderSpace:s,endRenderSpace:o}=i,r=function(t,e){const i=qe(di,t),n=Ne(hi,t,e);return N(i,n)>0}(e,n)?s:o;return I(t,r)}function ui(t,{forHeading:e,geometry:i,renderCoordsHelper:n}){return e?Ne(t,i,n):We(t,i,{invert:!0})}const di=et(),hi=et();function gi(t){return jt(t)+6}function fi(t,e){const i=e.material,n=e.focusMultiplier??At.focusMultiplier,s=e.calloutLength??At.calloutLength,o=At.discRadius*(e.discScale??1),r=o*n,a=(t,e)=>{const i=[0,1,2,2,3,0];return new qt(e,[[$t.POSITION,new Nt([s-t,-t,0,s+t,-t,0,s+t,t,0,s-t,t,0],i,3,!0)],[$t.UV0,new Nt([0,0,1,0,1,1,0,1],i,2,!0)]])},l=e.calloutWidth??At.calloutWidth,p=new Gt({width:l,color:e.calloutColor,renderOccluded:Zt.OccludeAndTransparent,isDecoration:!0}),c=Qt(p,[[0,0,0],[s-o,0,0]]),m=Qt(p,[[0,0,0],[s-r,0,0]]),u=e.customStateMask??Kt.None;t.collisionType={type:"disc",direction:[0,0,1],offset:[s,0,0]},t.focusMultiplier=n,t.metadata=e.metadata,t.radius=o,t.renderObjects=[new Ot(a(o,i),te.Unfocused|u),new Ot(c,te.Unfocused|u),new Ot(a(r,i),te.Focused|u),new Ot(m,te.Focused|u)]}const yi=Kt.Custom1,ji=et(),vi=et(),Si=E(),_i=new pt;var ki;function Mi(t,e,i){const{constraint:n,elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,unconstrainedGeometry:r,view:a}=i,{dimension:l,previousConstraint:p,preConstraintProperties:c}=t;if(null==s||null==o)return;const m=()=>{"startPoint"in e?l.startPoint=e.startPoint:"endPoint"in e&&(l.endPoint=e.endPoint)};if(null==n)m(),null!=p&&null!=c&&(l.measureType=c.measureType,l.orientation=c.orientation);else switch(l.measureType=S.Direct,n){case ki.Horizontal:if(n!==p&&(l.orientation=0),"startPoint"in e){const t=e.startPoint;null!=t&&(t.z=o.z),l.startPoint=t}else if("endPoint"in e){const t=e.endPoint;null!=t&&(t.z=s.z),l.endPoint=t}break;case ki.Vertical:if(n!==p&&(l.orientation=ai(r,a)),"startPoint"in e){const t=e.startPoint;null!=t&&(t.x=o.x,t.y=o.y),l.startPoint=t}else if("endPoint"in e){const t=e.endPoint;null!=t&&(t.x=s.x,t.y=s.y),l.endPoint=t}break;case ki.Direct:n!==p&&null!=c&&(l.orientation=c.orientation),m()}t.previousConstraint=n,t.unconstrainedGeometry=r}!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Direct=2]="Direct"}(ki||(ki={}));let bi=class extends e{constructor(t){super(t),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new ee,this._updatingHandles=new ne,this._getSnappingContext=ie((t=>new ue({elevationInfo:{mode:"absolute-height",offset:0},pointer:t,editGeometryOperations:new pe(new ce("point",me(!0,!1,this.view.spatialReference)),this.view.state.viewingMode),visualizer:new oe})));const{view:e}=t;this._snappingManagerResult=he(e),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:le(2)}),this._constraintSnappingIndicator=new Ht({view:e,attached:!0,width:1,renderOccluded:Zt.OccludeAndTransparent,stipplePattern:le(5),isDecoration:!0});const i=ft.toUnitRGBA(ti);this._stagedStartIndicator=new re({view:e,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:t.view.renderCoordsHelper.spatialReference,color:i,size:10,outlineSize:0,renderOccluded:Zt.OccludeAndTransparent,isDecoration:!0})}initialize(){const{view:t}=this;this._snappingOperation=new ge({view:t});const e=Xe(t.effectiveTheme),n=Ke(t.effectiveTheme),s=!t.stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this._textureHandle=se(t.stage.textures,{accentColor:e,contrastColor:n,preMultiplyAlpha:s}),this._orientationManipulatorMaterial=new ae({draped:!1,texture:this._textureHandle.texture,writeDepth:!1,renderOccluded:Zt.Opaque,isDecoration:!0});const o=a((()=>this.analysisViewData.computations),(({computation:t})=>this._createManipulators(t)));this.addHandles([k((()=>({accentColor:Xe(t.effectiveTheme),contrastColor:Ke(t.effectiveTheme)})),(({accentColor:e,contrastColor:i})=>{const n=this._textureHandle;this._textureHandle=se(t.stage.textures,{accentColor:e,contrastColor:i,preMultiplyAlpha:s}),this._orientationManipulatorMaterial.setParameters({texture:this._textureHandle.texture}),n?.release();const o=ft.toUnitRGBA(e);this._unfocusedOffsetManipulatorMaterial.setParameters({color:o}),this._focusedOffsetManipulatorMaterial.setParameters({color:o}),this._thinOffsetManipulatorMaterial.setParameters({color:o}),this._constraintSnappingIndicator.color=o}),b),i(o),k((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(({stagedPoint:t,stagedComputation:e})=>{if(null==e||null==t)return;const i=lt(t,new st);this._applyPointUpdate(e,{endPoint:i})}),w),k((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((t,e)=>{const{stagedDimension:i,selectedComputation:n,firstGrabbedManipulator:s}=t;if(i===e?.stagedDimension&&s===e?.firstGrabbedManipulator){for(const i of[n,e?.selectedComputation])if(null!=i){const e=this._computationManipulators.get(i);null!=e&&this._updateManipulators(i,e,t)}}else for(const[e,i]of this._computationManipulators)this._updateManipulators(e,i,t)}),M),k((()=>this.analysis.style.lineSize),(t=>this._updateManipulatorStyle(t)),b),k((()=>this.view.state.camera),(()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)})),k((()=>{const t=this._stagedComputation;if(!t)return null;const e=t.elevationAlignedStartPoint,i=et();return null!=e&&this.view.renderCoordsHelper.toRenderCoords(e,i)?i:null}),(t=>{null!=t?(this._stagedStartIndicator.vertices=[t],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),fe(this,(()=>{const t=this._activeComputation,e=this._stagedComputation;if(null==t||null!=e){const t=this.view.inputManager.latestPointerType??"mouse",e=this._getSnappingContext(t);this._updatingHandles.addPromise(ht(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,e)))}if(null!=t){const{start:e,end:i}=this._computationManipulators.get(t);(e.grabbing||i.grabbing)&&function(t,e,{constraint:i,view:n}){const{unconstrainedGeometry:s}=t;if(null==s)return;const{renderCoordsHelper:o,spatialReference:r}=n,{startRenderSpace:a,endRenderSpace:l}=s.directSegment,p=o.fromRenderCoords(a,new st({spatialReference:r})),c=o.fromRenderCoords(l,new st({spatialReference:r}));let m;m="start"===e?{startPoint:p}:{endPoint:c},Mi(t,m,{constraint:i,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,unconstrainedGeometry:s,view:n})}(t,e.grabbing?"start":"end",{constraint:this._computeConstraint(t),view:this.view})}}))}destroy(){this._textureHandle=l(this._textureHandle),this._snappingOperation=p(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:t}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=t?t:null}get _stagedComputation(){const t=this._stagedDimension,e=this.analysisViewData.computations.at(-1)?.computation;return null==t||null==e||e.dimension!==t?null:e}get _constraintHandles(){return[P((()=>this.analysisViewData.selectedComputation),(t=>{t.previousConstraint=this._computeConstraint(t)}),{...M,equals:o}),k((()=>{const t=this._activeComputation;if(null==t)return null;const{measureType:e,orientation:i}=t.dimension;return{measureType:e,orientation:i,computation:t}}),((t,e)=>{if(null!=t&&null==e){const{measureType:e,orientation:i,computation:n}=t;switch(n.previousConstraint){case ki.Horizontal:n.preConstraintProperties={measureType:S.Horizontal,orientation:0};break;case ki.Vertical:n.preConstraintProperties={measureType:S.Vertical,orientation:0};break;case ki.Direct:n.preConstraintProperties={measureType:S.Direct,orientation:i};break;default:n.preConstraintProperties={measureType:e,orientation:i}}}null==t&&null!=e&&(e.computation.preConstraintProperties=null)}),w)]}get _snappingIndicatorHandles(){const t="snapping-indicator-event-handles";return[k((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(({stagedComputation:e,activeComputation:i})=>{const n=this._constraintSnappingIndicator;if(this.removeHandles(t),null!=i)if(i===e)n.attached=!0;else{const{start:e,end:s}=this._computationManipulators.get(i),o=()=>{n.attached=e.grabbing||s.grabbing};o(),this.addHandles([e.events.on("grab-changed",o),s.events.on("grab-changed",o)],t)}else n.attached=!1})),k((()=>{const t=this._activeComputation;return null!=t?{geometry:t.geometry,constraint:t.previousConstraint}:{}}),(({geometry:t,constraint:e})=>{const i=this._constraintSnappingIndicator;null!=t&&null!=e&&e!==ki.Direct?(i.visible=!0,i.setGeometryFromSegment(t.directSegment)):i.visible=!1}))]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(t){const{_stagedDimension:e}=this;if(null==e){const e=this._onUnstagedClick(t);return this.analysis.dimensions.add(e),null}return this._onStagedClick(t),e}onPointerMove({mapPoint:t,pointerType:e}){if("touch"===e)return;const i=this._getSnappingContext(e);this._updatingHandles.addPromise(ht(this._snappingOperation.snap({point:t},this._snappingManager,i)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:t,pointerType:e}){let i=t;if("mouse"===e){const n=this._getSnappingContext(e);i=this._snappingManager.update({point:t,context:n})}const n=new v({startPoint:lt(i,new st),endPoint:null,measureType:S.Horizontal});return this._stagedDimension=n,this._resetSnappingState(),n}_onStagedClick({mapPoint:t,pointerType:e}){const i=this._stagedComputation;if(null==i)return;let n=t;if("mouse"===e){const i=this._getSnappingContext(e);n=this._snappingManager.update({point:t,context:i})}const s=lt(n,new st);this._applyPointUpdate(i,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(t){const e=this._setupPointManipulator(t,{isStart:!0}),i=this._setupPointManipulator(t,{isStart:!1}),s=this._setupOffsetManipulator(t),o=this._setupHeadingManipulator(t),r=this._setupRotationManipulator(t),a=this._setupMeasureTypeManipulator(t,S.Direct),l=this._setupMeasureTypeManipulator(t,S.Horizontal),p=this._setupMeasureTypeManipulator(t,S.Vertical),c=new ei({start:e,end:i,offset:s,heading:o,rotation:r,direct:a,horizontal:l,vertical:p});this._setupComputationToManipulatorsSync(t,c),this._computationManipulators.set(t,c),this.manipulators.addMany(c.values());const m=n(c.values().map((t=>t.events.on("focus-changed",(()=>{c.values().some((t=>t.focused))&&this._resetSnappingState()})))));return{manipulators:c,remove:()=>{m.remove(),this._computationHandles.remove(t),this._computationManipulators.delete(t);for(const t of c.values())this.manipulators.remove(t)}}}_setupComputationToManipulatorsSync(t,e){this._computationHandles.add([k((()=>t.geometry),(()=>this._updateManipulators(t,e)),{...M,equals:o})],t)}_setupPointManipulator(t,e){const{view:i}=this,{dimension:n}=t,s=new ii(i,{metadata:n}),o=function(t,{isStart:e,createSnappingPipelineStep:i,dimension:n,onUpdate:s,view:o}){const r=e?"startPoint":"endPoint",a=Yt(t,((t,e,a,l)=>{const p=Vt(t),{snappingStep:c,cancelSnapping:m}=i(l);a=a.next(p).next(Jt(n,[r,"measureType","orientation"])).next(m),e.next(p).next(Et(o)).next(...c).next((t=>{const e=lt(t.mapEnd,new st);s("startPoint"===r?{startPoint:e}:{endPoint:e})}))}));return[a]}(s,{isStart:e.isStart,createSnappingPipelineStep:t=>de({snappingContext:this._getSnappingContext(t),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:n,onUpdate:e=>this._applyPointUpdate(t,e),view:i});return this._computationHandles.add(o,t),s}_setupOffsetManipulator(t){const{view:e}=this,i=function(t,e){const i=[nt(-.5,0,0),nt(.5,0,0)],n=Qt(e.unfocusedMaterial,i.map((t=>Y(et(),t,.5)))),s=n.instantiate({material:e.focusedMaterial});return new Ct({view:t,renderObjects:[new Ot(n,te.Unfocused|te.Selected|yi),new Ot(s,te.Focused|yi)],collisionType:{type:"line",paths:[i]},radius:gi(e.lineSizePt)/2,metadata:e.metadata,available:!1,...Tt})}(e,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:t.dimension}),n=function(t,{computation:e,view:i}){return[Yt(t,((t,n,s)=>{if(!Ye(e)||!t.selected)return;const{geometry:o,dimension:r}=e,a=Vt(t);n.next(a).next(ri(i,r,o.dimensionSegment,o.primaryOffsetAxis)),s.next(a).next(Jt(r,["offset"]))}))]}(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupHeadingManipulator(t){const{view:e}=this,i=new ni(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),n=function(t,{computation:e,view:i}){return[Yt(t,((t,n,s)=>{oi({cancel:s,computation:e,settingHeading:!0,steps:n,view:i})}))]}(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupRotationManipulator(t){const{view:e}=this,i=new ni(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),n=function(t,{computation:e,view:i}){return[Yt(t,((t,n,s)=>{oi({cancel:s,computation:e,settingHeading:!1,steps:n,view:i})})),t.events.on("immediate-click",(t=>{!function(t,e,i){const{dimension:n,geometry:s}=e;if(90===n.orientation||270===n.orientation)return n.orientation=0,void t.stopPropagation();if(null==s)return;const{renderCoordsHelper:o}=i,r=Re({...Ae(e),orientation:90},o),a=Re({...Ae(e),orientation:270},o);if(null==r||null==a)return;const l=Qe(r,o),p=Qe(a,o),c=ai(s,i),m=yt.shortestSignedDiff(c,l),u=yt.shortestSignedDiff(c,p);n.orientation=Math.abs(m)<Math.abs(u)?90:270,t.stopPropagation()}(t,e,i)}))]}(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupMeasureTypeManipulator(t,e){const{view:i}=this,n=function(t,e){const i=[nt(-.5,0,0),nt(.5,0,0)],n=Qt(e.thinOffsetManipulatorMaterial,i),s=Qt(e.unfocusedMaterial,i.map((t=>Y(et(),t,.5)))),o=s.instantiate({material:e.focusedMaterial});return new Ct({view:t,renderObjects:[new Ot(s,te.Unfocused|yi),new Ot(o,te.Focused|yi),new Ot(n,yi)],collisionType:{type:"line",paths:[i]},radius:gi(e.lineSizePt)/2,available:!1,metadata:e.metadata,...Tt})}(i,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:t.dimension}),s=function(t,{computation:e,manipulatorMeasureType:i,view:n}){let s=S.Direct,o=0,r=0;return[t.events.on("grab-changed",(a=>{if("start"!==a.action||!Ye(e))return;const{dimension:l,geometry:p}=e;s=l.measureType,o=l.offset,r=l.orientation;const c=I(rt.get(),t.renderLocation);l.measureType=i,l.offset=function(t,e,i,n){const{directSegment:s}=i,o=Ie(rt.get(),{measureType:e,directSegment:s,renderCoordsHelper:n}),r=Be(Ee,o,0,s,n).eval(.5,rt.get()),a=F(rt.get(),t,r);return N(a,o)*n.unitInMeters}(c,i,p,n.renderCoordsHelper),l.orientation=0})),Yt(t,((t,a,l)=>{if(!Ye(e))return;const{geometry:p,dimension:c}=e,{renderCoordsHelper:m}=n,u=ze(_i,i,e,m),d=Ie(rt.get(),{measureType:i,directSegment:p.directSegment,renderCoordsHelper:m}),h=Vt(t);a.next(h).next(ri(n,c,u,d)),l.next(h).next((t=>(c.measureType=s,c.offset=o,c.orientation=r,t)))}))]}(n,{computation:t,manipulatorMeasureType:e,view:i});return this._computationHandles.add(s,t),n}_updateManipulators(t,e,i={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:n,selectedComputation:s,firstGrabbedManipulator:o}=i,{start:r,end:a,offset:l,heading:p,rotation:c}=e,m=s===t,u=Ye(t),{dimension:d}=t;for(const t of e.values()){const e=u&&null==n&&(null==o||t===o);t===l?(t.available=e,t.selected=m):t.available=e&&m}if(!u)return;null!=this._computeConstraint(t)?e.forEachMeasureTypeManipulator((t=>t.available=!1)):e.manipulatorForMeasureType(d.measureType).available=!1;for(const t of[p,c])d.measureType===S.Direct&&0!==d.offset||(t.available=!1);Fe(t)?c.available=!1:p.available=!1;const{geometry:h}=t;r.renderLocation=h.directSegment.startRenderSpace,a.renderLocation=h.directSegment.endRenderSpace;const{renderCoordsHelper:g}=this.view;!function(t,e,i){const{dimensionSegment:n,primaryOffsetAxis:s}=e,o=We(ji,e),r=J(o,it)?z(Si):xt(o,s,it,Si),a=Math.max(X(o),.1/i.unitInMeters);L(r,r,K(ji,a,a,a)),t.modelTransform=r,t.renderLocation=n.eval(.5,ji)}(l,h,g),p.available&&function(t,e,i){li(t,e,i,{forHeading:!0})}(p,t,g),c.available&&function(t,e,i){li(t,e,i,{forHeading:!1})}(c,t,g),e.forEachMeasureTypeManipulator(((e,i)=>{e.available&&function(t,e,i,n){const{geometry:s}=e,o=ze(_i,i,e,n),r=Ie(ji,{measureType:i,directSegment:s.directSegment,renderCoordsHelper:n}),a=F(vi,o.endRenderSpace,o.startRenderSpace),l=xt(a,r,it,Si),p=X(a);L(l,l,K(vi,p,p,p)),t.modelTransform=l,t.renderLocation=o.eval(.5,vi)}(e,t,i,g)}))}_updateManipulatorStyle(t){const e=function(t){return jt(t)+4}(t),i=gi(t),n={lineSizePt:t,material:this._orientationManipulatorMaterial};for(const{offset:t,heading:e,rotation:s}of this._computationManipulators.values())t.radius=i/2,e.update(n),s.update(n);this._unfocusedOffsetManipulatorMaterial.setParameters({width:e}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}_applyPointUpdate(t,e){const{view:i}=this,n=Ae(t);"startPoint"in e&&(n.elevationAlignedStartPoint=e.startPoint),"endPoint"in e&&(n.elevationAlignedEndPoint=e.endPoint);const s=Re(n,i.renderCoordsHelper);if(null==s)return;const o=this._computeConstraint({...n,geometry:s});Mi(t,e,{...n,constraint:o,unconstrainedGeometry:s,view:i}),t===this._stagedComputation&&this._updateStagedDimensionOffset(t)}_updateStagedDimensionOffset(t){if(null==t.geometry)return;t.geometry.directSegment.eval(.5,wi);const{state:e,renderCoordsHelper:i}=this.view,n=e.camera.computeScreenPixelSizeAt(wi);t.dimension.offset=50*n*i.unitInMeters}_computeConstraint(t){return function(t,e){if($e(t))return ki.Direct;if(!t.enabled)return null;const{geometry:i}=t;if(null==i||J(i.directSegment.startRenderSpace,i.directSegment.endRenderSpace))return null;const{camera:n}=e.state,s=Ne(rt.get(),i,e.renderCoordsHelper),o=qe(rt.get(),i),r=Y(rt.get(),s,N(o,s)),a=tt(rt.get(),o,r),l=$(a),p=$(r),{startRenderSpace:c,endRenderSpace:m}=i.directSegment,u=Math.max(10*n.computeScreenPixelSizeAt(c),10*n.computeScreenPixelSizeAt(m))**2;return l<u?ki.Vertical:p<u?ki.Horizontal:null}(function(t,e){return{enabled:e.effectiveFeatureEnabled,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,geometry:t.geometry}}(t,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new Gt({width:1,renderOccluded:Zt.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get test(){}};t([u({constructOnly:!0})],bi.prototype,"analysis",void 0),t([u({constructOnly:!0})],bi.prototype,"analysisViewData",void 0),t([u({constructOnly:!0})],bi.prototype,"manipulators",void 0),t([u({constructOnly:!0})],bi.prototype,"parentTool",void 0),t([u({constructOnly:!0,nonNullable:!0})],bi.prototype,"view",void 0),t([u({readOnly:!0})],bi.prototype,"updating",null),t([u()],bi.prototype,"firstGrabbedManipulator",null),t([u()],bi.prototype,"hasGrabbedManipulators",null),t([u()],bi.prototype,"snappingOptions",null),t([u()],bi.prototype,"_stagedDimension",void 0),t([u()],bi.prototype,"_activeComputation",null),t([u()],bi.prototype,"_stagedComputation",null),bi=t([d("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],bi);const wi=et();var Pi;!function(t){t.Ready="ready",t.Creating="creating",t.Created="created"}(Pi||(Pi={}));let Ci=class extends h{constructor(t){super(t),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._placementMode=Di,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=je(this.view.state.viewingMode),this._lengthDimensionSubTool=new bi({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([i(this._lengthDimensionSubTool),s((()=>this._clearPointerMoveTimeout())),P((()=>this.state===Pi.Created),(()=>this.finishToolCreation()),M),P((()=>this.firstGrabbedManipulator),(t=>{this.selectedDimension=t.metadata}),M),k((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),M)])}get state(){return this.analysis.dimensions.some((t=>"length"===t.type))?null!=this._activeSubTool?Pi.Creating:Pi.Created:Pi.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(t){this.analysisViewData.selectedDimension=t}place(t){this.selectedDimension=null,this._placementMode=t}onInputEvent(t){switch(t.type){case"immediate-click":this._clickHandler(t);break;case"immediate-double-click":this._doubleClickHandler(t);break;case"pointer-move":this._pointerMoveHandler(t);break;case"key-down":this._keyDownHandler(t)}}onActivate(){this._placementMode=Di,this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){this._activeSubTool?.onDeactivate(),this._activeSubTool=null}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(t){if(this.hasFocusedManipulators)return void t.stopPropagation();if(null==this._activeSubTool)return;const e=this._intersectScreen(t);null!=e&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:e,pointerType:t.pointerType}),this.selectedDimension&&"single"===this._placementMode&&(this.view.activeTool=null),t.stopPropagation())}_doubleClickHandler(t){this.active&&(this.view.activeTool=null,t.stopPropagation())}_pointerMoveHandler(t){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const e=this._intersectScreen(t);null!=e&&this._activeSubTool.onPointerMove({mapPoint:e,pointerType:t.pointerType})}_keyDownHandler(t){ye.cancel===t.key?(this._activeSubTool?.removeStaged()&&"multiple"===this._placementMode&&t.stopPropagation(),this.active||(this.selectedDimension=null)):ye.delete.includes(t.key)&&(this._activeSubTool?.removeStaged(),this._removeSelected())}_intersectScreen(t){const e=ve(t);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector);const i=this._intersector.results.min,n=rt.get();return i.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,new st({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=c(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((t=>t.manipulator.state|=yi)),this._prevPointerMoveTimeout=gt.setTimeout((()=>{this.manipulators.forEach((t=>t.manipulator.state&=~yi))}),this._pointerMoveTimerMs)}get test(){}};t([u({constructOnly:!0})],Ci.prototype,"view",void 0),t([u({constructOnly:!0})],Ci.prototype,"analysis",void 0),t([u({readOnly:!0})],Ci.prototype,"state",null),t([u({readOnly:!0})],Ci.prototype,"updating",null),t([u({readOnly:!0})],Ci.prototype,"cursor",null),t([u({constructOnly:!0})],Ci.prototype,"analysisViewData",void 0),t([u()],Ci.prototype,"selectedDimension",null),t([u()],Ci.prototype,"automaticManipulatorSelection",void 0),t([u()],Ci.prototype,"_activeSubTool",void 0),t([u()],Ci.prototype,"_lengthDimensionSubTool",void 0),t([u()],Ci.prototype,"_placementMode",void 0),Ci=t([d("esri.views.3d.analysis.Dimension.DimensionTool")],Ci);const Di="multiple";class Oi extends Ut{constructor(t,e){super(t),this._hasExternalMaterial=!1,this._renderOccluded=Zt.OccludeAndTransparent,this._width=1,this._color=_e(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=e,this._hasExternalMaterial=null!=e,this.applyProperties(t)}setGeometryFromSegment(t,e){const i=t.endRenderSpace;this.transform=V(Ti,i),this._normal=e;const{points:n}=t.createRenderGeometry(i,this.view.renderCoordsHelper);this.geometry=[n]}get renderOccluded(){return this._material?.parameters.renderOccluded??this._renderOccluded}set renderOccluded(t){this._renderOccluded=t,this._material?.setParameters({renderOccluded:t})}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get normal(){return this._normal}set normal(t){this._normal=t,this.recreateGeometry()}get width(){return this._material?.parameters.width??this._width}set width(t){this._width=t,this._material?.setParameters({width:t})}get color(){return this._material?.parameters.color??this._color}set color(t){this._color=ke(t),this._material?.setParameters({color:this._color})}get placement(){return this._material?.parameters.placement??this._placement}set placement(t){this._placement=t,this._material?.setParameters({placement:this._placement})}get markerPrimitive(){return this._material?.parameters.markerPrimitive??this._markerPrimitive}set markerPrimitive(t){this._markerPrimitive=t,this._material?.setParameters({markerPrimitive:t})}createExternalResources(){this._hasExternalMaterial||(this._material=new we({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(t){for(const e of Me(this.geometry,this.normal)){const i=be(this._material,e);t.addGeometry(i)}}forEachMaterial(t){this._hasExternalMaterial||t(this._material)}}const Ti=E();class xi{set visible(t){for(const e of this._visualElements.values())e.attached=t}constructor(t){this.destroyed=!1,this._handles=new ee,this._messages=null,this._labelSegment=new pt;const{analysis:e,computation:i,view:n,messages:s,isDecoration:r}=t;this.analysis=e,this.computation=i,this.view=n,this._messages=s;const a=t.visible,l={view:n,attached:a,isDecoration:r},{fontSize:p,textColor:c,textBackgroundColor:m}=e.style;this._visualElements=new Ui({marker:new Oi(l,t.markerMaterial),dimension:new Ht(l,t.dimensionLineMaterial),startOffset:new Ht(l,t.offsetLineMaterial),endOffset:new Ht(l,t.offsetLineMaterial),dimensionSmall:new Ht(l,t.smallDimensionLineMaterial),startOffsetSmall:new Ht(l,t.smallOffsetLineMaterial),endOffsetSmall:new Ht(l,t.smallOffsetLineMaterial),label:new ct({view:n,attached:a,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:jt(p),textColor:c.clone(),backgroundColor:m.clone(),isDecoration:r})}),this._handles.add([k((()=>i.geometry),(t=>{this.updateCameraDependentElements(n.state.camera,t,e.style),null!=i.geometry&&this._updateLines(i.geometry)}),{...b,equals:o}),k((()=>i.length),(t=>this._updateLabelContent(t)),b)])}destroy(){this.destroyed=!0,this._handles=p(this._handles);for(const t of this._visualElements.values())t.destroy()}get testInfo(){}_updateLines(t){const e=He(Ai,Ue.Start,t.directSegment,t.dimensionSegment),i=He(Ri,Ue.End,t.directSegment,t.dimensionSegment),n=this._visualElements;n.marker.setGeometryFromSegment(t.dimensionSegment,t.primaryOffsetAxis),n.dimension.setGeometryFromSegment(t.dimensionSegment),n.startOffset.setGeometryFromSegment(e),n.endOffset.setGeometryFromSegment(i),n.dimensionSmall.setGeometryFromSegment(t.dimensionSegment),n.startOffsetSmall.setGeometryFromSegment(e),n.endOffsetSmall.setGeometryFromSegment(i)}updateCameraDependentElements(t,e,i){const n=this._visualElements;if(null==e){for(const t of n.values())t.visible=!1;return}const s=t.computeScreenPixelSizeAt(e.dimensionSegment.eval(.5,Hi)),o=function(t,e){return $(We(Ze,t))/e**2}(e,s),r=o<(2*jt(i.lineSize))**2,a=!r;n.marker.visible=a,n.dimension.visible=a,n.startOffset.visible=a,n.endOffset.visible=a,n.dimensionSmall.visible=r,n.startOffsetSmall.visible=r,n.endOffsetSmall.visible=r;const l=5*jt(i.fontSize),{label:p}=n;if(p.visible=o>=l**2,!p.visible)return;const{dimensionSegment:c,primaryOffsetAxis:m}=e,{offset:u}=this.computation.dimension,d=(Math.sign(u)>=0?1:-1)*function(t){return 1.5*jt(t.fontSize)+20+jt(t.lineSize/2)}(i)*s;!function(t,e,i,n){Q(t.startRenderSpace,e.startRenderSpace,i,n),Q(t.endRenderSpace,e.endRenderSpace,i,n)}(this._labelSegment,c,m,d),p.updateLabelPosition()}updateLabelStyle(t){const{label:e}=this._visualElements;e.fontSize=jt(t.fontSize),e.textColor=t.textColor,e.backgroundColor=t.textBackgroundColor}updateUnitsMessages(t){this._messages=t;const{length:e}=this.computation;this._updateLabelContent(e)}_updateLabelContent(t){const{label:e}=this._visualElements;null!=t&&null!=this._messages?e.text=Se(this._messages,t,t.unit):e.text=""}}const Ai=new pt,Ri=new pt,Hi=et();class Ui{constructor(t){this.marker=t.marker,this.dimension=t.dimension,this.startOffset=t.startOffset,this.endOffset=t.endOffset,this.dimensionSmall=t.dimensionSmall,this.startOffsetSmall=t.startOffsetSmall,this.endOffsetSmall=t.endOffsetSmall,this.label=t.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}let zi=class extends e{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(t){super(t),this.loadingMessages=!1,this._messages=null}initialize(){const t=this.isDecoration;this._markerMaterial=new we({width:1,anchor:Bt.Tip,color:St,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:Zt.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:t}),this._dimensionLineMaterial=new Gt({width:1,color:St,renderOccluded:Zt.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:t}),this._offsetLineMaterial=new Gt({width:1,color:St,renderOccluded:Zt.OccludeAndTransparent,stipplePattern:le(5),isDecoration:t}),this._smallDimensionLineMaterial=new Gt({width:1,color:St,renderOccluded:Zt.OccludeAndTransparent,isDecoration:t}),this._smallOffsetLineMaterial=new Gt({width:1,color:St,renderOccluded:Zt.OccludeAndTransparent,stipplePattern:le(5),isDecoration:t});const e=a((()=>this.analysisViewData.computations),(({computation:t})=>this._createVisualization(t)));this._dimensionVisualizations=e,this.addHandles([i(e),k((()=>ft.toUnitRGBA(this.analysis.style.color)),(t=>{for(const e of this._lineMaterials())e.setParameters({color:t})}),M),k((()=>this.analysis.style.lineSize),(t=>{const e=jt(t);this._markerMaterial.setParameters({width:.8*e}),this._dimensionLineMaterial.setParameters({width:e,markerParameters:this._markerMaterial.parameters});const i=Math.max(.25*e,1);this._offsetLineMaterial.setParameters({width:i})}),M),k((()=>({camera:this.view.state.camera,style:Li(this.analysis)})),(({camera:t,style:e})=>{for(const{visualization:i}of this._dimensionVisualizations)i.updateCameraDependentElements(t,i.computation.geometry,e),i.updateLabelStyle(e)})),k((()=>this.visible),(t=>{for(const{visualization:e}of this._dimensionVisualizations)e.visible=t}))]),this.addHandles([Pe((()=>this._updateMessageBundle())),P((()=>!this.loadingMessages),(()=>{for(const{visualization:t}of this._dimensionVisualizations)t.updateUnitsMessages(this._messages)}),w)]),this._updateMessageBundle()}get testInfo(){}_createVisualization(t){const e=new xi({analysis:this.analysis,computation:t,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:e,remove:()=>e.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await Ce("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function Li(t){const{fontSize:e,lineSize:i,textColor:n,textBackgroundColor:s}=t.style;return{fontSize:e,lineSize:i,textBackgroundColor:s.clone(),textColor:n.clone()}}t([u({constructOnly:!0})],zi.prototype,"analysisViewData",void 0),t([u({constructOnly:!0,nonNullable:!0})],zi.prototype,"view",void 0),t([u({constructOnly:!0})],zi.prototype,"isDecoration",void 0),t([u()],zi.prototype,"analysis",null),t([u()],zi.prototype,"visible",null),t([u()],zi.prototype,"loadingMessages",void 0),zi=t([d("esri.views.3d.analysis.Dimension.DimensionVisualization")],zi);let Vi=class extends e{constructor(t){super(t),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(t){const{dimension:e,...i}=t;return{result:new De({dimension:e}),...i}}initialize(){this.addHandles([k((()=>this.dimension.startPoint),(t=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(t)),M),k((()=>this.dimension.endPoint),(t=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(t)),M)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};t([u({constructOnly:!0,nonNullable:!0})],Vi.prototype,"result",void 0),t([u({constructOnly:!0,nonNullable:!0})],Vi.prototype,"projectAndAlignPoint",void 0),t([u()],Vi.prototype,"dimension",null),t([u()],Vi.prototype,"length",null),t([u()],Vi.prototype,"geometry",void 0),t([u()],Vi.prototype,"unconstrainedGeometry",void 0),t([u()],Vi.prototype,"elevationAlignedStartPoint",void 0),t([u()],Vi.prototype,"elevationAlignedEndPoint",void 0),t([u()],Vi.prototype,"preConstraintProperties",void 0),t([u()],Vi.prototype,"previousConstraint",void 0),Vi=t([d("esri.views.3d.analysis.Dimension.LengthDimensionComputation")],Vi);let Ei=class extends(g(e)){constructor(t){super(t),this.type="dimension-view-3d",this.analysis=null,this.tool=null,this.selectedDimension=null,this.userOperation=null,this._dimensionsToComputations=new Map,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=t=>{if(null==t)return null;const{spatialReference:e,elevationProvider:i}=this.view,n=zt(t,e,i);return null==n&&Lt(this.analysis,t.spatialReference,r.getLogger(this)),n};const t=a((()=>this.analysis.dimensions),(t=>this._createComputation(t)));this.computations=t,this.addHandles([f(this,Ci),i(t)]),this._analysisVisualization=new zi({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this.addResolvingPromise(Oe().then((t=>{this._analysisController=new Je({analysisViewData:this,view:this.view,automaticLengthMeasurementUtils:t})})))}destroy(){this.userOperation=m(this.userOperation),y(this),this._analysisVisualization=p(this._analysisVisualization)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map((t=>this._dimensionsToComputations.get(t).result))}get selectedComputation(){const{selectedDimension:t}=this;return null==t?null:this._dimensionsToComputations.get(t)}get testInfo(){}async createLengthDimensions(t){this.selectedDimension=null,await j(this,{placementOptions:t,onToolActivated:t=>t.place("multiple")})}place(t){return this.selectedDimension=null,j(this,{placementOptions:t,onToolActivated:t=>t.place("single")})}_createComputation(t){const{_dimensionsToComputations:e}=this,i=new Vi({dimension:t,projectAndAlignPoint:this._projectAndAlignPoint});return e.set(t,i),{computation:i,remove:()=>this._removeComputation(i)}}_removeComputation(t){const{dimension:e}=t;e===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(e),t.destroy()}};t([u({readOnly:!0})],Ei.prototype,"type",void 0),t([u({constructOnly:!0,nonNullable:!0})],Ei.prototype,"analysis",void 0),t([u()],Ei.prototype,"tool",void 0),t([u()],Ei.prototype,"updating",null),t([u({readOnly:!0})],Ei.prototype,"results",null),t([u()],Ei.prototype,"computations",void 0),t([u()],Ei.prototype,"selectedDimension",void 0),t([u()],Ei.prototype,"selectedComputation",null),t([u()],Ei.prototype,"userOperation",void 0),t([u()],Ei.prototype,"_analysisVisualization",void 0),t([u()],Ei.prototype,"_analysisController",void 0),t([u()],Ei.prototype,"_dimensionsToComputations",void 0),Ei=t([d("esri.views.3d.analysis.DimensionAnalysisView3D")],Ei);const Ii=Ei;export{Ii as default};
