/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import e from"../../core/Evented.js";import{a as n}from"../../chunks/events.js";import{d as i}from"../../chunks/maybe.js";import{watch as o,when as s,syncAndInitial as r,initial as l,sync as a}from"../../core/reactiveUtils.js";import{i as c,c as u}from"../../chunks/screenUtils.js";import{property as d}from"../../core/accessorSupport/decorators/property.js";import"../../core/lang.js";import"../../chunks/Logger.js";import{subclass as p}from"../../core/accessorSupport/decorators/subclass.js";import{s as h}from"../../chunks/modeUtils.js";import"../../core/Error.js";import m from"../../widgets/Widget.js";import{c as f,a as v}from"../../chunks/widgetUtils.js";import{t as g,a as _}from"../../chunks/jsxFactory.js";import{p as y}from"../../chunks/a11yUtils.js";import{m as k}from"../../chunks/memoize.js";import{throwIfNotAbortError as b,throwIfAborted as j,after as x}from"../../core/promiseUtils.js";import{waitAnimationFrame as w,waitTick as C}from"../../core/scheduling.js";import{u as T}from"../../chunks/unitFormatUtils.js";import{ae as M,af as I,ag as E}from"../../chunks/unitUtils.js";import{g as D}from"../../chunks/getDefaultUnitForView.js";import{t as $}from"../../chunks/keybindings.js";import{C as P}from"../../chunks/Cyclical.js";import{j as S,a as U,f as O,k as L,b as A,d as V}from"../../chunks/quantityFormatUtils.js";import{t as R,e as F,a as z}from"../../chunks/quantityUtils.js";import{isLoaded as H,fromLatitudeLongitude as X,fromLongitude as Y,fromLatitude as B}from"../../geometry/coordinateFormatter.js";import{f as K,p as N}from"../../chunks/number2.js";import{a as q}from"../../chunks/angularMeasurementUtils.js";import{l as W}from"../../chunks/componentsUtils.js";import{m as G}from"../../chunks/messageBundle.js";import{d as Q}from"../../chunks/directionModeIcons.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/Lifecycle.js";import"../../chunks/metadata.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/tracking.js";import"../../chunks/watch.js";import"../../chunks/SetUtils.js";import"../../chunks/SimpleTrackingTarget.js";import"../../config.js";import"../../chunks/ensureType.js";import"../../chunks/MapUtils.js";import"../../chunks/Warning.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../intl.js";import"../../chunks/date.js";import"../../chunks/jsonMap.js";import"../../chunks/locale.js";import"../../chunks/constants.js";import"../../chunks/datetime.js";import"../../chunks/substitute.js";import"../../chunks/messages.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/jsonUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/assets.js";import"../../chunks/domUtils.js";import"../../core/Promise.js";import"../../chunks/uuid.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/projector.js";import"../../chunks/sanitizerUtils.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/ByteSizeUnit.js";import"../../chunks/mathUtils.js";import"../../chunks/pe.js";import"../../portal/Portal.js";import"../../core/JSONSupport.js";import"../../core/Loadable.js";import"../../chunks/reader.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../geometry/SpatialReference.js";import"../../chunks/writer.js";import"../../geometry/Point.js";import"../../geometry/support/webMercatorUtils.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../chunks/InputManager.js";import"../../chunks/Queue.js";import"../../chunks/SimpleObservable.js";import"../../chunks/signal.js";import"../../chunks/vec2.js";import"../../chunks/common.js";import"../../chunks/vec2f64.js";import"../../chunks/vec3.js";import"../../chunks/vec3f64.js";import"../../chunks/projectVectorToVector.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/Axis.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../geometry/Polyline.js";import"../../chunks/projectBuffer.js";import"../../chunks/geodesicConstants.js";import"../../chunks/projectPointToVector.js";import"../../chunks/projectionUtils.js";import"../../chunks/projectXYZToVector.js";import"../../geometry/support/GeographicTransformation.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../chunks/zscale.js";import"../../chunks/dehydratedPoint.js";import"../../geometry/support/geodesicUtils.js";const Z="esri-tooltip",J=`${Z}-content`,tt=`${Z}-content--input`,et=`${Z}-content__header`,nt=`${Z}-content__header__spacer`,it=`${Z}-content__header__actions`,ot=`${Z}-draw-header-actions`,st=`${Z}-table`,rt=`${Z}-help-message`,lt=`${Z}-help-message__text`,at=`${Z}-help-message__icon`,ct=`${Z}-field`,ut={base:ct,inputMode:`${ct}--input`,title:`${ct}__title`,value:`${ct}__value`};let dt=class extends m{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return g("div",{class:this.classes({[ut.base]:!0,[ut.inputMode]:"input"===this.mode})},g("div",{class:ut.title,key:"title"},this.title),g("div",{class:ut.value,key:"value"},this.value))}};t([d()],dt.prototype,"hidden",void 0),t([d()],dt.prototype,"mode",void 0),t([d()],dt.prototype,"title",void 0),t([d()],dt.prototype,"value",void 0),dt=t([p("esri.views.interactive.tooltip.components.TooltipField")],dt);const pt={base:`${Z}-value-by-value`};let ht=class extends m{constructor(){super(...arguments),this.divider="×"}render(){return g("div",{class:pt.base},g("span",null,this.left),g("span",null,this.divider),g("span",null,this.right))}};function mt(t,e){return{angleRelative:ft,direction:vt,directionRelative:gt,directionRelativeBilateral:_t,latitudeDecimalDegrees:kt,longitudeDecimalDegrees:yt,area:(n,i)=>A(t,n,i??e.area),length:(n,i,o)=>O(t,n,i??e.length,o),lengthRelative:(n,i)=>L(t,n,i??e.length),totalLength:(n,i)=>O(t,n,i??e.length),verticalLength:(n,i)=>U(t,n,i??e.verticalLength),verticalLengthRelative:(n,i)=>S(t,n,i??e.verticalLength),percentage:Ct,scalar:Mt,scale:Tt}}function ft(t){return K(t,{signDisplay:"exceptZero",...It(1)})}function vt(t){return V(t,t.rotationType,1)}function gt(t){const e=q(t);return K(e,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:e>0?"never":"exceptZero",...It(1)})}function _t(t){return V(t,t.rotationType,1)}function yt(t){return xt(t,Rt)}function kt(t){return xt(t,Ft)}function bt(t){return wt(t,Rt)}function jt(t){return wt(t,Ft)}function xt(t,e){return V(R(t,"degrees"),"geographic",6,e,!1)}function wt(t,e){const n=e.normalize(R(t,"degrees").value,void 0,!1);return Mt(F(n),6)}function Ct(t){return K(t.value,{style:"percent"})}function Tt(t){return K(t,{style:"percent",maximumFractionDigits:0})}function Mt(t,e){return K(t.value,It(e))}function It(t){return{minimumFractionDigits:t,maximumFractionDigits:t}}function Et({createQuantity:t,sanitize:e}){return(n,i)=>{if(null==n)return null;e&&(n=e(n));const o=N(n);return null==o?null:t(o,i)}}function Dt(t){return t.replaceAll(/[*^~°º]/g,"")}t([d()],ht.prototype,"left",void 0),t([d()],ht.prototype,"divider",void 0),t([d()],ht.prototype,"right",void 0),ht=t([p("esri.views.interactive.tooltip.components.ValueByValue")],ht);const $t=t=>{let e=`[-+]?[0-9${t.thousands}]+`;return""!==t.decimal&&(e+=`${t.decimal}[0-9]+`),new RegExp(`^(${e}\\s*)${t.separator}(\\s*${e})$`,"i")},Pt=[];for(const t of[",","\\|","\\s+"])for(const e of["\\.",",",""])for(const n of["",",","\\."," ","\\s+"])t!==e&&t!==n&&e!==n&&Pt.push({separator:t,decimal:e,thousands:n,pattern:$t({decimal:e,thousands:n,separator:t})});function St(t){for(const{decimal:e,thousands:n,pattern:i}of Pt){i.lastIndex=0;const o=t.match(i);if(!o)continue;const s=N(Ut(o[1],e,n)),r=N(Ut(o[2],e,n));if(null!=s&&null!=r)return{x:F(s),y:F(r)}}return null}function Ut(t,e,n){let i=t.replaceAll(/[\s+]/g,"");return""!==n&&(i=i.replaceAll(n,"")),""!==e&&(i=i.replaceAll(e,".")),i}function Ot(t){if(!t||null!=N(t)||!H())return null;const e=X(t),n=Vt(e?.latitude),i=Vt(e?.longitude);return null!=i&&null!=n?{latitude:n,longitude:i}:null}function Lt(t){return Vt(Y(t))}function At(t){return Vt(B(t))}function Vt(t){return null!=t?z(t,"degrees","geographic"):null}const Rt=new P(-180,180),Ft=new P(-90,90),zt=Symbol("dragHandles");let Ht=class extends m{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=k(mt),this._onHeaderPointerDown=t=>{const e=t.target;e instanceof HTMLElement&&"calcite-button"!==e?.tagName?.toLowerCase()&&(this.removeHandles(zt),t.preventDefault(),t.stopPropagation(),e.setPointerCapture(t.pointerId),this.tooltip.onDragStart(t.clientX,t.clientY),this.addHandles([n(e,"pointermove",(({clientX:t,clientY:e})=>{this.tooltip.onDrag(t,e)})),n(e,["pointerup","pointercancel"],(n=>{this.removeHandles(zt),e.releasePointerCapture(t.pointerId),this.tooltip.onDragEnd()})),n(e,"touchstart",(t=>t.preventDefault()))],zt))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(t,e)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:e}),"commit-and-exit"===e)return void this.exitInputMode();if("commit-on-blur"===e)return;const n=this._getFocusableElements(),i=n.length,o=n.indexOf(t);if(-1===o)return void this.exitInputMode();const s=((o+("commit-and-next"===e?1:-1))%i+i)%i;Xt(n.at(s))},this._onKeyDown=t=>{switch(t.code){case $.next:return this._onNextKey(t);case $.discard:return t.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:t}=this.info.sketchOptions.values,e=D(this.tooltip.view);return{length:t.length??e,verticalLength:t.verticalLength??e,area:t.area??e}}get _inputUnitInfos(){const t=this._messagesUnits,e=e=>({unit:e,abbreviation:T(t,e,"abbr")}),{inputUnits:n}=this.info.sketchOptions.values,i=D(this.tooltip.view),o=n.length??i,s=n.verticalLength??i,r=n.area??i;return{length:e(E(o)),verticalLength:e(I(s)),area:e(M(r)),angle:e("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:t}=this.info.sketchOptions.tooltips,e=this._renderedContent,n=this._renderedActions,i=this._renderedHelpMessage,o=e.length>0,s=o||!!i,r="input"===this.mode;return g("div",{class:f(J,r&&tt),onkeydown:this._onKeyDown,tabIndex:-1},r&&s&&t.header?g("div",{class:et,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},g("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),n.length>0?g(_,null,g("div",{class:nt,key:"spacer"}),g("div",{class:it,key:"actions"},n)):null):null,o?g("div",{class:st,key:"content"},...e):null,i)}destroy(){this._focusAbortController.abort(),this._transitionInfo?.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return W({button:()=>import("../../chunks/index6.js"),icon:()=>import("../../chunks/index.js"),input:()=>import("../../chunks/index10.js")})}async enterInputMode(t,e){try{await this._transitionTo("input",e),await this._focusField(t)}catch(t){b(t)}}async exitInputMode({focusOnView:t=!0}={}){try{const{container:e,info:n}=this;n.clearInputValues();const i=t?e?.closest(".esri-view")?.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),i instanceof HTMLElement&&i.focus()}catch(t){b(t)}}_onNextKey(t){const e=this._getFocusableElements(),n=e.at(0),i=e.at(-1);n&&i&&(t.shiftKey?document.activeElement===n&&(t.preventDefault(),t.stopPropagation(),Xt(i)):document.activeElement===i&&(t.preventDefault(),t.stopPropagation(),Xt(n)))}get _renderedContent(){return Yt(this._renderContent())}get _renderedActions(){return Yt(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:t,visibleElements:e}=this.info;if(!e.helpMessage)return null;const n=t.tooltips.helpMessage??this._defaultHelpMessage;if(!n)return null;const i=t.tooltips.helpMessageIcon??"information";return g("div",{class:rt,key:"help-message"},i?g("calcite-icon",{class:at,icon:i,scale:"s"}):null,g("div",{class:lt},n))}get _defaultHelpMessage(){const{helpMessage:t,viewType:e}=this.info;if(null==t)return null;const n="3d"===e?"helpMessages3d":"helpMessages2d";return this._messagesTooltip?.sketch?.[n]?.[t]}async _focusField(t){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const{signal:e}=this._focusAbortController;await this._waitForInputs(),j(e);const n=this._getFocusableInputs(),i=t?n.find((e=>e.getAttribute("data-field-name")===t)):n.at(0);await Xt(i)}async _transitionTo(t,e){if(this._mode===t&&!this._transitionInfo)return;if(this._transitionInfo?.mode===t)return this._transitionInfo.transition.finished;this._transitionInfo?.transition.skipTransition();const n=async()=>{this.destroyed||(this._mode=t,await C(),this.destroyed||(this.renderNow(),await C(),this.destroyed||e?.()))};if(!this.domNode?.firstChild||!document.startViewTransition||y())return void await n();this.autoRenderingEnabled=!1;const i=this._transitionInfo={transition:document.startViewTransition((async()=>{this.destroyed||i!==this._transitionInfo||(this.autoRenderingEnabled=!0,await n())})),mode:t};try{await i.transition.finished}finally{i===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const t=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;0===t().length;)await x(Bt);await w()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const t=this.domNode?.querySelector(`.${ot}`);return[...Array.from(t?.querySelectorAll(`.${it} calcite-button:not([disabled])`)??[]),...this._getFocusableInputs()]}};async function Xt(t){await(t?.setFocus())}function Yt(t){return(Array.isArray(t)?t:[t]).flat(10).filter((t=>!!t))}t([G("esri/core/t9n/Units"),d()],Ht.prototype,"_messagesUnits",void 0),t([G("esri/views/interactive/tooltip/t9n/Tooltip"),d()],Ht.prototype,"_messagesTooltip",void 0),t([d()],Ht.prototype,"info",void 0),t([d()],Ht.prototype,"tooltip",void 0),t([d()],Ht.prototype,"_mode",void 0),t([d()],Ht.prototype,"mode",null),t([d()],Ht.prototype,"_displayUnits",null),t([d()],Ht.prototype,"_inputUnitInfos",null),t([d()],Ht.prototype,"_formatters",null),t([d()],Ht.prototype,"fieldContext",null),t([d()],Ht.prototype,"_renderedContent",null),t([d()],Ht.prototype,"_renderedActions",null),t([d()],Ht.prototype,"_renderedHelpMessage",null),t([d()],Ht.prototype,"_defaultHelpMessage",null),Ht=t([p("esri.views.interactive.tooltip.content.TooltipContent")],Ht);const Bt=20;let Kt=class extends Ht{_renderContent(){const{area:t,radius:e,xSize:n,ySize:i,visibleElements:o}=this.info,s=this._messagesTooltip.sketch,r=this._formatters;return g(_,null,o.radius&&null!=e?g(dt,{title:s.radius,value:r.length(e)}):null,o.size&&null!=n&&null!=i?g(dt,{title:s.size,value:g(ht,{left:r.length(n),right:r.length(i)})}):null,o.area?g(dt,{title:s.area,value:r.area(t)}):null)}};Kt=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],Kt);const Nt=`${Z}-editable-field`,qt={base:Nt,inputMode:`${Nt}--input`,feedbackMode:`${Nt}--feedback`,readOnly:`${Nt}--read-only`,locked:`${Nt}--locked`,title:`${Nt}__title`,value:`${Nt}__value`,valueContent:`${Nt}__value__content`,valueContentReadOnly:`${Nt}__value__content--read-only`,lockIcon:`${Nt}__lock-icon`,input:`${Nt}__input`,inputWrapper:`${Nt}__input-wrapper`,inputMessage:`${Nt}__input-message`,inputSuffix:`${Nt}__input-suffix`,button:`${Nt}__button`},Wt="lock";let Gt=class extends m{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=t=>{this._lock=t},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=t=>{t.key===$.discard&&"input"===this.mode&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=t=>{const e=this._input;if(e)switch(t.key){case $.commit:return this.field.onCommit("commit-and-exit",e,this.context);case $.next:{t.preventDefault(),t.stopPropagation();const n=t.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(n,e,this.context)}}},this._onInput=t=>{this.field.onInput(t.currentTarget.value)},this._onInputBlur=t=>{const e=this._input;e&&t.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",e,this.context)},this._selectText=()=>{const t=()=>{this._input===document.activeElement&&this._input?.selectText()};t(),w().then(t)},this._onAfterCreate=t=>{this._input=t,t.addEventListener("paste",this._onPaste),t.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=t=>{t.removeEventListener("paste",this._onPaste),t.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=t=>{const e=t.clipboardData?.getData("text");e&&null!=this.field.parse(e,this.context)&&(t.stopPropagation(),this.field.onInput(e))},this._onBeforeInput=t=>{("historyUndo"===t.inputType||"historyRedo"===t.inputType)&&!this.field.dirty&&t.preventDefault()}}initialize(){this.addHandles(o((()=>this._rawDisplayValue),(()=>{const{committed:t,inputValue:e}=this.field;t||e||this._input!==document.activeElement||this._selectText()})))}loadDependencies(){return W({button:()=>import("../../chunks/index6.js"),icon:()=>import("../../chunks/index.js"),input:()=>import("../../chunks/index10.js"),"input-message":()=>import("../../chunks/index38.js")})}render(){const{field:t,mode:e}=this,n="input"===e,{locked:i,readOnly:o}=t;return g("div",{class:this.classes({[qt.base]:!0,[qt.feedbackMode]:"feedback"===e,[qt.inputMode]:"input"===e,[qt.locked]:i,[qt.readOnly]:o})},g("div",{class:qt.title,key:"title"},this._title),g("div",{class:qt.value,key:"value",onkeydown:this._onKeyDown},n?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||Qt}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:t}=this.field;return"string"==typeof t?t:t(this.context)}get _messages(){return this.context?.messages.sketch??{}}_renderValueFeedbackMode(){return g(_,null,g("div",{class:qt.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&"input"!==this.mode?g("calcite-icon",{class:qt.lockIcon,icon:Wt,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return g("div",{class:this.classes(qt.valueContent,qt.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:t}=this,e=this._messages,{name:n,invalid:i}=t;return g(_,null,g("div",{class:qt.inputWrapper,key:"value-input"},g("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:qt.input,"data-field-name":n,"data-testid":`tooltip-field-${n}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:i?"invalid":"idle",type:"text",value:this._rawDisplayValue??Qt,onCalciteInputInput:this._onInput}),i?g("calcite-input-message",{class:qt.inputMessage,scale:"s",status:"invalid"},e.invalidValue):null),g("div",{class:qt.inputSuffix,key:"suffix"},this._suffix),this._renderedLockButton)}get _renderedLockButton(){const{name:t,locked:e,lockable:n}=this.field;if(!n)return g("div",{key:"no-lock-button"});const i=this._messages,o=e?i.unlockConstraint:i.lockConstraint;return g("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:qt.button,"data-testid":`tooltip-field-${t}-lock`,iconStart:e?Wt:"unlock",key:"lock-button",kind:"neutral",label:o,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:o})}};t([d()],Gt.prototype,"field",void 0),t([d()],Gt.prototype,"context",void 0),t([d()],Gt.prototype,"mode",void 0),t([d()],Gt.prototype,"_input",void 0),t([d()],Gt.prototype,"_lock",void 0),t([d()],Gt.prototype,"_formattedValue",null),t([d()],Gt.prototype,"_rawDisplayValue",null),t([d()],Gt.prototype,"_suffix",null),t([d()],Gt.prototype,"_title",null),t([d()],Gt.prototype,"_messages",null),t([d()],Gt.prototype,"_renderedLockButton",null),Gt=t([p("esri.views.interactive.tooltip.components.TooltipEditableField")],Gt);const Qt="—";function Zt(t){const e=t.fields.filter((t=>!0===t?.visible));return 0===e.length?null:g(_,null,e.map((e=>g(Gt,{context:t.context,field:e,key:e.id,mode:t.mode}))))}let Jt=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return g(Zt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.scale?e.scale:void 0],mode:n})}};Jt=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],Jt);let te=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{elevation:i,visibleElements:o}=e;return g(Zt,{context:t,fields:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0,o.elevation?i:void 0],mode:n})}};te=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],te);let ee=class extends m{constructor(t){super(t),this.visibleElements={}}render(){return g("div",{class:ot},this._isElementVisible("direction")?g(ne,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return W({button:()=>import("../../chunks/index6.js"),dropdown:()=>import("../../chunks/index7.js"),"dropdown-item":()=>import("../../chunks/index8.js"),"dropdown-group":()=>import("../../chunks/index9.js")})}_isElementVisible(t){return this.visibleElements?.[t]??this.sketchOptions.tooltips.visibleElements[t]}};function ne(t){const{directionMode:e}=t.sketchOptions.values,n=t.messages?.sketch,i=n?.directionModeSelect?.title,o="absolute",s="relative";return g("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:e=>{const n=e.currentTarget.selectedItems?.[0]?.getAttribute("data-mode");t.sketchOptions.values.directionMode=n??"absolute"}},g("calcite-button",{alignment:"end",appearance:"transparent",iconStart:Q[e],kind:"neutral",label:i,scale:"s",slot:"trigger",title:i}),g("calcite-dropdown-group",{selectionMode:"single"},g("calcite-dropdown-item",{"data-mode":s,"data-testid":"tooltip-direction-mode-relative",iconStart:Q.relative,key:"relative",selected:e===s},n?.directionModeSelect?.relative),g("calcite-dropdown-item",{"data-mode":o,"data-testid":"tooltip-direction-mode-absolute",iconStart:Q.absolute,key:"absolute",selected:e===o},n?.directionModeSelect?.absolute)))}t([G("esri/views/interactive/tooltip/t9n/Tooltip"),d()],ee.prototype,"messages",void 0),t([d()],ee.prototype,"sketchOptions",void 0),t([d()],ee.prototype,"visibleElements",void 0),ee=t([p("esri.views.interactive.tooltip.components.DrawHeaderActions")],ee);let ie=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:i,visibleElements:o}=e;return g(Zt,{context:t,fields:[..."direction-distance"===i?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.area?e.area:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return g(ee,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};ie=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],ie);let oe=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{xyMode:i,visibleElements:o}=e;return g(Zt,{context:t,fields:[..."direction-distance"===i?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.totalLength?e.totalLength:void 0],mode:n})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return g(ee,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};oe=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],oe);let se=class extends Ht{_renderContent(){const{area:t,xSize:e,ySize:n,visibleElements:i}=this.info,o=this._messagesTooltip.sketch,s=this._formatters;return g(_,null,i.size&&null!=e&&null!=n?g(dt,{title:o.size,value:g(ht,{left:s.length(e),right:s.length(n)})}):null,i.area?g(dt,{title:o.area,value:s.area(t)}):null)}};se=t([p("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],se);let re=class extends Ht{_renderContent(){const{angle:t,visibleElements:e}=this.info,n=this._messagesTooltip.sketch;return g(_,null,e.rotation?g(dt,{title:n.rotation,value:this._formatters.angleRelative(t)}):null)}};re=t([p("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],re);let le=class extends Ht{_renderContent(){const t=this.info,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return g(_,null,e.size?g(dt,{title:n.size,value:g(ht,{left:i.length(t.xSize),right:i.length(t.ySize)})}):null,e.scale?g(dt,{title:n.scale,value:g(ht,{left:i.scale(t.xScale),right:i.scale(t.yScale)})}):null)}};le=t([p("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],le);let ae=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return g(Zt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0],mode:n})}};ae=t([p("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],ae);let ce=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return g(Zt,{context:t,fields:[i.distance?e.distance:void 0,i.area?e.area:void 0,i.totalLength?e.totalLength:void 0],mode:n})}};ce=t([p("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],ce);let ue=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return g(Zt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.area&&"polygon"===e.geometryType?e.area:null,i.totalLength&&"polyline"===e.geometryType?e.totalLength:null],mode:n})}};ue=t([p("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],ue);let de=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return g(Zt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.scale?e.scale:void 0],mode:n})}};de=t([p("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],de);let pe=class extends Ht{_renderContent(){const{fieldContext:t,info:e,mode:n}=this,{visibleElements:i}=e;return g(Zt,{context:t,fields:[i.coordinates?e.effectiveX:void 0,i.coordinates?e.effectiveY:void 0,i.elevation?e.elevation:void 0,i.orientation?e.orientation:void 0,i.size?e.size:void 0],mode:n})}};pe=t([p("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],pe);let he=class extends Ht{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return g(_,null,e.distance?g(dt,{title:n.distance,value:i.length(t.distance)}):null)}};he=t([p("esri.views.interactive.tooltip.content.TooltipContentTranslate")],he);let me=class extends Ht{_renderContent(){const{distance:t,elevation:e,area:n,totalLength:i,visibleElements:o}=this.info,s=this._messagesTooltip.sketch,r=this._formatters;return g(_,null,o.distance?g(dt,{title:s.distance,value:r.length(t)}):null,o.elevation&&null!=e?.actual?g(dt,{title:s.elevation,value:r.verticalLength(e.actual)}):null,o.area&&null!=n?g(dt,{title:s.area,value:r.area(n)}):null,o.totalLength&&null!=i?g(dt,{title:s.totalLength,value:r.length(i)}):null)}};me=t([p("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],me);let fe=class extends Ht{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch,i=this._formatters;return g(_,null,e.distance?g(dt,{title:n.distance,value:i.length(t.distance)}):null)}};fe=t([p("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],fe);let ve=class extends Ht{_renderContent(){const{info:t}=this,{visibleElements:e}=t,n=this._messagesTooltip.sketch;return g(_,null,e.distance?g(dt,{title:n.distance,value:this._formatters.verticalLengthRelative(t.distance)}):null)}};ve=t([p("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],ve);const ge={base:`${Z}`,ltr:`${Z}--ltr`,rtl:`${Z}--rtl`,debug:`${Z}--debug`};let _e=class extends e.EventedAccessor{constructor(t){super(t),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:t}=this;this.addHandles([o((()=>this.view.overlay?.surface),(e=>{t.remove(),e?.appendChild(t),this._rtl=v(e)}),r),o((()=>this.info),((e,n)=>{if(null!=this.content&&null!=e&&null!=n&&e.type===n.type)this.content.info=e;else{i(this.content);const n=function(t,e){if(null==e)return null;const n=document.createElement("div");switch(e.type){case"draw-point":case"draw-multipoint":return new te({tooltip:t,info:e,container:n});case"draw-polygon":return new ie({tooltip:t,info:e,container:n});case"draw-polyline":return new oe({tooltip:t,info:e,container:n});case"draw-mesh":return new Jt({tooltip:t,info:e,container:n});case"draw-rectangle":return new se({tooltip:t,info:e,container:n});case"draw-circle":return new Kt({tooltip:t,info:e,container:n});case"extent-rotate":return new re({tooltip:t,info:e,container:n});case"extent-scale":return new le({tooltip:t,info:e,container:n});case"move-point":return new ae({tooltip:t,info:e,container:n});case"selected-vertex":return new ue({tooltip:t,info:e,container:n});case"transform-point":return new pe({tooltip:t,info:e,container:n});case"transform-mesh":return new de({tooltip:t,info:e,container:n});case"translate":return new he({tooltip:t,info:e,container:n});case"translate-vertex":return new me({tooltip:t,info:e,container:n});case"translate-z":return new ve({tooltip:t,info:e,container:n});case"translate-xy":return new fe({tooltip:t,info:e,container:n});case"reshape-edge-offset":return new ce({tooltip:t,info:e,container:n})}}(this,e);n?(this.content=n,n.container&&t.appendChild(n.container),this.exitInputMode()):this.content=null}}),r),o((()=>({container:this.outerContainer,style:this._outerContainerStyle})),(({container:t,style:e})=>{Object.assign(t.style,e)}),l),o((()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug})),(({outerContainer:t,placement:e,effectiveOffset:n,rtl:i,debug:o})=>{const{classList:s}=t;s.add(ge.base),s.toggle(ge.rtl,i),s.toggle(ge.ltr,!i),s.toggle(ge.debug,o),this.outerContainer.style.setProperty("--offset",`${n}px`),h(t),function({classList:t},e){ye.forEach((e=>t.remove(e))),t.add(ke(e))}(t,e)}),l),s((()=>"feedback"===this.mode),(()=>{this.position=null,this._clearOverride("effectivePlacement")}),a),n(this.outerContainer,"paste",(t=>{this.emit("paste",t)})),n(this.outerContainer,["focusin","focusout"],(()=>{this._focused=this.content?.container?.contains(document.activeElement)??!1}))])}destroy(){this.info=null,this.content=i(this.content),this.outerContainer.remove()}get mode(){return this.content?.mode??"feedback"}get focused(){return this._focused}get visible(){return"none"!==this._outerContainerStyle.display}get contentContainer(){return this.content?.container}get effectivePlacement(){const t=this.options?.placement;return"auto"===t?"bottom-end":t??"bottom-end"}get _screenPoint(){const{inputManager:t}=this.view;return t?.multiTouchActive?null:t?.latestPointerLocation}get _effectiveOffset(){return this.options?.offset??20}get _outerContainerStyle(){const t=this.position??this._screenPoint;return this._lastPosition=c(t),null!=t&&null!=this.content?{display:"block",transform:`translate(${Math.round(t.x)}px, ${Math.round(t.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(t){const e=this.position??this._lastPosition??this._screenPoint,n=this.position=c(e),{effectivePlacement:i}=this;this._override("effectivePlacement",i),await(this.content?.enterInputMode(t,(()=>{n&&(this.position=function(t,e,n,i){if(!t||!i.container)return e;const o=t.getBoundingClientRect(),{left:s,top:r}=i.container.getBoundingClientRect();let{x:l,y:a}=e;const c=o.left-s-n;c<0&&(l-=c);const d=o.right-s+n-i.width;d>0&&(l-=d);const p=o.top-r-n;p<0&&(a-=p);const h=o.bottom-r+n-i.height;return h>0&&(a-=h),u(l,a)}(this.contentContainer,n,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))})))}async exitInputMode(t){await(this.content?.exitInputMode(t))}onDragStart(t,e){this._prevXY=[t,e]}onDrag(t,e){const n=t-this._prevXY[0],i=e-this._prevXY[1];this._prevXY=[t,e];const{position:o}=this;if(o){const{view:s}=this,r=t-s.position[0],l=e-s.position[1];if(r<0||r>s.width||l<0||l>s.height-16)return;this.position=u(o.x+n,o.y+i)}}onDragEnd(){this._prevXY=[0,0]}};t([d({nonNullable:!0})],_e.prototype,"view",void 0),t([d()],_e.prototype,"info",void 0),t([d()],_e.prototype,"options",void 0),t([d()],_e.prototype,"position",void 0),t([d()],_e.prototype,"content",void 0),t([d({readOnly:!0})],_e.prototype,"mode",null),t([d()],_e.prototype,"_focused",void 0),t([d({readOnly:!0})],_e.prototype,"focused",null),t([d({readOnly:!0})],_e.prototype,"outerContainer",void 0),t([d({readOnly:!0})],_e.prototype,"contentContainer",null),t([d({readOnly:!0})],_e.prototype,"effectivePlacement",null),t([d()],_e.prototype,"debug",void 0),t([d()],_e.prototype,"_lastPosition",void 0),t([d()],_e.prototype,"_screenPoint",null),t([d()],_e.prototype,"_rtl",void 0),t([d()],_e.prototype,"_effectiveOffset",null),t([d()],_e.prototype,"_outerContainerStyle",null),_e=t([p("esri.views.interactive.Tooltip")],_e);const ye=["top","bottom","leading","trailing"].flatMap((t=>[ke(`${t}-start`),ke(t),ke(`${t}-end`)]));function ke(t){return`${ge.base}--${t}`}const be=_e;export{St as a,Lt as b,jt as c,At as d,be as default,Vt as e,bt as f,Et as m,Ot as p,Dt as s};
