/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../intl.js";import"../core/lang.js";import{g as t}from"../chunks/MapUtils.js";import{watch as s,on as o}from"../core/reactiveUtils.js";import{property as i}from"../core/accessorSupport/decorators/property.js";import"../chunks/Logger.js";import{subclass as r}from"../core/accessorSupport/decorators/subclass.js";import{isIntegerField as n}from"../layers/support/fieldUtils.js";import{b as a}from"../chunks/guards.js";import p from"./Widget.js";import l,{g as m,a as u,i as d}from"./BatchAttributeForm/BatchAttributeFormViewModel.js";import c from"../core/Accessor.js";import{I as h,a as j,i as b,d as y}from"../chunks/inputUtils.js";import{l as f}from"../chunks/componentsUtils.js";import{g as k,a as v,p as g,h as C,n as I,f as _,e as F}from"../chunks/dateUtils.js";import{g as x}from"../chunks/globalCss.js";import{b as S}from"../chunks/widgetUtils.js";import{m as w}from"../chunks/messageBundle.js";import{v as M}from"../chunks/vmEvent.js";import{t as U}from"../chunks/jsxFactory.js";import{i as T}from"../chunks/formUtils2.js";import{s as D}from"../chunks/substitute.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../config.js";import"../chunks/locale.js";import"../chunks/handleUtils.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"../chunks/number2.js";import"../chunks/messages.js";import"../core/Error.js";import"../core/promiseUtils.js";import"../chunks/events.js";import"../chunks/maybe.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/assets.js";import"../chunks/watch.js";import"../chunks/ObjectPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/Lifecycle.js";import"../chunks/tracking.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/ensureType.js";import"../chunks/metadata.js";import"../chunks/Warning.js";import"../core/sql.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Handles.js";import"../chunks/ObservableBase.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/sanitizerUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/asyncUtils.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/ReactiveMap.js";import"../chunks/UpdatingHandles.js";import"../geometry/SpatialReference.js";import"../core/JSONSupport.js";import"../chunks/unitUtils.js";import"../chunks/pe.js";import"../chunks/writer.js";import"../arcade.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../chunks/reader.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils2.js";import"../chunks/mathUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../geometry/support/jsonUtils.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils2.js";import"../chunks/createFeatureId.js";import"../chunks/typeUtils.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils5.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils6.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/vec3f64.js";import"../chunks/aaBoundingBox.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/TimeOnly.js";import"../chunks/enum.js";import"../chunks/UnknownTimeZone.js";import"../chunks/ImmutableArray.js";import"../layers/FeatureLayer.js";import"../chunks/MultiOriginJSONSupport.js";import"../chunks/layerContainerType.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/AttachmentElement.js";import"../form/elements/Element.js";import"../form/elements/inputs/attachments/AttachmentInput.js";import"../chunks/Input.js";import"../form/elements/inputs/attachments/AudioInput.js";import"../chunks/utils7.js";import"../form/elements/inputs/attachments/DocumentInput.js";import"../form/elements/inputs/attachments/ImageInput.js";import"../form/elements/inputs/attachments/SignatureInput.js";import"../form/elements/inputs/attachments/VideoInput.js";import"../form/elements/FieldElement.js";import"../form/elements/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DatePickerInput.js";import"../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../form/elements/inputs/TimePickerInput.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/formUtils.js";import"../form/elements/RelationshipElement.js";import"../form/elements/TextElement.js";import"../form/elements/UtilityNetworkAssociationsElement.js";import"../layers/Layer.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../chunks/editsZScale.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../rest/support/FeatureSet.js";import"../layers/support/Field.js";import"../chunks/fieldType.js";import"../layers/mixins/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../layers/mixins/BlendLayer.js";import"../chunks/jsonUtils2.js";import"../chunks/parser.js";import"../chunks/utils2.js";import"../chunks/mat4.js";import"../chunks/common.js";import"../layers/mixins/CustomParametersMixin.js";import"../layers/mixins/DisplayFilteredLayer.js";import"../layers/support/DisplayFilterInfo.js";import"../chunks/scaleUtils.js";import"../layers/support/DisplayFilter.js";import"../chunks/displayFilterUtils.js";import"../chunks/EditBusLayer.js";import"../layers/mixins/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../chunks/FullTextSearch.js";import"../chunks/spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../layers/mixins/FeatureLayerBase.js";import"../geometry/HeightModelInfo.js";import"../chunks/commonProperties.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"../tables/AttributeTableTemplate.js";import"../tables/elements/AttributeTableGroupElement.js";import"../tables/elements/AttributeTableAttachmentElement.js";import"../tables/elements/AttributeTableElement.js";import"../tables/elements/AttributeTableFieldElement.js";import"../tables/elements/AttributeTableRelationshipElement.js";import"../chunks/timeZoneUtils.js";import"../chunks/featureLayerUtils.js";import"../chunks/featureQueryAll.js";import"../chunks/layerUtils.js";import"../layers/catalog/catalogUtils.js";import"../renderers/SimpleRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/visualVariableUtils.js";import"../chunks/commonProperties2.js";import"../symbols/support/jsonUtils.js";import"../chunks/defaults.js";import"../chunks/defaultsJSON.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../chunks/RendererLegendOptions.js";import"../renderers/support/UniqueValue.js";import"../renderers/support/UniqueValueClass.js";import"../renderers/support/UniqueValueGroup.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils.js";import"../rest/support/AttachmentQuery.js";import"../rest/support/NormalizationBinParametersMixin.js";import"../rest/support/RelationshipQuery.js";import"../layers/support/GeometryFieldsInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"../chunks/serviceCapabilitiesUtils.js";import"../chunks/infoFor3D.js";import"../layers/support/Subtype.js";import"../chunks/portalItemUtils.js";import"../chunks/projectionUtils.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../chunks/projectXYZToVector.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../layers/mixins/FeatureReductionLayer.js";import"../layers/support/AggregateField.js";import"../layers/support/ExpressionInfo.js";import"../chunks/FeatureReduction.js";import"../layers/support/FeatureReductionBinning.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../renderers/support/jsonUtils.js";import"../chunks/typeUtils3.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/support/ClassBreakInfo.js";import"../renderers/DictionaryRenderer.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/DictionaryScriptEvaluator.js";import"../chunks/Version.js";import"../layers/support/FieldsIndex.js";import"../chunks/ArcadeExpression.js";import"../chunks/utils3.js";import"../chunks/defaultCIMValues.js";import"../chunks/enums2.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../chunks/vec4.js";import"../chunks/vec4f64.js";import"../renderers/PieChartRenderer.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/FeatureReductionSelection.js";import"../chunks/clusterUtils.js";import"../chunks/MD5.js";import"../layers/mixins/OperationalLayer.js";import"../layers/mixins/OrderedLayer.js";import"../layers/support/OrderByInfo.js";import"../layers/mixins/PortalLayer.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../layers/mixins/PublishableLayer.js";import"../layers/support/PublishingInfo.js";import"../layers/mixins/RefreshableLayer.js";import"../layers/mixins/ScaleRangeLayer.js";import"../layers/mixins/TemporalLayer.js";import"../layers/support/TimeInfo.js";import"../time/TimeInterval.js";import"../layers/mixins/TrackableLayer.js";import"../layers/support/TrackInfo.js";import"../layers/support/TrackPartInfo.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../chunks/labelingInfo.js";import"../chunks/TitleCreator.js";import"../chunks/versionUtils.js";import"../chunks/styleUtils2.js";import"../support/popupUtils.js";import"../chunks/interfaces.js";import"./BatchAttributeForm/inputs/BatchFormInputs.js";import"./BatchAttributeForm/inputs/FieldInput.js";import"../chunks/utils14.js";import"../chunks/basemapUtils.js";import"../chunks/basemapDefinitions.js";import"./BatchAttributeForm/inputs/EditableInput.js";import"./BatchAttributeForm/inputs/InputBase.js";import"./BatchAttributeForm/inputs/GroupInput.js";import"../chunks/LayerContingentValuesCache.js";import"../chunks/featureFormUtils.js";const V="esri-batch-attribute-form",O=`${V}__group`,L=`${V}__input`,R={base:V,noticeError:`${V}__notice-error`,label:`${V}__label`,labelTextContent:`${V}__label-text-content`,fieldInput:`${L}`,inputRadio:`${L}--radio`,placeholderRadio:`${L}--radio-placeholder`,inputRadioGroup:`${L}--radio-group`,inputRadioLabel:`${L}--radio-label`,inputDisabled:`${L}--disabled`,inputSwitch:`${L}--switch`,description:`${V}__description-text`,dateInputContainer:`${V}__date-input-container`,group:O,groupSequential:`${O}--sequential`,individualElement:`${O}__individual-element`};let E=class extends c{constructor(e){super(e),this.errorsForNonVisibleFields=!0,this.featureInfo=!0,this.featureSwitcher=!0,this.loadingIndicator=!0}};e([i({type:Boolean,nonNullable:!0})],E.prototype,"errorsForNonVisibleFields",void 0),e([i({type:Boolean,nonNullable:!0})],E.prototype,"featureInfo",void 0),e([i({type:Boolean,nonNullable:!0})],E.prototype,"featureSwitcher",void 0),e([i({type:Boolean,nonNullable:!0})],E.prototype,"loadingIndicator",void 0),E=e([r("esri.widgets.BatchAttributeForm.VisibleElements")],E);const P="data-element-id";let B=class extends p{constructor(e,t){super(e,t),this.headingLevel=2,this.messagesCommon=null,this.messages=null,this.featureFormMessages=null,this.viewModel=new l,this.visibleElements=new E,this.groupDisplay="all",this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._touchedInputs=new Set,this._focusedFieldInput=null,this._batchSwitchInputInitialValues=new Map,this._saveInput=this._saveInput.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([s((()=>this.features),(()=>{this._dateComponentMap.clear()})),s((()=>this.viewModel.activeForm),(()=>{this._batchSwitchInputInitialValues.clear()})),o((()=>this.viewModel),"submit",(()=>{this.valid||this.goToClosestError()}))])}loadDependencies(){return f({input:()=>import("../chunks/index10.js"),block:()=>import("../chunks/index29.js"),button:()=>import("../chunks/index6.js"),combobox:()=>import("../chunks/index30.js"),"combobox-item":()=>import("../chunks/index31.js"),"combobox-item-group":()=>import("../chunks/index45.js"),dropdown:()=>import("../chunks/index7.js"),"dropdown-group":()=>import("../chunks/index9.js"),"dropdown-item":()=>import("../chunks/index8.js"),"input-date-picker":()=>import("../chunks/index13.js"),"input-number":()=>import("../chunks/index34.js"),"input-time-picker":()=>import("../chunks/index14.js"),"input-time-zone":()=>import("../chunks/index40.js"),label:()=>import("../chunks/index2.js"),"input-message":()=>import("../chunks/index38.js"),loader:()=>import("../chunks/index28.js"),notice:()=>import("../chunks/index20.js"),switch:()=>import("../chunks/index3.js"),"text-area":()=>import("../chunks/index46.js"),"radio-button":()=>import("../chunks/index23.js"),"radio-button-group":()=>import("../chunks/index24.js")})}get activeFeatureIndex(){return this.viewModel.activeFeatureIndex}set activeFeatureIndex(e){this.viewModel.activeFeatureIndex=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get _effectiveDisabled(){return this.disabled||this.viewModel.updating}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get icon(){return"edit-attributes"}set icon(e){this._overrideIfSome("icon",e)}get readOnly(){return this.viewModel.readOnly}set readOnly(e){this.viewModel.readOnly=e}get valid(){return this.viewModel.valid}goToClosestError(){const e=this.viewModel.getFirstVisibleInvalidFieldInput();if(!e)return;const{groupInput:t}=e;t&&(t.open||(t.open=!0)),this._focusedFieldInput=e.input,this._attemptFocusOnNextRender=!0,this.scheduleRender()}render(){const{status:e}=this.viewModel;return"failed"===e?this.viewModel.hasTooManyComplexFeatures?this._renderErrorNotice(D(this.messages.formFailedToLoadTooManyComplexFeatures,{num:this.viewModel.maximumFeatureCountWithComplexForms})):this.viewModel.hasTooManyFeatures?this._renderErrorNotice(D(this.messages.formFailedToLoadTooManyFeatures,{num:this.viewModel.maximumFeatureCount})):this._renderErrorNotice(this.messages.formFailedToLoad):this.viewModel.expressionEvaluationFailed?this._renderErrorNotice(this.messages.expressionEvaluationFailed):this.viewModel.hasLayersWithContingentValues?this._renderErrorNotice(this.messages.unsupportedContingentValues):U("div",{class:this.classes(R.base,x.widget,x.panel)},"loaded"===e?this._renderForm():"loading"===e&&this.visibleElements.loadingIndicator?U("calcite-loader",{key:"loader",label:this.messagesCommon?.loading}):null)}submit(){this.viewModel.submit()}_setDateTimeTimeZoneMap(e){const{datePart:s,elementId:o}=e.dataset,i=t(this._dateComponentMap,`${o}`,(()=>({})));switch(s){case"date":i.date=e;break;case"time":i.time=e;break;case"timeZone":i.timeZone=e}}_renderErrorNotice(e){return U("div",{class:this.classes(R.base,x.widget,x.panel)},U("calcite-notice",{class:R.noticeError,icon:!0,kind:"warning",open:!0},U("div",{slot:"message"},e)))}_renderForm(){return U("form",{onsubmit:this._onFormSubmit},this._renderInvisibleFieldsError(),this._renderContent())}_renderInvisibleFieldsError(){const{viewModel:e}=this,{hasNonActiveInvalidFeatures:t,activeForm:s}=e;let o;if(!e.submitHasBeenAttempted)return null;if(s.invalidHiddenInputs.length>0)if(o=m(s,e.mode,this.messages),"batch"===this.viewModel.mode){const e=s.invalidHiddenInputs.filter((e=>e.effectiveVisibilityCode===h.HIDDEN_GROUP_VISIBILITY_EXPRESSION_ALL||e.visibilityCode===h.HIDDEN_VISIBILITY_EXPRESSION_ALL));e.length>0?o+=` (${e.map((e=>e.label)).join(", ")})`:o=null}else o+=` (${s.invalidHiddenInputs.map((e=>e.label)).join(", ")})`;else if(t)return null;return o?U("calcite-notice",{class:R.noticeError,icon:!0,kind:"danger",open:!0},U("div",{slot:"message"},o)):null}_renderContent(){if(!this.viewModel.hasVisibleInputs)return[U("calcite-notice",{class:R.noticeError,icon:!0,kind:"warning",open:!0},U("div",{slot:"message"},this.messages.noVisibleFields[this.viewModel.noVisibleElementsReason]))];const{inputs:e}=this.viewModel.activeForm;return e.filter((e=>e.visible)).map((e=>this._renderInput(e)))}_renderInput(e){return j(e)?this._renderGroupInput(e):b(e)?this._renderLabeledField(e):void 0}_renderGroupInput(e){const{inputs:t,template:s,open:o}=e,i=t.filter((e=>e.visible)),r=s.label??"";return U("calcite-block",{class:this.classes(R.group,"sequential"===this.groupDisplay?R.groupSequential:null,this.disabled?R.inputDisabled:null),collapsible:!0,description:s.description??void 0,disabled:this._effectiveDisabled,expanded:o,heading:r,headingLevel:this.headingLevel,key:`{${s.elementId}-key}`,label:r,onCalciteBlockClose:()=>{e.open=!1},onCalciteBlockOpen:()=>{e.open=!0}},i.map((e=>this._renderInput(e))))}_renderLabeledField(e){const{label:t,elementId:s}=e.template,{required:o,dataType:i}=e,r=o?D(this.messages.requiredFieldLabel,{name:t}):t;return U("calcite-label",{"aria-label":r,class:R.label,key:`field--${s}`},U("div",{class:R.labelTextContent,key:"labelTextContainer"},t,o?U("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==i?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e))}_renderFieldInput(e){const t=this.getCommonInputProps(e),{dataType:s}=e;return"date"===s?this._renderDateComponents(e,t):"coded-value"===e.domain?.type?this._renderCodedInputs({input:e,props:t}):"number"===s?this._renderNumberComponent(e,t):this._renderStringComponent(e,t)}_renderAuxiliaryText(e){const{compositeError:t,description:s,submittable:o}=e,i=!o&&t&&(this.viewModel.submitHasBeenAttempted||this._touchedInputs.has(e.template.elementId))?u(e,t,this.messages):null;return i?U("calcite-input-message",{icon:!0,status:"invalid"},i):s?U("calcite-input-message",{class:R.description,icon:!1,status:"idle"},s):null}_renderCodedInputs({input:e,props:t}){const s=e.template.input?.type??null,o=e.codedValueOptions;switch(s){case"switch":return this._renderSwitchField({input:e,props:t});case"radio-buttons":return this._renderRadioButtonGroupComponent({input:e,options:o.flat(),props:t});default:return this._renderComboBoxComponent({options:o,props:t,input:e})}}_renderSwitchField({input:e,props:t}){if((this._batchSwitchInputInitialValues.get(e)===y||e.value===y)&&"batch"===this.viewModel.mode){const s={dropdown:{afterCreate:this._afterComponentCreateOrUpdate,afterUpdate:this._afterComponentCreateOrUpdate,disabled:t.readOnly,open:!1,[P]:t[P]},trigger:{appearance:"transparent",iconEnd:"chevron-down",kind:"neutral",slot:"trigger",label:t.label},group:{mode:"single"}};return this._renderDropdownComponent({buttonValue:e.value,dropdownProps:s,options:[{name:this.messages.differentValuesPlaceholder,value:y,disabled:!0},...e.codedValueDomainOptions]})}return this._renderSwitchComponent({input:e,props:t})}_renderSwitchComponent({input:e,props:t}){return U("calcite-switch",{...t,checked:!!d(e.template,"switch")&&e.value===e.template.input.onValue,class:R.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldInput=null},onCalciteSwitchChange:({currentTarget:e})=>this._saveInput(e)})}_renderDropdownComponent({buttonValue:e,options:t,dropdownProps:s}){const{trigger:o,dropdown:i,group:r}=s;return U("calcite-dropdown",{...i,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,onCalciteDropdownSelect:({currentTarget:e})=>this._saveInput(e)},U("calcite-button",{...o},e===y?this.messages.differentValuesPlaceholder:e),U("calcite-dropdown-group",{selectionMode:r.mode},t.map((t=>U("calcite-dropdown-item",{disabled:t.disabled,label:String(t.name),selected:e===t.value},t.name)))))}_renderComboBoxComponent({input:e,options:t,props:s}){const o="INSERT"===this.viewModel.editType,i=this._touchedInputs.has(e?.template?.elementId),r=o&&e.showNoValueOptionEnabled&&!i?()=>{}:s.onblur,n={...s,onblur:r};return U("calcite-combobox",{...n,selectionMode:"single",value:s.placeholder===this.messages.differentValuesPlaceholder?y:String(s.value),onCalciteComboboxChange:({currentTarget:e})=>{e.value!==y&&this._saveInput(e)}},this.renderComboboxOptionsList({input:e,options:t,props:s}))}renderComboboxOptionsList({input:e,options:t,props:s}){const[o,i]=t.map((e=>e.map((({name:e,value:t})=>U("calcite-combobox-item",{key:`#${t}`,selected:s.value===t,textLabel:e,value:`${t}`}))))),r=[...o];i.length>0&&r.push(U("calcite-combobox-item-group",{key:"unsupported",label:this.featureFormMessages.subtypes.unsupportedDomainGroupTitle},i));const n=s.placeholder===this.messages.differentValuesPlaceholder,a=!n&&T(s.value);return e.showNoValueOptionEnabled&&r.unshift(U("calcite-combobox-item",{key:"empty-option",selected:a,textLabel:e.showNoValueLabel||this.messages.empty,value:""})),n&&r.unshift(U("calcite-combobox-item",{key:y,selected:!0,textLabel:this.messages.differentValuesPlaceholder,value:y})),r}_renderRadioButtonGroupComponent({input:e,options:t,props:s}){const o=t.map((({name:t,value:o})=>this._renderRadioButtons({label:t,value:o,selected:o===e.value,props:s})));if(e.showNoValueOptionEnabled){const t="",i=e.showNoValueLabel||this.messages.empty,r=T(e.value);o.unshift(this._renderRadioButtons({label:i,value:t,selected:r,props:s}))}return U("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:R.inputRadioGroup,disabled:s.readOnly,key:`${s.key}-radio-group`,layout:"vertical",name:s.name,required:s.required},o,s.placeholder===this.messages.differentValuesPlaceholder?U("calcite-label",{class:R.placeholderRadio,key:s.label,layout:"inline"},U("calcite-radio-button",{checked:!0,class:R.inputRadio,disabled:!0,name:s.placeholder,value:s.placeholder}),s.placeholder):null)}_renderRadioButtons({value:e,selected:t,label:s,props:o}){return U("calcite-label",{class:R.inputRadioLabel,key:o.label,layout:"inline"},U("calcite-radio-button",{...o,afterCreate:void 0,afterUpdate:void 0,checked:t,class:R.inputRadio,disabled:o.readOnly,name:o.label,onblur:()=>{this._focusedFieldInput=null},value:e,onCalciteRadioButtonChange:({currentTarget:e})=>{e.checked&&this._saveInput(e)}}),s)}_renderStringComponent(e,t){const{template:s}=e;return!s.field.editable||this.readOnly?this._renderReadOnlyComponent(e):s.input&&"text-area"===s.input.type?U("calcite-text-area",{...t,class:this.classes(R.individualElement),resize:"vertical",value:t.value?String(t.value):"",onCalciteTextAreaInput:({currentTarget:e})=>this._saveInput(e)}):U("calcite-input",{...t,class:this.classes(R.individualElement),type:"text",value:t.value?String(t.value):"",onCalciteInputInput:({currentTarget:e})=>this._saveInput(e)})}_renderNumberComponent(e,t){const s=n(e.field);return U("calcite-input-number",{...t,integer:s,type:"number",value:s&&""!==t.value?Math.round(parseFloat(String(t.value))).toString():String(t.value),onCalciteInputNumberInput:({currentTarget:e})=>this._saveInput(e)})}_renderReadOnlyComponent(e,t){const s=this.getCommonInputProps(e);return U("calcite-input",{...s,class:this.classes(R.fieldInput,R.inputDisabled,R.individualElement),readOnly:!0,type:"text",value:String(t??s.value??"")})}_renderDateComponents(e,t){const{field:s}=e;let o;switch(s.type){case"date":o=this._renderDateFieldComponents(e,t);break;case"date-only":o=this._renderDateOnlyFieldComponent(e,t);break;case"time-only":o=this._renderTimeOnlyFieldComponent(e,t);break;case"timestamp-offset":o=this._renderTimestampOffsetFieldComponents(e,t);break;default:o=this._renderReadOnlyComponent(e,k(s,t.value,{timeZone:e.effectiveTimeZone,...v(e.template.field)}))}return e.value===y?[o,U("calcite-input-message",{icon:"information",key:"diff-values-message",status:"idle"},this.messages.differentValues)]:o}_renderDateOnlyFieldComponent(e,t){const{class:s,key:o,readOnly:i}=t,{rawMax:r,rawMin:n}=e.range;return U("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,class:s,"data-date-part":"date","data-element-id":t[P],key:`${o}-date-input`,max:a(r)?r:void 0,min:a(n)?n:void 0,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:i,value:e.value===y?"":e.value?String(e.value):"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.currentTarget)})}_renderTimeOnlyFieldComponent(e,t){const{class:s,key:o,readOnly:i}=t;return U("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,class:s,"data-date-part":"time","data-element-id":t[P],key:`${o}-time-input`,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:i,value:e.value===y?"":e.value?String(e.value):"",onCalciteInputTimePickerChange:t=>this._saveValueFromDateComponent(e,t.currentTarget)})}_renderTimestampOffsetFieldComponents(e,t){const{class:s,key:o,readOnly:i}=t,{rawMax:r,rawMin:n}=e.range,a=g(r),p=g(n),l=g(e.value===y?"":e.value),m=e.includeTimeOffset,u={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,overlayPositioning:"fixed",readOnly:i,[P]:t[P],onfocus:this._onComponentFocus};return U("div",{class:R.dateInputContainer,key:`${o}-date-time-container`},U("calcite-input-date-picker",{...u,class:s,"data-date-part":"date",key:`${o}-date-input`,max:a?.date??void 0,min:p?.date??void 0,onblur:()=>{this._focusedFieldInput=null},value:l.date??"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),U("calcite-input-time-picker",{...u,class:s,"data-date-part":"time",key:`${o}-time-input`,onblur:()=>{this._focusedFieldInput=null},value:l.time??"",onCalciteInputTimePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),m?U("calcite-input-time-zone",{...u,class:s,clearable:e.value===y||null==e.value,"data-date-part":"timeZone",key:`${o}-timezone-input`,onblur:()=>{this._focusedFieldInput=null},value:l.timeZoneOffset||"",onCalciteInputTimeZoneChange:t=>this._saveValueFromDateComponent(e,t.target)}):null)}_renderDateFieldComponents(e,t){const{class:s,key:o,readOnly:i,min:r,max:n}=t,a=e.effectiveTimeZone,p=C(e.value===y?"":e.value,a),l=C(n,a),m=C(r,a),u=e.includeTime,d={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,overlayPositioning:"fixed",readOnly:i,[P]:t[P],onfocus:this._onComponentFocus};return U("div",{class:R.dateInputContainer,key:`${o}-date-time-container`},U("calcite-input-date-picker",{...d,class:s,"data-date-part":"date",key:`${o}-date-input`,max:l?.date??void 0,min:m?.date??void 0,onblur:()=>{this._focusedFieldInput=null},value:p.date??"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),u?U("calcite-input-time-picker",{...d,"data-date-part":"time",key:`${o}-time-input`,onblur:()=>{this._focusedFieldInput=null},step:1,value:p.time??"",onCalciteInputTimePickerChange:t=>{this._saveValueFromDateComponent(e,t.target)}}):null)}getCommonInputProps(e){const{template:t,valid:s,value:o,minLength:i,maxLength:r,required:n,fieldName:a,editable:p,userHasChangedValue:l,range:{max:m,min:u}}=e,d=!p||this.readOnly,c=!d&&this._effectiveDisabled;let h=t.hint??void 0,j=!1;return o===y&&(h=this.messages.differentValuesPlaceholder,j=!0),{afterCreate:this._afterComponentCreateOrUpdate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":s?"false":"true",class:this.classes(R.fieldInput,d?R.inputDisabled:null),status:!l&&!this.viewModel.submitHasBeenAttempted||s?"idle":"invalid",maxLength:r&&r>-1?r:void 0,minLength:i&&i>-1?i:void 0,key:t.elementId,label:a,name:a,max:null!=m?m:void 0,min:null!=u?u:void 0,disabled:c,readOnly:d,onblur:this._onComponentBlur,required:n,placeholder:h,value:j?"":o??"",[P]:t.elementId,onfocus:this._onComponentFocus}}_onFormSubmit(e){e.preventDefault()}_getFieldInputFromHTMLElement(e){return this.viewModel.findFieldInput(e.getAttribute(P))}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,s=e.querySelector("calcite-radio-button"),o=t||s;o&&this._afterComponentCreateOrUpdate(o)}_onComponentFocus(e){const t=e.target,s=this._getFieldInputFromHTMLElement(t);this._touchedInputs.add(s.template.elementId),this._focusedFieldInput=s}_afterComponentCreateOrUpdate(e){const t=this._getFieldInputFromHTMLElement(e),s=this._focusedFieldInput;this._attemptFocusOnNextRender&&s===t&&(this._attemptFocusOnNextRender=!1,S(e))}_onComponentBlur(){this._focusedFieldInput=null}_parseValue(e,t){if(d(t.template,"switch")){if("calcite-dropdown"===e.localName&&t.domain)for(const s of t.domain.codedValues)if(s.name===e.selectedItems[0].textContent)return s.code;return e.checked?t.template.input.onValue:t.template.input.offValue}const s=e.value;return null==s||""===s?null:"number"===t.dataType?"-0"===s||"-0."===s||"-0,"===s?s:parseFloat(s):"date"===t.field.type?parseFloat(s):s}_saveInput(e){const s=this._getFieldInputFromHTMLElement(e),{elementId:o}=s.template;if(!s)return;const i=s?.value;if(d(s.template,"switch")&&"single"!==this.viewModel.mode){const e=t(this._batchSwitchInputInitialValues,s,(()=>s.value));this._batchSwitchInputInitialValues.set(s,null===e?i:e)}const r=this._parseValue(e,s);r!==i&&this.viewModel.setValue(o,r)}async _afterDateComponentCreate(e){this._setDateTimeTimeZoneMap(e),this._afterComponentCreateOrUpdate(e)}_saveValueFromDateComponent(e,t){const{elementId:s}=e.template,o=e.field.type,i=this._dateComponentMap.get(`${s}`);if(!i)return;const r=e.effectiveTimeZone;let n=e.value===y?void 0:e.value,a=null;"date-only"===o?a=Array.isArray(t.value)?t.value[0]:t.value:"time-only"===o?(n=I(n),a=I(t.value)):a="timestamp-offset"===o?null!=t.value?_({dateComponent:i.date,timeComponent:i.time,oldValue:n,timeZoneComponent:i.timeZone,defaultTimeZone:r}):null:null!=t.value?F({oldValue:n,dateComponent:i.date,timeZone:r,timeComponent:i.time?.value===y?void 0:i.time}):null,n!==a&&(null!==a&&t.value?this.viewModel.setValue(`${s}`,a):this.viewModel.setValue(`${s}`,null))}};e([i()],B.prototype,"activeFeatureIndex",null),e([i()],B.prototype,"disabled",null),e([i()],B.prototype,"_effectiveDisabled",null),e([i()],B.prototype,"features",null),e([i()],B.prototype,"map",null),e([i()],B.prototype,"spatialReference",null),e([i()],B.prototype,"timeZone",null),e([i()],B.prototype,"headingLevel",void 0),e([i()],B.prototype,"icon",null),e([i(),w("esri/t9n/common")],B.prototype,"messagesCommon",void 0),e([i(),w("esri/widgets/BatchAttributeForm/t9n/BatchAttributeForm")],B.prototype,"messages",void 0),e([i(),w("esri/widgets/FeatureForm/t9n/FeatureForm")],B.prototype,"featureFormMessages",void 0),e([i()],B.prototype,"readOnly",null),e([i()],B.prototype,"valid",null),e([i(),M(["value-change","submit"])],B.prototype,"viewModel",void 0),e([i({type:E,nonNullable:!0})],B.prototype,"visibleElements",void 0),e([i()],B.prototype,"groupDisplay",void 0),B=e([r("esri.widgets.BatchAttributeForm")],B);const A=B;export{E as V,A as default};
