/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import t from"../../../core/Accessor.js";import{property as s}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/lang.js";import{L as r}from"../../../chunks/Logger.js";import{subclass as i}from"../../../core/accessorSupport/decorators/subclass.js";import{k as n,j as o,F as a}from"../../../chunks/layerUtils.js";import{o as l}from"../../../chunks/elevationInfoUtils.js";import{e as p,a as m,i as u,b as c}from"../../../chunks/unitUtils.js";import{j as d}from"../../../chunks/infoFor3D.js";import{V as h}from"../../../chunks/ViewingMode.js";import{isRelatableFeatureSupportedLayer as f}from"../../../chunks/featureUtils.js";import{C as y}from"../../../chunks/featureFormUtils.js";import"../../../core/Handles.js";import"../../../chunks/maybe.js";import"../../../chunks/get.js";import"../../../chunks/utils.js";import"../../../chunks/handleUtils.js";import"../../../chunks/Lifecycle.js";import"../../../chunks/metadata.js";import"../../../chunks/ObjectPool.js";import"../../../chunks/ObservableBase.js";import"../../../chunks/tracking.js";import"../../../chunks/watch.js";import"../../../core/scheduling.js";import"../../../chunks/nextTick.js";import"../../../chunks/PooledArray.js";import"../../../core/promiseUtils.js";import"../../../core/Error.js";import"../../../config.js";import"../../../chunks/events.js";import"../../../chunks/SetUtils.js";import"../../../chunks/SimpleTrackingTarget.js";import"../../../chunks/ensureType.js";import"../../../chunks/MapUtils.js";import"../../../chunks/Warning.js";import"../../../kernel.js";import"../../../core/urlUtils.js";import"../../../chunks/jsonUtils.js";import"../../../request.js";import"../../../chunks/persistableUrlUtils.js";import"../../../core/Collection.js";import"../../../core/Evented.js";import"../../../chunks/shared.js";import"../../../chunks/SimpleObservable.js";import"../../../layers/catalog/catalogUtils.js";import"../../../core/reactiveUtils.js";import"../../../chunks/unitConversionUtils.js";import"../../../chunks/lengthUtils.js";import"../../../chunks/jsonMap.js";import"../../../chunks/pe.js";import"../../../chunks/assets.js";import"../../../chunks/date.js";import"../../../chunks/locale.js";import"../../../chunks/constants.js";import"../../../chunks/datetime.js";import"../../../chunks/number2.js";import"../../../layers/support/fieldUtils.js";import"../../../core/sql.js";import"../../../chunks/guards.js";import"../../../chunks/utils14.js";import"../../../chunks/basemapUtils.js";import"../../../chunks/utils2.js";import"../../../chunks/colorUtils2.js";import"../../../chunks/screenUtils.js";import"../../../chunks/mat4.js";import"../../../chunks/common.js";import"../../../chunks/basemapDefinitions.js";import"../../../chunks/messages.js";import"../../../chunks/timeZoneUtils.js";import"../../../intl.js";import"../../../chunks/substitute.js";import"../../../chunks/formUtils.js";import"../../../form/elements/AttachmentElement.js";import"../../../form/elements/Element.js";import"../../../core/JSONSupport.js";import"../../../form/elements/inputs/attachments/AttachmentInput.js";import"../../../core/accessorSupport/decorators/cast.js";import"../../../chunks/reader.js";import"../../../chunks/writer.js";import"../../../chunks/Input.js";import"../../../core/Clonable.js";import"../../../form/elements/inputs/attachments/AudioInput.js";import"../../../chunks/utils7.js";import"../../../form/elements/inputs/attachments/DocumentInput.js";import"../../../form/elements/inputs/attachments/ImageInput.js";import"../../../form/elements/inputs/attachments/SignatureInput.js";import"../../../form/elements/inputs/attachments/VideoInput.js";import"../../../form/elements/FieldElement.js";import"../../../form/elements/inputs.js";import"../../../form/elements/inputs/BarcodeScannerInput.js";import"../../../form/elements/inputs/TextInput.js";import"../../../form/elements/inputs/Input.js";import"../../../form/elements/inputs/ComboBoxInput.js";import"../../../form/elements/inputs/DatePickerInput.js";import"../../../form/elements/inputs/DateTimeOffsetPickerInput.js";import"../../../form/elements/inputs/DateTimePickerInput.js";import"../../../form/elements/inputs/RadioButtonsInput.js";import"../../../form/elements/inputs/SwitchInput.js";import"../../../form/elements/inputs/TextAreaInput.js";import"../../../form/elements/inputs/TextBoxInput.js";import"../../../form/elements/inputs/TimePickerInput.js";import"../../../chunks/domains.js";import"../../../layers/support/CodedValueDomain.js";import"../../../chunks/enumeration.js";import"../../../layers/support/Domain.js";import"../../../layers/support/InheritedDomain.js";import"../../../layers/support/RangeDomain.js";import"../../../form/elements/RelationshipElement.js";import"../../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../../form/elements/TextElement.js";import"../../../form/elements/UtilityNetworkAssociationsElement.js";import"../../../popup/support/UtilityNetworkAssociationType.js";import"../../../chunks/dateUtils.js";import"../../../chunks/mathUtils.js";import"../../../chunks/formUtils2.js";let b=class extends t{constructor(e){super(e),this.layer=null}get attachments(){return{enabled:this._effectiveEnabled&&!!this._effectiveCapabilities?.data.supportsAttachment}}get create(){const{_effectiveCapabilities:e,layer:t}=this,s=this._createEnabled,r=s,i=t.capabilities?.operations.supportsAdd,n=!!e?.operations.supportsAdd;return{attachments:{enabled:s&&this.attachments.enabled},attributes:s,enabled:s,geometry:r,reliesOnOwnerAdminPrivileges:!i&&n}}get delete(){const{_effectiveCapabilities:e,layer:t}=this,s=t.capabilities?.operations.supportsDelete,r=!!e?.operations.supportsDelete;return{enabled:this._effectiveEnabled&&!!e?.operations.supportsDelete,reliesOnOwnerAdminPrivileges:!s&&r}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){const{_effectiveCapabilities:e,layer:t}=this,s=this._updateEnabled,r=!(!s||!e?.editing.supportsGeometryUpdate),i=t.capabilities?.operations.supportsUpdate,n=!!e?.operations.supportsUpdate,o=this.attachments.enabled,a=o&&this._canCreateOrUpdate;return{attachments:{enabled:o,create:a,update:a},attributes:s,enabled:s,geometry:r,reliesOnOwnerAdminPrivileges:!i&&n}}get _createEnabled(){return this._effectiveEnabled&&!!this._effectiveCapabilities?.operations.supportsAdd}get _updateEnabled(){return this._effectiveEnabled&&!!this._effectiveCapabilities?.operations.supportsUpdate}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return n(this.layer)}get _effectiveCapabilities(){return o(this.layer)}};e([s()],b.prototype,"attachments",null),e([s()],b.prototype,"create",null),e([s()],b.prototype,"delete",null),e([s()],b.prototype,"layer",void 0),e([s()],b.prototype,"reliesOnOwnerAdminPrivileges",null),e([s()],b.prototype,"update",null),e([s()],b.prototype,"_createEnabled",null),e([s()],b.prototype,"_updateEnabled",null),e([s()],b.prototype,"_canCreateOrUpdate",null),e([s()],b.prototype,"_effectiveEnabled",null),e([s()],b.prototype,"_effectiveCapabilities",null),b=e([i("esri.layers.support.EditingCapabilities")],b);const j=b,g="esri.views.layers.support.editableLayerViews";let k=class extends j{constructor(e){super(e),this.layerInfo=null,this.layerView=null}get attachments(){const e=this.defaults.attachments.enabled,t=this.layerInfo;return{enabled:e&&!1!==t?.enabled}}get create(){const{attachments:e,defaults:t,layerInfo:s,layer:r,layerView:i}=this,n=t.create,o=!1!==s?.enabled&&!1!==s?.addEnabled,a=n.enabled&&o;return{attributes:a&&n.attributes,enabled:a,geometry:a&&n.geometry&&w(r,i),attachments:{enabled:e.enabled&&a&&!1!==s?.attachmentsOnCreateEnabled},reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}get defaults(){return new j({layer:this.layer})}get delete(){const{defaults:e,layerInfo:t}=this,s=e.delete,r=!1!==t?.enabled&&!1!==t?.deleteEnabled;return{enabled:s.enabled&&r,reliesOnOwnerAdminPrivileges:s.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:e,layerInfo:t}=this;return t?.formTemplate?t.formTemplate:e&&"formTemplate"in e?e.formTemplate:null}get relationship(){const{layer:e}=this,t=!(!f(e)||!e.relationships?.length),s=!!this.formTemplate?.elements?.some((e=>"relationship"===e.type));return{enabled:t&&s}}get update(){const{attachments:e,defaults:t,layerInfo:s,layer:r,layerView:i}=this,n=t.update,o=!1!==s?.enabled&&!1!==s?.updateEnabled,a=n.enabled&&o,l=a&&n.attributes&&!1!==s?.attributeUpdatesEnabled,p=a&&n.geometry&&!1!==s?.geometryUpdatesEnabled&&w(r,i),m=e.enabled&&!1!==s?.attachmentsOnUpdateEnabled;return{attributes:l,enabled:a,geometry:p,attachments:{enabled:m,create:m&&n.attachments.create,update:m&&n.attachments.update},reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}};function w(e,t){return"scene"!==e.type||null!=t&&"type"in t&&"scene-layer-3d"===t.type&&function(e,t){const{associatedLayer:s}=e,i=s?.infoFor3D;if(!i)return!1;const n=d(i);if(null==n||!i.queryFormats.includes(n))return r.getLogger(g).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because it does not support GLB queries.`),!1;const o=e.spatialReference,a=s.spatialReference;if(!p(o,a))return r.getLogger(g).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${o.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${a.wkid}).`),!1;const l=s.sourceJSON.sourceSpatialReference;if(null!=l&&!p(l,a))return r.getLogger(g).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:${a.wkid}) is different from its source spatial reference (wkid:${l.wkid}).`),!1;const{view:f}=t;if(t.destroyed||null==f)return!1;const y=f.spatialReference,{viewingMode:b}=f.state,j=m(o),k=b===h.Global;return j&&!k?(r.getLogger(g).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in local viewing mode because its spatial reference (wkid:${o.wkid}) is geographic. Please consider changing the viewing mode to global.`),!1):!j&&k?(r.getLogger(g).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in global viewing mode because its spatial reference (wkid:${o.wkid}) is projected. Please consider changing the viewing mode to local.`),!1):!!(p(o,y)||k&&u(y)&&c(o))||(r.getLogger(g).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${o.wkid}) does not match the view spatial reference (wkid:${y.wkid}).`),!1)}(e,t)}e([s()],k.prototype,"attachments",null),e([s()],k.prototype,"create",null),e([s()],k.prototype,"defaults",null),e([s()],k.prototype,"delete",null),e([s()],k.prototype,"formTemplate",null),e([s()],k.prototype,"layerInfo",void 0),e([s()],k.prototype,"layerView",void 0),e([s()],k.prototype,"relationship",null),e([s()],k.prototype,"update",null),k=e([i("esri.widgets.Editor.support.EditorEditingCapabilities")],k);const v=k;let O=class extends t{constructor(e){super(e),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){return!!this.layerView?.suspended}get capabilities(){return new v({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:e,relationship:t,update:s,delete:{enabled:r}}=this.capabilities,i=e.attachments.enabled||s.attachments.enabled;return!this.disabled&&(e.enabled||s.enabled||i||r||t.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return y(this.layer,this.formTemplate)}get isTable(){return a(this.layer)}get supportsCreateFeaturesWorkflow(){if(this.disabled)return!1;if("3d"===this.layerView?.view?.type&&l(this.layer.elevationInfo))return!1;const{enabled:e,geometry:t}=this.capabilities.create;return this.isTable?e:e&&t}get supportsUpdateWorkflow(){const{capabilities:e}=this;return!this.disabled&&(e.update.enabled||e.update.attachments.enabled||e.delete.enabled)}get visible(){const{layer:e}=this,t=e.parent;return!this._suspended&&e.visible&&(!t||!("visible"in t)||t.visible)}};e([s()],O.prototype,"_suspended",null),e([s()],O.prototype,"capabilities",null),e([s()],O.prototype,"disabled",void 0),e([s()],O.prototype,"editable",null),e([s()],O.prototype,"formTemplate",null),e([s()],O.prototype,"hasInvalidFormTemplate",null),e([s()],O.prototype,"isTable",null),e([s()],O.prototype,"layer",void 0),e([s()],O.prototype,"layerInfo",void 0),e([s()],O.prototype,"layerView",void 0),e([s()],O.prototype,"supportsCreateFeaturesWorkflow",null),e([s()],O.prototype,"supportsUpdateWorkflow",null),e([s()],O.prototype,"visible",null),O=e([i("esri.widgets.Editor.support.EditorItem")],O);const U=O;export{U as default};
