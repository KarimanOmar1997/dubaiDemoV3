/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.33/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import{c as e}from"../chunks/asyncUtils.js";import{d as s,a as i}from"../chunks/maybe.js";import{m as o}from"../chunks/memoize.js";import{throwIfAborted as r,createAbortError as n}from"../core/promiseUtils.js";import{watch as a,initial as l}from"../core/reactiveUtils.js";import{property as c}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"../chunks/Logger.js";import{subclass as p}from"../core/accessorSupport/decorators/subclass.js";import h from"./Widget.js";import m from"./ElevationProfile/ElevationProfileViewModel.js";import u from"../core/Accessor.js";import"../intl.js";import{t as d}from"../chunks/throttle.js";import{f as j,m as k}from"../chunks/unitFormatUtils.js";import{g,n as y,f as v,E as _}from"./ElevationProfile/ElevationProfileLine.js";import{l as b}from"../chunks/componentsUtils.js";import"../chunks/widgetUtils.js";import{m as f}from"../chunks/messageBundle.js";import{t as C,a as S}from"../chunks/jsxFactory.js";import{s as U}from"../chunks/substitute.js";import{U as w}from"../chunks/UnitSelect.js";import{g as x}from"../chunks/globalCss.js";import"../chunks/handleUtils.js";import"../core/Error.js";import"../config.js";import"../chunks/events.js";import"../chunks/watch.js";import"../chunks/ObjectPool.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/PooledArray.js";import"../chunks/SetUtils.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/Lifecycle.js";import"../chunks/tracking.js";import"../chunks/SimpleTrackingTarget.js";import"../chunks/ensureType.js";import"../chunks/MapUtils.js";import"../chunks/metadata.js";import"../chunks/Warning.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Handles.js";import"../chunks/ObservableBase.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/sanitizerUtils.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/messages.js";import"../chunks/locale.js";import"../chunks/date.js";import"../chunks/jsonMap.js";import"../chunks/constants.js";import"../chunks/datetime.js";import"../chunks/number2.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonUtils.js";import"../chunks/persistableUrlUtils.js";import"../chunks/assets.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"../chunks/guards.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../Color.js";import"../chunks/colorUtils2.js";import"../chunks/mathUtils.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../geometry/support/jsonUtils.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../chunks/unitUtils.js";import"../chunks/pe.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/coordsUtils.js";import"../chunks/Axis.js";import"../chunks/extentUtils.js";import"../chunks/boundsUtils.js";import"../chunks/aaBoundingRect.js";import"../geometry/Polyline.js";import"../chunks/typeUtils2.js";import"../chunks/createFeatureId.js";import"../chunks/typeUtils.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils5.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils6.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/vec3f64.js";import"../chunks/aaBoundingBox.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../chunks/lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"../chunks/Thumbnail.js";import"../chunks/calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/ByteSizeUnit.js";import"../chunks/LRUCache.js";import"../chunks/MemCache.js";import"../chunks/ElevationQueryTileCache.js";import"../chunks/defaultUnit.js";import"../chunks/getDefaultUnitForView.js";import"../chunks/elevationInfoUtils.js";import"../chunks/unitConversionUtils.js";import"../chunks/lengthUtils.js";import"./ElevationProfile/ElevationProfileLineGround.js";import"../chunks/elevationQuerySourceUtils.js";import"../chunks/groundInstanceUtils.js";import"../chunks/vec4f64.js";import"../chunks/Material.js";import"../chunks/ShaderOutput.js";import"../chunks/VertexAttribute.js";import"../chunks/ShaderTechniqueConfiguration.js";import"../chunks/BindType.js";import"../chunks/boundedPlane.js";import"../chunks/ray.js";import"../chunks/mat3.js";import"../chunks/mat3f64.js";import"../chunks/vec3.js";import"../chunks/common.js";import"../chunks/vector.js";import"../chunks/mat4f64.js";import"../chunks/quatf64.js";import"../chunks/vec2f64.js";import"../chunks/mat4.js";import"../chunks/lineSegment.js";import"../chunks/plane.js";import"../chunks/mathUtils2.js";import"../chunks/sphere.js";import"../chunks/vec4.js";import"../chunks/ViewingMode.js";import"../chunks/ScheduledQueueProcessor.js";import"../chunks/Queue.js";import"../chunks/ReactiveMap.js";import"../chunks/signal.js";import"../chunks/Scheduler.js";import"../chunks/debugFlags.js";import"../chunks/vec2.js";import"../chunks/projectionUtils.js";import"../chunks/projectBuffer.js";import"../chunks/geodesicConstants.js";import"../chunks/projectXYZToVector.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";import"../geometry/support/geodesicUtils.js";import"../chunks/traversalUtils.js";import"./ElevationProfile/ElevationProfileLineInput.js";import"../chunks/ElevationQuery.js";import"../layers/support/ElevationSampler.js";import"../chunks/ElevationTile.js";import"../chunks/ElevationSamplerData.js";import"../chunks/TileKey.js";import"./ElevationProfile/ElevationProfileLineQuery.js";import"./ElevationProfile/ElevationProfileLineView.js";import"../chunks/hitTest.js";import"../chunks/projectVectorToVector.js";import"../chunks/projectPointToVector.js";import"../chunks/dehydratedPoint.js";import"../chunks/LayerConstants.js";import"../chunks/layerUtils.js";import"../layers/catalog/catalogUtils.js";import"../chunks/debugFlags2.js";import"../chunks/Intersector2.js";import"../chunks/dehydratedFeatureUtils.js";import"../views/3d/webgl/RenderCamera.js";import"../chunks/frustum.js";import"../chunks/HUDIntersectorResult.js";import"../chunks/IntersectorResult.js";import"../chunks/verticalOffsetUtils.js";import"../chunks/orientedBoundingBox.js";import"../chunks/quat.js";import"../chunks/spatialReferenceEllipsoidUtils.js";import"../chunks/computeTranslationToOriginAndRotation.js";import"../chunks/intersectorUtilsConversions.js";import"../chunks/Intersector.js";import"../layers/GraphicsLayer.js";import"../chunks/GraphicsCollection.js";import"../layers/Layer.js";import"../time/TimeExtent.js";import"../chunks/timeUtils.js";import"../layers/mixins/BlendLayer.js";import"../chunks/layerContainerType.js";import"../chunks/jsonUtils2.js";import"../chunks/parser.js";import"../chunks/utils2.js";import"../layers/mixins/ScaleRangeLayer.js";import"../chunks/ElevationInfo.js";import"../chunks/InputManager.js";import"./Sketch/SketchViewModel.js";import"../chunks/UpdatingHandles.js";import"../chunks/isSupportedObject.js";import"../chunks/layerUtils2.js";import"../chunks/editableLayers.js";import"../chunks/keybindings.js";import"../views/interactive/sketch/SketchLabelOptions.js";import"../chunks/SketchOptions.js";import"../views/interactive/sketch/SketchTooltipOptions.js";import"../chunks/SketchTooltipVisibleElements.js";import"../views/interactive/sketch/SketchValueOptions.js";import"../chunks/angularMeasurementUtils.js";import"../chunks/Cyclical.js";import"../chunks/quantityUtils.js";import"../chunks/SnappingManager.js";import"../chunks/normalizedPoint.js";import"../chunks/Settings.js";import"../chunks/RightAngleSnappingHint.js";import"../views/interactive/snapping/SnappingOptions.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../chunks/constraints.js";import"../rest/support/Query.js";import"../chunks/DataLayerSource.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../chunks/FullTextSearch.js";import"../chunks/spatialRelationships.js";import"../rest/support/StatisticDefinition.js";import"../chunks/utils8.js";import"../chunks/Version2.js";import"../chunks/Version.js";import"../chunks/geometry2dUtils.js";import"../chunks/geodesicLengthMeasurementUtils.js";import"../geometry/operators/geodeticLengthOperator.js";import"../chunks/geodeticCurveType.js";import"../chunks/geodesicMeasurementUtils.js";import"../chunks/automaticAreaMeasurementUtils.js";import"../chunks/geodesicAreaMeasurementUtils.js";import"../chunks/earcut.js";import"../chunks/triangle.js";import"../chunks/automaticLengthMeasurementUtils.js";import"../chunks/HighlightDefaults.js";import"../chunks/hitTestSelectUtils.js";import"../chunks/screenUtils2.js";import"../chunks/sketchUtils.js";const E="esri-elevation-profile",M={base:`${E}`,refined:`${E}--refined`,mainContainer:`${E}__main-container`,promptContainer:`${E}__prompt-container`,header:`${E}__header`,zoomOutButton:`${E}__zoom-out-button`,clearButton:`${E}__clear-button`,actionButton:`${E}__action-button`,sketchButton:`${E}__sketch-button`,sketchCancelButton:`${E}__sketch-cancel-button`,sketchDoneButton:`${E}__sketch-done-button`,selectButton:`${E}__select-button`,selectCancelButton:`${E}__select-cancel-button`,chartContainer:`${E}__chart-container`,chartSpinner:`${E}__chart-spinner`,chartSpinnerVisible:`${E}__chart-spinner--visible`,chartSpinnerSmall:`${E}__chart-spinner--small`,footer:`${E}__footer`},P="esri-elevation-profile-legend-item",B={base:P,disabled:`${P}--disabled`,expanded:`${P}--expanded`,colorIndicator:`${P}__color-indicator`,header:`${P}__header`,content:`${P}__content`,collapseToggle:`${P}__collapse-toggle`,label:`${P}__label`,checkbox:`${P}__checkbox`},L="esri-elevation-profile-statistics",I={base:L,statistic:`${L}__statistic`,statisticLabel:`${L}__statistic__label`,statisticValue:`${L}__statistic__value`,slopeValue:`${L}__slope-value`},T="esri-elevation-profile-settings",D={base:`${T}`,popoverContent:`${T}__popover-content`,uniformChartScalingLabel:`${T}__uniform-scaling-label`,uniformChartScalingCheckbox:`${T}__uniform-scaling-checkbox`};let V=class extends u{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};t([c()],V.prototype,"legend",void 0),t([c()],V.prototype,"chart",void 0),t([c()],V.prototype,"clearButton",void 0),t([c()],V.prototype,"settingsButton",void 0),t([c()],V.prototype,"sketchButton",void 0),t([c()],V.prototype,"selectButton",void 0),t([c()],V.prototype,"unitSelector",void 0),t([c()],V.prototype,"uniformChartScalingToggle",void 0),V=t([p("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],V);const O=V;let $=class extends h{constructor(t,e){super(t,e),this._updateLayout=t=>{const e=t.parentElement,s=t.style.display;e?.removeChild(t),document.body.appendChild(t),t.style.display="block";let i=80;for(const e of t.childNodes)e instanceof HTMLElement&&(i=Math.max(i,e.offsetWidth));document.body.removeChild(t),e?.appendChild(t),t.style.display=s,t.style.setProperty("--max-width",`${i}px`)},this._updateLayoutThrottled=d(this._updateLayout,100)}loadDependencies(){return b({icon:()=>import("../chunks/index.js")})}initialize(){this.addHandles(this._updateLayoutThrottled)}render(){return C("div",{afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled,bind:this,class:I.base},this._renderStatistics())}_renderStatistics(){const t=this._messages?.statistics;return t?[this._renderDistanceStatistic("maxDistance",t.maxDistance),this._renderElevationStatistic("elevationGain",t.gain),this._renderElevationStatistic("elevationLoss",t.loss),this._renderElevationStatistic("minElevation",t.minElevation),this._renderElevationStatistic("maxElevation",t.maxElevation),this._renderElevationStatistic("avgElevation",t.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",t.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",t.avgSlope)]:[]}_renderDistanceStatistic(t,e){const s=g().formatPrecision,i=this._renderValue(t,(t=>{const e=this.effectiveUnits.distance;return j(this._messagesUnits,t,e,s)}));return this._renderStatistic(e,i)}_renderElevationStatistic(t,e){const s=g().formatPrecision,i=this._renderValue(t,(t=>{const e=this.effectiveUnits.elevation;return j(this._messagesUnits,t,e,s)}));return this._renderStatistic(e,i)}_renderSlopeStatistic(t,e,s){const i=g().formatPrecision,o=C("div",{class:I.slopeValue,key:"slope-up"},C("calcite-icon",{icon:"arrow-up",scale:"s"}),this._renderValue(t,(t=>k(t,"degrees","geographic","geographic",i))),C("calcite-icon",{icon:"arrow-down",scale:"s"}),this._renderValue(e,(t=>k(t,"degrees","geographic","geographic",i))));return this._renderStatistic(s,o)}_renderStatistic(t,e){return C("div",{class:I.statistic},C("label",{class:I.statisticLabel},t),C("div",{class:I.statisticValue},e))}_renderValue(t,e){const s=this.line,i=1===s.progress?s.statistics:null,o=i?.[t];return null!=o?e(o):y}};function R(t,{profiles:e}){const s=t.title;if(null!=s)return s;switch(t.type){case"ground":return e.ground;case"input":return e.input;case"query":return e.query;case"view":return e.view;default:return""}}t([c()],$.prototype,"effectiveUnits",void 0),t([c()],$.prototype,"line",void 0),t([c(),f("esri/widgets/ElevationProfile/t9n/ElevationProfile")],$.prototype,"_messages",void 0),t([c(),f("esri/core/t9n/Units")],$.prototype,"_messagesUnits",void 0),$=t([p("esri.widgets.ElevationProfile.components.Statistics")],$);let F=class extends h{constructor(t,e){super(t,e),this.checkboxVisible=!0,this.expanded=!1}loadDependencies(){return b({action:()=>import("../chunks/index5.js"),checkbox:()=>import("../chunks/index21.js"),label:()=>import("../chunks/index2.js")})}initialize(){this._statistics=new $(this._statisticsProps),this.addHandles(a((()=>this._statisticsProps),(t=>this._statistics.set(t))))}destroy(){this._statistics=s(this._statistics)}render(){const t=this.expanded;return C("div",{class:this.classes(B.base,{[B.disabled]:this.disabled,[B.expanded]:t}),key:this},this._renderColorIndicator(),C("div",{class:B.header,key:"header"},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),t?C("div",{class:B.content,key:"content"},this._statistics.render()):null)}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return C("div",{class:B.colorIndicator,key:"color-indicator",styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const{expanded:t,messages:e}=this,s=t?e.hideDetails:e.showDetails;return C("calcite-action",{appearance:"transparent",bind:this,class:B.collapseToggle,"data-testid":"legend-toggle",icon:t?"chevron-up":"chevron-down",key:"collapse-toggle",onclick:this._onCollapseToggleClick,scale:"s",text:s,title:s})}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:t,checkboxVisible:e,disabled:s,messages:i}=this;return C("calcite-label",{class:B.label,disabled:s,key:`label-${t.id}`,layout:"inline"},e?this._renderCheckbox():null,R(t,i))}_renderCheckbox(){const{disabled:t,line:e,messages:s}=this,i=e.visible,o=i?s.hideProfile:s.showProfile,r=U(o,{name:R(e,s)});return C("calcite-checkbox",{checked:i,class:B.checkbox,disabled:t,title:r,onCalciteCheckboxChange:()=>e.toggleVisibility()})}};t([c()],F.prototype,"checkboxVisible",void 0),t([c()],F.prototype,"disabled",null),t([c({nonNullable:!0})],F.prototype,"effectiveUnits",void 0),t([c()],F.prototype,"expanded",void 0),t([c({nonNullable:!0})],F.prototype,"line",void 0),t([c()],F.prototype,"messages",void 0),t([c()],F.prototype,"onExpandedToggle",void 0),t([c()],F.prototype,"_statistics",void 0),F=t([p("esri.widgets.ElevationProfile.components.LegendItem")],F);let A=class extends h{constructor(){super(...arguments),this._expandedLine=null}render(){const{profiles:t,messages:e,effectiveUnits:s,_expandedLine:i}=this;return C("div",{class:"esri-elevation-profile-legend"},t.map((o=>C(F,{checkboxVisible:t.length>1,effectiveUnits:s,expanded:o===i,line:o,messages:e,onExpandedToggle:()=>this._onExpandedToggle(o)}))))}_onExpandedToggle(t){this._expandedLine=t===this._expandedLine?null:t}};t([c()],A.prototype,"effectiveUnits",void 0),t([c()],A.prototype,"messages",void 0),t([c()],A.prototype,"profiles",void 0),t([c()],A.prototype,"_expandedLine",void 0),A=t([p("esri.widgets.ElevationProfile.components.Legend")],A);let z=class extends h{constructor(){super(...arguments),this.messages=null,this._popoverIsOpen=!1,this._referenceElement=null,this._onUniformChartScalingChange=t=>{this.onUniformChartScalingChange(t.currentTarget.checked)}}loadDependencies(){return b({action:()=>import("../chunks/index5.js"),checkbox:()=>import("../chunks/index21.js"),label:()=>import("../chunks/index2.js"),popover:()=>import("../chunks/index26.js").then((t=>t.i))})}render(){const{id:t,messages:e,visibleElements:s}=this,{unitSelector:i,uniformChartScalingToggle:o}=s;if(!e||!i&&!o)return C("div",{key:`${t}-empty`});const r=this._popoverIsOpen?e.hideSettings:e.showSettings;return C("div",{class:D.base,key:this},C("calcite-action",{afterCreate:t=>{this._referenceElement=t},appearance:"transparent","data-testid":"settings-button",icon:"gear",scale:"s",text:r,title:r}),this._referenceElement?C("calcite-popover",{autoClose:!0,label:r,placement:"bottom-end",referenceElement:this._referenceElement,onCalcitePopoverClose:()=>{this._popoverIsOpen=!1},onCalcitePopoverOpen:()=>{this._popoverIsOpen=!0}},this._renderPopoverContent()):null)}_renderPopoverContent(){const{unitSelector:t,uniformChartScalingToggle:e}=this.visibleElements;return C("div",{class:D.popoverContent},t?this._renderUnitSelector():null,e?this._renderUniformChartScalingToggle():null)}_renderUnitSelector(){const{messages:t}=this;return C(w,{key:"unit-selector-label",options:this.unitOptions,selectLabel:t?.unitSelectLabel??"",value:this.unit,onChange:this.onUnitChange})}_renderUniformChartScalingToggle(){const{messages:t}=this,e=this.uniformChartScaling;return C("calcite-label",{class:D.uniformChartScalingLabel,key:"uniform-chart-scaling-label",layout:"inline"},C("calcite-checkbox",{checked:e,class:D.uniformChartScalingCheckbox,title:t?.[e?"uniformChartScalingDisable":"uniformChartScalingEnable"]??"",onCalciteCheckboxChange:this._onUniformChartScalingChange}),t?.uniformChartScalingLabel)}};var N;t([c()],z.prototype,"messages",void 0),t([c()],z.prototype,"onUniformChartScalingChange",void 0),t([c()],z.prototype,"onUnitChange",void 0),t([c()],z.prototype,"uniformChartScaling",void 0),t([c()],z.prototype,"unit",void 0),t([c()],z.prototype,"unitOptions",void 0),t([c()],z.prototype,"visibleElements",void 0),t([c()],z.prototype,"_popoverIsOpen",void 0),t([c()],z.prototype,"_referenceElement",void 0),z=t([p("esri.widgets.ElevationProfile.components.SettingsButton")],z),function(t){t.Sketch="sketch",t.SketchCancel="sketch-cancel",t.SketchDone="sketch-done",t.Select="select",t.SelectCancel="select-cancel"}(N||(N={}));const G=[{type:N.Select},{type:N.Sketch}],H={[v.None]:null,[v.NoValidInput]:"noProfile",[v.NoVisibleProfiles]:"noProfile",[v.RefinedButNoChartData]:"noProfile",[v.TooComplex]:"tooComplex",[v.UnknownError]:"unknown",[v.InvalidGeometry]:"invalidGeometry",[v.InvalidElevationInfo]:"invalidElevationInfo"};let Q=class extends h{constructor(t,e){super(t,e),this.viewModel=null,this.visibleElements=new O,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=o(((t,e,s,i)=>({chart:t,data:e,stationary:s,messages:i}))),this._onZoomOutButtonClick=()=>{this._chart?.zoomOut()},this._onClearButtonClick=()=>{this.viewModel.clear()},t?.viewModel||(this._defaultViewModel=new m({view:t?.view}),this.viewModel=this._defaultViewModel)}loadDependencies(){return b({action:()=>import("../chunks/index5.js"),button:()=>import("../chunks/index6.js"),loader:()=>import("../chunks/index28.js")})}postInitialize(){this.addHandles([a((()=>({container:this._chartContainer})),(({container:t})=>{this._destroyChart(),null!=t&&this._initializeChart(t)}),l),a((()=>this._chartUpdateParams),(()=>this._updateChart(this._chartUpdateParams)),l)])}destroy(){this._destroyChart(),null!=this._defaultViewModel&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get input(){return this.viewModel.input}set input(t){this.viewModel.input=t}get profiles(){return this.viewModel.profiles}set profiles(t){this.viewModel.profiles=t}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(t){this.viewModel.unitOptions=t}get unit(){return this.viewModel.unit}set unit(t){this.viewModel.unit=t}get icon(){return"altitude"}set icon(t){this._overrideIfSome("icon",t)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}get test(){return{chart:this._chart}}get _selectButtonVisible(){return!0===this.visibleElements.selectButton&&this.viewModel.selectAvailable}get _chartUpdateParams(){const t=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,null==t||t.stationary,this._chartMessages)}get _chartMessages(){return{...this.messagesUnits,...this.messages}}get _profilesArray(){return this.profiles.toArray()}render(){const{viewModel:t,visible:e}=this;return C("div",{"aria-label":this.messages.widgetLabel,class:this.classes({[M.base]:e,[x.widget]:e,[x.panel]:e,[x.widgetDisabled]:e&&"disabled"===t.state,[M.refined]:1===t.progress}),key:this},C("div",{bind:this,key:"content-wrapper"},e?this._renderContentForState():null))}_renderContentForState(){switch(this.viewModel.state){case _.Ready:return this._renderContentForReadyState();case _.Selecting:return this._renderContentForSelectingState();case _.Creating:return this._renderContentForCreatingState();case _.Selected:return this._renderContentForSelectedState();case _.Created:return this._renderContentForCreatedState();case _.Disabled:return this._renderContentForReadyState()}}_renderContentForReadyState(){const{messages:t,visibleElements:e,_selectButtonVisible:s}=this,{sketchButton:i}=e;let o;return o=i&&s?t.readyPrompt:i?t.readyPromptCreateOnly:s?t.readyPromptSelectOnly:t.errors?.noProfile,this._renderContent({prompt:o,chart:!1,actions:G})}_renderContentForSelectingState(){const{view:t}=this;if(null==t)return null;const e=this.messages[`selectingPrompt-${t.type}`];return this._renderContent({prompt:e,chart:!1,actions:[{type:N.SelectCancel}]})}_renderContentForCreatingState(){const{view:t,viewModel:e}=this;if(null==t)return null;const s=e.hasVertices?[{type:N.SketchCancel},{type:N.SketchDone,disabled:!e.tool.interaction.canStopCreating}]:[{type:N.Select},{type:N.Sketch,disabled:!0}];if(e.errorState===v.NoValidInput){const e=this.messages[`creatingPrompt-${t.type}`];return this._renderContent({chart:!1,actions:s,prompt:e})}const i=this._getErrorMessage();return i?this._renderContent({chart:!1,actions:s,prompt:i}):this._renderContent({chart:!0,actions:s})}_renderContentForSelectedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:G,prompt:t}):this._renderContent({chart:!0,actions:G})}_renderContentForCreatedState(){const t=this._getErrorMessage();return t?this._renderContent({chart:!1,actions:G,prompt:t}):this._renderContent({chart:!0,actions:G})}_getErrorMessage(){const t=H[this.viewModel.errorState];return t?this.messages?.errors?.[t]:null}_renderContent(t){const e=null!=t.prompt?this._renderPrompt(t.prompt):t.chart&&this._renderChart(),{viewModel:s}=this,i=null!=s.input;return C(S,null,C("header",{class:M.header,key:"header"},this._zoomOutButtonVisible?this._renderZoomOutButton():null,this.visibleElements.clearButton&&i?this._renderClearButton():null,this.visibleElements.settingsButton?C(z,{messages:this.messages,uniformChartScaling:s.uniformChartScaling,unit:s.unit,unitOptions:s.unitOptions,visibleElements:this.visibleElements,onUniformChartScalingChange:t=>s.uniformChartScaling=t,onUnitChange:t=>s.unit=t}):null),C("div",{class:M.mainContainer,key:"main-container"},e),this.visibleElements.legend?C(A,{effectiveUnits:s.effectiveUnits,messages:this.messages,profiles:this._profilesArray}):null,this._renderActions(t))}_renderZoomOutButton(){const t=this.messages.zoomOut;return C("calcite-action",{appearance:"transparent",class:M.zoomOutButton,"data-testid":"zoom-out-button",icon:"magnifying-glass-minus",key:"zoom-out",onclick:this._onZoomOutButtonClick,scale:"s",text:t,title:t})}_renderClearButton(){const t=this.messages.clearProfile;return C("calcite-action",{appearance:"transparent",class:M.clearButton,"data-testid":"clear-button",icon:"trash",key:"clear-profile",onclick:this._onClearButtonClick,scale:"s",text:t,title:t})}_renderPrompt(t){return[C("div",{bind:this,class:M.promptContainer,key:"prompt-container"},C("p",null,t))]}_renderChart(){if(!this.visibleElements.chart)return C("div",{class:M.chartContainer,key:"empty-chart-container"});const{chartData:t,progress:e}=this.viewModel,s=this._chartIsRefined||this._canRenderChart(),i=null!=t&&e<1;return s?C(S,null,this._renderSpinner({size:s?"small":"large",visible:i}),C("div",{afterCreate:this._onChartContainerUpdate,afterRemoved:this._onChartContainerRemoved,afterUpdate:this._onChartContainerUpdate,bind:this,class:M.chartContainer,key:"chart-container"})):C(S,null,this._renderSpinner({size:"large",visible:i}),C("div",{class:M.chartContainer,key:"chart-container-empty"}))}_renderSpinner(t){const e="small"===t.size,s=t.visible??!0;return C("calcite-loader",{class:this.classes(M.chartSpinner,e&&M.chartSpinnerSmall,s&&M.chartSpinnerVisible),"data-testid":"chart-spinner",inline:e,key:"spinner",label:"",scale:"s"})}_canRenderChart(){const t=this.viewModel.chartData;if(null==t)return!1;if(!this.viewModel.inputIsSketched)return t.refined;let e=0;for(const{samples:s}of t.lines)e+=null!=s?s.length:0;return t.refined||e<=g().largeChartSamples}_renderActions({actions:t}){const e=t.map((t=>{switch(t.type){case N.Sketch:return this.visibleElements.sketchButton&&this._renderAction({action:t,className:M.sketchButton,label:this.messages.sketchButtonLabel,onClick:this._onSketchButtonClick,primary:!0});case N.SketchCancel:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:M.sketchCancelButton,label:this.messagesCommon.cancel,primary:!1});case N.SketchDone:return this.visibleElements.sketchButton&&this._renderAction({action:t,onClick:this._onDoneButtonClick,className:M.sketchDoneButton,label:this.messagesCommon.done,primary:!0});case N.Select:return this._selectButtonVisible&&this._renderAction({action:t,onClick:this._onSelectButtonClick,className:M.selectButton,label:this.messages.selectButtonLabel,primary:!1});case N.SelectCancel:return this._selectButtonVisible&&this._renderAction({action:t,onClick:this._onCancelButtonClick,className:M.selectCancelButton,label:this.messagesCommon.cancel,primary:!1})}})).filter(Boolean);return e.length?C("footer",{class:M.footer,key:"footer"},e):null}_renderAction({action:t,className:e,label:s,onClick:i,primary:o}){return C("calcite-button",{appearance:o?"solid":"outline-fill",bind:this,class:this.classes(M.actionButton,e),disabled:t.disabled,key:`action-${t.type}`,onclick:i},s)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_updateChart(t){const{data:e,chart:s,messages:i,stationary:o}=t;null!=s&&null!=i&&o&&this._canRenderChart()&&(s.update(t),this._chartIsRefined=null!=e&&e.refined)}_onChartContainerUpdate(t){this._chartContainer=t}_onChartContainerRemoved(t){this._chartContainer===t&&(this._chartContainer=null)}_initializeChart(t){i(this._chartInitTask),this._chartInitTask=e((async e=>{const{createChart:i}=await import("../chunks/chartUtils.js");r(e);const o=await i({container:t,abortOptions:{signal:e},onRangeChange:(t,e)=>{this._zoomOutButtonVisible=1!==t||1!==e},onCursorPositionChange:t=>{this.viewModel.hoveredChartPosition=t}});if(e.aborted)throw s(o),n();this._chart=o,this._updateChart(this._chartUpdateParams)}))}_destroyChart(){this._chartInitTask=i(this._chartInitTask),this._chart=s(this._chart),this._chartIsRefined=!1}};t([c({type:m})],Q.prototype,"viewModel",void 0),t([c()],Q.prototype,"view",null),t([c()],Q.prototype,"input",null),t([c()],Q.prototype,"profiles",null),t([c()],Q.prototype,"unitOptions",null),t([c()],Q.prototype,"unit",null),t([c({type:O,nonNullable:!0})],Q.prototype,"visibleElements",void 0),t([c()],Q.prototype,"icon",null),t([c()],Q.prototype,"label",null),t([c()],Q.prototype,"visible",null),t([c(),f("esri/widgets/ElevationProfile/t9n/ElevationProfile")],Q.prototype,"messages",void 0),t([c(),f("esri/t9n/common")],Q.prototype,"messagesCommon",void 0),t([c(),f("esri/core/t9n/Units")],Q.prototype,"messagesUnits",void 0),t([c()],Q.prototype,"_chartContainer",void 0),t([c()],Q.prototype,"_chart",void 0),t([c()],Q.prototype,"_chartInitTask",void 0),t([c()],Q.prototype,"_chartIsRefined",void 0),t([c()],Q.prototype,"_zoomOutButtonVisible",void 0),t([c()],Q.prototype,"_selectButtonVisible",null),t([c()],Q.prototype,"_chartUpdateParams",null),t([c()],Q.prototype,"_chartMessages",null),t([c()],Q.prototype,"_profilesArray",null),Q=t([p("esri.widgets.ElevationProfile")],Q);const q=Q;export{q as default,R as g};
