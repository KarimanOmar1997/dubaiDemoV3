// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],(function(e,t){"use strict";e.updateOrigins=function(e){e?.writtenProperties&&e.writtenProperties.forEach((({target:e,propName:r,newOrigin:o})=>{t.isMultiOriginJSONMixin(e)&&o&&e.originOf(r)!==o&&e.updateOrigin(r,o)}))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/portal/support/jsonContext":function(){define(["exports","../../core/urlUtils","../Portal"],(function(e,t,r){"use strict";function o(e,o){return{origin:o,url:t.urlToObject(e.itemUrl),portal:e.portal||r.getDefault(),portalItem:e}}e.createForItemRead=function(e,t){return{...o(e,t),readResourcePaths:[]}},e.createForItemWrite=function(e,r,s){const i=t.urlToObject(e.itemUrl);return{...o(e,r),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:i?{rootPath:i.path,writtenUrls:[]}:null,resources:s?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/MapFloorInfo":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../layers/support/FacilityLayerInfo","../layers/support/LevelLayerInfo","../layers/support/SiteLayerInfo"],(function(e,t,r,o,s,i,n,a,l,c){"use strict";let p=class extends t{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};return e.__decorate([r.property({type:l,json:{write:{isRequired:!0}}})],p.prototype,"levelLayer",void 0),e.__decorate([r.property({type:a,json:{write:{isRequired:!0}}})],p.prototype,"facilityLayer",void 0),e.__decorate([r.property({type:c,json:{write:!0}})],p.prototype,"siteLayer",void 0),p=e.__decorate([n.subclass("esri.support.MapFloorInfo")],p),p}))},"esri/layers/support/FacilityLayerInfo":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n){"use strict";let a=class extends t{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};return e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"facilityIdField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"layerId",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"nameField",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],a.prototype,"siteIdField",void 0),e.__decorate([r.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"sublayerId",void 0),a=e.__decorate([n.subclass("esri.layers.support.FacilityLayerInfo")],a),a}))},"esri/layers/support/LevelLayerInfo":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n){"use strict";let a=class extends t{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};return e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"facilityIdField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"layerId",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"levelIdField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"levelNumberField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"longNameField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"shortNameField",void 0),e.__decorate([r.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"sublayerId",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"verticalOrderField",void 0),a=e.__decorate([n.subclass("esri.layers.support.LevelLayerInfo")],a),a}))},"esri/layers/support/SiteLayerInfo":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n){"use strict";let a=class extends t{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};return e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"layerId",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"nameField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"siteIdField",void 0),e.__decorate([r.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"sublayerId",void 0),a=e.__decorate([n.subclass("esri.layers.support.SiteLayerInfo")],a),a}))},"esri/support/tagSymbols":function(){define(["exports"],(function(e){"use strict";const t=Symbol("WebScene");e.WebSceneTag=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/webSceneUtils":function(){define(["exports","../core/Error"],(function(e,t){"use strict";const r="webscene:schema-validation";e.createCopyError=function(){return new t("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")},e.createSchemaValidationError=function(e){return new t(r,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:e})},e.schemaValidationErrorName=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/spatialReferenceSupport":function(){define(["exports","../../geometry/support/SupportedGCSWkids","../ViewingMode"],(function(e,t,r){"use strict";e.isSpatialReferenceSupported=function(e,o){return null!=e&&(null==o||(o===r.ViewingMode.Local?!e.isGeographic||e.isWGS84||e.wkid===t.SupportedGCSWkids.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===t.SupportedGCSWkids.CGCS2000||e.wkid===t.SupportedGCSWkids.GCSMARS2000||e.wkid===t.SupportedGCSWkids.GCSMARS2000_SPHERE||e.wkid===t.SupportedGCSWkids.GCSMOON2000))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webdoc/Widgets":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/subclass","./widgets/FloorFilter","./widgets/Range","./widgets/TimeSlider"],(function(e,t,r,o,s,i,n,a,l,c){"use strict";var p;let u=p=class extends t{constructor(e){super(e),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new p(r.clone({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};return e.__decorate([o.property({type:l,json:{write:!0}})],u.prototype,"range",void 0),e.__decorate([o.property({type:c,json:{write:!0}})],u.prototype,"timeSlider",void 0),e.__decorate([o.property({type:a,json:{write:!0}})],u.prototype,"floorFilter",void 0),u=p=e.__decorate([n.subclass("esri.webdoc.Widgets")],u),u}))},"esri/webdoc/widgets/FloorFilter":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n){"use strict";var a;let l=a=class extends t{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new a(r.clone({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};return e.__decorate([o.property({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],l.prototype,"enabled",void 0),e.__decorate([o.property({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],l.prototype,"longNames",void 0),e.__decorate([o.property({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],l.prototype,"minimized",void 0),e.__decorate([o.property({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],l.prototype,"pinnedLevels",void 0),e.__decorate([o.property({type:String,json:{read:{source:"site"},write:{target:"site"}}})],l.prototype,"site",void 0),e.__decorate([o.property({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],l.prototype,"facility",void 0),e.__decorate([o.property({type:String,json:{read:{source:"level"},write:{target:"level"}}})],l.prototype,"level",void 0),l=a=e.__decorate([n.subclass("esri.webdoc.widgets.FloorFilter")],l),l}))},"esri/webdoc/widgets/Range":function(){define(["../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n,a){"use strict";var l;const c=new t.JSONMap({slider:"slider",picker:"picker"});let p=l=class extends r{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new l({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};return e.__decorate([o.property({type:c.apiValues,nonNullable:!0,json:{type:c.jsonValues,default:null,read:{reader:c.read},write:{isRequired:!0,writer:c.write}}})],p.prototype,"interactionMode",void 0),e.__decorate([o.property({type:s.Integer,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=null!=this.stopInterval;return{enabled:!e,isRequired:!e}}}}})],p.prototype,"numStops",void 0),e.__decorate([o.property({type:Number,json:{write:{overridePolicy(){return{isRequired:null==this.numStops}}}}})],p.prototype,"stopInterval",void 0),p=l=e.__decorate([a.subclass("esri.webdoc.widgets.Range")],p),p}))},"esri/webdoc/widgets/TimeSlider":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../portal/timeUnitKebabDictionary","../../chunks/TimeExtent","../../chunks/TimeInterval"],(function(e,t,r,o,s,i,n,a,l,c,p,u){"use strict";var d;let y=d=class extends t{constructor(e){super(e),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(e){return e?p.TimeExtent.fromArray(e):void 0}writeCurrentTimeExtent(e,t,r){e&&o.setDeepValue(r,e.toArray(),t)}readFullTimeExtent(e,t){const r=t.properties;if(!r)return;const o=null!=r.endTime?new Date(r.endTime):null,s=null!=r.startTime?new Date(r.startTime):null;return new p.TimeExtent({start:s,end:o})}writeFullTimeExtent(e,t){if(!e)return;const r=t.properties=t.properties||{},o=e.end,s=e.start;o&&(r.endTime=null!=o?o.getTime():null),s&&(r.startTime=null!=s?s.getTime():null)}readStopInterval(e,t,r){return e?u.TimeInterval.fromJSON({value:e.interval,unit:e.units},r):null}writeStopInterval(e,t,r,s){if(!e)return;const i=e.toJSON(s);o.setDeepValue("properties.timeStopInterval",{interval:i.value,units:i.unit},t)}readStops(e){return e?.length?e.map((e=>new Date(e))):null}writeStops(e,t,r){e?.length&&o.setDeepValue(r,e.map((e=>e.getTime())),t)}clone(){return new d(r.clone({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};return e.__decorate([s.property({type:p.TimeExtent,json:{type:[[i.Integer,i.Null]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],y.prototype,"currentTimeExtent",void 0),e.__decorate([n.reader("currentTimeExtent")],y.prototype,"readCurrentTimeExtent",null),e.__decorate([l.writer("currentTimeExtent")],y.prototype,"writeCurrentTimeExtent",null),e.__decorate([s.property({type:p.TimeExtent,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],y.prototype,"fullTimeExtent",void 0),e.__decorate([n.reader("fullTimeExtent")],y.prototype,"readFullTimeExtent",null),e.__decorate([l.writer("fullTimeExtent")],y.prototype,"writeFullTimeExtent",null),e.__decorate([s.property({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],y.prototype,"loop",void 0),e.__decorate([s.property({type:i.Integer,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){const e=!!this.stopInterval,t=!!this.stops?.length,r=!(e||t);return{enabled:r,isRequired:r}}}}})],y.prototype,"numStops",void 0),e.__decorate([s.property({type:[1,2],nonNullable:!0,json:{type:i.Integer,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],y.prototype,"numThumbs",void 0),e.__decorate([s.property({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],y.prototype,"stopDelay",void 0),e.__decorate([s.property({type:u.TimeInterval,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:c.timeUnitKebabDictionary.jsonValues.filter((e=>"esriTimeUnitsUnknown"!==e))}},overridePolicy(){const e=null!=this.numStops,t=!!this.stops?.length;return{enabled:!t,isRequired:!(e||t)}}}}})],y.prototype,"stopInterval",void 0),e.__decorate([n.reader("stopInterval")],y.prototype,"readStopInterval",null),e.__decorate([l.writer("stopInterval")],y.prototype,"writeStopInterval",null),e.__decorate([s.property({type:[Date],json:{type:[i.Integer],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:null==this.numStops&&!this.stopInterval}}}}})],y.prototype,"stops",void 0),e.__decorate([n.reader("stops")],y.prototype,"readStops",null),e.__decorate([l.writer("stops")],y.prototype,"writeStops",null),y=d=e.__decorate([a.subclass("esri.webdoc.widgets.TimeSlider")],y),y}))},"esri/webdoc/support/resourceUtils":function(){define(["require","exports","../../core/Error","../../core/promiseUtils","../../core/uuid","../../portal/support/resourceUtils"],(function(e,t,r,o,s,i){"use strict";async function n(t,n,a){if(!n?.resources)return;const l=n.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=n.portalItem;const c=new Set(n.resources.toKeep.map((e=>e.resource.path))),p=new Set,u=[];c.forEach((e=>{l.delete(e),t.paths.push(e)}));const d=[],y=[],h=[];for(const e of n.resources.toUpdate)if(l.delete(e.resource.path),c.has(e.resource.path)||p.has(e.resource.path)){const{resource:r,content:o,finish:n}=e,a=i.getSiblingOfSameTypeI(r,s.generateUUID());t.paths.push(a.path),d.push({resource:a,content:await i.contentToBlob(o),compress:e.compress}),n&&h.push((()=>n(a)))}else{t.paths.push(e.resource.path),y.push({resource:e.resource,content:await i.contentToBlob(e.content),compress:e.compress});const r=e.finish;r&&h.push((()=>r(e.resource))),p.add(e.resource.path)}for(const e of n.resources.toAdd)if(t.paths.push(e.resource.path),l.has(e.resource.path))l.delete(e.resource.path);else{d.push({resource:e.resource,content:await i.contentToBlob(e.content),compress:e.compress});const t=e.finish;t&&h.push((()=>t(e.resource)))}if(d.length||y.length){const{addOrUpdateResources:t}=await new Promise(((t,r)=>e(["../../portal/support/resourceUtils"],t,r)));await t(n.portalItem,d,"add",a),await t(n.portalItem,y,"update",a)}if(h.forEach((e=>e())),0===u.length)return l;const m=await o.allSettledErrors(u);if(o.throwIfAborted(a),m.length>0)throw new r("save:resources","Failed to save one or more resources",{errors:m});return l}async function a(e,t,r){if(!e||!t.portalItem)return;const s=[];for(const o of e){const e=t.portalItem.resourceFromPath(o);s.push(e.portalItem.removeResource(e,r))}await o.eachAlways(s)}t.saveResources=async function(e,t,r){const o=await n(e,t,r);await a(o,t,r)},t.updateItemWithResources=async function(e,t,r,o,s){const i=await n(r,o,s);await e.update({data:t}),await a(i,o,s)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/portal/support/resourceUtils":function(){define(["exports","../../request","../../core/Error","../../core/urlUtils"],(function(e,t,r,o){"use strict";function s(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function i(e){const[t,r]=function(e){const t=o.getPathExtension(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[i,n]=s(t);return[i,n,r]}e.addOrUpdateResources=async function(e,t,i,n){const a=new Map;for(const{resource:e,content:o,compress:n,access:l}of t){if(!e.hasPath())throw new r(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[t,c]=s(e.path),p=`${t}/${n??""}/${l??""}`;a.has(p)||a.set(p,{prefix:t,compress:n,access:l,files:[]}),a.get(p).files.push({fileName:c,content:o})}await e.load(n);const l=o.join(e.userItemUrl,"add"===i?"addResources":"updateResources");for(const{prefix:t,compress:r,access:o,files:s}of a.values()){const i=25;for(let a=0;a<s.length;a+=i){const c=s.slice(a,a+i),p=new FormData;t&&"."!==t&&p.append("resourcesPrefix",t),r&&p.append("compress","true"),o&&p.append("access",o);let u=0;for(const{fileName:e,content:t}of c)p.append("file"+ ++u,t,e);p.append("f","json"),await e.portal.request(l,{method:"post",body:p,signal:n?.signal})}}},e.contentToBlob=async function(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await t(e.url,{responseType:"blob"})).data},e.fetchResources=async function(e,t={},r){await e.load(r);const s=o.join(e.itemUrl,"resources"),{start:i=1,num:n=10,sortOrder:a="asc",sortField:l="resource"}=t,c={query:{start:i,num:n,sortOrder:a,sortField:l,token:e.apiKey},signal:r?.signal},p=await e.portal.request(s,c);return{total:p.total,nextStart:p.nextStart,resources:p.resources.map((({created:t,size:r,resource:o})=>({created:new Date(t),size:r,resource:e.resourceFromPath(o)})))}},e.getSiblingOfSameType=function(e,t){if(!e.hasPath())return null;const[r,,s]=i(e.path);return e.portalItem.resourceFromPath(o.join(r,t+s))},e.getSiblingOfSameTypeI=function(e,t){if(!e.hasPath())return null;const[r,,s]=i(e.path);return e.portalItem.resourceFromPath(o.join(r,t+s))},e.removeAllResources=async function(e,t){await e.load(t);const r=o.join(e.userItemUrl,"removeResources");return e.portal.request(r,{method:"post",query:{deleteAll:!0},signal:t?.signal})},e.removeResource=async function(e,t,s){if(!t.hasPath())throw new r("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(s);const i=o.join(e.userItemUrl,"removeResources");await e.portal.request(i,{method:"post",query:{resource:t.path},signal:s?.signal}),t.portalItem=null},e.splitPrefixFileNameAndExtension=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webdoc/support/saveUtils":function(){define(["exports","../../core/Error","../../layers/support/layerUtils"],(function(e,t,r){"use strict";const o=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);e.beforeSave=async function(e){const t=[];for(const r of e.allLayers)if("beforeSave"in r&&"function"==typeof r.beforeSave){const e=r.beforeSave();e&&t.push(e)}await Promise.allSettled(t)},e.evaluateWriteErrors=function(e,r,s){let i=(e.messages??[]).filter((({type:e})=>"error"===e)).map((({name:e,message:r,details:o})=>new t(e,r,o)));if(e.blockedRelativeUrls&&(i=i.concat(e.blockedRelativeUrls.map((e=>new t("url:unsupported",`Relative url '${e}' is not supported`))))),s){const{ignoreUnsupported:e,supplementalUnsupportedErrors:t=[],requiredPropertyChecksDisabled:r}=s;e&&(i=i.filter((({name:e})=>!(o.has(e)||t.includes(e))))),r&&(i=i.filter((e=>"web-document-write:property-required"!==e.name)))}if(i.length>0)throw new t(r.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:i})},e.hasCharts=function(e){return r.getLayersWithChartSupport(e).some((e=>!!e.charts?.length))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webdoc/support/thumbnailUtils":function(){define(["exports"],(function(e){"use strict";const t={width:600,height:400},r=1.5;e.getOptimalThumbnailSize=function(e,o){o=o||t;let{width:s,height:i}=o;const n=s/i;return n<r?i=s/r:n>r&&(s=i*r),s>e.width&&(i*=e.width/s,s=e.width),i>e.height&&(s*=e.height/i,i=e.height),{width:Math.round(s),height:Math.round(i)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webdoc/support/webdocSaveUtils":function(){define(["require","exports","../../core/Error","../../core/MultiOriginJSONSupport","../../core/reactiveUtils","../../core/urlUtils","../../core/accessorSupport/originUtils","../../geometry/SpatialReference","../../geometry/support/spatialReferenceUtils","../../geometry/support/webMercatorUtils","../../layers/support/arcgisLayerUrl","../../layers/support/layerUtils","../../portal/Portal","../../portal/PortalItem","../../portal/support/jsonContext","../../portal/support/portalItemUtils","../../rest/geometryService/project","../../rest/support/ProjectParameters","../../support/basemapUtils","./resourceUtils","./saveUtils"],(function(e,t,r,o,s,i,n,a,l,c,p,u,d,y,h,m,g,b,_,w,f){"use strict";const S=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map((e=>e.toLowerCase()));async function v(e,t,r){const o=h.createForItemWrite(t,r,!0),s=e.write({},o);return await Promise.all(o.resources.pendingOperations),{json:s,jsonContext:o}}function T(e,t){if(t.type!==e.itemType)throw new r(`${e.name}:portal-item-wrong-type`,`Portal item needs to have type "${e.itemType}"`)}async function E(e,t){if("linkchart"===e.name)return;if(!t.basemap?.baseLayers.length)throw new r(`${e.name}:save`,"Map does not have a valid basemap with a base layer.");let o=null;if(await s.whenOnce((()=>{const e=_.findSpatialReference(t.initialViewProperties,t.basemap);return o=e.spatialReference,!e.updating})),!l.equals(o,t.initialViewProperties.spatialReference))throw new r(`${e.name}:save`,"The spatial reference of the basemap is not compatible with the one from the map.",{expected:t.initialViewProperties.spatialReference,actual:o})}function I(e){const t=[];return e.basemap&&t.push(e.basemap.load()),e.ground&&t.push(e.ground.load()),Promise.allSettled(t).then((()=>{}))}async function R(t,r){r.extent=await async function(t,r){const o=r.clone().normalize();let s;if(o.length>1)for(const e of o)s?e.width>s.width&&(s=e):s=e;else s=o[0];return async function(t,r){const o=r.spatialReference;if(o.isWGS84)return r.clone();if(o.isWebMercator)return c.webMercatorToGeographic(r);const{getGeometryServiceURL:s}=await new Promise(((t,r)=>e(["../../portal/support/geometryServiceUtils"],t,r))),i=await s(t),n=new b({geometries:[r],outSpatialReference:a.WGS84});return(await g.project(i,n))[0]}(t,s)}(t.portalItem,t.initialViewProperties.viewpoint.targetGeometry),await async function(e,t){m.addTypeKeyword(t,L),await function(e){const t=V(e).map((e=>e.load())).toArray();return Promise.allSettled(t).then((()=>{}))}(e),function(e,t){m.hasTypeKeyword(t,P)||m.hasTypeKeyword(t,N)||m.hasTypeKeyword(t,j)||m.hasTypeKeyword(t,U)||!G(e)?m.removeTypeKeyword(t,O):m.addTypeKeyword(t,O)}(e,t),function(e,t){G(e)?m.addTypeKeyword(t,C):m.removeTypeKeyword(t,C)}(e,t),function(e,t){!m.hasTypeKeyword(t,A)&&function(e){return V(e).filter((e=>"group"!==e.type)).every((t=>t.loaded&&function(e,t){return u.isLayerWithFeatureLayerSource(t)&&t.capabilities.operations.supportsSync||function(e){return u.isFeatureCollectionLayer(e)||"map-notes"===e.type||"route"===e.type}(t)&&!t.portalItem||function(e){return("tile"===e.type||"vector-tile"===e.type)&&(e.capabilities.operations.supportsExportTiles||function(e){return"tile"===e.type&&p.isServerOrServicesAGOLUrl(e.url)&&S.some((t=>e.url?.toLowerCase().includes("/"+t+"/")))}(e)||_.isDeveloperBasemapLayer(e))}(t)&&!function(e){return"vector-tile"===e.type&&Object.keys(e.sourceNameToSource).length>1}(t)&&t.spatialReference.equals(e.initialViewProperties.spatialReference)}(e,t)))}(e)?m.addTypeKeyword(t,k):m.removeTypeKeyword(t,k)}(e,t),function(e,t){_.hasDeveloperBasemapLayer(e.basemap)?m.addTypeKeyword(t,x):m.removeTypeKeyword(t,x)}(e,t),function(e,t){e.utilityNetworks?.length?m.addTypeKeyword(t,M):m.removeTypeKeyword(t,M)}(e,t),function(e,t){e.ipsInfo?m.addTypeKeyword(t,F):m.removeTypeKeyword(t,F)}(e,t),function(e,t){m.toggleTypeKeyword(t,m.typeKeyword.CHARTS,f.hasCharts(e))}(e,t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}(t,r)}const L=m.typeKeyword.JSAPI,P="CollectorDisabled",O="Collector",C="Data Editing",A="OfflineDisabled",k="Offline",N="Workforce Project",j="Workforce Worker",U="Workforce Dispatcher",x=m.typeKeyword.DEVELOPER_BASEMAP,M="UtilityNetwork",F="IPS";function V(e){return e.allLayers.concat(e.allTables)}function G(e){return V(e).some((e=>e.loaded&&u.isLayerWithFeatureLayerSource(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&("subtype-group"!==e.type||e.sublayers.some((e=>e.editingEnabled)))))}async function W(e,t){const{item:r,authenticated:o}=e;return r?.id&&r.typeKeywords?.includes("useOnly")?r.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(o||await r.reload(),{copyAllowed:"admin"===r.itemControl||"update"===r.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function D(e,t,r,o){const s=e.portal,{item:n}=t,{folder:a,copyAllResources:l}=o;let c=!1;if(l&&n?.id&&i.hasSameCanonicalPortal(n.portal.url,s.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:e}=await n.fetchResources();c=!!e}if(c){const t=await n.copy({copyResources:"all",folder:a});e.id=t.id,e.portal=t.portal;const o=e.toJSON();await e.load(),e.read(o),await e.update({data:r})}else await s.user.addItem({item:e,folder:a,data:r});return c}function q(e,t,r,s,a){o.MultiOriginJSONSupport.prototype.read.call(t,{version:s.version,authoringApp:s.authoringApp,authoringAppVersion:s.authoringAppVersion},{origin:e.origin,ignoreDefaults:!0,url:r.itemUrl?i.urlToObject(r.itemUrl):void 0}),n.updateOrigins(a),t.resourceInfo=s}t.createJSON=v,t.initializeNewItem=D,t.isCopyAllowed=W,t.save=async function(e,t,o){o??={},function(e,t){if(!t.portalItem)throw new r(`${e.name}:portal-item-not-set`,"Portal item to save to has not been set on the WebMap");T(e,t.portalItem)}(e,t),await s.whenOnce((()=>!t.updatingFromView)),await t.load(),await I(t),await f.beforeSave(t),await E(e,t);const i=t.portalItem,{json:n,jsonContext:a}=await v(t,i,e.origin);return f.evaluateWriteErrors(a,{errorName:`${e.name}:save`},o),await R(t,i),await async function(e,t,r,o,s){await r.update({data:o}),q(e,t,r,o,s)}(e,t,i,n,a),await Promise.all([t.updateItemThumbnail(),w.saveResources(t.resourceReferences,a)]),i},t.saveAs=async function(e,t,o,i){i??={};const n=function(e,t){let r=y.from(t);return r.id&&(r=r.clone(),r.id=null),r.type||(r.type=e.itemType),r.portal||(r.portal=d.getDefault()),T(e,r),r}(e,o);await s.whenOnce((()=>!t.updatingFromView)),await t.load(),await I(t),await f.beforeSave(t),await E(e,t);const{json:a,jsonContext:l}=await v(t,n,e.origin);f.evaluateWriteErrors(l,{errorName:`${e.name}:save`},i),await async function(e,t){m.removeTypeKeyword(t,P),m.removeTypeKeyword(t,"FieldMapsDisabled"),m.removeTypeKeyword(t,m.typeKeyword.METADATA),m.removeTypeKeyword(t,A),m.removeTypeKeyword(t,"Offline Map Areas"),m.removeTypeKeyword(t,U),m.removeTypeKeyword(t,N),m.removeTypeKeyword(t,j),await R(e,t)}(t,n);const c=t.getThumbnailState();return await async function(e,t,o,s,i,n){const a=t.portalItem,l={item:a,authenticated:!(!a?.id||!a.portal.user)},c=o.portal;await c.signIn();const{copyAllowed:p,itemReloaded:u}=await W(l,c);if(l.authenticated||=u,!p)throw new r(`${e.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const d=await D(o,l,s,n);return t.portalItem=o,q(e,t,o,s,i),d}(e,t,n,a,l,i)&&(t.resourceReferences.portalItem=n),t.restoreThumbnailFromState(c),await Promise.all([t.updateItemThumbnail(),w.saveResources(t.resourceReferences,l)]),n},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/geometryService/project":function(){define(["exports","../../request","../../core/accessorSupport/ensureType","../../geometry/support/jsonUtils","../utils","./utils","../support/ProjectParameters"],(function(e,t,r,o,s,i,n){"use strict";const a=r.ensureType(n);e.project=async function(e,r,n){r=a(r);const l=s.parseUrl(e),c={...l.query,f:"json",...r.toJSON()},p=r.outSpatialReference,u=o.getJsonType(r.geometries[0]),d=s.asValidOptions(c,n);return t(l.path+"/project",d).then((({data:{geometries:e}})=>i.decodeGeometries(e,u,p)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/support/ProjectParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/SpatialReference","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils"],(function(e,t,r,o,s,i,n,a,l,c,p){"use strict";return e.default=class extends r{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((e=>e.toJSON())),t=this.geometries[0],r={};return r.outSR=p.srToRESTValue(this.outSpatialReference),r.inSR=p.srToRESTValue(t.spatialReference),r.geometries=JSON.stringify({geometryType:c.getJsonType(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}},t.__decorate([o.property()],e.default.prototype,"geometries",void 0),t.__decorate([o.property({type:l,json:{read:{source:"outSR"}}})],e.default.prototype,"outSpatialReference",void 0),t.__decorate([o.property()],e.default.prototype,"transformation",void 0),t.__decorate([o.property()],e.default.prototype,"transformForward",void 0),e.default=t.__decorate([a.subclass("esri.rest.support.ProjectParameters")],e.default),e.default}))},"esri/webscene/ApplicationProperties":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../webdoc/applicationProperties/Viewing"],(function(e,t,r,o,s,i,n,a){"use strict";var l;let c=l=class extends t{constructor(e){super(e),this.viewing=null}clone(){return new l({viewing:this.viewing?.clone()??null})}};return e.__decorate([r.property({type:a,json:{write:!0}})],c.prototype,"viewing",void 0),c=l=e.__decorate([n.subclass("esri.webscene.ApplicationProperties")],c),c}))},"esri/webdoc/applicationProperties/Viewing":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./Search"],(function(e,t,r,o,s,i,n,a){"use strict";var l;let c=l=class extends t{constructor(e){super(e),this.search=null}clone(){return new l(r.clone({search:this.search}))}};return e.__decorate([o.property({type:a,json:{write:!0}})],c.prototype,"search",void 0),c=l=e.__decorate([n.subclass("esri.webdoc.applicationProperties.Viewing")],c),c}))},"esri/webdoc/applicationProperties/Search":function(){define(["../../chunks/tslib.es6","../../core/Collection","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../core/accessorSupport/extensions/serializableProperty/writePolicyUtils","./SearchLayer","./SearchTable"],(function(e,t,r,o,s,i,n,a,l,c,p,u,d){"use strict";var y;const h=t.ofType(u),m=t.ofType(d);let g=y=class extends r{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new h,this.tables=new m}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,r){t[r]=!e}clone(){return new y(o.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};return e.__decorate([s.property({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],g.prototype,"addressSearchEnabled",void 0),e.__decorate([a.reader("addressSearchEnabled")],g.prototype,"readAddressSearchEnabled",null),e.__decorate([c.writer("addressSearchEnabled")],g.prototype,"writeAddressSearchEnabled",null),e.__decorate([s.property({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],g.prototype,"enabled",void 0),e.__decorate([s.property({type:String,json:{write:!0}})],g.prototype,"hintText",void 0),e.__decorate([s.property({type:h,json:{write:{overridePolicy:p.writeNonEmptyCollectionPolicy},origins:{"web-scene":{write:{isRequired:!0}}}}})],g.prototype,"layers",void 0),e.__decorate([s.property({type:m,json:{read:!0,write:{overridePolicy:p.writeNonEmptyCollectionPolicy}}})],g.prototype,"tables",void 0),g=y=e.__decorate([l.subclass("esri.webdoc.applicationProperties.Search")],g),g}))},"esri/core/accessorSupport/extensions/serializableProperty/writePolicyUtils":function(){define(["exports"],(function(e){"use strict";e.writeNonEmptyCollectionPolicy=function(e){return{enabled:!!e?.length}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webdoc/applicationProperties/SearchLayer":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","./SearchLayerField"],(function(e,t,r,o,s,i,n){"use strict";var a;let l=a=class extends t{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new a(r.clone({field:this.field,id:this.id,subLayer:this.subLayer}))}};return e.__decorate([o.property({type:n,json:{write:{isRequired:!0}}})],l.prototype,"field",void 0),e.__decorate([o.property({type:String,json:{write:{isRequired:!0}}})],l.prototype,"id",void 0),e.__decorate([o.property({type:s.Integer,json:{write:!0}})],l.prototype,"subLayer",void 0),l=a=e.__decorate([i.subclass("esri.webdoc.applicationProperties.SearchLayer")],l),l}))},"esri/webdoc/applicationProperties/SearchLayerField":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../layers/support/fieldType"],(function(e,t,r,o,s,i,n,a,l){"use strict";var c;let p=c=class extends t{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new c({exactMatch:this.exactMatch,type:this.type,name:this.name})}};return e.__decorate([r.property({type:Boolean,json:{write:!0}})],p.prototype,"exactMatch",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],p.prototype,"name",void 0),e.__decorate([n.enumeration(l.kebabDict)],p.prototype,"type",void 0),p=c=e.__decorate([a.subclass("esri.webdoc.applicationProperties.SearchLayerField")],p),p}))},"esri/webdoc/applicationProperties/SearchTable":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./SearchTableField"],(function(e,t,r,o,s,i,n,a){"use strict";var l;let c=l=class extends t{constructor(e){super(e),this.field=null,this.id=null}clone(){return new l(r.clone({field:this.field,id:this.id}))}};return e.__decorate([o.property({type:a,json:{write:{isRequired:!0}}})],c.prototype,"field",void 0),e.__decorate([o.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"id",void 0),c=l=e.__decorate([n.subclass("esri.webdoc.applicationProperties.SearchTable")],c),c}))},"esri/webdoc/applicationProperties/SearchTableField":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../layers/support/fieldType"],(function(e,t,r,o,s,i,n,a,l){"use strict";var c;let p=c=class extends t{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new c({exactMatch:this.exactMatch,type:this.type,name:this.name})}};return e.__decorate([r.property({type:Boolean,json:{write:!0}})],p.prototype,"exactMatch",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],p.prototype,"name",void 0),e.__decorate([n.enumeration(l.kebabDict)],p.prototype,"type",void 0),p=c=e.__decorate([a.subclass("esri.webdoc.applicationProperties.SearchTableField")],p),p}))},"esri/webscene/Environment":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/lang","../core/Logger","../core/accessorSupport/decorators/property","../core/has","../core/accessorSupport/decorators/subclass","../views/3d/environment/SunnyWeather","../views/3d/environment/weather","./lightingTypes","./SunLighting","./VirtualLighting","./background/utils"],(function(e,t,r,o,s,i,n,a,l,c,p,u,d){"use strict";var y;const h=(e,t,r)=>({enabled:!r?.isPresentation});let m=class extends t{static{y=this}constructor(e){super(e),this.lighting=new p,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){l.validateWeatherType(e?.type,o.getLogger(this))&&this._set("weather",e)}clone(){return new y(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?u.prototype.clone.call(this.lighting):p.prototype.clone.call(this.lighting),background:r.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};return e.__decorate([s.property({types:c.lightingTypes,nonNullable:!0,json:{write:!0}})],m.prototype,"lighting",void 0),e.__decorate([s.property(d.backgroundProperty)],m.prototype,"background",void 0),e.__decorate([s.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:h}}})],m.prototype,"atmosphereEnabled",void 0),e.__decorate([s.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:h}}})],m.prototype,"starsEnabled",void 0),e.__decorate([s.property({types:l.weatherTypes,nonNullable:!0,json:{write:!0},value:new a})],m.prototype,"weather",null),m=y=e.__decorate([n.subclass("esri.webscene.Environment")],m),m}))},"esri/views/3d/environment/SunnyWeather":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/enumeration","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n,a){"use strict";var l;let c=l=class extends t{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new l({cloudCover:this.cloudCover})}};return e.__decorate([n.enumeration({sunny:"sunny"}),r.property({json:{write:{isRequired:!0}}})],c.prototype,"type",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=l=e.__decorate([a.subclass("esri.views.3d.environment.SunnyWeather")],c),c}))},"esri/views/3d/environment/weather":function(){define(["exports","./CloudyWeather","./FoggyWeather","./RainyWeather","./SnowyWeather","./SunnyWeather"],(function(e,t,r,o,s,i){"use strict";const n={key:"type",base:i,typeMap:{sunny:i,cloudy:t,rainy:o,snowy:s,foggy:r}},a=Object.keys(n.typeMap);e.cloudsHeight=1e5,e.heightLimit=1e4,e.validateWeatherType=function(e,t){return!!a.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)},e.weatherTypes=n,e.weatherTypesArray=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/environment/CloudyWeather":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/enumeration","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n,a){"use strict";var l;let c=l=class extends t{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new l({cloudCover:this.cloudCover})}};return e.__decorate([n.enumeration({cloudy:"cloudy"}),r.property({json:{write:{isRequired:!0}}})],c.prototype,"type",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=l=e.__decorate([a.subclass("esri.views.3d.environment.CloudyWeather")],c),c}))},"esri/views/3d/environment/FoggyWeather":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/enumeration","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n,a){"use strict";var l;let c=l=class extends t{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new l({fogStrength:this.fogStrength})}};return e.__decorate([n.enumeration({foggy:"foggy"}),r.property({json:{write:{isRequired:!0}}})],c.prototype,"type",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"fogStrength",void 0),c=l=e.__decorate([a.subclass("esri.views.3d.environment.FoggyWeather")],c),c}))},"esri/views/3d/environment/RainyWeather":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/enumeration","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n,a){"use strict";var l;let c=l=class extends t{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new l({cloudCover:this.cloudCover,precipitation:this.precipitation})}};return e.__decorate([n.enumeration({rainy:"rainy"}),r.property({json:{write:{isRequired:!0}}})],c.prototype,"type",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"precipitation",void 0),c=l=e.__decorate([a.subclass("esri.views.3d.environment.RainyWeather")],c),c}))},"esri/views/3d/environment/SnowyWeather":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/enumeration","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n,a){"use strict";var l;let c=l=class extends t{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new l({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};return e.__decorate([n.enumeration({snowy:"snowy"}),r.property({json:{write:{isRequired:!0}}})],c.prototype,"type",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"precipitation",void 0),e.__decorate([r.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],c.prototype,"snowCover",void 0),c=l=e.__decorate([a.subclass("esri.views.3d.environment.SnowyWeather")],c),c}))},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],(function(e,t,r){"use strict";const o={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:t,virtual:r}};e.lightingTypes=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/SunLighting":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer"],(function(e,t,r,o,s,i,n,a,l){"use strict";var c;let p=class extends t{static{c=this}constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return null!=t.datetime&&new Date(t.datetime)||null}writeDate(e,t,r){t[r]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,r){e&&(t[r]=e)}writeDisplayUTCOffset(e,t){null!=e&&(t.displayUTCOffset=e)}clone(){return new c(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(e.date=new Date(this.date.getTime())),e}};return e.__decorate([r.property({readOnly:!0,type:["sun"],json:{write:!0}})],p.prototype,"type",void 0),e.__decorate([r.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],p.prototype,"date",void 0),e.__decorate([n.reader("date",["datetime"])],p.prototype,"readDate",null),e.__decorate([l.writer("date")],p.prototype,"writeDate",null),e.__decorate([r.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],p.prototype,"directShadowsEnabled",void 0),e.__decorate([n.reader("directShadowsEnabled",["directShadows"])],p.prototype,"readDirectShadowsEnabled",null),e.__decorate([l.writer("directShadowsEnabled")],p.prototype,"writedirectShadowsEnabled",null),e.__decorate([r.property({type:Number,json:{write:!0}})],p.prototype,"displayUTCOffset",void 0),e.__decorate([l.writer("displayUTCOffset")],p.prototype,"writeDisplayUTCOffset",null),p=c=e.__decorate([a.subclass("esri.webscene.SunLighting")],p),p}))},"esri/webscene/VirtualLighting":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n){"use strict";var a;let l=class extends t{static{a=this}constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new a(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};return e.__decorate([r.property({readOnly:!0,type:["virtual"],json:{write:{isRequired:!0}}})],l.prototype,"type",void 0),e.__decorate([r.property({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],l.prototype,"directShadowsEnabled",void 0),l=a=e.__decorate([n.subclass("esri.webscene.VirtualLighting")],l),l}))},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],(function(e,t,r){"use strict";const o={base:t,key:"type",typeMap:{color:r}},s={types:o,json:{read:(i=o,(e,t,r)=>{if(!e)return e;for(const t in i.typeMap)if(e.type===t){const o=new i.typeMap[t];return o.read(e,r),o}}),write:{overridePolicy:(e,t,r)=>({enabled:!r?.isPresentation})}}};var i;e.backgroundProperty=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/background/Background":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n){"use strict";let a=class extends t{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};return e.__decorate([r.property({readOnly:!0,json:{read:!1}})],a.prototype,"type",void 0),a=e.__decorate([n.subclass("esri.webscene.background.Background")],a),a}))},"esri/webscene/background/ColorBackground":function(){define(["../../chunks/tslib.es6","../../Color","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../symbols/support/materialUtils","./Background"],(function(e,t,r,o,s,i,n,a,l,c){"use strict";var p;let u=p=class extends c{constructor(e){super(e),this.type="color",this.color=new t([0,0,0,1])}clone(){return new p(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};return e.__decorate([n.enumeration({color:"color"},{readOnly:!0}),r.property({json:{write:{isRequired:!0}}})],u.prototype,"type",void 0),e.__decorate([r.property(l.colorAndTransparencyProperty({nonNullable:!0,colorRequiredOnWrite:!0}))],u.prototype,"color",void 0),u=p=e.__decorate([a.subclass("esri.webscene.background.ColorBackground")],u),u}))},"esri/webscene/InitialViewProperties":function(){define(["../chunks/tslib.es6","../Viewpoint","../core/Clonable","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../geometry/SpatialReference","../webdoc/support/timeProperties","./Environment","./support/analysisUtils"],(function(e,t,r,o,s,i,n,a,l,c,p,u,d){"use strict";let y=class extends(r.ClonableMixin(o)){constructor(e){super(e),this.analyses=new d.WebSceneAnalysesCollection,this.environment=new u,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(e){this._set("viewingMode",e)}};return e.__decorate([s.property(d.webSceneAnalysisCollectionProperty("analyses"))],y.prototype,"analyses",void 0),e.__decorate([s.property({type:u,json:{write:{isRequired:!0}}})],y.prototype,"environment",void 0),e.__decorate([s.property({type:c,json:{default:()=>c.WebMercator}})],y.prototype,"spatialReference",void 0),e.__decorate([s.property({type:["local","global"],json:{default:"global"}})],y.prototype,"viewingMode",null),e.__decorate([s.property({type:t,json:{write:{isRequired:!0}}})],y.prototype,"viewpoint",void 0),e.__decorate([s.property(p.timeExtent)],y.prototype,"timeExtent",void 0),y=e.__decorate([l.subclass("esri.webscene.InitialViewProperties")],y),y}))},"esri/webdoc/support/timeProperties":function(){define(["exports","../../core/Error","../../core/accessorSupport/ensureType","../../chunks/TimeExtent"],(function(e,t,r,o){"use strict";const s={type:o.TimeExtent,json:{read:{source:"timeExtent",reader:e=>e?Array.isArray(e)?o.TimeExtent.fromArray(e):o.TimeExtent.fromJSON(e):null},write:{writer:(e,r,o,s)=>{e&&(e.isEmpty?s?.messages&&s.messages.push(new t("invalid-timeExtent","TimeExtent cannot be empty")):r[o]=e.toArray())},target:{timeExtent:{type:[[r.Integer,r.Null]]}}}}};e.timeExtent=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/support/analysisUtils":function(){define(["require","exports","../../chunks/tslib.es6","../../analysis/support/AnalysisOriginWebScene","../../core/Collection","../../core/collectionUtils","../../core/Logger","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n,a,l,c,p){"use strict";const u=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),d=["slice"];function y(e){return d.includes(e.type)&&e.valid}t.WebSceneAnalysesCollection=class extends s{constructor(e){super(e),this.addHandles([this.on("after-add",(e=>{this._setOrigin(e.item)})),this.on("before-remove",(e=>{const{origin:t}=e.item;"web-scene"===t?.type&&this._setOrigin(e.item,null)}))])}initialize(){for(const e of this.items)this._setOrigin(e)}_setOrigin(e,t=new o){e.origin=t}updateFrom(e){const t=e.analyses.filter((e=>y(e)));this.removeAll(),t.length&&this.addMany(t.map((e=>(e.origin=new o,e.clone()))))}applyTo(e){e.analyses.destroyMany(e.analyses.filter((({origin:e})=>"web-scene"===e?.type))),e.analyses.addMany(this.map((e=>e.clone())))}toJSON(e){return this.items.filter(y).map((t=>t.toJSON(e)))}},t.WebSceneAnalysesCollection=r.__decorate([p.subclass("esri.webscene.support.analysisUtils.WebSceneAnalysesCollection")],t.WebSceneAnalysesCollection);const h={slice:async()=>{const{default:t}=await new Promise(((t,r)=>e(["../../analysis/SliceAnalysis"],(e=>t(u(e))),r)));return t}};t.webSceneAnalysisCollectionProperty=function(e){return{type:t.WebSceneAnalysesCollection,cast:i.castForReferenceSetter,clonable:e=>new t.WebSceneAnalysesCollection({items:e.items.map((e=>e.clone()))}),set(r){this._set(e,i.referenceSetter(r,this._get(e),t.WebSceneAnalysesCollection))},json:{read(t,r,o){o?.hooks?.onAfterLoad((()=>async function(e,t,r){if(!t)return;const o=await Promise.allSettled(t.map((e=>async function(e,t){const r=new(await h[e.type]());return r.read(e,t),r}(e,r))));for(const t of o)"fulfilled"===t.status&&e.add(t.value)}(this[e],t,o)))},write:{overridePolicy:e=>({enabled:e.length>0})}}}},t.webSceneAnalysisRegistry=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/analysis/support/AnalysisOriginWebScene":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n){"use strict";let a=class extends t{constructor(e){super(e),this.type="web-scene"}equals(e){return this.type===e.type}};return e.__decorate([r.property()],a.prototype,"type",void 0),a=e.__decorate([n.subclass("esri.analysis.support.AnalysisOriginWebScene")],a),a}))},"esri/webscene/Presentation":function(){define(["../chunks/tslib.es6","../core/Clonable","../core/Collection","../core/collectionUtils","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Slide"],(function(e,t,r,o,s,i,n,a,l,c,p){"use strict";const u=r.ofType(p);let d=class extends(t.ClonableMixin(s)){constructor(e){super(e),this.slides=new u}destroy(){this.slides.forEach((e=>e.destroy())),this.slides.removeAll()}set slides(e){e&&(e=e.filter((e=>!!e.viewpoint))),this._set("slides",o.referenceSetter(e,this._get("slides"),u))}};return e.__decorate([i.property({type:u,nonNullable:!0,json:{write:!0}}),n.cast(o.castForReferenceSetter)],d.prototype,"slides",null),d=e.__decorate([c.subclass("esri.webscene.Presentation")],d),d}))},"esri/webscene/Slide":function(){define(["require","../chunks/tslib.es6","../Basemap","../Viewpoint","../core/asyncUtils","../core/Clonable","../core/Collection","../core/collectionUtils","../core/JSONSupport","../core/Logger","../core/mathUtils","../core/maybe","../core/promiseUtils","../core/reactiveUtils","../core/time","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../core/accessorSupport/ensureType","../chunks/vec32","../core/libs/gl-matrix-2/factories/vec3f64","../layers/Layer","../support/basemapEnsureType","../views/support/Scheduler","../webdoc/support/SlideThumbnail","../webdoc/support/timeProperties","./SunLighting","./VirtualLighting","./support/Description","./support/SlideElements","./support/SlideEnvironment","./support/SlideGround","./support/SlideVisibleLayer","./support/Title"],(function(e,t,r,o,s,i,n,a,l,c,p,u,d,y,h,m,g,b,_,w,f,S,v,T,E,I,R,L,P,O,C,A,k,N,j,U){"use strict";let x=0;const M=n.ofType(j.SlideVisibleLayer);let F=class extends(i.ClonableMixin(l)){constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+x++,this.title=new U,this.description=new C,this.hidden=!1,this.thumbnail=new R.SlideThumbnail,this.viewpoint=null,this.basemap=null,this.ground=null,this.layout="caption",this.enabledFocusAreas=null,this.environment=new k.SlideEnvironment,this.timeExtent=null,this.elements=new A,this.visibleLayers=new M}destroy(){this.visibleLayers.removeAll(),this.enabledFocusAreas=null,this.basemap=null,this.thumbnail=u.destroyMaybe(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null,this.elements=null}castTitle(e){return"string"==typeof e?new U({text:e}):f.ensureType(U,e)}castDescription(e){return"string"==typeof e?new C({text:e}):f.ensureType(C,e)}castThumbnail(e){return"string"==typeof e?new R.SlideThumbnail({url:e}):f.ensureType(R.SlideThumbnail,e)}castBasemap(e){return E.basemapEnsureType(e)}set visibleLayers(e){this._set("visibleLayers",a.referenceSetter(e,this._get("visibleLayers"),M))}castVisibleLayers(e){return e&&"function"==typeof e.map?e.map((e=>{if("string"==typeof e)return{id:e};if(e instanceof T){const t=W(e);return{id:e.id,sublayerIds:t}}return e.id?{id:e.id,sublayerIds:"sublayerIds"in e?e.sublayerIds:void 0}:(c.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),e)})):null}async _updateVisibleLayers(e){const t=[];await Promise.allSettled(this._getLayers(e.map).map((r=>e.whenLayerView(r).then((e=>{if(e.visible){const o=W(r);t.push(new j.SlideVisibleLayer({id:e.layer.id,sublayerIds:o}))}})))).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(t)}async updateFrom(e,t){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...t?.screenshot};await e.when(),this.viewpoint=e.viewpoint.clone(),this.environment.lighting="virtual"===e.environment.lighting.type?O.prototype.clone.apply(e.environment.lighting):P.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.enabledFocusAreas=new n(e.focusAreasView?.enabledAreas.map((({id:e})=>e))??[]),this.basemap=e.map.basemap?.clone()||null,this.ground=e.map.ground?N.fromGround(e.map.ground):null,this.timeExtent=e.timeExtent?.clone()??null,this.elements.analyses.updateFrom(e),await this._updateVisibleLayers(e);const o=await e.takeScreenshot(r);return this.thumbnail=new R.SlideThumbnail({url:o.dataUrl}),this}async applyTo(e,t){null!=this._applyToController&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const o=d.onAbortOrThrow(t,(()=>r?.abort())),i=()=>{this._applyToController===r&&(this._applyToController=null),r=null,o?.remove()};try{await y.whenOnce((()=>e.ready),r.signal)}catch(e){throw i(),e}if(r.signal.aborted)throw i(),d.createAbortError();const n=e.resourceController.scheduler.registerTask(I.TaskPriority.SLIDE);let a=!1;const l={animate:!0,...t,signal:this._applyToController.signal},c=await s.result(e.addUpdatingPromise((async()=>{await Promise.all([n.schedule((async()=>a=await this._setViewpointOfInterest(e,l))),n.schedule((()=>this._applyBasemap(e,l)),l.signal),n.schedule((()=>this._loadLayersWithSublayerVisibility(e)))]),await Promise.all([n.schedule((()=>this._applyLayerVisibility(e)),l.signal),n.schedule((()=>this._applyFocusAreaEnabled(e.map?.focusAreas.areas))),n.schedule((()=>this._applyGround(e)),l.signal),n.schedule((()=>this.elements.analyses.applyTo(e)),l.signal),n.schedule((()=>this._applyViewpoint(e,l)),l.signal),n.schedule((()=>e.timeExtent=this.timeExtent?.clone()??null),l.signal),n.schedule((()=>e.environment.weather=this.environment.weather.clone()))])})()));if(a&&(e.contentCamera=null),n.remove(),i(),!1===c.ok)throw c.error;return this}async _applyBasemap(e,t){if(this.basemap){try{await this.basemap.load(t)}catch(e){if(d.isAbortError(e))throw e}e.map.basemap=E.clonePreservingTiledLayers(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_applyFocusAreaEnabled(e){if(e&&this.enabledFocusAreas)for(const t of e)t.enabled=this.enabledFocusAreas.includes(t.id)}_getLayers(e){const t=new n;return this._collectLayers(e,t),this._collectLayers(e.ground,t),t}_collectLayers(e,t){e.layers.forEach((e=>{e.persistenceEnabled&&(t.add(e),"layers"in e&&this._collectLayers(e,t))}))}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map((e=>{const t=this.visibleLayers.find((t=>t.id===e.id))?.sublayerIds;return t?e.load():null})))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach((e=>{const t=this.visibleLayers.find((t=>t.id===e.id));e.visible=null!=t;const r=t?.sublayerIds,o=G(e);r&&o&&o.forEach((e=>e.visible=r.includes(e.id)))}))}async _setViewpointOfInterest(t,r){if(t.state.fixedContentCamera||!this.viewpoint||r?.ignoreViewpoint||!r?.useDestinationCamera)return!1;const{toCameraAsync:o}=await new Promise(((t,r)=>e(["../views/3d/support/viewpointUtils"],t,r))),s=await o(t,this.viewpoint);return t.contentCamera=s,null!=s}async _applyViewpoint(e,t){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!t.ignoreViewpoint){const r=this.environment.lighting;if(t.animate&&"sun"===r.type&&r.date)return this._animateToLighting(e,t);t.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,t)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,t){let r=null;return"virtual"!==e.environment.lighting.type&&"virtual"!==this.environment.lighting.type&&("global"===e.viewingMode&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,"virtual"===this.environment.lighting.type||"virtual"===e.environment.lighting.type?(e.environment.applyLighting(this.environment.lighting.clone()),"virtual"!==e.environment.lighting.type&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):null!=this.environment.lighting.displayUTCOffset&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,t).then((()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())})).catch((t=>{throw null==e.animation&&this._applyCachedCameraTrackingEnabled(e),t})).finally((()=>{u.removeMaybe(r)}))}_applyCachedCameraTrackingEnabled(e){null!=e.environment.cachedCameraTrackingEnabled&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[h.Milliseconds(e.getTime()),h.Seconds(3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds())]}_setTime(e,t,r){return e.setTime(t),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,t,r){const o=new Date(t.date.toString()),[s,i]=this._getTime(o),[n,a]=this._getTime(r.date),l=function(e,t){let r=t-e;return r>q&&(r-=D),r<-q&&(r+=D),h.Seconds(r)}(i,a),c=e.renderCoordsHelper,u=v.create();c.toRenderCoords(e.camera.position,u);const d=v.create(),m=v.create();null!=this.viewpoint.camera&&c.toRenderCoords(this.viewpoint.camera.position,d);const g=new Date;return y.when((()=>e.camera),(e=>{c.toRenderCoords(e.position,m);const r=S.squaredDistance(u,m),o=S.squaredDistance(d,m);let a=0;r+o!==0&&(a=r/(r+o));const y=s+(n-s)*a,b=function(e,t){return h.Seconds(p.moduloPositive(e+t,D))}(i,h.Seconds(l*a));t.date=this._setTime(g,y,b)}))}write(e,t){const r=super.write(e,t);return r?.elements&&0===Object.keys(r.elements).length&&delete r.elements,r}static createFrom(e,t){return(new this).updateFrom(e,t)}};t.__decorate([m.property({type:String,json:{write:{isRequired:!0}}})],F.prototype,"id",void 0),t.__decorate([m.property({type:U,json:{default:()=>new U({text:""}),write:{isRequired:!0}}})],F.prototype,"title",void 0),t.__decorate([g.cast("title")],F.prototype,"castTitle",null),t.__decorate([m.property({type:C,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.text)})}}})],F.prototype,"description",void 0),t.__decorate([g.cast("description")],F.prototype,"castDescription",null),t.__decorate([m.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],F.prototype,"hidden",void 0),t.__decorate([m.property({type:R.SlideThumbnail,json:{default:()=>new R.SlideThumbnail({url:""}),write:{isRequired:!0}}})],F.prototype,"thumbnail",void 0),t.__decorate([g.cast("thumbnail")],F.prototype,"castThumbnail",null),t.__decorate([m.property({type:o,nonNullable:!0,json:{write:{isRequired:!0}}})],F.prototype,"viewpoint",void 0),t.__decorate([m.property({type:r,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],F.prototype,"basemap",void 0),t.__decorate([g.cast("basemap")],F.prototype,"castBasemap",null),t.__decorate([m.property({type:N,json:{write:!0}})],F.prototype,"ground",void 0),t.__decorate([m.property({type:["caption","cover","none"],json:{write:!0,default:"caption"},nonNullable:!0})],F.prototype,"layout",void 0),t.__decorate([m.property({type:M,json:{write:{isRequired:!0}}})],F.prototype,"visibleLayers",null),t.__decorate([g.cast("visibleLayers")],F.prototype,"castVisibleLayers",null),t.__decorate([m.property({type:n.ofType(String),json:{write:!0},clonable:e=>e?new n(e.items):null})],F.prototype,"enabledFocusAreas",void 0),t.__decorate([m.property({type:k.SlideEnvironment,json:{write:!0}})],F.prototype,"environment",void 0),t.__decorate([m.property(L.timeExtent)],F.prototype,"timeExtent",void 0),t.__decorate([m.property({type:A,nonNullable:!0,json:{write:!0}})],F.prototype,"elements",void 0),F=t.__decorate([w.subclass("esri.webscene.Slide")],F);const V=F;function G(e){if("building-scene"===e.type||"map-image"===e.type)return e.allSublayers.toArray()}function W(e){const t=G(e);if(t)return t.filter((e=>e.visible)).map((e=>e.id))}const D=h.Seconds(86400),q=h.Seconds(43200);return V}))},"esri/views/support/Scheduler":function(){define(["exports","../../core/Handles","../../core/has","../../core/Logger","../../core/maybe","../../core/PerformanceSampler","../../core/PooledArray","../../core/promiseUtils","../../core/reactiveUtils","../../core/signal","../../core/time","../../layers/support/PromiseQueue","./debugFlags","./RenderState","./Yield"],(function(e,t,r,o,s,i,n,a,l,c,p,u,d,y,h){"use strict";var m;e.TaskPriority=void 0,(m=e.TaskPriority||(e.TaskPriority={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",m.RESOURCE_CONTROLLER="schedule",m.SLIDE="slide",m.STREAM_DATA_LOADER="stream loader",m.ELEVATION_QUERY="elevation query",m.TERRAIN_SURFACE="terrain",m.SURFACE_GEOMETRY_UPDATES="surface geometry updates",m.LOD_RENDERER="LoD renderer",m.GRAPHICS_CORE="Graphics3D",m.I3S_CONTROLLER="I3S",m.POINT_CLOUD_LAYER="point cloud",m.FEATURE_TILE_FETCHER="feature fetcher",m.OVERLAY="overlay",m.OVERLAY_RENDERER="overlay renderer",m.STAGE="stage",m.GRAPHICS_DECONFLICTOR="graphics deconflictor",m.FILTER_VISIBILITY="Graphics3D filter visibility",m.SCALE_VISIBILITY="Graphics3D scale visibility",m.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",m.POINT_OF_INTEREST_FREQUENT="POI frequent",m.POINT_OF_INTEREST_INFREQUENT="POI infrequent",m.LABELER="labeler",m.FEATURE_QUERY_ENGINE="feature query",m.FEATURE_TILE_TREE="feature tile tree",m.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",m.ELEVATION_ALIGNMENT="elevation alignment",m.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",m.TEXT_TEXTURE_ATLAS="text texture atlas",m.TEXTURE_UNLOAD="texture unload",m.LINE_OF_SIGHT_TOOL="line of sight tool",m.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",m.ELEVATION_PROFILE="elevation profile",m.SNAPPING="snapping",m.SHADOW_ACCUMULATOR="shadow accumulator",m.CLOUDS_GENERATOR="clouds generator",m.MAPVIEW_FETCH_QUEUE="mapview fetch queue",m.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",m.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",m[m.NONE=0]="NONE",m[m.TEST_PRIO=1]="TEST_PRIO";const g=new Map([[e.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE,0],[e.TaskPriority.RESOURCE_CONTROLLER,4],[e.TaskPriority.SLIDE,0],[e.TaskPriority.STREAM_DATA_LOADER,0],[e.TaskPriority.ELEVATION_QUERY,0],[e.TaskPriority.TERRAIN_SURFACE,1],[e.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[e.TaskPriority.LOD_RENDERER,2],[e.TaskPriority.GRAPHICS_CORE,2],[e.TaskPriority.I3S_CONTROLLER,2],[e.TaskPriority.POINT_CLOUD_LAYER,2],[e.TaskPriority.FEATURE_TILE_FETCHER,2],[e.TaskPriority.CLOUDS_GENERATOR,2],[e.TaskPriority.OVERLAY,4],[e.TaskPriority.OVERLAY_RENDERER,4],[e.TaskPriority.STAGE,4],[e.TaskPriority.GRAPHICS_DECONFLICTOR,4],[e.TaskPriority.FILTER_VISIBILITY,4],[e.TaskPriority.SCALE_VISIBILITY,4],[e.TaskPriority.FRUSTUM_VISIBILITY,4],[e.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[e.TaskPriority.POINT_OF_INTEREST_INFREQUENT,30],[e.TaskPriority.LABELER,8],[e.TaskPriority.FEATURE_QUERY_ENGINE,8],[e.TaskPriority.FEATURE_TILE_TREE,16],[e.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[e.TaskPriority.ELEVATION_ALIGNMENT,12],[e.TaskPriority.ELEVATION_ALIGNMENT_SCENE,14],[e.TaskPriority.TEXT_TEXTURE_ATLAS,12],[e.TaskPriority.TEXTURE_UNLOAD,12],[e.TaskPriority.LINE_OF_SIGHT_TOOL,16],[e.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[e.TaskPriority.SNAPPING,0],[e.TaskPriority.SHADOW_ACCUMULATOR,30],[e.TaskPriority.MAPVIEW_FETCH_QUEUE,0],[e.TaskPriority.MAPVIEW_LAYERVIEW_UPDATE,2],[e.TaskPriority.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function b(e){return g.has(e)?g.get(e):"number"==typeof e?e:1}const _=p.Milliseconds(6.5),w=p.Milliseconds(1),f=p.Milliseconds(30),S=p.Milliseconds(1e3/30),v=p.Milliseconds(100);var T,E;!function(r){r.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=c.signal(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new i("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new m,this._state=y.RenderState.INTERACTING,this._tasks=new n,this._runQueue=new n,this._load=0,this._idleStateCallbacks=new n,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=l.watch((()=>d.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),l.initial);for(const t of Object.keys(e.TaskPriority))this.performanceInfo.tasks.set(e.TaskPriority[t],new i(e.TaskPriority[t]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),s.removeMaybe(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())})))}registerTask(e,t){const r=new a(this,e,t);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new i(e)),r}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),this.state===y.RenderState.IDLE&&this._idleUpdatesStartFired&&r.idleBegin();const o=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){o._idleUpdatesStartFired&&(r.idleEnd(),o._state===y.RenderState.IDLE&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==y.RenderState.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}frame(e){this._startFrameTaskTimes();const t=this._updateBudget(e);if(t){const e=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-e)}else this._recordFrameTaskTimes(0);return t}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=_,r=e.frameDuration,o=w;switch(this.state){case y.RenderState.IDLE:t=p.Milliseconds(0),r=p.Milliseconds(Math.max(v,e.frameDuration)),o=f;break;case y.RenderState.INTERACTING:r=p.Milliseconds(Math.max(S,e.frameDuration));case y.RenderState.ANIMATING:}return r=p.Milliseconds(r-e.elapsedFrameTime-t),this.state!==y.RenderState.IDLE&&r<w&&!this._forceTask?(this._forceTask=!0,!1):(r=p.Milliseconds(Math.max(r,o)),this._budget.reset(r),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case y.RenderState.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case y.RenderState.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(p.Milliseconds(0)),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(t){if(this._runQueue.some((e=>e.name===t)))return e.TaskState.SCHEDULED;let r=e.TaskState.IDLE;return this._tasks.forAll((o=>{o.name===t&&o.needsUpdate&&(o.schedulePriority<=1?r=e.TaskState.READY:r!==e.TaskState.READY&&(r=e.TaskState.WAITING))})),r}_getRuntime(e){let t=0;return this._tasks.forAll((r=>{r.name===e&&(t+=r.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do{for(;this._runQueue.length>0;){const t=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)===h.Yield&&(r.blockFrame=this._frameNumber)}catch(e){o.getLogger("esri.views.support.Scheduler").error(`Exception in task "${r.name}"`,e),r.blockFrame=this._frameNumber}!this._budget.hasProgressed&&r.blockFrame!==this._frameNumber&&r.needsUpdate&&(r.name,e.TaskPriority.I3S_CONTROLLER,r.blockFrame=this._frameNumber),r.schedulePriority=r.basePriority;const s=this._budget.now()-t;if(r.runtime+=s,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+s),this._budget.remaining<=0)return void this._updatingChanged()}}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const t of Object.keys(e.TaskPriority))this._frameTaskTimes.set(e.TaskPriority[t],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).push(e))),this.performanceInfo.total.push(e)}get test(){return this._test}};class a{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,r,o){this._scheduler=e,this.name=r,this.blockFrame=0,this.runtime=0,this._queue=new u.PromiseQueue,this._handles=new t,this._basePriority=b(r),this.schedulePriority=this._basePriority,this._task=c.signal(null!=o?o:this._queue),this._handles.add(l.when((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(I),this._scheduler.removeTask(this),this.schedule=R.schedule,this.reschedule=R.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=b(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class m{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}r.Budget=m}(T||(T={})),e.TaskState=void 0,(E=e.TaskState||(e.TaskState={})).SCHEDULED="s",E.READY="r",E.WAITING="w",E.IDLE="i";const I=new T.Budget;I.enabled=!1;const R=new class{remove(){}processQueue(){}schedule(e,t,r){try{if(a.isAborted(t)){const e=a.createAbortError();return r?Promise.resolve(r(e)):Promise.reject(e)}return a.when(e(I))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}};e.ImmediateTask=R,e.getTaskPriority=b,e.makeBudget=function(e){const t=new T.Budget;return t.reset(e),t},e.newScheduler=function(){return new T.Scheduler},e.noBudget=I,e.taskPriorities=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],(function(e,t,r,o){"use strict";class s{constructor(e,t,r,o=void 0,s=void 0){this.resolve=e,this.reject=t,this.callback=r,this.signal=o,this.abortCallback=s}}e.PromiseQueue=class{constructor(){this._tasks=new Array,this._numPendingTasks=r.signal(0),this._running=r.signal(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get running(){return this._running.value}_updateRunning(){this._running.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return o.Yield;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return new Promise(((o,i)=>{this._tasks.push(new s(o,i,e,t,r)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}unshift(e,t,r){return new Promise(((o,i)=>{this._tasks.unshift(new s(o,i,e,t,r)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}_process(e){if(0===this._tasks.length)return!1;const r=this._tasks.shift();this._updateRunning();try{const o=t.isAborted(r.signal);if(o&&!r.abortCallback)r.reject(t.createAbortError());else{const s=o?r.abortCallback?.(t.createAbortError()):r.callback(e);t.isPromiseLike(s)?s.then(r.resolve,r.reject):r.resolve(s)}}catch(e){r.reject(e)}return!0}cancelAll(){const e=t.createAbortError();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0,this._updateRunning()}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/Yield":function(){define(["exports"],(function(e){"use strict";const t=Symbol("Yield");e.Yield=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/debugFlags":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n){"use strict";let a=class extends t{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};return e.__decorate([r.property()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),e.__decorate([r.property()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=e.__decorate([n.subclass("esri.views.support.debugFlags")],a),new a}))},"esri/views/support/RenderState":function(){define(["exports"],(function(e){"use strict";var t;e.RenderState=void 0,(t=e.RenderState||(e.RenderState={}))[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webdoc/support/SlideThumbnail":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/urlUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n,a,l){"use strict";var c;e.SlideThumbnail=c=class extends r{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return o.isHTTPSProtocol(this.url)}get isDataURI(){return o.isDataProtocol(this.url)}clone(){return new c({url:this.url})}},t.__decorate([s.property({type:String,json:{write:{isRequired:!0}}})],e.SlideThumbnail.prototype,"url",void 0),t.__decorate([s.property()],e.SlideThumbnail.prototype,"isSecureUrl",null),t.__decorate([s.property()],e.SlideThumbnail.prototype,"isDataURI",null),e.SlideThumbnail=c=t.__decorate([l.subclass("esri.webdoc.support.SlideThumbnail")],e.SlideThumbnail),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/support/Description":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n,a){"use strict";let l=class extends(t.ClonableMixin(r)){constructor(){super(...arguments),this.text=""}};return e.__decorate([o.property({type:String,json:{write:{isRequired:!0}}})],l.prototype,"text",void 0),l=e.__decorate([a.subclass("esri.webscene.support.Description")],l),l}))},"esri/webscene/support/SlideElements":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../SlideLegendInfo","./analysisUtils","./SlidePopupInfo"],(function(e,t,r,o,s,i,n,a,l,c,p){"use strict";let u=class extends(t.ClonableMixin(r)){constructor(e){super(e),this.analyses=new c.WebSceneAnalysesCollection,this.legendInfo=null,this.popupInfo=null}};return e.__decorate([o.property(c.webSceneAnalysisCollectionProperty("analyses"))],u.prototype,"analyses",void 0),e.__decorate([o.property({type:l,json:{write:!0}})],u.prototype,"legendInfo",void 0),e.__decorate([o.property({type:p,json:{write:!0}})],u.prototype,"popupInfo",void 0),u=e.__decorate([a.subclass("esri.webscene.support.SlideElements")],u),u}))},"esri/webscene/SlideLegendInfo":function(){define(["../chunks/tslib.es6","../core/Clonable","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s){"use strict";let i=class extends(t.ClonableMixin(r)){constructor(e){super(e),this.visible=!1}};return e.__decorate([o.property({type:Boolean,json:{default:!1,write:!0}})],i.prototype,"visible",void 0),i=e.__decorate([s.subclass("esri.webscene.SlideLegendInfo")],i),i}))},"esri/webscene/support/SlidePopupInfo":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/Collection","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../geometry/Point","./FeatureReference"],(function(e,t,r,o,s,i,n,a){"use strict";const l=r.ofType(a);let c=class extends(t.ClonableMixin(o)){constructor(e){super(e),this.features=new l,this.selectedFeatureIndex=0,this.location=null}};return e.__decorate([s.property({type:l,nonNullable:!0,json:{read:!0,write:{isRequired:!0}}})],c.prototype,"features",void 0),e.__decorate([s.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"selectedFeatureIndex",void 0),e.__decorate([s.property({type:n,json:{write:{isRequired:!0}}})],c.prototype,"location",void 0),c=e.__decorate([i.subclass("esri.webscene.support.SlidePopupInfo")],c),c}))},"esri/webscene/support/FeatureReference":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./FeatureReferenceObjectId","./featureReferenceUtils","./LayerReference"],(function(e,t,r,o,s,i,n,a,l,c,p){"use strict";let u=class extends(t.ClonableMixin(r)){constructor(e){super(e),this.layerReference=new p,this.id=new l}};return e.__decorate([o.property({nonNullable:!0,json:{write:{isRequired:!0}},type:p})],u.prototype,"layerReference",void 0),e.__decorate([o.property({json:{read:!0,write:{isRequired:!0}},nonNullable:!0,types:c.featureReferenceIdType})],u.prototype,"id",void 0),u=e.__decorate([a.subclass("esri.webscene.support.FeatureReference")],u),u}))},"esri/webscene/support/FeatureReferenceObjectId":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","./FeatureReferenceId"],(function(e,t,r,o,s){"use strict";let i=class extends s{constructor(e){super(e),this.type="object-id",this.value=null}};return e.__decorate([t.enumeration({objectId:"object-id"}),r.property({type:["object-id"],json:{read:!1,write:{isRequired:!0}},nonNullable:!0})],i.prototype,"type",void 0),e.__decorate([r.property({type:[Number,String],json:{read:!0,write:{isRequired:!0}}})],i.prototype,"value",void 0),i=e.__decorate([o.subclass("esri.webscene.support.FeatureReferenceObjectId")],i),i}))},"esri/webscene/support/FeatureReferenceId":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i){"use strict";const n=new r.JSONMap({globalId:"global-id",objectId:"object-id"},{ignoreUnknown:!0});let a=class extends(t.ClonableMixin(o)){constructor(e){super(e),this.type=null}};return e.__decorate([s.property({type:n.apiValues,readOnly:!0,json:{type:n.jsonValues,read:!1,write:!0}})],a.prototype,"type",void 0),a=e.__decorate([i.subclass("esri.webscene.support.FeatureReferenceId")],a),a}))},"esri/webscene/support/featureReferenceUtils":function(){define(["exports","./FeatureReferenceGlobalId","./FeatureReferenceId","./FeatureReferenceObjectId"],(function(e,t,r,o){"use strict";const s={key:"type",base:r,typeMap:{"object-id":o,"global-id":t}};e.featureReferenceIdType=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/support/FeatureReferenceGlobalId":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","./FeatureReferenceId"],(function(e,t,r,o,s){"use strict";let i=class extends s{constructor(e){super(e),this.type="global-id",this.value=null}};return e.__decorate([t.enumeration({globalId:"global-id"}),r.property({type:["global-id"],json:{read:!1,write:{isRequired:!0}},nonNullable:!0})],i.prototype,"type",void 0),e.__decorate([r.property({type:String,json:{read:!0,write:{isRequired:!0}}})],i.prototype,"value",void 0),i=e.__decorate([o.subclass("esri.webscene.support.FeatureReferenceGlobalId")],i),i}))},"esri/webscene/support/LayerReference":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s){"use strict";let i=class extends(t.ClonableMixin(r)){constructor(e){super(e),this.layerId=null,this.sublayerId=null}};return e.__decorate([o.property({type:String,json:{write:{isRequired:!0}},nonNullable:!0})],i.prototype,"layerId",void 0),e.__decorate([o.property({type:Number,json:{write:!0}})],i.prototype,"sublayerId",void 0),i=e.__decorate([s.subclass("esri.webscene.support.LayerReference")],i),i}))},"esri/webscene/support/SlideEnvironment":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../views/3d/environment/SunnyWeather","../../views/3d/environment/weather","../lightingTypes","../SunLighting"],(function(e,t,r,o,s,i,n,a,l,c,p,u,d){"use strict";e.SlideEnvironment=class extends(r.ClonableMixin(o)){constructor(){super(...arguments),this.lighting=new d,this.weather=new c}},t.__decorate([s.property({types:u.lightingTypes,json:{write:!0}})],e.SlideEnvironment.prototype,"lighting",void 0),t.__decorate([s.property({types:p.weatherTypes,json:{write:!0}})],e.SlideEnvironment.prototype,"weather",void 0),e.SlideEnvironment=t.__decorate([l.subclass("esri.webscene.support.SlideEnvironment")],e.SlideEnvironment),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/support/SlideGround":function(){define(["../../chunks/tslib.es6","../../Ground","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../webdoc/support/opacityUtils"],(function(e,t,r,o,s,i,n,a,l,c){"use strict";var p;const u={type:Number,json:{type:i.Integer,name:"transparency",read:c.transparencyToOpacity,write:(e,t,r)=>{t[r]=c.opacityToTransparency(e)}}};let d=p=class extends(r.ClonableMixin(o)){constructor(){super(...arguments),this.opacity=null}cloneAndApplyTo(e){return null==this.opacity||((e=e?.clone()??new t).opacity=this.opacity),e}static fromGround(e){return new p({opacity:e.opacity})}};return e.__decorate([s.property(u)],d.prototype,"opacity",void 0),d=p=e.__decorate([l.subclass("esri.webscene.support.SlideGround")],d),d}))},"esri/webscene/support/SlideVisibleLayer":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n,a,l){"use strict";e.SlideVisibleLayer=class extends(r.ClonableMixin(o)){constructor(e){super(e),this.id="",this.sublayerIds=null}},t.__decorate([s.property({type:String,json:{write:!0}})],e.SlideVisibleLayer.prototype,"id",void 0),t.__decorate([s.property({type:[i.Integer],json:{name:"subLayerIds",write:!0}})],e.SlideVisibleLayer.prototype,"sublayerIds",void 0),e.SlideVisibleLayer=t.__decorate([l.subclass("esri.webscene.support.SlideVisibleLayer")],e.SlideVisibleLayer),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/support/Title":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n,a){"use strict";let l=class extends(t.ClonableMixin(r)){constructor(){super(...arguments),this.text=""}};return e.__decorate([o.property({type:String,json:{write:{isRequired:!0}}})],l.prototype,"text",void 0),l=e.__decorate([a.subclass("esri.webscene.support.Title")],l),l}))},"esri/webscene/TransportationNetwork":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],(function(e,t,r,o,s,i,n){"use strict";var a;let l=a=class extends t{constructor(e){super(e)}clone(){return new a({name:this.name,path:this.path,title:this.title})}};return e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],l.prototype,"name",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],l.prototype,"path",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],l.prototype,"title",void 0),l=a=e.__decorate([n.subclass("esri.webscene.TransportationNetwork")],l),l}))},"esri/webscene/Version":function(){define(["exports","../core/Version"],(function(e,t){"use strict";class r extends t.Version{constructor(e,t){super(e,t,"webscene")}get supportsGround(){return this.greaterEqual(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}}e.Version=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/support/AlphaCutoff":function(){define(["exports"],(function(e){"use strict";e.alphaCutoff=1/255.5,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/support/schemaValidatorLoader":function(){define(["exports"],(function(e){"use strict";let t=null;e.getLoader=function(){return t},e.registerLoader=function(e){t=e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"*noref":1}}),define(["require","./chunks/tslib.es6","./kernel","./Map","./core/Collection","./core/Error","./core/lang","./core/Loadable","./core/loadAll","./core/Logger","./core/maybe","./core/MultiOriginJSONSupport","./core/Promise","./core/promiseUtils","./core/reactiveUtils","./core/urlUtils","./core/Warning","./core/accessorSupport/decorators/property","./core/has","./core/accessorSupport/decorators/reader","./core/accessorSupport/decorators/subclass","./core/accessorSupport/decorators/writer","./core/accessorSupport/originUtils","./core/accessorSupport/read","./geometry/Extent","./geometry/HeightModelInfo","./geometry/projectionUtils","./geometry/SpatialReference","./geometry/support/heightModelInfoUtils","./geometry/support/jsonUtils","./geometry/support/spatialReferenceUtils","./portal/Portal","./portal/PortalItem","./portal/support/jsonContext","./portal/support/portalItemUtils","./support/basemapUtils","./support/MapFloorInfo","./support/tagSymbols","./support/webSceneUtils","./views/ViewingMode","./views/support/spatialReferenceSupport","./webdoc/interfaces","./webdoc/Widgets","./webdoc/support/resourceUtils","./webdoc/support/saveUtils","./webdoc/support/thumbnailUtils","./webdoc/support/webdocSaveUtils","./webscene/ApplicationProperties","./webscene/Environment","./webscene/InitialViewProperties","./webscene/Presentation","./webscene/TransportationNetwork","./webscene/Version","./webscene/support/AlphaCutoff","./webscene/support/schemaValidatorLoader"],(function(e,t,r,o,s,i,n,a,l,c,p,u,d,y,h,m,g,b,_,w,f,S,v,T,E,I,R,L,P,O,C,A,k,N,j,U,x,M,F,V,G,W,D,q,J,B,K,H,$,Q,Y,z,X,Z,ee){"use strict";var te;const re=new X.Version(1,37),oe="Web Scene";let se=class extends(a.LoadableMixin(d.EsriPromiseMixin(u.MultiOriginJSONMixin(o)))){static{te=M.WebSceneTag}constructor(e){super(e),this[te]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this._afterLoadHooks=[],this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new Y,this.initialViewProperties=new Q,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=y.debounce((async(e,t,r)=>{switch(e){case W.SaveOperationType.SAVE:return this._saveImpl(t);case W.SaveOperationType.SAVE_AS:return this._saveAsImpl(r,t)}})),this._loadContext={origin:"web-scene",initiator:this,hooks:{onAfterLoad:e=>this._afterLoadHooks.push(e)}},this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch((e=>{c.getLogger(this).error("#load()","Failed to load web scene",e)})),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(e){return void this.addResolvingPromise(Promise.reject(e))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(h.on((()=>this.allLayers),"change",(()=>this._scheduleLayersIdGC())))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=p.destroyMaybe(this.portalItem)}writeClippingArea(e,t){t.clippingArea||(t.clippingArea={}),t.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,t){return!!t.clippingArea&&!!t.clippingArea.clip}writeClippingEnabled(e,t){this.clippingArea&&(t.clippingArea||(t.clippingArea={}),t.clippingArea.clip=e)}writeLayers(e,t,r,o){t[r]=this._layersToJSON(e,"operational-layers",o)}readSourceVersion(e,t){const[r,o]=t.version.split(".");return new X.Version(parseInt(r,10),parseInt(o,10))}writeSourceVersion(e,t,r){t[r]=`${re.major}.${re.minor}`}writeTables(e,t,r,o){const s=this._layersToJSON(e,"tables",o);s.length&&(t[r]=s)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=r.version}writeGround(e,t,r,o){t[r]=e?e.write({},o):{transparency:0,layers:[]}}readInitialViewProperties(e,t,r){const{viewingMode:o,spatialReference:s}=t,i=new Q,n={...t.initialState};return void 0!==s&&(n.spatialReference=s),void 0!==o&&(n.viewingMode=o),i.read(n,r),i}get spatialReference(){return this.initialViewProperties?.spatialReference??L.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(e){const t=this.ground;return this.addResolvingPromise(this._loadFromSource().then((()=>{t&&t!==this.ground&&t.destroy(),this._validateFeatureLayerSymbolVisibility()}))),Promise.resolve(this)}loadAll(){return l.loadAll(this,(e=>{const t=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,t&&t.map((e=>e.basemap)),this.tables)}))}read(e,t){t??=this._loadContext,t.origin="web-scene";const r=this._isAuthoringAppVersionSetByUser,o=this._isAuthoringAppSetByUser;if(T.readLoadable(this,e,(t=>super.read(e,t)),t),o||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const t=e.baseMap.elevationLayers.map((e=>({id:e.id}))),r=this.presentation.slides,o=t.filter((e=>!r.some((t=>t.visibleLayers.some((t=>t.id===e.id))))));r.forEach((e=>e.visibleLayers.addMany(o)))}}_writeBasemapElevationLayers(e){const t=e.ground?.layers;!e.baseMap&&t?.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=n.clone(t))}_layersToJSON(e,t,r){const o={...r,layerContainerType:t};return e.map((e=>this._verifyWritableLayer(e,r)?e.write({},o):null)).filter((e=>!!e)).toArray()}_verifyWritableLayer(e,t){return!!e.persistenceEnabled&&("write"in e||(t?.messages&&t.messages.push(new i("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,t){if("loaded"!==this.loadStatus){const e=new i("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw c.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),e}this._runLayersIdGC();const r=!t?.messages;t={messages:[],...t,origin:"web-scene"};const o=super.write(e,t);if(r){const e=t.messages?.filter((e=>"web-document-write:property-required"===e.name))??[];if(e.length){const t=new i("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:e});throw c.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",e),t}}return this._writeBasemapElevationLayers(o),o}async save(e){return this._debouncedSaveOperations(W.SaveOperationType.SAVE,e)}async _saveImpl(e){if(!this.portalItem)throw new i("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(this.portalItem?.type!==oe)throw new i("webscene:portal-item-wrong-type",`Portal item needs to have type "${oe}"`);const t=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls(N.createForItemWrite(this.portalItem,"web-scene",!0)),o=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(o,r,W.SaveOperationType.SAVE,e),this._updateTypeKeywords(this.portalItem),await q.updateItemWithResources(this.portalItem,o,this._resourceReferences,r),v.updateOrigins(r),t&&await t,await this._saveThumbnail(),this.portalItem}async saveAs(e,t){return this._debouncedSaveOperations(W.SaveOperationType.SAVE_AS,t,e)}async _saveAsImpl(e,t){let r=k.from(e);if(!r)throw new i("webscene:portal-item-required","saveAs requires a portal item to save to");r.id&&(r=r.clone(),r.id=null);const o=r.portal||A.getDefault();await this._ensureLoadBeforeSave(),r.type=oe,r.portal=o;const s=this._enableVerifyItemRelativeUrls(N.createForItemWrite(r,"web-scene",!0)),n=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(n,s,t);const a=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");this._updateTypeKeywords(r),await o.signIn();const c=this.portalItem,p={item:c,authenticated:!(!c?.id||!c.portal.user)},{copyAllowed:d,itemReloaded:y}=await K.isCopyAllowed(p,o);if(p.authenticated||=y,!d)throw new i(`${s.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const h={...t,copyAllResources:!0};return await K.initializeNewItem(r,p,n,h)&&(this._resourceReferences.portalItem=r),await q.saveResources(this._resourceReferences,s),this.portalItem=r,u.MultiOriginJSONSupport.prototype.read.call(this,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?m.urlToObject(r.itemUrl):void 0}),v.updateOrigins(s),a&&(this.thumbnailUrl=l?m.addQueryParameter(a,"w","8192"):a),s.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await(this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl})),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(e,t,r,o){if(!C.isEarth(this.spatialReference))throw new i("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:s,requiredPropertyChecksDisabled:n,strictSchemaValidationEnabled:a}=o||{};J.evaluateWriteErrors(t,{errorName:"webscene:save"},{ignoreUnsupported:s,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:n});const l=ee.getLoader();if(a&&l){const t=(await l()).validate(e);if(!t.length)return;const o=`webscene did not validate:\n${t.join("\n")}`;c.getLogger(this).error(`${r===W.SaveOperationType.SAVE_AS?"saveAs":"save"}(): ${o}`);const s=t.map((e=>new i("webscene:schema-validation",e)));throw F.createSchemaValidationError(s)}}_verifySaveAs(e,t,r){return this._verifySave(e,t,W.SaveOperationType.SAVE_AS,r)}verifySaveAs(e){const t=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},t);return this._verifySaveAs(r,t,e)}canNotSaveAs(){return!1}async updateFrom(e,t={}){const r=this._updateFrom(e,t);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,t={}){if(await e.whenReady(),!t.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=$.prototype.clone.apply(e.environment)),!t.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,this.initialViewProperties.timeExtent=e.timeExtent?.clone()??null,this.initialViewProperties.analyses.updateFrom(e),null!=e.clippingArea?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const t of e.allLayerViews){const e="visible";e in t&&e in t.layer&&t._isOverridden(e)&&(t.layer[e]=t[e])}if(!t.widgetsExcluded)for(const t of e.persistableViewModels)t.updateWebDocument(this);(!1===t.thumbnailExcluded||null==t.thumbnailExcluded&&!t.viewpointExcluded)&&await this.updateThumbnail(e,{size:t.thumbnailSize})}async updateThumbnail(e,t){const r=B.getOptimalThumbnailSize(e,t?.size),o=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=o.dataUrl}async _loadFromSource(){this.resourceInfo?await this._loadFromJSON(this.resourceInfo):this.portalItem?.id?await this._loadFromItem(this.portalItem):await this._loadObjectsWithLayers(),await this._afterLoad()}async _afterLoad(){for(;this._afterLoadHooks.length;){const e=this._afterLoadHooks.slice();this._afterLoadHooks.length=0,await Promise.allSettled(e.map((e=>e(this._loadContext))))}}_readAndLoadFromJSON(e){const t=this._loadContext,r=this._validateJSON(e);return this.read(r,t),this._loadFromJSON(r)}_extractOperationalLayers(e){const t=[];if(!this.sourceVersion?.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const r of e.baseMap.elevationLayers)t.push(r);const r=[],o=e=>(e.layers&&(e.layers=e.layers.filter(o)),"ArcGISTiledElevationServiceLayer"!==e.layerType||(this.sourceVersion?.supportsGround||r.push(e),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(o):[],operationalElevationLayers:r,basemapElevationLayers:t}}async _loadFromJSON(t){const r=new s;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:o}=await new Promise(((t,r)=>e(["./layers/support/layersCreator"],t,r))),{operationalLayers:i,operationalElevationLayers:n,basemapElevationLayers:a}=this._extractOperationalLayers(t),l=[],c={context:{...this._loadContext,layerContainerType:"operational-layers"}};if(this.portalItem&&(c.context.portal=this.portalItem.portal||A.getDefault()),a.length>0){const e={...c,context:{...c.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(o(this.ground.layers,a,e))}if(n.length>0){const e={...c,context:{...c.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(o(r,n,e))}i&&i.length>0&&l.push(o(this.layers,i,c)),t.tables?.length&&l.push(o(this.tables,t.tables,{...c,context:{...c.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(l),await this._loadObjectsWithLayers(),this.ground.layers.addMany(r.filter((e=>"base-elevation"===e.type||"elevation"===e.type)))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],t=[...this.allLayers.items];for(const{basemap:e}of this.presentation.slides.items)e&&(t.push(...e.baseLayers.items),t.push(...e.referenceLayers.items));for(const r of t)if("beforeSave"in r&&"function"==typeof r.beforeSave){const t=r.beforeSave();t&&e.push(t)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach((t=>{t.basemap&&e.push(t.basemap.load())})),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch((e=>{throw new i("webscene:load-portal-item","Failed to load portal item",{error:e})})),"Web Scene"!==e.type)throw new i("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const t=await e.fetchData();this.resourceInfo=t;const r=this._loadContext;r.url=m.urlToObject(e.itemUrl),r.portal=e.portal||A.getDefault(),r.portalItem=e,r.readResourcePaths=[],await this._readAndLoadFromJSON(t),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,t=this._sceneSpatialReference;let r;if("local"!==e.viewingMode){if(!G.isSpatialReferenceSupported(t,V.ViewingMode.Global))return Promise.reject(new i("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=e=>!e||R.canProjectWithoutEngine(e,t)}else{if(!G.isSpatialReferenceSupported(t,V.ViewingMode.Local))return Promise.reject(new i("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=e=>!e||e.equals(t)}const o=e=>e?.camera?.position.spatialReference??e?.targetGeometry?.spatialReference,s=e.viewpoint,n=o(s);if(n&&!r(n))return Promise.reject(new i("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:n,sceneSpatialReference:t,viewingMode:e.viewingMode}));const a=this.presentation.slides.find((e=>!r(o(e.viewpoint))));if(a){const r=o(a.viewpoint);return Promise.reject(new i("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:r,sceneSpatialReference:t,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,t=P.validateWebSceneError(this.heightModelInfo,e);return t?Promise.reject(t):Promise.resolve()}_validateFeatureLayerSymbolVisibility(){this.sourceVersion?.greaterEqual(1,35)||this.layers.forEach((e=>{"feature"===e.type&&e.addHandles(h.watch((()=>e.loaded),(()=>{"on-the-ground"===e.elevationInfo?.mode&&"simple"===e.renderer?.type&&"polygon-3d"===e.renderer.symbol?.type&&e.renderer.symbol.symbolLayers.some((t=>"fill"===t.type&&null!=t.material&&(!t.material.color||t.material.color.a*e.opacity<Z.alphaCutoff)&&(e.loadWarnings.push(new g("feature-layer:invisible-draped-symbols","FeatureLayer has fully transparent symbols which will no longer render or highlight",{layer:e})),!0)))}),{once:!0,sync:!0}))}))}_validateJSON(e){const t=X.Version.parse(e.version||"","webscene");return re.validate(t),e.version=`${t.major}.${t.minor}`,1===t.major&&t.minor<=2&&(e.spatialReference=L.WebMercator.toJSON()),e}_updateTypeKeywords(e){j.toggleTypeKeyword(e,j.typeKeyword.LOCAL_SCENE,"local"===this.initialViewProperties.viewingMode),j.toggleTypeKeyword(e,j.typeKeyword.DEVELOPER_BASEMAP,U.hasDeveloperBasemapLayer(this.basemap)||this.presentation.slides.some((({basemap:e})=>!!e&&U.hasDeveloperBasemapLayer(e)))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||L.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?m.urlToObject(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const t=this._verifyItemRelativeRootPath;return t&&(e.verifyItemRelativeUrls={rootPath:t,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout((()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()}),3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties?.viewing?.search,t=e=>this.allLayers.some((t=>t.id===e&&t.persistenceEnabled));e?.layers&&(e.layers=e.layers.filter((e=>t(e.id))));const r=this.presentation&&this.presentation.slides;r&&r.forEach((e=>{e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter((e=>t(e.id))))}))}static fromJSON(e){if(!e)throw new i("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}static{this.version=`${re.major}.${re.minor}`}};return t.__decorate([b.property({type:H,json:{write:!0}})],se.prototype,"applicationProperties",void 0),t.__decorate([b.property({type:E,json:{read:{source:"clippingArea.geometry",reader:O.fromJSON},write:{target:"clippingArea.geometry"}}})],se.prototype,"clippingArea",void 0),t.__decorate([S.writer("clippingArea")],se.prototype,"writeClippingArea",null),t.__decorate([b.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],se.prototype,"clippingEnabled",void 0),t.__decorate([w.reader("clippingEnabled",["clippingArea"])],se.prototype,"readClippingEnabled",null),t.__decorate([S.writer("clippingEnabled")],se.prototype,"writeClippingEnabled",null),t.__decorate([b.property({type:x,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],se.prototype,"floorInfo",void 0),t.__decorate([b.property({type:I,json:{write:!0}})],se.prototype,"heightModelInfo",void 0),t.__decorate([b.property({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],se.prototype,"layers",void 0),t.__decorate([S.writer("layers")],se.prototype,"writeLayers",null),t.__decorate([b.property({readOnly:!0,type:X.Version,json:{type:(()=>{const e=[],t=re.major;for(let r=8;r<=re.minor;r++)e.push(`${t}.${r}`);return e})(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],se.prototype,"sourceVersion",void 0),t.__decorate([w.reader("sourceVersion",["version"])],se.prototype,"readSourceVersion",null),t.__decorate([S.writer("sourceVersion")],se.prototype,"writeSourceVersion",null),t.__decorate([b.property({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],se.prototype,"tables",void 0),t.__decorate([S.writer("tables")],se.prototype,"writeTables",null),t.__decorate([b.property()],se.prototype,"thumbnailUrl",null),t.__decorate([b.property({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],se.prototype,"authoringApp",null),t.__decorate([S.writer("authoringApp")],se.prototype,"writeAuthoringApp",null),t.__decorate([b.property({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],se.prototype,"authoringAppVersion",null),t.__decorate([S.writer("authoringAppVersion")],se.prototype,"writeAuthoringAppVersion",null),t.__decorate([b.property({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],se.prototype,"ground",void 0),t.__decorate([S.writer("ground")],se.prototype,"writeGround",null),t.__decorate([b.property({type:s.ofType(z),json:{write:!0}})],se.prototype,"transportationNetworks",void 0),t.__decorate([b.property({type:Y,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(e,t,r,o)=>{if(e.slides&&e.slides.length>0){const r={...o,isPresentation:!0};t.presentation=e.write({},r)}}}}})],se.prototype,"presentation",void 0),t.__decorate([b.property({type:Q,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new Q({viewingMode:"global",spatialReference:L.WebMercator})}})],se.prototype,"initialViewProperties",void 0),t.__decorate([w.reader("initialViewProperties",["initialState","spatialReference","viewingMode"])],se.prototype,"readInitialViewProperties",null),t.__decorate([b.property({type:L,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],se.prototype,"spatialReference",null),t.__decorate([b.property({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],se.prototype,"viewingMode",null),t.__decorate([b.property({type:k})],se.prototype,"portalItem",void 0),t.__decorate([b.property()],se.prototype,"resourceInfo",void 0),t.__decorate([b.property({type:D,json:{write:!0}})],se.prototype,"widgets",void 0),se=t.__decorate([f.subclass("esri.WebScene")],se),se}));