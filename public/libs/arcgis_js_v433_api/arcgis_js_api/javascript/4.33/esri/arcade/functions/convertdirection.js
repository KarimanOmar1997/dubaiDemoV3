// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../Dictionary","../enum","../executionError","../../chunks/languageUtils","../../core/maybe","../../support/guards"],(function(e,r,n,t,s,o,i){"use strict";const a=e=>(r,n,t=14)=>+e(r,n).toFixed(t),c=(e,r)=>e+r,u=(e,r)=>e-r,d=(e,r)=>e*r,l=(e,r)=>e/r,g=(e,r,n)=>a(c)(e,r,n),h=(e,r,n)=>a(d)(e,r,n),m=(e,r,n)=>a(l)(e,r,n),E=2*Math.PI,_=3600,f=60,w=648e3/Math.PI,A=1296e3,x=324e3,D=648e3,p=String.fromCharCode(7501);function S(e){if(!1===i.isString(e))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.InvalidParameter,null);return e}function T(e,r){const n=10**r;return Math.round(e*n)/n}function R(e){const r=parseFloat(e.toString().replace(Math.trunc(e).toString(),"0"))*Math.sign(e);return e<0?{fraction:r,integer:Math.ceil(e)}:{fraction:r,integer:Math.floor(e)}}var v,F,M;function L(e,r){switch(e){case v.north:return"SHORT"===r?"N":"North";case v.east:return"SHORT"===r?"E":"East";case v.south:return"SHORT"===r?"S":"South";case v.west:return"SHORT"===r?"W":"West"}}function C(e,r){return e-Math.floor(e/r)*r}function b(e){switch(e){case F.truncated_degrees:case F.decimal_degrees:return 360;case F.radians:return E;case F.gradians:return 400;case F.seconds:return A;case F.fractional_degree_minutes:return 60;case F.fractional_minute_seconds:return f;default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unsupported evaluations"})}}!function(e){e[e.north=0]="north",e[e.east=1]="east",e[e.south=2]="south",e[e.west=3]="west"}(v||(v={})),function(e){e[e.decimal_degrees=1]="decimal_degrees",e[e.seconds=2]="seconds",e[e.degrees_minutes_seconds=3]="degrees_minutes_seconds",e[e.radians=4]="radians",e[e.gradians=5]="gradians",e[e.truncated_degrees=6]="truncated_degrees",e[e.fractional_degree_minutes=7]="fractional_degree_minutes",e[e.fractional_minute_seconds=8]="fractional_minute_seconds"}(F||(F={})),function(e){e[e.north_azimuth=1]="north_azimuth",e[e.polar=2]="polar",e[e.quadrant=3]="quadrant",e[e.south_azimuth=4]="south_azimuth"}(M||(M={}));const N=new n.StringEnum([],[["NORTH",M.north_azimuth],["NORTH AZIMUTH",M.north_azimuth],["POLAR",M.polar],["QUADRANT",M.quadrant],["SOUTH",M.south_azimuth],["SOUTH AZIMUTH",M.south_azimuth]]);function U(e){const r=N.lookup(e);if(null==r)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unsupported directionType"});return r}const z=new n.StringEnum([],[["D",F.decimal_degrees],["DD",F.decimal_degrees],["DECIMAL DEGREE",F.decimal_degrees],["DEGREE",F.decimal_degrees],["DECIMAL DEGREES",F.decimal_degrees],["DEGREES",F.decimal_degrees],["DMS",F.degrees_minutes_seconds],["DEGREES MINUTES SECONDS",F.degrees_minutes_seconds],["R",F.radians],["RAD",F.radians],["RADS",F.radians],["RADIAN",F.radians],["RADIANS",F.radians],["G",F.gradians],["GON",F.gradians],["GONS",F.gradians],["GRAD",F.gradians],["GRADS",F.gradians],["GRADIAN",F.gradians],["GRADIANS",F.gradians]]);function y(e){const r=z.lookup(e);if(null==r)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unsupported units"});return r}var O;!function(e){e[e.meridian=0]="meridian",e[e.direction=1]="direction"}(O||(O={}));class G{constructor(e,r,n){this.m_degrees=e,this.m_minutes=r,this.m_seconds=n}getField(e){switch(e){case F.decimal_degrees:case F.truncated_degrees:return this.m_degrees;case F.fractional_degree_minutes:return this.m_minutes;case F.seconds:case F.fractional_minute_seconds:return this.m_seconds;default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}}static secondsToDMS(e){const r=R(e).fraction;let n=R(e).integer;const t=Math.floor(n/_);n-=t*_;const s=Math.floor(n/f);return n-=s*f,new G(t,s,n+r)}static numberToDms(e){const r=R(e).fraction,n=R(e).integer,t=h(R(100*r).fraction,100),s=R(100*r).integer;return new G(n,s,t)}format(e,r){let n=T(this.m_seconds,r),t=this.m_minutes,s=this.m_degrees;if(e===F.seconds||e===F.fractional_minute_seconds)f<=n&&(n-=f,++t),60<=t&&(t=0,++s),360<=s&&(s=0);else if(e===F.fractional_degree_minutes)n=0,t=30<=this.m_seconds?this.m_minutes+1:this.m_minutes,s=this.m_degrees,60<=t&&(t=0,++s),360<=s&&(s=0);else if(e===F.decimal_degrees||e===F.truncated_degrees){const e=m(this.m_seconds,_),r=m(this.m_minutes,60);s=Math.round(this.m_degrees+r+e),t=0,n=0}return new G(s,t,n)}static dmsToSeconds(e,r,n){return e*_+r*f+n}}class I{constructor(e,r,n){this.meridian=e,this.angle=r,this.direction=n}fetchAzimuth(e){return e===O.meridian?this.meridian:this.direction}}class H{constructor(e){this._angle=e}static createFromAngleAndDirection(e,r){return new H(new q(H._convertDirectionFormat(e.extractAngularUnits(F.seconds),r,M.north_azimuth)))}getAngle(e){const r=this._angle.extractAngularUnits(F.seconds);switch(e){case M.north_azimuth:case M.south_azimuth:case M.polar:return new q(H._convertDirectionFormat(r,M.north_azimuth,e));case M.quadrant:{const e=H.secondsNorthAzimuthToQuadrant(r);return new q(e.angle)}}}getMeridian(e){const r=this._angle.extractAngularUnits(F.seconds);switch(e){case M.north_azimuth:return v.north;case M.south_azimuth:return v.south;case M.polar:return v.east;case M.quadrant:return H.secondsNorthAzimuthToQuadrant(r).meridian}}getDirection(e){const r=this._angle.extractAngularUnits(F.seconds);switch(e){case M.north_azimuth:return v.east;case M.south_azimuth:return v.west;case M.polar:return v.north;case M.quadrant:return H.secondsNorthAzimuthToQuadrant(r).direction}}static secondsNorthAzimuthToQuadrant(e){const r=e<=x||e>=972e3?v.north:v.south,n=r===v.north?Math.min(A-e,e):Math.abs(e-D),t=e>D?v.west:v.east;return new I(r,n,t)}static createFromAngleMeridianAndDirection(e,r,n){return new H(new q(H.secondsQuadrantToNorthAzimuth(e.extractAngularUnits(F.seconds),r,n)))}static secondsQuadrantToNorthAzimuth(e,r,n){return r===v.north?n===v.east?e:A-e:n===v.east?D-e:D+e}static _convertDirectionFormat(e,r,n){let s=0;switch(r){case M.north_azimuth:s=e;break;case M.polar:s=x-e;break;case M.quadrant:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"});case M.south_azimuth:s=e+D}let o=0;switch(n){case M.north_azimuth:o=s;break;case M.polar:o=x-s;break;case M.quadrant:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"});case M.south_azimuth:o=s-D}return o%=A,o<0?A+o:o}}function k(e,r,n){let s=null;switch(r){case F.decimal_degrees:s=h(e,_);break;case F.seconds:s=e;break;case F.gradians:s=h(e,3240);break;case F.radians:s=h(e,w);break;default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}switch(n){case F.decimal_degrees:return m(s,_);case F.seconds:return s;case F.gradians:return m(s,3240);case F.radians:return s/w;default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}}class q{constructor(e){this._seconds=e}static createFromAngleAndUnits(e,r){return new q(k(e,r,F.seconds))}extractAngularUnits(e){return k(this._seconds,F.seconds,P(e))}static createFromDegreesMinutesSeconds(e,r,n){return new q(g(g(h(e,_),h(r,f)),n))}}function P(e){switch(o.assertIsSome(e),e){case F.decimal_degrees:case F.truncated_degrees:case F.degrees_minutes_seconds:return F.decimal_degrees;case F.gradians:return F.gradians;case F.fractional_degree_minutes:return F.fractional_degree_minutes;case F.radians:return F.radians;case F.seconds:case F.fractional_minute_seconds:return F.seconds}}class Q{constructor(e,r,n,t){this.view=e,this.angle=r,this.merdian=n,this.direction=t,this._dms=null,this._formattedDms=null}static createFromStringAndBearing(e,r,n){return new Q(e,r.getAngle(n),r.getMeridian(n),r.getDirection(n))}fetchAngle(){return this.angle}fetchMeridian(){return this.merdian}fetchDirection(){return this.direction}fetchView(){return this.view}fetchDms(){return null===this._dms&&this._calculateDms(),this._dms}fetchFormattedDms(){return null===this._formattedDms&&this._calculateDms(),this._formattedDms}_calculateDms(){let e=null,r=F.truncated_degrees,n=0;for(let t=0;t<this.view.length;t++){const s=this.view[t];switch(s){case"m":e=Z(this.view,t,s),r=r===F.truncated_degrees?F.fractional_degree_minutes:r,t=e.newpos;continue;case"s":e=Z(this.view,t,s),r=F.fractional_minute_seconds,n=n<e.rounding?e.rounding:n,t=e.newpos;continue;default:continue}}this._dms=G.secondsToDMS(this.angle.extractAngularUnits(F.seconds)),this._formattedDms=G.secondsToDMS(this.angle.extractAngularUnits(F.seconds)).format(r,n)}}function W(e,r,n,s,o){let i=null;switch(r){case F.decimal_degrees:case F.radians:case F.gradians:return i=C(T(e.extractAngularUnits(r),s),b(r)),i.toFixed(s).padStart(n+s+(s>0?1:0),"0");case F.truncated_degrees:case F.fractional_degree_minutes:return i=C(o.fetchFormattedDms().getField(r),b(r)),i.toFixed(s).padStart(n+s+(s>0?1:0),"0");case F.fractional_minute_seconds:return i=C(T(o.fetchDms().getField(r),s),b(r)),i.toFixed(s).padStart(n+s+(s>0?1:0),"0");default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}}function B(e){switch(e.toUpperCase().trim()){case"N":case"NORTH":return v.north;case"E":case"EAST":return v.east;case"S":case"SOUTH":return v.south;case"W":case"WEST":return v.west}return null}function V(e){const r=parseFloat(e);if(i.isNumber(r)){if(isNaN(r))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"});return r}throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"})}function X(e,r,n){const o=n===M.quadrant;let i=null,a=null,c=0,u=0,d=0;if(o){if(e.length<2)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"});d=1;const r=function(e){switch(s.toNumber(e)){case 1:return{first:v.north,second:v.east};case 2:return{first:v.south,second:v.east};case 3:return{first:v.south,second:v.west};case 4:return{first:v.north,second:v.west}}return null}(s.toString(e[e.length-1]));if(r?(i=r.first,a=r.second):(c=1,i=B(s.toString(e[0])),a=B(s.toString(e[e.length-1]))),null===i||null===a)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"})}switch(r){case F.decimal_degrees:case F.radians:case F.gradians:if(0===e.length)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"});return o?H.createFromAngleMeridianAndDirection(q.createFromAngleAndUnits(V(e[c]),P(r)),i,a):H.createFromAngleAndDirection(q.createFromAngleAndUnits(V(e[c]),P(r)),n);case F.degrees_minutes_seconds:if(u=e.length-d-c,3===u){const r=q.createFromDegreesMinutesSeconds(V(e[c]),V(e[c+1]),V(e[c+2]));return o?H.createFromAngleMeridianAndDirection(r,i,a):H.createFromAngleAndDirection(r,n)}if(1===u){const r=V(e[c]),t=G.numberToDms(r),s=q.createFromDegreesMinutesSeconds(t.m_degrees,t.m_minutes,t.m_seconds);return o?H.createFromAngleMeridianAndDirection(s,i,a):H.createFromAngleAndDirection(s,n)}}throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"})}function Z(e,r,n){const t={padding:0,rounding:0,newpos:r};let s=!1;for(;r<e.length;){const o=e[r];if(o===n)s?t.rounding++:t.padding++,r++;else{if("."!==o)break;s=!0,r++}}return t.newpos=r-1,t}function j(e,r,n){const t={escaped:"",newpos:r};for(r++;r<e.length;){const n=e[r];if(r++,"]"===n)break;t.escaped+=n}return t.newpos=r-1,t}const J=new n.StringEnum(["TEXT","VALUE"]);e.convertDirection=function(e,n,o){if(!(n instanceof r))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.InvalidParameter,null);if(!1===n.hasField("directionType"))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"missing directionType"});if(!1===n.hasField("angleType"))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"missing angleType"});const a=U(S(n.field("directiontype"))),c=function(e,r,n){if(i.isNumber(e))return function(e,r,n){if(n===M.quadrant)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"});if(r===F.degrees_minutes_seconds){const r=G.numberToDms(e);return H.createFromAngleAndDirection(q.createFromDegreesMinutesSeconds(r.m_degrees,r.m_minutes,r.m_seconds),n)}return H.createFromAngleAndDirection(q.createFromAngleAndUnits(e,P(r)),n)}(s.toNumber(e),r,n);if(i.isString(e))return X(function(e){const r=new Set([" ","-","/","'",'"',"\\","^","°",p,"\t","\r","\n","*"]);let n="";for(let t=0;t<e.length;t++){const s=e.charAt(t);r.has(s)?n+="RRSPLITRRSPLITRR":n+=s}return n.split("RRSPLITRRSPLITRR").filter((e=>""!==e))}(e),r,n);if(i.isArray(e))return X(e,r,n);if(s.isImmutableArray(e))return X(e.toArray(),r,n);throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"})}(e,y(S(n.field("angletype"))),a);if(!(o instanceof r))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.InvalidParameter,null);if(!1===o.hasField("directionType"))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"missing directionType"});if(!1===o.hasField("outputType"))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"missing angleType"});const u=U(S(o.field("directiontype"))),d=o.hasField("angleType")?y(S(o.field("angletype"))):null,l=J.get(S(o.field("outputType")));if(!u||!l)throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"});if(!(d||"TEXT"===l&&o.hasField("format")))throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"invalid unit"});switch(l){case"VALUE":return u===M.quadrant||d===F.degrees_minutes_seconds?function(e,r,n){const t=e.getAngle(r);if(r===M.quadrant&&n===F.degrees_minutes_seconds){const n=G.secondsToDMS(t.extractAngularUnits(F.seconds));return[L(e.getMeridian(r),"SHORT"),n.m_degrees,n.m_minutes,n.m_seconds,L(e.getDirection(r),"SHORT")]}if(n===F.degrees_minutes_seconds){const e=G.secondsToDMS(t.extractAngularUnits(F.seconds));return[e.m_degrees,e.m_minutes,e.m_seconds]}return r===M.quadrant?[L(e.getMeridian(r),"SHORT"),t.extractAngularUnits(n),L(e.getDirection(r),"SHORT")]:[t.extractAngularUnits(n)]}(c,u,d):function(e,r,n){const s=P(n);if(s&&n!==F.degrees_minutes_seconds)return e.getAngle(r).extractAngularUnits(s);throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"})}(c,u,d);case"TEXT":{let e="";return o.hasField("format")&&(e=s.toString(o.field("format"))),null!==e&&""!==e||(e=function(e,r){let n="";switch(e){case F.decimal_degrees:n=r===M.quadrant?"DD.DD°":"DDD.DD°";break;case F.degrees_minutes_seconds:n=r===M.quadrant?"dd° mm' ss\"":"ddd° mm' ss.ss\"";break;case F.radians:n="R.RR";break;case F.gradians:n="GGG.GG"+p;break;default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"})}return r===M.quadrant&&(n="p "+n+" b"),n}(d,u)),function(e,r,n){let t="",s=null,o=null;const i=Q.createFromStringAndBearing(r,e,n),a={D:F.decimal_degrees,d:F.truncated_degrees,m:F.fractional_degree_minutes,s:F.fractional_minute_seconds,R:F.radians,G:F.gradians};for(let c=0;c<r.length;c++){const u=r[c];switch(u){case"[":s=j(r,c),t+=s.escaped,c=s.newpos;continue;case"D":case"d":case"m":case"s":case"R":case"G":s=Z(r,c,u),o=e.getAngle(n),t+=W(o,a[u],s.padding,s.rounding,i),c=s.newpos;continue;case"P":case"p":t+=L(i.fetchMeridian(),"p"===u?"SHORT":"LONG");continue;case"B":case"b":t+=L(i.fetchDirection(),"b"===u?"SHORT":"LONG");continue;default:t+=u}}return t}(c,e,u)}default:throw new t.ArcadeExecutionError(null,t.ExecutionErrorCodes.InvalidParameter,null)}},e.preciseAdd=g,e.preciseDivide=m,e.preciseMinus=(e,r,n)=>a(u)(e,r,n),e.preciseMultiply=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));