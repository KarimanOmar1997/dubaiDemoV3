// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../Dictionary","../executionError","../Feature","../../chunks/languageUtils","../featureset/support/shared","../../core/sql/SqlTimestampOffset","../../core/sql/WhereClause","../../support/guards"],(function(e,r,t,n,o,i,a,u,c){"use strict";function d(e){const r=e?.fullSchema();return r?.datesInUnknownTimezone?"unknown":r?.dateFieldsTimeZone||"UTC"}function s(e){const r=e.fullSchema()?.fieldsIndex;return null==r&&e instanceof n?e.fieldsIndex:r}const l={getAttributeSQL(e,r){const t=e.field(r);if(null==t)return t;if(o.isDate(t)){const n=t.toDateTime(),o=s(e)?.get(r)?.type;return"esriFieldTypeTimestampOffset"===o||"timestamp-offset"===o?a.SqlTimeStampOffset.fromDateTime(n):n}return t}};e.registerFunctions=function(e,n,a){e.domain=function(e,a){return n(e,a,((n,u,c)=>{if(o.pcCheck(c,2,3,e,a),o.isFeature(c[0])){const t=o.featureFullDomain(c[0],o.toString(c[1]),void 0===c[2]?void 0:c[2]);return t&&t.domain?"coded-value"===t.domain.type||"codedValue"===t.domain.type?r.convertObjectToArcadeDictionary({type:"codedValue",name:t.domain.name,dataType:i.layerFieldEsriConstants[t.field.type],codedValues:t.domain.codedValues.map((e=>({name:e.name,code:e.code})))},o.defaultTimeZone(e)):r.convertObjectToArcadeDictionary({type:"range",name:t.domain.name,dataType:i.layerFieldEsriConstants[t.field.type],min:t.domain.minValue,max:t.domain.maxValue},o.defaultTimeZone(e)):null}throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,a)}))},e.domaincode=function(e,r){return n(e,r,((n,i,a)=>{if(o.pcCheck(a,2,4,e,r),o.isFeature(a[0]))return o.featureDomainCodeLookup(a[0],o.toString(a[1]),a[2],void 0===a[3]?void 0:a[3]);throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r)}))},e.domainname=function(e,r){return n(e,r,((n,i,a)=>{if(o.pcCheck(a,2,4,e,r),o.isFeature(a[0]))return o.featureDomainValueLookup(a[0],o.toString(a[1]),a[2],void 0===a[3]?void 0:a[3]);throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r)}))},e.expects=function(e,r){return n(e,r,((n,i,a)=>{if(a.length<1)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongNumberOfParameters,r);return o.voidOperation}))},e.featureinfilter=function(e,r){return n(e,r,((e,r,n)=>{o.pcCheck(n,2,2,e,r);const[i,f]=n;if(null==i)return!1;if(""===f||null==f)return!0;if(!o.isFeature(i)||!c.isString(f))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);const m=u.create(f,{fieldsIndex:s(i),timeZone:d(i)}),p=m.getVariables();for(const r of p)m.parameters[r]=a(e,{name:r});return m.testFeature(i,l)}))},e.gdbversion=function(e,r){return n(e,r,((n,i,a)=>{if(o.pcCheck(a,1,1,e,r),o.isFeature(a[0]))return a[0].gdbVersion();throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r)}))},e.schema=function(e,i){return n(e,i,((n,a,u)=>{if(o.isFeature(u[0])){const t=o.featureSchema(u[0]);return t?r.convertObjectToArcadeDictionary(t,o.defaultTimeZone(e)):null}throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i)}))},e.subtypecode=function(e,r){return n(e,r,((n,i,a)=>{if(o.pcCheck(a,1,1,e,r),o.isFeature(a[0])){const e=o.featureSubtypes(a[0]);if(!e)return null;if(e.subtypeField&&a[0].hasField(e.subtypeField)){const r=a[0].field(e.subtypeField);for(const t of e.subtypes)if(t.code===r)return t.code;return null}return null}throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r)}))},e.subtypename=function(e,r){return n(e,r,((n,i,a)=>{if(o.pcCheck(a,1,1,e,r),o.isFeature(a[0])){const e=o.featureSubtypes(a[0]);if(!e)return"";if(e.subtypeField&&a[0].hasField(e.subtypeField)){const r=a[0].field(e.subtypeField);for(const t of e.subtypes)if(t.code===r)return t.name;return""}return""}throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r)}))},e.subtypes=function(e,i){return n(e,i,((n,a,u)=>{if(o.pcCheck(u,1,1,e,i),o.isFeature(u[0])){const t=o.featureSubtypes(u[0]);return t?r.convertObjectToArcadeDictionary(t,o.defaultTimeZone(e)):null}throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i)}))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));