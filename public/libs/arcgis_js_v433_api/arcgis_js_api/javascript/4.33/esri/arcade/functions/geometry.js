// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../containerUtils","../Dictionary","../executionError","../Feature","../ImmutablePointArray","../../chunks/languageUtils","./centroid","../geometry/constructors","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/coordsUtils","../../geometry/support/jsonUtils","../../support/guards"],(function(e,r,t,n,o,i,a,c,l,s,f,u,m,E,d,p,x,y){"use strict";e.registerFunctions=function(e,h){e.ringisclockwise=function(e,r){return h(e,r,((t,o,c)=>{a.pcCheck(c,1,1,e,r);let l=[];if(null===c[0])return!1;if(y.isArray(c[0]))for(const t of c[0]){if(!(t instanceof m))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);l.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}else if(c[0]instanceof i)l=c[0]._elements;else{if(!a.isImmutableArray(c[0]))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);for(const t of c[0].toArray()){if(!(t instanceof m))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);l.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}}return!(l.length<3)&&p.isClockwise(l)}))},e.polygon=function(e,r){return h(e,r,((o,i,c)=>{let s;if(a.pcCheck(c,1,1,e,r),c[0]instanceof t){const r=a.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference,"polygon"),e.spatialReference);if(null==r)return null;s=r}else if(c[0]instanceof E)s=x.fromJSON(c[0].toJSON());else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),s=a.fixSpatialReference(new E(r),e.spatialReference)}if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongSpatialReference,r);return a.fixNullGeometry(s)}))},e.polyline=function(e,r){return h(e,r,((o,i,c)=>{let s;if(a.pcCheck(c,1,1,e,r),c[0]instanceof t){const r=a.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference,"polyline"),e.spatialReference);if(null==r)return null;s=r}else if(c[0]instanceof d)s=x.fromJSON(c[0].toJSON());else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),s=a.fixSpatialReference(new d(r),e.spatialReference)}if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongSpatialReference,r);return a.fixNullGeometry(s)}))},e.point=function(e,r){return h(e,r,((o,i,c)=>{let s;if(a.pcCheck(c,1,1,e,r),c[0]instanceof t){const r=a.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference,"point"),e.spatialReference);if(null==r)return null;s=r}else if(c[0]instanceof m)s=x.fromJSON(c[0].toJSON());else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),s=a.fixSpatialReference(new m(r),e.spatialReference)}if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongSpatialReference,r);return a.fixNullGeometry(s)}))},e.multipoint=function(e,r){return h(e,r,((o,i,c)=>{let s;if(a.pcCheck(c,1,1,e,r),c[0]instanceof t){const r=a.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference,"multipoint"),e.spatialReference);if(null==r)return null;s=r}else if(c[0]instanceof u)s=x.fromJSON(c[0].toJSON());else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),s=a.fixSpatialReference(new u(r),e.spatialReference)}if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongSpatialReference,r);return a.fixNullGeometry(s)}))},e.extent=function(e,r){return h(e,r,((o,i,c)=>{c=a.autoCastFeatureToGeometry(c),a.pcCheck(c,1,1,e,r);let f=null;if(c[0]instanceof t)f=a.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference),e.spatialReference);else if(c[0]instanceof m){const e={xmin:c[0].x,ymin:c[0].y,xmax:c[0].x,ymax:c[0].y,spatialReference:c[0].spatialReference.toJSON()},r=c[0];r.hasZ&&(e.zmin=r.z,e.zmax=r.z),r.hasM&&(e.mmin=r.m,e.mmax=r.m),f=x.fromJSON(e)}else if(c[0]instanceof E)f=x.fromJSON(c[0].extent?.toJSON());else if(c[0]instanceof d)f=x.fromJSON(c[0].extent?.toJSON());else if(c[0]instanceof u)f=x.fromJSON(c[0].extent?.toJSON());else if(c[0]instanceof s)f=x.fromJSON(c[0].toJSON());else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),f=a.fixSpatialReference(new s(r),e.spatialReference)}if(null!==f&&!1===f.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongSpatialReference,r);return a.fixNullGeometry(f)}))},e.geometry=function(e,r){return h(e,r,((o,i,c)=>{a.pcCheck(c,1,1,e,r);let s=null;if(null===c[0])return null;if(a.isFeature(c[0]))s=a.fixSpatialReference(c[0].geometry(),e.spatialReference);else if(c[0]instanceof t)s=a.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference),e.spatialReference);else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),s=a.fixSpatialReference(x.fromJSON(r),e.spatialReference)}if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongSpatialReference,r);return a.fixNullGeometry(s)}))},e.setgeometry=function(e,r){return h(e,r,((t,o,i)=>{if(a.pcCheck(i,2,2,e,r),!a.isFeature(i[0]))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);if(!0===i[0].immutable)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.Immutable,r);if(!(i[1]instanceof f||null===i[1]))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);return i[0]._geometry=i[1],a.voidOperation}))},e.feature=function(e,r){return h(e,r,((i,c,s)=>{if(0===s.length)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongNumberOfParameters,r);let u;if(1===s.length)if(y.isString(s[0]))u=o.fromJson(JSON.parse(s[0]),e.timeZone);else if(a.isFeature(s[0]))u=o.createFromArcadeFeature(s[0]);else if(s[0]instanceof f)u=o.createFromGraphicLikeObject(s[0],null,null,e.timeZone);else{if(!(s[0]instanceof t))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);{const t=s[0].hasField("geometry")?s[0].field("geometry"):null,i=s[0].hasField("attributes")?s[0].field("attributes"):null;let c,f;if(a.isDictionary(t))c=l.constructGeometryFromDictionary(t,e.spatialReference);else{if(null!=t&&!a.isGeometry(t))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);c=t}if(a.isDictionary(i))f=o.parseAttributesFromDictionary(i);else{if(null!=i)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);f=null}u=o.createFromGraphicLikeObject(c,f,null,e.timeZone)}}else if(2===s.length){let i=null,a=null;if(null!==s[0])if(s[0]instanceof f)i=s[0];else{if(!(s[0]instanceof t))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);i=l.constructGeometryFromDictionary(s[0],e.spatialReference)}if(null!==s[1]){if(!(s[1]instanceof t))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);a=o.parseAttributesFromDictionary(s[1])}u=o.createFromGraphicLikeObject(i,a,null,e.timeZone)}else{let i=null;const c={};if(null!==s[0])if(s[0]instanceof f)i=s[0];else{if(!(s[0]instanceof t))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);i=l.constructGeometryFromDictionary(s[0],e.spatialReference)}for(let t=1;t<s.length;t+=2){const o=a.toString(s[t]),i=s[t+1];if(!(null==i||y.isString(i)||isNaN(i)||a.isDate(i)||y.isNumber(i)||a.isTime(i)||a.isDateOnly(i)||y.isBoolean(i)))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);if(a.isFunctionParameter(i)||!1===a.isSimpleType(i))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);i===a.voidOperation?c[o]=null:c[o]=i}u=o.createFromGraphicLikeObject(i,c,null,e.timeZone)}return u._geometry=a.fixSpatialReference(u.geometry(),e.spatialReference),u.immutable=!1,u}))},e.dictionary=function(e,r){return h(e,r,((o,i,c)=>{if(0===c.length||1===c.length&&null===c[0]){const e=new t;return e.immutable=!1,e}if(1===c.length&&y.isString(c[0]))try{const r=JSON.parse(c[0]),n=t.convertObjectToArcadeDictionary(r,a.defaultTimeZone(e),!1);return n.immutable=!1,n}catch(t){throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r)}if(1===c.length&&c[0]instanceof f)try{const r=c[0].toJSON();r.hasZ=!0===c[0].hasZ,r.hasM=!0===c[0].hasM;const n=t.convertObjectToArcadeDictionary(r,a.defaultTimeZone(e),!1);return n.immutable=!1,n}catch(t){throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r)}if(1===c.length&&a.isFeature(c[0]))try{const e=new t;e.immutable=!1,e.setField("geometry",c[0].geometry());const r=new t;r.immutable=!1,e.setField("attributes",r);for(const e of c[0].keys())r.setField(e,c[0].field(e));return e}catch(t){throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r)}if(1===c.length&&(a.isDictionary(c[0])||a.isVoxel(c[0])))try{const e=new t;e.immutable=!1;for(const r of c[0].keys())e.setField(r,c[0].field(r));return e}catch(t){throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r)}if(2===c.length&&c[0]instanceof t&&y.isBoolean(c[1]))try{if(!0!==c[1]){const e=new t;e.immutable=!1;for(const r of c[0].keys())e.setField(r,c[0].field(r));return e}return c[0].deepClone()}catch(t){throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r)}if(c.length%2!=0)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongNumberOfParameters,r);const l=Object.create(null);for(let t=0;t<c.length;t+=2){const o=a.toString(c[t]),i=c[t+1];if(!(null==i||y.isString(i)||isNaN(i)||a.isDate(i)||y.isNumber(i)||y.isBoolean(i)||a.isDateOnly(i)||a.isTime(i)||y.isArray(i)||a.isImmutableArray(i)))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);if(a.isFunctionParameter(i))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);i===a.voidOperation?l[o]=null:l[o]=i}const s=new t(l);return s.immutable=!1,s}))},e.haskey=function(e,o){return h(e,o,((i,c,l)=>{a.pcCheck(l,2,2,e,o);const s=a.toString(l[1]);if(a.isDictionaryLike(l[0])||l[0]instanceof t)return l[0].hasField(s);if(l[0]instanceof f){const e=r.geometryMember(l[0],s,null,null,2);return!e||"notfound"!==e.keystate}throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,o)}))},e.hasvalue=function(e,t){return h(e,t,((n,o,i)=>(a.pcCheck(i,2,2,e,t),null!=r.getNestedOptionalValue(i[0],i[1]))))},e.indexof=function(e,r){return h(e,r,((t,o,i)=>{a.pcCheck(i,2,2,e,r);const c=i[1];if(y.isArray(i[0])){for(let e=0;e<i[0].length;e++)if(a.equalityTest(c,i[0][e]))return e;return-1}if(a.isImmutableArray(i[0])){const e=i[0].length();for(let r=0;r<e;r++)if(a.equalityTest(c,i[0].get(r)))return r;return-1}throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r)}))},e.angle=function(e,r){return h(e,r,((t,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,3,e,r),!(i[0]instanceof m))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);if(!(i[1]instanceof m))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);if(i.length>2&&!(i[2]instanceof m))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);return 2===i.length?c.angle2D(i[0],i[1]):c.angleBetween2D(i[0],i[1],i[2])}))},e.bearing=function(e,r){return h(e,r,((t,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,3,e,r),!(i[0]instanceof m))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);if(!(i[1]instanceof m))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);if(i.length>2&&!(i[2]instanceof m))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);return 2===i.length?c.bearing2D(i[0],i[1]):c.bearingBetween2D(i[0],i[1],i[2])}))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));