// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["require","exports","../Dictionary","../executionError","../kernel","../../chunks/languageUtils","../geometry/functions","../geometry/unitConversion","../../core/arrayUtils","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/jsonUtils","../geometry/extendedUnitData","../../support/guards"],(function(e,r,t,n,o,a,i,u,c,l,s,f,d,m,E,x,h,y){"use strict";let C;r.loadOperators=async function(){null==C&&(C=await new Promise(((r,t)=>e(["../geometry/operators"],r,t))),await C.loadAll())},r.registerFunctions=function(e,r){e.disjoint=function(e,t){return r(e,t,((r,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,t),null===o[0]||null===o[1]||C.disjoint.execute(o[0],o[1]))))},e.intersects=function(e,t){return r(e,t,((r,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,t),null!==o[0]&&null!==o[1]&&C.intersects.execute(o[0],o[1]))))},e.touches=function(e,t){return r(e,t,((r,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,t),null!==o[0]&&null!==o[1]&&C.touches.execute(o[0],o[1]))))},e.crosses=function(e,t){return r(e,t,((r,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,t),null!==o[0]&&null!==o[1]&&C.crosses.execute(o[0],o[1]))))},e.within=function(e,t){return r(e,t,((r,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,t),null!==o[0]&&null!==o[1]&&C.within.execute(o[0],o[1]))))},e.contains=function(e,t){return r(e,t,((r,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,t),null!==o[0]&&null!==o[1]&&C.contains.execute(o[0],o[1]))))},e.overlaps=function(e,t){return r(e,t,((r,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,t),null!==o[0]&&null!==o[1]&&C.overlaps.execute(o[0],o[1]))))},e.equals=function(e,t){return r(e,t,((r,n,o)=>(a.pcCheck(o,2,2,e,t),o[0]===o[1]||(o[0]instanceof s&&o[1]instanceof s?C.equals.execute(o[0],o[1]):(a.isDate(o[0])&&a.isDate(o[1])||a.isTime(o[0])&&a.isTime(o[1])||!(!a.isDateOnly(o[0])||!a.isDateOnly(o[1])))&&o[0].equals(o[1])))))},e.relate=function(e,t){return r(e,t,((r,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,3,3,e,t),i[0]instanceof s&&i[1]instanceof s)return C.relate.execute(i[0],i[1],a.toString(i[2]));if(i[0]instanceof s&&null===i[1])return!1;if(i[1]instanceof s&&null===i[0])return!1;if(null===i[0]&&null===i[1])return!1;throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t)}))},e.intersection=function(e,t){return r(e,t,((r,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,t),null===o[0]||null===o[1]?null:C.intersection.execute(o[0],o[1]))))},e.union=function(e,t){return r(e,t,((r,i,u)=>{if(0===(u=a.autoCastFeatureToGeometry(u)).length)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.WrongNumberOfParameters,t);const c=[];if(1===u.length)if(y.isArray(u[0])){for(const r of a.autoCastFeatureToGeometry(u[0]))if(null!==r){if(!(r instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);c.push(r)}}else{if(!a.isImmutableArray(u[0])){if(u[0]instanceof s)return a.fixSpatialReference(o.cloneGeometry(u[0]),e.spatialReference);if(null===u[0])return null;throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t)}for(const r of a.autoCastFeatureToGeometry(u[0].toArray()))if(null!==r){if(!(r instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);c.push(r)}}else for(const r of u)if(null!==r){if(!(r instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);c.push(r)}return 0===c.length?null:C.union.executeMany(c)}))},e.difference=function(e,t){return r(e,t,((r,n,u)=>(u=a.autoCastFeatureToGeometry(u),i.commonRelationsCheck(u,e,t),null===u[0]?null:null===u[1]?o.cloneGeometry(u[0]):C.difference.execute(u[0],u[1]))))},e.symmetricdifference=function(e,t){return r(e,t,((r,n,u)=>(u=a.autoCastFeatureToGeometry(u),i.commonRelationsCheck(u,e,t),null===u[0]&&null===u[1]?null:null===u[0]?o.cloneGeometry(u[1]):null===u[1]?o.cloneGeometry(u[0]):C.symmetricDifference.execute(u[0],u[1]))))},e.clip=function(e,t){return r(e,t,((r,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,2,e,t),!(i[1]instanceof l)&&null!==i[1])throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);if(null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return null===i[1]?null:C.clip.execute(i[0],i[1])}))},e.cut=function(e,t){return r(e,t,((r,i,u)=>{if(u=a.autoCastFeatureToGeometry(u),a.pcCheck(u,2,2,e,t),!(u[1]instanceof E)&&null!==u[1])throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);if(null===u[0])return[];if(!(u[0]instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return null===u[1]?[o.cloneGeometry(u[0])]:C.cut.execute(u[0],u[1])}))},e.area=function(e,t){return r(e,t,((r,o,i)=>{a.pcCheck(i,1,2,e,t);let c=(i=a.autoCastFeatureToGeometry(i))[0];if((y.isArray(i[0])||a.isImmutableArray(i[0]))&&(c=a.autoCastArrayOfPointsToPolygon(i[0],e.spatialReference)),null===c)return 0;if(!(c instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return u.convertFromSpatialReferenceUnit(c.spatialReference,u.toAreaUnit(i[1]),C.area.execute(c))}))},e.areageodetic=function(e,t){return r(e,t,((r,o,c)=>{a.pcCheck(c,1,3,e,t);let l=(c=a.autoCastFeatureToGeometry(c))[0];(y.isArray(l)||a.isImmutableArray(l))&&(l=a.autoCastArrayOfPointsToPolygon(l,e.spatialReference));const s=u.toAreaUnit(c[1]),f=i.toCurveType(c[2]);if(null==l)return 0;if(!a.isGeometry(l))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return u.convert(h.squareMeters,s,C.geodeticArea.execute(l,{curveType:f}))}))},e.length=function(e,t){return r(e,t,((r,o,i)=>{a.pcCheck(i,1,2,e,t);let c=(i=a.autoCastFeatureToGeometry(i))[0];if((y.isArray(i[0])||a.isImmutableArray(i[0]))&&(c=a.autoCastArrayOfPointsToPolyline(i[0],e.spatialReference)),null===c)return 0;if(!(c instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return u.convertFromSpatialReferenceUnit(c.spatialReference,u.toLengthUnit(i[1]),C.length.execute(c))}))},e.length3d=function(e,t){return r(e,t,((r,o,c)=>{a.pcCheck(c,1,2,e,t);let l=(c=a.autoCastFeatureToGeometry(c))[0];if((y.isArray(c[0])||a.isImmutableArray(c[0]))&&(l=a.autoCastArrayOfPointsToPolyline(c[0],e.spatialReference)),null===l)return 0;if(!(l instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return!0===l.hasZ?u.convertFromSpatialReferenceUnit(l.spatialReference,u.toLengthUnit(c[1]),i.planarLength3D(l)):u.convertFromSpatialReferenceUnit(l.spatialReference,u.toLengthUnit(c[1]),C.length.execute(l))}))},e.lengthgeodetic=function(e,t){return r(e,t,((r,o,c)=>{a.pcCheck(c,1,3,e,t);let l=(c=a.autoCastFeatureToGeometry(c))[0];(y.isArray(c[0])||a.isImmutableArray(c[0]))&&(l=a.autoCastArrayOfPointsToPolyline(c[0],e.spatialReference));const s=i.toCurveType(c[2]);if(null==l)return 0;if(null!=l&&!a.isGeometry(l))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const f=u.toLengthUnit(c[1]);return u.convert(h.meters,f,C.geodeticLength.execute(l,{curveType:s}))}))},e.distance=function(e,t){return r(e,t,((r,o,i)=>{i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,3,e,t);let c=i[0];if((y.isArray(i[0])||a.isImmutableArray(i[0]))&&(c=a.autoCastArrayOfPointsToMultiPoint(i[0],e.spatialReference)),!(c instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);let l=i[1];if((y.isArray(i[1])||a.isImmutableArray(i[1]))&&(l=a.autoCastArrayOfPointsToMultiPoint(i[1],e.spatialReference)),!(l instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return u.convertFromSpatialReferenceUnit(c.spatialReference,u.toLengthUnit(i[2]),C.distance.execute(c,l))}))},e.distancegeodetic=function(e,t){return r(e,t,((r,o,c)=>{c=a.autoCastFeatureToGeometry(c),a.pcCheck(c,2,4,e,t);const l=c[0];if(!(l instanceof d))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const s=c[1];if(!(s instanceof d))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const f=u.toLengthUnit(c[2]),m=i.toCurveType(c[3]),x=new E({paths:[],spatialReference:l.spatialReference});return x.addPath([l,s]),u.convert(h.meters,f,C.geodeticLength.execute(x,{curveType:m}))}))},e.densify=function(e,t){return r(e,t,((r,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,3,e,t),null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const c=a.toNumber(i[1]);if(isNaN(c))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);if(c<=0)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const l=u.convertToSpatialReferenceUnit(u.toLengthUnit(i[2]),i[0].spatialReference,c);switch(i[0].type){case"polygon":case"polyline":case"extent":return C.densify.execute(i[0],l);default:return i[0]}}))},e.densifygeodetic=function(e,t){return r(e,t,((r,o,c)=>{c=a.autoCastFeatureToGeometry(c),a.pcCheck(c,2,4,e,t);const l=c[0];if(null==l)return null;if(!a.isGeometry(l))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const s=a.toNumber(c[1]);if(isNaN(s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);if(s<=0)throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const f=u.toLengthUnit(c[2]),d=i.toCurveType(c[3]),m=u.convert(f,h.meters,s);switch(l.type){case"polygon":case"polyline":case"extent":return C.geodeticDensify.execute(l,m,{curveType:d});default:return l}}))},e.generalize=function(e,t){return r(e,t,((r,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,4,e,t),null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const c=a.toNumber(i[1]);if(isNaN(c))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const l=u.convertToSpatialReferenceUnit(u.toLengthUnit(i[3]),i[0].spatialReference,c);return C.generalize.execute(i[0],l,{removeDegenerateParts:a.toBoolean(a.defaultUndefined(i[2],!0))})}))},e.buffer=function(e,t){return r(e,t,((r,i,c)=>{if(c=a.autoCastFeatureToGeometry(c),a.pcCheck(c,2,3,e,t),null===c[0])return null;if(!(c[0]instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const l=a.toNumber(c[1]);if(isNaN(l))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return 0===l?o.cloneGeometry(c[0]):C.buffer.execute(c[0],u.convertToSpatialReferenceUnit(u.toLengthUnit(c[2]),c[0].spatialReference,l))}))},e.buffergeodetic=function(e,t){return r(e,t,((r,c,l)=>{l=a.autoCastFeatureToGeometry(l),a.pcCheck(l,2,4,e,t);const s=l[0];if(null==s)return null;if(!a.isGeometry(s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const f=a.toNumber(l[1]);if(isNaN(f))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);if(0===f)return o.cloneGeometry(s);const d=u.toLengthUnit(l[2]),m=i.toCurveType(l[3]);return C.geodesicBuffer.execute(s,u.convert(d,h.meters,f),{curveType:m})}))},e.offset=function(e,t){return r(e,t,((r,o,c)=>{if(c=a.autoCastFeatureToGeometry(c),a.pcCheck(c,2,6,e,t),null===c[0])return null;if(!(c[0]instanceof m||c[0]instanceof E))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const l=a.toNumber(c[1]);if(isNaN(l))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const s=u.convertToSpatialReferenceUnit(u.toLengthUnit(c[2]),c[0].spatialReference,l),f=i.toOffsetJoinType(c[3]),d=a.toNumber(a.defaultUndefined(c[4],10));if(isNaN(d))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const x=a.toNumber(a.defaultUndefined(c[5],0));if(isNaN(x))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return C.offset.execute(c[0],s,{joins:f,miterLimit:d,flattenError:x})}))},e.rotate=function(e,t){return r(e,t,((r,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,3,e,t),null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const u=i[0]instanceof l?m.fromExtent(i[0]):i[0],c=a.toNumber(i[1]);if(isNaN(c))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);const f=a.defaultUndefined(i[2],null);if(null===f){const e="point"===u.type?u:u.extent?.center;return C.rotate(u,c,e?.x,e?.y)}if(f instanceof d)return C.rotate(u,c,f.x,f.y);throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t)}))},e.centroid=function(e,t){return r(e,t,((e,r,t)=>{if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,1,2,e,r),null===t[0])return null;const o=i.toCentroidAlgorithm(t[1]);let u=t[0];if((y.isArray(t[0])||a.isImmutableArray(t[0]))&&(u="geometric"===o?a.autoCastArrayOfPointsToMultiPoint(t[0],e.spatialReference):a.autoCastArrayOfPointsToPolygon(t[0],e.spatialReference),null===u))return null;if(!(u instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,r);return"geometric"===o?C.centroid.execute(u):C.labelPoint.execute(u)}))},e.measuretocoordinate=function(e,t){return r(e,t,i.measureToCoordinateFunc)},e.pointtocoordinate=function(e,t){return r(e,t,i.pointToCoordinateFunc)},e.distancetocoordinate=function(e,t){return r(e,t,i.distanceToCoordinateFunc)},e.multiparttosinglepart=function(e,t){return r(e,t,((r,i,u)=>{if(u=a.autoCastFeatureToGeometry(u),a.pcCheck(u,1,1,e,t),null===u[0])return null;if(!(u[0]instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);if(u[0]instanceof d)return[a.fixSpatialReference(o.cloneGeometry(u[0]),e.spatialReference)];if(u[0]instanceof l)return[a.fixSpatialReference(o.cloneGeometry(u[0]),e.spatialReference)];const c=C.simplify.execute(u[0]);if(c instanceof m){const e=[],r=[];for(let t=0;t<c.rings.length;t++)if(c.isClockwise(c.rings[t])){const r=x.fromJSON({rings:[c.rings[t]],hasZ:!0===c.hasZ,hasM:!0===c.hasM,spatialReference:c.spatialReference.toJSON()});e.push(r)}else r.push({ring:c.rings[t],pt:c.getPoint(t,0)});for(let t=0;t<r.length;t++)for(let n=0;n<e.length;n++)if(e[n].contains(r[t].pt)){e[n].addRing(r[t].ring);break}return e}if(c instanceof E){const e=[];for(let r=0;r<c.paths.length;r++){const t=x.fromJSON({paths:[c.paths[r]],hasZ:!0===c.hasZ,hasM:!0===c.hasM,spatialReference:c.spatialReference.toJSON()});e.push(t)}return e}if(u[0]instanceof f){const r=[],t=a.fixSpatialReference(o.cloneGeometry(u[0]),e.spatialReference);for(let e=0;e<t.points.length;e++)r.push(t.getPoint(e));return r}return null}))},e.isselfintersecting=function(e,t){return r(e,t,((e,r,t)=>{a.pcCheck(t,1,1,e,r);let n=(t=a.autoCastFeatureToGeometry(t))[0];if((y.isArray(t[0])||a.isImmutableArray(t[0]))&&(n=a.autoCastArrayOfPointsToPolyline(t[0],e.spatialReference)),n instanceof f){const e=n.points;for(let r=0;r<e.length;r++)for(let t=r+1;t<e.length;t++)if(c.equals(e[r],e[t]))return!0;return!1}return(n instanceof E||n instanceof m)&&C.isSelfIntersecting(n)}))},e.issimple=function(e,t){return r(e,t,((r,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,1,1,e,t),null===i[0])return!0;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return C.simplify.isSimple(i[0])}))},e.simplify=function(e,t){return r(e,t,((r,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,1,1,e,t),null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return C.simplify.execute(i[0])}))},e.convexhull=function(e,t){return r(e,t,((r,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,1,1,e,t),null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,t);return C.convexHull.execute(i[0])}))},e.nearestcoordinate=function(e,o){return r(e,o,((r,i,u)=>{if(u=a.autoCastFeatureToGeometry(u),a.pcCheck(u,2,2,e,o),!(u[0]instanceof s||null===u[0]))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,o);if(!(u[1]instanceof d||null===u[1]))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,o);if(null===u[0]||null===u[1])return null;const c=u[0]instanceof l?m.fromExtent(u[0]):u[0],f=C.proximity.getNearestCoordinate(c,u[1],{calculateLeftRightSide:!0});return null===f||f.isEmpty?null:t.convertObjectToArcadeDictionary({coordinate:f.coordinate,distance:f.distance,sideOfLine:0===f.distance?"straddle":f.isRightSide?"right":"left"},a.defaultTimeZone(e),!1,!0)}))},e.nearestvertex=function(e,o){return r(e,o,((r,i,u)=>{if(u=a.autoCastFeatureToGeometry(u),a.pcCheck(u,2,2,e,o),!(u[0]instanceof s||null===u[0]))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,o);if(!(u[1]instanceof d||null===u[1]))throw new n.ArcadeExecutionError(e,n.ExecutionErrorCodes.InvalidParameter,o);if(null===u[0]||null===u[1])return null;const c=u[0]instanceof l?m.fromExtent(u[0]):u[0],f=C.proximity.getNearestVertex(c,u[1]);return null===f||f.isEmpty?null:t.convertObjectToArcadeDictionary({coordinate:f.coordinate,distance:f.distance,sideOfLine:0===f.distance?"straddle":f.isRightSide?"right":"left"},a.defaultTimeZone(e),!1,!0)}))}},Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})}));