// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../ArcadePortal","../Attachment","../Dictionary","../enum","../executionError","../../chunks/languageUtils","./convertdirection","./hash","../../core/urlUtils","../../core/uuid","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/SpatialReference","../../portal/Portal","../../support/guards"],(function(e,t,r,n,o,i,a,u,c,l,d,p,s,f,h,g,y,A,m){"use strict";function E(e,t){if(!e||!t)return e===t;if(e.x===t.x&&e.y===t.y){if(e.hasZ){if(e.z!==t.z)return!1}else if(t.hasZ)return!1;if(e.hasM){if(e.m!==t.m)return!1}else if(t.hasM)return!1;return!0}return!1}function x(e,o,u){if(null!==e)if(m.isArray(e)){if(o.updateUint8Array([61]),u.map.has(e)){const t=u.map.get(e);o.updateIntArray([61237541^t])}else{u.map.set(e,u.currentLength++);for(const t of e)x(t,o,u);u.map.delete(e),u.currentLength--}o.updateUint8Array([199])}else if(a.isImmutableArray(e)){if(o.updateUint8Array([61]),u.map.has(e)){const t=u.map.get(e);o.updateIntArray([61237541^t])}else{u.map.set(e,u.currentLength++);for(const t of e.toArray())x(t,o,u);u.map.delete(e),u.currentLength--}o.updateUint8Array([199])}else{if(a.isDate(e))return o.updateIntArray([e.toNumber()]),void o.updateUint8Array([241]);if(a.isDateOnly(e))return o.updateIntArray([e.toNumber()]),void o.updateIntArray([257]);if(a.isTime(e))return o.updateIntArray([e.toNumber()]),void o.updateIntArray([263]);if(m.isString(e))return o.updateIntArray([e.length]),o.updateWithString(e),void o.updateUint8Array([41]);if(m.isBoolean(e))o.updateUint8Array([!0===e?1:0,113]);else{if(m.isNumber(e))return o.updateFloatArray([e]),void o.updateUint8Array([173]);if(e instanceof r)throw new i.ArcadeExecutionError(u.context,i.ExecutionErrorCodes.UnsupportedHashType,u.node);if(e instanceof t)throw new i.ArcadeExecutionError(u.context,i.ExecutionErrorCodes.UnsupportedHashType,u.node);if(!(e instanceof n)){if(a.isFeature(e))throw new i.ArcadeExecutionError(u.context,i.ExecutionErrorCodes.UnsupportedHashType,u.node);if(e instanceof f)return o.updateIntArray([3833836621]),o.updateIntArray([0]),o.updateFloatArray([e.x]),o.updateIntArray([1]),o.updateFloatArray([e.y]),e.hasZ&&(o.updateIntArray([2]),o.updateFloatArray([e.z])),e.hasM&&(o.updateIntArray([3]),o.updateFloatArray([e.m])),o.updateIntArray([3765347959]),void x(e.spatialReference.wkid,o,u);if(e instanceof h){o.updateIntArray([1266616829]);for(let t=0;t<e.rings.length;t++){const r=e.rings[t],n=[];let i=null,a=null;for(let o=0;o<r.length;o++){const u=e.getPoint(t,o);if(0===o)i=u;else if(E(a,u))continue;a=u,o===r.length-1&&E(i,u)||n.push(u)}o.updateIntArray([1397116793,n.length]);for(let e=0;e<n.length;e++){const t=n[e];o.updateIntArray([3962308117,e]),x(t,o,u),o.updateIntArray([2716288009])}o.updateIntArray([2278822459])}return o.updateIntArray([3878477243]),void x(e.spatialReference.wkid,o,u)}if(e instanceof g){o.updateIntArray([4106883559]);for(let t=0;t<e.paths.length;t++){const r=e.paths[t];o.updateIntArray([1397116793,r.length]);for(let n=0;n<r.length;n++)o.updateIntArray([3962308117,n]),x(e.getPoint(t,n),o,u),o.updateIntArray([2716288009]);o.updateIntArray([2278822459])}return o.updateIntArray([2568784753]),void x(e.spatialReference.wkid,o,u)}if(e instanceof s){o.updateIntArray([588535921,e.points.length]);for(let t=0;t<e.points.length;t++){const r=e.getPoint(t);o.updateIntArray([t]),x(r,o,u)}return o.updateIntArray([1700171621]),void x(e.spatialReference.wkid,o,u)}if(e instanceof p)return o.updateIntArray([3483648373]),o.updateIntArray([0]),o.updateFloatArray([e.xmax]),o.updateIntArray([1]),o.updateFloatArray([e.xmin]),o.updateIntArray([2]),o.updateFloatArray([e.ymax]),o.updateIntArray([3]),o.updateFloatArray([e.ymin]),e.hasZ&&(o.updateIntArray([4]),o.updateFloatArray([e.zmax]),o.updateIntArray([5]),o.updateFloatArray([e.zmin])),e.hasM&&(o.updateIntArray([6]),o.updateFloatArray([e.mmax]),o.updateIntArray([7]),o.updateFloatArray([e.mmin])),o.updateIntArray([3622027469]),void x(e.spatialReference.wkid,o,u);if(e instanceof y)return o.updateIntArray([14]),void 0!==e.wkid&&null!==e.wkid&&o.updateIntArray([e.wkid]),e.wkt&&o.updateWithString(e.wkt),void(e.wkt2&&o.updateWithString(e.wkt2));if(a.isFunctionParameter(e))throw new i.ArcadeExecutionError(u.context,i.ExecutionErrorCodes.UnsupportedHashType,u.node);if(a.isFeatureSet(e))throw new i.ArcadeExecutionError(u.context,i.ExecutionErrorCodes.UnsupportedHashType,u.node);if(a.isFeatureSetCollection(e))throw new i.ArcadeExecutionError(u.context,i.ExecutionErrorCodes.UnsupportedHashType,u.node);if(e===a.voidOperation)throw new i.ArcadeExecutionError(u.context,i.ExecutionErrorCodes.UnsupportedHashType,u.node);throw new i.ArcadeExecutionError(u.context,i.ExecutionErrorCodes.UnsupportedHashType,u.node)}if(o.updateUint8Array([223]),u.map.has(e)){const t=u.map.get(e);o.updateIntArray([61237541^t])}else{u.map.set(e,u.currentLength++);for(const t of e.keys())o.updateIntArray([t.length]),o.updateWithString(t),o.updateUint8Array([251]),x(e.field(t),o,u),o.updateUint8Array([239]);u.map.delete(e),u.currentLength--}o.updateUint8Array([73])}}else o.updateUint8Array([0,139])}e.registerFunctions=function(e,r){e.portal=function(e,n){return r(e,n,((r,o,i)=>(a.pcCheck(i,1,1,e,n),new t(a.toString(i[0])))))},e.typeof=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,1,1,e,t);const u=a.getType(o[0]);if("Unrecognized Type"===u)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.UnrecognizedType,t);return u}))},e.trim=function(e,t){return r(e,t,((r,n,o)=>(a.pcCheck(o,1,1,e,t),a.toString(o[0]).trim())))},e.tohex=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,1,1,e,t);const i=a.toNumber(o[0]);return isNaN(i)?i:i.toString(16)}))},e.upper=function(e,t){return r(e,t,((r,n,o)=>(a.pcCheck(o,1,1,e,t),a.toString(o[0]).toUpperCase())))};const p=new o.StringEnum(["every-word","first-word"]);e.proper=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,1,2,e,t);const i=(o.length>=2?p.lookup(a.toString(o[1])):null)??"every-word",u=/\s/,c=a.toString(o[0]);let l="",d=!0;for(let e=0;e<c.length;e++){let t=c[e];u.test(t)?"every-word"===i&&(d=!0):t.toUpperCase()!==t.toLowerCase()&&(d?(t=t.toUpperCase(),d=!1):t=t.toLowerCase()),l+=t}return l}))},e.lower=function(e,t){return r(e,t,((r,n,o)=>(a.pcCheck(o,1,1,e,t),a.toString(o[0]).toLowerCase())))};const s=new o.StringEnum(["digits","digits-hyphen","digits-hyphen-braces","digits-hyphen-parentheses"]);e.guid=function(e,t){return r(e,t,((r,n,o)=>{switch(a.pcCheck(o,0,1,e,t),o.length>0?s.lookup(a.toString(o[0])):null){case"digits":return d.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return d.generateUUID();case"digits-hyphen-parentheses":return"("+d.generateUUID()+")";default:return"{"+d.generateUUID()+"}"}}))},e.standardizeguid=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,2,2,e,t);let i=a.toString(o[0]);if(""===i||null===i)return"";const u=/^(\{|\()?(?<partA>[0-9a-z]{8})(-?)(?<partB>[0-9a-z]{4})(-?)(?<partC>[0-9a-z]{4})(-?)(?<partD>[0-9a-z]{4})(-?)(?<partE>[0-9a-z]{12})(\}|\))?$/gim.exec(i);if(!u)return"";const c=u.groups;switch(i=c.partA+"-"+c.partB+"-"+c.partC+"-"+c.partD+"-"+c.partE,s.lookup(a.toString(o[1]))){case"digits":return i.replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return i;case"digits-hyphen-parentheses":return"("+i+")";default:return"{"+i+"}"}}))},e.console=function(e,t){return r(e,t,((t,r,n)=>(0===n.length||(1===n.length?e.console(a.toString(n[0])):e.console(a.toString(n))),a.voidOperation)))},e.mid=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,2,3,e,t);let i=a.toNumber(o[1]);if(isNaN(i))return"";if(i=Math.max(0,i),2===o.length)return a.toString(o[0]).slice(i);let u=a.toNumber(o[2]);return isNaN(u)?"":(u<0&&(u=0),a.toString(o[0]).slice(i,i+u))}))},e.find=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,2,3,e,t);let i=0;if(o.length>2){if(i=a.toNumber(a.defaultUndefined(o[2],0)),isNaN(i))return-1;i<0&&(i=0)}return a.toString(o[1]).indexOf(a.toString(o[0]),i)}))},e.left=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,2,2,e,t);let i=a.toNumber(o[1]);return isNaN(i)?"":(i<0&&(i=0),a.toString(o[0]).slice(0,i))}))},e.right=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,2,2,e,t);const i=a.toNumber(o[1]);return isNaN(i)||i<=0?"":a.toString(o[0]).slice(-i)}))},e.split=function(e,t){return r(e,t,((r,n,o)=>{let i;a.pcCheck(o,2,4,e,t);let u=a.toNumber(a.defaultUndefined(o[2],-1));const c=a.toBoolean(a.defaultUndefined(o[3],!1));if(-1===u||null===u||!0===c?i=a.toString(o[0]).split(a.toString(o[1])):(isNaN(u)&&(u=-1),u<-1&&(u=-1),i=a.toString(o[0]).split(a.toString(o[1]),u)),!1===c)return i;const l=[];for(let e=0;e<i.length&&!(-1!==u&&l.length>=u);e++)""!==i[e]&&void 0!==i[e]&&l.push(i[e]);return l}))},e.text=function(e,t){return r(e,t,((r,n,o)=>(a.pcCheck(o,1,2,e,t),a.toStringExplicit(o[0],o[1]))))},e.concatenate=function(e,t){return r(e,t,((e,t,r)=>{const n=[];if(r.length<1)return"";if(m.isArray(r[0])){const e=a.defaultUndefined(r[2],"");for(let t=0;t<r[0].length;t++)n[t]=a.toStringExplicit(r[0][t],e);return r.length>1?n.join(r[1]):n.join("")}if(a.isImmutableArray(r[0])){const e=a.defaultUndefined(r[2],"");for(let t=0;t<r[0].length();t++)n[t]=a.toStringExplicit(r[0].get(t),e);return r.length>1?n.join(r[1]):n.join("")}for(let e=0;e<r.length;e++)n[e]=a.toStringExplicit(r[e]);return n.join("")}))},e.reverse=function(e,t){return r(e,t,((r,n,o)=>{if(a.pcCheck(o,1,1,e,t),m.isArray(o[0])){const e=o[0].slice();return e.reverse(),e}if(a.isImmutableArray(o[0])){const e=o[0].toArray().slice();return e.reverse(),e}throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidParameter,t)}))},e.replace=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,3,4,e,t);const i=a.toString(o[0]),u=a.toString(o[1]),c=a.toString(o[2]);return 4!==o.length||a.toBoolean(o[3])?a.multiReplace(i,u,c):i.replace(u,c)}))},e.urlencode=function(e,t){return r(e,t,((r,o,i)=>{if(a.pcCheck(i,1,1,e,t),null===i[0])return"";if(i[0]instanceof n){let e="";for(const t of i[0].keys()){const r=i[0].field(t);""!==e&&(e+="&"),e+=null===r?encodeURIComponent(t)+"=":encodeURIComponent(t)+"="+encodeURIComponent(r)}return e}return encodeURIComponent(a.toString(i[0]))}))},e.hash=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,1,1,e,t);const i=new c.XXH(0);return x(o[0],i,{context:e,node:t,map:new Map,currentLength:0}),i.digest()}))},e.convertdirection=function(e,t){return r(e,t,((r,n,o)=>(a.pcCheck(o,3,3,e,t),u.convertDirection(o[0],o[1],o[2]))))},e.fromjson=function(e,t){return r(e,t,((r,o,u)=>{if(a.pcCheck(u,1,1,e,t),!1===m.isString(u[0]))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidParameter,t);return n.convertJsonToArcade(JSON.parse(a.toString(u[0])),a.defaultTimeZone(e))}))},e.tocharcode=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,1,2,e,t);const u=a.toNumber(a.defaultUndefined(o[1],0)),c=a.toString(o[0]);if(0===c.length&&1===o.length)return null;if(c.length<=u||u<0)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.OutOfBounds,t);return c.charCodeAt(u)}))},e.tocodepoint=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,1,2,e,t);const u=a.toNumber(a.defaultUndefined(o[1],0)),c=a.toString(o[0]);if(0===c.length&&1===o.length)return null;if(c.length<=u||u<0)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.OutOfBounds,t);return c.codePointAt(u)}))},e.fromcharcode=function(e,t){return r(e,t,((r,n,o)=>{if(o.length<1)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.WrongNumberOfParameters,t);const u=o.map((e=>Math.trunc(a.toNumber(e)))).filter((e=>e>=0&&e<=65535));return 0===u.length?null:String.fromCharCode.apply(null,u)}))},e.fromcodepoint=function(e,t){return r(e,t,((r,n,o)=>{if(o.length<1)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.WrongNumberOfParameters,t);let u;try{u=o.map((e=>Math.trunc(a.toNumber(e)))).filter((e=>e<=1114111&&e>>>0===e))}catch(e){return null}return 0===u.length?null:String.fromCodePoint.apply(null,u)}))},e.getuser=function(e,o){return r(e,o,((r,u,c)=>{a.pcCheck(c,0,2,e,o);let d=a.defaultUndefined(c[1],"");if(d=!0===d||!1===d?"":a.toString(d),null!==d&&""!==d)return null;if(0===c.length||c[0]instanceof t){let t=null;if(t=e.services?.portal?e.services.portal:A.getDefault(),c.length>0&&(f=t,!(s=c[0].field("url"))||!l.hasSamePortal(s,f?.restUrl||"")))return null;if(!t)return null;if(""===d){const r="loaded"===(p=t).loadStatus&&p.user?.sourceJSON?p.user.sourceJSON:null;if(r){const t=JSON.parse(JSON.stringify(r));for(const e of["lastLogin","created","modified"])void 0!==t[e]&&null!==t[e]&&(t[e]=new Date(t[e]));return n.convertObjectToArcadeDictionary(t,a.defaultTimeZone(e))}}return null}var p,s,f;throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidParameter,o)}))},e.getenvironment=function(e,t){return r(e,t,((r,o,i)=>(a.pcCheck(i,0,0,e,t),n.convertObjectToArcadeDictionary(a.defaultExecutingContext(a.defaultTimeZone(e),e.spatialReference),a.defaultTimeZone(e),!0))))},e.standardizefilename=function(e,t){return r(e,t,((e,t,r)=>{a.pcCheck(r,1,1,e,t);const[n]=r;if(null==n)return"";if(!m.isString(n))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidParameter,t);return n.replaceAll(/[<>"?*]/g,"_").replaceAll(/[/\\|]/g,"-").replaceAll(":",", ")}))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));