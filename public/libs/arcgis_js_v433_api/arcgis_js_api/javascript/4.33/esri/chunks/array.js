// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../arcade/deepClone","../arcade/executionError","../arcade/ImmutableArray","./languageUtils","../core/promiseUtils","../support/guards"],(function(r,n,e,t,o,i,c){"use strict";function u(r){function u(r,n,o){if(r instanceof t)return r.toArray();if(c.isArray(r))return r;throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,o)}function a(r,n){const e=r.length,t=Math.floor(e/2);return 0===e?[]:1===e?[r[0]]:function(r,n,e){const t=[];for(;r.length>0||n.length>0;)if(r.length>0&&n.length>0){let o=e(r[0],n[0]);isNaN(o)&&(o=0),o<=0?(t.push(r[0]),r=r.slice(1)):(t.push(n[0]),n=n.slice(1))}else r.length>0?(t.push(r[0]),r=r.slice(1)):n.length>0&&(t.push(n[0]),n=n.slice(1));return t}(a(r.slice(0,t),n),a(r.slice(t,e),n),n)}async function s(r,n){const e=r.length,t=Math.floor(e/2);if(0===e)return[];if(1===e)return[r[0]];const o=[await s(r.slice(0,t),n),await s(r.slice(t,e),n)];return l(o[0],o[1],n,[])}async function l(r,n,e,t){const o=t;if(r.length>0||n.length>0){if(r.length>0&&n.length>0){let i=await e(r[0],n[0]);return isNaN(i)&&(i=1),i<=0?(o.push(r[0]),r=r.slice(1)):(o.push(n[0]),n=n.slice(1)),l(r,n,e,t)}return r.length>0?(o.push(r[0]),l(r=r.slice(1),n,e,t)):(o.push(n[0]),l(r,n=n.slice(1),e,t))}return t}function d(r,n,t,i){o.pcCheck(t,1,2,r,n);let u=t[0];if(o.isImmutableArray(u)&&(u=u.toArray()),!1===c.isArray(u))throw new e.ArcadeExecutionError(r,e.ExecutionErrorCodes.InvalidParameter,n);if(t.length>1){if(!1===o.isFunctionParameter(t[1]))throw new e.ArcadeExecutionError(r,e.ExecutionErrorCodes.InvalidParameter,n);let c=u;const l=t[1].createFunction(r);return i?s(c,l):(c=a(c,((r,n)=>l(r,n))),c)}let l=u;if(0===l.length)return[];const d={};for(let r=0;r<l.length;r++){const n=o.getType(l[r]);""!==n&&(d[n]=!0)}if(!0===d.Array||!0===d.Dictionary||!0===d.Feature||!0===d.Voxel||!0===d.Point||!0===d.Polygon||!0===d.Polyline||!0===d.Multipoint||!0===d.Extent||!0===d.Function)return l.slice();let f=0,E="";for(const r in d)f++,E=r;return l=f>1||"String"===E?a(l,((r,n)=>{if(null==r||r===o.voidOperation)return null==n||n===o.voidOperation?0:1;if(null==n||n===o.voidOperation)return-1;const e=o.toString(r),t=o.toString(n);return e<t?-1:e===t?0:1})):"Number"===E?a(l,((r,n)=>r-n)):"Boolean"===E?a(l,((r,n)=>r===n?0:n?-1:1)):"Date"===E?a(l,((r,n)=>r.toNumber()-n.toNumber())):l.slice(),l}r.functions.array=function(t,i){return r.standardFunction(t,i,((r,u,a)=>{if(o.pcCheck(a,0,2,t,i),0===a.length)return[];if(1===a.length&&null===a[0])return[];if(c.isArray(a[0])){if(2===a.length&&!1===c.isBoolean(a[1]))throw new e.ArcadeExecutionError(t,e.ExecutionErrorCodes.InvalidParameter,i);return!0===o.defaultUndefined(a[1],!1)?n.deepClone(a[0]):a[0].slice()}if(o.isImmutableArray(a[0])){if(2===a.length&&!1===c.isBoolean(a[1]))throw new e.ArcadeExecutionError(t,e.ExecutionErrorCodes.InvalidParameter,i);return!0===o.defaultUndefined(a[1],!1)?n.deepClone(a[0]):a[0].toArray().slice()}const s=o.toNumber(a[0]);if(isNaN(s)||!1===c.isInteger(s))throw new e.ArcadeExecutionError(t,e.ExecutionErrorCodes.InvalidParameter,i);const l=o.defaultUndefined(a[1],null),d=new Array(s);return d.fill(l),d}))},r.functions.front=function(n,t){return r.standardFunction(n,t,((r,i,u)=>{if(o.pcCheck(u,1,1,n,t),o.isImmutableArray(u[0])){if(u[0].length()<=0)throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.OutOfBounds,t);return u[0].get(0)}if(c.isArray(u[0])){if(u[0].length<=0)throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.OutOfBounds,t);return u[0][0]}throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t)}))},r.functions.back=function(n,t){return r.standardFunction(n,t,((r,i,u)=>{if(o.pcCheck(u,1,1,n,t),o.isImmutableArray(u[0])){if(u[0].length()<=0)throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.OutOfBounds,t);return u[0].get(u[0].length()-1)}if(c.isArray(u[0])){if(u[0].length<=0)throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.OutOfBounds,t);return u[0][u[0].length-1]}throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t)}))},r.functions.push=function(n,t){return r.standardFunction(n,t,((r,i,u)=>{if(o.pcCheck(u,1,2,n,t),c.isArray(u[0]))return u[0][u[0].length]=u[1],u[0].length;throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t)}))},r.functions.pop=function(n,t){return r.standardFunction(n,t,((r,i,u)=>{if(o.pcCheck(u,1,1,n,t),c.isArray(u[0])){if(u[0].length<=0)throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.OutOfBounds,t);const r=u[0][u[0].length-1];return u[0].length=u[0].length-1,r}throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t)}))},r.functions.erase=function(n,t){return r.standardFunction(n,t,((r,i,u)=>{if(o.pcCheck(u,2,2,n,t),c.isArray(u[0])){let r=o.toNumber(u[1]);if(isNaN(r)||!1===c.isInteger(r))throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t);const i=u[0];if(i.length<=0)throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.OutOfBounds,t);if(r<0&&(r=i.length+r),r<0)throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.OutOfBounds,t);if(r>=i.length)throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.OutOfBounds,t);return i.splice(r,1),o.voidOperation}throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t)}))},r.functions.insert=function(n,t){return r.standardFunction(n,t,((r,i,u)=>{if(o.pcCheck(u,3,3,n,t),c.isArray(u[0])){const r=o.toNumber(u[1]);if(isNaN(r)||!1===c.isInteger(r))throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t);const i=u[2],a=u[0];if(r>a.length)throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.OutOfBounds,t);if(r<0&&r<-1*a.length)throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.OutOfBounds,t);return r===a.length?(a[r]=i,o.voidOperation):(a.splice(r,0,i),o.voidOperation)}throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t)}))},r.functions.resize=function(n,t){return r.standardFunction(n,t,((r,i,u)=>{if(o.pcCheck(u,2,3,n,t),c.isArray(u[0])){const r=o.toNumber(u[1]);if(isNaN(r)||!1===c.isInteger(r))throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t);if(r<0)throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t);const i=o.defaultUndefined(u[2],null),a=u[0];if(a.length>=r)return a.length=r,o.voidOperation;const s=a.length;a.length=r;for(let r=s;r<a.length;r++)a[r]=i;return o.voidOperation}throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t)}))},r.functions.includes=function(n,t){return r.standardFunction(n,t,((r,i,u)=>{if(o.pcCheck(u,2,2,n,t),c.isArray(u[0])){const r=u[1];return!!u[0].some((n=>o.equalityTest(n,r)))}if(o.isImmutableArray(u[0])){const r=u[1];return!!u[0].toArray().some((n=>o.equalityTest(n,r)))}throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t)}))},r.functions.slice=function(n,t){return r.standardFunction(n,t,((r,i,u)=>{if(o.pcCheck(u,1,3,n,t),c.isArray(u[0])){const r=o.toNumber(o.defaultUndefined(u[1],0)),i=o.toNumber(o.defaultUndefined(u[2],u[0].length));if(isNaN(r)||!1===c.isInteger(r))throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t);if(isNaN(i)||!1===c.isInteger(i))throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t);return u[0].slice(r,i)}if(o.isImmutableArray(u[0])){const r=u[0],i=o.toNumber(o.defaultUndefined(u[1],0)),a=o.toNumber(o.defaultUndefined(u[2],r.length()));if(isNaN(i)||!1===c.isInteger(i))throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t);if(isNaN(a)||!1===c.isInteger(a))throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t);return r.toArray().slice(i,a)}throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t)}))},r.functions.splice=function(n,e){return r.standardFunction(n,e,((r,n,e)=>{const t=[];for(let r=0;r<e.length;r++)c.isArray(e[r])?t.push(...e[r]):o.isImmutableArray(e[r])?t.push(...e[r].toArray()):t.push(e[r]);return t}))},r.functions.top=function(n,t){return r.standardFunction(n,t,((r,i,u)=>{if(o.pcCheck(u,2,2,n,t),c.isArray(u[0]))return o.toNumber(u[1])>=u[0].length?u[0].slice():u[0].slice(0,o.toNumber(u[1]));if(o.isImmutableArray(u[0]))return o.toNumber(u[1])>=u[0].length()?u[0].slice():u[0].slice(0,o.toNumber(u[1]));throw new e.ArcadeExecutionError(n,e.ExecutionErrorCodes.InvalidParameter,t)}))},r.functions.first=function(n,e){return r.standardFunction(n,e,((r,t,i)=>(o.pcCheck(i,1,1,n,e),c.isArray(i[0])?0===i[0].length?null:i[0][0]:o.isImmutableArray(i[0])?0===i[0].length()?null:i[0].get(0):null)))},"sync"===r.mode&&(r.functions.sort=function(n,e){return r.standardFunction(n,e,((r,e,t)=>d(n,e,t,!1)))},r.functions.any=function(n,e){return r.standardFunction(n,e,((r,e,t)=>{o.pcCheck(t,2,2,n,e);const i=t[1].createFunction(n),a=u(t[0],n,e);for(const r of a){const n=i(r);if(c.isBoolean(n)&&!0===n)return!0}return!1}))},r.functions.all=function(n,e){return r.standardFunction(n,e,((r,e,t)=>{o.pcCheck(t,2,2,n,e);const i=t[1].createFunction(n),c=u(t[0],n,e);for(const r of c)if(!0!==i(r))return!1;return!0}))},r.functions.none=function(n,e){return r.standardFunction(n,e,((r,e,t)=>{o.pcCheck(t,2,2,n,e);const i=t[1].createFunction(n),c=u(t[0],n,e);for(const r of c)if(!0===i(r))return!1;return!0}))},r.functions.reduce=function(n,e){return r.standardFunction(n,e,((r,e,t)=>{o.pcCheck(t,2,3,n,e);const i=t[1].createFunction(n),c=u(t[0],n,e);return 2===t.length?0===c.length?null:c.reduce(((r,n)=>{const e=i(r,n);return void 0!==e&&e!==o.voidOperation?e:null})):c.reduce(((r,n)=>{const e=i(r,n);return void 0!==e&&e!==o.voidOperation?e:null}),t[2])}))},r.functions.map=function(n,e){return r.standardFunction(n,e,((r,e,t)=>{o.pcCheck(t,2,2,n,e);const i=t[1].createFunction(n),c=u(t[0],n,e),a=[];for(const r of c){const n=i(r);void 0!==n&&n!==o.voidOperation?a.push(n):a.push(null)}return a}))},r.functions.filter=function(n,e){return r.standardFunction(n,e,((r,e,t)=>{o.pcCheck(t,2,2,n,e);const i=t[1].createFunction(n),c=u(t[0],n,e),a=[];for(const r of c)!0===i(r)&&a.push(r);return a}))}),"async"===r.mode&&(r.functions.sort=function(n,e){return r.standardFunctionAsync(n,e,(async(r,e,t)=>d(n,e,t,!0)))},r.functions.any=function(n,e){return r.standardFunctionAsync(n,e,(async(r,e,t)=>{o.pcCheck(t,2,2,n,e);const a=t[1].createFunction(n),s=u(t[0],n,e);for(const r of s){const n=await a(r);let e=null;if(e=i.isPromiseLike(e)?await n:n,c.isBoolean(e)&&!0===e)return!0}return!1}))},r.functions.all=function(n,e){return r.standardFunctionAsync(n,e,(async(r,e,t)=>{o.pcCheck(t,2,2,n,e);const c=t[1].createFunction(n),a=u(t[0],n,e);for(const r of a){const n=await c(r);let e=null;if(e=i.isPromiseLike(e)?await n:n,!0!==e)return!1}return!0}))},r.functions.none=function(n,e){return r.standardFunctionAsync(n,e,(async(r,e,t)=>{o.pcCheck(t,2,2,n,e);const c=t[1].createFunction(n),a=u(t[0],n,e);for(const r of a){const n=await c(r);let e=null;if(e=i.isPromiseLike(e)?await n:n,!0===e)return!1}return!0}))},r.functions.filter=function(n,e){return r.standardFunctionAsync(n,e,(async(r,e,t)=>{o.pcCheck(t,2,2,n,e);const c=t[1].createFunction(n),a=u(t[0],n,e),s=[];for(const r of a){const n=await c(r);let e=null;e=i.isPromiseLike(e)?await n:n,!0===e&&s.push(r)}return s}))},r.functions.reduce=function(n,e){return r.standardFunctionAsync(n,e,(async(r,e,t)=>{o.pcCheck(t,2,3,n,e);const i=t[1].createFunction(n),c=u(t[0],n,e);let a;if(t.length>2){const r=o.defaultUndefined(t[2],null);a=c.reduce((async(r,n)=>{let e=await r;return void 0!==e&&e!==o.voidOperation||(e=null),i(e,n)}),Promise.resolve(r))}else{if(0===c.length)return null;a=c.reduce((async(r,n,e)=>{if(e<=1)return i(r,n);let t=await r;return void 0!==t&&t!==o.voidOperation||(t=null),i(t,n)}))}return a.then((r=>void 0!==r&&r!==o.voidOperation?r:null))}))},r.functions.map=function(n,e){return r.standardFunctionAsync(n,e,(async(r,e,t)=>{o.pcCheck(t,2,2,n,e);const c=t[1].createFunction(n),a=u(t[0],n,e),s=[];for(const r of a){const n=await c(r);let e=null;e=i.isPromiseLike(e)?await n:n,void 0!==e&&e!==o.voidOperation?s.push(e):s.push(null)}return s}))})}const a=Object.freeze(Object.defineProperty({__proto__:null,registerFunctions:u},Symbol.toStringTag,{value:"Module"}));r.ArrayFunctions=a,r.registerFunctions=u}));