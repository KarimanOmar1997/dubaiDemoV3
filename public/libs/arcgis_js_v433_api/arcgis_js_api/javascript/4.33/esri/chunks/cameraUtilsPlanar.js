// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../core/mathUtils","../core/libs/gl-matrix-2/math/mat4","../core/libs/gl-matrix-2/factories/mat4f64","../core/libs/gl-matrix-2/factories/vec2f64","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","../geometry/Extent","../geometry/Polygon","../geometry/projection/projectPointToVector","../geometry/projection/projectVectorToVector","../geometry/support/coordsUtils","../geometry/support/frustum","../geometry/support/polygonExtentClipping","../geometry/support/ray","../views/3d/state/Frustum","../views/3d/support/cameraUtilsInternal"],(function(e,t,o,r,n,i,c,a,l,s,p,d,u,f,m,g,T){"use strict";const y=c.fromValues(0,1,0),x=c.fromValues(0,0,1),A=r.create(),V=c.create(),R=c.create();function h(e,r,n,c=T.createDirectionUp()){const{direction:a,up:l}=c;return o.fromZRotation(A,-t.deg2rad(r)),o.rotateX(A,A,t.deg2rad(n)),i.transformMat4(a,x,A),i.scale(a,a,-1),i.transformMat4(l,y,A),c}function j(e,t,o,r){return T.directionToHeadingTilt(t,o,r,x,y)}function P(e,t,o,r){const n=h(0,o,r),a=c.create();return i.scale(a,n.direction,-t),i.add(a,a,e),{up:n.up,eye:a,heading:o,tilt:r}}function E(e){return t.rad2deg(e)}function b(e){return t.deg2rad(e)}function v(e,t,o,r,n){const i=e.renderSpatialReference,c=e.spatialReference??t.spatialReference;return s.projectPointToVector(t,V,i),s.projectPointToVector(t,R,i),V[0]-=o/2,R[0]+=o/2,V[1]-=r/2,R[1]+=r/2,p.projectVectorToVector(V,i,V,c),p.projectVectorToVector(R,i,R,c),n?(n.xmin=V[0],n.ymin=V[1],n.xmax=R[0],n.ymax=R[1],n.spatialReference=c):n=new a(V[0],V[1],R[0],R[1],c),n}function w(e,t){const o=e.frustum,{renderCoordsHelper:r}=e,c=r.getAltitude(t),a=e.spatialReference,s=e.state.camera.eye,p=[],g=o.planes[u.PlaneIndex.FAR];for(let e=0;e<4;e++){const t=o.lines[e];r.intersectInfiniteManifold(m.wrap(t.origin,t.direction),c,C)||U(C,o,r,t.endpoint,c),T.clampLineSegmentToPlane(C,s,C,g),p.push(n.fromValues(C[0],C[1]))}return function(e,t,o){const r=e.map((e=>(i.set(C,e[0],e[1],0),t.fromRenderCoords(C,C,o),[C[0],C[1]])));return r.length<=2?new l({spatialReference:o}):(r.push(r[0].slice()),d.isClockwise(r)||r.reverse(),new l({rings:[r],spatialReference:o}))}(f.clipPolygonToExtent(p,r.extent),r,a)}function U(e,t,o,r,n){const c=t.lines[g.LineIndex.FAR_LEFT].direction,a=(n-o.getAltitude(r))/c[2];i.scaleAndAdd(e,r,c,a)}const C=c.create(),F=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:j,eyeForCenterWithHeadingTilt:P,eyeTiltToLookAtTilt:b,headingTiltToDirectionUp:h,lookAtTiltToEyeTilt:E,toArea:w,toExtent:v},Symbol.toStringTag,{value:"Module"}));e.cameraUtilsPlanar=F,e.directionToHeadingTilt=j,e.eyeForCenterWithHeadingTilt=P,e.eyeTiltToLookAtTilt=b,e.headingTiltToDirectionUp=h,e.lookAtTiltToEyeTilt=E,e.toArea=w,e.toExtent=v}));