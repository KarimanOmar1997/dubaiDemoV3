// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../kernel","../core/urlUtils","../portal/support/urlUtils"],(function(e,t,r,o){"use strict";function n(e,t){const o=t?.url?.path;if(e&&o&&(e=r.makeAbsolute(e,o,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const o=r.makeRelative(e,t.portalItem.itemUrl);null!=o&&c.test(o)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(o).path)}return(e=f(e,t?.portal))&&i.test(e)?h(e):e}function l(t,o,n=e.MarkKeep.YES){if(null==(t=t&&i.test(t)?d(t):t))return t;!r.isAbsolute(t)&&o?.blockedRelativeUrls&&o.blockedRelativeUrls.push(t);let l=r.makeAbsolute(t);if(o){const e=o.verifyItemRelativeUrls?.rootPath||o.url?.path;if(e){const n=f(e,o.portal),s=f(l,o.portal);l=r.makeRelative(s,n,n),null!=l&&l!==s&&l!==t&&o.verifyItemRelativeUrls&&o.verifyItemRelativeUrls.writtenUrls.push(l)}}return l=p(l,o?.portal),r.isAbsolute(l)&&(l=r.normalize(l)),o?.resources&&o?.portalItem&&!r.isAbsolute(l)&&!r.isDataProtocol(l)&&n===e.MarkKeep.YES&&o.resources.toKeep.push({resource:o.portalItem.resourceFromPath(l),compress:!1}),l}function s(e,t,r){return n(e,r)}function a(e,t,r,o){const n=l(e,o);void 0!==n&&(t[r]=n)}const i=/\/items\/([^/]+)\/resources\/(.*)/,c=/^\.\/resources\//;function u(e){const t=e?.match(i)??null;return t?.[1]??null}function m(e){const t=e?.match(i)??null;if(null==t)return null;const o=t[2],n=o.lastIndexOf("/");if(-1===n){const{path:e,extension:t}=r.splitPathExtension(o);return{prefix:null,filename:e,extension:t}}const{path:l,extension:s}=r.splitPathExtension(o.slice(n+1));return{prefix:o.slice(0,n),filename:l,extension:s}}function p(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?r.changeDomain(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function f(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const o=`${t.urlKey}.${t.customBaseUrl}`,n=r.getAppUrl();return r.hasSameOrigin(n,`${n.scheme}://${o}`)?r.changeDomain(e,t.portalHostname,o):r.changeDomain(e,o,t.portalHostname)}function h(e){if(!e)return e||null;let r=e;return r&&t.id&&!t.id.findCredential(r)&&(r=o.normalizeArcGISOnlineOrgDomain(r),r=r.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),r=r.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),r=r.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),r}function d(e){if(!e)return e||null;let r=e;return r=r.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),r=r.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),r=r.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),r&&t.id&&!t.id.findCredential(r)&&(r=o.normalizeArcGISOnlineOrgDomain(r)),r}var U;e.MarkKeep=void 0,(U=e.MarkKeep||(e.MarkKeep={}))[U.YES=0]="YES",U[U.NO=1]="NO";const g=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return e.MarkKeep},ensureMainOnlineDomain:p,fromCDNUrl:d,fromJSON:n,itemIdFromResourceUrl:u,prefixAndFilenameFromResourceUrl:m,read:s,toCDNUrl:h,toJSON:l,write:a},Symbol.toStringTag,{value:"Module"}));e.ensureMainOnlineDomain=p,e.fromCDNUrl=d,e.fromJSON=n,e.itemIdFromResourceUrl=u,e.persistableUrlUtils=g,e.prefixAndFilenameFromResourceUrl=m,e.read=s,e.toCDNUrl=h,e.toJSON=l,e.write=a}));