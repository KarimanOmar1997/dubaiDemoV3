// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../core/has","../core/Logger","../core/mathUtils","../core/libs/gl-matrix-2/math/mat4","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","./vec42","../core/libs/gl-matrix-2/factories/vec4f64","../core/libs/gl-matrix-2/math/common","../geometry/support/Axis","../geometry/support/ray","../geometry/support/sphereUtils","../geometry/support/vector","../geometry/support/vectorStacks"],(function(t,e,n,r,o,s,c,i,a,u,l,f,g,d,h){"use strict";const m=p();function p(){return a.create()}const M=i.equals,y=i.equals;function v(t,e){return i.copy(e,t)}function x(t,e){return a.fromValues(t[0],t[1],t[2],e)}function A(t){return t}function S(t){t[0]=t[1]=t[2]=t[3]=0}function b(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function R(t){return t[3]}function q(t){return t}function P(t,e,n,r){return a.fromValues(t,e,n,r)}function C(t,e,n){return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2]),n[3]=t[3]+e,n}function E(t,e,n){return t!==n&&v(t,n),n}function T(t,e){return e}function j(t,e,n){if(null==e)return!1;if(!V(t,e,O))return!1;let{t0:r,t1:o}=O;if((r<0||o<r&&o>0)&&(r=o),r<0)return!1;if(n){const{origin:t,direction:o}=e;n[0]=t[0]+o[0]*r,n[1]=t[1]+o[1]*r,n[2]=t[2]+o[2]*r}return!0}function L(t,e,n){const r=f.fromPoints(e,n);if(!V(t,r,O))return[];const{origin:o,direction:i}=r,{t0:a,t1:l}=O,g=e=>{const n=c.create();return s.scaleAndAdd(n,o,i,e),Z(t,n,n)};return Math.abs(a-l)<u.getEpsilon()?[g(a)]:[g(a),g(l)]}const O={t0:0,t1:0};function V(t,e,n){const{origin:r,direction:o}=e,s=_;s[0]=r[0]-t[0],s[1]=r[1]-t[1],s[2]=r[2]-t[2];const c=o[0]*o[0]+o[1]*o[1]+o[2]*o[2];if(0===c)return!1;const i=2*(o[0]*s[0]+o[1]*s[1]+o[2]*s[2]),a=i*i-4*c*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(a<0)return!1;const u=Math.sqrt(a);return n.t0=(-i-u)/(2*c),n.t1=(-i+u)/(2*c),!0}const _=c.create();function w(t,e){return j(t,e,null)}function z(t,e,n){if(j(t,e,n))return n;const r=F(t,e,h.sv3d.get());return s.add(n,e.origin,s.scale(h.sv3d.get(),e.direction,s.distance(e.origin,r)/s.length(e.direction))),n}function F(t,e,n){const r=h.sv3d.get(),c=h.sm4d.get();s.cross(r,e.origin,e.direction);const i=R(t);s.cross(n,r,e.origin),s.scale(n,n,1/s.length(n)*i);const a=D(t,e.origin),u=d.angle(e.origin,n);return o.fromRotation(c,u+a,r),s.transformMat4(n,n,c),n}function N(t,e,n,r){const o=R(t),s=o*o,c=e+.5*Math.PI,i=n*n+s-2*Math.cos(c)*n*o,a=Math.sqrt(i),u=i-s;if(u<=0)return.5;const l=Math.sqrt(u),f=Math.acos(l/a)-Math.asin(o/(a/Math.sin(c)));return Math.min(1,(f+.5*r)/r)}function U(t,e,n){return j(t,e,n)?n:(f.closestPoint(e,t,n),Z(t,n,n))}function Z(t,e,n){const r=s.subtract(h.sv3d.get(),e,t),o=s.scale(h.sv3d.get(),r,t[3]/s.length(r));return s.add(n,o,t)}function k(t,e){const n=s.subtract(h.sv3d.get(),e,t),r=s.squaredLength(n),o=t[3]*t[3];return Math.sqrt(Math.abs(r-o))}function D(t,e){const n=s.subtract(h.sv3d.get(),e,t),o=s.length(n),c=R(t),i=c+Math.abs(c-o);return r.acosClamped(c/i)}const I=c.create();function X(t,e,n,r){const o=s.subtract(I,e,t);switch(n){case l.Axis.X:{const t=g.cartesianToSpherical(o,I)[2];return s.set(r,-Math.sin(t),Math.cos(t),0)}case l.Axis.Y:{const t=g.cartesianToSpherical(o,I),e=t[1],n=t[2],c=Math.sin(e);return s.set(r,-c*Math.cos(n),-c*Math.sin(n),Math.cos(e))}case l.Axis.Z:return s.normalize(r,o);default:return}}function Y(t,e){const n=s.subtract(J,e,t);return s.length(n)-t[3]}function B(t,e,n,r){const o=Y(t,e),c=X(t,e,l.Axis.Z,J),i=s.scale(J,c,n-o);return s.add(r,e,i)}function G(t,e){const n=s.squaredDistance(t,e),r=R(t);return n<=r*r}function H(t,e,n=a.create()){const r=s.distance(t,e),o=t[3],c=e[3];return r+c<o?(i.copy(n,t),n):r+o<c?(i.copy(n,e),n):(s.lerp(n,t,e,(r+c-o)/(2*r)),n[3]=(r+o+c)/2,n)}const J=c.create(),K=p(),Q=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:m,altitudeAt:Y,angleToSilhouette:D,axisAt:X,cameraFrustumCoverage:N,clear:S,closestPoint:U,closestPointOnSilhouette:F,containsPoint:G,copy:v,create:p,distanceToSilhouette:k,elevate:C,equals:y,exactEquals:M,fromCenterAndRadius:x,fromRadius:b,fromValues:P,getCenter:q,getExtent:T,getRadius:R,intersectLine:L,intersectRay:j,intersectRayClosestSilhouette:z,intersectsRay:w,projectPoint:Z,setAltitudeAt:B,setExtent:E,tmpSphere:K,union:H,wrap:A},Symbol.toStringTag,{value:"Module"}));t.NullSphere=m,t.altitudeAt=Y,t.angleToSilhouette=D,t.axisAt=X,t.cameraFrustumCoverage=N,t.clear=S,t.closestPoint=U,t.closestPointOnSilhouette=F,t.containsPoint=G,t.copy=v,t.create=p,t.distanceToSilhouette=k,t.elevate=C,t.equals=y,t.exactEquals=M,t.fromCenterAndRadius=x,t.fromRadius=b,t.fromValues=P,t.getCenter=q,t.getExtent=T,t.getRadius=R,t.intersectLine=L,t.intersectRay=j,t.intersectRayClosestSilhouette=z,t.intersectsRay=w,t.projectPoint=Z,t.setAltitudeAt=B,t.setExtent=E,t.sphere=Q,t.tmpSphere=K,t.union=H,t.wrap=A}));