// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../has","../Logger","./utils","./tracking/Flags","./tracking/TrackingTarget"],(function(t,n,e,r,c,i){"use strict";const a=new i.TrackingTarget,s=[];let l=a;function o(t){l.onAccessed(t)}let g=!1,u=!1;function f(t,n,e){if(g)return p(t,n,e);let r=null;return k(t),r=n.call(e),d(),r}function p(t,n,r){const c=g;g=!0,k(t);let i=null;try{i=n.call(r)}catch(t){u&&e.getLogger("esri.core.accessorSupport.tracking").error(t)}return d(),g=c,i}function k(t){l=t,s.push(t)}function d(){const t=s.length;if(t>1){const n=s.pop();l=s[t-2],n.onTrackingEnd()}else if(1===t){const t=s.pop();l=a,t.onTrackingEnd()}else l=a}function T(t,n){if(n.flags&c.Flags.DepTrackingInitialized)return;n.flags|=c.Flags.DepTrackingInitialized;const e=u;u=!1,n.flags&c.Flags.AutoTracked?p(n.trackingTarget,n.metadata.get,t):h(t,n),u=e}const y=[];function h(t,n){n.flags&c.Flags.ExplicitlyTracking||(n.flags|=c.Flags.ExplicitlyTracking,p(n.trackingTarget,(()=>{const e=n.metadata.dependsOn||y;for(const n of e)if("string"!=typeof n||n.includes(".")){const e=r.pathToArray(n);for(let n=0,r=t;n<e.length&&null!=r&&"object"==typeof r;++n)r=A(r,e[n],n!==e.length-1)}else A(t,n,!1)})),n.flags&=~c.Flags.ExplicitlyTracking)}function A(t,n,e){const c="?"===n[n.length-1]?n.slice(0,-1):n;if(null!=t.getItemAt||Array.isArray(t)){const n=parseInt(c,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const i=r.getProperties(t);if(i){const n=i.propertiesByName.get(c);n&&(o(n),T(t,n))}return e?t[c]:void 0}t.initializeDependencyTracking=T,t.runTracked=f,t.runTrackedNoThrow=p,t.runUntracked=function(t,n){return f(a,t,n)},t.trackAccess=o,t.trackExplicitDependencies=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));