// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../arrayUtils","../Error","../Logger","./get","./PropertyOrigin","./utils","./extensions/serializableProperty"],(function(e,r,i,t,n,o,s,l){"use strict";function a(e,r,i,t,n){const o={};return r.write?.writer?.call(e,t,o,i,n),o}function u(e,s,l,a,u,p){if(!a?.write)return!1;const g=n.get(e,l);if(!u&&a.write.overridePolicy){const r=a.write.overridePolicy.call(e,g,l,p??void 0);void 0!==r&&(u=r)}if(u||(u=a.write),!u||!1===u.enabled)return!1;if(u.layerContainerTypes&&p?.layerContainerType&&!u.layerContainerTypes.includes(p.layerContainerType))return!1;if((null===g&&!u.allowNull&&!u.writerEnsuresNonNull||void 0===g)&&u.isRequired){const r=new i("web-document-write:property-required",`Missing value for required property '${l}' on '${e.declaredClass}'`,{propertyName:l,target:e});return r&&p?.messages?p.messages.push(r):r&&!p&&t.getLogger("esri.core.accessorSupport.write").error(r.name,r.message),!1}return!(void 0===g||null===g&&!u.allowNull&&!u.writerEnsuresNonNull||!(u.alwaysWriteDefaults||s.store.multipleOriginsSupported&&s.store.originOf(l)!==o.OriginId.DEFAULTS)&&function(e,i,t,n,o){const s=n.default;if(void 0===s)return!1;if(null!=n.defaultEquals)return n.defaultEquals(o);if("function"==typeof s){if(Array.isArray(o)){const n=s.call(e,i,t??void 0);return r.equals(n,o)}return!1}return s===o}(e,l,p,a,g)||!u.ignoreOrigin&&p?.origin&&s.store.multipleOriginsSupported&&s.store.originOf(l)<o.nameToId(p.origin))}e.willPropertyWrite=function(e,r,i,t){const n=s.getProperties(e),o=n.metadata,a=l.originSpecificWritePropertyDefinition(o[r],t);return!!a&&u(e,n,r,a,i,t)},e.write=function(e,r,i){if(e&&"function"==typeof e.toJSON&&(!e.toJSON.isDefaultToJSON||!e.write))return s.merge(r,e.toJSON(i));const t=s.getProperties(e),p=t.metadata;for(const g in p){const c=l.originSpecificWritePropertyDefinition(p[g],i);if(!u(e,t,g,c,void 0,i))continue;const f=n.get(e,g),d=a(e,c,c.write&&"string"==typeof c.write.target?c.write.target:g,f,i);Object.keys(d).length>0&&(r=s.merge(r,d),i?.resources?.pendingOperations?.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then((()=>s.merge(r,d,(()=>"replace-arrays"))))),i?.writtenProperties&&i.writtenProperties.push({target:e,propName:g,oldOrigin:o.idToReadableName(t.store.originOf(g)),newOrigin:i.origin}))}return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));