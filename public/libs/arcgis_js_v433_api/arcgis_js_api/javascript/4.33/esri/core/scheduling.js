// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","./nextTick","./PerformanceSampler","./PooledArray","./promiseUtils","./time"],(function(e,t,n,s,r,i){"use strict";class o{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}}class a{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}}let c=0,l=0;const m={time:i.Milliseconds(0),deltaTime:i.Milliseconds(0),elapsedFrameTime:i.Milliseconds(0),frameDuration:i.Milliseconds(0)},u=["prepare","preRender","render","postRender","update","finish"],d=[],p=new s;class f{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1,h()}}function h(){null==v&&(c=performance.now(),v=requestAnimationFrame(A))}const w={frameTasks:p,willDispatch:!1,clearFrameTasks:function(e=!1){p.forAll((e=>{e.removed=!0})),e&&M()},dispatch:b,executeFrameTasks:function(e){const t=i.Milliseconds(e-c);c=e;const n=l>0?l:1e3/60,s=Math.max(0,t-n);m.time=e,m.frameDuration=i.Milliseconds(n-s);for(let n=0;n<u.length;n++){const s=performance.now(),r=u[n];p.forAll((s=>{s.paused||s.removed||(0===n&&s.ticks++,s.phases[r]&&(m.elapsedFrameTime=i.Milliseconds(performance.now()-e),m.deltaTime=0===s.ticks?i.Milliseconds(0):t,s.phases[r]?.call(s,m)))})),g[n].push(performance.now()-s)}M(),R.push(performance.now()-e)},reschedule:function(){null!=v&&(cancelAnimationFrame(v),v=requestAnimationFrame(A))}};function k(e){const n=new a(e);return d.push(n),w.willDispatch||(w.willDispatch=!0,t.nextTick(b)),n}function T(e){const t=new o(e);return p.push(t),h(),new f(t)}let v=null;function A(){const e=performance.now();v=null;const t=p.some((e=>!e.paused&&!e.removed));v=t?requestAnimationFrame(A):null,w.executeFrameTasks(e)}const F=new s;function M(){p.forAll((e=>{e.removed&&F.push(e)})),p.removeUnorderedMany(F.data,F.length),F.clear()}function b(){for(;d.length;){const e=d.shift();e.isActive&&e.callback()}w.willDispatch=!1}function x(e=1,n){const s=r.createResolver(),i=()=>{r.isAborted(n)?s.reject(r.createAbortError()):0===e?s():(--e,t.nextTick((()=>i())))};return i(),s.promise}function D(e){return x(1,e)}const g=u.map((e=>new n(e))),R=new n("total");e.FrameTaskHandle=f,e.addFrameTask=T,e.debug=w,e.performanceInfo=g,e.performanceTotal=R,e.schedule=k,e.setFrameDuration=function(e){l=Math.max(0,e)},e.waitAnimationFrame=async function(e){await D(e),await new Promise((t=>requestAnimationFrame((()=>{e?.aborted||t()}))))},e.waitRender=function(){const e=r.createResolver(),t=T({postRender:()=>{t.remove(),k(e)}});return e.promise},e.waitTick=D,e.waitTicks=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));