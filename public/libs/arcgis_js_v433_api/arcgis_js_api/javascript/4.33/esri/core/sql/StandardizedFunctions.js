// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../mathUtils","../string","./DateOnly","./errorSupport","./sqlCompareUtils","./sqlDateParsingUtils","./TimeOnly","../../support/guards","../../chunks/datetime"],(function(e,a,r,n,t,l,s,u,o,i){"use strict";function m(e){return!(o.isDate(e)||s.isDateOnly(e)||s.isDateTime(e)||s.isTimeOnly(e)||s.isTimestampOffset(e))}function c(e){return s.isDateOnly(e)||s.isTimeOnly(e)?e.toString():s.isTimestampOffset(e)?e.toSQLValue():s.isDateTime(e)?0===e.millisecond?e.toFormat("yyyy-LL-dd HH:mm:ss"):e.toSQL({includeOffset:!1}):o.isDate(e)?c(i.DateTime.fromJSDate(e)):e.toString()}const f={extract:{minParams:2,maxParams:2,evaluate:([e,a])=>{if(null==a)return null;if(o.isDate(a))switch(e.toUpperCase()){case"SECOND":return a.getSeconds();case"MINUTE":return a.getMinutes();case"HOUR":return a.getHours();case"DAY":return a.getDate();case"MONTH":return a.getMonth()+1;case"YEAR":return a.getFullYear();case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":return 0;case"DOW":return i.DateTime.fromJSDate(a,{zone:"system"}).weekday;case"DOY":return i.DateTime.fromJSDate(a,{zone:"system"}).ordinal;case"WEEK":return i.DateTime.fromJSDate(a,{zone:"system"}).weekNumber}else if(s.isDateTime(a))switch(e.toUpperCase()){case"SECOND":return a.second;case"MINUTE":return a.minute;case"HOUR":return a.hour;case"DAY":return a.day;case"MONTH":return a.month;case"YEAR":return a.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new t.SqlError(t.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"});case"DOW":return a.weekday;case"DOY":return a.ordinal;case"WEEK":return a.weekNumber}else if(s.isDateOnly(a))switch(e.toUpperCase()){case"DAY":return a.day;case"MONTH":return a.month;case"YEAR":return a.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new t.SqlError(t.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"});case"DOW":return a.toDateTime("unknown").weekday;case"DOY":return a.toDateTime("unknown").ordinal;case"WEEK":return a.toDateTime("unknown").weekNumber}else if(s.isTimeOnly(a))switch(e.toUpperCase()){case"SECOND":return a.second;case"MINUTE":return a.minute;case"HOUR":return a.hour}else if(s.isTimestampOffset(a))switch(e.toUpperCase()){case"SECOND":return a.second;case"MINUTE":return a.minute;case"HOUR":return a.hour;case"DAY":return a.day;case"MONTH":return a.month;case"YEAR":return a.year;case"TIMEZONE_HOUR":return a.timezoneOffsetHour;case"TIMEZONE_MINUTE":return a.timezoneOffsetMinutes;case"DOW":return a.toDateTime().weekday;case"DOY":return a.toDateTime().ordinal;case"WEEK":return a.toDateTime().weekNumber}throw new t.SqlError(t.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"})}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(2===e.length){const[a,r]=e;return null==a||null==r?null:a.toString().substring(r-1)}if(3===e.length){const[a,r,n]=e;return null==a||null==r||null==n?null:n<=0?"":a.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,a])=>null==e||null==a?null:a.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{const a=3===e.length,n=a?e[1]:" ",l=a?e[2]:e[1];if(null==n||null==l)return null;const s=`(${r.escapeRegExpString(n)})`;switch(e[0]){case"BOTH":return l.replaceAll(new RegExp(`^${s}*|${s}*$`,"g"),"");case"LEADING":return l.replaceAll(new RegExp(`^${s}*`,"g"),"");case"TRAILING":return l.replaceAll(new RegExp(`${s}*$`,"g"),"")}throw new t.SqlError(t.SqlErrorCodes.InvalidFunctionParameters,{function:"TRIM"})}},abs:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0]>0?1:e[0]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]**e[1]},mod:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{const a=e[0],r=2===e.length?10**e[1]:1;return null==a?null:Math.round(a*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:e=>null==e[0]?null:1===e.length||0===e[1]?Math.trunc(e[0]):a.decimalAdjust("trunc",e[0],-Number(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>o.isString(e[0])?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{let a="";for(let r=0;r<e.length;r++){if(null==e[r])return null;a+=e[r].toString()}return a}},lower:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:e=>{for(const a of e)if(null!==a)return a;return null}},cosh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cosh(e[0])},sinh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sinh(e[0])},tanh:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tanh(e[0])},nullif:{minParams:2,maxParams:2,evaluate:e=>l.sqlCompare(e[0],e[1],"=")?null:e[0]},cast:{minParams:2,maxParams:2,evaluate:(e,a)=>{const r=e[0],l=e[1];if(null===r)return null;switch(l.type){case"integer":{if(!m(r))throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);const e=parseInt(r,10);if(isNaN(e))throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);return e}case"smallint":{if(!m(r))throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);const e=parseInt(r,10);if(isNaN(e))throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);if(e>32767||e<-32767)throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);return e}case"float":case"real":{if(!m(r))throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);const e=parseFloat(r);if(isNaN(e))throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);return e}case"time":return function(e){if(o.isDate(e))return u.TimeOnly.fromDateJS(e);if(s.isDateTime(e))return u.TimeOnly.fromDateTime(e);if(s.isDateOnly(e))throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);if(s.isTimeOnly(e))return e;if(s.isTimestampOffset(e))return u.TimeOnly.fromSqlTimeStampOffset(e);if(o.isString(e))return s.parseTime(e);throw new t.SqlError(t.SqlErrorCodes.CannotCastValue)}(r);case"date":return function(e){if(o.isDate(e))return n.DateOnly.fromDateJS(e);if(s.isDateTime(e))return n.DateOnly.fromParts(e.year,e.month,e.day);if(s.isDateOnly(e))return e;if(s.isTimeOnly(e))throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);if(s.isTimestampOffset(e)&&null===n.DateOnly.fromParts(e.year,e.month,e.day))throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);if(o.isString(e)){const a=n.DateOnly.fromReader(e);if(null!==a&&a.isValid)return a}throw new t.SqlError(t.SqlErrorCodes.CannotCastValue)}(r);case"timestamp":return function(e,a,r){if(o.isDate(e))return s.convertToExecutingTimeZone(e,a);if(s.isDateTime(e))return e;if(s.isDateOnly(e))return e.toDateTimeLuxon("unknown");if(s.isTimeOnly(e))throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);if(s.isTimestampOffset(e))return e;if(o.isString(e))return s.parseTimestamp(e,"unknown",r);throw new t.SqlError(t.SqlErrorCodes.CannotCastValue)}(r,a,!0===l.withtimezone);case"varchar":{const e=c(r);if(e.length>l.size)throw new t.SqlError(t.SqlErrorCodes.CannotCastValue);return e}default:throw new t.SqlError(t.SqlErrorCodes.InvalidDataType)}}}};e.evaluateFunction=function(e,a,r){const n=f[e.toLowerCase()];if(null==n)throw new t.SqlError(t.SqlErrorCodes.FunctionNotRecognized);if(a.length<n.minParams||a.length>n.maxParams)throw new t.SqlError(t.SqlErrorCodes.InvalidParameterCount,{name:e.toUpperCase()});return n.evaluate(a,r)},e.isStandardized=function(e,a){const r=f[e.toLowerCase()];return null!=r&&a>=r.minParams&&a<=r.maxParams},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));