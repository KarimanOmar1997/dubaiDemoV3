// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../has","../promiseUtils"],(function(e,r,t){"use strict";const s="worker:port-closed";var n;e.MessageType=void 0,(n=e.MessageType||(e.MessageType={}))[n.HANDSHAKE=0]="HANDSHAKE",n[n.OPEN=1]="OPEN",n[n.OPENED=2]="OPENED",n[n.RESPONSE=3]="RESPONSE",n[n.INVOKE=4]="INVOKE",n[n.ABORT=5]="ABORT",n[n.CLOSE=6]="CLOSE",n[n.OPEN_PORT=7]="OPEN_PORT",n[n.ON=8]="ON";let o=0;function a(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}function i(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function f(e){if(!e?.length)return null;if(r("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>{return!((r=e)instanceof ArrayBuffer||"ArrayBuffer"===r?.constructor?.name);var r}));return t.length?t:null}e.ignoreConnectionErrors=async function(e){try{return await e}catch(e){const r=e?.name===s;if(!t.isAbortError(e)&&!r)throw e;return}},e.isTransferrableResult=a,e.newJobId=function(){return o++},e.portClosedErrorName=s,e.postMessage=function t(s,n,o,u){if(n.type===e.MessageType.OPEN_PORT)return void s.postMessage(n,[n.port]);if(n.type!==e.MessageType.INVOKE&&n.type!==e.MessageType.RESPONSE)return void s.postMessage(n);let c;if(a(o)?(c=f(o.transferList),n.data=o.result):(c=f(u),n.data=o),c){if(r("ff"))for(const r of c)if("byteLength"in r&&r.byteLength>267386880){const r="Worker call with large ArrayBuffer would crash Firefox";switch(n.type){case e.MessageType.INVOKE:throw r;case e.MessageType.RESPONSE:return void t(s,{type:e.MessageType.RESPONSE,jobId:n.jobId,error:i(r)})}}s.postMessage(n,c)}else s.postMessage(n)},e.receiveMessage=function(e){if(!e)return null;const r=e.data;return r?"string"==typeof r?JSON.parse(r):r:null},e.toInvokeError=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));