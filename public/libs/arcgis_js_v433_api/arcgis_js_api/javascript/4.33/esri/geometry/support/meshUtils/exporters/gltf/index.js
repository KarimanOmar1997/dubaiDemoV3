// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/promiseUtils","./glb","./gltf","./types","./imageutils","./asset","./scene","./node"],(function(e,t,r,u,o,a,n,f,p){"use strict";const s="model.gltf",i="model.glb";async function l(e,n){const f=new u.GLTF(e,n).gltf,p=f.extras.promises;let l=1,c=1,y=null;await Promise.allSettled(p),t.throwIfAborted(n.signal);const d=n.jsonSpacing??4,g=new Map,m=JSON.stringify(f,((e,t)=>{if("extras"!==e){if(t instanceof ArrayBuffer){if(a.isArrayBufferPNG(t))switch(n.output?.image){case o.ImageOutputType.DataURI:case o.ImageOutputType.GLB:break;case o.ImageOutputType.External:default:{const e=`img${c}.png`;return c++,g.set(e,t),e}}switch(n.output?.buffer){case o.BufferOutputType.DataURI:return a.encodeBase64DataUri(t);case o.BufferOutputType.GLB:if(y)throw new Error("Already encountered an ArrayBuffer, there should only be one in the GLB format.");return void(y=t);case o.BufferOutputType.External:default:{const e=`data${l}.bin`;return l++,g.set(e,t),e}}}return t}}),d);return n.output?.buffer===o.BufferOutputType.GLB||n.output?.image===o.ImageOutputType.GLB?g.set(i,new r.GLB(m,y).buffer):g.set(s,m),g}Object.defineProperty(e,"AlphaMode",{enumerable:!0,get:()=>o.AlphaMode}),Object.defineProperty(e,"AttributeType",{enumerable:!0,get:()=>o.AttributeType}),Object.defineProperty(e,"BufferOutputType",{enumerable:!0,get:()=>o.BufferOutputType}),Object.defineProperty(e,"ColorMode",{enumerable:!0,get:()=>o.ColorMode}),Object.defineProperty(e,"ImageOutputType",{enumerable:!0,get:()=>o.ImageOutputType}),Object.defineProperty(e,"MeshMode",{enumerable:!0,get:()=>o.MeshMode}),e.Asset=n.Asset,e.Scene=f.Scene,e.Node=p.Node,e.exportGLB=async function(e,t){const r=(await l(e,{output:{buffer:o.BufferOutputType.GLB,image:o.ImageOutputType.GLB},jsonSpacing:0,...t})).get(i);if(!(r&&r instanceof ArrayBuffer))throw new Error("failed to export to glb");return r},e.exportGLTF=l,e.modelNameGlb=i,e.modelNameGltf=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));