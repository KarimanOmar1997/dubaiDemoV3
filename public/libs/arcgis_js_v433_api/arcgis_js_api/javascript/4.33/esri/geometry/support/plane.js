// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../chunks/vec42","./vector","./vectorStacks","../../views/3d/support/mathUtils"],(function(t,e,n,r,c,s,o,i){"use strict";function u(t=h){return[t[0],t[1],t[2],t[3]]}const I=c.exactEquals,a=c.equals;function l(t,e){return f(e[0],e[1],e[2],e[3],t)}function f(t,e,n,r,c=u()){return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c}function N(t,e,n){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],c=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return n[0]=e[0]*c,n[1]=e[1]*c,n[2]=e[2]*c,n[3]=-(n[0]*t[0]+n[1]*t[1]+n[2]*t[2]),n}function E(t,e,n,r=u()){const c=n[0]-e[0],s=n[1]-e[1],o=n[2]-e[2],i=t[0]-e[0],I=t[1]-e[1],a=t[2]-e[2],l=s*a-o*I,f=o*i-c*a,N=c*I-s*i,E=l*l+f*f+N*N,g=Math.abs(E-1)>1e-5&&E>1e-12?1/Math.sqrt(E):1;return r[0]=l*g,r[1]=f*g,r[2]=N*g,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function g(t,e,r,c=0,s=Math.floor(r*(1/3)),o=Math.floor(r*(2/3))){if(r<3)return!1;e(d,c);let i=s,u=!1;for(;i<r-1&&!u;)e(T,i),i++,u=!n.exactEquals(d,T);if(!u)return!1;for(i=Math.max(i,o),u=!1;i<r&&!u;)e(_,i),i++,n.subtract(M,d,T),n.normalize(M,M),n.subtract(m,T,_),n.normalize(m,m),u=!n.exactEquals(d,_)&&!n.exactEquals(T,_)&&Math.abs(n.dot(M,m))<S;return u?(E(d,T,_,t),!0):(0!==c||1!==s||2!==o)&&g(t,e,r,0,1,2)}const S=.99619469809,d=r.create(),T=r.create(),_=r.create(),M=r.create(),m=r.create();function v(t,e,r){const c=n.scale(o.sv3d.get(),t,n.dot(t,e));return n.subtract(r,e,c),r}function F(t,e){return n.dot(t,e)+t[3]}var R;function O(e){return e===t.IntersectResult.INTERSECTS_INSIDE_OUT||e===t.IntersectResult.INTERSECTS_OUTSIDE_IN}function p(r,c,s,o,i){const u=n.dot(r,s),I=F(r,c);if(0===u)return I>=0?t.IntersectResult.INSIDE:t.IntersectResult.OUTSIDE;let a=-I/u;return o&t.IntersectFlags.CLAMP&&(a=e.clamp(a,0,1)),!(o&t.IntersectFlags.INFINITE_MIN)&&a<0||!(o&t.IntersectFlags.INFINITE_MAX)&&a>1?I>=0?t.IntersectResult.INSIDE:t.IntersectResult.OUTSIDE:(n.add(i,c,n.scale(i,s,a)),I>=0?t.IntersectResult.INTERSECTS_INSIDE_OUT:t.IntersectResult.INTERSECTS_OUTSIDE_IN)}t.IntersectResult=void 0,(R=t.IntersectResult||(t.IntersectResult={}))[R.INTERSECTS_INSIDE_OUT=0]="INTERSECTS_INSIDE_OUT",R[R.INTERSECTS_OUTSIDE_IN=1]="INTERSECTS_OUTSIDE_IN",R[R.INSIDE=2]="INSIDE",R[R.OUTSIDE=3]="OUTSIDE";const h=[0,0,1,0];var D;t.IntersectFlags=void 0,(D=t.IntersectFlags||(t.IntersectFlags={}))[D.NONE=0]="NONE",D[D.CLAMP=1]="CLAMP",D[D.INFINITE_MIN=4]="INFINITE_MIN",D[D.INFINITE_MAX=8]="INFINITE_MAX";const P=t.IntersectFlags.INFINITE_MIN|t.IntersectFlags.INFINITE_MAX,U=t.IntersectFlags.INFINITE_MAX;t.clip=function(t,e){const r=n.dot(t,e.ray.direction),c=-F(t,e.ray.origin);if(c<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return c>0;if((c<0||r<0)&&!(c<0&&r<0))return!0;const s=c/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1},t.clipInfinite=function(t,e){const r=n.dot(t,e.ray.direction),c=-F(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return c>0;const s=c/r;return r>0?s<e.c1&&(e.c1=s):s>e.c0&&(e.c0=s),e.c0<=e.c1},t.copy=l,t.create=u,t.distance=function(t,e){return Math.abs(F(t,e))},t.equals=a,t.exactEquals=I,t.fromArray=function(t,e,r=!0){const c=e.length/3;return g(t,((t,r)=>n.set(t,e[3*r+0],e[3*r+1],e[3*r+2])),r?c-1:c)},t.fromManyPoints=g,t.fromNormalAndOffset=function(t,e,r){return n.copy(r,t),r[3]=e,r},t.fromPoints=E,t.fromPositionAndNormal=N,t.fromValues=f,t.fromVectorsAndPoint=function(t,e,r,c){return n.cross(_,e,t),N(r,_,c)},t.getNormal=function(t){return t},t.intersectLine=function(t,e,r,c){return O(p(t,e,n.subtract(o.sv3d.get(),r,e),P,c))},t.intersectLineOrRay=p,t.intersectLineSegment=function(e,n,r){return O(p(e,n.origin,n.vector,t.IntersectFlags.NONE,r))},t.intersectLineSegmentClamp=function(e,n,r){return O(p(e,n.origin,n.vector,t.IntersectFlags.CLAMP,r))},t.intersectRay=function(t,e,n){return null!=e&&O(p(t,e.origin,e.direction,U,n))},t.isPointInside=function(t,e){return F(t,e)>=0},t.negate=function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.projectPoint=function(t,e,r){const c=n.scale(o.sv3d.get(),t,-t[3]),s=v(t,n.subtract(o.sv3d.get(),e,c),o.sv3d.get());return n.add(r,s,c),r},t.projectPointLocal=function(t,e,r,c){const u=t,I=o.sv3d.get(),a=o.sv3d.get();i.tangentFrame(u,I,a);const l=n.subtract(o.sv3d.get(),r,e),f=s.projectPointSignedLength(I,l),N=s.projectPointSignedLength(a,l),E=s.projectPointSignedLength(u,l);return n.set(c,f,N,E)},t.projectVector=v,t.setOffsetFromPoint=function(t,e,r){return e!==t&&l(t,e),t[3]=-n.dot(t,r),t},t.signedDistance=F,t.up=h,t.wrap=function(t=h[0],e=h[1],n=h[2],r=h[3]){return f(t,e,n,r,o.sv4d.get())},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));