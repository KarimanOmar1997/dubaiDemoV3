// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/earcut","./Axis","./coordsUtils","./DoubleArray","./Indices","./polygonUtils","./meshUtils/deduplicate"],(function(e,n,t,o,i,s,r,l){"use strict";function c(n,t,o,s){const r=n.length,l=new Array(r),c=new Array(r),h=new Array(r);let g=0;for(let e=0;e<r;++e)g+=n[e].length;let f=0,d=0,p=0;const A=i.newDoubleArray(3*g);let C=0;for(let i=r-1;i>=0;i--){const g=n[i],w=o===e.CounterClockwiseMode.CCW_IS_HOLE&&u(g,t,s);if(w&&1!==r)l[f++]=g;else{let e=g.length;for(let n=0;n<f;++n)e+=l[n].length;const n={index:C,pathLengths:new Array(f+1),count:e,holeIndices:new Array(f)};n.pathLengths[0]=g.length,g.length>0&&(h[p++]={index:C,count:g.length}),C=w?a(g,g.length-1,-1,A,C,g.length,t):a(g,0,1,A,C,g.length,t);for(let e=0;e<f;++e){const o=l[e];n.holeIndices[e]=C,n.pathLengths[e+1]=o.length,o.length>0&&(h[p++]={index:C,count:o.length}),C=a(o,0,1,A,C,o.length,t)}f=0,n.count>0&&(c[d++]=n)}}for(let e=0;e<f;++e){const n=l[e];n.length>0&&(h[p++]={index:C,count:n.length}),C=a(n,0,1,A,C,n.length,t)}return c.length=d,h.length=p,{position:A,polygons:c,outlines:h}}function a(e,n,t,o,i,s,r){i*=3;for(let l=0;l<s;++l){const s=e[n];o[i++]=s[0],o[i++]=s[1],o[i++]=r&&s[2]?s[2]:0,n+=t}return i/3}function u(e,n,i){if(!n)return!o.isClockwise(e);const s=e.length-1;switch(r.leastSignificantAxis(e,s,i)){case t.Axis.X:return!o.isClockwise(e,t.Axis.Y,t.Axis.Z);case t.Axis.Y:return!o.isClockwise(e,t.Axis.X,t.Axis.Z);case t.Axis.Z:return!o.isClockwise(e,t.Axis.X,t.Axis.Y)}}var h;e.CounterClockwiseMode=void 0,(h=e.CounterClockwiseMode||(e.CounterClockwiseMode={}))[h.NONE=0]="NONE",h[h.CCW_IS_HOLE=1]="CCW_IS_HOLE",e.isCounterClockwise=u,e.ringsToTriangulationInfo=c,e.triangulate=function(t){const o=c(t.rings,t.hasZ,e.CounterClockwiseMode.CCW_IS_HOLE,t.spatialReference),r=new Array;let a=0,u=0;for(const e of o.polygons){const t=e.count,l=e.index,c=i.doubleSubArray(o.position,3*l,3*t),h=e.holeIndices.map((e=>e-l)),g=s.compactMeshIndices(n.earcut(c,h,3));r.push({position:c,faces:g}),a+=c.length,u+=g.length}const h=function(e,n,t){if(1===e.length)return e[0];const o=i.newDoubleArray(n),r=new Array(t);let l=0,c=0,a=0;for(const n of e){for(let e=0;e<n.position.length;e++)o[l++]=n.position[e];for(const e of n.faces)r[c++]=e+a;a=l/3}return{position:o,faces:s.compactMeshIndices(r)}}(r,a,u),g=Array.isArray(h.position)?l.deduplicate(h.position,3,{originalIndices:h.faces}):l.deduplicate(h.position.buffer,6,{originalIndices:h.faces});return h.position=i.doubleArrayFrom(new Float64Array(g.buffer)),h.faces=g.indices,h},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));