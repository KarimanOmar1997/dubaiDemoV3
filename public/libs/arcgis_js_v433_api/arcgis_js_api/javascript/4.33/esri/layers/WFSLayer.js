// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/graphics/sources/WFSSource":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Error","../../../core/has","../../../core/Loadable","../../../core/Logger","../../../core/promiseUtils","../../../core/workers/workers","../../../core/accessorSupport/decorators/property","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/Extent","../../../geometry/support/typeUtils","./support/clientSideDefaults","../../ogc/wfsUtils","../../../rest/support/AttributeBinsFeatureSet","../../../rest/support/FeatureSet","../../../time/constants"],(function(e,t,r,o,i,n,a,s,l,p,u,c,d,y,f,m,g,h){"use strict";e.WFSSource=class extends i{constructor(){super(...arguments),this._connection=null,this._workerHandler=null,this.capabilities=y.createCapabilities(!1,!1),this.type="wfs",this.refresh=a.debounce((async()=>{await this.load();const e={customParameters:this.layer.customParameters,maxRecordCount:this.layer.maxRecordCount,maxTotalRecordCount:this.layer.maxTotalRecordCount,maxPageCount:this.layer.maxPageCount},{extent:t}=await this._workerHandler.refresh(e);return t&&(this.sourceJSON.extent=t),{dataChanged:!0,updates:{extent:this.sourceJSON.extent}}}))}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this._startWorker({signal:t})),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null,this._workerHandler=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,t={}){const r=await this.queryFeaturesJSON(e,t);return g.fromJSON(r)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._workerHandler.queryFeatures(e?e.toJSON():void 0,t)}async queryFeatureCount(e,t={}){return await this.load(t),this._workerHandler.queryFeatureCount(e?e.toJSON():void 0,t)}async queryObjectIds(e,t={}){return await this.load(t),this._workerHandler.queryObjectIds(e?e.toJSON():void 0,t)}async queryExtent(e,t={}){await this.load(t);const r=await this._workerHandler.queryExtent(e?e.toJSON():void 0,t);return{count:r.count,extent:c.fromJSON(r.extent)}}async querySnapping(e,t={}){return await this.load(t),this._workerHandler.querySnapping(e,t)}async queryAttributeBins(e,t={}){await this.load(t);const r=await this._workerHandler.queryAttributeBins(e?.toJSON(),t);return m.fromJSON(r)}async _createLoadOptions(e){const{url:t,customParameters:o,name:i,namespaceUri:n,fields:a,geometryType:s,maxRecordCount:l,maxPageCount:p,maxTotalRecordCount:u,swapXY:c}=this.layer,y="defaults"===this.layer.originOf("spatialReference")?void 0:this.layer.spatialReference;if(!t)throw new r("wfs-layer:missing-url","WFSLayer must be created with a url");this.wfsCapabilities||(this.wfsCapabilities=await f.getCapabilities(t,{customParameters:o,...e}));const m=["fields","geometryType","name","namespaceUri","swapXY"].some((e=>null==this.layer[e]))?await f.getWFSLayerInfo(this.wfsCapabilities,i,n,{spatialReference:y,customParameters:o,signal:e?.signal}):{...f.prepareWFSLayerFields(a??[]),geometryType:s,name:i,namespaceUri:n,spatialReference:y,swapXY:c},g=f.findFeatureType(this.wfsCapabilities.readFeatureTypes(),m.name,m.namespaceUri),h=d.featureGeometryTypeKebabDictionary.toJSON(m.geometryType),{operations:w}=this.wfsCapabilities,b=w.GetFeature.url,S=w.GetFeature.outputFormat;return{customParameters:o,featureType:g,fields:m.fields?.map((e=>e.toJSON()))??[],geometryField:m.geometryField,geometryType:h,getFeatureUrl:b,getFeatureOutputFormat:S,maxRecordCount:l,maxPageCount:p,maxTotalRecordCount:u,objectIdField:m.objectIdField,spatialReference:m.spatialReference?.toJSON(),swapXY:!!m.swapXY}}async _startWorker(e){const[t,r]=await a.eachAlways([this._createLoadOptions(e),s.open("WFSSourceWorker",{...e,strategy:o("feature-layers-workers")?"dedicated":"local",registryTarget:this})]),i=t.error||r.error||null,l=r.value||null;if(i)throw l&&l.close(),i;const p=t.value;this._connection=r.value,this._workerHandler=this._connection.createInvokeProxy();const u=await this._workerHandler.load(p,e);for(const e of u.warnings)n.getLogger(this.layer).warn("#load()",`${e.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:e});this.sourceJSON={dateFieldsTimeReference:{timeZoneIANA:h.utc},extent:u.extent,fields:p.fields,geometryType:p.geometryType,objectIdField:p.objectIdField,geometryField:p.geometryField,drawingInfo:y.createDrawingInfo(p.geometryType),name:p.featureType.title,wfsInfo:{name:p.featureType.name,featureUrl:p.getFeatureUrl,maxFeatures:p.maxRecordCount,swapXY:p.swapXY,supportedSpatialReferences:p.featureType.supportedSpatialReferences,version:"2.0.0",wfsNamespace:p.featureType.namespaceUri}}}},t.__decorate([l.property()],e.WFSSource.prototype,"capabilities",void 0),t.__decorate([l.property({constructOnly:!0})],e.WFSSource.prototype,"layer",void 0),t.__decorate([l.property()],e.WFSSource.prototype,"sourceJSON",void 0),t.__decorate([l.property()],e.WFSSource.prototype,"type",void 0),t.__decorate([l.property()],e.WFSSource.prototype,"wfsCapabilities",void 0),e.WFSSource=t.__decorate([u.subclass("esri.layers.graphics.sources.WFSSource")],e.WFSSource),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/ogc/wfsUtils":function(){define(["exports","../../request","../../core/Error","../../core/iteratorUtils","../../core/urlUtils","../../geometry/Extent","../../geometry/projectionUtils","../../geometry/SpatialReference","../../geometry/support/spatialReferenceUtils","../../geometry/support/typeUtils","../graphics/sources/geojson/geojson","./xmlUtils","../support/arcgisLayerUrl","../support/Field","../support/fieldUtils"],(function(e,t,r,o,i,n,a,s,l,p,u,c,d,y,f){"use strict";const m="xlink:href",g="2.0.0",h="__esri_wfs_id__",w="wfs-layer:feature-type-not-found",b="wfs-layer:unknown-geometry-type";function S(e){const t=k(e);!function(e){const t=e.firstElementChild?.getAttribute("version");if(t&&t!==g)throw new r("wfs-layer:unsupported-wfs-version",`Unsupported WFS version ${t}. Supported version: ${g}`)}(t),U(t);const i=t.firstElementChild,a=o.cache((s=i,c.iterateXML(s,{FeatureTypeList:{FeatureType:e=>{const t={typeName:"undefined:undefined",name:"",title:"",description:"",extent:null,namespacePrefix:"",namespaceUri:"",defaultSpatialReference:4326,supportedSpatialReferences:[]},r=new Set;return c.visitXML(e,{Name:e=>{const{name:r,prefix:o}=E(e.textContent);t.typeName=`${o}:${r}`,t.name=r,t.namespacePrefix=o,t.namespaceUri=e.lookupNamespaceURI(o)},Abstract:e=>{t.description=e.textContent},Title:e=>{t.title=e.textContent},WGS84BoundingBox:e=>{t.extent=n.fromJSON(function(e){let t,r,o,i;for(const n of e.children)switch(n.localName){case"LowerCorner":[t,r]=n.textContent.split(" ").map((e=>Number.parseFloat(e)));break;case"UpperCorner":[o,i]=n.textContent.split(" ").map((e=>Number.parseFloat(e)))}return{xmin:t,ymin:r,xmax:o,ymax:i,spatialReference:l.wgs84}}(e))},DefaultCRS:e=>{const o=x(e);o&&(t.defaultSpatialReference=o,r.add(o))},OtherCRS:e=>{const t=x(e);t&&r.add(t)}}),t.title||(t.title=t.name),r.add(4326),t.supportedSpatialReferences.push(...r),t}}})));var s;return{operations:_(i),get featureTypes(){return Array.from(a())},readFeatureTypes:a}}const F=["json","application/json; subtype=geojson; charset=utf-8","application/json; subtype=geojson","application/json","geojson","application/geo+json"];function T(e){for(const t of F){const r=e.findIndex((e=>e.toLowerCase()===t));if(r>=0)return e[r]}return null}function _(e){let t=!0;const o={GetCapabilities:{url:""},DescribeFeatureType:{url:""},GetFeature:{url:"",outputFormat:null,supportsPagination:!1}},i=[],n=[];if(c.visitXML(e,{OperationsMetadata:{Parameter:e=>{if("outputformat"===e.getAttribute("name")?.toLowerCase())return{AllowedValues:{Value:({textContent:e})=>{e&&i.push(e)}}}},Operation:e=>{switch(e.getAttribute("name")){case"GetCapabilities":return{DCP:{HTTP:{Get:e=>{o.GetCapabilities.url=e.getAttribute(m)}}}};case"DescribeFeatureType":return{DCP:{HTTP:{Get:e=>{o.DescribeFeatureType.url=e.getAttribute(m)}}}};case"GetFeature":return{DCP:{HTTP:{Get:e=>{o.GetFeature.url=e.getAttribute(m)}}},Parameter:e=>{if("outputformat"===e.getAttribute("name")?.toLowerCase())return{AllowedValues:{Value:({textContent:e})=>{e&&n.push(e)}}}}}}},Constraint:e=>{switch(e.getAttribute("name")){case"KVPEncoding":return{DefaultValue:e=>{t="true"===e.textContent.toLowerCase()}};case"ImplementsResultPaging":return{DefaultValue:e=>{o.GetFeature.supportsPagination="true"===e.textContent.toLowerCase()}}}}}}),o.GetFeature.outputFormat=T(n)??T(i),!t)throw new r("wfs-layer:kvp-encoding-not-supported","WFS service doesn't support key/value pair (KVP) encoding");if(null==o.GetFeature.outputFormat)throw new r("wfs-layer:geojson-not-supported","WFS service doesn't support GeoJSON output format");return o}function x(e){const t=parseInt(e.textContent?.match(/(?<wkid>\d+$)/i)?.groups?.wkid??"",10);if(!Number.isNaN(t))return t}function v(e,t,r){return o.find(e,(e=>r?e.name===t&&e.namespaceUri===r:e.typeName===t||e.name===t))}async function P(e,t,o,i={}){const n=e.readFeatureTypes(),p=t?v(n,t,o):n.next().value,{spatialReference:u=new s({wkid:p?.defaultSpatialReference})}=i;if(null==p)throw t?new r(w,`The type '${t}' could not be found in the service`):new r("wfs-layer:empty-service","The service is empty");let c=p.extent;if(c&&!l.equals(c.spatialReference,u))try{await a.initializeProjection(c.spatialReference,u,void 0,i),c=a.project(c,u)}catch{throw new r("wfs-layer:unsupported-spatial-reference","Projection not supported")}return{extent:c,spatialReference:u,featureType:p}}function R(e){const t=e.find((e=>"geometry"===e.type));let r=e.find((e=>"oid"===e.type));return e=e.filter((e=>"geometry"!==e.type)),r||(r=new y({name:h,type:"oid",alias:h}),e.unshift(r)),{geometryField:t?.name??null,objectIdField:r.name,fields:e}}async function C(e,r,o,i={}){let n,a=!1;const[s,l]=await Promise.all([N(e.operations.GetFeature.url,r,o,e.operations.GetFeature.outputFormat,{...i,count:1}),t(e.operations.GetFeature.url,{responseType:"text",query:j(r,o,void 0,{...i,count:1}),signal:i?.signal})]),c="FeatureCollection"===s.type&&s.features[0]?.geometry;if(c){let e;switch(n=p.featureGeometryTypeKebabDictionary.fromJSON(u.getGeometryType(c.type)),c.type){case"Point":e=c.coordinates;break;case"LineString":case"MultiPoint":e=c.coordinates[0];break;case"MultiLineString":case"Polygon":e=c.coordinates[0][0];break;case"MultiPolygon":e=c.coordinates[0][0][0]}const t=/<[^>]*pos[^>]*> *(-?\d+(?:\.\d+)?) (-?\d+(?:\.\d+)?)/.exec(l.data);if(t){const r=e[0].toFixed(3),o=e[1].toFixed(3),i=parseFloat(t[1]).toFixed(3);r===parseFloat(t[2]).toFixed(3)&&o===i&&(a=!0)}}return{geometryType:n,swapXY:a}}async function O(e,r,o){return L(r,(await t(e,{responseType:"text",query:{SERVICE:"WFS",REQUEST:"DescribeFeatureType",VERSION:g,TYPENAME:r,TYPENAMES:r,...o?.customParameters},signal:o?.signal})).data)}function L(e,t){const{name:i}=E(e),n=k(t);U(n);const a=o.find(c.iterateXML(n.firstElementChild,{element:e=>e}),(e=>e.getAttribute("name")===i));if(null!=a){const e=a.getAttribute("type"),t=e?o.find(c.iterateXML(n.firstElementChild,{complexType:e=>e}),(t=>t.getAttribute("name")===E(e).name)):o.find(c.iterateXML(a,{complexType:e=>e}),(()=>!0));if(t)return function(e){const t=[],o=[];let i;const n=c.iterateXML(e,{complexContent:{extension:{sequence:{element:e=>e}}}});for(const a of n){const n=a.getAttribute("name");if(!n)continue;let s,l;if(a.hasAttribute("type")?s=E(a.getAttribute("type")).name:c.visitXML(a,{simpleType:{restriction:e=>(s=E(e.getAttribute("base")).name,{maxLength:e=>{l=+e.getAttribute("value")}})}}),!s)continue;const p="true"===a.getAttribute("nillable");let u=!1;switch(s.toLowerCase()){case"integer":case"nonpositiveinteger":case"negativeinteger":case"long":case"int":case"short":case"byte":case"nonnegativeinteger":case"unsignedlong":case"unsignedint":case"unsignedshort":case"unsignedbyte":case"positiveinteger":o.push(new y({name:n,alias:n,type:"integer",nullable:p,length:f.getFieldDefaultLength("integer")}));break;case"float":case"double":case"decimal":o.push(new y({name:n,alias:n,type:"double",nullable:p,length:f.getFieldDefaultLength("double")}));break;case"boolean":case"string":case"gyearmonth":case"gyear":case"gmonthday":case"gday":case"gmonth":case"anyuri":case"qname":case"notation":case"normalizedstring":case"token":case"language":case"idrefs":case"entities":case"nmtoken":case"nmtokens":case"name":case"ncname":case"id":case"idref":case"entity":case"duration":case"time":o.push(new y({name:n,alias:n,type:"string",nullable:p,length:l??f.getFieldDefaultLength("string")}));break;case"datetime":case"date":o.push(new y({name:n,alias:n,type:"date",nullable:p,length:l??f.getFieldDefaultLength("date")}));break;case"pointpropertytype":i="point",u=!0;break;case"multipointpropertytype":i="multipoint",u=!0;break;case"curvepropertytype":case"multicurvepropertytype":case"multilinestringpropertytype":i="polyline",u=!0;break;case"surfacepropertytype":case"multisurfacepropertytype":case"multipolygonpropertytype":i="polygon",u=!0;break;case"geometrypropertytype":case"multigeometrypropertytype":u=!0,t.push(new r(b,`geometry type '${s}' is not supported`,{type:(new XMLSerializer).serializeToString(e)}));break;default:t.push(new r("wfs-layer:unknown-field-type",`Unknown field type '${s}'`,{type:(new XMLSerializer).serializeToString(e)}))}u&&o.push(new y({name:n,alias:n,type:"geometry",nullable:p}))}for(const e of o)if("integer"===e.type&&!e.nullable&&I.has(e.name.toLowerCase())){e.type="oid";break}return{geometryType:i,fields:o,errors:t}}(t)}throw new r(w,`Type '${e}' not found in document`,{document:(new XMLSerializer).serializeToString(n)})}const I=new Set(["objectid","fid"]);async function N(e,o,i,n,a){let{data:s}=await t(e,{responseType:"text",query:j(o,i,n,a),signal:a?.signal});s=s.replaceAll(/": +(-?\d+),(\d+)(,)?/g,'": $1.$2$3');try{return JSON.parse(s)}catch(e){throw new r("wfs-layer:malformed-json","Error while parsing the response",{response:s,error:e})}}function j(e,t,r,o){const i="number"==typeof t?t:t.wkid;return{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:g,TYPENAMES:e,OUTPUTFORMAT:r,SRSNAME:"EPSG:"+i,STARTINDEX:o?.startIndex,COUNT:o?.count,...o?.customParameters}}function k(e){return(new DOMParser).parseFromString(e.trim(),"text/xml")}function E(e){const[t,r]=e.split(":");return{prefix:r?t:"",name:r??t}}function U(e){let t="",o="";if(c.visitXML(e.firstElementChild,{Exception:e=>(t=e.getAttribute("exceptionCode"),{ExceptionText:e=>{o=e.textContent}})}),t)throw new r(`wfs-layer:${t}`,o)}function G(e,t,r){const o={wkid:t.defaultSpatialReference},i=null!=r?.wkid?{wkid:r.wkid}:o;return{spatialReference:i,getFeatureSpatialReference:d.isArcGISUrl(e)||i.wkid&&t.supportedSpatialReferences.includes(i.wkid)?{wkid:i.wkid}:{wkid:t.defaultSpatialReference}}}e.describeFeatureType=O,e.findFeatureType=v,e.getCapabilities=async function(e,r){const o=S((await t(e,{responseType:"text",query:{SERVICE:"WFS",REQUEST:"GetCapabilities",VERSION:g,...r?.customParameters},signal:r?.signal})).data);return function(e,t){i.isHTTPSProtocol(e)&&(i.hasSameOrigin(e,t.operations.DescribeFeatureType.url,!0)&&(t.operations.DescribeFeatureType.url=i.toHTTPS(t.operations.DescribeFeatureType.url)),i.hasSameOrigin(e,t.operations.GetFeature.url,!0)&&(t.operations.GetFeature.url=i.toHTTPS(t.operations.GetFeature.url)))}(e,o),o},e.getFeature=N,e.getFeatureCount=async function(e,r,o){const i=await t(e,{responseType:"text",query:{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:g,TYPENAMES:r,RESULTTYPE:"hits",...o?.customParameters},signal:o?.signal}),n=/numberMatched=["'](?<numberMatched>\d+)["']/gi.exec(i.data);if(n?.groups)return+n.groups.numberMatched},e.getFeatureTypeInfo=P,e.getGetFeatureSpatialReference=G,e.getWFSLayerInfo=async function(e,t,o,i={}){const{featureType:n,extent:a}=await P(e,t,o,i),{spatialReference:l}=G(e.operations.GetFeature.url,n,i.spatialReference),{fields:p,geometryType:u,swapXY:c,objectIdField:d,geometryField:y}=await async function(e,t,o,i={}){const{typeName:n}=t,[a,s]=await Promise.allSettled([O(e.operations.DescribeFeatureType.url,n,i),C(e,n,o,i)]),l=e=>new r("wfs-layer:getWFSLayerTypeInfo-error",`An error occurred while getting info about the feature type '${n}'`,{error:e});if("rejected"===a.status)throw l(a.reason);if("rejected"===s.status)throw l(s.reason);const{fields:p,errors:u}=a.value??{},c=a.value?.geometryType||s.value?.geometryType,d=s.value?.swapXY??!1;if(null==c)throw new r(b,`The geometry type could not be determined for type '${n}`,{typeName:n,geometryType:c,fields:p,errors:u});return{...R(p??[]),geometryType:c,swapXY:d}}(e,n,l,i);return{url:e.operations.GetCapabilities.url,name:n.name,namespaceUri:n.namespaceUri,fields:p,geometryField:y,geometryType:u,objectIdField:d,spatialReference:i.spatialReference??new s({wkid:n.defaultSpatialReference}),extent:a,swapXY:c,wfsCapabilities:e,customParameters:i.customParameters}},e.parseDescribeFeatureTypeResponse=L,e.parseGetCapabilitiesResponse=S,e.prepareWFSLayerFields=R,e.wfsOidFieldName=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/sources/geojson/geojson":function(){define(["exports","../../../../core/date","../../../../core/Error","../../../../geometry/support/spatialReferenceUtils","../../OptimizedFeature","../../OptimizedGeometry","../../../support/fieldUtils"],(function(e,t,r,o,i,n,a){"use strict";const s={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function l(e){return s[e]}function*p(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*u(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function c(e){for(const t of e)if(t.length>2)return!0;return!1}function d(e){let t=0;for(let r=0;r<e.length;r++){const o=e[r],i=e[(r+1)%e.length];t+=o[0]*i[1]-i[0]*o[1]}return t<=0}function y(e){const t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function f(e,t,r){switch(t.type){case"LineString":case"MultiPoint":return function(e,t,r){return h(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){for(const o of t.coordinates)h(e,o,r);return e}(e,t,r);case"MultiPolygon":return function(e,t,r){for(const o of t.coordinates){m(e,o[0],r);for(let t=1;t<o.length;t++)g(e,o[t],r)}return e}(e,t,r);case"Point":return function(e,t,r){return b(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){const o=t.coordinates;m(e,o[0],r);for(let t=1;t<o.length;t++)g(e,o[t],r);return e}(e,t,r)}}function m(e,t,r){const o=y(t);d(o)?h(e,o,r):w(e,o,r)}function g(e,t,r){const o=y(t);d(o)?w(e,o,r):h(e,o,r)}function h(e,t,r){for(const o of t)b(e,o,r);e.lengths.push(t.length)}function w(e,t,r){for(let o=t.length-1;o>=0;o--)b(e,t[o],r);e.lengths.push(t.length)}function b(e,t,r){const[o,i,n]=t;e.coords.push(o,i),r.hasZ&&e.coords.push(n||0)}function S(e){switch(typeof e){case"string":return t.isISO8601Date(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}e.createOptimizedFeatures=function(e,t){return Array.from(function*(e,t={}){const{geometryType:r,objectIdField:o}=t;for(const a of e){const{geometry:e,properties:s,id:p}=a;if(e&&l(e.type)!==r)continue;const u=s||{};let c;o&&(c=u[o],null==p||c||(u[o]=c=p));const d=new i.OptimizedFeature(e?f(new n,e,t):null,u,null,c);yield d}}(p(e),t))},e.getGeometryType=l,e.inferLayerProperties=function(e,t={}){const r=[],o=new Set,i=new Set;let n,s=!1,d=null,y=!1,{geometryType:f=null}=t;for(const t of p(e)){const{geometry:e,properties:p,id:m}=t;if((!e||(f||(f=l(e.type)),l(e.type)===f))&&(s||(s=c(u(e))),y||(y=null!=m,y&&(n=typeof m,p&&(d=Object.keys(p).filter((e=>p[e]===m))))),p&&d&&y&&null!=m&&(d.length>1?d=d.filter((e=>p[e]===m)):1===d.length&&(d=p[d[0]]===m?d:[])),p))for(const e in p){if(o.has(e))continue;const t=S(p[e]);if("unknown"===t){i.add(e);continue}i.delete(e),o.add(e);const n=a.normalizeFieldName(e);n&&r.push({name:n,alias:e,type:t})}}const m=a.normalizeFieldName(1===d?.length&&d[0]||null)??void 0;if(m)for(const e of r)if(e.name===m&&a.isNumericField(e)){e.type="esriFieldTypeOID";break}return{fields:r,geometryType:f,hasZ:s,objectIdFieldName:m,objectIdFieldType:n,unknownFields:Array.from(i)}},e.validateGeoJSON=function(e,t=4326){if(!e)throw new r("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new r("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:i}=e;if(!i)return;const n="string"==typeof i?i:"name"===i.type?i.properties.name:"EPSG"===i.type?i.properties.code:null,a=o.isWGS84({wkid:t})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${t})$`,"i");if(!n||!a.test(n))throw new r("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:i})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/date":function(){define(["exports"],(function(e){"use strict";function t(e){const t=new Date(e);return function(e,t){if(Number.isNaN(e.getTime()))return!1;let r=!0;if(n&&/\d+\W*$/.test(t)){const e=t.match(/[a-zA-Z]{2,}/);if(e){let t=!1,o=0;for(;!t&&o<=e.length;)t=!i.test(e[o]),o++;r=!t}}return r}(t,e)?Number.isNaN(t.getTime())?null:t.getTime()-6e4*t.getTimezoneOffset():null}function r(e){const t=o.exec(e);if(!t?.groups)return null;const r=t.groups,i=+r.year,n=+r.month-1,a=+r.day,s=+(r.hours??"0"),l=+(r.minutes??"0"),p=+(r.seconds??"0");if(s>23)return null;if(l>59)return null;if(p>59)return null;const u=r.ms??"0",c=u?+u.padEnd(3,"0").slice(0,3):0;let d;if(r.isUTC||!r.offsetSign)d=Date.UTC(i,n,a,s,l,p,c);else{const e=+r.offsetHours,t=+r.offsetMinutes;d=6e4*("+"===r.offsetSign?-1:1)*(60*e+t)+Date.UTC(i,n,a,s,l,p,c)}return Number.isNaN(d)?null:d}const o=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/,i=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,n=!Number.isNaN(new Date("technology 10").getTime());e.isDateString=function(e){return null!=r(e)||null!=t(e)},e.isISO8601Date=function(e){return o.test(e)},e.parseDate=function(e){return r(e)??t(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/ogc/xmlUtils":function(){define(["exports"],(function(e){"use strict";e.iterateXML=function*e(t,r){for(const o of t.children)if(o.localName in r){const t=r[o.localName];"function"==typeof t?yield t(o):yield*e(o,t)}},e.visitXML=function e(t,r){if(t&&r)for(const o of t.children)if(o.localName in r){const t=r[o.localName];if("function"==typeof t){const r=t(o);r&&e(o,r)}else e(o,t)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/support/AttributeBinsFeatureSet":function(){define(["exports","../../chunks/tslib.es6","../../AttributeBinsGraphic","../../core/Clonable","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","./FeatureSet"],(function(e,t,r,o,i,n,a,s,l,p,u){"use strict";return e.default=class extends(o.ClonableMixin(u)){constructor(){super(...arguments),this.features=[]}readFeatures(e,t){return this.readFeaturesWithClass(e,t,r)}},t.__decorate([i.property({type:[r],json:{write:!0}})],e.default.prototype,"features",void 0),t.__decorate([l.reader("features")],e.default.prototype,"readFeatures",null),e.default=t.__decorate([p.subclass("esri.rest.support.AttributeBinsFeatureSet")],e.default),e.default}))},"esri/AttributeBinsGraphic":function(){define(["exports","./chunks/tslib.es6","./Graphic","./core/Clonable","./core/lang","./core/accessorSupport/decorators/property","./core/has","./core/Logger","./core/accessorSupport/decorators/subclass"],(function(e,t,r,o,i,n,a,s,l){"use strict";var p;return e.default=class extends(o.ClonableMixin(r)){static{p=this}constructor(e){super(e),this.stackedAttributes=null}cloneShallow(){return new p({...super.cloneShallow(),stackedAttributes:this.stackedAttributes})}toJSON(){return{...super.toJSON(),stackedAttributes:i.clone(this.stackedAttributes)}}},t.__decorate([n.property()],e.default.prototype,"stackedAttributes",void 0),e.default=p=t.__decorate([l.subclass("esri.AttributeBinsGraphic")],e.default),e.default}))},"*noref":1}}),define(["require","../chunks/tslib.es6","../PopupTemplate","../core/MultiOriginJSONSupport","../core/object","../core/urlUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../geometry/Extent","../geometry/SpatialReference","../geometry/support/typeUtils","./Layer","./graphics/sources/WFSSource","./mixins/BlendLayer","./mixins/CustomParametersMixin","./mixins/DisplayFilteredLayer","./mixins/FeatureEffectLayer","./mixins/FeatureReductionLayer","./mixins/OperationalLayer","./mixins/OrderedLayer","./mixins/PortalLayer","./mixins/RefreshableLayer","./mixins/ScaleRangeLayer","./mixins/TemporalLayer","./mixins/TrackableLayer","./ogc/wfsUtils","./support/commonProperties","./support/featureLayerUtils","./support/Field","./support/fieldProperties","./support/fieldUtils","./support/LabelClass","./support/labelingInfo","../renderers/support/typeUtils","../rest/support/Query","../support/popupUtils","../time/timeZoneUtils"],(function(e,t,r,o,i,n,a,s,l,p,u,c,d,y,f,m,g,h,w,b,S,F,T,_,x,v,P,R,C,O,L,I,N,j,k,E,U,G,A,D,M){"use strict";const q=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));var W;const X=j.defineFieldProperties();let J=W=class extends(_.OrderedLayer(b.DisplayFilteredLayer(w.CustomParametersMixin(F.FeatureReductionLayer(S.FeatureEffectLayer(h.BlendLayer(R.TemporalLayer(C.TrackableLayer(v.RefreshableLayer(P.ScaleRangeLayer(T.OperationalLayer(x.PortalLayer(o.MultiOriginJSONMixin(m)))))))))))))){static fromWFSLayerInfo(e){const{customParameters:t,fields:r,geometryField:o,geometryType:i,name:n,namespaceUri:a,objectIdField:s,spatialReference:l,swapXY:p,url:u,wfsCapabilities:c}=e;return new W({customParameters:t,fields:r,geometryField:o,geometryType:i,name:n,namespaceUri:a,objectIdField:s,spatialReference:l,swapXY:p,url:u,wfsCapabilities:c})}constructor(e){super(e),this.copyright=null,this.customParameters=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.featureUrl=void 0,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="WFS",this.maxRecordCount=3e3,this.maxPageCount=10,this.maxTotalRecordCount=2e5,this.mode=0,this.name=null,this.namespaceUri=null,this.outFields=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new g.WFSSource({layer:this}),this.spatialReference=y.WGS84,this.spatialReferences=[4326],this.swapXY=void 0,this.title="WFS",this.type="wfs",this.url=null,this.version=void 0}destroy(){this.source?.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WFS"]},e).then((()=>this.source.load(e))).then((()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo","spatialReference","name","namespaceUri"],"service"),k.fixRendererFields(this.renderer,this.fieldsIndex),k.fixTimeInfoFields(this.timeInfo,this.fieldsIndex)}))),Promise.resolve(this)}get capabilities(){return this.source?.capabilities}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,r){const o=e.filter((e=>e.name!==O.wfsOidFieldName));this.geometryField&&o.unshift(new N({name:this.geometryField,alias:this.geometryField,type:"geometry"})),i.setDeepValue(r,o.map((e=>e.toJSON())),t)}get parsedUrl(){return n.urlToObject(this.url)}set renderer(e){k.fixRendererFields(e,this.fieldsIndex),this._set("renderer",e)}get wfsCapabilities(){return this.source?.wfsCapabilities}set wfsCapabilities(e){this.source&&(this.source.wfsCapabilities=e)}createPopupTemplate(e){return D.createPopupTemplate(this,e)}createQuery(){const e=new A({returnGeometry:!0,outFields:["*"],where:this.definitionExpression||"1=1"}),{timeOffset:t,timeExtent:r}=this;return e.timeExtent=null!=t&&null!=r?r.offset(-t.value,t.unit):r||null,e}getFieldDomain(e,t){return this.getField(e)?.domain}getField(e){return this.fieldsIndex?.get(e)}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(A.from(e)||this.createQuery(),t))).then((e=>{if(e?.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this.load().then((()=>this.source.queryObjectIds(A.from(e)||this.createQuery(),t)))}queryFeatureCount(e,t){return this.load().then((()=>this.source.queryFeatureCount(A.from(e)||this.createQuery(),t)))}queryExtent(e,t){return this.load().then((()=>this.source.queryExtent(A.from(e)||this.createQuery(),t)))}async queryAttributeBins(t,r){const{source:o,capabilities:i}=await this.load();I.validateBinsQuery(t,i,"WFSLayer");const n=await new Promise(((t,r)=>e(["../rest/support/AttributeBinsQuery"],(e=>t(q(e))),r))),a=await o.queryAttributeBins(n.default.from(t),r);if(a.features)for(const e of a.features)e.layer=e.sourceLayer=this;return a}async hasDataChanged(){try{const{dataChanged:e,updates:t}=await this.source.refresh();return null!=t&&this.read(t,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}};return t.__decorate([a.property({readOnly:!0})],J.prototype,"capabilities",null),t.__decorate([a.property({type:String})],J.prototype,"copyright",void 0),t.__decorate([a.property({readOnly:!0})],J.prototype,"createQueryVersion",null),t.__decorate([a.property({json:{name:"wfsInfo.customParameters",write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0),ignoreOrigin:!0})}}})],J.prototype,"customParameters",void 0),t.__decorate([a.property(M.timeZoneProperty("dateFieldsTimeReference"))],J.prototype,"dateFieldsTimeZone",void 0),t.__decorate([a.property({readOnly:!0})],J.prototype,"defaultPopupTemplate",null),t.__decorate([a.property({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],J.prototype,"definitionExpression",void 0),t.__decorate([a.property({type:String})],J.prototype,"displayField",void 0),t.__decorate([a.property(L.elevationInfo)],J.prototype,"elevationInfo",void 0),t.__decorate([a.property({type:String,readOnly:!0,json:{name:"wfsInfo.featureUrl",write:{ignoreOrigin:!0,isRequired:!0}}})],J.prototype,"featureUrl",void 0),t.__decorate([a.property({type:[N],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],J.prototype,"fields",void 0),t.__decorate([c.writer("fields")],J.prototype,"writeFields",null),t.__decorate([a.property(X.fieldsIndex)],J.prototype,"fieldsIndex",void 0),t.__decorate([a.property({type:d,json:{name:"extent"}})],J.prototype,"fullExtent",void 0),t.__decorate([a.property()],J.prototype,"geometryField",void 0),t.__decorate([a.property({type:String,json:{read:{source:"layerDefinition.geometryType",reader:f.featureGeometryTypeKebabDictionary.read},write:{target:"layerDefinition.geometryType",writer:f.featureGeometryTypeKebabDictionary.write,ignoreOrigin:!0},origins:{service:{read:f.featureGeometryTypeKebabDictionary.read}}}})],J.prototype,"geometryType",void 0),t.__decorate([a.property({type:String})],J.prototype,"id",void 0),t.__decorate([a.property(L.labelsVisible)],J.prototype,"labelsVisible",void 0),t.__decorate([a.property({type:[E],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:U.reader},write:!0}})],J.prototype,"labelingInfo",void 0),t.__decorate([a.property(L.legendEnabled)],J.prototype,"legendEnabled",void 0),t.__decorate([a.property({type:["show","hide"]})],J.prototype,"listMode",void 0),t.__decorate([a.property({type:String})],J.prototype,"objectIdField",void 0),t.__decorate([a.property({type:["WFS"]})],J.prototype,"operationalLayerType",void 0),t.__decorate([a.property({type:s.Integer,json:{name:"wfsInfo.maxFeatures",write:{ignoreOrigin:!0,isRequired:!0}}})],J.prototype,"maxRecordCount",void 0),t.__decorate([a.property({type:s.Integer})],J.prototype,"maxPageCount",void 0),t.__decorate([a.property({type:s.Integer})],J.prototype,"maxTotalRecordCount",void 0),t.__decorate([a.property({type:[0],readOnly:!0,json:{origins:{"web-map":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],J.prototype,"mode",void 0),t.__decorate([a.property({type:String,json:{name:"wfsInfo.name",write:{ignoreOrigin:!0,isRequired:!0}}})],J.prototype,"name",void 0),t.__decorate([a.property({type:String,json:{name:"wfsInfo.wfsNamespace",write:{ignoreOrigin:!0,isRequired:!0}}})],J.prototype,"namespaceUri",void 0),t.__decorate([a.property(L.opacityDrawingInfo)],J.prototype,"opacity",void 0),t.__decorate([a.property(X.outFields)],J.prototype,"outFields",void 0),t.__decorate([a.property({readOnly:!0})],J.prototype,"parsedUrl",null),t.__decorate([a.property(L.popupEnabled)],J.prototype,"popupEnabled",void 0),t.__decorate([a.property({type:r,json:{name:"popupInfo",write:!0}})],J.prototype,"popupTemplate",void 0),t.__decorate([a.property({types:G.rendererTypes,json:{origins:{service:{name:"drawingInfo.renderer"},"web-scene":{types:G.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:!0}},name:"layerDefinition.drawingInfo.renderer",write:{ignoreOrigin:!0}}})],J.prototype,"renderer",null),t.__decorate([a.property(L.screenSizePerspectiveEnabled)],J.prototype,"screenSizePerspectiveEnabled",void 0),t.__decorate([a.property({readOnly:!0})],J.prototype,"source",void 0),t.__decorate([a.property({type:y,json:{name:"layerDefinition.spatialReference",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"extent.spatialReference"}}}})],J.prototype,"spatialReference",void 0),t.__decorate([a.property({readOnly:!0,type:[s.Integer],json:{name:"wfsInfo.supportedSpatialReferences",write:{ignoreOrigin:!0,isRequired:!0}}})],J.prototype,"spatialReferences",void 0),t.__decorate([a.property({type:Boolean,value:!1,json:{name:"wfsInfo.swapXY",write:{ignoreOrigin:!0,isRequired:!0}}})],J.prototype,"swapXY",void 0),t.__decorate([a.property({json:{write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"name"}}}})],J.prototype,"title",void 0),t.__decorate([a.property({json:{read:!1},readOnly:!0})],J.prototype,"type",void 0),t.__decorate([a.property(L.url)],J.prototype,"url",void 0),t.__decorate([a.property({type:String,readOnly:!0,json:{name:"wfsInfo.version",write:{ignoreOrigin:!0,isRequired:!0}}})],J.prototype,"version",void 0),t.__decorate([a.property()],J.prototype,"wfsCapabilities",null),J=W=t.__decorate([u.subclass("esri.layers.WFSLayer")],J),J}));