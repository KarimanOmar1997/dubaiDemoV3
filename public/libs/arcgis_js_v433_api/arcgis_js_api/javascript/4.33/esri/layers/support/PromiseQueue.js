// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],(function(s,t,e,n){"use strict";class i{constructor(s,t,e,n=void 0,i=void 0){this.resolve=s,this.reject=t,this.callback=e,this.signal=n,this.abortCallback=i}}s.PromiseQueue=class{constructor(){this._tasks=new Array,this._numPendingTasks=e.signal(0),this._running=e.signal(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get running(){return this._running.value}_updateRunning(){this._running.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(s){if(0===this.length)return n.Yield;for(;!s.done&&this._process(s);)s.madeProgress()}push(s,t,e){return new Promise(((n,r)=>{this._tasks.push(new i(n,r,s,t,e)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}unshift(s,t,e){return new Promise(((n,r)=>{this._tasks.unshift(new i(n,r,s,t,e)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}_process(s){if(0===this._tasks.length)return!1;const e=this._tasks.shift();this._updateRunning();try{const n=t.isAborted(e.signal);if(n&&!e.abortCallback)e.reject(t.createAbortError());else{const i=n?e.abortCallback?.(t.createAbortError()):e.callback(s);t.isPromiseLike(i)?i.then(e.resolve,e.reject):e.resolve(i)}}catch(s){e.reject(s)}return!0}cancelAll(){const s=t.createAbortError();for(const t of this._tasks)if(t.abortCallback){const e=t.abortCallback(s);t.resolve(e)}else t.reject(s);this._tasks.length=0,this._updateRunning()}},Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})}));