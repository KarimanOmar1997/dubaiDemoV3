// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../request","../renderers/support/jsonUtils","./utils","./query/executeQuery","./support/Query","./support/StatisticDefinition"],(function(e,t,n,i,a,l,s){"use strict";function u(e,t,i){if("classBreaks"===e.type){const a=n.fromJSON(e);return{classBreaks:a.classBreakInfos.map(((e,n)=>(0===n&&null!=t&&(e.minValue=t),n===a.classBreakInfos.length-1&&null!=i&&(e.maxValue=i),{minValue:e.minValue,maxValue:e.maxValue,label:e.label}))),normalizationTotal:a.normalizationTotal}}const{uniqueValueInfos:a}=e;return{uniqueValues:a?.map(((e,n)=>(0===n&&null!=t&&(e.value=t),n===a.length-1&&null!=i&&(e.value=i),{count:e.count,value:e.value,label:e.label})))??[]}}e.generateRenderer=async function(e,n,r,o){const c=i.parseUrl(e),{source:f,checkValueRange:p}=n,{classificationDefinition:m}=r,d={...r.toJSON(),f:"json"};let y=null;if(y="class-breaks-definition"===m?.type?m.classificationField:m?.attributeField,f){const e={source:f?.toJSON()};d.layer=JSON.stringify(e)}d.classificationDef&&(d.classificationDef=JSON.stringify(d.classificationDef));let g={query:d};o&&(g={...o,...g});const S={url:c.path,field:y,checkValueRange:p},V=c.path+"/generateRenderer";return t(V,g).then((e=>function(e,t){const{field:n,checkValueRange:i,url:r}=e,o=t?.data;if(!o)return;if(!i){const e=u(o);return Promise.resolve(e)}const c=new s({statisticType:"min",onStatisticField:n}),f=new s({statisticType:"max",onStatisticField:n}),p=new l({outStatistics:[c,f]});return a.executeQuery(r,p).then((e=>{const t=e.features[0].attributes;let n=null,i=null;for(const e in t)0===e.toLowerCase().indexOf("min")?n=t[e]:i=t[e];return u(o,n,i)}))}(S,e)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));