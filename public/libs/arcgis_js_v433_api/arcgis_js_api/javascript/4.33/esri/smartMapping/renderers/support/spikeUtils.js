// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../Color","../../../core/lang","../../../core/screenUtils","../../../symbols/CIMSymbol","../../../symbols/cim/enums"],(function(e,o,t,r,i,l){"use strict";const n="spike-height-override",a=r.px2pt(8),s=r.px2pt(20);function c(e){const{strokeColor:o,strokeWidth:t,symbolStyle:i}=e,n=i?.includes("solid-fill")||i?.includes("gradient-fill");let a=o?.toArray(),s=!1;return i?.includes("outline")&&n?s=!0:a=e.color?.toArray(),{type:"CIMSolidStroke",effects:u(i),enable:!0,colorLocked:s,capStyle:l.LineCapStyle.Round,joinStyle:l.LineJoinStyle.Round,lineStyle3D:l.Simple3DLineStyle.Strip,miterLimit:4,width:t??r.px2pt(1),color:a}}function u(e){if(!e?.includes("closed"))return[{type:"CIMGeometricEffectAddControlPoints",angleTolerance:90,primitiveName:"spike-control-points"},{type:"CIMGeometricEffectSuppress",suppress:!0,invert:!0,primitiveName:"spike-stroke-suppress"}]}function f(e){const{color:o,symbolStyle:t}=e,r=t?.includes("solid-fill"),i=t?.includes("gradient-fill");if(!r&&!i||!o)return;if(r)return{type:"CIMSolidFill",enable:!0,colorLocked:!1,color:o?.toArray()};const l=o.clone();return l.a=0,{type:"CIMGradientFill",enable:!0,angle:90,colorRamp:{type:"CIMMultipartColorRamp",colorRamps:[{type:"CIMLinearContinuousColorRamp",fromColor:o.toArray(),toColor:l.toArray()}],weights:[1]},gradientMethod:"Linear",gradientSize:70,gradientSizeUnits:"Relative",gradientType:"Continuous"}}function p(e,o){if(!o)return;const t=e.indexOf(o);-1!==t&&e.splice(t,1)}e.createPrimitiveOverrides=function(e){const{field:o,normalizationField:t,sizeStops:r}=e,{value:i,size:l}=r[0],{value:a,size:s}=r[1];let c,u=0;return o&&(u=`$feature["${o}"]`,c=`\n      if(!HasValue($feature, "${o}")){\n        return 0;\n      }\n      $feature["${o}"];\n    `),t&&(u=`$feature["${o}"] / $feature["${t}"]`,c=`if(!HasValue($feature, "${o}") || !HasValue($feature, "${t}") || $feature["${t}"] <= 0){\n        return 0;\n      }\n      $feature["${o}"];\n      $feature["${t}"];`),[{type:"CIMPrimitiveOverride",primitiveName:n,propertyName:"Length",valueExpressionInfo:{type:"CIMExpressionInfo",title:"Custom",expression:`\n        ${c}\n        var value = ${u};\n\n        var maxSize = ${s};\n        var minSize = ${l};\n\n        var minDataValue = ${i};\n        var maxDataValue = ${a};\n\n        var ratio = Constrain(( value - minDataValue ) / ( maxDataValue - minDataValue ), 0, 1);\n\n        var size = Constrain(maxSize * ratio, minSize, maxSize);\n        return size;\n      `,returnType:"Default"}}]},e.createSpikeSymbol=function(e){const{primitiveOverrides:o,baseWidth:t,defaultHeight:r}=e,l=function(e){const o=[c(e)],t=f(e);return t&&o.push(t),o}(e);return new i({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",effects:[{type:"CIMGeometricEffectRadial",primitiveName:n,angle:90,length:r??s},{type:"CIMGeometricEffectTaperedPolygon",fromWidth:t??a,toWidth:1,length:5}],symbolLayers:l,haloSize:1,scaleX:1,angleAlignment:"Display"},primitiveOverrides:o}})},e.defaultSpikeSymbolStyle="triangle-solid-fill-open-outline",e.updateSpikeSymbol=function(e,r){const{defaultHeight:i,baseWidth:l,color:a,strokeColor:s,primitiveOverrides:u,symbolStyle:d,strokeWidth:m}=r,y="CIMPointSymbol"===e.data.symbol?.type?e.data.symbol:null,C=y?.symbolLayers;if(!C)return e;const S=y.effects,v=S?.find((e=>"CIMGeometricEffectTaperedPolygon"===e.type)),g=S?.find((e=>"CIMGeometricEffectRadial"===e.type&&e.primitiveName===n));null!=l&&v&&(v.fromWidth=l),null!=i&&g&&(g.length=i);const M=C?.find((e=>"CIMSolidStroke"===e.type)),$=C?.find((e=>"CIMSolidFill"===e.type)),h=C?.find((e=>"CIMGradientFill"===e.type)),b="CIMMultipartColorRamp"===h?.colorRamp?.type&&"CIMLinearContinuousColorRamp"===h.colorRamp.colorRamps[0]?.type?h.colorRamp.colorRamps[0]:null;if(d){const e=$?.color??b?.fromColor??M?.color,t=a??(e?new o(e):void 0),i=M?.color??e,l=s??(i?new o(i):void 0),n=d.includes("solid-fill"),u=d.includes("gradient-fill");if(n||u||p(C,$??h),t)if(n)p(C,h),$?$.color=t?.toArray():C.push(f({...r,color:t}));else if(u)if(p(C,$),h){if(b&&a){const e=t.clone();e.a=0,b.fromColor=t.toArray(),b.toColor=e.toArray()}}else C.push(f({...r,color:t}));if(M){const e=c({...r,strokeColor:l,color:t});M.effects=e.effects,M.color=e.color,M.width=e.width,M.colorLocked=e.colorLocked}}else if(M&&(s&&(M.color=s.toArray()),null!=m&&(M.width=m)),$&&a&&($.color=a.toArray()),b&&a){const e=a.clone();e.a=0,b.fromColor=a.toArray(),b.toColor=e.toArray()}return void 0!==u&&(e.data.primitiveOverrides=t.clone(u)),e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));