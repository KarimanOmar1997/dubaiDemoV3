// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["../../core/Error","../../layers/support/fieldUtils","./support/utils","../support/binningUtils","../support/utils","../support/adapters/support/layerUtils"],(function(i,e,a,r,s,t){"use strict";const n=[...s.dateTypes,"time-only",...e.numericTypes];return async function(l){const{layerAdapter:o,...p}=await async function(l){if(!l?.layer||!(l.field||l.valueExpression||l.sqlExpression))throw new i("histogram:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(l.valueExpression&&!l.sqlExpression&&!l.view)throw new i("histogram:missing-parameters","View is required when 'valueExpression' is specified");l.forBinning&&r.verifyBinningParams(l,"histogram");const{layer:o,...p}=l,d=[...t.defaultSupportedLayerTypes,t.LayerType.ImageryLayer],f=l.forBinning?t.binningCapableLayerTypes:d,u=t.createLayerAdapter(o,f,l.forBinning);if(!u)throw new i("histogram:invalid-parameters","'layer' must be one of these types: "+t.getLayerTypeLabels(f).join(", "));const y={layerAdapter:u,...p};y.normalizationType=s.getNormalizationType(y);const m=null!=y.signal?{signal:y.signal}:null;await u.load(m);const h=y.valueExpression||y.sqlExpression,c=y.field,w=c?u.getField(c):null,g=!y.classificationMethod||"equal-interval"===y.classificationMethod,v=await s.getFieldsList({field:c,normalizationField:y.normalizationField,valueExpression:y.valueExpression}),E=a.verifyBasicFieldValidity(u,v,"histogram:invalid-parameters");if(E)throw E;if(w){const r=a.verifyFieldType(u,w,"histogram:invalid-parameters",n);if(r)throw r;if(s.isAnyDateField(w)||e.isTimeOnlyField(w)){if(y.normalizationType)throw new i("histogram:invalid-parameters","Normalization is not allowed for date fields");if(!g)throw new i("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed for date fields")}}else if(h){if(y.normalizationType)throw new i("histogram:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");if(!g)throw new i("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed when 'valueExpression' or 'sqlExpression' is specified")}y.filter&&!y.filter.spatialRelationship&&(y.filter.spatialRelationship="intersects");const x=a.verifyFilterValidity(y.filter,"histogram:invalid-parameters");if(x)throw x;return null==y.useQueryAttributeBins&&(y.useQueryAttributeBins=!0),y}(l);return o.histogram(p)}}));