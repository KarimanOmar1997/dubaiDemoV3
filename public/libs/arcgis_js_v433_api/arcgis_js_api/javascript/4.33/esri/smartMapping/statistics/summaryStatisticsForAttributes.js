// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["../../core/Error","./support/utils","../support/binningUtils","../support/utils","../support/adapters/support/layerUtils"],(function(e,t,r,s,i){"use strict";return async function(a){const{layerAdapter:n,...u}=await async function(a){if(!(a&&a.layer&&a.attributes))throw new e("summary-statistics-for-attributes:missing-parameters","'layer' and 'attributes' parameters are required");if(a.attributes.some((e=>!!e.valueExpression))&&!a.view)throw new e("summary-statistics-for-attributes:missing-parameters","View is required when 'valueExpression' is specified in attributes");a.forBinning&&r.verifyBinningParams(a,"summary-statistics-for-attributes");const{layer:n,...u}=a,l=[i.LayerType.CSVLayer,i.LayerType.FeatureLayer,i.LayerType.OGCFeatureLayer,i.LayerType.GeoJSONLayer,i.LayerType.KnowledgeGraphSublayer,i.LayerType.ParquetLayer,i.LayerType.WFSLayer],o=a.forBinning?i.binningCapableLayerTypes:l,y=i.createLayerAdapter(n,o,a.forBinning);if(!y)throw new e("summary-statistics-for-attributes:invalid-parameters","'layer' must be one of these types: "+i.getLayerTypeLabels(o).join(", "));const p={layerAdapter:y,...u};p.includeZeros=null==p.includeZeros||p.includeZeros,p.includeNegatives=null==p.includeNegatives||p.includeNegatives;const c=p.view,f=null!=p.signal?{signal:p.signal}:null;await Promise.all([c?.when(),y.load(f)]);const d=[];for(const e of p.attributes){const t=await s.getFieldsList({field:e.field,valueExpression:e.valueExpression});Array.prototype.push.apply(d,t)}const m=t.verifyBasicFieldValidity(y,d,"summary-statistics-for-attributes:invalid-parameters");if(m)throw m;return p}(a),l=t.getSumOfAttributesExpr(u.attributes,u.includeZeros,u.includeNegatives);return n.summaryStatistics({valueExpression:l.valueExpression,sqlExpression:l.sqlExpression,sqlWhere:l.sqlWhere,view:u.view,filter:u.filter,outStatisticTypes:s.defaultStatisticTypes,signal:u.signal})}}));