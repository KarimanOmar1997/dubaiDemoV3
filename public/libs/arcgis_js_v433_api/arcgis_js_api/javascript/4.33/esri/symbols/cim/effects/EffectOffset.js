// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/SpatialReference","../../../geometry/support/jsonUtils","../CIMEffects","../CurveHelper","../enums"],(function(e,t,s,i,o,r,n,f){"use strict";class l{static{this.instance=null}static local(){return null===l.instance&&(l.instance=new l),l.instance}execute(e,t,s,i,o,r,n){return new m(e,t,s,i,o,r,n)}}class m{constructor(e,t,s,i,o,r,f){this._preventClipping=f,this._inputGeometries=e,this._tileKey=i,this._geometryEngine=o,this._curveHelper=new n.CurveHelper,this._offset=(t.offset??1)*s,this._method=t.method,this._maxInflateSize=Math.max(Math.abs(r*s),10),this._option=t.option,this._offsetFlattenError=n.pixelTolerance*s}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._offset)return e.clone();if("esriGeometryEnvelope"===e.geometryType){if(this._method===f.GeometricEffectOffsetMethod.Rounded&&this._offset>0){const i=s.collectPath(e),o=this._curveHelper.offset(i,-this._offset,this._method,4,this._offsetFlattenError);if(o){const s=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);return s.pushPath(o),s}return null}const i=e.asJSON();if(o.isExtent(i)&&Math.min(i.xmax-i.xmin,i.ymax-i.ymin)+2*this._offset>0)return t.GeometryCursor.fromJSONCIM({xmin:i.xmin-this._offset,xmax:i.xmax+this._offset,ymin:i.ymin-this._offset,ymax:i.ymax+this._offset})}const n=this._geometryEngine;if(null==n)continue;const l=!this._preventClipping&&this._tileKey?r.clipCursorToTileExtent(e,this._maxInflateSize,!0):e.clone();if(!l)continue;const m=n.offset(i.WebMercator,l.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return m?t.GeometryCursor.fromJSONCIM(m):null}return null}}e.EffectOffset=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));