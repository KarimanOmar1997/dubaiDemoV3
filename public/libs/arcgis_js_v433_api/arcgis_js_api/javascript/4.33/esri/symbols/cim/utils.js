// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["require","exports","./defaultCIMValues"],(function(e,t,r){"use strict";function n(e){return"function"==typeof e}function o(e){let t=e.length;for(;t--;)if(!" /-,\n".includes(e.charAt(t)))return!1;return!0}function l(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function i(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function a(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}function s(e){return e?e.charAt(0).toLowerCase()+e.slice(1):e}function c(e,t){if("color"===t||"outlinecolor"===t||"backgroundcolor"===t||"borderlinecolor"===t||"tintcolor"===t)return[...r.defaultCIMColor[t]];const n=r.defaultCIMValues[e];if(!n)throw new Error(`InternalError: default value for type ${e}.`);return n[t]}function u(e){return e.split(" ").map((e=>Number(e)))}function f(e){return"string"==typeof e?u(e):e}function M(e,t){if(null!==t){const r=t.get(e);return r?r.name:e}return e}function m(e,t,r,n,o){const l=r*Math.PI/180;if(l){const r=Math.cos(l);return(Math.sin(l)*e+r*t)*n+o}return t*n+o}function y(e,t,r,n,o){const l=r*Math.PI/180;return l?(Math.cos(l)*e-Math.sin(l)*t)*n+o:e*n+o}function C(e,t,r){return t?r-e:r+e}t.adjustTextCase=l,t.analyzeTextParts=function(e,t){const r=[];let n=0,l=-1;do{if(l=e.indexOf("[",n),l>=n){if(l>n){const t=e.slice(n,l);r.push([t,null,o(t)])}if(n=l+1,l=e.indexOf("]",n),l>=n){if(l>n){const o=t[e.slice(n,l)];o&&r.push([null,o,!1])}n=l+1}}}while(-1!==l);if(n<e.length){const t=e.slice(n);r.push([t,null,o(t)])}return r},t.applyParentTransform=function(e,t,r,n,o,l,i=!0){const{infos:a}=l;let s=1,c=0,u=0,f=0,M=1;for(const{absoluteAnchorPoint:e,offsetX:t,offsetY:r,rotation:n,size:o,frameHeight:l,rotateClockWise:I,scaleSymbolsProportionally:p}of a)M=e?1:s,u=y(t,r,c,M,u),f=m(t,r,c,M,f),l&&(p||i)&&(s*=o/l),c=C(n,I,c);const I=y(n,o,c,M,u),p=m(n,o,c,M,f);return{size:e*s,rotation:C(t,r,c),offsetX:I,offsetY:p}},t.assignTextValuesFromFeature=function(e,t,r,n){let o="",i=null;for(const n of t){const[t,l,a]=n;if(null!=t&&""!==t)a?i=t:(null!=i&&(o+=i,i=null),o+=t);else{let t=l;null!=r&&(t=M(l,r));const n=e.attributes[t];null!=n&&""!==n&&(null!=i&&(o+=i,i=null),o+=n)}}return l(o,n)},t.attributesToFields=function(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))},t.colorToArray=function(e){return[e.r,e.g,e.b,e.a]},t.evaluateValueOrFunction=function(e,t,r,o){return n(e)?e(t,r,o):e},t.fromCIMFontDecoration=function(e){return e.underline?"underline":e.strikethrough?"line-through":"none"},t.fromCIMFontStyle=function(e){let t="normal",r="normal";if(e){const n=e.toLowerCase();n.includes("italic")?t="italic":n.includes("oblique")&&(t="oblique"),n.includes("bold")?r="bold":n.includes("light")&&(r="lighter")}return{style:t,weight:r}},t.fromCIMHorizontalAlignment=function(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}},t.fromCIMVerticalAlignment=function(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}},t.getDefaultCIMValue=c,t.getEnum=(e,t)=>e??t,t.getFieldName=M,t.getFillColor=function e(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const r of t.symbolLayers){const t=e(r);if(null!=t)return t}break;case"CIMTextSymbol":return e(t.symbol);case"CIMSolidFill":return t.color}return null},t.getFontStyle=function(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}},t.getFontWeight=function(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}},t.getNumericValue=(e,t=0)=>null==e||isNaN(e)?t:e,t.getProcessParam=function(e,t,r){const n="Color"===r||"TintColor"===r||"ToColor"===r,o="Rotation"===r||"Angle"===r||"ToRotation"===r;let l=t[s(r)];if(null!=l&&(n?l=[l[0]/255,l[1]/255,l[2]/255,l[3]/255]:o&&(l*=Math.PI/180)),null==l&&(l=c(t.type,r.toLowerCase()),null!=l&&(n?l=[l[0]/255,l[1]/255,l[2]/255,l[3]]:o&&(l*=Math.PI/180))),null!=t.primitiveName){const i=e[t.primitiveName];if(null!=i){const e=i[r];null==e||("string"==typeof e||"number"==typeof e||Array.isArray(e)?(l=e,null!=l&&(n?l=[l[0]/255,l[1]/255,l[2]/255,l[3]/255]:o&&(l*=Math.PI/180))):(l={valueExpressionInfo:e,defaultValue:l},null!=l&&(n?l={type:"Process",op:"ArcadeColor",value:l}:o&&(l={type:"Process",op:"Divide",left:l,right:180/Math.PI}))))}}if(null==l)throw new Error(`Failed to derive a value or an expression for "${r}".`);return l},t.getRelativeGradientSize=function(e,t){return Math.max(Math.min((e??t)/100,1),0)},t.getSize=function(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const n of e.symbolLayers)if(n)switch(n.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=n.size??r.defaultCIMValues.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const n of e.symbolLayers)if(n)switch(n.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=n.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(n.markerPlacement&&a(n.markerPlacement)){const e=n.size??r.defaultCIMValues.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=n.height;null!=e&&e>t&&(t=e)}}return t}}},t.getStrokeColor=function e(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const r=t.symbolLayers;if(r)for(const t of r){const r=e(t);if(null!=r)return r}break}case"CIMTextSymbol":return e(t.symbol);case"CIMSolidStroke":return t.color}},t.getStrokeWidth=function e(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const r of t.symbolLayers){const t=e(r);if(void 0!==t)return t}break;case"CIMTextSymbol":return e(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}},t.getTextCasing=function e(t){if(null==t)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=t.symbolLayers;if(!r)return"Normal";for(const t of r)if("CIMVectorMarker"===t.type)return e(t)}break;case"CIMVectorMarker":{const r=t.markerGraphics;if(!r)return"Normal";for(const t of r)if(t.symbol)return e(t.symbol)}}return"Normal"},t.getTextValuesFromFeatureHandle=function(e,t,r){let n="",o=null;for(const r of t){const[t,l,i]=r;if(null!=t&&""!==t)i?o=t:(null!=o&&(n+=o,o=null),n+=t);else{const t=e.readAttribute(l);null!=t&&""!==t&&(null!==o&&(n+=o,o=null),n+=t)}}return l(n,r)},t.getTintColor=e=>e.tintColor?i(e.tintColor):[255,255,255,1],t.getValue=(e,t)=>null!=e?e:t,t.hasProcessParam=function(e,t,r){if(null!=t[s(r)])return!0;if(null!=t.primitiveName){const n=e[t.primitiveName];if(null!=n&&null!=n[r])return!0}return!1},t.hasStrokeLayer=function(e){for(const t of e)if(t.enable)switch(t.type){case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return!0}return!1},t.importGeometryEngine=function(){return new Promise(((t,r)=>e(["../../geometry/geometryEngineJSON"],t,r)))},t.isCIMFill=function(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)},t.isCIMMarker=function(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type},t.isCIMMarkerStrokePlacement=a,t.isCIMStroke=function(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type},t.isFeatureValueFn=n,t.isGeometryEngineRequired=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectDonut":case"CIMGeometricEffectOffset":case"CIMGeometricEffectTaperedPolygon":case"CIMGeometricEffectEnclosingPolygon":return!0}return!1},t.isSVGImage=e=>e.includes("data:image/svg+xml"),t.isValidCIMValue=function e(t){if(null==t)return!1;if(Array.isArray(t))return t.every((t=>e(t)));switch(typeof t){case"string":return!!t;case"number":return!isNaN(t)}},t.mapCIMSymbolToGeometryType=function(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}},t.normalizeAlpha=i,t.normalizeDashEffectTemplate=function(e){return e?.dashTemplate&&(e.dashTemplate=f(e.dashTemplate)),e},t.normalizeDashTemplate=f,t.normalizePrimitiveOverrideProps=function(e){return e.map((e=>({...e,propertyName:s(e.propertyName)})))},t.parseDashTemplate=u,t.resampleHermite=function(e,t,r,n,o,l,i=!0){const a=t/o,s=r/l,c=Math.ceil(a/2),u=Math.ceil(s/2);for(let r=0;r<l;r++)for(let f=0;f<o;f++){const M=4*(f+(i?l-r-1:r)*o);let m=0,y=0,C=0,I=0,p=0,h=0,b=0;const d=(r+.5)*s;for(let n=Math.floor(r*s);n<(r+1)*s;n++){const r=Math.abs(d-(n+.5))/u,o=(f+.5)*a,l=r*r;for(let r=Math.floor(f*a);r<(f+1)*a;r++){let i=Math.abs(o-(r+.5))/c;const a=Math.sqrt(l+i*i);a>=-1&&a<=1&&(m=2*a*a*a-3*a*a+1,m>0&&(i=4*(r+n*t),b+=m*e[i+3],C+=m,e[i+3]<255&&(m=m*e[i+3]/250),I+=m*e[i],p+=m*e[i+1],h+=m*e[i+2],y+=m))}}n[M]=I/y,n[M+1]=p/y,n[M+2]=h/y,n[M+3]=b/C}},t.toCIMSymbolJSON=function(e){return e.data?.symbol??null},t.toLowerCaseProps=function(e){const t={};for(const r in e){const n=e[r];t[s(r)]=n}return t},t.uncapitalize=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));