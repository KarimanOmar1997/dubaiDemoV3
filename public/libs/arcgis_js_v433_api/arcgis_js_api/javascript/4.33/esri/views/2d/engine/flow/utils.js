// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/screenUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32"],(function(t,e,n,i){"use strict";function o(t){return"constant"===t.kind?t.value[0]:t.values[t.values.length-1]}function s(t){const e=t.toRgba();return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function a(t){if(!t.hasVisualVariables("size"))return{kind:"constant",value:[e.pt2px(t.trailWidth)]};const n=t.getVisualVariablesForType("size")[0],i=[],o=[];let s;if(n.stops){for(const t of n.stops)i.push(t.value),o.push(e.pt2px(t.size));s=n.stops.length}else i.push(n.minDataValue,n.maxDataValue),o.push(e.pt2px(n.minSize),e.pt2px(n.maxSize)),s=2;return{kind:"ramp",stops:i,values:o,count:s}}function l(t,e,n,i){switch(e){case"int":t.setUniform1iv(n,i);break;case"float":t.setUniform1fv(n,i);break;case"vec2":t.setUniform2fv(n,i);break;case"vec3":t.setUniform3fv(n,i);break;case"vec4":t.setUniform4fv(n,i)}}function r(t,e){let n=!0;return n=n&&t.collisions===e.collisions,n=n&&t.density===e.density,n=n&&t.interpolate===e.interpolate,n=n&&t.lineCollisionWidth===e.lineCollisionWidth,n=n&&t.lineSpacing===e.lineSpacing,n=n&&t.maxTurnAngle===e.maxTurnAngle,n=n&&t.minSpeedThreshold===e.minSpeedThreshold,n=n&&t.segmentLength===e.segmentLength,n=n&&t.smoothing===e.smoothing,n=n&&t.velocityScale===e.velocityScale,n=n&&t.verticesPerLine===e.verticesPerLine,n}function u(t,e){return t===e||null!=t&&null!=e&&t.equals(e)}t.areStreamlinesCompatible=function(t,e){if(!r(t.simulationSettings,e.simulationSettings))return!1;if(!u(t.timeExtent,e.timeExtent))return!1;let n=!0;return n=n&&t.loadImagery===e.loadImagery,n=n&&t.createFlowMesh===e.createFlowMesh,n=n&&t.color.kind===e.color.kind,n=n&&t.opacity.kind===e.opacity.kind,n=n&&t.size.kind===e.size.kind,n},t.getColor=function(t){if(!t.hasVisualVariables("color"))return{kind:"constant",value:s(t.color)};const e=t.getVisualVariablesForType("color")[0],n=[],i=[];for(const t of e.stops)n.push(t.value),Array.prototype.push.apply(i,s(t.color));return{kind:"ramp",stops:n,values:i,count:e.stops.length}},t.getFlowSimulationSettings=function(t){const n=o(a(t)),i=n,s=Math.max(n/2,5),l=Math.round(e.pt2px(t.maxPathLength)/s)+1,{density:r}=t;return{smoothing:e.pt2px(t.smoothing),interpolate:!0,velocityScale:"flow-from"===t.flowRepresentation?1:-1,verticesPerLine:l,minSpeedThreshold:.001,segmentLength:s,maxTurnAngle:1,collisions:!0,lineCollisionWidth:i,lineSpacing:10,density:r}},t.getForegroundColor=function(t){return{kind:"constant",value:[.1,.1,.1,1]}},t.getMax=o,t.getOpacity=function(t){if(!t.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const e=t.getVisualVariablesForType("opacity")[0],n=[],i=[];for(const t of e.stops)n.push(t.value),i.push(t.opacity);return{kind:"ramp",stops:n,values:i,count:e.stops.length}},t.getSingleTileVisualState=function(t,e,o){const s=i.create();return n.identity(s),n.translate(s,s,[-1,1]),n.scale(s,s,[2/e,-2/o,1]),{time:t,dvsMat3:s,displayViewMat3:s}},t.getSize=a,t.setUniform=l,t.setUniforms=function(t,e,n,i){"constant"===i.kind?l(t,n,`u_${e}`,i.value):(l(t,"float",`u_${e}_stops`,i.stops),l(t,n,`u_${e}_values`,i.values),t.setUniform1i(`u_${e}_count`,i.count))},t.simulationSettingsEqual=r,t.timeExtentsEqual=u,t.toRgba=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));