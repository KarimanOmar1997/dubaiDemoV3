// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/handleUtils","../../../../../core/time","../../../../../symbols/cim/enums","../grouping"],(function(e,t,i,r,a){"use strict";function n(e){return i.Milliseconds(e.frameDurations.reduce(((e,t)=>e+t),0))}function o(e){const{width:t,height:i}=e,r=e.frameDurations.reverse();return{frameCount:e.frameCount,duration:e.duration,frameDurations:r,getFrame:t=>{const i=e.frameDurations.length-1-t;return e.getFrame(i)},width:t,height:i}}function s(e,t){const{width:r,height:a,getFrame:n}=e,o=t/e.duration,s=e.frameDurations.map((e=>i.Milliseconds(e*o)));return{frameCount:e.frameCount,duration:e.duration,frameDurations:s,getFrame:n,width:r,height:a}}function m(e,t){const{width:r,height:a,getFrame:n}=e,o=e.frameDurations.slice(),s=o.shift();return o.unshift(i.Milliseconds(s+t)),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:o,getFrame:n,width:r,height:a}}function u(e,t){const{width:r,height:a,getFrame:n}=e,o=e.frameDurations.slice(),s=o.pop();return o.push(i.Milliseconds(s+t)),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:o,getFrame:n,width:r,height:a}}class l{constructor(e,t,i,r){this._animation=e,this._repeatType=i,this._onFrameData=r,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;t>a;)a+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case r.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case r.AnimatedSymbolRepeatType.Loop:this._currentFrame=0;break;case r.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case r.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case r.AnimatedSymbolRepeatType.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case r.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const e=this._animation.getFrame(this._currentFrame);this._onFrameData(e)}}function c(e,t,c,h){let d,{repeatType:f}=t;if(null==f&&(f=r.AnimatedSymbolRepeatType.Loop),!0===t.reverseAnimation&&(e=o(e)),null!=t.duration&&(e=s(e,i.Milliseconds(1e3*t.duration))),null!=t.repeatDelay){const a=1e3*t.repeatDelay;f===r.AnimatedSymbolRepeatType.Loop?e=u(e,i.Milliseconds(a)):f===r.AnimatedSymbolRepeatType.Oscillate&&(e=m(u(e,i.Milliseconds(a/2)),i.Milliseconds(a/2)))}if(null!=t.startTimeOffset)d=i.Milliseconds(1e3*t.startTimeOffset);else if(null!=t.randomizeStartTime){const r=82749913,o=null!=t.randomizeStartSeed?t.randomizeStartSeed:r,s=a.getRandomValue(c,o);d=i.Milliseconds(s*n(e))}else d=i.Milliseconds(0);return new l(e,d,f,h)}e.Player=l,e.adjustDuration=s,e.appendDelay=u,e.createPlayer=c,e.getDuration=n,e.play=function(e,i,r,a){const n=null==i.playAnimation||i.playAnimation,o=c(e,i,r,a);let s,m=o.timeToFrame;return function e(){s=n?setTimeout((()=>{o.nextFrame(),m=o.timeToFrame,e()}),m):void 0}(),t.makeHandle((()=>n&&clearTimeout(s)))},e.prependDelay=m,e.reverse=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));