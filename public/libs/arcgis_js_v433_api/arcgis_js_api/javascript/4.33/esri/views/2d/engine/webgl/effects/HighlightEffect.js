// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["../../../../../core/has","../BitBlitRenderer","./Effect","./highlight/HighlightRenderer","./highlight/HighlightSurfaces","../../../../webgl/enums"],(function(e,t,r,s,i,h){"use strict";class d extends r.Effect{constructor(){super(...arguments),this.defines=["highlight"],this._hlRenderer=new s,this._width=void 0,this._height=void 0,this._boundFBO=null,this._hlSurfaces=new i,this._adjustedWidth=void 0,this._adjustedHeight=void 0,this._blitRenderer=new t.BitBlitRenderer}dispose(){this._hlSurfaces?.dispose(),this._hlRenderer?.dispose(),this._boundFBO=null}bind(e){const{context:t,painter:r}=e,{width:s,height:i}=t.getViewport(),d=r.getFbos().effect0;this.setup(e,s,i),t.bindFramebuffer(d),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(h.FramebufferBit.COLOR)}unbind(){}setup({context:e},t,r){this._width=t,this._height=r;const s=t%4,i=r%4;t+=s<2?-s:4-s,r+=i<2?-i:4-i,this._adjustedWidth=t,this._adjustedHeight=r,this._boundFBO=e.getBoundFramebufferObject();const h=Math.round(1*t),d=Math.round(1*r);this._hlRenderer.setup(e,h,d),this._hlSurfaces.setup(e,h,d)}draw(e){const{context:t,passOptions:r}=e,s=r.activeGradient,i=t.getBoundFramebufferObject();t.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setStencilTestEnabled(!1),t.setClearColor(0,0,0,0),t.clear(h.FramebufferBit.COLOR),this._blitRenderer.render(t,i.colorTexture,h.TextureSamplingMode.NEAREST,1),t.setStencilTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!0),t.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),t.setClearColor(0,0,0,0),t.clear(h.FramebufferBit.COLOR),this._hlRenderer.preBlur(t,this._hlSurfaces.sharedBlur1Tex),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setClearColor(0,0,0,0),t.clear(h.FramebufferBit.COLOR),this._hlRenderer.finalBlur(t,this._hlSurfaces.sharedBlur2Tex),t.bindFramebuffer(this._boundFBO),t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(t,this._hlSurfaces.sharedBlur1Tex,s),this._boundFBO=null}}return d}));