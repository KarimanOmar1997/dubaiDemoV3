// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../chunks/earcut","../../../../../../geometry/libtess","../../../../../../geometry/support/TileClipper","../../../../../../layers/graphics/OptimizedGeometry","../../definitions","../bufcut"],(function(t,e,n,r,o,l,s){"use strict";const i=new r.TileClipper(0,0,0,1,0),u=new r.TileClipper(0,0,0,1,0);function c(t,e,n){let r=0;for(let o=1;o<n;o++){const n=t[2*(e+o-1)],l=t[2*(e+o-1)+1];r+=(t[2*(e+o)]-n)*(t[2*(e+o)+1]+l)}return r}function f(t,e,n,r,o){let l=0;for(let s=n;s<r;s+=3){const n=2*(t[s]-o),r=2*(t[s+1]-o),i=2*(t[s+2]-o);l+=Math.abs((e[n]-e[i])*(e[r+1]-e[n+1])-(e[n]-e[r])*(e[i+1]-e[n+1]))}return l}i.setExtent(l.tileSize),u.setExtent(l.tileSize),t.area=c,t.clipLinesMarshall=function(t,e){u.setPixelMargin(e);const n=u,o=-e,s=l.tileSize+e;let i=[],c=!1;if(!t.nextPath())return null;let f=t.pathLength(),h=!0;for(;h;){t.seekPathStart();const e=[];if(!t.pathSize)return null;n.reset(r.GeometryType.LineString),t.nextPoint();let l=t.x,u=t.y;if(c)n.moveTo(l,u);else{if(l<o||l>s||u<o||u>s){c=!0;continue}e.push({x:l,y:u})}let a=!1;for(;t.nextPoint();)if(l=t.x,u=t.y,c)n.lineTo(l,u);else{if(l<o||l>s||u<o||u>s){a=!0;break}e.push({x:l,y:u})}if(a)c=!0;else{if(c){const t=n.resultWithStarts();if(t)for(const e of t)i.push({...e,pathLength:f})}else i.push({line:e,start:0,pathLength:f});h=t.nextPath(),f=h?t.pathLength():0,c=!1}}return i=i.filter((t=>t.line.length>1)),0===i.length?null:i},t.clipMarshall=function(t,e){if(null==t)return null;if(!function(t,e,n){let r=0;for(let e=0;e<t.lengths.length;e++){const o=t.lengths[e];for(let e=0;e<o;e++){const o=t.coords[2*(e+r)],l=t.coords[2*(e+r)+1];if(o<-128||o>n||l<-128||l>n)return!0}r+=o}return!1}(t,0,l.tileSize+128))return t;i.setPixelMargin(e),i.reset(r.GeometryType.Polygon);let n=0;for(let e=0;e<t.lengths.length;e++){const r=t.lengths[e];let o=t.coords[2*(0+n)],l=t.coords[2*(0+n)+1];i.moveTo(o,l);for(let e=1;e<r;e++)o=t.coords[2*(e+n)],l=t.coords[2*(e+n)+1],i.lineTo(o,l);i.close(),n+=r}const s=i.result(!1);if(!s)return null;const u=[],c=[];for(const t of s){let e=0;for(const n of t)c.push(n.x),c.push(n.y),e++;u.push(e)}return new o(u,c)},t.triangleAreaArray=f,t.triangulate=function(t,e){const{coords:n,lengths:r}=e,o=t;let l=0;for(let t=0;t<r.length;){let e=t,i=r[t],u=c(n,l,i);const h=[];for(;++e<r.length;){const t=r[e],o=c(n,l+i,t);if(!(o>0))break;u+=o,h.push(l+i),i+=t}const a=o.length;s.bufcut(o,n,l,l+i,h,2,0);const g=f(o,n,a,o.length,0),p=Math.abs(u);if(Math.abs((g-p)/Math.max(1e-7,p))>1e-5)return o.length=0,!1;t=e,l+=i}return!0},t.triangulateEarcut=function(t,n,r){const{coords:o,lengths:l}=n;let s=0;for(let i=0;i<l.length;){let u=i,f=l[i];const h=[];for(;++u<l.length;){const t=l[u];if(!(c(o,s+f,t)>0))break;h.push(s+f-s),f+=t}const a=s+f,g=n.coords.slice(2*s,2*a),p=e.earcut(g,h,2);for(const e of p)t.push(e+r+s);i=u,s+=f}return!0},t.triangulateLibtess=function(t){const{coords:e,lengths:r}=t,{buffer:o}=n.triangulate(e,r);return o},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));