// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../symbols/cim/enums","../../../definitions","./AFillMeshWriter","./FillMeshWriter","./gradientFillConstants","./GradientSizeHelper","./meshWriterUtils","../../../../../../webgl/enums"],(function(e,t,i,r,a,s,n,l,o){"use strict";const d={createComputedParams:e=>e,optionalAttributes:a.fillVertexSpec.optionalAttributes,attributes:{...a.fillVertexSpec.attributes,bitset:{type:o.DataType.UNSIGNED_BYTE,count:1,pack:({gradientSizeUnits:e,gradientType:i})=>{let r=0;return e===t.SymbolUnits.Absolute&&(r|=l.getBitMask(s.bitset.isAbsolute)),"discrete"===i.toLowerCase()&&(r|=l.getBitMask(s.bitset.isDiscrete)),r}},tlbr:{count:4,type:o.DataType.UNSIGNED_SHORT,pack:({sprite:e})=>{const{rect:t,width:r,height:a}=e,s=t.x+i.spritePadding+i.gradientTextureExternalPadding,n=t.y+i.spritePadding;return[s,n,s+r-2*i.gradientTextureExternalPadding,n+a]}},relativePosition:{count:2,type:o.DataType.HALF_FLOAT,packTessellation:({gradientStats:e},t,i,r)=>e?.getRelativePosition(i,r)??[0,0]},relativeGradientSize:{count:2,type:o.DataType.HALF_FLOAT,packTessellation:({gradientStats:e})=>e?.relativeSize??[1,1]},gradientMethod:{count:1,type:o.DataType.UNSIGNED_BYTE,pack:({gradientMethod:e})=>{switch(e.toLowerCase()){case"rectangular":return s.gradientFillMethods.rectangular;case"circular":return s.gradientFillMethods.circular;default:return s.gradientFillMethods.linear}}}}};class c extends r.AFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=d}get _preventEffectClipping(){return!0}createTesselationParams(e){return{gradientStats:n.getGradientSizeHelper(this._unclippedGeometry,this.evaluatedMeshParams)}}_write(e,t,i){const r=i?.asOptimized()??t.readGeometryForDisplay();this._unclippedGeometry=r;const a=this._clip(r);if(!a)return void(this._unclippedGeometry=null);const s=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,s),this._writeGeometry(e,t,a),this._unclippedGeometry=null,e.recordEnd()}}e.GradientFillMeshWriter=c,e.gradientFillVertexSpec=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));