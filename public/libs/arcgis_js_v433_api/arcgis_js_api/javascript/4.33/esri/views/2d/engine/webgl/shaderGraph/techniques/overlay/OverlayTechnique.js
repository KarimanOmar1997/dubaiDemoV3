// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../core/maybe","../../../meshing/Mesh","../../utils","../Technique","../TechniqueType","../shaders/OverlayShader","../../../../../../webgl/enums","../../../../../../webgl/VertexElementDescriptor"],(function(e,t,i,n,s,r,o,a,l){"use strict";class u extends s.Technique{constructor(){super(...arguments),this.type=r.TechniqueType.Overlay,this._mesh=null,this.shaders={overlay:new o.OverlayShader}}render(e,t){const{context:i,painter:s}=e,r=this._getMesh(e,t);s.setPipelineState(n.simplePipelineState);const{isWrapAround:o,wrapAroundShift:l}=t.config,u={...t.config,wrapAroundShift:0},p={shader:this.shaders.overlay,uniforms:{transform:t.transform,config:u},defines:null,optionalAttributes:null,useComputeBuffer:!1};s.setPipelineState({...n.simplePipelineState,stencil:{write:!1,test:{compare:a.CompareFunction.EQUAL,op:{fail:a.StencilOperation.KEEP,zFail:a.StencilOperation.KEEP,zPass:a.StencilOperation.REPLACE},ref:0,mask:255}}}),s.submitDrawMeshUntyped(i,p,r),o&&(u.wrapAroundShift=l,s.submitDrawMeshUntyped(i,p,r))}shutdown(){t.destroyMaybe(this._mesh)}_getMesh(e,t){const{context:n}=e;if(this._mesh){const e=this._mesh.vertexBuffers.get("positions");if(!e)throw new Error("Buffer not found");e.buffer.setData(t.position)}else{const e=null!=t.index?t.index.length:t.position.length/2;this._mesh=new i.Mesh(n,{vertex:{positions:{data:t.position,attributes:[new l.VertexElementDescriptor("pos",2,a.DataType.FLOAT,0,8)]},uvs:{data:t.tex,attributes:[new l.VertexElementDescriptor("uv",2,a.DataType.UNSIGNED_SHORT,0,4)]}},index:null!=t.index?{index:{data:t.index}}:void 0,groups:[{index:null!=t.index?"index":void 0,primitive:a.PrimitiveType.TRIANGLE_STRIP}],parts:[{group:0,start:0,count:e}]})}return this._mesh}}e.OverlayTechnique=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));