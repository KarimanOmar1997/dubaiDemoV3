// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../core/maybe","../../../meshing/Mesh","../../utils","../Technique","../TechniqueType","../shaders/VideoScreenShader","../../../../../../webgl/enums","../../../../../../webgl/VertexElementDescriptor"],(function(e,t,r,n,s,i,o,c,a){"use strict";class u extends s.Technique{constructor(){super(...arguments),this.type=i.TechniqueType.VideoScreen,this._mesh=null,this.shaders={geometry:new o.VideoScreenShader}}render(e,t){const{context:r,painter:s}=e,{texture:i,textureCoords:o}=t,c=this._getMesh(e),a=t.ndcRect[2],u=t.ndcRect[3],h=t.ndcRect[0],d=t.ndcRect[1],p=new Float32Array(180);for(let e=0;e<6;e++){const t=u*e/5;for(let r=0;r<6;r++){const n=a*r/5,{u:s,v:i}=o[6*e+r];p[5*(6*e+r)]=h+n,p[5*(6*e+r)+1]=d-t,p[5*(6*e+r)+2]=s,p[5*(6*e+r)+3]=i,p[5*(6*e+r)+4]=1}}c.vertexBuffers.get("geometry")?.buffer.setData(p);const l={texture:{texture:i,unit:0},opacity:t.opacity},m={shader:this.shaders.geometry,uniforms:{config:l},defines:{},optionalAttributes:null,useComputeBuffer:!1};s.setPipelineState(n.simplePipelineState),s.submitDrawMeshUntyped(r,m,c)}shutdown(){t.destroyMaybe(this._mesh)}_getMesh(e){const{context:t}=e,n=new Uint32Array(150);for(let e=0;e<5;e++)for(let t=0;t<5;t++){const r=6*(5*e+t),s=6*(e+1)+t+1,i=s-1,o=s-6,c=s-7;n[r]=s,n[r+1]=i,n[r+2]=o,n[r+3]=i,n[r+4]=c,n[r+5]=o}return this._mesh||(this._mesh=new r.Mesh(t,{vertex:{geometry:{data:new Float32Array(180),attributes:[new a.VertexElementDescriptor("position",2,c.DataType.FLOAT,0,20),new a.VertexElementDescriptor("texcoord",2,c.DataType.FLOAT,8,20),new a.VertexElementDescriptor("w",1,c.DataType.FLOAT,16,20)]}},index:{index:{data:n}},groups:[{primitive:c.PrimitiveType.TRIANGLES,index:"index"}],parts:[{group:0,start:0,count:n.length}]})),this._mesh}}e.VideoScreenTechnique=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));