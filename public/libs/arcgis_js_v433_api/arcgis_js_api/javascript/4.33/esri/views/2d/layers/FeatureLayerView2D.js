// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define(["./chunks/tslib.es6","./Graphic","./core/accessorSupport/decorators/property","./core/has","./core/Logger","./core/RandomLCG","./core/accessorSupport/decorators/subclass"],(function(e,t,r,i,s,a,n){"use strict";let o=class extends t{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.sourceLayer?.featureReduction;return t&&"popupTemplate"in t&&t.popupEnabled?t.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};return e.__decorate([r.property({type:Boolean})],o.prototype,"isAggregate",void 0),o=e.__decorate([n.subclass("esri.AggregateGraphic")],o),o}))},"esri/TrackGraphic":function(){define(["./chunks/tslib.es6","./Graphic","./core/accessorSupport/decorators/property","./core/has","./core/Logger","./core/RandomLCG","./core/accessorSupport/decorators/subclass"],(function(e,t,r,i,s,a,n){"use strict";let o=class extends t{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.sourceLayer?.trackInfo;return t?.enabled&&t.popupEnabled?t.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};return e.__decorate([r.property({type:Boolean})],o.prototype,"isAggregate",void 0),o=e.__decorate([n.subclass("esri.TrackGraphic")],o),o}))},"esri/layers/effects/FeatureEffectView":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/has","../../core/accessorSupport/decorators/property","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./EffectView"],(function(e,t,r,i,s,a,n,o,l){"use strict";return e.default=class extends r{constructor(e){super(e),this._filter=null,this.duration=i("mapview-transitions-duration"),this._excludedEffectView=new l.EffectView(e),this._includedEffectView=new l.EffectView(e)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(e){this._get("featureEffect")!==e&&this._transitionTo(e)}get filter(){return this._filter||this.featureEffect?.filter||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(e){this._set("scale",e),this._excludedEffectView.scale=e,this._includedEffectView.scale=e}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}get transitioningToEmpty(){return!this._excludedEffectView.final&&!this._includedEffectView.final}transitionStep(e,t){this._set("scale",t),this.transitioning?(this._includedEffectView.transitionStep(e,t),this._excludedEffectView.transitionStep(e,t),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=t,this._includedEffectView.scale=t)}endTransition(){this._includedEffectView.endTransition(),this._excludedEffectView.endTransition(),this._filter=null}_transitionTo(e){const t=this._get("featureEffect"),r=e,i=r?.includedEffect,s=r?.excludedEffect,a=this._includedEffectView.canTransitionTo(i)&&this._excludedEffectView.canTransitionTo(s);this._includedEffectView.effect=i,this._excludedEffectView.effect=s,this._set("featureEffect",r),this._filter=r?.filter||t?.filter||null,a||this.endTransition()}},t.__decorate([s.property()],e.default.prototype,"_filter",void 0),t.__decorate([s.property()],e.default.prototype,"_excludedEffectView",void 0),t.__decorate([s.property()],e.default.prototype,"_includedEffectView",void 0),t.__decorate([s.property()],e.default.prototype,"duration",void 0),t.__decorate([s.property()],e.default.prototype,"excludedEffects",null),t.__decorate([s.property()],e.default.prototype,"featureEffect",null),t.__decorate([s.property()],e.default.prototype,"filter",null),t.__decorate([s.property()],e.default.prototype,"hasEffects",null),t.__decorate([s.property()],e.default.prototype,"includedEffects",null),t.__decorate([s.property({value:0})],e.default.prototype,"scale",null),t.__decorate([s.property()],e.default.prototype,"transitioning",null),t.__decorate([s.property()],e.default.prototype,"transitioningToEmpty",null),e.default=t.__decorate([o.subclass("esri.layers.effects.FeatureEffectView")],e.default),e.default}))},"esri/layers/support/timeSupport":function(){define(["exports","../../support/timeUtils"],(function(e,t){"use strict";e.combineTimeExtent=function(e,r,i){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:s=!1,timeOffset:a,useViewTime:n}=e;let o=e.timeExtent;s&&(o=t.toLocalTimeExtent(o));let l=n?r&&o?r.intersection(o):r||o:o;return!l||l.isEmpty||l.isAllTime?l:(a&&(l=l.offset(-a.value,a.unit)),s&&(l=t.toUTCTimeExtent(l)),l.equals(i)?i:l)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/timeUtils":function(){define(["exports","../core/arrayUtils","../core/lang","../core/timeUtils","../chunks/TimeExtent","../webmap/utils","../webscene/utils"],(function(e,t,r,i,s,a,n){"use strict";function o(e){return void 0!==e.timeInfo}async function l(e,r){if(0===e.length)return s.TimeExtent.allTime;await Promise.all(e.map((e=>e.load({signal:r}))));const i=e.filter(o),a=e.filter((e=>!o(e)&&null!=e.visibilityTimeExtent));if(0===i.length&&0===a.length)return s.TimeExtent.allTime;const n=[],l=[];for(const e of i)"feature"!==e?.type&&"map-image"!==e?.type||!e.timeInfo?.hasLiveData?l.push(e):n.push(e);const u=e=>null==e||e.isAllTime,c=[...l.map((e=>{const t=e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:r}=e;return t?.intersection(r)??r})),...a.map((e=>e.visibilityTimeExtent))];if(c.some(u))return s.TimeExtent.allTime;const d=n.map((async e=>{const t=(await e.fetchRecomputedExtents({signal:r}))?.timeExtent??e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=e;return t?.intersection(i)??i})),p=(await Promise.allSettled(d)).map((e=>"fulfilled"===e.status?e.value:null));if(p.some(u))return s.TimeExtent.allTime;const f=[...p,...c].filter(t.isSome);return 0===f.length?s.TimeExtent.allTime:f.reduce(((e,t)=>e.union(t)))}e.getTimeExtentFromLayers=l,e.getTimeSliderSettingsFromWebDocument=async function(e,t){if(!a.isWebMap(e)&&!n.isWebScene(e))return null;await e.load({signal:t});const i=e?.widgets?.timeSlider;if(!i)return null;const o=await async function(e,t){return e.widgets?.timeSlider?.fullTimeExtent??l(e.allLayers,t)}(e,t),u=i.loop,c=function(e){const t=e.numThumbs??2,r=e.currentTimeExtent;if(r){const{start:e,end:i}=r;return null!=e&&null!=i&&e.getTime()===i.getTime()?"instant":2===t?"time-window":null==e||0===e.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===t?"time-window":"cumulative-from-start"}(i),d=i.stopDelay??2e3,p=function(e){const{numStops:t,stopInterval:i,stops:s}=e;return s?{dates:r.clone(s)}:i?{interval:i.clone()}:{count:t??5}}(i),f=function(e,t){const r=e.currentTimeExtent;if(!r)return null;const{start:i,end:a}=r,n=i??a??null;switch(t){case"time-window":return new s.TimeExtent({start:i,end:a});case"cumulative-from-start":return new s.TimeExtent({start:null,end:n});case"cumulative-from-end":return new s.TimeExtent({start:n,end:null});case"instant":return new s.TimeExtent({start:n,end:n})}}(i,c);return{fullTimeExtent:o,loop:u,mode:c,playRate:d,stops:p,timeExtent:f}},e.toLocalTimeExtent=function(e){if(!e)return e;const{start:t,end:r}=e;return new s.TimeExtent({start:null!=t?i.offsetDate(t,t.getTimezoneOffset(),"minutes"):t,end:null!=r?i.offsetDate(r,r.getTimezoneOffset(),"minutes"):r})},e.toUTCTimeExtent=function(e){if(!e)return e;const{start:t,end:r}=e;return new s.TimeExtent({start:null!=t?i.offsetDate(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=r?i.offsetDate(r,-r.getTimezoneOffset(),"minutes"):r})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/utils":function(){define(["exports","../support/tagSymbols"],(function(e,t){"use strict";e.isWebScene=function(e){return null!=e&&"object"==typeof e&&t.WebSceneTag in e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/tagSymbols":function(){define(["exports"],(function(e){"use strict";const t=Symbol("WebScene");e.WebSceneTag=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/support/AggregateFeatureSet":function(){define(["exports","../../chunks/tslib.es6","../../AggregateGraphic","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../geometry/SpatialReference","./FeatureSet"],(function(e,t,r,i,s,a,n,o,l,u,c){"use strict";return e.default=class extends c{constructor(){super(...arguments),this.features=[]}readFeatures(e,t){const i=u.fromJSON(t.spatialReference),s=[];for(let t=0;t<e.length;t++){const a=e[t],n=r.fromJSON(a),o=a.geometry?.spatialReference;null==n.geometry||o||(n.geometry.spatialReference=i);const l=a.aggregateGeometries,u=n.aggregateGeometries;if(l&&null!=u)for(const e in u){const t=u[e],r=l[e],s=r?.spatialReference;null==t||s||(t.spatialReference=i)}s.push(n)}return s}},t.__decorate([i.property({type:[r],json:{write:!0}})],e.default.prototype,"features",void 0),t.__decorate([o.reader("features")],e.default.prototype,"readFeatures",null),e.default=t.__decorate([l.subclass("esri.rest.support.AggregateFeatureSet")],e.default),e.default}))},"esri/rest/support/AttributeBinsFeatureSet":function(){define(["exports","../../chunks/tslib.es6","../../AttributeBinsGraphic","../../core/Clonable","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","./FeatureSet"],(function(e,t,r,i,s,a,n,o,l,u,c){"use strict";return e.default=class extends(i.ClonableMixin(c)){constructor(){super(...arguments),this.features=[]}readFeatures(e,t){return this.readFeaturesWithClass(e,t,r)}},t.__decorate([s.property({type:[r],json:{write:!0}})],e.default.prototype,"features",void 0),t.__decorate([l.reader("features")],e.default.prototype,"readFeatures",null),e.default=t.__decorate([u.subclass("esri.rest.support.AttributeBinsFeatureSet")],e.default),e.default}))},"esri/AttributeBinsGraphic":function(){define(["exports","./chunks/tslib.es6","./Graphic","./core/Clonable","./core/lang","./core/accessorSupport/decorators/property","./core/has","./core/Logger","./core/accessorSupport/decorators/subclass"],(function(e,t,r,i,s,a,n,o,l){"use strict";var u;return e.default=class extends(i.ClonableMixin(r)){static{u=this}constructor(e){super(e),this.stackedAttributes=null}cloneShallow(){return new u({...super.cloneShallow(),stackedAttributes:this.stackedAttributes})}toJSON(){return{...super.toJSON(),stackedAttributes:s.clone(this.stackedAttributes)}}},t.__decorate([a.property()],e.default.prototype,"stackedAttributes",void 0),e.default=u=t.__decorate([l.subclass("esri.AttributeBinsGraphic")],e.default),e.default}))},"esri/rest/support/AttributeBinsQuery":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../geometry/SpatialReference","../../geometry/support/jsonUtils","../../geometry/support/typeUtils","../../layers/graphics/data/queryUtils","./AutoIntervalBinParameters","./BinParametersBase","./DateBinParameters","./FixedBoundariesBinParameters","./FixedIntervalBinParameters","./spatialRelationships","./StatisticDefinition","../../chunks/TimeExtent","../../time/timeZoneUtils"],(function(e,t,r,i,s,a,n,o,l,u,c,d,p,f,y,h,g,_,m,b,w,S,v,F,I){"use strict";const x=new i.JSONMap({asc:"ascending",desc:"descending"}),T={base:_,key:"type",typeMap:{"auto-interval":g,date:m,"fixed-boundaries":b,"fixed-interval":w}};return e.default=class extends(r.ClonableMixin(s)){constructor(e){super(e),this.binParameters=null,this.binOrder="ascending",this.cacheHint=void 0,this.datumTransformation=null,this.defaultSpatialReference=null,this.distance=void 0,this.geometry=null,this.lowerBoundaryAlias=null,this.outSpatialReference=null,this.outStatistics=null,this.returnDistinctValues=null,this.spatialRelationship="intersects",this.timeExtent=null,this.upperBoundaryAlias=null,this.units=null,this.where="1=1"}set outTimeZone(e){this._set("outTimeZone",e),e&&!I.isTimeZoneValid(e)&&a.getLogger(this).warn("#outTimeZone",`the parsed value '${e}' may not be a valid IANA time zone`)}},t.__decorate([n.property({types:T,json:{name:"bin",write:!0}})],e.default.prototype,"binParameters",void 0),t.__decorate([c.enumeration(x)],e.default.prototype,"binOrder",void 0),t.__decorate([n.property({type:Boolean,json:{write:!0}})],e.default.prototype,"cacheHint",void 0),t.__decorate([n.property({json:{write:!0}})],e.default.prototype,"datumTransformation",void 0),t.__decorate([n.property({type:p,json:{name:"defaultSR",write:!0}})],e.default.prototype,"defaultSpatialReference",void 0),t.__decorate([n.property({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],e.default.prototype,"distance",void 0),t.__decorate([n.property({types:y.geometryTypes,json:{read:f.fromJSON,write:!0}})],e.default.prototype,"geometry",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"lowerBoundaryAlias",void 0),t.__decorate([n.property({type:p,json:{name:"outSR",write:!0}})],e.default.prototype,"outSpatialReference",void 0),t.__decorate([n.property({type:[v],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.outStatistics&&this.outStatistics.length>0}}}}})],e.default.prototype,"outStatistics",void 0),t.__decorate([n.property({value:null,json:{name:"outTimeReference",read:{reader:e=>e.ianaTimeZone},write:{writer:(e,t,r)=>{e&&(t[r]={ianaTimeZone:e})}}}})],e.default.prototype,"outTimeZone",null),t.__decorate([n.property({type:Boolean,json:{write:!0}})],e.default.prototype,"returnDistinctValues",void 0),t.__decorate([c.enumeration(S.spatialRelKebabDict,{name:"spatialRel"})],e.default.prototype,"spatialRelationship",void 0),t.__decorate([n.property({type:F.TimeExtent,json:{write:!0}})],e.default.prototype,"timeExtent",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"upperBoundaryAlias",void 0),t.__decorate([n.property({type:String,json:{read:h.unitsKebabDict.read,write:{writer:h.unitsKebabDict.write,overridePolicy(e){return{enabled:null!=e&&null!=this.distance}}}}})],e.default.prototype,"units",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"where",void 0),e.default=t.__decorate([d.subclass("esri.rest.support.AttributeBinsQuery")],e.default),e.default.from=o.ensureType(e.default),e.default}))},"esri/rest/support/AutoIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],(function(e,t,r,i,s,a,n,o,l,u,c){"use strict";function d(e,t,i){r.setDeepValue(i,e instanceof Date?e.getTime():e,t)}return e.default=class extends(c.NormalizationBinParametersMixin(u)){constructor(e){super(e),this.numBins=null,this.end=null,this.start=null,this.type="auto-interval"}},t.__decorate([i.property({type:Number,json:{name:"parameters.numberOfBins",write:!0}})],e.default.prototype,"numBins",void 0),t.__decorate([i.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([o.enumeration({autoIntervalBin:"auto-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.AutoIntervalBinParameters")],e.default),e.default.from=s.ensureType(e.default),e.default}))},"esri/rest/support/BinParametersBase":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./AttributeBinsGrouping"],(function(e,t,r,i,s,a,n,o,l,u,c,d){"use strict";const p=new i.JSONMap({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeDate:"date",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"}),f=new i.JSONMap({naturalLog:"natural-log",squareRoot:"square-root"});return e.default=class extends(r.ClonableMixin(s)){constructor(e){super(e),this.expression=null,this.expressionValueType=null,this.field=null,this.firstDayOfWeek=null,this.hideUpperBound=null,this.splitBy=null,this.stackBy=null,this.transformation=null}},t.__decorate([a.property({type:String,json:{name:"onExpression.value",write:!0}})],e.default.prototype,"expression",void 0),t.__decorate([u.enumeration(p,{name:"onExpression.valueType"})],e.default.prototype,"expressionValueType",void 0),t.__decorate([a.property({type:String,json:{name:"onField",write:!0}})],e.default.prototype,"field",void 0),t.__decorate([a.property({type:String,json:{write:!0}})],e.default.prototype,"firstDayOfWeek",void 0),t.__decorate([a.property({type:String,json:{write:!0}})],e.default.prototype,"hideUpperBound",void 0),t.__decorate([a.property({type:d,json:{write:{overridePolicy(){return{enabled:null!=this.splitBy?.value||null!=this.splitBy?.type}}}}})],e.default.prototype,"splitBy",void 0),t.__decorate([a.property({type:d,json:{write:{target:{stackBy:{type:d},jsonStyle:{type:String}},writer:(e,t)=>{e&&(t.stackBy=e.toJSON(),null!=e.responseType&&(t.jsonStyle=e.responseType))},overridePolicy(){return{enabled:null!=this.stackBy?.value||null!=this.stackBy?.type}}},read:{source:["stackBy","jsonStyle"],reader:(e,t)=>d.fromJSON({...t.stackBy,responseType:t.jsonStyle})}}})],e.default.prototype,"stackBy",void 0),t.__decorate([u.enumeration(f)],e.default.prototype,"transformation",void 0),e.default=t.__decorate([c.subclass("esri.rest.support.BinParametersBase")],e.default),e.default}))},"esri/rest/support/AttributeBinsGrouping":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,s,a,n,o,l,u){"use strict";const c=new r.JSONMap({esriFieldTypeInteger:"integer",esriFieldTypeString:"string"});let d=class extends(t.ClonableMixin(i)){constructor(e){super(e),this.alias=null,this.responseType=null,this.type=null,this.value=null,this.valueType=null}};e.__decorate([s.property({type:String,json:{name:"outAlias",write:!0}})],d.prototype,"alias",void 0),e.__decorate([s.property({type:String})],d.prototype,"responseType",void 0),e.__decorate([s.property({type:String,json:{write:!0}})],d.prototype,"type",void 0),e.__decorate([s.property({type:String,json:{write:!0}})],d.prototype,"value",void 0),e.__decorate([l.enumeration(c)],d.prototype,"valueType",void 0),d=e.__decorate([u.subclass("esri.rest.support.AttributeBinsGrouping")],d);const p=d;return d.from=a.ensureType(d),p}))},"esri/rest/support/DateBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./DateBinTimeInterval"],(function(e,t,r,i,s,a,n,o,l,u,c){"use strict";function d(e,t,i){r.setDeepValue(i,"string"==typeof e?e:e?.getTime(),t)}function p(e,t){const r=e.parameters[t];return r?"string"==typeof r?r:new Date(r):null}return e.default=class extends u{constructor(e){super(e),this.end=null,this.interval=null,this.offset=null,this.returnFullIntervalBin=!1,this.start=null,this.snapToData=null,this.type="date"}},t.__decorate([i.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.end",read:{reader:(e,t)=>p(t,"end")},write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({type:c,json:{name:"parameters",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([i.property({type:c,json:{name:"parameters.offset",write:!0}})],e.default.prototype,"offset",void 0),t.__decorate([i.property({type:Boolean,json:{name:"parameters.returnFullIntervalBin",write:!0}})],e.default.prototype,"returnFullIntervalBin",void 0),t.__decorate([i.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.start",read:{reader:(e,t)=>p(t,"start")},write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([i.property({type:String,json:{name:"parameters.snapToData",write:!0}})],e.default.prototype,"snapToData",void 0),t.__decorate([o.enumeration({dateBin:"date"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.DateBinParameters")],e.default),e.default.from=s.ensureType(e.default),e.default}))},"esri/rest/support/DateBinTimeInterval":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./DateBinUtils"],(function(e,t,r,i,s,a,n,o,l,u){"use strict";let c=class extends(t.ClonableMixin(r)){constructor(e){super(e),this.value=null,this.unit=null}};e.__decorate([i.property({type:Number,json:{name:"number",write:!0}})],c.prototype,"value",void 0),e.__decorate([o.enumeration(u.unitsDict)],c.prototype,"unit",void 0),c=e.__decorate([l.subclass("esri.rest.support.DateBinTimeInterval")],c);const d=c;return c.from=s.ensureType(c),d}))},"esri/rest/support/DateBinUtils":function(){define(["exports","../../core/jsonMap"],(function(e,t){"use strict";const r=t.strict()({year:"years",quarter:"quarters",month:"months",week:"weeks",day:"days",hour:"hours",minute:"minutes",second:"seconds"});e.unitsDict=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/support/FixedBoundariesBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase"],(function(e,t,r,i,s,a,n,o,l,u){"use strict";return e.default=class extends u{constructor(e){super(e),this.boundaries=[],this.type="fixed-boundaries"}},t.__decorate([i.property({json:{name:"parameters.boundaries",write:{writer:function(e,t,i){r.setDeepValue(i,e&&e[0]instanceof Date?e.map((e=>e.getTime())):e,t)}}}})],e.default.prototype,"boundaries",void 0),t.__decorate([o.enumeration({fixedBoundariesBin:"fixed-boundaries"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedBoundariesBinParameters")],e.default),e.default.from=s.ensureType(e.default),e.default}))},"esri/rest/support/FixedIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],(function(e,t,r,i,s,a,n,o,l,u,c){"use strict";function d(e,t,i){r.setDeepValue(i,e instanceof Date?e.getTime():e,t)}return e.default=class extends(c.NormalizationBinParametersMixin(u)){constructor(e){super(e),this.end=null,this.interval=null,this.start=null,this.type="fixed-interval"}},t.__decorate([i.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.interval",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([i.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([o.enumeration({fixedIntervalBin:"fixed-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedIntervalBinParameters")],e.default),e.default.from=s.ensureType(e.default),e.default}))},"esri/views/2d/layers/LayerView2D":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Collection","../../../core/collectionUtils","../../../core/Error","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../linkChart/utils","../engine/Container","./support/HighlightCounter","./support/util","../support/highlightOptionsUtils","../../layers/support/ClipRect","../../layers/support/Geometry","../../layers/support/Path","../../support/HighlightOptions","../../support/layerViewUtils"],(function(e,t,r,i,s,a,n,o,l,u,c,d,p,f,y,h,g,_,m,b,w){"use strict";const S=r.ofType({key:"type",base:null,typeMap:{rect:g,path:m,geometry:_}}),v=new(r.ofType(b));e.LayerView2DMixin=e=>{let o=class extends e{constructor(){super(...arguments),this._highlightCounter=new f.HighlightCounter,this.attached=!1,this.clips=new S,this.highlights=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){const e=this.view?.spatialReferenceLocked??!0,t=this.view?.spatialReference;t&&e&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new s("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new p.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([a.watch((()=>this.suspended),(e=>{this.container&&(this.container.visible=!e)}),a.syncAndInitial),a.watch((()=>this.updateSuspended),(e=>{this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),a.syncAndInitial),a.watch((()=>this.layer?.opacity??1),(e=>{this.container&&(this.container.opacity=e)}),a.syncAndInitial),a.watch((()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal"),(e=>{this.container&&(this.container.blendMode=e)}),a.syncAndInitial),a.watch((()=>this.layer&&"effect"in this.layer?this.layer.effect:null),(e=>{this.container&&(this.container.effect=e)}),a.syncAndInitial),a.watch((()=>this._mergedHighlights.items.map((e=>({name:e.name,options:{fillColor:e.color,haloColor:e.haloColor,fillOpacity:e.fillOpacity,haloOpacity:e.haloOpacity,haloWidth:e.haloWidth,haloBlur:e.haloBlur}})))),(()=>{this.container.highlightGradient=y.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)}),a.syncAndInitial),a.watch((()=>this._mergedHighlights.items.map((e=>e.name))),(()=>{this._processHighlight()})),a.on((()=>this.clips),"change",(()=>{this.container&&(this.container.clips=this.clips)}),a.syncAndInitial),a.watch((()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null})),(({scale:e,scaleRange:t})=>{const r=w.isInEffectiveScaleRange(t,e);r!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=r)}),a.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e===this&&this.processAttach()}),(()=>{})):this.when().then((()=>{this.processAttach()}),(()=>{})))}destroy(){this.processDetach(),this.updateRequested=!1}get highlightOptions(){return h.getDefaultHighlightOptions(this)}set highlightOptions(e){h.setDefaultHighlightOptions(this,e)}get hasHighlight(){return this._highlightCounter.size>0}get _mergedHighlights(){if(!this.view)return v;if(!this.highlights)return this.view.highlights;const e=this.view.highlights.clone();for(const t of this.highlights){const r=e.find((e=>e.name===t.name));r&&r.assignFrom(t)}return e}get highlightIds(){return Array.from(this._highlightCounter.objectIds)}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const e=this.view?.spatialReference;return null==e||this.supportsSpatialReference(e)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}supportsSpatialReference(e){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;switch(this.layer?.type){case"link-chart":case"knowledge-graph-sublayer":case"graphics":break;default:if(d.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const e=super.getSuspendInfo(),t=!this.spatialReferenceSupported;return t&&(e.spatialReferenceNotSupported=t),e}addAttachHandles(e){this.addHandles(e,"attach")}_addHighlights(e,t){this._highlightCounter.add(e,t)&&this._processHighlight()}_removeHighlights(e,t){this._highlightCounter.delete(e,t)&&this._processHighlight()}_processHighlight(){}_getHighlights(){const e=[];for(const[t,r]of this._highlightCounter.highlightNamesByObjectId){const i=this._getHighlightBits(r);e.push({objectId:t,highlightFlags:i})}return e}_getHighlightBits(e){const t=new Set(e);let r=1,i=0;if(!this.view)return 0;const s=this._mergedHighlights;for(const{name:e}of s)t.delete(e)&&(i=r),r<<=1;return i}};return t.__decorate([n.property()],o.prototype,"attached",void 0),t.__decorate([n.property({type:S,set(e){const t=i.referenceSetter(e,this._get("clips"),S);this._set("clips",t)}})],o.prototype,"clips",void 0),t.__decorate([n.property()],o.prototype,"container",void 0),t.__decorate([n.property({type:b})],o.prototype,"highlightOptions",null),t.__decorate([n.property({type:r.ofType(b)})],o.prototype,"highlights",void 0),t.__decorate([n.property()],o.prototype,"_mergedHighlights",null),t.__decorate([n.property()],o.prototype,"moving",void 0),t.__decorate([n.property({readOnly:!0})],o.prototype,"spatialReferenceSupported",null),t.__decorate([n.property({readOnly:!0})],o.prototype,"updateParameters",void 0),t.__decorate([n.property()],o.prototype,"updateRequested",void 0),t.__decorate([n.property()],o.prototype,"updating",null),t.__decorate([n.property()],o.prototype,"view",void 0),t.__decorate([n.property()],o.prototype,"_visibleAtCurrentScale",void 0),t.__decorate([n.property({readOnly:!0})],o.prototype,"visibleAtCurrentScale",null),o=t.__decorate([c.subclass("esri.views.2d.layers.LayerView2D")],o),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/linkChart/utils":function(){define(["exports"],(function(e){"use strict";e.isLinkChartView=function(e){return null!=e&&"object"==typeof e&&"2d"===e.type&&"linkchart"===e.view2dType},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/support/HighlightCounter":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/MapUtils","../../../../core/ReactiveMap","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,s,a,n,o,l,u){"use strict";e.HighlightCounter=class extends r{constructor(){super(...arguments),this._idToCounters=new s}get size(){return this._idToCounters.size}get objectIds(){return this._idToCounters.keys()}get highlightNamesByObjectId(){return function*(e){for(const[t,r]of e)yield[t,r.keys()]}(this._idToCounters)}add(e,t){let r=!1;for(const s of e){const e=i.getOrCreateMapValue(this._idToCounters,s,(()=>(r=!0,new Map))),a=e.get(t)??0;a||(r=!0),e.set(t,a+1)}return r}delete(e,t){let r=!1;for(const i of e){const e=this._idToCounters.get(i);if(!e)continue;let s=e.get(t);null!=s&&(s--,s>0?e.set(t,s):(e.delete(t),r=!0),0===e.size&&(this._idToCounters.delete(i),r=!0))}return r}},e.HighlightCounter=t.__decorate([u.subclass("esri.views.2d.layers.support.HighlightCounter")],e.HighlightCounter),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/support/ClipRect":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],(function(e,t,r,i,s,a,n,o){"use strict";var l;return e.default=l=class extends o{constructor(e){super(e),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}},t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"left",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"right",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"top",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"bottom",void 0),e.default=l=t.__decorate([n.subclass("esri.views.layers.support.ClipRect")],e.default),e.default}))},"esri/views/layers/support/ClipArea":function(){define(["exports","../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,s,a,n,o){"use strict";return e.default=class extends r{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}},t.__decorate([i.property({readOnly:!0})],e.default.prototype,"version",null),e.default=t.__decorate([o.subclass("esri.views.layers.support.ClipArea")],e.default),e.default}))},"esri/views/layers/support/Geometry":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/Extent","../../../geometry/Geometry","../../../geometry/Polygon","../../../geometry/support/jsonUtils","./ClipArea"],(function(e,t,r,i,s,a,n,o,l,u,c,d){"use strict";var p;const f={base:l,key:"type",typeMap:{extent:o,polygon:u}};return e.default=p=class extends d{constructor(e){super(e),this.type="geometry",this.geometry=null}clone(){return new p({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}},t.__decorate([r.property({types:f,json:{read:c.fromJSON,write:!0}})],e.default.prototype,"geometry",void 0),e.default=p=t.__decorate([n.subclass("esri.views.layers.support.Geometry")],e.default),e.default}))},"esri/views/layers/support/Path":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],(function(e,t,r,i,s,a,n,o){"use strict";return e.default=class extends o{constructor(e){super(e),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}},t.__decorate([r.property({type:[[[Number]]],json:{write:!0}})],e.default.prototype,"path",void 0),e.default=t.__decorate([n.subclass("esri.views.layers.support.Path")],e.default),e.default}))},"esri/views/2d/layers/features/FeatureContainer":function(){define(["exports","../../../../core/has","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/support/UpdatingHandles","../../engine/AFeatureContainer","../../engine/webgl/enums","../../engine/webgl/shaderGraph/techniques/FeatureInstanceStore","../../engine/webgl/shaderGraph/techniques/TechniqueRegistry","../../engine/webgl/shaderGraph/techniques/TechniqueType","./RenderState","../support/util"],(function(e,t,r,i,s,a,n,o,l,u,c,d){"use strict";class p{constructor(e,t){this.id=e,this.version=t,this._resolver=i.createResolver(),this._done=!1}get done(){return this._done}get promise(){return this._resolver.promise}end(){this._resolver.resolve(),this._done=!0}destroy(){this._resolver.reject()}}class f extends a.AFeatureContainer{constructor(e){super(e.view.featuresTilingScheme),this.updatingHandles=new s.UpdatingHandles,this._hitTestsRequests=[],this._store=new o,this._visibleTiles=new Set,this._subscriptions=new Map,this._updateStatisticsRequests=[],this._lockStatisticUpdates=!1,this._shouldUnlockAttributeView=!1,this._layerView=e,this.addTransitionable(this._layerView.featureEffectView)}destroy(){super.destroy(),this._renderState=r.destroyMaybe(this._renderState),this._renderStateNext=r.destroyMaybe(this._renderStateNext)}renderChildren(e){if(this._updateAttributeView(),this._renderState?.update(this.attributeView.currentEpoch),this._layerView.requestUpdate(),this._renderState){const e=Array.from(this._renderState.tiles()).filter((e=>e.needsUpload));e.length&&(e[Math.floor(Math.random()*e.length)].upload(),e.length>=2&&this.requestRender());for(const e of this._renderState.tiles())e.tryReady(this.attributeView.currentEpoch)&&(this._subscriptions.get(e.key.id)?.end(),this._layerView.requestUpdate(),this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this._layerView.view.labelManager.symbolFader.restartDeclutter(),this.requestRender())}const t=this._layerView.subscriptionManager.updateVisibility();this.setVisibleTiles(t);for(const t of this.children)t.setTransform(e.state);switch(super.renderChildren(e),e.drawPhase){case n.WGLDrawPhase.MAP:return this._renderMapPhase(e);case n.WGLDrawPhase.HIGHLIGHT:return this._renderHighlightPhase(e);case n.WGLDrawPhase.LABEL:return this._renderLabelPhase(e)}}subscriptions(){return this._subscriptions.values()}get _instanceStore(){return this._store}get instanceStore(){return this._store}get layerView(){return this._layerView}get hasLabels(){return this._layerView.labelingCollisionInfos.length>0}get hasHighlight(){return this._layerView.hasHighlight}get _layer(){return this._layerView.layer}_getHeatmapInstance(e){if(null==this._instanceStore||!(e.drawPhase&l.Techniques.heatmap.drawPhase))return null;for(const e of this._instanceStore.values())if(y(e))return e;return null}get tiles(){return this._renderState?.tiles()}get children(){return this._renderState?Array.from(this._renderState.tiles()).filter((e=>this._visibleTiles.has(e.key.id))):[]}updateAttributeView(e){this.requestRender(),this.attributeView.requestUpdate(e),this.hasLabels&&(this._layerView.view.labelManager.requestUpdate(),this._layerView.view.labelManager.symbolFader.restartDeclutter())}updateSubscriptions(e){for(const{tileId:t,version:r}of e.subscribe)if(this._subscriptions.has(t))this._subscriptions.get(t).version=r;else{const e=new p(t,r);this._subscriptions.set(t,e),this.updatingHandles.addPromise(e.promise)}for(const t of e.unsubscribe){const e=this._subscriptions.get(t);e?.destroy(),this._subscriptions.delete(t),this.removeTile(t)}}isDone(e){return!!this._renderState&&this._renderState.isTileDone(e)}async updateRenderState(e){t("esri-2d-update-debug")&&console.debug(`Version[${e}] FeatureContainer.updateRenderState`),this._renderStateNext=new c.RenderState((()=>this._stage),(e=>this._subscriptions.get(e)?.version),e,this.layerView.view.labelManager.symbolFader,this,this.tileInfoView)}getDisplayStatistics(e,t){const r=this._statisticsByLevel.get(e);return r?r.get(t):null}updateStatistics(e,t){if(this._lockStatisticUpdates)return void this._updateStatisticsRequests.push({level:e,statistics:t});let r=this._statisticsByLevel.get(e);r||(r=new Map,this._statisticsByLevel.set(e,r));for(const e of t)r.set(e.fieldName,{minValue:e.minValue,maxValue:e.maxValue})}lockForOverrides(){this._renderState?.lockUploads(),this._lockStatisticUpdates=!0,this.attributeView.locked||(this.attributeView.lockTextureUploads(),this._shouldUnlockAttributeView=!0)}unlockForOverrides(){this._renderState?.unlockUploads(),this._shouldUnlockAttributeView&&(this.attributeView.unlockTextureUploads(),this._shouldUnlockAttributeView=!1),this._lockStatisticUpdates=!1;for(const e of this._updateStatisticsRequests)this.updateStatistics(e.level,e.statistics);this._updateStatisticsRequests=[],this._renderState?.flush(),this.requestRender()}trySwapRenderState(){if(this._renderStateNext){t("esri-2d-update-debug")&&console.debug(`Version[${this._renderStateNext.version}] FeatureContainer.update.swapRenderState`);const e=new Map;for(const t of this._renderState?.tiles()||[])e.set(t.id,t.metricsVisibility);this._renderState?.destroy(),this._renderState=this._renderStateNext,this._renderState.flush();for(const t of this._renderState.tiles())t.copyMetricsVisibility(e.get(t.id)||new Set);this._renderStateNext=null}this.requestRender()}setVisibleTiles(e){this._visibleTiles=e;for(const t of this.tiles??[])t.rendering=e.has(t.key.id)}async onMessage(e,r){i.throwIfAborted(r);const s=e.inner;if(!this._subscriptions.has(s.id))return;const a=this._subscriptions.get(s.id);if(a.version!==s.subscriptionVesrion){if(t("esri-2d-update-debug")){const e=`${s.subscriptionVesrion} != ${a.version}`;console.debug(`Version[${e}] Tile[${s.id}] FeatureContainer - Dropping message, outdated version]`,s)}return}const n=this._renderStateNext??this._renderState;if(!n)throw new Error("InternalError: No renderState defined");n.version!==s.version&&console.error(`InternalError: Version mismatch. [renderState: ${n.version}, message: ${s.version}]`),n.enqueueUpdate(e),this.requestRender(),this._layerView.view.labelManager.requestUpdate(),this._layerView.requestUpdate()}removeTile(e){(this._renderState||this._renderStateNext)&&(this._renderState&&this._renderState.removeTile(e),this._renderStateNext&&this._renderStateNext.removeTile(e))}hitTest(e){let t=this._hitTestsRequests.find((({x:t,y:r})=>t===e.x&&r===e.y));const r=i.createResolver();return t?t.resolvers.push(r):(t={x:e.x,y:e.y,resolvers:[r]},this._hitTestsRequests.push(t)),this.requestRender(),r.promise}getSortKeys(e){const t=new Set(e),r=new Map;for(const e of this.children)if(e.getSortKeys(t).forEach(((e,t)=>r.set(t,e))),r.size===t.size)break;return r}get hasAnimation(){return this.hasLabels}doRender(e){const{minScale:t,maxScale:r}=this._layer.effectiveScaleRange,i=e.state.scale;i<=(t||1/0)&&i>=r&&super.doRender(e)}afterRender(e){super.afterRender(e),this._hitTestsRequests.length&&this.requestRender()}setStencilReference(e){if(null==this._getHeatmapInstance(e))super.setStencilReference(e);else for(const e of this.children)e.stencilRef=l.Techniques.heatmap.getStencilReference(e)}_renderMapPhase(e){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(e),this._renderInsideEffect(e)):this._renderFeatures(e,n.FeatureSelection.All),this._hitTestsRequests.length>0&&this._renderHittest(e)}_renderHighlightPhase(e){this.hasHighlight&&d.renderHighlight(e,!1,(e=>{this._renderFeatures(e,n.FeatureSelection.Highlight)}))}_renderLabelPhase(e){this._renderFeatures(e,n.FeatureSelection.All)}_renderInsideEffect(e){const t=e.painter.effects.insideEffect;t.bind(e),this._renderFeatures(e,n.FeatureSelection.InsideEffect),t.draw(e,this._layerView.featureEffectView.includedEffects),t.unbind()}_renderOutsideEffect(e){const t=e.painter.effects.outsideEffect;t.bind(e),this._renderFeatures(e,n.FeatureSelection.OutsideEffect),t.draw(e,this._layerView.featureEffectView.excludedEffects),t.unbind()}_renderHittest(e){const{context:t}=e,r=e.painter.effects.hittest,i=t.getBoundFramebufferObject(),s=t.getViewport(),a=e.passOptions,o=e.drawPhase;r.bind(e),e.passOptions=r.createOptions(e,this._hitTestsRequests),e.drawPhase=n.WGLDrawPhase.HITTEST;const{distance:l,smallSymbolDistance:u}=e.passOptions,c=Math.max(l,u);for(const t of this.children)t.visible&&t.containsScreenPoint(e.state,e.passOptions.position,2*c)&&this._renderTile(t,e,n.FeatureSelection.All);r.draw(e),r.unbind(),t.bindFramebuffer(i),t.restoreViewport(s),e.passOptions=a,e.drawPhase=o}_renderFeatures(e,t){const r=this._getHeatmapInstance(e);null!=r?this._renderHeatmapFeatures(e,t,r):this._renderGeometryFeatures(e,t)}_renderGeometryFeatures(e,t){for(const r of this.children)r.visible&&this._renderTile(r,e,t)}_renderHeatmapFeatures(e,t,r){for(const r of this.children)r.visible&&this._renderTile(r,e,t,u.TechniqueType.Heatmap);r.techniqueRef.renderResolvePass(e,r)}_renderTile(e,r,i,s){const a=t("featurelayer-strict-draw-order")?n.FeatureBatchingStrategy.STRICT_ORDER:t("featurelayer-force-marker-text-draw-order")?n.FeatureBatchingStrategy.STRICT_MARKERS_AND_TEXT:n.FeatureBatchingStrategy.BATCHING,o=e.getDisplayList(this._instanceStore,a);r.selection=i,o?.render(r,s)}}function y(e){return e.techniqueRef.type===u.TechniqueType.Heatmap}e.FeatureContainer=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/FeatureInstanceStore":function(){define(["../../../../../../core/string","./TechniqueInstance","./mesh/instanceIdUtils"],(function(e,t,r){"use strict";return class{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}entries(){return this._instanceById.entries()}find(e){for(const t of this.values())if(t.techniqueRef.type===e)return t;return null}updateStart(e){e&&(this._instanceByIdNext=new Map,this._shaderCountByMesh=new Map,this._shaderIndices=new Map)}updateEnd(e){if(e){if(!this._instanceByIdNext)throw new Error("InternalError: Found updateEnd call without corresponding updateStart");for(const e of this._instanceById.keys())this._instanceByIdNext.has(e)||this._instanceById.delete(e);for(const[e,t]of this._instanceByIdNext.entries()){const r=this._instanceById.get(e);r?r.setInput(t.getInput()):this._instanceById.set(e,t)}this._instanceByIdNext=null,this._shaderCountByMesh=null,this._shaderIndices=null}}values(){return this._instanceById.values()}ensureInstance(i,s){let a;if("object"==typeof s&&"optionalAttributes"in s&&"uniforms"in s){const e=`${i.type}.${JSON.stringify(s.optionalAttributes)}`,t=e+`.${JSON.stringify(s.uniforms)}`;let r=0;null!=this._instanceByIdNext&&(this._shaderIndices.has(t)?r=this._shaderIndices.get(t):(r=this._shaderCountByMesh.get(e)??0,this._shaderCountByMesh.set(e,r+1),this._shaderIndices.set(t,r))),a=e+`.${r}`}else a=`${i.type}.${JSON.stringify(s)}`;const n=e.numericHash(a);if(this._instanceByIdNext){const e=new t.FeatureTechniqueInstance(r.castInstanceId(n),i,s);return this._instanceByIdNext.set(n,e),e}if(!this._instanceById.has(n)){const e=new t.FeatureTechniqueInstance(r.castInstanceId(n),i,s);this._instanceById.set(n,e)}return this._instanceById.get(n)}getInstance(e){const t=this._instanceById.get(e);if(null==t)throw new Error(`InternalError: Unable to get instance for ${e}`);return t}}}))},"esri/views/2d/layers/features/RenderState":function(){define(["exports","../../../../core/CircularArray","../../../../core/Error","../../../../core/has","../../../../core/Logger","../../../../geometry/support/aaBoundingRect","../../tiling/TileInfoView","../../tiling/TileKey","../../tiling/TileQueue","../../tiling/TileStrategy","../../engine/webgl/FeatureTile","../../engine/webgl/shaderGraph/techniques/TechniqueType"],(function(e,t,r,i,s,a,n,o,l,u,c,d){"use strict";e.RenderState=class{constructor(e,r,i,s,a,n){this.getStage=e,this.getSubscriptionVersion=r,this.version=i,this._fader=s,this._container=a,this._tileInfoView=n,this._pendingUpdates=new t(1e3),this._locked=!1,this._tiles=new Map}destroy(){for(const e of this.tiles())this._fader.unregisterFeatureTile(e),e.destroy();this._pendingUpdates.clear(),this._tiles.clear(),this._container=null,this._fader=null}tiles(){return this._tiles.values()}size(){return this._tiles.size}getTile(e){return this._tiles.get(e)}setTiles(e){this._tiles.clear();for(const t of e)this._tiles.set(t.key.id,t)}lockUploads(){this._locked=!0}unlockUploads(){this._locked=!1,this.flush()}enqueueUpdate(e){this._pendingUpdates.enqueue(e)}update(e){if(!this._locked)for(;this._pendingUpdates.size;){const t=this._pendingUpdates.peek();if(null==t||t.inner.attributeEpoch>e)break;this._updateTile(t),this._pendingUpdates.dequeue()}}removeTile(e){const t=this._tiles.get(e);i("esri-2d-update-debug")&&console.debug(`Tile[${e}] RenderState.removeTile`),t&&(this._fader.unregisterFeatureTile(t),t.destroy()),this._tiles.delete(e)}isTileDone(e){const t=this._tiles.get(e.id);return!!t&&t.isReady&&t.decluttered}flush(){for(;this._pendingUpdates.size;){const e=this._pendingUpdates.dequeue();null!=e&&this._updateTile(e)}for(const e of this._tiles.values())e.upload()}_updateTile(e){const{inner:t,objectIdMap:r}=e,s=this.getSubscriptionVersion(t.id);if(s!==t.subscriptionVesrion){if(i("esri-2d-update-debug")){const e=`${t.subscriptionVesrion} != ${s}`;console.debug(`Version[${e}] Tile[${t.id}] FeatureContainer - Dropping message, outdated version]`,t)}return}if(i("esri-2d-update-debug")){const e=t.debugInfo?.chunkId??"<EnsureEnd>";console.debug(`Version[${t.version}] Tile[${t.id}] Chunk[${e}] RenderState.updateTile [${t.type}]`,t)}const a=this._ensureTile(t.id);if("update"===t.type){const[e,...i]=t.modify;a.onMessage({type:"update",modify:e,remove:t.remove,end:t.end,attributeEpoch:t.attributeEpoch,objectIdMap:r});for(const e of i){const i=this._tiles.get(e.tileId);i&&i.onMessage({type:"update",modify:e,remove:t.remove,end:!1,isPixelBuffer:!0,attributeEpoch:null,objectIdMap:r})}return}if(null==t.append)return void a.onMessage({type:"append",clear:t.clear,debugInfo:t.debugInfo,end:t.end,attributeEpoch:t.attributeEpoch,objectIdMap:r});const[n,...o]=t.append;a.onMessage({type:"append",clear:t.clear,append:n,debugInfo:t.debugInfo,end:t.end,attributeEpoch:t.attributeEpoch,objectIdMap:r});for(const e of o){const t=this._tiles.get(e.tileId);t&&t.onMessage({type:"update",modify:e,remove:[],sort:!1,end:!1,isPixelBuffer:!0,attributeEpoch:null,objectIdMap:r})}}_ensureTile(e){if(!this._tiles.has(e)){const t=this._createTile(e);this._copyPixelBufferedEntitiesInto(t),this._tiles.set(e,t)}return this._tiles.get(e)}_createTile(e){i("esri-2d-update-debug")&&console.debug(`Version[${this.version}] Tile[${e}] RenderState.createTile`);const t=new o(e),n=this._tileInfoView.getTileBounds(a.create(),t),l=n[0],u=n[3],p=this._tileInfoView.getTileResolution(t.level),f=this._container.instanceStore.find(d.TechniqueType.Label)?.instanceId,y=new c.FeatureTile(t,p,l,u,this._fader,f,!0);if(this._fader.registerFeatureTile(y),y.stage=this.getStage(),!y.stage){const e=new r("featurelayerview:webgl","Cannot create tile with empty stage");s.getLogger("esri.views.2d.layers.features.RenderState").error(e)}return y}_copyPixelBufferedEntitiesInto(e){let t=7;const r=this._tileInfoView.getLODInfoAt(e.key);for(let i=-1;i<=1;i++)for(let s=-1;s<=1;s++){if(0===i&&0===s)continue;const a=e.key.getNormalizedNeighbor(s,i,r).id,n=this._tiles.get(a);if(null!=n){const r=1<<t;e.copyPixelBufferedEntitesFrom(n,r,s,i)}t--}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/FeaturePipelineWorkerProxy":function(){define(["exports","../../../../core/workers/workers"],(function(e,t){"use strict";class r{constructor(e){this._connection=e,this.pipeline=this._connection.createInvokeProxy(),this.features=this._connection.createInvokeProxy("features"),this.aggregates=this._connection.createInvokeProxy("aggregates"),this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}destroy(){this._connection.destroy()}get closed(){return this._connection.closed}}e.FeaturePipelineWorkerProxy=r,e.createFeaturePipelineWorkerProxy=async function(e){const i=await t.open("FeaturePipelineWorker",{client:e,strategy:"dedicated"});return new r(i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/FeatureSourceEventLog":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/CircularArray","../../../../core/Evented","../../../../core/ReactiveMap","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,s,a,n,o,l,u,c){"use strict";e.FeatureSourceEventLog=class extends r{constructor(){super(...arguments),this.events=new s,this._updatingStrategy=!0,this._tileToEvent=new a,this._fetchStatus={outstanding:0,done:0}}get hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}get willQueryAllFeatures(){return this._strategyInfo?.willQueryAllFeatures??!1}get willQueryFullResolutionGeometry(){return this._strategyInfo?.willQueryAllFeatures??!1}onEvent(e){switch(e.type){case"subscribe":case"unsubscribe":case"loaded":case"error":this._handleTileEvent(e);break;case"updateStrategyStart":this._updatingStrategy=!0,this._fetchStatus={done:0,outstanding:0},this._strategyInfo=e.about;break;case"updateStrategyEnd":this._updatingStrategy=!1;break;case"updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case"updateFieldsEnd":break;case"updateFieldsError":this.events.emit("error",e);break;case"fetchStart":this._fetchStatus.outstanding+=1,this.events.emit("status",this._fetchStatus);break;case"fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),e.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllTileData(){for(const e of this._tileToEvent.values()){const t=e.peekLast();if("loaded"!==t?.type)return!1}return!0}_handleTileEvent(e){switch(e.type){case"subscribe":{const t=new i(10);t.enqueue(e),this._tileToEvent.set(e.tile,t);break}case"unsubscribe":this._tileToEvent.delete(e.tile);break;case"loaded":{const t=this._tileToEvent.get(e.tile);if(!t)return;t.enqueue(e),this._tileToEvent.set(e.tile,t);break}case"error":{const t=this._tileToEvent.get(e.tile);if(!t)return;t.enqueue(e),this._tileToEvent.set(e.tile,t),this.events.emit("error",e);break}}}},t.__decorate([n.property({readOnly:!0})],e.FeatureSourceEventLog.prototype,"hasAllData",null),t.__decorate([n.property()],e.FeatureSourceEventLog.prototype,"willQueryAllFeatures",null),t.__decorate([n.property()],e.FeatureSourceEventLog.prototype,"willQueryFullResolutionGeometry",null),t.__decorate([n.property()],e.FeatureSourceEventLog.prototype,"_updatingStrategy",void 0),t.__decorate([n.property()],e.FeatureSourceEventLog.prototype,"_strategyInfo",void 0),t.__decorate([n.property()],e.FeatureSourceEventLog.prototype,"_tileToEvent",void 0),e.FeatureSourceEventLog=t.__decorate([c.subclass("esri.views.2d.layers.features.FeatureSourceEventLog")],e.FeatureSourceEventLog),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/CatalogFootprintLayerAdapter":function(){define(["exports","../../../../../core/lang","../../../../../layers/support/arcgisLayerUrl","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,i,s,a,n,o){"use strict";e.CatalogFootprintLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=s.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:s.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const s=this.layer,{capabilities:a,editingInfo:n,objectIdField:o,globalIdField:l,datesInUnknownTimezone:u,dateFieldsTimeZone:c,orderBy:d,parsedUrl:p}=s,f=s.fieldsIndex.toJSON(),y=i.getServiceGeometryType(s),h=s.timeInfo?.toJSON(),g=s.spatialReference.toJSON(),_=t.clone(p);let m=o;if(d?.length){const e=!d[0].valueExpression&&d[0].field;e&&(m=e)}const b=r.isHostedAgolService(_.path),w=e.spatialReference.toJSON();return{type:"feature-service",source:_,isSourceHosted:b,orderByFields:m,outSpatialReference:w,metadata:{timeReferenceUnknownClient:u,dateFieldsTimeZone:c,globalIdField:l,fieldsIndex:f,geometryType:y,featureIdInfo:{type:"object-id",fieldName:o},timeInfo:h,spatialReference:g,outSpatialReference:w,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:n?.lastEditDate?.getTime(),snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:r,displayFilterInfo:i,customParameters:s,timeExtent:n,apiKey:o}=this.layer,l={definitionExpression:r,displayFilterInfo:i,customParameters:s,timeExtent:n};return a.createFeatureSourceSchema(l,e,t,o)}createProcessorSchema(e,t,r){const{fields:i,geometryType:s,orderBy:a,objectIdField:o,renderer:l,labelingInfo:u,labelsVisible:c}=this.layer,d={featureReduction:null,labelingInfoSource:this.layer.id,fields:i.map((e=>e.toJSON())),geometryType:s,labelingInfo:u,labelsVisible:c,objectIdField:o,orderBy:a??"default",renderer:l?.clone()};return n.createSimpleProcessorSchema(e,t,d,r)}get hasRequiredSupport(){return o.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>this.layer.definitionExpression,()=>this.layer.outFields,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy]}setGraphicOrigin(e){e.origin={type:"catalog",layer:this.layer}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/geometryUtils":function(){define(["exports"],(function(e){"use strict";e.getServiceGeometryType=function(e){switch(e.geometryType){case"point":return"esriGeometryPoint";case"polyline":return"esriGeometryPolyline";case"mesh":case"polygon":return"esriGeometryPolygon";case"multipatch":return"esriGeometryMultiPatch";case"multipoint":return"esriGeometryMultipoint";default:return null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/labelingUtils":function(){define(["exports","../../../../../core/screenUtils","./featureReductionUtils","../../support/visualVariableSimpleUtils"],(function(e,t,r,i){"use strict";function s(e){return r=>t.pt2px(i.getSizeForValueSimple(r,e))}e.createLabelVVEvaluator=function(e){const t=null!=e&&"visualVariables"in e&&e.visualVariables;if(!t)return null;for(const e of t)if("size"===e.type)return s(e);return null},e.getFeatureReductionDeconflictionEnabled=function(e,t){const i=r.getEffectiveFeatureReduction(e,t);if(i?.labelsVisible&&i.labelingInfo?.length)return i.labelingInfo.every((e=>"none"!==e.deconflictionStrategy))},e.getLayerDeconflictionEnabled=function(e){return(e.labelsVisible&&e.labelingInfo?.every((e=>"none"!==e.deconflictionStrategy)))??!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/featureReductionUtils":function(){define(["exports"],(function(e){"use strict";e.getEffectiveFeatureReduction=function(e,t){const r=e.featureReduction;return r&&"selection"!==r.type&&(!("maxScale"in r)||!r.maxScale||r.maxScale<t.scale)?r:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/support/visualVariableSimpleUtils":function(){define(["exports","../../../../core/mathUtils","../../../../renderers/support/lengthUtils","../../../../renderers/visualVariables/support/sizeVariableUtils"],(function(e,t,r,i){"use strict";const s=Math.PI;function a(e,a){switch(a.transformationType){case i.TransformationType.Additive:return function(e,t){return e+(n(t.minSize,e)||t.minDataValue)}(e,a);case i.TransformationType.Constant:return function(e,t){const r=e.stops;let i=r?.length&&r[0].size;return null==i&&(i=e.minSize),n(i,t)}(a,e);case i.TransformationType.ClampedLinear:return function(e,t){const r=t.minDataValue,i=t.maxDataValue,s=(e-r)/(i-r),a=n(t.minSize,e),o=n(t.maxSize,e);return e<=r?a:e>=i?o:a+s*(o-a)}(e,a);case i.TransformationType.Proportional:return function(e,r){const i=e/r.minDataValue,s=n(r.minSize,e),a=n(r.maxSize,e);let o=null;return o=i*s,t.clamp(o,s,a)}(e,a);case i.TransformationType.Stops:return function(e,t){const[r,i,s]=function(e,t){if(!t)return;let r=0,i=t.length-1;return t.some(((t,s)=>e<t?(i=s,!0):(r=s,!1))),[r,i,(e-t[r])/(t[i]-t[r])]}(e,t.cache.ipData);if(r===i)return n(t.stops[r].size,e);{const a=n(t.stops[r].size,e);return a+(n(t.stops[i].size,e)-a)*s}}(e,a);case i.TransformationType.RealWorldSize:return function(e,i){const a=r.meterIn[i.valueUnit],o=n(i.minSize,e),l=n(i.maxSize,e),{valueRepresentation:u}=i;let c=null;return c="area"===u?2*Math.sqrt(e/s)/a:"radius"===u||"distance"===u?2*e/a:e/a,t.clamp(c,o,l)}(e,a);case i.TransformationType.Identity:return e;case i.TransformationType.Unknown:return null}}function n(e,t){return"number"==typeof e?e:a(t,e)}e.getSizeForValueSimple=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/schema/SourceSchema":function(){define(["exports","../../../../../core/sql"],(function(e,t){"use strict";e.createFeatureSourceSchema=function(e,r,i,s){const a=null!=e.subtypeCode?`${e.subtypeField} = ${e.subtypeCode}`:null,n=t.sqlAnd(e.definitionExpression,a),o=e.customParameters??{},l=r.displayFilterEnabled&&e.displayFilterInfo?e.displayFilterInfo.toJSON():null;return s&&(o.token=s),{type:"feature",mutable:{sourceRefreshVersion:i,availableFields:r.availableFields,displayFilterInfo:l,dataFilter:{definitionExpression:n,customParameters:o,gdbVersion:e.gdbVersion,historicMoment:e.historicMoment?.getTime(),queryScaleRanges:e.queryScaleRanges??[],timeExtent:e.timeExtent?.toJSON()}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/schema/processor/SimpleProcessorSchema":function(){define(["exports","../../../../../../core/screenUtils","../../../../../../layers/support/OrderByInfo","../../../../engine/webgl/shaderGraph/techniques/TechniqueType","./LabelMatcherSchema","./MatcherSchema","./StorageSchema","./VisualVariablesSchema"],(function(e,t,r,i,s,a,n,o){"use strict";function l(e,t){return e.fields.map((e=>({...e.toJSON(),type:u(e,t)})))}function u(e,t){const{onStatisticExpression:r,onStatisticField:i,statisticType:s}=e;switch(s){case"min":case"max":case"avg":case"avg_angle":case"sum":case"count":return"esriFieldTypeDouble";case"mode":{if(r){const{returnType:e}=r;return e?"string"===e?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"}const e=t.find((e=>e.name===i));return e?e.type:"esriFieldTypeString"}}}function c(e){return e.techniqueType===i.TechniqueType.AnimatedMarker}function d(e){if("simple"===e.type&&e.meshes.some(c))return!0;if("interval"===e.type){if(e.intervals.some((e=>e.meshes.some(c))))return!0;if(e.backgroundFill.some(c))return!0}if("map"===e.type){if(e.map.some((e=>e.symbol.some(c))))return!0;if(e.backgroundFill.some(c))return!0}return!1}e.createSimpleProcessorSchema=async function(e,i,u,c){const p=u.featureReduction;if(p)switch(p.type){case"binning":return async function(e,r,i,u,c){const p=l(e,u.fields),f=e.renderer,y=await a.createMatcherSchema(r,f),h=n.createStorageSchema(f,[null,null]),g=o.createVisualVariableUniforms(f),_=await s.createLabelMatcherSchema(r,{geometryType:"polygon",labelingInfoSource:u.labelingInfoSource+"-binning",labelingInfo:e.labelingInfo,labelsVisible:e.labelsVisible},g),m=d(y),b="geohash"===e.binType?{type:"geohash",fixBinLevel:e.fixedBinLevel??3}:{type:"grid",size:t.pt2px(e.size),fixedBinLevel:e.fixedBinLevel};return{storage:h,mesh:{properties:{sortKey:null,timeZone:i.timeZone,returnMeshObjectId:m,displayRefreshVersion:c,currentUser:i.currentUser},strategy:{type:"binning",fields:p,index:b,featureFilter:i.filters[0]},factory:{labels:_,symbology:y}},expressionProperties:{timeExtent:i.timeExtent?.toJSON()}}}(p,e,i,u,c);case"cluster":return async function(e,r,i,u,c){const p=l(e,u.fields),f={type:"cluster",feature:await a.createMatcherSchema(r,e.effectiveFeatureRenderer),cluster:await a.createMatcherSchema(r,e.effectiveClusterRenderer)},y=o.createVisualVariableUniforms(e.effectiveFeatureRenderer),h={type:"cluster",feature:await s.createLabelMatcherSchema(r,u,y),cluster:await s.createLabelMatcherSchema(r,{geometryType:"point",labelingInfoSource:u.labelingInfoSource+"-clusters",labelingInfo:e.labelingInfo,labelsVisible:e.labelsVisible},y)},g=n.createStorageSchema(e.effectiveFeatureRenderer,[null,null]),_=d(f);return{storage:g,mesh:{properties:{sortKey:null,timeZone:i.timeZone,displayRefreshVersion:c,returnMeshObjectId:_,currentUser:i.currentUser},strategy:{type:"cluster",fields:p,featureFilter:i.filters[0],clusterRadius:t.pt2px(e.clusterRadius/2)},factory:{labels:h,symbology:f}},expressionProperties:{timeExtent:i.timeExtent?.toJSON()}}}(p,e,i,u,c)}if(u.trackInfo?.enabled)return async function(e,t,r,i,u){const c=l(e,i.fields),p={type:"track",previousObservation:await a.createMatcherSchema(t,e.previousObservations.renderer),latestObservation:await a.createMatcherSchema(t,e.latestObservations.renderer),trackLine:await a.createMatcherSchema(t,e.trackLines.renderer)},f={type:"track",previousObservation:await s.createLabelMatcherSchema(t,{geometryType:i.geometryType,labelingInfoSource:i.labelingInfoSource+"-track-prev",labelingInfo:e.previousObservations.labelingInfo,labelsVisible:e.previousObservations.labelsVisible},o.createVisualVariableUniforms(e.previousObservations.renderer)),latestObservation:await s.createLabelMatcherSchema(t,{geometryType:i.geometryType,labelingInfoSource:i.labelingInfoSource+"-track-latest",labelingInfo:e.latestObservations.labelingInfo,labelsVisible:e.latestObservations.labelsVisible},o.createVisualVariableUniforms(e.latestObservations.renderer)),trackLine:await s.createLabelMatcherSchema(t,{geometryType:"polyline",labelingInfoSource:i.labelingInfoSource+"-track-line",labelingInfo:e.trackLines.labelingInfo,labelsVisible:e.trackLines.labelsVisible},o.createVisualVariableUniforms(e.trackLines.renderer))},y=n.createTrackStorageSchema(e,[null,null]),h=d(p);return{storage:y,mesh:{properties:{sortKey:null,timeZone:r.timeZone,returnMeshObjectId:h,displayRefreshVersion:u,currentUser:r.currentUser},strategy:{type:"track",featureFilter:r.filters[0],fields:c,maxDisplayDuration:e.maxDisplayDuration?.toMilliseconds()??0,maxDisplayObservationsPerTrack:e.maxDisplayObservationsPerTrack,showLatestObservation:e.latestObservations.visible,showPreviousObservations:e.previousObservations.visible,showTrackLine:e.trackLines.visible,timeField:e.timeField},factory:{labels:f,symbology:p}},expressionProperties:{timeExtent:r.timeExtent?.toJSON()}}}(u.trackInfo,e,i,u,c);const f=function(e,t,i){const s=null!=t&&"unique-value"===t.type&&t.orderByClassesEnabled;if("default"!==e||s||(e=[new r({field:i,order:"descending"})]),"default"!==e&&e?.length){e.length;const t=e[0],r="ascending"===t.order?"asc":"desc";return t.field?{field:t.field,order:r}:t.valueExpression?{expression:t.valueExpression,order:r}:null}return s?{byRenderer:!0,order:"asc"}:null}(u.orderBy,u.renderer,u.objectIdField),y=n.createStorageSchema(u.renderer,i.filters),h=await async function(e,t){const r=t.renderer,i=o.createVisualVariableUniforms(r);return{symbology:await a.createMatcherSchema(e,r),labels:await s.createLabelMatcherSchema(e,t,i)}}(e,u),g=d(h.symbology);return{storage:y,mesh:{properties:{sortKey:f,timeZone:i.timeZone,returnMeshObjectId:g,displayRefreshVersion:c,currentUser:i.currentUser},strategy:{type:"feature"},factory:h},expressionProperties:{timeExtent:i.timeExtent?.toJSON()}}},e.getAggregateFields=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/schema/processor/LabelMatcherSchema":function(){define(["exports","../../../../../../core/string","../../../../../../layers/support/labelingInfo","../../layerAdapters/geometryUtils","./symbols/SymbolSchema"],(function(e,t,r,i,s){"use strict";e.createLabelMatcherSchema=async function(e,a,n){const o=a.labelsVisible&&a.labelingInfo||[],l=i.getServiceGeometryType(a),u=r.validateLabelingInfo(o,l);return{type:"label",classes:await Promise.all(u.map(((r,i)=>async function(e,r,i,a,n,o,l){const u=t.numericHash(`${a} ${n}`),c=await s.createSymbolMeshSchemas(r,{schemaOptions:e,uniforms:l,labelClassId:u});return{maxScale:r.maxScale,minScale:r.minScale,deconflictionEnabled:"none"!==r.deconflictionStrategy&&i,expression:r.labelExpressionInfo?.expression??r.labelExpression,where:r.where,meshes:c,labelClassId:u,geometryType:o}}(e,r,a.labelsVisible,a.labelingInfoSource,i,l,n))))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/schema/processor/symbols/SymbolSchema":function(){define(["exports","../../../../../../../core/Logger","../../../../../../../core/screenUtils","../../../../../../../renderers/support/heatmapUtils","../../../../../../../symbols/SimpleFillSymbol","../../../../../../../symbols/SimpleLineSymbol","../../../../../../../symbols/SimpleMarkerSymbol","../../../../../../../symbols/cim/CIMSymbolHelper","../../../../../../../symbols/cim/enums","../../../../../../../symbols/cim/SDFHelper","../../../../../engine/webgl/alignmentUtils","../../../../../engine/webgl/color","../../../../../engine/webgl/definitions","../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry","../schemaUtils","../VisualVariablesSchema","./ComplexSymbolSchema","./utils"],(function(e,t,r,i,s,a,n,o,l,u,c,d,p,f,y,h,g,_){"use strict";async function m(e,i){if(!e)return[];switch(e.type){case"simple-fill":return v(e,i);case"picture-fill":return function(e,t){const{outline:r}=e,{uniforms:i,schemaOptions:s}=t,{store:a}=s,n=[],l=o.CIMSymbolHelper.createPictureFillRasterizationParam(e);if(!l)return[];const{width:u,height:c,xoffset:d,yoffset:p,xscale:y,yscale:h}=e,g={color:[255,255,255,255],sprite:l,height:c,aspectRatio:u/c,offsetX:d,offsetY:p,scaleX:y,scaleY:h,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,scaleProportionally:!1,effects:null,scaleInfo:null};if("solid"===r?.style)return[a.ensureInstance(f.Techniques.complexOutlineFill,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity,visualVariableSizeScaleStops:i.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({...g,...S(r,!!i.visualVariableSizeOutlineScaleStops)})];const _=a.ensureInstance(f.Techniques.complexFill,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity},optionalAttributes:{zoomRange:!1}});return n.push(_.createMeshInfo(g)),r&&n.push(...F(r,t,!0)),n}(e,i);case"simple-marker":return w(e,i);case"picture-marker":return function(e,t){const{uniforms:r,schemaOptions:i}=t,{store:s}=i,a=s.ensureInstance(f.Techniques.marker,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue,visualVariableRotation:r.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),n=o.CIMSymbolHelper.createPictureMarkerRasterizationParam(e);return n?[a.createMeshInfo({type:"picture",color:[255,255,255,255],height:e.height,width:e.width,offsetX:e.xoffset,offsetY:e.yoffset,angle:e.angle,alignment:_.hasRotationVVUniform(r)?l.Alignment.MAP:l.Alignment.SCREEN,outlineColor:null,outlineSize:0,referenceSize:e.height,sprite:n,overrideOutlineColor:!1,hasSizeVV:_.hasSizeVVUniform(r),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:h.getMaxSizeVVSize(r)})]:[]}(e,i);case"simple-line":return F(e,i,!1);case"text":return function(e,t){const{uniforms:r,schemaOptions:i}=t,{store:s}=i;return[s.ensureInstance(f.Techniques.text,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableRotation:r.visualVariableRotation,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1,clipAngle:!1,referenceSymbol:!1,visibility:!1}}).createMeshInfo({boxBackgroundColor:e.backgroundColor?.toArray(),boxBorderLineColor:e.borderLineColor?.toArray(),boxBorderLineSize:e.borderLineSize??0,color:e.color?.toArray()??[0,0,0,0],offsetX:e.xoffset,offsetY:e.yoffset,postAngle:e.angle,fontSize:e.font.size,decoration:e.font.decoration,haloColor:e.haloColor?.toArray()??[0,0,0,0],haloSize:e.haloSize??0,outlineColor:[0,0,0,0],outlineSize:0,lineWidth:e.lineWidth,lineHeightRatio:e.lineHeight,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:e.font.toJSON(),textString:e.text,symbol:o.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(e)},overrides:[]},referenceSize:null,effects:null,placement:null,scaleInfo:null,transforms:null,scaleFactor:1,minPixelBuffer:h.getMaxSizeVVSize(r),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,labelClassId:-1})]}(e,i);case"label":return function(e,t){const{schemaOptions:i,uniforms:s}=t,{store:a}=i,n=e.symbol,{allowOverrun:l,repeatLabel:u,repeatLabelDistance:d}=e,p={maxScale:e.maxScale??0,minScale:e.minScale??0},y=a.ensureInstance(f.Techniques.label,{uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:s.visualVariableRotation,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!0,clipAngle:!0,referenceSymbol:!0,visibility:!0}}),g=e.labelPlacement,[_,m]=c.getAlignmentFromPlacement(g);return[y.createMeshInfo({boxBackgroundColor:n.backgroundColor?.toArray(),boxBorderLineColor:n.borderLineColor?.toArray(),boxBorderLineSize:n.borderLineSize??0,color:n.color?.toArray()??[0,0,0,0],offsetX:n.xoffset,offsetY:n.yoffset,postAngle:n.angle,fontSize:n.font.size,decoration:n.font.decoration,outlineColor:[0,0,0,0],outlineSize:0,haloColor:n.haloColor?.toArray()??[0,0,0,0],haloSize:n.haloSize??0,lineWidth:n.lineWidth,lineHeightRatio:n.lineHeight,horizontalAlignment:_,verticalAlignment:m,repeatLabel:u,repeatLabelDistance:r.pt2px(d),allowOverrun:l,labelPosition:e.labelPosition,scaleInfo:p,minPixelBuffer:h.getMaxSizeVVSize(s),useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:n.font.toJSON(),textString:n.text,symbol:o.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(n),primitiveName:"label-override"},useLegacyLabelEvaluationRules:null==e.labelExpressionInfo?.expression,overrides:[{valueExpressionInfo:{type:"CIMExpressionInfo",expression:e.labelExpressionInfo?.expression??e.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",defaultValue:""}]},referenceSize:null,effects:null,placement:null,transforms:null,scaleFactor:1,labelClassId:t.labelClassId})]}(e,i);case"cim":return g.createComplexSymbolInstances(e.data,i);case"web-style":return m(await e.fetchSymbol({acceptedFormats:["cim","web"]}),i);case"line-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Defaulting to simple-line`),F(new a,i,!1);case"point-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Defaulting to simple-marker`),w(new n,i);case"polygon-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Defaulting to simple-fill`),v(new s,i);case"mesh-3d":case"label-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Ignoring`),[];case"CIMSymbolReference":throw new Error("InternalError: CIMSymbolReference should already be resolved")}}function b(e){if("path"===e.style){if(null==e.path)throw new Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:e.path,asFill:!0}}}const t=o.CIMSymbolHelper.fromSimpleMarker(e);if("outline"in e&&e.outline&&"none"!==e.outline.style&&"solid"!==e.outline.style){if(!t||!t.symbolLayers)throw new Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:t.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",resource:u.getSDFInfo(t),overrides:[]}}async function w(e,t){const{uniforms:r,schemaOptions:i}=t,{store:s}=i;if("path"===e.style||e.outline&&"solid"!==e.outline.style&&"none"!==e.outline.style){const i=o.CIMSymbolHelper.fromSimpleMarker(e);if(!i||!i.symbolLayers)throw new Error("Error handling marker! ");if(r.visualVariableRotation&&(i.angleAlignment="Map"),"path"!==e.style){const e=i.symbolLayers[0];if(_.hasSizeVVUniform(t.uniforms)){const r=h.getMaxSizeVVSize(t.uniforms,0,1);if(r>e.size){const t=r/e.size;e.size=r;const i=e.markerGraphics?.[0].symbol;(i.symbolLayers&&i.symbolLayers[0]).width*=t}}}return g.createComplexSymbolInstances({type:"CIMSymbolReference",symbol:i},t)}const a=s.ensureInstance(f.Techniques.marker,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue,visualVariableRotation:r.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),n=b(e);let u=e.color?.toArray()??[0,0,0,0];"CIMVectorMarker"===n.resource.type&&(u=[255,255,255,255]);const c="triangle"===e.style?124/116:1,d=e.size,p=d*c,y=null!=r.visualVariableColor&&("cross"===e.style||"x"===e.style);return[a.createMeshInfo({type:"simple",color:u,height:d,width:p,offsetX:e.xoffset,offsetY:e.yoffset,angle:e.angle,alignment:_.hasRotationVVUniform(r)?l.Alignment.MAP:l.Alignment.SCREEN,outlineColor:e.outline?.color?.toArray()??[0,0,0,0],outlineSize:e.outline?.width??1,referenceSize:d,sprite:n,overrideOutlineColor:y,hasSizeVV:_.hasSizeVVUniform(r),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:h.getMaxSizeVVSize(r)})]}function S(e,t){const r=e.width;return{outlineColor:e.color?.toArray()||[0,0,0,1],width:r,referenceWidth:r,capType:e.cap??"round",joinType:e.join??"round",miterLimit:e.miterLimit,hasSizeVV:t,outlineUsesColorVV:!1}}async function v(e,t){if("cim"===e.type)return g.createComplexSymbolInstances(e.data,t);const{style:r}=e;return r&&"none"!==r&&"solid"!==r?function(e,t){const{uniforms:r,schemaOptions:i}=t,{store:s}=i,a=e.color?.toArray()??[0,0,0,0],n={type:"sprite-rasterization-param",resource:{type:"fill-style",style:e.style},overrides:[]};if("solid"===e.outline?.style)return[s.ensureInstance(f.Techniques.patternOutlineFill,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeScaleStops:r.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:a,...S(e.outline,!!r.visualVariableSizeOutlineScaleStops),sprite:n,scaleInfo:null,effects:null})];const o=[],l=s.ensureInstance(f.Techniques.patternFill,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:e.color?.toArray()??[0,0,0,0],sprite:n,scaleInfo:null,effects:null});return o.push(l),e.outline&&o.push(...F(e.outline,t,!0)),o}(e,t):function(e,t){const{uniforms:r,schemaOptions:i}=t,{store:s}=i,a=e.color?.toArray()??[0,0,0,0];if("none"!==e.style&&"solid"===e.outline?.style)return[s.ensureInstance(f.Techniques.outlineFill,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeScaleStops:r.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:a,...S(e.outline,!!r.visualVariableSizeOutlineScaleStops),scaleInfo:null,effects:null})];const n=[];if("none"!==e.style){const e=s.ensureInstance(f.Techniques.fill,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:a,scaleInfo:null,effects:null});n.push(e)}return e.outline&&n.push(...F(e.outline,t,!0)),n}(e,t)}function F(e,t,r){const{color:i,style:s,width:a,cap:n,join:u}=e,{schemaOptions:c}=t,{store:d}=c,p=[],y=r?{...h.noVisualVariables,visualVariableSizeScaleStops:t.uniforms.visualVariableSizeOutlineScaleStops}:t.uniforms,g={uniforms:{visualVariableColor:y.visualVariableColor,visualVariableOpacity:y.visualVariableOpacity,visualVariableSizeMinMaxValue:y.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:y.visualVariableSizeScaleStops,visualVariableSizeStops:y.visualVariableSizeStops,visualVariableSizeUnitValue:y.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1}},m={color:i?.toArray()??[0,0,0,0],width:a,referenceWidth:a,capType:n,joinType:u,miterLimit:e.miterLimit,hasSizeVV:_.hasSizeVVUniform(y),effects:null,scaleInfo:null};if(null==s||"solid"===s){const e=d.ensureInstance(f.Techniques.line,g).createMeshInfo(m);p.push(e)}else if("none"!==s){const e=d.ensureInstance(f.Techniques.texturedLine,g).createMeshInfo({...m,offsetAlongLine:0,shouldScaleDash:!0,shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:o.slsDashToTemplateArray(s,n)},overrides:[]}});p.push(e)}return null!=e.marker&&p.push(...function(e,t,r){const{uniforms:i,schemaOptions:s}=r,{store:a}=s,n=a.ensureInstance(f.Techniques.marker,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity,visualVariableSizeMinMaxValue:i.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:i.visualVariableSizeScaleStops,visualVariableSizeStops:i.visualVariableSizeStops,visualVariableSizeUnitValue:i.visualVariableSizeUnitValue,visualVariableRotation:i.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),o=b(e),u=6*t.width,c=u,d=e.color?.toArray()??t.color?.toArray()??[0,0,0,0],p="cross"===e.style||"x"===e.style;let y;switch(e.placement){case"begin-end":y=l.ExtremityPlacement.Both;break;case"begin":y=l.ExtremityPlacement.JustBegin;break;case"end":y=l.ExtremityPlacement.JustEnd;break;default:y=l.ExtremityPlacement.None}const g={type:"cim-marker-placement-param",placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:y,offsetAlongLine:0},overrides:[]};return[n.createMeshInfo({type:"simple",color:d,height:c,width:u,offsetX:0,offsetY:0,angle:0,alignment:_.hasRotationVVUniform(i)?l.Alignment.MAP:l.Alignment.SCREEN,outlineColor:d,outlineSize:p?t.width:0,referenceSize:c/6,sprite:o,overrideOutlineColor:p&&null!=i.visualVariableColor,hasSizeVV:_.hasSizeVVUniform(i),placement:g,transforms:null,effects:null,scaleInfo:null,minPixelBuffer:h.getMaxSizeVVSize(i)})]}(e.marker,e,t)),p}e.createDotDensityMeshSchemas=async function(e,t){const{schemaOptions:r}=t,{store:i}=r,a=new Array(p.dotDensityMaxFields),n=new Array(p.dotDensityMaxFields/4);for(let t=0;t<p.dotDensityMaxFields;t++){const r=t<e.attributes.length?e.attributes[t].color:null;a[t]=[0,0,0,0],d.writeColor(a[t],r)}for(let t=0;t<p.dotDensityMaxFields/4;t++)n[t]=[0,0,0,0],n[t][0]=4*t<e.attributes.length?1:0,n[t][1]=4*t+1<e.attributes.length?1:0,n[t][2]=4*t+2<e.attributes.length?1:0,n[t][3]=4*t+3<e.attributes.length?1:0;const o={uniforms:{isActive:n,colors:a,dotValue:e.dotValue,dotScale:e.referenceScale,blending:e.dotBlendingEnabled,dotSize:e.dotSize,seed:e.seed},optionalAttributes:{}},l=i.ensureInstance(f.Techniques.dotDensity,o).createMeshInfo({effects:null}),u=[],c=new s({color:e.backgroundColor??[0,0,0,0],outline:null}),y=await m(c,t);if(u.push(...y),u.push(l),e.outline){const r=F(e.outline,t,!0);u.push(...r)}return u},e.createHeatmapMeshSchemas=async function(e,t){const{store:s}=t,{radius:a,minDensity:n,maxDensity:o,referenceScale:l,field:u,valueExpression:c,colorStops:d}=e,p=i.generateGradient(d);return[s.ensureInstance(f.Techniques.heatmap,{uniforms:{radius:r.pt2px(a),minDensity:n,maxDensity:o,referenceScale:l,isFieldActive:!(!u&&!c),gradient:p,gradientHash:p.join(",")},optionalAttributes:{}}).createMeshInfo({effects:null})]},e.createLineInstance=F,e.createPieChartMeshSchemas=async function(e,t){const{store:i}=t,s=e.outline?.width||0,a=h.createVisualVariableUniforms(e),n=i.ensureInstance(f.Techniques.pieChart,{uniforms:{shader:{outlineWidth:Math.round(r.pt2px(s)),defaultColor:y.premultiplyColor(e.defaultColor),outlineColor:y.premultiplyColor(e.outline?.color),othersColor:y.premultiplyColor(e.othersCategory?.color),donutRatio:e.holePercentage,sectorThreshold:e.othersCategory?.threshold||0,colors:e.attributes.map((e=>y.premultiplyColor(e.color))),visualVariableOpacity:a.visualVariableOpacity,visualVariableSizeMinMaxValue:a.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:a.visualVariableSizeScaleStops,visualVariableSizeStops:a.visualVariableSizeStops,visualVariableSizeUnitValue:a.visualVariableSizeUnitValue,hittestUniforms:null,highlightUniforms:null},numberOfFields:e.attributes.length},optionalAttributes:{}}).createMeshInfo({size:e.size,outlineWidth:s,effects:null,scaleInfo:null,minPixelBuffer:h.getMaxSizeVVSize(a)});return[...e.backgroundFillSymbol?await v(e.backgroundFillSymbol,{schemaOptions:t,uniforms:h.noVisualVariables}):[],n]},e.createSymbolMeshSchemas=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/schema/processor/MatcherSchema":function(){define(["exports","./VisualVariablesSchema","./symbols/SymbolSchema"],(function(e,t,r){"use strict";e.createMatcherSchema=async function(e,i){if(!i)return{type:"simple",meshes:[]};switch(i.type){case"simple":return async function(e,i){const s=i.symbols,a=s.length?s[0]:null,n=t.createVisualVariableUniforms(i);return{type:"simple",meshes:await r.createSymbolMeshSchemas(a,{schemaOptions:e,uniforms:n})}}(e,i);case"dot-density":return async function(e,i){const s=t.createVisualVariableUniforms(i);return{type:"dot-density",meshes:await r.createDotDensityMeshSchemas(i,{schemaOptions:e,uniforms:s})}}(e,i);case"class-breaks":return async function(e,i){const s=t.createVisualVariableUniforms(i),a=i.backgroundFillSymbol,n=i.normalizationType,o="log"===n?"esriNormalizeByLog":"percent-of-total"===n?"esriNormalizeByPercentOfTotal":"field"===n?"esriNormalizeByField":null,l=i.classBreakInfos.map((async t=>({meshes:await r.createSymbolMeshSchemas(t.symbol,{path:`renderer-stop-${t.minValue}-${t.maxValue}`,schemaOptions:e,uniforms:s}),min:t.minValue,max:t.maxValue}))),u=(await Promise.all(l)).sort(((e,t)=>e.min-t.min)),c=await r.createSymbolMeshSchemas(a,{schemaOptions:e,uniforms:{...t.noVisualVariables,visualVariableSizeOutlineScaleStops:s.visualVariableSizeOutlineScaleStops}}),d=await r.createSymbolMeshSchemas(i.defaultSymbol,{schemaOptions:e,uniforms:s});return{type:"interval",field:i.field,expression:i.valueExpression,backgroundFill:c,defaultSymbol:d,intervals:u,normalizationField:i.normalizationField,normalizationTotal:i.normalizationTotal,normalizationType:o,isMaxInclusive:i.isMaxInclusive}}(e,i);case"unique-value":return async function(e,i){const s=[],a=t.createVisualVariableUniforms(i),n=await r.createSymbolMeshSchemas(i.backgroundFillSymbol,{schemaOptions:e,uniforms:{...t.noVisualVariables,visualVariableSizeOutlineScaleStops:a.visualVariableSizeOutlineScaleStops}}),o=await r.createSymbolMeshSchemas(i.defaultSymbol,{schemaOptions:e,uniforms:a});for(const t of i.uniqueValueInfos??[]){const i=await r.createSymbolMeshSchemas(t.symbol,{path:`renderer-unique-value-${t.value}`,schemaOptions:e,uniforms:a});s.push({value:""+t.value,symbol:i})}return{type:"map",field:i.field,expression:i.valueExpression,field2:i.field2,field3:i.field3,fieldDelimiter:i.fieldDelimiter,backgroundFill:n,defaultSymbol:o,map:s}}(e,i);case"dictionary":return async function(e){const r=t.createVisualVariableUniforms(e),i=await e.getDictionaryInfo(),s=e.scaleExpression,a=null!=s&&"1"!==s?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:e.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0;return{type:"dictionary",dictionaryInfo:i,userConfig:e.config??{},fieldMap:e.fieldMap??{},scaleExpression:a,visualVariableUniforms:r}}(i);case"heatmap":return async function(e,t){return{type:"heatmap",meshes:await r.createHeatmapMeshSchemas(t,e)}}(e,i);case"pie-chart":return async function(e,t){return{type:"pie-chart",meshes:await r.createPieChartMeshSchemas(t,e)}}(e,i)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/FeatureLayerAdapter":function(){define(["exports","../../../../../core/lang","../../../../../layers/support/arcgisLayerUrl","./featureReductionUtils","./featureServiceUtils","./floorFilterUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,i,s,a,n,o,l,u,c){"use strict";e.FeatureLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=o.getFeatureReductionDeconflictionEnabled(t,e)??o.getLayerDeconflictionEnabled(t),s=i.getEffectiveFeatureReduction(t,e),a=[...t.labelingInfo||[],...s?.labelingInfo||[]];return[{vvEvaluators:{0:o.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r,labelingInfo:a}]}async createServiceOptions(e){const i=this.layer,{capabilities:a,editingInfo:o,typeIdField:l,globalIdField:u,datesInUnknownTimezone:c,dateFieldsTimeZone:d,orderBy:p,subtypeField:f,refreshInterval:y}=i,h=i.fieldsIndex.toJSON(),g=n.getServiceGeometryType(i),_=i.timeInfo?.toJSON(),m=i.spatialReference.toJSON(),b=i.types?.map((e=>e.toJSON())),w=t.clone(this.layer.parsedUrl);this.layer.dynamicDataSource&&(w.query={layer:JSON.stringify({source:this.layer.dynamicDataSource})});let S=this.layer.objectIdField;if(p?.length){const e=!p[0].valueExpression&&p[0].field;e&&(S=e)}const v=r.isHostedAgolService(w.path),F=!(null!=o?.lastEditDate)&&y>0,I=s.createSnapshotInfo(v,F,a,g,e.extent,i.fullExtent),x=e.spatialReference.toJSON();return{type:"feature-service",source:w,isSourceHosted:v,orderByFields:S,outSpatialReference:x,metadata:{typeIdField:l??void 0,types:b,timeReferenceUnknownClient:c,dateFieldsTimeZone:d,subtypeField:f,globalIdField:u,fieldsIndex:h,geometryType:g,featureIdInfo:s.createFeatureIdInfo(i),timeInfo:_,spatialReference:m,outSpatialReference:x,subtypes:this.layer.subtypes?.map((e=>e.toJSON()))},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:o?.lastEditDate?.getTime(),snapshotInfo:I}}}createSourceSchema(e,t){const{apiKey:r,definitionExpression:i,displayFilterInfo:s,customParameters:a,gdbVersion:n,historicMoment:o,subtypeCode:u,subtypeField:c,timeExtent:d}=this.layer,p={definitionExpression:i,displayFilterInfo:s,customParameters:a,gdbVersion:n,historicMoment:o,subtypeCode:u,subtypeField:c,timeExtent:d};return l.createFeatureSourceSchema(p,e,t,r)}createProcessorSchema(e,t,r){const{fields:s,renderer:a,geometryType:n,labelingInfo:o,labelsVisible:l,orderBy:c,objectIdField:d,trackInfo:p}=this.layer,f={fields:s.map((e=>e.toJSON())),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:i.getEffectiveFeatureReduction(this.layer,t),geometryType:n,labelingInfo:o,labelsVisible:l,objectIdField:d,orderBy:c??"default",trackInfo:p};return u.createSimpleProcessorSchema(e,t,f,r)}get hasRequiredSupport(){return c.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}addFilters(e,t){return a.addFloorFilter(this.layer,e,t)}getUpdateHashProperties(e){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>this.layer.definitionExpression,()=>i.getEffectiveFeatureReduction(this.layer,e),()=>a.hasFloorFilter(this.layer,e)?e.floors:null,()=>this.layer.gdbVersion,()=>this.layer.historicMoment,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy,()=>this.layer.outFields,()=>this.layer.renderer,()=>this.layer.subtypeCode,()=>this.layer.trackInfo]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/featureServiceUtils":function(){define(["exports","../../../../../core/has"],(function(e,t){"use strict";function r(e,r){return!(!e&&!t("featurelayer-snapshot-non-hosted-exceedslimit-enabled"))&&r?.operations.supportsExceedsLimitStatistics}e.createFeatureIdInfo=function(e){const{objectIdField:t,uniqueIdFields:r}=e;return r?.length?r.length>=2?{type:"unique-id-composite",fieldNames:r}:{type:"unique-id-simple",fieldName:r[0]}:{type:"object-id",fieldName:t}},e.createSnapshotInfo=function(e,i,s,a,n,o){const l=function(e){switch(e){case"esriGeometryMultipoint":return{min:t("featurelayer-snapshot-multipoint-min-threshold"),max:t("featurelayer-snapshot-multipoint-max-threshold")};case"esriGeometryPoint":return{min:t("featurelayer-snapshot-point-min-threshold"),max:t("featurelayer-snapshot-point-max-threshold")};case"esriGeometryMultiPatch":case"esriGeometryPolygon":return{min:t("featurelayer-snapshot-polygon-min-threshold"),max:t("featurelayer-snapshot-polygon-max-threshold")};case"esriGeometryPolyline":return{min:t("featurelayer-snapshot-polyline-min-threshold"),max:t("featurelayer-snapshot-polyline-max-threshold")}}}(a);if(!t("featurelayer-snapshot-enabled")||!s?.query.supportsPagination||s?.operations.supportsEditing||i)return null;const u=function(e,r){const i=r?.clone().intersection(e),s=null!=i?i.width*i.height:0,a=r?r.width*r.height:0,n=0===a?0:s/a,o=t("featurelayer-snapshot-coverage");return!isNaN(n)&&n>=o}(n,o),{min:c,max:d}=l,p=u?d:c,f=function(e){switch(e){case"esriGeometryPoint":return null;case"esriGeometryPolyline":case"esriGeometryPolygon":case"esriGeometryMultiPatch":case"esriGeometryMultipoint":return t("featurelayer-snapshot-max-vertex-count")}}(a);let y=t("featurelayer-snapshot-initial-tolerance");return"esriGeometryPoint"!==a&&"esriGeometryMultipoint"!==a||(y=null),{supportsExceedsLimit:r(e,s),initialTolerance:y,maxFeatureCount:p,maxVertexCount:f}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/floorFilterUtils":function(){define(["exports","../../../../../core/sql","../../../../../layers/support/FeatureFilter"],(function(e,t,r){"use strict";e.addFloorFilter=function(e,i,s){const a=function(e,r,i){if(null==e.floorInfo||!i.floors?.length)return r;let s=i.floors;const{floorField:a,viewAllLevelIds:n}=e.floorInfo;n.length&&(s=n);const o=s.filter((e=>""!==e)).map((e=>"'"+e+"'"));if(o.push("''"),r?.includes(a)){let e=new RegExp("AND \\("+a+".*NULL\\)","g");r=r.replace(e,""),e=new RegExp("\\("+a+".*NULL\\)","g"),r=(r=r.replace(e,"")).replaceAll(/\s+/g," ").trim()}let l="("+a+" IN ({ids}) OR "+a+" IS NULL)";return l=l.replace("{ids}",o.join(", ")),t.sqlAnd(r,l)}(e,i?.where,s);return a?(i??=new r,i.where=a,i):i},e.hasFloorFilter=function(e,t){return null!=e.floorInfo&&(e.floorInfo.viewAllLevelIds.length>0||t.floors.length>0)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/InMemoryLayerAdapter":function(){define(["exports","../../../../../core/Error","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,i,s,a,n,o){"use strict";e.InMemoryLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,i=s.getFeatureReductionDeconflictionEnabled(t,e)??s.getLayerDeconflictionEnabled(t),a=r.getEffectiveFeatureReduction(t,e),n=[...t.labelingInfo||[],...a?.labelingInfo||[]];return[{vvEvaluators:{0:s.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:i,labelingInfo:n}]}async createServiceOptions(e){const r=this.layer,{capabilities:s,objectIdField:a}=r,n=r.fieldsIndex.toJSON(),o=i.getServiceGeometryType(r),l=r.timeInfo?.toJSON(),u=r.spatialReference.toJSON();!function(e){if(!("openPorts"in e))throw new t("featurelayer:source-not-supported","source is not supported")}(r.source);const c=await r.source.openPorts(),d=a,p=e.spatialReference.toJSON();return{type:"memory",source:c,orderByFields:d,outSpatialReference:p,metadata:{fieldsIndex:n,geometryType:o,featureIdInfo:{type:"object-id",fieldName:r.objectIdField},timeInfo:l,spatialReference:u,outSpatialReference:p,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:"datesInUnknownTimezone"in r?r.datesInUnknownTimezone:null,dateFieldsTimeZone:"dateFieldsTimeZone"in r?r.dateFieldsTimeZone:null},queryMetadata:{maxRecordCount:s.query.maxRecordCount,supportsCompactGeometry:s.query.supportsCompactGeometry,supportsDefaultSpatialReference:s.query.supportsDefaultSpatialReference,supportsFormatPBF:s.query.supportsFormatPBF,supportsMaxRecordCountFactor:s.query.supportsMaxRecordCountFactor,supportsQuantization:s.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:r,timeExtent:i,displayFilterInfo:s}=this.layer,n={customParameters:null,definitionExpression:r,displayFilterInfo:s,timeExtent:i};return a.createFeatureSourceSchema(n,e,t,null)}createProcessorSchema(e,t,i){const{fields:s,renderer:a,geometryType:o,labelingInfo:l,labelsVisible:u,orderBy:c,objectIdField:d}=this.layer,p="trackInfo"in this.layer?this.layer.trackInfo:null,f={fields:s.map((e=>e.toJSON())),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:r.getEffectiveFeatureReduction(this.layer,t),geometryType:o,labelingInfo:l,labelsVisible:u,objectIdField:d,orderBy:c??"default",trackInfo:p};return n.createSimpleProcessorSchema(e,t,f,i)}get hasRequiredSupport(){return o.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.definitionExpression,()=>this.layer.displayFilterInfo,()=>this.layer.orderBy,()=>"outFields"in this.layer?this.layer.outFields:null,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>r.getEffectiveFeatureReduction(this.layer,e),()=>"trackInfo"in this.layer?this.layer.trackInfo:null]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/KnowledgeGraphSublayerAdapter":function(){define(["exports","../../../../../core/sql","../../../../../layers/knowledgeGraph/constants","../../../../../layers/support/FeatureFilter","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,i,s,a,n,o,l,u){"use strict";function c(e){return"link-chart"===e.parentCompositeLayer.type&&"hidden"===e.parentCompositeLayer.linkChart?.linkChartProperties.nonspatialDataDisplay?.mode}e.KnowledgeGraphSublayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=n.getFeatureReductionDeconflictionEnabled(t,e)??n.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:n.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const t=this.layer,{capabilities:r,objectIdField:i}=t,s=t.fieldsIndex.toJSON(),n=a.getServiceGeometryType(t),o=t.spatialReference.toJSON(),l=await t.source.openPorts(),u=i,c=e.spatialReference.toJSON();return{type:"memory",source:l,orderByFields:u,outSpatialReference:c,metadata:{fieldsIndex:s,geometryType:n,featureIdInfo:{type:"object-id",fieldName:t.objectIdField},spatialReference:o,outSpatialReference:c,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:t.timeInfo?.toJSON(),timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:r.query.maxRecordCount,supportsCompactGeometry:r.query.supportsCompactGeometry,supportsDefaultSpatialReference:r.query.supportsDefaultSpatialReference,supportsFormatPBF:r.query.supportsFormatPBF,supportsMaxRecordCountFactor:r.query.supportsMaxRecordCountFactor,supportsQuantization:r.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:r,displayFilterInfo:i}=this.layer,s={definitionExpression:r,displayFilterInfo:i,customParameters:null};return o.createFeatureSourceSchema(s,e,t,null)}createProcessorSchema(e,t,r){const{fields:i,renderer:a,geometryType:n,labelingInfo:o,labelsVisible:u,objectIdField:c}=this.layer,d={fields:i.map((e=>e.toJSON())),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:s.getEffectiveFeatureReduction(this.layer,t),geometryType:n,labelingInfo:o,labelsVisible:u,objectIdField:c,orderBy:"default"};return l.createSimpleProcessorSchema(e,t,d,r)}get hasRequiredSupport(){return u.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>s.getEffectiveFeatureReduction(this.layer,e),()=>c(this.layer)]}hasFilters(e){return c(this.layer)}addFilters(e,s){if(c(this.layer)){const s=t.sqlAnd(e?.where,`${r.systemIsSpatialFieldName}=1`);if(!s)return e;e??=new i,e.where=s}return e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/knowledgeGraph/constants":function(){define(["exports"],(function(e){"use strict";e.systemAggregationCountFieldName="ESRI__AggregationCount",e.systemDestinationIdFieldName="ESRI__DestID",e.systemIsSpatialFieldName="LC.ESRI__IsSpatial",e.systemLayoutGeometryFieldName="ESRI__LayoutGeometry",e.systemOidFieldName="ESRI__ID",e.systemOriginIdFieldName="ESRI__OriginID",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/OGCFeatureLayerAdapter":function(){define(["exports","../../../../../core/lang","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,i,s,a,n,o){"use strict";e.OGCFeatureLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=s.getFeatureReductionDeconflictionEnabled(t,e)??s.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:s.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r,labelingInfo:t.labelingInfo}]}async createServiceOptions(e){const r=this.layer,{capabilities:s}=r,a=r.fieldsIndex.toJSON(),n=i.getServiceGeometryType(r),o=r.timeInfo?.toJSON(),l=r.spatialReference.toJSON(),u=r.source.getSource(),c=this.layer.objectIdField,d=t.clone(s);d.query.maxRecordCount=u.maxRecordCount;const p=e.spatialReference.toJSON();return{type:"ogc",source:u,orderByFields:c,outSpatialReference:p,metadata:{fieldsIndex:a,geometryType:n,featureIdInfo:{type:"object-id",fieldName:r.objectIdField},timeInfo:o,spatialReference:l,outSpatialReference:p,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:d.query.maxRecordCount,supportsCompactGeometry:d.query.supportsCompactGeometry,supportsDefaultSpatialReference:d.query.supportsDefaultSpatialReference,supportsFormatPBF:d.query.supportsFormatPBF,supportsMaxRecordCountFactor:d.query.supportsMaxRecordCountFactor,supportsQuantization:d.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t){const{customParameters:r,timeExtent:i,apiKey:s}=this.layer,n={customParameters:r,timeExtent:i};return a.createFeatureSourceSchema(n,e,t,s)}createProcessorSchema(e,t,i){const{fields:s,renderer:a,geometryType:o,labelingInfo:l,labelsVisible:u,orderBy:c,objectIdField:d}=this.layer,p={fields:s.map((e=>e.toJSON())),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:r.getEffectiveFeatureReduction(this.layer,t),geometryType:o,labelingInfo:l,labelsVisible:u,objectIdField:d,orderBy:c??"default"};return n.createSimpleProcessorSchema(e,t,p,i)}get hasRequiredSupport(){return o.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>r.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy,()=>this.layer.renderer]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/OrientedImageryLayerAdapter":function(){define(["exports","../../../../../core/lang","../../../../../layers/support/arcgisLayerUrl","./featureReductionUtils","./featureServiceUtils","./floorFilterUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,i,s,a,n,o,l,u,c){"use strict";e.OrientedImageryLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=o.getFeatureReductionDeconflictionEnabled(t,e)??o.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:o.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const i=this.layer,{capabilities:a,globalIdField:o,orderBy:l,refreshInterval:u}=i,c=i.fieldsIndex.toJSON(),d=n.getServiceGeometryType(i),p=i.timeInfo?.toJSON(),f=i.spatialReference.toJSON(),y=t.clone(this.layer.parsedUrl);let h=this.layer.objectIdField;if(l?.length){const e=!l[0].valueExpression&&l[0].field;e&&(h=e)}const g=u>0,_=r.isHostedAgolService(y.path),m=e.spatialReference.toJSON(),b=s.createSnapshotInfo(_,g,a,d,e.extent,i.fullExtent);return{type:"feature-service",source:y,isSourceHosted:_,orderByFields:h,outSpatialReference:m,metadata:{globalIdField:o,fieldsIndex:c,geometryType:d,featureIdInfo:{type:"object-id",fieldName:i.objectIdField},timeInfo:p,spatialReference:f,outSpatialReference:m,timeReferenceUnknownClient:i.datesInUnknownTimezone,dateFieldsTimeZone:i.dateFieldsTimeZone,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:null,snapshotInfo:b}}}createSourceSchema(e,t){const{definitionExpression:r,displayFilterInfo:i,customParameters:s,timeExtent:a}=this.layer,n={definitionExpression:r,displayFilterInfo:i,customParameters:s,timeExtent:a};return l.createFeatureSourceSchema(n,e,t,null)}createProcessorSchema(e,t,r){const{fields:s,renderer:a,geometryType:n,labelingInfo:o,labelsVisible:l,orderBy:c,objectIdField:d}=this.layer,p={fields:s.map((e=>e.toJSON())),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:i.getEffectiveFeatureReduction(this.layer,t),geometryType:n,labelingInfo:o,labelsVisible:l,objectIdField:d,orderBy:c??"default"};return u.createSimpleProcessorSchema(e,t,p,r)}get hasRequiredSupport(){return c.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}addFilters(e,t){return a.addFloorFilter(this.layer,e,t)}getUpdateHashProperties(e){return[()=>this.layer.outFields,()=>this.layer.orderBy,()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>i.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.customParameters,()=>a.hasFloorFilter(this.layer,e)?e.floors:null]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/ParquetLayerAdapter":function(){define(["exports","../../../../../core/Error","../../../../../layers/support/parquetUtils","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,i,s,a,n,o){"use strict";e.ParquetLayerAdapter=class{constructor(e){this.layer=e}get hasRequiredSupport(){return o.isRendererSupported(this.layer.renderer)}get timeOptions(){return null}getLabelingDeconflictionInfo(e){const t=this.layer,r=a.getFeatureReductionDeconflictionEnabled(t,e)??a.getLayerDeconflictionEnabled(t),s=i.getEffectiveFeatureReduction(t,e),n=[...t.labelingInfo||[],...s?.labelingInfo||[]];return[{vvEvaluators:{0:a.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r,labelingInfo:n}]}getUpdateHashProperties(e){return[()=>this.layer.outFields,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>i.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.customParameters,()=>this.layer.orderBy,()=>this.layer.renderer,()=>this.layer.popupTemplate]}async createServiceOptions(e){const i=s.getServiceGeometryType(this.layer),a=e.spatialReference.toJSON(),n=this.layer.encoding;if(null==n)throw new t("parquet-layer:unsupported","creating a parquet layer view requires an encoding",{layer:this.layer});return{type:"parquet",source:{urls:this.layer.urls.items},outSpatialReference:a,geometryInfo:{geometryType:r.toParquetJSONGeometryType(this.layer.geometryType),spatialReference:this.layer.spatialReference.toJSON(),encoding:n.toJSON()},metadata:{spatialReference:this.layer.spatialReference,outSpatialReference:a,fieldsIndex:this.layer.fieldsIndex.toJSON(),featureIdInfo:{type:"object-id",fieldName:this.layer.objectIdField},geometryType:i,types:null,subtypes:null,timeInfo:null,typeIdField:null,subtypeField:null,globalIdField:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null}}}createSourceSchema(e,t){return{type:"parquet",mutable:{sourceRefreshVersion:t,availableFields:e.availableFields.includes("*")?this.layer.fields.map((e=>e.name)):e.availableFields,dataFilter:{customParameters:this.layer.customParameters??null}}}}createProcessorSchema(e,t,r){const s={fields:this.layer.fields.map((e=>e.toJSON())),renderer:this.layer.renderer?.clone(),labelingInfoSource:this.layer.id,featureReduction:i.getEffectiveFeatureReduction(this.layer,t),geometryType:this.layer.geometryType,labelingInfo:this.layer.labelingInfo,labelsVisible:this.layer.labelsVisible,objectIdField:this.layer.objectIdField,orderBy:this.layer.orderBy};return n.createSimpleProcessorSchema(e,t,s,r)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/parquetUtils":function(){define(["exports","../../core/Collection","../../core/Error","../../core/jsonMap","../../geometry/SpatialReference","./Field","./locationUtils","./ParquetEncodingLocation","./ParquetEncodingWkb","../../libs/parquet/parquet"],(function(e,t,r,i,s,a,n,o,l,u){"use strict";const c=new i.JSONMap({esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint"});async function d(e,t={}){if(e.geometryType&&e.spatialReference&&e.encoding&&e.fields)return e;if(e.urls.length<1)throw new r("parquet:bad-input","At least one url must be specified",e);const i=e.metadata??await u.ParquetMetadata.create(e.urls.getItemAt(0),(()=>t.customParameters)),c=i.tryReadGeoMetadata(),d={...e,metadata:i};if(null==d.fields&&(d.fields=i.fields.map((e=>a.fromJSON(e)))),null==d.encoding&&(d.encoding=function(e,t){if(null!=t){const r=t.primary_column,i=t.columns[r],s=e.tryReadEsriMetadata();return new l({primaryFieldName:r,orientation:i.orientation??null,multiscale:s?.multiscale})}const r=n.inferLocationInfo(e.fields.map((e=>e.name)));return new o({latitudeFieldName:r.latitudeFieldName,longitudeFieldName:r.longitudeFieldName})}(i,c)),!d.encoding)return d;switch(d.encoding.type){case"location":null==d.spatialReference&&(d.spatialReference=s.WGS84),null==d.geometryType&&(d.geometryType="point");break;case"wkb":{if(!c)return d;const e=c.primary_column,t=c.columns[e];d.geometryType||(d.geometryType=function(e){const{geometry_types:t}=e,i=new Set;for(const e of t){const t=p(e);t&&i.add(t)}if(i.size>1)throw new r("unsupported","Parquet mixed geometry types are not support",{geometryTypes:i});return 1===i.size?i.values().next().value:void 0}(t)),d.spatialReference||(d.spatialReference=function(e){const t=e.crs?.id?.code;return t&&"number"==typeof t?new s({wkid:t}):void 0}(t))}}return d}function p(e){switch(e){case"Point":return"point";case"Polygon":case"MultiPolygon":return"polygon";case"LineString":return"polyline";case"MultiPoint":return"multipoint";default:return null}}e.completeParquetLayerInfo=d,e.getParquetLayerInfo=function(e,r={}){return d({urls:new t(e)},r)},e.parquetGeometryTypeKebabDict=c,e.toParquetJSONGeometryType=function(e){return c.toJSON(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/locationUtils":function(){define(["exports","./fieldUtils"],(function(e,t){"use strict";const r=["lat","lat83","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],i=["lon","lng","lng83","long","long83","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"];e.inferLocationInfo=function(e,s,a){s=t.normalizeFieldName(s)?.toLowerCase(),a=t.normalizeFieldName(a)?.toLowerCase();const n=e.map((e=>e.toLowerCase())),o=s?e[n.indexOf(s)]:null,l=a?e[n.indexOf(a)]:null;return{longitudeFieldName:o||e[n.indexOf(i.find((e=>n.includes(e))))],latitudeFieldName:l||e[n.indexOf(r.find((e=>n.includes(e))))]}},e.latitudeFieldNames=r,e.longitudeFieldNames=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/ParquetEncodingLocation":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,s,a,n){"use strict";let o=class extends t{constructor(e){super(e),this.type="location",this.latitudeFieldName=null,this.longitudeFieldName=null}};return e.__decorate([r.property({type:["location"],readOnly:!0,json:{write:!0}})],o.prototype,"type",void 0),e.__decorate([r.property({json:{write:!0}})],o.prototype,"latitudeFieldName",void 0),e.__decorate([r.property({json:{write:!0}})],o.prototype,"longitudeFieldName",void 0),o=e.__decorate([n.subclass("esri.layers.support.ParquetEncodingLocation")],o),o}))},"esri/layers/support/ParquetEncodingWkb":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,s,a,n){"use strict";let o=class extends t{constructor(e){super(e),this.type="wkb",this.primaryFieldName=null}};return e.__decorate([r.property({type:["wkb"],readOnly:!0,json:{write:!0}})],o.prototype,"type",void 0),e.__decorate([r.property({json:{write:!0}})],o.prototype,"multiscale",void 0),e.__decorate([r.property({json:{write:!0}})],o.prototype,"orientation",void 0),e.__decorate([r.property({json:{write:!0}})],o.prototype,"primaryFieldName",void 0),o=e.__decorate([n.subclass("esri.layers.support.ParquetEncodingWkb")],o),o}))},"esri/libs/parquet/parquet":function(){define(["exports","../../request","./loadParquetModule","../../chunks/bundle"],(function(e,t,r,i){"use strict";const s=e=>async function(r,i,s){const a=e(),{data:n}=await t(r,{responseType:"array-buffer",query:a,headers:{range:`bytes=${i}-${s}`},useRequestQueue:!0});return n},a=e=>async function(r){const i=e(),{data:s}=await t(r,{responseType:"native",method:"head",query:i,useRequestQueue:!0}),a=s.headers.get("Content-Length");if(null==a)throw new Error("Unable to parse content length");return parseInt(a,10)};class n{static async create(e,t){const i=await r.loadParquetModule(),o=await i.readMetadata(e,s(t),a(t));return n.fromFileMetadata(o)}static fromFileMetadata(e){const t=[];for(let r=0;r<e.numFields();r++){const i=e.getFieldByIndex(r);t.push({name:i.name,type:i.type,alias:i.name,index:i.index}),i.free()}return new n(e,t)}constructor(e,t){this._inner=e,this.fields=t}destroy(){this._inner.free()}[Symbol.dispose](){this.destroy()}get size(){return this._inner.numRows()}getFieldIndex(e){return this._inner.getFieldIndex(e)}tryReadGeoMetadata(){const e=this._inner.keyValueMetadata("geo");return null==e?null:JSON.parse(e)}tryReadEsriMetadata(){const e=this._inner.keyValueMetadata("esri");return null==e?null:JSON.parse(e)}}function o(e,t,r){const s=i.GeometryInfoDescriptor.new();if(s.geometryType=function(e){switch(e){case"esriGeometryPoint":return i.GeometryType.Point;case"esriGeometryPolygon":return i.GeometryType.Polygon;case"esriGeometryPolyline":return i.GeometryType.Polyline;case"esriGeometryMultipoint":return i.GeometryType.Multipoint;default:throw new Error(`InternalError: Found unexpected GeometryType: ${e}`)}}(e.geometryType),"location"===e.encoding.type)s.latIndex=t.getFieldIndex(e.encoding.latitudeFieldName),s.lngIndex=t.getFieldIndex(e.encoding.longitudeFieldName);else if(s.wkbIndex=t.getFieldIndex(e.encoding.primaryFieldName),e.encoding.multiscale){const r=i.MultiScaleInfo.new();for(const i of e.encoding.multiscale.levels){const[e,s]=i.transform.translate,[a,n]=i.transform.scale,o=t.getFieldIndex(i.column);r.push(o,e,s,a,n)}s.setMultiscaleInfo(r)}return s.inWkid=e.spatialReference.wkid,r&&(s.outWkid=r.wkid),s}class l{static async create(e,t){const i=await r.loadParquetModule(),u=s(t.getCustomParameters),c=a(t.getCustomParameters),d=await i.readMetadata(e,u,c),p=o(t.geometryInfo,d,t.outSpatialReference),f=await i.readFile(e,u,c,d,p);return new l(f,n.fromFileMetadata(f.metadata()))}static async fromFile(e,t,i){const s=await r.loadParquetModule(),a=await s.readMetadataFromFile(e),u=t?o(t,a,i):void 0,c=await s.readFileFromBinary(u,e);return new l(c,n.fromFileMetadata(c.metadata()))}constructor(e,t){this.inner=e,this.metadata=t}destroy(){this.inner.free(),this.metadata.destroy()}[Symbol.dispose](){this.destroy()}}e.ParquetFile=l,e.ParquetMetadata=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/libs/parquet/loadParquetModule":function(){define(["require","exports","../../assets"],(function(e,t,r){"use strict";let i=null;t.loadParquetModule=async function(){return i||(i=async function(){const t=await new Promise(((t,r)=>e(["../../chunks/bundle"],t,r)));return await t.default({module_or_path:r.getAssetUrl("esri/libs/parquet/pkg/bundle_bg.wasm")}),t}()),i},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/bundle":function(){define(["exports"],(function(e){"use strict";let t;const r=new Array(128).fill(void 0);function i(e){return r[e]}r.push(void 0,null,!0,!1);let s=r.length;function a(e){s===r.length&&r.push(r.length+1);const t=s;return s=r[t],r[t]=e,t}function n(e,r){try{return e.apply(this,r)}catch(e){t.__wbindgen_exn_store(a(e))}}const o="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&o.decode();let l=null;function u(){return null!==l&&0!==l.byteLength||(l=new Uint8Array(t.memory.buffer)),l}function c(e,t){return e>>>=0,o.decode(u().subarray(e,e+t))}let d=0;const p="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},f="function"==typeof p.encodeInto?function(e,t){return p.encodeInto(e,t)}:function(e,t){const r=p.encode(e);return t.set(r),{read:e.length,written:r.length}};function y(e,t,r){if(void 0===r){const r=p.encode(e),i=t(r.length,1)>>>0;return u().subarray(i,i+r.length).set(r),d=r.length,i}let i=e.length,s=t(i,1)>>>0;const a=u();let n=0;for(;n<i;n++){const t=e.charCodeAt(n);if(t>127)break;a[s+n]=t}if(n!==i){0!==n&&(e=e.slice(n)),s=r(s,i,i=n+3*e.length,1)>>>0;const t=u().subarray(s+n,s+i);n+=f(e,t).written,s=r(s,i,n,1)>>>0}return d=n,s}let h=null;function g(){return(null===h||!0===h.buffer.detached||void 0===h.buffer.detached&&h.buffer!==t.memory.buffer)&&(h=new DataView(t.memory.buffer)),h}function _(e){return null==e}function m(e){const t=i(e);return function(e){e<132||(r[e]=s,s=e)}(e),t}const b="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>{t.__wbindgen_export_4.get(e.dtor)(e.a,e.b)}));function w(e,t){return e>>>=0,u().subarray(e/1,e/1+t)}let S=null,v=null;function F(e,t){e>>>=0;const r=g(),i=[];for(let s=e;s<e+4*t;s+=4)i.push(m(r.getUint32(s,!0)));return i}let I=null;function x(e,r){const i=r(2*e.length,2)>>>0;return(null!==I&&0!==I.byteLength||(I=new Uint16Array(t.memory.buffer)),I).set(e,i/2),d=e.length,i}function T(e,t){const r=t(1*e.length,1)>>>0;return u().set(e,r/1),d=e.length,r}function V(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}function E(e,r,i){t._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__h94c9328f486d7193(e,r,a(i))}const R=Object.freeze({Point:0,0:"Point",Polygon:1,1:"Polygon",Polyline:2,2:"Polyline",Multipoint:3,3:"Multipoint"}),k=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeBigInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],O="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>t.__wbg_columndescriptor_free(e>>>0,1)));class C{static __wrap(e){e>>>=0;const t=Object.create(C.prototype);return t.__wbg_ptr=e,O.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,O.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_columndescriptor_free(e,0)}name(){let e,r;try{const a=t.__wbindgen_add_to_stack_pointer(-16);t.columndescriptor_name(a,this.__wbg_ptr);var i=g().getInt32(a+0,!0),s=g().getInt32(a+4,!0);return e=i,r=s,c(i,s)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(e,r,1)}}physicalType(){let e,r;try{const a=t.__wbindgen_add_to_stack_pointer(-16);t.columndescriptor_physicalType(a,this.__wbg_ptr);var i=g().getInt32(a+0,!0),s=g().getInt32(a+4,!0);return e=i,r=s,c(i,s)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(e,r,1)}}logicalType(){try{const i=t.__wbindgen_add_to_stack_pointer(-16);t.columndescriptor_logicalType(i,this.__wbg_ptr);var e=g().getInt32(i+0,!0),r=g().getInt32(i+4,!0);let s;return 0!==e&&(s=c(e,r).slice(),t.__wbindgen_free(e,1*r,1)),s}finally{t.__wbindgen_add_to_stack_pointer(16)}}encodings(){try{const s=t.__wbindgen_add_to_stack_pointer(-16);t.columndescriptor_encodings(s,this.__wbg_ptr);var e=g().getInt32(s+0,!0),r=g().getInt32(s+4,!0),i=F(e,r).slice();return t.__wbindgen_free(e,4*r,4),i}finally{t.__wbindgen_add_to_stack_pointer(16)}}pageEncodings(){try{const i=t.__wbindgen_add_to_stack_pointer(-16);t.columndescriptor_pageEncodings(i,this.__wbg_ptr);var e=g().getInt32(i+0,!0),r=g().getInt32(i+4,!0);let s;return 0!==e&&(s=F(e,r).slice(),t.__wbindgen_free(e,4*r,4)),s}finally{t.__wbindgen_add_to_stack_pointer(16)}}numValues(){return t.columndescriptor_numValues(this.__wbg_ptr)}compression(){let e,r;try{const a=t.__wbindgen_add_to_stack_pointer(-16);t.columndescriptor_compression(a,this.__wbg_ptr);var i=g().getInt32(a+0,!0),s=g().getInt32(a+4,!0);return e=i,r=s,c(i,s)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(e,r,1)}}compressedSize(){return t.columndescriptor_compressedSize(this.__wbg_ptr)}uncompressedSize(){return t.columndescriptor_uncompressedSize(this.__wbg_ptr)}nullCount(){try{const i=t.__wbindgen_add_to_stack_pointer(-16);t.columndescriptor_nullCount(i,this.__wbg_ptr);var e=g().getInt32(i+0,!0),r=g().getBigInt64(i+8,!0);return 0===e?void 0:r}finally{t.__wbindgen_add_to_stack_pointer(16)}}distinctCount(){try{const i=t.__wbindgen_add_to_stack_pointer(-16);t.columndescriptor_distinctCount(i,this.__wbg_ptr);var e=g().getInt32(i+0,!0),r=g().getBigInt64(i+8,!0);return 0===e?void 0:r}finally{t.__wbindgen_add_to_stack_pointer(16)}}minValue(){try{const i=t.__wbindgen_add_to_stack_pointer(-16);t.columndescriptor_minValue(i,this.__wbg_ptr);var e=g().getInt32(i+0,!0),r=g().getInt32(i+4,!0);let s;return 0!==e&&(s=w(e,r).slice(),t.__wbindgen_free(e,1*r,1)),s}finally{t.__wbindgen_add_to_stack_pointer(16)}}maxValue(){try{const i=t.__wbindgen_add_to_stack_pointer(-16);t.columndescriptor_maxValue(i,this.__wbg_ptr);var e=g().getInt32(i+0,!0),r=g().getInt32(i+4,!0);let s;return 0!==e&&(s=w(e,r).slice(),t.__wbindgen_free(e,1*r,1)),s}finally{t.__wbindgen_add_to_stack_pointer(16)}}}const M="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>t.__wbg_fieldmetadata_free(e>>>0,1)));class A{static __wrap(e){e>>>=0;const t=Object.create(A.prototype);return t.__wbg_ptr=e,M.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,M.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_fieldmetadata_free(e,0)}get name(){let e,r;try{const a=t.__wbindgen_add_to_stack_pointer(-16);t.fieldmetadata_name(a,this.__wbg_ptr);var i=g().getInt32(a+0,!0),s=g().getInt32(a+4,!0);return e=i,r=s,c(i,s)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(e,r,1)}}get index(){return t.fieldmetadata_index(this.__wbg_ptr)}get type(){const e=t.fieldmetadata_esri_type(this.__wbg_ptr);return k[e]}get physicalType(){try{const i=t.__wbindgen_add_to_stack_pointer(-16);t.fieldmetadata_physical_type(i,this.__wbg_ptr);var e=g().getInt32(i+0,!0),r=g().getInt32(i+4,!0);let s;return 0!==e&&(s=c(e,r).slice(),t.__wbindgen_free(e,1*r,1)),s}finally{t.__wbindgen_add_to_stack_pointer(16)}}get logicalType(){try{const i=t.__wbindgen_add_to_stack_pointer(-16);t.fieldmetadata_logical_type(i,this.__wbg_ptr);var e=g().getInt32(i+0,!0),r=g().getInt32(i+4,!0);let s;return 0!==e&&(s=c(e,r).slice(),t.__wbindgen_free(e,1*r,1)),s}finally{t.__wbindgen_add_to_stack_pointer(16)}}}const P="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>t.__wbg_filemetadata_free(e>>>0,1)));class q{static __wrap(e){e>>>=0;const t=Object.create(q.prototype);return t.__wbg_ptr=e,P.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,P.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_filemetadata_free(e,0)}version(){return t.filemetadata_version(this.__wbg_ptr)}numRows(){return t.filemetadata_numRows(this.__wbg_ptr)>>>0}numFields(){return t.filemetadata_numFields(this.__wbg_ptr)>>>0}numColumns(){return t.filemetadata_numColumns(this.__wbg_ptr)>>>0}createdBy(){try{const i=t.__wbindgen_add_to_stack_pointer(-16);t.filemetadata_createdBy(i,this.__wbg_ptr);var e=g().getInt32(i+0,!0),r=g().getInt32(i+4,!0);let s;return 0!==e&&(s=c(e,r).slice(),t.__wbindgen_free(e,1*r,1)),s}finally{t.__wbindgen_add_to_stack_pointer(16)}}keyValueMetadata(e){try{const s=t.__wbindgen_add_to_stack_pointer(-16),a=y(e,t.__wbindgen_malloc,t.__wbindgen_realloc),n=d;t.filemetadata_keyValueMetadata(s,this.__wbg_ptr,a,n);var r=g().getInt32(s+0,!0),i=g().getInt32(s+4,!0);let o;return 0!==r&&(o=c(r,i).slice(),t.__wbindgen_free(r,1*i,1)),o}finally{t.__wbindgen_add_to_stack_pointer(16)}}keys(){try{const i=t.__wbindgen_add_to_stack_pointer(-16);t.filemetadata_keys(i,this.__wbg_ptr);var e=g().getInt32(i+0,!0),r=g().getInt32(i+4,!0);let s;return 0!==e&&(s=F(e,r).slice(),t.__wbindgen_free(e,4*r,4)),s}finally{t.__wbindgen_add_to_stack_pointer(16)}}getFieldIndex(e){const r=y(e,t.__wbindgen_malloc,t.__wbindgen_realloc),i=d,s=t.filemetadata_getFieldIndex(this.__wbg_ptr,r,i);return 16777215===s?void 0:s}getFieldByIndex(e){const r=t.filemetadata_getFieldByIndex(this.__wbg_ptr,e);return 0===r?void 0:A.__wrap(r)}getFields(){try{const s=t.__wbindgen_add_to_stack_pointer(-16);t.filemetadata_getFields(s,this.__wbg_ptr);var e=g().getInt32(s+0,!0),r=g().getInt32(s+4,!0),i=F(e,r).slice();return t.__wbindgen_free(e,4*r,4),i}finally{t.__wbindgen_add_to_stack_pointer(16)}}}const L="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>t.__wbg_geometryinfodescriptor_free(e>>>0,1)));class U{static __wrap(e){e>>>=0;const t=Object.create(U.prototype);return t.__wbg_ptr=e,L.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,L.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_geometryinfodescriptor_free(e,0)}get geometryType(){const e=t.__wbg_get_geometryinfodescriptor_geometryType(this.__wbg_ptr);return 4===e?void 0:e}set geometryType(e){t.__wbg_set_geometryinfodescriptor_geometryType(this.__wbg_ptr,_(e)?4:e)}get wkbIndex(){const e=t.__wbg_get_geometryinfodescriptor_wkbIndex(this.__wbg_ptr);return 16777215===e?void 0:e}set wkbIndex(e){t.__wbg_set_geometryinfodescriptor_wkbIndex(this.__wbg_ptr,_(e)?16777215:e)}get lngIndex(){const e=t.__wbg_get_geometryinfodescriptor_lngIndex(this.__wbg_ptr);return 16777215===e?void 0:e}set lngIndex(e){t.__wbg_set_geometryinfodescriptor_lngIndex(this.__wbg_ptr,_(e)?16777215:e)}get latIndex(){const e=t.__wbg_get_geometryinfodescriptor_latIndex(this.__wbg_ptr);return 16777215===e?void 0:e}set latIndex(e){t.__wbg_set_geometryinfodescriptor_latIndex(this.__wbg_ptr,_(e)?16777215:e)}get xIndex(){const e=t.__wbg_get_geometryinfodescriptor_xIndex(this.__wbg_ptr);return 16777215===e?void 0:e}set xIndex(e){t.__wbg_set_geometryinfodescriptor_xIndex(this.__wbg_ptr,_(e)?16777215:e)}get inWkid(){const e=t.__wbg_get_geometryinfodescriptor_inWkid(this.__wbg_ptr);return 4294967297===e?void 0:e}set inWkid(e){t.__wbg_set_geometryinfodescriptor_inWkid(this.__wbg_ptr,_(e)?4294967297:e>>>0)}get outWkid(){const e=t.__wbg_get_geometryinfodescriptor_outWkid(this.__wbg_ptr);return 4294967297===e?void 0:e}set outWkid(e){t.__wbg_set_geometryinfodescriptor_outWkid(this.__wbg_ptr,_(e)?4294967297:e>>>0)}static new(){const e=t.geometryinfodescriptor_new();return U.__wrap(e)}setMultiscaleInfo(e){V(e,N);var r=e.__destroy_into_raw();t.geometryinfodescriptor_setMultiscaleInfo(this.__wbg_ptr,r)}}const z="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>t.__wbg_multiscaleinfo_free(e>>>0,1)));class N{static __wrap(e){e>>>=0;const t=Object.create(N.prototype);return t.__wbg_ptr=e,z.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,z.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_multiscaleinfo_free(e,0)}static new(){const e=t.multiscaleinfo_new();return N.__wrap(e)}push(e,r,i,s,a){t.multiscaleinfo_push(this.__wbg_ptr,e,r,i,s,a)}}const j="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>t.__wbg_pageencodingdescriptor_free(e>>>0,1)));class D{static __wrap(e){e>>>=0;const t=Object.create(D.prototype);return t.__wbg_ptr=e,j.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,j.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_pageencodingdescriptor_free(e,0)}pageType(){let e,r;try{const a=t.__wbindgen_add_to_stack_pointer(-16);t.pageencodingdescriptor_pageType(a,this.__wbg_ptr);var i=g().getInt32(a+0,!0),s=g().getInt32(a+4,!0);return e=i,r=s,c(i,s)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(e,r,1)}}encoding(){let e,r;try{const a=t.__wbindgen_add_to_stack_pointer(-16);t.pageencodingdescriptor_encoding(a,this.__wbg_ptr);var i=g().getInt32(a+0,!0),s=g().getInt32(a+4,!0);return e=i,r=s,c(i,s)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(e,r,1)}}count(){return t.pageencodingdescriptor_count(this.__wbg_ptr)}}const B="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>t.__wbg_parquetchunk_free(e>>>0,1)));class G{static __wrap(e){e>>>=0;const t=Object.create(G.prototype);return t.__wbg_ptr=e,B.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,B.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_parquetchunk_free(e,0)}size(){return t.parquetchunk_size(this.__wbg_ptr)>>>0}hasField(e){return 0!==t.parquetchunk_hasField(this.__wbg_ptr,e)}readX(e){return t.parquetchunk_readX(this.__wbg_ptr,e)}readY(e){return t.parquetchunk_readY(this.__wbg_ptr,e)}readCoords(e){try{const n=t.__wbindgen_add_to_stack_pointer(-16);t.parquetchunk_readCoords(n,this.__wbg_ptr,e);var r=g().getInt32(n+0,!0),i=g().getInt32(n+4,!0);let o;return 0!==r&&(o=(s=r,a=i,s>>>=0,(null!==S&&0!==S.byteLength||(S=new Float64Array(t.memory.buffer)),S).subarray(s/8,s/8+a)).slice(),t.__wbindgen_free(r,8*i,8)),o}finally{t.__wbindgen_add_to_stack_pointer(16)}var s,a}readLengths(e){try{const n=t.__wbindgen_add_to_stack_pointer(-16);t.parquetchunk_readLengths(n,this.__wbg_ptr,e);var r=g().getInt32(n+0,!0),i=g().getInt32(n+4,!0);let o;return 0!==r&&(o=(s=r,a=i,s>>>=0,(null!==v&&0!==v.byteLength||(v=new Uint32Array(t.memory.buffer)),v).subarray(s/4,s/4+a)).slice(),t.__wbindgen_free(r,4*i,4)),o}finally{t.__wbindgen_add_to_stack_pointer(16)}var s,a}readGeometryTransformed(e,r,i,s,a){const n=t.parquetchunk_readGeometryTransformed(this.__wbg_ptr,e,r,i,s,a);return 0===n?void 0:Q.__wrap(n)}boundsXMin(e){return t.parquetchunk_boundsXMin(this.__wbg_ptr,e)}boundsYMin(e){return t.parquetchunk_boundsYMin(this.__wbg_ptr,e)}boundsXMax(e){return t.parquetchunk_boundsXMax(this.__wbg_ptr,e)}boundsYMax(e){return t.parquetchunk_boundsYMax(this.__wbg_ptr,e)}readAttribute(e,r){return m(t.parquetchunk_readAttribute(this.__wbg_ptr,e,r))}}const H="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>t.__wbg_parquetfile_free(e>>>0,1)));class W{static __wrap(e){e>>>=0;const t=Object.create(W.prototype);return t.__wbg_ptr=e,H.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,H.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_parquetfile_free(e,0)}metadata(){const e=t.parquetfile_metadata(this.__wbg_ptr);return q.__wrap(e)}rowGroups(){try{const s=t.__wbindgen_add_to_stack_pointer(-16);t.parquetfile_rowGroups(s,this.__wbg_ptr);var e=g().getInt32(s+0,!0),r=g().getInt32(s+4,!0),i=F(e,r).slice();return t.__wbindgen_free(e,4*r,4),i}finally{t.__wbindgen_add_to_stack_pointer(16)}}readChunksWithCallback(e,r){const i=x(e,t.__wbindgen_malloc),s=d;return m(t.parquetfile_readChunksWithCallback(this.__wbg_ptr,i,s,a(r)))}readFirstChunk(e){const r=x(e,t.__wbindgen_malloc),i=d;return m(t.parquetfile_readFirstChunk(this.__wbg_ptr,r,i))}readAllChunks(e){const r=x(e,t.__wbindgen_malloc),i=d;return m(t.parquetfile_readAllChunks(this.__wbg_ptr,r,i))}updateChunks(e){const r=x(e,t.__wbindgen_malloc),i=d;return m(t.parquetfile_updateChunks(this.__wbg_ptr,r,i))}}const J="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>t.__wbg_quantizedgeometry_free(e>>>0,1)));class Q{static __wrap(e){e>>>=0;const t=Object.create(Q.prototype);return t.__wbg_ptr=e,J.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,J.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_quantizedgeometry_free(e,0)}readCoordsUnsafe(){return m(t.quantizedgeometry_readCoordsUnsafe(this.__wbg_ptr))}readLengthsUnsafe(){return m(t.quantizedgeometry_readLengthsUnsafe(this.__wbg_ptr))}}const $="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>t.__wbg_rangeproviderjs_free(e>>>0,1)));class Z{static __wrap(e){e>>>=0;const t=Object.create(Z.prototype);return t.__wbg_ptr=e,$.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_rangeproviderjs_free(e,0)}static new(e,r){const i=t.rangeproviderjs_new(a(e),a(r));return Z.__wrap(i)}static withFetch(){const e=t.rangeproviderjs_withFetch();return Z.__wrap(e)}}const K="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>t.__wbg_rowgroup_free(e>>>0,1)));class X{static __wrap(e){e>>>=0;const t=Object.create(X.prototype);return t.__wbg_ptr=e,K.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,K.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_rowgroup_free(e,0)}columns(){try{const s=t.__wbindgen_add_to_stack_pointer(-16);t.rowgroup_columns(s,this.__wbg_ptr);var e=g().getInt32(s+0,!0),r=g().getInt32(s+4,!0),i=F(e,r).slice();return t.__wbindgen_free(e,4*r,4),i}finally{t.__wbindgen_add_to_stack_pointer(16)}}}function Y(){const e={wbg:{}};return e.wbg.__wbg_buffer_609cc3eee51ed158=function(e){return a(i(e).buffer)},e.wbg.__wbg_call_672a4d21634d4a24=function(){return n((function(e,t){return a(i(e).call(i(t)))}),arguments)},e.wbg.__wbg_call_7cccdd69e0791ae2=function(){return n((function(e,t,r){return a(i(e).call(i(t),i(r)))}),arguments)},e.wbg.__wbg_call_b8adc8b1d0a0d8eb=function(){return n((function(e,t,r,s,n){return a(i(e).call(i(t),i(r),i(s),i(n)))}),arguments)},e.wbg.__wbg_columndescriptor_new=function(e){return a(C.__wrap(e))},e.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,r){let i,s;try{i=e,s=r,console.error(c(e,r))}finally{t.__wbindgen_free(i,s,1)}},e.wbg.__wbg_fieldmetadata_new=function(e){return a(A.__wrap(e))},e.wbg.__wbg_filemetadata_new=function(e){return a(q.__wrap(e))},e.wbg.__wbg_length_a446193dc22c12f8=function(e){return i(e).length},e.wbg.__wbg_new_23a2665fac83c611=function(e,r){try{var i={a:e,b:r};const s=new Promise(((e,r)=>{const s=i.a;i.a=0;try{return function(e,r,i,s){t.wasm_bindgen__convert__closures__invoke2_mut__ha20fd0c25f0fd1fd(e,r,a(i),a(s))}(s,i.b,e,r)}finally{i.a=s}}));return a(s)}finally{i.a=i.b=0}},e.wbg.__wbg_new_8a6f238a6ece86ea=function(){return a(new Error)},e.wbg.__wbg_new_a12002a7f91c75be=function(e){return a(new Uint8Array(i(e)))},e.wbg.__wbg_newnoargs_105ed471475aaf50=function(e,t){return a(new Function(c(e,t)))},e.wbg.__wbg_newwithbyteoffsetandlength_f1dead44d1fc7212=function(e,t,r){return a(new Uint32Array(i(e),t>>>0,r>>>0))},e.wbg.__wbg_newwithbyteoffsetandlength_f254047f7e80e7ff=function(e,t,r){return a(new Int16Array(i(e),t>>>0,r>>>0))},e.wbg.__wbg_pageencodingdescriptor_new=function(e){return a(D.__wrap(e))},e.wbg.__wbg_parquetchunk_new=function(e){return a(G.__wrap(e))},e.wbg.__wbg_parquetfile_new=function(e){return a(W.__wrap(e))},e.wbg.__wbg_queueMicrotask_98e746b9f850fe3d=function(e){queueMicrotask(i(e))},e.wbg.__wbg_queueMicrotask_c847cc8372bec908=function(e){return a(i(e).queueMicrotask)},e.wbg.__wbg_resolve_4851785c9c5f573d=function(e){return a(Promise.resolve(i(e)))},e.wbg.__wbg_rowgroup_new=function(e){return a(X.__wrap(e))},e.wbg.__wbg_set_65595bdd868b3009=function(e,t,r){i(e).set(i(t),r>>>0)},e.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,r){const s=y(i(r).stack,t.__wbindgen_malloc,t.__wbindgen_realloc),a=d;g().setInt32(e+4,a,!0),g().setInt32(e+0,s,!0)},e.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const e="undefined"==typeof global?null:global;return _(e)?0:a(e)},e.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const e="undefined"==typeof globalThis?null:globalThis;return _(e)?0:a(e)},e.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const e="undefined"==typeof self?null:self;return _(e)?0:a(e)},e.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const e="undefined"==typeof window?null:window;return _(e)?0:a(e)},e.wbg.__wbg_then_44b73946d2fb3e7d=function(e,t){return a(i(e).then(i(t)))},e.wbg.__wbg_then_48b406749878a531=function(e,t,r){return a(i(e).then(i(t),i(r)))},e.wbg.__wbg_valueOf_fdbb54fcdfe33477=function(e){return i(e).valueOf()},e.wbg.__wbindgen_array_new=function(){return a([])},e.wbg.__wbindgen_array_push=function(e,t){i(e).push(m(t))},e.wbg.__wbindgen_cb_drop=function(e){const t=m(e).original;return 1==t.cnt--&&(t.a=0,!0)},e.wbg.__wbindgen_closure_wrapper1479=function(e,r,i){const s=function(e,r,i,s){const a={a:e,b:r,cnt:1,dtor:79},n=(...e)=>{a.cnt++;const r=a.a;a.a=0;try{return s(r,a.b,...e)}finally{0===--a.cnt?(t.__wbindgen_export_4.get(a.dtor)(r,a.b),b.unregister(a)):a.a=r}};return n.original=a,b.register(n,a,a),n}(e,r,0,E);return a(s)},e.wbg.__wbindgen_is_function=function(e){return"function"==typeof i(e)},e.wbg.__wbindgen_is_undefined=function(e){return void 0===i(e)},e.wbg.__wbindgen_memory=function(){return a(t.memory)},e.wbg.__wbindgen_number_new=function(e){return a(e)},e.wbg.__wbindgen_object_clone_ref=function(e){return a(i(e))},e.wbg.__wbindgen_object_drop_ref=function(e){m(e)},e.wbg.__wbindgen_string_new=function(e,t){return a(c(e,t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(c(e,t))},e.wbg.__wbindgen_uint8_array_new=function(e,r){var i=w(e,r).slice();return t.__wbindgen_free(e,1*r,1),a(i)},e}function ee(e,r){return t=e.exports,te.__wbindgen_wasm_module=r,h=null,S=null,I=null,v=null,l=null,t.__wbindgen_start(),t}async function te(e){if(void 0!==t)return t;void 0!==e&&(Object.getPrototypeOf(e)===Object.prototype?({module_or_path:e}=e):console.warn("using deprecated parameters for the initialization function; pass a single object instead"));const r=Y();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:i,module:s}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}(await e,r);return ee(i,s)}e.ColumnDescriptor=C,e.FieldMetadata=A,e.FileMetadata=q,e.GeometryInfoDescriptor=U,e.GeometryType=R,e.MultiScaleInfo=N,e.PageEncodingDescriptor=D,e.ParquetChunk=G,e.ParquetFile=W,e.QuantizedGeometry=Q,e.RangeProviderJs=Z,e.RowGroup=X,e.default=te,e.enableTracing=function(){t.enableTracing()},e.initSync=function(e){if(void 0!==t)return t;void 0!==e&&(Object.getPrototypeOf(e)===Object.prototype?({module:e}=e):console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const r=Y();return e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e)),ee(new WebAssembly.Instance(e,r),e)},e.readFile=function(e,r,i,s,n){const o=y(e,t.__wbindgen_malloc,t.__wbindgen_realloc),l=d;V(s,q);var u=s.__destroy_into_raw();let c=0;return _(n)||(V(n,U),c=n.__destroy_into_raw()),m(t.readFile(o,l,a(r),a(i),u,c))},e.readFileFromBinary=function(e,r){let i=0;_(e)||(V(e,U),i=e.__destroy_into_raw());const s=T(r,t.__wbindgen_malloc),a=d;return m(t.readFileFromBinary(i,s,a))},e.readMetadata=function(e,r,i){const s=y(e,t.__wbindgen_malloc,t.__wbindgen_realloc),n=d;return m(t.readMetadata(s,n,a(r),a(i)))},e.readMetadataFromFile=function(e){const r=T(e,t.__wbindgen_malloc),i=d;return m(t.readMetadataFromFile(r,i))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/StreamLayerAdapter":function(){define(["exports","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,i,s,a){"use strict";e.StreamLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const r=this.layer,s=i.getFeatureReductionDeconflictionEnabled(r,e)??i.getLayerDeconflictionEnabled(r),a=t.getEffectiveFeatureReduction(r,e),n=[...r.labelingInfo||[],...a?.labelingInfo||[]];return[{vvEvaluators:{0:i.createLabelVVEvaluator(r.renderer)},deconflictionEnabled:s,labelingInfo:n}]}async createServiceOptions(e){const t=this.layer,i=r.getServiceGeometryType(t),s=t.timeInfo?.toJSON()||null,a=t.spatialReference?t.spatialReference.toJSON():null,n=e.spatialReference.toJSON();return{type:"stream",source:this.layer.parsedUrl,outSpatialReference:n,metadata:{fieldsIndex:this.layer.fieldsIndex.toJSON(),geometryType:i,featureIdInfo:{type:"object-id",fieldName:this.layer.objectIdField},timeInfo:s,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,spatialReference:a,outSpatialReference:n,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}}}createSourceSchema(e,t){const{definitionExpression:r,geometryDefinition:i,customParameters:s}=this.layer;return{type:"stream",mutable:{sourceRefreshVersion:t,availableFields:e.availableFields,dataFilter:{geometryDefinition:i?.toJSON(),definitionExpression:r,customParameters:s??null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(e,r,i){const{fields:a,renderer:n,geometryType:o,labelingInfo:l,labelsVisible:u,objectIdField:c,trackInfo:d}=this.layer,p={fields:a.map((e=>e.toJSON())),renderer:n?.clone(),labelingInfoSource:this.layer.id,featureReduction:t.getEffectiveFeatureReduction(this.layer,r),geometryType:o,labelingInfo:l,labelsVisible:u,objectIdField:c,orderBy:"default",trackInfo:d};return s.createSimpleProcessorSchema(e,r,p,i)}get hasRequiredSupport(){return a.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>t.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.customParameters,()=>this.layer.geometryDefinition,()=>this.layer.definitionExpression,()=>this.layer.trackInfo]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/layerAdapters/SubtypeGroupLayerAdapter":function(){define(["exports","../../../../../core/lang","../../../../../core/mathUtils","../../../../../core/sql","../../../../../layers/support/arcgisLayerUrl","../../../../../layers/support/FeatureFilter","./featureServiceUtils","./floorFilterUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SubtypeProcessorSchema"],(function(e,t,r,i,s,a,n,o,l,u,c,d){"use strict";e.SubtypeGroupLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer;return[{vvEvaluators:{},deconflictionEnabled:t.sublayers.some((e=>u.getLayerDeconflictionEnabled(e))),labelingInfo:t.sublayers.toArray().filter((e=>!!e.labelingInfo)).flatMap((e=>e.labelingInfo))}]}async createServiceOptions(e){const r=this.layer,{capabilities:i,datesInUnknownTimezone:a,dateFieldsTimeZone:o,editingInfo:u,globalIdField:c,objectIdField:d,refreshInterval:p,subtypeField:f}=r,y=r.fieldsIndex.toJSON(),h=l.getServiceGeometryType(r),g=r.timeInfo?.toJSON(),_=r.spatialReference.toJSON(),m=t.clone(this.layer.parsedUrl),b=d,w=!(null!=u?.lastEditDate)&&p>0,S=s.isHostedAgolService(m.path),v=e.spatialReference.toJSON(),F=n.createSnapshotInfo(S,w,i,h,e.extent,r.fullExtent);return{type:"feature-service",source:m,isSourceHosted:S,orderByFields:b,outSpatialReference:v,metadata:{timeReferenceUnknownClient:a,dateFieldsTimeZone:o,subtypeField:f,globalIdField:c,fieldsIndex:y,geometryType:h,featureIdInfo:n.createFeatureIdInfo(this.layer),timeInfo:g,spatialReference:_,outSpatialReference:v,subtypes:this.layer.subtypes?.map((e=>e.toJSON())),typeIdField:null,types:null},queryMetadata:{maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:u?.lastEditDate?.getTime(),snapshotInfo:F}}}createSourceSchema(e,t){const{definitionExpression:r,customParameters:i,gdbVersion:s,historicMoment:a,subtypeField:n,timeExtent:o,apiKey:l,displayFilterInfo:u}=this.layer,d={queryScaleRanges:this.layer.sublayers.items.map((e=>({subtypeCode:e.subtypeCode,minScale:e.minScale,maxScale:e.maxScale}))),definitionExpression:r,displayFilterInfo:u,customParameters:i,gdbVersion:s,historicMoment:a,subtypeField:n,timeExtent:o};return c.createFeatureSourceSchema(d,e,t,l)}createProcessorSchema(e,t,r){const i={labelingInfoSource:this.layer.id,subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,((e,t)=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfoSource:this.layer.id+`-${t}`,labelingInfo:e.labelingInfo,labelsVisible:e.labelsVisible,renderer:e.renderer,subtypeCode:e.subtypeCode,orderBy:null})))};return d.createSubtypeProcessorSchema(e,t,i,r)}addFilters(e,t){e=o.addFloorFilter(this.layer,e,t);const s=this.layer.sublayers.filter((e=>!function(e,t){return e.visible&&(0===e.minScale||r.floatEqualAbsolute(t.scale,e.minScale)||t.scale<e.minScale)&&(0===e.maxScale||r.floatEqualAbsolute(t.scale,e.maxScale)||t.scale>e.maxScale)}(e,t))).map((e=>e.subtypeCode));if(!s.length)return e;e??=new a;const n=`NOT ${this.layer.subtypeField} IN (${s.join(",")})`;return e.where=i.sqlAnd(e.where,n),e}get hasRequiredSupport(){return!0}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>this.layer.definitionExpression,()=>o.hasFloorFilter(this.layer,e)?e.floors:null,()=>this.layer.outFields,()=>this.layer.gdbVersion,()=>this.layer.historicMoment,()=>this.layer.sublayers.map((({renderer:e,labelsVisible:t,labelingInfo:r,visible:i,minScale:s,maxScale:a})=>({renderer:e,labelsVisible:t,labelingInfo:r,visible:i,minScale:s,maxScale:a})))]}setGraphicOrigin(e){const t=this.layer.fieldsIndex.get(this.layer.subtypeField),r=e.attributes[t.name],i=this.layer.sublayers.find((e=>e.subtypeCode===r));e.layer=e.sourceLayer=i}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/features/schema/processor/SubtypeProcessorSchema":function(){define(["exports","./LabelMatcherSchema","./MatcherSchema","./StorageSchema","./VisualVariablesSchema","../../../../../webgl/capabilities"],(function(e,t,r,i,s,a){"use strict";async function n(e,{subtypeField:t,sublayers:i}){const s=await Promise.all(i.map((({renderer:t})=>r.createMatcherSchema(e,t))));return{type:"subtype",subtypeField:t,renderers:i.reduce(((e,{subtypeCode:t},r)=>({...e,[t]:s[r]})),{})}}function o(e,t){const r=a.getWebGLCapabilities();return{type:"multi",filters:e.filters,capabilities:{maxTextureSize:r.maxTextureSize},keyField:t.subtypeField,target:"feature",bindings:t.sublayers.reduce(((e,{renderer:t,subtypeCode:r})=>{const s=i.createVVBindings(t);return{...e,[r]:s}}),{})}}async function l(e,{subtypeField:r,sublayers:i,labelingInfoSource:a}){const n=await Promise.all(i.map((r=>{const i=s.createVisualVariableUniforms(r.renderer),n={...r,geometryType:r.geometryType??null,labelingInfoSource:a};return t.createLabelMatcherSchema(e,n,i)})));return{type:"subtype",subtypeField:r,renderers:i.reduce(((e,{subtypeCode:t},r)=>({...e,[t]:n[r]})),{})}}e.createSubtypeProcessorSchema=async function(e,t,r,i){return{storage:o(t,r),mesh:{properties:{timeZone:t.timeZone,displayRefreshVersion:i,returnMeshObjectId:!1,sortKey:null,currentUser:t.currentUser},strategy:{type:"feature"},factory:{symbology:await n(e,r),labels:await l(e,r)}},expressionProperties:{timeExtent:t.timeExtent?.toJSON()}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/support/DebouncedFeatureOverride":function(){define(["exports"],(function(e){"use strict";e.DebouncedFeatureOverride=class{constructor(){this._commands=new Map,this._historicMoment=null}add(e){switch(e.type){case"override":return this._addOverride(e);case"override-by-id":return this._addOverrideById(e)}}toMessage(){const e={historicMoment:this._historicMoment,commands:{updateByIdWeak:[],updateWeak:[],removeWeak:[],update:[],remove:[],release:[]}};for(const[t,r]of this._commands.entries())switch(r.type){case"override-update-by-id":e.commands.updateByIdWeak.push(t);break;case"override-update":r.isWeak?e.commands.updateWeak.push(r.feature):e.commands.update.push(r.feature);break;case"override-remove":r.isWeak?e.commands.removeWeak.push(t):e.commands.remove.push(t);break;case"override-release":e.commands.release.push(t)}return e}_addOverrideById(e){this._historicMoment=e.historicMoment;for(const t of e.updates)this._commands.set(t,{type:"override-update-by-id",isWeak:e.isWeak});for(const t of e.removed)this._commands.set(t,{type:"override-remove",isWeak:e.isWeak})}_addOverride(e){this._historicMoment=e.historicMoment;for(const t of e.updates)this._commands.set(t.objectId,{type:"override-update",feature:t,isWeak:e.isWeak});for(const t of e.removed)this._commands.set(t,{type:"override-remove",isWeak:e.isWeak});for(const t of e.release)this._commands.set(t,{type:"override-release"})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/support/handleNoEngineError":function(){define(["exports"],(function(e){"use strict";e.handleNoEngineError=async function(e,t){try{return await e}catch(e){if("no-queryEngine"!==e.name)throw e;return t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/tiling/FeatureTileSubscriptionManager":function(){define(["exports","./TileKey"],(function(e,t){"use strict";function r(e,t){const r=new Set;for(const i of e instanceof Set?e.values():e.keys())t.has(i)||r.add(i);return r}class i{constructor(e,t,r){const i=r?e.getTileCoverage(r,0,!0,"closest"):null,s=e.getTileCoverage(t,0,!0,"closest");if(this._tileKeys=new Map,i)for(const e of i.keys())this._tileKeys.set(e.id,e);if(s)for(const e of s.keys())this._tileKeys.set(e.id,e)}get coverageSet(){return new Set(this._tileKeys.keys())}keys(){return this._tileKeys.values()}}class s{constructor(e){this.version=e}}e.FeatureTileSubscriptionManager=class{constructor(e){this._subscriptions=new Map,this._visible=new Set,this._paused=new Set,this._version=0,this._config=e}destroy(){}get coverageSet(){return this._coverage?.coverageSet??new Set}get subscriptions(){return new Set(this._subscriptions.keys())}suspend(){this._suspendedOverage=this._coverage,this._coverage=null,this._updateSubscriptions()}resume(){null==this._coverage&&(this._coverage=this._suspendedOverage,this._suspendedOverage=null,this._updateSubscriptions())}update(e,t){return this._version=(this._version+1)%Number.MAX_SAFE_INTEGER,this._updateCoverage(e,t),this._updateSubscriptions(),new Set(this._visible)}updateVisibility(){const e=this._updateVisibility();return this._visible=e,this._visible}_updateCoverage(e,t){this._coverage=new i(this._config.tileInfoView,e,t)}_updateSubscriptions(){const e=this.coverageSet,t=this._updateVisibility(),i=r(t,e),a=r(this._subscriptions,t),n=r(e,this._subscriptions),o=r(a,e),l=r(i,o),u=r(l,this._paused);this._visible=t;for(const e of n.values())this._subscriptions.set(e,new s(this._version));for(const e of u.values())this._paused.add(e);for(const e of o.values())this._subscriptions.delete(e),this._paused.delete(e);(n.size||o.size||u.size)&&this._sendUpdateSubscriptions(n,o,u)}_sendUpdateSubscriptions(e,t,r){const i=Array.from(e.values()).map((e=>({tileId:e,version:this._subscriptions.get(e).version})));this._config.updateSubscriptions({subscribe:i,unsubscribe:Array.from(t.values()),pause:Array.from(r.values())})}_updateVisibility(){const e=new Set,t=new Set;if(!this._coverage)return e;for(const r of this._coverage.keys())this._config.isDone(r)?e.add(r.id):this._addVisibleParent(e,t,r)||this._addVisibleChildren(e,r)||e.add(r.id);return e}_addVisibleParent(e,r,i){let s=!1;for(const a of this._visible.values())new t(a).containsChild(i)&&(e.add(a),r.add(a),s=!0);return s}_addVisibleChildren(e,r){let i=!1;for(const s of this._visible.values()){const a=new t(s);r.containsChild(a)&&(e.add(s),i=!0)}return i}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/FeatureLayerView":function(){define(["../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/promiseUtils","../../core/reactiveUtils","../../core/sql","../../core/accessorSupport/decorators/property","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../layers/graphics/data/FeatureIdInfo","../../layers/knowledgeGraph/constants","../../layers/support/displayFilterUtils","../../layers/support/FeatureEffect","../../layers/support/FeatureFilter","../../layers/support/featureLayerUtils","../../layers/support/featurePopupQueryUtils","../../layers/support/fieldUtils","../../layers/support/floorFilterUtils","../../networks/support/networkFieldUtils","../../rest/support/Query","../2d/layers/features/layerAdapters/featureServiceUtils","./support/popupUtils","./support/WhereClauseVisitor"],(function(e,t,r,i,s,a,n,o,l,u,c,d,p,f,y,h,g,_,m,b,w,S,v){"use strict";return t=>{let o=class extends t{constructor(...e){super(...e),this._updatingRequiredPromise=null,this.filter=null,this.layer=null,this.requiresCurrentUser=!1,this.requiredFields=[],this.view=null}initialize(){this.addHandles([s.watch((()=>{const e=this.layer,t=this.view;return[e&&"elevationInfo"in e?e.elevationInfo?.featureExpressionInfo:null,e&&"displayField"in e?e.displayField:null,e&&"timeInfo"in e&&e.timeInfo,e&&"renderer"in e&&e.renderer,e&&"labelingInfo"in e&&e.labelingInfo,e&&"floorInfo"in e&&e.floorInfo,t?.requiredFieldsOptions?.featureTitleFields&&e&&"featureTitleFields"in e&&e.featureTitleFields,t?.requiredFieldsOptions?.utilityNetworkFields&&m.getUtilityNetworkFields(t,e),e.displayFilterInfo,this.displayFilterEnabled,this.filter,this.featureEffect,this.timeExtent,"knowledge-graph-sublayer"===e?.type&&"link-chart"===e.parentCompositeLayer.type&&e.parentCompositeLayer.linkChart?.linkChartProperties.nonspatialDataDisplay?.mode,"parquet"===e?.type&&e.popupTemplate]}),(()=>this._handleChange()),s.syncAndInitial),s.on((()=>this.view?.floors),"change",(()=>this._handleChange())),s.on((()=>this.layer.displayFilterInfo?.filters),"change",(()=>this._handleChange())),s.on((()=>this.layer&&"sublayers"in this.layer?this.layer.sublayers:null),"change",(()=>this._handleChange()))])}get availableFields(){if(!this.layer)return[];const{layer:e,layer:{fieldsIndex:t},requiredFields:r}=this;return"outFields"in e&&e.outFields?g.fixFields(t,[...g.unpackFieldNames(t,e.outFields),...r]):g.fixFields(t,r)}get displayFilterEnabled(){return(this.view?.displayFilterEnabled??!0)&&(!("displayFilterEnabled"in this.layer)||(this.layer?.displayFilterEnabled??!0))}get effectiveDisplayFilter(){const e=this.layer;return this.displayFilterEnabled&&e.displayFilterInfo?d.getEffectiveDisplayFilter(e.displayFilterInfo,this.view):null}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(e){this._override("featureEffect",e)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){r.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}get signedInUser(){return this.layer?.url?y.getSignedInUser(this.layer.url):Promise.resolve(null)}highlight(e,t){throw new Error("missing implementation")}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=null!=this.filter?this.filter.createQuery(e):new b(e);return"floorInfo"in this.layer&&this.layer.floorInfo&&(t.where=a.sqlAnd(t.where,_.getFloorFilterClause(this))),this.displayFilterEnabled&&(t.where=a.sqlAnd(t.where,this.effectiveDisplayFilter?.where)),null!=this.timeExtent&&(t.timeExtent=null!=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}createAggregateQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return new b(e)}queryFeatures(e,t){throw new Error("missing implementation")}queryObjectIds(e,t){throw new Error("missing implementation")}queryFeatureCount(e,t){throw new Error("missing implementation")}queryExtent(e,t){throw new Error("missing implementation")}async fetchPopupFeaturesFromGraphics(e,t){const r=await this._createPopupQuery(e.map((e=>e.origin?.layer??e.layer)),t);return await h.fetchFeaturePopupFeatures(this.layer,e,r,{getPopupTemplate:e=>e&&"popupEnabled"in e&&e.popupEnabled?S.getFetchPopupTemplate(e,t):null,hasRequiredFields:(e,t)=>this._popupFeatureHasRequiredFields(e,t),...t})}_handleChange(){const e=Promise.all([this._updateRequiredFields(),this._updateClientWhereClauseRequirements()]).then((()=>{}));return this._set("_updatingRequiredPromise",e),e.then((()=>{this._updatingRequiredPromise===e&&this._set("_updatingRequiredPromise",null)})),e}async _updateClientWhereClauseRequirements(){if(!this.layer||!this.view)return;const{layer:e}=this,t=new v.WhereClauseVisitor(e.fieldsIndex);if(t.visitFilter(this.filter),"featureReduction"in e&&t.visitFeatureReduction(e.featureReduction),"labelingInfo"in e&&t.visitLabelingInfo(e.labelsVisible,e.labelingInfo),"trackInfo"in e&&t.visitTrackInfo(e.trackInfo),"2d"===this.view.type&&(t.visitFilter(this.featureEffect?.filter),t.visitDisplayFilter(this.displayFilterEnabled,e.displayFilterInfo),"featureReduction"in e&&t.visitFeatureReduction(e.featureReduction)),"subtype-group"===e.type)for(const r of e.sublayers)t.visitLabelingInfo(r.labelsVisible,r.labelingInfo);try{const e=await t.finish();this._set("requiresCurrentUser",e.requiresCurrentUser)}catch(e){r.getLogger(this).error(e)}}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e="3d"===this.view.type,{layer:t,layer:{fieldsIndex:i}}=this,s="renderer"in t&&t.renderer,a="orderBy"in t&&t.orderBy,n="featureReduction"in t?t.featureReduction:null,o=new Set,l=[s?s.collectRequiredFields(o,i):null,g.collectLabelingFields(o,t),e&&"elevationInfo"in t?g.collectElevationFields(o,t):null,null!=this.filter?g.collectFilterFields(o,t,this.filter):null,e||null==this.featureEffect?null:g.collectFilterFields(o,t,this.featureEffect.filter),!e&&n?g.collectFeatureReductionFields(o,t,n):null,!e&&a?g.collectOrderByInfos(o,t,a):null];if("timeInfo"in t&&t.timeInfo&&this.timeExtent&&g.collectFields(o,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),"timeInfo"in t&&t.timeInfo&&"trackInfo"in t&&t.trackInfo){const{trackInfo:e}=t;g.collectFields(o,t.fieldsIndex,[t.timeInfo.trackIdField]),"feature"!==t.type&&"startTimeField"!==e.timeField||g.collectFields(o,t.fieldsIndex,[t.timeInfo.startField]),"endTimeField"===e.timeField&&g.collectFields(o,t.fieldsIndex,[t.timeInfo.endField]),await g.collectTrackInfoFields(o,t)}if("floorInfo"in t&&t.floorInfo&&g.collectFields(o,t.fieldsIndex,[t.floorInfo.floorField]),"featureTitleFields"in t&&this.view?.requiredFieldsOptions?.featureTitleFields&&t.featureTitleFields&&g.collectFields(o,t.fieldsIndex,t.featureTitleFields),"feature"===t.type&&t.globalIdField&&this.view?.requiredFieldsOptions?.globalIdField&&g.collectFields(o,t.fieldsIndex,[t.globalIdField]),this.displayFilterEnabled&&l.push(g.collectDisplayFilterFields(o,t,t.displayFilterInfo)),"feature"===t.type&&e&&null!=t.infoFor3D&&(null==t.globalIdField&&r.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),g.collectFields(o,t.fieldsIndex,[t.globalIdField])),"subtype-group"===t.type){g.collectField(o,i,t.subtypeField);const e=t.sublayers.map((e=>Promise.all([e.renderer?.collectRequiredFields(o,i),g.collectLabelingFields(o,e)])));l.push(Promise.all(e))}if("catalog-footprint"===t.type&&t.parent){const e=t.parent;g.collectFields(o,i,[e.itemNameField,e.itemSourceField,e.itemTypeField,e.maxScaleField,e.minScaleField])}"knowledge-graph-sublayer"===t.type&&"link-chart"===t.parentCompositeLayer.type&&g.collectField(o,i,c.systemIsSpatialFieldName),"parquet"===t.type&&l.push(S.getRequiredFields(t,t.popupTemplate).then((e=>{for(const t of e)o.add(t)})));const d=await Promise.allSettled(l);if(e)g.collectField(o,i,t.objectIdField);else for(const e of u.getFeatureIdInfoFieldNames(w.createFeatureIdInfo(t)))g.collectField(o,i,e);e&&"displayField"in t&&t.displayField&&g.collectField(o,i,t.displayField);for(const e of d)"rejected"===e.status&&r.getLogger(this).error(e.reason);const p=Array.from(o).sort();this._set("requiredFields",p)}_popupFeatureHasRequiredFields(e,t){return g.featureHasFields(e,t)}async _createPopupQuery(e,t){const r=this.layer.createQuery(),s=new Set;let n=!1;const o=e??[this.layer];for(const e of o){if(!("popupEnabled"in e))continue;const r=S.getFetchPopupTemplate(e,t);if(null==r)continue;const a=await h.loadFeaturePopupArcadeModules(r);i.throwIfAborted(t);const o=a&&a.arcadeUtils.hasGeometryOperations(r);n=!("point"!==this.layer.geometryType&&!o);const l=await S.getRequiredFields(this.layer,r);i.throwIfAborted(t);for(const e of l)s.add(e)}return r.returnGeometry=n,r.returnZ=n,r.returnM=n,r.outFields=Array.from(s),r.outSpatialReference=this.view.spatialReference,"floorInfo"in this.layer&&this.layer.floorInfo&&(r.where=a.sqlAnd(r.where,_.getFloorFilterClause(this))),r}canResume(){return!(!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty)}getTest(){}get test(){}};return e.__decorate([n.property()],o.prototype,"_updatingRequiredPromise",void 0),e.__decorate([n.property({readOnly:!0})],o.prototype,"availableFields",null),e.__decorate([n.property({readOnly:!0})],o.prototype,"displayFilterEnabled",null),e.__decorate([n.property({readOnly:!0})],o.prototype,"effectiveDisplayFilter",null),e.__decorate([n.property({type:p})],o.prototype,"featureEffect",null),e.__decorate([n.property({type:f})],o.prototype,"filter",void 0),e.__decorate([n.property()],o.prototype,"layer",void 0),e.__decorate([n.property({type:Number})],o.prototype,"maximumNumberOfFeatures",null),e.__decorate([n.property({readOnly:!0,type:Boolean})],o.prototype,"maximumNumberOfFeaturesExceeded",null),e.__decorate([n.property()],o.prototype,"requiresCurrentUser",void 0),e.__decorate([n.property({readOnly:!0})],o.prototype,"requiredFields",void 0),e.__decorate([n.property({readOnly:!0})],o.prototype,"signedInUser",null),e.__decorate([n.property()],o.prototype,"suspended",void 0),e.__decorate([n.property()],o.prototype,"view",void 0),o=e.__decorate([l.subclass("esri.views.layers.FeatureLayerView")],o),o}}))},"esri/layers/graphics/data/FeatureIdInfo":function(){define(["exports"],(function(e){"use strict";e.getFeatureIdInfoFieldNames=function*(e){switch(e.type){case"object-id":case"unique-id-simple":return void(yield e.fieldName);case"unique-id-composite":return void(yield*e.fieldNames)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/featurePopupQueryUtils":function(){define(["exports","../../core/promiseUtils","../../core/sql","./fieldUtils","../../support/loadArcade"],(function(e,t,r,i,s){"use strict";async function a(e){if(e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type)))return s.loadArcade()}e.fetchFeaturePopupFeatures=async function(e,s,n,o){const l=new Array(s.length),u=new Map,c=new Map,d=i.unpackFieldNames(e.fieldsIndex,n.outFields),p=o?.hasRequiredFields??i.featureHasFields;for(let e=0;e<s.length;e++){const r=s[e];if(r.isAggregate){l[e]=r;continue}let i=!1;if(o?.getPopupTemplate){const e=r.origin?.layer??r.sourceLayer??r.layer,s=o.getPopupTemplate(e);if(null==s)continue;const n=await a(s);t.throwIfAborted(o),i=n&&n.arcadeUtils.hasGeometryOperations(s)}if(i||!p(r,d)){const t=r.getObjectId();if(null!=t){u.set(t,{graphic:r,index:e});continue}const i=r.getGlobalId();if(null!=i){c.set(i,{graphic:r,index:e});continue}}l[e]=r}if(!e.queryFeatures||0===u.size&&0===c.size)return l.filter(Boolean);const f=[],y=(e,t)=>{t&&(e.outFields??=[],e.outFields.includes(t)||e.outFields.push(t))};if(u.size>0){const t=n.clone();y(t,e.objectIdField),"uniqueIdFields"in e&&e.uniqueIdFields?.length&&(t.outFields??=[],t.outFields.push(...e.uniqueIdFields)),t.objectIds=Array.from(u.keys()),f.push({type:"object-id",query:t,map:u})}const h="globalIdField"in e?e.globalIdField:null;if(null!=h&&c.size>0){const e=n.clone();y(e,h);const t=Array.from(c.keys());e.where=r.sqlAnd(n.where,`${h} IN (${t.map((e=>`'${e}'`)).join(",")})`),f.push({type:"global-id",query:e,map:c})}const g=o?.updateSourceAttributes??!1;for(const{type:t,query:r,map:i}of f)try{const s=await e.queryFeatures(r,o);for(const e of s.features){const r="object-id"===t?e.getObjectId():e.getGlobalId();if(null==r)continue;const s=i.get(r);if(!s)continue;const{graphic:a,index:n}=s;if(g&&e.attributes){a.attributes??={};for(const t of d)t in e.attributes&&(a.attributes[t]=e.attributes[t])}const{geometry:o,origin:u}=a;e.geometry||=o,e.origin=u,l[n]=e}}catch{}return l.filter(Boolean)},e.loadFeaturePopupArcadeModules=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/floorFilterUtils":function(){define(["exports"],(function(e){"use strict";function t(e,t){if(!e?.length)return null;const r=e.filter((e=>""!==e)).map((e=>`'${e}'`));return r.push("''"),`${t} IN (${r.join(",")}) OR ${t} IS NULL`}e.getFloorFilterClause=function(e){const r=e.layer;return"floorInfo"in r&&r.floorInfo?.floorField&&"floors"in e.view?t(e.view.floors,r.floorInfo.floorField):null},e.getLayerFloorFilterClause=function(e,r){return"floorInfo"in r&&r.floorInfo?.floorField?t(e,r.floorInfo.floorField):null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/networks/support/networkFieldUtils":function(){define(["exports"],(function(e){"use strict";e.getAssociationsTableFields=function(e){const t=e?.fieldsIndex,r="fromnetworksourceid",i="fromglobalid",s="fromterminalid",a="tonetworksourceid",n="toglobalid",o="toterminalid",l="status",u="associationtype",c="iscontentvisible",d="percentalong",p="globalid";return{fromNetworkSourceId:t?.get(r)?.name??r,fromGlobalId:t?.get(i)?.name??i,fromTerminalId:t?.get(s)?.name??s,toNetworkSourceId:t?.get(a)?.name??a,toGlobalId:t?.get(n)?.name??n,toTerminalId:t?.get(o)?.name??o,status:t?.get(l)?.name??l,associationType:t?.get(u)?.name??u,isContentVisible:t?.get(c)?.name??c,percentAlong:t?.get(d)?.name??d,globalId:t?.get(e?.globalIdField??p)?.name??p}},e.getUtilityNetworkFields=function(e,t){if("feature"!==t.type&&"subtype-group"!==t.type)return[];if(!t.url)return[];const r="utilityNetworks"in e.map?e.map.utilityNetworks??[]:[];for(const e of r)if(e.isUtilityLayer(t)){const e=t.fieldsIndex.get("assetgroup"),r=t.fieldsIndex.get("assettype");return[e?.name,r?.name].filter((e=>null!=e))}return[]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],(function(e,t){"use strict";function r(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}e.getFetchPopupTemplate=r,e.getRequiredFields=async function(e,r=e.popupTemplate){if(null==r)return[];const i=await r.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:s}=r,{objectIdField:a,typeIdField:n,globalIdField:o,relationships:l}=e;if(i.includes("*"))return["*"];const u=s?t.getFeatureEditFields(e):[],c=t.fixFields(e.fieldsIndex,[...i,...u]);return n&&c.push(n),c&&a&&e.fieldsIndex?.has(a)&&!c.includes(a)&&c.push(a),c&&o&&e.fieldsIndex?.has(o)&&!c.includes(o)&&c.push(o),l&&l.forEach((t=>{const{keyField:r}=t;c&&r&&e.fieldsIndex?.has(r)&&!c.includes(r)&&c.push(r)})),c},e.hasPopupTemplate=function(e,t){return null!=r(e,{defaultPopupTemplateEnabled:t})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/support/WhereClauseVisitor":function(){define(["exports","../../../core/sql"],(function(e,t){"use strict";e.WhereClauseVisitor=class{constructor(e){this._fieldsIndex=e,this._clauses=[]}async finish(){return{requiresCurrentUser:(await Promise.all(this._clauses)).some((e=>e.currentUserRequired))}}visitClientWhereClause(e){e&&this._clauses.push(t.parseWhereClause(e,this._fieldsIndex))}visitFeatureReduction(e){if(e)switch(e.type){case"binning":case"cluster":this.visitLabelingInfo(e.labelsVisible,e.labelingInfo)}}visitLabelingInfo(e,t){if(e&&null!=t)for(const e of t)this.visitClientWhereClause(e.where)}visitDisplayFilter(e,t){if(e)for(const e of t?.filters??[])this.visitClientWhereClause(e.where)}visitFilter(e){this.visitClientWhereClause(e?.where)}visitTrackInfo(e){null!=e&&(this.visitLabelingInfo(e?.latestObservations.labelsVisible,e?.latestObservations.labelingInfo),this.visitLabelingInfo(e?.previousObservations.labelsVisible,e?.previousObservations.labelingInfo),this.visitLabelingInfo(e?.trackLines.labelsVisible,e?.trackLines.labelingInfo))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/RefreshableLayerView":function(){define(["../../chunks/tslib.es6","../../core/Logger","../../core/promiseUtils","../../core/reactiveUtils","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,s,a,n,o){"use strict";return s=>{let a=class extends s{initialize(){this.addHandles(i.on((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{r.isAbortError(e)||t.getLogger(this).error(e)}))})),"RefreshableLayerView")}};return a=e.__decorate([o.subclass("esri.views.layers.RefreshableLayerView")],a),a}}))},"*noref":1}}),define(["exports","../../../chunks/tslib.es6","../../../AggregateGraphic","../../../Graphic","../../../TrackGraphic","../../../core/arrayUtils","../../../core/Collection","../../../core/compilerUtils","../../../core/Error","../../../core/handleUtils","../../../core/has","../../../core/Logger","../../../core/maybe","../../../core/object","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/sql","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/support/UpdatingHandles","../../../geometry/Extent","../../../layers/effects/FeatureEffectView","../../../layers/graphics/featureConversionUtils","../../../layers/support/FeatureFilter","../../../layers/support/featureLayerUtils","../../../layers/support/fieldUtils","../../../layers/support/layerUtils","../../../layers/support/timeSupport","../../../rest/support/AggregateFeatureSet","../../../rest/support/AttributeBinsFeatureSet","../../../rest/support/AttributeBinsQuery","../../../rest/support/FeatureSet","../../../rest/support/Query","./LayerView2D","./features/FeatureContainer","./features/FeaturePipelineWorkerProxy","./features/FeatureSourceEventLog","./features/layerAdapters/CatalogFootprintLayerAdapter","./features/layerAdapters/FeatureLayerAdapter","./features/layerAdapters/featureServiceUtils","./features/layerAdapters/InMemoryLayerAdapter","./features/layerAdapters/KnowledgeGraphSublayerAdapter","./features/layerAdapters/OGCFeatureLayerAdapter","./features/layerAdapters/OrientedImageryLayerAdapter","./features/layerAdapters/ParquetLayerAdapter","./features/layerAdapters/StreamLayerAdapter","./features/layerAdapters/SubtypeGroupLayerAdapter","./features/schema/processor/symbols/ComplexSymbolSchema","./support/DebouncedFeatureOverride","./support/FeatureCommandQueue","./support/handleNoEngineError","./support/util","../tiling/FeatureTileSubscriptionManager","../../layers/FeatureLayerView","../../layers/LayerView","../../layers/RefreshableLayerView","../../support/HighlightDefaults"],(function(e,t,r,i,s,a,n,o,l,u,c,d,p,f,y,h,g,_,m,b,w,S,v,F,I,x,T,V,E,R,k,O,C,M,A,P,q,L,U,z,N,j,D,B,G,H,W,J,Q,$,Z,K,X,Y,ee,te,re){"use strict";const ie=4294967294;return e.default=class extends(Y(te(M.LayerView2DMixin(ee)))){constructor(){super(...arguments),this._commandsQueue=new $.FeatureCommandQueue({process:e=>{switch(e.type){case"override-batch":return this._doOverride(e);case"update":return this._doUpdate();case"highlight":return this._updateHighlights()}}}),this._visibilityOverrides=new Set,this._lastAvailableFields=[],this._lastTargetState=null,this.eventLog=new q.FeatureSourceEventLog,this._sourceRefreshVersion=1,this._displayRefreshVersion=1,this._pipelineUpdating=!1,this._editUpdatingHandles=new b.UpdatingHandles,this._fields=null,this._sourceUpdating=!1,this.featureEffectView=new S}destroy(){this._workerProxy?.destroy(),this._workerAttached.reject(y.createAbortError()),this._commandsQueue.destroy()}initialize(){this._workerAttached=y.createResolver(),y.ignoreAbortErrors(this._workerAttached.promise),this.addResolvingPromise(this._initProxy()),this.featureEffectView.featureEffect=this.featureEffect,this.featureEffectView.endTransition()}async _initProxy(){const e=this.layer;if("isTable"in e&&e.isTable)throw new l("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:e});if(("feature"===e.type||"subtype-group"===e.type)&&!1===T.getEffectiveLayerCapabilities(e)?.operations.supportsQuery)throw new l("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:e});this._workerProxy&&this._workerProxy.destroy();const t=this._createClientOptions();this._workerProxy=await P.createFeaturePipelineWorkerProxy(t)}async _attachProxy(){const e={service:await this.layerAdapter.createServiceOptions(this.view),tileInfoJSON:this.view?.featuresTilingScheme?.tileInfo?.toJSON()};let t=[];Array.isArray(e.service.source)&&(t=e.service.source);try{await this._workerProxy.pipeline.onAttach(e,{transferList:t}),this._workerAttached.resolve()}catch(e){this._workerAttached.reject(y.createAbortError()),y.throwIfNotAbortError(e)}}async _detachProxy(){return this._workerProxy.pipeline.onDetach()}async getWorker(){return await this._workerAttached.promise,this._workerProxy}get dataUpdating(){return this._sourceUpdating||this._editUpdatingHandles.updating}get effectiveDisplayFilterClause(){const e=this.effectiveDisplayFilter?.where??null;return e&&this.hasHighlight?g.sqlOr(e,g.sqlIn(this.layer.objectIdField,this.highlightIds)):e}get hasAllFeatures(){return this.layer.visible&&!this.suspended&&this.eventLog.hasAllData&&this.eventLog.willQueryAllFeatures}get hasAllFeaturesInView(){const e=this.effectiveDisplayFilter?.where||null,t=!this.eventLog.willQueryAllFeatures&&null!=e&&"1=1"!==e;return this.layer.visible&&!this.suspended&&this.eventLog.hasAllData&&!t}get hasFullGeometries(){return this.layer.visible&&!this.suspended&&this.eventLog.hasAllData&&this.eventLog.willQueryFullResolutionGeometry}get labelingCollisionInfos(){const e=this.layerAdapter.getLabelingDeconflictionInfo(this.view),t=this.layer.geometryType,r=!this.suspended;return e.map((({vvEvaluators:e,deconflictionEnabled:i,labelingInfo:s})=>({labelingInfo:s,container:this.featureContainer,vvEvaluators:e,deconflictionEnabled:i,geometryType:t,visible:r})))}get layerAdapter(){switch(this.layer.type){case"feature":return"memory"===this.layer.source.type?new N.InMemoryLayerAdapter(this.layer):new U.FeatureLayerAdapter(this.layer);case"geojson":case"csv":case"wfs":return new N.InMemoryLayerAdapter(this.layer);case"parquet":return new G.ParquetLayerAdapter(this.layer);case"subtype-group":return new W.SubtypeGroupLayerAdapter(this.layer);case"ogc-feature":return new D.OGCFeatureLayerAdapter(this.layer);case"stream":return new H.StreamLayerAdapter(this.layer);case"oriented-imagery":return new B.OrientedImageryLayerAdapter(this.layer);case"knowledge-graph-sublayer":return new j.KnowledgeGraphSublayerAdapter(this.layer);case"catalog-footprint":return new L.CatalogFootprintLayerAdapter(this.layer);default:o.neverReached(this.layer)}return null}get timeExtent(){return V.combineTimeExtent(this.layerAdapter.timeOptions,this.view?.timeExtent,this._get("timeExtent"))}getDisplayStatistics(e,t){return this.featureContainer?.getDisplayStatistics(e,t)}async queryHeatmapStatistics(e){return(await this.getWorker()).pipeline.queryHeatmapStatistics(e)}highlight(e,t){let r;e instanceof i?r=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?r=[e]:n.isCollection(e)&&e.length>0?r=e.map((e=>e?.getObjectId())).toArray():Array.isArray(e)&&e.length>0&&(r="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((e=>e?.getObjectId())));const s=r?.filter(a.isSome);if(!s?.length)return u.makeHandle();const o=t?.name??re.defaultHighlightName;return this._addHighlights(s,o),u.makeHandle((()=>!this.destroyed&&this._removeHighlights(s,o)))}async hitTest(e,t){const a=await this.featureContainer.hitTest(t);if(0===a.length)return null;const n=await this.getWorker(),{features:o,aggregates:l,tracks:u}=await n.pipeline.getDisplayFeatures(a),c=this.featureContainer.getSortKeys(a),d=({displayId:e},{displayId:t})=>c.has(e)&&c.has(t)?c.get(e)-c.get(t):e-t;return o.sort(d).reverse(),l.sort(d).reverse(),[...l.map((t=>this._createGraphicHit(e,r.fromJSON(t)))),...u.map((t=>this._createGraphicHit(e,s.fromJSON(t)))),...o.map((t=>this._createGraphicHit(e,i.fromJSON(t))))]}async queryStatistics(){const e=await this.getWorker();return Z.handleNoEngineError(e.pipeline.queryStatistics(),{featureCount:0,ringCount:0,vertexCount:0})}async querySummaryStatistics(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.features.executeQueryForSummaryStatistics(this._cleanUpQuery(e),s,r);return Z.handleNoEngineError(a,{})}async queryAggregateSummaryStatistics(e,t,r){const i={...t,scale:this.view.scale},s=(await this.getWorker()).aggregates.executeQueryForSummaryStatistics(this._cleanUpAggregateQuery(e),i,r);return Z.handleNoEngineError(s,{})}async queryUniqueValues(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.features.executeQueryForUniqueValues(this._cleanUpQuery(e),s,r);return Z.handleNoEngineError(a,{uniqueValueInfos:[]})}async queryAggregateUniqueValues(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.aggregates.executeQueryForUniqueValues(this._cleanUpAggregateQuery(e),s,r);return Z.handleNoEngineError(a,{uniqueValueInfos:[]})}async queryClassBreaks(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.features.executeQueryForClassBreaks(this._cleanUpQuery(e),s,r);return Z.handleNoEngineError(a,{classBreakInfos:[]})}async queryAggregateClassBreaks(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.aggregates.executeQueryForClassBreaks(this._cleanUpAggregateQuery(e),s,r);return Z.handleNoEngineError(a,{classBreakInfos:[]})}async queryHistogram(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.features.executeQueryForHistogram(this._cleanUpQuery(e),s,r);return Z.handleNoEngineError(a,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}async queryAggregateHistogram(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.aggregates.executeQueryForHistogram(this._cleanUpAggregateQuery(e),s,r);return Z.handleNoEngineError(a,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}queryFeatures(e,t){return this.queryFeaturesJSON(e,t).then((e=>{const t=O.fromJSON(e);return t.features.forEach((e=>this._setLayersForFeature(e))),t}))}async queryVisibleFeatures(e,t){const r=(await this.getWorker()).pipeline.queryVisibleFeatures(this._cleanUpQuery(e),t),i=await Z.handleNoEngineError(r,{features:[]}),s=O.fromJSON(i);return s.features.forEach((e=>this._setLayersForFeature(e))),s}async queryAggregates(e,t){const r=(await this.getWorker()).aggregates.executeQuery(this._cleanUpAggregateQuery(e),t),i=await Z.handleNoEngineError(r,{features:[]}),s=E.fromJSON(i);return s.features.forEach((e=>this._setLayersForFeature(e))),s}async queryAggregateIds(e,t){const r=(await this.getWorker()).aggregates.executeQueryForIds(this._cleanUpAggregateQuery(e),t);return Z.handleNoEngineError(r,[])}async queryAggregateCount(e,t){const r=(await this.getWorker()).aggregates.executeQueryForCount(this._cleanUpAggregateQuery(e),t);return Z.handleNoEngineError(r,0)}async queryAggregateJSON(e,t){const r=(await this.getWorker()).aggregates.executeQuery(this._cleanUpAggregateQuery(e),t);return Z.handleNoEngineError(r,{features:[]})}async queryFeaturesJSON(e,t){const r=(await this.getWorker()).features.executeQuery(this._cleanUpQuery(e),t);return Z.handleNoEngineError(r,{features:[]})}async queryObjectIds(e,t){const r=(await this.getWorker()).features.executeQueryForIds(this._cleanUpQuery(e),t);return Z.handleNoEngineError(r,[])}async queryFeatureCount(e,t){const r=(await this.getWorker()).features.executeQueryForCount(this._cleanUpQuery(e),t);return Z.handleNoEngineError(r,0)}async queryExtent(e,t){const r=(await this.getWorker()).features.executeQueryForExtent(this._cleanUpQuery(e),t),i=await Z.handleNoEngineError(r,{count:0,extent:null});return{count:i.count,extent:w.fromJSON(i.extent)}}async queryAttributeBins(e,t){const r=(await this.getWorker()).features.executeAttributeBinsQuery(this._cleanUpAttributeBinsQuery(e),t),i=await Z.handleNoEngineError(r,{features:[]});return R.fromJSON(i)}async getSampleFeatures(e){return(await this.getWorker()).pipeline.getSampleFeatures(e)}setVisibility(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}update(e){if(!this.subscriptionManager)return;this.view.animation&&!this._lastTargetState&&(this._lastTargetState=e.state.clone()),!this.view.animation&&this._lastTargetState&&(this._lastTargetState=null);const t=this.subscriptionManager.update(e.targetState,this._lastTargetState),r=this.subscriptionManager.coverageSet;for(const e of this.featureContainer.tiles||[])e.isCoverage=r.has(e.id),e.neededForCoverage=t.has(e.id)||e.isCoverage;this.featureContainer.setVisibleTiles(t)}attach(){var e,t;c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach"),y.ignoreAbortErrors(this._updatingHandles.addPromise(this._workerAttached.promise)),y.ignoreAbortErrors(this._attachProxy()),this.featureContainer=new A.FeatureContainer(this),this.container.addChild(this.featureContainer),this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this.subscriptionManager=new X.FeatureTileSubscriptionManager({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:e=>{this.featureContainer.updateSubscriptions(e),y.ignoreAbortErrors(this._updatingHandles.addPromise(this.getWorker().then((t=>t.pipeline.updateSubscriptions(e)))))},isDone:e=>this.featureContainer.isDone(e)}),this.requestUpdate(),this.addAttachHandles([(e=[()=>this._displayRefreshVersion,()=>this.layer.displayFilterInfo,()=>this.timeExtent,()=>this.clips,()=>this.filter,()=>this.effectiveDisplayFilterClause,()=>this.featureEffect,()=>this._sourceRefreshVersion,()=>this.view.timeZone,()=>this.view.timeExtent,...this.layerAdapter.getUpdateHashProperties(this.view)],t=()=>this._update(),u.handlesGroup(e.map((e=>h.watch((()=>{const t=e();return t&&"object"==typeof t?"getTime"in t&&"function"==typeof t.getTime?t.getTime():JSON.stringify(t):t}),t))))),h.watch((()=>this.updateSuspended),(e=>{e||(this.subscriptionManager.resume(),this.view.labelManager.requestUpdate())})),h.watch((()=>this.visible),(e=>{this.view.labelManager.requestUpdate()}))]),this._update(),"stream"!==this.layer.type&&"parquet"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",(e=>this._editUpdatingHandles.addPromise(this._edit(e)))))}detach(){c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach"),this._detachProxy(),this._fields=null,this.view.labelManager.removeContainer(this.featureContainer),this.featureContainer.destroy(),this.featureContainer=null,this._commandsQueue.clear(),this.container.removeAllChildren(),this.subscriptionManager=p.destroyMaybe(this.subscriptionManager),this._workerProxy.pipeline.onDetach(),this._workerAttached=y.createResolver(),y.ignoreAbortErrors(this._workerAttached.promise),this._lastAvailableFields=[],this._lastSchema=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}addOverrides(e){return this._commandsQueue.push({type:"override",options:{...e,release:[]}})}removeOverrides(e){for(const t of e)if(null==t)throw new l("featurelayerview:bad-override","Tried to remove an override for an invalid objectId",{objectId:t});const t={added:[],updated:[],removed:[],release:e,isWeak:!1,historicMoment:null};return this._commandsQueue.push({type:"override",options:t})}isUpdating(){const e="renderer"in this.layer&&null!=this.layer.renderer,t=this._commandsQueue.updateTracking.updating,r=null!=this._updatingRequiredPromise,i=this.featureContainer.updatingHandles.updating,s=this.updateRequested||e&&(t||r)||i||this._pipelineUpdating||this.dataUpdating;if(c("esri-2d-log-updating")){console.log(`Updating FLV2D (${this.layer.id}): ${s}\n  -> updateRequested ${this.updateRequested}\n  -> hasRenderer ${e}\n  -> updatingRequiredFields ${r}\n  -> hasPendingCommand ${t}\n  -> dataUpdating ${this.dataUpdating}\n  -> processing ${this._pipelineUpdating}\n  -> updatingContainer ${i}\n`);for(const e of this.featureContainer.subscriptions())console.log(`    -> Tile[${e.id}] Done: ${e.done}`)}return s}_createClientOptions(){const e=this;return{get container(){return e.featureContainer},setUpdating:e=>{this._set("_pipelineUpdating",e.pipeline),this._set("_sourceUpdating",e.source)},emitEvent:e=>{this.emit(e.name,e.event)},get eventLog(){return e.eventLog},fetch:async t=>{if(c("esri-2d-stabilize-glyphs")){const r=[];for(const i of t)r.push(await e.view.stage.painter.textureManager.rasterizeItem(i));return r}return Promise.all(t.map((t=>e.view.stage.painter.textureManager.rasterizeItem(t))))},fetchDictionary:e=>Promise.all(e.map((e=>this._fetchDictionaryRequest(e))))}}async _fetchDictionaryRequest(e){try{if("subtype-group"===this.layer.type)throw new Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");const t=this.layer.renderer;if(!t||"dictionary"!==t.type)throw new Error("InternalError: Expected layer to have a DictionaryRenderer");const r=this._lastSchema.processor.mesh.factory.symbology;if("dictionary"!==r.type)throw new Error("InternalError: Expected schema to be of type 'dictionary'");const i={cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,store:this.featureContainer.instanceStore,scaleExpression:r.scaleExpression};this._fields||(this._fields=this.layer.fields.map((e=>e.toJSON())));const s=r.visualVariableUniforms,a=K.toJSONGeometryType(this.layer.geometryType),n=await t.getSymbolForControlString(e.controlString,a,!1);return n&&n.data?{type:"dictionary-response",meshes:await J.createComplexSymbolInstances({...n.data,hasTextStringTemplates:!0},{uniforms:s,path:"renderer",schemaOptions:i})}:{type:"dictionary-response",meshes:[]}}catch(e){return{type:"dictionary-response",meshes:[]}}}_cleanUpQuery(e){const t=C.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t.toJSON()}_cleanUpAttributeBinsQuery(e){const t=k.from(e);return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t.toJSON()}_cleanUpAggregateQuery(e){const t=C.from(e)||this.createAggregateQuery();t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference);const r=t.objectIds??[];for(const e of t.aggregateIds??[])r.push(e);return t.objectIds=r,t.aggregateIds=[],t.toJSON()}async _update(){return this._commandsQueue.push({type:"update"})}_edit(e){return this.updateSuspended?(this.subscriptionManager.suspend(),Promise.resolve()):this._commandsQueue.push({type:"edit",event:e})}async doRefresh(e){this.attached&&(this.updateSuspended&&e||(e?this.incrementSourceRefreshVersion():this.incrementDisplayRefreshVersion()))}incrementSourceRefreshVersion(){this._sourceRefreshVersion=(this._sourceRefreshVersion+1)%ie+1}incrementDisplayRefreshVersion(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%ie+1}async _resolveIdenifiers(e){const t=[],r=[];for(const i of e)null==i.objectId||-1===i.objectId?null==i.globalId?d.getLogger(this).warn("mapview-apply-edits","A feature identifier must contain either a GlobalId or ObjectId. Ignoring",{identifier:i}):r.push(i.globalId):t.push(i.objectId);const i="globalIdField"in this.layer&&this.layer.globalIdField,s=i&&this.availableFields.includes(i);if(r.length&&!s)return d.getLogger(this).error(new l("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${i} to be included the layer's outFields for updates to be reflected on the map`)),t;if(r.length){const e=await this._workerProxy.pipeline.getObjectIdsFromGlobalIds(r);for(const r of e)t.push(r)}return t}_resolveOverrides(e){const t=!1,r=!1,i=K.toJSONGeometryType(this.layer.geometryType),s=z.createFeatureIdInfo(this.layer),a=[];for(const n of e.added){const e=v.convertFromFeature(n,i,t,r,s);if(null==e.objectId)throw new l("featurelayerview:bad-override","Feature does not have an objectId",{feature:n});a.push(e)}for(const n of e.updated){const e=v.convertFromFeature(n,i,t,r,s);if(null==e.objectId)throw new l("featurelayerview:bad-override","Feature does not have an objectId",{feature:n});a.push(e)}for(const t of e.removed)if(null==t)throw new l("featurelayerview:bad-override","Tried to remove an invalid objectId",{objectId:t});return{type:"override",updates:a,removed:e.removed,release:e.release,isWeak:e.isWeak??!1,historicMoment:e.historicMoment??null}}async _resolveEdit(e){const t=this.layer,r=e.historicMoment?.getTime()??null,i="layerId"in t&&e.editedFeatures?.find((e=>e.layerId===t.layerId));if(i&&this._canEditByFeature(i)){const{adds:e,deletes:t,updates:s}=i.editedFeatures,a=this.layer.objectIdField,n=s.map((e=>e.current)),o=t.map((e=>"attributes"in e?{objectId:a?e.attributes[a]:null}:e)),l=await this._resolveIdenifiers(o);return this._resolveOverrides({added:e,updated:n,removed:l,historicMoment:r,isWeak:!0,release:[]})}const[s,a,n]=await Promise.all([this._resolveIdenifiers(e.addedFeatures),this._resolveIdenifiers(e.updatedFeatures),this._resolveIdenifiers(e.deletedFeatures)]);return{type:"override-by-id",updates:[...s,...a],removed:n,historicMoment:r,isWeak:!0}}_canEditByFeature(e){const{adds:t,updates:r}=e.editedFeatures;return t.every((e=>this.view.spatialReference.equals(e.geometry?.spatialReference)))&&r.every((e=>this.view.spatialReference.equals(e.current.geometry?.spatialReference)))}async _doUpdate(){"featureReduction"in this.layer&&this.layer.featureReduction&&this.layer.featureReduction!==this._lastFeatureReduction&&(this.layer.featureReduction=this.layer.featureReduction?.clone(),this._lastFeatureReduction=this.layer.featureReduction);try{if(await Promise.allSettled([this._handleChange(),I.checkServiceCurrentUserSupport(this.layer)]),this.destroyed||!this.layerAdapter?.hasRequiredSupport||!this.subscriptionManager)return;const e=this.featureContainer.instanceStore;this.featureContainer.attributeView.lockTextureUploads();const t=this._lastSchema?.processor.mesh.factory.symbology?.type;let r=!0;"subtype-group"!==this.layer.type&&"dictionary"===this.layer.renderer?.type&&"dictionary"===t&&(r=!1),e.updateStart(r);const i=this.featureEffect,s={store:e,cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},a=await this._createViewSchemaConfig(),n={source:this.layerAdapter.createSourceSchema(a,this._sourceRefreshVersion),processor:await this.layerAdapter.createProcessorSchema(s,a,this._displayRefreshVersion)},o=n.processor.mesh.factory.labels;o&&this.view.labelManager.setLabelSchemaStyles(o,this.featureContainer);const l=f.notDeepEqual(this._lastSchema?.source.mutable,n.source.mutable)||f.notDeepEqual(this._lastSchema?.processor,n.processor);if(!l)return this.featureContainer.requestRender(),this.featureContainer.attributeView.unlockTextureUploads(),e.updateEnd(r),void(this.featureEffectView.featureEffect=i);this._lastSchema=n,this._fields=null;const u=Math.round(performance.now());c("esri-2d-update-debug")&&console.debug(`Id[${this.layer.uid}] Version[${u}] FeatureLayerView2D._doUpdate`,{changes:l});const d=await this.getWorker();await d.pipeline.updateSchema(n,u),e.updateEnd(r),this.featureEffectView.featureEffect=i,this.featureEffectView.endTransition(),this.featureContainer.restartAllAnimations(),this.featureContainer.attributeView.unlockTextureUploads(),this.featureContainer.trySwapRenderState(),this.featureContainer.requestRender(),c("esri-2d-update-debug")&&console.debug(`Version[${u}] FeatureLayerView2D.updateEnd`),this.requestUpdate()}catch(e){c("esri-2d-update-debug")&&console.error("Encountered an error during update",e)}}async _doOverride(e){const t=await this.getWorker();try{for(const r of e.messages)switch(r.type){case"edit":{const e=new Q.DebouncedFeatureOverride;e.add(await this._resolveEdit(r.event)),await t.pipeline.onOverride(e.toMessage());break}case"override":{const e=new Q.DebouncedFeatureOverride;e.add(this._resolveOverrides(r.options)),await t.pipeline.onOverride(e.toMessage());break}}}catch(e){y.isAbortError(e)}}_getEffectiveAvailableFields(e){const t=function(e,t){const r=new Set;return e&&e.forEach((e=>r.add(e))),t&&t.forEach((e=>r.add(e))),r.has("*")?["*"]:Array.from(r)}(this._lastAvailableFields,e);return this._lastAvailableFields=t,x.packFields(this.layer.fieldsIndex,t)}async _createViewSchemaConfig(){const e=this.requiresCurrentUser?await this.signedInUser:null,t=[function(e,t,r,i,s,a){s&&(s=s.clone());const n=null!=s?s.timeExtent:null,o=null!=r&&null!=n?r.intersection(n):r||n;o&&(s??=new F,s.timeExtent=o),s=t.addFilters?.(s,e)??s,a&&(s??=new F,s.where=g.sqlAnd(s.where,a));let l=s?.toJSON()??null;return i.size&&(l??=(new F).toJSON(),l.hiddenIds=Array.from(i)),l}(this.view,this.layerAdapter,this.timeExtent,this._visibilityOverrides,this.filter,this.effectiveDisplayFilterClause),this.featureEffect?.filter?.toJSON()??null];return{availableFields:this._getEffectiveAvailableFields(this.availableFields),displayFilterEnabled:this.displayFilterEnabled,filters:t,scale:this.view.scale,timeZone:this.view.timeZone,timeExtent:this.view.timeExtent,currentUser:e}}_processHighlight(){this._commandsQueue.push({type:"highlight"})}async _updateHighlights(){const e=this._getHighlights(),t=await this.getWorker();if(this.destroyed)return;const r=t.pipeline.updateHighlight({highlights:e}).catch((e=>{y.isAbortError(e)||d.getLogger(this).error(e)}));this._updatingHandles.addPromise(r)}_setLayersForFeature(e){e.layer=e.sourceLayer=this.layer,this.layerAdapter.setGraphicOrigin&&this.layerAdapter.setGraphicOrigin(e)}_createGraphicHit(e,t){return this._setLayersForFeature(t),null!=t.geometry&&(t.geometry.spatialReference=this.view.spatialReference),{type:"graphic",graphic:t,layer:this.layer,mapPoint:e}}},t.__decorate([_.property()],e.default.prototype,"_commandsQueue",void 0),t.__decorate([_.property()],e.default.prototype,"_sourceRefreshVersion",void 0),t.__decorate([_.property()],e.default.prototype,"_displayRefreshVersion",void 0),t.__decorate([_.property({readOnly:!0})],e.default.prototype,"_pipelineUpdating",void 0),t.__decorate([_.property()],e.default.prototype,"_sourceUpdating",void 0),t.__decorate([_.property({readOnly:!0})],e.default.prototype,"dataUpdating",null),t.__decorate([_.property({readOnly:!0})],e.default.prototype,"effectiveDisplayFilterClause",null),t.__decorate([_.property({readOnly:!0})],e.default.prototype,"hasAllFeatures",null),t.__decorate([_.property({readOnly:!0})],e.default.prototype,"hasAllFeaturesInView",null),t.__decorate([_.property({readOnly:!0})],e.default.prototype,"hasFullGeometries",null),t.__decorate([_.property()],e.default.prototype,"featureEffectView",void 0),t.__decorate([_.property()],e.default.prototype,"labelingCollisionInfos",null),t.__decorate([_.property()],e.default.prototype,"layerAdapter",null),t.__decorate([_.property({readOnly:!0})],e.default.prototype,"timeExtent",null),t.__decorate([_.property()],e.default.prototype,"updating",void 0),e.default=t.__decorate([m.subclass("esri.views.2d.layers.FeatureLayerView2D")],e.default),e.default}));