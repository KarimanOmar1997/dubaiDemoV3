// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/FlowView2D":function(){define(["exports","../../../../chunks/tslib.es6","../../../../Graphic","../../../../core/Accessor","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./createFlowStyle","./dataUtils","./FlowContainer","./FlowStrategy"],(function(e,t,i,r,s,n,a,o,l,c,u,h,p,d){"use strict";return e.default=class extends r{constructor(){super(...arguments),this._loadImagery=(e,t,i,r,s)=>h.loadImagery(this.layer,e,t,i,r,s),this._createFlowMesh=(e,t,i,r)=>this.layer.createFlowMesh({meshType:e,flowData:i,simulationSettings:t},{signal:r}),this.attached=!1,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const{layer:e}=this,t=()=>{this._loadImagery=(t,i,r,s,n)=>h.loadImagery(e,t,i,r,s,n),this._updateVisualization()};"multidimensionalDefinition"in e?this.addHandles(s.watch((()=>e.multidimensionalDefinition),t)):this.addHandles([s.watch((()=>e.mosaicRule),t),s.watch((()=>e.rasterFunction),t),s.watch((()=>e.definitionExpression),t)]),this.container=new p,this._strategy=new d({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container?.removeAllChildren(),this.container=null,this.removeHandles()}update(e){e.stationary?this._strategy.update(e):this.layerView.requestUpdate()}hitTest(e){return new i({attributes:{},geometry:e.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){const e=this.layer.renderer;if(null==e||"flow"!==e.type)return;const t=u(e,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=t,this.layerView.requestUpdate()}},t.__decorate([n.property()],e.default.prototype,"_strategy",void 0),t.__decorate([n.property()],e.default.prototype,"attached",void 0),t.__decorate([n.property()],e.default.prototype,"container",void 0),t.__decorate([n.property()],e.default.prototype,"layer",void 0),t.__decorate([n.property()],e.default.prototype,"layerView",void 0),t.__decorate([n.property()],e.default.prototype,"type",void 0),t.__decorate([n.property()],e.default.prototype,"updating",null),t.__decorate([n.property()],e.default.prototype,"timeExtent",void 0),e.default=t.__decorate([c.subclass("esri.views.2d.engine.flow.FlowView2D")],e.default),e.default}))},"esri/views/2d/engine/flow/createFlowStyle":function(){define(["./utils","./styles/Imagery","./styles/Particles","./styles/Stack","./styles/Streamlines"],(function(e,t,i,r,s){"use strict";return function(n,a){const{flowSpeed:o,trailLength:l}=n,c=e.getFlowSimulationSettings(n);let u=null;const h={opacity:e.getOpacity(n),size:e.getSize(n)};let p=e.getColor(n);if("none"===n.background)h.color=p;else{"constant"===p.kind&&(p={kind:"ramp",stops:[0,1],values:[0,0,0,1,p.value[0],p.value[1],p.value[2],p.value[3]],count:2});const i={loadImagery:a.loadImagery,timeExtent:a.timeExtent,color:p,opacity:{kind:"constant",value:[1]}};u=new t.Imagery(i),h.color=e.getForegroundColor()}const d={loadImagery:a.loadImagery,createFlowMesh:a.createFlowMesh,simulationSettings:c,timeExtent:a.timeExtent,trailLength:l,flowSpeed:o,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:h.color,opacity:h.opacity,size:h.size},f="butt"===n.trailCap||e.getMax(e.getSize(n))<=4?new s(d):new i.Particles(d);return null!=u?new r.Stack([u,f]):f}}))},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/screenUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32"],(function(e,t,i,r){"use strict";function s(e){return"constant"===e.kind?e.value[0]:e.values[e.values.length-1]}function n(e){const t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function a(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[t.pt2px(e.trailWidth)]};const i=e.getVisualVariablesForType("size")[0],r=[],s=[];let n;if(i.stops){for(const e of i.stops)r.push(e.value),s.push(t.pt2px(e.size));n=i.stops.length}else r.push(i.minDataValue,i.maxDataValue),s.push(t.pt2px(i.minSize),t.pt2px(i.maxSize)),n=2;return{kind:"ramp",stops:r,values:s,count:n}}function o(e,t,i,r){switch(t){case"int":e.setUniform1iv(i,r);break;case"float":e.setUniform1fv(i,r);break;case"vec2":e.setUniform2fv(i,r);break;case"vec3":e.setUniform3fv(i,r);break;case"vec4":e.setUniform4fv(i,r)}}function l(e,t){let i=!0;return i=i&&e.collisions===t.collisions,i=i&&e.density===t.density,i=i&&e.interpolate===t.interpolate,i=i&&e.lineCollisionWidth===t.lineCollisionWidth,i=i&&e.lineSpacing===t.lineSpacing,i=i&&e.maxTurnAngle===t.maxTurnAngle,i=i&&e.minSpeedThreshold===t.minSpeedThreshold,i=i&&e.segmentLength===t.segmentLength,i=i&&e.smoothing===t.smoothing,i=i&&e.velocityScale===t.velocityScale,i=i&&e.verticesPerLine===t.verticesPerLine,i}function c(e,t){return e===t||null!=e&&null!=t&&e.equals(t)}e.areStreamlinesCompatible=function(e,t){if(!l(e.simulationSettings,t.simulationSettings))return!1;if(!c(e.timeExtent,t.timeExtent))return!1;let i=!0;return i=i&&e.loadImagery===t.loadImagery,i=i&&e.createFlowMesh===t.createFlowMesh,i=i&&e.color.kind===t.color.kind,i=i&&e.opacity.kind===t.opacity.kind,i=i&&e.size.kind===t.size.kind,i},e.getColor=function(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:n(e.color)};const t=e.getVisualVariablesForType("color")[0],i=[],r=[];for(const e of t.stops)i.push(e.value),Array.prototype.push.apply(r,n(e.color));return{kind:"ramp",stops:i,values:r,count:t.stops.length}},e.getFlowSimulationSettings=function(e){const i=s(a(e)),r=i,n=Math.max(i/2,5),o=Math.round(t.pt2px(e.maxPathLength)/n)+1,{density:l}=e;return{smoothing:t.pt2px(e.smoothing),interpolate:!0,velocityScale:"flow-from"===e.flowRepresentation?1:-1,verticesPerLine:o,minSpeedThreshold:.001,segmentLength:n,maxTurnAngle:1,collisions:!0,lineCollisionWidth:r,lineSpacing:10,density:l}},e.getForegroundColor=function(e){return{kind:"constant",value:[.1,.1,.1,1]}},e.getMax=s,e.getOpacity=function(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=e.getVisualVariablesForType("opacity")[0],i=[],r=[];for(const e of t.stops)i.push(e.value),r.push(e.opacity);return{kind:"ramp",stops:i,values:r,count:t.stops.length}},e.getSingleTileVisualState=function(e,t,s){const n=r.create();return i.identity(n),i.translate(n,n,[-1,1]),i.scale(n,n,[2/t,-2/s,1]),{time:e,dvsMat3:n,displayViewMat3:n}},e.getSize=a,e.setUniform=o,e.setUniforms=function(e,t,i,r){"constant"===r.kind?o(e,i,`u_${t}`,r.value):(o(e,"float",`u_${t}_stops`,r.stops),o(e,i,`u_${t}_values`,r.values),e.setUniform1i(`u_${t}_count`,r.count))},e.simulationSettingsEqual=l,e.timeExtentsEqual=c,e.toRgba=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/flow/styles/Imagery":function(){define(["exports","../../../../../core/promiseUtils","../utils","../../../../webgl/BufferObject","../../../../webgl/enums","../../../../webgl/Texture","../../../../webgl/TextureDescriptor","../../../../webgl/VertexArrayObject","../../../../webgl/VertexElementDescriptor"],(function(e,t,i,r,s,n,a,o,l){"use strict";class c{constructor(e){this._params=e,this.animated=!1}isCompatible(e){if(!(e instanceof c))return!1;if(!i.timeExtentsEqual(this._params.timeExtent,e._params.timeExtent))return!1;let t=!0;return t=t&&this._params.loadImagery===e._params.loadImagery,t=t&&this._params.color.kind===e._params.color.kind,t=t&&this._params.opacity.kind===e._params.opacity.kind,t}async load(e,i){const{extent:r,size:s}=e;t.throwIfAborted(i);const n=await this._params.loadImagery(r,s[0],s[1],this._params.timeExtent,i);return new d(n,{color:this._params.color,opacity:this._params.opacity})}render(e,t,r){const{context:n}=e,{program:a}=r;n.setFaceCullingEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunction(s.BlendFactor.ONE,s.BlendFactor.ONE_MINUS_SRC_ALPHA),n.useProgram(a),a.setUniformMatrix3fv("u_dvsMat3",t.dvsMat3),n.bindTexture(r.texture,0),a.setUniform1i("u_texture",0),a.setUniform1f("u_Min",r.min),a.setUniform1f("u_Max",r.max),i.setUniforms(a,"color","vec4",this._params.color),i.setUniforms(a,"opacity","float",this._params.opacity),n.bindVAO(r.vertexArray),n.drawArrays(s.PrimitiveType.TRIANGLE_STRIP,0,4)}}const u=new Map;u.set("a_position",0),u.set("a_texcoord",1);const h=new Map([["geometry",[new l.VertexElementDescriptor("a_position",2,s.DataType.UNSIGNED_SHORT,0,8),new l.VertexElementDescriptor("a_texcoord",2,s.DataType.UNSIGNED_SHORT,4,8)]]]),p={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:u};class d{constructor(e,t){this._flowData=e,this._values=t}attach(e){const{context:t}=e,{width:i,height:l}=this._flowData,c=r.BufferObject.createVertex(t,s.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,i,0,1,1,0,l,0,0,i,l,1,0])),d=new Map([["geometry",c]]),f=new o.VertexArrayObject(t,u,h,d),m=[];"ramp"===this._values.color.kind&&m.push("vvColor"),"ramp"===this._values.opacity.kind&&m.push("vvOpacity");const g=e.getProgram(p,m);let y=1e6,x=-1e6;for(let e=0;e<l;e++)for(let t=0;t<i;t++)if(0!==this._flowData.mask[e*i+t]){const r=this._flowData.data[2*(e*i+t)],s=this._flowData.data[2*(e*i+t)+1],n=Math.sqrt(r*r+s*s);y=Math.min(y,n),x=Math.max(x,n)}const w=new Uint8Array(4*i*l);for(let e=0;e<l;e++)for(let t=0;t<i;t++)if(0!==this._flowData.mask[e*i+t]){const r=this._flowData.data[2*(e*i+t)],s=this._flowData.data[2*(e*i+t)+1],n=(Math.sqrt(r*r+s*s)-y)/(x-y);w[4*(e*i+t)]=255*n,w[4*(e*i+t)+1]=0,w[4*(e*i+t)+2]=0,w[4*(e*i+t)+3]=255}else w[4*(e*i+t)]=0,w[4*(e*i+t)+1]=0,w[4*(e*i+t)+2]=0,w[4*(e*i+t)+3]=0;const _=new a.TextureDescriptor;_.internalFormat=s.PixelFormat.RGBA,_.wrapMode=s.TextureWrapMode.CLAMP_TO_EDGE,_.flipped=!0,_.width=i,_.height=l;const v=new n.Texture(t,_,w);this.vertexArray=f,this.program=g,this.texture=v,this.min=y,this.max=x,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.compiled}}e.Imagery=c,e.ImageryResources=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/flow/styles/Particles":function(){define(["exports","../../../../../core/promiseUtils","../utils","../../../../webgl/BufferObject","../../../../webgl/enums","../../../../webgl/VertexArrayObject","../../../../webgl/VertexElementDescriptor"],(function(e,t,i,r,s,n,a){"use strict";class o{constructor(e){this._params=e}get animated(){return this._params.flowSpeed>0}isCompatible(e){return e instanceof o&&i.areStreamlinesCompatible(this._params,e._params)}async load(e,i){const{extent:r,size:s}=e;t.throwIfAborted(i);const n=await this._params.loadImagery(r,s[0],s[1],this._params.timeExtent,i),{vertexData:a,indexData:o}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,n,i);return new h(a,o,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(e,t,r){const{context:n}=e,{program:a}=r;n.setFaceCullingEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunction(s.BlendFactor.ONE,s.BlendFactor.ONE_MINUS_SRC_ALPHA),n.useProgram(a),a.setUniform1f("u_time",t.time),a.setUniform1f("u_trailLength",this._params.trailLength),a.setUniform1f("u_flowSpeed",this._params.flowSpeed),a.setUniform1f("u_featheringSize",this._params.featheringSize),a.setUniform1f("u_featheringOffset",this._params.featheringOffset),a.setUniform1f("u_introFade",this._params.introFade?1:0),a.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),a.setUniform1f("u_decayRate",this._params.decayRate),a.setUniformMatrix3fv("u_dvsMat3",t.dvsMat3),a.setUniformMatrix3fv("u_displayViewMat3",t.displayViewMat3),i.setUniforms(a,"color","vec4",this._params.color),i.setUniforms(a,"opacity","float",this._params.opacity),i.setUniforms(a,"size","float",this._params.size),n.bindVAO(r.vertexArray),n.drawElements(s.PrimitiveType.TRIANGLES,r.indexCount,s.DataType.UNSIGNED_INT,0)}}const l=new Map;l.set("a_xyts0",0),l.set("a_xyts1",1),l.set("a_typeIdDurationSeed",2),l.set("a_extrudeInfo",3);const c=new Map([["geometry",[new a.VertexElementDescriptor("a_xyts0",4,s.DataType.FLOAT,0,64),new a.VertexElementDescriptor("a_xyts1",4,s.DataType.FLOAT,16,64),new a.VertexElementDescriptor("a_typeIdDurationSeed",4,s.DataType.FLOAT,32,64),new a.VertexElementDescriptor("a_extrudeInfo",4,s.DataType.FLOAT,48,64)]]]),u={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:l};class h{constructor(e,t,i){this._vertexData=e,this._indexData=t,this._values=i}attach(e){const{context:t}=e,i=r.BufferObject.createVertex(t,s.Usage.STATIC_DRAW,this._vertexData),a=r.BufferObject.createIndex(t,s.Usage.STATIC_DRAW,this._indexData),o=new Map([["geometry",i]]),h=new n.VertexArrayObject(t,l,c,o,a),p=[];"ramp"===this._values.color.kind&&p.push("vvColor"),"ramp"===this._values.opacity.kind&&p.push("vvOpacity"),"ramp"===this._values.size.kind&&p.push("vvSize");const d=e.getProgram(u,p);this.vertexArray=h,this.program=d,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}e.Particles=o,e.ParticlesResources=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports"],(function(e){"use strict";class t{constructor(e){this._styles=e}get animated(){return this._styles.reduce(((e,t)=>e||t.animated),!1)}isCompatible(e){if(!(e instanceof t))return!1;if(this._styles.length!==e._styles.length)return!1;const i=this._styles.length;for(let t=0;t<i;t++)if(!this._styles[t].isCompatible(e._styles[t]))return!1;return!0}async load(e,t){const r=await Promise.all(this._styles.map((i=>i.load(e,t))));return new i(r)}render(e,t,i){for(let r=0;r<this._styles.length;r++)this._styles[r].render(e,t,i.resources[r])}}class i{constructor(e){this.resources=e}attach(e){for(const t of this.resources)t.attach(e)}detach(){for(const e of this.resources)e.detach()}get ready(){return this.resources.reduce(((e,t)=>e&&t.ready),!0)}}e.Stack=t,e.StackResources=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/flow/styles/Streamlines":function(){define(["../../../../../core/promiseUtils","../utils","../../../../webgl/BufferObject","../../../../webgl/enums","../../../../webgl/VertexArrayObject","../../../../webgl/VertexElementDescriptor"],(function(e,t,i,r,s,n){"use strict";class a{constructor(e){this._params=e}get animated(){return this._params.flowSpeed>0}isCompatible(e){return e instanceof a&&t.areStreamlinesCompatible(this._params,e._params)}async load(t,i){const{extent:r,size:s}=t;e.throwIfAborted(i);const n=await this._params.loadImagery(r,s[0],s[1],this._params.timeExtent,i),{vertexData:a,indexData:o}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,n,i);return new u(a,o,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(e,i,s){const{context:n}=e,{program:a}=s;n.setFaceCullingEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunction(r.BlendFactor.ONE,r.BlendFactor.ONE_MINUS_SRC_ALPHA),n.useProgram(a),a.setUniform1f("u_time",i.time),a.setUniform1f("u_trailLength",this._params.trailLength),a.setUniform1f("u_flowSpeed",this._params.flowSpeed),a.setUniform1f("u_featheringSize",this._params.featheringSize),a.setUniform1f("u_featheringOffset",this._params.featheringOffset),a.setUniform1f("u_introFade",this._params.introFade?1:0),a.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),a.setUniform1f("u_decayRate",this._params.decayRate),a.setUniformMatrix3fv("u_dvsMat3",i.dvsMat3),a.setUniformMatrix3fv("u_displayViewMat3",i.displayViewMat3),t.setUniforms(a,"color","vec4",this._params.color),t.setUniforms(a,"opacity","float",this._params.opacity),t.setUniforms(a,"size","float",this._params.size),n.bindVAO(s.vertexArray),n.drawElements(r.PrimitiveType.TRIANGLES,s.indexCount,r.DataType.UNSIGNED_INT,0)}}const o=new Map;o.set("a_positionAndSide",0),o.set("a_timeInfo",1),o.set("a_extrude",2),o.set("a_speed",3);const l=new Map([["geometry",[new n.VertexElementDescriptor("a_positionAndSide",3,r.DataType.FLOAT,0,36),new n.VertexElementDescriptor("a_timeInfo",3,r.DataType.FLOAT,12,36),new n.VertexElementDescriptor("a_extrude",2,r.DataType.FLOAT,24,36),new n.VertexElementDescriptor("a_speed",1,r.DataType.FLOAT,32,36)]]]),c={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:o};class u{constructor(e,t,i){this._vertexData=e,this._indexData=t,this._values=i}attach(e){const{context:t}=e,n=i.BufferObject.createVertex(t,r.Usage.STATIC_DRAW,this._vertexData),a=i.BufferObject.createIndex(t,r.Usage.STATIC_DRAW,this._indexData),u=new Map([["geometry",n]]),h=new s.VertexArrayObject(t,o,l,u,a),p=[];"ramp"===this._values.color.kind&&p.push("vvColor"),"ramp"===this._values.opacity.kind&&p.push("vvOpacity"),"ramp"===this._values.size.kind&&p.push("vvSize");const d=e.getProgram(c,p);this.vertexArray=h,this.program=d,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}return a}))},"esri/views/2d/engine/flow/dataUtils":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../core/mathUtils","../../../../core/promiseUtils","../../../../core/RandomLCG","../../../../geometry/Extent","../../../../geometry/support/spatialReferenceUtils"],(function(e,t,i,r,s,n,a,o){"use strict";const l=()=>i.getLogger("esri.views.2d.engine.flow.dataUtils");function c(e,t){const i=function(e,t,i,r){if(0===r)return e;const s=Math.round(3*r),n=new Array(2*s+1);let a=0;for(let e=-s;e<=s;e++){const t=Math.exp(-e*e/(r*r));n[e+s]=t,a+=t}for(let e=-s;e<=s;e++)n[e+s]/=a;const o=new Float32Array(e.length);for(let r=0;r<i;r++)for(let i=0;i<t;i++){let a=0,l=0;for(let o=-s;o<=s;o++){if(i+o<0||i+o>=t)continue;const c=n[o+s];a+=c*e[2*(r*t+(i+o))],l+=c*e[2*(r*t+(i+o))+1]}o[2*(r*t+i)]=a,o[2*(r*t+i)+1]=l}const l=new Float32Array(e.length);for(let e=0;e<t;e++)for(let r=0;r<i;r++){let a=0,c=0;for(let l=-s;l<=s;l++){if(r+l<0||r+l>=i)continue;const u=n[l+s];a+=u*o[2*((r+l)*t+e)],c+=u*o[2*((r+l)*t+e)+1]}l[2*(r*t+e)]=a,l[2*(r*t+e)+1]=c}return l}(t.data,t.width,t.height,e.smoothing);return e.interpolate?(e,r)=>{const s=Math.floor(e),n=Math.floor(r);if(s<0||s>=t.width)return[0,0];if(n<0||n>=t.height)return[0,0];const a=e-s,o=r-n,l=s,c=n,u=s<t.width-1?s+1:s,h=n<t.height-1?n+1:n,p=i[2*(c*t.width+l)],d=i[2*(c*t.width+u)],f=i[2*(h*t.width+l)],m=i[2*(h*t.width+u)],g=i[2*(c*t.width+l)+1],y=i[2*(c*t.width+u)+1];return[(p*(1-o)+f*o)*(1-a)+(d*(1-o)+m*o)*a,(g*(1-o)+i[2*(h*t.width+l)+1]*o)*(1-a)+(y*(1-o)+i[2*(h*t.width+u)+1]*o)*a]}:(e,r)=>{const s=Math.round(e),n=Math.round(r);return s<0||s>=t.width||n<0||n>=t.height?[0,0]:[i[2*(n*t.width+s)],i[2*(n*t.width+s)+1]]}}function u(e,t,i,r,s,n,a,o,l){const c=[];let u=i,h=r,p=0,[d,f]=t(u,h);d*=e.velocityScale,f*=e.velocityScale;const m=Math.sqrt(d*d+f*f);let g,y;c.push({x:u,y:h,t:p,speed:m});for(let i=0;i<e.verticesPerLine;i++){let[i,r]=t(u,h);i*=e.velocityScale,r*=e.velocityScale;const d=Math.sqrt(i*i+r*r);if(d<e.minSpeedThreshold)return c;const f=i/d,m=r/d;if(u+=f*e.segmentLength,h+=m*e.segmentLength,p+=e.segmentLength/d,Math.acos(f*g+m*y)>e.maxTurnAngle)return c;if(e.collisions){const e=Math.round(u*l),t=Math.round(h*l);if(e<0||e>a-1||t<0||t>o-1)return c;const i=n[t*a+e];if(-1!==i&&i!==s)return c;n[t*a+e]=s}c.push({x:u,y:h,t:p,speed:d}),g=f,y=m}return c}function h(e,t,i,r){const s=[],a=new n,o=1/Math.max(e.lineCollisionWidth,1),l=Math.round(i*o),c=Math.round(r*o),h=new Int32Array(l*c);for(let e=0;e<h.length;e++)h[e]=-1;const p=[];for(let t=0;t<r;t+=e.lineSpacing)for(let r=0;r<i;r+=e.lineSpacing)p.push({x:r,y:t,sort:a.getFloat()});p.sort(((e,t)=>e.sort-t.sort));for(const{x:i,y:r}of p)if(a.getFloat()<e.density){const n=u(e,t,i,r,s.length,h,l,c,o);if(n.length<2)continue;s.push(n)}return s}function p(e,t){const i=new n,r=e.reduce(((e,t)=>e+t.length),0),s=new Float32Array(4*r),a=new Array(e.length);let o=0,l=0;for(const r of e){const e=o;for(const e of r)s[4*o]=e.x,s[4*o+1]=e.y,s[4*o+2]=e.t,s[4*o+3]=e.speed,o++;a[l++]={startVertex:e,numberOfVertices:r.length,totalTime:r[r.length-1].t,timeSeed:t?i.getFloat():0}}return{lineVertices:s,lineDescriptors:a}}function d(e,t){const{lineVertices:i,lineDescriptors:r}=e;let s=0,n=0;for(const e of r)s+=2*e.numberOfVertices,n+=6*(e.numberOfVertices-1);const a=new Float32Array(9*s),o=new Uint32Array(n);let l=0,c=0;function u(e,t,i,r,s,n,o,c){const u=9*l;let h=0;a[u+h++]=e,a[u+h++]=t,a[u+h++]=1,a[u+h++]=i,a[u+h++]=n,a[u+h++]=o,a[u+h++]=r/2,a[u+h++]=s/2,a[u+h++]=c,l++,a[u+h++]=e,a[u+h++]=t,a[u+h++]=-1,a[u+h++]=i,a[u+h++]=n,a[u+h++]=o,a[u+h++]=-r/2,a[u+h++]=-s/2,a[u+h++]=c,l++}for(const e of r){const{totalTime:r,timeSeed:s}=e;let n=null,a=null,h=null,p=null,d=null,f=null;for(let m=0;m<e.numberOfVertices;m++){const g=i[4*(e.startVertex+m)],y=i[4*(e.startVertex+m)+1],x=i[4*(e.startVertex+m)+2],w=i[4*(e.startVertex+m)+3];let _=null,v=null,b=null,S=null;if(m>0){_=g-n,v=y-a;const e=Math.sqrt(_*_+v*v);if(_/=e,v/=e,m>1){let e=_+d,i=v+f;const r=Math.sqrt(e*e+i*i);e/=r,i/=r;const s=Math.min(1/(e*_+i*v),t);e*=s,i*=s,b=-i,S=e}else b=-v,S=_;null!==b&&null!==S&&(u(n,a,h,b,S,r,s,w),o[c++]=l-2,o[c++]=l,o[c++]=l-1,o[c++]=l,o[c++]=l+1,o[c++]=l-1)}n=g,a=y,h=x,d=_,f=v,p=w}u(n,a,h,-f,d,r,s,p)}return{vertexData:a,indexData:o}}function f(e){const{lineVertices:t,lineDescriptors:i}=e;let r=0,s=0;for(const e of i){const t=e.numberOfVertices-1;r+=4*t*2,s+=6*t*2}const n=new Float32Array(16*r),a=new Uint32Array(s);let o,l,c,u,h,p,d,f,m,g,y,x,w,_,v=0,b=0;function S(e,t){let i=m+y,r=g+x;const s=Math.sqrt(i*i+r*r);i/=s,r/=s;const S=m*i+g*r;i/=S,r/=S;let M=y+w,P=x+_;const T=Math.sqrt(M*M+P*P);M/=T,P/=T;const A=y*M+x*P;M/=A,P/=A,function(e,t,i,r,s,a,o,l,c,u,h,p,d,f){const m=16*v;let g=0;for(const y of[1,2])for(const x of[1,2,3,4])n[m+g++]=e,n[m+g++]=t,n[m+g++]=i,n[m+g++]=r,n[m+g++]=o,n[m+g++]=l,n[m+g++]=c,n[m+g++]=u,n[m+g++]=y,n[m+g++]=x,n[m+g++]=d,n[m+g++]=f,n[m+g++]=s/2,n[m+g++]=a/2,n[m+g++]=h/2,n[m+g++]=p/2,v++}(o,l,c,u,-r,i,h,p,d,f,-P,M,e,t),a[b++]=v-8,a[b++]=v-7,a[b++]=v-6,a[b++]=v-7,a[b++]=v-5,a[b++]=v-6,a[b++]=v-4,a[b++]=v-3,a[b++]=v-2,a[b++]=v-3,a[b++]=v-1,a[b++]=v-2}function M(e,t,i,r,s,n){if(m=y,g=x,y=w,x=_,null==m&&null==g&&(m=y,g=x),null!=h&&null!=p){w=e-h,_=t-p;const i=Math.sqrt(w*w+_*_);w/=i,_/=i}null!=m&&null!=g&&S(s,n),o=h,l=p,c=d,u=f,h=e,p=t,d=i,f=r}function P(e,t){m=y,g=x,y=w,x=_,null==m&&null==g&&(m=y,g=x),null!=m&&null!=g&&S(e,t)}for(const e of i){o=null,l=null,c=null,u=null,h=null,p=null,d=null,f=null,m=null,g=null,y=null,x=null,w=null,_=null;const{totalTime:i,timeSeed:r}=e;for(let s=0;s<e.numberOfVertices;s++)M(t[4*(e.startVertex+s)],t[4*(e.startVertex+s)+1],t[4*(e.startVertex+s)+2],t[4*(e.startVertex+s)+3],i,r);P(i,r)}return{vertexData:n,indexData:a}}function m(e,t){const i=t.pixels,{width:s,height:n}=t,a=new Float32Array(s*n*2),o=t.mask||new Uint8Array(s*n*2);if(t.mask||o.fill(255),"vector-uv"===e)for(let e=0;e<s*n;e++)a[2*e]=i[0][e],a[2*e+1]=-i[1][e];else if("vector-magdir"===e)for(let e=0;e<s*n;e++){const t=i[0][e],s=r.deg2rad(i[1][e]),n=Math.cos(s-Math.PI/2),o=Math.sin(s-Math.PI/2);a[2*e]=n*t,a[2*e+1]=o*t}return{data:a,mask:o,width:s,height:n}}async function g(e,t,i,r,s,n){const a={requestProjectedLocalDirections:!0,signal:n};if(null!=s&&(a.timeExtent=s),"imagery"===e.type){await e.load({signal:n});const s=await e.internalFetchImage(t,i,r,a);return null==s?.pixelData?.pixelBlock?{data:new Float32Array(i*r*2),mask:new Uint8Array(i*r),width:i,height:r}:m(e.rasterInfo.dataType,s.pixelData.pixelBlock)}await e.load({signal:n});const o=await e.fetchPixels(t,i,r,a);return null==o?.pixelBlock?{data:new Float32Array(i*r*2),mask:new Uint8Array(i*r),width:i,height:r}:m(e.serviceRasterInfo.dataType,o.pixelBlock)}e.createAnimatedLinesData=p,e.createFlowFieldFromData=c,e.createFlowMesh=async function(e,i,r,n){const a=performance.now(),o=c(i,r),u=performance.now(),m=h(i,o,r.width,r.height),g=performance.now(),y=p(m,!0),x=performance.now(),w="Streamlines"===e?d(y,10):f(y),_=performance.now();return t("esri-2d-profiler")&&(l().info("I.1","_createFlowFieldFromData (ms)",Math.round(u-a)),l().info("I.2","_getStreamlines (ms)",Math.round(g-u)),l().info("I.3","createAnimatedLinesData (ms)",Math.round(x-g)),l().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(_-x)),l().info("I.5","createFlowMesh (ms)",Math.round(_-a)),l().info("I.6","Mesh size (bytes)",w.vertexData.buffer.byteLength+w.indexData.buffer.byteLength)),await Promise.resolve(),s.throwIfAborted(n),w},e.createParticlesMesh=f,e.createStreamlinesMesh=d,e.getStreamlines=h,e.loadImagery=async function(e,i,r,s,n,c){const u=performance.now(),h=o.getInfo(i.spatialReference);if(!h){const a=await g(e,i,r,s,n,c);return t("esri-2d-profiler")&&l().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-u)),t("esri-2d-profiler")&&l().info("I.9","Number of parts",1),a}const[p,d]=h.valid,f=d-p,m=Math.ceil(i.width/f),y=i.width/m,x=Math.round(r/m);let w=i.xmin;const _=[],v=performance.now();for(let t=0;t<m;t++){const t=new a({xmin:w,xmax:w+y,ymin:i.ymin,ymax:i.ymax,spatialReference:i.spatialReference});_.push(g(e,t,x,s,n,c)),w+=y}const b=await Promise.all(_);t("esri-2d-profiler")&&l().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-v)),t("esri-2d-profiler")&&l().info("I.9","Number of parts",b.length);const S={data:new Float32Array(r*s*2),mask:new Uint8Array(r*s),width:r,height:s};let M=0;for(const e of b){for(let t=0;t<e.height;t++)for(let i=0;i<e.width;i++)M+i>=r||(S.data[2*(t*r+M+i)]=e.data[2*(t*e.width+i)],S.data[2*(t*r+M+i)+1]=e.data[2*(t*e.width+i)+1],S.mask[t*r+M+i]=e.mask[t*e.width+i]);M+=e.width}return t("esri-2d-profiler")&&l().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-u)),S},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/flow/FlowContainer":function(){define(["./BrushFlow","../webgl/enums","../webgl/WGLContainer"],(function(e,t,i){"use strict";return class extends i{constructor(){super(...arguments),this.flowStyle=null}doRender(e){super.doRender(e)}prepareRenderPasses(i){const r=i.registerRenderPass({name:"flow",brushes:[e],target:()=>this.children,drawPhase:t.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(i),r]}}}))},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../core/libs/gl-matrix-2/factories/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],(function(e,t,i){"use strict";return class extends t{constructor(){super(...arguments),this._visualState={time:0,dvsMat3:e.create(),displayViewMat3:e.create()}}dispose(){}prepareState(e){const{context:t}=e;t.setColorMask(!0,!0,!0,!0),t.setStencilFunction(i.CompareFunction.EQUAL,0,255)}draw(e,t){const{requestRender:i,allowDelayedRender:r}=e,{displayData:s}=t;if(null==s)return;if("loaded"===s.state.name&&s.attach({context:e.context,getProgram:(t,i)=>e.painter.materialManager.getProgram(t,i)}),"attached"!==s.state.name)return;const n=s.state.resources;!r||n.ready||null==i?(this._visualState.time=e.time/1e3,this._visualState.dvsMat3=t.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=e.state.displayViewMat3,s.flowStyle.render({context:e.context,getProgram:(t,i)=>e.painter.materialManager.getProgram(t,i)},this._visualState,n),s.flowStyle.animated&&null!=i&&i()):i()}}}))},"esri/views/2d/engine/flow/FlowStrategy":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Logger","../../../../core/mathUtils","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Extent","../../../../geometry/Point","./FlowDisplayData","./FlowDisplayObject"],(function(e,t,i,r,s,n,a,o,l,c,u,h,p,d){"use strict";return e.default=class extends i{constructor(e){super(e),this._flowDisplayObject=new d.FlowDisplayObject,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(e){const{flowStyle:t}=this.flowContainer;if(null==t)return void this._clear();const{extent:i,rotation:a,resolution:o,pixelRatio:l}=e.state,c=function(e,t){const i=new h({x:(e.xmax+e.xmin)/2,y:(e.ymax+e.ymin)/2,spatialReference:e.spatialReference}),r=e.xmax-e.xmin,n=e.ymax-e.ymin,a=Math.abs(Math.cos(s.deg2rad(t))),o=Math.abs(Math.sin(s.deg2rad(t))),l=a*r+o*n,c=o*r+a*n,p=new u({xmin:i.x-l/2,ymin:i.y-c/2,xmax:i.x+l/2,ymax:i.y+c/2,spatialReference:e.spatialReference});return p.centerAt(i),p}(i,a);c.expand(1.15);const d=[Math.round((c.xmax-c.xmin)/o),Math.round((c.ymax-c.ymin)/o)],f=new p(t,c,d,l);if(null!=this._loading){if(this._loading.update(f))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(f)||(f.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(e=>{n.isAbortError(e)||(r.getLogger(this).error("A resource failed to load.",e),this._loading=null)})),this._loading=f)}_clear(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)}},t.__decorate([a.property()],e.default.prototype,"_loading",void 0),t.__decorate([a.property()],e.default.prototype,"flowContainer",void 0),t.__decorate([a.property()],e.default.prototype,"updating",null),e.default=t.__decorate([c.subclass("esri.views.2d.engine.flow.FlowStrategy")],e.default),e.default}))},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../core/Logger"],(function(e){"use strict";return class{constructor(e,t,i,r){this.state={name:"created"},this.flowStyle=e,this.extent=t,this.size=i,this.pixelRatio=r}async load(){const e=new AbortController;this.state={name:"loading",abortController:e};const t={extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},i=await this.flowStyle.load(t,e.signal);this.state={name:"loaded",resources:i}}attach(t){if("loaded"!==this.state.name)return void e.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");const i=this.state.resources;i.attach(t),this.state={name:"attached",resources:i}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(e){return!!this.flowStyle.isCompatible(e.flowStyle)&&!(!this.extent.equals(e.extent)||this.size[0]!==e.size[0]||this.size[1]!==e.size[1]||this.pixelRatio!==e.pixelRatio||(this.flowStyle=e.flowStyle,0))}}}))},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../DisplayObject"],(function(e,t,i,r,s){"use strict";class n extends s.DisplayObject{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(e){this._displayData=e,this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(e){const{displayData:r}=this;if(null==r)return;const s=r.extent.xmin,n=r.extent.ymax,a=[0,0];e.toScreen(a,[s,n]);const o=(r.extent.xmax-r.extent.xmin)/r.size[0]/e.resolution,l=t.deg2rad(e.rotation),{displayViewScreenMat3:c}=this.transforms;i.fromTranslation(c,[-1,1,0]),i.scale(c,c,[2/(e.size[0]*e.pixelRatio),-2/(e.size[1]*e.pixelRatio),1]),i.translate(c,c,[a[0],a[1],0]),i.rotate(c,c,l),i.scale(c,c,[o*e.pixelRatio,o*e.pixelRatio,1])}_createTransforms(){return{displayViewScreenMat3:r.create()}}}e.FlowDisplayObject=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/LayerView2D":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Collection","../../../core/collectionUtils","../../../core/Error","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../linkChart/utils","../engine/Container","./support/HighlightCounter","./support/util","../support/highlightOptionsUtils","../../layers/support/ClipRect","../../layers/support/Geometry","../../layers/support/Path","../../support/HighlightOptions","../../support/layerViewUtils"],(function(e,t,i,r,s,n,a,o,l,c,u,h,p,d,f,m,g,y,x,w,_){"use strict";const v=i.ofType({key:"type",base:null,typeMap:{rect:g,path:x,geometry:y}}),b=new(i.ofType(w));e.LayerView2DMixin=e=>{let o=class extends e{constructor(){super(...arguments),this._highlightCounter=new d.HighlightCounter,this.attached=!1,this.clips=new v,this.highlights=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){const e=this.view?.spatialReferenceLocked??!0,t=this.view?.spatialReference;t&&e&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new s("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new p.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([n.watch((()=>this.suspended),(e=>{this.container&&(this.container.visible=!e)}),n.syncAndInitial),n.watch((()=>this.updateSuspended),(e=>{this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),n.syncAndInitial),n.watch((()=>this.layer?.opacity??1),(e=>{this.container&&(this.container.opacity=e)}),n.syncAndInitial),n.watch((()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal"),(e=>{this.container&&(this.container.blendMode=e)}),n.syncAndInitial),n.watch((()=>this.layer&&"effect"in this.layer?this.layer.effect:null),(e=>{this.container&&(this.container.effect=e)}),n.syncAndInitial),n.watch((()=>this._mergedHighlights.items.map((e=>({name:e.name,options:{fillColor:e.color,haloColor:e.haloColor,fillOpacity:e.fillOpacity,haloOpacity:e.haloOpacity,haloWidth:e.haloWidth,haloBlur:e.haloBlur}})))),(()=>{this.container.highlightGradient=f.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)}),n.syncAndInitial),n.watch((()=>this._mergedHighlights.items.map((e=>e.name))),(()=>{this._processHighlight()})),n.on((()=>this.clips),"change",(()=>{this.container&&(this.container.clips=this.clips)}),n.syncAndInitial),n.watch((()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null})),(({scale:e,scaleRange:t})=>{const i=_.isInEffectiveScaleRange(t,e);i!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=i)}),n.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e===this&&this.processAttach()}),(()=>{})):this.when().then((()=>{this.processAttach()}),(()=>{})))}destroy(){this.processDetach(),this.updateRequested=!1}get highlightOptions(){return m.getDefaultHighlightOptions(this)}set highlightOptions(e){m.setDefaultHighlightOptions(this,e)}get hasHighlight(){return this._highlightCounter.size>0}get _mergedHighlights(){if(!this.view)return b;if(!this.highlights)return this.view.highlights;const e=this.view.highlights.clone();for(const t of this.highlights){const i=e.find((e=>e.name===t.name));i&&i.assignFrom(t)}return e}get highlightIds(){return Array.from(this._highlightCounter.objectIds)}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const e=this.view?.spatialReference;return null==e||this.supportsSpatialReference(e)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}supportsSpatialReference(e){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;switch(this.layer?.type){case"link-chart":case"knowledge-graph-sublayer":case"graphics":break;default:if(h.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const e=super.getSuspendInfo(),t=!this.spatialReferenceSupported;return t&&(e.spatialReferenceNotSupported=t),e}addAttachHandles(e){this.addHandles(e,"attach")}_addHighlights(e,t){this._highlightCounter.add(e,t)&&this._processHighlight()}_removeHighlights(e,t){this._highlightCounter.delete(e,t)&&this._processHighlight()}_processHighlight(){}_getHighlights(){const e=[];for(const[t,i]of this._highlightCounter.highlightNamesByObjectId){const r=this._getHighlightBits(i);e.push({objectId:t,highlightFlags:r})}return e}_getHighlightBits(e){const t=new Set(e);let i=1,r=0;if(!this.view)return 0;const s=this._mergedHighlights;for(const{name:e}of s)t.delete(e)&&(r=i),i<<=1;return r}};return t.__decorate([a.property()],o.prototype,"attached",void 0),t.__decorate([a.property({type:v,set(e){const t=r.referenceSetter(e,this._get("clips"),v);this._set("clips",t)}})],o.prototype,"clips",void 0),t.__decorate([a.property()],o.prototype,"container",void 0),t.__decorate([a.property({type:w})],o.prototype,"highlightOptions",null),t.__decorate([a.property({type:i.ofType(w)})],o.prototype,"highlights",void 0),t.__decorate([a.property()],o.prototype,"_mergedHighlights",null),t.__decorate([a.property()],o.prototype,"moving",void 0),t.__decorate([a.property({readOnly:!0})],o.prototype,"spatialReferenceSupported",null),t.__decorate([a.property({readOnly:!0})],o.prototype,"updateParameters",void 0),t.__decorate([a.property()],o.prototype,"updateRequested",void 0),t.__decorate([a.property()],o.prototype,"updating",null),t.__decorate([a.property()],o.prototype,"view",void 0),t.__decorate([a.property()],o.prototype,"_visibleAtCurrentScale",void 0),t.__decorate([a.property({readOnly:!0})],o.prototype,"visibleAtCurrentScale",null),o=t.__decorate([u.subclass("esri.views.2d.layers.LayerView2D")],o),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/linkChart/utils":function(){define(["exports"],(function(e){"use strict";e.isLinkChartView=function(e){return null!=e&&"object"==typeof e&&"2d"===e.type&&"linkchart"===e.view2dType},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/support/HighlightCounter":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/MapUtils","../../../../core/ReactiveMap","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass"],(function(e,t,i,r,s,n,a,o,l,c){"use strict";e.HighlightCounter=class extends i{constructor(){super(...arguments),this._idToCounters=new s}get size(){return this._idToCounters.size}get objectIds(){return this._idToCounters.keys()}get highlightNamesByObjectId(){return function*(e){for(const[t,i]of e)yield[t,i.keys()]}(this._idToCounters)}add(e,t){let i=!1;for(const s of e){const e=r.getOrCreateMapValue(this._idToCounters,s,(()=>(i=!0,new Map))),n=e.get(t)??0;n||(i=!0),e.set(t,n+1)}return i}delete(e,t){let i=!1;for(const r of e){const e=this._idToCounters.get(r);if(!e)continue;let s=e.get(t);null!=s&&(s--,s>0?e.set(t,s):(e.delete(t),i=!0),0===e.size&&(this._idToCounters.delete(r),i=!0))}return i}},e.HighlightCounter=t.__decorate([c.subclass("esri.views.2d.layers.support.HighlightCounter")],e.HighlightCounter),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/support/ClipRect":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],(function(e,t,i,r,s,n,a,o){"use strict";var l;return e.default=l=class extends o{constructor(e){super(e),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}},t.__decorate([i.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"left",void 0),t.__decorate([i.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"right",void 0),t.__decorate([i.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"top",void 0),t.__decorate([i.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"bottom",void 0),e.default=l=t.__decorate([a.subclass("esri.views.layers.support.ClipRect")],e.default),e.default}))},"esri/views/layers/support/ClipArea":function(){define(["exports","../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,i,r,s,n,a,o){"use strict";return e.default=class extends i{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}},t.__decorate([r.property({readOnly:!0})],e.default.prototype,"version",null),e.default=t.__decorate([o.subclass("esri.views.layers.support.ClipArea")],e.default),e.default}))},"esri/views/layers/support/Geometry":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/Extent","../../../geometry/Geometry","../../../geometry/Polygon","../../../geometry/support/jsonUtils","./ClipArea"],(function(e,t,i,r,s,n,a,o,l,c,u,h){"use strict";var p;const d={base:l,key:"type",typeMap:{extent:o,polygon:c}};return e.default=p=class extends h{constructor(e){super(e),this.type="geometry",this.geometry=null}clone(){return new p({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}},t.__decorate([i.property({types:d,json:{read:u.fromJSON,write:!0}})],e.default.prototype,"geometry",void 0),e.default=p=t.__decorate([a.subclass("esri.views.layers.support.Geometry")],e.default),e.default}))},"esri/views/layers/support/Path":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],(function(e,t,i,r,s,n,a,o){"use strict";return e.default=class extends o{constructor(e){super(e),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}},t.__decorate([i.property({type:[[[Number]]],json:{write:!0}})],e.default.prototype,"path",void 0),e.default=t.__decorate([a.subclass("esri.views.layers.support.Path")],e.default),e.default}))},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","../../engine/webgl/enums","./AGraphicContainer","../support/util"],(function(e,t,i,r,s,n,a,o,l,c){"use strict";return e.default=class extends l.AGraphicContainer{get hasHighlight(){return this.children.some((e=>e.hasData))}renderChildren(e){this.attributeView.update(),e.drawPhase===o.WGLDrawPhase.HIGHLIGHT&&this.children.some((e=>e.hasData))&&(super.renderChildren(e),e.context.setColorMask(!0,!0,!0,!0),c.renderHighlight(e,!1,(e=>{this._renderChildren(e,o.FeatureSelection.Highlight)})))}},e.default=t.__decorate([a.subclass("esri.views.2d.layers.graphics.HighlightGraphicContainer")],e.default),e.default}))},"esri/views/2d/layers/imagery/ImageryView2D":function(){define(["exports","../../../../chunks/tslib.es6","../../../../Graphic","../../../../core/Accessor","../../../../core/Logger","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../layers/support/rasterFunctions/pixelUtils","../../engine/BitmapContainer","../../engine/Container","../../engine/ImageryBitmapSource","../support/ExportStrategy"],(function(e,t,i,r,s,n,a,o,l,c,u,h,p,d,f){"use strict";return e.default=class extends r{constructor(){super(...arguments),this.attached=!1,this.container=new p.Container,this.updateRequested=!1,this.type="imagery",this._bitmapView=new h.BitmapContainer}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this.strategy.update(e).catch((e=>{n.isAbortError(e)||s.getLogger(this).error(e)}))}hitTest(e){return new i({attributes:{},geometry:e.clone(),layer:this.layer})}attach(){this.container.addChild(this._bitmapView);const e=this.layer.version>=10,t=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,i=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this.strategy=new f({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:t,imageMaxWidth:i,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren(),this.updateRequested=!1}redraw(){this.strategy.updateExports((async e=>{const{source:t}=e;if(!t||t instanceof ImageBitmap)return;const i=await this.layer.applyRenderer({extent:t.extent,pixelBlock:t.originalPixelBlock??t.pixelBlock});t.filter=e=>this.layer.pixelFilter?this.layer.applyFilter(e):{...i,extent:t.extent}})).catch((e=>{n.isAbortError(e)||s.getLogger(this).error(e)}))}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.bitmaps;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const t=this.view.extent,i=e.map((e=>e.source)).filter((e=>e.extent&&e.extent.intersects(t))).map((e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}))),r=u.mosaicPixelData(i,t);return null!=r?{extent:r.extent,pixelBlock:r.pixelBlock}:null}return null}async _fetchImage(e,t,i,r){(r=r||{}).timeExtent=this.timeExtent,r.requestAsImageElement=!0,r.returnImageBitmap=!0;const s=await this.layer.internalFetchImage(e,t,i,r);if(s.imageBitmap)return s.imageBitmap;const n=await this.layer.applyRenderer(s.pixelData,{signal:r.signal}),a=new d(n.pixelBlock,n.extent?.clone(),s.pixelData.pixelBlock);return a.filter=e=>this.layer.applyFilter(e),a}},t.__decorate([a.property()],e.default.prototype,"attached",void 0),t.__decorate([a.property()],e.default.prototype,"container",void 0),t.__decorate([a.property()],e.default.prototype,"layer",void 0),t.__decorate([a.property()],e.default.prototype,"strategy",void 0),t.__decorate([a.property()],e.default.prototype,"timeExtent",void 0),t.__decorate([a.property()],e.default.prototype,"view",void 0),t.__decorate([a.property()],e.default.prototype,"updateRequested",void 0),t.__decorate([a.property()],e.default.prototype,"updating",null),t.__decorate([a.property()],e.default.prototype,"type",void 0),e.default=t.__decorate([c.subclass("esri.views.2d.layers.imagery.ImageryView2D")],e.default),e.default}))},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../../../core/mathUtils","../PixelBlock","../rasterFormats/pixelRangeUtils"],(function(e,t,i,r){"use strict";var s,n;function a(e){return null!=e&&e.pixels?.length>0}function o(e,t,r,s,n){const a=e.length,o=i.createEmptyBand(n,a);if(t)for(let i=0;i<a;i++)t[i]&&(o[i]=r[e[i]-s]);else for(let t=0;t<a;t++)o[t]=r[e[t]-s];return o}function l(e,t,i,r){const s=null!=i&&i.length>=2?new Set(i):null,n=1===i?.length?i[0]:null,a=!!t?.length;for(let i=0;i<e.length;i++)if(r[i]){const o=e[i];if(a){let e=!1;for(let i=0;i<t.length;i+=2)if(o>=t[i]&&o<=t[i+1]){e=!0;break}e||(r[i]=0)}r[i]&&(o===n||s?.has(o))&&(r[i]=0)}}function c(e,t){const i=e[0].length;for(let r=0;r<i;r++)if(t[r]){let i=!1;for(let t=0;t<e.length;t++)if(e[t][r]){i=!0;break}i||(t[r]=0)}}function u(e,t){const i=e[0].length;for(let r=0;r<i;r++)if(t[r]){let i=!1;for(let t=0;t<e.length;t++)if(0===e[t][r]){i=!0;break}i&&(t[r]=0)}}function h(e,t,i,r,s,n,a,o){return{xmin:s<=i*e?0:s<i*e+e?s-i*e:e,ymin:n<=r*t?0:n<r*t+t?n-r*t:t,xmax:s+a<=i*e?0:s+a<i*e+e?s+a-i*e:e,ymax:n+o<=r*t?0:n+o<r*t+t?n+o-r*t:t}}function p(e,t,i,r,s,n){const{width:a,height:o}=i.block,{x:l,y:c}=i.offset,{width:u,height:p}=i.mosaic,d=h(a,o,r,s,l,c,u,p);let f=0,m=0;if(n){const e=n.hasGCSSShiftTransform?360:n.halfWorldWidth??0,t=a*n.resolutionX,i=n.startX+r*t;i<e&&i+t>e?m=n.rightPadding:i>=e&&(f=n.leftMargin-n.rightPadding,m=0)}if(d.xmax-=m,"number"!=typeof t)for(let i=d.ymin;i<d.ymax;i++){const n=(s*o+i-c)*u+(r*a-l)+f,h=i*a;for(let i=d.xmin;i<d.xmax;i++)e[n+i]=t[h+i]}else for(let i=d.ymin;i<d.ymax;i++){const n=(s*o+i-c)*u+(r*a-l)+f;for(let i=d.xmin;i<d.xmax;i++)e[n+i]=t}}function d(e,t,r={}){const{clipOffset:s,clipSize:n,alignmentInfo:o,blockWidths:l}=r;if(l)return function(e,t,r){const s=e.find((e=>null!=e));if(null==s)return null;const n=e.some((e=>null==e||!!e.mask)),{width:o,height:l}=t,c=n?new Uint8Array(o*l):null,{blockWidths:u}=r,h=[],p=s.getPlaneCount(),d=i.getPixelArrayConstructor(s.pixelType);if(n)for(let t=0,i=0;t<e.length;i+=u[t],t++){const r=e[t];if(!a(r))continue;const s=r.mask;for(let e=0;e<l;e++)for(let n=0;n<u[t];n++)c[e*o+n+i]=null==s?255:s[e*r.width+n]}const f=e.some((e=>e?.bandMasks&&e.bandMasks.length>1)),m=f?[]:void 0,g=o*l;for(let t=0;t<p;t++){const i=new d(g),r=f?new Uint8Array(g):void 0;for(let s=0,n=0;s<e.length;n+=u[s],s++){const c=e[s];if(!a(c))continue;const h=c.pixels[t];if(null!=h){for(let e=0;e<l;e++)for(let t=0;t<u[s];t++)i[e*o+t+n]=h[e*c.width+t];if(r){const e=c.bandMasks?.[t]??c.mask;for(let t=0;t<l;t++)for(let i=0;i<u[s];i++)r[t*o+i+n]=e?e[t*c.width+i]:255}}}h.push(i),m&&r&&m.push(r)}const y=new i({width:o,height:l,mask:c,bandMasks:m,pixels:h,pixelType:s.pixelType});return y.updateStatistics(),y}(e,t,{blockWidths:l});const c=e.find((e=>a(e)));if(null==c)return null;const u=n?n.width:t.width,h=n?n.height:t.height,d=c.width,f=c.height,m=t.width/d,g=t.height/f,y={offset:s||{x:0,y:0},mosaic:n||t,block:{width:d,height:f}},x=c.pixelType,w=i.getPixelArrayConstructor(x),_=c.pixels.length,v=[];let b,S;for(let t=0;t<_;t++){S=new w(u*h);for(let i=0;i<g;i++)for(let r=0;r<m;r++){const s=e[i*m+r];a(s)&&(b=s.pixels[t],p(S,b,y,r,i,o))}v.push(S)}const M=e.some((e=>null==e||null!=e.mask&&e.mask.length>0)),P=e.some((e=>e?.bandMasks&&e.bandMasks.length>1)),T=M?new Uint8Array(u*h):void 0,A=P?[]:void 0;if(T){for(let t=0;t<g;t++)for(let i=0;i<m;i++){const r=e[t*m+i],s=null!=r?r.mask:null;p(T,null!=s?s:r?255:0,y,i,t,o)}if(A)for(let t=0;t<_;t++){const i=new Uint8Array(u*h);for(let r=0;r<g;r++)for(let s=0;s<m;s++){const n=e[r*m+s],a=n?.bandMasks?.[t]??n?.mask;p(i,null!=a?a:n?255:0,y,s,r,o)}A.push(i)}}const k=new i({width:u,height:h,pixels:v,pixelType:x,bandMasks:A,mask:T});return k.updateStatistics(),k}function f(e){if(!a(e))return null;const t=e.clone(),{width:i,height:r,pixels:s}=e,n=s[0],o=t.pixels[0],l=e.mask;for(let e=2;e<r-1;e++){const t=new Map;for(let r=e-2;r<e+2;r++)for(let e=0;e<4;e++){const s=r*i+e;y(t,n[s],l?l[s]:1)}o[e*i]=m(t),o[e*i+1]=o[e*i+2]=o[e*i];let r=3;for(;r<i-1;r++){let s=(e-2)*i+r+1;y(t,n[s],l?l[s]:1),s=(e-1)*i+r+1,y(t,n[s],l?l[s]:1),s=e*i+r+1,y(t,n[s],l?l[s]:1),s=(e+1)*i+r+1,y(t,n[s],l?l[s]:1),s=(e-2)*i+r-3,g(t,n[s],l?l[s]:1),s=(e-1)*i+r-3,g(t,n[s],l?l[s]:1),s=e*i+r-3,g(t,n[s],l?l[s]:1),s=(e+1)*i+r-3,g(t,n[s],l?l[s]:1),o[e*i+r]=m(t)}o[e*i+r+1]=o[e*i+r]}for(let e=0;e<i;e++)o[e]=o[i+e]=o[2*i+e],o[(r-1)*i+e]=o[(r-2)*i+e];return t.updateStatistics(),t}function m(e){if(0===e.size)return 0;let t=0,i=-1,r=0;const s=e.keys();let n=s.next();for(;!n.done;)r=e.get(n.value),r>t&&(i=n.value,t=r),n=s.next();return i}function g(e,t,i){if(0===i)return;const r=e.get(t);1===r?e.delete(t):e.set(t,r-1)}function y(e,t,i){0!==i&&e.set(t,e.has(t)?e.get(t)+1:1)}function x(e,t,r){let{x:s,y:n}=t;const{width:o,height:l}=r;if(0===s&&0===n&&l===e.height&&o===e.width)return e;const{width:c,height:u}=e,h=Math.max(0,n),p=Math.max(0,s),d=Math.min(s+o,c),f=Math.min(n+l,u);if(d<0||f<0||!a(e))return null;s=Math.max(0,-s),n=Math.max(0,-n);const{pixels:m}=e,g=o*l,y=m.length,x=[];for(let t=0;t<y;t++){const r=m[t],a=i.createEmptyBand(e.pixelType,g);for(let e=h;e<f;e++){const t=e*c;let i=(e+n-h)*o+s;for(let e=p;e<d;e++)a[i++]=r[t+e]}x.push(a)}const w=new Uint8Array(g),_=e.mask;for(let e=h;e<f;e++){const t=e*c;let i=(e+n-h)*o+s;for(let e=p;e<d;e++)w[i++]=_?_[t+e]:1}const v=new i({width:r.width,height:r.height,pixelType:e.pixelType,pixels:x,mask:w});return v.updateStatistics(),v}function w(e,t=!0){if(!a(e))return null;const{pixels:r,width:s,height:n,mask:o,pixelType:l}=e,c=[],u=Math.round(s/2),h=Math.round(n/2),p=n-1,d=s-1;for(let e=0;e<r.length;e++){const a=r[e],o=i.createEmptyBand(l,u*h);let f=0;for(let e=0;e<n;e+=2)for(let i=0;i<s;i+=2){const r=a[e*s+i];if(t){const t=i===d?r:a[e*s+i+1],n=e===p?r:a[e*s+i+s],l=i===d?n:e===p?t:a[e*s+i+s+1];o[f++]=(r+t+n+l)/4}else o[f++]=r}c.push(o)}let f=null;if(null!=o){f=new Uint8Array(u*h);let e=0;for(let i=0;i<n;i+=2)for(let r=0;r<s;r+=2){const n=o[i*s+r];if(t){const t=r===d?n:o[i*s+r+1],a=i===p?n:o[i*s+r+s],l=r===d?a:i===p?t:o[i*s+r+s+1];f[e++]=n*t*a*l?1:0}else f[e++]=n}}return new i({width:u,height:h,pixelType:l,pixels:c,mask:f})}function _(e,t,i,r,s=0){const{width:n,height:a}=e,{width:o,height:l}=t,c=r.cols,u=r.rows,h=Math.ceil(o/c-.1/c),p=Math.ceil(l/u-.1/u);let d,f,m,g,y,x,w;const _=h*c,v=_*p*u,b=new Float32Array(v),S=new Float32Array(v),M=new Uint32Array(v),P=new Uint32Array(v);let T,A,k=0;for(let e=0;e<p;e++)for(let t=0;t<h;t++){d=12*(e*h+t),f=i[d],m=i[d+1],g=i[d+2],y=i[d+3],x=i[d+4],w=i[d+5];for(let i=0;i<u;i++){k=(e*u+i)*_+t*c,A=(i+.5)/u;for(let e=0;e<i;e++)T=(e+.5)/c,b[k+e]=(f*T+m*A+g)*n+s,S[k+e]=(y*T+x*A+w)*a+s,M[k+e]=Math.floor(b[k+e]),P[k+e]=Math.floor(S[k+e])}d+=6,f=i[d],m=i[d+1],g=i[d+2],y=i[d+3],x=i[d+4],w=i[d+5];for(let i=0;i<u;i++){k=(e*u+i)*_+t*c,A=(i+.5)/u;for(let e=i;e<c;e++)T=(e+.5)/c,b[k+e]=(f*T+m*A+g)*n+s,S[k+e]=(y*T+x*A+w)*a+s,M[k+e]=Math.floor(b[k+e]),P[k+e]=Math.floor(S[k+e])}}return{offsets_x:b,offsets_y:S,offsets_xi:M,offsets_yi:P,gridWidth:_}}e.NoDataInterpretation=void 0,(s=e.NoDataInterpretation||(e.NoDataInterpretation={}))[s.matchAny=0]="matchAny",s[s.matchAll=1]="matchAll",e.MissingBandAction=void 0,(n=e.MissingBandAction||(e.MissingBandAction={}))[n.bestMatch=0]="bestMatch",n[n.fail=1]="fail",e.approximateTransform=function(e,t,r,s,n="nearest"){if(!a(e))return null;"majority"===n&&(e=f(e));const{pixels:o,mask:l,bandMasks:c,pixelType:u}=e,h=e.width,p=e.height,d=i.getPixelArrayConstructor(u),m=o.length,{width:g,height:y}=t;let x=!1;for(let e=0;e<r.length;e+=3)-1===r[e]&&-1===r[e+1]&&-1===r[e+2]&&(x=!0);const{offsets_x:w,offsets_y:v,offsets_xi:b,offsets_yi:S,gridWidth:M}=_({width:h,height:p},t,r,s,"majority"===n?.5:0);let P;const T=(e,t,i,r)=>{const s=e instanceof Float32Array||e instanceof Float64Array?0:.5;for(let n=0;n<y;n++){P=n*M;for(let a=0;a<g;a++){if(w[P]<0||v[P]<0)e[n*g+a]=0;else if(r)e[n*g+a]=t[b[P]+S[P]*h];else{const r=Math.floor(w[P]),o=Math.floor(v[P]),l=Math.ceil(w[P]),c=Math.ceil(v[P]),u=w[P]-r,p=v[P]-o;if(!i||i[r+o*h]&&i[l+o*h]&&i[r+c*h]&&i[l+c*h]){const i=(1-u)*t[r+o*h]+u*t[l+o*h],d=(1-u)*t[r+c*h]+u*t[l+c*h];e[n*g+a]=(1-p)*i+p*d+s}else e[n*g+a]=t[b[P]+S[P]*h]}P++}}},A=[];let k;const R=c?.length===m,D=[];for(let e=0;e<m;e++){if(R){const t=new Uint8Array(g*y);T(t,c[e],c[e],!0),D.push(t)}k=new d(g*y),T(k,o[e],R?c[e]:l,"nearest"===n||"majority"===n),A.push(k)}const E=new i({width:g,height:y,pixelType:u,pixels:A,bandMasks:R?D:void 0});if(null!=l)E.mask=new Uint8Array(g*y),T(E.mask,l,l,!0);else if(x){E.mask=new Uint8Array(g*y);for(let e=0;e<g*y;e++)E.mask[e]=w[e]<0||v[e]<0?0:1}return E.updateStatistics(),E},e.clip=x,e.clipTile=function(e){const{pixelBlock:t,tileSize:i,level:r,row:s,col:n,useBilinear:o}=e;if(!a(t))return null;const{width:l,height:c}=i,u=2**r,h=u*l,p=u*c;let d=x(t,{y:s*p,x:n*h},{width:h,height:p});if(!d)return null;for(let e=r;e>0;e--)d=w(d,o);return d},e.colorize=function(e,t){if(!a(e))return e;if(!t||!t.indexedColormap&&!t.indexed2DColormap)return e;const i=e.clone(),r=i.pixels;let s=i.mask;const n=i.width*i.height;if(1!==r.length)return e;const{indexedColormap:o,indexed2DColormap:l,offset:c,alphaSpecified:u}=t,h=r[0],p=new Uint8Array(h.length),d=new Uint8Array(h.length),f=new Uint8Array(h.length);let m,g=0;if(o){const e=o.length-1;if(null!=s)for(let t=0;t<n;t++)s[t]&&(g=4*(h[t]-c),g<c||g>e?s[t]=0:(p[t]=o[g],d[t]=o[g+1],f[t]=o[g+2],s[t]=o[g+3]));else{s=new Uint8Array(n);for(let t=0;t<n;t++)g=4*(h[t]-c),g<c||g>e?s[t]=0:(p[t]=o[g],d[t]=o[g+1],f[t]=o[g+2],s[t]=o[g+3]);i.mask=s}}else if(l)if(null!=s)for(let e=0;e<n;e++)s[e]&&(m=l[h[e]],p[e]=m[0],d[e]=m[1],f[e]=m[2],s[e]=m[3]);else{s=new Uint8Array(n);for(let e=0;e<n;e++)m=l[h[e]],p[e]=m[0],d[e]=m[1],f[e]=m[2],s[e]=m[3];i.mask=s}return i.pixels=[p,d,f],i.statistics=null,i.pixelType="u8",i.maskIsAlpha=u,i},e.compositeBands=function(e){if(!e?.length||e.some((e=>!a(e))))return null;if(1===e.length)return e[0]?.clone()??null;const t=e,{width:r,height:s,pixelType:n}=t[0];if(t.some((e=>e.width!==r||e.height!==s)))return null;const o=t.map((({mask:e})=>e)).filter((e=>null!=e));let l=null;o.length&&(l=new Uint8Array(r*s),l.set(o[0]),o.length>1&&u(o.slice(1),l));const c=[];t.forEach((({pixels:e})=>c.push(...e)));const h=t.map((({statistics:e})=>e)).filter((e=>e?.length)),p=[];return h.forEach((e=>p.push(...e))),new i({pixelType:n,width:r,height:s,mask:l,pixels:c,statistics:p.length?p:null})},e.createColormapLUT=function(e){if(!e)return;const t=e.colormap;if(!t||0===t.length)return;const i=t.sort(((e,t)=>e[0]-t[0])),r=i[0][0]<0?i[0][0]:0,s=Math.max(256,i[i.length-1][0]-r+1),n=new Uint8Array(4*s),a=[],o=5===i[0].length;if(s>65536)return i.forEach((e=>{a[e[0]-r]=o?e.slice(1):e.slice(1).concat([255])})),{indexed2DColormap:a,offset:r,alphaSpecified:o};if(e.fillUnspecified){let e=i[0];for(let t=e[0]-r,a=0;t<s;t++)n[4*t]=e[1],n[4*t+1]=e[2],n[4*t+2]=e[3],n[4*t+3]=o?e[4]:255,t===e[0]-r&&(e=a===i.length-1?e:i[++a])}else for(let e=0;e<i.length;e++){const t=i[e],s=4*(t[0]-r);n[s]=t[1],n[s+1]=t[2],n[s+2]=t[3],n[s+3]=o?t[4]:255}return{indexedColormap:n,offset:r,alphaSpecified:o}},e.createMaskLUT=function(e,t,i){if("u8"!==e&&"s8"!==e&&"u16"!==e&&"s16"!==e)return null;const r=e.includes("16")?65536:256,s=e.includes("s")?-r/2:0,n=new Uint8Array(r);if(t)for(let e=0;e<t.length;e++){const i=Math.ceil(t[2*e]-s),r=Math.floor(t[2*e+1]-s);for(let e=i;e<=r;e++)n[e]=255}else n.fill(255);if(i)for(let e=0;e<i.length;e++)n[i[e]-s]=0;return{lut:n,offset:s}},e.createRangeMaps=function(e,i,r=!1){const s=1e-5,n=new Float32Array(27),a=i.length;for(let o=0;o<9;o++)n[3*o]=e[2*o]??t.numberMaxFloat32-1,n[3*o+1]=e[2*o+1]??t.numberMaxFloat32,n[3*o+2]=i[o]??0,o<a&&(o>0&&(n[3*o]-=s),e[2*o+1]!==e[2*o]&&(o<a-1||!r)&&(n[3*o+1]-=s));return n},e.createRemapLUT=function(e){const{srcPixelType:t,inputRanges:s,outputValues:n,allowUnmatched:a,noDataRanges:o,isLastInputRangeInclusive:l,outputPixelType:c}=e;if("u8"!==t&&"s8"!==t&&"u16"!==t&&"s16"!==t)return null;const u=t.includes("16")?65536:256,h=t.includes("s")?-u/2:0,p=i.createEmptyBand(c,u),d=new Uint8Array(u);a&&d.fill(255);const[f,m]=r.getPixelValueRange(c);if(s?.length&&n?.length){const e=1e-6,t=s.map((t=>t-e));t[0]=s[0],l&&(t[t.length-1]=s[s.length-1]);for(let e=0;e<t.length;e++){const i=n[e]>m?m:n[e]<f?f:n[e],r=Math.ceil(t[2*e]-h),a=s[2*e+1]===s[2*e]?r:Math.floor(t[2*e+1]-h);for(let e=r;e<=a;e++)p[e]=i,d[e]=255}}if(o?.length)for(let e=0;e<o.length;e++){const t=Math.ceil(o[2*e]-h),i=Math.floor(o[2*e+1]-h);for(let e=t;e<=i;e++)d[e]=0}return{lut:p,offset:h,mask:d}},e.extractBands=function(e,t){return t?.length&&a(e)?e.extractBands(t):e},e.getClipBounds=h,e.getLocalArithmeticNorthRotations=function(e,t){const{coefficients:i,spacing:r}=t,{offsets_x:s,offsets_y:n,gridWidth:a}=_(e,e,i,{rows:r[0],cols:r[1]}),{width:o,height:l}=e,c=new Float32Array(o*l),u=180/Math.PI;for(let e=0;e<l;e++)for(let t=0;t<o;t++){const i=e*a+t,r=0===e?i:i-a,h=e===l-1?i:i+a,p=s[r]-s[h],d=n[h]-n[r];if(isNaN(p)||isNaN(d))c[e*o+t]=90;else{let i=Math.atan2(d,p)*u;i=(360+i)%360,c[e*o+t]=i}}return c},e.interpolateOffsets=_,e.isValidPixelBlock=a,e.lookupBandValues=o,e.lookupPixels=function(e,t){if(!a(e))return null;const{pixels:r,mask:s}=e,n=r.length;let l=t.lut;const{offset:c}=t;l&&1===l[0].length&&(l=r.map((()=>l)));const u=[],h=t.outputPixelType||"u8";for(let e=0;e<n;e++){const t=o(r[e],s,l[e],c||0,h);u.push(t)}const p=new i({width:e.width,height:e.height,pixels:u,mask:s,pixelType:h});return p.updateStatistics(),p},e.mask=function(e,t){if(!a(e))return null;const{width:r,height:s,pixels:n}=e,h=r*s,p=new Uint8Array(h);e.mask?p.set(e.mask):p.fill(255);const d=n.length,{includedRanges:f,noDataValues:m,outputPixelType:g,matchAll:y,lookups:x}=t;if(x){const e=[];for(let t=0;t<d;t++){const i=x[t],r=o(n[t],p,i.lut,i.offset||0,"u8");e.push(r)}1===e.length?p.set(e[0]):y?c(e,p):u(e,p)}else if(y){const e=[];for(let t=0;t<d;t++){const i=new Uint8Array(h);i.set(p),l(n[t],f?.slice(2*t,2*t+2),m?.[t],i),e.push(i)}1===e.length?p.set(e[0]):c(e,p)}else for(let e=0;e<d;e++)l(n[e],f?.slice(2*e,2*e+2),m?.[e],p);return new i({width:r,height:s,pixelType:g,pixels:n,mask:p})},e.maxMapSizeGpu=9,e.mosaic=d,e.mosaicPixelData=function(e,t){if(!e||0===e.length)return null;const i=e.find((e=>e.pixelBlock));if(null==i?.pixelBlock)return null;const r=(i.extent.xmax-i.extent.xmin)/i.pixelBlock.width,s=(i.extent.ymax-i.extent.ymin)/i.pixelBlock.height,n=.01*Math.min(r,s),a=e.sort(((e,t)=>Math.abs(e.extent.ymax-t.extent.ymax)>n?t.extent.ymax-e.extent.ymax:Math.abs(e.extent.xmin-t.extent.xmin)>n?e.extent.xmin-t.extent.xmin:0)),o=Math.min.apply(null,a.map((e=>e.extent.xmin))),l=Math.min.apply(null,a.map((e=>e.extent.ymin))),c=Math.max.apply(null,a.map((e=>e.extent.xmax))),u=Math.max.apply(null,a.map((e=>e.extent.ymax))),h={x:Math.round((t.xmin-o)/r),y:Math.round((u-t.ymax)/s)},p={width:Math.round((c-o)/r),height:Math.round((u-l)/s)},f={width:Math.round((t.xmax-t.xmin)/r),height:Math.round((t.ymax-t.ymin)/s)};return Math.round(p.width/i.pixelBlock.width)*Math.round(p.height/i.pixelBlock.height)!==a.length||h.x<0||h.y<0||p.width<f.width||p.height<f.height?null:{extent:t,pixelBlock:d(a.map((e=>e.pixelBlock)),p,{clipOffset:h,clipSize:f})}},e.remap=function(e,t){if(!a(e))return null;const{width:s,height:n}=e,{inputRanges:o,outputValues:l,outputPixelType:c,noDataRanges:u,allowUnmatched:h,replacementValue:p,isLastInputRangeInclusive:d}=t,f=e.pixels[0],m=i.createEmptyBand(c,f.length),g=e.mask,y=new Uint8Array(s*n);g?y.set(g):y.fill(255);const x=e.pixelType.startsWith("f")?1e-6:0,w=o.map((e=>e-x));w[0]=o[0],w[w.length-1]=o[o.length-1]+(d?1e-6:0);const _=o.length/2,[v,b]=r.getPixelValueRange(c);for(let e=0;e<n;e++)for(let t=0;t<s;t++){const i=e*s+t;if(y[i]){const e=f[i];let t=!1;for(let r=_-1;r>=0;r--)if(e===o[2*r]||e>w[2*r]&&e<w[2*r+1]){m[i]=l[r],t=!0;break}t||(h?m[i]=e>b?b:e<v?v:p??e:y[i]=0)}}const S=u?.length;if(S)for(let e=0;e<n;e++)for(let t=0;t<s;t++){const i=e*s+t;if(!g||g[i]){const e=f[i];for(let t=0;t<S;t+=2)if(e>=u[t]&&e<=u[t+1]){m[i]=0,y[i]=0;break}}}return new i({width:s,height:n,pixelType:c,pixels:[m],mask:y})},e.remapColor=function(e,t){if(!a(e))return null;const i=e.clone(),{pixels:r}=i,s=i.width*i.height,n=t.length,o=Math.floor(n/2),l=t[Math.floor(o)],c=r[0],u=new Uint8Array(s),h=new Uint8Array(s),p=new Uint8Array(s);let d=i.mask;const f=4===t[0].mappedColor.length;d||(d=new Uint8Array(s),d.fill(f?255:1),i.mask=d);for(let e=0;e<s;e++)if(d[e]){const i=c[e];let r=!1,s=o,a=l,f=0,m=n-1;for(;m-f>1;){if(i===a.value){r=!0;break}i>a.value?f=s:m=s,s=Math.floor((f+m)/2),a=t[Math.floor(s)]}r||(i===t[f].value?(a=t[f],r=!0):i===t[m].value?(a=t[m],r=!0):i<t[f].value?r=!1:i>t[f].value&&(i<t[m].value?(a=t[f],r=!0):m===n-1?r=!1:(a=t[m],r=!0))),r?(u[e]=a.mappedColor[0],h[e]=a.mappedColor[1],p[e]=a.mappedColor[2],d[e]=a.mappedColor[3]):u[e]=h[e]=p[e]=d[e]=0}return i.pixels=[u,h,p],i.mask=d,i.pixelType="u8",i.maskIsAlpha=f,i},e.resampleByMajority=f,e.setValidBoundary=function(e,t,i){if(!a(e))return null;const{width:r,height:s}=e,n=t.x,o=t.y,l=i.width+n,c=i.height+o;if(n<0||o<0||l>r||c>s)return e;if(0===n&&0===o&&l===r&&c===s)return e;e.mask||(e.mask=new Uint8Array(r*s));const u=e.mask;for(let e=0;e<s;e++){const t=e*r;for(let i=0;i<r;i++)u[t+i]=e<o||e>=c||i<n||i>=l?0:1}return e.updateStatistics(),e},e.split=function(e,t,i=0,r=!0){if(!a(e))return null;const{width:s,height:n}=t;let{width:o,height:l}=e;const c=new Map,u={x:0,y:0},h=1+i;let p=e;for(let e=0;e<h;e++){const i=Math.ceil(o/s),a=Math.ceil(l/n);for(let r=0;r<a;r++){u.y=r*n;for(let n=0;n<i;n++){u.x=n*s;const i=x(p,u,t);c.set(`${e}/${r}/${n}`,i)}}e<h-1&&(p=w(p,r)),o=Math.round(o/2),l=Math.round(l/2)}return c},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/PixelBlock":function(){define(["exports","../../chunks/tslib.es6","../../core/Error","../../core/JSONSupport","../../core/lang","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","./SimpleBandStatistics","./rasterFormats/pixelRangeUtils"],(function(e,t,i,r,s,n,a,o,l,c,u){"use strict";var h;return e.default=h=class extends r{static createEmptyBand(e,t){return new(h.getPixelArrayConstructor(e))(t)}static combineBandMasks(e){if(e.length<2)return e[0];const t=e[0].length,i=new Uint8Array(t).fill(255);for(let r=0;r<e.length;r++){const s=e[r];for(let e=0;e<t;e++)s[e]||(i[e]=0)}return i}static getPixelArrayConstructor(e){let t;switch(e){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":t=Float32Array;break;case"f64":t=Float64Array}return t}constructor(e){super(e),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.premultiplyAlpha=!1,this.statistics=null,this.depthCount=1}castPixelType(e){if(!e)return"f32";let t=e.toLowerCase();return["u1","u2","u4"].includes(t)?t="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(t)||(t="f32"),t}getPlaneCount(){return this.pixels?.length}addData(e){if(!e.pixels||e.pixels.length!==this.width*this.height)throw new i("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(e.pixels),this.statistics.push(e.statistics??new c.SimpleBandStatistics)}getAsRGBA(){const e=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(e);break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)}getAsRGBAFloat(){const e=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(e),e}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map((e=>function(e,t){let i=1/0,r=-1/0;const s=e.length;let n,a=0;if(null!=t)for(n=0;n<s;n++)t[n]&&(a=e[n],i=a<i?a:i,r=a>r?a:r);else for(n=0;n<s;n++)a=e[n],i=a<i?a:i,r=a>r?a:r;return new c.SimpleBandStatistics(i,r)}(e,this.mask)));const e=this.mask;let t=0;if(null!=e)for(let i=0;i<e.length;i++)e[i]&&t++;else t=this.width*this.height;this.validPixelCount=t}clamp(e){if(!e||"f64"===e||"f32"===e||!this.pixels)return;const[t,i]=u.getPixelValueRange(e),r=this.pixels,s=this.width*this.height,n=r.length;let a,o,l;const c=[];for(let u=0;u<n;u++){l=h.createEmptyBand(e,s),a=r[u];for(let e=0;e<s;e++)o=a[e],l[e]=o>i?i:o<t?t:o;c.push(l)}this.pixels=c,this.pixelType=e}extractBands(e){const{pixels:t,statistics:i}=this;if(null==e||0===e.length||!t||0===t.length)return this;const r=t.length,s=e.some((e=>e>=t.length)),n=r===e.length&&!e.some(((e,t)=>e!==t));if(s||n)return this;const a=this.bandMasks?.length===r?e.map((e=>this.bandMasks[e])):void 0;let{mask:o,validPixelCount:l}=this;const{width:c,height:u}=this;return a?.length&&(o=h.combineBandMasks(a),l=o.filter((e=>!!e)).length),new h({pixelType:this.pixelType,width:c,height:u,mask:o,bandMasks:a,validPixelCount:l,maskIsAlpha:this.maskIsAlpha,pixels:e.map((e=>t[e])),statistics:i&&e.map((e=>i[e]))})}clone(){const e=new h({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});let t;null!=this.mask&&(e.mask=new Uint8Array(this.mask)),this.bandMasks&&(e.bandMasks=this.bandMasks.map((e=>new Uint8Array(e))));const i=h.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){e.pixels=[];const r=!!this.pixels[0].slice;for(t=0;t<this.pixels.length;t++)e.pixels[t]=r?this.pixels[t].slice():new i(this.pixels[t])}if(this.statistics)for(e.statistics=[],t=0;t<this.statistics.length;t++)e.statistics[t]=s.clone(this.statistics[t]);return e.premultiplyAlpha=this.premultiplyAlpha,e}_fillFrom8Bit(e){const{mask:t,maskIsAlpha:i,premultiplyAlpha:r,pixels:s}=this;if(!e||!s?.length)return void n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let a,o,l,c;a=o=l=s[0],s.length>=3?(o=s[1],l=s[2]):2===s.length&&(o=s[1]);const u=new Uint32Array(e),h=this.width*this.height;if(a.length===h)if(null!=t&&t.length===h)if(i)for(c=0;c<h;c++){const e=t[c];if(e){const t=e/255;u[c]=r?e<<24|l[c]*t<<16|o[c]*t<<8|a[c]*t:e<<24|l[c]<<16|o[c]<<8|a[c]}}else for(c=0;c<h;c++)t[c]&&(u[c]=255<<24|l[c]<<16|o[c]<<8|a[c]);else for(c=0;c<h;c++)u[c]=255<<24|l[c]<<16|o[c]<<8|a[c];else n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(e){const{pixels:t,mask:i,statistics:r}=this;if(!e||!t?.length)return void n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");const s=this.pixelType;let a=1,o=0,l=1;if(r&&r.length>0){for(const e of r)if(null!=e.minValue&&(o=Math.min(o,e.minValue)),null!=e.maxValue&&null!=e.minValue){const t=e.maxValue-e.minValue;l=Math.max(l,t)}a=255/l}else{let e=255;"s8"===s?(o=-128,e=127):"u16"===s?e=65535:"s16"===s?(o=-32768,e=32767):"u32"===s?e=4294967295:"s32"===s?(o=-2147483648,e=2147483647):"f32"===s?(o=-34e38,e=34e38):"f64"===s&&(o=-Number.MAX_VALUE,e=Number.MAX_VALUE),a=255/(e-o)}const c=new Uint32Array(e),u=this.width*this.height;let h,p,d,f,m;if(h=p=d=t[0],h.length!==u)return n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(t.length>=2)if(p=t[1],t.length>=3&&(d=t[2]),null!=i&&i.length===u)for(f=0;f<u;f++)i[f]&&(c[f]=255<<24|(d[f]-o)*a<<16|(p[f]-o)*a<<8|(h[f]-o)*a);else for(f=0;f<u;f++)c[f]=255<<24|(d[f]-o)*a<<16|(p[f]-o)*a<<8|(h[f]-o)*a;else if(null!=i&&i.length===u)for(f=0;f<u;f++)m=(h[f]-o)*a,i[f]&&(c[f]=255<<24|m<<16|m<<8|m);else for(f=0;f<u;f++)m=(h[f]-o)*a,c[f]=255<<24|m<<16|m<<8|m}_fillFrom32Bit(e){const{pixels:t,mask:i}=this;if(!e||!t?.length)return n.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let r,s,a,o;r=s=a=t[0],t.length>=3?(s=t[1],a=t[2]):2===t.length&&(s=t[1]);const l=this.width*this.height;if(r.length!==l)return n.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let c=0;if(null!=i&&i.length===l)for(o=0;o<l;o++)e[c++]=r[o],e[c++]=s[o],e[c++]=a[o],e[c++]=1&i[o];else for(o=0;o<l;o++)e[c++]=r[o],e[c++]=s[o],e[c++]=a[o],e[c++]=1}},t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"width",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"height",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"pixelType",void 0),t.__decorate([o.cast("pixelType")],e.default.prototype,"castPixelType",null),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"validPixelCount",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"mask",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"maskIsAlpha",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"pixels",void 0),t.__decorate([a.property()],e.default.prototype,"premultiplyAlpha",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"statistics",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"depthCount",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"noDataValues",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"bandMasks",void 0),e.default=h=t.__decorate([l.subclass("esri.layers.support.PixelBlock")],e.default),e.default}))},"esri/layers/support/SimpleBandStatistics":function(){define(["exports"],(function(e){"use strict";e.SimpleBandStatistics=class{constructor(e=null,t=null,i=null){this.minValue=e,this.maxValue=t,this.noDataValue=i}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],(function(e){"use strict";const t={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function i(e){return t[e]??[-34028234663852886e22,34028234663852886e22]}const r={u1:1,u2:1,u4:1,u8:1,s8:1,u16:2,s16:2,u32:4,s32:4,f32:4,f64:8,unknown:4,c64:16,c128:32};function s(e){return(e?.startsWith("s")||e?.startsWith("u"))??!1}e.clipBandToPixelTypeRange=function(e,t,r,n){let[a,o]=i(r);const l=s(r);return l&&(a-=1e-5,o+=1e-5),l?r.startsWith("u")?function(e,t,i,r){const[s,n]=r;for(let r=0;r<t.length;r++)if(t[r]){const a=e[r];a<s||a>n?t[r]=0:i[r]=a+.5|0}}(e,t,n,[a,o]):function(e,t,i,r){const[s,n]=r;for(let r=0;r<t.length;r++)if(t[r]){const a=e[r];a<s||a>n?t[r]=0:i[r]=a+(a>0?.5:-.5)|0}}(e,t,n,[a,o]):function(e,t,i,r){const[s,n]=r;for(let r=0;r<t.length;r++)if(t[r]){const a=e[r];a<s||a>n?t[r]=0:i[r]=a}}(e,t,n,[a,o])},e.convertNoDataToMask=function(e,t,r){if(e.depthCount&&e.depthCount>1)return;const{pixels:s,statistics:n,pixelType:a}=e,o=s[0].length,l=e.bandMasks??[],c=e.mask??new Uint8Array(o).fill(255),u="f32"===a||"f64"===a,h=i(a);let p=!1;for(let e=0;e<s.length;e++){const i="number"==typeof t?t:t[e];if(null==i)continue;const o=n?.[e]?.minValue??h[0],d=n?.[e]?.maxValue??h[1];if(o>i+Number.EPSILON||d<i-Number.EPSILON)continue;const f=l[e]||c.slice(),m=s[e],g=r?.customFloatTolerance;if(u&&0!==g){let e=g;e||(e=Math.abs(i)>=9999999e31?2e-7*Math.abs(i):"f32"===a?2**-23:Number.EPSILON);for(let t=0;t<m.length;t++)f[t]&&Math.abs(m[t]-i)<e&&(m[t]=0,f[t]=0,c[t]=0,p=!0)}else for(let e=0;e<m.length;e++)f[e]&&m[e]===i&&(m[e]=0,f[e]=0,c[e]=0,p=!0);l[e]=f}if(p){const t=e.bandMasks||e.pixels.length>1?l:null;r?.matchAllNoData?e.mask=t&&t.length>1?function(e){if(e.length<2)return e[0];const t=e[0].length,i=new Uint8Array(t).fill(0);for(let r=0;r<e.length;r++){const s=e[r];for(let e=0;e<t;e++)s[e]&&(i[e]=255)}return i}(t):c:(e.bandMasks=t,e.mask=c)}p&&"updateStatistics"in e&&e.updateStatistics()},e.fixNaN=function(e,t){for(let i=0;i<t.length;i++)t[i]&&isNaN(e[i])&&(t[i]=0,e[i]=0)},e.getBytesPerPixel=function(e){return t=e.pixelType,r[t]*e.bandCount;var t},e.getIntegerPixelType=function(e,t){return null==e||null==t?"s32":e<0?e>=-128&&t<128?"s8":e>=-32768&&t<32768?"s16":"s32":t<256?"u8":t<65536?"u16":"u32"},e.getPixelValueRange=i,e.isIntegerPixelType=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/support/ExportStrategy":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/has","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/spatialReferenceUtils","../../../../layers/support/TileInfo","../../viewStateUtils","../../engine/Bitmap","../../tiling/TileInfoView","../../tiling/TileKey"],(function(e,t,i,r,s,n,a,o,l,c,u,h,p,d,f,m){"use strict";const g=c.create(),y=[0,0],x=new m(0,0,0,0);return e.default=class extends i{constructor(e){super(e),this._imagePromise=null,this.bitmaps=[],this.hidpi=!1,this.imageMaxWidth=2048,this.imageMaxHeight=2048,this.imageRotationSupported=!1,this.imageNormalizationSupported=!1,this.update=s.debounce((async(e,t)=>{if(s.throwIfAborted(t),!e.stationary||this.destroyed)return;const i=e.state,r=u.getInfo(i.spatialReference),n=this.hidpi?e.pixelRatio:1,a=i.worldScreenWidth>0,o=a&&this.imageNormalizationSupported&&i.worldScreenWidth<i.size[0],l=Math.round((this.imageMaxWidth??0)/n),c=Math.round((this.imageMaxHeight??0)/n);o?(y[0]=i.worldScreenWidth,y[1]=i.size[1]):this.imageRotationSupported?(y[0]=i.size[0],y[1]=i.size[1]):p.getOuterSize(y,i);const h=Math.floor(y[0])>l||Math.floor(y[1])>c,d=r&&(i.extent.xmin<r.valid[0]||i.extent.xmax>r.valid[1]),f=!this.imageNormalizationSupported&&d,m=!h&&!f,g=this.imageRotationSupported?i.rotation:0,x=this.container.children.slice();if(m){const e=o?i.paddedViewState.center:i.center;this._imagePromise=this._singleExport(i,y,e,i.resolution,g,n,t)}else{let e=Math.min(l,c);a&&(e=Math.min(i.worldScreenWidth,e),e=Math.round(i.worldScreenWidth/Math.ceil(i.worldScreenWidth/e))),this._imagePromise=this._tiledExport(i,e,n,t)}try{const e=await this._imagePromise??[];s.throwIfAborted(t);const i=[];if(this._imagePromise=null,this.destroyed)return;this.bitmaps=e;for(const t of x)e.includes(t)||i.push(t.fadeOut().then((()=>{t.remove(),t.destroy()})));for(const t of e)i.push(t.fadeIn());await Promise.all(i)}catch(e){this._imagePromise=null,s.throwIfAbortError(e)}}),5e3),this.updateExports=s.debounce((async e=>{const t=[];for(const i of this.container.children){if(!i.visible||!i.stage)return;t.push(e(i).then((()=>{i.invalidateTexture(),i.requestRender()})))}this._imagePromise=s.eachAlways(t).then((()=>this._imagePromise=null)),await this._imagePromise}))}destroy(){this.bitmaps.forEach((e=>e.destroy())),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(e,t,i,r,n,a){const o=await this.fetchSource(e,Math.floor(t*n),Math.floor(i*n),{rotation:r,pixelRatio:n,signal:a});s.throwIfAborted(a);const l=new d.Bitmap(null,!0);return l.x=e.xmin,l.y=e.ymax,l.resolution=e.width/t,l.rotation=r,l.pixelRatio=n,l.opacity=0,this.container.addChild(l),await l.setSourceAsync(o,a),s.throwIfAborted(a),l}async _singleExport(e,t,i,r,s,n,a){p.getBBox(g,i,r,t);const o=c.toExtent(g,e.spatialReference);return[await this._export(o,t[0],t[1],s,n,a)]}_tiledExport(e,t,i,r){const s=h.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),n=new f(s),a=n.getTileCoverage(e);if(!a)return null;const o=[];return a.forEach(((s,a,l,u)=>{x.set(s,a,l,0),n.getTileBounds(g,x);const h=c.toExtent(g,e.spatialReference);o.push(this._export(h,t,t,0,i,r).then((e=>(0!==u&&(x.set(s,a,l,u),n.getTileBounds(g,x),e.x=g[0],e.y=g[3]),e))))})),Promise.all(o)}},t.__decorate([n.property()],e.default.prototype,"_imagePromise",void 0),t.__decorate([n.property()],e.default.prototype,"bitmaps",void 0),t.__decorate([n.property()],e.default.prototype,"container",void 0),t.__decorate([n.property()],e.default.prototype,"fetchSource",void 0),t.__decorate([n.property()],e.default.prototype,"hidpi",void 0),t.__decorate([n.property()],e.default.prototype,"imageMaxWidth",void 0),t.__decorate([n.property()],e.default.prototype,"imageMaxHeight",void 0),t.__decorate([n.property()],e.default.prototype,"imageRotationSupported",void 0),t.__decorate([n.property()],e.default.prototype,"imageNormalizationSupported",void 0),t.__decorate([n.property()],e.default.prototype,"requestUpdate",void 0),t.__decorate([n.property()],e.default.prototype,"updating",null),e.default=t.__decorate([l.subclass("esri.views.2d.layers.support.ExportStrategy")],e.default),e.default}))},"esri/views/2d/viewStateUtils":function(){define(["exports"],(function(e){"use strict";const t=Math.PI/180;e.getBBox=function(e,t,i,r){const[s,n]=t,[a,o]=r,l=.5*i;return e[0]=s-l*a,e[1]=n-l*o,e[2]=s+l*a,e[3]=n+l*o,e},e.getOuterSize=function(e,i){const r=i.rotation*t,s=Math.abs(Math.cos(r)),n=Math.abs(Math.sin(r)),[a,o]=i.size;return e[0]=Math.round(o*n+a*s),e[1]=Math.round(o*s+a*n),e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/imagery/VectorFieldView2D":function(){define(["exports","../../../../chunks/tslib.es6","../../../../Graphic","../../../../request","../../../../core/Accessor","../../../../core/Logger","../../../../core/promiseUtils","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Extent","../../../../geometry/support/spatialReferenceUtils","../../../../layers/support/rasterFunctions/rasterProjectionHelper","../../../../layers/support/rasterFunctions/vectorFieldUtils","../../engine/imagery/RasterVFContainer","./ImageryVFStrategy"],(function(e,t,i,r,s,n,a,o,l,c,u,h,p,d,f,m,g,y){"use strict";return e.default=class extends s{constructor(){super(...arguments),this.attached=!1,this.container=new g.RasterVFContainer,this.type="imageryVF",this._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""},this._fetchpixels=async(e,t,i,r)=>{const s=await this._projectFullExtentPromise,{layer:n}=this,{symbolTileSize:a}=n.renderer,{extent:o,width:l,height:c}=m.snapImageToSymbolTile(e,t,i,a,s);if(null!=s&&!s.intersects(e))return{extent:o,pixelBlock:null};const u={bbox:`${o.xmin}, ${o.ymin}, ${o.xmax}, ${o.ymax}`,exportParametersVersion:n.exportImageServiceParameters.version,symbolTileSize:a,time:JSON.stringify(this.timeExtent||"")};if(this._canReuseVectorFieldData(u)){const e=this.getPixelData();if(null!=e&&`${e.extent.xmin}, ${e.extent.ymin}, ${e.extent.xmax}, ${e.extent.ymax}`===u.bbox)return e}const{pixelBlock:h}=await n.fetchPixels(o,l,c,{timeExtent:this.timeExtent,interpolation:n.interpolation,signal:r});if(this._dataParameters=u,null==h)return{extent:o,pixelBlock:null};const{dataType:p}=n.rasterInfo;return{extent:o,pixelBlock:"vector-uv"===p&&h?await n.convertVectorFieldData(h,"vector-uv",{signal:r}):h}}}get updating(){return!this.attached||this._strategy.updating}attach(){this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference),this._strategy=new y({container:this.container,fetchPixels:this._fetchpixels}),this.addHandles(o.watch((()=>this.layer.renderer),(e=>this._updateSymbolizerParams(e)),o.syncAndInitial),"attach")}detach(){this._strategy.destroy(),this.container.children.forEach((e=>e.destroy())),this.container.removeAllChildren(),this.removeHandles("attach"),this._strategy=this.container=this._projectFullExtentPromise=null}getPixelData(){const e=this.container.children[0]?.rawPixelData;if(this.updating||!e)return null;const{extent:t,pixelBlock:i}=e;return{extent:t,pixelBlock:i}}hitTest(e){return new i({attributes:{},geometry:e.clone(),layer:this.layer})}update(e){this._strategy.update(e,this._symbolizerParams).catch((e=>{a.isAbortError(e)||n.getLogger(this).error(e)}))}redraw(){const{renderer:e}=this.layer;e&&(this._updateSymbolizerParams(e),this._strategy.redraw(this._symbolizerParams))}_canReuseVectorFieldData(e){const t=this._dataParameters.exportParametersVersion===e.exportParametersVersion,i=this._dataParameters.time===e.time,r=this._dataParameters.symbolTileSize===e.symbolTileSize,s=this._dataParameters.bbox===e.bbox;return t&&i&&r&&s}async _getProjectedFullExtent(e){try{return f.projectExtent(this.layer.fullExtent,e)}catch(t){try{const t=(await r(this.layer.url,{query:{option:"footprints",outSR:d.srToRESTValue(e),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return t?p.fromJSON(t):null}catch{return null}}}_updateSymbolizerParams(e){"vector-field"===e?.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))}},t.__decorate([l.property()],e.default.prototype,"attached",void 0),t.__decorate([l.property()],e.default.prototype,"container",void 0),t.__decorate([l.property()],e.default.prototype,"layer",void 0),t.__decorate([l.property()],e.default.prototype,"timeExtent",void 0),t.__decorate([l.property()],e.default.prototype,"type",void 0),t.__decorate([l.property()],e.default.prototype,"view",void 0),t.__decorate([l.property()],e.default.prototype,"updating",null),e.default=t.__decorate([h.subclass("esri.views.2d.layers.imagery.VectorFieldView2D")],e.default),e.default}))},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define(["require","exports","../../../core/arrayUtils","../../../core/Error","../../../core/promiseUtils","../../../core/unitUtils","../../../geometry/Extent","../../../chunks/pe","../../../geometry/Point","../../../geometry/Polygon","../../../geometry/projectionUtils","../../../geometry/SpatialReference","../../../geometry/support/spatialReferenceUtils"],(function(e,t,i,r,s,n,a,o,l,c,u,h,p){"use strict";var d;function f(){if(!S)throw new r("rasterprojectionhelper-project","projection operator is not loaded")}!function(e){e[e.None=0]="None",e[e.North=1]="North",e[e.South=2]="South",e[e.Both=3]="Both"}(d||(d={}));const m=(e,t,i,r=0)=>{if(1===i[0])return[0,0];let s=1,n=-1,a=1,o=-1;for(let t=0;t<e.length;t+=2)isNaN(e[t])||(s=s>e[t]?e[t]:s,n=n>e[t]?n:e[t],a=a>e[t+1]?e[t+1]:a,o=o>e[t+1]?o:e[t+1]);const{cols:l,rows:c}=t,u=(n-s)/l/i[0],h=(o-a)/c/i[1],p=2*r;let d=0,f=!1,m=[0,0];for(let t=0;t<l-3;t++){for(let i=0;i<c-3;i++){const r=t*c*2+2*i,s=(e[r]+e[r+4]+e[r+4*c]+e[r+4*c+4])/4,n=(e[r+1]+e[r+5]+e[r+4*c+1]+e[r+4*c+5])/4,a=Math.abs((s-e[r+2*c+2])/u),o=Math.abs((n-e[r+2*c+3])/h);if(a+o>d&&(d=a+o,m=[a,o]),p&&d>p){f=!0;break}}if(f)break}return m},g={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},y=new Map,x=new Map,w=500;let _,v,b,S=!1;function M(e,t,i){if(f(),i){const i=v.execute(e,t);return b.getTransformation(t,e.spatialReference,i)}return b.getTransformation(e.spatialReference,t,e)}function P(e,t,i){const r=n.getMetersPerUnitForSR(t)/n.getMetersPerUnitForSR(i);return{x:e.x*r,y:e.y*r}}function T(e,t,i){const{spatialReference:s}=i;if(!s||!t||s.equals(t))return e;if(s.isGeographic&&t.isGeographic)return P(e,s,t);if(f(),!S)throw new r("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:a,y:o}=e;const l=(a+o)/2*n.getMetersPerUnitForSR(s);let u=1;l>30&&(u=30/l,a*=u,o*=u);const h=256,p=a*h/2,d=o*h/2,{x:m,y:g}=i.center,y=[];for(let e=0;e<=h;e++)y.push([m-p,g-d+e*o]);for(let e=1;e<=h;e++)y.push([m-p+e*a,g+d]);for(let e=1;e<=h;e++)y.push([m+p,g+d-e*o]);for(let e=1;e<h;e++)y.push([m+p-e*a,g-d]);y.push(y[0]);const x=new c({rings:[y],spatialReference:s}),w=v.execute(x,t);if(!w)return P(e,s,t);const _=w.extent,b=B(t);if(null==_||null!=b&&_.width>=b)return P(e,s,t);const M=function(e){let t=0;for(const i of e){const e=i.length;let r=i[0][0]*(i[1][1]-i[e-2][1]);for(let t=1;t<e-1;t++)r+=i[t][0]*(i[t+1][1]-i[t-1][1]);t+=r/2}return Math.abs(t)}(w.rings),T=a*o*h*h,A=Math.sqrt(M/T)/u,k={x:_.width/u/h,y:_.height/u/h},R={x:a*A,y:o*A},D=k.x*k.y;return Math.abs(D-R.x*R.y)/D<.1?k:R}function A(e,t){return("number"==typeof e?e:(e.x+e.y)/2)*n.getMetersPerUnitForSR(t)*96*39.37}function k(e,t=.01){return n.getMetersPerUnitForSR(e)?t/n.getMetersPerUnitForSR(e):0}function R(e,t,i,r=!0){const s=e.spatialReference;if(s.equals(t))return e;f();const n=v.execute(e,t,{geographicTransformation:i});return r&&n?(D([e],[n],s,t),n):n}function D(e,t,i,r){const s=z(i,!0),n=z(r,!0),a=k(i,w),o=k(r,w);if(a&&null!=s&&null!=n)for(let i=0;i<e.length;i++){const r=t[i];if(!r)continue;const{x:l}=e[i],{x:c}=r;c>=n[1]-o&&Math.abs(l-s[0])<a?r.x-=n[1]-n[0]:c<=n[0]+o&&Math.abs(l-s[1])<a&&(r.x+=n[1]-n[0])}}function E(e){const{inSR:t,outSR:i,preferPE:r}=e;if(t.equals(i)){const{points:t}=C(e,null);return t}if(t.isWebMercator&&i.isWGS84||t.isWGS84&&i.isWebMercator)return function(e){const{cols:t,rows:i,xres:r,yres:s,usePixelCenter:n,inSR:a,outSR:o}=e;let{xmin:c,ymax:h}=e;n&&(c+=r/2,h-=s/2);const p=[],d=[],f=Math.max(t,i);for(let e=0;e<f;e++){const n=c+r*Math.min(t,e),f=h-s*Math.min(i,e),m=u.projectWithoutEngine(new l({x:n,y:f,spatialReference:a}),a,o);e<=t&&p.push(m.x),e<=i&&d.push(m.y)}const m=[];for(let e=0;e<t;e++)for(let t=0;t<i;t++)m.push([p[e],d[t]]);return m}(e);if(r){if(t.isGeographic)return U(e);if(null!=V(t))return U(e)}return function(e){const{points:t}=C(e,null),{inSR:i,outSR:r,datumTransformation:s}=e,n=t.map((e=>new l(e[0],e[1],i))),a=v.executeMany(n,r,{geographicTransformation:s});return s&&D(n,a,i,r),a.map((e=>e?[e.x,e.y]:[NaN,NaN]))}(e)}function U(e){const{inSR:t,outSR:i,datumTransformation:r}=e,s=V(t),{points:n,mask:a}=C(e,s);if(!t.isGeographic){const e=t.wkid?o.PeFactory.coordsys(t.wkid):o.PeFactory.fromString(t.isGeographic?o.PeDefs.PE_TYPE_GEOGCS:o.PeDefs.PE_TYPE_PROJCS,t.wkt2||t.wkt);o.PeCSTransformations.projToGeog(e,n.length,n)}if(null!=r&&r.steps.length){let e;const t=179.9955;if(i.isGeographic&&(e=n.map((([e])=>e>t?1:e<-179.9955?-1:0))),r.steps.forEach((e=>{const t=e.wkid?o.PeFactory.geogtran(e.wkid):o.PeFactory.fromString(o.PeDefs.PE_TYPE_GEOGTRAN,e.wkt);o.PeGTTransformations.geogToGeog(t,n.length,n,null,e.isInverse?o.PeDefs.PE_TRANSFORM_2_TO_1:o.PeDefs.PE_TRANSFORM_1_TO_2)})),e)for(let i=0;i<n.length;i++){const r=e[i],s=n[i][0],a=s>t?1:s<-179.9955?-1:0;r&&a&&r!==a&&(n[i][0]=r>0?s+360:s-360)}}if(!i.isGeographic){const e=V(i,!0),t=null!=e&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];!function(e,t){const[i,r]=t;for(let t=0;t<e.length;t++){const s=e[t][1];(s<i||s>r)&&(e[t]=[NaN,NaN])}}(n,t);const r=i.wkid?o.PeFactory.coordsys(i.wkid):o.PeFactory.fromString(i.isGeographic?o.PeDefs.PE_TYPE_GEOGCS:o.PeDefs.PE_TYPE_PROJCS,i.wkt2||i.wkt);o.PeCSTransformations.geogToProj(r,n.length,n)}let l=n;if(a&&n.length!==a.length){l=[];for(let e=0,t=0;e<a.length;e++)a[e]?l.push(n[t++]):l.push([NaN,NaN])}return l}function V(e,t=!1){let i=e.wkid||e.wkt2||e.wkt;if(!i||e.isGeographic)return null;if(i=String(i),y.has(i)){const e=y.get(i);return t?e?.gcs:e?.pcs}const r=e.wkid?o.PeFactory.coordsys(e.wkid):o.PeFactory.fromString(e.isGeographic?o.PeDefs.PE_TYPE_GEOGCS:o.PeDefs.PE_TYPE_PROJCS,e.wkt2||e.wkt),s=F(r,k(e,1e-4)),n=F(r,0,!0);return y.set(i,{pcs:s,gcs:n}),t?n:s}function F(e,t=0,i=!1){const r=o.PePCSInfo.generate(e),s=i?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!r||!s?.length)return null;let n=!1,a=s.find((e=>1===e.getInclusive()&&1===e.getKind()));if(!a){if(a=s.find((e=>1===e.getInclusive()&&0===e.getKind())),!a)return null;n=!0}const l=i?0:(2===r.getNorthPoleLocation()?1:0)|(2===r.getSouthPoleLocation()?2:0),c=r.isPannableRectangle(),u=a.getCoord();if(n)return{isEnvelope:n,isPannable:c,vertices:u,coef:null,bbox:[u[0][0]-t,u[0][1]-t,u[1][0]+t,u[1][1]+t],poleLocation:l};let h=0;const p=[];let[d,f]=u[0],[m,g]=u[0];for(let e=0,t=u.length;e<t;e++){h++,h===t&&(h=0);const[i,r]=u[e],[s,n]=u[h];if(n===r)p.push([i,s,r,n,2]);else{const e=(s-i)/(n-r||1e-4),t=i-e*r;r<n?p.push([e,t,r,n,0]):p.push([e,t,n,r,1])}d=d<i?d:i,f=f<r?f:r,m=m>i?m:i,g=g>r?g:r}return{isEnvelope:!1,isPannable:c,vertices:u,coef:p,bbox:[d,f,m,g],poleLocation:l}}function C(e,t){const i=[],{cols:r,rows:s,xres:n,yres:a,usePixelCenter:o}=e;let{xmin:l,ymax:c}=e;if(o&&(l+=n/2,c-=a/2),null==t){for(let e=0;e<r;e++)for(let t=0;t<s;t++)i.push([l+n*e,c-a*t]);return{points:i}}const u=new Uint8Array(r*s);if(t.isEnvelope){const{bbox:[e,o,h,p]}=t;for(let d=0,f=0;d<r;d++){const r=l+n*d,m=t.isPannable||r>=e&&r<=h;for(let e=0;e<s;e++,f++){const t=c-a*e;m&&t>=o&&t<=p&&(i.push([r,t]),u[f]=1)}}return{points:i,mask:u}}const h=t.coef,p=[];for(let e=0;e<s;e++){const t=c-a*e,i=[],r=[];for(let e=0;e<h.length;e++){const[s,n,a,o,l]=h[e];if(t===a&&a===o)i.push(s),i.push(n),r.push(2),r.push(2);else if(t>=a&&t<=o){const e=s*t+n;i.push(e),r.push(l)}}let s=i;if(i.length>2){let e=2===r[0]?0:r[0],t=i[0];s=[];for(let n=1;n<r.length;n++)2===r[n]&&n!==r.length-1||(r[n]!==e&&(s.push(0===e?Math.min(t,i[n-1]):Math.max(t,i[n-1])),e=r[n],t=i[n]),n===r.length-1&&s.push(0===r[n]?Math.min(t,i[n]):Math.max(t,i[n])));s.sort(((e,t)=>e-t))}else i[0]>i[1]&&(s=[i[1],i[0]]);p.push(s)}for(let e=0,t=0;e<r;e++){const r=l+n*e;for(let e=0;e<s;e++,t++){const s=c-a*e,n=p[e];if(2===n.length)r>=n[0]&&r<=n[1]&&(i.push([r,s]),u[t]=1);else if(n.length>2){let e=!1;for(let t=0;t<n.length;t+=2)if(r>=n[t]&&r<=n[t+1]){e=!0;break}e&&(i.push([r,s]),u[t]=1)}}}return{points:i,mask:u}}function I(e,t){const i=B(e[0].spatialReference);if(e.length<2||null==i)return e[0];if(t=t??k(e[0].spatialReference),1===(e=e.filter((e=>e.width>t))).length)return e[0];let{xmin:r,xmax:s,ymin:n,ymax:o}=e[0];for(let t=1;t<e.length;t++){const r=e[t];s=r.xmax+i*t,n=Math.min(n,r.ymin),o=Math.max(o,r.ymax)}return new a({xmin:r,xmax:s,ymin:n,ymax:o,spatialReference:e[0].spatialReference})}function O(e,t,r=null,s=!0){const n=e.spatialReference;if(n.equals(t)||!t)return e;const o=G(e),l=B(n,!0),u=B(t);if(0===o||null==l||null==u){const i=L(e,t,r,s);if(i&&null==l&&null!=u&&Math.abs(i.width-u)<k(t)&&v.isLoaded()){const r=V(n);if(null!=r&&r.poleLocation===d.None&&e.width<(r.bbox[2]-r.bbox[0])/2)return function(e,t){const i=B(t);if(null==i)return null;let{xmin:r,ymin:s,xmax:n,ymax:o}=e;const l=e.spatialReference,u=new c({spatialReference:l,rings:[[[r,s],[n,s],[n,o],[r,o],[r,s]]]}),h=v.execute(u,t);if(2!==h.rings.length||!h.rings[0].length||!h.rings[1].length)return null;const{rings:p}=h,d=k(l),f=new a({spatialReference:t});for(let e=0;e<2;e++){r=n=p[e][0][0],s=o=p[e][0][1];for(let t=0;t<p[e].length;t++)r=r>p[e][t][0]?p[e][t][0]:r,n=n<p[e][t][0]?p[e][t][0]:n,s=s>p[e][t][1]?p[e][t][1]:s,o=o<p[e][t][1]?p[e][t][1]:o;if(0===e)f.ymin=s,f.ymax=o,f.xmin=r,f.xmax=n;else if(f.ymin=Math.min(f.ymin,s),f.ymax=Math.max(f.ymax,o),Math.abs(n-i/2)<d)f.xmin=r,f.xmax=f.xmax+i;else{if(!(Math.abs(r+i/2)<d))return null;f.xmax=n+i}}return f}(e,t)||i}return i}const h=e.clone().normalize();if(1===h.length&&e.xmax<l&&e.xmax-l/2>k(n)){const{xmin:t,xmax:i}=e;for(let r=0;r<=o;r++){const s=0===r?t:-l/2,c=r===o?i-l*r:l/2;h[r]=new a({xmin:s,xmax:c,ymin:e.ymin,ymax:e.ymax,spatialReference:n})}}const p=h.map((e=>L(e,t,r,s))).filter(i.isSome);return 0===p.length?null:I(p)}function L(e,t,i,r=!0,s=!0){const n=e.spatialReference;if(n.equals(t)||!t)return e;f();const a=v.execute(e,t,{geographicTransformation:i});if(s&&t.isWebMercator&&a&&(a.ymax=Math.min(20037508.342787,a.ymax),a.ymin=Math.max(-20037508.342787,a.ymin),a.ymin>=a.ymax))return null;if(!r||!a)return a;const o=z(n,!0),c=z(t,!0);if(null==o||null==c)return a;const u=k(n,.001),h=k(n,w),p=k(t,.001);if(Math.abs(a.xmin-c[0])<p&&Math.abs(a.xmax-c[1])<p){const r=Math.abs(e.xmin-o[0]),s=Math.abs(o[1]-e.xmax);if(r<u&&s>h){a.xmin=c[0];const r=[];r.push(new l(e.xmax,e.ymin,n)),r.push(new l(e.xmax,(e.ymin+e.ymax)/2,n)),r.push(new l(e.xmax,e.ymax,n));const s=r.map((e=>R(e,t,i))).filter((e=>!isNaN(e?.x))).map((e=>e.x));a.xmax=Math.max.apply(null,s)}if(s<u&&r>h){a.xmax=c[1];const r=[];r.push(new l(e.xmin,e.ymin,n)),r.push(new l(e.xmin,(e.ymin+e.ymax)/2,n)),r.push(new l(e.xmin,e.ymax,n));const s=r.map((e=>R(e,t,i))).filter((e=>!isNaN(e?.x))).map((e=>e.x));a.xmin=Math.min.apply(null,s)}}else{const e=k(t,.001);Math.abs(a.xmin-c[0])<e&&(a.xmin=c[0]),Math.abs(a.xmax-c[1])<e&&(a.xmax=c[1])}return a}function B(e,t=!1){if(!e)return null;const i=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*i:e.wkid&&e.isGeographic?360:2*g[e.wkid]||null}function z(e,t=!1){if(e.isGeographic)return[-180,180];const i=B(e,t);return null!=i?[-i/2,i/2]:null}function N(e,t,i,r){let s=(e-t)/i;return s-Math.floor(s)!==0?s=Math.floor(s):r&&(s-=1),s}function G(e,t=!1){const i=B(e.spatialReference);if(null==i)return 0;const r=t?0:-i/2,s=k(e.spatialReference),n=!t&&Math.abs(e.xmax-i/2)<s?i/2:e.xmax,a=!t&&Math.abs(e.xmin+i/2)<s?-i/2:e.xmin;return N(n,r,i,!0)-N(a,r,i,!1)}function j(e){const{projectedExtent:t,srcBufferExtent:i,pixelSize:r,datumTransformation:s,rasterTransform:n}=e,a=t.spatialReference,o=i.spatialReference;f();const{xmin:c,ymin:u,xmax:h,ymax:p}=t,d=B(o),m=null!=d&&(e.hasWrapAround||"gcs-shift"===n?.type),g=e.spacing||[32,32],y=g[0]*r.x,x=g[1]*r.y,_=1===g[0],v=Math.ceil((h-c)/y-.1/g[0])+(_?0:1),b=Math.ceil((p-u)/x-.1/g[1])+(_?0:1),S=E({cols:v,rows:b,xmin:c,ymax:p,xres:y,yres:x,inSR:a,outSR:o,datumTransformation:s,preferPE:g[0]<=4,usePixelCenter:_}),M=[];let P,T=0;const A=_?-1:NaN,{xmin:R,xmax:D,ymax:U,width:F,height:C}=i,I=k(o,w),O=null!=d&&R>0&&D>d/2,L=V(a),z=null!=L&&L.poleLocation>0;for(let e=0;e<v;e++){const t=[];for(let i=0;i<b;i++){let r=S[e*b+i];if(m&&r[0]>D&&r[0]>d/2-I?r[0]-=d:m&&0===e&&r[0]<0&&O&&!n&&(r[0]+=d),!r||isNaN(r[0])||isNaN(r[1]))M.push(A),M.push(A),t.push(null),T++;else{if(n){const e=n.inverseTransform(new l({x:r[0],y:r[1],spatialReference:o}));r=[e.x,e.y]}t.push(r),e>0&&m&&P[i]&&r[0]<P[i][0]&&(r[0]+=d,z&&r[0]>D&&r[0]>d&&(r[0]-=d)),M.push((r[0]-R)/F),M.push((U-r[1])/C)}}P=t}return{offsets:M,error:null,coefficients:null,outofBoundPointCount:T,spacing:g,size:_?[v,b]:[v-1,b-1]}}function q(e,t,i){const{cols:r,rows:s}=t,n=new Float32Array((r-1)*(s-1)*2*6),a=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),o=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let t=0;t<r-1;t++){for(let i=0;i<s-1;i++){let l=t*s*2+2*i;const c=e[l],u=e[l+1],h=e[l+2],p=e[l+3];l+=2*s;const d=e[l],f=e[l+1],m=e[l+2],g=e[l+3];let y=0,x=12*(i*(r-1)+t);for(let e=0;e<3;e++)n[x++]=a[y++]*c+a[y++]*h+a[y++]*m;y=0;for(let e=0;e<3;e++)n[x++]=a[y++]*u+a[y++]*p+a[y++]*g;y=0;for(let e=0;e<3;e++)n[x++]=o[y++]*c+o[y++]*d+o[y++]*m;y=0;for(let e=0;e<3;e++)n[x++]=o[y++]*u+o[y++]*f+o[y++]*g}if(i)for(let e=0;e<n.length;e++)isNaN(n[e])&&(n[e]=-1)}return n}function H(e,t){const i=e.clone().normalize();return 1===i.length?i[0]:I(i,t)}function W(e,t,i=!1){const{pixelSize:r,extent:s}=e,n=M(s,t,!1),a=O(H(s,(r.x+r.y)/16),t,n);return!a||i||0===G(a)?a:L(s,t,n)}t.computeProjectedScales=function(e,t,i){const r=i?.tileSize??512,s=i?.alignGlobalDatasetWithAGOL??!0,n=!!i?.limitToSrcResolution,{extent:a,spatialReference:o,pixelSize:l}=e,c=T(l,t,a);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(c.x+c.y)/2,p=A(u,t),d=t.isGeographic?256/r*295828763.7958547:256/r*591657527.591555;let f="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const m=W(e,t,!0),g=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(d/2/p)/Math.LN2));if(!f&&m&&s&&(t.isGeographic||t.isWebMercator)){const i=B(t);if(f=G(m)>0||null!=i&&m.width>i/4,!f&&null!=i){let t=-1;if(g<3)t=2**g*u*r;else if(e.storageInfo){const{maximumPyramidLevel:i=0,pyramidScalingFactor:s=2}=e.storageInfo;t=s**i*u*r}const s=Math.ceil(i/t);f=1===s||2===s&&i/2-m.xmax<t}}let y,x=p;const w=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(f){x=d;const i=t.isGeographic?1341104507446289e-21:.29858214164761665,r=A(i,t),s=t.isGeographic?4326:3857;y=T({x:i,y:i},o,W(e,new h({wkid:s}),!0)),y.x*=x/r,y.y*=x/r}else{y={x:l.x,y:l.y};let e=0;for(;x<.5005*d&&e<g;)e++,x*=w,y.x*=w,y.y*=w;Math.max(x,d)/Math.min(x,d)<=1.001&&(x=d)}const _=[x],v=[{x:y.x,y:y.y}],b=Math.min(70.5310735,p)/1.001;for(;x>=b;)x/=w,y.x/=w,y.y/=w,_.push(x),v.push({x:y.x,y:y.y});if(n){const e=.001*l.x;let t=v.findIndex((t=>t.x>=l.x-e&&t.x<=l.x+e));t>-1?(v.length=t+1,_.length=t+1):(t=v.findIndex((t=>t.x<=l.x+e)),t>0&&(v.length=t,_.length=t))}return{projectedPixelSize:c,scales:_,srcResolutions:v,isCustomTilingScheme:!f}},t.defaultGridSpacing=32,t.defaultProjectionToleranceInPixels=4,t.getDefaultDatumTransformationForDataset=M,t.getProjectedGridPoints=E,t.getProjectionOffsetGrid=function(e){const t=e.isAdaptive&&null==e.spacing;let i=e.spacing||[32,32],r=j(e),s={cols:r.size[0]+1,rows:r.size[1]+1};const n=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2;let a=r.outofBoundPointCount===r.offsets.length/2||t&&n?[0,0]:m(r.offsets,s,i,4);const l=(a[0]+a[1])/2,c=e.projectedExtent.spatialReference,u=e.srcBufferExtent.spatialReference;if(t&&(n||l>4)&&(c.isGeographic||V(c),i=[4,4],r=j({...e,spacing:i}),s={cols:r.size[0]+1,rows:r.size[1]+1},a=m(r.offsets,s,i,4)),r.error=a,i[0]>1&&(r.coefficients=q(r.offsets,s,n)),e.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(u.isGeographic)r.gcsGrid={offsets:r.offsets,coefficients:r.coefficients,spacing:i};else{const t=V(c);if(null!=t&&!t.isEnvelope){const t=function(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt2||e.wkt);let i;return x.has(t)?i=x.get(t):(i=(e.wkid?o.PeFactory.coordsys(e.wkid):o.PeFactory.fromString(o.PeDefs.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),x.set(t,i)),new h({wkid:i})}(c),a=O(e.projectedExtent,t),{offsets:l}=j({...e,srcBufferExtent:a,spacing:i}),u=q(l,s,n);r.gcsGrid={offsets:l,coefficients:u,spacing:i}}}return r},t.getRasterDatasetAlignmentInfo=function(e){const t=e.storageInfo.origin.x,i=B(e.spatialReference,!0);if(null==i)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const r=i/2,{nativePixelSize:s,storageInfo:n,extent:a}=e,{maximumPyramidLevel:o,blockWidth:l,pyramidScalingFactor:c}=n;let u=s.x;const h=[],p=null!=e.transform&&"gcs-shift"===e.transform.type,d=t+(p?0:r),f=p?i-t:r-t;for(let e=0;e<=o;e++){const e=(a.xmax-t)/u/l,i=e-Math.floor(e)===0?e:Math.ceil(e),r=f/u/l,s=r-Math.floor(r)===0?r:Math.ceil(r),n=Math.floor(d/u/l),o=Math.round(d/u)%l,p=(l-Math.round(f/u)%l)%l;h.push({resolutionX:u,blockWidth:l,datasetColumnCount:i,worldColumnCountFromOrigin:s,leftMargin:o,rightPadding:p,originColumnOffset:n}),u*=c}return{originX:t,halfWorldWidth:r,pyramidsInfo:h,hasGCSSShiftTransform:p}},t.getSourceScale=function(e,t){const{pixelSize:i,extent:r}=e;return A(T(i,t,r),t)},t.getWorldWidth=B,t.getWorldWrapCount=G,t.load=async function(){return _||(_=s.createResolver(),v=await new Promise(((t,i)=>e(["../../../geometry/operators/projectOperator"],t,i))),b=await new Promise(((t,i)=>e(["../../../geometry/operators/support/geographicTransformationUtils"],t,i))),v.isLoaded()||await v.load(),b.isLoaded()||await b.load(),S=!0,_.resolve()),_.promise},t.minimumGridSpacing=4,t.projectDatasetExtent=W,t.projectDatasetResolution=T,t.projectExtent=O,t.projectPoint=R,t.projectPolygon=function(e,t,i){if("extent"===e.type){const{xmin:t,ymin:i,xmax:r,ymax:s,spatialReference:n}=e;e=new c({rings:[[[t,s],[r,s],[r,i],[t,i],[t,s]]],spatialReference:n})}return e.spatialReference.equals(t)?e:(f(),v.execute(e,t,{geographicTransformation:i}))},t.projectResolution=function(e,t,i,r){const s=e.spatialReference;if(!s||!t||s.equals(t))return e;f();const n=i.center,o=new a({xmin:n.x-e.x/2,xmax:n.x+e.x/2,ymin:n.y-e.y/2,ymax:n.y+e.y/2,spatialReference:s}),l=v.execute(o,t,{geographicTransformation:r}),c=B(t);return null==l||null!=c&&l.width>=c?P(e,s,t):{x:l.width,y:l.height}},t.shiftExtent=function(e){const{spatialReference:t}=e,i=p.getInfo(t);if(!i)return e;const[r,s]=i.valid,n=s-r;let o=0;if(e.xmin<r){const t=r-e.xmin;o=Math.ceil(t/n)}else if(e.xmin>s){const t=e.xmin-s;o=-Math.ceil(t/n)}return new a({spatialReference:e.spatialReference,xmin:e.xmin+o*n,ymin:e.ymin,xmax:e.xmax+o*n,ymax:e.ymax})},t.snapExtent=H,t.snapPyramid=function(e,t,i){const{storageInfo:r,pixelSize:s}=t;let a=0,o=!1;const{pyramidResolutions:c}=r,u="mixed"===r.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,r.tileInfo.dpi/96)):1,h=(e.x+e.y)/2/u;if(null!=c&&c.length){const e=c[c.length-1],r=(e.x+e.y)/2,u=(s.x+s.y)/2;if(h<=u)a=0;else if(h>=r)a=c.length,o=h/r>8;else{let e,t=u;for(let r=1;r<=c.length;r++){if(e=(c[r-1].x+c[r-1].y)/2,h<=e){h===e?a=r:"down"===i?(a=r-1,o=h/t>8):a="up"===i||h-t>e-h||h/t>2?r:r-1;break}t=e}}const p=0===a?s:c[a-1];return o&&Math.min(p.x,p.y)*n.getMetersPerUnitForSR(t.spatialReference)>19567&&(o=!1),{pyramidLevel:a,pyramidResolution:new l({x:p.x,y:p.y,spatialReference:t.spatialReference}),excessiveReading:o}}const p=Math.log(e.x/s.x)/Math.LN2,d=Math.log(e.y/s.y)/Math.LN2,f=t.storageInfo.maximumPyramidLevel||0;a="down"===i?Math.floor(Math.min(p,d)):"up"===i?Math.ceil(Math.max(p,d)):Math.round((p+d)/2),a<0?a=0:a>f&&(o=a>f+3,a=f);const m=2**a;return{pyramidLevel:a,pyramidResolution:new l({x:m*t.nativePixelSize.x,y:m*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../PixelBlock","./pixelUtils"],(function(e,t,i,r){"use strict";const s=new Map;s.set("meter-per-second",1),s.set("kilometer-per-hour",.277778),s.set("knots",.514444),s.set("feet-per-second",.3048),s.set("mile-per-hour",.44704);const n=180/Math.PI,a=new t.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function o(e,t){return s.get(e)/s.get(t)||1}function l(e){return(450-e)%360}function c(e,t="geographic"){const[i,r]=e,s=Math.sqrt(i*i+r*r);let a=Math.atan2(r,i)*n;return a=(360+a)%360,"geographic"===t&&(a=l(a)),[s,a]}function u(e,t="geographic"){let i=e[1];"geographic"===t&&(i=l(i)),i%=360;const r=e[0];return[r*Math.cos(i/n),r*Math.sin(i/n)]}function h(e,t,s="geographic",n=1){if(!r.isValidPixelBlock(e))return e;const{pixels:a,width:o,height:l}=e,h=o*l,p=a[0],d=a[1],f=e.pixelType.startsWith("f")?e.pixelType:"f32",m=i.createEmptyBand(f,h),g=i.createEmptyBand(f,h);let y=0;for(let e=0;e<l;e++)for(let e=0;e<o;e++)"vector-uv"===t?([m[y],g[y]]=c([p[y],d[y]],s),m[y]*=n):([m[y],g[y]]=u([p[y],d[y]],s),m[y]*=n,g[y]*=n),y++;const x=new i({pixelType:f,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[m,g]});return x.updateStatistics(),x}const p=d(0,0,0);function d(e=0,t=0,i=Math.PI,r=!0){r&&(i=(2*Math.PI-i)%(2*Math.PI));const s=r?-1:1,n=13*s,a=-7*s,o=-2*s,l=-16*s,c=21.75,[u,h]=m(0,t+n,i,c),[p,d]=m(e-5.5,t+a,i,c),[f,g]=m(e+5.5,t+a,i,c),[y,x]=m(e-1.5,t+o,i,c),[w,_]=m(e+1.5,t+o,i,c),[v,b]=m(e-1.5,t+l,i,c),[S,M]=m(e+1.5,t+l,i,c);return[u,h,p,d,y,x,w,_,f,g,v,b,S,M]}function f(e=0,t=Math.PI,i=!0){i&&(t=(2*Math.PI-t)%(2*Math.PI));const r=i?-1:1,s=5*r,n=20*r,a=25*r,o=45,l=2*r,c=i?1:-1,u=5*c;let[h,p]=[0+u,0-n],[d,f]=[h+2*c,p],[g,y]=[d-0*c,f+l],[x,w]=[0-u,0-a],[_,v]=[x+0*c,w-l],b=Math.ceil(e/5),S=Math.floor(b/10);b-=8*S;const M=[],P=[];for(let e=0;e<b/2;e++,S--){S<=0&&b%2==1&&e===(b-1)/2&&(x=0,_=x+0*c,w=(w+p)/2,v=w-l);const[i,r]=m(x,w,t,o);if(S>0){const[e,s]=m(d,w,t,o),[n,a]=m(h,p,t,o);M.push(e),M.push(s),M.push(i),M.push(r),M.push(n),M.push(a)}else{const[e,s]=m(d,f,t,o),[n,a]=m(g,y,t,o),[l,c]=m(_,v,t,o);P.push(i),P.push(r),P.push(l),P.push(c),P.push(n),P.push(a),P.push(e),P.push(s)}w+=s,p+=s,f+=s,y+=s,v+=s}const[T,A]=m(0+u,0+n,t,o),k=7*c,[R,D]=m(0+k,0+n,t,o),[E,U]=m(0+u,0-a,t,o),[V,F]=m(0+k,0-a,t,o);return{pennants:M,barbs:P,shaft:[T,A,R,D,E,U,V,F]}}function m(e,t,i,r=1){const s=Math.sqrt(e*e+t*t)/r,n=(2*Math.PI+Math.atan2(t,e))%(2*Math.PI);return[s,(2*Math.PI+n-i)%(2*Math.PI)]}const g=[0,1,3,6,10,16,21,27,33,40,47,55,63],y=[0,.5,1,1.5,2],x=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function w(e,t,i,r){const s=o(r||"knots",i);let n;for(n=1;n<t.length;n++)if(n===t.length-1){if(e<t[n]*s)break}else if(e<=t[n]*s)break;return Math.min(n-1,t.length-2)}function _(e,t,i,r,s){let n=0;switch(t){case"beaufort_kn":n=w(e,g,"knots",i);break;case"beaufort_km":n=w(e,g,"kilometer-per-hour",i);break;case"beaufort_ft":n=w(e,g,"feet-per-second",i);break;case"beaufort_m":n=w(e,g,"meter-per-second",i);break;case"classified_arrow":n=w(e,s??[],r,i);break;case"ocean_current_m":n=w(e,y,"meter-per-second",i);break;case"ocean_current_kn":n=w(e,x,"knots",i)}return n}const v=[];function b(e,t){let i=0,r=0;const{width:s,height:n,mask:l}=e,c=e.pixels[0],u=[],h=[],p=o(a.fromJSON(t.inputUnit),"knots"),d="wind_speed"===t.style?5:Number.MAX_VALUE;for(let e=0;e<n;e++)for(let t=0;t<s;t++){const a=c[e*s+t]*p;if((!l||l[e*s+t])&&a<d){for(let r=0;r<4;r++)u[i++]=(t+.5)/s,u[i++]=(e+.5)/n,u[i++]=r<2?-.5:.5,u[i++]=r%2==0?-.5:.5,u[i++]=0,u[i++]=a;const o=4*(i/24-1);h[r++]=o,h[r++]=o+1,h[r++]=o+2,h[r++]=o+1,h[r++]=o+2,h[r++]=o+3}}return{vertexData:new Float32Array(u),indexData:new Uint32Array(h)}}e.convertToLocalDirections=function(e,t,i,s="geographic"){if(!r.isValidPixelBlock(e)||null==i)return e;const n="vector-magdir"===t?e.clone():h(e,t),a=n.pixels[1];for(let e=0;e<a.length;e++)a[e]="geographic"===s?(a[e]+i[e]+270)%360:(a[e]+360-i[e])%360;return"vector-magdir"===t?n:h(n,"vector-magdir")},e.convertVectorFieldData=h,e.convertVectorFieldUnit=function(e,t,i=1){if(1===i||!r.isValidPixelBlock(e))return e;const s=e.clone(),{pixels:n,width:a,height:o}=s,l=n[0],c=n[1];let u=0;for(let e=0;e<o;e++)for(let e=0;e<a;e++)"vector-uv"===t?(l[u]*=i,c[u]*=i):l[u]*=i,u++;return s.updateStatistics(),s},e.createVFMesh=function(e,t){return"simple_scalar"===t.style?b(e,t):"wind_speed"===t.style?function(e,t){if(0===v.length)for(let e=0;e<30;e++)v.push(f(5*e,0,!t.invertDirection));const i=o(a.fromJSON(t.inputUnit),"knots"),{width:r,height:s,mask:n}=e,l=e.pixels[0],c=e.pixels[1],u=[],h=[];let p=0,d=0;for(let e=0;e<s;e++)for(let t=0;t<r;t++){const a=e*r+t,o=l[a]*i;if((!n||n[e*r+t])&&o>=5){const i=(c[a]+360)%360/180*Math.PI,{pennants:n,barbs:l,shaft:f}=v[Math.min(Math.floor(o/5),29)];if(n.length+l.length===0)continue;let m=u.length/6;const g=(t+.5)/r,y=(e+.5)/s;for(let e=0;e<n.length;e+=2)u[p++]=g,u[p++]=y,u[p++]=n[e],u[p++]=n[e+1]+i,u[p++]=0,u[p++]=o;for(let e=0;e<l.length;e+=2)u[p++]=g,u[p++]=y,u[p++]=l[e],u[p++]=l[e+1]+i,u[p++]=0,u[p++]=o;for(let e=0;e<f.length;e+=2)u[p++]=g,u[p++]=y,u[p++]=f[e],u[p++]=f[e+1]+i,u[p++]=0,u[p++]=o;for(let e=0;e<n.length/6;e++)h[d++]=m,h[d++]=m+1,h[d++]=m+2,m+=3;for(let e=0;e<l.length/8;e++)h[d++]=m,h[d++]=m+1,h[d++]=m+2,h[d++]=m+1,h[d++]=m+2,h[d++]=m+3,m+=4;h[d++]=m+0,h[d++]=m+1,h[d++]=m+2,h[d++]=m+1,h[d++]=m+3,h[d++]=m+2,m+=4}}return{vertexData:new Float32Array(u),indexData:new Uint32Array(h)}}(e,t):function(e,t){const{style:i,inputUnit:r,outputUnit:s,breakValues:n}=t,o=a.fromJSON(r),l=a.fromJSON(s);let c=0,u=0;const{width:h,height:f,mask:m}=e,g=e.pixels[0],y=e.pixels[1],x=null!=m?m.filter((e=>e>0)).length:h*f,w=new Float32Array(42*x),v=new Uint32Array(15*x),b=t.invertDirection?d(0,0,0,!1):p;for(let e=0;e<f;e++)for(let t=0;t<h;t++){const r=e*h+t;if(!m||m[e*h+t]){const s=(y[r]+360)%360/180*Math.PI,a=_(g[r],i,o,l,n);for(let i=0;i<b.length;i+=2)w[c++]=(t+.5)/h,w[c++]=(e+.5)/f,w[c++]=b[i],w[c++]=b[i+1]+s,w[c++]=a,w[c++]=g[r];const p=7*(c/42-1);v[u++]=p,v[u++]=p+1,v[u++]=p+2,v[u++]=p+0,v[u++]=p+4,v[u++]=p+3,v[u++]=p+0,v[u++]=p+2,v[u++]=p+3,v[u++]=p+2,v[u++]=p+5,v[u++]=p+3,v[u++]=p+5,v[u++]=p+6,v[u++]=p+3}}return{vertexData:w,indexData:v}}(e,t)},e.createVFMeshScalar=b,e.getUnitConversionFactor=o,e.sampleVectorField=function(e,t,r,s=[0,0],n=.5){const{width:a,height:o,mask:l}=e,[h,p]=e.pixels,[d,f]=s,m=Math.round((a-d)/r),g=Math.round((o-f)/r),y=m*g,x=new Float32Array(y),w=new Float32Array(y),_=new Uint8Array(y),v="vector-uv"===t;for(let e=0;e<g;e++)for(let t=0;t<m;t++){let i=0;const s=e*m+t,g=Math.max(0,e*r+f),y=Math.max(0,t*r+d),b=Math.min(o,g+r),S=Math.min(a,y+r);for(let e=g;e<b;e++)for(let t=y;t<S;t++){const r=e*a+t;if(!l||l[r]){i++;const e=v?[h[r],p[r]]:[h[r],(360+p[r])%360],[t,n]=v?e:u(e);x[s]+=t,w[s]+=n}}if(i>=(b-g)*(S-y)*(1-n)){_[s]=1;const[e,t]=c([x[s]/i,w[s]/i]);x[s]=e,w[s]=t}else _[s]=0,x[s]=0,w[s]=0}const b=new i({width:m,height:g,pixels:[x,w],mask:_});return b.updateStatistics(),b},e.snapImageToSymbolTile=function(e,t,i,r,s){if(null==s||!s.spatialReference.equals(e.spatialReference))return{extent:e,width:Math.round(t/r),height:Math.round(i/r),resolution:e.width/t};const n=s.xmin,a=s.ymax,o=(e.xmax-e.xmin)/t*r,l=(e.ymax-e.ymin)/i*r,c=(o+l)/2;return e.xmin=n+Math.floor((e.xmin-n)/o)*o,e.xmax=n+Math.ceil((e.xmax-n)/o)*o,e.ymin=a+Math.floor((e.ymin-a)/l)*l,e.ymax=a+Math.ceil((e.ymax-a)/l)*l,{extent:e,width:Math.round(e.width/o),height:Math.round(e.height/l),resolution:c}},e.unitKebabDict=a,e.uvComponentToVector=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/imagery/RasterVFContainer":function(){define(["exports","./BrushVectorField","../webgl/enums","../webgl/WGLContainer"],(function(e,t,i,r){"use strict";e.RasterVFContainer=class extends r{constructor(){super(...arguments),this.symbolTypes=["triangle"]}prepareRenderPasses(e){const r=e.registerRenderPass({name:"imagery (vf)",brushes:[t],target:()=>this.children,drawPhase:i.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(e),r]}doRender(e){this.visible&&e.drawPhase===i.WGLDrawPhase.MAP&&this.symbolTypes.forEach((t=>{e.renderPass=t,super.doRender(e)}))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../webgl/brushes/WGLBrush","../../../webgl/enums"],(function(e,t){"use strict";const i=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),r=new Float32Array([0,92/255,230/255,1]),s={beaufort_ft:i,beaufort_m:i,beaufort_km:i,beaufort_mi:i,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:r,single_arrow:r,wind_speed:new Float32Array([0,0,0,1])},n=[0,20];return class extends e{constructor(){super(...arguments),this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:e}){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(t.BlendFactor.ONE,t.BlendFactor.ONE_MINUS_SRC_ALPHA,t.BlendFactor.ONE,t.BlendFactor.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0),e.setStencilOp(t.StencilOperation.KEEP,t.StencilOperation.KEEP,t.StencilOperation.REPLACE)}draw(e,i){if(null==i.source||0===i.source.validPixelCount)return;const{context:r,timeline:s}=e;if(s.begin(this.name),r.setStencilFunction(t.CompareFunction.EQUAL,i.stencilRef,255),i.updateVectorFieldVAO(e),"scalar"===e.renderPass){const t=i.vaoData.scalar;t&&this._drawScalars(e,i,t.vao,t.elementCount)}else{const t=i.vaoData.magdir;t&&this._drawTriangles(e,i,t.vao,t.elementCount)}s.end(this.name)}_drawTriangles(e,i,r,a){const{context:o,painter:l,requestRender:c,allowDelayedRender:u}=e,{symbolizerParameters:h}=i,p=h.dataRange?["dataRange"]:[];"geographic"===h.rotationType&&p.push("rotationGeographic");const d=l.materialManager.getProgram(this._desc.magdir,p);if(u&&null!=c&&!d.compiled)return void c();o.useProgram(d);const{coordScale:f,opacity:m,transforms:g}=i;d.setUniform2fv("u_coordScale",f),d.setUniform1f("u_opacity",m),d.setUniformMatrix3fv("u_dvsMat3",g.displayViewScreenMat3);const{style:y,dataRange:x,rotation:w,symbolPercentRange:_}=h;d.setUniform4fv("u_colors",s[y]),d.setUniform2fv("u_dataRange",x||n),d.setUniform1f("u_rotation",w),d.setUniform2fv("u_symbolPercentRange",_);const v=this._getSymbolSize(e,i);d.setUniform2fv("u_symbolSize",v),o.bindVAO(r),o.drawElements(t.PrimitiveType.TRIANGLES,a,t.DataType.UNSIGNED_INT,0)}_drawScalars(e,i,r,s){const{context:a,painter:o,requestRender:l,allowDelayedRender:c}=e,{symbolizerParameters:u}=i,h=[];"wind_speed"===u.style?h.push("innerCircle"):u.dataRange&&h.push("dataRange"),"geographic"===u.rotationType&&h.push("rotationGeographic");const p=o.materialManager.getProgram(this._desc.scalar,h);if(c&&null!=l&&!p.compiled)return void l();a.useProgram(p);const{coordScale:d,opacity:f,transforms:m}=i;p.setUniform2fv("u_coordScale",d),p.setUniform1f("u_opacity",f),p.setUniformMatrix3fv("u_dvsMat3",m.displayViewScreenMat3);const{dataRange:g,symbolPercentRange:y}=u;p.setUniform2fv("u_dataRange",g||n),p.setUniform2fv("u_symbolPercentRange",y);const x=this._getSymbolSize(e,i);p.setUniform2fv("u_symbolSize",x),a.bindVAO(r),a.drawElements(t.PrimitiveType.TRIANGLES,s,t.DataType.UNSIGNED_INT,0)}_getSymbolSize(e,t){const i=t.key?2**(e.displayLevel-t.key.level):t.resolution/e.state.resolution,{symbolTileSize:r}=t.symbolizerParameters;return[r/(Math.round((t.width-t.offset[0])/r)*r)/i,r/(Math.round((t.height-t.offset[1])/r)*r)/i]}}}))},"esri/views/2d/layers/imagery/ImageryVFStrategy":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Logger","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Extent","../../engine/imagery/RasterVFDisplayObject"],(function(e,t,i,r,s,n,a,o,l,c,u){"use strict";return e.default=class extends i{constructor(e){super(e),this._loading=null,this.update=s.debounce(((e,t)=>this._update(e,t).catch((e=>{s.isAbortError(e)||r.getLogger(this).error(e)}))))}get updating(){return!!this._loading}redraw(e){if(!this.container.children.length)return;const t=this.container.children[0];t.symbolizerParameters=e,t.invalidateVAO(),this.container.symbolTypes="wind_speed"===e.style?["scalar","triangle"]:"simple_scalar"===e.style?["scalar"]:["triangle"],this.container.requestRender()}async _update(e,t,i){if(!e.stationary)return;const{extent:r,spatialReference:s}=e.state,n=new c({xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax,spatialReference:s}),[a,o]=e.state.size;this._loading=this.fetchPixels(n,a,o,i);const l=await this._loading;this._addToDisplay(l,t,e.state),this._loading=null}_addToDisplay(e,t,i){if(null==e.pixelBlock)return this.container.children.forEach((e=>e.destroy())),void this.container.removeAllChildren();const{extent:r,pixelBlock:s}=e,n=new u.RasterVFDisplayObject(s);n.offset=[0,0],n.symbolizerParameters=t,n.rawPixelData=e,n.invalidateVAO(),n.x=r.xmin,n.y=r.ymax,n.pixelRatio=i.pixelRatio,n.rotation=i.rotation,n.resolution=i.resolution,n.width=s.width*t.symbolTileSize,n.height=s.height*t.symbolTileSize,this.container.children.forEach((e=>e.destroy())),this.container.removeAllChildren(),this.container.symbolTypes="wind_speed"===t.style?["scalar","triangle"]:"simple_scalar"===t.style?["scalar"]:["triangle"],this.container.addChild(n)}},t.__decorate([n.property()],e.default.prototype,"fetchPixels",void 0),t.__decorate([n.property()],e.default.prototype,"container",void 0),t.__decorate([n.property()],e.default.prototype,"_loading",void 0),t.__decorate([n.property()],e.default.prototype,"updating",null),e.default=t.__decorate([l.subclass("esri.views.2d.layers.imagery.ImageryVFStrategy")],e.default),e.default}))},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define(["exports","../../../../core/has","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../core/libs/gl-matrix-2/factories/vec2f32","../../../../layers/support/rasterFunctions/vectorFieldUtils","../DisplayObject","../webgl/Utils","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject"],(function(e,t,i,r,s,n,a,o,l,c,u){"use strict";class h extends a.DisplayObject{constructor(e=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.key=null,this.offset=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.vaoData=null,this.width=null,this.source=e}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}get source(){return this._source}set source(e){this._source=e,this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,null!=this.source&&null==this.vaoData){const{style:t}=this.symbolizerParameters;switch(t){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const t=n.createVFMesh(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:i}}break;case"simple_scalar":{const t=n.createVFMeshScalar(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={scalar:i}}break;case"wind_speed":{const t=n.createVFMesh(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t),r=n.createVFMeshScalar(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(e.context,r);this.vaoData={magdir:i,scalar:s}}}}this.ready(),this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:r.create()}}setTransform(e){const t=i.identity(this.transforms.displayViewScreenMat3),[r,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),a=this.resolution/this.pixelRatio/e.resolution,o=a*this.width,l=a*this.height,c=Math.PI*this.rotation/180;i.translate(t,t,s.fromValues(r,n)),i.translate(t,t,s.fromValues(o/2,l/2)),i.rotate(t,t,-c),i.translate(t,t,s.fromValues(-o/2,-l/2)),i.scaleByVec2(t,t,s.fromValues(o,l)),i.multiply(this.transforms.displayViewScreenMat3,e.displayViewMat3,t)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(e,t){const{vertexData:i,indexData:r}=t,s=l.BufferObject.createVertex(e,c.Usage.STATIC_DRAW,new Float32Array(i)),n=l.BufferObject.createIndex(e,c.Usage.STATIC_DRAW,new Uint32Array(r)),a=o.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:c.DataType.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:c.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:c.DataType.FLOAT,normalized:!1}]});return{vao:new u.VertexArrayObject(e,a.attributes,a.bufferLayouts,new Map([["geometry",s]]),n),elementCount:r.length}}}e.RasterVFDisplayObject=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/ImageryLayerView":function(){define(["../../chunks/tslib.es6","../../core/Error","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/Point","../../layers/support/timeSupport","../../layers/support/rasterFunctions/rasterProjectionHelper","../../rest/support/Query","./support/popupUtils"],(function(e,t,i,r,s,n,a,o,l,c,u,h,p){"use strict";return s=>{let n=class extends s{constructor(){super(...arguments),this.view=null}get timeExtent(){return c.combineTimeExtent(this.layer,this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(e,r){const{layer:s}=this;if(!e)throw new t("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:s});const{popupEnabled:n}=s,a=p.getFetchPopupTemplate(s,r);if(!n||null==a)return[];const o=await a.getRequiredFields();i.throwIfAborted(r);const c=new h;c.timeExtent=this.timeExtent,c.geometry=e,c.outFields=o,c.outSpatialReference=e.spatialReference;const{resolution:u,spatialReference:d}=this.view,f="2d"===this.view.type?new l(u,u,d):new l(.5*u,.5*u,d),{returnTopmostRaster:m,showNoDataRecords:g}=a.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},y={returnDomainValues:!0,returnTopmostRaster:m,pixelSize:f,showNoDataRecords:g,signal:r?.signal};return s.queryVisibleRasters(c,y).then((e=>e))}async getSourceScale(){return await u.load(),await this.layer.load(),u.getSourceScale(this.layer.serviceRasterInfo,this.view.spatialReference)}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return e.__decorate([r.property()],n.prototype,"layer",void 0),e.__decorate([r.property()],n.prototype,"suspended",void 0),e.__decorate([r.property({readOnly:!0})],n.prototype,"timeExtent",null),e.__decorate([r.property()],n.prototype,"view",void 0),n=e.__decorate([o.subclass("esri.views.layers.ImageryLayerView")],n),n}}))},"esri/layers/support/timeSupport":function(){define(["exports","../../support/timeUtils"],(function(e,t){"use strict";e.combineTimeExtent=function(e,i,r){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:s=!1,timeOffset:n,useViewTime:a}=e;let o=e.timeExtent;s&&(o=t.toLocalTimeExtent(o));let l=a?i&&o?i.intersection(o):i||o:o;return!l||l.isEmpty||l.isAllTime?l:(n&&(l=l.offset(-n.value,n.unit)),s&&(l=t.toUTCTimeExtent(l)),l.equals(r)?r:l)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/timeUtils":function(){define(["exports","../core/arrayUtils","../core/lang","../core/timeUtils","../chunks/TimeExtent","../webmap/utils","../webscene/utils"],(function(e,t,i,r,s,n,a){"use strict";function o(e){return void 0!==e.timeInfo}async function l(e,i){if(0===e.length)return s.TimeExtent.allTime;await Promise.all(e.map((e=>e.load({signal:i}))));const r=e.filter(o),n=e.filter((e=>!o(e)&&null!=e.visibilityTimeExtent));if(0===r.length&&0===n.length)return s.TimeExtent.allTime;const a=[],l=[];for(const e of r)"feature"!==e?.type&&"map-image"!==e?.type||!e.timeInfo?.hasLiveData?l.push(e):a.push(e);const c=e=>null==e||e.isAllTime,u=[...l.map((e=>{const t=e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=e;return t?.intersection(i)??i})),...n.map((e=>e.visibilityTimeExtent))];if(u.some(c))return s.TimeExtent.allTime;const h=a.map((async e=>{const t=(await e.fetchRecomputedExtents({signal:i}))?.timeExtent??e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:r}=e;return t?.intersection(r)??r})),p=(await Promise.allSettled(h)).map((e=>"fulfilled"===e.status?e.value:null));if(p.some(c))return s.TimeExtent.allTime;const d=[...p,...u].filter(t.isSome);return 0===d.length?s.TimeExtent.allTime:d.reduce(((e,t)=>e.union(t)))}e.getTimeExtentFromLayers=l,e.getTimeSliderSettingsFromWebDocument=async function(e,t){if(!n.isWebMap(e)&&!a.isWebScene(e))return null;await e.load({signal:t});const r=e?.widgets?.timeSlider;if(!r)return null;const o=await async function(e,t){return e.widgets?.timeSlider?.fullTimeExtent??l(e.allLayers,t)}(e,t),c=r.loop,u=function(e){const t=e.numThumbs??2,i=e.currentTimeExtent;if(i){const{start:e,end:r}=i;return null!=e&&null!=r&&e.getTime()===r.getTime()?"instant":2===t?"time-window":null==e||0===e.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===t?"time-window":"cumulative-from-start"}(r),h=r.stopDelay??2e3,p=function(e){const{numStops:t,stopInterval:r,stops:s}=e;return s?{dates:i.clone(s)}:r?{interval:r.clone()}:{count:t??5}}(r),d=function(e,t){const i=e.currentTimeExtent;if(!i)return null;const{start:r,end:n}=i,a=r??n??null;switch(t){case"time-window":return new s.TimeExtent({start:r,end:n});case"cumulative-from-start":return new s.TimeExtent({start:null,end:a});case"cumulative-from-end":return new s.TimeExtent({start:a,end:null});case"instant":return new s.TimeExtent({start:a,end:a})}}(r,u);return{fullTimeExtent:o,loop:c,mode:u,playRate:h,stops:p,timeExtent:d}},e.toLocalTimeExtent=function(e){if(!e)return e;const{start:t,end:i}=e;return new s.TimeExtent({start:null!=t?r.offsetDate(t,t.getTimezoneOffset(),"minutes"):t,end:null!=i?r.offsetDate(i,i.getTimezoneOffset(),"minutes"):i})},e.toUTCTimeExtent=function(e){if(!e)return e;const{start:t,end:i}=e;return new s.TimeExtent({start:null!=t?r.offsetDate(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=i?r.offsetDate(i,-i.getTimezoneOffset(),"minutes"):i})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/utils":function(){define(["exports","../support/tagSymbols"],(function(e,t){"use strict";e.isWebScene=function(e){return null!=e&&"object"==typeof e&&t.WebSceneTag in e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/tagSymbols":function(){define(["exports"],(function(e){"use strict";const t=Symbol("WebScene");e.WebSceneTag=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],(function(e,t){"use strict";function i(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}e.getFetchPopupTemplate=i,e.getRequiredFields=async function(e,i=e.popupTemplate){if(null==i)return[];const r=await i.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:s}=i,{objectIdField:n,typeIdField:a,globalIdField:o,relationships:l}=e;if(r.includes("*"))return["*"];const c=s?t.getFeatureEditFields(e):[],u=t.fixFields(e.fieldsIndex,[...r,...c]);return a&&u.push(a),u&&n&&e.fieldsIndex?.has(n)&&!u.includes(n)&&u.push(n),u&&o&&e.fieldsIndex?.has(o)&&!u.includes(o)&&u.push(o),l&&l.forEach((t=>{const{keyField:i}=t;u&&i&&e.fieldsIndex?.has(i)&&!u.includes(i)&&u.push(i)})),u},e.hasPopupTemplate=function(e,t){return null!=i(e,{defaultPopupTemplateEnabled:t})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/RefreshableLayerView":function(){define(["../../chunks/tslib.es6","../../core/Logger","../../core/promiseUtils","../../core/reactiveUtils","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/subclass"],(function(e,t,i,r,s,n,a,o){"use strict";return s=>{let n=class extends s{initialize(){this.addHandles(r.on((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{i.isAbortError(e)||t.getLogger(this).error(e)}))})),"RefreshableLayerView")}};return n=e.__decorate([o.subclass("esri.views.layers.RefreshableLayerView")],n),n}}))},"*noref":1}}),define(["../../../chunks/tslib.es6","../../../Graphic","../../../core/arrayUtils","../../../core/Collection","../../../core/handleUtils","../../../core/has","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../../../support/GraphicsCollection","../engine/flow/FlowView2D","./LayerView2D","./graphics/GraphicsView2D","./graphics/HighlightGraphicContainer","./imagery/ImageryView2D","./imagery/VectorFieldView2D","../../layers/ImageryLayerView","../../layers/LayerView","../../layers/RefreshableLayerView","../../support/HighlightDefaults"],(function(e,t,i,r,s,n,a,o,l,c,u,h,p,d,f,m,g,y,x,w,_){"use strict";let v=class extends(y(w(p.LayerView2DMixin(x)))){constructor(){super(...arguments),this._exportImageVersion=-1,this._highlightGraphics=new u.GraphicsCollection,this._highlightView=void 0,this.layer=null,this.subview=null}get pixelData(){const{subview:e}=this;return this.updating||!e?null:"getPixelData"in e?e.getPixelData():null}update(e){this.subview?.update(e)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.view&&(this._highlightView=new d({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new f(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container)),this.addAttachHandles([a.watch((()=>this.layer.exportImageServiceParameters.version),(e=>{e&&this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())}),a.sync),a.watch((()=>this.timeExtent),(e=>{const{subview:t}=this;t&&(t.timeExtent=e,"redraw"in t?this.requestUpdate():t.redrawOrRefetch())}),a.sync),this.layer.on("redraw",(()=>{const{subview:e}=this;e&&("redraw"in e?e.redraw():e.redrawOrRefetch())})),a.watch((()=>this.layer.renderer),(()=>this._setSubView()))])}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.container.removeAllChildren(),this._detachSubview(this.subview),this.subview?.destroy(),this.subview=null,this._highlightView?.destroy(),this._exportImageVersion=-1}viewChange(){}moveEnd(){this.requestUpdate()}highlight(e,n){if(!((Array.isArray(e)?e[0]:r.isCollection(e)?e.at(0):e)instanceof t))return s.makeHandle();let a=[];Array.isArray(e)||r.isCollection(e)?a=e.map((e=>e.clone())):e instanceof t&&(a=[e.clone()]);const o=a?.filter(i.isSome);if(!o?.length)return s.makeHandle();const l=n?.name??_.defaultHighlightName;return this._addHighlightGraphics(a,l),s.makeHandle((()=>!this.destroyed&&this._removeHighlightGraphics(a,l)))}_addHighlightGraphics(e,t){this._highlightGraphics.addMany(e),this._addHighlights(e.map((e=>e.uid)),t)}_removeHighlightGraphics(e,t){this._highlightGraphics.removeMany(e),this._removeHighlights(e.map((e=>e.uid)),t)}async doRefresh(){this.requestUpdate()}isUpdating(){const e=!this.subview||this.subview.updating||!!this._highlightView?.updating;return n("esri-2d-log-updating")&&console.log(`Updating ImageryLayerView2D (${this.layer.id}): ${e}\n-> subview ${!this.subview||this.subview.updating}\n-> higlightView ${this._highlightView?.updating}\n`),e}_processHighlight(){const e=this._getHighlights();this._highlightView?.setHighlight(e)}_setSubView(){if(!this.view)return;const e=this.layer.renderer?.type;let t="imagery";if("vector-field"===e?t="imageryVF":"flow"===e&&(t="flow"),this.subview){const{type:e}=this.subview;if(e===t)return this._attachSubview(this.subview),void("flow"===e?this.subview.redrawOrRefetch():"imagery"===e&&"lerc"===this.layer.format?this.subview.redraw():this.requestUpdate());this._detachSubview(this.subview),this.subview?.destroy()}this.subview="imagery"===t?new m({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===t?new g({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new h({layer:this.layer,layerView:this}),this._attachSubview(this.subview),this.requestUpdate()}_attachSubview(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0))}_detachSubview(e){e?.attached&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}};return e.__decorate([o.property()],v.prototype,"pixelData",null),e.__decorate([o.property()],v.prototype,"subview",void 0),v=e.__decorate([c.subclass("esri.views.2d.layers.ImageryLayerView2D")],v),v}));