// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/rasterDatasets/multidimensionalUtils":function(){define(["exports","../../../core/arrayUtils","../DimensionalDefinition"],(function(e,t,r){"use strict";function s(e,t,r){const i=t.shift();if(0===r.length){const e=[];r.push({sliceId:-1,multidimensionalDefinition:e})}const n=r.length;for(let t=0;t<n;t++){const t=r.shift().multidimensionalDefinition;i.values?.forEach((s=>{r.push({sliceId:-1,multidimensionalDefinition:[...t,{variableName:e,dimensionName:i.name,values:[s]}]})}))}t.length&&s(e,t,r)}function i(e,t){return Array.isArray(e)?t[0]===t[1]?e[0]===t[0]||e[1]===t[0]:e[0]>=t[0]&&e[0]<=t[1]&&e[1]>=t[0]&&e[1]<=t[1]:e>=t[0]&&e<=t[1]}function n(e,t){return e[0]<=t[0]&&e[1]>=t[0]||e[0]<=t[1]&&e[1]>=t[1]||e[0]>=t[0]&&e[1]<=t[1]}function a(e){return 1===e.length?[e[0],e[0]]:[e[0],e[e.length-1]]}function o(e,t,r){if(!t?.subsetDefinitions?.length)return e;let s;if(r){const{variables:i}=t;if(i.length&&!i.includes(r))return null;const n=t.subsetDefinitions.find((t=>t.dimensionName===e.name&&t.variableName===r));if(!n?.values?.length)return e;s=a(n.values)}else{const r=t.dimensions.find((({name:t})=>t===e.name));s=r?.extent}const n=s;if(!n?.length)return e;const o=e.values.filter((e=>i(e,n)));return{...e,extent:[...n],values:o}}function l(e,t,r){if(!t?.subsetDefinitions?.length)return!1;const{variables:s}=t;if(s.length&&e.some((({variableName:e})=>e&&!s.includes(e))))return!0;for(let s=0;s<e.length;s++){const o=e[s],l=t.subsetDefinitions.find((e=>(""===o.variableName||e.variableName===o.variableName)&&e.dimensionName===o.dimensionName));if(l?.values.length){const e=a(l.values);if(o.isSlice||2!==o.values.length||Array.isArray(o.values[0])||o.values[0]===o.values[1]||!r){if(o.values.some((t=>!i(t,e))))return!0}else if(!n(o.values,e))return!0}}return!1}function c(e,t={}){const{multidimensionalInfo:r,keyProperties:s}=e;if(null==r)return null;const{variableName:i,multidimensionalSubset:n,multidimensionalDefinition:a}=t,o=null!=a?a[0]?.variableName:null,l=i||o||s?.DefaultVariable;let{variables:c}=r;return n?.variables?.length&&(c=c.filter((({name:e})=>n.variables.includes(e)))),l?c.find((({name:e})=>e===l))??c[0]:c[0]}function u(e,t={}){const s=c(e,t);if(!s)return null;const i=[],{dimensions:n,name:a}=s;if(0===n.length)return[new r({variableName:a,dimensionName:"",values:[],isSlice:!0})];for(let e=0;e<n.length;e++){const s=o(n[e],t.multidimensionalSubset,a);if(!s)return null;const{values:l,extent:c}=s;let u=l?.[0]??c?.[0];"stdz"===s.name.toLowerCase()&&!s.hasRanges&&c&&Math.abs(c[1])<=Math.abs(c[0])&&(u=l?.length?l[l.length-1]:c[1]),i.push(new r({variableName:a,dimensionName:s.name,values:[u],isSlice:!t.useRangeForRangedDimensionInfo||!!s.hasRanges}))}return i}function h(e,t){const{values:r}=t;if(r?.length){const t=Array.isArray(r[0]),s=Array.isArray(e);return t!==s?-1:t&&s?r.findIndex((t=>t[0]===e[0]&&t[1]===e[1])):r.indexOf(e)}const{extent:s}=t;if(Array.isArray(e)||!s||e<s[0]||e>s[1])return-1;const i=t.interval||1;if("ISO8601"!==t.unit)return Math.round((e-s[0])/i);const n=s[0];let a=-1;switch(t.intervalUnit?.toLowerCase()||"days"){case"seconds":a=Math.round((e-n)/1e3/i);break;case"minutes":a=Math.round((e-n)/6e4/i);break;case"hours":a=Math.round((e-n)/36e5/i);break;case"days":a=Math.round((e-n)/864e5/i);break;case"months":{const t=new Date(e).getUTCFullYear()-new Date(n).getUTCFullYear(),r=new Date(n).getUTCMonth(),s=new Date(e).getUTCMonth();a=0===t?s-r:s+11-r+12*(t-1)}break;case"years":a=Math.round((new Date(e).getUTCFullYear()-new Date(n).getUTCFullYear())/i);break;case"decades":a=Math.round((new Date(e).getUTCFullYear()-new Date(n).getUTCFullYear())/10/i)}return a}function d(e){let t=e.values?.length;if(t)return t;const{extent:r,unit:s}=e,i=e.interval||1,n=r?r[1]-r[0]:0;if("ISO8601"!==s)return Math.round(n/i);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":t=Math.round(n/1e3/i);break;case"minutes":t=Math.round(n/6e4/i);break;case"hours":t=Math.round(n/36e5/i);break;case"days":t=Math.round(n/864e5/i);break;case"months":if(r){const e=new Date(r[1]).getUTCFullYear()-new Date(r[0]).getUTCFullYear(),s=new Date(r[0]).getUTCMonth(),i=new Date(r[1]).getUTCMonth();t=0===e?i-s+1:i+11-s+12*(e-1)+1}else t=0;break;case"years":t=r?Math.round((new Date(r[1]).getUTCFullYear()-new Date(r[0]).getUTCFullYear())/i):0;break;case"decades":t=r?Math.round((new Date(r[1]).getUTCFullYear()-new Date(r[0]).getUTCFullYear())/10/i):0;break;default:t=0}return t}function p(e,t,r,s){const i=[];let n=e;const a=new Date(e);for(;n<=t;)switch(i.push(n),s){case"decades":a.setUTCFullYear(a.getUTCFullYear()+10*r),n=a.getTime();break;case"years":a.setUTCFullYear(a.getUTCFullYear()+r),n=a.getTime();break;case"months":a.setUTCMonth(a.getUTCMonth()+r),n=a.getTime();break;case"days":n+=864e5*r;break;case"hours":n+=36e5*r;break;case"minutes":n+=6e4*r;break;case"seconds":n+=1e3*r}return 1===i.length?i[1]=t:i[i.length-1]=t,i}e.convertOleDateTimeToEpoch=function(e){return Math.round(24*(e-25569)*3600*1e3)},e.createSlices=function(e,t){const r=[];let i=0;return(t?e.variables.filter((e=>e.name.toLowerCase()===t.toLowerCase())):[...e.variables].sort(((e,t)=>e.name>t.name?1:-1))).forEach((e=>{const t=[],n=[...e.dimensions].sort(((e,t)=>e.name>t.name?-1:1));s(e.name,n,t),t.forEach((e=>{r.push({...e,sliceId:i++})}))})),r},e.getDefaultMultidimensionalDefinition=u,e.getDefaultVariableInfo=c,e.getDimensionValues=function(e){if(2!==e.extent?.length||!e.interval)return[];const{extent:[t,r],interval:s}=e;if("ISO8601"===e.unit){const i=e.intervalUnit?.toLowerCase()??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(i)?p(t,r,s,i):[]}const i=Math.round((r-t)/s);return Array.from({length:i},((e,n)=>n===i-1?r:t+n*s))},e.getEffectiveMultidimensionalDefinition=function(e){const{rasterInfo:t,multidimensionalSubset:r}=e,{multidimensionalInfo:s}=t;if(null==s)return null;let i=e.multidimensionalDefinition?.length?e.multidimensionalDefinition:u(t,{multidimensionalSubset:r});if(!i?.length)return null;if(i.some((e=>!e.dimensionName))){const{variableName:e}=i[0],s=u(t,{multidimensionalSubset:r,variableName:e});s?.forEach((e=>{const t=i?.find((({dimensionName:t})=>t===e.dimensionName));t?.values?.length&&(e.values=t.values,e.isSlice=t.isSlice)})),i=s}const{timeExtent:n}=e;if(null!=i&&null!=n&&(null!=n.start||null!=n.end)){i=i.map((e=>e.clone()));const e=s.variables.find((({name:e})=>e===i[0].variableName))?.dimensions?.find((({name:e})=>"StdTime"===e)),t=i.find((({dimensionName:e})=>"StdTime"===e));if(!e||!t)return null;const{start:r,end:a}=n,o=null==r?null:r.getTime(),l=null==a?null:a.getTime(),c=o??l,u=l??o;if(null!=e.values){const r=e.values.filter((e=>{if(Array.isArray(e)){if(c===u)return e[0]<=c&&e[1]>=c;const t=e[0]<=c&&e[1]>c||e[0]<u&&e[1]>=u,r=e[0]>=c&&e[1]<=u||e[0]<c&&e[1]>u;return t||r}return c===u?e===c:e>=c&&e<=u}));if(r.length){const e=r.sort(((e,t)=>{const r=Array.isArray(e)?e[0]:e,s=Array.isArray(e)?e[1]:e,i=Array.isArray(t)?t[0]:t,n=Array.isArray(t)?t[1]:t;return c===u?r-i:Math.abs(s-u)-Math.abs(n-u)}))[0];t.values=[e]}else i=null}else if(e.hasRegularIntervals&&e.extent){const[r,s]=e.extent;c>s||u<r?i=null:t.values=c===u?[c]:[Math.max(r,c),Math.min(s,u)]}}return null!=i&&l(i,r)?null:i},e.getSliceIds=function(e,t,r){let s=e;if(t&&(t=[...t].sort(((e,t)=>e.dimensionName<t.dimensionName?-1:1))).forEach((({dimensionName:e,values:t,isSlice:r})=>{t.length&&(s=s.filter((s=>{const i=s.multidimensionalDefinition.find((t=>t.dimensionName===e));if(null==i)return!1;const n=i.values[0];return"number"==typeof n?"number"==typeof t[0]?t.includes(n):t.some((e=>e[0]<=n&&e[1]>=n)):"number"==typeof t[0]?t.some((e=>n[0]<=e&&n[1]>=e)):r?t.some((e=>e[0]===n[0]&&e[0]===n[1])):t.some((e=>e[0]>=n[0]&&e[0]<=n[1]||e[1]>=n[0]&&e[1]<=n[1]||e[0]<n[0]&&e[1]>n[1]))})))})),s.length&&null!=r?.start&&null!=r.end){const e=r.start.getTime(),t=r.end.getTime(),i=s[0].multidimensionalDefinition.findIndex((e=>"StdTime"===e.dimensionName));i>-1&&(s=s.filter((r=>{const s=r.multidimensionalDefinition[i].values[0];return e<=s&&t>=s})))}return s.map((e=>e.sliceId))},e.getSliceIndex=function(e,t){let r=0;const s=e[0].variableName,i=[...t.variables].sort(((e,t)=>e.name>t.name?1:-1));for(let t=0;t<i.length;t++){const n=i[t],a=[...n.dimensions].sort(((e,t)=>e.name>t.name?-1:1));if(n.name!==s){r+=a.map((e=>d(e))).reduce(((e,t)=>e*t));continue}const o=a.map((e=>d(e))),l=a.length;for(let t=0;t<l;t++){const s=e.find((e=>e.dimensionName===a[t].name));if(null==s)return null;const i=h(s.values[0],a[t]);if(-1===i)return null;o.shift(),r+=t===l-1?i:i*o.reduce(((e,t)=>e*t))}break}return r},e.getSubsetVariablesFromMdInfo=function(e,r){if(null==r||null==e)return null;let s=r.variables.map((e=>({...e})));return e?.variables?.length&&(s=s.filter((({name:t})=>e.variables.includes(t))),s.forEach((r=>{r.dimensions=r.dimensions.map((t=>o(t,e,r.name))).filter(t.isSome)}))),s},e.getTimeDimensionValues=p,e.hasExcludedVariableOrDimension=l,e.intersectMultimensionalSubset=function(e,t){if(null==e)return{isOutside:!1};const{geometry:s,timeExtent:i,multidimensionalDefinition:n}=t;let a=null;if(null!=i&&(a=function(e,t){const s=e.dimensions.find((({name:e})=>"StdTime"===e));if(null==s||null==t.start&&null==t.end)return t;t=t.clone();const{start:i,end:n}=t.toJSON(),a=i===n?[i]:null!=i&&null!=n?[i,n]:[i??n];return 2===a.length&&s?.extent.length&&(a[0]=Math.max(a[0],s.extent[0]),a[1]=Math.min(a[1],s.extent[1]??s.extent[0]),a[1]<a[0])||l([new r({variableName:"",dimensionName:"StdTime",isSlice:1===a.length,values:a})],e,!0)?null:(t.start=new Date(a[0]),t.end=new Date(a[1]??a[0]),t)}(e,i),null==a))return{isOutside:!0};const{areaOfInterest:o}=e;if(o&&s){const e="point"===s.type?s:"extent"===s.type?s.center:"polygon"===s.type?s.centroid:null;if(e&&!o.contains(e))return{isOutside:!0}}return null!=n&&n.length&&l(n,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:s,timeExtent:a,multidimensionalDefinition:n}}},e.isMultiSliceOrRangeDefinition=function(e){return!!e?.length&&e.some((e=>{if(null==e.values)return!0;const t=e.values.length;return 0===t||t>1||!e.isSlice&&Array.isArray(e.values[0])}))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/DimensionalDefinition":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,s,i,n,a){"use strict";var o;return e.default=o=class extends r{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new o({variableName:this.variableName,dimensionName:this.dimensionName,values:s.clone(this.values),isSlice:this.isSlice})}},t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"variableName",void 0),t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"dimensionName",void 0),t.__decorate([i.property({type:n.types.array(n.types.oneOf([n.types.native(Number),n.types.array(n.types.native(Number))])),json:{write:!0}})],e.default.prototype,"values",void 0),t.__decorate([i.property({type:Boolean,json:{write:!0}})],e.default.prototype,"isSlice",void 0),e.default=o=t.__decorate([a.subclass("esri.layers.support.DimensionalDefinition")],e.default),e.default}))},"esri/views/2d/engine/flow/FlowView2D":function(){define(["exports","../../../../chunks/tslib.es6","../../../../Graphic","../../../../core/Accessor","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./createFlowStyle","./dataUtils","./FlowContainer","./FlowStrategy"],(function(e,t,r,s,i,n,a,o,l,c,u,h,d,p){"use strict";return e.default=class extends s{constructor(){super(...arguments),this._loadImagery=(e,t,r,s,i)=>h.loadImagery(this.layer,e,t,r,s,i),this._createFlowMesh=(e,t,r,s)=>this.layer.createFlowMesh({meshType:e,flowData:r,simulationSettings:t},{signal:s}),this.attached=!1,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const{layer:e}=this,t=()=>{this._loadImagery=(t,r,s,i,n)=>h.loadImagery(e,t,r,s,i,n),this._updateVisualization()};"multidimensionalDefinition"in e?this.addHandles(i.watch((()=>e.multidimensionalDefinition),t)):this.addHandles([i.watch((()=>e.mosaicRule),t),i.watch((()=>e.rasterFunction),t),i.watch((()=>e.definitionExpression),t)]),this.container=new d,this._strategy=new p({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container?.removeAllChildren(),this.container=null,this.removeHandles()}update(e){e.stationary?this._strategy.update(e):this.layerView.requestUpdate()}hitTest(e){return new r({attributes:{},geometry:e.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){const e=this.layer.renderer;if(null==e||"flow"!==e.type)return;const t=u(e,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=t,this.layerView.requestUpdate()}},t.__decorate([n.property()],e.default.prototype,"_strategy",void 0),t.__decorate([n.property()],e.default.prototype,"attached",void 0),t.__decorate([n.property()],e.default.prototype,"container",void 0),t.__decorate([n.property()],e.default.prototype,"layer",void 0),t.__decorate([n.property()],e.default.prototype,"layerView",void 0),t.__decorate([n.property()],e.default.prototype,"type",void 0),t.__decorate([n.property()],e.default.prototype,"updating",null),t.__decorate([n.property()],e.default.prototype,"timeExtent",void 0),e.default=t.__decorate([c.subclass("esri.views.2d.engine.flow.FlowView2D")],e.default),e.default}))},"esri/views/2d/engine/flow/createFlowStyle":function(){define(["./utils","./styles/Imagery","./styles/Particles","./styles/Stack","./styles/Streamlines"],(function(e,t,r,s,i){"use strict";return function(n,a){const{flowSpeed:o,trailLength:l}=n,c=e.getFlowSimulationSettings(n);let u=null;const h={opacity:e.getOpacity(n),size:e.getSize(n)};let d=e.getColor(n);if("none"===n.background)h.color=d;else{"constant"===d.kind&&(d={kind:"ramp",stops:[0,1],values:[0,0,0,1,d.value[0],d.value[1],d.value[2],d.value[3]],count:2});const r={loadImagery:a.loadImagery,timeExtent:a.timeExtent,color:d,opacity:{kind:"constant",value:[1]}};u=new t.Imagery(r),h.color=e.getForegroundColor()}const p={loadImagery:a.loadImagery,createFlowMesh:a.createFlowMesh,simulationSettings:c,timeExtent:a.timeExtent,trailLength:l,flowSpeed:o,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:h.color,opacity:h.opacity,size:h.size},f="butt"===n.trailCap||e.getMax(e.getSize(n))<=4?new i(p):new r.Particles(p);return null!=u?new s.Stack([u,f]):f}}))},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/screenUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32"],(function(e,t,r,s){"use strict";function i(e){return"constant"===e.kind?e.value[0]:e.values[e.values.length-1]}function n(e){const t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function a(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[t.pt2px(e.trailWidth)]};const r=e.getVisualVariablesForType("size")[0],s=[],i=[];let n;if(r.stops){for(const e of r.stops)s.push(e.value),i.push(t.pt2px(e.size));n=r.stops.length}else s.push(r.minDataValue,r.maxDataValue),i.push(t.pt2px(r.minSize),t.pt2px(r.maxSize)),n=2;return{kind:"ramp",stops:s,values:i,count:n}}function o(e,t,r,s){switch(t){case"int":e.setUniform1iv(r,s);break;case"float":e.setUniform1fv(r,s);break;case"vec2":e.setUniform2fv(r,s);break;case"vec3":e.setUniform3fv(r,s);break;case"vec4":e.setUniform4fv(r,s)}}function l(e,t){let r=!0;return r=r&&e.collisions===t.collisions,r=r&&e.density===t.density,r=r&&e.interpolate===t.interpolate,r=r&&e.lineCollisionWidth===t.lineCollisionWidth,r=r&&e.lineSpacing===t.lineSpacing,r=r&&e.maxTurnAngle===t.maxTurnAngle,r=r&&e.minSpeedThreshold===t.minSpeedThreshold,r=r&&e.segmentLength===t.segmentLength,r=r&&e.smoothing===t.smoothing,r=r&&e.velocityScale===t.velocityScale,r=r&&e.verticesPerLine===t.verticesPerLine,r}function c(e,t){return e===t||null!=e&&null!=t&&e.equals(t)}e.areStreamlinesCompatible=function(e,t){if(!l(e.simulationSettings,t.simulationSettings))return!1;if(!c(e.timeExtent,t.timeExtent))return!1;let r=!0;return r=r&&e.loadImagery===t.loadImagery,r=r&&e.createFlowMesh===t.createFlowMesh,r=r&&e.color.kind===t.color.kind,r=r&&e.opacity.kind===t.opacity.kind,r=r&&e.size.kind===t.size.kind,r},e.getColor=function(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:n(e.color)};const t=e.getVisualVariablesForType("color")[0],r=[],s=[];for(const e of t.stops)r.push(e.value),Array.prototype.push.apply(s,n(e.color));return{kind:"ramp",stops:r,values:s,count:t.stops.length}},e.getFlowSimulationSettings=function(e){const r=i(a(e)),s=r,n=Math.max(r/2,5),o=Math.round(t.pt2px(e.maxPathLength)/n)+1,{density:l}=e;return{smoothing:t.pt2px(e.smoothing),interpolate:!0,velocityScale:"flow-from"===e.flowRepresentation?1:-1,verticesPerLine:o,minSpeedThreshold:.001,segmentLength:n,maxTurnAngle:1,collisions:!0,lineCollisionWidth:s,lineSpacing:10,density:l}},e.getForegroundColor=function(e){return{kind:"constant",value:[.1,.1,.1,1]}},e.getMax=i,e.getOpacity=function(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=e.getVisualVariablesForType("opacity")[0],r=[],s=[];for(const e of t.stops)r.push(e.value),s.push(e.opacity);return{kind:"ramp",stops:r,values:s,count:t.stops.length}},e.getSingleTileVisualState=function(e,t,i){const n=s.create();return r.identity(n),r.translate(n,n,[-1,1]),r.scale(n,n,[2/t,-2/i,1]),{time:e,dvsMat3:n,displayViewMat3:n}},e.getSize=a,e.setUniform=o,e.setUniforms=function(e,t,r,s){"constant"===s.kind?o(e,r,`u_${t}`,s.value):(o(e,"float",`u_${t}_stops`,s.stops),o(e,r,`u_${t}_values`,s.values),e.setUniform1i(`u_${t}_count`,s.count))},e.simulationSettingsEqual=l,e.timeExtentsEqual=c,e.toRgba=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/flow/styles/Imagery":function(){define(["exports","../../../../../core/promiseUtils","../utils","../../../../webgl/BufferObject","../../../../webgl/enums","../../../../webgl/Texture","../../../../webgl/TextureDescriptor","../../../../webgl/VertexArrayObject","../../../../webgl/VertexElementDescriptor"],(function(e,t,r,s,i,n,a,o,l){"use strict";class c{constructor(e){this._params=e,this.animated=!1}isCompatible(e){if(!(e instanceof c))return!1;if(!r.timeExtentsEqual(this._params.timeExtent,e._params.timeExtent))return!1;let t=!0;return t=t&&this._params.loadImagery===e._params.loadImagery,t=t&&this._params.color.kind===e._params.color.kind,t=t&&this._params.opacity.kind===e._params.opacity.kind,t}async load(e,r){const{extent:s,size:i}=e;t.throwIfAborted(r);const n=await this._params.loadImagery(s,i[0],i[1],this._params.timeExtent,r);return new p(n,{color:this._params.color,opacity:this._params.opacity})}render(e,t,s){const{context:n}=e,{program:a}=s;n.setFaceCullingEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunction(i.BlendFactor.ONE,i.BlendFactor.ONE_MINUS_SRC_ALPHA),n.useProgram(a),a.setUniformMatrix3fv("u_dvsMat3",t.dvsMat3),n.bindTexture(s.texture,0),a.setUniform1i("u_texture",0),a.setUniform1f("u_Min",s.min),a.setUniform1f("u_Max",s.max),r.setUniforms(a,"color","vec4",this._params.color),r.setUniforms(a,"opacity","float",this._params.opacity),n.bindVAO(s.vertexArray),n.drawArrays(i.PrimitiveType.TRIANGLE_STRIP,0,4)}}const u=new Map;u.set("a_position",0),u.set("a_texcoord",1);const h=new Map([["geometry",[new l.VertexElementDescriptor("a_position",2,i.DataType.UNSIGNED_SHORT,0,8),new l.VertexElementDescriptor("a_texcoord",2,i.DataType.UNSIGNED_SHORT,4,8)]]]),d={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:u};class p{constructor(e,t){this._flowData=e,this._values=t}attach(e){const{context:t}=e,{width:r,height:l}=this._flowData,c=s.BufferObject.createVertex(t,i.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,r,0,1,1,0,l,0,0,r,l,1,0])),p=new Map([["geometry",c]]),f=new o.VertexArrayObject(t,u,h,p),m=[];"ramp"===this._values.color.kind&&m.push("vvColor"),"ramp"===this._values.opacity.kind&&m.push("vvOpacity");const g=e.getProgram(d,m);let y=1e6,x=-1e6;for(let e=0;e<l;e++)for(let t=0;t<r;t++)if(0!==this._flowData.mask[e*r+t]){const s=this._flowData.data[2*(e*r+t)],i=this._flowData.data[2*(e*r+t)+1],n=Math.sqrt(s*s+i*i);y=Math.min(y,n),x=Math.max(x,n)}const w=new Uint8Array(4*r*l);for(let e=0;e<l;e++)for(let t=0;t<r;t++)if(0!==this._flowData.mask[e*r+t]){const s=this._flowData.data[2*(e*r+t)],i=this._flowData.data[2*(e*r+t)+1],n=(Math.sqrt(s*s+i*i)-y)/(x-y);w[4*(e*r+t)]=255*n,w[4*(e*r+t)+1]=0,w[4*(e*r+t)+2]=0,w[4*(e*r+t)+3]=255}else w[4*(e*r+t)]=0,w[4*(e*r+t)+1]=0,w[4*(e*r+t)+2]=0,w[4*(e*r+t)+3]=0;const b=new a.TextureDescriptor;b.internalFormat=i.PixelFormat.RGBA,b.wrapMode=i.TextureWrapMode.CLAMP_TO_EDGE,b.flipped=!0,b.width=r,b.height=l;const _=new n.Texture(t,b,w);this.vertexArray=f,this.program=g,this.texture=_,this.min=y,this.max=x,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.compiled}}e.Imagery=c,e.ImageryResources=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/flow/styles/Particles":function(){define(["exports","../../../../../core/promiseUtils","../utils","../../../../webgl/BufferObject","../../../../webgl/enums","../../../../webgl/VertexArrayObject","../../../../webgl/VertexElementDescriptor"],(function(e,t,r,s,i,n,a){"use strict";class o{constructor(e){this._params=e}get animated(){return this._params.flowSpeed>0}isCompatible(e){return e instanceof o&&r.areStreamlinesCompatible(this._params,e._params)}async load(e,r){const{extent:s,size:i}=e;t.throwIfAborted(r);const n=await this._params.loadImagery(s,i[0],i[1],this._params.timeExtent,r),{vertexData:a,indexData:o}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,n,r);return new h(a,o,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(e,t,s){const{context:n}=e,{program:a}=s;n.setFaceCullingEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunction(i.BlendFactor.ONE,i.BlendFactor.ONE_MINUS_SRC_ALPHA),n.useProgram(a),a.setUniform1f("u_time",t.time),a.setUniform1f("u_trailLength",this._params.trailLength),a.setUniform1f("u_flowSpeed",this._params.flowSpeed),a.setUniform1f("u_featheringSize",this._params.featheringSize),a.setUniform1f("u_featheringOffset",this._params.featheringOffset),a.setUniform1f("u_introFade",this._params.introFade?1:0),a.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),a.setUniform1f("u_decayRate",this._params.decayRate),a.setUniformMatrix3fv("u_dvsMat3",t.dvsMat3),a.setUniformMatrix3fv("u_displayViewMat3",t.displayViewMat3),r.setUniforms(a,"color","vec4",this._params.color),r.setUniforms(a,"opacity","float",this._params.opacity),r.setUniforms(a,"size","float",this._params.size),n.bindVAO(s.vertexArray),n.drawElements(i.PrimitiveType.TRIANGLES,s.indexCount,i.DataType.UNSIGNED_INT,0)}}const l=new Map;l.set("a_xyts0",0),l.set("a_xyts1",1),l.set("a_typeIdDurationSeed",2),l.set("a_extrudeInfo",3);const c=new Map([["geometry",[new a.VertexElementDescriptor("a_xyts0",4,i.DataType.FLOAT,0,64),new a.VertexElementDescriptor("a_xyts1",4,i.DataType.FLOAT,16,64),new a.VertexElementDescriptor("a_typeIdDurationSeed",4,i.DataType.FLOAT,32,64),new a.VertexElementDescriptor("a_extrudeInfo",4,i.DataType.FLOAT,48,64)]]]),u={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:l};class h{constructor(e,t,r){this._vertexData=e,this._indexData=t,this._values=r}attach(e){const{context:t}=e,r=s.BufferObject.createVertex(t,i.Usage.STATIC_DRAW,this._vertexData),a=s.BufferObject.createIndex(t,i.Usage.STATIC_DRAW,this._indexData),o=new Map([["geometry",r]]),h=new n.VertexArrayObject(t,l,c,o,a),d=[];"ramp"===this._values.color.kind&&d.push("vvColor"),"ramp"===this._values.opacity.kind&&d.push("vvOpacity"),"ramp"===this._values.size.kind&&d.push("vvSize");const p=e.getProgram(u,d);this.vertexArray=h,this.program=p,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}e.Particles=o,e.ParticlesResources=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports"],(function(e){"use strict";class t{constructor(e){this._styles=e}get animated(){return this._styles.reduce(((e,t)=>e||t.animated),!1)}isCompatible(e){if(!(e instanceof t))return!1;if(this._styles.length!==e._styles.length)return!1;const r=this._styles.length;for(let t=0;t<r;t++)if(!this._styles[t].isCompatible(e._styles[t]))return!1;return!0}async load(e,t){const s=await Promise.all(this._styles.map((r=>r.load(e,t))));return new r(s)}render(e,t,r){for(let s=0;s<this._styles.length;s++)this._styles[s].render(e,t,r.resources[s])}}class r{constructor(e){this.resources=e}attach(e){for(const t of this.resources)t.attach(e)}detach(){for(const e of this.resources)e.detach()}get ready(){return this.resources.reduce(((e,t)=>e&&t.ready),!0)}}e.Stack=t,e.StackResources=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/flow/styles/Streamlines":function(){define(["../../../../../core/promiseUtils","../utils","../../../../webgl/BufferObject","../../../../webgl/enums","../../../../webgl/VertexArrayObject","../../../../webgl/VertexElementDescriptor"],(function(e,t,r,s,i,n){"use strict";class a{constructor(e){this._params=e}get animated(){return this._params.flowSpeed>0}isCompatible(e){return e instanceof a&&t.areStreamlinesCompatible(this._params,e._params)}async load(t,r){const{extent:s,size:i}=t;e.throwIfAborted(r);const n=await this._params.loadImagery(s,i[0],i[1],this._params.timeExtent,r),{vertexData:a,indexData:o}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,n,r);return new u(a,o,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(e,r,i){const{context:n}=e,{program:a}=i;n.setFaceCullingEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunction(s.BlendFactor.ONE,s.BlendFactor.ONE_MINUS_SRC_ALPHA),n.useProgram(a),a.setUniform1f("u_time",r.time),a.setUniform1f("u_trailLength",this._params.trailLength),a.setUniform1f("u_flowSpeed",this._params.flowSpeed),a.setUniform1f("u_featheringSize",this._params.featheringSize),a.setUniform1f("u_featheringOffset",this._params.featheringOffset),a.setUniform1f("u_introFade",this._params.introFade?1:0),a.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),a.setUniform1f("u_decayRate",this._params.decayRate),a.setUniformMatrix3fv("u_dvsMat3",r.dvsMat3),a.setUniformMatrix3fv("u_displayViewMat3",r.displayViewMat3),t.setUniforms(a,"color","vec4",this._params.color),t.setUniforms(a,"opacity","float",this._params.opacity),t.setUniforms(a,"size","float",this._params.size),n.bindVAO(i.vertexArray),n.drawElements(s.PrimitiveType.TRIANGLES,i.indexCount,s.DataType.UNSIGNED_INT,0)}}const o=new Map;o.set("a_positionAndSide",0),o.set("a_timeInfo",1),o.set("a_extrude",2),o.set("a_speed",3);const l=new Map([["geometry",[new n.VertexElementDescriptor("a_positionAndSide",3,s.DataType.FLOAT,0,36),new n.VertexElementDescriptor("a_timeInfo",3,s.DataType.FLOAT,12,36),new n.VertexElementDescriptor("a_extrude",2,s.DataType.FLOAT,24,36),new n.VertexElementDescriptor("a_speed",1,s.DataType.FLOAT,32,36)]]]),c={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:o};class u{constructor(e,t,r){this._vertexData=e,this._indexData=t,this._values=r}attach(e){const{context:t}=e,n=r.BufferObject.createVertex(t,s.Usage.STATIC_DRAW,this._vertexData),a=r.BufferObject.createIndex(t,s.Usage.STATIC_DRAW,this._indexData),u=new Map([["geometry",n]]),h=new i.VertexArrayObject(t,o,l,u,a),d=[];"ramp"===this._values.color.kind&&d.push("vvColor"),"ramp"===this._values.opacity.kind&&d.push("vvOpacity"),"ramp"===this._values.size.kind&&d.push("vvSize");const p=e.getProgram(c,d);this.vertexArray=h,this.program=p,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.compiled}}return a}))},"esri/views/2d/engine/flow/dataUtils":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../core/mathUtils","../../../../core/promiseUtils","../../../../core/RandomLCG","../../../../geometry/Extent","../../../../geometry/support/spatialReferenceUtils"],(function(e,t,r,s,i,n,a,o){"use strict";const l=()=>r.getLogger("esri.views.2d.engine.flow.dataUtils");function c(e,t){const r=function(e,t,r,s){if(0===s)return e;const i=Math.round(3*s),n=new Array(2*i+1);let a=0;for(let e=-i;e<=i;e++){const t=Math.exp(-e*e/(s*s));n[e+i]=t,a+=t}for(let e=-i;e<=i;e++)n[e+i]/=a;const o=new Float32Array(e.length);for(let s=0;s<r;s++)for(let r=0;r<t;r++){let a=0,l=0;for(let o=-i;o<=i;o++){if(r+o<0||r+o>=t)continue;const c=n[o+i];a+=c*e[2*(s*t+(r+o))],l+=c*e[2*(s*t+(r+o))+1]}o[2*(s*t+r)]=a,o[2*(s*t+r)+1]=l}const l=new Float32Array(e.length);for(let e=0;e<t;e++)for(let s=0;s<r;s++){let a=0,c=0;for(let l=-i;l<=i;l++){if(s+l<0||s+l>=r)continue;const u=n[l+i];a+=u*o[2*((s+l)*t+e)],c+=u*o[2*((s+l)*t+e)+1]}l[2*(s*t+e)]=a,l[2*(s*t+e)+1]=c}return l}(t.data,t.width,t.height,e.smoothing);return e.interpolate?(e,s)=>{const i=Math.floor(e),n=Math.floor(s);if(i<0||i>=t.width)return[0,0];if(n<0||n>=t.height)return[0,0];const a=e-i,o=s-n,l=i,c=n,u=i<t.width-1?i+1:i,h=n<t.height-1?n+1:n,d=r[2*(c*t.width+l)],p=r[2*(c*t.width+u)],f=r[2*(h*t.width+l)],m=r[2*(h*t.width+u)],g=r[2*(c*t.width+l)+1],y=r[2*(c*t.width+u)+1];return[(d*(1-o)+f*o)*(1-a)+(p*(1-o)+m*o)*a,(g*(1-o)+r[2*(h*t.width+l)+1]*o)*(1-a)+(y*(1-o)+r[2*(h*t.width+u)+1]*o)*a]}:(e,s)=>{const i=Math.round(e),n=Math.round(s);return i<0||i>=t.width||n<0||n>=t.height?[0,0]:[r[2*(n*t.width+i)],r[2*(n*t.width+i)+1]]}}function u(e,t,r,s,i,n,a,o,l){const c=[];let u=r,h=s,d=0,[p,f]=t(u,h);p*=e.velocityScale,f*=e.velocityScale;const m=Math.sqrt(p*p+f*f);let g,y;c.push({x:u,y:h,t:d,speed:m});for(let r=0;r<e.verticesPerLine;r++){let[r,s]=t(u,h);r*=e.velocityScale,s*=e.velocityScale;const p=Math.sqrt(r*r+s*s);if(p<e.minSpeedThreshold)return c;const f=r/p,m=s/p;if(u+=f*e.segmentLength,h+=m*e.segmentLength,d+=e.segmentLength/p,Math.acos(f*g+m*y)>e.maxTurnAngle)return c;if(e.collisions){const e=Math.round(u*l),t=Math.round(h*l);if(e<0||e>a-1||t<0||t>o-1)return c;const r=n[t*a+e];if(-1!==r&&r!==i)return c;n[t*a+e]=i}c.push({x:u,y:h,t:d,speed:p}),g=f,y=m}return c}function h(e,t,r,s){const i=[],a=new n,o=1/Math.max(e.lineCollisionWidth,1),l=Math.round(r*o),c=Math.round(s*o),h=new Int32Array(l*c);for(let e=0;e<h.length;e++)h[e]=-1;const d=[];for(let t=0;t<s;t+=e.lineSpacing)for(let s=0;s<r;s+=e.lineSpacing)d.push({x:s,y:t,sort:a.getFloat()});d.sort(((e,t)=>e.sort-t.sort));for(const{x:r,y:s}of d)if(a.getFloat()<e.density){const n=u(e,t,r,s,i.length,h,l,c,o);if(n.length<2)continue;i.push(n)}return i}function d(e,t){const r=new n,s=e.reduce(((e,t)=>e+t.length),0),i=new Float32Array(4*s),a=new Array(e.length);let o=0,l=0;for(const s of e){const e=o;for(const e of s)i[4*o]=e.x,i[4*o+1]=e.y,i[4*o+2]=e.t,i[4*o+3]=e.speed,o++;a[l++]={startVertex:e,numberOfVertices:s.length,totalTime:s[s.length-1].t,timeSeed:t?r.getFloat():0}}return{lineVertices:i,lineDescriptors:a}}function p(e,t){const{lineVertices:r,lineDescriptors:s}=e;let i=0,n=0;for(const e of s)i+=2*e.numberOfVertices,n+=6*(e.numberOfVertices-1);const a=new Float32Array(9*i),o=new Uint32Array(n);let l=0,c=0;function u(e,t,r,s,i,n,o,c){const u=9*l;let h=0;a[u+h++]=e,a[u+h++]=t,a[u+h++]=1,a[u+h++]=r,a[u+h++]=n,a[u+h++]=o,a[u+h++]=s/2,a[u+h++]=i/2,a[u+h++]=c,l++,a[u+h++]=e,a[u+h++]=t,a[u+h++]=-1,a[u+h++]=r,a[u+h++]=n,a[u+h++]=o,a[u+h++]=-s/2,a[u+h++]=-i/2,a[u+h++]=c,l++}for(const e of s){const{totalTime:s,timeSeed:i}=e;let n=null,a=null,h=null,d=null,p=null,f=null;for(let m=0;m<e.numberOfVertices;m++){const g=r[4*(e.startVertex+m)],y=r[4*(e.startVertex+m)+1],x=r[4*(e.startVertex+m)+2],w=r[4*(e.startVertex+m)+3];let b=null,_=null,v=null,S=null;if(m>0){b=g-n,_=y-a;const e=Math.sqrt(b*b+_*_);if(b/=e,_/=e,m>1){let e=b+p,r=_+f;const s=Math.sqrt(e*e+r*r);e/=s,r/=s;const i=Math.min(1/(e*b+r*_),t);e*=i,r*=i,v=-r,S=e}else v=-_,S=b;null!==v&&null!==S&&(u(n,a,h,v,S,s,i,w),o[c++]=l-2,o[c++]=l,o[c++]=l-1,o[c++]=l,o[c++]=l+1,o[c++]=l-1)}n=g,a=y,h=x,p=b,f=_,d=w}u(n,a,h,-f,p,s,i,d)}return{vertexData:a,indexData:o}}function f(e){const{lineVertices:t,lineDescriptors:r}=e;let s=0,i=0;for(const e of r){const t=e.numberOfVertices-1;s+=4*t*2,i+=6*t*2}const n=new Float32Array(16*s),a=new Uint32Array(i);let o,l,c,u,h,d,p,f,m,g,y,x,w,b,_=0,v=0;function S(e,t){let r=m+y,s=g+x;const i=Math.sqrt(r*r+s*s);r/=i,s/=i;const S=m*r+g*s;r/=S,s/=S;let T=y+w,M=x+b;const R=Math.sqrt(T*T+M*M);T/=R,M/=R;const C=y*T+x*M;T/=C,M/=C,function(e,t,r,s,i,a,o,l,c,u,h,d,p,f){const m=16*_;let g=0;for(const y of[1,2])for(const x of[1,2,3,4])n[m+g++]=e,n[m+g++]=t,n[m+g++]=r,n[m+g++]=s,n[m+g++]=o,n[m+g++]=l,n[m+g++]=c,n[m+g++]=u,n[m+g++]=y,n[m+g++]=x,n[m+g++]=p,n[m+g++]=f,n[m+g++]=i/2,n[m+g++]=a/2,n[m+g++]=h/2,n[m+g++]=d/2,_++}(o,l,c,u,-s,r,h,d,p,f,-M,T,e,t),a[v++]=_-8,a[v++]=_-7,a[v++]=_-6,a[v++]=_-7,a[v++]=_-5,a[v++]=_-6,a[v++]=_-4,a[v++]=_-3,a[v++]=_-2,a[v++]=_-3,a[v++]=_-1,a[v++]=_-2}function T(e,t,r,s,i,n){if(m=y,g=x,y=w,x=b,null==m&&null==g&&(m=y,g=x),null!=h&&null!=d){w=e-h,b=t-d;const r=Math.sqrt(w*w+b*b);w/=r,b/=r}null!=m&&null!=g&&S(i,n),o=h,l=d,c=p,u=f,h=e,d=t,p=r,f=s}function M(e,t){m=y,g=x,y=w,x=b,null==m&&null==g&&(m=y,g=x),null!=m&&null!=g&&S(e,t)}for(const e of r){o=null,l=null,c=null,u=null,h=null,d=null,p=null,f=null,m=null,g=null,y=null,x=null,w=null,b=null;const{totalTime:r,timeSeed:s}=e;for(let i=0;i<e.numberOfVertices;i++)T(t[4*(e.startVertex+i)],t[4*(e.startVertex+i)+1],t[4*(e.startVertex+i)+2],t[4*(e.startVertex+i)+3],r,s);M(r,s)}return{vertexData:n,indexData:a}}function m(e,t){const r=t.pixels,{width:i,height:n}=t,a=new Float32Array(i*n*2),o=t.mask||new Uint8Array(i*n*2);if(t.mask||o.fill(255),"vector-uv"===e)for(let e=0;e<i*n;e++)a[2*e]=r[0][e],a[2*e+1]=-r[1][e];else if("vector-magdir"===e)for(let e=0;e<i*n;e++){const t=r[0][e],i=s.deg2rad(r[1][e]),n=Math.cos(i-Math.PI/2),o=Math.sin(i-Math.PI/2);a[2*e]=n*t,a[2*e+1]=o*t}return{data:a,mask:o,width:i,height:n}}async function g(e,t,r,s,i,n){const a={requestProjectedLocalDirections:!0,signal:n};if(null!=i&&(a.timeExtent=i),"imagery"===e.type){await e.load({signal:n});const i=await e.internalFetchImage(t,r,s,a);return null==i?.pixelData?.pixelBlock?{data:new Float32Array(r*s*2),mask:new Uint8Array(r*s),width:r,height:s}:m(e.rasterInfo.dataType,i.pixelData.pixelBlock)}await e.load({signal:n});const o=await e.fetchPixels(t,r,s,a);return null==o?.pixelBlock?{data:new Float32Array(r*s*2),mask:new Uint8Array(r*s),width:r,height:s}:m(e.serviceRasterInfo.dataType,o.pixelBlock)}e.createAnimatedLinesData=d,e.createFlowFieldFromData=c,e.createFlowMesh=async function(e,r,s,n){const a=performance.now(),o=c(r,s),u=performance.now(),m=h(r,o,s.width,s.height),g=performance.now(),y=d(m,!0),x=performance.now(),w="Streamlines"===e?p(y,10):f(y),b=performance.now();return t("esri-2d-profiler")&&(l().info("I.1","_createFlowFieldFromData (ms)",Math.round(u-a)),l().info("I.2","_getStreamlines (ms)",Math.round(g-u)),l().info("I.3","createAnimatedLinesData (ms)",Math.round(x-g)),l().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(b-x)),l().info("I.5","createFlowMesh (ms)",Math.round(b-a)),l().info("I.6","Mesh size (bytes)",w.vertexData.buffer.byteLength+w.indexData.buffer.byteLength)),await Promise.resolve(),i.throwIfAborted(n),w},e.createParticlesMesh=f,e.createStreamlinesMesh=p,e.getStreamlines=h,e.loadImagery=async function(e,r,s,i,n,c){const u=performance.now(),h=o.getInfo(r.spatialReference);if(!h){const a=await g(e,r,s,i,n,c);return t("esri-2d-profiler")&&l().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-u)),t("esri-2d-profiler")&&l().info("I.9","Number of parts",1),a}const[d,p]=h.valid,f=p-d,m=Math.ceil(r.width/f),y=r.width/m,x=Math.round(s/m);let w=r.xmin;const b=[],_=performance.now();for(let t=0;t<m;t++){const t=new a({xmin:w,xmax:w+y,ymin:r.ymin,ymax:r.ymax,spatialReference:r.spatialReference});b.push(g(e,t,x,i,n,c)),w+=y}const v=await Promise.all(b);t("esri-2d-profiler")&&l().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-_)),t("esri-2d-profiler")&&l().info("I.9","Number of parts",v.length);const S={data:new Float32Array(s*i*2),mask:new Uint8Array(s*i),width:s,height:i};let T=0;for(const e of v){for(let t=0;t<e.height;t++)for(let r=0;r<e.width;r++)T+r>=s||(S.data[2*(t*s+T+r)]=e.data[2*(t*e.width+r)],S.data[2*(t*s+T+r)+1]=e.data[2*(t*e.width+r)+1],S.mask[t*s+T+r]=e.mask[t*e.width+r]);T+=e.width}return t("esri-2d-profiler")&&l().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-u)),S},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/flow/FlowContainer":function(){define(["./BrushFlow","../webgl/enums","../webgl/WGLContainer"],(function(e,t,r){"use strict";return class extends r{constructor(){super(...arguments),this.flowStyle=null}doRender(e){super.doRender(e)}prepareRenderPasses(r){const s=r.registerRenderPass({name:"flow",brushes:[e],target:()=>this.children,drawPhase:t.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(r),s]}}}))},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../core/libs/gl-matrix-2/factories/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],(function(e,t,r){"use strict";return class extends t{constructor(){super(...arguments),this._visualState={time:0,dvsMat3:e.create(),displayViewMat3:e.create()}}dispose(){}prepareState(e){const{context:t}=e;t.setColorMask(!0,!0,!0,!0),t.setStencilFunction(r.CompareFunction.EQUAL,0,255)}draw(e,t){const{requestRender:r,allowDelayedRender:s}=e,{displayData:i}=t;if(null==i)return;if("loaded"===i.state.name&&i.attach({context:e.context,getProgram:(t,r)=>e.painter.materialManager.getProgram(t,r)}),"attached"!==i.state.name)return;const n=i.state.resources;!s||n.ready||null==r?(this._visualState.time=e.time/1e3,this._visualState.dvsMat3=t.transforms.displayViewScreenMat3,this._visualState.displayViewMat3=e.state.displayViewMat3,i.flowStyle.render({context:e.context,getProgram:(t,r)=>e.painter.materialManager.getProgram(t,r)},this._visualState,n),i.flowStyle.animated&&null!=r&&r()):r()}}}))},"esri/views/2d/engine/flow/FlowStrategy":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Logger","../../../../core/mathUtils","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Extent","../../../../geometry/Point","./FlowDisplayData","./FlowDisplayObject"],(function(e,t,r,s,i,n,a,o,l,c,u,h,d,p){"use strict";return e.default=class extends r{constructor(e){super(e),this._flowDisplayObject=new p.FlowDisplayObject,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(e){const{flowStyle:t}=this.flowContainer;if(null==t)return void this._clear();const{extent:r,rotation:a,resolution:o,pixelRatio:l}=e.state,c=function(e,t){const r=new h({x:(e.xmax+e.xmin)/2,y:(e.ymax+e.ymin)/2,spatialReference:e.spatialReference}),s=e.xmax-e.xmin,n=e.ymax-e.ymin,a=Math.abs(Math.cos(i.deg2rad(t))),o=Math.abs(Math.sin(i.deg2rad(t))),l=a*s+o*n,c=o*s+a*n,d=new u({xmin:r.x-l/2,ymin:r.y-c/2,xmax:r.x+l/2,ymax:r.y+c/2,spatialReference:e.spatialReference});return d.centerAt(r),d}(r,a);c.expand(1.15);const p=[Math.round((c.xmax-c.xmin)/o),Math.round((c.ymax-c.ymin)/o)],f=new d(t,c,p,l);if(null!=this._loading){if(this._loading.update(f))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(f)||(f.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(e=>{n.isAbortError(e)||(s.getLogger(this).error("A resource failed to load.",e),this._loading=null)})),this._loading=f)}_clear(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)}},t.__decorate([a.property()],e.default.prototype,"_loading",void 0),t.__decorate([a.property()],e.default.prototype,"flowContainer",void 0),t.__decorate([a.property()],e.default.prototype,"updating",null),e.default=t.__decorate([c.subclass("esri.views.2d.engine.flow.FlowStrategy")],e.default),e.default}))},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../core/Logger"],(function(e){"use strict";return class{constructor(e,t,r,s){this.state={name:"created"},this.flowStyle=e,this.extent=t,this.size=r,this.pixelRatio=s}async load(){const e=new AbortController;this.state={name:"loading",abortController:e};const t={extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},r=await this.flowStyle.load(t,e.signal);this.state={name:"loaded",resources:r}}attach(t){if("loaded"!==this.state.name)return void e.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");const r=this.state.resources;r.attach(t),this.state={name:"attached",resources:r}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(e){return!!this.flowStyle.isCompatible(e.flowStyle)&&!(!this.extent.equals(e.extent)||this.size[0]!==e.size[0]||this.size[1]!==e.size[1]||this.pixelRatio!==e.pixelRatio||(this.flowStyle=e.flowStyle,0))}}}))},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../DisplayObject"],(function(e,t,r,s,i){"use strict";class n extends i.DisplayObject{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(e){this._displayData=e,this.requestRender()}clear(){null!=this._displayData&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(e){const{displayData:s}=this;if(null==s)return;const i=s.extent.xmin,n=s.extent.ymax,a=[0,0];e.toScreen(a,[i,n]);const o=(s.extent.xmax-s.extent.xmin)/s.size[0]/e.resolution,l=t.deg2rad(e.rotation),{displayViewScreenMat3:c}=this.transforms;r.fromTranslation(c,[-1,1,0]),r.scale(c,c,[2/(e.size[0]*e.pixelRatio),-2/(e.size[1]*e.pixelRatio),1]),r.translate(c,c,[a[0],a[1],0]),r.rotate(c,c,l),r.scale(c,c,[o*e.pixelRatio,o*e.pixelRatio,1])}_createTransforms(){return{displayViewScreenMat3:s.create()}}}e.FlowDisplayObject=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/LayerView2D":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Collection","../../../core/collectionUtils","../../../core/Error","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../linkChart/utils","../engine/Container","./support/HighlightCounter","./support/util","../support/highlightOptionsUtils","../../layers/support/ClipRect","../../layers/support/Geometry","../../layers/support/Path","../../support/HighlightOptions","../../support/layerViewUtils"],(function(e,t,r,s,i,n,a,o,l,c,u,h,d,p,f,m,g,y,x,w,b){"use strict";const _=r.ofType({key:"type",base:null,typeMap:{rect:g,path:x,geometry:y}}),v=new(r.ofType(w));e.LayerView2DMixin=e=>{let o=class extends e{constructor(){super(...arguments),this._highlightCounter=new p.HighlightCounter,this.attached=!1,this.clips=new _,this.highlights=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){const e=this.view?.spatialReferenceLocked??!0,t=this.view?.spatialReference;t&&e&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new i("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new d.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([n.watch((()=>this.suspended),(e=>{this.container&&(this.container.visible=!e)}),n.syncAndInitial),n.watch((()=>this.updateSuspended),(e=>{this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),n.syncAndInitial),n.watch((()=>this.layer?.opacity??1),(e=>{this.container&&(this.container.opacity=e)}),n.syncAndInitial),n.watch((()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal"),(e=>{this.container&&(this.container.blendMode=e)}),n.syncAndInitial),n.watch((()=>this.layer&&"effect"in this.layer?this.layer.effect:null),(e=>{this.container&&(this.container.effect=e)}),n.syncAndInitial),n.watch((()=>this._mergedHighlights.items.map((e=>({name:e.name,options:{fillColor:e.color,haloColor:e.haloColor,fillOpacity:e.fillOpacity,haloOpacity:e.haloOpacity,haloWidth:e.haloWidth,haloBlur:e.haloBlur}})))),(()=>{this.container.highlightGradient=f.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)}),n.syncAndInitial),n.watch((()=>this._mergedHighlights.items.map((e=>e.name))),(()=>{this._processHighlight()})),n.on((()=>this.clips),"change",(()=>{this.container&&(this.container.clips=this.clips)}),n.syncAndInitial),n.watch((()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null})),(({scale:e,scaleRange:t})=>{const r=b.isInEffectiveScaleRange(t,e);r!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=r)}),n.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e===this&&this.processAttach()}),(()=>{})):this.when().then((()=>{this.processAttach()}),(()=>{})))}destroy(){this.processDetach(),this.updateRequested=!1}get highlightOptions(){return m.getDefaultHighlightOptions(this)}set highlightOptions(e){m.setDefaultHighlightOptions(this,e)}get hasHighlight(){return this._highlightCounter.size>0}get _mergedHighlights(){if(!this.view)return v;if(!this.highlights)return this.view.highlights;const e=this.view.highlights.clone();for(const t of this.highlights){const r=e.find((e=>e.name===t.name));r&&r.assignFrom(t)}return e}get highlightIds(){return Array.from(this._highlightCounter.objectIds)}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const e=this.view?.spatialReference;return null==e||this.supportsSpatialReference(e)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}supportsSpatialReference(e){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;switch(this.layer?.type){case"link-chart":case"knowledge-graph-sublayer":case"graphics":break;default:if(h.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const e=super.getSuspendInfo(),t=!this.spatialReferenceSupported;return t&&(e.spatialReferenceNotSupported=t),e}addAttachHandles(e){this.addHandles(e,"attach")}_addHighlights(e,t){this._highlightCounter.add(e,t)&&this._processHighlight()}_removeHighlights(e,t){this._highlightCounter.delete(e,t)&&this._processHighlight()}_processHighlight(){}_getHighlights(){const e=[];for(const[t,r]of this._highlightCounter.highlightNamesByObjectId){const s=this._getHighlightBits(r);e.push({objectId:t,highlightFlags:s})}return e}_getHighlightBits(e){const t=new Set(e);let r=1,s=0;if(!this.view)return 0;const i=this._mergedHighlights;for(const{name:e}of i)t.delete(e)&&(s=r),r<<=1;return s}};return t.__decorate([a.property()],o.prototype,"attached",void 0),t.__decorate([a.property({type:_,set(e){const t=s.referenceSetter(e,this._get("clips"),_);this._set("clips",t)}})],o.prototype,"clips",void 0),t.__decorate([a.property()],o.prototype,"container",void 0),t.__decorate([a.property({type:w})],o.prototype,"highlightOptions",null),t.__decorate([a.property({type:r.ofType(w)})],o.prototype,"highlights",void 0),t.__decorate([a.property()],o.prototype,"_mergedHighlights",null),t.__decorate([a.property()],o.prototype,"moving",void 0),t.__decorate([a.property({readOnly:!0})],o.prototype,"spatialReferenceSupported",null),t.__decorate([a.property({readOnly:!0})],o.prototype,"updateParameters",void 0),t.__decorate([a.property()],o.prototype,"updateRequested",void 0),t.__decorate([a.property()],o.prototype,"updating",null),t.__decorate([a.property()],o.prototype,"view",void 0),t.__decorate([a.property()],o.prototype,"_visibleAtCurrentScale",void 0),t.__decorate([a.property({readOnly:!0})],o.prototype,"visibleAtCurrentScale",null),o=t.__decorate([u.subclass("esri.views.2d.layers.LayerView2D")],o),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/linkChart/utils":function(){define(["exports"],(function(e){"use strict";e.isLinkChartView=function(e){return null!=e&&"object"==typeof e&&"2d"===e.type&&"linkchart"===e.view2dType},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/support/HighlightCounter":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/MapUtils","../../../../core/ReactiveMap","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,s,i,n,a,o,l,c){"use strict";e.HighlightCounter=class extends r{constructor(){super(...arguments),this._idToCounters=new i}get size(){return this._idToCounters.size}get objectIds(){return this._idToCounters.keys()}get highlightNamesByObjectId(){return function*(e){for(const[t,r]of e)yield[t,r.keys()]}(this._idToCounters)}add(e,t){let r=!1;for(const i of e){const e=s.getOrCreateMapValue(this._idToCounters,i,(()=>(r=!0,new Map))),n=e.get(t)??0;n||(r=!0),e.set(t,n+1)}return r}delete(e,t){let r=!1;for(const s of e){const e=this._idToCounters.get(s);if(!e)continue;let i=e.get(t);null!=i&&(i--,i>0?e.set(t,i):(e.delete(t),r=!0),0===e.size&&(this._idToCounters.delete(s),r=!0))}return r}},e.HighlightCounter=t.__decorate([c.subclass("esri.views.2d.layers.support.HighlightCounter")],e.HighlightCounter),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/support/ClipRect":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],(function(e,t,r,s,i,n,a,o){"use strict";var l;return e.default=l=class extends o{constructor(e){super(e),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}},t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"left",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"right",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"top",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"bottom",void 0),e.default=l=t.__decorate([a.subclass("esri.views.layers.support.ClipRect")],e.default),e.default}))},"esri/views/layers/support/ClipArea":function(){define(["exports","../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,s,i,n,a,o){"use strict";return e.default=class extends r{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}},t.__decorate([s.property({readOnly:!0})],e.default.prototype,"version",null),e.default=t.__decorate([o.subclass("esri.views.layers.support.ClipArea")],e.default),e.default}))},"esri/views/layers/support/Geometry":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/Extent","../../../geometry/Geometry","../../../geometry/Polygon","../../../geometry/support/jsonUtils","./ClipArea"],(function(e,t,r,s,i,n,a,o,l,c,u,h){"use strict";var d;const p={base:l,key:"type",typeMap:{extent:o,polygon:c}};return e.default=d=class extends h{constructor(e){super(e),this.type="geometry",this.geometry=null}clone(){return new d({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}},t.__decorate([r.property({types:p,json:{read:u.fromJSON,write:!0}})],e.default.prototype,"geometry",void 0),e.default=d=t.__decorate([a.subclass("esri.views.layers.support.Geometry")],e.default),e.default}))},"esri/views/layers/support/Path":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],(function(e,t,r,s,i,n,a,o){"use strict";return e.default=class extends o{constructor(e){super(e),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}},t.__decorate([r.property({type:[[[Number]]],json:{write:!0}})],e.default.prototype,"path",void 0),e.default=t.__decorate([a.subclass("esri.views.layers.support.Path")],e.default),e.default}))},"esri/views/2d/layers/imagery/ImageryTileView2D":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/has","../../../../core/accessorSupport/decorators/property","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../layers/support/rasterDatasets/datasetUtils","../../../../layers/support/rasterFormats/pixelRangeUtils","../../../../layers/support/rasterFunctions/clipUtils","../../engine/imagery/RasterTileContainer","./BaseImageryTileSubView2D","../support/util"],(function(e,t,r,s,i,n,a,o,l,c,u,h,d){"use strict";return e.default=class extends h.BaseImageryTileSubView2D{constructor(){super(...arguments),this.type="raster"}get canUseWebGLForProcessing(){const{loaded:e,symbolizer:t}=this.layer;if(!e||!t)return!1;const s=t.lookup.colormapLut?.indexedColormap,i=s&&s.length>this._maxIndexedColormapSize,n=l.getBytesPerPixel(this.layer.serviceRasterInfo);return!(r("ios")&&n>4)&&this.useWebGLForProcessing&&t.canRenderInWebGL&&!i&&!("majority"===this.layer.interpolation&&d.canUseMajorityInterpolationOnDataSource(this.layer))}attach(){super.attach(),this.container=new u.RasterTileContainer(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this.updateRasterFunctionParameters()}detach(){super.detach(),this.container.removeAllChildren(),this.container=null}fetchTile(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}updateRasterFunctionParameters(){const{raster:e,type:t}=this.layer,{container:r}=this;if("Function"!==e.datasetFormat||"wcs"===t)return r.rasterFunctionChain=null,r.children.forEach((e=>{const{bitmap:t}=e;t&&(t.suspended=!0,t.processed=!1,t.projected&&(t.invalidateTexture(),t.rasterTexture=null))})),void(this._rasterFunctionState="na");const s=this._rasterFunctionState,{rasterFunction:i,primaryRasters:n}=e,a=i.supportsGPU&&(!n||n.rasters.length<=1),o=a?i.flatWebGLFunctionChain:null,{renderer:l}=this.layer,c=!a||!o?.functions.length||"raster-stretch"===l?.type&&l.dynamicRangeAdjustment||!this.canUseWebGLForProcessing;r.rasterFunctionChain=c?null:this._addProjection(o);const u=null==i?"na":r.rasterFunctionChain?"gpu":"cpu",h=s===u||"na"===s&&"cpu"===u&&0===o?.functions?.length;r.children.forEach((e=>{const{bitmap:t}=e;t&&(t.suspended=!h,t.processed=!1,t.processedTexture=null)})),this._rasterFunctionState=u}async updateTileSource(e,t){const r=this._getBandIds(),s=this._getLayerInterpolation(),{canUseWebGLForProcessing:i}=this,{source:n,globalSymbolizerParams:a,suspended:l,coords:u,resolution:h}=t,d=this.layerView.hasTilingEffects?a:t.symbolizerParams,{bitmap:p}=e;if([p.x,p.y]=u,p.resolution=h,null!=n?.pixelBlock){const e={extent:n.extent,pixelBlock:n.pixelBlock,srcPixelSize:n.srcTilePixelSize};if(p.rawPixelData=e,i)p.source=n.pixelBlock,p.isRendereredSource=!1;else{const t=await this.layer.applyRenderer(e,"stretch"===a?.type?a:void 0);p.source=t,p.isRendereredSource=!0}p.symbolizerParameters=i?d:null,p.transformGrid=i?n.transformGrid:null}else{const e=this.createEmptyTilePixelBlock();p.source=e,p.symbolizerParameters=i?d:null,p.transformGrid=null}p.bandIds=i?r:null,p.width=this._tileInfoView.tileInfo.size[0],p.height=this._tileInfoView.tileInfo.size[1],p.interpolation=s,p.suspended=l;const{raster:f}=this.layer;if(o.isFunctionRaster(f)){const t=f.getClippingGeometry(this.layerView.view.spatialReference);if(t){const r=f.getTileExtentFromTileInfo(e.key.level,e.key.row,e.key.col,this._tileInfoView.tileInfo);p.mask=c.convertGeometryToMask({srcExtent:r,geometry:t,size:[p.width,p.height]})}}p.invalidateTexture()}async updateTileSymbolizerParameters(e,t){const{local:r,global:s}=t,i=this._getBandIds(),n=this._getLayerInterpolation(),{canUseWebGLForProcessing:a}=this,{bitmap:o}=e,{rawPixelData:l}=o;a||null==l?(o.isRendereredSource&&null!=l&&(o.source=l.pixelBlock),o.isRendereredSource=!1):(o.source=await this.layer.applyRenderer(l,"stretch"===s?.type?s:void 0),o.isRendereredSource=!0),o.symbolizerParameters=a?this.layerView.hasTilingEffects?s:r:null,o.bandIds=a?i:null,o.interpolation=n,o.suspended=!1}_getLayerInterpolation(){const{interpolation:e,renderer:t}=this.layer;if(!t)return e;const r=t.type;return"raster-colormap"===r||"unique-value"===r?"nearest":"raster-stretch"===t.type&&null!=t.colorRamp?"bilinear"===e||"cubic"===e?"bilinear":"nearest":e}_addProjection(e){return e?.functions?.length&&!e.hasFocalFunction&&e.functions.unshift({name:"Reproject",parameters:{targetImageSize:this._tileInfoView.tileInfo.size,requireNNEdge:e.isSourceSingleBand},pixelType:"f32",id:0,isNoopProcess:!1}),e}},t.__decorate([s.property()],e.default.prototype,"canUseWebGLForProcessing",null),t.__decorate([s.property()],e.default.prototype,"container",void 0),t.__decorate([s.property()],e.default.prototype,"layer",void 0),t.__decorate([s.property()],e.default.prototype,"type",void 0),e.default=t.__decorate([a.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],e.default),e.default}))},"esri/layers/support/rasterDatasets/datasetUtils":function(){define(["exports"],(function(e){"use strict";function t(e){return"Function"===e?.datasetFormat}e.getPrimaryRasters=function(e){return t(e)?e.primaryRasters.rasters:[e]},e.isFunctionRaster=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],(function(e){"use strict";const t={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function r(e){return t[e]??[-34028234663852886e22,34028234663852886e22]}const s={u1:1,u2:1,u4:1,u8:1,s8:1,u16:2,s16:2,u32:4,s32:4,f32:4,f64:8,unknown:4,c64:16,c128:32};function i(e){return(e?.startsWith("s")||e?.startsWith("u"))??!1}e.clipBandToPixelTypeRange=function(e,t,s,n){let[a,o]=r(s);const l=i(s);return l&&(a-=1e-5,o+=1e-5),l?s.startsWith("u")?function(e,t,r,s){const[i,n]=s;for(let s=0;s<t.length;s++)if(t[s]){const a=e[s];a<i||a>n?t[s]=0:r[s]=a+.5|0}}(e,t,n,[a,o]):function(e,t,r,s){const[i,n]=s;for(let s=0;s<t.length;s++)if(t[s]){const a=e[s];a<i||a>n?t[s]=0:r[s]=a+(a>0?.5:-.5)|0}}(e,t,n,[a,o]):function(e,t,r,s){const[i,n]=s;for(let s=0;s<t.length;s++)if(t[s]){const a=e[s];a<i||a>n?t[s]=0:r[s]=a}}(e,t,n,[a,o])},e.convertNoDataToMask=function(e,t,s){if(e.depthCount&&e.depthCount>1)return;const{pixels:i,statistics:n,pixelType:a}=e,o=i[0].length,l=e.bandMasks??[],c=e.mask??new Uint8Array(o).fill(255),u="f32"===a||"f64"===a,h=r(a);let d=!1;for(let e=0;e<i.length;e++){const r="number"==typeof t?t:t[e];if(null==r)continue;const o=n?.[e]?.minValue??h[0],p=n?.[e]?.maxValue??h[1];if(o>r+Number.EPSILON||p<r-Number.EPSILON)continue;const f=l[e]||c.slice(),m=i[e],g=s?.customFloatTolerance;if(u&&0!==g){let e=g;e||(e=Math.abs(r)>=9999999e31?2e-7*Math.abs(r):"f32"===a?2**-23:Number.EPSILON);for(let t=0;t<m.length;t++)f[t]&&Math.abs(m[t]-r)<e&&(m[t]=0,f[t]=0,c[t]=0,d=!0)}else for(let e=0;e<m.length;e++)f[e]&&m[e]===r&&(m[e]=0,f[e]=0,c[e]=0,d=!0);l[e]=f}if(d){const t=e.bandMasks||e.pixels.length>1?l:null;s?.matchAllNoData?e.mask=t&&t.length>1?function(e){if(e.length<2)return e[0];const t=e[0].length,r=new Uint8Array(t).fill(0);for(let s=0;s<e.length;s++){const i=e[s];for(let e=0;e<t;e++)i[e]&&(r[e]=255)}return r}(t):c:(e.bandMasks=t,e.mask=c)}d&&"updateStatistics"in e&&e.updateStatistics()},e.fixNaN=function(e,t){for(let r=0;r<t.length;r++)t[r]&&isNaN(e[r])&&(t[r]=0,e[r]=0)},e.getBytesPerPixel=function(e){return t=e.pixelType,s[t]*e.bandCount;var t},e.getIntegerPixelType=function(e,t){return null==e||null==t?"s32":e<0?e>=-128&&t<128?"s8":e>=-32768&&t<32768?"s16":"s32":t<256?"u8":t<65536?"u16":"u32"},e.getPixelValueRange=r,e.isIntegerPixelType=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/rasterFunctions/clipUtils":function(){define(["require","exports","../../../core/unitUtils","../../../geometry/Extent","../../../geometry/Point","../PixelBlock"],(function(e,t,r,s,i,n){"use strict";function a(e){const{geometry:t,size:r,srcExtent:s,srcMask:i}=e,[n,a]=r;let o;const l=s.width/n,c=s.height/a,{xmin:u,ymax:h}=s;if("extent"===t.type){const e=(t.xmin-u)/l,r=(t.xmax-u)/l,s=(h-t.ymax)/c,i=(h-t.ymin)/c;o=[[[e,s],[e,i],[r,i],[r,s],[e,s]]]}else o=t.rings.map((e=>e.map((([e,t])=>[(e-u)/l,(h-t)/c]))));return function(e,t,r){const[s,i]=t,n=new OffscreenCanvas(s,i).getContext("2d");n.fillStyle="#f00",n.beginPath(),e.forEach((e=>{n.moveTo(e[0][0],e[0][1]);for(let t=0;t<e.length;t++)n.lineTo(e[t][0],e[t][1]);n.closePath()})),n.fill();const a=n.getImageData(0,0,s,i).data,o=s*i,l=new Uint8Array(o);let c=!1;for(let e=0;e<o;e++)r&&!r[e]||(a[4*e+3]>127?l[e]=255:c=!0);return c||r?l:void 0}(o,r,i)}function o(e,t,i,n=!0){const{spatialReference:a}=e,{x:o,y:l}=function(e,t){if(e.spatialReference.equals(t))return e;const s=r.getMetersPerUnitForSR(e.spatialReference),i=r.getMetersPerUnitForSR(t);if(s===i)return e;const n=s/i;return{x:e.x*n,y:e.y*n}}(i,a);let c,u,h;const d="extent"===t.type?t:t.extent;let{xmin:p,xmax:f,ymax:m,ymin:g}=d;const{xmin:y,ymax:x}=e.extent;return n?(p=y+(p>y?o*Math.round((p-y)/o):0),m=x-(m<x?l*Math.round((x-m)/l):0),f=y+(f>y?o*Math.round((f-y)/o):0),g=x-(g<x?l*Math.round((x-g)/l):0),c=new s({xmin:p,ymax:m,xmax:f,ymin:g,spatialReference:a}),u=Math.round(c.width/o),h=Math.round(c.height/l)):(u=Math.floor((f-p)/o+.8),h=Math.floor((m-g)/l+.8),p=y+(p>y?o*Math.floor((p-y)/o+.1):0),m=x-(m<x?l*Math.floor((x-m)/l+.1):0),f=p+u*o,g=m-h*l,c=new s({xmin:p,ymax:m,xmax:f,ymin:g,spatialReference:a})),{extent:c,width:u,height:h}}t.clip=async function(t,r,s){if("extent"===s.type)return function(e,t,r){const{width:s,height:i}=e,a=new Uint8Array(s*i),o=t.width/s,l=t.height/i;if(r.width/o<.5||r.height/l<.5)return new n({pixelType:e.pixelType,width:s,height:i,mask:a,pixels:[...e.pixels]});const{xmin:c,xmax:u,ymin:h,ymax:d}=t,{xmin:p,xmax:f,ymin:m,ymax:g}=r,y=Math.max(c,p),x=Math.min(u,f),w=Math.max(h,m),b=Math.min(d,g),_=.5*o,v=.5*l;if(x-y<_||b-w<v||x<c+_||y>u-_||w>d-v||b<h+v)return new n({pixelType:e.pixelType,width:s,height:i,mask:a,pixels:[...e.pixels]});const S=Math.max(0,(y-c)/o),T=Math.min(s,Math.max(0,(x-c)/o)),M=Math.max(0,(d-b)/l),R=Math.min(i,Math.max(0,(d-w)/l)),C=Math.round(S),P=Math.round(T)-1,k=Math.round(M),F=Math.round(R)-1;if(C===P&&S%1>.5&&T%1<.5||k===F&&M%1>.5&&R%1<.5)return new n({pixelType:e.pixelType,width:s,height:i,mask:a,pixels:[...e.pixels]});if(0===C&&0===k&&P===s&&F===i)return e;const V=e.mask;for(let e=k;e<=F;e++)for(let t=C;t<=P;t++){const r=e*s+t;a[r]=V?V[r]:255}return new n({pixelType:e.pixelType,width:s,height:i,mask:a,pixels:[...e.pixels]})}(t,r,s);const{width:i,height:o}=t,l=new Uint8Array(i*o);return(await new Promise(((t,r)=>e(["../../../geometry/operators/intersectsOperator"],t,r)))).execute(r,s)?"polyline"===s.type?function(e,t,r){const{width:s,height:i}=e,a=new Uint8Array(s*i),o=t.width/s,l=t.height/i,{xmin:c,ymax:u}=t,{paths:h}=r,d=e.mask;for(let e=0;e<h.length;e++){const t=h[e];for(let e=0;e<t.length-1;e++){const[r,n]=t[e],[h,p]=t[e+1];let f=Math.floor((u-n)/l),m=Math.floor((u-p)/l);if(m<f){const e=f;f=m,m=e}f=Math.max(0,f),m=Math.min(i-1,m);const g=(h-r)/(p-n);for(let e=f;e<=m;e++){const t=e===f?Math.max(n,p):(i+1-e)*l,u=e===m?Math.min(n,p):t-l;let y=p===n?Math.floor((r-c)/o):Math.floor((g*(t-n)+r-c)/o),x=p===n?Math.floor((h-c)/o):Math.floor((g*(u-n)+r-c)/o);if(x<y){const e=y;y=x,x=e}const w=e*s;y=Math.max(0,y),x=Math.min(s-1,x);for(let e=w+y;e<=w+x;e++)a[e]=d?d[e]:255}}}return new n({pixelType:e.pixelType,width:s,height:i,mask:a,pixels:[...e.pixels]})}(t,r,s):(await new Promise(((t,r)=>e(["../../../geometry/operators/containsOperator"],t,r)))).execute(s,r)?t:function(e,t,r){if(!e)return e;const{width:s,height:i}=e,o=a({geometry:r,size:[s,i],srcExtent:t,srcMask:e.mask});return new n({pixelType:e.pixelType,width:s,height:i,mask:o,maskIsAlpha:!1,pixels:[...e.pixels]})}(t,r,s):new n({pixelType:t.pixelType,width:i,height:o,mask:l,maskIsAlpha:!1,pixels:[...t.pixels]})},t.clipRasterInfo=function(e,t){const{extent:r}=o(e,t,new i({x:e.pixelSize.x,y:e.pixelSize.y,spatialReference:e.spatialReference})),{extent:s}=e.extent;if(r.xmax=Math.min(r.xmax,s.xmax),r.ymax=Math.min(r.ymax,s.ymax),r.xmin<r.xmax&&r.ymin<r.ymax){const{x:t,y:s}=e.pixelSize,i=Math.round(r.width/t),n=Math.round(r.height/s);e.extent=r,e.width=i,e.height=n}},t.convertGeometryToMask=a,t.snapToRaster=o,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/PixelBlock":function(){define(["exports","../../chunks/tslib.es6","../../core/Error","../../core/JSONSupport","../../core/lang","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","./SimpleBandStatistics","./rasterFormats/pixelRangeUtils"],(function(e,t,r,s,i,n,a,o,l,c,u){"use strict";var h;return e.default=h=class extends s{static createEmptyBand(e,t){return new(h.getPixelArrayConstructor(e))(t)}static combineBandMasks(e){if(e.length<2)return e[0];const t=e[0].length,r=new Uint8Array(t).fill(255);for(let s=0;s<e.length;s++){const i=e[s];for(let e=0;e<t;e++)i[e]||(r[e]=0)}return r}static getPixelArrayConstructor(e){let t;switch(e){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":t=Float32Array;break;case"f64":t=Float64Array}return t}constructor(e){super(e),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.premultiplyAlpha=!1,this.statistics=null,this.depthCount=1}castPixelType(e){if(!e)return"f32";let t=e.toLowerCase();return["u1","u2","u4"].includes(t)?t="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(t)||(t="f32"),t}getPlaneCount(){return this.pixels?.length}addData(e){if(!e.pixels||e.pixels.length!==this.width*this.height)throw new r("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(e.pixels),this.statistics.push(e.statistics??new c.SimpleBandStatistics)}getAsRGBA(){const e=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(e);break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)}getAsRGBAFloat(){const e=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(e),e}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map((e=>function(e,t){let r=1/0,s=-1/0;const i=e.length;let n,a=0;if(null!=t)for(n=0;n<i;n++)t[n]&&(a=e[n],r=a<r?a:r,s=a>s?a:s);else for(n=0;n<i;n++)a=e[n],r=a<r?a:r,s=a>s?a:s;return new c.SimpleBandStatistics(r,s)}(e,this.mask)));const e=this.mask;let t=0;if(null!=e)for(let r=0;r<e.length;r++)e[r]&&t++;else t=this.width*this.height;this.validPixelCount=t}clamp(e){if(!e||"f64"===e||"f32"===e||!this.pixels)return;const[t,r]=u.getPixelValueRange(e),s=this.pixels,i=this.width*this.height,n=s.length;let a,o,l;const c=[];for(let u=0;u<n;u++){l=h.createEmptyBand(e,i),a=s[u];for(let e=0;e<i;e++)o=a[e],l[e]=o>r?r:o<t?t:o;c.push(l)}this.pixels=c,this.pixelType=e}extractBands(e){const{pixels:t,statistics:r}=this;if(null==e||0===e.length||!t||0===t.length)return this;const s=t.length,i=e.some((e=>e>=t.length)),n=s===e.length&&!e.some(((e,t)=>e!==t));if(i||n)return this;const a=this.bandMasks?.length===s?e.map((e=>this.bandMasks[e])):void 0;let{mask:o,validPixelCount:l}=this;const{width:c,height:u}=this;return a?.length&&(o=h.combineBandMasks(a),l=o.filter((e=>!!e)).length),new h({pixelType:this.pixelType,width:c,height:u,mask:o,bandMasks:a,validPixelCount:l,maskIsAlpha:this.maskIsAlpha,pixels:e.map((e=>t[e])),statistics:r&&e.map((e=>r[e]))})}clone(){const e=new h({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});let t;null!=this.mask&&(e.mask=new Uint8Array(this.mask)),this.bandMasks&&(e.bandMasks=this.bandMasks.map((e=>new Uint8Array(e))));const r=h.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){e.pixels=[];const s=!!this.pixels[0].slice;for(t=0;t<this.pixels.length;t++)e.pixels[t]=s?this.pixels[t].slice():new r(this.pixels[t])}if(this.statistics)for(e.statistics=[],t=0;t<this.statistics.length;t++)e.statistics[t]=i.clone(this.statistics[t]);return e.premultiplyAlpha=this.premultiplyAlpha,e}_fillFrom8Bit(e){const{mask:t,maskIsAlpha:r,premultiplyAlpha:s,pixels:i}=this;if(!e||!i?.length)return void n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let a,o,l,c;a=o=l=i[0],i.length>=3?(o=i[1],l=i[2]):2===i.length&&(o=i[1]);const u=new Uint32Array(e),h=this.width*this.height;if(a.length===h)if(null!=t&&t.length===h)if(r)for(c=0;c<h;c++){const e=t[c];if(e){const t=e/255;u[c]=s?e<<24|l[c]*t<<16|o[c]*t<<8|a[c]*t:e<<24|l[c]<<16|o[c]<<8|a[c]}}else for(c=0;c<h;c++)t[c]&&(u[c]=255<<24|l[c]<<16|o[c]<<8|a[c]);else for(c=0;c<h;c++)u[c]=255<<24|l[c]<<16|o[c]<<8|a[c];else n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(e){const{pixels:t,mask:r,statistics:s}=this;if(!e||!t?.length)return void n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");const i=this.pixelType;let a=1,o=0,l=1;if(s&&s.length>0){for(const e of s)if(null!=e.minValue&&(o=Math.min(o,e.minValue)),null!=e.maxValue&&null!=e.minValue){const t=e.maxValue-e.minValue;l=Math.max(l,t)}a=255/l}else{let e=255;"s8"===i?(o=-128,e=127):"u16"===i?e=65535:"s16"===i?(o=-32768,e=32767):"u32"===i?e=4294967295:"s32"===i?(o=-2147483648,e=2147483647):"f32"===i?(o=-34e38,e=34e38):"f64"===i&&(o=-Number.MAX_VALUE,e=Number.MAX_VALUE),a=255/(e-o)}const c=new Uint32Array(e),u=this.width*this.height;let h,d,p,f,m;if(h=d=p=t[0],h.length!==u)return n.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(t.length>=2)if(d=t[1],t.length>=3&&(p=t[2]),null!=r&&r.length===u)for(f=0;f<u;f++)r[f]&&(c[f]=255<<24|(p[f]-o)*a<<16|(d[f]-o)*a<<8|(h[f]-o)*a);else for(f=0;f<u;f++)c[f]=255<<24|(p[f]-o)*a<<16|(d[f]-o)*a<<8|(h[f]-o)*a;else if(null!=r&&r.length===u)for(f=0;f<u;f++)m=(h[f]-o)*a,r[f]&&(c[f]=255<<24|m<<16|m<<8|m);else for(f=0;f<u;f++)m=(h[f]-o)*a,c[f]=255<<24|m<<16|m<<8|m}_fillFrom32Bit(e){const{pixels:t,mask:r}=this;if(!e||!t?.length)return n.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let s,i,a,o;s=i=a=t[0],t.length>=3?(i=t[1],a=t[2]):2===t.length&&(i=t[1]);const l=this.width*this.height;if(s.length!==l)return n.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let c=0;if(null!=r&&r.length===l)for(o=0;o<l;o++)e[c++]=s[o],e[c++]=i[o],e[c++]=a[o],e[c++]=1&r[o];else for(o=0;o<l;o++)e[c++]=s[o],e[c++]=i[o],e[c++]=a[o],e[c++]=1}},t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"width",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"height",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"pixelType",void 0),t.__decorate([o.cast("pixelType")],e.default.prototype,"castPixelType",null),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"validPixelCount",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"mask",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"maskIsAlpha",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"pixels",void 0),t.__decorate([a.property()],e.default.prototype,"premultiplyAlpha",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"statistics",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"depthCount",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"noDataValues",void 0),t.__decorate([a.property({json:{write:!0}})],e.default.prototype,"bandMasks",void 0),e.default=h=t.__decorate([l.subclass("esri.layers.support.PixelBlock")],e.default),e.default}))},"esri/layers/support/SimpleBandStatistics":function(){define(["exports"],(function(e){"use strict";e.SimpleBandStatistics=class{constructor(e=null,t=null,r=null){this.minValue=e,this.maxValue=t,this.noDataValue=r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/imagery/RasterTileContainer":function(){define(["exports","../../../../geometry/support/aaBoundingRect","../../viewpointUtils","./RasterTile","../webgl/enums","../webgl/TileContainer","../webgl/shaderGraph/techniques/raster/RasterColorizerTechnique","../webgl/shaderGraph/techniques/raster/RasterProcessorTechnique"],(function(e,t,r,s,i,n,a,o){"use strict";e.RasterTileContainer=class extends n{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(e){const t=this._getTileBounds(e),[r,i]=this.tileInfoView.tileInfo.size,n=this.tileInfoView.getTileResolution(e.level);return new s.RasterTile(e,n,t[0],t[3],r,i)}onAttach(){super.onAttach(),this._colorizerTechnique=new a.RasterColorizerTechnique,this._processorTechnique=new o.RasterProcessorTechnique}onDetach(){super.onDetach(),this._colorizerTechnique?.shutdown(),this._colorizerTechnique=void 0,this._processorTechnique?.shutdown(),this._processorTechnique=void 0}doRender(e){if(!this.visible||e.drawPhase!==i.WGLDrawPhase.MAP||!this._colorizerTechnique)return;const{rasterFunctionChain:t}=this;if(t?.functions?.length){if(!this._processorTechnique)return;const{functions:r,hasBranches:s}=t;for(const t of r){if("Constant"===t.name||"Identity"===t.name)continue;e.rasterFunction=t,e.hasBranches=s,super.doRender(e);const r=this.children.map((e=>e.bitmap));this._processorTechnique.render(e,{bitmaps:r})}}e.rasterFunction=null,super.doRender(e);const r=this.children.map((e=>e.bitmap));this._colorizerTechnique.render(e,{bitmaps:r})}_getTileBounds(e){const s=this.tileInfoView.getTileBounds(t.create(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:t}=this.tileInfoView,i=r.getWorldWidth(t.spatialReference);if(i){const r=t.lodAt(e.level);if(!r)return s;const{resolution:n}=r,a=n*t.size[0];s[0]=i*e.world+t.origin.x+e.col*a,s[2]=s[0]+a}}return s}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/imagery/RasterTile":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat3f32","./RasterBitmap","../webgl/TiledDisplayObject"],(function(e,t,r,s){"use strict";class i extends s.TiledDisplayObject{constructor(e,t,s,i,n,a,o=null){super(e,t,s,i,n,a),this.bitmap=null,this.bitmap=new r.RasterBitmap(o,null,null),this.bitmap.coordScale=[n,a],this.bitmap.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e){super.setTransform(e),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}_createTransforms(){return{displayViewScreenMat3:t.create(),tileMat3:t.create()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}e.RasterTile=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/imagery/RasterBitmap":function(){define(["exports","../../../../core/maybe","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../core/libs/gl-matrix-2/factories/vec2f32","../DisplayObject","../../../webgl/enums","../../../webgl/rasterUtils"],(function(e,t,r,s,i,n,a,o){"use strict";const l={bandCount:3,minOutput:0,maxOutput:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class c extends n.DisplayObject{constructor(e=null,t=null,r=null){super(),this._textureInvalidated=!0,this._colormapTextureInvalidated=!0,this._rasterTexture=null,this._maskTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,this._colormapTexture=null,this._colormap=null,this._supportsBilinearTexture=!0,this._processedTexture=null,this.functionTextures=[],this.projected=!1,this.stencilRef=0,this.coordScale=[1,1],this._processed=!1,this._symbolizerParameters=null,this.height=null,this.isRendereredSource=!1,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._mask=null,this.rawPixelData=null,this._suspended=!1,this._bandIds=null,this._interpolation=null,this._transformGrid=null,this.width=null,this.x=0,this.y=0,this.source=e,this.transformGrid=t,this.interpolation=r}destroy(){this._disposeTextures()}get processedTexture(){return this._processedTexture}set processedTexture(e){this._processedTexture!==e&&(this._disposeTextures(!0),this._processedTexture=e)}get rasterTexture(){return this._rasterTexture}set rasterTexture(e){this._rasterTexture!==e&&(this._rasterTexture?.dispose(),this._rasterTexture=e),null==e&&(this.projected=!1)}get processed(){return this._processed}set processed(e){this._processed=e,e||(this.processedTexture=t.disposeMaybe(this.processedTexture),this.invalidateTexture())}get symbolizerParameters(){return this._symbolizerParameters||l}set symbolizerParameters(e){this._symbolizerParameters!==e&&(this._symbolizerParameters=e,this._colormapTextureInvalidated=!0)}get source(){return this._source}set source(e){this._source!==e&&(this._source=e,this._rasterTexture&&(this._rasterTexture=t.disposeMaybe(this._rasterTexture),this._rasterTextureBandIds=null),this.projected=!1,this.invalidateTexture())}get mask(){return this._mask}set mask(e){this._mask!==e&&(this._mask=e,this._maskTexture=t.disposeMaybe(this._maskTexture))}get suspended(){return this._suspended}set suspended(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender()),this._suspended=e}get bandIds(){return this._bandIds}set bandIds(e){this._bandIds=e,this._isBandIdsChanged(e)&&(this.projected=!1,this.invalidateTexture())}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(e||"nearest")?a.TextureSamplingMode.LINEAR:a.TextureSamplingMode.NEAREST)}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid!==e&&(this._transformGrid=e,this._transformGridTexture=t.disposeMaybe(this._transformGridTexture))}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}getRasterTextureSize(e=!1){const t=e||this.projected;return[t?this.width:this.source?.width||this.width,t?this.height:this.source?.height||this.height]}getRasterCellSize(){const e=this.rawPixelData?.srcPixelSize,{projected:t,resolution:r}=this;return e&&!t?[e.x,e.y]:[r,r]}_createTransforms(){return{displayViewScreenMat3:s.create()}}setTransform(e){const t=r.identity(this.transforms.displayViewScreenMat3),[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),a=this.resolution/this.pixelRatio/e.resolution,o=a*this.width,l=a*this.height,c=Math.PI*this.rotation/180;r.translate(t,t,i.fromValues(s,n)),r.translate(t,t,i.fromValues(o/2,l/2)),r.rotate(t,t,-c),r.translate(t,t,i.fromValues(-o/2,-l/2)),r.scaleByVec2(t,t,i.fromValues(o,l)),r.multiply(this.transforms.displayViewScreenMat3,e.displayViewMat3,t)}getTextures({forProcessing:e=!1,useProcessedTexture:t=!1}={}){const r=t?this._processedTexture??this._rasterTexture:this._rasterTexture,s=[],i=[];return r?(this._transformGridTexture&&!this.projected&&(i.push(this._transformGridTexture),s.push("u_transformGrid")),i.push(r),s.push("u_image"),!this._colormapTexture||!t&&e||(i.push(this._colormapTexture),s.push("u_colormap")),this._maskTexture&&(i.push(this._maskTexture),s.push("u_mask")),{names:s,textures:i}):{names:s,textures:i}}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture({context:e}){if(!this.stage)return void this._disposeTextures();const t=this._isValidSource(this.source);t&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(e)),this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(e),this._rasterTexture&&(t?(this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=o.createTransformTexture(e,this.transformGrid)),this._mask&&!this._maskTexture&&(this._maskTexture=o.createPixelMaskTexture(e,this._mask,[this.width,this.height]))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}updateProcessedTexture(){const{functionTextures:e}=this;0!==e.length&&(this.processedTexture=e.shift(),e.forEach((e=>e?.dispose())),e.length=0,this.processed=!!this.processedTexture)}_createOrDestroyRasterTexture(e){const r=this.source?.extractBands(this.bandIds);if(!this._isValidSource(r))return void(this._rasterTexture&&(this._rasterTexture=t.disposeMaybe(this._rasterTexture),this._rasterTextureBandIds=null));const s=!this._isBandIdsChanged(this.bandIds);if(this._rasterTexture){if(s)return;this._rasterTexture=t.disposeMaybe(this._rasterTexture),this._rasterTextureBandIds=null}this._supportsBilinearTexture=!!e.capabilities.textureFloatLinear;const i=this._getTextureSamplingMethod(this.interpolation),n=this.isRendereredSource;this._rasterTexture=o.createRasterTexture(e,r,i,n),this.projected=!1,this._processed=!1,this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}_isBandIdsChanged(e){const t=this._rasterTextureBandIds;return!(null==t&&null==e||t&&e&&t.join("")===e.join(""))}_isValidSource(e){return null!=e&&e.pixels?.length>0}_getTextureSamplingMethod(e){const{type:t}=this.symbolizerParameters,r="lut"===t&&!this.symbolizerParameters.isClassBreaks||"hillshade"===t||"stretch"===t&&1===this.symbolizerParameters.bandCount;return!this._supportsBilinearTexture||r||"bilinear"!==e&&"cubic"!==e?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,s=this.symbolizerParameters.colormap;return s?r?s.length!==r.length||s.some(((e,t)=>e!==r[t]))?(this._colormapTexture&&(this._colormapTexture=t.disposeMaybe(this._colormapTexture)),this._colormapTexture=o.createColormapTexture(e,s),void(this._colormap=s)):void 0:(this._colormapTexture=o.createColormapTexture(e,s),void(this._colormap=s)):(this._colormapTexture&&(this._colormapTexture=t.disposeMaybe(this._colormapTexture)),void(this._colormap=null))}_disposeTextures(e=!1){e?this.projected&&(this._transformGridTexture=t.disposeMaybe(this._transformGridTexture)):(this._rasterTexture=t.disposeMaybe(this._rasterTexture),this._colormapTexture=t.disposeMaybe(this._colormapTexture),this._transformGridTexture=t.disposeMaybe(this._transformGridTexture),this._maskTexture=t.disposeMaybe(this._maskTexture),this._rasterTextureBandIds=null,this._colormap=null,this._colormapTextureInvalidated=!0),this._processedTexture=t.disposeMaybe(this._processedTexture)}}e.RasterBitmap=c,e.RasterBitmapWithSource=class extends c{get source(){return this._source}},e.hasSource=function(e){return null!=e.source},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/rasterUtils":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec2f64","./enums","./Texture","./TextureDescriptor"],(function(e,t,r,s,i){"use strict";e.createColormapTexture=function(e,t){const n=new i.TextureDescriptor;return n.internalFormat=r.PixelFormat.RGBA,n.width=t.length/4,n.height=1,n.samplingMode=r.TextureSamplingMode.NEAREST,n.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE,new s.Texture(e,n,t)},e.createPixelMaskTexture=function(e,t,n){const a=new i.TextureDescriptor;return a.internalFormat=r.PixelFormat.ALPHA,a.pixelFormat=r.PixelFormat.ALPHA,a.dataType=r.PixelType.UNSIGNED_BYTE,a.width=n[0],a.height=n[1],a.samplingMode=r.TextureSamplingMode.NEAREST,a.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE,new s.Texture(e,a,t)},e.createRasterTexture=function(e,t,n="nearest",a=!1){const o=!(a&&"u8"===t.pixelType),l=o?r.PixelType.FLOAT:r.PixelType.UNSIGNED_BYTE,c=null==t.pixels||0===t.pixels.length?null:o?t.getAsRGBAFloat():t.getAsRGBA(),u=e.capabilities.textureFloatLinear,h=new i.TextureDescriptor;return h.width=t.width,h.height=t.height,h.internalFormat=o?r.SizedPixelFormat.RGBA32F:r.PixelFormat.RGBA,h.samplingMode=!u||"bilinear"!==n&&"cubic"!==n?r.TextureSamplingMode.NEAREST:r.TextureSamplingMode.LINEAR,h.dataType=l,h.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE,new s.Texture(e,h,c)},e.createTransformTexture=function(e,t){const{spacing:n,offsets:a,coefficients:o,size:[l,c]}=t,u=n[0]>1,h=new i.TextureDescriptor;h.width=u?4*l:l,h.height=c,h.internalFormat=r.SizedPixelFormat.RGBA32F,h.dataType=r.PixelType.FLOAT,h.samplingMode=r.TextureSamplingMode.NEAREST,h.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;const d=new Float32Array(u?l*c*16:2*a.length);if(u&&null!=o)for(let e=0,t=0;e<o.length;e++)d[t++]=o[e],e%3==2&&(d[t++]=1);else for(let e=0;e<c;e++)for(let t=0;t<l;t++){const r=4*(e*l+t),s=2*(t*c+e);d[r]=a[s],d[r+1]=a[s+1],d[r+3]=-1===a[s]?0:1}return new s.Texture(e,h,d)},e.getColormapUniforms=function(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}},e.getCommonUniforms=function(e,r,s,i=1,n=!0){return{u_flipY:n,u_applyTransform:!!e,u_opacity:i,u_transformSpacing:e?e.spacing:t.ZEROS,u_transformGridSize:e?e.size:t.ZEROS,u_targetImageSize:r,u_srcImageSize:s}},e.getShadedReliefUniforms=function(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}},e.getStretchUniforms=function(e){return{u_bandCount:e.bandCount,u_minOutput:e.minOutput,u_maxOutput:e.maxOutput,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/RasterColorizerTechnique":function(){define(["exports","../Technique","../TechniqueType","../shaders/raster/RasterColorizerLUTShader","../shaders/raster/RasterColorizerShadedReliefShader","../shaders/raster/RasterColorizerStretchShader","../../../../../../webgl/enums"],(function(e,t,r,s,i,n,a){"use strict";class o extends t.Technique{constructor(){super(...arguments),this.name="BrushRasterColorizer",this.type=r.RasterTechniqueType.RasterColorizer,this.shaders={lut:new s.RasterColorizerLUTShader,stretch:new n.RasterColorizerStretchShader,shadedRelief:new i.RasterColorizerShadedReliefShader}}render(e,t){for(const r of t.bitmaps){if(!r.source||r.suspended)continue;e.timeline.begin(this.name);const{painter:t}=e;t.setPipelineState({depth:!1,stencil:{test:{mask:255,ref:r.stencilRef,compare:a.CompareFunction.EQUAL,op:{fail:a.StencilOperation.KEEP,zFail:a.StencilOperation.KEEP,zPass:a.StencilOperation.KEEP}},write:!1},color:{write:[!0,!0,!0,!0],blendMode:"composite"}}),r.updateTexture(e),r.processedTexture||r.updateProcessedTexture();const{type:s}=r.symbolizerParameters,i="stretch"===s?this._getStretchOptions(r):"lut"===s?this._getLutOptions(r):this._getShadedReliefOptions(r);"bilinear"!==r.interpolation||e.context.capabilities.textureFloatLinear||(i.defines.bilinear=!0),t.submitDrawMesh(e.context,i,t.quadMesh),e.timeline.end(this.name)}}_getLutOptions(e){const{config:t,projectionConfig:r,colormapConfig:s,pixelMaskConfig:i,projectionDefines:n}=this._getCommonConfig(e),a=this._getInterpolationDefines("nearest",!1);return{shader:this.shaders.lut,uniforms:{projectionConfig:r,config:t,colormapConfig:s,pixelMaskConfig:i},defines:{...n,...a,applyPixelMask:!!i},optionalAttributes:null,useComputeBuffer:!1}}_getStretchOptions(e){const t=e.symbolizerParameters,{config:r,projectionConfig:s,colormapConfig:i,pixelMaskConfig:n,projectionDefines:a}=this._getCommonConfig(e),o=this._getInterpolationDefines(e.interpolation,1===t.bandCount);return{shader:this.shaders.stretch,uniforms:{projectionConfig:s,config:r,stretchConfig:t,colormapConfig:i,pixelMaskConfig:n},defines:{...a,...o,isMultiband:t.bandCount>1,applyColormap:!!i,useGamma:t.useGamma,noOp:e.isRendereredSource&&!e.processed,applyPixelMask:!!n},optionalAttributes:null,useComputeBuffer:!1}}_getShadedReliefOptions(e){const t=e.symbolizerParameters,{config:r,projectionConfig:s,colormapConfig:i,pixelMaskConfig:n,projectionDefines:a}=this._getCommonConfig(e),o=this._getInterpolationDefines(e.interpolation,!0);return{shader:this.shaders.shadedRelief,uniforms:{projectionConfig:s,config:r,hillshadeConfig:t,colormapConfig:i,pixelMaskConfig:n},defines:{...a,...o,isMultidirectional:t.hillshadeType>0,applyColormap:!!i,applyPixelMask:!!n},optionalAttributes:null,useComputeBuffer:!1}}_getCommonConfig(e){const{coordScale:t,computedOpacity:r,transforms:s}=e,{names:i,textures:n}=e.getTextures({useProcessedTexture:e.processed}),a=n[i.indexOf("u_image")],o=e.getRasterTextureSize(),l={texture:{texture:a,unit:0},dvsMat3:s.displayViewScreenMat3,coordScale:t,srcImageSize:o,opacity:r},c=n[i.indexOf("u_transformGrid")],{transformGrid:u}=e,h=!(!c||!u),d=h?{transformTexture:{texture:c,unit:2},targetImageSize:[e.width,e.height],transformSpacing:u.spacing,transformGridSize:u.size}:void 0,p=n[i.indexOf("u_colormap")],{colormap:f,colormapOffset:m}=e.symbolizerParameters,g=p&&f?{colormapTexture:{texture:p,unit:1},colormapOffset:m??0,colormapMaxIndex:f.length/4-1}:void 0,y=n[i.indexOf("u_mask")];return{config:l,projectionConfig:d,colormapConfig:g,pixelMaskConfig:y?{maskTexture:{texture:y,unit:3}}:void 0,projectionDefines:{applyProjection:h,lookupProjection:h&&1===u.spacing[0]}}}_getInterpolationDefines(e,t){const r="bilinear"===e&&t;return{bilinear:r,bicubic:"cubic"===e,nearestOnEdge:r}}}e.RasterColorizerTechnique=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/RasterColorizerLUTShader":function(){define(["exports","../../../../../../../../chunks/tslib.es6","../../../GraphShaderModule","../../../graph/glsl","./BaseRasterColorizerShader","./lut"],(function(e,t,r,s,i,n){"use strict";class a extends i.BaseRasterColorizerShader{constructor(){super(...arguments),this.type="RasterColorizerLUTShader"}_colorize(e){const t=this._getPixel(e);return n.lookupColor(t,new s.Float(1),this.colormapConfig,!1)}}t.__decorate([r.uniform(n.ColormapConfig)],a.prototype,"colormapConfig",void 0),e.RasterColorizerLUTShader=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/BaseRasterColorizerShader":function(){define(["exports","../../../../../../../../chunks/tslib.es6","../../../GraphShaderModule","../../../graph/glsl","./projection"],(function(e,t,r,s,i){"use strict";class n extends r.VertexInput{}t.__decorate([r.location(0,s.Vec2)],n.prototype,"position",void 0);class a extends r.FragmentInput{}class o extends r.UniformGroup{}t.__decorate([r.uniform(s.Sampler2D)],o.prototype,"texture",void 0),t.__decorate([r.uniform(s.Mat3)],o.prototype,"dvsMat3",void 0),t.__decorate([r.uniform(s.Vec2)],o.prototype,"coordScale",void 0),t.__decorate([r.uniform(s.Vec2)],o.prototype,"srcImageSize",void 0),t.__decorate([r.uniform(s.Float)],o.prototype,"opacity",void 0);class l extends r.UniformGroup{}t.__decorate([r.uniform(s.Sampler2D)],l.prototype,"maskTexture",void 0);class c extends r.GraphShaderModule{constructor(){super(...arguments),this.applyProjection=!0,this.lookupProjection=!1,this.bilinear=!1,this.bicubic=!1,this.nearestOnEdge=!1,this.applyPixelMask=!1}vertex(e){const t=e.position,{dvsMat3:r,coordScale:i}=this.config,n=r.multiply(new s.Vec3(t.multiply(i),1));return{uv:t,glPosition:new s.Vec4(n,1)}}fragment(e){const t=new r.FragmentOutput,n=i.getPixelLocation(e.uv,this.applyProjection?this.projectionConfig:void 0,this.lookupProjection),a=s.ifElse(i.isOutside(n),new s.Vec4(0,0,0,0),this._colorize(n));let o=a.a.multiply(this.config.opacity);if(this.applyPixelMask){const t=this._getPixelMask(e.uv);o=o.multiply(t)}return t.fragColor=new s.Vec4(a.rgb,1).multiply(o),t}_getPixel(e){const{config:t,bicubic:r,bilinear:s,nearestOnEdge:n}=this;return i.getPixel(e,t,{bicubic:r,bilinear:s,nearestOnEdge:n})}_getPixelMask(e){const{maskTexture:t}=this.pixelMaskConfig,r=s.texture2D(t,e);return s.sign(r.a)}}t.__decorate([r.define],c.prototype,"applyProjection",void 0),t.__decorate([r.define],c.prototype,"lookupProjection",void 0),t.__decorate([r.define],c.prototype,"bilinear",void 0),t.__decorate([r.define],c.prototype,"bicubic",void 0),t.__decorate([r.define],c.prototype,"nearestOnEdge",void 0),t.__decorate([r.define],c.prototype,"applyPixelMask",void 0),t.__decorate([r.uniform(o)],c.prototype,"config",void 0),t.__decorate([r.option(i.ProjectionConfig)],c.prototype,"projectionConfig",void 0),t.__decorate([r.option(l)],c.prototype,"pixelMaskConfig",void 0),t.__decorate([t.__param(0,r.input(n))],c.prototype,"vertex",null),t.__decorate([t.__param(0,r.input(a))],c.prototype,"fragment",null),e.BaseRasterColorizerShader=c,e.PixelMaskConfig=l,e.RasterColorizerFragmentInput=a,e.RasterConfig=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/projection":function(){define(["exports","../../../../../../../../chunks/tslib.es6","../../../GraphShaderModule","../../../graph/glsl","../bitmapUtils","../utils","./sampleBilinear"],(function(e,t,r,s,i,n,a){"use strict";class o extends r.UniformGroup{}t.__decorate([r.uniform(s.Sampler2D)],o.prototype,"transformTexture",void 0),t.__decorate([r.uniform(s.Vec2)],o.prototype,"targetImageSize",void 0),t.__decorate([r.uniform(s.Vec2)],o.prototype,"transformSpacing",void 0),t.__decorate([r.uniform(s.Vec2)],o.prototype,"transformGridSize",void 0),e.ProjectionConfig=o,e.getPixel=function(e,t,r){const{bicubic:n=!1,bilinear:o=!1,nearestOnEdge:l=!1}=r??{};return n||o?n?i.sampleBicubicBSpline(t.texture,e,t.srcImageSize):a.sampleBilinear(t.texture,e,t.srcImageSize,l):s.texture2D(t.texture,e)},e.getPixelLocation=function(e,t,r=!1){return t?r?function(e,t){const r=s.texture2D(t.transformTexture,e);return new s.Vec2(r.r,r.g)}(e,t):function(e,t){const{transformTexture:r,targetImageSize:i,transformSpacing:n}=t,a=s.floor(e.multiply(i)),o=new s.Vec2(4,1),l=s.floor(a.divide(n)).multiply(o),c=s.fract(a.add(new s.Vec2(.5,.5)).divide(n)),u=new s.IVec2(s.int(l.x),s.int(l.y)),h=new s.Vec3(c,1);return s.ifElse(s.lessThanEqual(c.x,c.y),function(e,t,r){const i=s.texelFetch(e,t,new s.Int(0)),n=new s.IVec2(t.x.add(1),t.y),a=s.texelFetch(e,n,new s.Int(0));return new s.Vec2(s.dot(i.rgb,r),s.dot(a.rgb,r))}(r,u,h),function(e,t,r){const i=new s.IVec2(t.x.add(2),t.y),n=s.texelFetch(e,i,new s.Int(0)),a=new s.IVec2(t.x.add(3),t.y),o=s.texelFetch(e,a,new s.Int(0));return new s.Vec2(s.dot(n.rgb,r),s.dot(o.rgb,r))}(r,u,h))}(e,t):e},e.isOutside=function(e){const t=s.step(new s.Vec2(-1e-5,-1e-5),e).multiply(s.step(e,new s.Vec2(1.00001,1.00001))),r=n.oneMinus(t.x.multiply(t.y));return new s.Bool(r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/sampleBilinear":function(){define(["exports","../../../graph/glsl","../utils"],(function(e,t,r){"use strict";e.sampleBilinear=function(e,s,i,n){const a=t.floor(s.multiply(i)),o=new t.IVec2(new t.Int(a.x),new t.Int(a.y)),l=new t.IVec2(o.x.add(1),o.y),c=new t.IVec2(o.x,o.y.add(1)),u=new t.IVec2(o.x.add(1),o.y.add(1)),h=t.texelFetch(e,o,new t.Int(0)),d=t.texelFetch(e,l,new t.Int(0)),p=t.texelFetch(e,c,new t.Int(0)),f=t.texelFetch(e,u,new t.Int(0)),m=t.fract(s.multiply(i)),g=t.mix(h,d,m.x),y=t.mix(p,f,m.x),x=t.mix(g,y,m.y);if(!n)return x;const w=new t.Vec4(h.a,d.a,p.a,f.a),b=w.xy.multiply(w.zw),_=t.floor(b.x.multiply(b.y).add(.5)),v=x.multiply(_),S=r.oneMinus(_).multiply(t.texture2D(e,s));return v.add(S)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/lut":function(){define(["exports","../../../../../../../../chunks/tslib.es6","../../../GraphShaderModule","../../../graph/glsl"],(function(e,t,r,s){"use strict";class i extends r.UniformGroup{}t.__decorate([r.uniform(s.Sampler2D)],i.prototype,"colormapTexture",void 0),t.__decorate([r.uniform(s.Float)],i.prototype,"colormapOffset",void 0),t.__decorate([r.uniform(s.Float)],i.prototype,"colormapMaxIndex",void 0),e.ColormapConfig=i,e.lookupColor=function(e,t,r,i=!0){const{colormapTexture:n,colormapOffset:a,colormapMaxIndex:o}=r,l=e.r.multiply(t).subtract(a),c=s.clamp(l,new s.Float(0),o),u=new s.Vec2(c.add(.5).divide(o.add(1)),0),h=s.texture2D(n,u),d=new s.Vec4(h.rgb,h.a.multiply(e.a));if(i)return d;const p=s.step(new s.Float(0),l).multiply(s.step(l,r.colormapMaxIndex));return d.multiply(p)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/RasterColorizerShadedReliefShader":function(){define(["exports","../../../../../../../../chunks/tslib.es6","../../../GraphShaderModule","../../../graph/glsl","./BaseRasterColorizerShader","./colorConversion","./lut","./surface"],(function(e,t,r,s,i,n,a,o){"use strict";class l extends i.BaseRasterColorizerShader{constructor(){super(...arguments),this.type="RasterColorizerShadedReliefShader",this.applyColormap=!1,this.isMultidirectional=!1}_colorize(e){const{texture:t}=this.config,r=o.getSurfaceValues(t,e,this.config.srcImageSize),i=o.hillshade(r,this.hillshadeConfig,this.isMultidirectional);if(!this.applyColormap)return new s.Vec4(i.x,i.x,i.x,i.a);const{minValue:l,maxValue:c}=this.hillshadeConfig,u=this._getPixel(e),h=c.subtract(l),d=u.r.subtract(l),p=s.clamp(d.divide(h),new s.Float(0),new s.Float(1)),f=a.lookupColor(new s.Vec4(p,p,p,1),new s.Float(255),this.colormapConfig),m=n.rgb2hsv(f.xyz),g=n.hsv2rgb(new s.Vec3(m.xy,i.x));return new s.Vec4(g,f.a.multiply(i.a))}}t.__decorate([r.define],l.prototype,"applyColormap",void 0),t.__decorate([r.define],l.prototype,"isMultidirectional",void 0),t.__decorate([r.uniform(o.HillshadeConfig)],l.prototype,"hillshadeConfig",void 0),t.__decorate([r.option(a.ColormapConfig)],l.prototype,"colormapConfig",void 0),e.RasterColorizerShadedReliefShader=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/colorConversion":function(){define(["exports","../../../graph/glsl"],(function(e,t){"use strict";e.hsv2rgb=function(e){const r=new t.Vec4(1,2/3,1/3,3),s=t.abs(t.fract(e.xxx.add(r.xyz)).multiply(6).subtract(r.www)),i=t.clamp(s.subtract(r.xxx),new t.Vec3(0,0,0),new t.Vec3(1));return e.z.multiply(t.mix(r.xxx,i,e.y))},e.rgb2hsv=function(e){const r=new t.Vec4(0,-1/3,2/3,-1),s=t.ifElse(t.lessThan(e.y,e.z),new t.Vec4(e.zy,r.wz),new t.Vec4(e.yz,r.xy)),i=t.ifElse(t.lessThan(e.x,s.x),new t.Vec4(s.xyw,e.x),new t.Vec4(e.x,s.yzx)),n=i.x.subtract(t.min(i.w,i.y)),a=new t.Float(1e-10),o=i.w.subtract(i.y),l=n.multiply(6).add(a),c=t.abs(o.divide(l).add(i.z)),u=i.x.add(a),h=t.min(n.divide(u),new t.Float(1));return new t.Vec3(c,h,i.x)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/surface":function(){define(["exports","../../../../../../../../chunks/tslib.es6","../../../GraphShaderModule","../../../graph/glsl"],(function(e,t,r,s){"use strict";class i extends r.UniformGroup{}function n(e){const t=s.abs(e),r=s.step(t,new s.Vec2(1,1)).multiply(t),i=new s.Float(2).subtract(t),n=s.step(new s.Float(1),t).multiply(i);return r.add(n)}function a(e,t){const r=new s.Vec4(e[5],e[3],e[7],e[1]).multiply(2),i=new s.Vec3(e[2],r[0],e[8]),n=new s.Vec3(e[0],r[1],e[6]),a=s.dot(i.subtract(n),new s.Vec3(1)),o=new s.Vec3(e[6],r[2],e[8]),l=new s.Vec3(e[0],r[3],e[2]),c=s.dot(o.subtract(l),new s.Vec3(1));return new s.Vec2(a,c).multiply(t)}function o(e){const t=e.sinZsinA.multiply(e.dzxy.y),r=e.sinZcosA.multiply(e.dzxy.x),i=t.subtract(r),n=e.cosZ.add(i).divide(e.dzd);return n.multiply(s.step(new s.Float(0),n)).multiply(e.weights)}t.__decorate([r.uniform(s.FixedArray.ofType(s.Float,6))],i.prototype,"sinZcosAs",void 0),t.__decorate([r.uniform(s.FixedArray.ofType(s.Float,6))],i.prototype,"sinZsinAs",void 0),t.__decorate([r.uniform(s.FixedArray.ofType(s.Float,6))],i.prototype,"cosZs",void 0),t.__decorate([r.uniform(s.FixedArray.ofType(s.Float,6))],i.prototype,"weights",void 0),t.__decorate([r.uniform(s.Float)],i.prototype,"minValue",void 0),t.__decorate([r.uniform(s.Float)],i.prototype,"maxValue",void 0),t.__decorate([r.uniform(s.Vec2)],i.prototype,"factor",void 0),e.HillshadeConfig=i,e.computeDeltaZ=a,e.computeZFactor=function(e,t){const{pixelSizeFactor:r}=e,s=[e.factor[0]/t[0],e.factor[1]/t[1]];if(r>0){const{zFactor:i,pixelSizePower:n,gcsFactor:a}=e,o=t[0]*a,l=t[1]*a;s[0]=(i+o**n*r)/(8*o),s[1]=(i+l**n*r)/(8*l)}return s},e.getSurfaceValues=function(e,t,r){const i=new s.Float(1).divide(r),a=s.texture2D(e,n(i.multiply(new s.Vec2(-1,-1)).add(t))),o=s.texture2D(e,n(i.multiply(new s.Vec2(0,-1)).add(t))),l=s.texture2D(e,n(i.multiply(new s.Vec2(1,-1)).add(t))),c=s.texture2D(e,n(i.multiply(new s.Vec2(-1,0)).add(t))),u=s.texture2D(e,n(t)),h=s.texture2D(e,n(i.multiply(new s.Vec2(1,0)).add(t))),d=s.texture2D(e,n(i.multiply(new s.Vec2(-1,1)).add(t))),p=s.texture2D(e,n(i.multiply(new s.Vec2(0,1)).add(t))),f=s.texture2D(e,n(i.multiply(new s.Vec2(1,1)).add(t))),m=new s.Vec4(a.a,o.a,l.a,c.a),g=new s.Vec4(h.a,d.a,p.a,f.a),y=m.multiply(g),x=y.xy.multiply(y.zw),w=x.x.multiply(x.y).multiply(u.a),b=new s.FixedArray(new s.Float(0),10);return b[0]=a.r,b[1]=o.r,b[2]=l.r,b[3]=c.r,b[4]=u.r,b[5]=h.r,b[6]=d.r,b[7]=p.r,b[8]=f.r,b[9]=w,b},e.hillshade=function(e,t,r){const{factor:i}=t,n=a(e,i),l=s.sqrt(s.dot(n,n).add(1)),c=e[9],{sinZsinAs:u,sinZcosAs:h,cosZs:d,weights:p}=t;if(!r){const e=o({sinZsinA:u[0],sinZcosA:h[0],cosZ:d[0],weights:new s.Float(1),dzxy:n,dzd:l});return new s.Vec4(e,e,e,c)}const f=o({sinZsinA:new s.Vec3(u[0],u[1],u[2]),sinZcosA:new s.Vec3(h[0],h[1],h[2]),cosZ:new s.Vec3(d[0],d[1],d[2]),weights:new s.Vec3(p[0],p[1],p[2]),dzxy:n,dzd:l}),m=o({sinZsinA:new s.Vec3(u[3],u[4],u[5]),sinZcosA:new s.Vec3(h[3],h[5],h[5]),cosZ:new s.Vec3(d[3],d[4],d[5]),weights:new s.Vec3(p[3],p[4],p[5]),dzxy:n,dzd:l}),g=s.dot(f.add(m),new s.Vec3(1));return new s.Vec4(g,g,g,c)},e.mirror=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/RasterColorizerStretchShader":function(){define(["exports","../../../../../../../../chunks/tslib.es6","../../../GraphShaderModule","../../../graph/glsl","./BaseRasterColorizerShader","./lut","./stretch"],(function(e,t,r,s,i,n,a){"use strict";class o extends i.BaseRasterColorizerShader{constructor(){super(...arguments),this.type="RasterColorizerStretchShader",this.isMultiband=!0,this.applyColormap=!1,this.useGamma=!1,this.noOp=!1}_colorize(e){const t=this._getPixel(e);if(this.noOp)return t;let r=a.stretch(t,this.stretchConfig,this.useGamma);if(this.isMultiband)return r;if(r=new s.Vec4(r.rrr,r.a),this.applyColormap){const e=this.useGamma?255:1;r=n.lookupColor(r,new s.Float(e),this.colormapConfig)}return r}}t.__decorate([r.define],o.prototype,"isMultiband",void 0),t.__decorate([r.define],o.prototype,"applyColormap",void 0),t.__decorate([r.define],o.prototype,"useGamma",void 0),t.__decorate([r.define],o.prototype,"noOp",void 0),t.__decorate([r.uniform(a.StretchConfig)],o.prototype,"stretchConfig",void 0),t.__decorate([r.option(n.ColormapConfig)],o.prototype,"colormapConfig",void 0),e.RasterColorizerStretchShader=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/stretch":function(){define(["exports","../../../../../../../../chunks/tslib.es6","../../../GraphShaderModule","../../../graph/glsl","../utils"],(function(e,t,r,s,i){"use strict";class n extends r.UniformGroup{}t.__decorate([r.uniform(s.Float)],n.prototype,"minOutput",void 0),t.__decorate([r.uniform(s.Float)],n.prototype,"maxOutput",void 0),t.__decorate([r.uniform(s.Vec3)],n.prototype,"minCutOff",void 0),t.__decorate([r.uniform(s.Vec3)],n.prototype,"maxCutOff",void 0),t.__decorate([r.uniform(s.Vec3)],n.prototype,"factor",void 0),t.__decorate([r.uniform(s.Vec3)],n.prototype,"gamma",void 0),t.__decorate([r.uniform(s.Vec3)],n.prototype,"gammaCorrection",void 0),e.StretchConfig=n,e.stretch=function(e,t,r,n=255){const a=r?function(e,t){const{minCutOff:r,maxCutOff:n,minOutput:a,maxOutput:o,gamma:l,gammaCorrection:c}=t,u=s.clamp(e,r,n).subtract(r),h=n.subtract(r),d=u.divide(h),p=s.step(new s.Float(1),l),f=s.sign(l.subtract(1)),m=o.subtract(a),g=new s.Vec3(1),y=s.pow(g.divide(m),d.multiply(c)),x=i.oneMinus(p.multiply(f).multiply(y)),w=s.pow(d,g.divide(l)),b=x.multiply(m).multiply(w).add(a);return s.clamp(b,a,o)}(e.rgb,t).divide(n):function(e,t){const{minCutOff:r,maxCutOff:i,factor:n,minOutput:a}=t;return s.clamp(e,r,i).subtract(r).multiply(n).add(a)}(e.rgb,t);return new s.Vec4(a,e.a)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/RasterProcessorTechnique":function(){define(["exports","../../../definitions","../Technique","../TechniqueType","./processor/AspectTechnique","./processor/BandArithmeticTechnique","./processor/ColormapToRGBTechnique","./processor/CompositeBandTechnique","./processor/ComputeChangeTechnique","./processor/ContrastBrightnessTechnique","./processor/ConvolutionTechnique","./processor/CurvatureTechnique","./processor/ExtractBandTechnique","./processor/FocalStatisticsTechnique","./processor/GrayscaleTechnique","./processor/HillshadeTechnique","./processor/LocalTechnique","./processor/MaskTechnique","./processor/NDVITechnique","./processor/RemapTechnique","./processor/ReprojectTechnique","./processor/ShadedReliefTechnique","./processor/SlopeTechnique","./processor/StretchTechnique","./processor/textureUtils"],(function(e,t,r,s,i,n,a,o,l,c,u,h,d,p,f,m,g,y,x,w,b,_,v,S,T){"use strict";const M=new Map([["Aspect",i.AspectTechnique],["BandArithmetic",n.BandArithmeticTechnique],["ColormapToRGB",a.ColormapToRGBTechnique],["CompositeBand",o.CompositeBandTechnique],["ComputeChange",l.ComputeChangeTechnique],["ContrastBrightness",c.ContrastBrightnessTechnique],["Convolution",u.ConvolutionTechnique],["Curvature",h.CurvatureTechnique],["ExtractBand",d.ExtractBandTechnique],["Grayscale",f.GrayscaleTechnique],["Hillshade",m.HillshadeTechnique],["Local",g.LocalTechnique],["Mask",y.MaskTechnique],["NDVI",x.NDVITechnique],["Remap",w.RemapTechnique],["Reproject",b.ReprojectTechnique],["ShadedRelief",_.ShadedReliefTechnique],["Slope",v.SlopeTechnique],["Statistics",p.FocalStatisticsTechnique],["Stretch",S.StretchTechnique]]);class R extends r.Technique{constructor(){super(...arguments),this.type=s.RasterTechniqueType.RasterProcessor,this.shaders={},this._techniques=new Map}shutdown(e){super.shutdown(e),this._fbo?.dispose(),this._fbo=void 0;for(const e of this._techniques.values())e.shutdown();this._techniques.clear()}render(e,r){this._fbo??=T.createNewFBO(e.context,t.tileSize,t.tileSize);let{name:s}=e.rasterFunction;if("Arithmetic"===s&&(s="Local"),!this._techniques.has(s)){const e=M.get(s);if(!e)return;this._techniques.set(s,new e)}this._techniques.get(s).render(e,{...r,processorFbo:this._fbo})}}e.RasterProcessorTechnique=R,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/AspectTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/AspectShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterAspectProcessor",this.type=t.RasterTechniqueType.Aspect,this.shaders={aspect:new s.AspectShader}}_process(e,t){const r={cellSize:t.getRasterCellSize()},s=this._getCommonConfig(e,t),i={shader:this.shaders.aspect,uniforms:{config:s,aspectConfig:r},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:a}=e;n.submitDrawMesh(a,i,n.quadMesh)}}e.AspectTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/BaseRasterProcessorTechnique":function(){define(["exports","../../../../../../../../core/maybe","../../../../definitions","../../Technique","./textureUtils","../../../../../../../webgl/enums","../../../../../../../webgl/rasterUtils"],(function(e,t,r,s,i,n,a){"use strict";class o extends s.Technique{shutdown(e){super.shutdown(e),this._fbo?.dispose(),this._fbo=void 0}render(e,s){const{rasterFunction:o}=e;if(!o)return;const{context:l}=e,c="indexedColormap"in o.parameters?a.createColormapTexture(l,o.parameters.indexedColormap):void 0,u="Reproject"===o.name,h=l.getBoundFramebufferObject(),d=l.getViewport();for(const a of s.bitmaps){const h=u?!(a.rasterTexture&&a.projected):!a.processed;if(!a.source||!h||a.suspended)continue;e.timeline.begin(this.name);const{painter:d}=e;d.setPipelineState({depth:!1,stencil:{test:!1,write:!1},color:{write:[!0,!0,!0,!0],blendMode:"custom",blendParameters:{srcRGB:n.BlendFactor.ONE,dstRGB:n.BlendFactor.ZERO,srcAlpha:n.BlendFactor.ONE,dstAlpha:n.BlendFactor.ZERO}}}),u||(a.processedTexture=t.disposeMaybe(a.processedTexture)),a.updateTexture(e);const[p,f]=a.getRasterTextureSize(u),m=p===r.tileSize&&f===r.tileSize,g=m?s.processorFbo:i.createNewFBO(l,p,f);l.bindFramebuffer(g),l.setViewport(0,0,g.width,g.height),this._process(e,a,c);const y=i.createProcessedTexture(e.context,p,f);if(g.copyToTexture(0,0,p,f,0,0,y),u)a.rasterTexture=y;else{const t=e.hasBranches?o.id:0;a.functionTextures[t]=y}m||g.dispose(),e.timeline.end(this.name)}c?.dispose(),l.bindFramebuffer(h),l.setViewport(d.x,d.y,d.width,d.height)}_getCommonConfig(e,t){const{rasterFunction:r,hasBranches:s}=e,{raster:i,rasters:n}=r.parameters,a=s?i?.id??n?.filter((e=>"Constant"!==e.name))?.[0]?.id??-1:0,o=t.functionTextures[a]??t.rasterTexture,l="Reproject"===r.name;return{texture:{texture:o,unit:0},srcImageSize:t.getRasterTextureSize(l)}}_getMultipleInputConfig(e,t){return t?.length?2===t.length?{twoRasterConfig:this._getTwoInputConfig(t,e)}:3===t.length?{threeRasterConfig:this._getThreeInputConfig(t,e)}:{}:{}}_getConstantCount(e){return e?.filter((e=>"Constant"===e.name)).length??0}_getTextures(e,t){return e.filter((e=>"Constant"!==e.name)).map((e=>null!=e.id&&"Identity"!==e.name?t.functionTextures[e.id]:t.rasterTexture))}_getTwoInputConfig(e,t){const r=this._getTextures(e,t),s=r[1]?{texture:r[1],unit:1}:void 0,i=e.findIndex((e=>"Constant"===e.name)),n=0===i?new Float32Array([0,1,0,1,0,0,0,0,0]):new Float32Array([1,0,0,0,1,0,0,0,0]);return{image1:s,image1Const:i>-1?e[i].parameters.value:0,imageSwap:n}}_getThreeInputConfig(e,t){const r=this._getTextures(e,t);let s=0,i=0,n=new Float32Array([1,0,0,0,1,0,0,0,1]);const a=r[1]?{texture:r[1],unit:1}:void 0,o=r[2]?{texture:r[2],unit:2}:void 0,l=[];if(e.forEach(((e,t)=>"Constant"===e.name&&l.push(t))),1===l.length)s=e[l[0]].parameters.value,n=0===l[0]?new Float32Array([0,1,0,0,0,1,1,0,0]):1===l[0]?new Float32Array([1,0,0,0,0,1,0,1,0]):new Float32Array([1,0,0,0,1,0,0,0,1]);else if(2===l.length){s=e[l[0]].parameters.value,i=e[l[1]].parameters.value;const t=e.findIndex((e=>"Constant"!==e.name));n=0===t?new Float32Array([1,0,0,0,1,0,0,0,1]):1===t?new Float32Array([0,1,0,1,0,0,0,0,1]):new Float32Array([0,0,1,1,0,0,0,1,0])}return{image1:a,image2:o,image1Const:s,image2Const:i,imageSwap:n}}}e.BaseRasterProcessorTechnique=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/textureUtils":function(){define(["exports","../../../../../../../webgl/enums","../../../../../../../webgl/FramebufferObject","../../../../../../../webgl/Texture","../../../../../../../webgl/TextureDescriptor"],(function(e,t,r,s,i){"use strict";function n(e,r){const s=new i.TextureDescriptor;return s.width=e,s.height=r,s.internalFormat=t.SizedPixelFormat.RGBA32F,s.samplingMode=t.TextureSamplingMode.NEAREST,s.dataType=t.PixelType.FLOAT,s.isImmutable=!0,s.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE,s}e.createNewFBO=function(e,t,s){const i=n(t,s);return new r.FramebufferObject(e,i)},e.createProcessedTexture=function(e,t,r){const i=n(t,r);return new s.Texture(e,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/AspectShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../surface","./BaseRasterProcessorShader"],(function(e,t,r,s,i,n){"use strict";class a extends r.UniformGroup{}t.__decorate([r.uniform(s.Vec2)],a.prototype,"cellSize",void 0);class o extends n.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="AspectShader"}_process(e){const{texture:t}=this.config,r=i.getSurfaceValues(t,e,this.config.srcImageSize),n=new s.Vec2(1).divide(this.aspectConfig.cellSize.multiply(8)),{x:a,y:o}=i.computeDeltaZ(r,n),l=s.negate(o),c=r[9].multiply(s.sign(s.abs(a).add(s.abs(l)))),u=s.abs(s.sign(a)),h=new s.Float(3.14159265359),d=new s.Float(0),p=s.step(d,l).multiply(.5).multiply(h).add(s.step(l,d).multiply(1.5).multiply(h)),f=s.mod(new s.Float(2.5).multiply(h).add(s.atan(l,s.negate(a))),new s.Float(2).multiply(h)),m=s.mix(p,f,u).multiply(180).divide(h);return new s.Vec4(m,m,m,c)}}t.__decorate([r.uniform(a)],o.prototype,"aspectConfig",void 0),e.AspectShader=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/BaseRasterProcessorShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../../utils","../projection"],(function(e,t,r,s,i,n){"use strict";class a extends r.VertexInput{}t.__decorate([r.location(0,s.Vec2)],a.prototype,"position",void 0);class o extends r.FragmentInput{}class l extends r.UniformGroup{}t.__decorate([r.uniform(s.Sampler2D)],l.prototype,"texture",void 0),t.__decorate([r.uniform(s.Vec2)],l.prototype,"srcImageSize",void 0);class c extends r.GraphShaderModule{vertex(e){return{uv:e.position,glPosition:new s.Vec4(i.uvToClip(e.position),0,1)}}fragment(e){const t=new r.FragmentOutput,i=n.getPixelLocation(e.uv),a=this._process(i);return t.fragColor=new s.Vec4(a.rgb,1).multiply(a.a),t}_getPixel(e){return n.getPixel(e,this.config)}}t.__decorate([r.uniform(l)],c.prototype,"config",void 0),t.__decorate([t.__param(0,r.input(a))],c.prototype,"vertex",null),t.__decorate([t.__param(0,r.input(o))],c.prototype,"fragment",null),e.BaseRasterProcessorShader=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/BandArithmeticTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/BandArithmeticShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterBandArithmeticProcessor",this.type=t.RasterTechniqueType.BandArithmetic,this.shaders={bandArithmetic:new s.BandArithmeticShader}}_process(e,t){const r=e.rasterFunction.parameters,s={indexType:r.indexType,isOutputRounded:r.isOutputRounded},i={bandIndexMat3:r.bandIndexMat3},n=r.adjustments?{adjustments:[...r.adjustments]}:void 0,a=this._getCommonConfig(e,t),o={shader:this.shaders.bandArithmetic,uniforms:{config:a,bandArithmeticConfig:i,adjustmentConfig:n},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:l,context:c}=e;l.submitDrawMesh(c,o,l.quadMesh)}}e.BandArithmeticTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/BandArithmeticShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../../utils","./BaseRasterProcessorShader","./math"],(function(e,t,r,s,i,n,a){"use strict";class o extends r.UniformGroup{}t.__decorate([r.uniform(s.Mat3)],o.prototype,"bandIndexMat3",void 0);class l extends r.UniformGroup{}t.__decorate([r.uniform(s.Vec3)],l.prototype,"adjustments",void 0);class c extends n.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="BandArithmeticShader",this.isOutputRounded=!1}_process(e){const t=this._getPixel(e),r=this.bandArithmeticConfig.bandIndexMat3.multiply(t.rgb),i=this._processIndex(r),n=new s.Vec4(i,i,i,t.a);return this.isOutputRounded?a.roundOutput(n):n}_processIndex(e){const{r:t,g:r}=e,n=this.adjustmentConfig?.adjustments;switch(this.indexType){case"ndxi":{const e=t.subtract(r),s=t.add(r);return e.multiply(a.invertValue(s))}case"sr":return t.multiply(a.invertValue(r));case"ci":return t.multiply(a.invertValue(r)).subtract(1);case"savi":{const{x:e}=n,s=t.subtract(r),i=t.add(r).add(e);return s.multiply(a.invertValue(i)).multiply(e.add(1))}case"tsavi":{const{x:e,y:s,z:i}=n,o=i.multiply(e.multiply(e).add(1)).subtract(s.multiply(e)),l=e.multiply(t.subtract(e.multiply(r)).subtract(s)),c=s.multiply(t).add(r).add(o);return l.multiply(a.invertValue(c))}case"msavi":{const e=t.multiply(2).add(1),i=e.multiply(e).subtract(t.subtract(r).multiply(8));return e.subtract(s.sqrt(i)).multiply(.5)}case"gemi":{const e=t.multiply(t).subtract(r.multiply(r)).multiply(2).add(t.multiply(1.5)).add(r.multiply(.5)),s=t.add(r).add(.5),n=e.multiply(a.invertValue(s)),o=n.multiply(i.oneMinus(n.multiply(.25))),l=r.subtract(.125).multiply(a.invertValue(i.oneMinus(r)));return o.subtract(l)}case"pvi":{const{x:e,y:i}=n,o=s.sqrt(e.multiply(e).add(1));return t.subtract(r.multiply(e)).subtract(i).multiply(a.invertValue(o))}case"vari":{const t=e.g.subtract(e.r),r=e.g.add(e.r).subtract(e.b);return t.multiply(a.invertValue(r))}case"rtvicore":return t.subtract(r).multiply(100).subtract(t.subtract(e.b).multiply(10));case"bai":{const e=s.pow(new s.Float(.1).subtract(r),new s.Float(2)),i=s.pow(new s.Float(.06).subtract(t),new s.Float(2));return a.invertValue(e.add(i))}case"evi":{const s=e.b,i=t.add(r.multiply(6)).subtract(s.multiply(7.5)).add(1);return t.subtract(r).multiply(2.5).multiply(a.invertValue(i))}case"wndwi":{const{r:t,g:r,b:s}=e,i=n.x,o=i.multiply(r),l=i.multiply(s),c=t.add(o).add(s).subtract(l);return t.subtract(o).subtract(s).add(l).multiply(a.invertValue(c))}case"mtvi":{const i=e.b,n=s.pow(t.multiply(2).add(1),new s.Float(2)),o=t.multiply(6).subtract(s.sqrt(r).multiply(5)),l=s.sqrt(n.subtract(o).subtract(.5)),c=t.subtract(i).multiply(1.2),u=r.subtract(i).multiply(2.5);return c.subtract(u).multiply(1.5).multiply(a.invertValue(l))}default:return t}}}t.__decorate([r.define],c.prototype,"indexType",void 0),t.__decorate([r.define],c.prototype,"isOutputRounded",void 0),t.__decorate([r.uniform(o)],c.prototype,"bandArithmeticConfig",void 0),t.__decorate([r.option(l)],c.prototype,"adjustmentConfig",void 0),e.BandArithmeticShader=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/math":function(){define(["exports","../../../../graph/glsl"],(function(e,t){"use strict";e.computeMapValue=function(e,r,s){const i=new t.Vec3(e);let n=new t.Vec3(0,0,0),a=new t.Float(0);for(let e=0;e<s/3;e++){const s=9*e,o=new t.Vec3(r[s],r[s+3],r[s+6]),l=new t.Vec3(r[s+1],r[s+4],r[s+7]),c=t.step(o,i).multiply(t.step(i,l)),u=new t.Vec3(r[s+2],r[s+5],r[s+8]);a=t.mix(a,u.x,c.x),a=t.mix(a,u.y,c.y),a=t.mix(a,u.z,c.z),n=n.add(c)}return{mapValue:a,includeMask:t.sign(t.dot(n,new t.Vec3(1,1,1)))}},e.getRangeClipFactor=function(e,r){return t.step(r.x,e).multiply(t.step(e,r.y))},e.invertValue=function(e){const r=t.sign(e),s=e.add(t.abs(r).subtract(1));return r.multiply(r).divide(s)},e.roundOutput=function(e){return new t.Vec4(t.floor(e.rgb.add(.5)),e.a)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/ColormapToRGBTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/ColormapToRGBShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterColormapToRGBProcessor",this.type=t.RasterTechniqueType.ColormapToRGB,this.shaders={colormapToRGB:new s.ColormapToRGBShader}}_process(e,t,r){const s=e.rasterFunction.parameters,i={colormapTexture:{texture:r,unit:1},colormapOffset:s.offset,colormapMaxIndex:s.indexedColormap.length/4-1},n=this._getCommonConfig(e,t),a={shader:this.shaders.colormapToRGB,uniforms:{config:n,colormapConfig:i},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:o,context:l}=e;o.submitDrawMesh(l,a,o.quadMesh)}}e.ColormapToRGBTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/ColormapToRGBShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../lut","./BaseRasterProcessorShader"],(function(e,t,r,s,i,n){"use strict";class a extends n.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="ColormapToRGBShader"}_process(e){const t=this._getPixel(e),r=i.lookupColor(t,new s.Float(1),this.colormapConfig,!1);return new s.Vec4(r.xyz.multiply(255),r.a)}}t.__decorate([r.uniform(i.ColormapConfig)],a.prototype,"colormapConfig",void 0),e.ColormapToRGBShader=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/CompositeBandTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/CompositeBandShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterCompositeBandProcessor",this.type=t.RasterTechniqueType.CompositeBand,this.shaders={compositeBand:new s.CompositeBandShader}}_process(e,t){const{rasters:r}=e.rasterFunction.parameters,s={constantCount:this._getConstantCount(r),imageCount:r?.length??1},i=this._getMultipleInputConfig(t,r),n=this._getCommonConfig(e,t),a={shader:this.shaders.compositeBand,uniforms:{config:n,...i},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:o,context:l}=e;o.submitDrawMesh(l,a,o.quadMesh)}}e.CompositeBandTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/CompositeBandShader":function(){define(["exports","../../../../graph/glsl","./BaseRasterProcessorShader","./MultiRasterMixin"],(function(e,t,r,s){"use strict";class i extends(s.MultiRasterMixin(r.BaseRasterProcessorShader)){constructor(){super(...arguments),this.type="CompositeBandShader"}_process(e){const{a:r,b:s,c:i,alpha:n}=this._getRasterValues(e);return new t.Vec4(r,s,i,n)}}e.CompositeBandShader=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/MultiRasterMixin":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl"],(function(e,t,r,s){"use strict";class i extends r.UniformGroup{}t.__decorate([r.uniform(s.Sampler2D)],i.prototype,"image1",void 0),t.__decorate([r.uniform(s.Float)],i.prototype,"image1Const",void 0),t.__decorate([r.uniform(s.Mat3)],i.prototype,"imageSwap",void 0);class n extends r.UniformGroup{}t.__decorate([r.uniform(s.Sampler2D)],n.prototype,"image1",void 0),t.__decorate([r.uniform(s.Sampler2D)],n.prototype,"image2",void 0),t.__decorate([r.uniform(s.Float)],n.prototype,"image1Const",void 0),t.__decorate([r.uniform(s.Float)],n.prototype,"image2Const",void 0),t.__decorate([r.uniform(s.Mat3)],n.prototype,"imageSwap",void 0),e.MultiRasterMixin=e=>{class a extends e{constructor(){super(...arguments),this.constantCount=0,this.imageCount=1}_getRasterValues(e){const{imageCount:t}=this;if(1===t){const t=s.texture2D(this.config.texture,e);return{a:t.r,b:t.g,c:t.b,alpha:t.a}}if(2===t){const t=this._getTwoValues(e);return{a:t.a,b:t.b,c:t.b,alpha:t.alpha}}return this._getThreeValues(e)}_getTwoValues(e){const t=s.texture2D(this.config.texture,e);if(1===this.constantCount){const{imageSwap:e,image1Const:r}=this.twoRasterConfig,i=e.multiply(new s.Vec3(t.r,r,0));return{a:i.x,b:i.y,alpha:t.a}}const{image1:r}=this.twoRasterConfig,i=s.texture2D(r,e);return{a:t.r,b:i.r,alpha:t.a.multiply(i.a)}}_getThreeValues(e){const t=s.texture2D(this.config.texture,e),{imageSwap:r,image1:i,image2:n,image1Const:a,image2Const:o}=this.threeRasterConfig;if(2===this.constantCount){const e=r.multiply(new s.Vec3(t.r,a,o));return{a:e.x,b:e.y,c:e.z,alpha:t.a}}if(1===this.constantCount){const n=s.texture2D(i,e),o=r.multiply(new s.Vec3(t.r,n.r,a));return{a:o.x,b:o.y,c:o.z,alpha:t.a.multiply(n.a)}}const l=s.texture2D(i,e),c=s.texture2D(n,e);return{a:t.r,b:l.r,c:c.r,alpha:t.a.multiply(l.a).multiply(c.a)}}}return t.__decorate([r.define],a.prototype,"constantCount",void 0),t.__decorate([r.define],a.prototype,"imageCount",void 0),t.__decorate([r.option(i)],a.prototype,"twoRasterConfig",void 0),t.__decorate([r.option(n)],a.prototype,"threeRasterConfig",void 0),a},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/ComputeChangeTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/ComputeChangeShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterComputeChangeProcessor",this.type=t.RasterTechniqueType.ComputeChange,this.shaders={computeChange:new s.ComputeChangeShader}}_process(e,t){const r=e.rasterFunction.parameters,{rasters:s}=r,i={constantCount:this._getConstantCount(s),imageCount:s.length,method:r.method,isOutputRounded:r.isOutputRounded},n={domainRange:r.domainRange},{twoRasterConfig:a}=this._getMultipleInputConfig(t,s),o=this._getCommonConfig(e,t),l={shader:this.shaders.computeChange,uniforms:{config:o,domainRangeConfig:n,twoRasterConfig:a},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:c,context:u}=e;c.submitDrawMesh(u,l,c.quadMesh)}}e.ComputeChangeTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/ComputeChangeShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","./BaseRasterProcessorShader","./LocalShader","./math","./MultiRasterMixin"],(function(e,t,r,s,i,n,a,o){"use strict";class l extends(o.MultiRasterMixin(i.BaseRasterProcessorShader)){constructor(){super(...arguments),this.type="ComputeChangeShader",this.isOutputRounded=!1}_process(e){const{a:t,b:r,alpha:i}=this._getRasterValues(e);let n=t.subtract(r);"relative-difference"===this.method&&(n=n.multiply(a.invertValue(s.max(s.abs(t),s.abs(r)))));const o=a.getRangeClipFactor(n,this.domainRangeConfig.domainRange),l=new s.Vec4(n,n,n,i).multiply(o);return this.isOutputRounded?a.roundOutput(l):l}}t.__decorate([r.define],l.prototype,"method",void 0),t.__decorate([r.define],l.prototype,"isOutputRounded",void 0),t.__decorate([r.uniform(n.DomainRangeConfig)],l.prototype,"domainRangeConfig",void 0),e.ComputeChangeShader=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/LocalShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","./BaseRasterProcessorShader","./math","./MultiRasterMixin"],(function(e,t,r,s,i,n,a){"use strict";class o extends r.UniformGroup{}t.__decorate([r.uniform(s.Vec2)],o.prototype,"domainRange",void 0);class l extends(a.MultiRasterMixin(i.BaseRasterProcessorShader)){constructor(){super(...arguments),this.type="LocalShader",this.isOutputRounded=!1}_process(e){if("conditional"===this.operationName)return this._conditional(e);const{a:t,b:r,alpha:s}=this._getRasterValues(e),{value:i,alpha:n}=this._compute(t,r,s);return this._processResult(i,n)}_processResult(e,t){const r=n.getRangeClipFactor(e,this.domainRangeConfig.domainRange),i=new s.Vec4(e,e,e,t).multiply(r);return this.isOutputRounded?n.roundOutput(i):i}_compute(e,t,r){const{operationName:i}=this;let a;switch(i){case"plus":a=e.add(t);break;case"minus":a=e.subtract(t);break;case"times":a=e.multiply(t);break;case"divide":case"floatdivide":a=e.multiply(n.invertValue(t)),r=r.multiply(s.float(s.abs(s.sign(t))));break;case"floordivide":a=s.floor(e.multiply(n.invertValue(t))),r=r.multiply(s.float(s.abs(s.sign(t))));break;case"square":a=e.multiply(e);break;case"sqrt":a=s.sqrt(e);break;case"power":a=s.pow(e,t);break;case"ln":a=s.ifElse(s.greaterThan(e,new s.Float(0)),s.log(e),new s.Float(0)),r=r.multiply(this._isAboveZero(e));break;case"log10":a=s.ifElse(s.greaterThan(e,new s.Float(0)),s.log2(e).multiply(n.invertValue(s.log2(new s.Float(10)))),new s.Float(0)),r=r.multiply(this._isAboveZero(e));break;case"log2":a=s.ifElse(s.greaterThan(e,new s.Float(0)),s.log2(e),new s.Float(0)),r=r.multiply(this._isAboveZero(e));break;case"exp":a=s.exp(e);break;case"exp10":a=s.pow(new s.Float(10),e);break;case"exp2":a=s.pow(new s.Float(2),e);break;case"rounddown":a=s.floor(e);break;case"roundup":a=s.ceil(e);break;case"int":a=s.sign(e).multiply(s.floor(s.abs(e)));break;case"mod":a=s.mod(e,t);break;case"negate":a=s.negate(e);break;case"abs":a=s.abs(e);break;case"acos":{const t=this._isAbsBiggerThanOne(e);a=s.ifElse(t,new s.Float(0),s.acos(e)),r=s.ifElse(t,new s.Float(0),r);break}case"acosh":a=s.acosh(e);break;case"asin":{const t=this._isAbsBiggerThanOne(e);a=s.ifElse(t,new s.Float(0),s.asin(e)),r=s.ifElse(t,new s.Float(0),r);break}case"asinh":a=s.asinh(e);break;case"atan":a=s.atan(e);break;case"atanh":{const t=this._isAbsBiggerThanOne(e);a=s.ifElse(t,new s.Float(0),s.atanh(e)),r=s.ifElse(t,new s.Float(0),r);break}case"atan2":a=s.atan(e,t);break;case"cos":a=s.cos(e);break;case"cosh":a=s.cosh(e);break;case"sin":a=s.sin(e);break;case"sinh":a=s.sinh(e);break;case"tan":a=s.tan(e);break;case"tanh":a=s.tanh(e);break;case"bitwiseand":a=new s.Float(s.bitAnd(new s.Int(e),new s.Int(t)));break;case"bitwiseor":a=new s.Float(s.bitOr(new s.Int(e),new s.Int(t)));break;case"bitwiseleftshift":a=new s.Float(s.bitShift(new s.Int(e),new s.Int(t)));break;case"bitwiserightshift":a=new s.Float(s.bitRShift(new s.Int(e),new s.Int(t)));break;case"bitwisenot":a=new s.Float(s.bitNot(new s.Int(e)));break;case"bitwisexor":a=new s.Float(s.bitXor(new s.Int(e),new s.Int(t)));break;case"booleanand":a=s.float(s.and(s.notEqual(e,new s.Float(0)),s.notEqual(t,new s.Float(0))));break;case"booleanor":a=s.float(s.or(s.notEqual(e,new s.Float(0)),s.notEqual(t,new s.Float(0))));break;case"booleannot":a=s.float(s.equal(e,new s.Float(0)));break;case"booleanxor":a=s.float(s.xor(s.notEqual(e,new s.Float(0)),s.notEqual(t,new s.Float(0))));break;case"greaterthan":a=s.float(s.greaterThan(e,t));break;case"greaterthanequal":a=s.float(s.greaterThanEqual(e,t));break;case"lessthan":a=s.float(s.lessThan(e,t));break;case"lessthanequal":a=s.float(s.lessThanEqual(e,t));break;case"equalto":a=s.float(s.equal(e,t));break;case"notequal":a=s.float(s.notEqual(e,t));break;case"isnull":a=s.float(s.equal(r,new s.Float(0))),r=new s.Float(1);break;case"setnull":{const i=s.float(s.equal(e,new s.Float(0)));a=i.multiply(t),r=r.multiply(i);break}default:a=e}return{value:a,alpha:r}}_conditional(e){const{a:t,b:r,c:i,alpha:n}=this._getRasterValues(e),a=new s.Float(s.abs(s.sign(t))),o=s.mix(i,r,a);return this._processResult(o,n)}_isAboveZero(e){return s.float(s.greaterThan(e,new s.Float(0)))}_isAbsBiggerThanOne(e){return s.greaterThan(s.abs(e),new s.Float(1))}}t.__decorate([r.define],l.prototype,"operationName",void 0),t.__decorate([r.define],l.prototype,"isOutputRounded",void 0),t.__decorate([r.uniform(o)],l.prototype,"domainRangeConfig",void 0),e.DomainRangeConfig=o,e.LocalShader=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/ContrastBrightnessTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/ContrastBrightnessShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterContrastBrightnessProcessor",this.type=t.RasterTechniqueType.ContrastBrightness,this.shaders={contrastBrightness:new s.ContrastBrightnessShader}}_process(e,t){const r=this._getCommonConfig(e,t),s=e.rasterFunction.parameters,i={shader:this.shaders.contrastBrightness,uniforms:{config:r,contrastBrightnessConfig:s},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:a}=e;n.submitDrawMesh(a,i,n.quadMesh)}}e.ContrastBrightnessTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/ContrastBrightnessShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","./BaseRasterProcessorShader","./math"],(function(e,t,r,s,i,n){"use strict";class a extends r.UniformGroup{}t.__decorate([r.uniform(s.Float)],a.prototype,"contrastOffset",void 0),t.__decorate([r.uniform(s.Float)],a.prototype,"brightnessOffset",void 0);class o extends i.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="ContrastBrightnessShader"}_process(e){const{rgb:t,a:r}=this._getPixel(e),{contrastOffset:i,brightnessOffset:a}=this.contrastBrightnessConfig,o=new s.Float(255),l=new s.Float(128),c=t.multiply(200),u=o.multiply(100),h=o.multiply(2).multiply(a),d=c.subtract(u).add(h),p=s.cond([s.equal(i,new s.Float(-100)),new s.Vec3(l)],[s.equal(i,new s.Float(100)),s.sign(d).add(1).divide(2).multiply(o)],[s.greaterThan(i,new s.Float(0)),d.divide(new s.Float(100).subtract(i).multiply(2)).add(l)],[!0,d.multiply(i.add(100)).divide(2e4).add(l)]);return n.roundOutput(new s.Vec4(p,r))}}t.__decorate([r.uniform(a)],o.prototype,"contrastBrightnessConfig",void 0),e.ContrastBrightnessShader=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/ConvolutionTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/ConvolutionShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterConvolutionProcessor",this.type=t.RasterTechniqueType.Convolution,this.shaders={convolution:new s.ConvolutionShader}}_process(e,t){const r=e.rasterFunction.parameters,s={rows:r.kernelRows,cols:r.kernelCols},i={kernel:[...r.kernel],clampRange:r.clampRange},n=this._getCommonConfig(e,t),a={shader:this.shaders.convolution,uniforms:{config:n,convolutionConfig:i},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:o,context:l}=e;o.submitDrawMesh(l,a,o.quadMesh)}}e.ConvolutionTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/ConvolutionShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../surface","./BaseRasterProcessorShader"],(function(e,t,r,s,i,n){"use strict";class a extends r.UniformGroup{}t.__decorate([r.uniform(s.FixedArray2D.ofType(s.Float,5,5,!0))],a.prototype,"kernel",void 0),t.__decorate([r.uniform(s.Vec2)],a.prototype,"clampRange",void 0);class o extends n.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="ConvolutionShader",this.rows=3,this.cols=3}_process(e){const{rows:t,cols:r}=this,n=new s.Vec2(Math.floor(t/2),Math.floor(r/2)),{texture:a,srcImageSize:o}=this.config,l=new s.Float(1).divide(o),{kernel:c}=this.convolutionConfig,u=s.reduce2D(c,{initialValue:new s.Vec4(0,0,0,1),xRange:[0,t],yRange:[0,r],callback:(t,r,o,c)=>{const u=new s.Vec2(new s.Float(o),new s.Float(c)).subtract(n).multiply(l),h=s.texture2D(a,i.mirror(e.add(u))),d=h.rgb.multiply(r).add(t.rgb),p=h.a.multiply(t.a);return new s.Vec4(d,p)}}),{clampRange:h}=this.convolutionConfig;return new s.Vec4(s.clamp(u.rgb,h.x,h.y),1).multiply(u.a)}}t.__decorate([r.define],o.prototype,"rows",void 0),t.__decorate([r.define],o.prototype,"cols",void 0),t.__decorate([r.uniform(a)],o.prototype,"convolutionConfig",void 0),e.ConvolutionShader=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/CurvatureTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/CurvatureShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterCurvatureProcessor",this.type=t.RasterTechniqueType.Curvature,this.shaders={curvature:new s.CurvatureShader}}_process(e,t){const r=e.rasterFunction.parameters,s={curvatureType:r.curvatureType},i=t.getRasterCellSize(),n={zlFactor:200*r.zFactor/i[0]/i[1]},a=this._getCommonConfig(e,t),o={shader:this.shaders.curvature,uniforms:{config:a,curvatureConfig:n},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:l,context:c}=e;l.submitDrawMesh(c,o,l.quadMesh)}}e.CurvatureTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/CurvatureShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../surface","./BaseRasterProcessorShader"],(function(e,t,r,s,i,n){"use strict";class a extends r.UniformGroup{}t.__decorate([r.uniform(s.Float)],a.prototype,"zlFactor",void 0);class o extends n.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="CurvatureShader"}_process(e){const{texture:t}=this.config,r=i.getSurfaceValues(t,e,this.config.srcImageSize),n=r[3].add(r[5]).multiply(.5).subtract(r[4]),a=r[1].add(r[7]).multiply(.5).subtract(r[4]),{zlFactor:o}=this.curvatureConfig,{curvatureType:l}=this;let c;if("standard"===l)c=s.negate(o).multiply(n.add(a));else{const e=r[2].subtract(r[0]).add(r[6]).subtract(r[8]).divide(4),t=r[5].subtract(r[3]).divide(2),i=r[1].subtract(r[7]).divide(2),u=t.multiply(t),h=i.multiply(i),d=t.multiply(i),p=o.divide(u.add(h));c="profile"===l?s.dot(new s.Vec3(n,a,e),new s.Vec3(u,h,d)).multiply(p):s.dot(new s.Vec3(n,a,s.negate(e)),new s.Vec3(h,u,d)).multiply(s.negate(p))}return new s.Vec4(c,c,c,r[9])}}t.__decorate([r.define],o.prototype,"curvatureType",void 0),t.__decorate([r.uniform(a)],o.prototype,"curvatureConfig",void 0),e.CurvatureShader=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/ExtractBandTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/ExtractBandShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterExtractBandProcessor",this.type=t.RasterTechniqueType.ExtractBand,this.shaders={extractBand:new s.ExtractBandShader}}_process(e,t){const r={bandIndexMat3:e.rasterFunction.parameters.bandIndexMat3},s=this._getCommonConfig(e,t),i={shader:this.shaders.extractBand,uniforms:{config:s,extractBandConfig:r},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:a}=e;n.submitDrawMesh(a,i,n.quadMesh)}}e.ExtractBandTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/ExtractBandShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","./BaseRasterProcessorShader"],(function(e,t,r,s,i){"use strict";class n extends r.UniformGroup{}t.__decorate([r.uniform(s.Mat3)],n.prototype,"bandIndexMat3",void 0);class a extends i.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="ExtractBandShader"}_process(e){const t=this._getPixel(e),r=this.extractBandConfig.bandIndexMat3.multiply(t.rgb);return new s.Vec4(r,t.a)}}t.__decorate([r.uniform(n)],a.prototype,"extractBandConfig",void 0),e.ExtractBandShader=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/FocalStatisticsTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/FocalStatisticsShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterFocalStatisticsProcessor",this.type=t.RasterTechniqueType.Statistics,this.shaders={focalStatistics:new s.FocalStatisticsShader}}_process(e,t){const r=e.rasterFunction.parameters,s={rows:r.kernelRows,cols:r.kernelCols,statisticsType:r.statisticsType,fill:r.fillNoDataOnly},i={clampRange:r.clampRange},n=this._getCommonConfig(e,t),a={shader:this.shaders.focalStatistics,uniforms:{config:n,focalStatisticsConfig:i},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:o,context:l}=e;o.submitDrawMesh(l,a,o.quadMesh)}}e.FocalStatisticsTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/FocalStatisticsShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../surface","./BaseRasterProcessorShader","./math"],(function(e,t,r,s,i,n,a){"use strict";class o extends r.UniformGroup{}t.__decorate([r.uniform(s.Vec2)],o.prototype,"clampRange",void 0);class l extends n.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="FocalStatisticsShader",this.rows=3,this.cols=3,this.fill=!1}_process(e){const t=this._process1(e),r=s.step(new s.Float(1),t.a);if(!this.fill)return this._clamp(t.rgb,r);const i=this._getPixel(e),n=s.mix(t.rgb,i.rgb,i.a);return this._clamp(n,r)}_clamp(e,t){const{clampRange:r}=this.focalStatisticsConfig;return new s.Vec4(s.clamp(e,r.x,r.y),1).multiply(t)}_process1(e){const{texture:t,srcImageSize:r}=this.config,{rows:n,cols:o}=this,l=new s.Vec2(Math.floor(n/2),Math.floor(o/2)),c=new s.Float(1).divide(r),u=this._getPixel(e),{statisticsType:h}=this,d="min"===h||"max"===h?new s.Vec4(u.rgb,0):new s.Vec4(0,0,0,0);switch(h){case"min":return this._stat(n,o,d,((r,n,a)=>{const o=new s.Vec2(new s.Float(n),new s.Float(a)).subtract(l).multiply(c),u=s.texture2D(t,i.mirror(e.add(o))),h=s.min(r.rgb,u.rgb);return new s.Vec4(h,r.a.add(u.a))}));case"max":return this._stat(n,o,d,((r,n,a)=>{const o=new s.Vec2(new s.Float(n),new s.Float(a)).subtract(l).multiply(c),u=s.texture2D(t,i.mirror(e.add(o))),h=s.max(r.rgb,u.rgb);return new s.Vec4(h,r.a.add(u.a))}));case"mean":{const r=this._stat(n,o,d,((r,n,a)=>{const o=new s.Vec2(new s.Float(n),new s.Float(a)).subtract(l).multiply(c),u=s.texture2D(t,i.mirror(e.add(o))),h=r.rgb.add(u.rgb.multiply(u.a));return new s.Vec4(h,r.a.add(u.a))})),u=r.rgb.multiply(a.invertValue(r.a));return new s.Vec4(u,r.a)}case"stddev":{const r=this._stat(n,o,d,((r,n,a)=>{const o=new s.Vec2(new s.Float(n),new s.Float(a)).subtract(l).multiply(c),u=s.texture2D(t,i.mirror(e.add(o))),h=r.rgb.add(u.rgb.multiply(u.a));return new s.Vec4(h,r.a.add(u.a))})),u=this._stat(n,o,d,((r,n,a)=>{const o=new s.Vec2(new s.Float(n),new s.Float(a)).subtract(l).multiply(c),u=s.texture2D(t,i.mirror(e.add(o))),h=r.rgb.add(u.a.multiply(u.rgb).multiply(u.rgb));return new s.Vec4(h,r.a.add(u.a))})),h=a.invertValue(u.a),p=s.sqrt(u.subtract(r.multiply(r).multiply(h)).multiply(h));return new s.Vec4(p.rgb,r.a)}default:return u}}_stat(e=3,t=3,r,i){const n=new s.Int(0).setMutable().setDebugName("StatColIterator"),a=new s.Int(0).setMutable().setDebugName("StatRowIterator"),o=r.setMutable().setDebugName("StatAccumulator"),l=i(o,n,a).setDebugName("StatPredicate"),c=s.block({iterX:n,iterY:a,accumulator:o},s.Vec4,l,(({out:r,iterX:s,iterY:i,accumulator:n,subgraph:a})=>`\n  for (${i} = 0; ${i} < ${e}; ${i}++) {\n    for (${s} = 0; ${s} < ${t}; ${s}++) {\n  \n    ${a.body}\n  \n    ${n} = ${a.varName};\n    }\n  }\n  ${r} = ${n};\n  `)).setDebugName("statBody");return c}}t.__decorate([r.define],l.prototype,"rows",void 0),t.__decorate([r.define],l.prototype,"cols",void 0),t.__decorate([r.define],l.prototype,"statisticsType",void 0),t.__decorate([r.define],l.prototype,"fill",void 0),t.__decorate([r.uniform(o)],l.prototype,"focalStatisticsConfig",void 0),e.FocalStatisticsShader=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/GrayscaleTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/GrayscaleShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterGrayscaleProcessor",this.type=t.RasterTechniqueType.Grayscale,this.shaders={grayscale:new s.GrayscaleShader}}_process(e,t){const r={weights:e.rasterFunction.parameters.weights},s=this._getCommonConfig(e,t),i={shader:this.shaders.grayscale,uniforms:{config:s,grayscaleConfig:r},defines:{},optionalAttributes:null,useComputeBuffer:!1},{painter:n,context:a}=e;n.submitDrawMesh(a,i,n.quadMesh)}}e.GrayscaleTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/GrayscaleShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","./BaseRasterProcessorShader"],(function(e,t,r,s,i){"use strict";class n extends r.UniformGroup{}t.__decorate([r.uniform(s.Vec3)],n.prototype,"weights",void 0);class a extends i.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="GrayscaleShader"}_process(e){const t=this._getPixel(e),{weights:r}=this.grayscaleConfig,i=s.dot(r,t.rgb);return new s.Vec4(i,i,i,t.a)}}t.__decorate([r.uniform(n)],a.prototype,"grayscaleConfig",void 0),e.GrayscaleShader=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/HillshadeTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/surface","../../shaders/raster/processor/HillshadeShader"],(function(e,t,r,s,i){"use strict";class n extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterHillshadeProcessor",this.type=t.RasterTechniqueType.Hillshade,this.shaders={hillshade:new i.HillshadeShader}}_process(e,t){const r=e.rasterFunction.parameters,i={isMultidirectional:r.hillshadeType>0},n=t.getRasterCellSize(),a=s.computeZFactor(r,n),o={...r,factor:a,minValue:0,maxValue:8e3},l=this._getCommonConfig(e,t),c={shader:this.shaders.hillshade,uniforms:{config:l,hillshadeConfig:o},defines:i,optionalAttributes:null,useComputeBuffer:!1},{painter:u,context:h}=e;u.submitDrawMesh(h,c,u.quadMesh)}}e.HillshadeTechnique=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/HillshadeShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../surface","./BaseRasterProcessorShader"],(function(e,t,r,s,i,n){"use strict";class a extends n.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="HillshadeShader",this.isMultidirectional=!1}_process(e){const{texture:t}=this.config,r=i.getSurfaceValues(t,e,this.config.srcImageSize),n=i.hillshade(r,this.hillshadeConfig,this.isMultidirectional);return new s.Vec4(n.rgb.multiply(255),n.a)}}t.__decorate([r.define],a.prototype,"isMultidirectional",void 0),t.__decorate([r.uniform(i.HillshadeConfig)],a.prototype,"hillshadeConfig",void 0),e.HillshadeShader=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/LocalTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/LocalShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterLocalProcessor",this.type=t.RasterTechniqueType.Local,this.shaders={local:new s.LocalShader}}_process(e,t){const r=e.rasterFunction.parameters,s={constantCount:this._getConstantCount(r.rasters),imageCount:r.imageCount,operationName:r.operationName,isOutputRounded:r.isOutputRounded},i={domainRange:r.domainRange},n="conditional"===r.operationName?r.rasters:r.rasters?.slice(0,2),a=this._getMultipleInputConfig(t,n),o=this._getCommonConfig(e,t),l={shader:this.shaders.local,uniforms:{config:o,domainRangeConfig:i,...a},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:c,context:u}=e;c.submitDrawMesh(u,l,c.quadMesh)}}e.LocalTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/MaskTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/MaskShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterMaskProcessor",this.type=t.RasterTechniqueType.Mask,this.shaders={mask:new s.MaskShader}}_process(e,t){const r=e.rasterFunction.parameters,s={isMultiband:r.bandCount>1},i={includedRanges:[...r.includedRanges],noDataValues:[...r.noDataValues]},n=this._getCommonConfig(e,t),a={shader:this.shaders.mask,uniforms:{config:n,maskConfig:i},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:o,context:l}=e;o.submitDrawMesh(l,a,o.quadMesh)}}e.MaskTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/MaskShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../../../../../../layers/support/rasterFunctions/pixelUtils","../../../../GraphShaderModule","../../../../graph/glsl","./BaseRasterProcessorShader"],(function(e,t,r,s,i,n){"use strict";class a extends s.UniformGroup{}t.__decorate([s.uniform(i.FixedArray.ofType(i.Float,6))],a.prototype,"includedRanges",void 0),t.__decorate([s.uniform(i.FixedArray.ofType(i.Float,r.maxMapSizeGpu))],a.prototype,"noDataValues",void 0);class o extends n.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="MaskShader",this.isMultiband=!0}_process(e){const t=this._getPixel(e),r=this._computeNoDataFactor(t.r),s=this._computeRangeFactor(t.rgb);let n;if(this.isMultiband){const e=this._computeNoDataFactor(t.g),a=this._computeNoDataFactor(t.b),o=new i.Vec3(r,e,a).multiply(s);n=o.x.multiply(o.y).multiply(o.z)}else n=r.multiply(s.x);return t.multiply(n)}_computeNoDataFactor(e){const{noDataValues:t}=this.maskConfig;let s=new i.Vec3(1);for(let n=0;n<r.maxMapSizeGpu/3;n++){const r=3*n,a=new i.Vec3(t[r+0],t[r+1],t[r+2]),o=i.abs(i.sign(a.subtract(e)));s=s.multiply(o)}return s.x.multiply(s.y).multiply(s.z)}_computeRangeFactor(e){const{includedRanges:t}=this.maskConfig,r=new i.Vec3(t[0],t[2],t[4]),s=new i.Vec3(t[1],t[3],t[5]);return i.step(r,e).multiply(i.step(e,s))}}t.__decorate([s.define],o.prototype,"isMultiband",void 0),t.__decorate([s.uniform(a)],o.prototype,"maskConfig",void 0),e.MaskShader=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../../../core/mathUtils","../PixelBlock","../rasterFormats/pixelRangeUtils"],(function(e,t,r,s){"use strict";var i,n;function a(e){return null!=e&&e.pixels?.length>0}function o(e,t,s,i,n){const a=e.length,o=r.createEmptyBand(n,a);if(t)for(let r=0;r<a;r++)t[r]&&(o[r]=s[e[r]-i]);else for(let t=0;t<a;t++)o[t]=s[e[t]-i];return o}function l(e,t,r,s){const i=null!=r&&r.length>=2?new Set(r):null,n=1===r?.length?r[0]:null,a=!!t?.length;for(let r=0;r<e.length;r++)if(s[r]){const o=e[r];if(a){let e=!1;for(let r=0;r<t.length;r+=2)if(o>=t[r]&&o<=t[r+1]){e=!0;break}e||(s[r]=0)}s[r]&&(o===n||i?.has(o))&&(s[r]=0)}}function c(e,t){const r=e[0].length;for(let s=0;s<r;s++)if(t[s]){let r=!1;for(let t=0;t<e.length;t++)if(e[t][s]){r=!0;break}r||(t[s]=0)}}function u(e,t){const r=e[0].length;for(let s=0;s<r;s++)if(t[s]){let r=!1;for(let t=0;t<e.length;t++)if(0===e[t][s]){r=!0;break}r&&(t[s]=0)}}function h(e,t,r,s,i,n,a,o){return{xmin:i<=r*e?0:i<r*e+e?i-r*e:e,ymin:n<=s*t?0:n<s*t+t?n-s*t:t,xmax:i+a<=r*e?0:i+a<r*e+e?i+a-r*e:e,ymax:n+o<=s*t?0:n+o<s*t+t?n+o-s*t:t}}function d(e,t,r,s,i,n){const{width:a,height:o}=r.block,{x:l,y:c}=r.offset,{width:u,height:d}=r.mosaic,p=h(a,o,s,i,l,c,u,d);let f=0,m=0;if(n){const e=n.hasGCSSShiftTransform?360:n.halfWorldWidth??0,t=a*n.resolutionX,r=n.startX+s*t;r<e&&r+t>e?m=n.rightPadding:r>=e&&(f=n.leftMargin-n.rightPadding,m=0)}if(p.xmax-=m,"number"!=typeof t)for(let r=p.ymin;r<p.ymax;r++){const n=(i*o+r-c)*u+(s*a-l)+f,h=r*a;for(let r=p.xmin;r<p.xmax;r++)e[n+r]=t[h+r]}else for(let r=p.ymin;r<p.ymax;r++){const n=(i*o+r-c)*u+(s*a-l)+f;for(let r=p.xmin;r<p.xmax;r++)e[n+r]=t}}function p(e,t,s={}){const{clipOffset:i,clipSize:n,alignmentInfo:o,blockWidths:l}=s;if(l)return function(e,t,s){const i=e.find((e=>null!=e));if(null==i)return null;const n=e.some((e=>null==e||!!e.mask)),{width:o,height:l}=t,c=n?new Uint8Array(o*l):null,{blockWidths:u}=s,h=[],d=i.getPlaneCount(),p=r.getPixelArrayConstructor(i.pixelType);if(n)for(let t=0,r=0;t<e.length;r+=u[t],t++){const s=e[t];if(!a(s))continue;const i=s.mask;for(let e=0;e<l;e++)for(let n=0;n<u[t];n++)c[e*o+n+r]=null==i?255:i[e*s.width+n]}const f=e.some((e=>e?.bandMasks&&e.bandMasks.length>1)),m=f?[]:void 0,g=o*l;for(let t=0;t<d;t++){const r=new p(g),s=f?new Uint8Array(g):void 0;for(let i=0,n=0;i<e.length;n+=u[i],i++){const c=e[i];if(!a(c))continue;const h=c.pixels[t];if(null!=h){for(let e=0;e<l;e++)for(let t=0;t<u[i];t++)r[e*o+t+n]=h[e*c.width+t];if(s){const e=c.bandMasks?.[t]??c.mask;for(let t=0;t<l;t++)for(let r=0;r<u[i];r++)s[t*o+r+n]=e?e[t*c.width+r]:255}}}h.push(r),m&&s&&m.push(s)}const y=new r({width:o,height:l,mask:c,bandMasks:m,pixels:h,pixelType:i.pixelType});return y.updateStatistics(),y}(e,t,{blockWidths:l});const c=e.find((e=>a(e)));if(null==c)return null;const u=n?n.width:t.width,h=n?n.height:t.height,p=c.width,f=c.height,m=t.width/p,g=t.height/f,y={offset:i||{x:0,y:0},mosaic:n||t,block:{width:p,height:f}},x=c.pixelType,w=r.getPixelArrayConstructor(x),b=c.pixels.length,_=[];let v,S;for(let t=0;t<b;t++){S=new w(u*h);for(let r=0;r<g;r++)for(let s=0;s<m;s++){const i=e[r*m+s];a(i)&&(v=i.pixels[t],d(S,v,y,s,r,o))}_.push(S)}const T=e.some((e=>null==e||null!=e.mask&&e.mask.length>0)),M=e.some((e=>e?.bandMasks&&e.bandMasks.length>1)),R=T?new Uint8Array(u*h):void 0,C=M?[]:void 0;if(R){for(let t=0;t<g;t++)for(let r=0;r<m;r++){const s=e[t*m+r],i=null!=s?s.mask:null;d(R,null!=i?i:s?255:0,y,r,t,o)}if(C)for(let t=0;t<b;t++){const r=new Uint8Array(u*h);for(let s=0;s<g;s++)for(let i=0;i<m;i++){const n=e[s*m+i],a=n?.bandMasks?.[t]??n?.mask;d(r,null!=a?a:n?255:0,y,i,s,o)}C.push(r)}}const P=new r({width:u,height:h,pixels:_,pixelType:x,bandMasks:C,mask:R});return P.updateStatistics(),P}function f(e){if(!a(e))return null;const t=e.clone(),{width:r,height:s,pixels:i}=e,n=i[0],o=t.pixels[0],l=e.mask;for(let e=2;e<s-1;e++){const t=new Map;for(let s=e-2;s<e+2;s++)for(let e=0;e<4;e++){const i=s*r+e;y(t,n[i],l?l[i]:1)}o[e*r]=m(t),o[e*r+1]=o[e*r+2]=o[e*r];let s=3;for(;s<r-1;s++){let i=(e-2)*r+s+1;y(t,n[i],l?l[i]:1),i=(e-1)*r+s+1,y(t,n[i],l?l[i]:1),i=e*r+s+1,y(t,n[i],l?l[i]:1),i=(e+1)*r+s+1,y(t,n[i],l?l[i]:1),i=(e-2)*r+s-3,g(t,n[i],l?l[i]:1),i=(e-1)*r+s-3,g(t,n[i],l?l[i]:1),i=e*r+s-3,g(t,n[i],l?l[i]:1),i=(e+1)*r+s-3,g(t,n[i],l?l[i]:1),o[e*r+s]=m(t)}o[e*r+s+1]=o[e*r+s]}for(let e=0;e<r;e++)o[e]=o[r+e]=o[2*r+e],o[(s-1)*r+e]=o[(s-2)*r+e];return t.updateStatistics(),t}function m(e){if(0===e.size)return 0;let t=0,r=-1,s=0;const i=e.keys();let n=i.next();for(;!n.done;)s=e.get(n.value),s>t&&(r=n.value,t=s),n=i.next();return r}function g(e,t,r){if(0===r)return;const s=e.get(t);1===s?e.delete(t):e.set(t,s-1)}function y(e,t,r){0!==r&&e.set(t,e.has(t)?e.get(t)+1:1)}function x(e,t,s){let{x:i,y:n}=t;const{width:o,height:l}=s;if(0===i&&0===n&&l===e.height&&o===e.width)return e;const{width:c,height:u}=e,h=Math.max(0,n),d=Math.max(0,i),p=Math.min(i+o,c),f=Math.min(n+l,u);if(p<0||f<0||!a(e))return null;i=Math.max(0,-i),n=Math.max(0,-n);const{pixels:m}=e,g=o*l,y=m.length,x=[];for(let t=0;t<y;t++){const s=m[t],a=r.createEmptyBand(e.pixelType,g);for(let e=h;e<f;e++){const t=e*c;let r=(e+n-h)*o+i;for(let e=d;e<p;e++)a[r++]=s[t+e]}x.push(a)}const w=new Uint8Array(g),b=e.mask;for(let e=h;e<f;e++){const t=e*c;let r=(e+n-h)*o+i;for(let e=d;e<p;e++)w[r++]=b?b[t+e]:1}const _=new r({width:s.width,height:s.height,pixelType:e.pixelType,pixels:x,mask:w});return _.updateStatistics(),_}function w(e,t=!0){if(!a(e))return null;const{pixels:s,width:i,height:n,mask:o,pixelType:l}=e,c=[],u=Math.round(i/2),h=Math.round(n/2),d=n-1,p=i-1;for(let e=0;e<s.length;e++){const a=s[e],o=r.createEmptyBand(l,u*h);let f=0;for(let e=0;e<n;e+=2)for(let r=0;r<i;r+=2){const s=a[e*i+r];if(t){const t=r===p?s:a[e*i+r+1],n=e===d?s:a[e*i+r+i],l=r===p?n:e===d?t:a[e*i+r+i+1];o[f++]=(s+t+n+l)/4}else o[f++]=s}c.push(o)}let f=null;if(null!=o){f=new Uint8Array(u*h);let e=0;for(let r=0;r<n;r+=2)for(let s=0;s<i;s+=2){const n=o[r*i+s];if(t){const t=s===p?n:o[r*i+s+1],a=r===d?n:o[r*i+s+i],l=s===p?a:r===d?t:o[r*i+s+i+1];f[e++]=n*t*a*l?1:0}else f[e++]=n}}return new r({width:u,height:h,pixelType:l,pixels:c,mask:f})}function b(e,t,r,s,i=0){const{width:n,height:a}=e,{width:o,height:l}=t,c=s.cols,u=s.rows,h=Math.ceil(o/c-.1/c),d=Math.ceil(l/u-.1/u);let p,f,m,g,y,x,w;const b=h*c,_=b*d*u,v=new Float32Array(_),S=new Float32Array(_),T=new Uint32Array(_),M=new Uint32Array(_);let R,C,P=0;for(let e=0;e<d;e++)for(let t=0;t<h;t++){p=12*(e*h+t),f=r[p],m=r[p+1],g=r[p+2],y=r[p+3],x=r[p+4],w=r[p+5];for(let r=0;r<u;r++){P=(e*u+r)*b+t*c,C=(r+.5)/u;for(let e=0;e<r;e++)R=(e+.5)/c,v[P+e]=(f*R+m*C+g)*n+i,S[P+e]=(y*R+x*C+w)*a+i,T[P+e]=Math.floor(v[P+e]),M[P+e]=Math.floor(S[P+e])}p+=6,f=r[p],m=r[p+1],g=r[p+2],y=r[p+3],x=r[p+4],w=r[p+5];for(let r=0;r<u;r++){P=(e*u+r)*b+t*c,C=(r+.5)/u;for(let e=r;e<c;e++)R=(e+.5)/c,v[P+e]=(f*R+m*C+g)*n+i,S[P+e]=(y*R+x*C+w)*a+i,T[P+e]=Math.floor(v[P+e]),M[P+e]=Math.floor(S[P+e])}}return{offsets_x:v,offsets_y:S,offsets_xi:T,offsets_yi:M,gridWidth:b}}e.NoDataInterpretation=void 0,(i=e.NoDataInterpretation||(e.NoDataInterpretation={}))[i.matchAny=0]="matchAny",i[i.matchAll=1]="matchAll",e.MissingBandAction=void 0,(n=e.MissingBandAction||(e.MissingBandAction={}))[n.bestMatch=0]="bestMatch",n[n.fail=1]="fail",e.approximateTransform=function(e,t,s,i,n="nearest"){if(!a(e))return null;"majority"===n&&(e=f(e));const{pixels:o,mask:l,bandMasks:c,pixelType:u}=e,h=e.width,d=e.height,p=r.getPixelArrayConstructor(u),m=o.length,{width:g,height:y}=t;let x=!1;for(let e=0;e<s.length;e+=3)-1===s[e]&&-1===s[e+1]&&-1===s[e+2]&&(x=!0);const{offsets_x:w,offsets_y:_,offsets_xi:v,offsets_yi:S,gridWidth:T}=b({width:h,height:d},t,s,i,"majority"===n?.5:0);let M;const R=(e,t,r,s)=>{const i=e instanceof Float32Array||e instanceof Float64Array?0:.5;for(let n=0;n<y;n++){M=n*T;for(let a=0;a<g;a++){if(w[M]<0||_[M]<0)e[n*g+a]=0;else if(s)e[n*g+a]=t[v[M]+S[M]*h];else{const s=Math.floor(w[M]),o=Math.floor(_[M]),l=Math.ceil(w[M]),c=Math.ceil(_[M]),u=w[M]-s,d=_[M]-o;if(!r||r[s+o*h]&&r[l+o*h]&&r[s+c*h]&&r[l+c*h]){const r=(1-u)*t[s+o*h]+u*t[l+o*h],p=(1-u)*t[s+c*h]+u*t[l+c*h];e[n*g+a]=(1-d)*r+d*p+i}else e[n*g+a]=t[v[M]+S[M]*h]}M++}}},C=[];let P;const k=c?.length===m,F=[];for(let e=0;e<m;e++){if(k){const t=new Uint8Array(g*y);R(t,c[e],c[e],!0),F.push(t)}P=new p(g*y),R(P,o[e],k?c[e]:l,"nearest"===n||"majority"===n),C.push(P)}const V=new r({width:g,height:y,pixelType:u,pixels:C,bandMasks:k?F:void 0});if(null!=l)V.mask=new Uint8Array(g*y),R(V.mask,l,l,!0);else if(x){V.mask=new Uint8Array(g*y);for(let e=0;e<g*y;e++)V.mask[e]=w[e]<0||_[e]<0?0:1}return V.updateStatistics(),V},e.clip=x,e.clipTile=function(e){const{pixelBlock:t,tileSize:r,level:s,row:i,col:n,useBilinear:o}=e;if(!a(t))return null;const{width:l,height:c}=r,u=2**s,h=u*l,d=u*c;let p=x(t,{y:i*d,x:n*h},{width:h,height:d});if(!p)return null;for(let e=s;e>0;e--)p=w(p,o);return p},e.colorize=function(e,t){if(!a(e))return e;if(!t||!t.indexedColormap&&!t.indexed2DColormap)return e;const r=e.clone(),s=r.pixels;let i=r.mask;const n=r.width*r.height;if(1!==s.length)return e;const{indexedColormap:o,indexed2DColormap:l,offset:c,alphaSpecified:u}=t,h=s[0],d=new Uint8Array(h.length),p=new Uint8Array(h.length),f=new Uint8Array(h.length);let m,g=0;if(o){const e=o.length-1;if(null!=i)for(let t=0;t<n;t++)i[t]&&(g=4*(h[t]-c),g<c||g>e?i[t]=0:(d[t]=o[g],p[t]=o[g+1],f[t]=o[g+2],i[t]=o[g+3]));else{i=new Uint8Array(n);for(let t=0;t<n;t++)g=4*(h[t]-c),g<c||g>e?i[t]=0:(d[t]=o[g],p[t]=o[g+1],f[t]=o[g+2],i[t]=o[g+3]);r.mask=i}}else if(l)if(null!=i)for(let e=0;e<n;e++)i[e]&&(m=l[h[e]],d[e]=m[0],p[e]=m[1],f[e]=m[2],i[e]=m[3]);else{i=new Uint8Array(n);for(let e=0;e<n;e++)m=l[h[e]],d[e]=m[0],p[e]=m[1],f[e]=m[2],i[e]=m[3];r.mask=i}return r.pixels=[d,p,f],r.statistics=null,r.pixelType="u8",r.maskIsAlpha=u,r},e.compositeBands=function(e){if(!e?.length||e.some((e=>!a(e))))return null;if(1===e.length)return e[0]?.clone()??null;const t=e,{width:s,height:i,pixelType:n}=t[0];if(t.some((e=>e.width!==s||e.height!==i)))return null;const o=t.map((({mask:e})=>e)).filter((e=>null!=e));let l=null;o.length&&(l=new Uint8Array(s*i),l.set(o[0]),o.length>1&&u(o.slice(1),l));const c=[];t.forEach((({pixels:e})=>c.push(...e)));const h=t.map((({statistics:e})=>e)).filter((e=>e?.length)),d=[];return h.forEach((e=>d.push(...e))),new r({pixelType:n,width:s,height:i,mask:l,pixels:c,statistics:d.length?d:null})},e.createColormapLUT=function(e){if(!e)return;const t=e.colormap;if(!t||0===t.length)return;const r=t.sort(((e,t)=>e[0]-t[0])),s=r[0][0]<0?r[0][0]:0,i=Math.max(256,r[r.length-1][0]-s+1),n=new Uint8Array(4*i),a=[],o=5===r[0].length;if(i>65536)return r.forEach((e=>{a[e[0]-s]=o?e.slice(1):e.slice(1).concat([255])})),{indexed2DColormap:a,offset:s,alphaSpecified:o};if(e.fillUnspecified){let e=r[0];for(let t=e[0]-s,a=0;t<i;t++)n[4*t]=e[1],n[4*t+1]=e[2],n[4*t+2]=e[3],n[4*t+3]=o?e[4]:255,t===e[0]-s&&(e=a===r.length-1?e:r[++a])}else for(let e=0;e<r.length;e++){const t=r[e],i=4*(t[0]-s);n[i]=t[1],n[i+1]=t[2],n[i+2]=t[3],n[i+3]=o?t[4]:255}return{indexedColormap:n,offset:s,alphaSpecified:o}},e.createMaskLUT=function(e,t,r){if("u8"!==e&&"s8"!==e&&"u16"!==e&&"s16"!==e)return null;const s=e.includes("16")?65536:256,i=e.includes("s")?-s/2:0,n=new Uint8Array(s);if(t)for(let e=0;e<t.length;e++){const r=Math.ceil(t[2*e]-i),s=Math.floor(t[2*e+1]-i);for(let e=r;e<=s;e++)n[e]=255}else n.fill(255);if(r)for(let e=0;e<r.length;e++)n[r[e]-i]=0;return{lut:n,offset:i}},e.createRangeMaps=function(e,r,s=!1){const i=1e-5,n=new Float32Array(27),a=r.length;for(let o=0;o<9;o++)n[3*o]=e[2*o]??t.numberMaxFloat32-1,n[3*o+1]=e[2*o+1]??t.numberMaxFloat32,n[3*o+2]=r[o]??0,o<a&&(o>0&&(n[3*o]-=i),e[2*o+1]!==e[2*o]&&(o<a-1||!s)&&(n[3*o+1]-=i));return n},e.createRemapLUT=function(e){const{srcPixelType:t,inputRanges:i,outputValues:n,allowUnmatched:a,noDataRanges:o,isLastInputRangeInclusive:l,outputPixelType:c}=e;if("u8"!==t&&"s8"!==t&&"u16"!==t&&"s16"!==t)return null;const u=t.includes("16")?65536:256,h=t.includes("s")?-u/2:0,d=r.createEmptyBand(c,u),p=new Uint8Array(u);a&&p.fill(255);const[f,m]=s.getPixelValueRange(c);if(i?.length&&n?.length){const e=1e-6,t=i.map((t=>t-e));t[0]=i[0],l&&(t[t.length-1]=i[i.length-1]);for(let e=0;e<t.length;e++){const r=n[e]>m?m:n[e]<f?f:n[e],s=Math.ceil(t[2*e]-h),a=i[2*e+1]===i[2*e]?s:Math.floor(t[2*e+1]-h);for(let e=s;e<=a;e++)d[e]=r,p[e]=255}}if(o?.length)for(let e=0;e<o.length;e++){const t=Math.ceil(o[2*e]-h),r=Math.floor(o[2*e+1]-h);for(let e=t;e<=r;e++)p[e]=0}return{lut:d,offset:h,mask:p}},e.extractBands=function(e,t){return t?.length&&a(e)?e.extractBands(t):e},e.getClipBounds=h,e.getLocalArithmeticNorthRotations=function(e,t){const{coefficients:r,spacing:s}=t,{offsets_x:i,offsets_y:n,gridWidth:a}=b(e,e,r,{rows:s[0],cols:s[1]}),{width:o,height:l}=e,c=new Float32Array(o*l),u=180/Math.PI;for(let e=0;e<l;e++)for(let t=0;t<o;t++){const r=e*a+t,s=0===e?r:r-a,h=e===l-1?r:r+a,d=i[s]-i[h],p=n[h]-n[s];if(isNaN(d)||isNaN(p))c[e*o+t]=90;else{let r=Math.atan2(p,d)*u;r=(360+r)%360,c[e*o+t]=r}}return c},e.interpolateOffsets=b,e.isValidPixelBlock=a,e.lookupBandValues=o,e.lookupPixels=function(e,t){if(!a(e))return null;const{pixels:s,mask:i}=e,n=s.length;let l=t.lut;const{offset:c}=t;l&&1===l[0].length&&(l=s.map((()=>l)));const u=[],h=t.outputPixelType||"u8";for(let e=0;e<n;e++){const t=o(s[e],i,l[e],c||0,h);u.push(t)}const d=new r({width:e.width,height:e.height,pixels:u,mask:i,pixelType:h});return d.updateStatistics(),d},e.mask=function(e,t){if(!a(e))return null;const{width:s,height:i,pixels:n}=e,h=s*i,d=new Uint8Array(h);e.mask?d.set(e.mask):d.fill(255);const p=n.length,{includedRanges:f,noDataValues:m,outputPixelType:g,matchAll:y,lookups:x}=t;if(x){const e=[];for(let t=0;t<p;t++){const r=x[t],s=o(n[t],d,r.lut,r.offset||0,"u8");e.push(s)}1===e.length?d.set(e[0]):y?c(e,d):u(e,d)}else if(y){const e=[];for(let t=0;t<p;t++){const r=new Uint8Array(h);r.set(d),l(n[t],f?.slice(2*t,2*t+2),m?.[t],r),e.push(r)}1===e.length?d.set(e[0]):c(e,d)}else for(let e=0;e<p;e++)l(n[e],f?.slice(2*e,2*e+2),m?.[e],d);return new r({width:s,height:i,pixelType:g,pixels:n,mask:d})},e.maxMapSizeGpu=9,e.mosaic=p,e.mosaicPixelData=function(e,t){if(!e||0===e.length)return null;const r=e.find((e=>e.pixelBlock));if(null==r?.pixelBlock)return null;const s=(r.extent.xmax-r.extent.xmin)/r.pixelBlock.width,i=(r.extent.ymax-r.extent.ymin)/r.pixelBlock.height,n=.01*Math.min(s,i),a=e.sort(((e,t)=>Math.abs(e.extent.ymax-t.extent.ymax)>n?t.extent.ymax-e.extent.ymax:Math.abs(e.extent.xmin-t.extent.xmin)>n?e.extent.xmin-t.extent.xmin:0)),o=Math.min.apply(null,a.map((e=>e.extent.xmin))),l=Math.min.apply(null,a.map((e=>e.extent.ymin))),c=Math.max.apply(null,a.map((e=>e.extent.xmax))),u=Math.max.apply(null,a.map((e=>e.extent.ymax))),h={x:Math.round((t.xmin-o)/s),y:Math.round((u-t.ymax)/i)},d={width:Math.round((c-o)/s),height:Math.round((u-l)/i)},f={width:Math.round((t.xmax-t.xmin)/s),height:Math.round((t.ymax-t.ymin)/i)};return Math.round(d.width/r.pixelBlock.width)*Math.round(d.height/r.pixelBlock.height)!==a.length||h.x<0||h.y<0||d.width<f.width||d.height<f.height?null:{extent:t,pixelBlock:p(a.map((e=>e.pixelBlock)),d,{clipOffset:h,clipSize:f})}},e.remap=function(e,t){if(!a(e))return null;const{width:i,height:n}=e,{inputRanges:o,outputValues:l,outputPixelType:c,noDataRanges:u,allowUnmatched:h,replacementValue:d,isLastInputRangeInclusive:p}=t,f=e.pixels[0],m=r.createEmptyBand(c,f.length),g=e.mask,y=new Uint8Array(i*n);g?y.set(g):y.fill(255);const x=e.pixelType.startsWith("f")?1e-6:0,w=o.map((e=>e-x));w[0]=o[0],w[w.length-1]=o[o.length-1]+(p?1e-6:0);const b=o.length/2,[_,v]=s.getPixelValueRange(c);for(let e=0;e<n;e++)for(let t=0;t<i;t++){const r=e*i+t;if(y[r]){const e=f[r];let t=!1;for(let s=b-1;s>=0;s--)if(e===o[2*s]||e>w[2*s]&&e<w[2*s+1]){m[r]=l[s],t=!0;break}t||(h?m[r]=e>v?v:e<_?_:d??e:y[r]=0)}}const S=u?.length;if(S)for(let e=0;e<n;e++)for(let t=0;t<i;t++){const r=e*i+t;if(!g||g[r]){const e=f[r];for(let t=0;t<S;t+=2)if(e>=u[t]&&e<=u[t+1]){m[r]=0,y[r]=0;break}}}return new r({width:i,height:n,pixelType:c,pixels:[m],mask:y})},e.remapColor=function(e,t){if(!a(e))return null;const r=e.clone(),{pixels:s}=r,i=r.width*r.height,n=t.length,o=Math.floor(n/2),l=t[Math.floor(o)],c=s[0],u=new Uint8Array(i),h=new Uint8Array(i),d=new Uint8Array(i);let p=r.mask;const f=4===t[0].mappedColor.length;p||(p=new Uint8Array(i),p.fill(f?255:1),r.mask=p);for(let e=0;e<i;e++)if(p[e]){const r=c[e];let s=!1,i=o,a=l,f=0,m=n-1;for(;m-f>1;){if(r===a.value){s=!0;break}r>a.value?f=i:m=i,i=Math.floor((f+m)/2),a=t[Math.floor(i)]}s||(r===t[f].value?(a=t[f],s=!0):r===t[m].value?(a=t[m],s=!0):r<t[f].value?s=!1:r>t[f].value&&(r<t[m].value?(a=t[f],s=!0):m===n-1?s=!1:(a=t[m],s=!0))),s?(u[e]=a.mappedColor[0],h[e]=a.mappedColor[1],d[e]=a.mappedColor[2],p[e]=a.mappedColor[3]):u[e]=h[e]=d[e]=p[e]=0}return r.pixels=[u,h,d],r.mask=p,r.pixelType="u8",r.maskIsAlpha=f,r},e.resampleByMajority=f,e.setValidBoundary=function(e,t,r){if(!a(e))return null;const{width:s,height:i}=e,n=t.x,o=t.y,l=r.width+n,c=r.height+o;if(n<0||o<0||l>s||c>i)return e;if(0===n&&0===o&&l===s&&c===i)return e;e.mask||(e.mask=new Uint8Array(s*i));const u=e.mask;for(let e=0;e<i;e++){const t=e*s;for(let r=0;r<s;r++)u[t+r]=e<o||e>=c||r<n||r>=l?0:1}return e.updateStatistics(),e},e.split=function(e,t,r=0,s=!0){if(!a(e))return null;const{width:i,height:n}=t;let{width:o,height:l}=e;const c=new Map,u={x:0,y:0},h=1+r;let d=e;for(let e=0;e<h;e++){const r=Math.ceil(o/i),a=Math.ceil(l/n);for(let s=0;s<a;s++){u.y=s*n;for(let n=0;n<r;n++){u.x=n*i;const r=x(d,u,t);c.set(`${e}/${s}/${n}`,r)}}e<h-1&&(d=w(d,s)),o=Math.round(o/2),l=Math.round(l/2)}return c},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/NDVITechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/NDVIShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterNDVIProcessor",this.type=t.RasterTechniqueType.NDVI,this.shaders={ndvi:new s.NDVIShader}}_process(e,t){const r=e.rasterFunction.parameters,s={scaled:r.scaled},i={bandIndexMat3:r.bandIndexMat3},n=this._getCommonConfig(e,t),a={shader:this.shaders.ndvi,uniforms:{config:n,ndviConfig:i},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:o,context:l}=e;o.submitDrawMesh(l,a,o.quadMesh)}}e.NDVITechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/NDVIShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","./BaseRasterProcessorShader","./math"],(function(e,t,r,s,i,n){"use strict";class a extends r.UniformGroup{}t.__decorate([r.uniform(s.Mat3)],a.prototype,"bandIndexMat3",void 0);class o extends i.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="NDVIShader",this.scaled=!0}_process(e){const t=this._getPixel(e),{r,g:i}=this.ndviConfig.bandIndexMat3.multiply(t.rgb),a=r.subtract(i),o=r.add(i),l=a.multiply(n.invertValue(o));if(!this.scaled)return new s.Vec4(l,l,l,t.a);const c=s.floor(l.multiply(100).add(100.5));return new s.Vec4(c,c,c,t.a)}}t.__decorate([r.define],o.prototype,"scaled",void 0),t.__decorate([r.uniform(a)],o.prototype,"ndviConfig",void 0),e.NDVIShader=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/RemapTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/RemapShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterRemapProcessor",this.type=t.RasterTechniqueType.Remap,this.shaders={remap:new s.RemapShader}}_process(e,t){const r=e.rasterFunction.parameters,s={replaceUnmatched:r.allowUnmatched&&null!=r.replacementValue},i={rangeMaps:[...r.rangeMaps],noDataRanges:[...r.noDataRanges],unmatchMask:r.allowUnmatched?1:0,replacementValue:r.replacementValue??0,clampRange:r.clampRange},n=this._getCommonConfig(e,t),a={shader:this.shaders.remap,uniforms:{config:n,remapConfig:i},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:o,context:l}=e;o.submitDrawMesh(l,a,o.quadMesh)}}e.RemapTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/RemapShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../../../../../../layers/support/rasterFunctions/pixelUtils","../../../../GraphShaderModule","../../../../graph/glsl","../../utils","./BaseRasterProcessorShader","./math"],(function(e,t,r,s,i,n,a,o){"use strict";class l extends s.UniformGroup{}t.__decorate([s.uniform(i.FixedArray.ofType(i.Float,3*r.maxMapSizeGpu))],l.prototype,"rangeMaps",void 0),t.__decorate([s.uniform(i.FixedArray.ofType(i.Float,2*r.maxMapSizeGpu))],l.prototype,"noDataRanges",void 0),t.__decorate([s.uniform(i.Float)],l.prototype,"unmatchMask",void 0),t.__decorate([s.uniform(i.Float)],l.prototype,"replacementValue",void 0),t.__decorate([s.uniform(i.Vec2)],l.prototype,"clampRange",void 0);class c extends a.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="RemapShader"}_process(e){const t=this._getPixel(e),{rangeMaps:s,unmatchMask:n,clampRange:a,replacementValue:l}=this.remapConfig,{mapValue:c,includeMask:u}=o.computeMapValue(t.r,s,r.maxMapSizeGpu),h=this.replaceUnmatched?l:n.multiply(t.r),d=i.mix(h,c,u),p=i.clamp(d,a.x,a.y),f=this._computeNoDataFactor(t.rrr).multiply(i.max(n,u));return new i.Vec4(p,p,p,t.a).multiply(f)}_computeNoDataFactor(e){const{noDataRanges:t}=this.remapConfig;let s=new i.Vec3(0,0,0);for(let n=0;n<r.maxMapSizeGpu/3;n++){const r=6*n,a=new i.Vec3(t[r],t[r+2],t[r+4]),o=new i.Vec3(t[r+1],t[r+3],t[r+5]);s=s.add(i.step(a,e).multiply(i.step(e,o)))}return n.oneMinus(i.sign(i.dot(s,new i.Vec3(1,1,1))))}}t.__decorate([s.uniform(l)],c.prototype,"remapConfig",void 0),t.__decorate([s.define],c.prototype,"replaceUnmatched",void 0),e.RemapShader=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/ReprojectTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/ReprojectShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterReprojectProcessor",this.type=t.RasterTechniqueType.Reproject,this.shaders={reproject:new s.ReprojectShader}}_process(e,t){const r=e.rasterFunction.parameters,s=this._getInterpolationDefines(t.interpolation,!!r.requireNNEdge),{config:i,projectionConfig:n,projectionDefines:a}=this._getReprojectConfig(t),o={shader:this.shaders.reproject,uniforms:{config:i,projectionConfig:n},defines:{...a,...s,applyPixelMask:!1},optionalAttributes:null,useComputeBuffer:!1},{interpolation:l}=t;t.interpolation="nearest";const{painter:c,context:u}=e;c.submitDrawMesh(u,o,c.quadMesh),t.interpolation=l,t.projected=!0}_getReprojectConfig(e){const{source:t}=e,{names:r,textures:s}=e.getTextures({forProcessing:!0}),i={texture:{texture:s[r.indexOf("u_image")],unit:0},dvsMat3:new Float32Array([2,0,0,0,2,0,-1,-1,0]),coordScale:[1,1],srcImageSize:[t.width,t.height],opacity:1},n=s[r.indexOf("u_transformGrid")],{transformGrid:a}=e,o=!(!n||!a);return{config:i,projectionConfig:o?{transformTexture:{texture:n,unit:1},targetImageSize:[e.width,e.height],transformSpacing:a.spacing,transformGridSize:a.size}:void 0,projectionDefines:{applyProjection:o,lookupProjection:o&&1===a.spacing[0]}}}_getInterpolationDefines(e,t){const r="bilinear"===e&&t;return{bilinear:r,bicubic:"cubic"===e,nearestOnEdge:r}}}e.ReprojectTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/ReprojectShader":function(){define(["exports","../BaseRasterColorizerShader"],(function(e,t){"use strict";class r extends t.BaseRasterColorizerShader{constructor(){super(...arguments),this.type="ReprojectShader"}_colorize(e){return this._getPixel(e)}}e.ReprojectShader=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/ShadedReliefTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/surface","../../shaders/raster/processor/ShadedReliefShader"],(function(e,t,r,s,i){"use strict";class n extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterShadedReliefProcessor",this.type=t.RasterTechniqueType.ShadedRelief,this.shaders={shadedRelief:new i.ShadedReliefShader}}_process(e,t,r){const i=e.rasterFunction.parameters,n={isMultidirectional:i.hillshadeType>0},a=t.getRasterCellSize(),o=s.computeZFactor(i,a),l={...i,factor:o},c={colormapTexture:{texture:r,unit:1},colormapOffset:i.offset,colormapMaxIndex:i.indexedColormap.length/4-1},u=this._getCommonConfig(e,t),h={shader:this.shaders.shadedRelief,uniforms:{config:u,hillshadeConfig:l,colormapConfig:c},defines:n,optionalAttributes:null,useComputeBuffer:!1},{painter:d,context:p}=e;d.submitDrawMesh(p,h,d.quadMesh)}}e.ShadedReliefTechnique=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/ShadedReliefShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../colorConversion","../lut","./HillshadeShader"],(function(e,t,r,s,i,n,a){"use strict";class o extends a.HillshadeShader{constructor(){super(...arguments),this.type="ShadedReliefShader"}_process(e){const t=super._process(e),{minValue:r,maxValue:a}=this.hillshadeConfig,o=this._getPixel(e),l=a.subtract(r),c=o.r.subtract(r),u=s.clamp(c.divide(l),new s.Float(0),new s.Float(1)),h=n.lookupColor(new s.Vec4(u,u,u,1),new s.Float(255),this.colormapConfig),d=i.rgb2hsv(h.xyz),p=i.hsv2rgb(new s.Vec3(d.xy,t.x.divide(255))).multiply(255);return new s.Vec4(p,h.a.multiply(t.a))}}t.__decorate([r.uniform(n.ColormapConfig)],o.prototype,"colormapConfig",void 0),e.ShadedReliefShader=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/SlopeTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/SlopeShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterSlopeProcessor",this.type=t.RasterTechniqueType.Slope,this.shaders={slope:new s.SlopeShader}}_process(e,t){const r=e.rasterFunction.parameters,s={isOutputRounded:r.isOutputRounded,percentRise:"percent-rise"===r.slopeType},i={cellSize:t.getRasterCellSize(),pixelSizePower:"adjusted"===r.slopeType?r.pixelSizePower:0,pixelSizeFactor:"adjusted"===r.slopeType?r.pixelSizeFactor:0,zFactor:r.zFactor},n=this._getCommonConfig(e,t),a={shader:this.shaders.slope,uniforms:{config:n,slopeConfig:i},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:o,context:l}=e;o.submitDrawMesh(l,a,o.quadMesh)}}e.SlopeTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/SlopeShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../surface","./BaseRasterProcessorShader","./math"],(function(e,t,r,s,i,n,a){"use strict";class o extends r.UniformGroup{}t.__decorate([r.uniform(s.Float)],o.prototype,"pixelSizePower",void 0),t.__decorate([r.uniform(s.Float)],o.prototype,"pixelSizeFactor",void 0),t.__decorate([r.uniform(s.Float)],o.prototype,"zFactor",void 0),t.__decorate([r.uniform(s.Vec2)],o.prototype,"cellSize",void 0);class l extends n.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="SlopeShader",this.isOutputRounded=!1,this.percentRise=!1}_process(e){const{cellSize:t,pixelSizePower:r,pixelSizeFactor:n,zFactor:o}=this.slopeConfig,l=s.pow(t,new s.Vec2(r)).multiply(n).add(o).divide(t.multiply(8)),{texture:c}=this.config,u=i.getSurfaceValues(c,e,this.config.srcImageSize),{x:h,y:d}=i.computeDeltaZ(u,l),p=s.sqrt(h.multiply(h).add(d.multiply(d))),f=this.percentRise?p.multiply(100):s.atan(p).multiply(57.2957795),m=new s.Vec4(f,f,f,u[9]);return this.isOutputRounded?a.roundOutput(m):m}}t.__decorate([r.define],l.prototype,"isOutputRounded",void 0),t.__decorate([r.define],l.prototype,"percentRise",void 0),t.__decorate([r.uniform(o)],l.prototype,"slopeConfig",void 0),e.SlopeShader=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/raster/processor/StretchTechnique":function(){define(["exports","../../TechniqueType","./BaseRasterProcessorTechnique","../../shaders/raster/processor/StretchShader"],(function(e,t,r,s){"use strict";class i extends r.BaseRasterProcessorTechnique{constructor(){super(...arguments),this.name="RasterStretchProcessor",this.type=t.RasterTechniqueType.Stretch,this.shaders={stretch:new s.StretchShader}}_process(e,t){const r=e.rasterFunction.parameters,s={isMultiband:r.bandCount>1,isOutputRounded:r.isOutputRounded,useGamma:r.useGamma},i=this._getCommonConfig(e,t),n={shader:this.shaders.stretch,uniforms:{config:i,stretchConfig:r},defines:s,optionalAttributes:null,useComputeBuffer:!1},{painter:a,context:o}=e;a.submitDrawMesh(o,n,a.quadMesh)}}e.StretchTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/raster/processor/StretchShader":function(){define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../stretch","./BaseRasterProcessorShader","./math"],(function(e,t,r,s,i,n,a){"use strict";class o extends n.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="StretchShader",this.isMultiband=!0,this.isOutputRounded=!1,this.useGamma=!1}_process(e){const t=this._getPixel(e);let r=i.stretch(t,this.stretchConfig,this.useGamma,1);return this.isMultiband||(r=new s.Vec4(r.rrr,r.a)),this.isOutputRounded?a.roundOutput(r):r}}t.__decorate([r.define],o.prototype,"isMultiband",void 0),t.__decorate([r.define],o.prototype,"isOutputRounded",void 0),t.__decorate([r.define],o.prototype,"useGamma",void 0),t.__decorate([r.uniform(i.StretchConfig)],o.prototype,"stretchConfig",void 0),e.StretchShader=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/imagery/BaseImageryTileSubView2D":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Logger","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../core/support/UpdatingHandles","../../../../geometry/Extent","../../../../geometry/Point","../../../../layers/support/PixelBlock","../../../../layers/support/TileInfo","../../../../layers/support/rasterDatasets/RawBlockCache","../../../../layers/support/rasterFunctions/rasterProjectionHelper","../../tiling/TileInfoView","../../tiling/TileKey","../../tiling/TileQueue","../../tiling/TileStrategy","../../engine/webgl/definitions","../../../support/Scheduler","../../../webgl/capabilities"],(function(e,t,r,s,i,n,a,o,l,c,u,h,d,p,f,m,g,y,x,w,b,_,v,S){"use strict";const T=[0,0];e.BaseImageryTileSubView2D=class extends r{constructor(){super(...arguments),this._updatingHandles=new u.UpdatingHandles,this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=[],this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._maxIndexedColormapSize=0,this._rasterFunctionState="na",this._globalUpdateRequested=!1,this.attached=!1,this.timeExtent=null,this.redrawOrRefetch=n.debounce((async(e={})=>{const t=this._rasterFunctionState,r=e.reprocess||"gpu"===t&&!this.canUseWebGLForProcessing||"cpu"===t&&this.canUseWebGLForProcessing;if(r&&(await this._updatingHandles.addPromise(this.layer.updateRasterFunction()),this.updateRasterFunctionParameters()),!this.previousLOD||this.layerView.suspended)return;const s=this._rasterFunctionState,{type:i}=this;return e.refetch||"raster"!==i&&r||"cpu"===s||"cpu"===t?this._updatingHandles.addPromise(this.doRefresh()):this._updatingHandles.addPromise(this._redrawImage(e.signal))}))}destroy(){this._updatingHandles.destroy()}get canUseWebGLForProcessing(){return!1}get canUseLocalSymbolizerParams(){return(this.canUseWebGLForProcessing||"rasterVF"===this.type)&&!this.layerView.hasTilingEffects}get useWebGLForProcessing(){return this._get("useWebGLForProcessing")??!0}set useWebGLForProcessing(e){this._set("useWebGLForProcessing",e)}get useProgressiveUpdate(){return this._get("useProgressiveUpdate")??!0}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();const t=this._getCacheSize(e);this._tileStrategy=new b({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:r,scale:s}=e.state,i=this._tileInfoView.getClosestInfoForScale(s);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[i.level],s="toJSON"in t?t:h.fromJSON(t);m.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,s,r,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,this.previousLOD?.level!==i.level&&(this.previousLOD=i,null!=this._symbolizerParams&&this.canUseLocalSymbolizerParams&&this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()})));const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.layerView.requestUpdate()}get updating(){return this._globalUpdateRequested||this._updatingHandles?.updating}attach(){const e=S.getWebGLCapabilities();this._maxIndexedColormapSize=4*(e.maxTextureSize||4096),this._initializeTileInfo(),this._tileInfoView=new y(this.layerView.tileInfo,this.layerView.fullExtent);const t=this._computeFetchConcurrency();this._fetchQueue=new w({tileInfoView:this._tileInfoView,concurrency:t,process:(e,t)=>this._fetchTile(e,t),priority:v.TaskPriority.MAPVIEW_FETCH_QUEUE,scheduler:this.scheduler});const r=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new b({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:r,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,m.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(e){const t=this.container.createTile(e);return this._updatingHandles.addPromise(this._enqueueTileFetch(t)),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",(()=>{e.destroy(),this.layerView.requestUpdate()})),this.layerView.requestUpdate()}createEmptyTilePixelBlock(e=null){const t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const[r,s]=e,i=new p({width:r,height:s,pixels:[new Uint8Array(r*s)],mask:new Uint8Array(r*s),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=i),i}_getBandIds(){if(!("rasterFunctionChain"in this.container)||!this.container.rasterFunctionChain)return this.layer.bandIds;const{bandIds:e,raster:t}=this.layer,r="rasterFunction"in t?t.rasterFunction.rawInputBandIds:null;return e?.length&&r?.length&&1!==t.rasterInfo.bandCount?e.map((e=>r[Math.min(e,r.length-1)])):"rasterFunction"in t?r:e}updateRasterFunctionParameters(){}_fetchTile(e,t){const r=this._getFetchOptions(e.level,t.signal);return this.fetchTile(e,r)}_getFetchOptions(e,t){const{canUseWebGLForProcessing:r}=this,{layerView:s}=this,{tileInfo:i}=s,n=!i.isWrappable&&null!=g.getWorldWidth(s.view.spatialReference),a=r&&this.layer.raster.hasUniqueSourceStorageInfo,{layer:o}=this.layerView,l=o.serviceRasterInfo?.storageInfo.isBsqTile?o.bandIds:void 0;return{allowPartialFill:!0,datumTransformation:s.datumTransformation,interpolation:r?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:a,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:t,srcResolution:this._srcResolutions[e],timeExtent:s.timeExtent,tileInfo:i,bandIds:l,disableWrapAround:n}}_getCacheSize(e){return e?40:0}_initializeTileInfo(){const{layerView:e}=this,t=e.view.spatialReference;if(this._canUseLayerLODs()){const{origin:r,lods:s}=this.layer.tileInfo,i=s.map((({scale:e})=>e)),n=f.create({spatialReference:t,size:_.tileSize,scales:i,origin:r});return e.set("tileInfo",n),void(this._srcResolutions=s.map((({resolution:e})=>({x:e,y:e}))))}const{scales:r,srcResolutions:s,isCustomTilingScheme:n}=g.computeProjectedScales(this.layer.serviceRasterInfo,t,{tileSize:_.tileSize,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:!1}),a=f.create({spatialReference:t,size:_.tileSize,scales:r}),o=0===a.origin.x;i.assertIsSome(e.fullExtent);const{xmin:l,ymax:c}=e.fullExtent;(o||n&&a.origin.x>l)&&(a.origin=new d({x:l,y:c,spatialReference:t})),this._isCustomTilingScheme=n,e.set("tileInfo",a),this._srcResolutions=s??[]}_canUseLayerLODs(){const{layer:e,layerView:t}=this;if("Map"!==e.raster.tileType)return!1;const{lods:r}=e.tileInfo,s=t.view.constraints?.effectiveLODs;return s?.length===r.length&&s.every((({scale:e},t)=>Math.abs(e-r[t].scale)<.001))}_computeFetchConcurrency(){const{blockBoundary:e}=this.layer.serviceRasterInfo.storageInfo,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}async _enqueueTileFetch(e,t){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key),r=this._getBandIds();let i=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){i=!1;try{await this._redrawImage(this._abortController?.signal)}catch(e){n.isAbortError(e)&&s.getLogger(this).error(e)}this._globalUpdateRequested=!1}this.canUseLocalSymbolizerParams&&null==this._symbolizerParams&&this._updateSymbolizerParams();const a=this._tileInfoView.getTileCoords(T,e.key),o=this._tileInfoView.getTileResolution(e.key);await this.updateTileSource(e,{source:t,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:i,bandIds:r,coords:a,resolution:o}),e.once("attach",(()=>this.layerView.requestUpdate())),this.container.addChild(e)}catch(e){n.isAbortError(e)||s.getLogger(this).error(e)}this.layerView.requestUpdate()}}async _redrawImage(e){if(0===this.container.children.length)return;await this.layer.updateRenderer(),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this.canUseLocalSymbolizerParams&&this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const t=this.container.children.map((async e=>this.updateTileSymbolizerParameters(e,{local:this._symbolizerParams,global:this._globalSymbolizerParams})));await Promise.allSettled(t),this.container.requestRender()}async _updateGlobalSymbolizerParams(e){const t=this._getFetchOptions(this.previousLOD.level,e),r=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,{...t,interpolation:"nearest",requestRawData:!1,skipRasterFunction:!1});if(!r?.pixelBlock)return;const{resolution:s}=this.previousLOD,i=this._getBandIds(),n=this.layer.symbolizer.generateWebGLParameters({pixelBlock:r.pixelBlock.extractBands(i),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:s,y:s},bandIds:i});!this.canUseWebGLForProcessing&&n&&"stretch"===n.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(n.factor=n.factor.map((e=>255*e)),n.minOutput=Math.round(255*n.minOutput),n.maxOutput=Math.round(255*n.maxOutput)),this._globalSymbolizerParams=n}_updateSymbolizerParams(){const{resolution:e}=this.previousLOD,t=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:e,y:e},bandIds:t})}_updateBlockCacheRegistry(e=!1){const{layer:t,layerView:r}=this,{raster:s}=t,{multidimensionalDefinition:i}=t.normalizeRasterFetchOptions({multidimensionalDefinition:t.multidimensionalDefinition,timeExtent:r.timeExtent}),n=s.rasterInfo.multidimensionalInfo?s.getSliceIndex(i):null,a=s.rasterInfo.storageInfo.isBsqTile&&t.bandIds?.length?t.bandIds:null,o=m.getRasterId(s.rasterId,n,a);if(o!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&m.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=m.register(o,s.rasterInfo),e){const{view:e}=r,t=this._tileInfoView.getClosestInfoForScale(e.scale),i=this._srcResolutions[t.level];m.update(o,this._blockCacheRegistryId,e.extent,e.resolution,i,s.ioConfig.sampling)}this._blockCacheRegistryUrl=o}}async doRefresh(){if(!this.attached||!this.previousLOD||this.layerView.suspended)return;await this.layer.updateRenderer(),this.canUseLocalSymbolizerParams&&this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset();const e=[];this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,this._tileStrategy.refresh((t=>e.push(this._enqueueTileFetch(t)))),await this._updatingHandles.addPromise(Promise.allSettled(e))}},t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"_globalUpdateRequested",void 0),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"attached",void 0),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"canUseWebGLForProcessing",null),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"canUseLocalSymbolizerParams",null),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"container",void 0),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"layer",void 0),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"layerView",void 0),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"scheduler",void 0),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"type",void 0),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"useWebGLForProcessing",null),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"useProgressiveUpdate",null),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"timeExtent",void 0),t.__decorate([a.property()],e.BaseImageryTileSubView2D.prototype,"updating",null),e.BaseImageryTileSubView2D=t.__decorate([c.subclass("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],e.BaseImageryTileSubView2D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define(["exports","../../../geometry/Point","./EphemeralBlockCache","../rasterFunctions/rasterProjectionHelper"],(function(e,t,r,s){"use strict";const i=new Map,n=new r;e.decreaseRefCount=function(e,t,r){const s=i.get(e);if(!s)return null==t?n.decreaseRefCount(e,r):0;if(null==t||null==s[t])return n.decreaseRefCount(e,r);const a=s[t]?.cache,o=a?.get(r);if(a&&o){if(o.refCount--,0===o.refCount){a.delete(r);for(let e=0;e<s.length;e++)s[e]?.cache.delete(r);o.controller&&o.controller.abort()}return o.refCount}return 0},e.deleteBlock=function(e,t,r){const s=i.get(e);s?null!=t&&null!=s[t]?s[t]?.cache.delete(r):n.deleteBlock(e,r):null==t&&n.deleteBlock(e,r)},e.deleteRaster=function(e){i.delete(e)},e.getBlock=function(e,t,r){const s=i.get(e);if(!s)return null==t?n.getBlock(e,r):null;if(null==t||null==s[t]){for(let e=0;e<s.length;e++){const t=s[e]?.cache.get(r);if(t)return t.refCount++,t.block}return n.getBlock(e,r)}const a=s[t]?.cache.get(r);if(a)return a.refCount++,a.block;for(let e=0;e<s.length;e++){if(e===t||!s[e])continue;const i=s[e]?.cache,n=i?.get(r);if(i&&n)return n.refCount++,i.set(r,n),n.block}return null},e.getRasterId=function(e,t,r){const s=[];return null!=t&&s.push(`sliceId=${t}`),null!=r&&s.push(`bandIds=${r.join(",")}`),s.length?`${e}?${s.join("&")}`:e},e.putBlock=function(e,t,r,s,a=null){const o=i.get(e);if(!o)return void(null==t&&n.putBlock(e,r,s,a));if(null==t||null==o[t])return void n.putBlock(e,r,s,a);const l={refCount:1,block:s,isResolved:!1,isRejected:!1,controller:a};s.then((()=>l.isResolved=!0)).catch((()=>l.isRejected=!0)),o[t]?.cache.set(r,l)},e.register=function(e,t){const r={extent:null,rasterInfo:t,cache:new Map},s=i.get(e);return s?(s.push(r),s.length-1):(i.set(e,[r]),0)},e.unregister=function(e,t){const r=i.get(e);r&&(r[t]=null,r.some((e=>null!=e))||i.delete(e))},e.update=function(e,r,n,a,o,l,c=null){const u=function(e,t){const r=i.get(e);return r?r[t]??null:null}(e,r);if(!u)return;const h=u.extent,{cache:d,rasterInfo:p}=u;if(h&&h.xmin===n.xmin&&h.xmax===n.xmax&&h.ymin===n.ymin&&h.ymax===n.ymax)return;a=a??0;const f=n.clone().normalize(),{spatialReference:m,transform:g}=p,y=new Set;for(let e=0;e<f.length;e++){const r=f[e];if(r.xmax-r.xmin<=a||r.ymax-r.ymin<=a)continue;let i=s.projectExtent(r,m,c);if(null==i)continue;if(null!=g&&(i=g.inverseTransform(i),null==i))continue;const n=new t({x:a,y:a,spatialReference:r.spatialReference});if(null==o&&!(o=s.projectResolution(n,m,r,c)))return;const{pyramidLevel:u,pyramidResolution:h,excessiveReading:d}=s.snapPyramid(o,p,l||"closest");if(d)return;const{storageInfo:x}=p,{origin:w}=x,{x:b,y:_}=h,v=Math.max(0,Math.floor((i.xmin-w.x)/b)),S=Math.max(0,Math.floor((w.y-i.ymax)/_)),T=Math.ceil(i.width/b-.1),M=Math.ceil(i.height/_-.1),R=u>0?x.pyramidBlockWidth:x.blockWidth,C=u>0?x.pyramidBlockHeight:x.blockHeight,P=x.blockBoundary[u];if(!P)continue;const k=1,F=Math.max(P.minCol,Math.floor(v/R)-k),V=Math.max(P.minRow,Math.floor(S/C)-k),I=Math.min(P.maxCol,Math.floor((v+T-1)/R)+k),D=Math.min(P.maxRow,Math.floor((S+M-1)/C)+k);for(let e=V;e<=D;e++)for(let t=F;t<=I;t++)y.add(`${u}/${e}/${t}`)}d.forEach(((e,t)=>{if(!y.has(t)){const e=d.get(t);(null==e||e.isResolved||e.isRejected)&&d.delete(t)}})),u.extent={xmin:n.xmin,ymin:n.ymin,xmax:n.xmax,ymax:n.ymax}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define((function(){"use strict";return class{constructor(e=15e3,t=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}decreaseRefCount(e,t){const r=e+"/"+t,s=this._cachedBlocks;if(s.has(r)){const e=s.get(r);return e.refCount--,e.refCount<=0&&(s.delete(r),e.controller&&e.controller.abort()),e.refCount}return 0}getBlock(e,t){const r=e+"/"+t,s=this._cachedBlocks;if(s.has(r)){const e=s.get(r);return e.ts=Date.now(),e.refCount++,s.delete(r),s.set(r,e),e.block}return null}putBlock(e,t,r,s){const i=this._cachedBlocks,n=e+"/"+t;if(i.has(n)){const e=i.get(n);e.ts=Date.now(),e.refCount++}else i.set(n,{block:r,ts:Date.now(),refCount:1,controller:s});this._trim(),this._updateTimer()}deleteBlock(e,t){const r=this._cachedBlocks,s=e+"/"+t;r.has(s)&&r.delete(s)}updateMaxSize(e){this._size=e,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval((()=>{const t=Array.from(e),r=Date.now();for(let s=0;s<t.length&&t[s][1].ts<=r-this._duration;s++)e.delete(t[s][0]);0===e.size&&this._clearTimer()}),this._interval)}_trim(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const t=Array.from(e);for(let r=0;r<t.length-this._size;r++)e.delete(t[r][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}}))},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define(["require","exports","../../../core/arrayUtils","../../../core/Error","../../../core/promiseUtils","../../../core/unitUtils","../../../geometry/Extent","../../../chunks/pe","../../../geometry/Point","../../../geometry/Polygon","../../../geometry/projectionUtils","../../../geometry/SpatialReference","../../../geometry/support/spatialReferenceUtils"],(function(e,t,r,s,i,n,a,o,l,c,u,h,d){"use strict";var p;function f(){if(!S)throw new s("rasterprojectionhelper-project","projection operator is not loaded")}!function(e){e[e.None=0]="None",e[e.North=1]="North",e[e.South=2]="South",e[e.Both=3]="Both"}(p||(p={}));const m=(e,t,r,s=0)=>{if(1===r[0])return[0,0];let i=1,n=-1,a=1,o=-1;for(let t=0;t<e.length;t+=2)isNaN(e[t])||(i=i>e[t]?e[t]:i,n=n>e[t]?n:e[t],a=a>e[t+1]?e[t+1]:a,o=o>e[t+1]?o:e[t+1]);const{cols:l,rows:c}=t,u=(n-i)/l/r[0],h=(o-a)/c/r[1],d=2*s;let p=0,f=!1,m=[0,0];for(let t=0;t<l-3;t++){for(let r=0;r<c-3;r++){const s=t*c*2+2*r,i=(e[s]+e[s+4]+e[s+4*c]+e[s+4*c+4])/4,n=(e[s+1]+e[s+5]+e[s+4*c+1]+e[s+4*c+5])/4,a=Math.abs((i-e[s+2*c+2])/u),o=Math.abs((n-e[s+2*c+3])/h);if(a+o>p&&(p=a+o,m=[a,o]),d&&p>d){f=!0;break}}if(f)break}return m},g={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},y=new Map,x=new Map,w=500;let b,_,v,S=!1;function T(e,t,r){if(f(),r){const r=_.execute(e,t);return v.getTransformation(t,e.spatialReference,r)}return v.getTransformation(e.spatialReference,t,e)}function M(e,t,r){const s=n.getMetersPerUnitForSR(t)/n.getMetersPerUnitForSR(r);return{x:e.x*s,y:e.y*s}}function R(e,t,r){const{spatialReference:i}=r;if(!i||!t||i.equals(t))return e;if(i.isGeographic&&t.isGeographic)return M(e,i,t);if(f(),!S)throw new s("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:a,y:o}=e;const l=(a+o)/2*n.getMetersPerUnitForSR(i);let u=1;l>30&&(u=30/l,a*=u,o*=u);const h=256,d=a*h/2,p=o*h/2,{x:m,y:g}=r.center,y=[];for(let e=0;e<=h;e++)y.push([m-d,g-p+e*o]);for(let e=1;e<=h;e++)y.push([m-d+e*a,g+p]);for(let e=1;e<=h;e++)y.push([m+d,g+p-e*o]);for(let e=1;e<h;e++)y.push([m+d-e*a,g-p]);y.push(y[0]);const x=new c({rings:[y],spatialReference:i}),w=_.execute(x,t);if(!w)return M(e,i,t);const b=w.extent,v=z(t);if(null==b||null!=v&&b.width>=v)return M(e,i,t);const T=function(e){let t=0;for(const r of e){const e=r.length;let s=r[0][0]*(r[1][1]-r[e-2][1]);for(let t=1;t<e-1;t++)s+=r[t][0]*(r[t+1][1]-r[t-1][1]);t+=s/2}return Math.abs(t)}(w.rings),R=a*o*h*h,C=Math.sqrt(T/R)/u,P={x:b.width/u/h,y:b.height/u/h},k={x:a*C,y:o*C},F=P.x*P.y;return Math.abs(F-k.x*k.y)/F<.1?P:k}function C(e,t){return("number"==typeof e?e:(e.x+e.y)/2)*n.getMetersPerUnitForSR(t)*96*39.37}function P(e,t=.01){return n.getMetersPerUnitForSR(e)?t/n.getMetersPerUnitForSR(e):0}function k(e,t,r,s=!0){const i=e.spatialReference;if(i.equals(t))return e;f();const n=_.execute(e,t,{geographicTransformation:r});return s&&n?(F([e],[n],i,t),n):n}function F(e,t,r,s){const i=E(r,!0),n=E(s,!0),a=P(r,w),o=P(s,w);if(a&&null!=i&&null!=n)for(let r=0;r<e.length;r++){const s=t[r];if(!s)continue;const{x:l}=e[r],{x:c}=s;c>=n[1]-o&&Math.abs(l-i[0])<a?s.x-=n[1]-n[0]:c<=n[0]+o&&Math.abs(l-i[1])<a&&(s.x+=n[1]-n[0])}}function V(e){const{inSR:t,outSR:r,preferPE:s}=e;if(t.equals(r)){const{points:t}=B(e,null);return t}if(t.isWebMercator&&r.isWGS84||t.isWGS84&&r.isWebMercator)return function(e){const{cols:t,rows:r,xres:s,yres:i,usePixelCenter:n,inSR:a,outSR:o}=e;let{xmin:c,ymax:h}=e;n&&(c+=s/2,h-=i/2);const d=[],p=[],f=Math.max(t,r);for(let e=0;e<f;e++){const n=c+s*Math.min(t,e),f=h-i*Math.min(r,e),m=u.projectWithoutEngine(new l({x:n,y:f,spatialReference:a}),a,o);e<=t&&d.push(m.x),e<=r&&p.push(m.y)}const m=[];for(let e=0;e<t;e++)for(let t=0;t<r;t++)m.push([d[e],p[t]]);return m}(e);if(s){if(t.isGeographic)return I(e);if(null!=D(t))return I(e)}return function(e){const{points:t}=B(e,null),{inSR:r,outSR:s,datumTransformation:i}=e,n=t.map((e=>new l(e[0],e[1],r))),a=_.executeMany(n,s,{geographicTransformation:i});return i&&F(n,a,r,s),a.map((e=>e?[e.x,e.y]:[NaN,NaN]))}(e)}function I(e){const{inSR:t,outSR:r,datumTransformation:s}=e,i=D(t),{points:n,mask:a}=B(e,i);if(!t.isGeographic){const e=t.wkid?o.PeFactory.coordsys(t.wkid):o.PeFactory.fromString(t.isGeographic?o.PeDefs.PE_TYPE_GEOGCS:o.PeDefs.PE_TYPE_PROJCS,t.wkt2||t.wkt);o.PeCSTransformations.projToGeog(e,n.length,n)}if(null!=s&&s.steps.length){let e;const t=179.9955;if(r.isGeographic&&(e=n.map((([e])=>e>t?1:e<-179.9955?-1:0))),s.steps.forEach((e=>{const t=e.wkid?o.PeFactory.geogtran(e.wkid):o.PeFactory.fromString(o.PeDefs.PE_TYPE_GEOGTRAN,e.wkt);o.PeGTTransformations.geogToGeog(t,n.length,n,null,e.isInverse?o.PeDefs.PE_TRANSFORM_2_TO_1:o.PeDefs.PE_TRANSFORM_1_TO_2)})),e)for(let r=0;r<n.length;r++){const s=e[r],i=n[r][0],a=i>t?1:i<-179.9955?-1:0;s&&a&&s!==a&&(n[r][0]=s>0?i+360:i-360)}}if(!r.isGeographic){const e=D(r,!0),t=null!=e&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];!function(e,t){const[r,s]=t;for(let t=0;t<e.length;t++){const i=e[t][1];(i<r||i>s)&&(e[t]=[NaN,NaN])}}(n,t);const s=r.wkid?o.PeFactory.coordsys(r.wkid):o.PeFactory.fromString(r.isGeographic?o.PeDefs.PE_TYPE_GEOGCS:o.PeDefs.PE_TYPE_PROJCS,r.wkt2||r.wkt);o.PeCSTransformations.geogToProj(s,n.length,n)}let l=n;if(a&&n.length!==a.length){l=[];for(let e=0,t=0;e<a.length;e++)a[e]?l.push(n[t++]):l.push([NaN,NaN])}return l}function D(e,t=!1){let r=e.wkid||e.wkt2||e.wkt;if(!r||e.isGeographic)return null;if(r=String(r),y.has(r)){const e=y.get(r);return t?e?.gcs:e?.pcs}const s=e.wkid?o.PeFactory.coordsys(e.wkid):o.PeFactory.fromString(e.isGeographic?o.PeDefs.PE_TYPE_GEOGCS:o.PeDefs.PE_TYPE_PROJCS,e.wkt2||e.wkt),i=A(s,P(e,1e-4)),n=A(s,0,!0);return y.set(r,{pcs:i,gcs:n}),t?n:i}function A(e,t=0,r=!1){const s=o.PePCSInfo.generate(e),i=r?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!s||!i?.length)return null;let n=!1,a=i.find((e=>1===e.getInclusive()&&1===e.getKind()));if(!a){if(a=i.find((e=>1===e.getInclusive()&&0===e.getKind())),!a)return null;n=!0}const l=r?0:(2===s.getNorthPoleLocation()?1:0)|(2===s.getSouthPoleLocation()?2:0),c=s.isPannableRectangle(),u=a.getCoord();if(n)return{isEnvelope:n,isPannable:c,vertices:u,coef:null,bbox:[u[0][0]-t,u[0][1]-t,u[1][0]+t,u[1][1]+t],poleLocation:l};let h=0;const d=[];let[p,f]=u[0],[m,g]=u[0];for(let e=0,t=u.length;e<t;e++){h++,h===t&&(h=0);const[r,s]=u[e],[i,n]=u[h];if(n===s)d.push([r,i,s,n,2]);else{const e=(i-r)/(n-s||1e-4),t=r-e*s;s<n?d.push([e,t,s,n,0]):d.push([e,t,n,s,1])}p=p<r?p:r,f=f<s?f:s,m=m>r?m:r,g=g>s?g:s}return{isEnvelope:!1,isPannable:c,vertices:u,coef:d,bbox:[p,f,m,g],poleLocation:l}}function B(e,t){const r=[],{cols:s,rows:i,xres:n,yres:a,usePixelCenter:o}=e;let{xmin:l,ymax:c}=e;if(o&&(l+=n/2,c-=a/2),null==t){for(let e=0;e<s;e++)for(let t=0;t<i;t++)r.push([l+n*e,c-a*t]);return{points:r}}const u=new Uint8Array(s*i);if(t.isEnvelope){const{bbox:[e,o,h,d]}=t;for(let p=0,f=0;p<s;p++){const s=l+n*p,m=t.isPannable||s>=e&&s<=h;for(let e=0;e<i;e++,f++){const t=c-a*e;m&&t>=o&&t<=d&&(r.push([s,t]),u[f]=1)}}return{points:r,mask:u}}const h=t.coef,d=[];for(let e=0;e<i;e++){const t=c-a*e,r=[],s=[];for(let e=0;e<h.length;e++){const[i,n,a,o,l]=h[e];if(t===a&&a===o)r.push(i),r.push(n),s.push(2),s.push(2);else if(t>=a&&t<=o){const e=i*t+n;r.push(e),s.push(l)}}let i=r;if(r.length>2){let e=2===s[0]?0:s[0],t=r[0];i=[];for(let n=1;n<s.length;n++)2===s[n]&&n!==s.length-1||(s[n]!==e&&(i.push(0===e?Math.min(t,r[n-1]):Math.max(t,r[n-1])),e=s[n],t=r[n]),n===s.length-1&&i.push(0===s[n]?Math.min(t,r[n]):Math.max(t,r[n])));i.sort(((e,t)=>e-t))}else r[0]>r[1]&&(i=[r[1],r[0]]);d.push(i)}for(let e=0,t=0;e<s;e++){const s=l+n*e;for(let e=0;e<i;e++,t++){const i=c-a*e,n=d[e];if(2===n.length)s>=n[0]&&s<=n[1]&&(r.push([s,i]),u[t]=1);else if(n.length>2){let e=!1;for(let t=0;t<n.length;t+=2)if(s>=n[t]&&s<=n[t+1]){e=!0;break}e&&(r.push([s,i]),u[t]=1)}}}return{points:r,mask:u}}function O(e,t){const r=z(e[0].spatialReference);if(e.length<2||null==r)return e[0];if(t=t??P(e[0].spatialReference),1===(e=e.filter((e=>e.width>t))).length)return e[0];let{xmin:s,xmax:i,ymin:n,ymax:o}=e[0];for(let t=1;t<e.length;t++){const s=e[t];i=s.xmax+r*t,n=Math.min(n,s.ymin),o=Math.max(o,s.ymax)}return new a({xmin:s,xmax:i,ymin:n,ymax:o,spatialReference:e[0].spatialReference})}function q(e,t,s=null,i=!0){const n=e.spatialReference;if(n.equals(t)||!t)return e;const o=j(e),l=z(n,!0),u=z(t);if(0===o||null==l||null==u){const r=U(e,t,s,i);if(r&&null==l&&null!=u&&Math.abs(r.width-u)<P(t)&&_.isLoaded()){const s=D(n);if(null!=s&&s.poleLocation===p.None&&e.width<(s.bbox[2]-s.bbox[0])/2)return function(e,t){const r=z(t);if(null==r)return null;let{xmin:s,ymin:i,xmax:n,ymax:o}=e;const l=e.spatialReference,u=new c({spatialReference:l,rings:[[[s,i],[n,i],[n,o],[s,o],[s,i]]]}),h=_.execute(u,t);if(2!==h.rings.length||!h.rings[0].length||!h.rings[1].length)return null;const{rings:d}=h,p=P(l),f=new a({spatialReference:t});for(let e=0;e<2;e++){s=n=d[e][0][0],i=o=d[e][0][1];for(let t=0;t<d[e].length;t++)s=s>d[e][t][0]?d[e][t][0]:s,n=n<d[e][t][0]?d[e][t][0]:n,i=i>d[e][t][1]?d[e][t][1]:i,o=o<d[e][t][1]?d[e][t][1]:o;if(0===e)f.ymin=i,f.ymax=o,f.xmin=s,f.xmax=n;else if(f.ymin=Math.min(f.ymin,i),f.ymax=Math.max(f.ymax,o),Math.abs(n-r/2)<p)f.xmin=s,f.xmax=f.xmax+r;else{if(!(Math.abs(s+r/2)<p))return null;f.xmax=n+r}}return f}(e,t)||r}return r}const h=e.clone().normalize();if(1===h.length&&e.xmax<l&&e.xmax-l/2>P(n)){const{xmin:t,xmax:r}=e;for(let s=0;s<=o;s++){const i=0===s?t:-l/2,c=s===o?r-l*s:l/2;h[s]=new a({xmin:i,xmax:c,ymin:e.ymin,ymax:e.ymax,spatialReference:n})}}const d=h.map((e=>U(e,t,s,i))).filter(r.isSome);return 0===d.length?null:O(d)}function U(e,t,r,s=!0,i=!0){const n=e.spatialReference;if(n.equals(t)||!t)return e;f();const a=_.execute(e,t,{geographicTransformation:r});if(i&&t.isWebMercator&&a&&(a.ymax=Math.min(20037508.342787,a.ymax),a.ymin=Math.max(-20037508.342787,a.ymin),a.ymin>=a.ymax))return null;if(!s||!a)return a;const o=E(n,!0),c=E(t,!0);if(null==o||null==c)return a;const u=P(n,.001),h=P(n,w),d=P(t,.001);if(Math.abs(a.xmin-c[0])<d&&Math.abs(a.xmax-c[1])<d){const s=Math.abs(e.xmin-o[0]),i=Math.abs(o[1]-e.xmax);if(s<u&&i>h){a.xmin=c[0];const s=[];s.push(new l(e.xmax,e.ymin,n)),s.push(new l(e.xmax,(e.ymin+e.ymax)/2,n)),s.push(new l(e.xmax,e.ymax,n));const i=s.map((e=>k(e,t,r))).filter((e=>!isNaN(e?.x))).map((e=>e.x));a.xmax=Math.max.apply(null,i)}if(i<u&&s>h){a.xmax=c[1];const s=[];s.push(new l(e.xmin,e.ymin,n)),s.push(new l(e.xmin,(e.ymin+e.ymax)/2,n)),s.push(new l(e.xmin,e.ymax,n));const i=s.map((e=>k(e,t,r))).filter((e=>!isNaN(e?.x))).map((e=>e.x));a.xmin=Math.min.apply(null,i)}}else{const e=P(t,.001);Math.abs(a.xmin-c[0])<e&&(a.xmin=c[0]),Math.abs(a.xmax-c[1])<e&&(a.xmax=c[1])}return a}function z(e,t=!1){if(!e)return null;const r=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*r:e.wkid&&e.isGeographic?360:2*g[e.wkid]||null}function E(e,t=!1){if(e.isGeographic)return[-180,180];const r=z(e,t);return null!=r?[-r/2,r/2]:null}function G(e,t,r,s){let i=(e-t)/r;return i-Math.floor(i)!==0?i=Math.floor(i):s&&(i-=1),i}function j(e,t=!1){const r=z(e.spatialReference);if(null==r)return 0;const s=t?0:-r/2,i=P(e.spatialReference),n=!t&&Math.abs(e.xmax-r/2)<i?r/2:e.xmax,a=!t&&Math.abs(e.xmin+r/2)<i?-r/2:e.xmin;return G(n,s,r,!0)-G(a,s,r,!1)}function L(e){const{projectedExtent:t,srcBufferExtent:r,pixelSize:s,datumTransformation:i,rasterTransform:n}=e,a=t.spatialReference,o=r.spatialReference;f();const{xmin:c,ymin:u,xmax:h,ymax:d}=t,p=z(o),m=null!=p&&(e.hasWrapAround||"gcs-shift"===n?.type),g=e.spacing||[32,32],y=g[0]*s.x,x=g[1]*s.y,b=1===g[0],_=Math.ceil((h-c)/y-.1/g[0])+(b?0:1),v=Math.ceil((d-u)/x-.1/g[1])+(b?0:1),S=V({cols:_,rows:v,xmin:c,ymax:d,xres:y,yres:x,inSR:a,outSR:o,datumTransformation:i,preferPE:g[0]<=4,usePixelCenter:b}),T=[];let M,R=0;const C=b?-1:NaN,{xmin:k,xmax:F,ymax:I,width:A,height:B}=r,O=P(o,w),q=null!=p&&k>0&&F>p/2,U=D(a),E=null!=U&&U.poleLocation>0;for(let e=0;e<_;e++){const t=[];for(let r=0;r<v;r++){let s=S[e*v+r];if(m&&s[0]>F&&s[0]>p/2-O?s[0]-=p:m&&0===e&&s[0]<0&&q&&!n&&(s[0]+=p),!s||isNaN(s[0])||isNaN(s[1]))T.push(C),T.push(C),t.push(null),R++;else{if(n){const e=n.inverseTransform(new l({x:s[0],y:s[1],spatialReference:o}));s=[e.x,e.y]}t.push(s),e>0&&m&&M[r]&&s[0]<M[r][0]&&(s[0]+=p,E&&s[0]>F&&s[0]>p&&(s[0]-=p)),T.push((s[0]-k)/A),T.push((I-s[1])/B)}}M=t}return{offsets:T,error:null,coefficients:null,outofBoundPointCount:R,spacing:g,size:b?[_,v]:[_-1,v-1]}}function N(e,t,r){const{cols:s,rows:i}=t,n=new Float32Array((s-1)*(i-1)*2*6),a=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),o=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let t=0;t<s-1;t++){for(let r=0;r<i-1;r++){let l=t*i*2+2*r;const c=e[l],u=e[l+1],h=e[l+2],d=e[l+3];l+=2*i;const p=e[l],f=e[l+1],m=e[l+2],g=e[l+3];let y=0,x=12*(r*(s-1)+t);for(let e=0;e<3;e++)n[x++]=a[y++]*c+a[y++]*h+a[y++]*m;y=0;for(let e=0;e<3;e++)n[x++]=a[y++]*u+a[y++]*d+a[y++]*g;y=0;for(let e=0;e<3;e++)n[x++]=o[y++]*c+o[y++]*p+o[y++]*m;y=0;for(let e=0;e<3;e++)n[x++]=o[y++]*u+o[y++]*f+o[y++]*g}if(r)for(let e=0;e<n.length;e++)isNaN(n[e])&&(n[e]=-1)}return n}function W(e,t){const r=e.clone().normalize();return 1===r.length?r[0]:O(r,t)}function H(e,t,r=!1){const{pixelSize:s,extent:i}=e,n=T(i,t,!1),a=q(W(i,(s.x+s.y)/16),t,n);return!a||r||0===j(a)?a:U(i,t,n)}t.computeProjectedScales=function(e,t,r){const s=r?.tileSize??512,i=r?.alignGlobalDatasetWithAGOL??!0,n=!!r?.limitToSrcResolution,{extent:a,spatialReference:o,pixelSize:l}=e,c=R(l,t,a);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(c.x+c.y)/2,d=C(u,t),p=t.isGeographic?256/s*295828763.7958547:256/s*591657527.591555;let f="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const m=H(e,t,!0),g=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(p/2/d)/Math.LN2));if(!f&&m&&i&&(t.isGeographic||t.isWebMercator)){const r=z(t);if(f=j(m)>0||null!=r&&m.width>r/4,!f&&null!=r){let t=-1;if(g<3)t=2**g*u*s;else if(e.storageInfo){const{maximumPyramidLevel:r=0,pyramidScalingFactor:i=2}=e.storageInfo;t=i**r*u*s}const i=Math.ceil(r/t);f=1===i||2===i&&r/2-m.xmax<t}}let y,x=d;const w=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(f){x=p;const r=t.isGeographic?1341104507446289e-21:.29858214164761665,s=C(r,t),i=t.isGeographic?4326:3857;y=R({x:r,y:r},o,H(e,new h({wkid:i}),!0)),y.x*=x/s,y.y*=x/s}else{y={x:l.x,y:l.y};let e=0;for(;x<.5005*p&&e<g;)e++,x*=w,y.x*=w,y.y*=w;Math.max(x,p)/Math.min(x,p)<=1.001&&(x=p)}const b=[x],_=[{x:y.x,y:y.y}],v=Math.min(70.5310735,d)/1.001;for(;x>=v;)x/=w,y.x/=w,y.y/=w,b.push(x),_.push({x:y.x,y:y.y});if(n){const e=.001*l.x;let t=_.findIndex((t=>t.x>=l.x-e&&t.x<=l.x+e));t>-1?(_.length=t+1,b.length=t+1):(t=_.findIndex((t=>t.x<=l.x+e)),t>0&&(_.length=t,b.length=t))}return{projectedPixelSize:c,scales:b,srcResolutions:_,isCustomTilingScheme:!f}},t.defaultGridSpacing=32,t.defaultProjectionToleranceInPixels=4,t.getDefaultDatumTransformationForDataset=T,t.getProjectedGridPoints=V,t.getProjectionOffsetGrid=function(e){const t=e.isAdaptive&&null==e.spacing;let r=e.spacing||[32,32],s=L(e),i={cols:s.size[0]+1,rows:s.size[1]+1};const n=s.outofBoundPointCount>0&&s.outofBoundPointCount<s.offsets.length/2;let a=s.outofBoundPointCount===s.offsets.length/2||t&&n?[0,0]:m(s.offsets,i,r,4);const l=(a[0]+a[1])/2,c=e.projectedExtent.spatialReference,u=e.srcBufferExtent.spatialReference;if(t&&(n||l>4)&&(c.isGeographic||D(c),r=[4,4],s=L({...e,spacing:r}),i={cols:s.size[0]+1,rows:s.size[1]+1},a=m(s.offsets,i,r,4)),s.error=a,r[0]>1&&(s.coefficients=N(s.offsets,i,n)),e.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(u.isGeographic)s.gcsGrid={offsets:s.offsets,coefficients:s.coefficients,spacing:r};else{const t=D(c);if(null!=t&&!t.isEnvelope){const t=function(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt2||e.wkt);let r;return x.has(t)?r=x.get(t):(r=(e.wkid?o.PeFactory.coordsys(e.wkid):o.PeFactory.fromString(o.PeDefs.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),x.set(t,r)),new h({wkid:r})}(c),a=q(e.projectedExtent,t),{offsets:l}=L({...e,srcBufferExtent:a,spacing:r}),u=N(l,i,n);s.gcsGrid={offsets:l,coefficients:u,spacing:r}}}return s},t.getRasterDatasetAlignmentInfo=function(e){const t=e.storageInfo.origin.x,r=z(e.spatialReference,!0);if(null==r)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const s=r/2,{nativePixelSize:i,storageInfo:n,extent:a}=e,{maximumPyramidLevel:o,blockWidth:l,pyramidScalingFactor:c}=n;let u=i.x;const h=[],d=null!=e.transform&&"gcs-shift"===e.transform.type,p=t+(d?0:s),f=d?r-t:s-t;for(let e=0;e<=o;e++){const e=(a.xmax-t)/u/l,r=e-Math.floor(e)===0?e:Math.ceil(e),s=f/u/l,i=s-Math.floor(s)===0?s:Math.ceil(s),n=Math.floor(p/u/l),o=Math.round(p/u)%l,d=(l-Math.round(f/u)%l)%l;h.push({resolutionX:u,blockWidth:l,datasetColumnCount:r,worldColumnCountFromOrigin:i,leftMargin:o,rightPadding:d,originColumnOffset:n}),u*=c}return{originX:t,halfWorldWidth:s,pyramidsInfo:h,hasGCSSShiftTransform:d}},t.getSourceScale=function(e,t){const{pixelSize:r,extent:s}=e;return C(R(r,t,s),t)},t.getWorldWidth=z,t.getWorldWrapCount=j,t.load=async function(){return b||(b=i.createResolver(),_=await new Promise(((t,r)=>e(["../../../geometry/operators/projectOperator"],t,r))),v=await new Promise(((t,r)=>e(["../../../geometry/operators/support/geographicTransformationUtils"],t,r))),_.isLoaded()||await _.load(),v.isLoaded()||await v.load(),S=!0,b.resolve()),b.promise},t.minimumGridSpacing=4,t.projectDatasetExtent=H,t.projectDatasetResolution=R,t.projectExtent=q,t.projectPoint=k,t.projectPolygon=function(e,t,r){if("extent"===e.type){const{xmin:t,ymin:r,xmax:s,ymax:i,spatialReference:n}=e;e=new c({rings:[[[t,i],[s,i],[s,r],[t,r],[t,i]]],spatialReference:n})}return e.spatialReference.equals(t)?e:(f(),_.execute(e,t,{geographicTransformation:r}))},t.projectResolution=function(e,t,r,s){const i=e.spatialReference;if(!i||!t||i.equals(t))return e;f();const n=r.center,o=new a({xmin:n.x-e.x/2,xmax:n.x+e.x/2,ymin:n.y-e.y/2,ymax:n.y+e.y/2,spatialReference:i}),l=_.execute(o,t,{geographicTransformation:s}),c=z(t);return null==l||null!=c&&l.width>=c?M(e,i,t):{x:l.width,y:l.height}},t.shiftExtent=function(e){const{spatialReference:t}=e,r=d.getInfo(t);if(!r)return e;const[s,i]=r.valid,n=i-s;let o=0;if(e.xmin<s){const t=s-e.xmin;o=Math.ceil(t/n)}else if(e.xmin>i){const t=e.xmin-i;o=-Math.ceil(t/n)}return new a({spatialReference:e.spatialReference,xmin:e.xmin+o*n,ymin:e.ymin,xmax:e.xmax+o*n,ymax:e.ymax})},t.snapExtent=W,t.snapPyramid=function(e,t,r){const{storageInfo:s,pixelSize:i}=t;let a=0,o=!1;const{pyramidResolutions:c}=s,u="mixed"===s.tileInfo.format?.toLowerCase()?Math.max(1,Math.min(3,s.tileInfo.dpi/96)):1,h=(e.x+e.y)/2/u;if(null!=c&&c.length){const e=c[c.length-1],s=(e.x+e.y)/2,u=(i.x+i.y)/2;if(h<=u)a=0;else if(h>=s)a=c.length,o=h/s>8;else{let e,t=u;for(let s=1;s<=c.length;s++){if(e=(c[s-1].x+c[s-1].y)/2,h<=e){h===e?a=s:"down"===r?(a=s-1,o=h/t>8):a="up"===r||h-t>e-h||h/t>2?s:s-1;break}t=e}}const d=0===a?i:c[a-1];return o&&Math.min(d.x,d.y)*n.getMetersPerUnitForSR(t.spatialReference)>19567&&(o=!1),{pyramidLevel:a,pyramidResolution:new l({x:d.x,y:d.y,spatialReference:t.spatialReference}),excessiveReading:o}}const d=Math.log(e.x/i.x)/Math.LN2,p=Math.log(e.y/i.y)/Math.LN2,f=t.storageInfo.maximumPyramidLevel||0;a="down"===r?Math.floor(Math.min(d,p)):"up"===r?Math.ceil(Math.max(d,p)):Math.round((d+p)/2),a<0?a=0:a>f&&(o=a>f+3,a=f);const m=2**a;return{pyramidLevel:a,pyramidResolution:new l({x:m*t.nativePixelSize.x,y:m*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/layers/imagery/VectorFieldTileView2D":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../layers/support/rasterFunctions/vectorFieldUtils","../../engine/imagery/RasterVFTileContainer","./BaseImageryTileSubView2D"],(function(e,t,r,s,i,n,a,o,l,c,u){"use strict";return e.default=class extends u.BaseImageryTileSubView2D{constructor(){super(...arguments),this._handle=null,this.type="rasterVF"}async fetchTile(e,t){t={...t,interpolation:"nearest",requestProjectedLocalDirections:!0};const r=await this.layer.fetchTile(e.level,e.row,e.col,t);return"vector-magdir"===this.layer.serviceRasterInfo?.dataType&&r?.pixelBlock&&(r.pixelBlock=await this.layer.convertVectorFieldData(r.pixelBlock,"vector-magdir",t)),r}updateTileSource(e,t){const r=t.symbolizerParams,{tileData:s}=e;s.key=e.key,s.width=this._tileInfoView.tileInfo.size[0],s.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:i}=r,{source:n}=t;if(s.offset=this._getTileSymbolOffset(s.key,i),null!=n?.pixelBlock){const e={extent:n.extent,pixelBlock:n.pixelBlock};s.rawPixelData=e,s.symbolizerParameters=r,s.source=this._sampleVectorFieldData(n.pixelBlock,r,s.offset)}else{const e=[Math.round((this._tileInfoView.tileInfo.size[0]-s.offset[0])/i),Math.round((this._tileInfoView.tileInfo.size[1]-s.offset[1])/i)],t=this.createEmptyTilePixelBlock(e);s.source=t,s.symbolizerParameters=r}return s.invalidateVAO(),Promise.resolve()}updateTileSymbolizerParameters(e,t){const r=t.local,{symbolTileSize:s}=r,{tileData:i}=e;i.offset=this._getTileSymbolOffset(i.key,s);const n=i.symbolizerParameters.symbolTileSize;i.symbolizerParameters=r;const a=i.rawPixelData?.pixelBlock;return null!=a&&n!==s&&(i.source=this._sampleVectorFieldData(a,i.symbolizerParameters,i.offset)),Promise.resolve()}attach(){super.attach(),this.container=new c.RasterVFTileContainer(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=r.watch((()=>this.layer.renderer),(e=>this._updateSymbolType(e)))}detach(){super.detach(),this.container.removeAllChildren(),this._handle?.remove(),this._handle=null,this.container=null}_getTileSymbolOffset(e,t){const r=e.col*this._tileInfoView.tileInfo.size[0]%t,s=e.row*this._tileInfoView.tileInfo.size[1]%t;return[r>t/2?t-r:-r,s>t/2?t-s:-s]}_sampleVectorFieldData(e,t,r){const{symbolTileSize:s}=t;return l.sampleVectorField(e,"vector-uv",s,r)}_updateSymbolType(e){"vector-field"===e?.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}},t.__decorate([s.property()],e.default.prototype,"container",void 0),t.__decorate([s.property()],e.default.prototype,"layer",void 0),t.__decorate([s.property()],e.default.prototype,"type",void 0),e.default=t.__decorate([o.subclass("esri.views.2d.layers.imagery.VectorFieldTileView2D")],e.default),e.default}))},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../PixelBlock","./pixelUtils"],(function(e,t,r,s){"use strict";const i=new Map;i.set("meter-per-second",1),i.set("kilometer-per-hour",.277778),i.set("knots",.514444),i.set("feet-per-second",.3048),i.set("mile-per-hour",.44704);const n=180/Math.PI,a=new t.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function o(e,t){return i.get(e)/i.get(t)||1}function l(e){return(450-e)%360}function c(e,t="geographic"){const[r,s]=e,i=Math.sqrt(r*r+s*s);let a=Math.atan2(s,r)*n;return a=(360+a)%360,"geographic"===t&&(a=l(a)),[i,a]}function u(e,t="geographic"){let r=e[1];"geographic"===t&&(r=l(r)),r%=360;const s=e[0];return[s*Math.cos(r/n),s*Math.sin(r/n)]}function h(e,t,i="geographic",n=1){if(!s.isValidPixelBlock(e))return e;const{pixels:a,width:o,height:l}=e,h=o*l,d=a[0],p=a[1],f=e.pixelType.startsWith("f")?e.pixelType:"f32",m=r.createEmptyBand(f,h),g=r.createEmptyBand(f,h);let y=0;for(let e=0;e<l;e++)for(let e=0;e<o;e++)"vector-uv"===t?([m[y],g[y]]=c([d[y],p[y]],i),m[y]*=n):([m[y],g[y]]=u([d[y],p[y]],i),m[y]*=n,g[y]*=n),y++;const x=new r({pixelType:f,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[m,g]});return x.updateStatistics(),x}const d=p(0,0,0);function p(e=0,t=0,r=Math.PI,s=!0){s&&(r=(2*Math.PI-r)%(2*Math.PI));const i=s?-1:1,n=13*i,a=-7*i,o=-2*i,l=-16*i,c=21.75,[u,h]=m(0,t+n,r,c),[d,p]=m(e-5.5,t+a,r,c),[f,g]=m(e+5.5,t+a,r,c),[y,x]=m(e-1.5,t+o,r,c),[w,b]=m(e+1.5,t+o,r,c),[_,v]=m(e-1.5,t+l,r,c),[S,T]=m(e+1.5,t+l,r,c);return[u,h,d,p,y,x,w,b,f,g,_,v,S,T]}function f(e=0,t=Math.PI,r=!0){r&&(t=(2*Math.PI-t)%(2*Math.PI));const s=r?-1:1,i=5*s,n=20*s,a=25*s,o=45,l=2*s,c=r?1:-1,u=5*c;let[h,d]=[0+u,0-n],[p,f]=[h+2*c,d],[g,y]=[p-0*c,f+l],[x,w]=[0-u,0-a],[b,_]=[x+0*c,w-l],v=Math.ceil(e/5),S=Math.floor(v/10);v-=8*S;const T=[],M=[];for(let e=0;e<v/2;e++,S--){S<=0&&v%2==1&&e===(v-1)/2&&(x=0,b=x+0*c,w=(w+d)/2,_=w-l);const[r,s]=m(x,w,t,o);if(S>0){const[e,i]=m(p,w,t,o),[n,a]=m(h,d,t,o);T.push(e),T.push(i),T.push(r),T.push(s),T.push(n),T.push(a)}else{const[e,i]=m(p,f,t,o),[n,a]=m(g,y,t,o),[l,c]=m(b,_,t,o);M.push(r),M.push(s),M.push(l),M.push(c),M.push(n),M.push(a),M.push(e),M.push(i)}w+=i,d+=i,f+=i,y+=i,_+=i}const[R,C]=m(0+u,0+n,t,o),P=7*c,[k,F]=m(0+P,0+n,t,o),[V,I]=m(0+u,0-a,t,o),[D,A]=m(0+P,0-a,t,o);return{pennants:T,barbs:M,shaft:[R,C,k,F,V,I,D,A]}}function m(e,t,r,s=1){const i=Math.sqrt(e*e+t*t)/s,n=(2*Math.PI+Math.atan2(t,e))%(2*Math.PI);return[i,(2*Math.PI+n-r)%(2*Math.PI)]}const g=[0,1,3,6,10,16,21,27,33,40,47,55,63],y=[0,.5,1,1.5,2],x=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function w(e,t,r,s){const i=o(s||"knots",r);let n;for(n=1;n<t.length;n++)if(n===t.length-1){if(e<t[n]*i)break}else if(e<=t[n]*i)break;return Math.min(n-1,t.length-2)}function b(e,t,r,s,i){let n=0;switch(t){case"beaufort_kn":n=w(e,g,"knots",r);break;case"beaufort_km":n=w(e,g,"kilometer-per-hour",r);break;case"beaufort_ft":n=w(e,g,"feet-per-second",r);break;case"beaufort_m":n=w(e,g,"meter-per-second",r);break;case"classified_arrow":n=w(e,i??[],s,r);break;case"ocean_current_m":n=w(e,y,"meter-per-second",r);break;case"ocean_current_kn":n=w(e,x,"knots",r)}return n}const _=[];function v(e,t){let r=0,s=0;const{width:i,height:n,mask:l}=e,c=e.pixels[0],u=[],h=[],d=o(a.fromJSON(t.inputUnit),"knots"),p="wind_speed"===t.style?5:Number.MAX_VALUE;for(let e=0;e<n;e++)for(let t=0;t<i;t++){const a=c[e*i+t]*d;if((!l||l[e*i+t])&&a<p){for(let s=0;s<4;s++)u[r++]=(t+.5)/i,u[r++]=(e+.5)/n,u[r++]=s<2?-.5:.5,u[r++]=s%2==0?-.5:.5,u[r++]=0,u[r++]=a;const o=4*(r/24-1);h[s++]=o,h[s++]=o+1,h[s++]=o+2,h[s++]=o+1,h[s++]=o+2,h[s++]=o+3}}return{vertexData:new Float32Array(u),indexData:new Uint32Array(h)}}e.convertToLocalDirections=function(e,t,r,i="geographic"){if(!s.isValidPixelBlock(e)||null==r)return e;const n="vector-magdir"===t?e.clone():h(e,t),a=n.pixels[1];for(let e=0;e<a.length;e++)a[e]="geographic"===i?(a[e]+r[e]+270)%360:(a[e]+360-r[e])%360;return"vector-magdir"===t?n:h(n,"vector-magdir")},e.convertVectorFieldData=h,e.convertVectorFieldUnit=function(e,t,r=1){if(1===r||!s.isValidPixelBlock(e))return e;const i=e.clone(),{pixels:n,width:a,height:o}=i,l=n[0],c=n[1];let u=0;for(let e=0;e<o;e++)for(let e=0;e<a;e++)"vector-uv"===t?(l[u]*=r,c[u]*=r):l[u]*=r,u++;return i.updateStatistics(),i},e.createVFMesh=function(e,t){return"simple_scalar"===t.style?v(e,t):"wind_speed"===t.style?function(e,t){if(0===_.length)for(let e=0;e<30;e++)_.push(f(5*e,0,!t.invertDirection));const r=o(a.fromJSON(t.inputUnit),"knots"),{width:s,height:i,mask:n}=e,l=e.pixels[0],c=e.pixels[1],u=[],h=[];let d=0,p=0;for(let e=0;e<i;e++)for(let t=0;t<s;t++){const a=e*s+t,o=l[a]*r;if((!n||n[e*s+t])&&o>=5){const r=(c[a]+360)%360/180*Math.PI,{pennants:n,barbs:l,shaft:f}=_[Math.min(Math.floor(o/5),29)];if(n.length+l.length===0)continue;let m=u.length/6;const g=(t+.5)/s,y=(e+.5)/i;for(let e=0;e<n.length;e+=2)u[d++]=g,u[d++]=y,u[d++]=n[e],u[d++]=n[e+1]+r,u[d++]=0,u[d++]=o;for(let e=0;e<l.length;e+=2)u[d++]=g,u[d++]=y,u[d++]=l[e],u[d++]=l[e+1]+r,u[d++]=0,u[d++]=o;for(let e=0;e<f.length;e+=2)u[d++]=g,u[d++]=y,u[d++]=f[e],u[d++]=f[e+1]+r,u[d++]=0,u[d++]=o;for(let e=0;e<n.length/6;e++)h[p++]=m,h[p++]=m+1,h[p++]=m+2,m+=3;for(let e=0;e<l.length/8;e++)h[p++]=m,h[p++]=m+1,h[p++]=m+2,h[p++]=m+1,h[p++]=m+2,h[p++]=m+3,m+=4;h[p++]=m+0,h[p++]=m+1,h[p++]=m+2,h[p++]=m+1,h[p++]=m+3,h[p++]=m+2,m+=4}}return{vertexData:new Float32Array(u),indexData:new Uint32Array(h)}}(e,t):function(e,t){const{style:r,inputUnit:s,outputUnit:i,breakValues:n}=t,o=a.fromJSON(s),l=a.fromJSON(i);let c=0,u=0;const{width:h,height:f,mask:m}=e,g=e.pixels[0],y=e.pixels[1],x=null!=m?m.filter((e=>e>0)).length:h*f,w=new Float32Array(42*x),_=new Uint32Array(15*x),v=t.invertDirection?p(0,0,0,!1):d;for(let e=0;e<f;e++)for(let t=0;t<h;t++){const s=e*h+t;if(!m||m[e*h+t]){const i=(y[s]+360)%360/180*Math.PI,a=b(g[s],r,o,l,n);for(let r=0;r<v.length;r+=2)w[c++]=(t+.5)/h,w[c++]=(e+.5)/f,w[c++]=v[r],w[c++]=v[r+1]+i,w[c++]=a,w[c++]=g[s];const d=7*(c/42-1);_[u++]=d,_[u++]=d+1,_[u++]=d+2,_[u++]=d+0,_[u++]=d+4,_[u++]=d+3,_[u++]=d+0,_[u++]=d+2,_[u++]=d+3,_[u++]=d+2,_[u++]=d+5,_[u++]=d+3,_[u++]=d+5,_[u++]=d+6,_[u++]=d+3}}return{vertexData:w,indexData:_}}(e,t)},e.createVFMeshScalar=v,e.getUnitConversionFactor=o,e.sampleVectorField=function(e,t,s,i=[0,0],n=.5){const{width:a,height:o,mask:l}=e,[h,d]=e.pixels,[p,f]=i,m=Math.round((a-p)/s),g=Math.round((o-f)/s),y=m*g,x=new Float32Array(y),w=new Float32Array(y),b=new Uint8Array(y),_="vector-uv"===t;for(let e=0;e<g;e++)for(let t=0;t<m;t++){let r=0;const i=e*m+t,g=Math.max(0,e*s+f),y=Math.max(0,t*s+p),v=Math.min(o,g+s),S=Math.min(a,y+s);for(let e=g;e<v;e++)for(let t=y;t<S;t++){const s=e*a+t;if(!l||l[s]){r++;const e=_?[h[s],d[s]]:[h[s],(360+d[s])%360],[t,n]=_?e:u(e);x[i]+=t,w[i]+=n}}if(r>=(v-g)*(S-y)*(1-n)){b[i]=1;const[e,t]=c([x[i]/r,w[i]/r]);x[i]=e,w[i]=t}else b[i]=0,x[i]=0,w[i]=0}const v=new r({width:m,height:g,pixels:[x,w],mask:b});return v.updateStatistics(),v},e.snapImageToSymbolTile=function(e,t,r,s,i){if(null==i||!i.spatialReference.equals(e.spatialReference))return{extent:e,width:Math.round(t/s),height:Math.round(r/s),resolution:e.width/t};const n=i.xmin,a=i.ymax,o=(e.xmax-e.xmin)/t*s,l=(e.ymax-e.ymin)/r*s,c=(o+l)/2;return e.xmin=n+Math.floor((e.xmin-n)/o)*o,e.xmax=n+Math.ceil((e.xmax-n)/o)*o,e.ymin=a+Math.floor((e.ymin-a)/l)*l,e.ymax=a+Math.ceil((e.ymax-a)/l)*l,{extent:e,width:Math.round(e.width/o),height:Math.round(e.height/l),resolution:c}},e.unitKebabDict=a,e.uvComponentToVector=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/imagery/RasterVFTileContainer":function(){define(["exports","../../../../geometry/support/aaBoundingRect","./BrushVectorField","./RasterVFTile","../webgl/enums","../webgl/TileContainer"],(function(e,t,r,s,i,n){"use strict";e.RasterVFTileContainer=class extends n{constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}createTile(e){const r=this.tileInfoView.getTileBounds(t.create(),e),[i,n]=this.tileInfoView.tileInfo.size,a=this.tileInfoView.getTileResolution(e.level);return new s.RasterVFTile(e,a,r[0],r[3],i,n)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (vf tile)",brushes:[r],target:()=>this.children.map((e=>e.tileData)),drawPhase:i.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===i.WGLDrawPhase.MAP&&this.symbolTypes.forEach((t=>{e.renderPass=t,super.doRender(e)}))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../webgl/brushes/WGLBrush","../../../webgl/enums"],(function(e,t){"use strict";const r=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),s=new Float32Array([0,92/255,230/255,1]),i={beaufort_ft:r,beaufort_m:r,beaufort_km:r,beaufort_mi:r,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),simple_scalar:s,single_arrow:s,wind_speed:new Float32Array([0,0,0,1])},n=[0,20];return class extends e{constructor(){super(...arguments),this._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}}}dispose(){}prepareState({context:e}){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(t.BlendFactor.ONE,t.BlendFactor.ONE_MINUS_SRC_ALPHA,t.BlendFactor.ONE,t.BlendFactor.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0),e.setStencilOp(t.StencilOperation.KEEP,t.StencilOperation.KEEP,t.StencilOperation.REPLACE)}draw(e,r){if(null==r.source||0===r.source.validPixelCount)return;const{context:s,timeline:i}=e;if(i.begin(this.name),s.setStencilFunction(t.CompareFunction.EQUAL,r.stencilRef,255),r.updateVectorFieldVAO(e),"scalar"===e.renderPass){const t=r.vaoData.scalar;t&&this._drawScalars(e,r,t.vao,t.elementCount)}else{const t=r.vaoData.magdir;t&&this._drawTriangles(e,r,t.vao,t.elementCount)}i.end(this.name)}_drawTriangles(e,r,s,a){const{context:o,painter:l,requestRender:c,allowDelayedRender:u}=e,{symbolizerParameters:h}=r,d=h.dataRange?["dataRange"]:[];"geographic"===h.rotationType&&d.push("rotationGeographic");const p=l.materialManager.getProgram(this._desc.magdir,d);if(u&&null!=c&&!p.compiled)return void c();o.useProgram(p);const{coordScale:f,opacity:m,transforms:g}=r;p.setUniform2fv("u_coordScale",f),p.setUniform1f("u_opacity",m),p.setUniformMatrix3fv("u_dvsMat3",g.displayViewScreenMat3);const{style:y,dataRange:x,rotation:w,symbolPercentRange:b}=h;p.setUniform4fv("u_colors",i[y]),p.setUniform2fv("u_dataRange",x||n),p.setUniform1f("u_rotation",w),p.setUniform2fv("u_symbolPercentRange",b);const _=this._getSymbolSize(e,r);p.setUniform2fv("u_symbolSize",_),o.bindVAO(s),o.drawElements(t.PrimitiveType.TRIANGLES,a,t.DataType.UNSIGNED_INT,0)}_drawScalars(e,r,s,i){const{context:a,painter:o,requestRender:l,allowDelayedRender:c}=e,{symbolizerParameters:u}=r,h=[];"wind_speed"===u.style?h.push("innerCircle"):u.dataRange&&h.push("dataRange"),"geographic"===u.rotationType&&h.push("rotationGeographic");const d=o.materialManager.getProgram(this._desc.scalar,h);if(c&&null!=l&&!d.compiled)return void l();a.useProgram(d);const{coordScale:p,opacity:f,transforms:m}=r;d.setUniform2fv("u_coordScale",p),d.setUniform1f("u_opacity",f),d.setUniformMatrix3fv("u_dvsMat3",m.displayViewScreenMat3);const{dataRange:g,symbolPercentRange:y}=u;d.setUniform2fv("u_dataRange",g||n),d.setUniform2fv("u_symbolPercentRange",y);const x=this._getSymbolSize(e,r);d.setUniform2fv("u_symbolSize",x),a.bindVAO(s),a.drawElements(t.PrimitiveType.TRIANGLES,i,t.DataType.UNSIGNED_INT,0)}_getSymbolSize(e,t){const r=t.key?2**(e.displayLevel-t.key.level):t.resolution/e.state.resolution,{symbolTileSize:s}=t.symbolizerParameters;return[s/(Math.round((t.width-t.offset[0])/s)*s)/r,s/(Math.round((t.height-t.offset[1])/s)*s)/r]}}}))},"esri/views/2d/engine/imagery/RasterVFTile":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","./RasterVFDisplayObject","../webgl/TiledDisplayObject"],(function(e,t,r,s,i){"use strict";class n extends i.TiledDisplayObject{constructor(e,t,r,i,n,a,o=null){super(e,t,r,i,n,a),this.tileData=new s.RasterVFDisplayObject(o),this.tileData.coordScale=[n,a],this.tileData.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(e){this.tileData.stencilRef=e}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{displayViewScreenMat3:r.create(),tileMat3:r.create()}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),s=this.transforms.tileMat3,[i,n]=this.tileData.offset,a=[this.x+i*this.resolution,this.y-n*this.resolution],[o,l]=e.toScreenNoRotation([0,0],a),{symbolTileSize:c}=this.tileData.symbolizerParameters,u=Math.round((this.width-this.tileData.offset[0])/c)*c,h=Math.round((this.height-this.tileData.offset[1])/c)*c,d=u/this.rangeX*r,p=h/this.rangeY*r;t.set(s,d,0,0,0,p,0,o,l,1),t.multiply(this.transforms.displayViewScreenMat3,e.displayViewMat3,s),this.tileData.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}e.RasterVFTile=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define(["exports","../../../../core/has","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../core/libs/gl-matrix-2/factories/vec2f32","../../../../layers/support/rasterFunctions/vectorFieldUtils","../DisplayObject","../webgl/Utils","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject"],(function(e,t,r,s,i,n,a,o,l,c,u){"use strict";class h extends a.DisplayObject{constructor(e=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.key=null,this.offset=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.vaoData=null,this.width=null,this.source=e}destroy(){null!=this.vaoData&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}get source(){return this._source}set source(e){this._source=e,this.invalidateVAO()}invalidateVAO(){this._vaoInvalidated||null==this.vaoData||(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,null!=this.source&&null==this.vaoData){const{style:t}=this.symbolizerParameters;switch(t){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const t=n.createVFMesh(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:r}}break;case"simple_scalar":{const t=n.createVFMeshScalar(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,t);this.vaoData={scalar:r}}break;case"wind_speed":{const t=n.createVFMesh(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,t),s=n.createVFMeshScalar(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,s);this.vaoData={magdir:r,scalar:i}}}}this.ready(),this.requestRender()}}_createTransforms(){return{displayViewScreenMat3:s.create()}}setTransform(e){const t=r.identity(this.transforms.displayViewScreenMat3),[s,n]=e.toScreenNoRotation([0,0],[this.x,this.y]),a=this.resolution/this.pixelRatio/e.resolution,o=a*this.width,l=a*this.height,c=Math.PI*this.rotation/180;r.translate(t,t,i.fromValues(s,n)),r.translate(t,t,i.fromValues(o/2,l/2)),r.rotate(t,t,-c),r.translate(t,t,i.fromValues(-o/2,-l/2)),r.scaleByVec2(t,t,i.fromValues(o,l)),r.multiply(this.transforms.displayViewScreenMat3,e.displayViewMat3,t)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(e,t){const{vertexData:r,indexData:s}=t,i=l.BufferObject.createVertex(e,c.Usage.STATIC_DRAW,new Float32Array(r)),n=l.BufferObject.createIndex(e,c.Usage.STATIC_DRAW,new Uint32Array(s)),a=o.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:c.DataType.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:c.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:c.DataType.FLOAT,normalized:!1}]});return{vao:new u.VertexArrayObject(e,a.attributes,a.bufferLayouts,new Map([["geometry",i]]),n),elementCount:s.length}}}e.RasterVFDisplayObject=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/ImageryTileLayerView":function(){define(["../../chunks/tslib.es6","../../Graphic","../../core/Error","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../layers/support/rasterFieldUtils","../../layers/support/timeSupport","../../layers/support/rasterDatasets/datasetUtils","../../layers/support/rasterFunctions/rasterProjectionHelper","./support/popupUtils"],(function(e,t,r,s,i,n,a,o,l,c,u,h,d){"use strict";return i=>{let n=class extends i{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return c.combineTimeExtent(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?h.getDefaultDatumTransformationForDataset(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(e){try{return!this.layer.loaded||!!h.projectDatasetExtent(this.layer.serviceRasterInfo,e)}catch{return!1}}async fetchPopupFeaturesAtLocation(e,s){const{layer:i}=this;if(!e)throw new r("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:n}=i,a=d.getFetchPopupTemplate(i,s);if(!n||null==a)return[];const o=[],{value:c,magdirValue:h,processedValue:p}=await i.identify(e,{timeExtent:this.timeExtent,signal:s?.signal});let f="";if(c?.length){f="imagery-tile"===i.type&&i.hasStandardTime()&&null!=c[0]?c.map((e=>i.getStandardTimeValue(e))).join(", "):c.join(", ");const e={ObjectId:0};e[l.commonRasterFieldNames.servicePixelValue]="imagery-tile"===i.type&&u.isFunctionRaster(i.raster)?p?.join(", "):f,e[l.commonRasterFieldNames.rawServicePixelValue]=f;const r=i.raster?.rasterInfo??i.serviceRasterInfo,s=r?.attributeTable;if(null!=s){const{fields:t,features:r}=s,i=t.find((({name:e})=>"value"===e.toLowerCase())),n=e[l.commonRasterFieldNames.servicePixelValue],a=i?r.find((e=>String(e.attributes[i.name])===n)):null;if(a)for(const t in a.attributes)a.attributes.hasOwnProperty(t)&&(e[l.rasterFieldPrefix+t]=a.attributes[t])}const n=r?.dataType;"vector-magdir"!==n&&"vector-uv"!==n||(e[l.commonRasterFieldNames.magnitude]=h?.[0],e[l.commonRasterFieldNames.direction]=h?.[1]);const{multidimensionalDefinition:a}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});l.addMultidimensionalFieldValues(i.rasterFields,e,a);const d=new t({geometry:this.fullExtent?.clone(),attributes:e,layer:i,sourceLayer:i});o.push(d)}return o}async getSourceScale(){return await this.layer.load(),h.getSourceScale(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return h.projectDatasetExtent(this.layer.serviceRasterInfo,this.view.spatialReference)}};return e.__decorate([s.property()],n.prototype,"fullExtent",null),e.__decorate([s.property()],n.prototype,"layer",void 0),e.__decorate([s.property({readOnly:!0})],n.prototype,"timeExtent",null),e.__decorate([s.property()],n.prototype,"tileInfo",void 0),e.__decorate([s.property({readOnly:!0})],n.prototype,"hasTilingEffects",null),e.__decorate([s.property()],n.prototype,"datumTransformation",null),n=e.__decorate([o.subclass("esri.views.layers.ImageryTileLayerView")],n),n}}))},"esri/layers/support/rasterFieldUtils":function(){define(["exports","./Field"],(function(e,t){"use strict";const r="Raster.",s="Raster.Dim.",i=".Max",n={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},a=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function o(e,r){return new t({name:e,alias:r,domain:null,editable:!1,length:50,type:"string"})}function l(e,r){return new t({name:e,alias:r,domain:null,editable:!1,type:"double"})}function c(e){const t=e.endsWith(i),r=t?e.slice(0,-4):e,s="StdTime"===r?"Standard Time":"StdZ"===r?"Standard Z":r;return t?`${s} Max`:s}function u(e,t){return t?new Date(e):e}e.addMultidimensionalFieldValues=function(e,t,r){r?.length&&(t[n.variable]=r[0].variableName,r.forEach((({dimensionName:r,values:n})=>{if(r&&n?.length){const a=`${s}${r}`,o=e.find((({name:e})=>e===a));if(!o)return;const l="date"===o.type,c=n[0];if(Array.isArray(c)){if(t[`${s}${r}`]=u(c[0],l),null!=c[1]){const n=`${s}${r}${i}`;if(e.some((({name:e})=>e===n))){const e=u(c[1],l);t[n]=e}}}else t[`${s}${r}`]=u(c,l)}})))},e.commonRasterFieldNames=n,e.getDirectionField=function(){return l(`${n.direction}`,"Direction ()")},e.getItemPixelValueField=function(){return o(n.itemPixelValue,"Item Pixel Value")},e.getMagnitudeField=function(e){return l(`${n.magnitude}`,"Magnitude"+(e?` (${e})`:""))},e.getMultidimensionalFields=function(e){const r=new Set,u=new Set,h=new Map;return e.variables.forEach((({dimensions:e})=>{e.forEach((e=>{if(e.recurring)h.set(e.name,e.unit);else{const t="ISO8601"===e.unit?.trim()?r:u;t.add(e.name),e.hasRanges&&t.add(`${e.name}${i}`)}}))})),[o(n.variable,"Variable"),...[...r].map((e=>function(e,r){return new t({name:e,alias:r,domain:null,editable:!1,type:"date"})}(`${s}${e}`,c(e)))),...[...u].map((e=>l(`${s}${e}`,c(e)))),...[...h].map((([e,t])=>l(`${s}${e}`,function(e,t){return t=t?.toLowerCase(),t&&a.has(t)?a.get(t):c(e)}(e,t))))]},e.getProcessedServicePixelValueField=function(e){return o(`${n.servicePixelValue}.${e}`,e)},e.getRasterAttributeTableFields=function(e){return e.fields.filter((e=>"oid"!==e.type&&"value"!==e.name.toLowerCase())).map((e=>{const t=e.clone();return t.name=`${r}${e.name}`,t}))},e.getRawServicePixelValueField=function(e){return o(n.rawServicePixelValue,e??"Raw Service Pixel Value")},e.getServicePixelValueField=function(e){return o(n.servicePixelValue,e??"Service Pixel Value")},e.rasterDimensionFieldPrefix=s,e.rasterFieldPrefix=r,e.setDefaultRasterFieldFormats=function(e,t){if(t.pixelType.startsWith("f")&&e.forEach((({format:e,fieldName:t})=>{e&&t&&/^raster\.(item|service)pixelvalue/i.test(t)&&(e.places=2)})),t.multidimensionalInfo){const r=t.multidimensionalInfo.variables.flatMap((({dimensions:e})=>e));e.forEach((({format:e,fieldName:t})=>{if(e&&t?.startsWith(s)){const s=t.slice(11),n=`${s}${i}`,a=r.find((({name:e})=>e===s||e===n));a?.values?.every((e=>Number.isInteger(e)))&&(e.places=0)}}))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/timeSupport":function(){define(["exports","../../support/timeUtils"],(function(e,t){"use strict";e.combineTimeExtent=function(e,r,s){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:i=!1,timeOffset:n,useViewTime:a}=e;let o=e.timeExtent;i&&(o=t.toLocalTimeExtent(o));let l=a?r&&o?r.intersection(o):r||o:o;return!l||l.isEmpty||l.isAllTime?l:(n&&(l=l.offset(-n.value,n.unit)),i&&(l=t.toUTCTimeExtent(l)),l.equals(s)?s:l)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/timeUtils":function(){define(["exports","../core/arrayUtils","../core/lang","../core/timeUtils","../chunks/TimeExtent","../webmap/utils","../webscene/utils"],(function(e,t,r,s,i,n,a){"use strict";function o(e){return void 0!==e.timeInfo}async function l(e,r){if(0===e.length)return i.TimeExtent.allTime;await Promise.all(e.map((e=>e.load({signal:r}))));const s=e.filter(o),n=e.filter((e=>!o(e)&&null!=e.visibilityTimeExtent));if(0===s.length&&0===n.length)return i.TimeExtent.allTime;const a=[],l=[];for(const e of s)"feature"!==e?.type&&"map-image"!==e?.type||!e.timeInfo?.hasLiveData?l.push(e):a.push(e);const c=e=>null==e||e.isAllTime,u=[...l.map((e=>{const t=e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:r}=e;return t?.intersection(r)??r})),...n.map((e=>e.visibilityTimeExtent))];if(u.some(c))return i.TimeExtent.allTime;const h=a.map((async e=>{const t=(await e.fetchRecomputedExtents({signal:r}))?.timeExtent??e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:s}=e;return t?.intersection(s)??s})),d=(await Promise.allSettled(h)).map((e=>"fulfilled"===e.status?e.value:null));if(d.some(c))return i.TimeExtent.allTime;const p=[...d,...u].filter(t.isSome);return 0===p.length?i.TimeExtent.allTime:p.reduce(((e,t)=>e.union(t)))}e.getTimeExtentFromLayers=l,e.getTimeSliderSettingsFromWebDocument=async function(e,t){if(!n.isWebMap(e)&&!a.isWebScene(e))return null;await e.load({signal:t});const s=e?.widgets?.timeSlider;if(!s)return null;const o=await async function(e,t){return e.widgets?.timeSlider?.fullTimeExtent??l(e.allLayers,t)}(e,t),c=s.loop,u=function(e){const t=e.numThumbs??2,r=e.currentTimeExtent;if(r){const{start:e,end:s}=r;return null!=e&&null!=s&&e.getTime()===s.getTime()?"instant":2===t?"time-window":null==e||0===e.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===t?"time-window":"cumulative-from-start"}(s),h=s.stopDelay??2e3,d=function(e){const{numStops:t,stopInterval:s,stops:i}=e;return i?{dates:r.clone(i)}:s?{interval:s.clone()}:{count:t??5}}(s),p=function(e,t){const r=e.currentTimeExtent;if(!r)return null;const{start:s,end:n}=r,a=s??n??null;switch(t){case"time-window":return new i.TimeExtent({start:s,end:n});case"cumulative-from-start":return new i.TimeExtent({start:null,end:a});case"cumulative-from-end":return new i.TimeExtent({start:a,end:null});case"instant":return new i.TimeExtent({start:a,end:a})}}(s,u);return{fullTimeExtent:o,loop:c,mode:u,playRate:h,stops:d,timeExtent:p}},e.toLocalTimeExtent=function(e){if(!e)return e;const{start:t,end:r}=e;return new i.TimeExtent({start:null!=t?s.offsetDate(t,t.getTimezoneOffset(),"minutes"):t,end:null!=r?s.offsetDate(r,r.getTimezoneOffset(),"minutes"):r})},e.toUTCTimeExtent=function(e){if(!e)return e;const{start:t,end:r}=e;return new i.TimeExtent({start:null!=t?s.offsetDate(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=r?s.offsetDate(r,-r.getTimezoneOffset(),"minutes"):r})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/utils":function(){define(["exports","../support/tagSymbols"],(function(e,t){"use strict";e.isWebScene=function(e){return null!=e&&"object"==typeof e&&t.WebSceneTag in e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/tagSymbols":function(){define(["exports"],(function(e){"use strict";const t=Symbol("WebScene");e.WebSceneTag=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],(function(e,t){"use strict";function r(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}e.getFetchPopupTemplate=r,e.getRequiredFields=async function(e,r=e.popupTemplate){if(null==r)return[];const s=await r.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:i}=r,{objectIdField:n,typeIdField:a,globalIdField:o,relationships:l}=e;if(s.includes("*"))return["*"];const c=i?t.getFeatureEditFields(e):[],u=t.fixFields(e.fieldsIndex,[...s,...c]);return a&&u.push(a),u&&n&&e.fieldsIndex?.has(n)&&!u.includes(n)&&u.push(n),u&&o&&e.fieldsIndex?.has(o)&&!u.includes(o)&&u.push(o),l&&l.forEach((t=>{const{keyField:r}=t;u&&r&&e.fieldsIndex?.has(r)&&!u.includes(r)&&u.push(r)})),u},e.hasPopupTemplate=function(e,t){return null!=r(e,{defaultPopupTemplateEnabled:t})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/layers/RefreshableLayerView":function(){define(["../../chunks/tslib.es6","../../core/Logger","../../core/promiseUtils","../../core/reactiveUtils","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,s,i,n,a,o){"use strict";return i=>{let n=class extends i{initialize(){this.addHandles(s.on((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{r.isAbortError(e)||t.getLogger(this).error(e)}))})),"RefreshableLayerView")}};return n=e.__decorate([o.subclass("esri.views.layers.RefreshableLayerView")],n),n}}))},"*noref":1}}),define(["../../../chunks/tslib.es6","../../../core/Logger","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../layers/support/rasterDatasets/multidimensionalUtils","../engine/flow/FlowView2D","./LayerView2D","./imagery/ImageryTileView2D","./imagery/VectorFieldTileView2D","./support/util","../../layers/ImageryTileLayerView","../../layers/LayerView","../../layers/RefreshableLayerView"],(function(e,t,r,s,i,n,a,o,l,c,u,h,d,p,f,m,g){"use strict";let y=class extends(f(g(u.LayerView2DMixin(m)))){constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this.subview=null}get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}get displayParameters(){const{layer:e}=this,t=this._get("displayParameters");return e.renderer&&e.visible?{bandIds:e.bandIds,renderer:e.renderer,interpolation:e.interpolation,multidimensionalDefinition:e.multidimensionalDefinition,rasterFunction:"imagery-tile"===e.type?e.rasterFunction:null}:t}update(e){this.subview?.update(e),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.addAttachHandles([s.watch((()=>this.displayParameters),((e,s)=>{const i=e.interpolation!==s?.interpolation&&("majority"===e.interpolation||"majority"===s?.interpolation)&&p.canUseMajorityInterpolationOnDataSource(this.layer),n=!!this.layer.serviceRasterInfo?.storageInfo?.isBsqTile&&e.bandIds?.join()!==s?.bandIds?.join(),a=e.renderer!==s?.renderer&&this._getSubviewType(s?.renderer)!==this._getSubviewType(e.renderer);a&&this._updateSubview();const o=e.multidimensionalDefinition!==s?.multidimensionalDefinition,l=e.rasterFunction!==s?.rasterFunction,c=l&&!this._useWebGLForProcessing,u=o||i||a||c||n;this.subview.redrawOrRefetch({refetch:u,reprocess:l}).catch((e=>{r.isAbortError(e)||t.getLogger(this).error(e)})),this.notifyChange("updating")})),s.watch((()=>this.layer.multidimensionalSubset??null),((e,s)=>{const{multidimensionalDefinition:i}=this.layer;null!=i&&l.hasExcludedVariableOrDimension(i,e)!==l.hasExcludedVariableOrDimension(i,s)&&(this.subview.redrawOrRefetch({refetch:!0}).catch((e=>{r.isAbortError(e)||t.getLogger(this).error(e)})),this.notifyChange("updating"))}),s.sync),s.watch((()=>this.timeExtent),(()=>{this.subview.timeExtent=this.timeExtent,this.subview.redrawOrRefetch({refetch:!0}).catch((e=>{r.isAbortError(e)||t.getLogger(this).error(e)}))}),s.initial)])}detach(){this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),this.subview?.destroy(),this.subview=null}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}doRefresh(){return this.subview?this.subview.doRefresh():Promise.resolve()}_updateSubview(){const{renderer:e}=this.layer;if(!e)return;const t=this._getSubviewType(e);if(this.subview){if(this.subview.type===t)return void this._attachSubview(this.subview);this._detachSubview(this.subview),this.subview?.destroy(),this.subview=null}const{layer:r}=this;let s;if(s="rasterVF"===t?new d({layer:r,layerView:this,scheduler:this.scheduler}):"flow"===t?new c({layer:r,layerView:this,scheduler:this.scheduler}):new h({layer:r,layerView:this,scheduler:this.scheduler}),"useWebGLForProcessing"in s&&(s.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in s&&(s.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in s){const{subview:e}=this;s.previousLOD=e&&"previousLOD"in e?e.previousLOD:null}this._attachSubview(s),this.subview=s,this.requestUpdate()}_attachSubview(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0))}_detachSubview(e){e?.attached&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}_getSubviewType(e){const t=e?.type;return"vector-field"===t?"rasterVF":"flow"===t?"flow":"raster"}};return e.__decorate([i.property()],y.prototype,"subview",void 0),e.__decorate([i.property()],y.prototype,"useWebGLForProcessing",null),e.__decorate([i.property()],y.prototype,"useProgressiveUpdate",null),e.__decorate([i.property({readOnly:!0})],y.prototype,"displayParameters",null),y=e.__decorate([o.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],y),y}));