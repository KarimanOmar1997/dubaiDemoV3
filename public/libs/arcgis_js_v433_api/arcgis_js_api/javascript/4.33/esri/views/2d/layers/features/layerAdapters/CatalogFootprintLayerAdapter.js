// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/lang","../../../../../layers/support/arcgisLayerUrl","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,a,o,i,s,l){"use strict";e.CatalogFootprintLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=o.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:o.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const o=this.layer,{capabilities:i,editingInfo:s,objectIdField:l,globalIdField:n,datesInUnknownTimezone:c,dateFieldsTimeZone:p,orderBy:d,parsedUrl:u}=o,y=o.fieldsIndex.toJSON(),m=a.getServiceGeometryType(o),f=o.timeInfo?.toJSON(),h=o.spatialReference.toJSON(),g=t.clone(u);let S=l;if(d?.length){const e=!d[0].valueExpression&&d[0].field;e&&(S=e)}const b=r.isHostedAgolService(g.path),I=e.spatialReference.toJSON();return{type:"feature-service",source:g,isSourceHosted:b,orderByFields:S,outSpatialReference:I,metadata:{timeReferenceUnknownClient:c,dateFieldsTimeZone:p,globalIdField:n,fieldsIndex:y,geometryType:m,featureIdInfo:{type:"object-id",fieldName:l},timeInfo:f,spatialReference:h,outSpatialReference:I,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:s?.lastEditDate?.getTime(),snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:r,displayFilterInfo:a,customParameters:o,timeExtent:s,apiKey:l}=this.layer,n={definitionExpression:r,displayFilterInfo:a,customParameters:o,timeExtent:s};return i.createFeatureSourceSchema(n,e,t,l)}createProcessorSchema(e,t,r){const{fields:a,geometryType:o,orderBy:i,objectIdField:l,renderer:n,labelingInfo:c,labelsVisible:p}=this.layer,d={featureReduction:null,labelingInfoSource:this.layer.id,fields:a.map((e=>e.toJSON())),geometryType:o,labelingInfo:c,labelsVisible:p,objectIdField:l,orderBy:i??"default",renderer:n?.clone()};return s.createSimpleProcessorSchema(e,t,d,r)}get hasRequiredSupport(){return l.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>this.layer.definitionExpression,()=>this.layer.outFields,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy]}setGraphicOrigin(e){e.origin={type:"catalog",layer:this.layer}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));