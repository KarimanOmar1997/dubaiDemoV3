// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/lang","../../../../../layers/support/arcgisLayerUrl","./featureReductionUtils","./featureServiceUtils","./floorFilterUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,o,a,i,l,s,n,c,u){"use strict";e.OrientedImageryLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=s.getFeatureReductionDeconflictionEnabled(t,e)??s.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:s.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const o=this.layer,{capabilities:i,globalIdField:s,orderBy:n,refreshInterval:c}=o,u=o.fieldsIndex.toJSON(),d=l.getServiceGeometryType(o),p=o.timeInfo?.toJSON(),y=o.spatialReference.toJSON(),f=t.clone(this.layer.parsedUrl);let m=this.layer.objectIdField;if(n?.length){const e=!n[0].valueExpression&&n[0].field;e&&(m=e)}const h=c>0,S=r.isHostedAgolService(f.path),F=e.spatialReference.toJSON(),b=a.createSnapshotInfo(S,h,i,d,e.extent,o.fullExtent);return{type:"feature-service",source:f,isSourceHosted:S,orderByFields:m,outSpatialReference:F,metadata:{globalIdField:s,fieldsIndex:u,geometryType:d,featureIdInfo:{type:"object-id",fieldName:o.objectIdField},timeInfo:p,spatialReference:y,outSpatialReference:F,timeReferenceUnknownClient:o.datesInUnknownTimezone,dateFieldsTimeZone:o.dateFieldsTimeZone,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:null,snapshotInfo:b}}}createSourceSchema(e,t){const{definitionExpression:r,displayFilterInfo:o,customParameters:a,timeExtent:i}=this.layer,l={definitionExpression:r,displayFilterInfo:o,customParameters:a,timeExtent:i};return n.createFeatureSourceSchema(l,e,t,null)}createProcessorSchema(e,t,r){const{fields:a,renderer:i,geometryType:l,labelingInfo:s,labelsVisible:n,orderBy:u,objectIdField:d}=this.layer,p={fields:a.map((e=>e.toJSON())),renderer:i?.clone(),labelingInfoSource:this.layer.id,featureReduction:o.getEffectiveFeatureReduction(this.layer,t),geometryType:l,labelingInfo:s,labelsVisible:n,objectIdField:d,orderBy:u??"default"};return c.createSimpleProcessorSchema(e,t,p,r)}get hasRequiredSupport(){return u.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}addFilters(e,t){return i.addFloorFilter(this.layer,e,t)}getUpdateHashProperties(e){return[()=>this.layer.outFields,()=>this.layer.orderBy,()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>o.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.customParameters,()=>i.hasFloorFilter(this.layer,e)?e.floors:null]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));