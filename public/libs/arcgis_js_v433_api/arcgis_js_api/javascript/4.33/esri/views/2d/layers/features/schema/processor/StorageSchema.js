// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../core/arrayUtils","../../../../../../layers/support/streamLayerUtils","../../../../engine/webgl/enums","../../support/rendererUtils","../../../../../webgl/capabilities"],(function(e,i,n,r,t,a){"use strict";function s(e){switch(e){case"opacity":return r.VVBinding.OPACITY;case"color":return r.VVBinding.COLOR;case"rotation":return r.VVBinding.ROTATION;case"size":return r.VVBinding.SIZE;default:return null}}function l(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return d(e);case"dot-density":return o(e);case"pie-chart":return u(e);case"heatmap":return c(e)}}function o(e){const i=[];for(const n of e.attributes)i.push({binding:i.length,expression:n.valueExpression,field:n.field});return i}function u(e){const i=d(e);let n=4;for(const r of e.attributes)i.push({binding:n++,expression:r.valueExpression,field:r.field});return i}function c({valueExpression:e,field:i}){return e||i?[{binding:0,expression:e,field:i}]:[]}function d(e){return"visualVariables"in e&&e.visualVariables?.length?t.simplifyVisualVariables(e.visualVariables).map((e=>function(e){switch(e.type){case"size":return function(e){return"$view.scale"===e.valueExpression?null:{binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}(e);case"color":case"opacity":return function(e){return{binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}(e);case"rotation":return function(e){return{binding:s(e.type),expression:e.valueExpression,field:e.field}}(e)}}(e))).filter(i.isSome):[]}e.createDotDensityBindings=o,e.createHeatmapBindings=c,e.createPieChartBindings=u,e.createStorageSchema=function(e,i){return{type:"simple",filters:i,capabilities:{maxTextureSize:a.getWebGLCapabilities().maxTextureSize},bindings:l(e)}},e.createTrackStorageSchema=function(e,i){const r=a.getWebGLCapabilities();return{type:"multi",target:"feature",keyField:n.internalTrackPartField,filters:i,capabilities:{maxTextureSize:r.maxTextureSize},bindings:{[n.TrackPart.TrackLine]:l(e.trackLines.renderer),[n.TrackPart.LatestObservation]:l(e.latestObservations.renderer),[n.TrackPart.PreviousObservation]:l(e.previousObservations.renderer)}}},e.createVVBindings=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));