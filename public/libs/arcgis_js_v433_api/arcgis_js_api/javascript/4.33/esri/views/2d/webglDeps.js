// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/webgl/BufferObject":function(){define(["exports","../../core/arrayUtils","../../core/has","../../core/Logger","../../core/typedArrayUtil","./checkWebGLError","./enums"],(function(e,t,r,i,o,a,n){"use strict";const s=()=>i.getLogger("esri.views.webgl.BufferObject");class c{static createIndex(e,t,r){return new c(e,n.BufferType.ELEMENT_ARRAY_BUFFER,t,r)}static createVertex(e,t,r){return new c(e,n.BufferType.ARRAY_BUFFER,t,r)}static createUniform(e,t,r){return new c(e,n.BufferType.UNIFORM_BUFFER,t,r)}static createPixelPack(e,t=n.Usage.STREAM_READ,r){const i=new c(e,n.BufferType.PIXEL_PACK_BUFFER,t);return r&&i.setSize(r),i}static createPixelUnpack(e,t=n.Usage.STREAM_DRAW,r){return new c(e,n.BufferType.PIXEL_UNPACK_BUFFER,t,r)}static createTransformFeedback(e,t=n.Usage.STATIC_DRAW,r){const i=new c(e,n.BufferType.TRANSFORM_FEEDBACK_BUFFER,t);return i.setSize(r),i}constructor(e,t,r,i){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(n.ResourceType.BufferObject,this),this._glName=this._context.gl.createBuffer(),a.checkWebGLError(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){if(this.bufferType===n.BufferType.ELEMENT_ARRAY_BUFFER){if(this._indexType===n.DataType.UNSIGNED_INT)return 4*this._size;if(this._indexType===n.DataType.UNSIGNED_SHORT)return 2*this._size}return this._size}get _isVAOAware(){return this.bufferType===n.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===n.BufferType.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(n.ResourceType.BufferObject,this),this._context=null):this._glName&&s().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(this.bufferType===n.BufferType.ELEMENT_ARRAY_BUFFER&&null!=t)switch(this._indexType=t,t){case n.DataType.UNSIGNED_SHORT:e*=2;break;case n.DataType.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===n.BufferType.ELEMENT_ARRAY_BUFFER&&(o.isUint8Array(e)?this._indexType=n.DataType.UNSIGNED_BYTE:o.isUint16Array(e)?(t/=2,this._indexType=n.DataType.UNSIGNED_SHORT):o.isUint32Array(e)&&(t/=4,this._indexType=n.DataType.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=t?i.bufferData(this.bufferType,t,this.usage):i.bufferData(this.bufferType,e,this.usage),a.checkWebGLError(i),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,t,r,i){if(!e)return;const o=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:n}=this._context;n.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,r,i-r),a.checkWebGLError(n),this._isVAOAware&&this._context.bindVAO(o)}getSubData(e,r=0,i,o){if(i<0||o<0)return;const a=(c=e,t.isArrayLike(c)?e.BYTES_PER_ELEMENT:1);var c;if(a*((i??0)+(o??0))>e.byteLength)return;r+a*(o??0)>this.usedMemory&&s().warn("Potential problem getting subdata: requested data exceeds buffer size!");const l=this._context.gl;this.bufferType===n.BufferType.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,n.BufferType.TRANSFORM_FEEDBACK_BUFFER),l.getBufferSubData(n.BufferType.TRANSFORM_FEEDBACK_BUFFER,r,e,i,o),this._context.unbindBuffer(n.BufferType.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,n.BufferType.COPY_READ_BUFFER),l.getBufferSubData(n.BufferType.COPY_READ_BUFFER,r,e,i,o),this._context.unbindBuffer(n.BufferType.COPY_READ_BUFFER))}async getSubDataAsync(e,t=0,r,i){await this._context.clientWaitAsync(),this.getSubData(e,t,r,i)}}e.BufferObject=c,e.tracer=null,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger","./enums"],(function(e,t,r,i,o){"use strict";function a(e){switch(e){case o.ErrorConstant.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case o.ErrorConstant.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case o.ErrorConstant.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case o.ErrorConstant.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case o.ErrorConstant.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case o.ErrorConstant.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const n=!!r("enable-feature:webgl-debug");function s(){return n}e.checkWebGLError=function(e,r=s()){if(r){const r=e.getError();if(r){const e=a(r),o=(new Error).stack;i.getLogger("esri.views.webgl.checkWebGLError").error(new t("webgl-error","WebGL error occurred",{message:e,stack:o}))}}},e.getErrorMessage=a,e.hasFeatureFlagWebGLDebug=n,e.webglDebugEnabled=s,e.webglValidateShadersEnabled=function(){return n},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/enums":function(){define(["exports"],(function(e){"use strict";var t,r,i,o,a,n,s,c,l,_,u,h,d,m,T,E,f,p,R,S,g,A,x,D,F,N,b,M,P,C,I,O,U,y,B,L;e.FramebufferBit=void 0,(t=e.FramebufferBit||(e.FramebufferBit={}))[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t[t.COLOR=16384]="COLOR",e.BufferContent=void 0,(r=e.BufferContent||(e.BufferContent={}))[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e.PrimitiveType=void 0,(i=e.PrimitiveType||(e.PrimitiveType={}))[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",e.BlendFactor=void 0,(o=e.BlendFactor||(e.BlendFactor={}))[o.ZERO=0]="ZERO",o[o.ONE=1]="ONE",o[o.SRC_COLOR=768]="SRC_COLOR",o[o.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",o[o.SRC_ALPHA=770]="SRC_ALPHA",o[o.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",o[o.DST_ALPHA=772]="DST_ALPHA",o[o.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",o[o.DST_COLOR=774]="DST_COLOR",o[o.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",o[o.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",o[o.CONSTANT_COLOR=32769]="CONSTANT_COLOR",o[o.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",o[o.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",o[o.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e.BlendOperation=void 0,(a=e.BlendOperation||(e.BlendOperation={}))[a.ADD=32774]="ADD",a[a.MIN=32775]="MIN",a[a.MAX=32776]="MAX",a[a.SUBTRACT=32778]="SUBTRACT",a[a.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT",e.BufferType=void 0,(n=e.BufferType||(e.BufferType={}))[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e.Face=void 0,(s=e.Face||(e.Face={}))[s.FRONT=1028]="FRONT",s[s.BACK=1029]="BACK",s[s.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e.CullMode=void 0,(c=e.CullMode||(e.CullMode={}))[c.CW=2304]="CW",c[c.CCW=2305]="CCW",e.DataType=void 0,(l=e.DataType||(e.DataType={}))[l.BYTE=5120]="BYTE",l[l.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",l[l.SHORT=5122]="SHORT",l[l.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",l[l.INT=5124]="INT",l[l.UNSIGNED_INT=5125]="UNSIGNED_INT",l[l.FLOAT=5126]="FLOAT",l[l.HALF_FLOAT=5131]="HALF_FLOAT",e.CompareFunction=void 0,(_=e.CompareFunction||(e.CompareFunction={}))[_.NEVER=512]="NEVER",_[_.LESS=513]="LESS",_[_.EQUAL=514]="EQUAL",_[_.LEQUAL=515]="LEQUAL",_[_.GREATER=516]="GREATER",_[_.NOTEQUAL=517]="NOTEQUAL",_[_.GEQUAL=518]="GEQUAL",_[_.ALWAYS=519]="ALWAYS",e.StencilOperation=void 0,(u=e.StencilOperation||(e.StencilOperation={}))[u.ZERO=0]="ZERO",u[u.KEEP=7680]="KEEP",u[u.REPLACE=7681]="REPLACE",u[u.INCR=7682]="INCR",u[u.DECR=7683]="DECR",u[u.INVERT=5386]="INVERT",u[u.INCR_WRAP=34055]="INCR_WRAP",u[u.DECR_WRAP=34056]="DECR_WRAP",e.TextureSamplingMode=void 0,(h=e.TextureSamplingMode||(e.TextureSamplingMode={}))[h.NEAREST=9728]="NEAREST",h[h.LINEAR=9729]="LINEAR",h[h.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",h[h.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",h[h.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",h[h.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e.TextureWrapMode=void 0,(d=e.TextureWrapMode||(e.TextureWrapMode={}))[d.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",d[d.REPEAT=10497]="REPEAT",d[d.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e.TextureType=void 0,(m=e.TextureType||(e.TextureType={}))[m.TEXTURE_2D=3553]="TEXTURE_2D",m[m.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",m[m.TEXTURE_3D=32879]="TEXTURE_3D",m[m.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",m[m.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",m[m.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",m[m.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",m[m.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",m[m.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",m[m.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e.TextureConstants=void 0,(T=e.TextureConstants||(e.TextureConstants={}))[T.MIN_LOD=33082]="MIN_LOD",T[T.MAX_LOD=33083]="MAX_LOD",T[T.BASE_LEVEL=33084]="BASE_LEVEL",T[T.MAX_LEVEL=33085]="MAX_LEVEL",T[T.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e.PixelFormat=void 0,(E=e.PixelFormat||(e.PixelFormat={}))[E.ALPHA=6406]="ALPHA",E[E.RGB=6407]="RGB",E[E.RGBA=6408]="RGBA",E[E.LUMINANCE=6409]="LUMINANCE",E[E.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",E[E.RED=6403]="RED",E[E.RG=33319]="RG",E[E.RED_INTEGER=36244]="RED_INTEGER",E[E.RG_INTEGER=33320]="RG_INTEGER",E[E.RGB_INTEGER=36248]="RGB_INTEGER",E[E.RGBA_INTEGER=36249]="RGBA_INTEGER",e.SizedPixelFormat=void 0,(f=e.SizedPixelFormat||(e.SizedPixelFormat={}))[f.RGBA4=32854]="RGBA4",f[f.R16F=33325]="R16F",f[f.RG16F=33327]="RG16F",f[f.RGB32F=34837]="RGB32F",f[f.RGBA16F=34842]="RGBA16F",f[f.R32F=33326]="R32F",f[f.RG32F=33328]="RG32F",f[f.RGBA32F=34836]="RGBA32F",f[f.R11F_G11F_B10F=35898]="R11F_G11F_B10F",f[f.RGB8=32849]="RGB8",f[f.RGBA8=32856]="RGBA8",f[f.RGB5_A1=32855]="RGB5_A1",f[f.R8=33321]="R8",f[f.RG8=33323]="RG8",f[f.R8I=33329]="R8I",f[f.R8UI=33330]="R8UI",f[f.R16I=33331]="R16I",f[f.R16UI=33332]="R16UI",f[f.R32I=33333]="R32I",f[f.R32UI=33334]="R32UI",f[f.RG8I=33335]="RG8I",f[f.RG8UI=33336]="RG8UI",f[f.RG16I=33337]="RG16I",f[f.RG16UI=33338]="RG16UI",f[f.RG32I=33339]="RG32I",f[f.RG32UI=33340]="RG32UI",f[f.RGB16F=34843]="RGB16F",f[f.RGB9_E5=35901]="RGB9_E5",f[f.SRGB8=35905]="SRGB8",f[f.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",f[f.RGB565=36194]="RGB565",f[f.RGBA32UI=36208]="RGBA32UI",f[f.RGB32UI=36209]="RGB32UI",f[f.RGBA16UI=36214]="RGBA16UI",f[f.RGB16UI=36215]="RGB16UI",f[f.RGBA8UI=36220]="RGBA8UI",f[f.RGB8UI=36221]="RGB8UI",f[f.RGBA32I=36226]="RGBA32I",f[f.RGB32I=36227]="RGB32I",f[f.RGBA16I=36232]="RGBA16I",f[f.RGB16I=36233]="RGB16I",f[f.RGBA8I=36238]="RGBA8I",f[f.RGB8I=36239]="RGB8I",f[f.R8_SNORM=36756]="R8_SNORM",f[f.RG8_SNORM=36757]="RG8_SNORM",f[f.RGB8_SNORM=36758]="RGB8_SNORM",f[f.RGBA8_SNORM=36759]="RGBA8_SNORM",f[f.RGB10_A2=32857]="RGB10_A2",f[f.RGB10_A2UI=36975]="RGB10_A2UI",e.UnsizedDepthFormat=void 0,(p=e.UnsizedDepthFormat||(e.UnsizedDepthFormat={}))[p.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",p[p.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e.SizedDepthStencilFormat=void 0,(R=e.SizedDepthStencilFormat||(e.SizedDepthStencilFormat={}))[R.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",R[R.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e.SizedDepthFormat=void 0,(S=e.SizedDepthFormat||(e.SizedDepthFormat={}))[S.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",S[S.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",S[S.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e.SizedStencilFormat=void 0,(g=e.SizedStencilFormat||(e.SizedStencilFormat={}))[g.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e.PixelType=void 0,(A=e.PixelType||(e.PixelType={}))[A.FLOAT=5126]="FLOAT",A[A.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",A[A.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",A[A.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",A[A.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",A[A.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",A[A.BYTE=5120]="BYTE",A[A.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",A[A.SHORT=5122]="SHORT",A[A.UNSIGNED_INT=5125]="UNSIGNED_INT",A[A.INT=5124]="INT",A[A.HALF_FLOAT=5131]="HALF_FLOAT",A[A.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",A[A.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",A[A.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",A[A.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e.Usage=void 0,(x=e.Usage||(e.Usage={}))[x.STATIC_DRAW=35044]="STATIC_DRAW",x[x.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",x[x.STREAM_DRAW=35040]="STREAM_DRAW",x[x.STATIC_READ=35045]="STATIC_READ",x[x.DYNAMIC_READ=35049]="DYNAMIC_READ",x[x.STREAM_READ=35041]="STREAM_READ",x[x.STATIC_COPY=35046]="STATIC_COPY",x[x.DYNAMIC_COPY=35050]="DYNAMIC_COPY",x[x.STREAM_COPY=35042]="STREAM_COPY",e.ShaderType=void 0,(D=e.ShaderType||(e.ShaderType={}))[D.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",D[D.VERTEX_SHADER=35633]="VERTEX_SHADER",e.FramebufferTarget=void 0,(F=e.FramebufferTarget||(e.FramebufferTarget={}))[F.FRAMEBUFFER=36160]="FRAMEBUFFER",F[F.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",F[F.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e.ResourceType=void 0,(N=e.ResourceType||(e.ResourceType={}))[N.Texture=0]="Texture",N[N.TileTexture=1]="TileTexture",N[N.BufferObject=2]="BufferObject",N[N.VertexArrayObject=3]="VertexArrayObject",N[N.Shader=4]="Shader",N[N.Program=5]="Program",N[N.FramebufferObject=6]="FramebufferObject",N[N.Renderbuffer=7]="Renderbuffer",N[N.TransformFeedback=8]="TransformFeedback",N[N.Sync=9]="Sync",N[N.UNCOUNTED=10]="UNCOUNTED",N[N.LinesOfCode=10]="LinesOfCode",N[N.Uniform=11]="Uniform",N[N.COUNT=12]="COUNT",e.SpecialDrawBuffers=void 0,(b=e.SpecialDrawBuffers||(e.SpecialDrawBuffers={}))[b.NONE=0]="NONE",b[b.BACK=1029]="BACK",e.CompressedTextureFormat=void 0,(M=e.CompressedTextureFormat||(e.CompressedTextureFormat={}))[M.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",M[M.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",M[M.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",M[M.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",M[M.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",M[M.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",M[M.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",M[M.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",M[M.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",M[M.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",M[M.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",M[M.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",M[M.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",M[M.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e.UniformType=void 0,(P=e.UniformType||(e.UniformType={}))[P.FLOAT=5126]="FLOAT",P[P.FLOAT_VEC2=35664]="FLOAT_VEC2",P[P.FLOAT_VEC3=35665]="FLOAT_VEC3",P[P.FLOAT_VEC4=35666]="FLOAT_VEC4",P[P.INT=5124]="INT",P[P.INT_VEC2=35667]="INT_VEC2",P[P.INT_VEC3=35668]="INT_VEC3",P[P.INT_VEC4=35669]="INT_VEC4",P[P.BOOL=35670]="BOOL",P[P.BOOL_VEC2=35671]="BOOL_VEC2",P[P.BOOL_VEC3=35672]="BOOL_VEC3",P[P.BOOL_VEC4=35673]="BOOL_VEC4",P[P.FLOAT_MAT2=35674]="FLOAT_MAT2",P[P.FLOAT_MAT3=35675]="FLOAT_MAT3",P[P.FLOAT_MAT4=35676]="FLOAT_MAT4",P[P.SAMPLER_2D=35678]="SAMPLER_2D",P[P.SAMPLER_CUBE=35680]="SAMPLER_CUBE",P[P.UNSIGNED_INT=5125]="UNSIGNED_INT",P[P.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",P[P.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",P[P.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",P[P.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",P[P.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",P[P.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",P[P.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",P[P.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",P[P.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",P[P.SAMPLER_3D=35679]="SAMPLER_3D",P[P.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",P[P.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",P[P.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",P[P.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",P[P.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",P[P.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",P[P.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",P[P.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",P[P.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",P[P.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",P[P.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",P[P.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e.SyncParameter=void 0,(C=e.SyncParameter||(e.SyncParameter={}))[C.OBJECT_TYPE=37138]="OBJECT_TYPE",C[C.SYNC_CONDITION=37139]="SYNC_CONDITION",C[C.SYNC_STATUS=37140]="SYNC_STATUS",C[C.SYNC_FLAGS=37141]="SYNC_FLAGS",e.SyncStatus=void 0,(I=e.SyncStatus||(e.SyncStatus={}))[I.UNSIGNALED=37144]="UNSIGNALED",I[I.SIGNALED=37145]="SIGNALED",e.ClientWaitSyncStatus=void 0,(O=e.ClientWaitSyncStatus||(e.ClientWaitSyncStatus={}))[O.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",O[O.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",O[O.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",O[O.WAIT_FAILED=37149]="WAIT_FAILED",e.SyncCondition=void 0,(U=e.SyncCondition||(e.SyncCondition={}))[U.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e.SyncFlag=void 0,(y=e.SyncFlag||(e.SyncFlag={}))[y.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e.ErrorConstant=void 0,(B=e.ErrorConstant||(e.ErrorConstant={}))[B.INVALID_ENUM=1280]="INVALID_ENUM",B[B.INVALID_VALUE=1281]="INVALID_VALUE",B[B.INVALID_OPERATION=1282]="INVALID_OPERATION",B[B.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",B[B.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",B[B.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e.Extension=void 0,(L=e.Extension||(e.Extension={}))[L.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e.ColorAttachment0=36064,e.ColorAttachment1=36065,e.ColorAttachment10=36074,e.ColorAttachment11=36075,e.ColorAttachment12=36076,e.ColorAttachment13=36077,e.ColorAttachment14=36078,e.ColorAttachment15=36079,e.ColorAttachment2=36066,e.ColorAttachment3=36067,e.ColorAttachment4=36068,e.ColorAttachment5=36069,e.ColorAttachment6=36070,e.ColorAttachment7=36071,e.ColorAttachment8=36072,e.ColorAttachment9=36073,e.DepthAttachment=36096,e.DepthStencilAttachment=33306,e.StencilAttachment=36128,e.baseTextureUnit=33984,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/FramebufferObject":function(){define(["exports","../../core/has","../../core/Logger","../../core/maybe","./BufferObject","./checkWebGLError","./enums","./FBOAttachmentType","./Renderbuffer","./Texture"],(function(e,t,r,i,o,a,n,s,c,l){"use strict";class _{constructor(e,t,r){if(this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(n.ResourceType.FramebufferObject,this),null!=t){const r=u(t)?t:new l.Texture(e,t);this._colorAttachments.set(n.ColorAttachment0,r),this._validateTextureDescriptor(r.descriptor),this._validateColorAttachmentPoint(n.ColorAttachment0)}var i;if(null!=r)if(u(i=r)||function(e){return h(e)===s.FBOAttachmentType.TextureDescriptor}(i))this._depthStencilTexture=u(r)?r:new l.Texture(e,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const t=function(e){return h(e)===s.FBOAttachmentType.Renderbuffer}(r)?r:new c.Renderbuffer(e,r);this._depthStencilBuffer=t,this._validateRenderbufferDescriptor(t.descriptor)}}dispose(){const{_colorAttachments:e,_glName:t}=this;if(0===e.size&&!this._depthStencilBuffer&&!this._depthStencilTexture&&!t)return;const{_context:r}=this,i=r.getBoundFramebufferObject();e.forEach(((e,t)=>this.detachColorTexture(t)?.dispose())),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),r.gl.deleteFramebuffer(t),this._glName=null,r.bindFramebuffer(i===this?null:i),r.instanceCounter.decrement(n.ResourceType.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(n.ColorAttachment0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){const e=this._colorAttachments.get(n.ColorAttachment0)??this._depthStencilTexture??this._depthStencilBuffer;return e?.descriptor?.width??0}get height(){const e=this._colorAttachments.get(n.ColorAttachment0)??this._depthStencilTexture??this._depthStencilBuffer;return e?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce(((e,[t,r])=>e+r.usedMemory),this.depthStencil?.usedMemory??0)}static{this._MAX_COLOR_ATTACHMENTS=-1}getColorTexture(e){const t=this._colorAttachments.get(e);return t&&u(t)?t:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,t=n.ColorAttachment0){if(!e)return;this._validateColorAttachmentPoint(t);const{descriptor:r}=e;this._validateTextureDescriptor(r),this.detachColorTexture(t)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,t)),this._colorAttachments.set(t,e)}detachColorTexture(e=n.ColorAttachment0){const t=this._colorAttachments.get(e);if(t)return this._initialized&&this._context.temporaryBindFramebufferObject(this,(()=>{this._framebufferTexture2D(null,e)})),this._colorAttachments.delete(e),t}setColorTextureTarget(e,t=n.ColorAttachment0,r=0){const i=this._colorAttachments.get(t);i&&(e===n.TextureType.TEXTURE_2D_ARRAY?this._framebufferTextureLayer(i.glName,t,n.FramebufferTarget.FRAMEBUFFER,0,r):this._framebufferTexture2D(i.glName,t,e,n.FramebufferTarget.FRAMEBUFFER,0))}attachDepthStencil(e){if(e)switch(e.type){case s.FBOAttachmentType.Texture:return this._attachDepthStencilTexture(e);case s.FBOAttachmentType.Renderbuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(null==e)return;const{descriptor:t}=e,{pixelFormat:r,dataType:i}=t;r===n.UnsizedDepthFormat.DEPTH_STENCIL||r===n.UnsizedDepthFormat.DEPTH_COMPONENT?r!==n.UnsizedDepthFormat.DEPTH_STENCIL||i===n.PixelType.UNSIGNED_INT_24_8?r!==n.UnsizedDepthFormat.DEPTH_COMPONENT||i===n.PixelType.UNSIGNED_INT||i===n.PixelType.UNSIGNED_SHORT?(this._validateTextureDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,T(r))),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e):console.error("Depth texture must have data type of UNSIGNED_INT or UNSIGNED_SHORT!"):console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"):console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!")}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&this._context.temporaryBindFramebufferObject(this,(()=>{this._framebufferTexture2D(null,T(e.descriptor.pixelFormat))})),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(null==e)return;const t=e.descriptor;if(this._validateRenderbufferDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const{gl:r}=this._context,i=this._getGLAttachmentPoint(t);r.framebufferRenderbuffer(n.FramebufferTarget.FRAMEBUFFER,i,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const{_context:t}=this,r=t.getBoundFramebufferObject();t.bindFramebuffer(this);const{gl:i}=t,o=this._getGLAttachmentPoint(e.descriptor);i.framebufferRenderbuffer(n.FramebufferTarget.FRAMEBUFFER,o,i.RENDERBUFFER,null),t.bindFramebuffer(r)}return this._depthStencilBuffer=null,e}invalidateAttachments(e){const{_context:t}=this;t.temporaryBindFramebufferObject(this,(()=>t.gl.invalidateFramebuffer(n.FramebufferTarget.FRAMEBUFFER,e)),!0)}copyToTexture(e,t,r,i,o,a,s){(e<0||t<0||o<0||a<0)&&console.error("Offsets cannot be negative!"),(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!");const c=s.descriptor;s.descriptor.target!==n.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(null==c?.width||null==c?.height||e+r>this.width||t+i>this.height||o+r>c.width||a+i>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const _=this._context,u=_.bindTexture(s,l.Texture.TEXTURE_UNIT_FOR_UPDATES);_.setActiveTexture(l.Texture.TEXTURE_UNIT_FOR_UPDATES),_.bindFramebuffer(this),_.gl.copyTexSubImage2D(n.TextureType.TEXTURE_2D,0,o,a,e,t,r,i),_.bindTexture(u,l.Texture.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,t,r,i,o,a,n){(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!"),n||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,i,o,a,n)}async readPixelsAsync(e,t,r,i,a,s,c){const{gl:l}=this._context,_=o.BufferObject.createPixelPack(this._context,n.Usage.STREAM_READ,c.byteLength);this._context.bindBuffer(_);const u=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),l.readPixels(e,t,r,i,a,s,0),this._context.unbindBuffer(n.BufferType.PIXEL_PACK_BUFFER),this._context.bindFramebuffer(u),await _.getSubDataAsync(c),_.dispose()}resize(e,t){if(this.width===e&&this.height===t)return;const r={width:e,height:t};d(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach((e=>e.resize(r.width,r.height))),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(d(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=n.FramebufferTarget.FRAMEBUFFER){const{gl:t}=this._context;if(this._initialized)return void t.bindFramebuffer(e,this.glName);this._glName&&t.deleteFramebuffer(this._glName);const r=t.createFramebuffer();if(t.bindFramebuffer(e,r),this._colorAttachments.forEach(((t,r)=>{const i=m(t);i===n.TextureType.TEXTURE_2D_ARRAY?this._framebufferTextureLayer(t.glName,r,e,0,0):this._framebufferTexture2D(t.glName,r,i,e)})),this._depthStencilBuffer){const r=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(e,r,t.RENDERBUFFER,this._depthStencilBuffer.glName)}else if(this._depthStencilTexture){const t=T(this._depthStencilTexture.descriptor.pixelFormat);this._framebufferTexture2D(this._depthStencilTexture.glName,t,m(this._depthStencilTexture),e)}a.webglDebugEnabled()&&t.checkFramebufferStatus(e)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,t=n.ColorAttachment0,r=n.TextureType.TEXTURE_2D,i=n.FramebufferTarget.FRAMEBUFFER,o=0){this._context.gl.framebufferTexture2D(i,t,r,e,o)}_framebufferTextureLayer(e,t=n.ColorAttachment0,r=n.FramebufferTarget.FRAMEBUFFER,i=0,o=0){this._context.gl.framebufferTextureLayer(r,t,e,i,o)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const t=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(n.FramebufferTarget.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthStencilBuffer=i.disposeMaybe(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,T(this._depthStencilTexture.descriptor.pixelFormat))),this._depthStencilTexture=i.disposeMaybe(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==n.TextureType.TEXTURE_2D&&e.target!==n.TextureType.TEXTURE_CUBE_MAP&&e.target!==n.TextureType.TEXTURE_2D_ARRAY&&console.error("Texture type must be TEXTURE_2D, TEXTURE_2D_ARRAY or TEXTURE_CUBE_MAP!"),d(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderbufferDescriptor(e){d(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case n.SizedDepthFormat.DEPTH_COMPONENT16:case n.SizedDepthFormat.DEPTH_COMPONENT24:case n.SizedDepthFormat.DEPTH_COMPONENT32F:return n.DepthAttachment;case n.SizedDepthStencilFormat.DEPTH24_STENCIL8:case n.SizedDepthStencilFormat.DEPTH32F_STENCIL8:return n.DepthStencilAttachment;case n.SizedStencilFormat.STENCIL_INDEX8:return n.StencilAttachment}}_validateColorAttachmentPoint(e){if(-1===_._MAX_COLOR_ATTACHMENTS){const{gl:e}=this._context;_._MAX_COLOR_ATTACHMENTS=e.getParameter(e.MAX_COLOR_ATTACHMENTS)}const t=e-n.ColorAttachment0;t+1>_._MAX_COLOR_ATTACHMENTS&&r.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${_._MAX_COLOR_ATTACHMENTS} color attachments`)}}function u(e){return h(e)===s.FBOAttachmentType.Texture}function h(e){return null!=e&&"type"in e?e.type:null}function d(e,t){const i=Math.max(e.width,e.height);if(i>t){r.getLogger("esri.views.webgl.FramebufferObject").warnOnce(`Resizing FBO attachment size ${e.width}x${e.height} to device limit ${t}`);const o=t/i;return e.width=Math.round(e.width*o),e.height=Math.round(e.height*o),!1}return!0}function m(e){return e.descriptor.target===n.TextureType.TEXTURE_CUBE_MAP?n.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:e.descriptor.target===n.TextureType.TEXTURE_2D_ARRAY?n.TextureType.TEXTURE_2D_ARRAY:n.TextureType.TEXTURE_2D}function T(e){return e===n.UnsizedDepthFormat.DEPTH_COMPONENT?n.DepthAttachment:n.DepthStencilAttachment}e.FramebufferObject=_,e.ensureAttachmentMaxSize=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/FBOAttachmentType":function(){define(["exports"],(function(e){"use strict";var t;e.FBOAttachmentType=void 0,(t=e.FBOAttachmentType||(e.FBOAttachmentType={}))[t.TextureDescriptor=0]="TextureDescriptor",t[t.Texture=1]="Texture",t[t.Renderbuffer=2]="Renderbuffer",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/Renderbuffer":function(){define(["exports","./enums","./FBOAttachmentType","./RenderbufferDescriptor"],(function(e,t,r,i){"use strict";e.Renderbuffer=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=r.FBOAttachmentType.Renderbuffer,this._context.instanceCounter.increment(t.ResourceType.Renderbuffer,this);const o=this._context.gl;this.glName=o.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:a,height:n,internalFormat:s,multisampled:c}=i;c?o.renderbufferStorageMultisample(o.RENDERBUFFER,this.samples,s,a,n):o.renderbufferStorage(o.RENDERBUFFER,s,a,n),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,t=this._context.parameters.maxSamples;return e?Math.min(e,t):t}get usedMemory(){return i.estimateMemory(this._descriptor)}resize(e,t){const r=this._descriptor;if(r.width===e&&r.height===t)return;r.width=e,r.height=t;const i=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):i.renderbufferStorage(i.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(t.ResourceType.Renderbuffer,this),this._context=null)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/RenderbufferDescriptor":function(){define(["exports","./Util"],(function(e,t){"use strict";e.RenderbufferDescriptor=class{constructor(e,t=0,r=t){this.internalFormat=e,this.width=t,this.height=r,this.multisampled=!1,this.samples=1}},e.estimateMemory=function(e){return e.width<=0||e.height<=0||null==e.internalFormat?0:e.width*e.height*t.getBytesPerElementFormat(e.internalFormat)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/Util":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./getDataTypeBytes"],(function(e,t,r,i,o){"use strict";function a(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function n(e){return e[0].stride}e.bindVertexBufferLayout=function(e,t,i,n,s=0){const c=e.gl;e.bindBuffer(i);for(const i of n){const n=t.get(i.name);if(null==n){console.warn(`There is no location for vertex attribute '${i.name}' defined.`);continue}const l=s*i.stride;if(i.count<=4)c.vertexAttribPointer(n,i.count,i.type,i.normalized,i.stride,i.offset+l),c.enableVertexAttribArray(n),i.divisor>0&&e.gl.vertexAttribDivisor(n,i.divisor);else if(9===i.count)for(let t=0;t<3;t++)c.vertexAttribPointer(n+t,3,i.type,i.normalized,i.stride,i.offset+12*t+l),c.enableVertexAttribArray(n+t),i.divisor>0&&e.gl.vertexAttribDivisor(n+t,i.divisor);else if(16===i.count)for(let t=0;t<4;t++)c.vertexAttribPointer(n+t,4,i.type,i.normalized,i.stride,i.offset+16*t+l),c.enableVertexAttribArray(n+t),i.divisor>0&&e.gl?.vertexAttribDivisor(n+t,i.divisor);else console.error("Unsupported vertex attribute element count: "+i.count);if(r.webglDebugEnabled()){const t=a(e),r=o.getDataTypeBytes(i.type),n=i.offset,s=Math.round(r/n)!==r/n?`. Offset not a multiple of stride. DataType requires ${r} bytes, but descriptor has an offset of ${n}`:"";t&&console.error(`Unable to bind vertex attribute "${i.name}" with baseInstanceOffset ${l}${s}:`,t,i)}}},e.getBytesPerElementFormat=function(e){switch(e){case i.PixelFormat.ALPHA:case i.PixelFormat.LUMINANCE:case i.PixelFormat.RED:case i.PixelFormat.RED_INTEGER:case i.SizedPixelFormat.R8:case i.SizedPixelFormat.R8I:case i.SizedPixelFormat.R8UI:case i.SizedPixelFormat.R8_SNORM:case i.SizedStencilFormat.STENCIL_INDEX8:return 1;case i.PixelFormat.LUMINANCE_ALPHA:case i.PixelFormat.RG:case i.PixelFormat.RG_INTEGER:case i.SizedPixelFormat.RGBA4:case i.SizedPixelFormat.R16F:case i.SizedPixelFormat.R16I:case i.SizedPixelFormat.R16UI:case i.SizedPixelFormat.RG8:case i.SizedPixelFormat.RG8I:case i.SizedPixelFormat.RG8UI:case i.SizedPixelFormat.RG8_SNORM:case i.SizedPixelFormat.RGB565:case i.SizedPixelFormat.RGB5_A1:case i.SizedDepthFormat.DEPTH_COMPONENT16:return 2;case i.PixelFormat.RGB:case i.PixelFormat.RGB_INTEGER:case i.SizedPixelFormat.RGB8:case i.SizedPixelFormat.RGB8I:case i.SizedPixelFormat.RGB8UI:case i.SizedPixelFormat.RGB8_SNORM:case i.SizedPixelFormat.SRGB8:case i.SizedDepthFormat.DEPTH_COMPONENT24:return 3;case i.PixelFormat.RGBA:case i.PixelFormat.RGBA_INTEGER:case i.SizedPixelFormat.RGBA8:case i.SizedPixelFormat.R32F:case i.SizedPixelFormat.R11F_G11F_B10F:case i.SizedPixelFormat.RG16F:case i.SizedPixelFormat.R32I:case i.SizedPixelFormat.R32UI:case i.SizedPixelFormat.RG16I:case i.SizedPixelFormat.RG16UI:case i.SizedPixelFormat.RGBA8I:case i.SizedPixelFormat.RGBA8UI:case i.SizedPixelFormat.RGBA8_SNORM:case i.SizedPixelFormat.SRGB8_ALPHA8:case i.SizedPixelFormat.RGB9_E5:case i.SizedPixelFormat.RGB10_A2UI:case i.SizedPixelFormat.RGB10_A2:case i.SizedDepthFormat.DEPTH_COMPONENT32F:case i.SizedDepthStencilFormat.DEPTH24_STENCIL8:return 4;case i.SizedDepthStencilFormat.DEPTH32F_STENCIL8:return 5;case i.SizedPixelFormat.RGB16F:case i.SizedPixelFormat.RGB16I:case i.SizedPixelFormat.RGB16UI:return 6;case i.SizedPixelFormat.RG32F:case i.SizedPixelFormat.RG32I:case i.SizedPixelFormat.RG32UI:case i.SizedPixelFormat.RGBA16F:case i.SizedPixelFormat.RGBA16I:case i.SizedPixelFormat.RGBA16UI:return 8;case i.SizedPixelFormat.RGB32F:case i.SizedPixelFormat.RGB32I:case i.SizedPixelFormat.RGB32UI:return 12;case i.SizedPixelFormat.RGBA32F:case i.SizedPixelFormat.RGBA32I:case i.SizedPixelFormat.RGBA32UI:return 16;case i.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case i.CompressedTextureFormat.COMPRESSED_R11_EAC:case i.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case i.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case i.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case i.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case i.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case i.CompressedTextureFormat.COMPRESSED_RG11_EAC:case i.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case i.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case i.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0},e.getErrorString=a,e.getStride=n,e.unbindVertexBufferLayout=function(e,t,r,o){const a=e.gl;e.bindBuffer(r);for(const r of o){const i=t.get(r.name);if(r.count<=4)a.disableVertexAttribArray(i),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i,0);else if(9===r.count)for(let t=0;t<3;t++)a.disableVertexAttribArray(i+t),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else if(16===r.count)for(let t=0;t<4;t++)a.disableVertexAttribArray(i+t),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else console.error("Unsupported vertex attribute element count: "+r.count)}e.unbindBuffer(i.BufferType.ARRAY_BUFFER)},e.vertexCount=function(e,t){return(e.vertexBuffers.get(t)?.usedMemory??0)/n(e.layout.get(t))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/getDataTypeBytes":function(){define(["exports","./enums"],(function(e,t){"use strict";e.getDataTypeBytes=function(e){switch(e){case t.DataType.BYTE:case t.DataType.UNSIGNED_BYTE:return 1;case t.DataType.SHORT:case t.DataType.UNSIGNED_SHORT:case t.DataType.HALF_FLOAT:return 2;case t.DataType.FLOAT:case t.DataType.INT:case t.DataType.UNSIGNED_INT:return 4}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/Texture":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger","../../core/maybe","../../core/promiseUtils","./checkWebGLError","./enums","./FBOAttachmentType","./TextureDescriptor","./textureUtils","./ValidatedTextureDescriptor"],(function(e,t,r,i,o,a,n,s,c,l,_,u){"use strict";const h=()=>i.getLogger("esri/views/webgl/Texture");let d=class e{static{this.TEXTURE_UNIT_FOR_UPDATES=0}static{this.compressionWorkerHandle=null}constructor(e,r=null,i=null){if(this.type=c.FBOAttachmentType.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._shadowFilterDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const i=u.ValidatedTextureDescriptor.validate(e,r);if(!i)throw new t("texture:invalid-descriptor","Texture descriptor invalid");this._descriptor=i}this._descriptor.target===s.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return l.estimateMemory(this._descriptor)}get cachedMemory(){return this.usedMemory}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty||this._shadowFilterDirty}get hasWebGLTextureObject(){return!!this._glName}dispose(){this.abortCompression(),this._descriptor.context.gl&&this.hasWebGLTextureObject&&(this._descriptor.context.instanceCounter.decrement(s.ResourceType.Texture,this),this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new t("texture:immutable-resize","Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===s.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.compress=e}disableCompression(){this._descriptor.compress=void 0}setData(e){this.abortCompression(),!_.isCompressedData(e)&&this._descriptor.internalFormat&&this._descriptor.internalFormat in s.CompressedTextureFormat&&(this._descriptor.internalFormat=void 0),this._setData(e),!_.isCompressedData(e)&&this._descriptor.compress&&this._compressOnWorker(e)}updateData(r,i,o,a,n,s,c=0){s||h().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||h().error("An attempt to update uninitialized texture!");const l=this._descriptor;l.internalFormat=_.deriveInternalFormat(l);const{context:u,pixelFormat:d,dataType:m,target:T,isImmutable:E}=l;if(E&&!this._wasImmutablyAllocated)throw new t("texture:uninitialized","Cannot update immutable texture before allocation!");const f=u.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||o<0||i+a>l.width||o+n>l.height)&&h().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:p}=u;c&&(a&&n||h().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),p.pixelStorei(p.UNPACK_SKIP_ROWS,c)),_.isTexImageSource(s)?p.texSubImage2D(T,r,i,o,a,n,d,m,s):_.isCompressedData(s)?p.compressedTexSubImage2D(T,r,i,o,a,n,l.internalFormat,s.levels[r]):p.texSubImage2D(T,r,i,o,a,n,d,m,s),c&&p.pixelStorei(p.UNPACK_SKIP_ROWS,0),u.bindTexture(f,e.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(r,i,o,a,n,s,c,l){l||h().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||h().error("An attempt to update an uninitialized texture!");const u=this._descriptor;u.internalFormat=_.deriveInternalFormat(u);const{context:d,pixelFormat:m,dataType:T,isImmutable:E,target:f}=u;if(E&&!this._wasImmutablyAllocated)throw new t("texture:uninitialized","Cannot update immutable texture before allocation!");_.is3DTarget(f)||h().warn("Attempting to set 3D texture data on a non-3D texture");const p=d.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),(i<0||o<0||a<0||i+n>u.width||o+s>u.height||a+c>u.depth)&&h().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:R}=d;if(_.isCompressedData(l))l=l.levels[r],R.compressedTexSubImage3D(f,r,i,o,a,n,s,c,u.internalFormat,l);else{const e=l;R.texSubImage3D(f,r,i,o,a,n,s,c,m,T,e)}d.bindTexture(p,e.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const r=this._descriptor;if(0===r.width||0===r.height)return;if(!r.hasMipmap){if(this._wasImmutablyAllocated)throw new t("texture:immutable-change","Cannot add mipmaps to immutable texture after allocation");r.hasMipmap=!0,this._samplingModeDirty=!0,_.validateTexture(r)}r.samplingMode===s.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,r.samplingMode=s.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):r.samplingMode===s.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,r.samplingMode=s.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(r.target),this._descriptor.context.bindTexture(i,e.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new t("texture:immutable-change","Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,_.validateTexture(e)}e.samplingMode===s.TextureSamplingMode.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=s.TextureSamplingMode.LINEAR):e.samplingMode===s.TextureSamplingMode.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=s.TextureSamplingMode.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,_.validateTexture(this._descriptor),this._wrapModeDirty=!0)}setShadowFiltering(e){e!==this._descriptor.linearFilterDepth&&(this._descriptor.linearFilterDepth=this._descriptor.compareEnabled=e,this.setSamplingMode(e?s.TextureSamplingMode.LINEAR:s.TextureSamplingMode.NEAREST),_.validateTexture(this._descriptor),this._shadowFilterDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1),this._shadowFilterDirty&&(this._applyShadowMode(),this._shadowFilterDirty=!1)}abortCompression(){this._compressionAbortController=o.abortMaybe(this._compressionAbortController)}_setData(r,i){const o=this._descriptor,a=o.context?.gl;if(!a)return;n.checkWebGLError(a),this.hasWebGLTextureObject||(this._glName=a.createTexture(),o.context.instanceCounter.increment(s.ResourceType.Texture,this)),_.validateTexture(o);const c=o.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);o.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),n.checkWebGLError(a);const l=i??o.target,u=_.is3DTarget(l);if(_.isTexImageSource(r))this._setDataFromTexImageSource(r,l);else{const{width:e,height:i,depth:s}=o;if(null==e||null==i)throw new t("texture:missing-size","Width and height must be specified!");if(u&&null==s)throw new t("texture:missing-depth","Depth must be specified!");if(o.internalFormat=_.deriveInternalFormat(o),o.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,o.internalFormat,o.hasMipmap,e,i,s),_.isCompressedData(r)){if(!_.isCompressedFormat(o.internalFormat))throw new t("texture:format-mismatch","Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(r,o.internalFormat,l)}else this._texImage(l,0,o.internalFormat,e,i,s,r),n.checkWebGLError(a),o.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),this._applyShadowMode(),n.checkWebGLError(a),o.context.bindTexture(c,e.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let t=s.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;t<=s.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:i}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0)}_setDataFromTexImageSource(e,t){const{gl:r}=this._descriptor.context,i=this._descriptor;i.internalFormat=_.deriveInternalFormat(i);const o=_.is3DTarget(t),{width:a,height:s,depth:c}=_.getDimensions(e);i.width&&i.height,i.width||(i.width=a),i.height||(i.height=s),o&&i.depth,o&&(i.depth=c),i.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(t,i.internalFormat,i.hasMipmap,a,s,c),this._texImage(t,0,i.internalFormat,a,s,c,e),n.checkWebGLError(r),i.hasMipmap&&(this.generateMipmap(),n.checkWebGLError(r))}_setDataFromCompressedSource(e,t,r){const i=this._descriptor,{width:o,height:a,depth:n}=i,c=e.levels,l=_.calcMipmapLevels(r,o,a,n),u=Math.min(l,c.length)-1;this._descriptor.context.gl.texParameteri(i.target,s.TextureConstants.MAX_LEVEL,u),this._forEachMipmapLevel(((e,i,o,a)=>{const n=c[Math.min(e,c.length-1)];this._compressedTexImage(r,e,t,i,o,a,n)}),u)}_texStorage(e,r,i,o,a,n){const{gl:s}=this._descriptor.context;if(!_.isSizedPixelFormat(r)&&!_.isSizedDepthFormat(r)&&!_.isSizedDepthStencilFormat(r))throw new t("texture:missing-format","Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const c=i?_.calcMipmapLevels(e,o,a,n):1;if(_.is3DTarget(e)){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");s.texStorage3D(e,c,r,o,a,n)}else s.texStorage2D(e,c,r,o,a);this._wasImmutablyAllocated=!0}_texImage(e,r,i,o,a,n,s){const c=this._descriptor.context.gl,l=_.is3DTarget(e),{isImmutable:u,pixelFormat:h,dataType:d}=this._descriptor;if(u){if(null!=s){const i=s;if(l){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");c.texSubImage3D(e,r,0,0,0,o,a,n,h,d,i)}else c.texSubImage2D(e,r,0,0,o,a,h,d,i)}}else{const _=s;if(l){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");c.texImage3D(e,r,i,o,a,n,0,h,d,_)}else c.texImage2D(e,r,i,o,a,0,h,d,_)}}_compressedTexImage(e,r,i,o,a,n,s){const c=this._descriptor.context.gl,l=_.is3DTarget(e);if(this._descriptor.isImmutable){if(null!=s)if(l){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,o,a,n,i,s)}else c.compressedTexSubImage2D(e,r,0,0,o,a,i,s)}else if(l){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,o,a,n,0,s)}else c.compressedTexImage2D(e,r,i,o,a,0,s)}async _compressOnWorker(t){const{width:r,height:i,context:o,flipped:n,preMultiplyAlpha:c,hasMipmap:l}=this._descriptor,_=this._descriptor.compress?.compressionTracker,u=this._descriptor.compress?.compressionCallback,{compressedTextureETC:d,compressedTextureS3TC:m}=o.capabilities;if(!e.compressionWorkerHandle?.isCompressible(t,this._descriptor)||!d&&!m)return;this.abortCompression();const T=new AbortController;this._compressionAbortController=T,_?.increment();try{let o;t instanceof Uint8Array?o=t.buffer:(o=await createImageBitmap(t,{imageOrientation:n?"flipY":"none"}),a.throwIfAborted(T));const _={data:o,width:r,height:i,needsFlip:t instanceof Uint8Array&&this.descriptor.flipped,components:this._descriptor.pixelFormat===s.PixelFormat.RGBA?4:3,preMultiplyAlpha:c,hasMipmap:l,hasETC:!!d,hasS3TC:!!m},h=await e.compressionWorkerHandle.invoke(_,T.signal,"low");if(a.throwIfAborted(T),h.compressedTexture&&this.hasWebGLTextureObject){const e=this.usedMemory;this._descriptor.internalFormat=h.internalFormat,this._setData(h.compressedTexture),u?.(e-this.usedMemory)}}catch(e){a.isAbortError(e)||h().error("Texture compression failed!")}finally{_?.decrement(),this._compressionAbortController?.signal.aborted&&(this._compressionAbortController=null)}}_forEachMipmapLevel(e,r=1/0){let{width:i,height:o,depth:a,hasMipmap:n,target:c}=this._descriptor;const l=c===s.TextureType.TEXTURE_3D;if(null==i||null==o||l&&null==a)throw new t("texture:missing-size","Missing texture dimensions for mipmap calculation");for(let t=0;e(t,i,o,a),n&&(1!==i||1!==o||l&&1!==a)&&!(t>=r);++t)i=Math.max(1,i>>1),o=Math.max(1,o>>1),l&&(a=Math.max(1,a>>1))}_applySamplingMode(){const e=this._descriptor,t=e.context?.gl;let r=e.samplingMode,i=e.samplingMode;r===s.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||r===s.TextureSamplingMode.LINEAR_MIPMAP_LINEAR?(r=s.TextureSamplingMode.LINEAR,e.hasMipmap||(i=s.TextureSamplingMode.LINEAR)):r!==s.TextureSamplingMode.NEAREST_MIPMAP_NEAREST&&r!==s.TextureSamplingMode.NEAREST_MIPMAP_LINEAR||(r=s.TextureSamplingMode.NEAREST,e.hasMipmap||(i=s.TextureSamplingMode.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}_applyWrapMode(){const e=this._descriptor,t=e.context?.gl;"number"==typeof e.wrapMode?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}_applyShadowMode(){const e=this._descriptor,t=e.context?.gl,r=e.compareEnabled?t.COMPARE_REF_TO_TEXTURE:t.NONE;t.texParameteri(e.target,t.TEXTURE_COMPARE_MODE,r),e.compareEnabled&&t.texParameteri(e.target,t.TEXTURE_COMPARE_FUNC,t.GREATER),n.checkWebGLError(t)}_applyAnisotropicFilteringParameters(){const e=this._descriptor,t=e.context.capabilities.textureFilterAnisotropic;t&&e.context.gl.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}};e.Texture=d,e.tracer=null,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./FBOAttachmentType","./Util"],(function(e,t,r,i){"use strict";e.TextureDescriptor=class{constructor(e=0,i=e){this.width=e,this.height=i,this.type=r.FBOAttachmentType.TextureDescriptor,this.target=t.TextureType.TEXTURE_2D,this.pixelFormat=t.PixelFormat.RGBA,this.dataType=t.PixelType.UNSIGNED_BYTE,this.samplingMode=t.TextureSamplingMode.LINEAR,this.wrapMode=t.TextureWrapMode.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.compareEnabled=!1,this.linearFilterDepth=!1,this.depth=1,this.isImmutable=!1}},e.estimateMemory=function(e){return e.width<=0||e.height<=0||e.depth<=0?0:Math.round(e.width*e.height*e.depth*(e.hasMipmap?4/3:1)*(null==e.internalFormat?4:i.getBytesPerElementFormat(e.internalFormat))*(e.target===t.TextureType.TEXTURE_CUBE_MAP?6:1))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/textureUtils":function(){define(["exports","../../core/Error","../../core/Logger","./enums"],(function(e,t,r,i){"use strict";const o=()=>r.getLogger("esri/views/webgl/textureUtils");function a(e){return e in i.SizedDepthFormat}function n(e){return e in i.SizedDepthStencilFormat}function s(e){return null!=e&&e in i.CompressedTextureFormat}function c(e){return null!=e&&"type"in e&&"compressed"===e.type}function l(e){return null!=e&&"byteLength"in e}e.calcMipmapLevels=function(e,t,r,o=1){let a=Math.max(t,r);return e===i.TextureType.TEXTURE_3D&&(a=Math.max(a,o)),Math.floor(Math.log2(a))+1},e.deriveInternalFormat=function(e){if(null!=e.internalFormat)return e.internalFormat;switch(e.dataType){case i.PixelType.FLOAT:switch(e.pixelFormat){case i.PixelFormat.RGBA:return i.SizedPixelFormat.RGBA32F;case i.PixelFormat.RGB:return i.SizedPixelFormat.RGB32F;default:throw new t("texture:unknown-format","Unable to derive format")}case i.PixelType.UNSIGNED_BYTE:switch(e.pixelFormat){case i.PixelFormat.RGBA:return i.SizedPixelFormat.RGBA8;case i.PixelFormat.RGB:return i.SizedPixelFormat.RGB8}}const{pixelFormat:r}=e;return e.internalFormat=r===i.UnsizedDepthFormat.DEPTH_STENCIL?i.SizedDepthStencilFormat.DEPTH24_STENCIL8:r===i.UnsizedDepthFormat.DEPTH_COMPONENT?i.SizedDepthFormat.DEPTH_COMPONENT24:r,e.internalFormat},e.getDimensions=function(e){let t="width"in e?e.width:e.codedWidth,r="height"in e?e.height:e.codedHeight;return e instanceof HTMLVideoElement&&(t=e.videoWidth,r=e.videoHeight),{width:t,height:r,depth:1}},e.is3DTarget=function(e){return e===i.TextureType.TEXTURE_3D||e===i.TextureType.TEXTURE_2D_ARRAY},e.isArrayBufferView=l,e.isCompressedData=c,e.isCompressedFormat=s,e.isCompressedTexture=function(e){return s(e.descriptor.internalFormat)},e.isSizedDepthFormat=a,e.isSizedDepthStencilFormat=n,e.isSizedPixelFormat=function(e){return e in i.SizedPixelFormat},e.isTexImageSource=function(e){return null!=e&&!c(e)&&!l(e)},e.validateTexture=function(e){const{width:t,height:r,depth:s}=e;(null!=t&&t<0||null!=r&&r<0||null!=s&&s<0)&&o().error("Negative dimension parameters are not allowed!");const{internalFormat:c}=e;if(c&&(a(c)||n(c))){const{linearFilterDepth:t,compareEnabled:r,samplingMode:a,hasMipmap:n}=e;n&&o().error("Depth textures cannot have mipmaps"),t?a!==i.TextureSamplingMode.LINEAR&&a!==i.TextureSamplingMode.NEAREST&&o().error("Depth textures cannot sample mipmaps"):(a!==i.TextureSamplingMode.NEAREST&&o().error("Depth textures without filtering must use NEAREST filtering"),r&&o().error("Depth textures without filtering cannot use compare function"))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],(function(e,t,r){"use strict";class i extends r.TextureDescriptor{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case t.SizedPixelFormat.R16F:case t.SizedPixelFormat.R32F:case t.SizedPixelFormat.R8_SNORM:case t.SizedPixelFormat.R8:this.pixelFormat=t.PixelFormat.RED;break;case t.SizedPixelFormat.R8I:case t.SizedPixelFormat.R8UI:case t.SizedPixelFormat.R16I:case t.SizedPixelFormat.R16UI:case t.SizedPixelFormat.R32I:case t.SizedPixelFormat.R32UI:this.pixelFormat=t.PixelFormat.RED_INTEGER}}static validate(e,t){return new i(e,t)}}e.ValidatedTextureDescriptor=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/Program":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./ShaderTranspiler"],(function(e,t,r,i,o){"use strict";function a(e,t,o){const a=e.gl,n=a.createShader(t);return a.shaderSource(n,o),a.compileShader(n),r.webglValidateShadersEnabled()&&!a.getShaderParameter(n,a.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===i.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(a.getShaderInfoLog(n)),console.error(function(e){let t=2;return e.replaceAll("\n",(()=>{return"\n"+((e=t++)>=1e3?e.toString():("  "+e).slice(-3))+":";var e}))}(o))),n}function n(e,t,r){const i=e.get(t);if(!i)return e.set(t,Array.from(r)),!0;const o=r.length;if(i.length!==o)return e.set(t,Array.from(r)),!0;for(let e=0;e<o;++e){const t=r[e];if(i[e]!==t){for(i[e]=t;e<o;++e)i[e]=r[e];return!0}}return!1}const s={enabled:!1},c=r.webglDebugEnabled()?(...e)=>l(e):()=>{},l=r.webglDebugEnabled()?e=>{const t=e.length;for(let r=0;r<t;++r){const t=e[r];Number.isNaN(t)&&console.error(`Got ${t} as uniform value from ${(new Error).stack}`)}}:()=>{};e.Program=class{constructor(e,t,n,c,l=new Map,_=[]){this._context=e,this._locations=c,this._uniformBlockBindings=l,this._transformFeedbackVaryings=_,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),0===t.length&&console.error("Shaders source should not be empty!"),t=o.transpileShader(t,i.ShaderType.VERTEX_SHADER),n=o.transpileShader(n,i.ShaderType.FRAGMENT_SHADER),this._vShader=a(this._context,i.ShaderType.VERTEX_SHADER,t),this._fShader=a(this._context,i.ShaderType.FRAGMENT_SHADER,n),s.enabled&&(this._linesOfCode=t.match(/\n/g).length+n.match(/\n/g).length+2,this._context.instanceCounter.increment(i.ResourceType.LinesOfCode,this._vShader,this._linesOfCode)),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(i.ResourceType.Shader,this),r.webglValidateShadersEnabled()&&(this.vertexShader=t,this.fragmentShader=n),this.usedMemory=t.length+n.length;const u=this._context.gl,h=u.createProgram();u.attachShader(h,this._vShader),u.attachShader(h,this._fShader),this._locations.forEach(((e,t)=>u.bindAttribLocation(h,e,t))),this._transformFeedbackVaryings?.length&&u.transformFeedbackVaryings(h,this._transformFeedbackVaryings,u.SEPARATE_ATTRIBS),u.linkProgram(h),r.webglValidateShadersEnabled()&&!u.getProgramParameter(h,u.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${u.getProgramParameter(h,u.VALIDATE_STATUS)}, gl error ${u.getError()}, vertex: ${u.getShaderParameter(this._vShader,u.COMPILE_STATUS)}, fragment: ${u.getShaderParameter(this._fShader,u.COMPILE_STATUS)}, info log: ${u.getProgramInfoLog(h)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[e,t]of this._uniformBlockBindings){const r=u.getUniformBlockIndex(h,e);r<4294967295&&u.uniformBlockBinding(h,r,t)}this._glName=h,this._context.instanceCounter.increment(i.ResourceType.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){return!!this._compiled||(this._context.capabilities.parallelShaderCompile&&null!=this.glName?(this._compiled=!!this._context.gl.getProgramParameter(this.glName,i.Extension.COMPLETION_STATUS_KHR),this._compiled):(this._compiled=!0,!0))}dispose(){if(--this._refCount>0)return;const e=this._context.gl,t=this._context.instanceCounter;this._nameToUniformLocation.forEach((e=>e&&t.decrement(i.ResourceType.Uniform,e))),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(t.decrement(i.ResourceType.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,t.decrement(i.ResourceType.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,t.decrement(i.ResourceType.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const t=this._nameToUniformLocation.get(e);if(void 0!==t)return t;if(this.glName){const t=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,t),t&&this._context.instanceCounter.increment(i.ResourceType.Uniform,t),t}return null}hasUniform(e){return null!=this._getUniformLocation(e)}setUniform1i(e,t){c(t);const r=this._nameToUniform1.get(e);void 0!==r&&t===r||(this._context.gl.uniform1i(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1iv(e,t){l(t),n(this._nameToUniform1v,e,t)&&this._context.gl.uniform1iv(this._getUniformLocation(e),t)}setUniform2iv(e,t){l(t),n(this._nameToUniform2,e,t)&&this._context.gl.uniform2iv(this._getUniformLocation(e),t)}setUniform3iv(e,t){l(t),n(this._nameToUniform3,e,t)&&this._context.gl.uniform3iv(this._getUniformLocation(e),t)}setUniform4iv(e,t){l(t),n(this._nameToUniform4,e,t)&&this._context.gl.uniform4iv(this._getUniformLocation(e),t)}setUniform1f(e,t){c(t);const r=this._nameToUniform1.get(e);void 0!==r&&t===r||(this._context.gl.uniform1f(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1fv(e,t){l(t),n(this._nameToUniform1v,e,t)&&this._context.gl.uniform1fv(this._getUniformLocation(e),t)}setUniform2f(e,t,r){c(t,r);const i=this._nameToUniform2.get(e);void 0===i?(this._context.gl.uniform2f(this._getUniformLocation(e),t,r),this._nameToUniform2.set(e,[t,r])):t===i[0]&&r===i[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),t,r),i[0]=t,i[1]=r)}setUniform2fv(e,t){l(t),n(this._nameToUniform2,e,t)&&this._context.gl.uniform2fv(this._getUniformLocation(e),t)}setUniform3f(e,t,r,i){c(t,r,i);const o=this._nameToUniform3.get(e);void 0===o?(this._context.gl.uniform3f(this._getUniformLocation(e),t,r,i),this._nameToUniform3.set(e,[t,r,i])):t===o[0]&&r===o[1]&&i===o[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),t,r,i),o[0]=t,o[1]=r,o[2]=i)}setUniform3fv(e,t){l(t);const r=this._getUniformLocation(e);null!=r&&n(this._nameToUniform3,e,t)&&this._context.gl.uniform3fv(r,t)}setUniform4f(e,t,r,i,o){c(t,r,i,o);const a=this._nameToUniform4.get(e);void 0===a?(this._context.gl.uniform4f(this._getUniformLocation(e),t,r,i,o),this._nameToUniform4.set(e,[t,r,i,o])):void 0!==a&&t===a[0]&&r===a[1]&&i===a[2]&&o===a[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),t,r,i,o),a[0]=t,a[1]=r,a[2]=i,a[3]=o)}setUniform4fv(e,t){l(t);const r=this._getUniformLocation(e);null!=r&&n(this._nameToUniform4,e,t)&&this._context.gl.uniform4fv(r,t)}setUniformMatrix3fv(e,t,r=!1){l(t);const i=this._getUniformLocation(e);null!=i&&n(this._nameToUniformMatrix3,e,t)&&this._context.gl.uniformMatrix3fv(i,r,t)}setUniformMatrix4fv(e,t,r=!1){l(t);const i=this._getUniformLocation(e);null!=i&&n(this._nameToUniformMatrix4,e,t)&&this._context.gl.uniformMatrix4fv(i,r,t)}stop(){}},e.test=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/ShaderTranspiler":function(){define(["exports","../../core/has","./enums","./reservedWordsGLSL3","./testUtils"],(function(e,t,r,i,o){"use strict";const a=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","uvec2","uvec3","uvec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","usampler1D","usampler2D","usampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],n=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],s=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var c=999,l=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];const _=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function u(e,t){for(let r=t-1;r>=0;r--){const t=e[r];if("whitespace"!==t.type&&"block-comment"!==t.type){if("keyword"!==t.type)break;if("attribute"===t.data||"in"===t.data)return!0}}return!1}function h(e,t,r,i){i=i||r;for(const o of e)if("ident"===o.type&&o.data===r)return i in t?t[i]++:t[i]=0,h(e,t,i+"_"+t[i],i);return r}function d(e,t,r="afterVersion"){function i(e,t){for(let r=t;r<e.length;r++){const t=e[r];if("operator"===t.type&&";"===t.data)return r}return null}const o={data:"\n",type:"whitespace"},a=t=>t<e.length&&/[^\r\n]$/.test(e[t].data);let n=function(e){let t=-1,o=0,a=-1;for(let n=0;n<e.length;n++){const s=e[n];if("preprocessor"===s.type&&(/#(if|ifdef|ifndef)\s+.+/.test(s.data)?++o:/#endif\s*.*/.test(s.data)&&--o),"afterVersion"!==r&&"afterPrecision"!==r||"preprocessor"===s.type&&s.data.startsWith("#version")&&(a=Math.max(a,n)),"afterPrecision"===r&&"keyword"===s.type&&"precision"===s.data){const t=i(e,n);if(null===t)throw new Error("precision statement not followed by any semicolons!");a=Math.max(a,t)}t<a&&0===o&&(t=n)}return t+1}(e);a(n-1)&&e.splice(n++,0,o);for(const r of t)e.splice(n++,0,r);a(n-1)&&a(n)&&e.splice(n,0,o)}function m(e,t,r,i="lowp"){d(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function T(e,t,r,i,o="lowp"){d(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:o},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function E(e,t){let r,i,o=-1;for(let a=t;a<e.length;a++){const t=e[a];if("operator"===t.type&&("["===t.data&&(r=a),"]"===t.data)){i=a;break}"integer"===t.type&&(o=parseInt(t.data,10))}return r&&i&&e.splice(r,i-r+1),o}const f=new Map;e.transpileShader=function(e,t){if(e.startsWith("#version 300"))return e;const d=function(e){return o.shaderTranspiler.enableCache?f.get(e):null}(e);if(null!=d)return d;const p=function(e){return t=e,r=function(){var e,t,r,i=0,o=0,_=c,u=[],h=[],d=1,m=0,T=0,E=!1,f=!1,p="";return function(t){return h=[],null!==t?function(t){var a;for(i=0,r=(p+=t).length;e=p[i],i<r;){switch(a=i,_){case 0:i=x();break;case 1:case 2:i=A();break;case 3:i=D();break;case 4:i=b();break;case 11:i=N();break;case 5:i=M();break;case 9999:i=P();break;case 9:i=g();break;case c:i=S()}a!==i&&("\n"===p[a]?(m=0,++d):++m)}return o+=i,p=p.slice(i),h}(t.replace?t.replace(/\r\n/g,"\n"):t):(u.length&&R(u.join("")),_=10,R("(eof)"),h)};function R(e){e.length&&h.push({type:l[_],data:e,position:T,line:d,column:m})}function S(){return u=u.length?[]:u,"/"===t&&"*"===e?(T=o+i-1,_=0,t=e,i+1):"/"===t&&"/"===e?(T=o+i-1,_=1,t=e,i+1):"#"===e?(_=2,T=o+i,i):/\s/.test(e)?(_=9,T=o+i,i):(E=/\d/.test(e),f=/[^\w_]/.test(e),T=o+i,_=E?4:f?3:9999,i)}function g(){return/[^\s]/g.test(e)?(R(u.join("")),_=c,i):(u.push(e),t=e,i+1)}function A(){return"\r"!==e&&"\n"!==e||"\\"===t?(u.push(e),t=e,i+1):(R(u.join("")),_=c,i)}function x(){return"/"===e&&"*"===t?(u.push(e),R(u.join("")),_=c,i+1):(u.push(e),t=e,i+1)}function D(){if("."===t&&/\d/.test(e))return _=5,i;if("/"===t&&"*"===e)return _=0,i;if("/"===t&&"/"===e)return _=1,i;if("."===e&&u.length){for(;F(u););return _=5,i}if(";"===e||")"===e||"("===e){if(u.length)for(;F(u););return R(e),_=c,i+1}var r=2===u.length&&"="!==e;if(/[\w_\d\s]/.test(e)||r){for(;F(u););return _=c,i}return u.push(e),t=e,i+1}function F(e){for(var t,r,i=0;;){if(t=n.indexOf(e.slice(0,e.length+i).join("")),r=n[t],-1===t){if(i--+e.length>0)continue;r=e.slice(0,1).join("")}return R(r),T+=r.length,(u=u.slice(r.length)).length}}function N(){return/[^a-fA-F0-9]/.test(e)?(R(u.join("")),_=c,i):(u.push(e),t=e,i+1)}function b(){return"."===e||/[eE]/.test(e)?(u.push(e),_=5,t=e,i+1):"x"===e&&1===u.length&&"0"===u[0]?(_=11,u.push(e),t=e,i+1):/[^\d]/.test(e)?(R(u.join("")),_=c,i):(u.push(e),t=e,i+1)}function M(){return"f"===e&&(u.push(e),t=e,i+=1),/[eE]/.test(e)||"-"===e&&/[eE]/.test(t)?(u.push(e),t=e,i+1):/[^\d]/.test(e)?(R(u.join("")),_=c,i):(u.push(e),t=e,i+1)}function P(){if(/[^\d\w_]/.test(e)){var r=u.join("");return _=a.indexOf(r)>-1?8:s.indexOf(r)>-1?7:6,R(u.join("")),_=c,i}return u.push(e),t=e,i+1}}(),[].concat(r(t)).concat(r(null));var t,r}(e);if("300 es"===function(e,t="100",r="300 es"){const i=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const o of e)if("preprocessor"===o.type){const e=i.exec(o.data);if(e){const i=e[1].replaceAll(/\s{2,}/g," ");if(i===r)return i;if(i===t)return o.data="#version "+r,t;throw new Error("unknown glsl version: "+i)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:"\n"}),null}(p,"100","300 es"))return e;let R=null,S=null;const g={},A={};for(let e=0;e<p.length;++e){const o=p[e];switch(o.type){case"keyword":t===r.ShaderType.VERTEX_SHADER&&"attribute"===o.data?o.data="in":"varying"===o.data&&(o.data=t===r.ShaderType.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(o.data.trim())&&(o.data=o.data.replaceAll(/(2D|Cube|EXT)/g,"")),t===r.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===o.data&&(R||(R=h(p,g,"fragColor"),m(p,R,"vec4")),o.data=R),t===r.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===o.data){const t=E(p,e+1),r=h(p,g,"fragData");T(p,r,"vec4",t,"mediump"),o.data=r}else t===r.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===o.data&&(S||(S=h(p,g,"gl_FragDepth")),o.data=S);break;case"ident":if(i.includes(o.data)){if(t===r.ShaderType.VERTEX_SHADER&&u(p,e))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");o.data in A||(A[o.data]=h(p,g,o.data)),o.data=A[o.data]}}}for(let e=p.length-1;e>=0;--e){const t=p[e];if("preprocessor"===t.type){const r=t.data.match(/#extension\s+(.*):/);if(r?.[1]&&_.has(r[1].trim())){const t=p[e+1];p.splice(e,t&&"whitespace"===t.type?2:1)}const i=t.data.match(/#ifdef\s+(.*)/);i?.[1]&&_.has(i[1].trim())&&(t.data="#if 1");const o=t.data.match(/#ifndef\s+(.*)/);o?.[1]&&_.has(o[1].trim())&&(t.data="#if 0")}}return function(e,t){return o.shaderTranspiler.enableCache&&f.set(e,t),t}(e,function(e){return e.map((e=>"eof"!==e.type?e.data:"")).join("")}(p))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/reservedWordsGLSL3":function(){define((function(){"use strict";return["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]}))},"esri/views/webgl/testUtils":function(){define(["exports"],(function(e){"use strict";e.shaderTranspiler={enableCache:!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/ProgramCache":function(){define(["exports","../../core/has","../../core/NestedMap","./Program"],(function(e,t,r,i){"use strict";e.ProgramCache=class{constructor(e){this._rctx=e,this._store=new r.NestedMap}dispose(){this._store.forAll((e=>e.dispose())),this._store.clear()}acquire(e,t,r,o){const a=this._store.get(e,t);if(null!=a)return a.ref(),a;const n=new i.Program(this._rctx,e,t,r,o);return n.ref(),this._store.set(e,t,n),n}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/NestedMap":function(){define(["exports"],(function(e){"use strict";e.NestedMap=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get outerSize(){return this._outer.size}get(e,t){return this._outer.get(e)?.get(t)}getInner(e){return this._outer.get(e)}set(e,t,r){const i=this._outer.get(e);i?i.set(t,r):this._outer.set(e,new Map([[t,r]]))}delete(e,t){const r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,r)=>e(t,r)))}forAll(e){this._outer.forEach(((t,r)=>t.forEach(((t,i)=>e(t,r,i)))))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/ShaderCompiler":function(){define(["exports"],(function(e){"use strict";e.ShaderCompiler=class{constructor(e){this._readFile=e}resolveIncludes(e){return this._resolve(e)}_resolve(e,t=new Map){if(t.has(e))return t.get(e);const r=this._read(e);if(!r)throw new Error(`cannot find shader file ${e}`);const i=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let o=i.exec(r);const a=[];for(;null!=o;)a.push({path:o[1],start:o.index,length:o[0].length}),o=i.exec(r);let n=0,s="";return a.forEach((e=>{s+=r.slice(n,e.start),s+=t.has(e.path)?"":this._resolve(e.path,t),n=e.start+e.length})),s+=r.slice(n),t.set(e,s),s}_read(e){return this._readFile(e)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/VertexArrayObject":function(){define(["exports","../../core/Logger","../../core/maybe","../../core/memoryEstimations","./enums","./Util"],(function(e,t,r,i,o,a){"use strict";const n=()=>t.getLogger("esri.views.webgl.VertexArrayObject");e.VertexArrayObject=class{constructor(e,t,r,i,o=null){this._context=e,this._locations=t,this._layout=r,this._buffers=i,this._indexBuffer=o,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}getByteLength(e){return this._buffers.get(e)?.usedMemory??0}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return Array.from(this._buffers.values()).reduce(((e,t)=>e+t.usedMemory),this._indexBuffer?.usedMemory??0+(this._buffers.size+(this._indexBuffer?1:0))*i.baseTypedArrayMemory)}get cachedMemory(){return this.usedMemory}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this._indexBuffer=r.disposeMaybe(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&n().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.ResourceType.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(o.ResourceType.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:r}=this;e||n().error("Vertex buffer dictionary is empty!");const i=this._context.gl;this._buffers.forEach(((e,r)=>{const i=t.get(r);i?a.bindVertexBufferLayout(this._context,this._locations,e,i):n().error("Vertex element descriptor is empty!")})),null!=r&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/programUtils":function(){define(["exports"],(function(e){"use strict";function t(e){const{options:t,value:r}=e;return"number"==typeof t[r]}e.glslifyDefineMap=function(e){let r="";for(const i in e){const o=e[i];if("boolean"==typeof o)o&&(r+=`#define ${i}\n`);else if("number"==typeof o)r+=`#define ${i} ${o.toFixed()}\n`;else if("object"==typeof o)if(t(o)){const{value:e,options:t,namespace:a}=o,n=a?`${a}_`:"";for(const e in t)r+=`#define ${n}${e} ${t[e].toFixed()}\n`;r+=`#define ${i} ${n}${e}\n`}else{const e=o.options;let t=0;for(const i in e)r+=`#define ${e[i]} ${(t++).toFixed()}\n`;r+=`#define ${i} ${e[o.value]}\n`}}return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/ProgramTemplate":function(){define(["exports","./Program"],(function(e,t){"use strict";e.createProgram=function(e,r,i=""){return new t.Program(e,i+r.shaders.vertexShader,i+r.shaders.fragmentShader,r.attributes)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"*noref":1}}),define(["exports","../webgl/BufferObject","../webgl/FramebufferObject","../webgl/Program","../webgl/ProgramCache","../webgl/Renderbuffer","../webgl/ShaderCompiler","../webgl/Texture","../webgl/VertexArrayObject","../webgl/programUtils","../webgl/ProgramTemplate"],(function(e,t,r,i,o,a,n,s,c,l,_){"use strict";e.BufferObject=t.BufferObject,e.FramebufferObject=r.FramebufferObject,e.Program=i.Program,e.ProgramCache=o.ProgramCache,e.Renderbuffer=a.Renderbuffer,e.ShaderCompiler=n.ShaderCompiler,e.Texture=s.Texture,e.VertexArrayObject=c.VertexArrayObject,e.glslifyDefineMap=l.glslifyDefineMap,e.createProgram=_.createProgram,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));