// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../analysis/dimensionUtils","../../../../core/has","../../../../chunks/vec32","../../../../geometry/Point","../../../../geometry/support/vectorStacks","./lengthDimensionManipulatorUtils","./lengthDimensionUtils","./settings"],(function(n,e,t,i,o,r,a,s,l){"use strict";var d;function c(t,i,o){const{constraint:r,elevationAlignedStartPoint:s,elevationAlignedEndPoint:l,unconstrainedGeometry:d,view:c}=o,{dimension:u,previousConstraint:m,preConstraintProperties:g}=t;if(null==s||null==l)return;const P=()=>{"startPoint"in i?u.startPoint=i.startPoint:"endPoint"in i&&(u.endPoint=i.endPoint)};if(null==r)P(),null!=m&&null!=g&&(u.measureType=g.measureType,u.orientation=g.orientation);else switch(u.measureType=e.LengthDimensionMeasureType.Direct,r){case n.LengthDimensionConstraint.Horizontal:if(r!==m&&(u.orientation=0),"startPoint"in i){const n=i.startPoint;null!=n&&(n.z=l.z),u.startPoint=n}else if("endPoint"in i){const n=i.endPoint;null!=n&&(n.z=s.z),u.endPoint=n}break;case n.LengthDimensionConstraint.Vertical:if(r!==m&&(u.orientation=a.automaticHeadingFromCamera(d,c)),"startPoint"in i){const n=i.startPoint;null!=n&&(n.x=l.x,n.y=l.y),u.startPoint=n}else if("endPoint"in i){const n=i.endPoint;null!=n&&(n.x=s.x,n.y=s.y),u.endPoint=n}break;case n.LengthDimensionConstraint.Direct:r!==m&&null!=g&&(u.orientation=g.orientation),P()}t.previousConstraint=r,t.unconstrainedGeometry=d}n.LengthDimensionConstraint=void 0,(d=n.LengthDimensionConstraint||(n.LengthDimensionConstraint={}))[d.Horizontal=0]="Horizontal",d[d.Vertical=1]="Vertical",d[d.Direct=2]="Direct",n.applyConstraint=c,n.computeConstraint=function(e,t){if(s.isGeodesicDimension(e))return n.LengthDimensionConstraint.Direct;if(!e.enabled)return null;const{geometry:o}=e;if(null==o||i.exactEquals(o.directSegment.startRenderSpace,o.directSegment.endRenderSpace))return null;const{camera:a}=t.state,d=s.directUp(r.sv3d.get(),o,t.renderCoordsHelper),c=s.directStartToEnd(r.sv3d.get(),o),u=i.scale(r.sv3d.get(),d,i.dot(c,d)),m=i.subtract(r.sv3d.get(),c,u),g=i.squaredLength(m),P=i.squaredLength(u),{startRenderSpace:p,endRenderSpace:v}=o.directSegment,f=Math.max(a.computeScreenPixelSizeAt(p)*l.constraintThresholdPx,a.computeScreenPixelSizeAt(v)*l.constraintThresholdPx)**2;return g<f?n.LengthDimensionConstraint.Vertical:P<f?n.LengthDimensionConstraint.Horizontal:null},n.constraintDependencies=function(n,e){return{enabled:e.effectiveFeatureEnabled,elevationAlignedStartPoint:n.elevationAlignedStartPoint,elevationAlignedEndPoint:n.elevationAlignedEndPoint,geometry:n.geometry}},n.reapplyConstraint=function(n,e,{constraint:t,view:i}){const{unconstrainedGeometry:r}=n;if(null==r)return;const{renderCoordsHelper:a,spatialReference:s}=i,{startRenderSpace:l,endRenderSpace:d}=r.directSegment,u=a.fromRenderCoords(l,new o({spatialReference:s})),m=a.fromRenderCoords(d,new o({spatialReference:s}));let g;g="start"===e?{startPoint:u}:{endPoint:m},c(n,g,{constraint:t,elevationAlignedStartPoint:n.elevationAlignedStartPoint,elevationAlignedEndPoint:n.elevationAlignedEndPoint,unconstrainedGeometry:r,view:i})},Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})}));