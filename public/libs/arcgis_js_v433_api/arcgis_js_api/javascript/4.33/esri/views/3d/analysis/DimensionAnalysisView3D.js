// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/handleUtils","../../../core/has","../../../core/Logger","../../../core/mapCollectionUtils","../../../core/maybe","../../../core/accessorSupport/decorators/property","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./AnalysisView3D","./Dimension/DimensionController","./Dimension/DimensionTool","./Dimension/DimensionVisualization","./Dimension/LengthDimensionComputation","./support/projectionUtils","../../analysis/analysisViewUtils","../../support/automaticLengthMeasurementUtils"],(function(e,t,i,o,s,n,a,r,l,p,c,u,d,m,y,h,_,g){"use strict";let D=class extends(c.AnalysisView3D(t)){constructor(e){super(e),this.type="dimension-view-3d",this.analysis=null,this.tool=null,this.selectedDimension=null,this.userOperation=null,this._dimensionsToComputations=new Map,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(null==e)return null;const{spatialReference:t,elevationProvider:i}=this.view,o=h.applyProjectionAndElevationAlignment(e,t,i);return null==o&&h.logFailedGeometryProjectionError(this.analysis,e.spatialReference,s.getLogger(this)),o};const e=n.mapCollection((()=>this.analysis.dimensions),(e=>this._createComputation(e)));this.computations=e,this.addHandles([_.connectAnalysisViewToTool(this,d.DimensionTool),i.destroyHandle(e)]),this._analysisVisualization=new m.DimensionVisualization({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this.addResolvingPromise(g.loadAutomaticLengthMeasurementUtils().then((e=>{this._analysisController=new u.DimensionController({analysisViewData:this,view:this.view,automaticLengthMeasurementUtils:e})})))}destroy(){this.userOperation=a.abortMaybe(this.userOperation),_.removeAnalysisViewTool(this),this._analysisVisualization=a.destroyMaybe(this._analysisVisualization)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return null==e?null:this._dimensionsToComputations.get(e)}get testInfo(){}async createLengthDimensions(e){this.selectedDimension=null,await _.startPlaceOperation(this,{placementOptions:e,onToolActivated:e=>e.place("multiple")})}place(e){return this.selectedDimension=null,_.startPlaceOperation(this,{placementOptions:e,onToolActivated:e=>e.place("single")})}_createComputation(e){const{_dimensionsToComputations:t}=this,i=new y.LengthDimensionComputation({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return t.set(e,i),{computation:i,remove:()=>this._removeComputation(i)}}_removeComputation(e){const{dimension:t}=e;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}};return e.__decorate([r.property({readOnly:!0})],D.prototype,"type",void 0),e.__decorate([r.property({constructOnly:!0,nonNullable:!0})],D.prototype,"analysis",void 0),e.__decorate([r.property()],D.prototype,"tool",void 0),e.__decorate([r.property()],D.prototype,"updating",null),e.__decorate([r.property({readOnly:!0})],D.prototype,"results",null),e.__decorate([r.property()],D.prototype,"computations",void 0),e.__decorate([r.property()],D.prototype,"selectedDimension",void 0),e.__decorate([r.property()],D.prototype,"selectedComputation",null),e.__decorate([r.property()],D.prototype,"userOperation",void 0),e.__decorate([r.property()],D.prototype,"_analysisVisualization",void 0),e.__decorate([r.property()],D.prototype,"_analysisController",void 0),e.__decorate([r.property()],D.prototype,"_dimensionsToComputations",void 0),D=e.__decorate([p.subclass("esri.views.3d.analysis.DimensionAnalysisView3D")],D),D}));