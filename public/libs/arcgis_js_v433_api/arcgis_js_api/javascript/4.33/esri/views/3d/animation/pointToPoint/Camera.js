// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../ViewingMode","../../support/mathUtils"],(function(t,e,i,s,a,o,c,n){"use strict";const r=o.create(),h=o.create(),_=o.create(),l=o.create(),p=o.create(),d=o.create(),m=o.UNIT_Z,M=o.UNIT_Y,g=o.UNIT_X,f=s.create();t.Camera=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(t){this.viewingMode=t,this.center=o.create(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=o.clone(M),this._fov=55,this._size=1}pixelsPerPanAtZoom(t){return this._size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this._size/2/(this._zoomToPanScale*t)}pixelsPerRotate(){const t=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/t}compareTo(t,e){if(this.viewingMode===c.ViewingMode.Global){const i=(a.length(this.center)+a.length(t.center))/2;e.pan=n.angle(this.center,t.center)*i}else e.pan=a.distance(this.center,t.center);let i=Math.abs(t._yaw-this._yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(t._pitch-this._pitch);e.rotate=Math.max(i,s),e.fov=t.fov-this.fov,e.sourceZoom=this._distance,e.targetZoom=t._distance}interpolate(t,i,s){this.viewingMode===c.ViewingMode.Global?n.slerp(t.center,i.center,s.pan,this.center):a.lerp(this.center,t.center,i.center,s.pan),this._distance=isFinite(i.distance)?e.lerp(t.distance,i.distance+s.zoomOffset,s.zoom):t.distance,this._pitch=e.lerp(t.pitch,i.pitch,s.rotate);let o=t._yaw;const r=i._yaw;Math.abs(r-o)>=Math.PI&&(o+=2*(o<r?1:-1)*Math.PI),this._yaw=e.lerp(o,r,s.rotate),this._fov=e.lerp(t.fov,i.fov,s.fov)}copyFrom(t){a.copy(this.center,t.center),this._pitch=t.pitch,this._yaw=t.yaw,this._distance=t.distance,a.copy(this.direction,t.direction),this._size=t.size,this._fov=t.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const e=this._lookAtOrientation(t.center,f);var i;a.copy(this.center,t.center),a.subtract(l,t.center,t.eye),a.transformMat3(l,l,e),a.transformMat3(p,t.up,e),this._distance=a.length(l),0!==this._distance&&(l[0]/=this._distance,l[1]/=this._distance,l[2]/=this._distance),this._pitch=(i=l,Math.PI-n.angle(m,i)),this._yaw=function(t,e){const i=d;return Math.abs(e[2])<.5?(a.copy(i,e),t[2]>0&&a.scale(i,i,-1)):a.copy(i,t),a.cross(h,i,m),a.normalize(h,h),n.angle(g,h,m)}(l,p),this._size=Math.sqrt(t.width*t.width+t.height*t.height),this._fov=t.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(t){const e=this._lookAtOrientation(this.center,f);i.transpose(e,e),this._axisAngleVec3(g,this._pitch-Math.PI/2,M,l),this._axisAngleVec3(m,this._yaw,l,l),this._axisAngleVec3(g,this._pitch-Math.PI/2,m,p),this._axisAngleVec3(m,this._yaw,p,p),a.scale(l,l,this._distance),a.transformMat3(l,l,e),a.transformMat3(p,p,e),t.center=this.center,t.eye=a.subtract(l,this.center,l),t.up=p,t.fov=this._fov}_axisAngleVec3(t,e,i,s){const o=Math.cos(e),c=Math.sin(e);return a.scale(r,i,o),a.cross(h,t,i),a.scale(h,h,c),a.scale(_,t,(1-o)*a.dot(t,i)),a.add(s,a.add(s,r,h),_)}_lookAtOrientation(t,e=s.create()){return this._upAtLookAt(t,_),a.cross(r,this.direction,_),a.normalize(r,r),0===r[0]&&0===r[1]&&0===r[2]&&a.copy(r,g),a.cross(h,_,r),a.normalize(h,h),e[0]=r[0],e[1]=h[0],e[2]=_[0],e[3]=r[1],e[4]=h[1],e[5]=_[1],e[6]=r[2],e[7]=h[2],e[8]=_[2],e}_upAtLookAt(t,e){return this.viewingMode===c.ViewingMode.Local?a.copy(e,m):a.normalize(e,t)}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));