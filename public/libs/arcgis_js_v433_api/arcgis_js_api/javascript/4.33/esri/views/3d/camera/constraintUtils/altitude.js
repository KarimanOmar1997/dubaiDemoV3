// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/ray","./common","./ConstraintTypes","./InteractionType","../../support/intersectionUtils"],(function(t,e,n,r,i,o,a,s,c){"use strict";function u(t,n,r=o.defaultConstraintOptions){if(!function(t,e){const n=t.state.constraints.altitude;return!(!t.state.isGlobal||!n||e.interactionType===s.InteractionType.TUMBLE&&o.hasConstraintType(e.selection,a.ConstraintTypes.TILT))}(t,r)||!t.state.constraints.altitude)return 0;const i=function(t,e){return e.min=t.min,e.max=t.max,e}(t.state.constraints.altitude,l);!function(t,e,n){const r=e.interactionType;if(r===s.InteractionType.NONE)return;const{min:i,max:a}=n,{interactionStartCamera:c,interactionFactor:l}=e;if(!c)return;const p=r===s.InteractionType.TUMBLE||r===s.InteractionType.ZOOM,d=u(t,c),y=0===d?0:t.renderCoordsHelper.getAltitude(c.eye);n.min=i,n.max=a;const m=.05*y;o.adjustRangeForInteraction(d,y,p,l,m,n)}(t,r,i);const c=t.renderCoordsHelper.getAltitude(n.eye),p=e.clamp(c,i.min,i.max)-c;return Math.abs(p)<=1e-6?0:p}const l={min:0,max:0},p=r.create(),d=r.create(),y=r.create(),m=r.create();t.applyAltitudeConstraint=function(t,e,r=o.defaultConstraintOptions){const a=u(t,e,r);if(0===a)return!1;const s=t.renderCoordsHelper,l=s.getAltitude(e.eye)+a,f=o.interactionDirectionTowardsConstraintMinimization(e,r.interactionDirection,function(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),n.scale(i,i,r),i}(t,e,Math.sign(a),d),p),T=n.copy(y,e.viewForward),C=s.intersectInfiniteManifold(i.wrap(e.eye,f),l,m);return e.eye=null!=C?C:s.setAltitude(m,l,e.eye),e.center=c.closestPointOnRay(m,e.eye,T,e.center),!0},t.getAltitudeConstraintError=u,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));