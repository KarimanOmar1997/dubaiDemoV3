// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/tslib.es6","../../../core/maybe","../../../core/reactiveUtils","../../../core/Logger","../../../core/has","../../../core/RandomLCG","../../../core/Error","../../../core/accessorSupport/decorators/subclass","../../../core/libs/gl-matrix-2/math/mat4","../../../core/libs/gl-matrix-2/factories/mat4f64","../webgl","../../../chunks/SimpleAtmosphere.glsl","./SimpleAtmosphereTechnique","./SimpleAtmosphereTechniqueConfiguration","./resources/SimpleAtmosphereTexture","../support/buffer/glUtil","../support/buffer/InterleavedLayout","../webgl-engine/effects/OpaqueEnvironment","../webgl-engine/lib/basicInterfaces","../webgl-engine/lib/DefaultVertexAttributeLocations","../webgl-engine/lib/GeometryUtil","../webgl-engine/lib/VertexArrayObject","../webgl-engine/lib/VertexAttribute","../../webgl/BufferObject","../../webgl/enums","../../webgl/Texture","../../webgl/TextureDescriptor","../../webgl/Util"],(function(e,t,r,i,s,o,a,n,c,l,u,h,p,m,b,g,f,d,_,w,A,v,x,y,T,P,S,C,L){"use strict";e.LocalAtmosphere=class extends _.OpaqueEnvironment{constructor(){super(...arguments),this._configuration=new b.SimpleAtmosphereTechniqueConfiguration,this._passParameters=new p.SimpleAtmospherePassParameters,this._vao=null,this._vaoCount=0}initialize(){this._configuration.geometry=b.SimpleAtmosphereGeometry.Cylinder,this.addHandles([i.watch((()=>this.view.environment.atmosphereEnabled),(e=>e?this._enable():this._disable()),i.initial)])}destroy(){this._passParameters.texture=r.disposeMaybe(this._passParameters.texture),this._vao=r.disposeMaybe(this._vao)}precompile(){this.techniques.precompile(m.SimpleAtmosphereTechnique,this._configuration)}render(e){const t=e.find((({name:e})=>e===h.InternalRenderCategory.OPAQUE_ENVIRONMENT)),r=this.techniques.get(m.SimpleAtmosphereTechnique,this._configuration);if(!r.compiled)return this.requestRender(w.RenderRequestType.UPDATE),t;const i=this.renderingContext;if(this._vao||(this._vao=function(e){const t=v.createPolySphereData(1,2,!1),{data:r,indices:i}=t[0][1],s=q.createBuffer(i.length),o=s.position;for(let e=0;e<i.length;++e){const t=3*i[e%3==0?e+2:e%3==2?e-2:e];o.set(e,0,r[t]),o.set(e,1,r[t+1]),o.set(e,2,r[t+2])}return new x.VertexArrayObject(e,A.Default3D,new Map([["geometry",f.glLayout(q)]]),new Map([["geometry",T.BufferObject.createVertex(e,P.Usage.STATIC_DRAW,s.buffer)]]))}(i),this._vaoCount=L.vertexCount(this._vao,"geometry")),!this._passParameters.texture){const e=new C.TextureDescriptor;e.wrapMode=P.TextureWrapMode.CLAMP_TO_EDGE,e.flipped=!0,e.width=1,e.height=512,this._passParameters.texture=new S.Texture(i,e,g.earthAtmosphereTextureSimple)}const s=i.bindTechnique(r,this.bindParameters,this._passParameters);var o,a;return o=O,a=this.bindParameters.camera.viewMatrix,l.copy(o,a),o[12]=0,o[13]=0,o[14]=0,o[15]=1,s.setUniformMatrix4fv("view",O),i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(P.PrimitiveType.TRIANGLES,0,this._vaoCount),t}},e.LocalAtmosphere=t.__decorate([c.subclass("esri.views.3d.environment.LocalAtmosphere")],e.LocalAtmosphere);const O=u.create(),q=d.newLayout().vec3f(y.VertexAttribute.POSITION);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));