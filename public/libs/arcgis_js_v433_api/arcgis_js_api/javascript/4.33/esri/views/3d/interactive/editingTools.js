// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/3d/interactive/editingTools/draw/DrawGraphicTool3D":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/colorUtils","../../../../../core/handleUtils","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../support/elevationInfoUtils","../../../../../symbols/support/ElevationInfo","../../SegmentLabels3D","../../SnappingVisualizer3D","../meshFastUpdateUtils","../settings","../../visualElements/ExtendedLineVisualElement","../../visualElements/OutlineVisualElement","../../visualElements/VerticesVisualElement","../../../layers/graphics/elevationAlignmentUtils","../../../layers/graphics/ElevationContext","../../../layers/graphics/GraphicState","../../../webgl-engine/lib/Material","../../../../draw/DrawGraphicTool","../../../../draw/DrawOperation","../../../../draw/drawSurfaces","../../../../interactive/tooltip/tooltipCommonUtils","../../../../../core/accessorSupport/trackingUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C,w,T,D,I,A){"use strict";e.DrawGraphicTool3D=class extends w.DrawGraphicTool{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new y.Settings({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t,unit:i}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new p({mode:e,offset:t,unit:i})}normalizeCtorArgs(e){if(!e.elevationInfo){const t=e.hasZ??!0;return{...e,elevationInfo:d.getEffectiveElevationInfo(t)}}return e}initializeGraphic(e){const{view:t}=this,i=this._createGraphicState=new S.GraphicState({graphic:e});return n.handlesGroup([t.maskOccludee(e),t.trackGraphicState(i),r.watch((()=>({element:this._outlineVisualElement,isDraped:i.isDraped})),(({element:e,isDraped:t})=>{e&&(e.isDraped=t)}),r.syncAndInitial),A.autorun((()=>{I.updateMeshTransformFromTooltipInfo(this.tooltipInfos.mesh,this.geometryToPlace)})),this._setupLoadingIndicator(i),...f.meshTransformFastUpdateHandles(i)])}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new T.DrawOperation({view:this.view,manipulators:this.manipulators,geometryType:w.geometryTypeToDrawOperationGeometryType(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new D.SceneDrawSurface(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new D.ElevationDrawSurface(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new _.SnappingVisualizer3D,segmentLabels:t?new g.SegmentLabels3D:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===d.getEffectiveElevationMode(this.hasZ,this.elevationInfo),cursor:this.cursor,constraintsEnabled:!0,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils})}onActiveVertexChanged(e){const{view:t}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(e),n.makeHandle();const o=this._settings,a=o.manipulators.vertex,l=new P.VerticesVisualElement({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:a.size,outlineSize:a.outlineSize,renderOccluded:a.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=l;const c=o.visualElements.zVerticalLine,h=new x.ExtendedLineVisualElement({view:t,extensionType:c.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:C.RenderOccludedFlag.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=h;const u=n.handlesGroup([r.watch((()=>o.visualElements.zVerticalLine),(e=>e.apply(h)),r.initial),r.watch((()=>({selectedColor:i.unitRGBAFromColor(o.colors.selected),outlineColor:i.unitRGBAFromColor(o.manipulators.vertex.outlineColor)})),(({selectedColor:e,outlineColor:t})=>{l.color=e,l.outlineColor=t}),r.initial),n.makeHandle((()=>{this._activeVertexVisualElement=s.destroyMaybe(this._activeVertexVisualElement),this._verticalLineVisualElement=s.destroyMaybe(this._verticalLineVisualElement)}))]);return l.attached=!0,this._updateVerticalLineVisualElement(e),u}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if(!t)return;const{renderCoordsHelper:i,elevationProvider:n}=this.view;u.set(N,e[0],e[1],e[2]),M.setFromElevationInfo(this.elevationInfo),N[2]=b.evaluateElevationAlignmentAtPoint(N,n,M,i),i.toRenderCoords(N,this.view.spatialReference,N)?(t.setStartEndFromWorldDownAtLocation(N),t.attached=!0):t.attached=!1}onOutlineChanged(e){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,n.makeHandle();const t=this.internalGraphicsLayer.elevationInfo,{view:i}=this,o=this._settings,a=new v.OutlineVisualElement({view:i,geometry:e,elevationInfo:t,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===d.getEffectiveElevationMode(this.hasZ,t),attached:!1,isDecoration:!0});this._outlineVisualElement=a;const l=n.handlesGroup([r.watch((()=>o.visualElements.lineObjects.outline),(e=>e.apply(a)),r.initial),r.watch((()=>o.visualElements.lineObjects.shadowStyle),(e=>e.apply(a)),r.initial),n.makeHandle((()=>{this._outlineVisualElement=s.destroyMaybe(this._outlineVisualElement)}))]);return a.attached=!0,a.laserlineEnabled=!0,l}onRegularVerticesChanged(e){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,n.makeHandle();const{view:t}=this,o=this._settings,a=o.manipulators.vertex,l=new P.VerticesVisualElement({view:t,spatialReference:t.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:a.size,outlineSize:a.outlineSize,renderOccluded:a.renderOccluded,attached:!1,isDecoration:!0}),c=n.handlesGroup([r.watch((()=>({color:i.unitRGBAFromColor(o.manipulators.vertex.color),outlineColor:i.unitRGBAFromColor(o.manipulators.vertex.outlineColor)})),(({color:e,outlineColor:t})=>{l.color=e,l.outlineColor=t}),r.initial),n.makeHandle((()=>{this._verticesVisualElement=s.destroyMaybe(this._verticesVisualElement)}))]);return l.attached=!0,this._verticesVisualElement=l,c}updateGraphicGeometry(e){if("mesh"!==this.geometryType||"point"!==e?.type)super.updateGraphicGeometry(e);else{const t=this.geometryToPlace;t?.centerAt(e),I.updateMeshTransformFromTooltipInfo(this.tooltipInfos.mesh,t);const i=this._graphic;t&&i.geometry===t||(i.geometry=t)}}_setupLoadingIndicator(e){const{drawOperation:t}=this;if(!this.geometryToPlace)return t.loading=!1,null;t.loading=!0;const i=n.makeHandle((()=>{t.loading=!1}));let s;const o=()=>s&&cancelAnimationFrame(s);return n.handlesGroup([r.when((()=>e.displaying),(()=>{o(),s=requestAnimationFrame((()=>i.remove()))}),{...r.syncAndInitial,once:!0}),n.makeHandle(o),i])}},t.__decorate([o.property({constructOnly:!0})],e.DrawGraphicTool3D.prototype,"elevationInfo",void 0),t.__decorate([o.property({constructOnly:!0})],e.DrawGraphicTool3D.prototype,"geometryType",void 0),t.__decorate([o.property()],e.DrawGraphicTool3D.prototype,"type",void 0),t.__decorate([o.property({constructOnly:!0})],e.DrawGraphicTool3D.prototype,"view",void 0),e.DrawGraphicTool3D=t.__decorate([h.subclass("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],e.DrawGraphicTool3D);const M=new E.ElevationContext,N=m.create();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/SegmentLabels3D":function(){define(["exports","../../../chunks/tslib.es6","../../../core/screenUtils","../../../core/Logger","../../../core/has","../../../core/RandomLCG","../../../core/Error","../../../core/accessorSupport/decorators/subclass","../../../core/libs/gl-matrix-2/factories/vec3f64","./support/viewUtils","../../interactive/SegmentLabels"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.SegmentLabels3D=class extends h.SegmentLabels{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:n},s,r=i.createScreenPointArray()){const{spatialReference:o}=n.data.coordinateHelper;return c.vectorToRender(s,o,t,e,u),e.state.camera.projectToScreen(u,r),r}},e.SegmentLabels3D=t.__decorate([a.subclass("esri.views.3d.interactive.SegmentLabels3D")],e.SegmentLabels3D);const u=l.create();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/support/viewUtils":function(){define(["exports","../../../../core/screenUtils","../../../../core/libs/gl-matrix-2/math/vec2","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../support/elevationInfoUtils"],(function(e,t,i,n,s,r){"use strict";const o=s.create(),a=t.createRenderScreenPointArray(),l=t.createRenderScreenPointArray();e.renderScreenSpaceTangent=function(e,t,n,s){n.projectToRenderScreen(e,a),n.projectToRenderScreen(t,l),i.subtract(s,l,a),i.normalize(s,s)},e.vectorToRender=function(e,t,i,a,l=s.create()){const c=n.copy(o,e);return c[2]=r.getConvertedElevationFromVector(a,c,t,i)||0,a.renderCoordsHelper.toRenderCoords(c,t,l),l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/SegmentLabels":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../intl","../../core/Accessor","../../core/asyncUtils","../../core/colorUtils","../../core/handleUtils","../../core/has","../../core/mathUtils","../../core/quantityFormatUtils","../../core/reactiveUtils","../../core/screenUtils","../../core/unitUtils","../../core/accessorSupport/decorators/property","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64","../../chunks/vec32","../../geometry/support/coordsUtils","../../geometry/support/vectorStacks","../../intl/messages","../../support/elevationInfoUtils","../../support/getDefaultUnitForView","../overlay/TextOverlayItem","../../intl/locale"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C,w,T){"use strict";const D={default:15,far:25};function I(e,t,i,n,s){const r=[];if(t.data.components[s].iterateVertices((e=>{r.push(n.toXYZ(e.pos,b.sv3d.get()))})),0===s&&null!=i&&r.push(n.toXYZ(i,b.sv3d.get())),r.length<2)return r;const o=r[0],a=r[r.length-1];return"polygon"===e.type&&r.length>2&&!v.equals(o,a)&&r.push(o),r}function A(e,t,i,n){if("2d"===t.type)return!0;const s=d.getMetersPerUnit(n)??1,r=d.getMetersPerVerticalUnitForSR(n),o=e=>S.getConvertedElevationFromVector(t,e,n,i,S.absoluteHeightElevationInfo)??0;for(let t=1;t<e.length;++t){const i=e[t-1],n=e[t],a=(n[0]-i[0])*s,l=(n[1]-i[1])*s,c=(o(n)-o(i))*r;if(Math.abs(c)/Math.sqrt(a*a+l*l)>M)return!1}return!0}e.SegmentLabels=class extends s{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messageUnitsTask=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){this.addHandles([u.watch((()=>[null!=this.context&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((e=>u.on((()=>this.context?.editGeometryOperations),e,(()=>this._update())))),u.watch((()=>this._colors),(e=>this._updateStyle(e))),T.onLocaleChange((()=>this._refreshMessages())),a.makeHandle((()=>this._messageUnitsTask?.abort()))]),this._refreshMessages()}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return null==this._messagesUnits}get test(){}get _messagesUnits(){return this._messageUnitsTask?.value}get _edgeDistancePixels(){return D[this.edgeDistance]}get _colors(){const e=this.context?.view.effectiveTheme.textColor??i.fromArray([255,255,255]);return{textColor:e,backgroundColor:o.multiplyOpacity(o.getContrast(e,o.BrightnessThreshold.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;const{context:e,stagedVertex:t}=this;if(!e)return this._destroyUnusedLabels();const{editGeometryOperations:i}=e,{components:n,geometry:s,coordinateHelper:r}=i.data;if(!s)return this._destroyUnusedLabels();const o=n.length;for(let n=0;n<o;++n){const a=I(s,i,t,r,n);if(a.length<2||!A(a,e.view,e.elevationInfo,r.spatialReference))continue;const l=1===o&&!P.isClockwise(a);let c=O,h=G;this.toScreenPointArray(e,a[0],c);for(let t=1;t<a.length;++t){const i=a[t-1],n=a[t];this.toScreenPointArray(e,n,h),this._addLabel(e,i,c,n,h,l),[c,h]=[h,c]}}this._destroyUnusedLabels()}_updateStyle({textColor:e,backgroundColor:t}){const i=this._nextLabelIndex,n=this._labelInfos;for(let s=0;s<i;++s){const{label:i}=n[s];i.textColor=e,i.backgroundColor=t}}_addLabel(e,t,i,n,s,r){const{label:o}=this._getOrCreateLabel(e);if(!this.visible||y.squaredDistance(i,s)<3025)return void(o.visible=!1);const{spatialReference:a}=e.editGeometryOperations.data,l=e.automaticLengthMeasurementUtils.autoDistance2D(t,n,a),c=this._messagesUnits,u=C.getDefaultUnitForView(e.view);o.text=null!=c&&null!=l?h.formatLength(c,l,u):"",o.visible=!0;const m=s[0]-i[0],d=s[1]-i[1];r?y.set(N,-d,m):y.set(N,d,-m),y.normalize(N,N),y.scale(N,N,this._edgeDistancePixels),y.lerp(R,i,s,.5),y.add(R,R,N),o.position=[R[0],R[1]],Math.abs(N[0])>Math.abs(N[1])?o.anchor=N[0]>0?"left":"right":o.anchor=-N[1]<0?"top":"bottom"}_getOrCreateLabel(e){const t=this._labelInfos.length>this._nextLabelIndex,{textColor:i,backgroundColor:n}=this._colors;if(t){const e=this._labelInfos[this._nextLabelIndex++],{label:t}=e;return t.textColor=i,t.backgroundColor=n,e}const s=new w({anchor:"center",fontSize:8,textColor:i,backgroundColor:n});e.view.overlay?.items.add(s);const r={label:s};return this._labelInfos.push(r),this._nextLabelIndex=this._labelInfos.length,r}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){this.context?.view.overlay?.items.remove(e),e.destroy()}_refreshMessages(){this._messageUnitsTask?.abort(),this._messageUnitsTask=r.createTask((()=>E.fetchMessageBundle("esri/core/t9n/Units")))}},t.__decorate([p.property()],e.SegmentLabels.prototype,"context",void 0),t.__decorate([p.property()],e.SegmentLabels.prototype,"stagedVertex",void 0),t.__decorate([p.property()],e.SegmentLabels.prototype,"visible",void 0),t.__decorate([p.property()],e.SegmentLabels.prototype,"edgeDistance",void 0),t.__decorate([p.property()],e.SegmentLabels.prototype,"updating",null),t.__decorate([p.property()],e.SegmentLabels.prototype,"_messageUnitsTask",void 0),t.__decorate([p.property()],e.SegmentLabels.prototype,"_messagesUnits",null),t.__decorate([p.property()],e.SegmentLabels.prototype,"_edgeDistancePixels",null),t.__decorate([p.property()],e.SegmentLabels.prototype,"_colors",null),e.SegmentLabels=t.__decorate([f.subclass("esri.views.interactive.SegmentLabels")],e.SegmentLabels);const M=c.deg2rad(5),N=x.create(),R=x.create(),O=m.createScreenPointArray(),G=m.createScreenPointArray();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/quantityFormatUtils":function(){define(["exports","./Cyclical","./quantityUtils","./unitFormatUtils"],(function(e,t,i,n){"use strict";function s(e,t,s,r=2,o="abbr"){return n.formatDecimal(e,i.toUnit(t,s).value,s,r,o)}function r(e,t,s,r=2,o="abbr"){return n.formatRelativeDecimal(e,i.toUnit(t,s).value,s,r,o)}function o(e,t,i=2,s="abbr"){return n.formatMetricLength(e,t.value,t.unit,i,s)}function a(e,t,i=2,s="abbr"){return n.formatMetricRelativeLength(e,t.value,t.unit,i,s)}function l(e,t,i=2,s="abbr"){return n.formatMetricVerticalLength(e,t.value,t.unit,i,s)}function c(e,t,i=2,s="abbr"){return n.formatMetricRelativeVerticalLength(e,t.value,t.unit,i,s)}function h(e,t,i=2,s="abbr"){return n.formatMetricArea(e,t.value,t.unit,i,s)}function u(e,t,i=2,s="abbr"){return n.formatImperialLength(e,t.value,t.unit,i,s)}function m(e,t,i=2,s="abbr"){return n.formatImperialRelativeLength(e,t.value,t.unit,i,s)}function d(e,t,i=2,s="abbr"){return n.formatImperialVerticalLength(e,t.value,t.unit,i,s)}function p(e,t,i=2,s="abbr"){return n.formatImperialRelativeVerticalLength(e,t.value,t.unit,i,s)}function g(e,t,i=2,s="abbr"){return n.formatImperialArea(e,t.value,t.unit,i,s)}e.formatAngle=function(e,i,s,r=t.cyclicalDegrees,o=!0){return n.formatAngleDegrees(e.value,e.unit,e.rotationType,i,s,r,o)},e.formatArea=function(e,t,i,n=2,r="abbr"){switch(i){case"imperial":return g(e,t,n,r);case"metric":return h(e,t,n,r);default:return s(e,t,i,n,r)}},e.formatDMS=function(e){return n.formatDMS(e.value,e.unit)},e.formatDecimal=s,e.formatImperialArea=g,e.formatImperialLength=u,e.formatImperialRelativeLength=m,e.formatImperialRelativeVerticalLength=p,e.formatImperialVerticalLength=d,e.formatLength=function(e,t,i,n,r="abbr"){switch(n=n??2,i){case"imperial":return u(e,t,n,r);case"metric":return o(e,t,n,r);default:return s(e,t,i,n,r)}},e.formatMetricArea=h,e.formatMetricLength=o,e.formatMetricRelativeLength=a,e.formatMetricRelativeVerticalLength=c,e.formatMetricVerticalLength=l,e.formatRelativeAngle=function(e,t,i){return n.formatRelativeAngleDegrees(e.value,e.unit,e.rotationType,t,i??void 0)},e.formatRelativeDecimal=r,e.formatRelativeLength=function(e,t,i,n=2,s="abbr"){switch(i){case"imperial":return m(e,t,n,s);case"metric":return a(e,t,n,s);default:return r(e,t,i,n,s)}},e.formatRelativeVerticalLength=function(e,t,i,n=2,s="abbr"){switch(i){case"imperial":return p(e,t,n,s);case"metric":return c(e,t,n,s);default:return r(e,t,i,n,s)}},e.formatVerticalLength=function(e,t,i,n=2,r="abbr"){switch(i){case"imperial":return d(e,t,n,r);case"metric":return l(e,t,n,r);default:return s(e,t,i,n,r)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/getDefaultUnitForView":function(){define(["exports","../core/unitUtils","../portal/Portal"],(function(e,t,i){"use strict";e.getDefaultUnitForView=function(e){const n="metric";if(null==e)return n;const s=e.map,r=(s&&"portalItem"in s?s.portalItem?.portal:null)??i.getDefault();switch(r.user?.units??r.units){case n:return n;case"english":return"imperial"}return t.getDefaultUnitSystem(e.spatialReference)??n},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/overlay/TextOverlayItem":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../libs/maquette/projection","../../libs/maquette/h","../../libs/maquette/projector"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";const m={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};e.default=class extends n{get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadowColor(){const{textColor:e,backgroundColor:t}=this,i=t.clone();return i.a*=e.a,i}get _textShadow(){const e=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${e}`}get padding(){return.5*this.fontSize}get borderRadius(){return this.padding}set borderRadius(e){this._overrideIfSome("borderRadius",e)}constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new i([0,0,0,.6]),this.textColor=new i([255,255,255]),this._textShadowSize=1}render(){return h.h("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+"px",borderRadius:this.borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const{padding:i,borderRadius:n}=this,s=e.measureText(this.text).width,r=""!==this.text?this.fontSize:0,o=d[this.anchor];e.textAlign="center",e.textBaseline="middle";const a=s+2*i,l=r+2*i,c=this.x+o.x*a,h=this.y+o.y*l;this._roundedRect(e,c,h,a,l,n),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();const u=this.x+(o.x+.5)*a,m=this.y+(o.y+.5)*l;this._renderTextShadow(e,this.text,u,m),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,u,m)}_renderTextShadow(e,t,i,n){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/p.length})`;const s=this._textShadowSize;for(const[r,o]of p)e.fillText(t,i+s*r,n+s*o)}_roundedRect(e,t,i,n,s,r){r=Math.min(r,s/2,n/2),e.beginPath(),e.moveTo(t,i+r),e.arcTo(t,i,t+r,i,r),e.lineTo(t+n-r,i),e.arcTo(t+n,i,t+n,i+r,r),e.lineTo(t+n,i+s-r),e.arcTo(t+n,i+s,t+n-r,i+s,r),e.lineTo(t+r,i+s),e.arcTo(t,i+s,t,i+s-r,r),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};let t;for(t in m)e[m[t]]=this.anchor===t;return e}},t.__decorate([s.property()],e.default.prototype,"x",void 0),t.__decorate([s.property()],e.default.prototype,"y",void 0),t.__decorate([s.property()],e.default.prototype,"position",null),t.__decorate([s.property()],e.default.prototype,"text",void 0),t.__decorate([s.property()],e.default.prototype,"fontSize",void 0),t.__decorate([s.property()],e.default.prototype,"anchor",void 0),t.__decorate([s.property()],e.default.prototype,"visible",void 0),t.__decorate([s.property()],e.default.prototype,"isDecoration",void 0),t.__decorate([s.property()],e.default.prototype,"backgroundColor",void 0),t.__decorate([s.property()],e.default.prototype,"textColor",void 0),t.__decorate([s.property()],e.default.prototype,"_textShadowSize",void 0),t.__decorate([s.property()],e.default.prototype,"_textShadowColor",null),t.__decorate([s.property()],e.default.prototype,"_textShadow",null),t.__decorate([s.property()],e.default.prototype,"padding",null),t.__decorate([s.property()],e.default.prototype,"borderRadius",null),e.default=t.__decorate([l.subclass("esri.views.overlay.TextOverlayItem")],e.default);const d={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},p=[];{const e=16;for(let t=0;t<360;t+=360/e)p.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}return e.default}))},"esri/libs/maquette/h":function(){define(["exports"],(function(e){"use strict";let t=(e,i,n)=>{for(let s=0,r=i.length;s<r;s++){let r=i[s];Array.isArray(r)?t(e,r,n):null!=r&&!1!==r&&("string"==typeof r&&(r={vnodeSelector:"",properties:void 0,children:void 0,text:r.toString(),domNode:null}),n.push(r))}};e.h=function(e,i,n){if(Array.isArray(i))n=i,i=void 0;else if(i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector"))||n&&("string"==typeof n||n.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let s,r;return n&&1===n.length&&"string"==typeof n[0]?s=n[0]:n&&(r=[],t(e,n,r),0===r.length&&(r=void 0)),{vnodeSelector:e,properties:i,children:r,text:""===s?void 0:s,domNode:null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/SnappingVisualizer3D":function(){define(["exports","../../../Color","../../../core/colorUtils","../../../core/has","../../../core/handleUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/projection/projectVectorToVector","../../../support/elevationInfoUtils","./support/viewUtils","./visualElements/ExtendedLineVisualElement","./visualElements/ParallelLineVisualElement","./visualElements/PointVisualElement","./visualElements/RightAngleQuadVisualElement","../layers/interfaces","../webgl-engine/lib/Material","../../interactive/sketch/normalizedPoint","../../interactive/snapping/Settings","../../interactive/snapping/SnappingDomain","../../interactive/snapping/snappingUtils","../../interactive/snapping/SnappingVisualizer","../../interactive/snapping/hints/LineSnappingHint"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P){"use strict";class b extends v.SnappingVisualizer{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof P.LineSnappingHint?t.length:0)-(e instanceof P.LineSnappingHint?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:n}=t,r=E(t);return s.destroyHandle(new m.PointVisualElement({view:n,primitive:"circle",geometry:_.toDehydratedPoint(e.intersectionPoint,i),elevationInfo:e.isDraped?l.onTheGroundElevationInfo:l.absoluteHeightElevationInfo,size:20,outlineSize:2,color:r.intersectionPointColor,outlineColor:r.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:i,spatialReference:n}=t,r=E(t),o=S(e.point,e.domain,t);return s.destroyHandle(new m.PointVisualElement({view:i,primitive:"circle",geometry:_.toDehydratedPoint(o,n),elevationInfo:C(e),size:20,outlineSize:2,color:r.pointColor,outlineColor:r.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:i,spatialReference:n}=t,r=E(t),o=S(e.lineStart,e.domain,t),a=S(e.lineEnd,e.domain,t);return s.destroyHandle(function(e,t,i,n,s,r,o,a=!1,l=!0,c=!0){const u=w(t,n,s,r,a),m=w(i,n,s,r,a),d=new h.ExtendedLineVisualElement({view:r,extensionType:h.ExtensionType.FADED,start:u,end:m,isDraped:a,color:o.lineColor,renderOccluded:a?g.RenderOccludedFlag.OccludeAndTransparent:g.RenderOccludedFlag.Opaque,renderGroup:p.DrapedRenderGroup.SnappingHint,isDecoration:!0});switch(e){case x.LineSegmentHintType.TARGET:d.width=f.defaults.lineHintWidthTarget,d.fadedExtensions={start:0,end:f.defaults.lineHintFadedExtensions};break;case x.LineSegmentHintType.REFERENCE_EXTENSION:d.width=f.defaults.lineHintWidthReference,d.fadedExtensions={start:0,end:0};break;case x.LineSegmentHintType.REFERENCE:d.width=f.defaults.lineHintWidthReference,d.fadedExtensions={start:l?f.defaults.lineHintFadedExtensions:0,end:c?f.defaults.lineHintFadedExtensions:0}}return d.attached=!0,d}(e.type,o,a,n,C(e),i,r,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:n}=t,o=E(t),{isDraped:a}=e,l=C(e),c=S(e.lineStart,e.domain,t),h=S(e.lineEnd,e.domain,t),m=w(c,n,l,i,a),d=w(h,n,l,i,a),_=r.lerp(d,m,d,.5),y=new u.ParallelLineVisualElement({view:i,attached:!1,offset:f.defaults.parallelLineHintOffset,length:f.defaults.parallelLineHintLength,width:f.defaults.parallelLineHintWidth,color:o.parallelSignColor,location:_,renderOccluded:a?g.RenderOccludedFlag.OccludeAndTransparent:g.RenderOccludedFlag.Opaque,isDraped:a,renderGroup:p.DrapedRenderGroup.SnappingHint,isDecoration:!0});return y.setDirectionFromPoints(m,_),y.attached=!0,s.destroyHandle(y)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:n}=t,r=E(t),o=C(e),{isDraped:a}=e,l=S(e.previousVertex,e.domain,t),c=S(e.centerVertex,e.domain,t),h=S(e.nextVertex,e.domain,t),u=w(l,n,o,i,a),m=w(c,n,o,i,a),_=w(h,n,o,i,a);return s.destroyHandle(new d.RightAngleQuadVisualElement({view:i,attached:!0,color:a?r.rightAngleColorDraped:r.rightAngleColor,renderOccluded:a?g.RenderOccludedFlag.OccludeAndTransparent:g.RenderOccludedFlag.Transparent,outlineRenderOccluded:a?g.RenderOccludedFlag.OccludeAndTransparent:g.RenderOccludedFlag.Opaque,outlineColor:r.rightAngleOutlineColor,outlineSize:f.defaults.rightAngleHintOutlineSize,size:f.defaults.rightAngleHintSize,isDraped:a,geometry:{previous:u,center:m,next:_},renderGroup:p.DrapedRenderGroup.SnappingHint,isDecoration:!0}))}}function E(e){const{effectiveTheme:n}=e.view,s=t.toUnitRGBA(n.accentColor),r=[0,0,0,0];return{intersectionPointColor:r,intersectionPointOutlineColor:s,pointColor:r,pointOutlineColor:s,lineColor:s,lineOutlineColor:void 0,parallelSignColor:s,rightAngleColor:s,rightAngleColorDraped:t.toUnitRGBA(i.multiplyOpacity(n.accentColor,.5)),rightAngleOutlineColor:s}}function S(e,t,{selfSnappingZ:i,view:n,spatialReference:s}){return 0!==(t&y.SnappingDomain.SELF)&&_.isTarget(e)&&null!=i?_.withSelfSnappingZ(e,i,n,s):e}function C(e){return e.isDraped?l.onTheGroundElevationInfo:l.absoluteHeightElevationInfo}function w(e,t,i,n,s){const r=o.create();if(s){const i=n.basemapTerrain.overlayManager.renderer.spatialReference;a.projectVectorToVector(e,t,r,i)}else c.vectorToRender(e,t,i,n,r);return r}e.SnappingVisualizer3D=b,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/ExtendedLineVisualElement":function(){define(["exports","../../../../core/has","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/support/clipRay","../../../../geometry/support/frustum","../../../../geometry/support/lineSegment","../../../../geometry/support/ray","./EngineVisualElement","./LaserlineVisualElement","../../terrain/OverlayRenderer","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Material","../../webgl-engine/lib/RenderGeometry","../../webgl-engine/lib/VertexAttribute","../../webgl-engine/materials/RibbonLineMaterial"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f){"use strict";class y extends h.EngineVisualElement{constructor(t){super(t),this._ray=c.create(),this._isWorldDown=!1,this._start=n.create(),this._end=n.fromValues(1,0,0),this._width=1,this._color=r.fromValues(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=r.fromValues(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=e.ExtensionType.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=p.RenderOccludedFlag.OccludeAndTransparent,this._fadedExtensions=w,this._laserline=new u.LaserlineVisualElement({view:this.view,isDecoration:t.isDecoration}),this.applyProperties(t)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:x,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry(),forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:x,recreateGeometry:e=>this._recreateDrapedGeometry(e),forEachMaterial:(e,t)=>t(e.material)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,i.copy(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),i.subtract(this._end,e,this._end),c.fromPoints(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,i.exactEquals(this._start,e)||(i.copy(this._start,e),c.fromPoints(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,i.exactEquals(this._end,e)||(i.copy(this._end,e),c.fromPoints(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){s.exactEquals(e,this._color)||(s.copy(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){s.exactEquals(e,this._innerColor)||(s.copy(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&s.exactEquals(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?r.clone(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===p.RenderOccludedFlag.OccludeAndTransparentStencil?p.RenderOccludedFlag.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??w,this.recreateGeometry()}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new f.RibbonLineMaterial(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const n=this._createGeometry(e);i.push(n),t.addGeometry(n),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new f.RibbonLineMaterial(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new g.RenderGeometry(t)}_createGeometry(t){const i=this.extensionType===e.ExtensionType.FADED,s=i?[n.create(),n.create(),n.create(),n.create()]:[n.create(),n.create()],r=i?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null;return d.createPolylineGeometry(t,s,null,r)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===e.ExtensionType.FADED?this._updateLineSegmentFinite(E):this._updateLineSegmentInfinite(this._extensionType,E)}_updateLineSegmentFinite(e){return l.fromPoints(this._start,this._end,e)}_updateLineSegmentInfinite(t,n){const s=this.view.state.camera;switch(o.fromRay(this._ray,v),t){case e.ExtensionType.LINE:v.c0=-Number.MAX_VALUE;break;case e.ExtensionType.RAY:case e.ExtensionType.GROUND_RAY:{const t=this._ray.origin,n=this.view.elevationProvider.getElevation(t[0],t[1],t[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,s=this.view.renderCoordsHelper.getAltitude(t);this._isWorldDown&&s<n&&i.negate(v.ray.direction,v.ray.direction),this._extensionType===e.ExtensionType.GROUND_RAY&&null!=n&&(v.c1=Math.abs(s-n));break}}if(!a.intersectClipRay(s.frustum,v))return this._updateLineSegmentFinite(n);const r=o.getStart(v,P),c=o.getEnd(v,b);return l.fromPoints(r,c,n)}_updateVertexAttributesObject3D(e,t){const i=e.geometries[0].getMutableAttribute(_.VertexAttribute.POSITION)?.data;if(!i)return;let n=0;for(const e of this._lineVertices(t))i[n++]=e[0],i[n++]=e[1],i[n++]=e[2];e.geometryVertexAttributeUpdated(e.geometries[0],_.VertexAttribute.POSITION)}_updateVertexAttributesDraped(e,t){const i=e.getMutableAttribute(_.VertexAttribute.POSITION)?.data;if(!i)return;let n=0;for(const e of this._lineVertices(t))i[n++]=e[0],i[n++]=e[1],i[n++]=m.drapedZ;e.invalidateBoundingInfo()}*_lineVertices(t){this.extensionType===e.ExtensionType.FADED?(yield l.pointAt(t,-this.fadedExtensions.start,P),yield l.pointAt(t,0,P),yield l.pointAt(t,1,P),yield l.pointAt(t,1+this.fadedExtensions.end,P)):(yield l.pointAt(t,0,P),yield l.pointAt(t,1,P))}}function x(e){e.geometries=[]}const v=o.create(),P=n.create(),b=n.create(),E=l.create();var S;e.ExtensionType=void 0,(S=e.ExtensionType||(e.ExtensionType={}))[S.LINE=0]="LINE",S[S.RAY=1]="RAY",S[S.GROUND_RAY=2]="GROUND_RAY",S[S.FADED=3]="FADED";const C=1/3,w={start:C,end:C};e.ExtendedLineVisualElement=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/EngineVisualElement":function(){define(["exports","./DrapedVisualElementResources","./VisualElement","./VisualElementResources"],(function(e,t,i,n){"use strict";class s extends i.VisualElement{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new n.VisualElementResources(this.createObject3DResourceFactory(e.view)),this.drapedResources=new t.DrapedVisualElementResources(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}forEachMaterial(e){this.object3dResources?.forEachMaterial(e),this.drapedResources?.forEachMaterial(e)}}e.EngineVisualElement=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/DrapedVisualElementResources":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Identifiable","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../layers/interfaces","../../webgl-engine/lib/ModelDirtyTypes","../../webgl-engine/lib/UpdatePolicy"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";let m=class extends(n.IdentifiableMixin(i)){constructor(e){super(e),this.drapeSourceType=c.DrapeSourceType.Features,this.updatePolicy=u.UpdatePolicy.SYNC,this.renderGroup=c.DrapedRenderGroup.Outline}};t.__decorate([s.property({constructOnly:!0})],m.prototype,"view",void 0),t.__decorate([s.property({readOnly:!0})],m.prototype,"drapeSourceType",void 0),t.__decorate([s.property()],m.prototype,"renderGroup",void 0),m=t.__decorate([l.subclass("esri.views.3d.interactive.visualElements.DrapedVisualElementResources")],m),e.DrapedVisualElementResources=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=c.DrapedRenderGroup.Outline}destroy(){this._destroyResources()}get resources(){return this._resources?.external}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new m({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:t,external:e,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,h.DirtyOperation.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,h.DirtyOperation.UPDATE),this._resources.geometriesAdded=!0))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/VisualElement":function(){define(["exports","../../../../core/has","../../../../core/reactiveUtils"],(function(e,t,i){"use strict";e.VisualElement=class{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this.forEachMaterial((t=>t?.setParameters({isDecoration:e})))}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=i.watch((()=>e.view.ready),(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProperties(e){let t=!1;for(const i in e)i in this&&("attached"===i?t=!!e[i]:this[i]=e[i]);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view.stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/VisualElementResources":function(){define(["exports","../../../../core/reactiveUtils","../../webgl-engine/lib/Object3D","../../webgl-engine/lib/UpdatePolicy","../../webgl-engine/lib/WebGLLayer"],(function(e,t,i,n,s){"use strict";e.VisualElementResources=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view.stage;if(null==this._resources||!e)return;const t=this._resources.object;t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer)}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,r=e.view,o=r.stage;if(!o)return;const a=new s.WebGLLayer(o,{pickable:!1,updatePolicy:n.UpdatePolicy.SYNC}),l=new i.Object3D({castShadow:!1}),c=e.createResources(l,a);a.add(l);const h=e.cameraChanged,u=h?t.watch((()=>r.state.camera),(e=>h(e)),t.initial):null;this._resources={layer:a,object:l,external:c,cameraHandle:u},this._syncVisible()}_destroyResources(){null!=this._resources&&(this._resources.layer.destroy(),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null)}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/LaserlineVisualElement":function(){define(["exports","../../../../core/has","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/lineSegment","./VisualElement","../../webgl-engine/effects/laserlines/LaserLineRenderer","../../../../chunks/Laserlines.glsl"],(function(e,t,i,n,s,r,o,a){"use strict";class l extends r.VisualElement{constructor(e){super(e),this._angleCutoff=a.defaultAngleCutoff,this._style={},this._heightManifoldTarget=n.create(),this._heightManifoldEnabled=!1,this._intersectsLine=s.create(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){null!=e?(i.copy(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(null==e)return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,c);this.intersectsLine=s.fromValues(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){null!=e?(s.copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=null!=e?s.copy(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=null!=e?{origin:n.clone(e.origin),target:e.target?n.clone(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._renderer&&(this._renderer.isDecoration=e)}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||null!=this._pointDistanceLine||null!=this._pathVerticalPlaneBuffers)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){null==this._renderer&&(this._renderer=new o.LaserLineRenderer({view:this.view,contrastControlEnabled:!0,isDecoration:this.isDecoration}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff())}_syncStyle(){null!=this._renderer&&this._renderer.setParameters(this._style)}_syncAngleCutoff(){this._renderer?.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){null!=this._renderer&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){null!=this._renderer&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){null!=this._renderer&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){null!=this._renderer&&(this._renderer.pathVerticalPlaneEnabled=null!=this._pathVerticalPlaneBuffers&&this.visible,null!=this._pathVerticalPlaneBuffers&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){null!=this._renderer&&(this._renderer.lineVerticalPlaneEnabled=null!=this._lineVerticalPlaneSegment&&this.visible,null!=this._lineVerticalPlaneSegment&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(null==this._renderer)return;const e=this._pointDistanceLine,t=null!=e;this._renderer.pointDistanceEnabled=t&&null!=e.target&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,null!=e.target&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){null!=this._renderer&&this.view.stage&&(this._renderer.destroy(),this._renderer=null)}forEachMaterial(){}}const c=n.create();e.LaserlineVisualElement=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/laserlines/LaserLineRenderer":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/has","../../../../../core/maybe","../../../../../core/accessorSupport/decorators/property","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../chunks/vec32","../../../../../geometry/support/clipRay","../../../../../geometry/support/frustum","../../../../../geometry/support/lineSegment","../../../../../geometry/support/ray","../../../../ViewingMode","../../../webgl","../../../webgl/RenderNode","../blit/Blit","./LaserlinePathData","./LaserlinePathTechnique","./LaserlinePathTechniqueConfiguration","./LaserlineTechnique","./LaserlineTechniqueConfiguration","../../lib/basicInterfaces","../../materials/internal/MaterialUtil","../../shaders/CompositingTechniqueConfiguration","../../../../webgl/enums"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C){"use strict";e.LaserLineRenderer=class extends g{constructor(e){super(e),this.isDecoration=!0,this.produces=p.InternalRenderCategory.LASERLINES,this.consumes={required:[p.InternalRenderCategory.LASERLINES,"normals"]},this.requireGeometryDepth=!0,this._configuration=new P.LaserlineTechniqueConfiguration,this._pathTechniqueConfiguration=new x.LaserlinePathTechniqueConfiguration,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._passParameters=new y.LaserlinePathPassParameters;const t=e.view.stage.renderView.techniques,i=new x.LaserlinePathTechniqueConfiguration;i.contrastControlEnabled=e.contrastControlEnabled,t.precompile(y.LaserlinePathTechnique,i)}initialize(){this._passParameters.renderCoordsHelper=this.view.renderCoordsHelper,this._pathTechniqueConfiguration.spherical=this.view.state.viewingMode===d.ViewingMode.Global,this._pathTechniqueConfiguration.contrastControlEnabled=this.contrastControlEnabled,this._techniques.precompile(y.LaserlinePathTechnique,this._pathTechniqueConfiguration),this._blit=new _.Blit(this._techniques,S.BlitMode.PremultipliedAlpha)}destroy(){this._pathVerticalPlaneData=n.disposeMaybe(this._pathVerticalPlaneData),this._blit=null}get _techniques(){return this.view.stage.renderView.techniques}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this.requestRender(b.RenderRequestType.UPDATE))}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){l.copy(this._passParameters.heightManifoldTarget,e),this.requestRender(b.RenderRequestType.UPDATE)}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this.requestRender(b.RenderRequestType.UPDATE))}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){l.copy(this._passParameters.pointDistanceTarget,e),this.requestRender(b.RenderRequestType.UPDATE)}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){l.copy(this._passParameters.pointDistanceOrigin,e),this.requestRender(b.RenderRequestType.UPDATE)}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this.requestRender(b.RenderRequestType.UPDATE))}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){u.copy(e,this._passParameters.lineVerticalPlaneSegment),this.requestRender(b.RenderRequestType.UPDATE)}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this.requestRender(b.RenderRequestType.UPDATE))}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){u.copy(e,this._passParameters.intersectsLineSegment),this.requestRender(b.RenderRequestType.UPDATE)}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this.requestRender(b.RenderRequestType.UPDATE))}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,null!=this._pathVerticalPlaneData&&this.requestRender(b.RenderRequestType.UPDATE))}set pathVerticalPlaneVertices(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new f.LaserlinePathData(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this.requestRender(b.RenderRequestType.UPDATE)}set pathVerticalPlaneBuffers(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new f.LaserlinePathData(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this.requestRender(b.RenderRequestType.UPDATE)}setParameters(e){E.updateParameters(this._passParameters,e)&&this.requestRender(b.RenderRequestType.UPDATE)}precompile(){this._acquireTechnique()}render(e){const t=e.find((({name:e})=>e===this.produces));if(this.isDecoration&&!this.bindParameters.decorations||null==this._blit)return t;const i=this.renderingContext,n=e.find((({name:e})=>"normals"===e));this._passParameters.normals=n?.getTexture();const s=()=>{(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(),this.pathVerticalPlaneEnabled&&this._renderPath()};if(!this.contrastControlEnabled)return i.bindFramebuffer(t.fbo),s(),t;this._passParameters.colors=t.getTexture();const r=this.fboCache.acquire(t.fbo.width,t.fbo.height,"laser lines");return i.bindFramebuffer(r.fbo),i.setClearColor(0,0,0,0),i.clear(C.FramebufferBit.COLOR|C.FramebufferBit.DEPTH),s(),i.unbindTexture(t.getTexture()),this._blit.blend(i,r,t,this.bindParameters)||this.requestRender(b.RenderRequestType.UPDATE),r.release(),t}_acquireTechnique(){return this._configuration.heightManifoldEnabled=this.heightManifoldEnabled,this._configuration.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._configuration.pointDistanceEnabled=this.pointDistanceEnabled,this._configuration.intersectsLineEnabled=this.intersectsLineEnabled,this._configuration.contrastControlEnabled=this.contrastControlEnabled,this._configuration.spherical=this.view.state.viewingMode===d.ViewingMode.Global,this._techniques.get(v.LaserlineTechnique,this._configuration)}_renderUnified(){if(!this._updatePassParameters())return;const e=this._acquireTechnique();if(e.compiled){const t=this.renderingContext;t.bindTechnique(e,this.bindParameters,this._passParameters),t.screen.draw()}else this.requestRender(b.RenderRequestType.UPDATE)}_renderPath(){if(null==this._pathVerticalPlaneData)return;const e=this._techniques.get(y.LaserlinePathTechnique,this._pathTechniqueConfiguration);if(e.compiled){const t=this.renderingContext;this._passParameters.origin=this._pathVerticalPlaneData.origin,t.bindTechnique(e,this.bindParameters,this._passParameters),this._pathVerticalPlaneData.draw(t)}else this.requestRender(b.RenderRequestType.UPDATE)}_updatePassParameters(){if(!this._intersectsLineEnabled)return!0;const e=this.bindParameters.camera,t=this._passParameters;if(this._intersectsLineInfinite){if(c.fromRay(m.wrap(t.intersectsLineSegment.origin,t.intersectsLineSegment.vector),w),w.c0=-Number.MAX_VALUE,!h.intersectClipRay(e.frustum,w))return!1;c.getStart(w,t.lineStartWorld),c.getEnd(w,t.lineEndWorld)}else l.copy(t.lineStartWorld,t.intersectsLineSegment.origin),l.add(t.lineEndWorld,t.intersectsLineSegment.origin,t.intersectsLineSegment.vector);return!0}get test(){}},t.__decorate([s.property({constructOnly:!0})],e.LaserLineRenderer.prototype,"contrastControlEnabled",void 0),t.__decorate([s.property()],e.LaserLineRenderer.prototype,"isDecoration",void 0),t.__decorate([s.property()],e.LaserLineRenderer.prototype,"produces",void 0),t.__decorate([s.property()],e.LaserLineRenderer.prototype,"consumes",void 0),e.LaserLineRenderer=t.__decorate([a.subclass("esri.views.3d.webgl-engine.effects.laserlines.LaserLineRenderer")],e.LaserLineRenderer);const w=c.create();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/laserlines/LaserlinePathData":function(){define(["exports","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../geometry/support/DoubleArray","../../../../ViewingMode","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","./LaserlinePathTechnique","../../lib/VertexArrayObject","../../lib/VertexAttribute","../../../../webgl/BufferObject","../../../../webgl/enums"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";function m(e){return 2*(e.length/3-1)*3}const d=i.create(),p=i.create(),g=o.newLayout().vec3f(c.VertexAttribute.START).vec3f(c.VertexAttribute.END).vec2f(c.VertexAttribute.EXTRUDE).vec3f(c.VertexAttribute.START_UP).vec3f(c.VertexAttribute.END_UP),_=o.newLayout().vec3f(c.VertexAttribute.START).vec3f(c.VertexAttribute.END).vec2f(c.VertexAttribute.EXTRUDE);e.LaserlinePathData=class{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=i.create(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=n.newDoubleArray(3*e.length);let i=0;for(const n of e)t[i++]=n[0],t[i++]=n[1],t[i++]=n[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],i=3*Math.floor(e.length/3/2);t.set(this._origin,e[i],e[i+1],e[i+2])}else t.set(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);null!=t&&(e.bindVAO(t),e.drawArrays(u.PrimitiveType.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}get _layout(){return this._renderCoordsHelper.viewingMode===s.ViewingMode.Global?g:_}_ensureVAO(e){return null==this._buffers?null:(this._vao??=this._createVAO(e,this._buffers),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const i=this._createDataBuffer(t);return this._dirty=!1,new l.VertexArrayObject(e,a.vertexAttributeLocations,new Map([["data",r.glLayout(this._layout)]]),new Map([["data",h.BufferObject.createVertex(e,u.Usage.STATIC_DRAW,i)]]))}_ensureVertexData(e,t){if(!this._dirty)return;const i=this._createDataBuffer(t);e.vertexBuffers.get("data")?.setData(i),this._dirty=!1}_createDataBuffer(e){const i=e.reduce(((e,t)=>e+m(t)),0);this._count=i;const n=this._layout.createBuffer(i),s=this._origin;let r=0,o=0;const a="startUp"in n?this._setUpVectors.bind(this,n):void 0;for(const i of e){for(let e=0;e<i.length;e+=3){const l=t.set(p,i[e],i[e+1],i[e+2]);0===e?o=this._renderCoordsHelper.getAltitude(l):this._renderCoordsHelper.setAltitude(l,o);const c=r+2*e;a?.(e,c,i,l);const h=t.subtract(p,l,s);if(e<i.length-3){for(let e=0;e<6;e++)n.start.setVec(c+e,h);n.extrude.setValues(c,0,-1),n.extrude.setValues(c+1,1,-1),n.extrude.setValues(c+2,1,1),n.extrude.setValues(c+3,0,-1),n.extrude.setValues(c+4,1,1),n.extrude.setValues(c+5,0,1)}if(e>0)for(let e=-6;e<0;e++)n.end.setVec(c+e,h)}r+=m(i)}return n.buffer}_setUpVectors(e,t,i,n,s){const r=this._renderCoordsHelper.worldUpAtPosition(s,d);if(t<n.length-3)for(let t=0;t<6;t++)e.startUp.setVec(i+t,r);if(t>0)for(let t=-6;t<0;t++)e.endUp.setVec(i+t,r)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/laserlines/LaserlinePathTechnique":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../core/shaderTechnique/ReloadableShaderModule","../../core/shaderTechnique/ShaderTechnique","./LaserlineTechnique","../../lib/VertexAttribute","../../../../../chunks/LaserlinePath.glsl"],(function(e,t,i,n,s,r,o,a){"use strict";class l extends r.LaserlinePassParameters{constructor(){super(...arguments),this.origin=i.create()}}class c extends s.ShaderTechnique{constructor(t,i){super(t,i,new n.ReloadableShaderModule(a.LaserlinePath,(()=>new Promise(((t,i)=>e(["../../shaders/LaserlinePath.glsl"],t,i))))),h)}}const h=new Map([[o.VertexAttribute.START,0],[o.VertexAttribute.END,1],[o.VertexAttribute.EXTRUDE,2],[o.VertexAttribute.START_UP,3],[o.VertexAttribute.END_UP,4]]);t.LaserlinePathPassParameters=l,t.LaserlinePathTechnique=c,t.vertexAttributeLocations=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/laserlines/LaserlineTechnique":function(){define(["require","exports","../../../../../core/mathUtils","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../geometry/support/lineSegment","../../core/shaderTechnique/ReloadableShaderModule","../../core/shaderTechnique/ShaderTechnique","../../../../../chunks/Laserlines.glsl","../../../../webgl/NoParameters"],(function(e,t,i,n,s,r,o,a,l){"use strict";class c extends l.NoParameters{constructor(){super(...arguments),this.innerColor=n.fromValues(1,1,1),this.innerWidth=1,this.glowColor=n.fromValues(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=i.deg2rad(6),this.pointDistanceOrigin=n.create(),this.pointDistanceTarget=n.create(),this.lineVerticalPlaneSegment=s.create(),this.intersectsLineSegment=s.create(),this.intersectsLineRadius=3,this.heightManifoldTarget=n.create(),this.lineStartWorld=n.create(),this.lineEndWorld=n.create()}}class h extends o.ShaderTechnique{constructor(t,i){super(t,i,new r.ReloadableShaderModule(a.Laserlines,(()=>new Promise(((t,i)=>e(["../../shaders/Laserlines.glsl"],t,i))))))}}t.LaserlinePassParameters=c,t.LaserlineTechnique=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/Laserlines.glsl":function(){define(["exports","../core/mathUtils","../core/libs/gl-matrix-2/math/vec2","../core/libs/gl-matrix-2/factories/vec2f64","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","./vec42","../core/libs/gl-matrix-2/factories/vec4f64","../geometry/support/lineSegment","../geometry/support/plane","./sphere","../views/3d/webgl-engine/core/shaderLibrary/Laserline.glsl","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/Float2PassUniform","../views/3d/webgl-engine/core/shaderModules/Float3BindUniform","../views/3d/webgl-engine/core/shaderModules/Float3PassUniform","../views/3d/webgl-engine/core/shaderModules/Float4PassUniform","../views/3d/webgl-engine/core/shaderModules/FloatBindUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/webgl/ShaderBuilder"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v){"use strict";const P=t.deg2rad(6);function b(e){const t=new v.ShaderBuilder;t.include(m.ScreenSpacePass),t.include(u.Laserline,e);const i=t.fragment;if(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)if(i.uniforms.add(new y.FloatPassUniform("maxPixelDistance",((t,i)=>e.heightManifoldEnabled?2*i.camera.computeScreenPixelSizeAt(t.heightManifoldTarget):2*i.camera.computeScreenPixelSizeAt(t.lineVerticalPlaneSegment.origin)))),i.code.add(x.glsl`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.spherical){const e=(e,t,i)=>s.transformMat4(e,t.heightManifoldTarget,i.camera.viewMatrix),t=(e,t)=>s.transformMat4(e,[0,0,0],t.camera.viewMatrix);i.uniforms.add(new _.Float4PassUniform("heightManifoldOrigin",((i,n)=>(e(w,i,n),t(I,n),s.subtract(I,I,w),s.normalize(T,I),T[3]=s.length(I),T))),new p.Float3BindUniform("globalOrigin",(e=>t(w,e))),new y.FloatPassUniform("cosSphericalAngleThreshold",((e,t)=>1-Math.max(2,s.distance(t.camera.eye,e.heightManifoldTarget)*t.camera.perRenderPixelRatio)/s.length(e.heightManifoldTarget)))),i.code.add(x.glsl`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else i.code.add(x.glsl`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if(e.pointDistanceEnabled&&(i.uniforms.add(new y.FloatPassUniform("maxPixelDistance",((e,t)=>2*t.camera.computeScreenPixelSizeAt(e.pointDistanceTarget)))),i.code.add(x.glsl`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),e.intersectsLineEnabled&&i.uniforms.add(new f.FloatBindUniform("perScreenPixelRatio",(e=>e.camera.perScreenPixelRatio))).code.add(x.glsl`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&i.code.add(x.glsl`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),i.main.add(x.glsl`vec3 pos;
vec3 normal;
float angleCutoffAdjust;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, angleCutoffAdjust, depthDiscontinuityAlpha)) {
fragColor = vec4(0.0);
return;
}
vec4 color = vec4(0.0);`),e.heightManifoldEnabled){i.uniforms.add(new d.Float2PassUniform("angleCutoff",(e=>E(e))),new _.Float4PassUniform("heightPlane",((e,t)=>S(e.heightManifoldTarget,e.renderCoordsHelper.worldUpAtPosition(e.heightManifoldTarget,w),t.camera.viewMatrix))));const t=e.spherical?x.glsl`normalize(globalOrigin - pos)`:x.glsl`heightPlane.xyz`;i.main.add(x.glsl`
      vec2 angleCutoffAdjusted = angleCutoff - angleCutoffAdjust;
      // Fade out laserlines on flat surfaces
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoffAdjusted.x, angleCutoffAdjusted.y, abs(dot(normal, ${t})));
      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);`)}return e.pointDistanceEnabled&&(i.uniforms.add(new d.Float2PassUniform("angleCutoff",(e=>E(e))),new _.Float4PassUniform("pointDistanceSphere",((e,t)=>function(e,t){return s.transformMat4(h.getCenter(N),e.pointDistanceOrigin,t.camera.viewMatrix),N[3]=s.distance(e.pointDistanceOrigin,e.pointDistanceTarget),N}(e,t)))),i.main.add(x.glsl`float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);`)),e.lineVerticalPlaneEnabled&&(i.uniforms.add(new d.Float2PassUniform("angleCutoff",(e=>E(e))),new _.Float4PassUniform("lineVerticalPlane",((e,t)=>function(e,t){const i=l.pointAt(e.lineVerticalPlaneSegment,.5,w),n=e.renderCoordsHelper.worldUpAtPosition(i,D),r=s.normalize(I,e.lineVerticalPlaneSegment.vector),o=s.cross(w,n,r);return s.normalize(o,o),S(e.lineVerticalPlaneSegment.origin,o,t.camera.viewMatrix)}(e,t))),new g.Float3PassUniform("lineVerticalStart",((e,t)=>function(e,t){const i=s.copy(w,e.lineVerticalPlaneSegment.origin);return e.renderCoordsHelper.setAltitude(i,0),s.transformMat4(i,i,t.camera.viewMatrix)}(e,t))),new g.Float3PassUniform("lineVerticalEnd",((e,t)=>function(e,t){const i=s.add(w,e.lineVerticalPlaneSegment.origin,e.lineVerticalPlaneSegment.vector);return e.renderCoordsHelper.setAltitude(i,0),s.transformMat4(i,i,t.camera.viewMatrix)}(e,t)))),i.main.add(x.glsl`if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}`)),e.intersectsLineEnabled&&(i.uniforms.add(new d.Float2PassUniform("angleCutoff",(e=>E(e))),new g.Float3PassUniform("intersectsLineStart",((e,t)=>s.transformMat4(w,e.lineStartWorld,t.camera.viewMatrix))),new g.Float3PassUniform("intersectsLineEnd",((e,t)=>s.transformMat4(w,e.lineEndWorld,t.camera.viewMatrix))),new g.Float3PassUniform("intersectsLineDirection",((e,t)=>(s.copy(T,e.intersectsLineSegment.vector),T[3]=0,s.normalize(w,o.transformMat4(T,T,t.camera.viewMatrix))))),new y.FloatPassUniform("intersectsLineRadius",(e=>e.intersectsLineRadius))),i.main.add(x.glsl`if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}`)),i.main.add(x.glsl`fragColor = laserlineOutput(color * depthDiscontinuityAlpha);`),t}function E(e){return i.set(C,Math.cos(e.angleCutoff),Math.cos(Math.max(0,e.angleCutoff-t.deg2rad(2))))}function S(e,t,i){return s.transformMat4(A,e,i),s.copy(T,t),T[3]=0,o.transformMat4(T,T,i),c.fromPositionAndNormal(A,T,M)}const C=n.create(),w=r.create(),T=a.create(),D=r.create(),I=r.create(),A=r.create(),M=c.create(),N=h.create(),R=Object.freeze(Object.defineProperty({__proto__:null,build:b,defaultAngleCutoff:P},Symbol.toStringTag,{value:"Module"}));e.Laserlines=R,e.build=b,e.defaultAngleCutoff=P}))},"esri/views/3d/webgl-engine/core/shaderLibrary/Laserline.glsl":function(){define(["exports","./output/ReadDepth.glsl","./util/BlendColorsPremultiplied.glsl","./util/CameraSpace.glsl","../shaderModules/Float3PassUniform","../shaderModules/FloatPassUniform","../shaderModules/glsl","../shaderModules/Texture2DBindUniform","../shaderModules/Texture2DPassUniform"],(function(e,t,i,n,s,r,o,a,l){"use strict";e.Laserline=function(e,c){const h=e.fragment;h.include(t.ReadDepth),e.include(n.CameraSpace),h.include(i.BlendColorsPremultiplied),h.uniforms.add(new r.FloatPassUniform("globalAlpha",(e=>e.globalAlpha)),new s.Float3PassUniform("glowColor",(e=>e.glowColor)),new r.FloatPassUniform("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new r.FloatPassUniform("glowFalloff",(e=>e.glowFalloff)),new s.Float3PassUniform("innerColor",(e=>e.innerColor)),new r.FloatPassUniform("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio)),new a.Texture2DBindUniform("depthMap",(e=>e.depth?.attachment)),new l.Texture2DPassUniform("normalMap",(e=>e.normals))),h.code.add(o.glsl`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),h.code.add(o.glsl`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendColorsPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),h.code.add(o.glsl`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float angleCutoffAdjust, out float depthDiscontinuityAlpha) {
float depth = depthFromTexture(depthMap, uv);
if (depth == 1.0) {
return false;
}
float linearDepth = linearizeDepth(depth);
pos = reconstructPosition(gl_FragCoord.xy, linearDepth);
float minStep = 6e-8;
float depthStep = clamp(depth + minStep, 0.0, 1.0);
float linearDepthStep = linearizeDepth(depthStep);
float depthError = abs(linearDepthStep - linearDepth);
vec3 normalReconstructed = normalize(cross(dFdx(pos), dFdy(pos)));
vec3 normalFromTexture = normalize(texture(normalMap, uv).xyz * 2.0 - 1.0);
float blendFactor = smoothstep(0.15, 0.2, depthError);
normal = normalize(mix(normalReconstructed, normalFromTexture, blendFactor));
angleCutoffAdjust = mix(0.0, 0.004, blendFactor);
float ddepth = fwidth(linearDepth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / linearDepth);
return true;
}`),c.contrastControlEnabled?h.uniforms.add(new l.Texture2DPassUniform("frameColor",((e,t)=>e.colors)),new r.FloatPassUniform("globalAlphaContrastBoost",(e=>e.globalAlphaContrastBoost))).code.add(o.glsl`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`):h.code.add(o.glsl`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/LaserlinePath.glsl":function(){define(["exports","../core/libs/gl-matrix-2/math/mat4","../core/libs/gl-matrix-2/factories/mat4f64","../core/libs/gl-matrix-2/math/vec2","../core/libs/gl-matrix-2/factories/vec2f64","../views/3d/webgl-engine/core/shaderLibrary/Laserline.glsl","../views/3d/webgl-engine/core/shaderModules/Float2BindUniform","../views/3d/webgl-engine/core/shaderModules/FloatBindUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Matrix4BindUniform","../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform","../views/3d/webgl-engine/lib/VertexAttribute","../views/webgl/ShaderBuilder"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d){"use strict";function p(e){const i=new d.ShaderBuilder;i.include(r.Laserline,e);const{vertex:s,fragment:p}=i;s.uniforms.add(new u.Matrix4PassUniform("modelView",((e,{camera:i})=>t.translate(_,i.viewMatrix,e.origin))),new h.Matrix4BindUniform("proj",(({camera:e})=>e.projectionMatrix)),new l.FloatPassUniform("glowWidth",((e,{camera:t})=>e.glowWidth*t.pixelRatio)),new o.Float2BindUniform("pixelToNDC",(({camera:e})=>n.set(g,2/e.fullViewport[2],2/e.fullViewport[3])))),i.attributes.add(m.VertexAttribute.START,"vec3"),i.attributes.add(m.VertexAttribute.END,"vec3"),e.spherical&&(i.attributes.add(m.VertexAttribute.START_UP,"vec3"),i.attributes.add(m.VertexAttribute.END_UP,"vec3")),i.attributes.add(m.VertexAttribute.EXTRUDE,"vec2"),i.varyings.add("uv","vec2"),i.varyings.add("vViewStart","vec3"),i.varyings.add("vViewEnd","vec3"),i.varyings.add("vViewSegmentNormal","vec3"),i.varyings.add("vViewStartNormal","vec3"),i.varyings.add("vViewEndNormal","vec3");const f=!e.spherical;return s.main.add(c.glsl`
    vec3 pos = mix(start, end, extrude.x);

    vec4 viewPos = modelView * vec4(pos, 1);
    vec4 projPos = proj * viewPos;
    vec2 ndcPos = projPos.xy / projPos.w;

    // in planar we hardcode the up vectors to be Z-up */
    ${c.If(f,c.glsl`vec3 startUp = vec3(0, 0, 1);`)}
    ${c.If(f,c.glsl`vec3 endUp = vec3(0, 0, 1);`)}

    // up vector corresponding to the location of the vertex, selecting either startUp or endUp */
    vec3 up = extrude.y * mix(startUp, endUp, extrude.x);
    vec3 viewUp = (modelView * vec4(up, 0)).xyz;

    vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
    vec2 projUp = normalize(projPosUp.xy / projPosUp.w - ndcPos);

    // extrude ndcPos along projUp to the edge of the screen
    vec2 lxy = abs(sign(projUp) - ndcPos);
    ndcPos += length(lxy) * projUp;

    vViewStart = (modelView * vec4(start, 1)).xyz;
    vViewEnd = (modelView * vec4(end, 1)).xyz;

    vec3 viewStartEndDir = vViewEnd - vViewStart;

    vec3 viewStartUp = (modelView * vec4(startUp, 0)).xyz;

    // the normal of the plane that aligns with the segment and the up vector
    vViewSegmentNormal = normalize(cross(viewStartUp, viewStartEndDir));

    // the normal orthogonal to the segment normal and the start up vector
    vViewStartNormal = -normalize(cross(vViewSegmentNormal, viewStartUp));

    // the normal orthogonal to the segment normal and the end up vector
    vec3 viewEndUp = (modelView * vec4(endUp, 0)).xyz;
    vViewEndNormal = normalize(cross(vViewSegmentNormal, viewEndUp));

    // Add enough padding in the X screen space direction for "glow"
    float xPaddingPixels = sign(dot(vViewSegmentNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
    ndcPos.x += xPaddingPixels * pixelToNDC.x;

    // uv is used to read back depth to reconstruct the position at the fragment
    uv = ndcPos * 0.5 + 0.5;

    gl_Position = vec4(ndcPos, 0, 1);
  `),p.uniforms.add(new a.FloatBindUniform("perScreenPixelRatio",(e=>e.camera.perScreenPixelRatio))),p.code.add(c.glsl`float planeDistance(vec3 planeNormal, vec3 planeOrigin, vec3 pos) {
return dot(planeNormal, pos - planeOrigin);
}
float segmentDistancePixels(vec3 segmentNormal, vec3 startNormal, vec3 endNormal, vec3 pos, vec3 start, vec3 end) {
float distSegmentPlane = planeDistance(segmentNormal, start, pos);
float distStartPlane = planeDistance(startNormal, start, pos);
float distEndPlane = planeDistance(endNormal, end, pos);
float dist = max(max(distStartPlane, distEndPlane), abs(distSegmentPlane));
float width = fwidth(distSegmentPlane);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}`),p.main.add(c.glsl`fragColor = vec4(0.0);
vec3 dEndStart = vViewEnd - vViewStart;
if (dot(dEndStart, dEndStart) < 1e-5) {
return;
}
vec3 pos;
vec3 normal;
float angleCutoffAdjust;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, angleCutoffAdjust, depthDiscontinuityAlpha)) {
return;
}
float distance = segmentDistancePixels(
vViewSegmentNormal,
vViewStartNormal,
vViewEndNormal,
pos,
vViewStart,
vViewEnd
);
vec4 color = laserlineProfile(distance);
float alpha = (1.0 - smoothstep(0.995 - angleCutoffAdjust, 0.999 - angleCutoffAdjust, abs(dot(normal, vViewSegmentNormal))));
fragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);`),i}const g=s.create(),_=i.create(),f=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));e.LaserlinePath=f,e.build=p}))},"esri/views/3d/webgl-engine/effects/laserlines/LaserlinePathTechniqueConfiguration":function(){define(["exports","../../../../../chunks/tslib.es6","../../core/shaderTechnique/ShaderTechniqueConfiguration"],(function(e,t,i){"use strict";class n extends i.ShaderTechniqueConfiguration{constructor(){super(...arguments),this.contrastControlEnabled=!1,this.spherical=!1}}t.__decorate([i.parameter()],n.prototype,"contrastControlEnabled",void 0),t.__decorate([i.parameter()],n.prototype,"spherical",void 0),e.LaserlinePathTechniqueConfiguration=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/laserlines/LaserlineTechniqueConfiguration":function(){define(["exports","../../../../../chunks/tslib.es6","../../core/shaderTechnique/ShaderTechniqueConfiguration","./LaserlinePathTechniqueConfiguration"],(function(e,t,i,n){"use strict";class s extends n.LaserlinePathTechniqueConfiguration{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1}}t.__decorate([i.parameter()],s.prototype,"heightManifoldEnabled",void 0),t.__decorate([i.parameter()],s.prototype,"pointDistanceEnabled",void 0),t.__decorate([i.parameter()],s.prototype,"lineVerticalPlaneEnabled",void 0),t.__decorate([i.parameter()],s.prototype,"intersectsLineEnabled",void 0),e.LaserlineTechniqueConfiguration=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/ParallelLineVisualElement":function(){define(["exports","../../../../core/reactiveUtils","../../../../core/screenUtils","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../layers/graphics/dehydratedPoint","./EngineVisualElement","../../terrain/OverlayRenderer","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Material","../../webgl-engine/lib/RenderGeometry","../../webgl-engine/lib/VertexAttribute","../../webgl-engine/materials/RibbonLineMaterial"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_){"use strict";class f extends h.EngineVisualElement{constructor(e){super(e),this._location=o.create(),this._direction=o.fromValues(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=l.fromValues(1,0,1,1),this._renderOccluded=d.RenderOccludedFlag.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:v,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry(),forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:P,recreateGeometry:e=>this._recreateDrapedGeometry(e),forEachMaterial:(e,t)=>t(e.material)}}get location(){return this._location}set location(e){r.exactEquals(this._location,e)||(r.copy(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){r.exactEquals(this._direction,e)||(r.copy(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){r.normalize(this._direction,r.subtract(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){a.exactEquals(e,this._color)||(a.copy(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}_createObject3DResources(e){const t=new _.RibbonLineMaterial(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[n,s]=y(e);t.addGeometry(n),t.addGeometry(s),i.push(n),i.push(s),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new _.RibbonLineMaterial(this.materialParameters),i=t.watch((()=>this.view.state.contentPixelRatio),(()=>this.drapedResources.recreateGeometry()));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:i}}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=y(e);return this._updateVerticesDraped(t),t.map((e=>new p.RenderGeometry(e)))}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,w),r.add(b,this.location,this.direction),t.projectToScreen(b,T),n.normalize(T,n.subtract(T,T,w)),this._updateVertexAttributesObject3D(t,e,0,w,T,1),this._updateVertexAttributesObject3D(t,e,1,w,T,-1)}_updateVertexAttributesObject3D(e,t,n,s,r,o){const a=t.geometries[n],l=a.getMutableAttribute(g.VertexAttribute.POSITION)?.data;if(!l)return;const{start:c,end:h}=x(r,s,o,this.offset,this.width,this.length);e.unprojectFromScreen(i.castScreenPointArray(c),b),l[0]=b[0],l[1]=b[1],l[2]=b[2],e.unprojectFromScreen(i.castScreenPointArray(h),b),l[3]=b[0],l[4]=b[1],l[5]=b[2],t.geometryVertexAttributeUpdated(a,g.VertexAttribute.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:n,width:s,length:r,offset:o}=this,a=D;a.spatialReference=t.renderer.spatialReference,a.x=n[0],a.y=n[1];const l=this.view.overlayPixelSizeInMapUnits(a)*i,c=s*l,h=r*l,u=o*l;this._updateVertexAttributesDraped(e[0],c,h,u,-1),this._updateVertexAttributesDraped(e[1],c,h,u,1)}_updateVertexAttributesDraped(e,t,i,n,s){const r=e.getMutableAttribute(g.VertexAttribute.POSITION)?.data;if(!r)return;const{location:o,direction:a}=this,{start:l,end:c}=x(a,o,s,n,t,i);r[0]=l[0],r[1]=l[1],r[2]=u.drapedZ,r[3]=c[0],r[4]=c[1],r[5]=u.drapedZ,e.invalidateBoundingInfo()}}function y(e){return[m.createPolylineGeometry(e,[o.create(),o.create()]),m.createPolylineGeometry(e,[o.create(),o.create()])]}function x(e,t,i,s,r,o){const a=n.scale(E,n.set(E,e[1]*i,e[0]*-i),s+r/2),l=n.add(S,n.add(S,n.add(S,t,n.scale(S,e,o/2)),a),a);return{start:l,end:n.add(C,l,n.scale(C,e,-o))}}function v(e){e.geometries.length=0}function P(e){e.pixelRatioHandle.remove(),e.geometries=[]}const b=o.create(),E=s.create(),S=s.create(),C=s.create(),w=i.createScreenPointArray(),T=i.createScreenPointArray(),D=c.makeDehydratedPoint(0,0,void 0,null);e.ParallelLineVisualElement=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/PointVisualElement":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/projection/projectVectorToVector","../../../../geometry/support/aaBoundingBox","../../../../geometry/support/vectorStacks","../../../ViewingMode","./Object3DVisualElement","../../layers/graphics/elevationAlignmentUtils","../../layers/graphics/ElevationContext","../../support/engineContent/sdfPrimitives","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/VertexAttribute","../../webgl-engine/materials/HUDMaterial"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_){"use strict";class f extends h.Object3DVisualElement{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=r.fromValues(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=r.fromValues(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){s.exactEquals(e,this._color)||(s.copy(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){s.exactEquals(e,this._outlineColor)||(s.copy(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material?.setParameters(this._materialParameters)}_updateSizeAttribute(){const e=this.object;if(null==e)return;const t=e.geometries[0];if(null==t)return;const i=t.getMutableAttribute(g.VertexAttribute.SIZE).data,n=this._geometrySize;i[0]=n,i[1]=n,e.geometryVertexAttributeUpdated(e.geometries[0],g.VertexAttribute.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:d.requiresHalfTexelOffset(this._primitive),distanceFieldBoundingBox:d.defaultBoundingBox,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawAsLabel:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/d.defaultSymbolSizeRatio}createExternalResources(){this._texture=d.createTexture(this._primitive,this._preferredTextureSize),this._material=new _.HUDMaterial(this._materialParameters,this.view.state.viewingMode===c.ViewingMode.Global);const e=this.view.stage;this._texture.load(e.renderView.renderingContext),e.addTexture(this._texture)}destroyExternalResources(){this._texture&&(this.view.stage.removeTexture(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){const t=this._createRenderGeometry();null!=t&&e.addGeometry(t)}forEachMaterial(e){e(this._material)}get _preferredTextureSize(){return t.clamp(2*this._geometrySize,16,128)}calculateMapBounds(e){const t=this.object?.geometries[0];if(!t)return!1;const i=t.attributes.get(g.VertexAttribute.POSITION).data;return o.projectVectorToVector(i,this.view.renderCoordsHelper.spatialReference,y,this.view.spatialReference),a.expandWithBuffer(e,y),!0}_createRenderGeometry(){const{geometry:e,_material:t}=this;if(null==e||null==t)return null;const{renderCoordsHelper:n,elevationProvider:s}=this.view,r=u.evaluateElevationAlignmentAtPoint(e,s,m.ElevationContext.fromElevationInfo(this.elevationInfo),n),a=i.set(l.sv3d.get(),e.x,e.y,r),c=l.sv3d.get();o.projectVectorToVector(a,e.spatialReference,c,n.spatialReference);const h=this._geometrySize;return p.createPointGeometry(t,{position:c,size:[h,h],centerOffsetAndDistance:[0,0,0,1]})}}const y=n.create();e.PointVisualElement=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/Object3DVisualElement":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","./VisualElement","../../webgl-engine/lib/Object3D","../../webgl-engine/lib/UpdatePolicy","../../webgl-engine/lib/WebGLLayer"],(function(e,t,i,n,s,r,o){"use strict";class a extends n.VisualElement{constructor(e){super(e),this._resources=null,this._transform=i.create()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(e){t.copy(this._transform,e),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const e=this._resources.object;e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible}createResources(){this.destroyResources();const e=this.view.stage;if(!e)return;const t=new o.WebGLLayer(e,{pickable:!1,updatePolicy:r.UpdatePolicy.SYNC}),i=new s.Object3D({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),t.add(i),i.visible=this.visible,this._resources={layer:t,object:i}}destroyResources(){const e=this.view.stage;null!=this._resources&&e&&(this._resources.layer.destroy(),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){null!=this._resources&&(this._resources.object.visible=e)}}e.Object3DVisualElement=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/RightAngleQuadVisualElement":function(){define(["exports","../../../../core/reactiveUtils","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/support/vectorStacks","../../../../layers/graphics/dehydratedPoint","./EngineVisualElement","../../terrain/OverlayRenderer","../../webgl-engine/lib/Attribute","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Material","../../webgl-engine/lib/RenderGeometry","../../webgl-engine/lib/VertexAttribute","../../webgl-engine/materials/ColorMaterial","../../webgl-engine/materials/RibbonLineMaterial"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x){"use strict";class v extends h.EngineVisualElement{constructor(e){super(e),this._maxSize=0,this._position=r.create(),this._up=r.create(),this._right=r.create(),this._renderOccluded=g.RenderOccludedFlag.OccludeAndTransparent,this._color=a.fromValues(1,0,0,1),this._outlineColor=a.fromValues(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=g.RenderOccludedFlag.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D(),forEachMaterial:(e,t)=>{t(e.outlineMaterial),t(e.quadMaterial)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:P,forEachMaterial:(e,t)=>{t(e.outlineMaterial),t(e.quadMaterial)}}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateOutlineMaterial(),this._updateQuadMaterial()}get color(){return this._color}set color(e){o.copy(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){o.copy(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min(s.distance(t,e),s.distance(t,i))/3,s.normalize(this._up,s.subtract(this._up,e,t)),s.normalize(this._right,s.subtract(this._right,i,t)),s.copy(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new y.ColorMaterial(this._quadMaterialParameters),i=0===this._outlineSize?void 0:new x.RibbonLineMaterial(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,i),{quadMaterial:t,outlineMaterial:i}}_createObject3DGeometries(e,t,i){if(s.exactEquals(this._up,r.ZEROS)&&s.exactEquals(this._right,r.ZEROS))return;const n=this._createGeometries(t,i);for(const t of n)e.addGeometry(t);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new y.ColorMaterial(this._quadMaterialParameters),i=0===this._outlineSize?void 0:new x.RibbonLineMaterial(this._outlineMaterialParameters),n=this._createGeometries(e,i).map((e=>new _.RenderGeometry(e)));return this._setTransformDraped(n),{quadMaterial:e,outlineMaterial:i,geometries:n,pixelRatioHandle:t.watch((()=>this.view.state.contentPixelRatio),(()=>this.drapedResources.recreateGeometry()))}}_createGeometries(e,t){const{up:i,right:n,corner:s}=this._getVertices(),r=function(e,t,i,n){return new d.Geometry(n,[[f.VertexAttribute.POSITION,new m.Attribute([0,0,0,...t,...e,...i],[0,1,2,1,2,3],3,!0)]])}(i,n,s,e);return t?[r,p.createPolylineGeometry(t,[i,s,n])]:[r]}_getVertices(){let e=this._up,t=this._right;const i=s.add(l.sv3d.get(),e,t);return this.isDraped&&(e=s.copy(l.sv3d.get(),e),t=s.copy(l.sv3d.get(),t),e[2]=0,t[2]=0,i[2]=0),{up:e,right:t,corner:i}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;const t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,n);i.fromTranslation(b,this._position),i.scale(b,b,[s,s,s]),e.transformation=b}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:n}}}=this,{_position:r,_size:o}=this,a=s.copy(l.sv3d.get(),r);a[2]=u.drapedZ;const c=E;c.spatialReference=t.renderer.spatialReference,c.x=a[0],c.y=a[1];const h=o*(this.view.overlayPixelSizeInMapUnits(c)*n),m=Math.min(this._maxSize,h);i.fromTranslation(b,a),i.scale(b,b,[m,m,1]);for(const t of e)t.transformation=b}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}function P(e){e.pixelRatioHandle.remove(),e.geometries=[]}const b=n.create(),E=c.makeDehydratedPoint(0,0,void 0,null);e.RightAngleQuadVisualElement=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../effects/geometry/olidUtils","../lib/basicInterfaces","../lib/GLMaterial","../lib/OrderIndependentTransparency","../lib/RenderSlot","../lib/VertexAttribute","./DefaultBufferWriter","./TriangleMaterial","./VisualVariablePassParameters","../shaders/ColorMaterialTechnique","../shaders/ColorMaterialTechniqueConfiguration","../../../../webscene/support/AlphaCutoff"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g){"use strict";class _ extends u.TriangleMaterial{constructor(e){super(e,y),this._configuration=new p.ColorMaterialTechniqueConfiguration,this.supportsEdges=!0,this.produces=new Map([[l.RenderSlot.OPAQUE_MATERIAL,e=>this._isOpaqueMaterialPass(e)],[l.RenderSlot.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>this._isOpaqueNoSSAODepthPass(e)],[l.RenderSlot.TRANSPARENT_MATERIAL,e=>n.isColorOrColorEmissionOrOID(e)&&this._transparent&&this.parameters.writeDepth],[l.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,e=>n.isDepth(e)&&this._transparent&&this.parameters.writeDepth],[l.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>n.isColorOrColorEmissionOrOID(e)&&this._transparent&&!this.parameters.writeDepth],[l.RenderSlot.DRAPED_MATERIAL,e=>n.is2DGeometryOutput(e)]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<a.OITPolygonOffsetLimit,this._configuration.terrainDepthTest=t.terrainDepthTest&&n.isColorOrColorEmission(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=g.alphaCutoff}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===n.ShaderOutput.Highlight||n.isColorOrColorEmissionOrOID(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return n.isDepth(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new f(e)}createBufferWriter(){const e=i.newLayout().vec3f(c.VertexAttribute.POSITION);return s.olidEnabled()&&e.vec4u8(c.VertexAttribute.OLIDCOLOR),this.parameters.vvColor?e.f32(c.VertexAttribute.COLORFEATUREATTRIBUTE):e.vec4u8(c.VertexAttribute.COLOR),new h.DefaultBufferWriter(e)}}class f extends o{beginSlot(e){return this.getTechnique(d.ColorMaterialTechnique,e)}}class y extends m.VisualVariablePassParameters{constructor(){super(...arguments),this.color=t.ZEROS,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=r.CullFaceOptions.None,this.draped=!1,this.discardInvisibleFragments=!1}}e.ColorMaterial=_,e.Parameters=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/TriangleMaterial":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64","../lib/Material","../lib/RayIntersections"],(function(e,t,i,n){"use strict";class s extends i.Material{constructor(){super(...arguments),this._pp0=t.fromValues(0,0,1),this._pp1=t.fromValues(0,0,0)}intersect(e,t,i,s,r,o){return n.intersectTriangleGeometry(e,i,s,r,void 0,o)}intersectDraped(e,t,i,s){return this._pp0[0]=this._pp1[0]=i[0],this._pp0[1]=this._pp1[1]=i[1],n.intersectTriangleGeometry(e,t,this._pp0,this._pp1,void 0,s)}}e.TriangleMaterial=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/factories/vec4f64","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../lib/OITPass","../lib/OrderIndependentTransparency","../lib/StencilUtils","../materials/VisualVariablePassParameters","../../../../chunks/ColorMaterial.glsl","../../../webgl/renderState"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";class m extends c.VisualVariablePassParameters{constructor(){super(...arguments),this.color=i.ZEROS}}class d extends r.ShaderTechnique{constructor(t,i){super(t,i,new s.ReloadableShaderModule(h.ColorMaterial,(()=>new Promise(((t,i)=>e(["./ColorMaterial.glsl"],t,i))))))}_createPipeline(e,t){const{oitPass:i,output:s,transparent:c,cullFace:h,draped:m,hasOccludees:d,polygonOffset:g}=e,_=i===o.OITPass.NONE;return u.makePipelineState({blending:n.isColorOrColorEmission(s)&&c?a.blending(i):null,culling:u.cullingParams(h),depthTest:m?null:{func:a.oitDepthTest(i)},depthWrite:a.depthWrite(e),drawBuffers:r.depthOnlyOutputBuffersOr(s,a.getDrawBuffers(i,s)),colorWrite:u.defaultColorWrite,stencilWrite:d?l.stencilWriteMaskOn:null,stencilTest:d?t?l.stencilToolMaskBaseParams:l.stencilBaseAllZerosParams:null,polygonOffset:_?g?p:null:a.oitPolygonOffset(e)})}initializePipeline(e){return this._occludeePipelineState=this._createPipeline(e,!0),this._createPipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const p={factor:1,units:1};t.ColorMaterialPassParameters=m,t.ColorMaterialTechnique=d,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/ColorMaterial.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl","../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl","../views/3d/webgl-engine/core/shaderModules/Float4PassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/lib/VertexAttribute","../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl","../views/webgl/ShaderBuilder"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d){"use strict";function p(e){const p=new d.ShaderBuilder,{vertex:g,fragment:_,attributes:f,varyings:y}=p,{vvColor:x,hasVertexColors:v}=e;return l.addProjViewLocalOrigin(g,e),p.include(i.Transform,e),p.include(s.VertexColor,e),p.include(o.VisualVariables,e),p.include(n.ObjectAndLayerIdColor,e),_.include(t.SliceDraw,e),p.include(m.outputColorHighlightOID,e),p.include(r.terrainDepthTest,e),f.add(u.VertexAttribute.POSITION,"vec3"),x&&f.add(u.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),v||y.add("vColor","vec4"),y.add("vpos","vec3",{invariant:!0}),g.uniforms.add(new c.Float4PassUniform("uColor",(e=>e.color))),g.main.add(h.glsl`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${v?"vColor *= uColor;":x?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vpos);`),_.include(a.ColorConversion),_.main.add(h.glsl`discardBySlice(vpos);
discardByTerrainDepth();
outputColorHighlightOID(vColor, vpos, vColor.rgb);`),p}const g=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));e.ColorMaterial=g,e.build=p}))},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../core/shaderLibrary/output/Emissions.glsl","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/basicInterfaces","../materials/DefaultTechniqueConfiguration"],(function(e,t,i,n,s,r,o){"use strict";class a extends o.DefaultTechniqueConfiguration{constructor(){super(...arguments),this.cullFace=r.CullFaceOptions.None,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1,this.textureCoordinateType=i.TextureCoordinateType.None,this.emissionSource=n.EmissionSource.None,this.occlusionPass=!1,this.hasVvInstancing=!0,this.vvSize=!1,this.vvOpacity=!1,this.snowCover=!1}}t.__decorate([s.parameter({count:r.CullFaceOptions.COUNT})],a.prototype,"cullFace",void 0),t.__decorate([s.parameter()],a.prototype,"hasVertexColors",void 0),t.__decorate([s.parameter()],a.prototype,"transparent",void 0),t.__decorate([s.parameter()],a.prototype,"discardInvisibleFragments",void 0),t.__decorate([s.parameter()],a.prototype,"polygonOffset",void 0),t.__decorate([s.parameter()],a.prototype,"enableOffset",void 0),t.__decorate([s.parameter()],a.prototype,"writeDepth",void 0),t.__decorate([s.parameter()],a.prototype,"hasOccludees",void 0),t.__decorate([s.parameter()],a.prototype,"terrainDepthTest",void 0),t.__decorate([s.parameter()],a.prototype,"cullAboveTerrain",void 0),t.__decorate([s.parameter()],a.prototype,"objectAndLayerIdColorInstanced",void 0),t.__decorate([s.parameter()],a.prototype,"vvColor",void 0),t.__decorate([s.parameter()],a.prototype,"draped",void 0),e.ColorMaterialTechniqueConfiguration=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/sketch/normalizedPoint":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../layers/graphics/dehydratedPoint","../../../support/elevationInfoUtils"],(function(e,t,i,n){"use strict";var s;function r(e=0,i=0,n=0){return t.fromValues(e,i,n)}function o(e,t,i,s=r()){return s[0]=e.x,s[1]=e.y,s[2]=e.z??0,null==t||("2d"===t.type?s[2]=0:s[2]=n.getConvertedElevation(t,e,i,n.absoluteHeightElevationInfo)??0),s}!function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"}(s||(s={}));const a=i.makeDehydratedPoint(0,0,0,null);e.asVec2=function(e){return e},e.clone=function(e){const[t,i,n]=e;return e.length>3?[t,i,n,e[3]]:[t,i,n]},e.create=function(e,t,i){return r(e,t,i)},e.createWritable=r,e.fromAnyMapPoint=function(e,t,{coordinateHelper:i,elevationInfo:n},s){return e?o(i.vectorToDehydratedPoint(e,a),t,n,s):null},e.fromPoint=o,e.fromValues=function(e,i,n){return t.fromValues(e,i,n)},e.fromVec3=function(e){return e},e.isTarget=function(e){return Boolean(((e.length>3?e[3]:void 0)??s.NONE)&s.TARGET)},e.markAsTarget=function(e){return e[3]=((e.length>3?e[3]:void 0)??s.NONE)|s.TARGET,e},e.toDehydratedPoint=function(e,t,n){return n?(i.setDehydratedPoint(n,e[0],e[1],e[2],t),n):i.makeDehydratedPoint(e[0],e[1],e[2],t)},e.toElevationAlignedDehydratedPoint=function(e,t,{z:s,m:r},o,a){const{spatialReference:l,elevationInfo:c}=o;let h;if(null==s&&null==r)h=void 0;else if(null==t||"2d"===t.type)h=s??void 0;else{const i=n.absoluteHeightElevationInfo;h=n.getConvertedElevationFromVector(t,e,l,i,c)??0}const[u,m]=e;return a?i.setDehydratedPoint(a,u,m,h,l):a=i.makeDehydratedPoint(u,m,h,l),null!=r&&(a.m=r,a.hasM=!0),a},e.withSelfSnappingZ=function(e,t,i,o,a=r()){const[l,c]=e;return a[0]=l,a[1]=c,e.length>3&&(a[3]=e[3]??s.NONE),"3d"!==i?.type?(a[2]=t.value,a):(a[2]=n.getConvertedElevationFromXYZ(i,l,c,t.value,o,t.elevationInfo,n.absoluteHeightElevationInfo)??0,a)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/Settings":function(){define(["exports","../../../chunks/tslib.es6","../../../Color","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass"],(function(e,t,i,n,s,r){"use strict";let o=class extends n{constructor(){super(...arguments),this.enabled=!0}};t.__decorate([s.property({type:Boolean})],o.prototype,"enabled",void 0),o=t.__decorate([r.subclass("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],o);let a=class extends n{constructor(e){super(e),this.lineSnapper=new o,this.parallelLineSnapper=new o,this.rightAngleSnapper=new o,this.rightAngleTriangleSnapper=new o,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new i([255,127,0]),this.orangeTransparent=new i([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};t.__decorate([s.property({type:o,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"lineSnapper",void 0),t.__decorate([s.property({type:o,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"parallelLineSnapper",void 0),t.__decorate([s.property({type:o,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"rightAngleSnapper",void 0),t.__decorate([s.property({type:o,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"rightAngleTriangleSnapper",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],a.prototype,"shortLineThreshold",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],a.prototype,"distance",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"pointThreshold",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"intersectionParallelLineThreshold",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"parallelLineThreshold",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"verticalLineThresholdMeters",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"touchSensitivityMultiplier",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"pointOnLineThreshold",void 0),t.__decorate([s.property({type:i,nonNullable:!0})],a.prototype,"orange",void 0),t.__decorate([s.property({type:i,nonNullable:!0})],a.prototype,"orangeTransparent",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"lineHintWidthReference",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"lineHintWidthTarget",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"lineHintFadedExtensions",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"parallelLineHintWidth",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],a.prototype,"parallelLineHintLength",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],a.prototype,"parallelLineHintOffset",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],a.prototype,"rightAngleHintSize",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],a.prototype,"rightAngleHintOutlineSize",void 0),t.__decorate([s.property({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],a.prototype,"satisfiesConstraintScreenThreshold",void 0),a=t.__decorate([r.subclass("esri.views.interactive.snapping.Settings.Defaults")],a);const l=new a;e.defaults=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/SnappingDomain":function(){define(["exports"],(function(e){"use strict";var t;e.SnappingDomain=void 0,(t=e.SnappingDomain||(e.SnappingDomain={}))[t.FEATURE=1]="FEATURE",t[t.SELF=2]="SELF",t[t.ALL=3]="ALL",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/snappingUtils":function(){define(["exports","../../../core/reactiveUtils","../../../core/SetUtils","../../../core/sql","../../../core/timeUtils","../../../chunks/vec32","../../../layers/graphics/dehydratedPoint","../../../rest/support/Query","../../input/InputManager","../keybindings","../sketch/normalizedPoint","../../../webmap/utils"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";const m=Symbol("grid-placement-graphic");function d(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n}var p;e.LineSegmentHintType=void 0,(p=e.LineSegmentHintType||(e.LineSegmentHintType={}))[p.TARGET=0]="TARGET",p[p.REFERENCE=1]="REFERENCE",p[p.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION";const g=Symbol("snapping-toggle");e.editEdgeToSnappingEdge=function(e,t,i){return{left:h.fromAnyMapPoint(e.leftVertex.pos,t,i),right:h.fromAnyMapPoint(e.rightVertex.pos,t,i)}},e.gridPlacementGraphicSymbol=m,e.isUtilityNetworkWebMap=function(e){return u.isWebMap(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length},e.makeSnappingQuery=function({parameters:{point:e,distance:t,returnEdge:r,vertexMode:l,coordinateHelper:{spatialReference:c},filter:h},mode:u,returnZ:m,filter:d}){const p=d?.clone()??new a({where:"1=1"});return p.returnZ=m??"3d"===u,h&&(p.geometry=h.geometry,p.distance=h.distance,p.spatialRelationship=h.spatialRelationship,p.where=n.sqlAnd(p.where,h.where),p.timeExtent=s.mergeTimeExtents(p.timeExtent,h.timeExtent),p.objectIds=(g=p.objectIds,_=h.objectIds,g||_?_?g?Array.from(i.intersection(new Set(g),new Set(_))):_:g:null)),{point:o.makeDehydratedPoint(e[0],e[1],e[2],c.toJSON()),mode:u,distance:t,returnEdge:r,vertexMode:l,query:p.toJSON()};var g,_},e.objectEqual=function(e,t){const i=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return i;case 3:return i&&e[2]===t[2];case 4:return i&&e[2]===t[2]&&e[3]===t[3]}return!1},e.screenDistance=function(e,t){return Math.sqrt(d(e,t))},e.setupSnappingToggleHandles=function(e,i=()=>{}){const n=t.watch((()=>({view:e.view,snappingOptions:e.snappingOptions})),(({view:t,snappingOptions:n})=>{if(e.removeHandles(g),!t||!n)return;const s=l.ViewEventPriorities.TOOL,r=[t.on("key-down",(e=>{e.key!==c.snappingKeys.toggle||e.repeat||(n.enabledToggled=!0,i())}),s),t.on("key-up",(e=>{e.key===c.snappingKeys.toggle&&(n.enabledToggled=!1,i())}),s),t.on("pointer-move",(e=>{const t=e.native.ctrlKey;n.enabledToggled!==t&&(n.enabledToggled=t,i())}),s)];e.addHandles(r,g)}),t.syncAndInitial);e.addHandles(n)},e.sortCandidatesInPlace=function(e,t){t.sort(((t,i)=>r.squaredDistance(t.targetPoint,e)-r.squaredDistance(i.targetPoint,e)))},e.squaredScreenDistance=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/SnappingVisualizer":function(){define(["exports","../../../core/handleUtils","./hints/IntersectionSnappingHint","./hints/LineSnappingHint","./hints/ParallelSnappingHint","./hints/PointSnappingHint","./hints/RightAngleSnappingHint"],(function(e,t,i,n,s,r,o){"use strict";e.SnappingVisualizer=class{draw(e,a){const l=function(e){const t=[];for(const i of e){let e=!0;for(const n of t)if(i.equals(n)){e=!1;break}e&&t.push(i)}return t}(e),c=this.sortUniqueHints(l),h=[];for(const e of c)e instanceof i.IntersectionSnappingHint&&h.push(this.visualizeIntersectionPoint(e,a)),e instanceof n.LineSnappingHint&&h.push(this.visualizeLine(e,a)),e instanceof s.ParallelSnappingHint&&h.push(this.visualizeParallelSign(e,a)),e instanceof o.RightAngleSnappingHint&&h.push(this.visualizeRightAngleQuad(e,a)),e instanceof r.PointSnappingHint&&h.push(this.visualizePoint(e,a));return t.handlesGroup(h)}sortUniqueHints(e){return e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/hints/IntersectionSnappingHint":function(){define(["exports","../../../../chunks/vec32","../SnappingDomain","./SnappingHint"],(function(e,t,i,n){"use strict";class s extends n.SnappingHint{constructor(e,t,n=i.SnappingDomain.ALL){super(t,n),this.intersectionPoint=e}equals(e){return e instanceof s&&t.exactEquals(this.intersectionPoint,e.intersectionPoint)}}e.IntersectionSnappingHint=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/hints/SnappingHint":function(){define(["exports"],(function(e){"use strict";e.SnappingHint=class{constructor(e,t){this.isDraped=e,this.domain=t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/hints/LineSnappingHint":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../chunks/vec32","../SnappingDomain","./SnappingHint"],(function(e,t,i,n,s,r){"use strict";class o extends r.SnappingHint{constructor(e,t,i,n,r=s.SnappingDomain.ALL,o=!0,a=!0){super(n,r),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof o&&this.type===e.type&&n.exactEquals(this.lineStart,e.lineStart)&&n.exactEquals(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return n.distance(this.lineStart,this.lineEnd)}}e.LineSnappingHint=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/hints/ParallelSnappingHint":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../chunks/vec32","../SnappingDomain","./SnappingHint"],(function(e,t,i,n,s,r){"use strict";class o extends r.SnappingHint{constructor(e,t,i,n=s.SnappingDomain.ALL){super(i,n),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof o&&n.exactEquals(this.lineStart,e.lineStart)&&n.exactEquals(this.lineEnd,e.lineEnd)}}e.ParallelSnappingHint=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/hints/PointSnappingHint":function(){define(["exports","../../../../chunks/vec32","./SnappingHint"],(function(e,t,i){"use strict";class n extends i.SnappingHint{constructor(e,t,i){super(t,i),this.point=e}equals(e){return e instanceof n&&t.exactEquals(this.point,e.point)}}e.PointSnappingHint=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/hints/RightAngleSnappingHint":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../chunks/vec32","../SnappingDomain","./SnappingHint"],(function(e,t,i,n,s,r){"use strict";class o extends r.SnappingHint{constructor(e,t,i,n,r=s.SnappingDomain.ALL){super(n,r),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof o&&n.exactEquals(this.previousVertex,e.previousVertex)&&n.exactEquals(this.centerVertex,e.centerVertex)&&n.exactEquals(this.nextVertex,e.nextVertex)}}e.RightAngleSnappingHint=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/meshFastUpdateUtils":function(){define(["exports","../../../../core/handleUtils","../../../../core/reactiveUtils","../../../../layers/graphics/sources/interfaces"],(function(e,t,i,n){"use strict";e.meshTransformFastUpdateHandles=function(e){const s=e.graphic;return s?[i.watch((()=>"visible"in e?e.visible:e.displaying),(e=>{e&&s.notifyMeshTransformChanged({action:n.MeshTransformUpdateAction.EnableFastUpdates})}),{...i.syncAndInitial}),t.makeHandle((()=>s.notifyMeshTransformChanged({action:n.MeshTransformUpdateAction.DisableFastUpdates})))]:[]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/sources/interfaces":function(){define(["exports"],(function(e){"use strict";var t;e.MeshTransformUpdateAction=void 0,(t=e.MeshTransformUpdateAction||(e.MeshTransformUpdateAction={}))[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/settings":function(){define(["exports","../../../../chunks/tslib.es6","../../../../Color","../../../../core/Accessor","../../../../core/colorUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../visualElements/ExtendedLineVisualElement","../../webgl-engine/lib/Material","../../webgl-engine/materials/lineStippleUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m){"use strict";const d=.3;function p(e,t){t&&Object.assign(e,t)}class g{constructor(e){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=u.RenderOccludedFlag.Opaque,this.color=e.accent}}class _{constructor({colors:e,...t}){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=e.accent,this.outlineColor=e.outline,this.renderOccluded=u.RenderOccludedFlag.Opaque,this.hoverOutlineColor=e.selectedOutline,p(this,t)}applyColor(e){this._apply(this.color,e)}applyOutline(e){this._apply(this.outlineColor,e)}applyHoverOutline(e){this._apply(this.hoverOutlineColor,e)}_apply(e,t){t.setParameters({color:s.unitRGBAFromColor(e),renderOccluded:this.renderOccluded})}}class f{constructor({colors:e,...t}){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=u.RenderOccludedFlag.Transparent,this.minSquaredEdgeLength=900,this.color=s.multiplyOpacity(e.accent,.5),this.hoverColor=e.accent,p(this,t)}applyColor(e){this._apply(this.color,e)}applyHover(e){this._apply(this.hoverColor,e)}_apply(e,t){t.setParameters({color:s.unitRGBAFromColor(e),renderOccluded:this.renderOccluded})}}class y{constructor(e){this.vertex=new _({colors:e,color:e.accent,outlineColor:e.outline}),this.edge=new _({colors:e,color:s.desaturate(s.multiplyOpacity(e.accent,2/3),.5),outlineColor:s.multiplyOpacity(e.outline,.5),size:8,collisionPadding:8}),this.selected=new _({colors:e,color:e.selected,outlineColor:e.outline}),this.edgeOffset=new f({colors:e})}}class x{constructor({colors:e,...t}){this.width=1.5,this.stipplePattern=m.createStipplePatternSimple(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=u.RenderOccludedFlag.OccludeAndTransparent,this.color=e.selected,this.stippleOffColor=e.outline,this.innerColor=e.selected,p(this,t)}apply(e){e.color=s.unitRGBAFromColor(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=s.unitRGBAFromColor(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=s.unitRGBAFromColor(this.innerColor),e.renderOccluded=this.renderOccluded}}class v{constructor({colors:e,...t}){this.size=4,this.outlineSize=1,this.shape="square",this.color=e.selected,this.outlineColor=e.outline,p(this,t)}apply(e){e.color=s.unitRGBAFromColor(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=s.unitRGBAFromColor(this.outlineColor),e.primitive=this.shape}}class P{constructor({colors:e,...t}){this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=d,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=e.selected,this.glowColor=e.accent,this.heightFillColor=e.accent,p(this,t)}apply(e,t=1){const n={glowColor:i.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:i.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=n:e.laserlineStyle=n}}class b{constructor(e){this.outline=new x({colors:e,color:e.stippleOff,renderOccluded:u.RenderOccludedFlag.OccludeAndTransparentStencil,stippleOffColor:e.stippleOn,innerWidth:0}),this.staged=new x({colors:e,color:e.stippleOn,renderOccluded:u.RenderOccludedFlag.OccludeAndTransparentStencil,innerColor:e.stagedSolid,stippleOffColor:e.stippleOff}),this.shadowStyle=new P({colors:e,globalAlpha:d,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1})}}class E{constructor(e){this.outline=new v({colors:e,color:e.selected,outlineColor:e.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new P({colors:e,globalAlpha:d,glowColor:e.accent,glowFalloff:1.5,glowWidth:6,innerColor:e.selected,innerWidth:1,radius:2})}}class S extends x{constructor({colors:e,...t}){super({colors:e}),this.extensionType=h.ExtensionType.GROUND_RAY,p(this,t)}}class C{constructor(e){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineObjects=new b(e),this.pointObjects=new E(e),this.heightPlane=new P({colors:e,globalAlpha:d,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1}),this.heightBox=new P({colors:e,globalAlpha:d,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:0,heightFillColor:e.accent}),this.zVerticalLine=new S({colors:e,color:s.multiplyOpacity(e.accent,.5),falloff:2,innerColor:s.multiplyOpacity(e.selected,0),renderOccluded:u.RenderOccludedFlag.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:h.ExtensionType.GROUND_RAY})}}e.Settings=class extends n{constructor(e){super(e)}get colors(){const e=this.getTheme().accentColor,t=e.a;return{accent:e,contrast:s.getContrast(e),selected:i.fromArray([255,255,255,t]),selectedOutline:i.fromArray([255,255,255,t]),staged:i.fromArray([12,207,255,t]),stagedSolid:i.fromArray([12,207,255,1]),outline:i.fromArray([0,0,0,.5*t]),stippleOn:i.fromArray([255,255,255,1]),stippleOff:i.fromArray([0,0,0,.5])}}get visualElements(){return new C(this.colors)}get manipulators(){return new y(this.colors)}get zManipulator(){return new g(this.colors)}},t.__decorate([r.property()],e.Settings.prototype,"colors",null),t.__decorate([r.property()],e.Settings.prototype,"visualElements",null),t.__decorate([r.property()],e.Settings.prototype,"manipulators",null),t.__decorate([r.property()],e.Settings.prototype,"zManipulator",null),t.__decorate([r.property()],e.Settings.prototype,"getTheme",void 0),e.Settings=t.__decorate([c.subclass("esri.views.3d.interactive.editingTools.settings")],e.Settings),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports"],(function(e){"use strict";const t={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},i={dash:t.dash,"dash-dot":[...t.dash,...t.dot],dot:t.dot,"long-dash":t["long-dash"],"long-dash-dot":[...t["long-dash"],...t.dot],"long-dash-dot-dot":[...t["long-dash"],...t.dot,...t.dot],none:null,"short-dash":t["short-dash"],"short-dash-dot":[...t["short-dash"],...t["short-dot"]],"short-dash-dot-dot":[...t["short-dash"],...t["short-dot"],...t["short-dot"]],"short-dot":t["short-dot"],solid:null};function n(e){return null!=e?null==(t=i[e])?t:{pattern:t.slice(),pixelRatio:8}:null;var t}e.createStipplePatternSimple=function(e){return{pattern:[e,e],pixelRatio:2}},e.getStipplePatternForLinePattern=function(e){return"style"===e?.type?n(e.style):null},e.getStipplePatternForPatternStyle=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/OutlineVisualElement":function(){define(["exports","../../../../core/Evented","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/projection/projectBuffer","../../../../geometry/support/aaBoundingBox","../../../../geometry/support/DoubleArray","../../../../layers/graphics/dehydratedPoint","../../../../support/elevationInfoUtils","../../../../symbols/support/ElevationInfo","./EngineVisualElement","./LaserlineVisualElement","../../layers/graphics/ElevationContext","../../support/engineContent/line","../../support/renderInfoUtils/line","../../webgl-engine/lib/Material","../../webgl-engine/lib/RenderGeometry","../../webgl-engine/lib/VertexAttribute","../../webgl-engine/materials/RibbonLineMaterial"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v){"use strict";class P extends m.EngineVisualElement{constructor(e){super(e),this._attachmentOrigin=c.makeDehydratedPoint(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new t,this._geometry=null,this._width=1,this._color=r.fromValues(1,0,1,1),this._innerWidth=0,this._innerColor=r.fromValues(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=f.RenderOccludedFlag.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new d.LaserlineVisualElement({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:b,recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)},forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:b,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()},forEachMaterial:(e,t)=>t(e.material)}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}get geometry(){return this._geometry}set geometry(e){const t=this._isClosed;this._geometry=e,this.recreateGeometry(),t!==this._isClosed&&this._updateMaterial()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){s.exactEquals(e,this._color)||(s.copy(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){s.exactEquals(e,this._innerColor)||(s.copy(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&s.exactEquals(e,this._stippleOffColor)||(this._stippleOffColor=e?r.clone(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=this.object3dResources.resources?.geometries;if(!e||0===e.length)return null;i.set(S,0,0,0);let t=0;for(const n of e)n.computeAttachmentOrigin(E)&&(i.add(S,S,E),t++);return 0===t?null:(i.scale(S,S,1/t),this.view.renderCoordsHelper.fromRenderCoords(S,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources?.material.setParameters(this._materialParameters),this.drapedResources.resources?.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===f.RenderOccludedFlag.OccludeAndTransparentStencil?f.RenderOccludedFlag.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,i){this._createRenderGeometries(t,i);for(const t of i)e.addGeometry(t);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createObject3DResources(e){const t=new v.RibbonLineMaterial(this._materialParameters),i=new Array;return this._recreateGeometry(e,t,i),{material:t,geometries:i}}_createDrapedResources(){const e=new v.RibbonLineMaterial(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:i}=this,n=i.basemapTerrain.spatialReference;return null==t||null==n?[]:_.geometryToRenderInfoDraped(t,n).lines.map((({position:t})=>{const s={overlayInfo:{spatialReference:n,renderCoordsHelper:i.renderCoordsHelper},attributeData:{position:t},removeDuplicateStartEnd:this._isClosed};return new y.RenderGeometry(g.createGeometry(e,s))}))}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const i of this.object3dResources.resources.geometries){const n=i.attributes.get(x.VertexAttribute.POSITION),s=l.newDoubleArray(n.data.length);o.projectBuffer(n.data,t.spatialReference,0,s,this.view.spatialReference,0),a.expandWithBuffer(e,s)}return!0}_createRenderGeometries(e,t){const i=this.geometry;if(null==i)return;const n=_.geometryToRenderInfo(i,this.view.elevationProvider,this.view.renderCoordsHelper,p.ElevationContext.fromElevationInfo(this.elevationInfo??new u({mode:h.getGeometryEffectiveElevationMode(i,null)}))),s=new Array;for(const{position:i,mapPositions:r}of n.lines){const n={mapPositions:r,attributeData:{position:i},removeDuplicateStartEnd:this._isClosed};t.push(g.createGeometry(e,n)),s.push(i)}this._laserline.pathVerticalPlane=s}}function b(e){e.geometries=[]}const E=n.create(),S=n.create();e.OutlineVisualElement=P,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/engineContent/line":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/projectors","../../../../geometry/support/DoubleArray","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices","../../../ViewingMode","../../webgl-engine/lib/Attribute","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/VertexAttribute","../../webgl-engine/lib/IntersectableGeometry"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d){"use strict";const p=i.create(),g=i.create();e.createGeometry=function(e,i,_=null){const f=[],y=i.mapPositions;!function(e,t){const{attributeData:{position:i},removeDuplicateStartEnd:n}=e,s=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(i)&&n,r=i.length/3-(s?1:0),o=new Array(2*(r-1)),a=s?i.slice(0,-3):i;let l=0;for(let e=0;e<r-1;e++)o[l++]=e,o[l++]=e+1;t.push([m.VertexAttribute.POSITION,new h.Attribute(a,o,3,s)])}(i,f);const x=f[0][1].data,v=f[0][1].indices.length,P=l.getZeroIndexArray(v);return function(e,t,i){if(null!=e.attributeData.colorFeature)return;const s=e.attributeData.color;t.push([m.VertexAttribute.COLOR,new h.Attribute(s??n.ONES,i,4)])}(i,f,P),function(e,t,i){null==e.attributeData.sizeFeature&&t.push([m.VertexAttribute.SIZE,new h.Attribute([e.attributeData.size??1],i,1,!0)])}(i,f,P),function(e,t,i){e.attributeData.normal&&t.push([m.VertexAttribute.NORMAL,new h.Attribute(e.attributeData.normal,i,3)])}(i,f,P),function(e,t,i){null!=e.attributeData.colorFeature&&t.push([m.VertexAttribute.COLORFEATUREATTRIBUTE,new h.Attribute([e.attributeData.colorFeature],i,1,!0)])}(i,f,P),function(e,t,i){null!=e.attributeData.sizeFeature&&t.push([m.VertexAttribute.SIZEFEATUREATTRIBUTE,new h.Attribute([e.attributeData.sizeFeature],i,1,!0)])}(i,f,P),function(e,t,i){null!=e.attributeData.opacityFeature&&t.push([m.VertexAttribute.OPACITYFEATUREATTRIBUTE,new h.Attribute([e.attributeData.opacityFeature],i,1,!0)])}(i,f,P),function(e,i,n){if(null==e.overlayInfo||e.overlayInfo.renderCoordsHelper.viewingMode!==c.ViewingMode.Global||!e.overlayInfo.spatialReference.isGeographic)return;const l=o.newDoubleArray(n.length),u=s.getReferenceEllipsoid(e.overlayInfo.spatialReference);for(let e=0;e<l.length;e+=3)r.lonLatToWebMercatorComparable(n,e,l,e,u);const d=n.length/3,_=a.newFloatArray(d+1);let f=p,y=g,x=0,v=0;t.set(f,l[v++],l[v++]),v++,_[0]=0;for(let e=1;e<d+1;++e)e===d&&(v=0),t.set(y,l[v++],l[v++]),v++,x+=t.dist(f,y),_[e]=x,[f,y]=[y,f];i.push([m.VertexAttribute.DISTANCETOSTART,new h.Attribute(_,i[0][1].indices,1,!0)])}(i,f,x),new u.Geometry(e,f,y,d.GeometryType.Line,_)},e.lineStripsToParameters=function(e,t){if(null==e||0===e.length)return[];const i=[];return e.forEach((e=>{const n=e.length,s=o.newDoubleArray(3*n);e.forEach(((e,t)=>{s[3*t]=e[0],s[3*t+1]=e[1],s[3*t+2]=e[2]}));const r={attributeData:{position:s,normal:t},removeDuplicateStartEnd:!1};i.push(r)})),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/renderInfoUtils/line":function(){define(["exports","../../../../geometry/projection/projectBuffer","../../../../geometry/support/DoubleArray","../../../../geometry/support/triangulationUtils","../../layers/graphics/elevationAlignmentUtils","../../terrain/OverlayRenderer"],(function(e,t,i,n,s,r){"use strict";function o(e,t,n=null){const s=new Array;for(const{index:r,count:o}of e){if(o<=1)continue;const e=3*r,a=3*o;s.push({position:i.doubleSubArray(t,3*r,3*o),mapPositions:null!=n?i.doubleSubArray(n,e,a):void 0})}return s}e.geometryToRenderInfo=function(e,t,r,a){const l="polygon"===e.type?n.CounterClockwiseMode.CCW_IS_HOLE:n.CounterClockwiseMode.NONE,c="polygon"===e.type?e.rings:e.paths,{position:h,outlines:u}=n.ringsToTriangulationInfo(c,!!e.hasZ,l,e.spatialReference),m=i.newDoubleArray(h.length),d=s.applyPerVertexElevationAlignment(h,e.spatialReference,0,m,0,h,0,h.length/3,t,r,a),p=null!=d;return{lines:p?o(u,h,m):[],projectionSuccess:p,sampledElevation:d}},e.geometryToRenderInfoDraped=function(e,i){const s="polygon"===e.type?n.CounterClockwiseMode.CCW_IS_HOLE:n.CounterClockwiseMode.NONE,a="polygon"===e.type?e.rings:e.paths,{position:l,outlines:c}=n.ringsToTriangulationInfo(a,!1,s),h=t.projectBuffer(l,e.spatialReference,0,l,i,0);for(let e=2;e<l.length;e+=3)l[e]=r.drapedZ;return{lines:h?o(c,l):[],projectionSuccess:h}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/triangulationUtils":function(){define(["exports","../../chunks/earcut","./Axis","./coordsUtils","./DoubleArray","./Indices","./polygonUtils","./meshUtils/deduplicate"],(function(e,t,i,n,s,r,o,a){"use strict";function l(t,i,n,r){const o=t.length,a=new Array(o),l=new Array(o),u=new Array(o);let m=0;for(let e=0;e<o;++e)m+=t[e].length;let d=0,p=0,g=0;const _=s.newDoubleArray(3*m);let f=0;for(let s=o-1;s>=0;s--){const m=t[s],y=n===e.CounterClockwiseMode.CCW_IS_HOLE&&h(m,i,r);if(y&&1!==o)a[d++]=m;else{let e=m.length;for(let t=0;t<d;++t)e+=a[t].length;const t={index:f,pathLengths:new Array(d+1),count:e,holeIndices:new Array(d)};t.pathLengths[0]=m.length,m.length>0&&(u[g++]={index:f,count:m.length}),f=y?c(m,m.length-1,-1,_,f,m.length,i):c(m,0,1,_,f,m.length,i);for(let e=0;e<d;++e){const n=a[e];t.holeIndices[e]=f,t.pathLengths[e+1]=n.length,n.length>0&&(u[g++]={index:f,count:n.length}),f=c(n,0,1,_,f,n.length,i)}d=0,t.count>0&&(l[p++]=t)}}for(let e=0;e<d;++e){const t=a[e];t.length>0&&(u[g++]={index:f,count:t.length}),f=c(t,0,1,_,f,t.length,i)}return l.length=p,u.length=g,{position:_,polygons:l,outlines:u}}function c(e,t,i,n,s,r,o){s*=3;for(let a=0;a<r;++a){const r=e[t];n[s++]=r[0],n[s++]=r[1],n[s++]=o&&r[2]?r[2]:0,t+=i}return s/3}function h(e,t,s){if(!t)return!n.isClockwise(e);const r=e.length-1;switch(o.leastSignificantAxis(e,r,s)){case i.Axis.X:return!n.isClockwise(e,i.Axis.Y,i.Axis.Z);case i.Axis.Y:return!n.isClockwise(e,i.Axis.X,i.Axis.Z);case i.Axis.Z:return!n.isClockwise(e,i.Axis.X,i.Axis.Y)}}var u;e.CounterClockwiseMode=void 0,(u=e.CounterClockwiseMode||(e.CounterClockwiseMode={}))[u.NONE=0]="NONE",u[u.CCW_IS_HOLE=1]="CCW_IS_HOLE",e.isCounterClockwise=h,e.ringsToTriangulationInfo=l,e.triangulate=function(i){const n=l(i.rings,i.hasZ,e.CounterClockwiseMode.CCW_IS_HOLE,i.spatialReference),o=new Array;let c=0,h=0;for(const e of n.polygons){const i=e.count,a=e.index,l=s.doubleSubArray(n.position,3*a,3*i),u=e.holeIndices.map((e=>e-a)),m=r.compactMeshIndices(t.earcut(l,u,3));o.push({position:l,faces:m}),c+=l.length,h+=m.length}const u=function(e,t,i){if(1===e.length)return e[0];const n=s.newDoubleArray(t),o=new Array(i);let a=0,l=0,c=0;for(const t of e){for(let e=0;e<t.position.length;e++)n[a++]=t.position[e];for(const e of t.faces)o[l++]=e+c;c=a/3}return{position:n,faces:r.compactMeshIndices(o)}}(o,c,h),m=Array.isArray(u.position)?a.deduplicate(u.position,3,{originalIndices:u.faces}):a.deduplicate(u.position.buffer,6,{originalIndices:u.faces});return u.position=s.doubleArrayFrom(new Float64Array(m.buffer)),u.faces=m.indices,u},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/earcut":function(){define(["exports"],(function(e){"use strict";function t(e,t,r){r=r||2;var o,a,l,h,m,d,g,_=t&&t.length,f=_?t[0]*r:e.length,y=i(e,0,f,r,!0),x=[];if(!y||y.next===y.prev)return x;if(_&&(y=function(e,t,s,r){var o,a,l,h=[];for(o=0,a=t.length;o<a;o++)(l=i(e,t[o]*r,o<a-1?t[o+1]*r:e.length,r,!1))===l.next&&(l.steiner=!0),h.push(p(l));for(h.sort(c),o=0;o<h.length;o++)s=n(s=u(h[o],s),s.next);return s}(e,t,y,r)),e.length>80*r){o=l=e[0],a=h=e[1];for(var v=r;v<f;v+=r)(m=e[v])<o&&(o=m),(d=e[v+1])<a&&(a=d),m>l&&(l=m),d>h&&(h=d);g=0!==(g=Math.max(l-o,h-a))?1/g:0}return s(y,x,r,o,a,g),x}function i(e,t,i,n,s){var r,o;if(s===T(e,t,i,n)>0)for(r=t;r<i;r+=n)o=S(r,e[r],e[r+1],o);else for(r=i-n;r>=t;r-=n)o=S(r,e[r],e[r+1],o);if(o&&y(o,o.next)){var a=o.next;C(o),o=a}return o}function n(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!y(n,n.next)&&0!==f(n.prev,n,n.next))n=n.next;else{var s=n.prev;if(C(n),(n=t=s)===n.next)break;i=!0}}while(i||n!==t);return t}function s(e,t,i,c,h,u,m){if(e){!m&&u&&function(e,t,i,n){var s=e;do{null===s.z&&(s.z=d(s.x,s.y,t,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){var t,i,n,s,r,o,a,l,c=1;do{for(i=e,e=null,r=null,o=0;i;){for(o++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(s=i,i=i.nextZ,a--):(s=n,n=n.nextZ,l--),r?r.nextZ=s:e=s,s.prevZ=r,r=s;i=n}r.nextZ=null,c*=2}while(o>1)}(s)}(e,c,h,u);for(var p,g,_=e;e.prev!==e.next;)if(p=e.prev,g=e.next,u?o(e,c,h,u):r(e))t.push(p.i/i),t.push(e.i/i),t.push(g.i/i),C(e),e=g.next,_=g.next;else if((e=g)===_){m?1===m?s(e=a(n(e),t,i),t,i,c,h,u,2):2===m&&l(e,t,i,c,h,u):s(n(e),t,i,c,h,u,1);break}}}function r(e){var t=e.prev,i=e,n=e.next;if(f(t,i,n)>=0)return!1;for(var s=e.next.next;s!==e.prev;){if(g(t.x,t.y,i.x,i.y,n.x,n.y,s.x,s.y)&&f(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function o(e,t,i,n){var s=e.prev,r=e,o=e.next;if(f(s,r,o)>=0)return!1;for(var a=s.x<r.x?s.x<o.x?s.x:o.x:r.x<o.x?r.x:o.x,l=s.y<r.y?s.y<o.y?s.y:o.y:r.y<o.y?r.y:o.y,c=s.x>r.x?s.x>o.x?s.x:o.x:r.x>o.x?r.x:o.x,h=s.y>r.y?s.y>o.y?s.y:o.y:r.y>o.y?r.y:o.y,u=d(a,l,t,i,n),m=d(c,h,t,i,n),p=e.prevZ,_=e.nextZ;p&&p.z>=u&&_&&_.z<=m;){if(p!==e.prev&&p!==e.next&&g(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&f(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,_!==e.prev&&_!==e.next&&g(s.x,s.y,r.x,r.y,o.x,o.y,_.x,_.y)&&f(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;p&&p.z>=u;){if(p!==e.prev&&p!==e.next&&g(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&f(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;_&&_.z<=m;){if(_!==e.prev&&_!==e.next&&g(s.x,s.y,r.x,r.y,o.x,o.y,_.x,_.y)&&f(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function a(e,t,i){var s=e;do{var r=s.prev,o=s.next.next;!y(r,o)&&x(r,s,s.next,o)&&b(r,o)&&b(o,r)&&(t.push(r.i/i),t.push(s.i/i),t.push(o.i/i),C(s),C(s.next),s=e=o),s=s.next}while(s!==e);return n(s)}function l(e,t,i,r,o,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&_(l,c)){var h=E(l,c);return l=n(l,l.next),h=n(h,h.next),s(l,t,i,r,o,a),void s(h,t,i,r,o,a)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function h(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function u(e,t){var i=function(e,t){var i,n=t,s=e.x,r=e.y,o=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=s&&a>o){if(o=a,a===s){if(r===n.y)return n;if(r===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(s===o)return i;var l,c=i,h=i.x,u=i.y,d=1/0;n=i;do{s>=n.x&&n.x>=h&&s!==n.x&&g(r<u?s:o,r,h,u,r<u?o:s,r,n.x,n.y)&&(l=Math.abs(r-n.y)/(s-n.x),b(n,e)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&m(i,n)))&&(i=n,d=l)),n=n.next}while(n!==c);return i}(e,t);if(!i)return t;var s=E(i,e),r=n(i,i.next);let o=h(s);return n(o,o.next),r=h(r),h(t===i?r:t)}function m(e,t){return f(e.prev,e,t.prev)<0&&f(t.next,e,e.next)<0}function d(e,t,i,n,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function g(e,t,i,n,s,r,o,a){return(s-o)*(t-a)-(e-o)*(r-a)>=0&&(e-o)*(n-a)-(i-o)*(t-a)>=0&&(i-o)*(r-a)-(s-o)*(n-a)>=0}function _(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&x(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var i=e,n=!1,s=(e.x+t.x)/2,r=(e.y+t.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(f(e.prev,e,t.prev)||f(e,t.prev,t))||y(e,t)&&f(e.prev,e,e.next)>0&&f(t.prev,t,t.next)>0)}function f(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,i,n){var s=P(f(e,t,i)),r=P(f(e,t,n)),o=P(f(i,n,e)),a=P(f(i,n,t));return s!==r&&o!==a||!(0!==s||!v(e,i,t))||!(0!==r||!v(e,n,t))||!(0!==o||!v(i,e,n))||!(0!==a||!v(i,t,n))}function v(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function P(e){return e>0?1:e<0?-1:0}function b(e,t){return f(e.prev,e,e.next)<0?f(e,t,e.next)>=0&&f(e,e.prev,t)>=0:f(e,t,e.prev)<0||f(e,e.next,t)<0}function E(e,t){var i=new w(e.i,e.x,e.y),n=new w(t.i,t.x,t.y),s=e.next,r=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function S(e,t,i,n){var s=new w(e,t,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function w(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(e,t,i,n){for(var s=0,r=t,o=i-n;r<i;r+=n)s+=(e[o]-e[r])*(e[r+1]+e[o+1]),o=r;return s}t.deviation=function(e,t,i,n){var s=t&&t.length,r=s?t[0]*i:e.length,o=Math.abs(T(e,0,r,i));if(s)for(var a=0,l=t.length;a<l;a++){var c=t[a]*i,h=a<l-1?t[a+1]*i:e.length;o-=Math.abs(T(e,c,h,i))}var u=0;for(a=0;a<n.length;a+=3){var m=n[a]*i,d=n[a+1]*i,p=n[a+2]*i;u+=Math.abs((e[m]-e[p])*(e[d+1]-e[m+1])-(e[m]-e[d])*(e[p+1]-e[m+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},t.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,s=0;s<e.length;s++){for(var r=0;r<e[s].length;r++)for(var o=0;o<t;o++)i.vertices.push(e[s][r][o]);s>0&&(n+=e[s-1].length,i.holes.push(n))}return i},e.earcut=t}))},"esri/geometry/support/polygonUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils","../../chunks/vec32","./Axis","./plane"],(function(e,t,i,n,s,r){"use strict";function o(e,t,s,o){const a=(l=t,Array.isArray(l[0])?(e,i)=>t[e][i]:(e,i)=>t[3*e+i]);var l;const c=o?i.getMetersPerUnitForSR(o)/i.getMetersPerVerticalUnitForSR(o):1;return r.fromManyPoints(e,((e,t)=>n.set(e,a(t,0)*c,a(t,1)*c,a(t,2))),s)}const a=r.create();e.fitPlane=o,e.leastSignificantAxis=function(e,i,n){const l=o(a,e,i,n)?r.getNormal(a):[0,0,1];return Math.abs(l[2])>Math.cos(t.deg2rad(80))?s.Axis.Z:Math.abs(l[1])>Math.abs(l[0])?s.Axis.Y:s.Axis.X},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils","../Indices"],(function(e,t,i){"use strict";function n(e,t,i,n){for(let s=0;s<n;s++)if(e[t+s]!==e[i+s])return!1;return!0}function s(e,t,i,n,s){for(let r=0;r<s;r++)i[n+r]=e[t+r]}function r(e,t,i){let n=0;for(let s=0;s<i;s++)n=e[t+s]+n|0,n=n+(n<<11)+(n>>>2)|0;return n>>>0}let o=null;e.deduplicate=function(e,a,l){const c=Array.isArray(e),h=c?e.length/a:e.byteLength/(4*a),u=c?e:new Uint32Array(e,0,h*a),m=l?.minReduction??0,d=l?.originalIndices||null,p=d?d.length:0,g=l?.componentOffsets||null;let _=0;if(g)for(let e=0;e<g.length-1;e++){const t=g[e+1]-g[e];t>_&&(_=t)}else _=h;const f=Math.floor(1.1*_)+1;(null==o||o.length<2*f)&&(o=new Uint32Array(t.nextHighestPowerOfTwo(2*f)));for(let e=0;e<2*f;e++)o[e]=0;let y=0;const x=!!g&&!!d,v=x?p:h;let P=i.newIndexArray(h);const b=new Uint32Array(p),E=1.96;let S=0!==m?Math.ceil(4*E*E/(m*m)*m*(1-m)):v,C=1,w=g?g[1]:v;for(let e=0;e<v;e++){if(e===S){const t=1-y/e;if(t+E*Math.sqrt(t*(1-t)/e)<m)return null;S*=2}if(e===w){for(let e=0;e<2*f;e++)o[e]=0;if(d)for(let e=g[C-1];e<g[C];e++)b[e]=P[d[e]];w=g[++C]}const t=x?d[e]:e,i=t*a,s=r(u,i,a);let l=s%f,c=y;for(;0!==o[2*l+1];){if(o[2*l]===s){const e=o[2*l+1]-1;if(n(u,i,e*a,a)){c=P[e];break}}l++,l>=f&&(l-=f)}c===y&&(o[2*l]=s,o[2*l+1]=t+1,y++),P[t]=c}if(0!==m&&1-y/h<m)return null;if(x){for(let e=g[C-1];e<b.length;e++)b[e]=P[d[e]];P=i.compactMeshIndices(b)}const T=c?new Array(y):new Uint32Array(y*a);y=0;for(let e=0;e<v;e++)P[e]===y&&(s(u,(x?d[e]:e)*a,T,y*a,a),y++);if(d&&!x){const e=new Uint32Array(p);for(let t=0;t<e.length;t++)e[t]=P[d[t]];P=i.compactMeshIndices(e)}return{buffer:Array.isArray(T)?T:T.buffer,indices:P,uniqueCount:y}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/VerticesVisualElement":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","./Object3DVisualElement","../../layers/graphics/ElevationContext","../../support/renderInfoUtils/point","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Material","../../webgl-engine/materials/ShadedColorMaterial"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";class m extends r.Object3DVisualElement{constructor(e){super(e),this.view=null,this._renderOccluded=h.RenderOccludedFlag.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=s.fromArray([1,127/255,0,1]),this._size=11,this._outlineColor=s.fromArray([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){n.exactEquals(e,this._color)||(n.copy(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){n.exactEquals(e,this._outlineColor)||(n.copy(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const i=a.geometryToRenderInfo(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,o.ElevationContext.fromElevationInfo(this.elevationInfo)),n=[],s=i.numVertices,r=i.position;for(let e=0;e<s;++e){const i=t.set(d,r[3*e],r[3*e+1],r[3*e+2]),s=p(this._vertexMaterial,.5,i),o=p(this._vertexOutlineMaterial,.5,i);n.push({vertexGeometry:s,vertexOutlineGeometry:o})}return n}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:n}of t)e.addGeometry(i),e.addGeometry(n)}createExternalResources(){this._vertexMaterial=new u.ShadedColorMaterial({...this._vertexMaterialParameters,writeDepth:!0,cullFace:l.CullFaceOptions.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new u.ShadedColorMaterial({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:l.CullFaceOptions.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const d=i.create();function p(e,t,i){return c.createSphereGeometry(e,t,16,16,{offset:i})}e.VerticesVisualElement=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/renderInfoUtils/point":function(){define(["exports","../../../../geometry/support/DoubleArray","../../layers/graphics/elevationAlignmentUtils"],(function(e,t,i){"use strict";e.geometryToRenderInfo=function(e,n,s,r,o){const a=t.newDoubleArray(3*e.length),l=t.newDoubleArray(a.length);e.forEach(((e,t)=>{a[3*t]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));const c=i.applyPerVertexElevationAlignment(a,n,0,l,0,a,0,a.length/3,s,r,o),h=null!=c;return{numVertices:e.length,position:a,mapPositions:l,projectionSuccess:h,sampledElevation:c}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/ShadedColorMaterial":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/support/aaBoundingBox","../../../../geometry/support/buffer/BufferView","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../lib/basicInterfaces","../lib/GLMaterial","../lib/Material","../lib/RayIntersections","../lib/RenderSlot","../lib/Util","../lib/VertexAttribute","./internal/bufferWriterUtils","../shaders/ShadedColorMaterialTechnique","../shaders/ShadedColorMaterialTechniqueConfiguration","../../../../webscene/support/AlphaCutoff"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y){"use strict";class x extends h.Material{constructor(e){super(e,P),this._configuration=new f.ShadedColorMaterialTechniqueConfiguration,this.vertexAttributeLocations=_.vertexAttributeLocations,this.supportsEdges=!0,this._pp0=i.fromValues(0,0,1),this._pp1=i.fromValues(0,0,0),this.produces=new Map([[m.RenderSlot.OPAQUE_MATERIAL,e=>e===a.ShaderOutput.Highlight||a.isColorOrOID(e)&&!this.parameters.transparent],[m.RenderSlot.TRANSPARENT_MATERIAL,e=>a.isColorOrOID(e)&&this.parameters.transparent&&this.parameters.writeDepth],[m.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>a.isColorOrOID(e)&&this.parameters.transparent&&!this.parameters.writeDepth]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest&&a.isColorOrColorEmission(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color[3]>=y.alphaCutoff}intersect(e,t,i,n,s,r){this._intersect(e,i,n,s,r)}intersectDraped(e,t,i,n){return this._pp0[0]=this._pp1[0]=i[0],this._pp0[1]=this._pp1[1]=i[1],this._intersect(e,t,this._pp0,this._pp1,n)}_intersect(e,i,n,r,o){if(this.parameters.screenSizeEnabled){const a=e.attributes.get(p.VertexAttribute.OFFSET),l={applyToVertex:(e,n,s,r)=>{const o=t.set(E,a.data[3*r],a.data[3*r+1],a.data[3*r+2]),l=t.set(S,e,n,s);return t.scale(o,o,this.parameters.screenSizeScale*(i.camera?.computeScreenPixelSizeAt(o)??1)),t.add(l,l,o),[l[0],l[1],l[2]]},applyToAabb:e=>{const t=s.center(e,E);return s.scale(e,this.parameters.screenSizeScale*(i.camera?.computeScreenPixelSizeAt(t)??1))}};u.intersectTriangleGeometry(e,i,n,r,l,o)}else u.intersectTriangleGeometry(e,i,n,r,void 0,o)}createGLMaterial(e){return new v(e)}createBufferWriter(){return new b(this.parameters.screenSizeEnabled)}}class v extends c{beginSlot(e){return this.getTechnique(_.ShadedColorMaterialTechnique,e)}}class P extends h.MaterialParameters{constructor(){super(...arguments),this.color=n.fromValues(1,1,1,1),this.shadingTint=n.fromValues(0,0,0,.25),this.shadingDirection=t.normalize(i.create(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=l.CullFaceOptions.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}get transparent(){return this.color[3]<1||this.forceTransparentMode}}class b{constructor(e){this.screenSizeEnabled=e;const t=o.newLayout().vec3f(p.VertexAttribute.POSITION).vec3f(p.VertexAttribute.NORMAL);this.screenSizeEnabled&&t.vec3f(p.VertexAttribute.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.get(p.VertexAttribute.POSITION).indices.length}write(e,t,i,n,s,o){const a=g.writeDefaultAttributes(i,n,this.vertexBufferLayout,e,t,s,o);if(this.screenSizeEnabled){if(!i.has(p.VertexAttribute.OFFSET))throw new Error(`${p.VertexAttribute.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const e=i.get(p.VertexAttribute.OFFSET);d.assert(3===e.size);const n=s.getField(p.VertexAttribute.OFFSET,r.BufferViewVec3f);if(!n)throw new Error("unable to acquire view for "+p.VertexAttribute.OFFSET);g.writePosition(e,t,n,o)}}return a}}const E=i.create(),S=i.create();e.Parameters=P,e.ShadedColorMaterial=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/ShadedColorMaterialTechnique":function(){define(["require","exports","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../lib/OITPass","../lib/OrderIndependentTransparency","../lib/VertexAttribute","../../../../chunks/ShadedColorMaterial.glsl","../../../webgl/enums","../../../webgl/renderState"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";class u extends s.ShaderTechnique{constructor(t,i){super(t,i,new n.ReloadableShaderModule(l.ShadedColorMaterial,(()=>new Promise(((t,i)=>e(["./ShadedColorMaterial.glsl"],t,i))))),m)}initializePipeline(e){const{oitPass:t,output:n,transparent:s,cullFace:a,shadingEnabled:l}=e,u=t===r.OITPass.NONE,m=t===r.OITPass.FrontFace;return h.makePipelineState({blending:i.isColorOrColorEmission(n)&&s?o.blending(t):null,culling:h.cullingParams(a),depthTest:{func:m?c.CompareFunction.LESS:l?c.CompareFunction.LEQUAL:c.CompareFunction.LESS},depthWrite:o.depthWrite(e),drawBuffers:o.getDrawBuffers(t,n),colorWrite:h.defaultColorWrite,polygonOffset:u||m?null:o.OITPolygonOffset})}}const m=new Map([[a.VertexAttribute.POSITION,0],[a.VertexAttribute.NORMAL,1],[a.VertexAttribute.OFFSET,2]]);t.ShadedColorMaterialTechnique=u,t.vertexAttributeLocations=m,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/ShadedColorMaterial.glsl":function(){define(["exports","../core/libs/gl-matrix-2/factories/vec4f64","../views/3d/webgl-engine/core/shaderLibrary/ScreenSizeScaling.glsl","../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl","../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl","../views/3d/webgl-engine/core/shaderModules/Float3PassUniform","../views/3d/webgl-engine/core/shaderModules/Float4PassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/lib/VertexAttribute","../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl","../views/webgl/ShaderBuilder"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d){"use strict";function p(e){const t=new d.ShaderBuilder;t.include(s.Transform,e),t.include(i.ScreenSizeScaling,e),t.fragment.include(n.SliceDraw,e),t.include(m.outputColorHighlightOID,e),t.include(r.terrainDepthTest,e);const{vertex:p,fragment:_}=t;return _.include(o.ColorConversion),a.addProjViewLocalOrigin(p,e),_.uniforms.add(new c.Float4PassUniform("uColor",(e=>e.color))),t.attributes.add(u.VertexAttribute.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),e.screenSizeEnabled&&t.attributes.add(u.VertexAttribute.OFFSET,"vec3"),e.shadingEnabled&&(a.addViewNormal(p),t.attributes.add(u.VertexAttribute.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3"),_.uniforms.add(new l.Float3PassUniform("shadingDirection",(e=>e.shadingDirection))),_.uniforms.add(new c.Float4PassUniform("shadedColor",(e=>function(e,t){const i=1-e[3],n=e[3]+t[3]*i;return 0===n?(g[3]=n,g):(g[0]=(e[0]*e[3]+t[0]*t[3]*i)/n,g[1]=(e[1]*e[3]+t[1]*t[3]*i)/n,g[2]=(e[2]*e[3]+t[2]*t[3]*i)/n,g[3]=t[3],g)}(e.shadingTint,e.color))))),p.main.add(h.glsl`
      vWorldPosition = ${e.screenSizeEnabled?h.glsl`screenSizeScaling(offset, position)`:h.glsl`position`};
      ${e.shadingEnabled?h.glsl`vec3 worldNormal = normal;
                 vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`:""}
      forwardViewPosDepth((view * vec4(vWorldPosition, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vWorldPosition);
  `),_.main.add(h.glsl`
      discardBySlice(vWorldPosition);
      discardByTerrainDepth();
      ${e.shadingEnabled?h.glsl`vec3 viewNormalNorm = normalize(vViewNormal);
             float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
             vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`:h.glsl`vec4 finalColor = uColor;`}
      outputColorHighlightOID(finalColor, vWorldPosition, finalColor.rgb);`),t}const g=t.create(),_=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));e.ShadedColorMaterial=_,e.build=p}))},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSizeScaling.glsl":function(){define(["exports","./util/View.glsl","../shaderModules/FloatBindUniform","../shaderModules/FloatPassUniform","../shaderModules/glsl"],(function(e,t,i,n,s){"use strict";e.ScreenSizeScaling=function(e,r){if(!r.screenSizeEnabled)return;const o=e.vertex;t.addCameraPosition(o,r),o.uniforms.add(new i.FloatBindUniform("perScreenPixelRatio",(e=>e.camera.perScreenPixelRatio)),new n.FloatPassUniform("screenSizeScale",(e=>e.screenSizeScale))).code.add(s.glsl`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/ShadedColorMaterialTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../core/shaderLibrary/output/Emissions.glsl","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/basicInterfaces","../materials/DefaultTechniqueConfiguration"],(function(e,t,i,n,s,r,o){"use strict";class a extends o.DefaultTechniqueConfiguration{constructor(){super(...arguments),this.cullFace=r.CullFaceOptions.None,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=i.TextureCoordinateType.None,this.emissionSource=n.EmissionSource.None,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.overlayEnabled=!1,this.snowCover=!1}get discardInvisibleFragments(){return this.transparent}}t.__decorate([s.parameter({count:r.CullFaceOptions.COUNT})],a.prototype,"cullFace",void 0),t.__decorate([s.parameter()],a.prototype,"transparent",void 0),t.__decorate([s.parameter()],a.prototype,"writeDepth",void 0),t.__decorate([s.parameter()],a.prototype,"screenSizeEnabled",void 0),t.__decorate([s.parameter()],a.prototype,"shadingEnabled",void 0),t.__decorate([s.parameter()],a.prototype,"terrainDepthTest",void 0),t.__decorate([s.parameter()],a.prototype,"cullAboveTerrain",void 0),e.ShadedColorMaterialTechniqueConfiguration=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/GraphicState":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Evented","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass"],(function(e,t,i,n,s,r,o,a){"use strict";e.GraphicState=class extends i.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.error=null,this.isDraped=!1}},t.__decorate([n.property({constructOnly:!0})],e.GraphicState.prototype,"graphic",void 0),t.__decorate([n.property()],e.GraphicState.prototype,"tracking",void 0),t.__decorate([n.property()],e.GraphicState.prototype,"displaying",void 0),t.__decorate([n.property()],e.GraphicState.prototype,"error",void 0),t.__decorate([n.property()],e.GraphicState.prototype,"isDraped",void 0),e.GraphicState=t.__decorate([a.subclass("esri.views.3d.layers.graphics.GraphicState")],e.GraphicState),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/draw/DrawGraphicTool":function(){define(["exports","../../chunks/tslib.es6","../../Graphic","../../UndoRedo","../../core/asyncUtils","../../core/Evented","../../core/handleUtils","../../core/maybe","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/coordinateFormatter","../../layers/GraphicsLayer","../../layers/graphics/dehydratedFeatureComparison","./support/CreateOperationGeometry","./support/createUtils","./support/surfaceCoordinateSystems","./support/tooltipUtils","../interactive/InteractiveToolBase","../interactive/sketch/SketchOptions","../interactive/tooltip/tooltipCommonUtils","../../core/accessorSupport/trackingUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S){"use strict";e.DrawGraphicTool=class extends(r.EventedMixin(P.InteractiveToolBase)){constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new b}initialize(){const{view:e}=this;this.internalGraphicsLayer=new g({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=v.createTooltipInfos(e.type,this.sketchOptions);const i=E.makeTooltip((()=>({view:e,options:this.sketchOptions.tooltips})));this.tooltip=i,v.initializeConstraints(this._tooltipsContext),this._coordinateFormatterLoadTask=s.createTask((()=>p.load())),this.addHandles([t.on("vertex-add",(e=>this.onVertexAdd(e))),t.on("vertex-remove",(e=>this.onVertexRemove(e))),t.on("vertex-update",(e=>this.onVertexUpdate(e))),t.on("cursor-update",(e=>this.onCursorUpdate(e))),t.on("cursor-remove",(()=>this._updateGraphic())),t.on("complete",(e=>this.onComplete(e))),this._coordinateFormatterLoadTask,i.on("paste",(e=>E.pasteLocation(e,this.activeTooltipInfo))),l.watch((()=>this.cursor),(e=>{t.cursor=e}),l.syncAndInitial),S.autorun((()=>{const{activeTooltipInfo:e,sketchOptions:t}=this;v.updateTooltipInfo(e,this._tooltipsContext),i.info=t.tooltips.effectiveEnabled?e:null})),S.autorun((()=>{t.constraintZ=v.getConstraintZ(this._tooltipsContext)}),l.sync)]),this.finishToolCreation()}destroy(){this.drawOperation=a.destroyMaybe(this.drawOperation),this.tooltip=a.destroyMaybe(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=a.destroyMaybe(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){const{defaultZ:e,directionOptions:t,drawOperation:i,forceUniformSize:n,geometryType:s,graphic:r,sketchOptions:o,tooltipInfos:a,view:l,automaticAreaMeasurementUtils:c,automaticLengthMeasurementUtils:h}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:e,directionOptions:t,drawOperation:i,forceUniformSize:n,geometryType:s,graphic:r,sketchOptions:o,tooltipInfos:a,view:l,automaticAreaMeasurementUtils:c,automaticLengthMeasurementUtils:h}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),null!=this._graphic&&(this._graphic.symbol=e)}set mode(e){const t=this.drawOperation;t&&(t.drawingMode=e),this._set("mode",e)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:e,map:t}}=this;return"2d"===e&&t&&"undoRedo"in t&&t.undoRedo instanceof n.UndoRedo?t.undoRedo:null}set undoRedo(e){this._override("undoRedo",e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||E.enterInputModeIfAvailable(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),0===this.drawOperation.numCommittedVertices&&v.initializeConstraints(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(w.outline),this.removeHandles(w.regularVertices),this.removeHandles(w.activeVertex),this.removeHandles(w.activeEdge),this.removeHandles(C)}_createOrUpdateGraphic(e){if(null!=this._graphic)return this.updateGraphicGeometry(e),this._graphic;const t=new i({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange("graphic"),this.addHandles(o.makeHandle((()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)})),C),t}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){if(null==this.drawOperation)return;const{coordinateHelper:t,view:i,visualizationCursorVertex:n,lastVertex:s,committedVertices:r,geometryIncludingUncommittedVertices:o,numCommittedVertices:a}=this.drawOperation;if(!(a>0||null!=n))return;const l=e.operationComplete?r:o,c=l.length,h=null!=n?t.pointToArray(n):null,u=this._drawSpatialReference,m="3d"===i.type&&"global"===i.viewingMode,d=new f.CreateOperationGeometry;d.committedVertices=r,d.cursorVertex=h;const{geometryType:p}=this;switch(p){case"point":case"mesh":d.full=t.arrayToPoint(l[0]);break;case"multipoint":d.full=c>0?y.createMultipoint(l,u):null;break;case"polyline":case"polygon":c>0&&(d.full="polygon"===p?y.createPolygon([l],u,m,!0):y.createPolyline([l],u,m),d.cursorEdge=null!=h&&s&&!_.pointEquals(n,s)?y.createPolyline([[h,t.pointToArray(s)]],u,m):null,d.outline=c>1?d.full:null);break;case"circle":case"rectangle":{if(d.committedVertices=d.cursorVertex=null,!c)break;const t=x.createViewAlignedCoordinateSystem(i,l[0]),n=l[0],s=t.makeMapPoint(n[0]+T*i.resolution,n[1]);"circle"===p?1===c&&e.operationComplete?d.circle=y.createCircle([n,s],t,!0):2===c&&(this.forceUniformSize?d.circle=y.createCircle(l,t,this.centered):d.rectangle=y.createEllipse(l,t,this.centered)):1===c&&e.operationComplete?d.rectangle=y.createSquare([n,s],t,!0):2===c&&(d.rectangle=this.forceUniformSize?y.createSquare(l,t,this.centered):y.createRectangle(l,t,this.centered)),d.full=null!=d.circle?d.circle.geometry:d.rectangle?.geometry,d.outline="polygon"===d.full?.type?d.full:null;break}default:return null}return d}initializeGraphic(e){return o.makeHandle()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});null!=e&&(t=this._createOrUpdateGraphic(e.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){const{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return o.makeHandle()}onCursorEdgeChanged(e){return o.makeHandle()}onVertexAdd(e){v.unlockConstraintsOnVertexAddOrRemove(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||v.lockElevationOnVertexAdd(e.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",e)}onVertexRemove(e){v.unlockConstraintsOnVertexAddOrRemove(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,null!=e?(null!=e.cursorEdge?this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),w.activeEdge):this.removeHandles(w.activeEdge),null!=e.outline?this.addHandles(this.onOutlineChanged(e.outline),w.outline):this.removeHandles(w.outline),null!=e.committedVertices?this.addHandles(this.onRegularVerticesChanged(e.committedVertices),w.regularVertices):this.removeHandles(w.regularVertices),null!=e.cursorVertex?this.addHandles(this.onActiveVertexChanged(e.cursorVertex),w.activeVertex):this.removeHandles(w.activeVertex),null!=e.full?this._createOrUpdateGraphic(e.full):this.removeHandles(C)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?v.getActiveTooltipInfo(this._tooltipsContext):null}},t.__decorate([c.property()],e.DrawGraphicTool.prototype,"_coordinateFormatterLoadTask",void 0),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"_createOperationGeometry",void 0),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"_tooltipsContext",null),t.__decorate([c.property({value:!0})],e.DrawGraphicTool.prototype,"centered",null),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"cursor",null),t.__decorate([c.property({nonNullable:!0})],e.DrawGraphicTool.prototype,"defaultZ",void 0),t.__decorate([c.property({constructOnly:!0})],e.DrawGraphicTool.prototype,"directionOptions",void 0),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"drawOperation",void 0),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"elevationLockOnVertexAddDisabled",void 0),t.__decorate([c.property({value:!0})],e.DrawGraphicTool.prototype,"enabled",null),t.__decorate([c.property({value:!0})],e.DrawGraphicTool.prototype,"forceUniformSize",null),t.__decorate([c.property({constructOnly:!0})],e.DrawGraphicTool.prototype,"geometryType",void 0),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"graphic",null),t.__decorate([c.property({constructOnly:!0})],e.DrawGraphicTool.prototype,"graphicProperties",void 0),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"graphicSymbol",null),t.__decorate([c.property({constructOnly:!0})],e.DrawGraphicTool.prototype,"hasZ",void 0),t.__decorate([c.property({constructOnly:!0})],e.DrawGraphicTool.prototype,"geometryToPlace",void 0),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"mode",null),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"snappingManager",void 0),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"snapToScene",void 0),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"tooltip",void 0),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"tooltipInfos",void 0),t.__decorate([c.property({constructOnly:!0,type:b})],e.DrawGraphicTool.prototype,"sketchOptions",void 0),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"updating",null),t.__decorate([c.property({constructOnly:!0,nonNullable:!0})],e.DrawGraphicTool.prototype,"view",void 0),t.__decorate([c.property({constructOnly:!0})],e.DrawGraphicTool.prototype,"automaticAreaMeasurementUtils",void 0),t.__decorate([c.property({constructOnly:!0})],e.DrawGraphicTool.prototype,"automaticLengthMeasurementUtils",void 0),t.__decorate([c.property({constructOnly:!0})],e.DrawGraphicTool.prototype,"undoRedo",null),t.__decorate([c.property()],e.DrawGraphicTool.prototype,"activeTooltipInfo",null),e.DrawGraphicTool=t.__decorate([d.subclass("esri.views.draw.DrawGraphicTool")],e.DrawGraphicTool);const C=Symbol("create-operation-graphic"),w={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")},T=48;e.geometryTypeToDrawOperationGeometryType=function(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/UndoRedo":function(){define(["exports","./chunks/tslib.es6","./core/Accessor","./core/Collection","./core/reactiveUtils","./core/accessorSupport/decorators/property","./core/has","./core/Logger","./core/RandomLCG","./core/accessorSupport/decorators/subclass","./core/support/UpdatingHandles","./undoredo/OperationStatus","./undoredo/UndoableOperation","./undoredo/UndoRedoError"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d){"use strict";e.UndoRedo=class extends i{constructor(){super(...arguments),this._stack=new n,this._stackPosition=-1,this._updatingHandles=new h.UpdatingHandles}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach((e=>e.destroy()))}_drainStack(){this._stack.drain((e=>e.destroy())),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new d.UndoInvalidError;if(this.updating)throw new d.UndoRedoUpdatingError;const e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(m.UndoRedoExecutionMethod.Undo),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new d.RedoInvalidError;if(this.updating)throw new d.UndoRedoUpdatingError;const e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new d.RedoInvalidError;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(m.UndoRedoExecutionMethod.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new d.UndoRedoUpdatingError;await this._updatingHandles.addPromise((async()=>{e.status===u.OperationStatus.NeverApplied&&await e.executeUndoRedoOperation(m.UndoRedoExecutionMethod.Apply),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach((e=>e.destroy())),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new d.UndoRedoUpdatingError;await this._updatingHandles.addPromise((async()=>{e.status===u.OperationStatus.NeverApplied&&await e.executeUndoRedoOperation(m.UndoRedoExecutionMethod.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,t=!1){if(this.updating&&!t)return;await s.whenOnce((()=>!this.updating));const i=new n;for(let t=0;t<this._stack.length;t++){const n=this._stack.getItemAt(t);n&&(n.tag===e?(n.destroy(),t===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(n))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(e=!1){if(this.updating&&!e)throw new d.UndoRedoUpdatingError;await s.whenOnce((()=>!this.updating)),this._drainStack()}},t.__decorate([r.property()],e.UndoRedo.prototype,"_stack",void 0),t.__decorate([r.property()],e.UndoRedo.prototype,"_stackPosition",void 0),t.__decorate([r.property()],e.UndoRedo.prototype,"updating",null),t.__decorate([r.property({readOnly:!0})],e.UndoRedo.prototype,"canUndo",null),t.__decorate([r.property({readOnly:!0})],e.UndoRedo.prototype,"hasUndo",null),t.__decorate([r.property({readOnly:!0})],e.UndoRedo.prototype,"canRedo",null),t.__decorate([r.property({readOnly:!0})],e.UndoRedo.prototype,"hasRedo",null),e.UndoRedo=t.__decorate([c.subclass("esri.UndoRedo")],e.UndoRedo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/undoredo/OperationStatus":function(){define(["exports"],(function(e){"use strict";var t;e.OperationStatus=void 0,(t=e.OperationStatus||(e.OperationStatus={}))[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/undoredo/UndoableOperation":function(){define(["exports","../chunks/tslib.es6","../core/Accessor","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./OperationStatus","./UndoRedoError"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";var h;e.UndoRedoExecutionMethod=void 0,(h=e.UndoRedoExecutionMethod||(e.UndoRedoExecutionMethod={}))[h.Apply=0]="Apply",h[h.Undo=1]="Undo",h[h.Redo=2]="Redo",e.UndoableOperation=class extends i{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=l.OperationStatus.NeverApplied}get canUndo(){return this.status===l.OperationStatus.Applied}get canRedo(){return this.status===l.OperationStatus.Undone}async executeUndoRedoOperation(t){switch(t){case e.UndoRedoExecutionMethod.Apply:if(this.status!==l.OperationStatus.NeverApplied)throw new c.ApplyInvalidError;return await this.apply(),void(this.status=l.OperationStatus.Applied);case e.UndoRedoExecutionMethod.Undo:if(this.status!==l.OperationStatus.Applied)throw new c.UndoInvalidError;return await this.undo(),void(this.status=l.OperationStatus.Undone);case e.UndoRedoExecutionMethod.Redo:if(this.status!==l.OperationStatus.Undone)throw new c.UndoInvalidError;return await this.redo(),void(this.status=l.OperationStatus.Applied)}}},t.__decorate([n.property()],e.UndoableOperation.prototype,"name",void 0),t.__decorate([n.property()],e.UndoableOperation.prototype,"tag",void 0),e.UndoableOperation=t.__decorate([a.subclass("esri.undoredo.UndoableOperation")],e.UndoableOperation),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/undoredo/UndoRedoError":function(){define(["exports"],(function(e){"use strict";var t;e.UndoRedoErrorCodes=void 0,(t=e.UndoRedoErrorCodes||(e.UndoRedoErrorCodes={})).UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError";const i={[e.UndoRedoErrorCodes.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[e.UndoRedoErrorCodes.UndoInvalidError]:"There are no items to Undo",[e.UndoRedoErrorCodes.RedoInvalidError]:"There are no items to Redo",[e.UndoRedoErrorCodes.ApplyInvalidError]:"Cannot apply an item that is already applied"};class n extends Error{constructor(){super(i[e.UndoRedoErrorCodes.UndoRedoUpdating]),this.type="undo-redo-updating-error"}}class s extends Error{constructor(){super(i[e.UndoRedoErrorCodes.UndoInvalidError]),this.type="undo-redo-undo-error"}}class r extends Error{constructor(){super(i[e.UndoRedoErrorCodes.RedoInvalidError]),this.type="undo-redo-redo-error"}}class o extends Error{constructor(){super(i[e.UndoRedoErrorCodes.ApplyInvalidError]),this.type="undo-redo-apply-error"}}e.ApplyInvalidError=o,e.RedoInvalidError=r,e.UndoInvalidError=s,e.UndoRedoErrorMessages=i,e.UndoRedoUpdatingError=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/coordinateFormatter":function(){define(["exports","../core/Error","../chunks/pe","./Point","./SpatialReference","../intl/number"],(function(e,t,i,n,s,r){"use strict";function o(){return i.isLoaded()}function a(e,t){const r=l(t),o=e.replaceAll(/[\u00B0\u00BA]/g,"^").replaceAll("","'").replaceAll("",'"'),a=[];return i.PeNotationDms.dmsToGeog(r,1,[o],a)?new n(a[0][0],a[0][1],t||s.WGS84):null}function l(e){if(e??=s.WGS84,e.wkid){const n=i.PeFactory.geogcs(e.wkid);if(!n)throw new t("coordinate-formatter:invalid-spatial-reference","wkid is not valid");return n}const n=e.wkt2??e.wkt;if(n){const e=i.PeFactory.fromString(i.PeDefs.PE_TYPE_GEOGCS,n);if(!e)throw new t("coordinate-formatter:invalid-spatial-reference","wkt is not valid");return e}throw new t("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing")}function c(e){switch(e){case"automatic":return i.PeNotationMgrs.PE_MGRS_STYLE_AUTO;case"new-180-in-zone-01":return i.PeNotationMgrs.PE_MGRS_STYLE_NEW|i.PeNotationMgrs.PE_MGRS_180_ZONE_1_PLUS;case"new-180-in-zone-60":return i.PeNotationMgrs.PE_MGRS_STYLE_NEW;case"old-180-in-zone-01":return i.PeNotationMgrs.PE_MGRS_STYLE_OLD|i.PeNotationMgrs.PE_MGRS_180_ZONE_1_PLUS;case"old-180-in-zone-60":return i.PeNotationMgrs.PE_MGRS_STYLE_OLD;default:return-1}}function h(e){switch(e){case"latitude-band-indicators":return i.PeNotationUtm.PE_UTM_OPTS_NONE;case"north-south-indicators":return i.PeNotationUtm.PE_UTM_OPTS_NS;default:return-1}}e.fromLatitude=function(e){return e&&o()?r.parseNumber(e)??a(`${e} | 0 0' 0" E`)?.latitude??a(`${e} | 0 E`)?.latitude??null:null},e.fromLatitudeLongitude=a,e.fromLongitude=function(e){return e&&o()?r.parseNumber(e)??a(`0 0' 0" N | ${e}`)?.longitude??a(`0 N | ${e}`)?.longitude??null:null},e.fromMgrs=function(e,t,r){const o=[],a=c(r);if(-1===a)return console.warn(`invalid conversionMode: ${r}`),null;const h=l(t);return i.PeNotationMgrs.mgrsToGeogExtended(h,1,[e],a,o)?new n(o[0][0],o[0][1],t||s.WGS84):null},e.fromUsng=function(e,t){const r=[];!t&&/\(.+27/.test(e)&&(t=s.GCS_NAD_1927);const o=l(t);return i.PeNotationUsng.usngToGeog(o,1,[e],r)?new n(r[0][0],r[0][1],t||s.WGS84):null},e.fromUtm=function(e,t,r){const o=[],a=h(r);if(-1===a)return console.warn(`invalid conversionMode: ${r}`),null;const c=l(t);return i.PeNotationUtm.utmToGeog(c,1,[e],a,o)?new n(o[0][0],o[0][1],t||s.WGS84):null},e.isLoaded=o,e.isSupported=function(){return i.isSupported()},e.load=function(){return i.load()},e.toLatitudeLongitude=function(e,t,n=0){const s=[[e.x,e.y]],r=[],o=l(e.spatialReference);let a=0;switch(t){case"dd":a=i.PeNotationDms.geogToDd(o,1,s,n,r);break;case"ddm":a=i.PeNotationDms.geogToDdm(o,1,s,n,r);break;case"dms":a=i.PeNotationDms.geogToDms(o,1,s,n,r);break;default:return console.warn(`invalid format: ${t}`),null}return a?r[0]:null},e.toMgrs=function(e,t,n=0,s=!1){const r=[[e.x,e.y]],o=[],a=l(e.spatialReference);let h=c(t);return-1===h?(console.warn(`invalid conversionMode: ${t}`),null):(s&&(h|=i.PeNotationMgrs.PE_MGRS_ADD_SPACES),i.PeNotationMgrs.geogToMgrsExtended(a,1,r,n,!1,h,o)?o[0]:null)},e.toUsng=function(e,t=0,n=!1){const s=[[e.x,e.y]],r=[],o=l(e.spatialReference);return i.PeNotationUsng.geogToUsng(o,1,s,t,!1,n,r)?r[0]:null},e.toUtm=function(e,t,n=!1){const s=[[e.x,e.y]],r=[],o=l(e.spatialReference);let a=h(t);return-1===a?(console.warn(`invalid conversionMode: ${t}`),null):(n&&(a|=i.PeNotationUtm.PE_UTM_OPTS_ADD_SPACES),i.PeNotationUtm.geogToUtm(o,1,s,a,r)?r[0]:null)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/GraphicsLayer":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../core/support/OwningCollection","./Layer","./mixins/BlendLayer","./mixins/ScaleRangeLayer","../support/GraphicsCollection","../symbols/support/ElevationInfo"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m){"use strict";return e.default=class extends(c.BlendLayer(h.ScaleRangeLayer(l))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new u.GraphicsCollection,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}},t.__decorate([i.property({type:m})],e.default.prototype,"elevationInfo",void 0),t.__decorate([i.property(a.owningCollectionProperty(u.GraphicsCollection,"graphics"))],e.default.prototype,"graphics",void 0),t.__decorate([i.property({type:["show","hide"]})],e.default.prototype,"listMode",void 0),t.__decorate([i.property()],e.default.prototype,"screenSizePerspectiveEnabled",void 0),t.__decorate([i.property({readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([i.property({constructOnly:!0})],e.default.prototype,"internal",void 0),e.default=t.__decorate([o.subclass("esri.layers.GraphicsLayer")],e.default),e.default}))},"esri/views/draw/support/CreateOperationGeometry":function(){define(["exports"],(function(e){"use strict";e.CreateOperationGeometry=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/draw/support/createUtils":function(){define(["exports","../../../core/arrayUtils","../../../core/lang","../../../core/unitUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/Circle","../../../geometry/Multipoint","../../../geometry/Point","../../../geometry/Polygon","../../../geometry/Polyline","../../../chunks/distanceOperator","../../../chunks/simplifyOperator","../../../geometry/support/coordsUtils","../../../geometry/support/spatialReferenceUtils","./surfaceCoordinateSystems"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g){"use strict";function _(e,t){const i=new l({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function f(e,n,s,r=!0){const o=i.clone(e);o.forEach((e=>{const i=e[0],n=e[e.length-1];t.equals(i,n)&&1!==e.length||e.push(e[0])}));let a=new c({rings:o,spatialReference:n});return a.rings.forEach((e=>{d.isClockwise(e)||e.reverse()})),s&&d.unnormalizeGeometryOnDatelineCrossing(a),r&&!m.isSimple(a)&&p.isValid(n)&&(a=m.execute(a)||a),a}function y(e,t,i){const n=x(t[3],t[2],i),s=x(t[1],t[2],i),r=x(t[0],t[1],i),o=x(t[0],t[3],i);return{geometry:e,midpoints:null!=n&&null!=s&&null!=r&&null!=o?{top:n,right:s,bottom:r,left:o}:null}}function x(e,t,i){P[0]=e.x,P[1]=e.y,P[2]=0,b[0]=t.x,b[1]=t.y,b[2]=0,s.lerp(P,P,b,.5),v.x=P[0],v.y=b[1],v.z=b[2];const n=i.localToMap(v);return null!=n?_(n,i.spatialReference):null}const v=g.makeSurfacePoint(0,0,0),P=r.create(),b=r.create();e.createCircle=function(e,t,i,s){const r=t.mapToLocalMultiple(e);let a=null,l=null;if(i)a=r[0],l=r[1];else{const e=r[0],t=r[1],i=Math.round(t.x-e.x),n=Math.round(t.y-e.y),s=Math.max(Math.abs(i),Math.abs(n));a=g.makeSurfacePoint(i>0?e.x+s/2:e.x-s/2,n>0?e.y+s/2:e.y-s/2),l=g.makeSurfacePoint(Math.abs(i)>Math.abs(n)?a.x-s/2:a.x,Math.abs(i)>Math.abs(n)?a.y:a.y-s/2)}const c=t.localToMap(a),h=t.localToMap(l);if(null==c||null==h)return null;t.doUnnormalization&&d.unnormalizeVerticesOnDatelineCrossing([[c,h]],t.spatialReference);const m=_(c,t.spatialReference),y=_(h,t.spatialReference),x=n.getMetersPerUnitForSR(t.spatialReference);let v=0;if(p.isValid(t.spatialReference))v=x*u.execute(m,y);else{const e=a.x-l.x,t=a.y-l.y;v=x*Math.sqrt(e*e+t*t)*(s||1)}const P=new o({center:m,radius:v,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:f(P.rings,P.spatialReference,!1),center:m,edge:y}},e.createEllipse=function(e,i,n){const s=i.mapToLocalMultiple(e),r=s[0],o=s[1],a=Math.round(o.x-r.x),l=Math.round(o.y-r.y),c=g.makeSurfacePoint(n?r.x:r.x+a/2,n?r.y:r.y+l/2),h=n?a:a/2,u=n?l:l/2,m=[],d=2*Math.PI/60;function p(e){const t=Math.cos(e),i=Math.sin(e);return g.makeSurfacePoint(h*t+c.x,u*i+c.y)}for(let e=0;e<60;e++)m.push(p(e*d));m.push(m[0]);const{spatialReference:y,doUnnormalization:x}=i,v=f([m.map((e=>i.localToMap(e))).filter(t.isSome)],y,x,!1),P=i.localToMap(p(Math.PI/2)),b=i.localToMap(p(0)),E=i.localToMap(p(-Math.PI/2)),S=i.localToMap(p(Math.PI));return{geometry:v,midpoints:null!=P&&null!=b&&null!=E&&null!=S?{top:_(P,y),right:_(b,y),bottom:_(E,y),left:_(S,y)}:null}},e.createMultipoint=function(e,t){return new a({points:e,spatialReference:t})},e.createPoint=_,e.createPolygon=f,e.createPolyline=function(e,t,i){const n=new h({paths:e,spatialReference:t});return i&&d.unnormalizeGeometryOnDatelineCrossing(n),n},e.createRectangle=function(e,i,n){let s=i.mapToLocalMultiple(e);if(1===s.length){const e=48,t=s[0];s=[g.makeSurfacePoint(t.x-e,t.y+e),g.makeSurfacePoint(t.x+e,t.y-e),g.makeSurfacePoint(t.x+e,t.y-e),g.makeSurfacePoint(t.x-e,t.y+e)]}const r=[],o={x:s[0].x,y:s[0].y},a={x:s[1].x,y:s[1].y};if(n){const e=Math.round(a.x-o.x),t=Math.round(a.y-o.y);r.push(g.makeSurfacePoint(o.x-e,o.y-t),g.makeSurfacePoint(a.x,o.y-t),g.makeSurfacePoint(a.x,a.y),g.makeSurfacePoint(o.x-e,a.y))}else r.push(g.makeSurfacePoint(o.x,o.y),g.makeSurfacePoint(a.x,o.y),g.makeSurfacePoint(a.x,a.y),g.makeSurfacePoint(o.x,a.y));return y(f([r.map((e=>i.localToMap(e))).filter(t.isSome)],i.spatialReference,i.doUnnormalization,!0),r,i)},e.createSquare=function(e,i,n){const s=i.mapToLocalMultiple(e),r=[],o={x:s[0].x,y:s[0].y},a=s[1].x,l=s[1].y,c=Math.round(a-o.x),h=Math.round(l-o.y),u=Math.max(Math.abs(c),Math.abs(h));if(n){const e={x:o.x+u,y:o.y+u},t={x:o.x-u,y:o.y-u};r.push(g.makeSurfacePoint(e.x,t.y),g.makeSurfacePoint(t.x,t.y),g.makeSurfacePoint(t.x,e.y),g.makeSurfacePoint(e.x,e.y))}else{const e={x:c>0?o.x+u:o.x-u,y:h>0?o.y+u:o.y-u};r.push(g.makeSurfacePoint(o.x,o.y),g.makeSurfacePoint(e.x,o.y),g.makeSurfacePoint(e.x,e.y),g.makeSurfacePoint(o.x,e.y))}return y(f([r.map((e=>i.localToMap(e))).filter(t.isSome)],i.spatialReference,i.doUnnormalization,!0),r,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/Circle":function(){define(["../chunks/tslib.es6","../core/unitUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./ellipsoidUtils","./Point","./Polygon","./SpatialReference","./support/geodesicUtils","./support/webMercatorUtils","./support/WKIDUnitConversion"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d){"use strict";var p;let g=p=class extends c{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const e=this.center,i=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,0!==this.rings.length||!e)return;const n=t.convertUnit(this.radius,this.radiusUnit,"meters"),s=e.spatialReference;let r,o="geographic";if(s.isWebMercator?o="webMercator":(null!=(s.wkid&&d[s.wkid])||(s.wkt2||s.wkt)&&t.isProjectedWKT(s.wkt2||s.wkt))&&(o="projected"),this.geodesic){let t;switch(o){case"webMercator":t=m.webMercatorToGeographic(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":t=e}r=this._createGeodesicCircle(t,n,i),"webMercator"===o&&(r=m.geographicToWebMercator(r))}else{let s;"webMercator"===o||"projected"===o?s=n/t.getMetersPerUnit(e.spatialReference):"geographic"===o&&(s=t.lengthToDegrees(n,"meters",a.getReferenceEllipsoid(e.spatialReference).radius)),r=this._createPlanarCircle(e,s,i)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:n,geodesic:s}=this;return new p({center:e?.clone(),numberOfPoints:t,radius:i,radiusUnit:n,geodesic:s})}_createGeodesicCircle(e,t,i){const n=[],s=[e.x,e.y];for(let r=0;r<360;r+=360/i){const i=this.hasZ?[0,0,e.z??0]:[0,0];u.directGeodeticSolver(i,s,r,t,h.WGS84),n.push(i)}return n.push(n[0]),new c({rings:[n]})}_createPlanarCircle(e,t,i){const n=[],s=2*Math.PI/i;for(let r=0;r<i;++r){const i=s*r,o=[e.x+Math.cos(-i)*t,e.y+Math.sin(-i)*t];this.hasZ&&o.push(e.z??0),n.push(o)}return n.push(n[0]),new c({spatialReference:e.spatialReference,rings:[n]})}};return e.__decorate([i.property({type:l})],g.prototype,"center",void 0),e.__decorate([i.property()],g.prototype,"geodesic",void 0),e.__decorate([i.property()],g.prototype,"numberOfPoints",void 0),e.__decorate([i.property()],g.prototype,"radius",void 0),e.__decorate([i.property()],g.prototype,"radiusUnit",void 0),g=p=e.__decorate([o.subclass("esri.geometry.Circle")],g),g}))},"esri/geometry/support/geodesicUtils":function(){define(["exports","../../core/Error","../../core/unitUtils","../../core/accessorSupport/ensureType","../Point","../Polygon","../Polyline","../SpatialReference","./geodesicConstants","./spatialReferenceUtils"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";function h(e){if(!e)return null;const t=e.wkid;if(t)return l.spheroids[t];const i=e.wkt2??e.wkt;return i?function(e){const t=l.wktSpheroidRegex.exec(e);if(!t||2!==t.length)return null;const i=t[1].split(",");if(!i||i.length<3)return null;const n=parseFloat(i[1]),s=parseFloat(i[2]);return isNaN(n)||isNaN(s)?null:{a:n,f:0===s?0:1/s}}(i):null}function u(e){const t=h(e);if(function(e){return null!=e&&"b"in e&&"eSq"in e&&"radius"in e}(t))return t;const i=t.a*(1-t.f);return Object.assign(t,{b:i,eSq:1-(i/t.a)**2,radius:(2*t.a+i)/3,densificationRatio:1e4/((2*t.a+i)/3)})}function m(e){return null!=e&&e<0?e+360:e}function d(e,t,i){const{a:n,eSq:s}=u(i),r=Math.sqrt(s),o=Math.sin(t[1]*l.toRadians),a=n*t[0]*l.toRadians;let c;return c=s>0?n*((1-s)*(o/(1-s*(o*o))-1/(2*r)*Math.log((1-r*o)/(1+r*o))))*.5:n*o,e[0]=a,e[1]=c,e}function p(e){return c.isGeographic(e)&&!!h(e)}function g(e,i){if("polyline"!==e.type&&"polygon"!==e.type)throw new t("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:s}=e;if(!p(s))throw new t("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const l="polyline"===e.type?e.paths:e.rings,c=[],h=[0,0],u=new _;for(const e of l){const t=[];c.push(t),t.push([e[0][0],e[0][1]]);let n,r,o=e[0][0],a=e[0][1];for(let l=0;l<e.length-1;l++){if(n=e[l+1][0],r=e[l+1][1],o===n&&a===r)continue;const c=[o,a];y(u,[o,a],[n,r],s);const{azimuth:m,distance:d}=u,p=d/i;if(p>1){for(let e=1;e<=p-1;e++)f(h,c,m,e*i,s),t.push(h.slice());f(h,c,m,(d+Math.floor(p-1)*i)/2,s),t.push(h.slice())}f(h,c,m,d,s),t.push(h.slice()),o=h[0],a=h[1]}}const m=n.ensureClass(a,s);return"polyline"===e.type?new o({paths:c,spatialReference:m}):new r({rings:c,spatialReference:m})}class _{constructor(e=0,t=void 0,i=void 0){this.distance=e,this.azimuth=t,this.reverseAzimuth=i}}function f(e,t,i,n,s){const r=t[0],o=t[1],a=r*l.toRadians,c=o*l.toRadians,h=(i??0)*l.toRadians,{a:m,b:d,f:p}=u(s),g=Math.sin(h),_=Math.cos(h),f=(1-p)*Math.tan(c),y=1/Math.sqrt(1+f*f),x=f*y,v=Math.atan2(f,_),P=y*g,b=P*P,E=1-b,S=E*(m*m-d*d)/(d*d),C=1+S/16384*(4096+S*(S*(320-175*S)-768)),w=S/1024*(256+S*(S*(74-47*S)-128));let T,D,I,A=n/(d*C),M=2*Math.PI;for(;Math.abs(A-M)>1e-12;)I=Math.cos(2*v+A),T=Math.sin(A),D=Math.cos(A),M=A,A=n/(d*C)+w*T*(I+w/4*(D*(2*I*I-1)-w/6*I*(4*T*T-3)*(4*I*I-3)));const N=x*T-y*D*_,R=Math.atan2(x*D+y*T*_,(1-p)*Math.sqrt(b+N*N)),O=p/16*E*(4+p*(4-3*E)),G=Math.atan2(T*g,y*D-x*T*_)-(1-O)*p*P*(A+O*T*(I+O*D*(2*I*I-1)));return e[0]=(a+G)/l.toRadians,e[1]=R/l.toRadians,e}function y(e,t,i,n){const s=t[0]*l.toRadians,r=t[1]*l.toRadians,o=i[0]*l.toRadians,a=i[1]*l.toRadians,{a:c,b:h,f:m,radius:d}=u(n),p=o-s,g=Math.atan((1-m)*Math.tan(r)),_=Math.atan((1-m)*Math.tan(a)),f=Math.sin(g),y=Math.cos(g),x=Math.sin(_),v=Math.cos(_);let P,b,E,S,C,w,T,D,I,A,M=1e3,N=p;do{if(T=Math.sin(N),D=Math.cos(N),E=Math.sqrt(v*T*(v*T)+(y*x-f*v*D)*(y*x-f*v*D)),0===E)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;C=f*x+y*v*D,w=Math.atan2(E,C),I=y*v*T/E,b=1-I*I,S=C-2*f*x/b,isNaN(S)&&(S=0),A=m/16*b*(4+m*(4-3*b)),P=N,N=p+(1-A)*m*I*(w+A*E*(S+A*C*(2*S*S-1)))}while(Math.abs(N-P)>1e-12&&--M>0);if(0===M){const t=d,i=Math.acos(Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos(o-s))*t,n=o-s,c=Math.sin(n)*Math.cos(a),h=Math.cos(r)*Math.sin(a)-Math.sin(r)*Math.cos(a)*Math.cos(n),u=Math.atan2(c,h);return e.azimuth=u/l.toRadians,e.distance=i,e.reverseAzimuth=void 0,e}const R=b*(c*c-h*h)/(h*h),O=R/1024*(256+R*(R*(74-47*R)-128)),G=h*(1+R/16384*(4096+R*(R*(320-175*R)-768)))*(w-O*E*(S+O/4*(C*(2*S*S-1)-O/6*S*(4*E*E-3)*(4*S*S-3)))),k=Math.atan2(v*Math.sin(N),y*x-f*v*Math.cos(N)),V=Math.atan2(y*Math.sin(N),y*x*Math.cos(N)-f*v);return e.azimuth=k/l.toRadians,e.distance=G,e.reverseAzimuth=V/l.toRadians,e}e.InverseGeodeticSolverResult=_,e.directGeodeticSolver=f,e.geodesicAreas=function(e,n="square-meters"){if(e.some((e=>!p(e.spatialReference))))throw new t("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const s=[];for(let t=0;t<e.length;t++){const i=e[t],n=i.spatialReference,{radius:r,densificationRatio:o}=u(n),a=r*o;s.push(g(i,a))}const r=[],o=[0,0],a=[0,0];for(let e=0;e<s.length;e++){const{rings:t,spatialReference:l}=s[e];let c=0;for(let e=0;e<t.length;e++){const i=t[e];d(o,i[0],l),d(a,i[i.length-1],l);let n=a[0]*o[1]-o[0]*a[1];for(let e=0;e<i.length-1;e++)d(o,i[e+1],l),d(a,i[e],l),n+=a[0]*o[1]-o[0]*a[1];c+=n}c=i.convertUnit(c,"square-meters",n),r.push(c/-2)}return r},e.geodesicCompatibleSpatialReference=function(e){return p(e)?e:c.isWebMercator(e)?a.WGS84:null},e.geodesicDensify=g,e.geodesicDistance=function(e,n,s="meters"){if(!e||!n)throw new t("geodesic-distance:missing-parameters","one or both input parameters are missing");if(!e.spatialReference||!n.spatialReference)throw new t("geodesic-distance:invalid-parameters","one or both input points do not have a spatial reference");if(!c.equals(e.spatialReference,n.spatialReference))throw new t("geodesic-distance:invalid-parameters","spatial references of input parameters do not match");const{spatialReference:r}=e;if(!p(r))throw new t("geodesic-distance:not-supported","input geometry spatial reference is not supported");if(e.x===n.x&&e.y===n.y)return new _(0,0,0);const o=new _;return y(o,[e.x,e.y],[n.x,n.y],r),o.distance=i.convertUnit(o.distance,"meters",s),o.azimuth=m(o.azimuth),o.reverseAzimuth=m(o.reverseAzimuth),o},e.geodesicLengths=function(e,n="meters"){if(!e)throw new t("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some((e=>!p(e.spatialReference))))throw new t("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const s=[];for(let t=0;t<e.length;t++){const r=e[t],{spatialReference:o}=r,a="polyline"===r.type?r.paths:r.rings;let l=0;for(let e=0;e<a.length;e++){const t=a[e];let i=0;for(let e=1;e<t.length;e++){const n=t[e-1][0],s=t[e][0],r=t[e-1][1],a=t[e][1];if(r!==a||n!==s){const e=new _;y(e,[n,r],[s,a],o),i+=e.distance}}l+=i}l=i.convertUnit(l,"meters",n),s.push(l)}return s},e.inverseGeodeticSolver=y,e.isSupported=p,e.pointFromDistance=function(e,i,n){if(!e||null==i||null==n)throw new t("point-from-distance:missing-parameters","one or more input parameters are missing or undefined");if(n<0||n>360)throw new t("point-from-distance:-of-bounds","azimuth is restricted to angles between, and including, 0 to 360 degrees");if(!e.spatialReference)throw new t("point-from-distance:missing-spatial-reference","the input point must have a spatial reference");const{spatialReference:r}=e;if(!p(r))throw new t("geodesic-distance:not-supported","input geometry spatial reference is not supported");const o=[0,0];return f(o,[e.x,e.y],n,i,r),new s({x:o[0],y:o[1],spatialReference:r})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/distanceOperator":function(){define(["exports","./Geometry","./Distance2DCalculator-CXhBP-8I","../core/unitUtils","../geometry/operators/support/apiConverter"],(function(e,t,i,n,s){"use strict";const r=new class{getOperatorType(){return 10100}supportsCurves(){return!0}accelerateGeometry(e,t,i){return!1}canAccelerateGeometry(e){return!1}execute(e,t,i){return this.executeEx(e,t,i,null,null,Number.NaN)}executeEx(e,n,s,r,o,a){if(e.isEmpty()||n.isEmpty())return Number.NaN;t.throwIfMesh(e),t.throwIfMesh(n);const l=e,c=n;Number.isNaN(a)&&(a=Number.POSITIVE_INFINITY);const h=new i.DistanceCalculator(a,s).calculate(l,c,r,o);return Number.isFinite(h)?h:Number.NaN}};function o(e,t,i={}){const{unit:o}=i;let a=r.execute(s.fromGeometry(e),s.fromGeometry(t),null);if(a&&o){const t=s.getSpatialReference(e);a=n.convertFromSpatialReferenceUnit(a,t,o)}return a}const a=r.supportsCurves(),l=Object.freeze(Object.defineProperty({__proto__:null,execute:o,supportsCurves:a},Symbol.toStringTag,{value:"Module"}));e.distanceOperator=l,e.execute=o,e.supportsCurves=a}))},"esri/chunks/Geometry":function(){define(["exports"],(function(e){"use strict";class t extends Error{constructor(e,t){super(t),this.m_AdditionalMessage=t,this.m_ErrorType=e,this.name="GeometryError"}what(){return function(e){switch(e){case 1:return"Unknown error";case 2:return"Corrupted geometry";case 3:return"Empty geometry";case 4:return"Math singularity";case 5:return"Buffer is too small";case 6:return"Invalid shape type";case 7:return"Projection out of supported range";case 8:return"Non simple geometry";case 9:return"Cannot calculate geodesic";case 10:return"Notation conversion";case 11:return"Missing grid file";case 12:return"Invalid call";case 13:return"Internal error";case 14:return"Not implemented";case 15:return"IO error";case 16:return"Invalid 3D";case 17:return"An ambiguous geography edge with antipodal points";case 18:return"Geocentric coordinates require ellipsoidal height";case 19:return"Geography cannot be projected into a gnomonic plane or a result of an operation cannot fit into a gnomonic plane";case 20:return"Geometry is too large to be exported in to a given format";case 22:return"Operation is canceled by the user";case 21:return"The operation, such as projection or geodetic computation, cannot be performed without pe-wasm loaded";default:return"unknown error"}}(this.m_ErrorType)}additionalMessage(){return this.m_AdditionalMessage?this.m_AdditionalMessage:""}code(){return this.m_ErrorType}}class i extends t{constructor(e){super(2,e),this.name="CorruptedGeometryError"}}class n extends t{constructor(e){super(3,e),this.name="EmptyGeometryError"}}class s extends t{constructor(e){super(4,e),this.name="MathSingularityError"}}class r extends t{constructor(e){super(21,e),this.name="ProjectionEngineNotLoadedError"}}class o extends t{constructor(e){super(8,e),this.name="NonSimpleGeometryError"}}var a;e.GeometryType=void 0,(a=e.GeometryType||(e.GeometryType={}))[a.enumUnknown=0]="enumUnknown",a[a.enumPoint=513]="enumPoint",a[a.enumLine=5122]="enumLine",a[a.enumBezier=5123]="enumBezier",a[a.enumEllipticArc=5124]="enumEllipticArc",a[a.enumEnvelope=3077]="enumEnvelope",a[a.enumMultiPoint=8710]="enumMultiPoint",a[a.enumPolyline=25607]="enumPolyline",a[a.enumPolygon=27656]="enumPolygon",a[a.enumMultipatch=40969]="enumMultipatch",a[a.enumGeometryCollection=3594]="enumGeometryCollection",a[a.enumRationalBezier2=5134]="enumRationalBezier2",a[a.enumBezier2=5135]="enumBezier2",a[a.enumRationalBezier23d=5392]="enumRationalBezier23d",a[a.enumGreatArc3d=5393]="enumGreatArc3d";const l=[0,0,1,1,1,2,0,1,2,3,-1,-1,-1,-1,1,1];function c(e){return!!(4096&e)}function h(e){return!!(8192&e)}function u(e){return!!(16384&e)}function m(e){return!!(32768&e)}function d(t){const i=t.getGeometryType();if(u(i))return t.hasNonLinearSegments();if(i===e.GeometryType.enumGeometryCollection){const e=t;for(let t=0,i=e.getGeometryCount();t<i;t++)if(d(e.getGeometry(t)))return!0;return!1}return!!c(i)&&i!==e.GeometryType.enumLine}function p(e){throw new Error(e)}function g(e){throw new t(14,e)}function _(e){throw new t(13,e)}function f(t){t===e.GeometryType.enumGeometryCollection&&p("Geometry_collection instances are not supported in this operation")}e.checkAndThrow=function(e,t){e||p(t)},e.geometryReleaseAssert=function(e,t){try{if(!e)throw new Error(t)}catch(e){throw e}},e.getDimensionFromType=function(e){return l[15&e]},e.hasNonLinearSegments=d,e.isArea=function(e){return!!(2048&e)},e.isLinear=function(e){return!!(1024&e)},e.isMesh=m,e.isMultiPath=u,e.isMultiVertex=h,e.isPoint=function(e){return!!(512&e)},e.isSegment=c,e.throwCorruptedGeometryException=function(e){throw new i(e)},e.throwEmptyGeometryException=function(e){throw new n(e)},e.throwIfCurves=function(e){e&&d(e)&&g("Operation does not support curves.")},e.throwIfGeometryCollection=function(e){f(e.getGeometryType())},e.throwIfGeometryCollectionType=f,e.throwIfMesh=function(e){e&&m(e.getGeometryType())&&g("Unsupported geometry type.")},e.throwInternalErrorException=_,e.throwInvalidArgumentException=p,e.throwInvalidCallException=function(e){throw new t(12,e)},e.throwInvalidGeometryTypeFor3DOps=function(){p("Geometry type is not supported for 3D operations.")},e.throwInvalidWkidException=function(e){p(`bad wkid: ${e}`)},e.throwInvalidWktException=function(e){let t="bad wkt: ";t+=e,t+="...",p(t)},e.throwLogicErrorException=function(e){throw new Error(e)},e.throwMathSingularityException=function(e){throw new s(e)},e.throwNonSimpleGeometryException=function(e){throw new o(e)},e.throwNotImplementedException=g,e.throwOutOfRangeException=function(e){throw new Error(e)},e.throwProjectionEngineNotLoadedException=function(e){throw new r(e)},e.vertexCount=function(t){const i=t.getGeometryType();return h(i)?t.getPointCount():t.isEmpty()?0:i===e.GeometryType.enumEnvelope?4:i===e.GeometryType.enumPoint?1:c(i)?2:void _("missing type")}}))},"esri/chunks/Distance2DCalculator-CXhBP-8I":function(){define(["exports","./tslib.es6","./Geometry","./MultiPathImpl","./ProjectionTransformation","./Point2D","./Envelope2D","./Envelope"],(function(e,t,i,n,s,r,o,a){"use strict";function l(){return{outPoint:new r.Point2D,index:-1,t:Number.NaN}}function c(e,t,i){return{outPoint:e.clone(),index:t,t:i}}function h(e,t,i,n){e.outPoint.assign(t),e.index=i,e.t=n}function u(e,t){e.outPoint.assign(t.outPoint),e.index=t.index,e.t=t.t}function m(e,t,i,n){e.index=i,e.t=n,t.queryCoord2D(e.t,e.outPoint)}function d(e,t){const i=l();u(i,e),u(e,t),u(t,i)}function p(e,t,n,r,o,a){if(e.getGeometryType()===i.GeometryType.enumPolygon){for(;r.nextPath();)if(r.hasNextSegment()){const t=r.nextSegment();if(0!==s.isPoint2DInPolygon2D(e,t.getEndXY(),0))return h(o,t.getEndXY(),-1,Number.NaN),h(a,t.getEndXY(),-1,Number.NaN),!0}r.resetToFirstPath()}if(t.getGeometryType()===i.GeometryType.enumPolygon){for(;n.nextPath();)if(n.hasNextSegment()){const e=n.nextSegment();if(0!==s.isPoint2DInPolygon2D(t,e.getEndXY(),0))return h(o,e.getEndXY(),-1,Number.NaN),h(a,e.getEndXY(),-1,Number.NaN),!0}n.resetToFirstPath()}return!1}function g(e){const t=e.getPathCount(),i=r.makePrimitiveArray(e.getSegmentCount(),0);let s=0;for(let n=0;n<t;++n){const t=s+e.getSegmentCountPath(n);for(let r=s,o=e.getPathStart(n);r<t;++r,++o)i[r]=o;s=t}return n.shuffle(e.getPointCount(),i),i}function _(e,t){return!!Number.isNaN(t)||e<=t}function f(e){const t=new n.Polygon;return t.addEnvelope(e,!1),t}e.DistanceCalculator=class{constructor(e,t){if(this.m_env2DgeometryA=null,this.m_env2DgeometryB=null,this.m_progressCounter=0,this.m_progressTracker=t,this.m_maxSqrDistance=e*e,this.m_maxDistance=e,this.m_bIsNearCalc=!1,Number.isNaN(this.m_maxDistance)?this.m_maxDistance=Number.POSITIVE_INFINITY:this.m_maxDistance=e,this.m_maxSqrDistance=this.m_maxDistance*this.m_maxDistance,Number.isFinite(this.m_maxSqrDistance)){let e=Math.sqrt(this.m_maxSqrDistance);for(;e<this.m_maxDistance;)this.m_maxSqrDistance*=1+Number.EPSILON,e=Math.sqrt(this.m_maxSqrDistance)}}calculate(e,t,i,n){if((e.getGeometryType()!==a.Point.type||t.getGeometryType()!==a.Point.type)&&(this.m_env2DgeometryA=new o.Envelope2D,this.m_env2DgeometryB=new o.Envelope2D,e.queryEnvelope(this.m_env2DgeometryA),t.queryEnvelope(this.m_env2DgeometryB),!_(this.m_env2DgeometryA.distanceFromEnvelope(this.m_env2DgeometryB),this.m_maxDistance)))return Number.POSITIVE_INFINITY;const s=c(new r.Point2D,r.indexTypeMax(),Number.NaN),l=c(new r.Point2D,r.indexTypeMax(),Number.NaN),h=this._ExecuteBruteForce(e,t,s,l);return _(h,this.m_maxDistance)?(null!==i&&u(i,s),null!==n&&u(n,l),h):Number.POSITIVE_INFINITY}isNear(e,t){if(this.m_bIsNearCalc=!0,e.isEmpty()||t.isEmpty())return!1;if(e===t)return!0;let i=!0;if(e.getGeometryType()!==a.Point.type&&e.getGeometryType()!==a.Envelope.type||t.getGeometryType()!==a.Point.type&&t.getGeometryType()!==a.Envelope.type||(i=!1),i){if(this.m_env2DgeometryA=new o.Envelope2D,this.m_env2DgeometryB=new o.Envelope2D,e.queryEnvelope(this.m_env2DgeometryA),t.queryEnvelope(this.m_env2DgeometryB),!(this.m_env2DgeometryA.sqrMaxMinDistanceEnvelope(this.m_env2DgeometryB)>this.m_maxSqrDistance))return!0;if(this.m_env2DgeometryA.sqrDistanceEnvelope(this.m_env2DgeometryB,null,null)>this.m_maxSqrDistance)return!1}const n=c(new r.Point2D,r.indexTypeMax(),Number.NaN),s=c(new r.Point2D,r.indexTypeMax(),Number.NaN);return this._ExecuteBruteForce(e,t,n,s)<=this.m_maxDistance}progress_(e=!1){}_ExecuteBruteForce(e,t,n,s){switch(e.getGeometryType()){case i.GeometryType.enumPoint:return this.distancePointGeometry(e,t,n,s);case i.GeometryType.enumMultiPoint:return this.distanceMultipointGeometry(e,t,n,s);case i.GeometryType.enumEnvelope:return this.distanceEnvelopeGeometry(e,t,n,s);case i.GeometryType.enumPolyline:case i.GeometryType.enumPolygon:return this.distanceMultipathGeometry(e,t,n,s);default:return Number.NaN}}distancePointGeometry(e,t,n,s){switch(t.getGeometryType()){case i.GeometryType.enumPoint:return this.distancePointPoint(e,t,n,s);case i.GeometryType.enumMultiPoint:return this.distancePointMultipoint(e,t,n,s);case i.GeometryType.enumPolyline:case i.GeometryType.enumPolygon:return this.distancePointMultipath(e,t,n,s);case i.GeometryType.enumEnvelope:return this.distancePointEnvelope(e,t,n,s);default:return Number.NaN}}distancePointPoint(e,t,i,n){const s=e.getXY(),o=t.getXY();return h(i,s,0,0),h(n,o,0,0),Math.sqrt(r.Point2D.sqrDistance(s,o))}distancePointMultipoint(e,t,i,n){const s=e.getXY();let o=this.m_maxSqrDistance,a=o,l=!1;const c=t.getPointCount(),u=new r.Point2D;for(let e=0;e<c;++e)if(t.queryXY(e,u),a=r.Point2D.sqrDistance(s,u),this.m_bIsNearCalc){if(a<=o)return 0}else if(!(a>o)&&(!l&&a===o||a<o)&&(o=a,h(i,s,0,0),h(n,u,e,0),l=!0,0===o))return 0;return l?Math.sqrt(o):Number.POSITIVE_INFINITY}distancePointMultipath(e,t,n,a){const l=!this.m_env2DgeometryA.isIntersecting(this.m_env2DgeometryB),c=e.getXY();if(!l&&t.getGeometryType()===i.GeometryType.enumPolygon&&0!==s.isPoint2DInPolygon2D(t,c,0))return h(n,c,0,0),h(a,c,-1,Number.NaN),0;t.getImpl().getAccelerators();let u=this.m_maxSqrDistance,m=u,d=-1;const p=new o.Envelope2D,g=t.querySegmentIterator();let _=!1;for(;g.nextPath();)for(;g.hasNextSegment();){const e=g.nextSegment();e.queryEnvelope(p);const t=p.sqrDistance(c);if(t>u)continue;if(!this.m_bIsNearCalc&&_&&t===u)continue;d=e.getClosestCoordinate(c,!1);const i=e.getCoord2D(d);if(m=r.Point2D.sqrDistance(c,i),this.m_bIsNearCalc){if(m<=u)return 0}else if(!(m>u)&&(!_||m<u)&&(u=m,h(n,c,0,0),h(a,i,g.getStartPointIndex(),d),_=!0,0===u))return 0}return _?Math.sqrt(u):Number.POSITIVE_INFINITY}distancePointEnvelope(e,t,i,n){const s=e.getXY();h(i,s,0,0),h(n,s,-1,Number.NaN);const r=t.asEnvelope2D();return r.contains(s)?0:Math.sqrt(r.sqrDistance(s,n.outPoint))}distanceMultipointGeometry(e,t,n,s){switch(t.getGeometryType()){case i.GeometryType.enumPoint:{this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB);const i=this.distancePointMultipoint(t,e,s,n);return this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),i}case i.GeometryType.enumMultiPoint:return this.distanceMultipointMultipoint(e,t,n,s,1,1);case i.GeometryType.enumPolyline:case i.GeometryType.enumPolygon:return this.distanceMultipointMultipath(e,t,n,s);case i.GeometryType.enumEnvelope:return this.distanceMultipointMultipath(e,f(t),n,s);default:return Number.NaN}}distanceMultipointMultipoint(e,i,n,s,o,a){const l={stack:[],error:void 0,hasError:!1};try{if(this.m_bIsNearCalc&&1===o&&1===a){const t=Math.trunc(r.snap(Math.sqrt(e.getPointCount())+1,1,r.intMax())),o=Math.trunc(r.snap(Math.sqrt(i.getPointCount())+1,1,r.intMax()));if((t>=4||o>=4)&&this.distanceMultipointMultipoint(e,i,n,s,t,o)<=this.m_maxSqrDistance)return 0}let c=this.m_maxSqrDistance;const u=[e],m=[i],p=this.swapGeometriesIfBGtA(u,m);p&&(this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),a=r.swap(o,o=a),d(n,s)),t.__addDisposableResource(l,r.makeScopedCall((()=>{d(n,s),this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB)}),!p),!1);const g=u[0].getImpl(),_=m[0].getImpl(),f=g.getPointCount(),y=_.getPointCount(),x=y>1;let v=!1;const P=new r.Point2D,b=new r.Point2D;for(let e=0;e<f;e+=o){if(g.queryXY(e,P),x){const e=this.m_env2DgeometryB.sqrDistance(P);if(this.m_bIsNearCalc){if(e>c)continue;if(this.m_env2DgeometryB.sqrMaxMinDistance(P)<=c)return 0}else if(e>=c)continue}for(let t=0;t<y;t+=a){_.queryXY(t,b);const i=r.Point2D.sqrDistance(P,b);if(this.m_bIsNearCalc){if(i<=c)return 0}else if(!(i>c||v&&i===c)&&(!v||i<c)&&(h(n,P,e,0),h(s,b,t,0),v=!0,c=i,0===c))return v?Math.sqrt(c):Number.POSITIVE_INFINITY}}return v?Math.sqrt(c):Number.POSITIVE_INFINITY}catch(e){l.error=e,l.hasError=!0}finally{t.__disposeResources(l)}}distanceMultipointMultipath(e,t,n,a){let l=!!this.m_env2DgeometryA.isIntersecting(this.m_env2DgeometryB)&&t.getGeometryType()===i.GeometryType.enumPolygon;const c=t.querySegmentIterator();c.stripAttributes();const u=new o.Envelope2D,m=new r.Point2D;let d=this.m_maxSqrDistance;const p=e.getImpl(),g=p.getPointCount(),_=g>1;let f=!1;for(;c.nextPath();)for(;c.hasNextSegment();){const e=c.nextSegment();if(e.queryLooseEnvelope(u),_){const e=u.sqrDistanceEnvelope(this.m_env2DgeometryA,null,null);if(this.m_bIsNearCalc){if(e>d)continue}else if(e>d||f&&e===d)continue}for(let i=0;i<g;i++){if(p.queryXY(i,m),l&&0!==s.isPoint2DInPolygon2D(t,m,0))return h(n,m,-1,Number.NaN),h(a,m,i,0),0;{const e=u.sqrDistance(m);if(this.m_bIsNearCalc){if(e>d)continue}else if(e>d)continue}const r=e.getClosestCoordinate(m,!1),o=e.getCoord2D(r);m.subThis(o);const g=m.sqrLength();if(this.m_bIsNearCalc){if(g<=d)return 0}else if(!(g>d)&&(!f||g<d)&&(d=g,h(n,p.getXY(i),i,0),h(a,o,c.getStartPointIndex(),r),f=!0,0===d))return 0}l=!1}return f?Math.sqrt(d):Number.POSITIVE_INFINITY}distanceEnvelopeGeometry(e,t,n,s){switch(t.getGeometryType()){case i.GeometryType.enumPoint:return this.distancePointEnvelope(t,e,s,n);case i.GeometryType.enumMultiPoint:{this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB);const i=this.distanceMultipointMultipath(t,f(e),s,n);return this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),i}case i.GeometryType.enumPolyline:case i.GeometryType.enumPolygon:return this.distanceMultipathMultipath(f(e),t,n,s);case i.GeometryType.enumEnvelope:return this.distanceEnvelopeEnvelope(e,t,n,s);default:return Number.NaN}}distanceEnvelopeEnvelope(e,t,i,n){i.t=Number.NaN,i.index=-1,n.t=Number.NaN,n.index=-1;const s=e.asEnvelope2D(),r=t.asEnvelope2D();return Math.sqrt(s.sqrDistanceEnvelope(r,i.outPoint,n.outPoint))}distanceMultipathGeometry(e,t,n,s){switch(t.getGeometryType()){case i.GeometryType.enumPoint:{this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB);const i=this.distancePointMultipath(t,e,s,n);return this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),i}case i.GeometryType.enumMultiPoint:{this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB);const i=this.distanceMultipointMultipath(t,e,s,n);return this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),i}case i.GeometryType.enumPolyline:case i.GeometryType.enumPolygon:return this.distanceMultipathMultipath(e,t,n,s);case i.GeometryType.enumEnvelope:return this.distanceMultipathMultipath(e,f(t),n,s);default:return Number.NaN}}distanceMultipathMultipath(e,i,s,a){const c={stack:[],error:void 0,hasError:!1};try{const h=[e],_=[i],f=this.swapGeometriesIfAGtB(h,_);f&&(this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),d(s,a)),t.__addDisposableResource(c,r.makeScopedCall((()=>{d(s,a),this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB)}),!f),!1);const y=h[0],x=_[0],v=y.querySegmentIterator();v.stripAttributes();const P=x.querySegmentIterator();if(P.stripAttributes(),this.m_bIsNearCalc&&this.m_env2DgeometryA.sqrMaxMinDistanceEnvelope(this.m_env2DgeometryB)<=this.m_maxSqrDistance)return 0;if(this.m_bIsNearCalc){const e=Math.trunc(r.snap(Math.sqrt(y.getPointCount())+1,1,r.intMax())),t=Math.trunc(r.snap(Math.sqrt(y.getPointCount())+1,1,r.intMax()));if(this.distanceMultipointMultipoint(y,x,s,a,e,t)<=this.m_maxSqrDistance)return 0}if(this.m_env2DgeometryA.isIntersecting(this.m_env2DgeometryB)){const e=l(),t=l();if(p(y,x,v,P,e,t))return u(s,e),u(a,t),0}const b=g(y),E=[],S=new n.SegmentBuffer,C=new o.Envelope2D,w=new o.Envelope2D,T=new o.Envelope2D;let D=this.m_maxSqrDistance,I=!0,A=!1;for(let e=0,t=b.length;e<t;++e){y.querySegment(b[e],S,!0);const t=S.get();if(t.queryEnvelope(C),!(C.sqrDistanceEnvelope(this.m_env2DgeometryB,null,null)>D)){if(this.m_bIsNearCalc&&C.sqrMaxDistanceEnvelope(this.m_env2DgeometryB)<=D)return 0;for(;P.nextPath();){if(this.progress_(),I)x.queryPathEnvelope(P.getPathIndex(),T),E[P.getPathIndex()]=T.clone();else if(C.sqrDistanceEnvelope(E[P.getPathIndex()],null,null)>D)continue;for(;P.hasNextSegment();){const i=P.nextSegment();if(i.queryEnvelope(w),C.sqrDistanceEnvelope(w,null,null)<=D){const n=!C.isIntersecting(w),r=[0],o=[0];let l=t.distance(i,n,r,o);if(l*=l,this.m_bIsNearCalc&&l<=this.m_maxSqrDistance)return 0;if(l<D||l===D&&b[e]<s.index){if(A=!0,m(s,t,b[e],r[0]),m(a,i,P.getStartPointIndex(),o[0]),0===l)return 0;D=l}}}}P.resetToFirstPath(),I=!1}}return A?Math.sqrt(D):Number.POSITIVE_INFINITY}catch(e){c.error=e,c.hasError=!0}finally{t.__disposeResources(c)}}swapGeometriesIfAGtB(e,t){return i.vertexCount(e[0])>i.vertexCount(t[0])&&(t[0]=r.swap(e[0],e[0]=t[0]),!0)}swapGeometriesIfBGtA(e,t){return this.swapGeometriesIfAGtB(t,e)}},e.makeOutput=l,e.shuffleMultipathSegments=g,e.weakIntersectionTest=p}))},"esri/chunks/MultiPathImpl":function(){define(["exports","./Geometry","./Envelope","./Point2D","./Envelope2D","./Transformation2D","./SimpleGeometryCursor"],(function(e,t,i,n,s,r,o){"use strict";class a{constructor(){this.posStream=null,this.streams=null}get(e){return e>0?this.streams[e-1]:this.posStream}set(e,t){e>0?this.streams[e-1]=t:this.posStream=t}destroyAndSetSize(e){if(this.streams=null,e>1){this.streams=new Array(e-1);for(let t=0;t<e-1;++t)this.streams[t]=null}this.posStream=null}swap(e){[this.streams,e.streams]=[e.streams,this.streams],[this.posStream,e.posStream]=[e.posStream,this.posStream]}empty(){return null===this.posStream&&null===this.streams}}function l(e,t){let i=n.nextRand(e);const s=t.length/n.intMax();for(let e=0;e<t.length;++e){const e=Math.trunc(i*s);i=n.nextRand(i);const r=Math.trunc(i*s),o=t[e];t[e]=t[r],t[r]=o}}function c(e,t,i){if(!(i<=t))for(;t<i;)e[i]=n.swap(e[t],e[t]=e[i]),t++,i--}var h=i.VertexDescription;const u="can not assign an empty point to a vertex";class m{constructor(e){if(this.m_accelerators=null,void 0!==e&&e.move)this.m_description=e.move.m_description,e.move.m_description=i.getDefaultDescription2D(),this.m_vertexAttributes=e.move.m_vertexAttributes,e.move.m_vertexAttributes=new a,this.m_envelopeData=e.move.m_envelopeData,e.move.m_envelopeData=new i.EnvelopeData,this.m_pointCount=e.move.m_pointCount,this.m_reservedPointCount=e.move.m_reservedPointCount,this.m_flags=e.move.m_flags,this.m_bFillRule=e.move.m_bFillRule,this.m_bPathStarted=e.move.m_bPathStarted,this.m_bPolygon=e.move.m_bPolygon,this.m_simpleTolerance=e.move.m_simpleTolerance;else{const t=void 0!==e&&e.vd?e.vd:i.getDefaultDescription2D();this.m_description=t,this.m_vertexAttributes=new a,this.m_envelopeData=new i.EnvelopeData,this.m_pointCount=0,this.m_reservedPointCount=-1,this.m_flags=4063,this.m_bFillRule=this.m_bPathStarted=this.m_bPolygon=!1,this.m_simpleTolerance=0,void 0!==e&&e.copy&&e.copy.copyTo(this)}}equalsBase(e,i){if(!t.isMultiVertex(e.getGeometryType()))return!1;const n=e;if(this===n)return!0;if(!this.m_description.equals(n.getDescription()))return!1;if(this.isEmptyImpl()!==n.isEmptyImpl())return!1;if(this.isEmptyImpl())return!0;const s=this.getPointCount();if(s!==n.getPointCount())return!1;for(let e=0;e<this.m_description.getAttributeCount();e++){const t=this.m_description.getSemantics(e),r=this.getAttributeStreamRef(t),o=n.getAttributeStreamRef(t),a=h.getComponentCount(t);if(!r.equals(o,0,s*a,i))return!1}if(i){if(!this.equalsImplTol(e,i))return!1}else if(!this.equalsImpl(e))return!1;return!0}transformAttribute(e,n,s,o,a){if(this.addAttribute(e),!this.isEmpty()&&(0!==s||1!==o)){if(0===e){const e=new r.Transformation2D;return 0===a?0===n?(e.setShiftCoords(s,0),e.scale(o,1)):1===n?(e.setShiftCoords(0,s),e.scale(1,o)):t.throwInvalidArgumentException(""):0===n?(e.setScaleCoords(1/o,1),e.shiftCoords(-s,0)):1===n?(e.setScaleCoords(1,1/o),e.shiftCoords(0,-s)):t.throwInvalidArgumentException(""),void this.applyTransformation(e)}!function(e,i,n,s,r){(i<0||n<0||s<1||i+s*(n-1)+1>e.size())&&t.throwInvalidArgumentException("Index out of bound");for(let t=i,o=i+s*(n-1)+1;t<o;t+=s)e.writeAsDbl(t,r(e.readAsDbl(t)))}(this.getAttributeStreamRef(e),n,this.getPointCount(),h.getComponentCount(e),i.applyShiftAndScale(s,o,a)),this.notifyModified()}}getDescription(){return this.m_description}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}mergeVertexDescriptionImpl(e){const t=this.getDescription(),n=i.getMergedVertexDescription(t,e);this.assignVertexDescription(n)}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;const t=i.getMergedVertexDescriptionSemantics(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;const t=i.removeSemanticsFromVertexDescription(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){const e=i.getDefaultDescription2D();e!==this.m_description&&this.assignVertexDescription(e)}getAttributeStreamRef(e){this.throwIfEmpty(),this.m_description.hasAttribute(e)||t.throwInvalidArgumentException("AttributeStream : Geometry does not have the attribute");const i=this.m_description.getAttributeIndex(e);return this.m_vertexAttributes.get(i)}setAttributeStreamRef(e,i){i||t.throwInvalidArgumentException("stream"),i&&h.getPersistence(e)!==i.getPersistence()&&t.throwInvalidArgumentException(""),this.addAttribute(e);const n=this.m_description.getAttributeIndex(e);this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),this.m_vertexAttributes.set(n,i),this.notifyModifiedFlags(2001)}notifyModifiedFlags(e){65535===e&&(this.m_reservedPointCount=-1,this.notifyModifiedAllImpl()),this.setDirtyFlagProtected(e,!0),this.clearAccelerators(),32&e&&this.verifyAllStreamsAfterSizeChange()}notifyModified(){this.notifyModifiedFlags(2001)}getPointCount(){return this.m_pointCount}getPointByVal(e,t){const i=t;i.assignVertexDescription(this.m_description);for(let t=0;t<this.m_description.getAttributeCount();t++){const n=this.m_description.getSemantics(t);for(let s=0,r=h.getComponentCount(n);s<r;s++){const o=this.m_vertexAttributes.get(t).readAsDbl(r*e+s);i.setAttributeBasic(n,s,o)}}}setPointByValNoCurves(e,i){const n=i;n.isEmpty()&&t.throwInvalidArgumentException(u);const s=n.getDescription();s!==this.m_description&&this.mergeVertexDescription(s);const r=this.m_vertexAttributes.get(0);r.write(2*e,n.getX()),r.write(2*e+1,n.getY());for(let t=1,i=this.m_description.getAttributeCount();t<i;t++){const i=this.m_description.getSemantics(t),s=h.getComponentCount(i);for(let r=0;r<s;r++){const o=n.getAttributeAsDbl(i,r);this.m_vertexAttributes.get(t).writeAsDbl(e*s+r,o)}}this.notifyModifiedFlags(2001)}setPointByValFromArrayNoCurves(e,i,n,s){t.geometryReleaseAssert(0)}getPointByValAsArray(e,i,n,s){t.geometryReleaseAssert(0)}isEmpty(){return this.isEmptyImpl()}isEmptyImpl(){return 0===this.m_pointCount}getAttributeAsDbl(e,i,n){const s=h.getComponentCount(e);n>=s&&t.throwOutOfRangeException("");const r=this.m_description.getAttributeIndex(e);return r>=0?this.m_vertexAttributes.get(r).readAsDbl(i*s+n):h.getDefaultValue(e)}queryAttributeAsDbl(e,i,n,s){const r=h.getComponentCount(e);s<r&&t.throwOutOfRangeException("");const o=this.m_description.getAttributeIndex(e);if(o>=0){const e=i*r,t=this.m_vertexAttributes.get(o);for(let i=0;i<r;i++)n[i]=t.readAsDbl(e+i)}else{const t=h.getDefaultValue(e);for(let e=0;e<r;e++)n[e]=t}}getAttributeAsInt(e,t,i){return Math.trunc(this.getAttributeAsDbl(e,t,i))}queryAttributeAsInt(e,i,n,s){t.geometryReleaseAssert(0)}setAttributeNoCurves(e,i,n,s){const r=h.getComponentCount(e);n>=r&&t.throwOutOfRangeException(""),this.addAttribute(e);const o=this.m_description.getAttributeIndex(e);this.notifyModifiedFlags(2001),this.m_vertexAttributes.get(o).writeAsDbl(i*r+n,s)}setAttributeFromArrayNoCurves(e,i,n,s){(i<0||i>=this.m_pointCount)&&t.throwOutOfRangeException("");const r=h.getComponentCount(e);s<r&&t.throwOutOfRangeException(""),this.addAttribute(e);const o=this.m_description.getAttributeIndex(e);this.notifyModifiedFlags(2001);const a=this.m_vertexAttributes.get(o);for(let e=0;e<r;++e)a.writeAsDbl(i*r+e,n[e])}getXY(e){return this.m_vertexAttributes.get(0).readPoint2D(2*e)}queryXY(e,t){return this.m_vertexAttributes.get(0).queryPoint2D(2*e,t)}setXYNoCurves(e,t){this.m_vertexAttributes.get(0).writePoint2D(2*e,t),this.notifyModifiedFlags(2001)}setXYCoordsNoCurves(e,t,i){const n=this.m_vertexAttributes.get(0);n.write(2*e,t),n.write(2*e+1,i),this.notifyModifiedFlags(2001)}getXYZ(e){const t=this.m_vertexAttributes.get(0),n=i.Point3D.getNAN();return n.x=t.read(2*e),n.y=t.read(2*e+1),this.m_description.hasAttribute(1)?n.z=this.m_vertexAttributes.get(1).read(e):n.z=h.getDefaultValue(1),n}setXYZNoCurves(e,t){this.addAttribute(1),this.notifyModifiedFlags(2001);const i=this.m_vertexAttributes.get(0);i.write(2*e,t.x),i.write(2*e+1,t.y),this.m_vertexAttributes.get(1).write(e,t.z)}queryEnvelope(e){e instanceof s.Envelope2D||e instanceof i.Envelope3D?this.updateEnvelope(e):(this.updateAllDirtyIntervals(!0),this.m_envelopeData.copyTo(this.m_description,e))}queryLooseEnvelope(e){this.updateLooseEnvelope(e)}queryInterval(e,t){const i=n.Envelope1D.constructEmpty();return this.isEmptyImpl()||(this.updateAllDirtyIntervals(!0),this.m_envelopeData.queryInterval(this.m_description,e,t,i)),i}setAttributeBasic(e,t,i){this.setAttributeImpl(e,t,i)}setAttributeImpl(e,t,i){if(this.addAttribute(e),this.isEmpty())return;let n=!1;const s=h.getComponentCount(e),r=this.getAttributeStreamRef(e),o=Number.isNaN(i);if(1===r.getPersistence()){const e=r;for(let r=t,a=this.m_pointCount*s;r<a;r+=s){const t=e.read(r);(o||t===i)&&Number.isNaN(t)||(e.write(r,i),n=!0)}}else for(let e=t,o=this.m_pointCount*s;e<o;e+=s)r.readAsDbl(e)!==i&&(r.writeAsDbl(e,i),n=!0);n&&this.notifyModifiedFlags(2001)}replaceNaNs(e,t){if(this.addAttribute(e),this.isEmpty())return;let i=!1;const n=h.getComponentCount(e),s=this.getAttributeStreamRef(e);for(let e=0;e<n;e++)if(1===s.getPersistence()){const e=s;for(let s=0,r=this.m_pointCount*n;s<r;s++){const n=e.read(s);Number.isNaN(n)&&(e.write(s,t),i=!0)}}else for(let e=0,r=this.m_pointCount*n;e<r;e++){const n=s.readAsDbl(e);Number.isNaN(n)&&(s.writeAsDbl(e,t),i=!0)}i&&this.notifyModifiedFlags(2001)}calculateLength3D(e){return t.geometryReleaseAssert(0),0}setEnvelopeForImport(e){this.m_description.equals(e.getDescription())||t.throwInvalidArgumentException(""),this.m_envelopeData=new i.EnvelopeData({moveEnv:e}),this.setDirtyFlagProtected(192,!1)}copyTo(e){e.getGeometryType()!==this.getGeometryType()&&t.throwInvalidArgumentException(""),this!==e&&this.copyToUnchecked(e,!1)}queryCoordinates(e,i,n,s){let r=s<0?this.m_pointCount:s;if(r=Math.min(r,n+i),(n<0||r<n||this.m_pointCount>0&&n>=this.m_pointCount)&&t.throwInvalidArgumentException(""),0===this.m_pointCount)return r;const o=this.getAttributeStreamRef(0);for(let t=2*n,i=2*r,s=0;t<i;t+=2,s++)o.queryPoint2D(t,e[s]);return r}queryCoordinates3D(e,i,n,s){let r=s<0?this.m_pointCount:s;if(r=Math.min(r,n+i),(n<0||r<n||this.m_pointCount>0&&n>=this.m_pointCount)&&t.throwInvalidArgumentException(""),0===this.m_pointCount)return r;const o=this.getAttributeStreamRef(0);let a=null;const l=h.getDefaultValue(1),c=this.m_description.hasAttribute(1);c&&(a=this.getAttributeStreamRef(1));let u=0;for(let t=n;t<r;t++,u++)e[u].x=o.read(2*t),e[u].y=o.read(2*t+1),e[u].z=c?a.read(t):l;return r}clearAndSetDirtyFlagProtected(e,t){let i=0;const n=e&~t,s=t|n;i=this.m_flags,(i&s)!==t&&(this.m_flags=i&~n|t)}getIsSimple(e,t){t[0]=0;let i=-1;const n=this.m_flags,s=this.m_simpleTolerance;return 1&n||(i=(14&n)>>1,t[0]=s,s<e&&(i=-1)),i}setIsSimple(e,i,n=!1){if(2===e?t.geometryReleaseAssert(this.getGeometryType()===t.GeometryType.enumPolyline):1===e?t.geometryReleaseAssert(this.getGeometryType()===t.GeometryType.enumMultiPoint||this.getGeometryType()===t.GeometryType.enumPolyline):3===e&&t.geometryReleaseAssert(this.getGeometryType()===t.GeometryType.enumPolygon),-1===e)this.setDirtyFlagProtected(17,!0);else{let t=e<<1;n||(t|=16);const s=31;this.clearAndSetDirtyFlagProtected(s,t),this.m_simpleTolerance!==i&&(this.m_simpleTolerance=i)}}attributeStreamIsAllocated(e){this.throwIfEmpty();const t=this.m_description.getAttributeIndex(e);return t>=0&&null!==this.m_vertexAttributes.get(t)}capacity(){return-1===this.m_reservedPointCount&&0===this.m_pointCount?0:this.m_reservedPointCount}getDescriptionImpl(){return this.m_description}copyToUnchecked(e,i=!1){i&&this.hasDirtyFlag(32)&&t.throwLogicErrorException("Cannot do shallow clone on unprepared geometry");const n=e,s=this.getGeometryType(),r=n.getGeometryType();t.geometryReleaseAssert(s===r||s===t.GeometryType.enumPolygon&&r===t.GeometryType.enumPolyline,"failure in copyToUnchcked"),n.clearAccelerators(),n.m_description=this.m_description,n.m_vertexAttributes.destroyAndSetSize(0),n.m_envelopeData.releaseAttributes();const o=this.m_description.getAttributeCount(),l=new a;if(!this.m_vertexAttributes.empty()){l.destroyAndSetSize(o);for(let e=0;e<o;e++)if(this.m_vertexAttributes.get(e))if(i)l.set(e,this.m_vertexAttributes.get(e));else{const t=h.getComponentCount(this.m_description.getSemantics(e));l.set(e,this.m_vertexAttributes.get(e).restrictedClone(this.getPointCount()*t))}}if(this.m_envelopeData.copyToIfNotNull(this.m_description,n.m_envelopeData),n.m_flags=this.m_flags,n.m_simpleTolerance=this.m_simpleTolerance,s!==r){const e=[Number.NaN];n.getIsSimple(0,e)>=3?n.setIsSimple(1,e[0]):n.setIsSimple(-1,0)}n.m_vertexAttributes.swap(l),l.destroyAndSetSize(0),n.m_pointCount=this.m_pointCount,n.hasDirtyFlag(32)||n.m_vertexAttributes.empty()?(t.geometryReleaseAssert(!i||0===n.m_pointCount),n.m_reservedPointCount=-1):n.m_reservedPointCount=n.m_pointCount;try{this.copyToImpl(n,i)}catch(e){throw n.setEmpty(),e}n.verifyAllStreamsAfterSizeChange()}buildRasterizedGeometryAccelerator(e,t){return!1}getAccelerators(){return this.m_accelerators}clearAccelerators(){this.m_accelerators&&this.m_accelerators.release(),this.m_accelerators=null}ensureUniqueAccelerators(){if(this.m_accelerators&&!this.m_accelerators.uniqueUse()){const e=this.m_accelerators.clone();this.m_accelerators.release(),this.m_accelerators=e}}interpolateTwoVertices(e,s,r,o){(e<0||e>=this.m_pointCount)&&t.throwOutOfRangeException(""),(s<0||s>=this.m_pointCount)&&t.throwOutOfRangeException(""),o.assignVertexDescription(this.m_description);const a=n.makePrimitiveArray(h.maxComponentCount(),Number.NaN),l=n.makePrimitiveArray(h.maxComponentCount(),Number.NaN),c=i.newOrdinateBuffer();let u=0;for(let o=0;o<this.m_description.getAttributeCount();o++){const m=this.m_description.getSemantics(o),d=h.getInterpolation(m),p=h.getComponentCount(m),g=h.getDefaultValue(m);this.queryAttributeAsDbl(m,e,a,p),this.queryAttributeAsDbl(m,s,l,p),t.geometryReleaseAssert(u+p<=i.OrdinateBufferLength),n.interpolateArray(d,a,l,c,u,p,r,g),u+=p}!function(e,t){const i=e.getDescription().getTotalComponentCount();e.setX(t[0]),e.setY(t[1]),n.memcpy(e.getAttributeArray(),t,0,2,i-2)}(o,c)}getShortestDistance(e,t){return n.Point2D.distance(this.getXY(e),this.getXY(t))}getShortestSqrDistance(e,t){return n.Point2D.sqrDistance(this.getXY(e),this.getXY(t))}resizeImpl(e){if(e<0&&t.throwInvalidArgumentException(),(e=Math.ceil(e))===this.m_pointCount)return;this.m_pointCount=e;const i=this.m_pointCount<=this.m_reservedPointCount?2001:4095;this.notifyModifiedFlags(i)}assignVertexDescriptionImpl(e){if(!this.m_vertexAttributes.empty()){const t=i.createAttributeMap();i.mapAttributes(e,this.m_description,t);const n=new a;n.destroyAndSetSize(e.getAttributeCount());for(let i=0;i<e.getAttributeCount();i++){const e=t[i];-1!==e?n.set(i,this.m_vertexAttributes.get(e)):this.m_reservedPointCount=-1}n.swap(this.m_vertexAttributes)}this.m_description=e,this.m_envelopeData.releaseAttributes(),this.notifyModifiedFlags(4095)}hasDirtyFlag(e){return 0!==(this.m_flags&e)}setDirtyFlagProtected(e,t){t?this.m_flags|=e:this.m_flags&=~e}notifyModifiedAllImpl(){}verifyAllStreamsAfterSizeChange(){this.hasDirtyFlag(32)&&this.verifyAllStreamsAfterSizeChangeImpl()}verifyAllStreamsAfterSizeChangeImpl(){if(this.hasDirtyFlag(32)){if(this.m_reservedPointCount<this.m_pointCount){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),this.m_reservedPointCount=-1;let e=Number.MAX_SAFE_INTEGER,t=0;t=this.m_pointCount<4?3:this.m_pointCount<=128?2*this.m_pointCount:Math.trunc((4*this.m_pointCount+2)/3);for(let n=0;n<this.m_description.getAttributeCount();n++){const s=this.m_description.getSemantics(n);let r=0;if(null!==this.m_vertexAttributes.get(n)){const e=h.getComponentCount(s);r=this.m_vertexAttributes.get(n).size()/e,r<this.m_pointCount&&(this.m_vertexAttributes.get(n).resize(t*e,h.getDefaultValue(s)),r=t)}else this.m_vertexAttributes.set(n,i.createAttributeStreamFromSemantics(s,t)),r=t;r<e&&(e=r)}this.m_reservedPointCount=e}this.verifyStreamsAfterSizeChangeExtraImpl(),this.setDirtyFlagProtected(32,!1)}}verifyStreamsAfterSizeChangeExtraImpl(){}updateAllDirtyIntervals(e){if(e?this.hasDirtyFlag(192):this.hasDirtyFlag(128)){if(this.isEmpty())return this.hasDirtyFlag(192)&&this.m_envelopeData.setEmpty(this.m_description),void this.setDirtyFlagProtected(192,!1);const t=this.updateXYImpl(e),s=new i.Envelope({vd:this.m_description});s.setEnvelope(t);for(let e=1;e<this.m_description.getAttributeCount();e++){const t=this.m_description.getSemantics(e),i=h.getComponentCount(t),r=this.m_vertexAttributes.get(e);for(let e=0;e<i;e++){const o=new n.Envelope1D;o.setEmpty();for(let t=0;t<this.m_pointCount;t++){const n=r.readAsDbl(t*i+e);o.mergeCoordinate(n)}s.setIntervalEnvelope(t,e,o)}}(e?this.hasDirtyFlag(192):this.hasDirtyFlag(128))&&(this.m_envelopeData=new i.EnvelopeData({moveEnv:s}),this.clearDirtyIntervalsFlag(e))}}updateXYImpl(e){const t=s.Envelope2D.constructEmpty(),i=this.m_vertexAttributes.get(0);return t.mergePointsInterleaved(i,0,this.m_pointCount),t}updateEnvelope3D(e){t.geometryReleaseAssert(0)}updateLooseEnvelope(e){this.updateAllDirtyIntervals(!1),e instanceof s.Envelope2D?e.assign(this.m_envelopeData.m_envelope2D):this.m_envelopeData.queryEnvelope3D(this.m_description,e)}updateEnvelope(e){this.updateAllDirtyIntervals(!0),e.assign(this.m_envelopeData.m_envelope2D)}setEmptyImpl(){this.m_pointCount=0,this.m_reservedPointCount=-1,this.m_vertexAttributes.destroyAndSetSize(0),this.notifyModifiedFlags(4095)}clearDirtyIntervalsFlag(e){this.setDirtyFlagProtected(192,!1)}reserveImpl(e,n){if(e<0&&t.throwInvalidArgumentException(""),0===e)return;let s=e=Math.ceil(e);if(this.m_reservedPointCount<s){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),n?(null===this.m_vertexAttributes.get(0)&&this.m_vertexAttributes.set(0,i.createAttributeStreamUninitialized(0,0)),this.m_vertexAttributes.get(0).resizeRounded(2*s),s=this.m_vertexAttributes.get(0).size()>>1):null===this.m_vertexAttributes.get(0)?this.m_vertexAttributes.set(0,i.createAttributeStreamUninitialized(0,s)):this.m_vertexAttributes.get(0).resize(2*s);for(let e=1;e<this.m_description.getAttributeCount();e++){const t=this.m_description.getSemantics(e),n=h.getComponentCount(t);null!==this.m_vertexAttributes.get(e)?this.m_vertexAttributes.get(e).resize(s*n):this.m_vertexAttributes.set(e,i.createAttributeStreamUninitialized(t,s))}this.reserveImplImpl(s,n),this.m_reservedPointCount=s}}reserveRounded(e){e<0&&t.throwInvalidArgumentException(),e=Math.ceil(e),this.reserveImpl(e,!0)}reserveImplImpl(e,t){}throwIfEmpty(){this.isEmptyImpl()&&t.throwEmptyGeometryException("")}}class d extends m{constructor(e){super(e),e&&(e.points?this.addPoints2D(e.points,e.pointsSize,0,-1):e.point&&this.add(e.point))}assignCopy(e){return e.copyTo(this),this}assignMove(e){return e.copyTo(this),e.setEmpty(),this}insertPoint2D(e,n){e>this.getPointCount()&&t.throwInvalidArgumentException("invalid point index"),e<0&&(e=this.getPointCount());const s=this.m_pointCount;this.resizeNoInit(this.m_pointCount+1);for(let t=0,r=this.m_description.getAttributeCount();t<r;t++){const r=this.m_description.getSemantics(t),o=i.VertexDescription.getComponentCount(r);if(0===r)this.m_vertexAttributes.get(t).insert(o*e,n,o*s);else{const n=i.VertexDescription.getDefaultValue(r);this.m_vertexAttributes.get(t).insertRange(o*e,n,o,o*s)}}this.notifyModifiedFlags(2001)}insertPoint(e,n){n.isEmpty()&&t.throwInvalidArgumentException(u),e<0&&(e=this.getPointCount()),this.mergeVertexDescription(n.getDescription());const s=this.m_pointCount;this.resizeNoInit(this.m_pointCount+1);for(let t=0,r=this.m_description.getAttributeCount();t<r;t++){const r=this.m_description.getSemantics(t),o=i.VertexDescription.getComponentCount(r);if(n.hasAttribute(r))this.m_vertexAttributes.get(t).insertAttributes(o*e,n,r,o*s);else{const n=i.VertexDescription.getDefaultValue(r);this.m_vertexAttributes.get(t).insertRange(o*e,n,o,o*s)}}this.notifyModifiedFlags(2001)}insertPoints(e,n,s){if((e>this.getPointCount()||s<0)&&t.throwOutOfRangeException(""),e<0&&(e=this.getPointCount()),0===s)return;const r=n[0].getDescription();this.mergeVertexDescription(r);const o=this.m_pointCount;this.resizeNoInit(this.m_pointCount+s);for(let t=0,a=this.m_description.getAttributeCount();t<a;t++){const a=this.m_description.getSemantics(t),l=i.VertexDescription.getComponentCount(a);if(this.m_vertexAttributes.get(t))if(r.hasAttribute(a))this.m_vertexAttributes.get(t).insertAttributesFromPoints(e*l,n,s,a,o*l);else{const n=i.VertexDescription.getDefaultValue(a);this.m_vertexAttributes.get(t).insertRange(l*e,n,l*s,l*o)}}this.notifyModifiedFlags(2001)}insertPoints2D(e,n,s){if((e>this.getPointCount()||s<0)&&t.throwInvalidArgumentException("invalid point index"),e<0&&(e=this.getPointCount()),0===s)return;const r=this.m_pointCount;this.resizeNoInit(this.m_pointCount+s);for(let t=0,o=this.m_description.getAttributeCount();t<o;t++){const o=this.m_description.getSemantics(t),a=i.VertexDescription.getComponentCount(o);if(this.m_vertexAttributes.get(t))if(0===o)this.m_vertexAttributes.get(t).insertRangeFromPoints(a*e,n,0,s,!0,a*r);else{const n=i.VertexDescription.getDefaultValue(o);this.m_vertexAttributes.get(t).insertRange(a*e,n,a,a*r)}}this.notifyModifiedFlags(2001)}removePoints(e,n){if((e<0||n<0||e+n>this.getPointCount())&&t.throwOutOfRangeException("remove_points"),0!==n){for(let t=0,s=this.m_description.getAttributeCount();t<s;t++)if(this.m_vertexAttributes.get(t)){const s=this.m_description.getSemantics(t),r=i.VertexDescription.getComponentCount(s);this.m_vertexAttributes.get(t).eraseRange(r*e,r*n,r*this.m_pointCount)}this.m_pointCount-=n,this.m_reservedPointCount>0&&(this.m_reservedPointCount-=n),this.notifyModifiedFlags(2001)}}removePoint(e){for(let t=0,n=this.m_description.getAttributeCount();t<n;t++)if(this.m_vertexAttributes.get(t)){const n=this.m_description.getSemantics(t),s=i.VertexDescription.getComponentCount(n);this.m_vertexAttributes.get(t).eraseRange(s*e,s,s*this.m_pointCount)}this.m_pointCount--,this.m_reservedPointCount>0&&this.m_reservedPointCount--,this.notifyModifiedFlags(2001)}calculateEnvelope2D(){return this.updateXYImpl(!0)}resizeNoInit(e){this.resizeImpl(e)}resizeAndInitNonPositionAttributes(e){const t=this.m_pointCount;if(this.resizeImpl(e),this.m_pointCount>t)for(let e=1,n=this.m_description.getAttributeCount();e<n;e++){const n=this.m_description.getSemantics(e),s=i.VertexDescription.getDefaultValue(n),r=i.VertexDescription.getComponentCount(n);this.m_vertexAttributes.get(e).insertRange(r*t,s,r*(this.m_pointCount-t),r*t)}}queryCoordinates3D(e,n,s,r){let o=r<0?this.m_pointCount:r;if(o=Math.min(o,s+n),(s<0||o<s||this.m_pointCount>0&&s>=this.m_pointCount)&&t.throwInvalidArgumentException(""),0===this.m_pointCount)return o;const a=this.getAttributeStreamRef(0);let l=null;const c=i.VertexDescription.getDefaultValue(1),h=this.m_description.hasAttribute(1);h&&(l=this.getAttributeStreamRef(1));let u=0;for(let t=s;t<o;t++,u++)e[u].x=a.read(2*t),e[u].y=a.read(2*t+1),e[u].z=h?l.read(t):c;return o}queryAttributeAsInt(e,i,n,s){t.geometryReleaseAssert(0)}add(e){e.isEmpty()&&t.throwInvalidArgumentException(u),this.resizeAndInitNonPositionAttributes(this.m_pointCount+1),this.setPointByValNoCurves(this.m_pointCount-1,e)}addXY(e,t){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);const i=new n.Point2D(e,t);this.setXYNoCurves(this.m_pointCount-1,i)}addXYZ(e,t,n){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);const s=new i.Point3D;s.setCoords(e,t,n),this.setXYZNoCurves(this.m_pointCount-1,s)}addPoint2D(e){this.addXY(e.x,e.y)}addPoint3D(e){this.addXYZ(e.x,e.y,e.z)}addPoints(e,n,s){this===e&&t.throwInvalidArgumentException("Multi_point_impl.add");const r=s<0?e.getPointCount():s;if((n<0||n>e.getPointCount()||r<n)&&t.throwInvalidArgumentException(""),n===r)return;const o=e.getDescription();this.mergeVertexDescription(o);const a=r-n,l=this.m_pointCount;this.resizeNoInit(this.m_pointCount+a);for(let t=0,s=this.m_description.getAttributeCount();t<s;t++){const s=this.m_description.getSemantics(t),r=i.VertexDescription.getComponentCount(s),c=this.getAttributeStreamRef(s);if(o.hasAttribute(s)){const t=e.getAttributeStreamRef(s);c.insertRangeFromStream(l*r,t,n*r,a*r,!0,1,l*r)}else{const e=i.VertexDescription.getDefaultValue(s);c.insertRange(l*r,e,a*r,l*r)}}}addPoints2D(e,i,n,s){let r=i;const o=s<0?r:s;if((r<0||n<0||n>r||o<n)&&t.throwInvalidArgumentException(""),n===o)return;r=o-n;const a=this.m_pointCount;this.resizeAndInitNonPositionAttributes(this.m_pointCount+r);const l=this.getAttributeStreamRef(0);for(let t=0;t<r;++t)l.writePoint2D(2*(a+t),e[n+t]);this.notifyModifiedFlags(2001)}addPoints3D(e,i,s,r){let o=i;const a=r<0?o:r;if((o<0||s<0||s>o||a<s)&&t.throwInvalidArgumentException(""),this.addAttribute(1),s===a)return;o=a-s;const l=this.m_pointCount;this.resizeAndInitNonPositionAttributes(this.m_pointCount+o);const c=this.getAttributeStreamRef(0),h=new n.Point2D;for(let t=0;t<o;t++)h.x=e[s+t].x,h.y=e[s+t].y,c.writePoint2D(2*(l+t),h);const u=this.getAttributeStreamRef(1);for(let t=0;t<o;t++)u.write(l+t,e[s+t].z);this.notifyModifiedFlags(2001)}setPointByVal(e,t){this.setPointByValNoCurves(e,t)}setXY(e,t){this.setXYNoCurves(e,t)}setXYCoords(e,t,i){this.setXYCoordsNoCurves(e,t,i)}setXYZ(e,t){this.setXYZNoCurves(e,t)}setAttribute(e,t,i,n){this.setAttributeNoCurves(e,t,i,n)}getGeometryType(){return t.GeometryType.enumMultiPoint}getDimension(){return 0}createInstance(){return new d({vd:this.getDescription()})}setEmpty(){this.setEmptyImpl()}applyTransformation(e){if(this.isEmpty())return;if(e.isIdentity())return;const i=this.m_vertexAttributes.get(0);1===e.m_TransformationType?i.applyTransformation(e,0,this.m_pointCount):t.throwNotImplementedException("3d xform not impl"),this.notifyModifiedFlags(2001)}calculateArea2D(){return 0}calculateLength2D(){return 0}calculateLength3D(e){return 0}equals(e,i){return e.getGeometryType()===t.GeometryType.enumMultiPoint&&this.equalsBase(e,i)}queryEnvelope(e){4===e.m_EnvelopeType?(this.updateAllDirtyIntervals(!0),this.m_envelopeData.copyTo(this.m_description,e)):2===e.m_EnvelopeType?this.updateEnvelope(e):t.throwNotImplementedException("")}getImpl(){return this}getBoundary(){return null}reserve(e){this.reserveImpl(e)}clone(){const e=this.createInstance();return this.copyTo(e),e}swap(e){t.geometryReleaseAssert(0)}buildQuadTreeAccelerator(e){return!1}getHashCodeImpl(){return t.geometryReleaseAssert(0),0}equalsImpl(e){return!0}equalsImplTol(e,t){return!0}copyToImpl(e,t){}}d.type=t.GeometryType.enumMultiPoint;class p{constructor(){this.m_EnvelopeType=5,this.envAabb=s.Envelope2D.constructEmpty(),this.envRot=s.Envelope2D.constructEmpty()}static constructEmpty(){return new p}width(){return this.envAabb.width()}height(){return this.envAabb.height()}maxDim(){return Math.max(this.width(),this.height())}setEmpty(){this.envAabb.setEmpty(),this.envRot.setEmpty()}setCoords(e){this.envAabb.setCoords(e),this.envRot.setCoords({x:g(e),y:_(e)})}setFromPoints(e,t){this.setEmpty(),this.mergePoints(e,t)}mergeNe(e){this.envAabb.mergeNe(e),this.envRot.mergeNeCoords(g(e),_(e))}mergePoints(e,t){this.envAabb.mergePoints(e,t);for(let i=0;i<t;){if(!this.envRot.isEmpty()){for(let n=i;n<t;n++){const t=g(e[n]),i=_(e[n]);this.envRot.mergeNeCoords(t,i)}break}{const t=g(e[i]),n=_(e[i]);this.envRot.setCoords({x:t,y:n}),i++}}}isIntersectingPoint2D(e){return!(!this.envAabb.contains(e)||!this.envRot.containsCoords(g(e),_(e)))}isIntersectingW(e){return this.envAabb.isIntersecting(e.envAabb)&&this.envRot.isIntersecting(e.envRot)}containsW(e){return!(!this.envAabb.containsEnvelope(e.envAabb)||!this.envRot.containsEnvelope(e.envRot))}containsPoint2D(e){return this.isIntersectingPoint2D(e)}intersectW(e){const t=this.envAabb.intersect(e.envAabb),i=this.envRot.intersect(e.envRot);return t&&!i&&this.envAabb.setEmpty(),i&&!t&&this.envRot.setEmpty(),t&&i}inflate(e){this.envAabb.inflateCoords(e,e);const t=e*n.sqrt2();this.envRot.inflateCoords(t,t),t<0&&p.st_reduceEmpty(this)}static st_reduceEmpty(e){const t=e.envAabb.isEmpty(),i=e.envRot.isEmpty();t&&!i?e.envRot.setEmpty():i&&!t&&e.envAabb.setEmpty()}sqrMaxMinDistance(e){const t=this.envAabb.sqrMaxMinDistance(e),i=this.envRot.sqrMaxMinDistance(f(e))/2;return Math.max(t,i)}sqrMinDistance(e){const t=this.envAabb.sqrMinDistance(e),i=this.envRot.sqrMinDistance(f(e))/2;return Math.max(t,i)}sqrMaxDistance(e){const t=this.envAabb.sqrMaxDistance(e),i=this.envRot.sqrMaxDistance(f(e))/2;return Math.max(t,i)}getEnvelope2D(){return this.envAabb}getRotatedEnvelope2D(){return this.envRot}xyRot(e,t){const i=e.x-e.y,n=(s=e.x,r=e.y,s+r);var s,r;t.setCoords(i,n)}}function g(e){return e.x-e.y}function _(e){return e.x+e.y}function f(e){return new n.Point2D(g(e),_(e))}class y{constructor(){this.x=n.ECoordinate.getNAN(),this.y=n.ECoordinate.getNAN()}static getNAN(){return new y}static constructPoint2D(e){const t=new y;return t.x.set(e.x),t.y.set(e.y),t}static constructCoords(e,t){const i=new y;return i.x.set(e),i.y.set(t),i}static constructCoordsE(e,t){const i=new y;return i.setCoordsE(e,t),i}get 0(){return this.x.clone()}set 0(e){this.x.setE(e)}get 1(){return this.y.clone()}set 1(e){this.y.setE(e)}clone(){return(new y).setE(this)}scaleThis(e){return this.x.mulThisE(e),this.y.mulThisE(e),this}setCoords(e,t){return this.x.set(e),this.y.set(t),this}setCoordsE(e,t){return this.x.setE(e),this.y.setE(t),this}set(e){return this.x.set(e.x),this.y.set(e.y),this}setE(e){return this.x.setE(e.x),this.y.setE(e.y),this}setWithEps(e,t){return this.x.setWithEps(e.x,t),this.y.setWithEps(e.y,t),this}getUnitVector(){const e=this.clone();return e.normalize(),e}sqrLength(){return this.x.sqr().addE(this.y.sqr())}length(){return this.sqrLength().sqrt()}mulE(e){const t=new y;return t.setCoordsE(this.x.mulE(e),this.y.mulE(e)),t}mul(e){const t=new y;return t.setCoordsE(this.x.mul(e),this.y.mul(e)),t}mulThis(e){return this.x.mulThis(e),this.y.mulThis(e),this}mulThisE(e){return this.x.mulThisE(e),this.y.mulThisE(e),this}divE(e){return this.clone().divThisE(e)}divThisE(e){return this.x.divThisE(e),this.y.divThisE(e),this}normalize(){const e=this.length();0===e.value()?(this.x=n.s_one.clone(),this.y=n.s_zero.clone()):(this.x.divThisE(e),this.y.divThisE(e))}addE(e){return this.clone().addThisE(e)}addThisE(e){return this.x.addThisE(e.x),this.y.addThisE(e.y),this}subE(e){return this.clone().subThisE(e)}subThisE(e){return this.x.subThisE(e.x),this.y.subThisE(e.y),this}static distance(e,t){return e.subE(t).length()}negateThis(){return this.x.negateThis(),this.y.negateThis(),this}eq(e){return this.x.eq(e.x)&&this.y.eq(e.y)}isZero(){return this.x.isZero()&&this.y.isZero()}isTrueZero(){return!this.x.value()&&!this.y.value()}rotateDirect(e,t){const i=this.x.mulE(e).subThisE(this.y.mulE(t)),n=this.x.mulE(t).addThisE(this.y.mulE(e));return this.x.setE(i),this.y.setE(n),this}rotateReverse(e,t){const i=this.x.mulE(e).addThisE(this.y.mulE(t)),n=this.x.negate().mulThisE(t).addThisE(this.y.mulE(e));return this.x.setE(i),this.y.setE(n),this}dotProduct(e){return this.x.mulE(e.x).addE(this.y.mulE(e.y))}crossProduct(e){return this.x.mulE(e.y).subE(this.y.mulE(e.x))}value(){return n.Point2D.construct(this.x.value(),this.y.value())}}class x{constructor(){this.a11=new n.ECoordinate(1),this.a12=new n.ECoordinate(0),this.a21=new n.ECoordinate(0),this.a22=new n.ECoordinate(1)}clone(){const e=new x;return e.a11.setE(this.a11),e.a12.setE(this.a12),e.a21.setE(this.a21),e.a22.setE(this.a22),e}assign(e){return this.a11.setE(e.a11),this.a12.setE(e.a12),this.a21.setE(e.a21),this.a22.setE(e.a22),this}mulThis(e){const t=this.a11.mulE(e.a11).addThisE(this.a12.mulE(e.a21)),i=this.a11.mulE(e.a12).addThisE(this.a12.mulE(e.a22)),n=this.a21.mulE(e.a11).addThisE(this.a22.mulE(e.a21)),s=this.a21.mulE(e.a12).addThisE(this.a22.mulE(e.a22));return this.a11=t,this.a12=i,this.a21=n,this.a22=s,this}mulLeftThis(e){const t=e.clone();return this.assign(t.mulThis(this)),this}det(){return this.a11.mulE(this.a22).subThisE(this.a12.mulE(this.a21))}invertThis(){const e=this.det();if(0!==e.value()){const t=this.a22.divE(e),i=this.a12.negate().divThisE(e),n=this.a21.negate().divThisE(e),s=this.a11.divE(e);this.a11=t,this.a12=i,this.a21=n,this.a22=s}else this.setZero();return!e.isZero()}transposeThis(){return this.a21=n.swap(this.a12,this.a12=this.a21),this}eigenSymmetric(e,t){const i=this.a12.clone();i.addThisE(this.a21),i.mulThisByPower2(.5);let s=new n.ECoordinate(1),r=new n.ECoordinate(0);if(i.isZero())e[0].setE(this.a11),e[1].setE(this.a22);else{const t=new n.ECoordinate(1);if(this.a11.ne(this.a22)){const o=this.a11.subE(this.a22).divE(i);o.mulThisByPower2(.5);const a=o.sqr();t.setE(o),t.absThis(),t.subThisE(a.add(1).sqrtThis()),o.gt(n.s_zero)&&t.negateThis();const l=t.sqr().addThis(1).sqrtThis().invThis();r=t.mulE(l),s.setE(l);const c=t.mulE(i);e[0]=this.a11.addE(c),e[1]=this.a22.subE(c)}else s=new n.ECoordinate(1/Math.sqrt(2)),r=s.clone(),e[0]=this.a11.addE(i),e[1]=this.a22.subE(i)}t[0].x=s.toDouble(),t[0].y=r.toDouble(),t[1].x=r.negate().toDouble(),t[1].y=s.toDouble(),Math.abs(e[0].toDouble())>Math.abs(e[1].toDouble())&&(e[1]=n.swap(e[0],e[0]=e[1]),t[1]=n.swap(t[0],t[0]=t[1]))}setZero(){this.a11.set(0),this.a21.set(0),this.a12.set(0),this.a22.set(0)}}class v{static constructPoint2D(e){return new v(n.MPValue.constructDouble(e.x),n.MPValue.constructDouble(e.y))}constructor(e,t){if(void 0===e)return this.x=(new n.MPValue).setNAN(),void(this.y=(new n.MPValue).setNAN());this.x=e.clone(),this.y=t.clone()}assignPoint2D(e){return this.x.setDouble(e.x),this.y.setDouble(e.y),this}setCoords(e,t){return this.x.setThis(e),this.y.setThis(t),this}asPoint2D(){return new n.Point2D(this.x.value(),this.y.value())}crossProduct(e){return this.x.mul(e.y).sub(this.y.mul(e.x))}leftPerpendicularThis(){const e=this.x.clone();this.x=this.y.clone().negate(),this.y=e}clone(){return new v(this.x,this.y)}dotProduct(e){return this.x.mul(e.x).add(this.y.mul(e.y))}add(e){return new v(this.x.add(e.x),this.y.add(e.y))}sub(e){return new v(this.x.sub(e.x),this.y.sub(e.y))}sqrLength(){return this.x.sqr().addThis(this.y.sqr())}mulThis(e){return this.x.mulThis(e),this.y.mulThis(e),this}mul(e){return this.clone().mulThis(e)}subThis(e){return this.x.subThis(e.x),this.y.subThis(e.y),this}addThis(e){return this.x.addThis(e.x),this.y.addThis(e.y),this}}var P=i.VertexDescription;function b(e){let t=!1;for(let i=0;i<2;i++){const s=n.compareNoNANs(e[0][i],e[3][i]);s>0?(n.compareNoNANs(e[0][i],e[1][i])<0&&(e[1][i]=e[0][i],t=!0),n.compareNoNANs(e[1][i],e[3][i])<0&&(e[1][i]=e[3][i],t=!0),n.compareNoNANs(e[0][i],e[2][i])<0&&(e[2][i]=e[0][i],t=!0),n.compareNoNANs(e[2][i],e[3][i])<0&&(e[2][i]=e[3][i],t=!0),n.compareNoNANs(e[1][i],e[2][i])<0&&(e[2][i]=e[1][i],t=!0)):s<0?(n.compareNoNANs(e[0][i],e[1][i])>0&&(e[1][i]=e[0][i],t=!0),n.compareNoNANs(e[1][i],e[3][i])>0&&(e[1][i]=e[3][i],t=!0),n.compareNoNANs(e[0][i],e[2][i])>0&&(e[2][i]=e[0][i],t=!0),n.compareNoNANs(e[2][i],e[3][i])>0&&(e[2][i]=e[3][i],t=!0),n.compareNoNANs(e[1][i],e[2][i])>0&&(e[2][i]=e[1][i],t=!0)):e[1][i]===e[0][i]&&e[2][i]===e[0][i]||(e[1][i]=e[0][i],e[2][i]=e[0][i],t=!0)}return t}function E(e,t){const i=e.getStartXY();if(i.equals(t.getStartXY()))return!0;if(i.equals(t.getEndXY()))return!0;const n=e.getEndXY();return!!n.equals(t.getStartXY())||!!n.equals(t.getEndXY())}function S(e,t){let i=e.calculateLowerLength2D();return!(i>t)&&(!!e.isLine()||(i=e.calculateUpperLength2D(),i<=t||0!==t&&e.calculateLength2D()<=t))}function C(e,i,s,r,o,a,l,c){let h=e.calculateUpperLength2D(),u=i.calculateUpperLength2D(),m=e,d=i,p=!1;h>u&&(d=n.swap(m,m=d),r=n.swap(s,s=r),u=n.swap(h,h=u),p=!0);const g=0===s;{l[0]=g?1:0;const e=m.getCoord2D(l[0]);c[0]=d.getClosestCoordinate(e,!1);const t=d.getCoord2D(c[0]);if(n.Point2D.distance(e,t)<=o){const t=[.5,.75,.25,.1,.9];let i=!0;for(let s=0;s<t.length;s++)if(e.assign(m.getCoord2D(t[s])),!d.isCloserThanDistance(e,new n.Envelope1D(0,1),o)){i=!1;break}if(i)return p&&(c[0]=n.swap(l[0],l[0]=c[0])),1}}if(h<=3*o)return 0;let _=n.snap(Math.max(o/h,.1),0,.5),f=.01*o,y=0,x=0,v=_,P=-1,b=0,E=1/32;for(let e=0;;e++){t.geometryReleaseAssert(e<4095);const i=g?_:1-_,s=m.getCoord2D(i),h=d.getClosestCoordinate(s,!1);if(h===r)return b;const u=d.getCoord2D(h),S=n.Point2D.distance(s,u);if(0===e&&(P=S),S<=f?(E=.5,x=S,y=_):(v=_,P=S),Math.abs(x-P)>.1*f&&v-y>1e-16)_=n.lerp(y,v,E);else{if(l[b]=i,c[b]=h,p&&(c[b]=n.swap(l[b],l[b]=c[b])),1===a||1===b)return 1===b&&l[0]>l[1]&&(l[1]=n.swap(l[0],l[0]=l[1]),c[1]=n.swap(c[0],c[0]=c[1])),b+1;b++,y=v,x=P,v=.8,P=-1,_=.8,E=1/32,f=10*o,e=0}}}function w(e,t,i,s,r,o,a,l,c){if(n.isOneOf(i,0,1)&&n.isOneOf(s,0,1)&&0===n.Point2D.distance(e.getCoord2D(i),t.getCoord2D(s))){const c=1e-12,h=new y,u=n.doubleEps();if(e.queryDerivative(new n.ECoordinate(i,u),h),h.isTrueZero()){const t=1===i?-1e-12:c;e.queryDerivative(new n.ECoordinate(i,u).add(t),h)}1===i&&h.negateThis();const m=new y;if(t.queryDerivative(new n.ECoordinate(s,u),m),m.isTrueZero()){const e=1===i?-1e-12:c;t.queryDerivative(new n.ECoordinate(s,u).add(e),m)}1===s&&m.negateThis(),h.isZero()||h.normalize(),m.isZero()||m.normalize();const d=h.dotProduct(m),p=h.crossProduct(m);p.scaleError(3);const g=()=>{{const i=e.calculateUpperLength2D(),n=t.calculateUpperLength2D();return Math.min(.01*r/Math.min(i,n),1e-10)}};if(d.ge(n.s_zero)&&(p.isZero()||Math.abs(p.value())<g()))return C(e,t,i,s,r,o,a,l)}return 0}function T(e,t){e.m_XStart=t.x,e.m_YStart=t.y}function D(e,t,i){e.m_XStart=t,e.m_YStart=i}function I(e,t){e.m_XEnd=t.x,e.m_YEnd=t.y}function A(e,t,i){e.m_XEnd=t,e.m_YEnd=i}function M(e,t){const n=new i.Point3D;return t?(n.x=e.m_XEnd,n.y=e.m_YEnd):(n.x=e.m_XStart,n.y=e.m_YStart),n.z=function(e,t){return e.m_description.hasZ()?e.m_attributes[t*(e.m_description.getTotalComponentCount()-2)]:P.getDefaultValue(1)}(e,t),n}function N(e,t,i){e.m_description.hasZ()||e.addAttribute(1),t?e.m_XEnd===i.x&&e.m_YEnd===i.y||(e.m_XEnd=i.x,e.m_YEnd=i.y,e.endPointModified()):e.m_XStart===i.x&&e.m_YStart===i.y||(e.m_XStart=i.x,e.m_YStart=i.y,e.endPointModified()),e.m_attributes[(e.m_description.getTotalComponentCount()-2)*t]=i.z}function R(e,t,i){i.assignVertexDescription(e.m_description);const n=0===t?e.m_XStart:e.m_XEnd,s=0===t?e.m_YStart:e.m_YEnd;i.setXYCoords(n,s);for(let n=1;n<e.m_description.getAttributeCount();n++){const s=e.m_description.getSemantics(n);for(let n=0,r=P.getComponentCount(s);n<r;n++){const r=G(e,t,s,n);i.setAttributeBasic(s,n,r)}}}function O(e,i,n){n.isEmpty()&&t.throwEmptyGeometryException(""),function(e,t,i){t?e.m_XEnd===i.x&&e.m_YEnd===i.y||(e.m_XEnd=i.x,e.m_YEnd=i.y,e.endPointModified()):e.m_XStart===i.x&&e.m_YStart===i.y||(e.m_XStart=i.x,e.m_YStart=i.y,e.endPointModified())}(e,i,n.getXY());const s=n.getDescription();s!==e.m_description&&e.mergeVertexDescription(s);for(let t=1,r=s.getAttributeCount();t<r;t++){const r=s.getSemantics(t),o=P.getComponentCount(r);for(let t=0;t<o;t++)k(e,i,r,t,n.getAttributeAsDbl(r,t))}}function G(e,i,n,s){if((i<0||i>1)&&t.throwOutOfRangeException(""),0===n)return(s<0||s>=2)&&t.throwOutOfRangeException(""),0===i?0===s?e.m_XStart:e.m_YStart:0===s?e.m_XEnd:e.m_YEnd;const r=P.getComponentCount(n);(s<0||s>=r)&&t.throwOutOfRangeException("");const o=e.m_description.getAttributeIndex(n);return o>=0?e.m_attributes[i*(e.m_description.getTotalComponentCount()-2)+e.m_description.getPointAttributeOffset(o)-2+s]:P.getDefaultValue(n)}function k(e,i,n,s,r){if((i<0||i>1)&&t.throwOutOfRangeException(""),0===n)return 0===i?0===s?e.m_XStart=r:1===s?e.m_YStart=r:t.throwOutOfRangeException(""):1===i?0===s?e.m_XEnd=r:1===s?e.m_YEnd=r:t.throwOutOfRangeException(""):t.throwOutOfRangeException(""),void e.endPointModified();const o=P.getComponentCount(n);(s<0||s>=o)&&t.throwOutOfRangeException("");let a=e.m_description.getAttributeIndex(n);a<0&&(e.addAttribute(n),a=e.m_description.getAttributeIndex(n)),e.m_attributes[i*(e.m_description.getTotalComponentCount()-2)+e.m_description.getPointAttributeOffset(a)-2+s]=r}function V(e,i){if(e===i)return;i.isEmpty()&&t.throwEmptyGeometryException("");const n=i.getDescription();n!==e.m_description&&e.mergeVertexDescription(n);for(let t=1,s=n.getAttributeCount();t<s;t++){const s=n.getSemantics(t),r=P.getComponentCount(s);for(let t=0;t<r;t++){let n=G(i,0,s,t);k(e,0,s,t,n),n=G(i,1,s,t),k(e,1,s,t,n)}}}function F(e){return e.absNorm()*n.geomEpsFactor()}function L(e,t){return Math.max(e.absNorm(),t.absNorm())*n.geomEpsFactor()}function q(e,t,i){const s=new p;e.queryEnvelopeW(n.Envelope1D.unit(),s);const r=new p;return t.queryEnvelopeW(n.Envelope1D.unit(),r),r.inflate(i),!s.isIntersectingW(r)}function H(e,t,i){const s=n.cloneObjectArray(e,i),r=n.cloneObjectArray(t,i);s.sort(((e,t)=>e.compare(t))),r.sort(((e,t)=>e.compare(t)));for(let e=0;e<3;e++){if(s[e].compare(r[e])<0)return-1;if(0!==s[e].compare(r[e]))return 1}return 0}var U=i.VertexDescription;class z{constructor(e){if(e.copy)this.m_XStart=e.copy.m_XStart,this.m_YStart=e.copy.m_YStart,this.m_XEnd=e.copy.m_XEnd,this.m_YEnd=e.copy.m_YEnd,this.m_description=e.copy.m_description,this.m_attributes=null,this.m_description&&this.m_description.getTotalComponentCount()-2&&(this.m_attributes=e.copy.m_attributes.slice());else{if(e.move)return this.m_description=e.move.m_description,e.move.m_description=null,this.m_attributes=e.move.m_attributes,e.move.m_attributes=null,this.m_XStart=e.move.m_XStart,this.m_YStart=e.move.m_YStart,this.m_XEnd=e.move.m_XEnd,void(this.m_YEnd=e.move.m_YEnd);if(void 0!==e.XStart)return this.m_XStart=e.XStart,this.m_YStart=e.YStart,this.m_XEnd=e.XEnd,this.m_YEnd=e.YEnd,this.m_attributes=null,this.m_description=e.vd?e.vd:i.getDefaultDescription2D(),void(e.vd&&this.setDefaultAttributeValues());if(void 0!==e.ZStart)return this.m_XStart=e.XStart,this.m_YStart=e.YStart,this.m_XEnd=e.XEnd,this.m_YEnd=e.YEnd,this.m_description=e.vd?e.vd:i.getDefaultDescription3D(),void(e.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=e.ZStart,this.m_attributes[this.m_description.getTotalComponentCount()-2]=e.ZEnd):this.m_attributes=[e.ZStart,e.ZEnd]);if(e.start)return this.m_XStart=e.start.x,this.m_YStart=e.start.y,this.m_XEnd=e.end.x,this.m_YEnd=e.end.y,this.m_attributes=null,void(this.m_description=i.getDefaultDescription2D());if(e.start3D)return this.m_XStart=e.start3D.x,this.m_YStart=e.start3D.y,this.m_XEnd=e.end3D.x,this.m_YEnd=e.end3D.y,this.m_description=e.vd?e.vd:i.getDefaultDescription3D(),void(e.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=e.start3D.z,this.m_attributes[this.m_description.getTotalComponentCount()-2]=e.end3D.z):this.m_attributes=[e.start3D.z,e.end3D.z]);t.throwInternalErrorException("bad constructor params"),this.m_XStart=this.m_YStart=this.m_XEnd=this.m_YEnd=Number.NaN}}setDefaultAttributeValues(){const e=this.m_description.getTotalComponentCount()-2;e>0&&(null===this.m_attributes&&(this.m_attributes=n.makePrimitiveArray(2*e,Number.NaN)),n.memcpy(this.m_attributes,this.m_description.getDefaultPointAttributes(),0,2,e),n.memcpy(this.m_attributes,this.m_description.getDefaultPointAttributes(),e,2,e))}absNormXYZ(e){return t.throwNotImplementedException("not implemented"),0}queryWeights(e){}snapControlPoints3D(){return t.throwNotImplementedException("not implemented"),!1}setCoordsForIntersector3D(e,i,n){t.throwNotImplementedException("not implemented")}transformAttribute(e,i,n,s,r){t.throwNotImplementedException("")}mergeVertexDescriptionImpl(e){const t=this.getDescription(),n=i.getMergedVertexDescription(t,e);this.assignVertexDescription(n)}changeEndPoints(e,t){const i=e.getXY(),n=t.getXY();this.changeEndPoints2D(i,n);let s=e.getDescription();s!==this.getDescription()&&this.mergeVertexDescription(s),s=t.getDescription(),s!==this.getDescription()&&this.mergeVertexDescription(s);for(let i=1,n=s.getAttributeCount();i<n;i++){const n=s.getSemantics(i),r=U.getComponentCount(n);for(let i=0;i<r;i++)k(this,0,n,i,e.getAttributeAsDbl(n,i)),k(this,1,n,i,t.getAttributeAsDbl(n,i))}}getStartXY(){return new n.Point2D(this.m_XStart,this.m_YStart)}setStartXY(e){this.m_XStart=e.x,this.m_YStart=e.y,this.endPointModified()}setStartXYCoords(e,t){this.m_XStart=e,this.m_YStart=t,this.endPointModified()}getStartXYZ(){return M(this,0)}setStartXYZ(e){N(this,0,e)}setStartXYZCoords(e,t,n){N(this,0,i.Point3D.construct(e,t,n))}queryStart(e){R(this,0,e)}setStart(e){O(this,0,e)}setStart2D(e){this.setStartXY(e)}getStartAttributeAsDbl(e,t){return G(this,0,e,t)}getStartAttributeAsInt(e,i){return t.geometryReleaseAssert(0),0}setStartAttribute(e,t,i){k(this,0,e,t,i)}setStartAttributesFromPoint(e,t){const i=e.getDescription();for(let n=t&&i.hasZ()?2:1,s=i.getAttributeCount();n<s;++n){const t=i.getSemantics(n),s=U.getComponentCount(t);for(let i=0;i<s;++i){const n=e.getAttributeAsDbl(t,i);this.setStartAttribute(t,i,n)}}}setEndAttributesFromPoint(e,t){const i=e.getDescription();for(let n=t&&i.hasZ()?2:1,s=i.getAttributeCount();n<s;++n){const t=i.getSemantics(n),s=U.getComponentCount(t);for(let i=0;i<s;++i){const n=e.getAttributeAsDbl(t,i);this.setEndAttribute(t,i,n)}}}getStartX(){return this.m_XStart}getStartY(){return this.m_YStart}getStartZ(){return t.geometryReleaseAssert(0),0}getEndX(){return this.m_XEnd}getEndY(){return this.m_YEnd}getEndZ(){return t.geometryReleaseAssert(0),0}getEndXY(){return new n.Point2D(this.m_XEnd,this.m_YEnd)}setEndXY(e){this.m_XEnd=e.x,this.m_YEnd=e.y,this.endPointModified()}setEndXYCoords(e,t){this.m_XEnd=e,this.m_YEnd=t,this.endPointModified()}getEndXYZ(){return M(this,1)}setEndXYZ(e){N(this,1,e)}setEndXYZCoords(e,t,n){N(this,1,i.Point3D.construct(e,t,n))}queryEnd(e){R(this,1,e)}setEnd(e){O(this,1,e)}setEnd2D(e){this.setEndXY(e)}getEndAttributeAsDbl(e,t){return G(this,1,e,t)}getEndAttributeAsInt(e,i){return t.geometryReleaseAssert(0),Math.trunc(0)}setEndAttribute(e,t,i){k(this,1,e,t,i)}getDimension(){return 1}copyTo(e){if(this===e)return;e.getGeometryType()!==this.getGeometryType()&&t.throwInvalidArgumentException("");const i=e;i.assignVertexDescription(this.m_description),i.m_attributes&&n.memcpy(i.m_attributes,this.m_attributes,0,0,2*(this.m_description.getTotalComponentCount()-2)),i.m_XStart=this.m_XStart,i.m_YStart=this.m_YStart,i.m_XEnd=this.m_XEnd,i.m_YEnd=this.m_YEnd,this.copyToImpl(i)}isEmpty(){return this.isEmptyImpl()}isClosed(){return this.m_XStart===this.m_XEnd&&this.m_YStart===this.m_YEnd}setEmpty(){}calculateArea2D(){return 0}queryInterval(e,t){const i=n.Envelope1D.constructEmpty();return i.vmin=G(this,0,e,t),i.vmax=i.vmin,i.mergeNeCoordinate(G(this,1,e,t)),i}calculateLength3D(e){return t.geometryReleaseAssert(0),0}getCoord3D(e){return t.geometryReleaseAssert(0),{}}getCoord2D(e){const t=n.Point2D.getNAN();return this.queryCoord2D(e,t),t}queryCoord3D(e,i){t.geometryReleaseAssert(0)}getCoordZ(e){return t.geometryReleaseAssert(0),0}queryCoord(e,t){t.assignVertexDescription(this.m_description),t.setXY(this.getCoord2D(e));for(let i=1,n=this.m_description.getAttributeCount();i<n;i++){const n=this.m_description.getSemantics(i),s=U.getComponentCount(n);for(let i=0;i<s;i++){const s=this.getAttributeAsDbl(e,n,i);t.setAttributeBasic(n,i,s)}}}isCloserThanDistance(e,t,i){const r=s.Envelope2D.constructEmpty();if(this.queryLooseEnvelopeOnInterval(t,r),r.distance(e)>i)return!1;const o=this.getClosestCoordinateOnInterval(e,t,i);return!Number.isNaN(o)&&n.Point2D.distance(e,this.getCoord2D(o))<=i}isMonotoneQuickAndDirty(){return!1}isTrue3D(){return!1}getReversed(){const e=this.clone();return e.reverse(),e}reverse(){this.m_XEnd=n.swap(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=n.swap(this.m_YStart,this.m_YStart=this.m_YEnd),this.reverseImpl();for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e);for(let e=0,i=U.getComponentCount(t);e<i;e++){const i=G(this,0,t,e);k(this,0,t,e,G(this,1,t,e)),k(this,1,t,e,i)}}return this.afterCompletedModification(),this}isEmptyImpl(){return!1}isCircular(){return!1}distance(e,i,s,r){if(!i&&this.isIntersecting(e,0,!1)){if(null!==s||null!==r){const i=n.makePrimitiveArray(9,Number.NaN),o=n.makePrimitiveArray(9,Number.NaN),a=this.intersect(e,null,i,o,0);t.geometryReleaseAssert(a<=9),0===a&&t.throwInternalErrorException(""),null!==s&&(s[0]=i[0]),null!==r&&(r[0]=o[0])}return 0}let o,a=Number.MAX_VALUE,l=-1,c=a;return o=this.getStartXY(),l=e.getClosestCoordinate(o,!1),o.subThis(e.getCoord2D(l)),c=o.length(),c<a&&(a=c,null!==r&&(r[0]=l),null!==s&&(s[0]=0)),o=this.getEndXY(),l=e.getClosestCoordinate(o,!1),o.subThis(e.getCoord2D(l)),c=o.length(),c<a&&(a=c,null!==r&&(r[0]=l),null!==s&&(s[0]=1)),o=e.getStartXY(),l=this.getClosestCoordinate(o,!1),o.subThis(this.getCoord2D(l)),c=o.length(),c<a&&(a=c,null!==s&&(s[0]=l),null!==r&&(r[0]=0)),o=e.getEndXY(),l=this.getClosestCoordinate(o,!1),o.subThis(this.getCoord2D(l)),c=o.length(),c<a&&(a=c,null!==s&&(s[0]=l),null!==r&&(r[0]=1)),a}calculateSubLengthFromStart(e){return this.tToLength(e)}calculateSubLength(e,t){return t===e?0:this.tToLength(t)-this.tToLength(e)}static recalculateParentT(e,t,i){return n.lerp(e,t,i)}moveTo(e){const t=this.isClosed(),i=new r.Transformation2D;i.setShift(e.sub(this.getStartXY())),this.applyTransformation(i),t?this.changeEndPoints2D(e,e):this.changeEndPoints2D(e,this.getEndXY())}moveTo3D(e){t.geometryReleaseAssert(0)}getDescription(){return this.m_description}assignVertexDescription(e){!function(e,t){const s=i.createAttributeMap();i.mapAttributes(t,e.m_description,s);let r=null;const o=t.getTotalComponentCount()-2,a=e.m_description?e.m_description.getTotalComponentCount()-2:0;if(o>0&&(r=n.makePrimitiveArray(2*o,Number.NaN),n.memcpy(r,t.getDefaultPointAttributes(),0,2,o),n.memcpy(r,t.getDefaultPointAttributes(),o,2,o),null!==e.m_description))for(let i=1;i<t.getAttributeCount();i++){const n=s[i];if(-1!==n){const s=e.m_description.getPointAttributeOffset(n)-2,l=t.getPointAttributeOffset(i)-2,c=P.getComponentCount(t.getSemantics(i));for(let t=0;t<c;++t)r[l]=e.m_attributes[s],r[o+l]=e.m_attributes[a+s]}}e.m_attributes=r,e.m_description=t}(this,e)}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;const t=i.getMergedVertexDescriptionSemantics(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;const t=i.removeSemanticsFromVertexDescription(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){const e=i.getDefaultDescription2D();e!==this.m_description&&this.assignVertexDescription(e)}swap(e){if(this===e)return;e.getGeometryType()!==this.getGeometryType()&&t.throwInvalidArgumentException("wrong geometry type");const i=e;i.m_description=n.swap(this.m_description,this.m_description=i.m_description),i.m_XStart=n.swap(this.m_XStart,this.m_XStart=i.m_XStart),i.m_YStart=n.swap(this.m_YStart,this.m_YStart=i.m_YStart),i.m_XEnd=n.swap(this.m_XEnd,this.m_XEnd=i.m_XEnd),i.m_YEnd=n.swap(this.m_YEnd,this.m_YEnd=i.m_YEnd),i.m_attributes=n.swap(this.m_attributes,this.m_attributes=i.m_attributes),this.swapImpl(i)}equals(e,t){if(this.getGeometryType()!==e.getGeometryType())return!1;const i=void 0===t;i&&(t=0);const s=e;if(this===s)return!0;if(this.m_description!==s.m_description)return!1;if(Math.abs(this.m_XStart-s.m_XStart)>t||Math.abs(this.m_XEnd-s.m_XEnd)>t||Math.abs(this.m_YStart-s.m_YStart)>t||Math.abs(this.m_YEnd-s.m_YEnd)>t)return!1;for(let e=0,i=2*(this.m_description.getTotalComponentCount()-2);e<i;e++)if(!n.isEqualNonIEEETol(this.m_attributes[e],s.m_attributes[e],t))return!1;return i?this.equalsImpl(s):this.equalsImplTol(s,t)}getImpl(){return this}setAttributeBasic(e,i,n){if(this.addAttribute(e),0===e&&this.isCurve()){(i<0||i>1)&&t.throwInvalidArgumentException("");const e=new r.Transformation2D,s=0===i?n:0,o=1===i?n:0;e.setShiftCoords(s,o),0===i?e.xx=0:e.yy=0,this.applyTransformation(e)}else this.setStartAttribute(e,i,n),this.setEndAttribute(e,i,n)}replaceNaNs(e,t){if(this.addAttribute(e),this.isEmpty())return;const i=U.getComponentCount(e);for(let n=0;n<i;n++){const i=this.getStartAttributeAsDbl(e,n);Number.isNaN(i)&&this.setStartAttribute(e,n,t);const s=this.getEndAttributeAsDbl(e,n);Number.isNaN(s)&&this.setEndAttribute(e,n,t)}}}z.s_maxMonotonicPartParams=8;class Y extends o.GeometryCursor{constructor(e,t){super(),this.m_index=-1,this.gc=e,this.dim=t}next(){for(;;){if(this.m_index>=this.gc.getGeometryCount())return null;if(this.m_index++,this.m_index===this.gc.getGeometryCount())return null;const e=this.gc.getGeometry(this.m_index);if(-1===this.dim||1<<e.getDimension()&this.dim)return e}return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class B{constructor(e){this.m_geoms=[],this.m_description=i.getDefaultDescription2D(),e&&(e.vd?this.m_description=e.vd:e.copy?e.copy.copyTo(this):t.throwInvalidArgumentException("constructor argument not recognized"))}getGeometryCount(){return this.m_geoms.length}reserve(e){}addGeometry(e){if(e.getGeometryType()===t.GeometryType.enumGeometryCollection){const t=e;for(let e=0,i=t.getGeometryCount();e<i;e++)this.addGeometry(t.getGeometry(e))}else this.m_geoms.push(e.clone()),this.mergeVertexDescription(e.getDescription())}addCursor(e){for(let t=e.next();null!==t;t=e.next())this.addGeometry(t)}getGeometry(e){return(e<0||e>=this.m_geoms.length)&&t.throwInvalidArgumentException("Geometry_collection.get_geometry"),this.m_geoms[e]}modifiedElementIndex(e){this.mergeVertexDescription(this.getGeometry(e).getDescription())}modifiedElement(e){this.mergeVertexDescription(e.getDescription())}getGeometryType(){return t.GeometryType.enumGeometryCollection}getDimension(){let e=0;for(const t of this.m_geoms)e=Math.max(e,t.getDimension());return e}getDescription(){return this.m_description}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}assignVertexDescriptionImpl(e){for(const t of this.m_geoms)t.assignVertexDescription(e);this.m_description=e}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;const t=i.getMergedVertexDescriptionSemantics(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;const t=i.removeSemanticsFromVertexDescription(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){const e=i.getDefaultDescription2D();e!==this.m_description&&this.assignVertexDescription(e)}queryInterval(e,t){let i=new n.Envelope1D;const s=new n.Envelope1D;s.setEmpty();for(const n of this.m_geoms)i=n.queryInterval(e,t),s.merge(i);return s}queryEnvelope(e){if(4===e.m_EnvelopeType){const t=new i.Envelope;e.setEmpty(),e.assignVertexDescription(this.m_description);for(const i of this.m_geoms)i.queryEnvelope(t),e.merge(t)}else if(2===e.m_EnvelopeType){const t=new s.Envelope2D;e.setEmpty();for(const i of this.m_geoms)i.queryEnvelope(t),e.mergeEnvelope2D(t)}t.throwNotImplementedException("3d envelope case not implemented")}queryLooseEnvelope(e){if(2===e.m_EnvelopeType){const t=new s.Envelope2D;e.setEmpty();for(const i of this.m_geoms)i.queryLooseEnvelope(t),e.mergeEnvelope2D(t)}t.throwNotImplementedException("3d not impl")}isEmpty(){return 0===this.m_geoms.length}setEmpty(){this.m_geoms.length=0}applyTransformation(e){if(1===e.m_TransformationType)for(const t of this.m_geoms)t.applyTransformation(e);t.throwNotImplementedException("3d xform not impl")}transformAttribute(e,t,i,n,s){for(const r of this.m_geoms)r.transformAttribute(e,t,i,n,s)}createInstance(){return new B({vd:this.getDescription()})}copyTo(e){e.getGeometryType()!==t.GeometryType.enumGeometryCollection&&t.throwInvalidArgumentException("");const i=e;if(i!==this){i.m_geoms.length=0,i.assignVertexDescription(this.m_description);for(const e of this.m_geoms)i.m_geoms.push(e.clone())}}calculateArea2D(){const e=new n.KahanSummator(0);for(const t of this.m_geoms)e.pe(t.calculateArea2D());return e.getResult()}calculateLength2D(){const e=new n.KahanSummator(0);for(const t of this.m_geoms)e.pe(t.calculateLength2D());return e.getResult()}calculateLength3D(e){return t.geometryReleaseAssert(0),0}getBoundary(){const e=this.createInstance(),t=e;for(const e of this.m_geoms){const i=e.getBoundary();i&&t.m_geoms.push(i)}return e}clone(){return new B({copy:this})}equals(e,i){if(e===this)return!0;if(e.getGeometryType()!==t.GeometryType.enumGeometryCollection)return!1;const n=e;if(this.m_description!==n.m_description)return!1;if(this.m_geoms.length!==n.m_geoms.length)return!1;for(let e=0;e<this.m_geoms.length;++e)if(!this.m_geoms[e].equals(n.m_geoms[e],i))return!1;return!0}swap(e){e.getGeometryType()!==t.GeometryType.enumGeometryCollection&&t.throwInvalidArgumentException("");const i=e;i!==this&&(this.m_geoms=n.swap(i.m_geoms,i.m_geoms=this.m_geoms))}setAttributeBasic(e,t,i){for(const n of this.m_geoms)n.setAttributeBasic(e,t,i)}replaceNaNs(e,t){for(const i of this.m_geoms)i.replaceNaNs(e,t)}getImpl(){return this}mergeVertexDescriptionImpl(e){const t=this.getDescription(),n=i.getMergedVertexDescription(t,e);this.assignVertexDescription(n)}}B.type=t.GeometryType.enumGeometryCollection;class X extends z{constructor(e){super(e)}}class j extends X{isTrue3D(){return!0}constructor(e){super(e)}}function W(e,t,i){Z(t,e.getStartXY(),e.getEndXY(),i)}function Z(e,t,i,s){n.lerpPoint2D(t,i,e,s)}function Q(e,t){return n.lerp(e.m_XStart,e.m_XEnd,t)}function $(e,t){return n.lerp(e.m_YStart,e.m_YEnd,t)}function K(e,t,i){t.value()<=.5?n.lerpLoPointE(2,y.constructPoint2D(e.getStartXY()),y.constructPoint2D(e.getEndXY()),t,i):n.lerpHiPointE(2,y.constructPoint2D(e.getStartXY()),y.constructPoint2D(e.getEndXY()),t,i)}function J(e,t,i){e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=i.x,e.m_YEnd=i.y,e.afterCompletedModification()}function ee(e){if(e.m_YEnd<e.m_YStart||e.m_YEnd===e.m_YStart&&e.m_XEnd<e.m_XStart){e.m_XEnd=n.swap(e.m_XStart,e.m_XStart=e.m_XEnd),e.m_YEnd=n.swap(e.m_YStart,e.m_YStart=e.m_YEnd);for(let t=0,i=e.m_description.getTotalComponentCount()-2;t<i;t++)e.m_attributes[t+i]=n.swap(e.m_attributes[t],e.m_attributes[t]=e.m_attributes[t+i])}}function te(e,t,i,n){let s=0;if((e.m_XStart===t.m_XStart&&e.m_YStart===t.m_YStart||e.m_XStart===t.m_XEnd&&e.m_YStart===t.m_YEnd)&&(s++,!n))return 1;if(e.m_XEnd===t.m_XStart&&e.m_YEnd===t.m_YStart||e.m_XEnd===t.m_XEnd&&e.m_YEnd===t.m_YEnd){if(s++,2===s)return 2;if(!n)return 1}return t.isIntersectingPoint(e.getStartXY(),i,!0)||t.isIntersectingPoint(e.getEndXY(),i,!0)||e.isIntersectingPoint(t.getStartXY(),i,!0)||e.isIntersectingPoint(t.getEndXY(),i,!0)?4:n&&s?0:function(e,t){const i=se(e,t.m_XStart,t.m_YStart),n=se(e,t.m_XEnd,t.m_YEnd);if(i<0&&n<0||i>0&&n>0)return!1;const s=se(t,e.m_XStart,e.m_YStart),r=se(t,e.m_XEnd,e.m_YEnd);return!(s<0&&r<0||s>0&&r>0)&&(ae(e)>ae(t)?oe(e,t):oe(t,e))}(e,t)?4:0}function ie(e,t,i,s,r,o,a,l){null!==s&&n.initializePrimitiveArray(s,2,Number.NaN),null!==r&&n.initializePrimitiveArray(r,2,Number.NaN),null!==i&&n.initializeObjectArray(i,n.Point2D,2);const c=function(e,t,i,s,r,o,a,l,c){const h=ne(e,t.getStartXY(),a,!1),u=ne(e,t.getEndXY(),a,!1),m=ne(t,e.getStartXY(),a,!1),d=ne(t,e.getEndXY(),a,!1);let p=0,g=0;if(!Number.isNaN(h)){let i=!1;l&&n.isOneOf(h,0,1)&&e.getCoord2D(h).isEqualPoint2D(t.getStartXY())&&(p++,i=!0),i||(r&&(r[g]=h),o&&(o[g]=0),s&&s[g].setCoords(t.m_XStart,t.m_YStart),g++)}if(!Number.isNaN(u)){let i=!1;l&&n.isOneOf(u,0,1)&&e.getCoord2D(u).isEqualPoint2D(t.getEndXY())&&(p++,i=!0),i||(2>g&&(r&&(r[g]=u),o&&(o[g]=1),s&&s[g].setCoords(t.m_XEnd,t.m_YEnd)),g++)}if(2!==g&&!Number.isNaN(m)&&!(0===h&&0===m||0===u&&1===m)){let i=!1;l&&n.isOneOf(m,0,1)&&t.getCoord2D(m).isEqualPoint2D(e.getStartXY())&&(p++,i=!0),i||(2>g&&(r&&(r[g]=0),o&&(o[g]=m),s&&s[g].setCoords(e.m_XStart,e.m_YStart)),g++)}if(2!==g&&!Number.isNaN(d)&&!(1===h&&0===d||1===u&&1===d)){let i=!1;l&&n.isOneOf(d,0,1)&&t.getCoord2D(d).isEqualPoint2D(e.getEndXY())&&(p++,i=!0),i||(2>g&&(r&&(r[g]=1),o&&(o[g]=d),s&&s[g].setCoords(t.m_XEnd,t.m_YEnd)),g++)}if(g>0)return c&&(o=n.swap(r,r=o)),2===g&&r&&r[0]>r[1]&&(r[1]=n.swap(r[0],r[0]=r[1]),o&&(o[1]=n.swap(o[0],o[0]=o[1])),s&&(s[1]=n.swap(s[0],s[0]=s[1]))),g;if(p>0)return 0;const _=function(e,t,i){const s=e.m_XEnd-e.m_XStart,r=e.m_YEnd-e.m_YStart,o=t.m_XEnd-t.m_XStart,a=t.m_YEnd-t.m_YStart,l=o*r-s*a;if(0===l)return n.Point2D.getNAN();const c=4*n.doubleEps()*(Math.abs(o*r)+Math.abs(s*a)),h=t.m_XStart-e.m_XStart,u=t.m_YStart-e.m_YStart,m=o*u-h*a,d=4*n.doubleEps()*(Math.abs(o*u)+Math.abs(h*a)),p=m/l,g=Math.abs(l),_=(d*g+c*Math.abs(m))/(l*l)+n.doubleEps()*Math.abs(p);if(p<-_||p>1+_)return n.Point2D.getNAN();const f=s*u-h*r,y=f/l,x=(4*n.doubleEps()*(Math.abs(s*u)+Math.abs(h*r))*g+c*Math.abs(f))/(l*l)+n.doubleEps()*Math.abs(y);if(y<-x||y>1+x)return n.Point2D.getNAN();let v=n.snap(p,0,1),P=n.snap(y,0,1);const b=n.Point2D.getNAN();W(e,v,b);const E=n.Point2D.getNAN();if(W(t,P,E),!i||n.Point2D.distance(b,E)>i){const s=n.Point2D.getNAN();n.lerpPoint2D(b,E,.5,s),v=e.getClosestCoordinate(s,!1),P=t.getClosestCoordinate(s,!1);const r=n.Point2D.getNAN();W(e,v,r);const o=n.Point2D.getNAN();W(t,P,o),r.subThis(o);const a=r.length(),l=(e.absNorm()+t.absNorm())*n.geomEpsFactor();if(a>Math.max(i,l))return n.Point2D.getNAN()}return new n.Point2D(v,P)}(e,t,a);return Number.isNaN(_.x)?0:(s&&(s[0]=e.getCoord2D(_.x)),r&&(r[0]=_.x),o&&(o[0]=_.y),1)}(e,t,0,i,s,r,o,a,l);return s&&(s.length=c),r&&(r.length=c),i&&(i.length=c),c}function ne(e,t,i,s){const r=n.Point2D.getNAN(),o=n.Point2D.getNAN();let a=!1;e.m_YEnd<e.m_YStart||e.m_YEnd===e.m_YStart&&e.m_XEnd<e.m_XStart?(r.setCoords(e.m_XEnd,e.m_YEnd),o.setCoords(e.m_XStart,e.m_YStart),a=!0):(r.setCoords(e.m_XStart,e.m_YStart),o.setCoords(e.m_XEnd,e.m_YEnd));const l=a?1:0,c=a?0:1,h=n.Point2D.getNAN();h.setSub(t,r);let u=h.length(),m=3*u*n.doubleEps();if(u<=Math.max(i,m))return s&&0===u?Number.NaN:l;if(h.setSub(t,o),u=h.length(),m=3*u*n.doubleEps(),u<=Math.max(i,m))return s&&0===u?Number.NaN:c;h.setCoords(o.x-r.x,o.y-r.y);const d=h.length();if(d>0){const e=1/d;h.scale(e);const s=n.Point2D.getNAN();s.setSub(t,r);const u=s.dotProduct(h),m=8*s.dotProductAbs(h)*n.doubleEps();h.leftPerpendicularThis();const p=s.dotProduct(h),g=8*s.dotProductAbs(h)*n.doubleEps(),_=Math.max(i,m);if(u<-_||u>d+_)return Number.NaN;const f=Math.max(i,g);if(Math.abs(p)<=f){let s=u*e;s=n.snap(s,0,1);const h=n.Point2D.getNAN();if(Z(s,r,o,h),n.Point2D.distance(h,t)<=i){if(s<.5){if(n.Point2D.distance(h,r)<=i&&n.Point2D.distance(t,r)<=i)return l}else if(n.Point2D.distance(h,o)<=i&&n.Point2D.distance(t,o)<=i)return c;return a?1-s:s}}}return Number.NaN}function se(e,t,i){const s=n.Point2D.getNAN();s.setCoords(t,i),s.subThis(e.getStartXY());const r=n.Point2D.getNAN();r.setSub(e.getEndXY(),e.getStartXY());const o=r.crossProduct(s),a=4*n.doubleEps()*(Math.abs(r.x*s.y)+Math.abs(r.y*s.x));return o>a?-1:o<-a?1:0}function re(e,t,i,s){const r=s?e.m_XStart:e.m_XEnd,o=s?e.m_YStart:e.m_YEnd,a=n.Point2D.getNAN();return a.x=t.getEndX()-r,a.y=t.getEndY()-o,!(i.dotProduct(a)>3*n.doubleEps()*i.dotProductAbs(a))||(a.x=t.getStartX()-r,a.y=t.getStartY()-o,i.dotProduct(a)<=3*n.doubleEps()*i.dotProductAbs(a))}function oe(e,t){const i=n.Point2D.getNAN();return i.x=e.m_XEnd-e.m_XStart,i.y=e.m_YEnd-e.m_YStart,!!re(e,t,i,!1)&&(i.negateThis(),!!re(e,t,i,!0))}function ae(e){const t=e.m_XStart-e.m_XEnd,i=e.m_YStart-e.m_YEnd;return t*t+i*i}class le{constructor(e){if(this.m_segFlagStream=null,this.m_xyStream=null,this.m_bCirculator=!1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_nextPathIndex=0,this.m_currentPathIndex=-1,this.m_parent=e.parent,this.m_buffer=new this.m_parent.m_segmentBufferCTor,this.m_description=e.parent.getDescription(),this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex),void 0!==e.pointIndex){(e.pointIndex<0||e.pointIndex>=e.parent.getPointCount())&&t.throwOutOfRangeException("");const i=e.parent.getPathIndexFromPointIndex(e.pointIndex);this.m_currentPathIndex=i,this.m_nextPathIndex=i+1,this.m_nextSegmentIndex=e.pointIndex-e.parent.getPathStart(i),this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex)}else if(void 0!==e.pathIndex){(e.pathIndex<0||e.pathIndex>=e.parent.getPathCount()||e.segmentIndex<0)&&t.throwOutOfRangeException("");const i=e.parent.isClosedPath(e.pathIndex)?0:1;e.segmentIndex>=e.parent.getPathSize(e.pathIndex)-i&&t.throwOutOfRangeException(""),this.m_nextSegmentIndex=e.segmentIndex,this.m_currentPathIndex=e.pathIndex,this.m_nextPathIndex=this.m_nextSegmentIndex+1,this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex)}this.prepare(),this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1,this.m_bStripAttributes=!1,this.m_prevPathIndex=-1,this.m_prevSegmentIndex=-1,this.m_bNeedsUpdate=!1,this.m_currentPathIndex>-1&&(this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex))}stripAttributes(){this.m_bStripAttributes=!0}prepare(){this.m_bCirculator=!1,this.m_parent.isEmptyImpl()?(this.m_segFlagStream=null,this.m_xyStream=null):(this.m_segFlagStream=this.m_parent.getSegmentFlagsStreamRef(),this.m_xyStream=this.m_parent.getAttributeStreamRef(0))}nextPath(){return this.m_currentPathIndex=this.m_nextPathIndex,!(this.m_currentPathIndex>=this.m_parent.getPathCount()||(this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex),this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex),this.m_nextPathIndex++,0))}previousPath(){return 0!==this.m_nextPathIndex&&(this.m_nextPathIndex--,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex),this.m_currentPathIndex=this.m_nextPathIndex,this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex),this.resetToLastSegment(),!0)}getSegmentCount(e){return this.m_parent.isEmptyImpl()?0:this.m_parent.getSegmentCountPath(e)}resetToFirstPath(){this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_nextPathIndex=0,this.m_currentPathIndex=-1,this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1}resetToLastPath(){this.m_nextPathIndex=this.m_parent.getPathCount(),this.m_currentPathIndex=-1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_pathBegin=-1}resetToPath(e){(e<0||e>this.m_parent.getPathCount())&&t.throwOutOfRangeException(""),this.m_nextPathIndex=e,this.m_currentPathIndex=-1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1}isLastPath(){return this.m_currentPathIndex===this.m_parent.getPathCount()-1}isFirstSegmentInPath(){return 0===this.m_currentSegmentIndex}isLastSegmentInPath(){return this.m_currentSegmentIndex===this.m_segmentCount-1}resetToFirstSegment(){this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0}resetToLastSegment(){this.m_nextSegmentIndex=this.m_segmentCount,this.m_currentSegmentIndex=-1}resetTo(e){this.m_parent!==e.m_parent&&t.throwInvalidCallException(""),this.m_currentSegmentIndex=e.m_currentSegmentIndex,this.m_nextSegmentIndex=e.m_nextSegmentIndex,this.m_currentPathIndex=e.m_currentPathIndex,this.m_nextPathIndex=e.m_nextPathIndex,this.m_segmentCount=e.m_segmentCount,this.m_bCirculator=e.m_bCirculator,this.m_pathBegin=e.m_pathBegin,this.m_bCurrentPathClosed=e.m_bCurrentPathClosed,this.m_bStripAttributes=e.m_bStripAttributes,this.m_description=e.m_description}resetToVertex(e,t){if(this.m_currentPathIndex>=0&&this.m_currentPathIndex<this.m_parent.getPathCount()){const t=this.getPathBegin();if(e>=t&&e<this.m_parent.getPathEnd(this.m_currentPathIndex))return this.m_currentSegmentIndex=-1,void(this.m_nextSegmentIndex=e-t)}let i;i=t>=0&&t<this.m_parent.getPathCount()&&e>=this.m_parent.getPathStart(t)&&e<this.m_parent.getPathEnd(t)?t:this.m_parent.getPathIndexFromPointIndex(e),this.m_nextPathIndex=i+1,this.m_currentPathIndex=i,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=e-this.m_parent.getPathStart(i),this.m_segmentCount=this.getSegmentCount(i),this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex)}hasNextSegment(){return this.m_nextSegmentIndex<this.m_segmentCount}hasPreviousSegment(){return this.m_nextSegmentIndex>0}nextSegment(){return this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment(),this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:(this.m_nextSegmentIndex===this.m_segmentCount&&t.throwOutOfRangeException("Segment_iterator_impl::next_segment"),this.m_nextSegmentIndex++),this.m_buffer.get()}previousSegment(){return this.m_bCirculator?this.m_nextSegmentIndex=(this.m_segmentCount+this.m_nextSegmentIndex-1)%this.m_segmentCount:(0===this.m_nextSegmentIndex&&t.throwOutOfRangeException(""),this.m_nextSegmentIndex--),this.m_nextSegmentIndex!==this.m_currentSegmentIndex&&this.updateSegment(),this.m_buffer.get()}nextCurve(){if(!this.m_parent.hasNonLinearSegments())return this.resetToLastSegment(),null;let e=0;for(;;){if(this.m_nextSegmentIndex===this.m_segmentCount||e===this.m_segmentCount)return null;const t=this.getPathBegin()+this.m_nextSegmentIndex;if(1!=(31&this.m_segFlagStream.read(t))){this.updateSegment();break}this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:this.m_nextSegmentIndex++,e++}return this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment(),this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:(this.m_nextSegmentIndex===this.m_segmentCount&&t.throwOutOfRangeException(""),this.m_nextSegmentIndex++),this.m_buffer.get()}getPathBegin(){return this.m_pathBegin}getPathIndex(){return this.m_currentPathIndex}getStartPointIndex(){return this.getPathBegin()+this.m_currentSegmentIndex}getEndPointIndex(){return this.isClosingSegment()?this.getPathBegin():this.getStartPointIndex()+1}updateSegment(){(this.m_nextSegmentIndex<0||this.m_nextSegmentIndex>=this.m_segmentCount||this.m_currentPathIndex<0)&&t.throwOutOfRangeException(""),this.m_currentSegmentIndex=this.m_nextSegmentIndex,this.m_parent.getSegmentFromPath(this.m_currentPathIndex,this.m_currentSegmentIndex,this.m_buffer,this.m_bStripAttributes)}isClosingSegment(){return this.m_bCurrentPathClosed&&this.m_currentSegmentIndex===this.m_segmentCount-1}isCurve(){return null!==this.m_segFlagStream&&1!=(31&this.m_segFlagStream.read(this.m_currentSegmentIndex))}isPathClosed(){return this.m_bCurrentPathClosed}setCirculator(e){this.m_bCirculator=e}getImpl(){return this}}class ce{constructor(e){this.m_rasterizedGeometry=null,this.m_quadTree=null,this.m_quadTreeForPaths=null,this.m_refCount=1,e&&e.copyTo(this)}getRasterizedGeometry(){return this.m_rasterizedGeometry}copyTo(e){e!==this&&(t.geometryReleaseAssert(e.uniqueUse()),e.m_quadTree=this.m_quadTree,e.m_quadTreeForPaths=this.m_quadTreeForPaths,e.m_rasterizedGeometry=this.m_rasterizedGeometry)}clone(){const e=new ce;return this.copyTo(e),e}uniqueUse(){return 1===this.m_refCount}addRef(){++this.m_refCount}release(){0===--this.m_refCount&&(this.m_rasterizedGeometry=null,this.m_quadTree=null,this.m_quadTreeForPaths=null)}setRasterizedGeometry(e){t.geometryReleaseAssert(this.uniqueUse())}setQuadTree(e){t.geometryReleaseAssert(this.uniqueUse()),this.m_quadTree=e}setQuadTreeForPaths(e){t.geometryReleaseAssert(this.uniqueUse()),this.m_quadTreeForPaths=e}getQuadTree(){return this.m_quadTree}getQuadTreeForPaths(){return this.m_quadTreeForPaths}}function he(e){const i=e.getGeometryType();return i===t.GeometryType.enumEllipticArc?10:i===t.GeometryType.enumBezier?4:i===t.GeometryType.enumRationalBezier2?5:i===t.GeometryType.enumBezier2?2:void t.throwInternalErrorException("")}function ue(e){const t=31&e;return 4===t?10:2===t?4:8===t?5:16===t?2:0}function me(e,t,i,s){const r=e.getPathStart(t),o=e.getPathEnd(t);if(o-r<3)return;const a=2*r,l=n.Point2D.getNAN();i.queryPoint2D(a,l);const c=l.x,h=l.y,u=n.Point2D.getNAN();i.queryPoint2D(a+2,u);const m=n.Point2D.getNAN();for(let e=a+4,t=2*o;e<t;e+=2)i.queryPoint2D(e,m),s.pe((m.x-l.x)*(u.y-h)),l.setCoordsPoint2D(u),u.setCoordsPoint2D(m);s.pe((c-l.x)*(u.y-h))}function de(e,t,i){for(;t.hasNextSegment();){const e=t.nextCurve();if(null===e)break;i.pe(2*e.calculateArea2DHelper())}}var pe=i.VertexDescription;class ge{static toSegType(e){let i=0;switch(e){case t.GeometryType.enumLine:i=1;break;case t.GeometryType.enumBezier:i=2;break;case t.GeometryType.enumEllipticArc:i=4;break;case t.GeometryType.enumRationalBezier2:i=8;break;case t.GeometryType.enumBezier2:i=16;break;default:t.throwInternalErrorException("")}return i}constructor(){this.m_segmentFlags=null,this.m_segmentParamIndex=null,this.m_segmentParams=null,this.m_curveCount=0,this.m_bezierCount=0,this.m_arcCount=0,this.m_rbezier2Count=0,this.m_bezier2Count=0,this.m_curveParamWritePoint=0}assignCopy(e){return this.m_segmentFlags=e.m_segmentFlags,this.m_segmentParamIndex=e.m_segmentParamIndex,this.m_segmentParams=e.m_segmentParams,this.m_curveCount=e.m_curveCount,this.m_bezierCount=e.m_bezierCount,this.m_arcCount=e.m_arcCount,this.m_rbezier2Count=e.m_rbezier2Count,this.m_bezier2Count=e.m_bezier2Count,this.m_curveParamWritePoint=e.m_curveParamWritePoint,this}}class _e extends m{constructor(e){super(e),this.m_cachedRingAreas2D=null,this.m_paths=null,this.m_pathFlags=null,this.m_curveData=null,e.move?(this.m_bPolygon=e.move.m_bPolygon,this.m_cachedLength2D=e.move.m_cachedLength2D,this.m_cachedArea2D=e.move.m_cachedArea2D,this.m_currentPathIndex=e.move.m_currentPathIndex,this.m_cachedRingAreas2D=e.move.m_cachedRingAreas2D,this.m_paths=e.move.m_paths,this.m_pathFlags=e.move.m_pathFlags,this.m_curveData=e.move.m_curveData,e.move.m_curveData=null,e.move.setEmpty()):(this.m_bPolygon=e.bPolygon,this.m_cachedLength2D=0,this.m_cachedArea2D=0,this.m_currentPathIndex=0)}getGeometryType(){return this.m_bPolygon?t.GeometryType.enumPolygon:t.GeometryType.enumPolyline}getDimension(){return this.m_bPolygon?2:1}changeRingStartPoint(e){t.geometryReleaseAssert(this.m_bPolygon);const i=this.getPathIndexFromPointIndex(e),n=this.getPathStart(i);if(n===e)return;const s=this.getPathEnd(i);(e>=s||e<n)&&t.throwInvalidArgumentException("change_ring_start_point");for(let t=0,i=this.m_description.getAttributeCount();t<i;t++){const i=this.m_description.getSemantics(t),r=pe.getComponentCount(i);this.m_vertexAttributes.get(t).rotate(n*r,e*r,s*r)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.rotate(n,e,s),this.m_curveData.m_segmentParamIndex.rotate(n,e,s))}setFillRule(e){this.m_bFillRule=1===e}getFillRule(){return this.m_bFillRule?1:0}isExteriorRingOGC(e){return!!this.m_bPolygon&&(this.updateOGCFlagsProtected(),!!(8&this.m_pathFlags.read(e)))}isExteriorRing(e){return this.calculateRingArea2D(e)>0}calculateRingArea2D(e){return this.m_bPolygon?(this.updateRingAreas2DProtected(),this.m_cachedRingAreas2D.read(e)):0}updateRingAreas2DProtected(){if(!this.hasDirtyFlag(1024))return;const e=this.getPathCount();if(0===e)return this.hasDirtyFlag(1024)&&(this.m_cachedArea2D=0),void this.setDirtyFlagProtected(1024,!1);const t=new i.AttributeStreamOfDbl(e),s=new n.KahanSummator(0),r=new n.KahanSummator(0);if(0!==this.m_pointCount){const i=this.getAttributeStreamRef(0);if(this.hasNonLinearSegments()){const e=new le({parent:this});for(e.stripAttributes();e.nextPath();){r.reset();const n=e.getPathIndex();me(this,n,i,r),de(0,e,r);const o=.5*r.getResult();s.add(o),t.write(n,o)}}else for(let n=0;n<e;n++){r.reset(),me(this,n,i,r);const e=.5*r.getResult();s.add(e),t.write(n,e)}}this.hasDirtyFlag(1024)&&(this.m_cachedArea2D=s.getResult(),this.m_cachedRingAreas2D=t,this.setDirtyFlagProtected(1024,!1))}getOGCPolygonCount(){if(!this.m_bPolygon)return 0;this.updateOGCFlagsProtected();let e=0;const t=this.getPathCount();for(let i=0;i<t;i++)8&this.m_pathFlags.read(i)&&e++;return e}getHashCodeImpl(){return t.geometryReleaseAssert(0),0}equalsImpl(e){const t=e,i=this.getPathCount();if(i!==t.getPathCount())return!1;const s=this.hasNonLinearSegments();if(s!==t.hasNonLinearSegments())return!1;if(s){if(this.m_curveData.m_curveCount!==t.m_curveData.m_curveCount)return!1;if(this.m_curveData.m_bezierCount!==t.m_curveData.m_bezierCount)return!1}if(this.m_paths&&!this.m_paths.equals(t.m_paths,0,i+1))return!1;if(this.m_bFillRule!==t.m_bFillRule)return!1;if(!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(t.m_pathFlags,0,i))return!1;if(this.hasNonLinearSegments()){if(!this.m_curveData.m_segmentFlags.equals(t.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;for(let e=0,i=this.getPointCount();e<i;e++){const i=this.m_curveData.m_segmentFlags.read(e);if(!_e.isNonLinearSegmentFlag(i))continue;const s=this.m_curveData.m_segmentParamIndex.read(e),r=t.m_curveData.m_segmentParamIndex.read(e),o=ue(i);for(let e=0;e<o;e++){const i=this.m_curveData.m_segmentParams.read(s+e),o=t.m_curveData.m_segmentParams.read(r+e);if(!n.isEqualNonIEEE(i,o))return!1}}}return!0}equalsImplTol(e,t){const i=e,n=this.getPathCount();if(n!==i.getPathCount())return!1;const s=this.hasNonLinearSegments();if(s!==i.hasNonLinearSegments())return!1;if(s){if(this.m_curveData.m_curveCount!==i.m_curveData.m_curveCount)return!1;if(this.m_curveData.m_bezierCount!==i.m_curveData.m_bezierCount)return!1}if(this.m_paths&&!this.m_paths.equals(i.m_paths,0,n+1))return!1;if(this.m_bFillRule!==i.m_bFillRule)return!1;if(!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(i.m_pathFlags,0,n))return!1;if(!s)return!0;if(!this.m_curveData.m_segmentFlags.equals(i.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;const r=this.querySegmentIterator(),o=i.querySegmentIterator();for(;r.nextPath();){if(!o.nextPath())return!1;for(;r.hasNextSegment();){const e=r.nextCurve(),i=o.nextCurve();if(!(e&&i&&e.equals(i,t))){if(!e&&!i)break;return!1}}}return!0}reserveImplImpl(e,t){this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(e,1),this.m_curveData.m_segmentParamIndex.resize(e,-1),this.checkCompactSegmentParams())}verifyStreamsAfterSizeChangeExtraImpl(){this.m_paths||(this.m_paths=i.createIndexStream(1,0),this.m_pathFlags=i.createByteStream(1,0)),this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(this.m_reservedPointCount,1),this.m_curveData.m_segmentParamIndex.resize(this.m_reservedPointCount,-1),this.checkCompactSegmentParams())}copyToImpl(e,t){const i=e;i.m_bPathStarted=!1,i.m_bFillRule=this.m_bFillRule,this.m_paths?i.m_paths=t?this.m_paths:this.m_paths.clone():i.m_paths=null,this.m_pathFlags?i.m_pathFlags=t?this.m_pathFlags:this.m_pathFlags.clone():i.m_pathFlags=null,this.m_curveData&&(i.m_curveData||(i.m_curveData=new ge),i.m_curveData.assignCopy(this.m_curveData),i.m_curveData.m_curveCount=0,i.updateCurveCounter(this.m_curveData.m_curveCount),t||(this.m_curveData.m_segmentParamIndex?i.m_curveData.m_segmentParamIndex=this.m_curveData.m_segmentParamIndex.clone():i.m_curveData.m_segmentParamIndex=null,this.m_curveData.m_segmentFlags?i.m_curveData.m_segmentFlags=this.m_curveData.m_segmentFlags.clone():i.m_curveData.m_segmentFlags=null,this.m_curveData.m_segmentParams?i.m_curveData.m_segmentParams=this.m_curveData.m_segmentParams.clone():i.m_curveData.m_segmentParams=null)),i.hasDirtyFlag(512)||(i.m_cachedLength2D=this.m_cachedLength2D),i.m_cachedRingAreas2D=null,i.hasDirtyFlag(1024)||(i.m_cachedArea2D=this.m_cachedArea2D,null!==this.m_cachedRingAreas2D&&(i.m_cachedRingAreas2D=t?this.m_cachedRingAreas2D:this.m_cachedRingAreas2D.clone()))}calculateArea2D(){return this.m_bPolygon?(this.updateRingAreas2DProtected(),this.m_cachedArea2D):0}calculateLength2D(){if(!this.hasDirtyFlag(512))return this.m_cachedLength2D;const e=this.querySegmentIterator(),t=new n.KahanSummator(0);for(;e.nextPath();)for(;e.hasNextSegment();)t.add(e.nextSegment().calculateLength2D());return this.hasDirtyFlag(512)&&(this.m_cachedLength2D=t.getResult()),this.setDirtyFlagProtected(512,!1),t.getResult()}calculatePathLength2D(e){const t=this.querySegmentIteratorAtVertex(this.getPathStart(e)),i=new n.KahanSummator(0);for(;t.hasNextSegment();)i.add(t.nextSegment().calculateLength2D());return i.getResult()}calculateLength3D(e){return t.geometryReleaseAssert(0),0}calculatePathLength3D(e,i){return t.geometryReleaseAssert(0),0}copyTo(e){t.isMultiPath(e.getGeometryType())||t.throwInvalidArgumentException(""),this!==e&&super.copyTo(e)}swap(e){t.geometryReleaseAssert(0)}setPointByVal(e,t){this.setPointByValWithCurves(e,t)}setPointByValWithCurves(e,t){if(this.hasNonLinearSegments()){const i=t.getXY();if(this.setXYCoordsWithCurves(e,i.x,i.y),1===this.m_description.getAttributeCount())return}this.setPointByValNoCurves(e,t)}setXYCoordsWithCurves(e,t,i){if(this.hasNonLinearSegments()){const s=_e.getPathIndexFromPointIndexImpl(this.m_paths,this.getPathCount(),e,this.m_currentPathIndex);this.m_currentPathIndex=s;const r=this.getPrevSegmentTypeFromPath(s,e),o=this.getNextSegmentType(e);if(1!==r||1!==o){let a=e-1;const l=new Mr;1!==r&&(this.isClosedPath(s)&&e===this.getPathStart(s)&&(a=this.getPathEnd(s)-1),this.getSegmentBuffer(a,l,!0));const c=new Mr;1!==o&&this.getSegmentBuffer(e,c,!0);const h=e+1;this.setXYCoordsNoCurves(e,t,i);const u=new n.Point2D(t,i);return 1!==r&&(l.get().changeEndPoints2D(l.get().getStartXY(),u),this.replaceSegmentImpl(a,e,l.get(),!0)),void(1!==o&&(c.get().changeEndPoints2D(u,c.get().getEndXY()),this.replaceSegmentImpl(e,h,c.get(),!0)))}}this.setXYCoordsNoCurves(e,t,i)}setXYZWithCurves(e,t){this.hasNonLinearSegments()?(this.setXYCoordsWithCurves(e,t.x,t.y),this.setAttributeNoCurves(1,e,0,t.z)):this.setXYZNoCurves(e,t)}setAttributeWithCurves(e,t,i,n){if(0===e&&this.hasNonLinearSegments()){const e=this.getXY(t);0===i?e.x=n:e.y=n,this.setXYCoordsWithCurves(t,e.x,e.y)}else this.setAttributeNoCurves(e,t,i,n)}setXY(e,t){this.setXYCoordsWithCurves(e,t.x,t.y)}setXYCoords(e,t,i){this.setXYCoordsWithCurves(e,t,i)}setXYZ(e,t){this.setXYZWithCurves(e,t)}setAttribute(e,t,i,n){this.setAttributeWithCurves(e,t,i,n)}setAttributeWithCurvesFromArray(e,i,n,s){if(0===e&&this.hasNonLinearSegments()){s<2&&t.throwOutOfRangeException("");const e=this.getXY(i);e.x=n[0],e.y=n[1],this.setXYCoordsWithCurves(i,e.x,e.y)}else this.setAttributeFromArrayNoCurves(e,i,n,s)}setAttributeFromArray(e,t,i,n){this.setAttributeWithCurvesFromArray(e,t,i,n)}hasNonLinearSegments(){return 0!==this.getCurveCount()}getSegmentCount(){let e=this.getPointCount();if(!this.m_bPolygon){e-=this.getPathCount();for(let t=0,i=this.getPathCount();t<i;t++)this.isClosedPath(t)&&e++}return e}getSegmentCountPath(e){let t=this.getPathSize(e);return!this.isClosedPath(e)&&t>0&&t--,t}add(e,i){this===e&&t.throwInvalidArgumentException("Multi_path_impl::add");for(let t=0,n=e.getPathCount();t<n;t++)this.addPath(e,t,!i)}addPath(e,t,i){this.insertPath(-1,e,t,i)}addPathPoint2D(e,t,i){this.insertPath2D(-1,e,0,t,i)}addPathMultiPoint(e,t,i,n){i<0&&(i=e.getPointCount()-t),this.insertPointsFromMultipoint(-1,0,e,t,i,n)}addSegmentsFromPath(e,i,n,s,r){if(this===e&&t.throwInvalidArgumentException("Multi_path_impl.add_segments_from_path"),r||0!==this.getPathCount()||(r=!0),i<0&&(i=e.getPathCount()-1),(i>=e.getPathCount()||n<0||s<0||n+s>e.getSegmentCountPath(i))&&t.throwOutOfRangeException("add_segments_from_path"),0===s)return;const o=e.getPathStart(i),a=e.isClosedPath(i)&&n+s===e.getSegmentCountPath(i);this.m_bPathStarted=!1,this.mergeVertexDescription(e.getDescription());let l=s;const c=o+n;let h=c+1;r&&(l++,h--),!r&&e.hasNonLinearSegments()&&1!==e.m_curveData.m_segmentFlags.read(c)&&(e.getXY(c).equals(this.getXY(this.m_pointCount-1))||t.throwInvalidArgumentException("add_segments_from_path: start point mismatch"));const u=this.m_pointCount;if(this.resizeImpl(this.m_pointCount+l),this.verifyAllStreamsAfterSizeChange(),r){if(0===l)return;this.m_paths.add(this.m_pointCount);let t=e.m_pathFlags.read(i);this.m_bPolygon&&(t|=1),this.m_pathFlags.write(this.m_pathFlags.size()-1,t),this.m_pathFlags.add(0)}else this.m_paths.write(this.m_pathFlags.size()-1,this.m_pointCount);const m=a?l-1:l;for(let t=0,i=this.m_description.getAttributeCount();t<i;t++){const i=this.m_description.getSemantics(t),n=pe.getComponentCount(i),s=e.m_description.getAttributeIndex(i);if(m>0){if(s<0||!e.m_vertexAttributes.get(s)){const e=pe.getDefaultValue(i);this.m_vertexAttributes.get(t).insertRange(n*u,e,m*n,n*u),a&&this.m_vertexAttributes.get(t).insertRange(n*u+m*n,e,n,n*u);continue}this.m_vertexAttributes.get(t).insertRangeFromStream(n*u,e.m_vertexAttributes.get(s),n*h,m*n,!0,n,n*u)}a&&this.m_vertexAttributes.get(t).insertRangeFromStream(n*(u+m),e.m_vertexAttributes.get(s),n*o,n,!0,n,n*(u+m))}if(this.hasNonLinearSegments()&&this.initSegmentData(0),e.hasNonLinearSegments()){let t=0;for(let i=0,n=c;i<s;i++)t+=ue(e.m_curveData.m_segmentFlags.read(n)),n++;if(t>0){this.initSegmentData(t);let i=c,n=u-(r?0:1),o=0;for(let t=0;t<s;t++){const t=e.m_curveData.m_segmentFlags.read(i);if(this.m_curveData.m_segmentFlags.write(n,t),_e.isNonLinearSegmentFlag(t)){o++;let s=e.m_curveData.m_segmentParamIndex.read(i);const r=ue(t);this.m_curveData.m_segmentParamIndex.write(n,this.m_curveData.m_curveParamWritePoint);for(let t=0;t<r;t++){const t=e.m_curveData.m_segmentParams.read(s);this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,t),this.m_curveData.m_curveParamWritePoint++,s++}this.incCurveType(t,1)}else this.m_curveData.m_segmentParamIndex.write(n,-1);n++,i++}this.modifyCurveCounter(o)}}if(a){const e=this.getPathCount()-1,t=this.getPathStart(e),i=this.getPathEnd(e)-1,n=this.getXY(t),s=this.getXY(i);n.isEqualPoint2D(s)&&(--this.m_pointCount,this.m_paths.write(e+1,this.m_pointCount))}this.notifyModifiedFlags(2001)}reverseAllPaths(){for(let e=0,t=this.getPathCount();e<t;e++)this.reversePath(e)}reversePath(e){e>=this.getPathCount()&&t.throwInvalidArgumentException("");const i=this.getPathSize(e);if(0===i)return;const n=this.getPathStart(e),s=this.isClosedPath(e);if(this.hasNonLinearSegments()){let e=n;const t=new this.m_segmentBufferCTor;let r=!1;for(let n=0;n<i;n++,e++){const i=this.m_curveData.m_segmentFlags.read(e);if(!_e.isNonLinearSegmentFlag(i))continue;r=!0,this.querySegment(e,t,!0),t.get().reverse();const n=this.m_curveData.m_segmentParamIndex.read(e);t.get().writeInBufferStream(this.m_curveData.m_segmentParams,n)}if(r){const e=s?0:1;this.m_curveData.m_segmentFlags.reverseRange(n,i-e,1),this.m_curveData.m_segmentParamIndex.reverseRange(n,i-e,1)}}const r=s?1:0;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){const t=this.m_description.getSemantics(e),s=pe.getComponentCount(t);this.m_vertexAttributes.get(e).reverseRange(s*(n+r),s*(i-r),s)}const o=6&this.m_pathFlags.read(e);if(o){let t=0;4&o&&(t|=2),2&o&&(t|=4),this.m_pathFlags.clearBits(e,6),this.m_pathFlags.setBits(e,t)}this.notifyModifiedFlags(1233)}removePath(e){const i=this.getPathCount();e<0&&(e=i-1),e>=i&&t.throwInvalidArgumentException("");const n=this.getPathStart(e),s=this.getPathSize(e);for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){const t=this.m_description.getSemantics(e),i=pe.getComponentCount(t);this.m_vertexAttributes.get(e).eraseRange(i*n,i*s,i*this.m_pointCount)}if(this.hasNonLinearSegments()){let e=0;for(let t=n,i=n+s;t<i;t++){const i=this.m_curveData.m_segmentFlags.read(t);_e.isNonLinearSegmentFlag(i)&&(this.incCurveType(i,-1),e++)}this.modifyCurveCounter(-e),this.m_curveData.m_segmentFlags.eraseRange(n,s,this.m_pointCount),this.m_curveData.m_segmentParamIndex.eraseRange(n,s,this.m_pointCount)}for(let t=e+1;t<=i;t++){const e=this.m_paths.read(t);this.m_paths.write(t-1,e-s)}if(this.m_pathFlags)for(let t=e+1;t<=i;t++){const e=this.m_pathFlags.read(t);this.m_pathFlags.write(t-1,e)}this.m_paths.resize(i),this.m_pathFlags.resize(i),this.m_pointCount-=s,this.m_reservedPointCount-=s,e===i-1&&(this.m_bPathStarted=!1),this.notifyModifiedFlags(2001),this.checkCompactSegmentParams(),this.dbgVerifyCurves()}dbgVerifyCurves(){}insertPath(e,n,s,r){this===n&&t.throwInvalidArgumentException("Multi_path_impl::insert_path");const o=this.getPathCount();if(!r&&n.hasNonLinearSegmentsPath(s))return e=this.insertPath(e,n,s,!0),this.reversePath(e),e;s>=n.getPathCount()&&t.throwInvalidArgumentException(""),e>o&&t.throwInvalidArgumentException(""),e<0&&(e=o),s<0&&(s=n.getPathCount()-1),this.m_bPathStarted=!1,this.mergeVertexDescription(n.getDescription());const a=n.getPathStart(s),l=n.getPathSize(s);if(0===l)return this.insertPath2D(e,null,0,0,!0);const c=this.m_pointCount,h=n.isClosedPath(s)&&!r?1:0;this.resizeImpl(this.m_pointCount+l),this.verifyAllStreamsAfterSizeChange();const u=e<o?this.getPathStart(e):c;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),i=n.getDescription().getAttributeIndex(t),s=pe.getComponentCount(t);if(i>=0&&n.m_vertexAttributes.get(i))0!==h&&this.m_vertexAttributes.get(e).insertRangeFromStream(u*s,n.m_vertexAttributes.get(i),s*a,s,!0,s,s*c),this.m_vertexAttributes.get(e).insertRangeFromStream((u+h)*s,n.m_vertexAttributes.get(i),s*(a+h),s*(l-h),r,s,s*(c+h));else{const i=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(u*s,i,s*l,s*c)}}const m=c+l;this.m_paths.add(m);for(let t=o;t>=e+1;t--){const e=this.m_paths.read(t-1);this.m_paths.write(t,e+l)}this.m_pathFlags.add(0);for(let t=o-1;t>=e+1;t--){let e=this.m_pathFlags.read(t);e&=-9,this.m_pathFlags.write(t+1,e)}let d=n.getPathFlagsStreamRef().read(s);if(d&=-9,this.m_bPolygon&&(d|=1),this.m_pathFlags.write(e,d),n.hasNonLinearSegments()){this.initSegmentData(0);let e=a,t=0;for(let i=0;i<l;i++)t+=ue(n.m_curveData.m_segmentFlags.read(e)),e++;if(t>0){null===this.m_curveData.m_segmentFlags?(this.m_curveData.m_segmentFlags=i.createByteStream(this.m_pointCount,1),this.m_curveData.m_segmentParamIndex=i.createIndexStream(this.m_pointCount,-1)):(this.m_curveData.m_segmentFlags.insertRange(u,1,l,c),this.m_curveData.m_segmentParamIndex.insertRange(u,-1,l,c)),this.m_curveData.m_segmentParams?this.m_curveData.m_segmentParams.resize(this.m_curveData.m_curveParamWritePoint+t):this.m_curveData.m_segmentParams=i.createDoubleStream(t),e=a;let s=u,r=0;for(let t=0;t<l;t++){const t=n.m_curveData.m_segmentFlags.read(e);if(_e.isNonLinearSegmentFlag(t)){this.m_curveData.m_segmentFlags.write(s,t),this.m_curveData.m_segmentParamIndex.write(s,this.m_curveData.m_curveParamWritePoint);const i=ue(t);let o=n.m_curveData.m_segmentParamIndex.read(e);for(let e=0;e<i;e++){const e=n.m_curveData.m_segmentParams.read(o);this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,e),this.m_curveData.m_curveParamWritePoint++,o++}r++,this.incCurveType(t,1)}e++,s++}this.modifyCurveCounter(r)}}return this.notifyModifiedFlags(2001),e}insertPath2D(e,i,n,s,r){const o=this.getPathCount();(e>o||n<0)&&t.throwInvalidArgumentException(""),e<0&&(e=o),this.m_bPathStarted=!1;const a=this.m_pointCount;this.resizeImpl(this.m_pointCount+s),0===s&&this.notifyModifiedFlags(32),this.verifyAllStreamsAfterSizeChange();const l=e<o?this.getPathStart(e):a;if(i)this.m_vertexAttributes.get(0).insertRangeFromPoints(2*l,i,n,s,r,2*a);else{const e=pe.getDefaultValue(0);this.m_vertexAttributes.get(0).insertRange(2*l,e,2*s,2*a)}for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),i=pe.getComponentCount(t),n=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(l*i,n,i*s,i*a)}this.m_paths.add(this.m_pointCount);for(let t=o;t>=e+1;t--){const e=this.m_paths.read(t-1);this.m_paths.write(t,e+s)}this.m_pathFlags.add(0);for(let t=o-1;t>=e+1;t--){let e=this.m_pathFlags.read(t);e&=-9,this.m_pathFlags.write(t+1,e)}return this.m_bPolygon&&this.m_pathFlags.write(e,1),this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(l,1,s,a),this.m_curveData.m_segmentParamIndex.insertRange(l,-1,s,a)),this.notifyModifiedFlags(2001),e}insertPathFromMultipoint(e,i,n,s,r){const o=i.getImpl(),a=this.getPathCount();(e>a||n<0)&&t.throwInvalidArgumentException("");const l=s<0?o.getPointCount()-n:s;if(l>o.getPointCount()&&t.throwInvalidArgumentException(""),n>=o.getPointCount()&&t.throwInvalidArgumentException("pointsOffset"),e<0&&(e=a),this.m_bPathStarted=!1,this.mergeVertexDescription(o.getDescription()),0===l)return void this.insertPath2D(e,null,0,0,!0);const c=this.m_pointCount,h=n;this.resizeImpl(this.m_pointCount+l),this.verifyAllStreamsAfterSizeChange();const u=e<a?this.getPathStart(e):c;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),i=o.getDescription().getAttributeIndex(t),n=pe.getComponentCount(t);if(i>=0){const i=o.getAttributeStreamRef(t);this.m_vertexAttributes.get(e).insertRangeFromStream(u*n,i,n*h,n*l,r,n,n*c)}else{const i=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(u*n,i,n*l,n*c)}}const m=c+l;this.m_paths.add(m);for(let t=a;t>=e+1;t--){const e=this.m_paths.read(t-1);this.m_paths.write(t,e+l)}this.m_pathFlags.add(0);for(let t=a-1;t>=e+1;t--){let e=this.m_pathFlags.read(t);e&=-9,this.m_pathFlags.write(t+1,e)}let d=0;this.m_bPolygon&&(d|=1),this.m_pathFlags.write(e,d),this.notifyModifiedFlags(2001)}insertPoints(e,i,n,s,r,o,a){if(this===n&&t.throwInvalidArgumentException("Multi_path_impl.insert_points"),e<0&&(e=this.getPathCount()),s<0&&(s=n.getPathCount()-1),(e>this.getPathCount()||i>=0&&i>this.getPathSize(e)||s>=n.getPathCount()||o>n.getPathSize(s))&&t.throwOutOfRangeException(""),!o)return;if(this.mergeVertexDescription(n.m_description),e===this.getPathCount()){this.m_paths.add(this.m_pointCount);let e=n.m_pathFlags.read(s);e&=-9,this.m_bPolygon?this.m_pathFlags.add(1|e):this.m_pathFlags.add(e)}i<0&&(i=this.getPathSize(e));const l=this.m_pointCount;this.resizeImpl(this.m_pointCount+o),this.verifyAllStreamsAfterSizeChange();const c=this.getPathStart(e),h=c+i;o<0&&(o=n.getPathSize(s));const u=n.getPathStart(s),m=u+o;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),s=pe.getComponentCount(t),d=n.m_description.getAttributeIndex(t);if(d<0||!n.m_vertexAttributes.get(d)){const i=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(s*h,i,m*s,s*l)}else this.m_vertexAttributes.get(e)?.insertRangeFromStream(s*(c+i),n.m_vertexAttributes.get(d),s*(u+r),o*s,a,s,s*l)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(c+i,1,o,l),this.m_curveData.m_segmentParamIndex.insertRange(c+i,-1,o,l),i>0&&this.isNonLinearSegment(c+i-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(c+i-1),-1),this.m_curveData.m_segmentFlags.write(c+i-1,1),this.m_curveData.m_segmentParamIndex.write(c+i-1,-1),this.modifyCurveCounter(-1)));for(let t=e+1,i=this.getPathCount();t<=i;t++){const e=this.m_paths.read(t);this.m_paths.write(t,e+o)}this.notifyModifiedFlags(2001)}insertPointsFromPoints(e,i,n,s,r,o){if(e<0&&(e=this.getPathCount()),(e>this.getPathCount()||i>this.getPathSize(e)||s<0)&&t.throwOutOfRangeException(""),!r)return;e===this.getPathCount()&&(this.m_paths.add(this.m_pointCount),this.m_bPolygon?this.m_pathFlags.add(1):this.m_pathFlags.add(0)),i<0&&(i=this.getPathSize(e));const a=this.m_pointCount;this.resizeImpl(this.m_pointCount+r),this.verifyAllStreamsAfterSizeChange();const l=this.getPathStart(e);this.m_vertexAttributes.get(0).insertRangeFromPoints(2*(l+i),n,s,r,o,2*a);for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),n=pe.getComponentCount(t),s=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange((l+i)*n,s,n*r,n*a)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(l+i,1,r,a),this.m_curveData.m_segmentParamIndex.insertRange(l+i,-1,r,a),i>0&&this.isNonLinearSegment(l+i-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(l+i-1),-1),this.m_curveData.m_segmentFlags.write(l+i-1,1),this.m_curveData.m_segmentParamIndex.write(l+i-1,-1),this.modifyCurveCounter(-1)));for(let t=e+1,i=this.getPathCount();t<=i;t++)this.m_paths.write(t,this.m_paths.read(t)+r);this.notifyModifiedFlags(2001)}insertPointsFromMultipoint(e,i,n,s,r,o){const a=n.getImpl(),l=this.getPathCount();e<0&&(e=this.getPathCount());const c=a.getPointCount();if((s<0||s>c)&&t.throwOutOfRangeException(""),(r<0||s+r>c)&&(r=c-s),i<0&&(i=e<l?this.getPathSize(e):0),(e>l||e<l&&i>this.getPathSize(e)||e===l&&i>0||r<0)&&t.throwOutOfRangeException(""),!r)return;if(this.mergeVertexDescription(a.getDescription()),e===l){this.m_paths.add(this.m_pointCount);const e=0;this.m_bPolygon?this.m_pathFlags.add(1|e):this.m_pathFlags.add(e)}i<0&&(i=this.getPathSize(e));const h=this.m_pointCount;this.resizeImpl(this.m_pointCount+r),this.verifyAllStreamsAfterSizeChange();const u=this.getPathStart(e),m=u+i,d=0+r;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),n=pe.getComponentCount(t);if(a.getDescription().getAttributeIndex(t)<0){const i=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(n*m,i,d*n,n*h);continue}const l=a.getAttributeStreamRef(t);this.m_vertexAttributes.get(e).insertRangeFromStream(n*(u+i),l,n*(0+s),r*n,o,n,n*h)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(u+i,1,r,h),this.m_curveData.m_segmentParamIndex.insertRange(u+i,-1,r,h),i>0&&this.isNonLinearSegment(u+i-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(u+i-1),-1),this.m_curveData.m_segmentFlags.write(u+i-1,1),this.m_curveData.m_segmentParamIndex.write(u+i-1,-1),this.modifyCurveCounter(-1)));for(let t=e+1,i=this.getPathCount();t<=i;t++){const e=this.m_paths.read(t);this.m_paths.write(t,e+r)}this.notifyModifiedFlags(2001)}insertPoint2D(e,i,n){const s=this.getPathCount();e<0&&(e=s),(e>s||e<s&&i>this.getPathSize(e))&&t.throwOutOfRangeException(""),e===s&&this.addPathPoint2D(null,0,!0);const r=this.m_pointCount;this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();const o=this.getPathStart(e),a=i<0?this.getPathSize(e)+o:i+o,l=this.m_vertexAttributes.get(0);if(a===r)this.m_paths.write(e+1,r+1),l.writePoint2D(2*a,n);else{l.insert(2*a,n,2*r);for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),i=pe.getComponentCount(t),n=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(i*a,n,i,i*r)}this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(a,1,1,r),this.m_curveData.m_segmentParamIndex.insertRange(a,-1,1,r));for(let t=e+1,i=s;t<=i;t++)this.m_paths.write(t,this.m_paths.read(t)+1)}this.m_curveData&&this.m_curveData.m_segmentFlags&&a>o&&this.isNonLinearSegment(a-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(a-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(a-1,1),this.m_curveData.m_segmentParamIndex.write(a-1,-1)),this.notifyModifiedFlags(2001)}insertPoint(e,i,n){const s=this.getPathCount();e<0&&(e=s),(e>s||e<s&&i>this.getPathSize(e))&&t.throwOutOfRangeException(""),e===s&&this.addPathPoint2D(null,0,!0);const r=this.m_pointCount;this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();const o=this.getPathStart(e),a=i<0?this.getPathSize(e)+o:i+o;if(a===r)this.m_paths.write(e+1,r+1),this.setPointByValNoCurves(a,n);else{const t=n.getDescription();this.m_description!==t&&this.mergeVertexDescription(t);for(let e=0,i=this.m_description.getAttributeCount();e<i;e++){const i=this.m_description.getSemantics(e),s=pe.getComponentCount(i);if(t.hasAttribute(i))this.m_vertexAttributes.get(e).insertAttributes(s*a,n,i,s*r);else{const t=pe.getDefaultValue(i);this.m_vertexAttributes.get(e).insertRange(s*a,t,s,s*r)}}this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(a,1,1,r),this.m_curveData.m_segmentParamIndex.insertRange(a,-1,1,r));for(let t=e+1,i=s;t<=i;t++)this.m_paths.write(t,this.m_paths.read(t)+1)}this.m_curveData&&this.m_curveData.m_segmentFlags&&a>o&&this.isNonLinearSegment(a-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(a-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(a-1,1),this.m_curveData.m_segmentParamIndex.write(a-1,-1)),this.notifyModifiedFlags(2001)}removePointFromPath(e,i){const n=this.getPathCount();e<0&&(e=n-1),(e>=n||i>=this.getPathSize(e))&&t.throwOutOfRangeException("Multi_path.remove_point");const s=this.getPathStart(e),r=this.isClosedPath(e);i<0&&(i=this.getPathSize(e)-1),i<0&&t.throwOutOfRangeException("Multi_path.remove_point");const o=s+i;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){const t=this.m_description.getSemantics(e),i=pe.getComponentCount(t);this.m_vertexAttributes.get(e).eraseRange(i*o,i,i*this.m_pointCount)}if(this.m_curveData&&this.m_curveData.m_segmentFlags){this.checkCompactSegmentParams();let t=0;if(o>s&&this.isNonLinearSegment(o-1))t+=1,this.incCurveType(this.m_curveData.m_segmentFlags.read(o-1),-1),this.m_curveData.m_segmentFlags.write(o-1,1),this.m_curveData.m_segmentParamIndex.write(o-1,-1);else{const i=this.getPathEnd(e);r&&s+1<i&&this.isNonLinearSegment(i-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(i-1),-1),this.m_curveData.m_segmentFlags.write(i-1,1),this.m_curveData.m_segmentParamIndex.write(i-1,-1),t+=1)}this.isNonLinearSegment(o)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(o),-1),t+=1),t>0&&this.modifyCurveCounter(-t),this.m_curveData.m_segmentFlags.eraseRange(o,1,this.m_pointCount),this.m_curveData.m_segmentParamIndex.eraseRange(o,1,this.m_pointCount)}for(let t=n;t>=e+1;t--){const e=this.m_paths.read(t);this.m_paths.write(t,e-1)}this.m_pointCount--,this.m_reservedPointCount--,this.notifyModifiedFlags(2001)}removePoint(e){let t;t=e<0?this.getPathCount()-1:this.getPathIndexFromPointIndex(e),this.removePointFromPath(t,e-this.getPathStart(t))}getNextSegmentType(e){return this.hasNonLinearSegments()?this.m_curveData.m_segmentFlags.read(e):1}getPrevSegmentTypeFromPath(e,i){if(!this.hasNonLinearSegments())return 1;const n=this.getPathStart(e);if(i>n)return this.m_curveData.m_segmentFlags.read(i-1);if(i===n){if(this.isClosedPath(e)){const t=this.getPathEnd(e);return this.m_curveData.m_segmentFlags.read(t-1)}return 1}t.throwInternalErrorException("")}getNumberOfCurves(e){if(!this.hasNonLinearSegments())return 0;let t=0;for(let i=this.getPathStart(e),n=this.getPathEnd(e);i<n;i++)_e.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(i))&&++t;return t}getPathCount(){return this.m_paths?this.m_paths.size()-1:0}getPathSize(e){return this.m_paths.read(e+1)-this.m_paths.read(e)}getPathStart(e){return this.m_paths.read(e)}getPathEnd(e){return this.m_paths.read(e+1)}getPathIndexFromPointIndex(e,t=-1){-1===t&&(t=this.m_currentPathIndex);const i=this.getPathCount(),n=_e.getPathIndexFromPointIndexImpl(this.m_paths,i,e,t);return this.m_currentPathIndex=n,n}startPathCoords(e,t){this.startPathPoint(new i.Point({x:e,y:t}))}startPath(e){this.startPathPoint(new i.Point({pt:e}))}startPath3D(e){this.startPathPoint(new i.Point({x:e.x,y:e.y,z:e.z}))}startPath3DCoords(e,t,n){this.startPathPoint(new i.Point({x:e,y:t,z:n}))}startPathPoint(e){e.isEmpty()&&t.throwInvalidArgumentException("");const n=e.getDescription();let s;if(this.m_description!==n){this.mergeVertexDescription(n);const t=new i.Point({vd:this.m_description});e.copyCommonAttributesTo(t),s=t}else s=e;this.m_bPathStarted?this.setPointByValNoCurves(this.m_pointCount-1,s):(this.insertPoint(-1,-1,s),this.m_bPathStarted=!0)}beforeNewSegmentHelper2(){this.m_paths=i.createIndexStream(2),this.m_paths.write(0,0),this.m_pathFlags=i.createByteStream(2,0),this.m_bPolygon&&this.m_pathFlags.write(0,1)}beforeNewSegmentHelper1(){null!==this.m_paths?(this.m_paths.add(0),this.m_pathFlags.add(0),this.m_bPolygon&&this.m_pathFlags.write(this.m_pathFlags.size()-2,1)):this.beforeNewSegmentHelper2()}beforeNewSegment(e){0!==this.m_pointCount||this.m_bPathStarted||this.startPathCoords(0,0);const t=this.m_pointCount,i=this.m_paths.size()-1,n=t+e;this.m_paths.write(i,n),this.resizeImpl(n),this.m_bPathStarted&&(this.m_bPathStarted=!1)}finishLineTo(){if(this.hasNonLinearSegments()){const e=this.m_curveData.m_segmentFlags.read(this.m_pointCount-1);1!==e&&(this.m_curveData.m_segmentFlags.write(this.m_pointCount-1,1),this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-1,-1),this.modifyCurveCounter(-1),this.incCurveType(e,-1))}}lineToCoords(e,t){if(this.beforeNewSegment(1),1===this.m_description.getAttributeCount())this.setXYCoordsNoCurves(this.m_pointCount-1,e,t);else{const n=i.newOrdinateBuffer(),s=new i.Point({vd:this.m_description,attribBuffer:n,initDefaultValues:!0});s.setXYCoords(e,t),this.setPointByValNoCurves(this.m_pointCount-1,s)}this.finishLineTo()}lineTo(e){this.lineToCoords(e.x,e.y)}lineTo3D(e){this.beforeNewSegment(1);const t=i.getMergedVertexDescription(this.m_description,i.getDefaultDescription3D()),n=i.newOrdinateBuffer(),s=new i.Point({vd:t,attribBuffer:n,initDefaultValues:!0});s.setXYZ(e),this.setPointByValNoCurves(this.m_pointCount-1,s),this.finishLineTo()}lineTo3DCoords(e,t,n){this.lineTo3D(new i.Point3D(e,t,n))}lineToPoint(e){if(this.beforeNewSegment(1),this.m_description===e.getDescription())this.setPointByValNoCurves(this.m_pointCount-1,e);else{this.mergeVertexDescription(e.getDescription());const t=i.newOrdinateBuffer(),n=new i.Point({vd:this.m_description,attribBuffer:t,initDefaultValues:!1});e.copyCommonAttributesTo(n),this.setPointByValNoCurves(this.m_pointCount-1,n)}this.finishLineTo()}openPathAndDuplicateStartVertex(e){this.m_bPolygon&&t.throwInternalErrorException("");const i=this.getPathCount();if(e>i&&t.throwInvalidArgumentException(""),!this.isClosedPath(e))return;this.m_pathFlags||t.throwInternalErrorException("");const n=this.m_pointCount,s=this.getPathStart(e),r=this.getPathEnd(e);if(r-s!==0){this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){const t=this.m_description.getSemantics(e),i=pe.getComponentCount(t);this.m_vertexAttributes.get(e).insertRangeFromStream(i*r,this.m_vertexAttributes.get(e),i*s,i,!0,1,i*n)}for(let t=i;t>e;t--){const e=this.m_paths.read(t);this.m_paths.write(t,e+1)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(r,1,1,n),this.m_curveData.m_segmentParamIndex.insertRange(r,-1,1,n)),this.m_pathFlags.clearBits(e,1)}}openPath(e){this.m_bPolygon&&t.throwInternalErrorException(""),e>this.getPathCount()&&t.throwInvalidArgumentException(""),this.m_pathFlags||t.throwInternalErrorException(""),this.m_pathFlags.clearBits(e,1)}isStrongPathStart(e){return!!(2&this.m_pathFlags.read(e))}setStrongPathStart(e,t){t?this.m_pathFlags.setBits(e,2):this.m_pathFlags.clearBits(e,2)}isStrongPathEnd(e){return!!(4&this.m_pathFlags.read(e))}setStrongPathEnd(e,t){t?this.m_pathFlags.setBits(e,4):this.m_pathFlags.clearBits(e,4)}clearStrongPathEnds(){for(let e=0,t=this.getPathCount();e<t;++e)this.m_pathFlags.clearBits(e,6)}openAllPathsAndDuplicateStartVertex(){if(this.m_bPolygon&&t.throwInternalErrorException(""),this.isEmpty())return;this.m_pathFlags||t.throwInternalErrorException("");let e=0;const n=this.getPathCount();for(let t=0;t<n;t++)this.isClosedPath(t)&&(this.getPathSize(t)>0?e++:this.m_pathFlags.clearBits(t,1));if(0===e)return;const s=this.hasNonLinearSegments();let r=0;const o=this.getPathCount(),a=this.m_description.getAttributeCount(),l=new Array(a);let c=null,h=null;for(let t=0;t<o;++t){const n=this.getPathStart(t),o=this.getPathSize(t),u=this.isClosedPath(t);if(o>0){const t=n+r;for(let s=0;s<a;s++)if(this.m_vertexAttributes.get(s)){const r=this.m_description.getSemantics(s),a=pe.getComponentCount(r);if(!l[s]){const t=a*(this.m_pointCount+e),n=i.createAttributeStreamUninitialized(r,t);l[s]=n}l[s].writeRange(t*a,o*a,this.m_vertexAttributes.get(s),n*a,!0,1),u&&l[s].writeRange((t+o)*a,a,this.m_vertexAttributes.get(s),n*a,!0,1)}if(s){if(null===c){const t=this.m_pointCount+e;c=i.createByteStream(t),h=i.createIndexStream(t)}c.writeRange(t,o,this.m_curveData.m_segmentFlags,n,!0,1),h.writeRange(t,o,this.m_curveData.m_segmentParamIndex,n,!0,1),u&&(c.write(t+o,1),h.write(t+o,-1))}}this.m_paths.write(t,n+r),u&&(this.m_pathFlags.clearBits(t,1),++r)}this.m_paths.write(o,this.m_pointCount+e),this.m_pathFlags.clearBits(o,1);for(let e=0;e<a;e++)this.m_vertexAttributes.get(e)&&this.m_vertexAttributes.set(e,l[e]);s&&(this.m_curveData.m_segmentFlags=c,this.m_curveData.m_segmentParamIndex=h),this.m_pointCount+=e,this.m_reservedPointCount>0&&(this.m_reservedPointCount=this.m_pointCount)}closePathWithLine(e){void 0===e&&(e=this.getPathCount()-1),this.throwIfEmpty(),(e<0||e>=this.getPathCount())&&t.throwInvalidArgumentException("close_path_with_line"),e===this.getPathCount()-1&&(this.m_bPathStarted=!1);const i=this.m_pathFlags.read(e);if(1&i||this.m_pathFlags.write(e,1|i),this.m_curveData&&this.m_curveData.m_segmentFlags){const t=this.getPathEnd(e)-1,i=this.m_curveData.m_segmentFlags.read(t);1!==i&&(this.m_curveData.m_segmentFlags.write(t,1),this.m_curveData.m_segmentParamIndex.write(t,-1),this.incCurveType(i,-1),this.modifyCurveCounter(-1))}this.notifyModifiedFlags(2001)}closeLastPathWithSegment(e){this.closePathWithSegment(this.getPathCount()-1,e)}closePathWithSegment(e,i){if(this.throwIfEmpty(),(e<0||e>=this.getPathCount())&&t.throwInvalidArgumentException("close_path_with_line"),i.getEndXY().equals(this.getXY(this.getPathStart(e)))||t.throwInvalidArgumentException("close_path_with_segment: end point mismatch"),e===this.getPathCount()-1)this.m_bPathStarted=!1,this.addSegment(i,!1),--this.m_pointCount,this.m_paths.write(e+1,this.m_pointCount);else{this.mergeVertexDescription(i.getDescription());const n=i.getStartXY(),s=this.getPathEnd(e)-1;n.equals(this.getXY(s))||t.throwInvalidArgumentException("close_path_with_segment: start point mismatch");const r=i.getGeometryType();if(r===t.GeometryType.enumLine)return void this.closePathWithLine(e);{const e=he(i);this.initSegmentData(e);const t=ge.toSegType(r),n=this.m_curveData.m_segmentFlags.read(s);if(n!==t)this.m_curveData.m_segmentParamIndex.write(s,this.m_curveData.m_curveParamWritePoint),i.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint),this.m_curveData.m_curveParamWritePoint+=e,this.incCurveType(t,1),1!==n?this.incCurveType(n,-1):this.modifyCurveCounter(1);else{const e=this.m_curveData.m_segmentParamIndex.read(s);i.writeInBufferStream(this.m_curveData.m_segmentParams,e)}this.m_curveData.m_segmentFlags.write(s,t)}}const n=this.m_pathFlags.read(e);1&n||this.m_pathFlags.write(e,1|n),this.notifyModifiedFlags(2001)}closeAllPaths(){if(this.m_bPolygon||this.isEmptyImpl())return;this.m_bPathStarted=!1;let e=!1;for(let t=0,i=this.m_paths.size()-1;t<i;t++){if(this.isClosedPath(t))continue;const i=this.m_pathFlags.read(t);this.m_pathFlags.write(t,1|i),e=!0}e&&this.notifyModifiedFlags(512)}isClosedPath(e){return!!(1&this.m_pathFlags.read(e))}isClosedPathInXYPlane(e){if(this.isClosedPath(e))return!0;const t=this.getPathStart(e),i=this.getPathEnd(e)-1;if(t>i)return!1;const n=this.getXY(t),s=this.getXY(i);return n.isEqualPoint2D(s)}isClosedPathIn3D(e){return t.geometryReleaseAssert(0),!1}hasNonLinearSegmentsPath(e){if(!this.hasNonLinearSegments())return!1;for(let t=this.getPathStart(e),i=this.getPathEnd(e);t<i;t++)if(_e.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(t)))return!0;return!1}isNonLinearSegment(e){return!(1&this.getSegmentFlags(e))}addEnvelope(e,t){if(e.isEmpty())return;const n=0===this.m_pointCount;if(e instanceof s.Envelope2D)this.startPathCoords(e.xmin,e.ymin),t?(this.lineToCoords(e.xmax,e.ymin),this.lineToCoords(e.xmax,e.ymax),this.lineToCoords(e.xmin,e.ymax)):(this.lineToCoords(e.xmin,e.ymax),this.lineToCoords(e.xmax,e.ymax),this.lineToCoords(e.xmax,e.ymin));else{const n=e.getDescription(),s=i.newOrdinateBuffer(),r=new i.Point({vd:n,attribBuffer:s,initDefaultValues:!1});for(let i=0,n=4;i<n;i++){const s=t?n-i-1:i;e.queryCornerByVal(s,r),0===i?this.startPathPoint(r):this.lineToPoint(r)}}this.closePathWithLine(),this.m_bPathStarted=!1,n&&!t&&(this.setDirtyFlagProtected(256,!1),this.m_bPolygon&&Math.min(e.width(),e.height())>0&&this.setIsSimple(3,0))}addPathFromClosedSegment(e,n){if(e.isClosed()||t.throwInvalidArgumentException("add_path_from_closedSegment: segment must be closed"),n){const t=e.getReversed(),n=new i.Point;t.queryStart(n),this.startPathPoint(n),this.closeLastPathWithSegment(t)}else{const t=new i.Point;e.queryStart(t),this.startPathPoint(t),this.closeLastPathWithSegment(e)}}addSegment_(e,n){const s=e.getDescription();this.mergeVertexDescription(s);const r=i.newOrdinateBuffer(),o=new i.Point({vd:s,attribBuffer:r,initDefaultValues:!1}),a=e.getGeometryType();if(a===t.GeometryType.enumLine)(n||this.isEmptyImpl())&&(e.queryStart(o),this.startPathPoint(o)),e.queryEnd(o),this.lineToPoint(o);else{let s=!1;if((n||this.isEmptyImpl())&&(s=!0),s||e.getStartXY().equals(this.getXY(this.m_pointCount-1))||t.throwInvalidArgumentException("add_segment: start point mismatch"),s&&(e.queryStart(o),this.startPathPoint(o)),this.beforeNewSegment(1),e.queryEnd(o),o.getDescription()===this.m_description)this.setPointByVal(this.m_pointCount-1,o);else{const e=i.newOrdinateBuffer(),t=new i.Point({vd:this.m_description,attribBuffer:e,initDefaultValues:!1});o.copyCommonAttributesTo(t),this.setPointByVal(this.m_pointCount-1,t)}const r=he(e);this.initSegmentData(r),this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-2,this.m_curveData.m_curveParamWritePoint),e.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint),this.m_curveData.m_curveParamWritePoint+=r;const l=ge.toSegType(a);this.incCurveType(l,1),this.modifyCurveCounter(1),this.m_curveData.m_segmentFlags.write(this.m_pointCount-2,l)}}addSegment(e,t,i){i?t?this.addPathFromClosedSegment(e,!1):this.closeLastPathWithSegment(e):this.addSegment_(e,t)}interpolateAttributesRange(e,i,n,s){for(let i=e;i<n-1;i++)this.isClosedPath(i)&&t.throwInvalidArgumentException("cannot interpolate across closed paths");const r=this.m_description.getAttributeCount();if(1===r)return;const o=this.calculateSubLength2D(e,i,n,s);if(0!==o)for(let t=1;t<r;t++){const r=this.m_description.getSemantics(t);this.interpolateAttributesSemanticsImpl(r,e,i,n,s,o)}}interpolateAttributesSemantics(e,i,n,s,r){if(0===e)return;this.hasAttribute(e)||t.throwInvalidArgumentException("does not have the given attribute"),2===pe.getInterpolation(e)&&t.throwInvalidArgumentException("angular interpolation");for(let e=i;e<s-1;e++)this.isClosedPath(e)&&t.throwInvalidArgumentException("cannot interpolate across closed paths");const o=this.calculateSubLength2D(i,n,s,r);0!==o&&this.interpolateAttributesSemanticsImpl(e,i,n,s,r,o)}interpolateAttributesPath(e,t,i){const n=this.m_description.getAttributeCount();if(1===n)return;if(t===i)return;const s=this.calculatePathSubLength2D(e,t,i);for(let r=1;r<n;r++){const n=this.m_description.getSemantics(r);this.interpolateAttributesSemanticsPathImpl(n,e,t,i,s)}}interpolateAttributesSemanticsPath(e,i,n,s){if(0===e)return;this.hasAttribute(e)||t.throwInvalidArgumentException("does not have the given attribute"),2===pe.getInterpolation(e)&&t.throwInvalidArgumentException("angular interpolation");const r=this.calculatePathSubLength2D(i,n,s);0!==r&&this.interpolateAttributesSemanticsPathImpl(e,i,n,s,r)}interpolateAttributesSemanticsImpl(e,t,i,s,r,o){const a=this.querySegmentIterator(),l=this.getPathStart(t)+i,c=this.getPathStart(s)+r,h=pe.getComponentCount(e),u=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,l,u,h);const m=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,c,m,h);const d=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);n.memcpy(d,u,0,0,h);let p=0;const g=pe.getDefaultValue(e),_=pe.getInterpolation(e);a.resetToVertex(l,t);do{if(a.hasNextSegment()){if(a.nextSegment(),a.getStartPointIndex()===c)return;this.setAttributeFromArray(e,a.getStartPointIndex(),d,h),a.previousSegment();do{const t=a.nextSegment();if(a.getEndPointIndex()===c)return;p+=t.calculateLength2D();const i=p/o;n.interpolateArray(_,u,m,d,0,h,i,g),a.isClosingSegment()||this.setAttributeFromArray(e,a.getEndPointIndex(),d,h)}while(a.hasNextSegment())}}while(a.nextPath())}interpolateAttributesSemanticsPathImpl(e,i,s,r,o){t.geometryReleaseAssert(0!==e);const a=this.querySegmentIterator(),l=pe.getInterpolation(e),c=this.getPathStart(i)+s,h=this.getPathStart(i)+r;if(h===c)return;const u=pe.getComponentCount(e),m=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,c,m,u);const d=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,h,d,u);const p=new n.KahanSummator(0);a.resetToVertex(c,i),a.setCirculator(this.isClosedPath(i));const g=pe.getDefaultValue(e),_=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);n.memcpy(_,m,0,0,u);const f=0===o;let y=.5;do{const t=a.nextSegment();if(this.setAttributeFromArrayNoCurves(e,a.getStartPointIndex(),_,u),!f){const e=t.calculateLength2D();p.pe(e),y=p.getResult()/o}n.interpolateArray(l,m,d,_,0,u,y,g)}while(a.getEndPointIndex()!==h)}querySegment(e,i,n){const s=this.getPathIndexFromPointIndex(e),r=e-this.getPathStart(s);r>=this.getSegmentCountPath(s)&&t.throwInvalidArgumentException("get_segment"),this.getSegmentFromPath(s,r,i,n)}getSegment(e,t){const i=new this.m_segmentBufferCTor;return this.getSegmentBuffer(e,i,t),i.releaseSegment()}getSegmentType(e){const i=this.getPathIndexFromPointIndex(e),n=e-this.getPathStart(i);return n>=this.getSegmentCountPath(i)&&t.throwInvalidArgumentException("get_segment"),this.getSegmentTypeFromPath(i,n)}getSegmentFromPath(e,n,s,r){const o=this.getPathStart(e)+n,a=this.getSegmentFlagsStreamRef();let l=1;switch(a&&(l=31&a.read(o)),l){case 1:s.createLine();break;case 2:s.createCubicBezier();break;case 4:s.createEllipticArc();break;case 8:s.createQuadraticRationalBezier();break;case 16:s.createQuadraticBezier();break;default:t.throwInternalErrorException("")}const c=s.get();let h,u=null;if(r?(u=i.getDefaultDescription2D(),c.assignVertexDescription(u)):c.assignVertexDescription(this.m_description),h=o===this.getPathEnd(e)-1&&this.isClosedPath(e)?this.getPathStart(e):o+1,T(c,this.getXY(o)),I(c,this.getXY(h)),!r)for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),i=pe.getComponentCount(t);for(let e=0;e<i;e++){const i=this.getAttributeAsDbl(t,o,e);c.setStartAttribute(t,e,i);const n=this.getAttributeAsDbl(t,h,e);c.setEndAttribute(t,e,n)}}if(_e.isNonLinearSegmentFlag(l)){const e=this.m_curveData.m_segmentParamIndex.read(o);c.readFromBufferStream(this.m_curveData.m_segmentParams,e)}}replaceLinearEllipticalArcsWithTrueLines(){if(!this.hasNonLinearSegments())return!1;if(0===this.m_curveData.m_arcCount)return!1;let e=!1;for(let n=0,s=this.getPointCount();n<s;n++)if(4===this.m_curveData.m_segmentFlags.read(n)){const s=this.m_curveData.m_segmentParamIndex.read(n);(t=this.m_curveData.m_segmentParams,i=s,t.readPoint2D(i+4)).isNAN()&&(this.m_curveData.m_segmentFlags.write(n,1),this.m_curveData.m_segmentParamIndex.write(n,-1),this.incCurveType(4,-1),this.modifyCurveCounter(-1),e=!0)}var t,i;return e&&this.checkCompactSegmentParams(),e}queryPointAlongPath(e,i,s,r=!1){const o={iSegment:-1},a=r?o:{tSegment:0};if(s.setEmpty(),this.isEmpty())return o;if((e<0||e>=this.getPathCount())&&t.throwInvalidArgumentException("query_point_along_path"),i<0)return o;const l=this.getPathSize(e);if(0===l)return o;if(1===l)return this.getPointByVal(this.getPathStart(e),s),a.tSegment=0,o.iSegment=this.getPathStart(e),o;const c=this.querySegmentIteratorAtVertex(this.getPathStart(e)),h=new n.KahanSummator(0);for(;c.hasNextSegment();){const e=c.nextSegment(),t=e.calculateLength2D(),n=h.getResult();if(h.add(t),h.getResult()>=i){let r=i-n;r>t&&(r=t);const l=e.lengthToT(r);return e.queryCoord(l,s),a.tSegment=l,o.iSegment=c.getStartPointIndex(),o}}if(this.isClosedPath(e)){const t=this.getPathStart(e);return this.getPointByVal(t,s),a.tSegment=1,o.iSegment=this.getPathEnd(e)-1,o}{const t=this.getPathEnd(e)-1;return this.getPointByVal(t,s),this.getPathSize(e)>1?(a.tSegment=1,o.iSegment=this.getPathEnd(e)-2,o):(a.tSegment=0,o.iSegment=this.getPathStart(e),o)}}queryPointsAlongPath(e,i,s,r,o,a){{let e=0;for(let n=0;n<i;++n)r&&r[n].setEmpty(),o&&(o[n]=-1),a&&(a[n]=0),e>s[n]&&t.throwInvalidArgumentException("query_points_along"),e=s[n]}const l=this.getPathSize(e);if(0===i||0===l)return 0;if(1===l){const t=this.getPathStart(e);return r&&this.getPointByVal(t,r[0]),a&&(a[0]=0),o&&(o[0]=t),1}const c=this.getPathStart(e),h=new n.KahanSummator(0),u=this.querySegmentIteratorAtVertex(c);let m=0,d=0,p=s[m];for(;u.hasNextSegment();){const e=u.nextSegment(),t=e.calculateLength2D(),n=h.getResult();for(h.add(t);h.getResult()>=p;){let l=p-n;l>t&&(l=t);const c=e.lengthToT(l);if(r&&e.queryCoord(c,r[d]),a&&(a[d]=c),o&&(o[d]=u.getStartPointIndex()),d++,m++,p=s[m],m===i)return d}}if(this.isClosedPath(e)){const t=this.getPathStart(e),i=0;r&&this.getPointByVal(t,r[d]),a&&(a[d]=i),o&&(o[d]=t),d++}else if(this.getPathSize(e)>1){const t=this.getPathEnd(e)-2,i=1;r&&this.getPointByVal(t+1,r[d]),a&&(a[d]=i),o&&(o[d]=t),d++}return d}queryPointsAlong(e,i,s,r,o){{let n=0;for(let a=0;a<e;++a)s&&s[a].setEmpty(),r&&(r[a]=-1),o&&(o[a]=0),n>i[a]&&t.throwInvalidArgumentException("query_points_along"),n=i[a]}if(0===e)return 0;const a=new n.KahanSummator(0),l=this.querySegmentIterator();let c=-1,h=0,u=0,m=i[h];for(;l.nextPath();)for(;l.hasNextSegment();){c=l.getPathIndex();const t=l.nextSegment(),n=t.calculateLength2D(),d=a.getResult();for(a.add(n);a.getResult()>=m;){let a=m-d;a>n&&(a=n);const c=t.lengthToT(a);if(s&&t.queryCoord(c,s[u]),o&&(o[u]=c),r&&(r[u]=l.getStartPointIndex()),u++,h++,m=i[h],h===e)return u}}if(c<0)return 0;if(this.isClosedPath(c)){const e=this.getPathStart(c),t=0;s&&this.getPointByVal(e,s[u]),o&&(o[u]=t),r&&(r[u]=e),u++}else if(this.getPathSize(c)>1){const e=this.getPathEnd(c)-2,t=1;s&&this.getPointByVal(e+1,s[u]),o&&(o[u]=t),r&&(r[u]=e),u++}return u}querySegmentIterator(){return new le({parent:this})}querySegmentIteratorAtVertex(e){return new le({parent:this,pointIndex:e})}queryPathEnvelope(e,t){this.queryPathEnvelopeImpl(e,t,!0)}queryLoosePathEnvelope(e,t){this.queryPathEnvelopeImpl(e,t,!1)}queryPathEnvelopeImpl(e,n,r){if(n instanceof i.Envelope&&t.geometryReleaseAssert(0,"not implemented for Envelope"),n instanceof i.Envelope3D&&t.geometryReleaseAssert(0,"not implemented for Envelope3D"),(e>=this.getPathCount()||e<0)&&t.throwInvalidArgumentException(""),this.isEmpty())return void n.setEmpty();const o=this.getAttributeStreamRef(0),a=s.Envelope2D.constructEmpty();a.setEmpty();for(let i=2*this.getPathStart(e),n=2*this.getPathEnd(e);i<n;){const e=n-i;t.geometryReleaseAssert(!(1&e)),a.mergePointsInterleaved(o,i/2,e/2),i+=e}if(n.setCoords({env2D:a}),this.hasNonLinearSegmentsPath(e)){const i=this.querySegmentIterator();if(i.resetToPath(e),i.nextPath())for(;i.hasNextSegment();){const e=i.nextCurve();if(!e)break;{const t=s.Envelope2D.constructEmpty();r?e.queryEnvelope(t):e.queryLooseEnvelope(t),n.mergeEnvelope2D(t)}}else t.geometryReleaseAssert(0)}}checkCompactSegmentParams(){if(!this.m_curveData||null===this.m_curveData.m_segmentParams)return!1;if(this.m_curveData.m_segmentParams.size()<=this.m_vertexAttributes.get(0).size())return!1;const e=ue(4)*this.m_curveData.m_arcCount+ue(2)*this.m_curveData.m_bezierCount+ue(8)*this.m_curveData.m_rbezier2Count+ue(16)*this.m_curveData.m_bezier2Count;return this.m_curveData.m_segmentParams.size()>Math.max(3*e>>1,10)?(this.forceCompactSegmentParams(),!0):(0===this.m_pointCount&&(this.m_curveData.m_curveParamWritePoint=0),!1)}forceCompactSegmentParams(){let e=0;for(let t=0,i=this.getPointCount();t<i;t++){const i=this.m_curveData.m_segmentFlags.read(t);_e.isNonLinearSegmentFlag(i)&&(e+=ue(i))}const t=i.createDoubleStream(e);let n=0;for(let e=0,i=this.getPointCount();e<i;e++){const i=this.m_curveData.m_segmentFlags.read(e);if(_e.isNonLinearSegmentFlag(i)){let s=this.m_curveData.m_segmentParamIndex.read(e);this.m_curveData.m_segmentParamIndex.write(e,n);const r=ue(i);for(let e=0;e<r;e++)t.write(n,this.m_curveData.m_segmentParams.read(s)),n++,s++}}this.m_curveData.m_segmentParams=t,this.m_curveData.m_curveParamWritePoint=n}setEmpty(){this.m_curveData&&(this.removeAllCurvesFromGlobalCounter(),this.m_curveData=null),this.m_bPathStarted=!1,this.m_paths=null,this.m_pathFlags=null,this.setEmptyImpl()}applyTransformation(e){this.applyTransformationToPath(e,-1)}applyTransformation3D(e){t.geometryReleaseAssert(0)}getImpl(){return this}reserve(e){this.reserveImpl(e),e>0&&!this.m_paths&&(this.m_paths=i.createIndexStream(0),this.m_pathFlags=i.createByteStream(0),this.m_paths.reserve(2),this.m_pathFlags.reserve(2),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,this.m_bPolygon?1:0))}reserveParts(e,t){this.reserveImpl(e),t>0&&(this.m_paths?(this.m_paths.reserve(t+1),this.m_pathFlags.reserve(t+1)):(this.m_paths=i.createIndexStream(0),this.m_pathFlags=i.createByteStream(0),this.m_paths.reserve(t+1),this.m_pathFlags.reserve(t+1),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,this.m_bPolygon?1:0)))}clone(){const e=this.createInstance();return this.copyTo(e),e}queryLimitedSegmentIterator(e){return new fe(this,e)}getPathStreamRef(){return this.throwIfEmpty(),this.m_paths}setPathStreamRef(e){this.m_paths=e}getSegmentFlagsStreamRef(){return this.throwIfEmpty(),null!=this.m_curveData?this.m_curveData.m_segmentFlags:null}getPathFlagsStreamRef(){return this.throwIfEmpty(),this.m_pathFlags}setPathFlagsStreamRef(e){this.m_pathFlags=e}getSegmentIndexStreamRef(){return this.throwIfEmpty(),null!==this.m_curveData?this.m_curveData.m_segmentParamIndex:null}getSegmentDataStreamRef(){return this.throwIfEmpty(),null!==this.m_curveData?this.m_curveData.m_segmentParams:null}setSegmentData(e,t,i,n){this.m_curveData||(this.m_curveData=new ge),this.m_curveData.m_segmentFlags=i,this.m_curveData.m_segmentParams=t,this.m_curveData.m_segmentParamIndex=e,this.m_curveData.m_curveParamWritePoint=n}static getPathIndexFromPointIndexImpl(e,i,n,s){if(s>=0&&s<i){if(n>=e.read(s)){if(n<e.read(s+1))return s;s++}else s--;if(s>=0&&s<i&&n>=e.read(s)&&n<e.read(s+1))return s}if(i<5){for(let t=0;t<i;t++)if(n<e.read(t+1))return t;t.throwCorruptedGeometryException("")}let r=0,o=i-1;for(;o>r;){const t=r+(o-r>>1);if(n<e.read(t))o=t-1;else{if(!(n>=e.read(t+1)))return t;r=t+1}}return r}getHighestPointIndex(e){t.geometryReleaseAssert(e>=0&&e<this.getPathCount());const i=this.getAttributeStreamRef(0),s=this.getPathEnd(e),r=this.getPathStart(e);let o=-1;const a=new n.Point2D;a.y=Number.NEGATIVE_INFINITY,a.x=Number.NEGATIVE_INFINITY;for(let e=r+0;e<s;e++){const t=i.readPoint2D(2*e);-1===a.compare(t)&&(o=e,a.setCoordsPoint2D(t))}return o}applyTransformationToPath(e,i){if(i>=this.getPathCount()&&t.throwInvalidArgumentException("apply_transformation"),this.isEmpty())return;if(e.isIdentity())return;const s=this.m_vertexAttributes.get(0);if(!(i<0?this.hasNonLinearSegments():this.hasNonLinearSegmentsPath(i))){let t,n;return i<0?(t=0,n=this.m_pointCount):(t=this.getPathStart(i),n=this.getPathEnd(i)),s.applyTransformation(e,2*t,n-t),void this.notifyModifiedFlags(2001)}const r=new this.m_segmentBufferCTor,o=this.getPathCount();let a=i<0?0:i;do{const t=this.getPathStart(a),o=this.getPathEnd(a),l=this.isClosedPath(a),c=s.readPoint2D(2*t);if(!this.hasNonLinearSegmentsPath(a)){s.applyTransformation(e,2*t,o-t);continue}const h=n.Point2D.getNAN();for(let i=t;i<o;++i){if(1!=(31&this.m_curveData.m_segmentFlags.read(i))){const n=l&&i+1===o;n&&s.writePoint2D(2*t,c),this.getSegmentBuffer(i,r,!0),r.get().applyTransformation(e);const a=this.m_curveData.m_segmentParamIndex.read(i);r.get().writeInBufferStream(this.m_curveData.m_segmentParams,a),s.writePoint2D(2*i,r.get().getStartXY()),n&&s.writePoint2D(2*t,r.get().getEndXY());continue}const n=2*i;s.queryPoint2D(n,h),e.transformInPlace(h),s.writePoint2D(n,h)}if(a===i)break}while(++a<o);this.notifyModifiedFlags(2001)}calculateSubLength2D(e,i,n,s){const r=this.getPathStart(e)+i,o=this.getPathStart(n)+s;(o<r||r<0||o>this.getPointCount()-1)&&t.throwInvalidCallException("");const a=this.querySegmentIterator();let l=0;a.resetToVertex(r,e);do{for(;a.hasNextSegment();){const e=a.nextSegment();if(a.getStartPointIndex()===o)break;l+=e.calculateLength2D()}if(a.getStartPointIndex()===o)break}while(a.nextPath());return l}calculatePathSubLength2D(e,i,n){const s=this.getPathStart(e)+i,r=this.getPathStart(e)+n;(s<0||r>this.getPointCount()-1)&&t.throwInvalidCallException("");const o=this.querySegmentIterator();if(s>r&&(this.isClosedPath(e)||t.throwInvalidArgumentException("cannot iterate across an open path"),o.setCirculator(!0)),s===r)return 0;let a=0,l=0;o.resetToVertex(s,e);do{l+=a,a=o.nextSegment().calculateLength2D()}while(o.getStartPointIndex()!==r);return l}calculateEnvelope2D(e){return this.updateXYImpl(e)}updateXYImpl(e){const t=super.updateXYImpl(e);if(this.hasNonLinearSegments()){const i=s.Envelope2D.constructEmpty(),n=this.querySegmentIterator();for(;n.nextPath();)for(;n.hasNextSegment();){const s=n.nextCurve();if(!s)break;e?s.queryEnvelope(i):s.queryLooseEnvelope(i),t.mergeEnvelope2D(i)}}return t}notifyModifiedAllImpl(){null!==this.m_paths&&this.m_paths.size()?this.m_pointCount=this.m_paths.read(this.m_paths.size()-1):this.m_pointCount=0}setDirtyOGCFlags(e){this.setDirtyFlagProtected(16,e)}hasDirtyOGCStartFlags(){return this.hasDirtyFlag(16)}setDirtyRingAreas2D(e){this.setDirtyFlagProtected(1024,e)}hasDirtyRingAreas2D(){return this.hasDirtyFlag(1024)}static isNonLinearSegmentFlag(e){return!(1&e)}addAndExplicitlyOpenAllPaths(e,i){this===e&&t.throwInvalidArgumentException("Multi_path_impl::add");let n=this.getPathCount();for(let t=0,s=e.getPathCount();t<s;t++)this.addPath(e,t,!i),this.openPathAndDuplicateStartVertex(n),n++}getSegmentFlags(e){return null!==this.m_curveData&&null!==this.m_curveData.m_segmentFlags?this.m_curveData.m_segmentFlags.read(e):1}getSegmentBuffer(e,i,n){const s=this.getPathIndexFromPointIndex(e),r=e-this.getPathStart(s);r>=this.getSegmentCountPath(s)&&t.throwInvalidArgumentException("getSegmentBuffer"),this.getSegmentFromPath(s,r,i,n)}getSegmentTypeFromPath(e,i){const n=this.getPathStart(e)+i,s=this.getSegmentFlagsStreamRef();let r=1;switch(s&&(r=31&s.read(n)),r){case 1:return t.GeometryType.enumLine;case 2:return t.GeometryType.enumBezier;case 4:return t.GeometryType.enumEllipticArc;case 8:return t.GeometryType.enumRationalBezier2;case 16:return t.GeometryType.enumBezier2;default:t.throwInternalErrorException("")}}ensureXYMonotoneSegments(){if(!this.m_curveData)return!1;let e=!1;for(let i=0,s=this.getPathCount();i<s;i++){const s=this.getPathStart(i),r=this.getPathEnd(i),o=r-s;for(let i=s;i<r;i++){const r=31&this.m_curveData.m_segmentFlags.read(i);if(1===r)continue;2!==r&&t.throwNotImplementedException("ensure_xy_monotone_segments");const a=(i-s+1)%o+s,l=this.m_curveData.m_segmentParamIndex.read(i),c=n.makeObjectArray(n.Point2D,4);c[0]=this.getXY(i),c[3]=this.getXY(a),c[1].x=this.m_curveData.m_segmentParams.read(l),c[1].y=this.m_curveData.m_segmentParams.read(l+1),c[2].x=this.m_curveData.m_segmentParams.read(l+2),c[2].y=this.m_curveData.m_segmentParams.read(l+3),b(c)&&(e=!0,this.m_curveData.m_segmentParams.write(l,c[1].x),this.m_curveData.m_segmentParams.write(l+1,c[1].y),this.m_curveData.m_segmentParams.write(l+2,c[2].x),this.m_curveData.m_segmentParams.write(l+3,c[2].y))}}return e&&this.notifyModifiedFlags(2001),e}buildRasterizedGeometryAccelerator(e,t){return!1}buildQuadTreeAccelerator(e){if(this.m_accelerators||(this.m_accelerators=new ce),null!==this.m_accelerators.getQuadTree())return!0;this.ensureUniqueAccelerators(),this.m_accelerators.setQuadTree(null);const t=i.buildQuadTree(this);return this.m_accelerators.setQuadTree(t),!0}buildQuadTreeForPathsAccelerator(e){if(this.m_accelerators||(this.m_accelerators=new ce),null!==this.m_accelerators.getQuadTreeForPaths())return!0;this.ensureUniqueAccelerators(),this.m_accelerators.setQuadTreeForPaths(null);const t=i.buildQuadTreeForPaths(this);return this.m_accelerators.setQuadTreeForPaths(t),!0}updateCurveCounter(e){this.modifyCurveCounter(e-this.getCurveCount())}removeAllCurvesFromGlobalCounter(){this.m_curveData&&(_e.st_totalCurveCount-=this.m_curveData.m_curveCount,this.m_curveData.m_curveCount=0,this.m_curveData.m_bezierCount=0,this.m_curveData.m_arcCount=0,this.m_curveData.m_bezier2Count=0,this.m_curveData.m_rbezier2Count=0,this.m_curveData.m_curveParamWritePoint=0)}modifyCurveCounter(e){e&&(this.m_curveData||(this.m_curveData=new ge),_e.st_totalCurveCount+=e,this.m_curveData.m_curveCount+=e)}getCurveCount(){return this.m_curveData?this.m_curveData.m_curveCount:0}incCurveType(e,t){this.m_curveData||(this.m_curveData=new ge),2&e?this.m_curveData.m_bezierCount+=t:4&e?this.m_curveData.m_arcCount+=t:8&e?this.m_curveData.m_rbezier2Count+=t:16&e&&(this.m_curveData.m_bezier2Count+=t)}getCurveWritePoint(){return null!==this.m_curveData?this.m_curveData.m_curveParamWritePoint:0}initSegmentData(e){null===this.m_curveData&&(this.m_curveData=new ge);const t=this.m_reservedPointCount>0?this.m_reservedPointCount:this.m_pointCount;null===this.m_curveData.m_segmentParamIndex&&(this.m_curveData.m_segmentFlags=i.createByteStream(t,1),this.m_curveData.m_segmentParamIndex=i.createIndexStream(t,-1));const n=this.m_curveData.m_curveParamWritePoint+e;null===this.m_curveData.m_segmentParams?this.m_curveData.m_segmentParams=i.createDoubleStream(n):n!==this.m_curveData.m_segmentParams.size()&&this.m_curveData.m_segmentParams.resize(n,0),this.m_curveData.m_segmentFlags.size()<t&&(this.m_curveData.m_segmentFlags.resize(t,1),this.m_curveData.m_segmentParamIndex.resize(t,-1))}updateCurveWritePoint(e){null===this.m_curveData&&(this.m_curveData=new ge),this.m_curveData.m_curveParamWritePoint=e}updateOGCFlagsHelper(){const e=this.getPathCount();if(0===e)return;const t=this.m_pathFlags;let i=0;for(let s=0;s<e;s++){const e=this.m_cachedRingAreas2D.read(s);0===i&&(i=n.sign(e)),e*i>0||0===i?t.setBits(s,8):t.clearBits(s,8)}}updateOGCFlagsProtected(){this.hasDirtyFlag(16)&&(this.updateRingAreas2DProtected(),this.updateOGCFlagsHelper(),this.setDirtyFlagProtected(16,!1))}replaceSegment(e,i,n){(e<0||e>=this.getPointCount())&&t.throwInvalidArgumentException("Multi_path_impl.replace_segment"),t.geometryReleaseAssert(i.isCurve());const s=this.getPathIndexFromPointIndex(e),r=this.getPathStart(s),o=(e-r+1)%this.getPathSize(s)+r;{const n=this.getXY(e),s=this.getXY(o),r=!n.isEqualPoint2D(i.getStartXY())||!s.isEqualPoint2D(i.getEndXY());t.geometryReleaseAssert(!r)}this.replaceSegmentImpl(e,o,i,n)}replaceSegmentImpl(e,s,r,o){const a=r.getDescription();this.mergeVertexDescription(a);const l=n.makePrimitiveArray(32,Number.NaN),c=new i.Point({vd:a,attribBuffer:l,initDefaultValues:!1}),h=null===this.m_curveData?1:31&this.m_curveData.m_segmentFlags.read(e),u=ue(h),m=he(r);let d,p=!1;u>=m?(t.geometryReleaseAssert(null!==this.m_curveData),p=!0,d=this.m_curveData.m_segmentParamIndex.read(e)):(this.initSegmentData(m),p=!1,d=this.m_curveData.m_curveParamWritePoint);const g=r.getGeometryType(),_=ge.toSegType(g);o||(r.queryStart(c),this.setPointByValNoCurves(e,c),r.queryEnd(c),this.setPointByValNoCurves(s,c)),this.m_curveData.m_segmentParamIndex.write(e,1!==_?d:-1),this.m_curveData.m_segmentFlags.write(e,_),1!==_&&r.writeInBufferStream(this.m_curveData.m_segmentParams,d),p||(this.m_curveData.m_curveParamWritePoint+=m),h!==_&&(this.incCurveType(h,-1),this.incCurveType(_,1),this.modifyCurveCounter(1===h?1:-1))}setAttributeImpl(e,i,n){if(this.addAttribute(e),!this.isEmpty())if(this.hasNonLinearSegments()&&0===e){(i<0||i>1)&&t.throwInvalidArgumentException("");const e=new r.Transformation2D,s=0===i?n:0,o=0===i?0:1;e.setShiftCoords(s,o),0===i?e.xx=0:e.yy=0,this.applyTransformation(e)}else super.setAttributeImpl(e,i,n)}}_e.st_totalCurveCount=0;class fe{constructor(e,t){this.m_segIter=null,this.m_quadTree=null,this.m_qtIter=null,this.m_extentOfInterest=new s.Envelope2D(t),this.m_bfirst=!0,this.m_prevIndex=-100,this.m_parent=e}nextSegment(){return this.m_bfirst&&this.prepare_(),this.m_quadTree?this.nextSegmentQt():this.nextSegmentNoQt()}getPathIndex(){return this.m_segIter.getPathIndex()}getStartPointIndex(){return this.m_segIter.getStartPointIndex()}getEndPointIndex(){return this.m_segIter.getEndPointIndex()}isClosingSegment(){return this.m_segIter.isClosingSegment()}isPathClosed(){return this.m_segIter.isPathClosed()}prepare_(){const e=this.m_parent.getAccelerators();e&&(this.m_quadTree=e.getQuadTree(),this.m_quadTree&&(this.m_qtIter=this.m_quadTree.getSortedIterator(this.m_extentOfInterest,0))),this.m_segIter=this.m_parent.querySegmentIterator()}nextSegmentQt(){this.m_bfirst=!1;const e=this.m_qtIter.next();if(-1===e)return null;const t=this.m_quadTree.getElement(e);return(t!==this.m_prevIndex+1||this.m_segIter.isLastSegmentInPath())&&(this.m_segIter.resetToVertex(t,this.m_segIter.getPathIndex()),this.m_prevIndex=t),this.m_segIter.nextSegment()}nextSegmentNoQt(){for(;;){if(!this.m_bfirst&&this.m_segIter.hasNextSegment()){const e=this.m_segIter.nextSegment(),t=s.Envelope2D.constructEmpty();if(e.queryLooseEnvelope(t),!t.isIntersecting(this.m_extentOfInterest))continue;return e}if(this.m_bfirst=!1,!this.m_segIter.nextPath())return null}}}class ye extends _e{constructor(e){e?e.vd?(super({vd:e.vd,bPolygon:!1}),this.m_segmentBufferCTor=Mr):e.copy?(super({vd:e.copy.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=Mr,e.copy.copyTo(this)):e.move?(super({move:e.move}),this.m_segmentBufferCTor=Mr):e.start?(super({vd:e.start.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=Mr,this.startPathPoint(e.start),this.lineToPoint(e.end)):e.path?(super({bPolygon:!1}),this.m_segmentBufferCTor=Mr,this.addPathPoint2D(e.path,e.pointCount,e.bForward)):t.throwInternalErrorException("bad constructor arg"):(super({bPolygon:!1}),this.m_segmentBufferCTor=Mr)}getBoundary(){return ve(this)}assignCopy(e){return this!==e&&e.copyTo(this),this}assignMove(e){return e.copyTo(this),this}getGeometryType(){return ye.type}getDimension(){return 1}createInstance(){return new ye({vd:this.getDescription()})}equals(e,t){return this.equalsBase(e,t)}}ye.type=t.GeometryType.enumPolyline;var xe=t.GeometryType;function ve(e,n){const s=e.getGeometryType();if(s===xe.enumPolygon){const t=new ye({vd:e.getDescription()});return e.isEmpty()||e.copyToUnchecked(t),t}if(s===xe.enumPolyline)return Pe(e.getImpl(),0,!1).boundary;if(s===xe.enumEnvelope){const t=new ye({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(t.isSegment(s)){const t=new d({vd:e.getDescription()});if(!e.isEmpty()&&!e.isClosed()){const n=new i.Point;t.reserve(2),e.queryStart(n),t.add(n),e.queryEnd(n),t.add(n)}return t}if(s===xe.enumGeometryCollection){const t=e;let i=null;for(let s=0,r=t.getGeometryCount();s<r;s++){const r=ve(t.getGeometry(s),n);if(null!==r){null===i&&(i=e.createInstance());const t=r;i.addGeometry(t)}}return i}if(t.isPoint(s))return new i.Point({vd:e.getDescription()});t.throwNotImplementedException("")}function Pe(e,t,s){const r=!1,o=e;let a=null;if(s||(a=new d({vd:o.getDescription()})),!o.isEmpty()){const e=new i.AttributeStreamOfInt32(0);for(let t=0,i=o.getPathCount();t<i;t++)if(o.getPathSize(t)>0&&!o.isClosedPathInXYPlane(t)){const i=o.getPathStart(t);e.add(i);const n=o.getPathEnd(t)-1;e.add(n)}if(e.size()>0){const t=new i.BucketSort,r=o.getAttributeStreamRef(0),l={userSort(e,t,i){const s=n.Point2D.getNAN(),o=n.Point2D.getNAN();i.sort(e,t,((e,t)=>(r.queryPoint2D(2*e,s),r.queryPoint2D(2*t,o),s.compare(o))))},getValue:e=>r.read(2*e+1)};t.sort(e,0,e.size(),l);let c=r.readPoint2D(2*e.read(0)),h=0,u=1;const m=new i.Point;for(let t=1,i=e.size();t<i;t++){const i=r.readPoint2D(2*e.read(t));if(i.isEqualPoint2D(c))e.read(h)>e.read(t)?(e.write(h,n.indexTypeMax()),h=t):e.write(t,n.indexTypeMax()),u++;else{if(1&u){if(s)return{bNotEmpty:!0,boundary:new d({})}}else e.write(h,n.indexTypeMax());c=i,h=t,u=1}}if(1&u){if(s)return{bNotEmpty:!0,boundary:new d({})}}else e.write(h,n.indexTypeMax());if(!s){e.sort(0,e.size());for(let t=0,i=e.size();t<i&&e.read(t)!==n.indexTypeMax();t++)o.getPointByVal(e.read(t),m),a.add(m)}}}return s?{bNotEmpty:r,boundary:new d({})}:{bNotEmpty:r,boundary:a}}function be(e,i,s,r){const o=4*n.doubleEps()*(Math.abs(i.vmin)+Math.abs(i.vmax)),a=n.doubleEps();if(1===e.getMaxDerivative()){t.geometryReleaseAssert(s>0);const a=we(e,0,i,n.doubleEps(),o);return r[0]=a.root,a.cRoots}let l,c=[];const h=new n.Envelope1D(i.vmin-o,i.vmax+o);c.push(new n.Point2D(h.vmin,h.vmax));let u=0;for(let t=e.getMaxDerivative()-1;t>=0;t--){l=c,c=[];for(let h=0,m=l.length;h<m;h++){if(l[h][0]<l[h][1]){let m,d,p;if(t===e.getMaxDerivative()-1?({root:m,funcAtRoot:d,cRoots:p}=we(e,t,n.Envelope1D.construct(l[h][0],l[h][1]),a,.5*o)):({root:m,funcAtRoot:d,cRoots:p}=Te(e,t,n.Envelope1D.construct(l[h][0],l[h][1]),0,.5*o)),1===p){if(0===t)u<s&&(l[h][0]<=i.vmin&&l[h][1]>=i.vmin&&m!==i.vmin&&0===e.getValue(0,i.vmin)&&(m=i.vmin),l[h][0]<=i.vmax&&l[h][1]>=i.vmax&&m!==i.vmax&&0===e.getValue(0,i.vmax)&&(m=i.vmax),r[u]=i.snapClip(m),u>0?r[u]-r[u-1]>o&&u++:u++);else{const e=n.Point2D.getNAN();e[0]=l[h][0],e[1]=m,c.push(e);const t=n.Point2D.getNAN();t[0]=m,t[1]=l[h][1],c.push(t)}continue}}c.push(l[h])}}return u}function Ee(e,t,i,s,r,o){const a=n.makeObjectArray(n.ECoordinate,2),l=Ae(new n.ECoordinate(e),new n.ECoordinate(t),new n.ECoordinate(i),s,r,a);return o[0]=a[0].value(),o[1]=a[1].value(),l}function Se(e,t,i,s,r,o,a){const l=n.makeObjectArray(n.ECoordinate,3),c=Me(new n.ECoordinate(e),new n.ECoordinate(t),new n.ECoordinate(i),new n.ECoordinate(s),r,o,l);return a[0]=l[0].value(),a[1]=l[1].value(),a[2]=l[2].value(),c}function Ce(e,t,i,s,r,o,a,l){return function(e,t,i,s,r,o,a,l){const c=n.makePrimitiveArray(i*i,Number.NaN);c.fill(0),n.memcpy(l,s,0,0,i);const h=n.makePrimitiveArray(i,Number.NaN),u=n.makePrimitiveArray(i,Number.NaN),m=n.makePrimitiveArray(i,Number.NaN);let d=e(l,i,t),p=0;for(p=0;p<100;p++){const s=d;for(let e=0;e<i;++e)u[e]=l[e];if(p%i===0){c.fill(0);for(let e=0;e<i;e++)c[e*i+e]=1}let a=0,g=0;for(let n=0;n<i;++n){for(let e=0;e<i;++e)h[e]=c[n*i+e];const s=d;d=De(e,t,l,h,r,o,i);const u=s-d;u>a&&(g=n,a=u)}for(let e=0;e<i;e++)h[e]=l[e]-u[e],m[e]=l[e]+(l[e]-u[e]);const _=e(m,i,t);if(_<s&&2*(s-2*d+_)*n.sqr(s-d-a)<n.sqr(s-_)*a){d=De(e,t,l,h,r,o,i);for(let e=0;e<i;++e)c[g*i+e]=c[(i-1)*i+e],c[(i-1)*i+e]=h[e]}if(s<=d)return e(l,i,t)}return d}(e,t,i,s,r,o,0,l)}function we(e,i,s,r,o){const a={root:0,funcAtRoot:0,cRoots:0};let l=s.vmin,c=s.vmax,h=0,u=Number.MAX_VALUE,m=e.getValue(i,l),d=e.getValue(i,c),p=0,g=0,_=0;if(m>=0&&d>=0||m<=0&&d<=0)return Math.abs(m)<Math.abs(d)?(a.funcAtRoot=m,a.root=l,a.cRoots=0===m?1:0,a):(a.funcAtRoot=d,a.root=c,a.cRoots=0===d?1:0,a);Math.abs(m)<Math.abs(d)&&(c=n.swap(l,l=c),d=n.swap(m,m=d)),h=l,p=m;let f=!0,y=0;for(;0!==d&&Math.abs(l-c)>r*Math.abs(c)+o;y++){let s=y>64;if(!s){g=m!==p&&d!==p?l*d*p/((m-d)*(m-p))+c*m*p/((d-m)*(d-p))+h*m*d/((p-m)*(p-d)):c-d*(c-l)/(d-m);const e=(3*l+c)/4;if(s=!(g>e&&g<c||g>c&&g<e),!s){const e=r*Math.abs(c)+o;if(f){const t=Math.abs(c-h);s=Math.abs(g-c)>=.5*t||t<e}else{const t=Math.abs(h-u);s=Math.abs(g-c)>=.5*t||t<e}}}if(s?(g=(l+c)/2,f=!0):f=!1,_=e.getValue(i,g),0===_)return a.root=g,a.funcAtRoot=_,a.cRoots=1,a;if(!s){const t=l-g,s=g-c;if(Math.abs(t)>10*Math.abs(s)){let t=c+3*s;for(let s=0;s<2;s++){const s=e.getValue(i,t);n.sign(m)*n.sign(s)>0?(l=t,m=s):t=n.lerp(l,c,.75)}}else if(Math.abs(s)>10*Math.abs(t)){let s=l-3*t;for(let t=0;t<2;++t){const t=e.getValue(i,s);n.sign(d)*n.sign(t)>0?(c=s,d=t):s=n.lerp(l,c,.25)}}}u=h,h=c,p=d,n.sign(m)*n.sign(_)<0?(c=g,d=_):(l=g,m=_),Math.abs(m)<Math.abs(d)&&(c=n.swap(l,l=c),d=n.swap(m,m=d)),128===y&&t.throwInternalErrorException("Root_finder iterations exceeded")}return a.root=c,a.funcAtRoot=d,a.cRoots=1,a}function Te(e,i,s,r,o){const a={root:0,funcAtRoot:0,cRoots:0};let l=s.vmin,c=e.getValue(i,l),h=s.vmax,u=e.getValue(i,h);if(c>=0&&u>=0||c<=0&&u<=0)return Math.abs(c)<Math.abs(u)?(a.funcAtRoot=c,a.root=l,a.cRoots=0===c?1:0,a):(a.funcAtRoot=u,a.root=h,a.cRoots=0===u?1:0,a);u<0&&(u=n.swap(c,c=u),h=n.swap(l,l=h));let m=.5*(l+h),d=Math.abs(h-l),p=d,g=e.getValue(i,m),_=e.getValue(i+1,m),f=4,y=1,x=0,v=0,P=1,b=0;for(;++b<100;){let t;b>32||0===_||2===P&&x>1||1===P&&f<4?(P=1,y>1&&y--):(P=2,v>1&&Math.abs(2*g)>Math.abs(d*_)&&y++),d=p;let n=!1;if(1===P)do{if(v>2){const e=16*Math.abs(d);if(.5*Math.abs(l-h)>e){const i=Math.min(l,h),n=Math.max(l,h);if(m===i){t=m,m=i+e,p=m-t;break}if(m===n){t=m,m=n-e,p=m-t;break}}}p=.5*(h-l),t=m,m=l+p,n=l===m||h===m}while(0);else for(;;){p=y*g/_,t=m,m-=p,n=m===t;const e=Math.min(l,h),i=Math.max(l,h);if(m<e){if(y>1){m=t,y--;continue}p=t-e,m=e}else if(m>i){if(y>1){m=t,y--;continue}p=t-i,m=i}break}if(n||Math.abs(p)<o){t!==m&&(g=e.getValue(i,m));break}g=e.getValue(i,m),_=e.getValue(i+1,m);const s=l,r=h;g<0?(c=g,l=m):(u=g,h=m),2===P&&(l===s&&h===r||v>1&&Math.abs(p)>=.5001*Math.abs(d))?x++:x=0,1===P?(f++,v=0):(f=0,v++)}return 100===b&&t.throwInternalErrorException("Root_finder iterations exceeded"),a.root=m,a.funcAtRoot=g,a.cRoots=1,a}function De(e,t,i,s,r,o,a){const l=s.slice(0,a);let c=0;for(let e=0;e<a;e++)c+=s[e]*s[e];if(c=Math.sqrt(c),c>0)for(let e=0;e<a;e++)l[e]/=c;let h=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY;{const e=n.makePrimitiveArray(a,0);for(let t=0;t<a;t++)e[t]=t;e.sort(((e,t)=>{const i=Math.abs(l[e]),n=Math.abs(l[t]);return i<n?-1:i>n?1:0}));for(let t=0;t<a;t++){const s=e[t];if(0===l[s])continue;let a=(r[s]-i[s])/l[s],c=(o[s]-i[s])/l[s];c<a&&(c=n.swap(a,a=c)),a>h&&(h=a),c<u&&(u=c)}}let m=0;const d=(Math.abs(h)+Math.abs(u))*n.doubleEps()*100,p=n.makePrimitiveArray(a,Number.NaN),g=l.slice();function _(n,s){for(let e=0,t=a;e<t;e++)p[e]=i[e]+n*g[e];return e(p,a,t)}d>0&&(m=function(e,t,i,s,r,o){return function(e,t,i,s,r,o){const a=n.goldenRatio();let l=0,c=e(l,t),h=i,u=r,m=e(h,t),d=e(u,t);c>m&&(c=m,l=h),c>d&&(c=d,l=u);let p=h,g=u,_=m,f=d;_>f&&(_=n.swap(f,f=_),g=n.swap(p,p=g));let y=l-p,x=p-g;const v=.5*Math.min(o,u-h),P=2*v;let b,E=0;for(b=0;b<100&&!(u-h<=P);++b){const i=h+.5*(u-h);let n=E>0;if(!n&&Math.abs(x)<=v&&(n=!0,E=3),!n){const e=l-p,t=l-g,i=e*(c-f);let s=t*(c-_),r=t*s-e*i;s=2*(s-i),s>0&&(r=-r),s=Math.abs(s),0===s||Math.abs(r)>=Math.abs(s*x/2)||r<=s*(h-l)||r>=s*(u-l)?(n=!0,E=3):(x=y,y=r/s)}n&&(x=l>=i?h-l:u-l,y=a*x,E--);let s=l+y;s<h+v?s=h+v:s>u-v&&(s=u-v);const r=e(s,t);r<c?(s>=l?(h=l,m=c):(u=l,d=c),g=p,p=l,l=s,f=_,_=c,c=r):(s<l?(h=s,m=r):(u=s,d=r),r<=_||p===l?(g=p,p=s,f=_,_=r):(r<=f||g===l||g===p)&&(g=s,f=r))}return l}(e,null,i,0,r,o)}(_,0,h,0,u,d));const f=_(m);for(let e=0,t=a;e<t;e++)i[e]=n.snap(p[e],r[e],o[e]);return f}function Ie(e,t,i,n){return e.isZero()?t.isZero()?-1:0:(n.setE(t.clone().negateThis().divThisE(e)),i.containsCoordinate(n.value())?1:0)}function Ae(e,t,i,s,r,o){if(0===e.value())return r?(o[0].set(1),s.containsCoordinate(o[0].value())?1:0):Ie(t,i,s,o[0]);if(r){let t=2;return o[0].set(1),o[1].setE(i).divThisE(e),o[1].eq(o[0])&&(o[1].set(1),t=1),s.containsCoordinate(o[1].value())||(t=1),s.containsCoordinate(o[0].value())||(t--,o[0].setE(o[1])),2===t&&o[0].value()>o[1].value()&&(o[1]=n.swap(o[0],o[0]=o[1])),t}const a=t.clone().sqrThis().subThisE(e.clone().mulThisE(i).mulThisE(n.s_four));if(a.lt(n.s_zero))return 0;const l=new n.ECoordinate(t.value()>=0?1:-1),c=a.clone().sqrtThis(),h=new n.ECoordinate(-.5).mulThisE(t.clone().addThisE(l.clone().mulThisE(c)));let u=0;o[0].setE(h.divE(e));const m=new n.ECoordinate(o[0].value()),d=new n.ECoordinate(e.value()).mulE(m).addE(new n.ECoordinate(t.value()).mulE(m).addE(new n.ECoordinate(i.value())));return d.isZero()||Ve(o[0],e,t,i,o[0]),s.containsCoordinate(o[0].value())&&u++,0!==c.value()&&0!==h.value()?(o[u].assign(i.divE(h)),m.set(o[u].value()),d.assign(new n.ECoordinate(e.value()).mulE(m).addE(new n.ECoordinate(t.value()).mulE(m).addE(new n.ECoordinate(i.value())))),d.isZero()||Ve(o[u],e,t,i,o[u]),s.containsCoordinate(o[u].value())&&u++,2===u&&o[0].value()>o[1].value()&&(o[1]=n.swap(o[0],o[0]=o[1])),u):u}function Me(e,i,s,r,o,a,l){if(0===e.value())return Ae(i,s,r,o,a,l);if(a){let t=1;l[0].set(1);const s=l.slice(t),a=Ae(e,i.addE(e),r.negate(),o,!1,s);if(a>0){t+=a;for(let e=1;e<t;e++)l[e].eq(n.s_one)&&(l[t-1]=n.swap(l[e],l[e]=l[t-1]),t--)}const c=l.slice(0,t);c.sort(((e,t)=>e.value()<t.value()?-1:e.value()>t.value()?1:0));for(let e=0;e<t;++e)l[e]=c[e];return t}return function(e,i,s,r,o,a){const l=n.makeObjectArray(n.ECoordinate,3);let c=0;const h=i.negate().divThisE(e.clone().mulThis(3));o.containsCoordinate(h.value())&&(l[0].setE(h),c=1);const u=n.makeObjectArray(n.ECoordinate,2),m=Ae(e.mul(3),i.mul(2),s,o,!1,u);if(m<0)return r.isZero()?-1:0;for(let e=0;e<m;e++)o.containsCoordinate(u[e].value())&&l[c++].setE(u[e]);n.sortRange(l,0,c,((e,t)=>e.value()<t.value()?-1:e.value()>t.value()?1:0));const d=n.makeObjectArray(n.ECoordinate,5);d[0].set(o.vmin);for(let e=0;e<c;e++)d[1+e].setE(l[e]);d[1+c].set(o.vmax);const p=c+2;let g=1,_=0;{const t=d[0].clone();if(e.clone().mulThisE(t).addThisE(i).mulThisE(t).addThisE(s).mulThisE(t).addThisE(r).isZero()){const n=Re(e,i,s,r);t.setError(n.estimateError(t.value())),a[_]=t,_++,g++}}for(let n=g;n<p;n++){const l=d[n].clone(),c=e.clone().mulThisE(l).addThisE(i).mulThisE(l).addThisE(s).mulThisE(l).addThisE(r).isZero();if(c||!d[n].eq(d[n-1])){if(c||(f=e,y=i,x=s,v=r,P=l,Ge(d[n-1].value(),d[n].value(),d[n-1].clone().addThisE(d[n]).divThisByPower2(2).value(),Re(f,y,x,v),P,!1))){if(_>0&&l.eq(a[_-1]))continue;if(_>=3&&t.throwInternalErrorException("cubic_polynomial_solver_too_many_roots"),c){const t=Re(e,i,s,r);l.setError(t.estimateError(l.value()))}a[_]=l,_++}if(d[n].value()===o.vmax)break;c&&n++}}var f,y,x,v,P;return _}(e,i,s,r,o,l)}function Ne(e,i,s,r,o,a){return(a<i||i<0)&&t.throwInvalidArgumentException("nth_degree_real_roots"),function(e,t,i,s,r){const o=new Oe(e,t,i,n.doubleEps());let a=0;if(2===o.truePower)a=Ae(e[2],e[1],e[0],i,s,r);else if(1===o.truePower)a=Ie(e[1],e[0],i,r[0]);else{if(0===o.truePower)return e[0].value()?0:-1;{const e=[];e.length=t,a=be(o,i,t,e);for(let t=0;t<a;t++)r[t].set(e[t])}}for(let e=0;e<a;e++)r[e].setError(o.getError(r[e].value()));return a}(e,i,s,r,o)}function Re(e,t,i,n){return{coef0:e.clone(),coef1:t.clone(),coef2:i.clone(),coef3:n.clone(),calcF(e){return this.coef0.clone().mulThis(e).addThisE(this.coef1).mulThis(e).addThisE(this.coef2).mulThis(e).addThisE(this.coef3)},calcDF(e){return this.coef0.clone().mulThis(3).mulThis(e).addThisE(this.coef1.clone().mulThisByPower2(2)).mulThis(e).addThisE(this.coef2)},estimateError(e){const t=Math.abs(e),i=((this.coef0.eps()*t+this.coef1.eps())*t+this.coef2.eps())*t+this.coef3.eps()+this.calcF(e).eps(),n=this.coef0.clone().mulThis(e).mulThis(3).addThisE(this.coef1.clone().mulThis(2)).mulThis(e).addThisE(this.coef2);if(n.isZero()){const t=this.coef0.clone().mulThis(e).mulThis(6).addThisE(this.coef1.clone().mulThis(2));if(t.isZero()){const e=this.coef0.clone().mulThis(6);return Math.pow(6*i/Math.abs(e.value()),1/3)}return Math.sqrt(2*i/Math.abs(t.value()))}return i/Math.abs(n.value())}}}class Oe{updateCoefs(e){if(this.lastDeriv1===e)return this.curCoefs=this.derivCoefs1,void(this.lastUsed=1);if(this.lastDeriv2===e)return this.curCoefs=this.derivCoefs2,void(this.lastUsed=2);let t;1===this.lastUsed?(t=this.derivCoefs2,this.lastDeriv2=e,this.lastUsed=2):(t=this.derivCoefs1,this.lastDeriv1=e,this.lastUsed=1),t.length=0;for(let i=0,n=this.truePower-e;i<=n;++i){t.push(this.coefs[i+e].clone());let n=i+e,s=n--;for(let t=1;t<e;t++)s*=n--;t[i].mulThis(s)}this.curCoefs=t}constructor(e,t,i,n){this.derivCoefs1=[],this.derivCoefs2=[],this.lastDeriv1=-1,this.lastDeriv2=-1,this.lastUsed=-1,this.curCoefs=null,this.coefs=e,this.power=t,this.truePower=0;for(let e=t;e>=1;e--)if(0!==this.coefs[e].value()){this.truePower=e;break}}getMaxDerivative(){return this.truePower+1}getValue(e,t){let i=this.coefs;0===e?i=this.coefs:(this.updateCoefs(e),i=this.curCoefs);const s=new n.KahanSummator(0);let r=1;for(let n=0,o=this.truePower-e;n<=o;++n)s.pe(r*i[n].value()),r*=t;return s.getResult()}getError(e){const t=Math.abs(e),i=new n.KahanSummator(0),s=new n.ECoordinate(1),r=new n.ECoordinate(0);for(let e=0,n=this.power;e<=n;++e)r.addThisE(this.coefs[e].mulE(s)),i.pe(s.value()*this.coefs[e].eps()),s.mulThis(t);i.pe(r.eps());let o=1;for(let t=1;t<=this.truePower;++t){o*=t,this.updateCoefs(t);const s=new n.ECoordinate(1),r=new n.ECoordinate(0);for(let i=0,n=this.truePower-t;i<=n;++i)r.addThisE(this.curCoefs[i].mulE(s)),s.mulThis(e);if(!r.isZero())return Math.pow(o*i.getResult()/Math.abs(r.value()),1/t)}return 0}}function Ge(e,t,i,s,r,o){let a=e,l=t,c=l-a;if(!o){let i=s.calcF(e).value(),r=s.calcF(t).value();if((i>0||i>r)&&(l=n.swap(a,a=l),r=n.swap(i,i=r)),i>=0||r<=0)return!1}let h,u=!1,m=i,d=0;for(;d<100;d++){const e=s.calcF(m);if(h=s.calcDF(m),h.isZero())return!1;if(!e.value()||d>3&&e.isZero()){u=!0;break}o||(e.value()<0?a=m:l=m);const t=e.value()/h.value(),i=m-t;o||(i>=a&&i<=l||i>=l&&i<=a)&&Math.abs(t)<=.5*c?(m=i,c=Math.abs(t)):(c=Math.abs(.5*(l-a)),m=.5*(a+l))}return!!u&&(r.set(m,s.estimateError(m)),!0)}class ke{constructor(e,t,i){this.coefs=n.makeObjectArray(n.ECoordinate,3),this.coefs[0].setE(e),this.coefs[1].setE(t),this.coefs[2].setE(i)}calcF(e){const t=new n.ECoordinate(e);return this.coefs[0].mulE(t).addE(this.coefs[1]).mulE(t).addE(this.coefs[2])}calcDF(e){const t=new n.ECoordinate(e);return n.ECoordinate.st_mulByPower2(this.coefs[0],2).mulE(t).addE(this.coefs[1])}estimateError(e){const t=Math.abs(e),i=(this.coefs[0].eps()*t+this.coefs[1].eps())*t+this.coefs[2].eps()+this.calcF(e).eps(),s=new n.ECoordinate(2).mulE(this.coefs[0]).mul(e).addE(this.coefs[1]);if(s.isZero()){const e=this.coefs[0].value();return Math.sqrt(i/Math.abs(e))}return i/Math.abs(s.value())}}function Ve(e,t,i,n,s){return Ge(0,0,e.value(),new ke(t,i,n),s,!0)}var Fe=i.VertexDescription;class Le extends X{constructor(e){return void 0===e||n.isOnlyProperty(e,"vd")?(super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new n.Point2D(0,0),void(this.m_weights=[1,0,1])):(e.fromPoint&&e.weight?e={fromPoint:e.fromPoint,controlPoint1:e.controlPoint1,toPoint:e.toPoint,weight0:1,weight1:e.weight,weight2:1}:e.points&&e.weight?e={fromPoint:e.points[0],controlPoint1:e.points[1],toPoint:e.points[2],weight0:1,weight1:e.weight,weight2:1}:e.points&&e.weights&&(e={fromPoint:e.points[0],controlPoint1:e.points[1],toPoint:e.points[2],weight0:e.weights[0],weight1:e.weights[1],weight2:e.weights[2]}),e.fromPoint&&e.weight0?(super({start:e.fromPoint,end:e.toPoint}),(e.weight0<=0||e.weight1<0||e.weight2<=0)&&t.throwInvalidArgumentException("weights"),this.m_cp=e.controlPoint1.clone(),void(this.m_weights=[e.weight0,e.weight1,e.weight2])):e.copy?(super(e),this.m_cp=e.copy.m_cp.clone(),void(this.m_weights=e.copy.m_weights.slice())):e.move?(super(e),this.m_cp=e.move.m_cp.clone(),void(this.m_weights=e.move.m_weights.slice())):void t.throwNotImplementedException("unexpected constructor param"))}getBoundary(){return ve(this)}assignMove(e){return this}assignCopy(e){return e.copyTo(this),this}construct(e,t,i,n){this.dropAllAttributes(),this.setCpsAndWeights(e,t,i,1,n,1),vn(this)}constructWeights(e,t,i,n,s,r){this.dropAllAttributes(),this.setCpsAndWeights(e,t,i,n,s,r),vn(this)}constructArray(e,t){this.construct(e[0],e[1],e[2],t)}constructArrayWeights(e,t){this.dropAllAttributes(),this.setCpsAndWeightsArray(e,t),vn(this)}convertToStandardForm(){}getStandardFormWeight(){return this.m_weights[1]/Math.sqrt(this.m_weights[0]*this.m_weights[2])}getGeometryType(){return t.GeometryType.enumRationalBezier2}queryEnvelope(e){if(e instanceof s.Envelope2D){if(e.setCoords(this.getStartXY()),e.mergeNe(this.getEndXY()),e.contains(this.m_cp))return;const t=Rn(this);if(null!==t){const i=new n.Point2D;for(const n of t.specialPoints)this.queryCoord2D(n,i),e.mergeNe(i)}else{const t=[],i=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(i),bn(i,this.m_weights,t);const s=new n.Point2D;for(const i of t)this.queryCoord2D(i,s),e.mergeNe(s)}}}applyTransformation(e){if(e instanceof r.Transformation2D){const t=n.makeObjectArray(n.Point2D,3);return this.queryControlPoints(t),e.transformPoints2D(t,3,t),this.setStartXY(t[0]),this.m_cp.assign(t[1]),this.setEndXY(t[2]),void this.afterCompletedModification()}}createInstance(){return new Le({vd:this.m_description})}calculateLength2D(){return En(this,1,!1)}calculateLowerLength2D(){return n.Point2D.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return this.m_weights[1]>0?n.Point2D.distance(this.getStartXY(),this.m_cp)+n.Point2D.distance(this.getEndXY(),this.m_cp):n.Point2D.distance(this.getStartXY(),this.getEndXY())}queryCoord2D(e,t){return this.queryCoord2DExtension(e,t,!0)}queryCoord2DE(e,t){!function(e,t,i){const s=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(s);const r=[0,0,0];e.queryWeights(r),function(e,t,i,s){if(0===i.value())return void s.setE(e[0]);if(1===i.value())return void s.setE(e[2]);const r=[e[0].x.mulE(t[0]),e[1].x.mulE(t[1]),e[2].x.mulE(t[2])],o=[e[0].y.mulE(t[0]),e[1].y.mulE(t[1]),e[2].y.mulE(t[2])],a=[t[0].clone(),t[1].clone(),t[2].clone()],l=new n.ECoordinate,c=new n.ECoordinate,h=new n.ECoordinate;if(i.value()<=.5){const e=n.lerpLoE(r[0],r[1],i),t=n.lerpLoE(r[1],r[2],i);l.setE(n.lerpLoE(e,t,i));const s=n.lerpLoE(o[0],o[1],i),u=n.lerpLoE(o[1],o[2],i);c.setE(n.lerpLoE(s,u,i));const m=n.lerpLoE(a[0],a[1],i),d=n.lerpLoE(a[1],a[2],i);h.setE(n.lerpLoE(m,d,i))}else{const e=n.lerpHiE(r[0],r[1],i),t=n.lerpHiE(r[1],r[2],i);l.setE(n.lerpHiE(e,t,i));const s=n.lerpHiE(o[0],o[1],i),u=n.lerpHiE(o[1],o[2],i);c.setE(n.lerpHiE(s,u,i));const m=n.lerpHiE(a[0],a[1],i),d=n.lerpHiE(a[1],a[2],i);h.setE(n.lerpHiE(m,d,i))}l.divThisE(h),c.divThisE(h);const u=new n.Point2D(l.value(),c.value());cs([e[0].value(),e[1].value(),e[2].value()],u),s.x.set(u.x,l.eps()),s.y.set(u.y,c.eps())}([y.constructPoint2D(s[0]),y.constructPoint2D(s[1]),y.constructPoint2D(s[2])],[new n.ECoordinate(r[0]),new n.ECoordinate(r[1]),new n.ECoordinate(r[2])],t,i)}(this,e,t)}queryCoord2DExtension(e,t,i){if(i){if(e<0)return void W(new Ar({start:this.getStartXY(),end:this.getStartXY().add(this.getTangent(0).getUnitVector())}),e,t);if(e>1)return void W(new Ar({start:this.getEndXY(),end:this.getEndXY().add(this.getTangent(1).getUnitVector())}),e-1,t)}const s=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(s),is(s,this.m_weights,e,t)}getCoordX(e){const t=new n.Point2D;return this.queryCoord2DExtension(e,t,!0),t.x}getCoordY(e){const t=new n.Point2D;return this.queryCoord2DExtension(e,t,!0),t.y}cut(e,t,i){const n=new Mr;return this.queryCut(e,t,n,i),n.releaseSegment()}queryCut(e,t,i,n){const s=i.createQuadraticRationalBezier();if(this.cutBezierIgnoreAttributes(e,t,s),n)return;s.assignVertexDescription(this.m_description);const r=this.m_description.getAttributeCount();if(r>1){for(let t=1;t<r;t++){const i=this.m_description.getSemantics(t),n=Fe.getComponentCount(i);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,i,t);s.setStartAttribute(i,t,n)}}for(let e=1;e<r;e++){const i=this.m_description.getSemantics(e),n=Fe.getComponentCount(i);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,i,e);s.setEndAttribute(i,e,n)}}}}queryDerivative(e,i){!function(e,i,s){const r=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(r);const o=n.makePrimitiveArray(3,Number.NaN);e.queryWeights(o),function(e,i,s,r){s.value()<0&&s.set(0,s.eps()),s.value()>1&&s.set(1,s.eps());const o=n.makeObjectArray(y,4);(function(e,i,s,r,o){const a=[y.constructPoint2D(e[0]),y.constructPoint2D(e[1]),y.constructPoint2D(e[2])];a[2].subThisE(a[0]),a[1].subThisE(a[0]),a[0].setCoords(0,0),function(e,i,s,r,o){t.geometryReleaseAssert(!0);const a=[e[0].clone(),e[1].clone(),e[2].clone()];if(!a[0].isZero()){for(let e=1;e<3;++e)a[e].subThisE(a[0]);a[0]=y.constructCoords(0,0)}const l=Tn(a,i,0,r),c=function(e,t,i){if(i.toDouble()<=.5){const t=n.lerpLoE(e[0],e[1],i),s=n.lerpLoE(e[1],e[2],i);return n.lerpLoE(t,s,i)}{const t=n.lerpHiE(e[0],e[1],i),s=n.lerpHiE(e[1],e[2],i);return n.lerpHiE(t,s,i)}}(i,0,r),h=l.divE(c);o[0].setE(h);const u=[i[1].mulE(i[0]),i[2].mulE(i[0]).mul(.5),i[1].mulE(i[2])],m=Tn([e[1].subE(e[0]),e[2].subE(e[0]),e[2].subE(e[1])],u,0,r).mul(2),d=c.sqr(),p=m.divE(d);o[1].setE(p)}(a,[new n.ECoordinate(i[0]),new n.ECoordinate(i[1]),new n.ECoordinate(i[2])],0,r,o)})(e,i,0,s,o),r.setE(o[1])}(r,o,i,s)}(this,e,i)}cutBezierIgnoreAttributes(e,i,s){(e<0||i>1||e>i)&&t.throwInvalidArgumentException("Quadratic_rational_bezier.cut_bezier_ignore_attributes");const r=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(r);const o=[0,0,0];zn(r,this.m_weights,e,i,r,o),s.setControlPointsAndWeights(r,o)}splitBezierIgnoreAttributes(e,t,i){}getAttributeAsDbl(e,t,i){if(0===t)return 0===i?this.getCoordX(e):this.getCoordY(e);const s=this.calculateLength2D(),r=s>0?this.tToLength(e)/s:0,o=Fe.getInterpolation(t),a=this.getStartAttributeAsDbl(t,i),l=this.getEndAttributeAsDbl(t,i);return n.interpolate(o,a,l,r,Fe.getDefaultValue(t))}getClosestCoordinate(e,t){return Gn(this,e,n.Envelope1D.unit(),t,-1)}getClosestCoordinateOnInterval(e,t,i=-1){return Gn(this,e,0,!1,i)}getYMonotonicParts(e,t){return this.getMonotonicParts(e,t)}getMonotonicParts(e,i){e.length<2&&t.throwInvalidArgumentException("");const n=Pn(this);let s=0;if(2===n.specialPointsCount())return 0;t.geometryReleaseAssert(e.length>=n.specialPointsCount()-1);for(let t=1,r=n.specialPointsCount();t<r;++t)this.queryCut(n.specialPoints[t-1],n.specialPoints[t],e[s],i),s++;for(let t=0;t<s;++t)qn(e[t].get());return s}intersectionWithAxis2D(e,t,i,s){i&&(i.length=9),s&&(s.length=9);const r=new Array(3),o=n.makeObjectArray(n.ECoordinate,2),a=new n.Envelope1D(0,1);let l=0;const c=n.makeObjectArray(n.Point2D,3);if(this.queryControlPoints(c),e){if(r[0]=new n.ECoordinate(c[0].y).sub(t).mul(this.m_weights[0]),r[1]=new n.ECoordinate(c[1].y).sub(t).mul(this.m_weights[1]),r[2]=r[0].subE(r[1].mul(2)).addE(new n.ECoordinate(c[2].y).sub(t).mul(this.m_weights[2])),r[1]=r[1].subE(r[0]).mulThisByPower2(2),l=Ae(r[2],r[1],r[0],a,!1,o),i)for(let e=0;e<l;e++)i[e]=this.getCoordX(o[e].value())}else if(r[0]=new n.ECoordinate(c[0].x).sub(t).mul(this.m_weights[0]),r[1]=new n.ECoordinate(c[1].x).sub(t).mul(this.m_weights[1]),r[2]=r[0].subE(r[1].mul(2)).addE(new n.ECoordinate(c[2].x).sub(t).mul(this.m_weights[2])),r[1]=r[1].subE(r[0]).mulThisByPower2(2),l=Ae(r[2],r[1],r[0],a,!1,o),i)for(let e=0;e<l;e++)i[e]=this.getCoordY(o[e].value());if(s)for(let e=0;e<l;e++)s[e]=o[e].value();else i&&n.sortRange(i,0,l,n.standardNumericCompare);return l}intersectionOfYMonotonicWithAxisX(e,i){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?i:Number.NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;const n=[Number.NaN,Number.NaN],s=this.intersectionWithAxis2D(!0,e,n,null);return t.geometryReleaseAssert(2!==s),-1===s?i:n[0]}isCurve(){return!0}isDegenerate(e){return S(this,e)}isDegenerate3D(e,t){return!1}queryLooseEnvelope(e){if(e instanceof s.Envelope2D)return e.setCoords({pt:this.getStartXY()}),e.mergeNe(this.m_cp),void e.mergeNe(this.getEndXY())}clone(e){const t=this.createInstance();return this.copyTo(t),t}queryInterval(e,t){if(0===e){const e=s.Envelope2D.constructEmpty();this.queryEnvelope(e);const i=n.Envelope1D.constructEmpty();return 0===t?e.queryIntervalX(i):e.queryIntervalY(i),i}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){const i=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(i),zn(i,this.m_weights,e.vmin,e.vmax,i,[0,0,0]),t.setFromPoints(i,3)}changeEndPoints2D(e,t){if(e.isEqual(this.m_XStart,this.m_YStart)&&t.isEqual(this.m_XEnd,this.m_YEnd))return;const i=this.m_cp.isEqual(this.m_XStart,this.m_YStart),n=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(e),this.setEndXY(t),i?this.m_cp.setCoordsPoint2D(e):n&&this.m_cp.setCoordsPoint2D(t),this.normalizeAfterEndpointChange()}tToLength(e){return En(this,e,!0)}lengthToT(e){const i=function(e,i){const s=En(e,1,!1);if(i<=0)return i;if(i>=s)return i-s+1;const r=[0];return 1!==be(new An(e,i),n.Envelope1D.unit(),1,r)&&t.throwInternalErrorException(""),r[0]}(this,e);return i}calculateWeightedAreaCentroid2D(e){const i=function(e){const i=n.makeObjectArray(n.Point2D,3),s=[0,0,0];return e.queryControlPoints(i),e.queryWeights(s),function(e,i){const s=ss(i);if(1===s){const t=n.makeObjectArray(n.Point2D,3);qt(e,t);const i=t[2].clone(),s=t[1].clone(),r=new n.Point2D,o=i.y*s.x-i.x*s.y;return r.x=-(4*i.x+5*s.x)*o/60,r.y=-(4*i.y+5*s.y)*o/60,r}if(0===s)return new n.Point2D(0,0);t.geometryReleaseAssert(s>0);const r=e[1].sub(e[0]),o=e[2].sub(e[0]);if(s<1){const e=Math.sqrt(1-s),t=Math.sqrt(1+s),i=(r.y*o.x-r.x*o.y)*s/Math.pow(e*t,5)/12,n=Math.atan2(e,t),a=s*e*t,l=s*s,c=r.mul(2*(2+l)),h=o.mul(2*l-5),u=c.add(h).mul(a),m=o.sub(r.mul(2*l)).mul(6*n);return u.add(m).mul(i)}{const e=Math.sqrt(s-1),t=Math.sqrt(s+1),i=(r.y*o.x-r.x*o.y)*s/Math.pow(e*t,5)/12,n=Math.atanh(e/t),a=s*e*t,l=s*s,c=r.mul(4).sub(o.mul(5)),h=r.add(o).mul(2*l),u=c.add(h).mul(a),m=o.sub(r.mul(2*l)).mul(6*n);return u.add(m).mul(i)}}(i,s)}(this),s=Mn(this);return i.x+=(this.getStartX()-e.x)*s,i.y+=(this.getStartY()-e.y)*s,i}calculateWeightedCentroid2D(){const e=new n.Point2D;return this.isDegenerate(0)?(e.setCoords(0,0),e):function(e){if(0===e.m_weights[1])return!0;const t=n.Point2D.distance(e.getStartXY(),e.getEndXY()),i=e.calculateUpperLength2D();return i-t<=8*Number.EPSILON*i}(this)?(e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e):(e.assign(function(e,i,s){void 0===s&&(s=i,i=0);const r=new n.Point2D;if(i<0||s>1)return r.setNAN(),r;if(i>s&&t.throwInvalidArgumentException("calculate_sub_weighted_centroid"),i===s||e.isDegenerate(0))return r.setCoords(0,0),r;const o=Pn(e),a=Nn(e),l=a/e.calculateUpperLength2D();let c=i,h=0;for(let e=1,t=o.specialPointsCount();e<t;e++)if(i<o.specialPoints[e]){h=e-1;break}r.setCoords(0,0);for(let t=h+1,i=o.specialPointsCount();t<i;t++){const i=Math.min(o.specialPoints[t],s),n=xn(e,c,i,l,a);if(r.addThis(n),c=i,s<=o.specialPoints[t])break}return r.add(e.getStartXY().mul(e.calculateLength2D()))}(this,1)),e)}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(e){this.m_cp.setCoordsPoint2D(e),this.afterCompletedModification()}queryWeights(e){for(let t=0;t<3;++t)e[t]=this.m_weights[t]}queryCoord2DMP(e,t){const i=n.makeObjectArray(n.Point2D,3);return this.queryControlPoints(i),function(e,t,i,s){const r=i.lte(n.s_half)?n.MPValue.lerpLo:n.MPValue.lerpHi,[o,a,l]=[t.map(((t,i)=>e[i].x.mul(t))),t.map(((t,i)=>e[i].y.mul(t))),t].map((([e,t,n])=>r(r(e,t,i),r(t,n,i),i))),c=new n.Point2D(o.divThis(l).value(),a.divThis(l).value());cs(e.map((e=>e.asPoint2D())),c),s.x=n.MPValue.constructDouble(c.x),s.y=n.MPValue.constructDouble(c.y)}(i.map((e=>v.constructPoint2D(e))),this.m_weights.map((e=>n.MPValue.constructDouble(e))),n.MPValue.constructDouble(e),t)}setWeights(e){}queryControlPoints(e){e[0].assign(this.getStartXY()),e[1].assign(this.m_cp),e[2].assign(this.getEndXY())}queryControlPointsHelper(e){return this.queryControlPoints(e),3}setControlPointsAndWeights(e,t){this.setCpsAndWeightsArray(e,t),this.afterCompletedModification()}getTangent(e){const t=n.makeObjectArray(n.Point2D,3);return this.queryControlPoints(t),In(t,this.m_weights,e)}getDerivative(e){const t=n.snap(e,0,1),i=n.makeObjectArray(n.Point2D,4);return Sn(this,1,t,i),i[1]}getCurvature(e){const t=n.makeObjectArray(n.Point2D,4);Sn(this,2,e,t);const i=t[1].sqrLength();return 0===i?Number.NaN:(t[1].divThis(Math.sqrt(i)),t[1].crossProduct(t[2])/i)}isIntersecting(e,t,i){return!1}isIntersectingPoint(e,t,i){return!1}isIntersectingPoint3D(e,t,i,n,s=1){return!1}isMonotoneQuickAndDirty(){const e=n.makeObjectArray(n.Point2D,3);return this.queryControlPoints(e),Ln(e)}getMonotonicPartParams(e,i){const n=Pn(this),s=n.specialPointsCount();if(!i)return n.specialPointsCount();e<s&&t.throwInvalidArgumentException("");for(let e=0;e<s;e++)i[e]=n.specialPoints[e];return s}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=n.swap(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=n.swap(this.m_YStart,this.m_YStart=this.m_YEnd),this.m_weights[2]=n.swap(this.m_weights[0],this.m_weights[0]=this.m_weights[2]);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=n.swap(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_cachedValues=null}}isLine(){return!1}isDegenerateToLineHelper(e){const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t);const i=t[2].sub(t[0]),s=i.length();if(n.Point2D.distance(t[0],t[1])+n.Point2D.distance(t[2],t[1])-s>e)return!1;const r=e,o=t[1].clone();return o.subThis(t[0]),!(Math.abs(o.crossProduct(i))/s>r)}copyIgnoreAttributes(e){const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t);const i=[0,0,0];this.queryWeights(i),e.setControlPointsAndWeights(t,i)}calculateArea2DHelper(){return Mn(this)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)+this.m_cp.norm(1)}absNormXYZ(e){return t.geometryReleaseAssert(0),0}queryEnvelopeW(e,t){Vn(this,e,t)}setSegmentFromCoordsForStitcher(e,t){const i=[0,0,0];this.queryWeights(i),this.constructWeights(e[0],this.getControlPoint1(),e[t-1],i[0],i[1],i[2])}writeInBufferStream(e,t){const i=new Float64Array(5);return i[0]=this.m_cp.x,i[1]=this.m_cp.y,i[2]=this.m_weights[0],i[3]=this.m_weights[1],i[4]=this.m_weights[2],e.writeRangeFromArray(t,i.length,i,!0,1),t+i.length}readFromBufferStream(e,t){const i=new Float64Array(5);e.queryRange(t,i.length,i,!0,1),this.m_cp.x=i[0],this.m_cp.y=i[1],this.m_weights[0]=i[2],this.m_weights[1]=i[3],this.m_weights[2]=i[4],this.m_cachedValues=null}snapControlPoints(e){const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t);const i=n.Point2D.sqrDistance(t[1],t[0]),s=n.Point2D.sqrDistance(t[1],t[2]);let r=t[0].clone(),o=i;i>s&&(r=t[2].clone(),o=s);let a=!1;return o<=e&&0!==o&&(a=!0,this.setControlPoint1(r)),a}needsSnapControlPoints(e){if(!e)return!1;const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t);const i=n.Point2D.sqrDistance(t[1],t[0]),s=n.Point2D.sqrDistance(t[1],t[2]);t[0].clone();let r=i;return i>s&&(t[2].clone(),r=s),r<=e&&0!==r}calculateSpecialPointsForCracking(e,t){return 0}ensureXYMonotone(){return qn(this)}setCoordsForIntersector(e,t,i){!function(e,t,i,s){if(t.isEqual(e.m_XStart,e.m_YStart)&&i.isEqual(e.m_XEnd,e.m_YEnd))return;const o=!!s&&e.isMonotoneQuickAndDirty(),a=new r.Transformation2D,l=n.makeObjectArray(n.Point2D,3);l[0].setCoords(e.m_XStart,e.m_YStart),l[2].setCoords(e.m_XEnd,e.m_YEnd);const c=new n.Point2D;c.setSub(l[2],l[0]),c.leftPerpendicularThis(),l[1].setAdd(l[0],c);const h=n.makeObjectArray(n.Point2D,3);h[0].setCoordsPoint2D(t),h[2].setCoordsPoint2D(i),c.setSub(h[2],h[0]),c.leftPerpendicularThis(),h[1].setAdd(h[0],c),a.setFromTwoTriangles(l,h)?a.transformInPlace(e.m_cp):n.lerpPoint2D(t,i,.5,e.m_cp),e.changeEndPoints2D(t,i),o&&qn(e)}(this,e,t,i)}copyToImpl(e){const t=e;t.m_cp.setCoordsPoint2D(this.m_cp),t.m_weights[0]=this.m_weights[0],t.m_weights[1]=this.m_weights[1],t.m_weights[2]=this.m_weights[2],On(t,Rn(this))}reverseImpl(){this.m_weights[2]=n.swap(this.m_weights[0],this.m_weights[0]=this.m_weights[2])}equalsImpl(e){const t=e;if(!this.m_cp.equals(t.m_cp))return!1;for(let e=0;e<3;e++)if(this.m_weights[e]!==t.m_weights[e])return!1;return!0}equalsImplTol(e,t){const s=e;if(!this.m_cp.isEqualPoint2D(s.m_cp,t))return!1;const r=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(r);const o=n.makeObjectArray(n.Point2D,3);s.queryControlPoints(o);const a=[s.m_weights[0],s.m_weights[1],s.m_weights[2]];for(let e=0;e<3;e++){const n=new i.Point3D;n.setCoordsPoint2DZ(r[e].mul(this.m_weights[e]),this.m_weights[e]);const s=new i.Point3D;if(s.setCoordsPoint2DZ(o[e].mul(a[e]),a[e]),!n.isEqual(s,t))return!1}return!0}swapImpl(e){const t=e;var i;t.m_cp=n.swap(this.m_cp,this.m_cp=t.m_cp),t.m_weights=n.swap(this.m_weights,this.m_weights=t.m_weights),(i=t).m_cachedValues=n.swap(this.m_cachedValues,this.m_cachedValues=i.m_cachedValues)}afterCompletedModification(){vn(this)}intersect(e,t,i,n,s){return Cr(!1,this,e,t,i,n,s)}intersectPoint(e,i,s){return function(e,i,s,r){const o=new p;if(Vn(e,n.Envelope1D.unit(),o),o.inflate(r),!o.isIntersectingPoint2D(i))return 0;const a=Pn(e);let l=0;const c=[];let h=a.specialPoints[0];for(let n=1,s=a.specialPoints.length;n<s;++n){const s=a.specialPoints[n],r=yn(e,i,h,s);if(0===c.length)c.push(r);else if(r.t===r.tmin)t.geometryReleaseAssert(c.at(-1).d<=r.d),c.at(-1).tmax=r.tmax;else if(c.at(-1).t===c.at(-1).tmax){t.geometryReleaseAssert(c.at(-1).d>=r.d);const e=c.at(-1).tmin;c[c.length-1]=r,c.at(-1).tmin=e}else c.push(r);h=s}for(const e of c)if(e.d<=r){const t=e.t;s?(s[l]=t,l++):l++}return l}(this,e,i,s)}endPointModified(){vn(this)}clearEndPointModified(){}setCpsAndWeights(e,i,n,s,r,o){(s<=0||o<=0||r<0)&&t.throwInvalidArgumentException("weights"),(e.isNAN()||i.isNAN()||n.isNAN())&&t.throwInvalidArgumentException("NAN control points in bezier are not supported"),this.setStartXY(e),this.m_cp.assign(i),this.m_weights[0]=s,this.m_weights[1]=r,this.m_weights[2]=o,this.setEndXY(n)}setCpsAndWeightsArray(e,t){this.setCpsAndWeights(e[0],e[1],e[2],t[0],t[1],t[2])}}Le.type=t.GeometryType.enumRationalBezier2;var qe=i.VertexDescription;class He extends X{constructor(e){void 0===e||n.isOnlyProperty(e,"vd")?(super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new n.Point2D(0,0)):e.from?(super({XStart:e.from.x,YStart:e.from.y,XEnd:e.to.x,YEnd:e.to.y,...e.vd}),this.m_cp=e.cp.clone()):e.points?(super({XStart:e.points[0].x,YStart:e.points[0].y,XEnd:e.points[2].x,YEnd:e.points[2].y,...e.vd}),this.m_cp=e.points[1].clone()):e.copy?(super(e),this.m_cp=e.copy.m_cp.clone()):t.throwInternalErrorException("unexpected constructor args")}getBoundary(){return ve(this)}assignCopy(e){return this!==e&&e.copyTo(this),this}construct(e,t,i){this.setStartXY(e),this.m_cp.assign(t),this.setEndXY(i),pt(this)}constructPoints(e){this.setStartXY(e[0]),this.m_cp.assign(e[1]),this.setEndXY(e[2]),pt(this)}getGeometryType(){return t.GeometryType.enumBezier2}queryEnvelope(e){if(2!==e.m_EnvelopeType)t.throwNotImplementedException("env type not impl");else{if(e.setCoords(this.getStartXY()),e.mergeNe(this.getEndXY()),e.contains(this.m_cp))return;const t=Ct(this);if(null!==t){const i=new n.Point2D;for(const n of t.specialPoints)this.queryCoord2D(n,i),e.mergeNe(i)}else{const t=[];_t(this,t);const i=new n.Point2D;for(const n of t)this.queryCoord2D(n,i),e.mergeNe(i)}}}applyTransformation(e){if(1===e.m_TransformationType){const t=n.makeObjectArray(n.Point2D,3);return this.queryControlPoints(t),e.transformPoints2D(t,3,t),this.setStartXY(t[0]),this.m_cp.assign(t[1]),this.setEndXY(t[2]),void this.afterCompletedModification()}t.geometryReleaseAssert(0)}createInstance(){return new He({vd:this.m_description})}calculateLength2D(){return ft(this,1,!1)}calculateLowerLength2D(){return n.Point2D.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return n.Point2D.distance(this.getStartXY(),this.m_cp)+n.Point2D.distance(this.getEndXY(),this.m_cp)}queryCoord2D(e,t){this.queryCoord2DExtended(e,t,!1)}queryCoord2DExtended(e,t,i){const s=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(s),Ut(s,e,t,i)}queryCoord2DE(e,t){!function(e,t,i){const s=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(s),function(e,t,i){if(t.value()<=.5){const s=y.constructPoint2D(e[1]),r=new y;n.lerpLoPointE(2,y.constructPoint2D(e[0]),s,t,r);const o=new y;n.lerpLoPointE(2,s,y.constructPoint2D(e[2]),t,o);const a=new y;n.lerpLoPointE(2,r,o,t,a),i.setE(a)}else{const s=y.constructPoint2D(e[1]),r=new y;n.lerpHiPointE(2,y.constructPoint2D(e[0]),s,t,r);const o=new y;n.lerpHiPointE(2,s,y.constructPoint2D(e[2]),t,o);const a=new y;n.lerpHiPointE(2,r,o,t,a),i.setE(a)}}(s,t,i)}(this,e,t)}queryCoord2DMP(e,i){t.geometryReleaseAssert(!1,"bernstein polynomials not ported")}getCoordX(e){if(e<0||e>1){const t=new n.Point2D;return this.queryCoord2DExtended(e,t,!0),t.x}if(e<=.5){const t=n.lerpLo(this.getStartX(),this.m_cp.x,e),i=n.lerpLo(this.m_cp.x,this.getEndX(),e);return n.lerpLo(t,i,e)}{const t=n.lerpHi(this.getStartX(),this.m_cp.x,e),i=n.lerpHi(this.m_cp.x,this.getEndX(),e);return n.lerpHi(t,i,e)}}getCoordY(e){if(e<0||e>1){const t=new n.Point2D;return this.queryCoord2DExtended(e,t,!0),t.y}if(e<=.5){const t=n.lerpLo(this.getStartX(),this.m_cp.x,e),i=n.lerpLo(this.m_cp.x,this.getEndX(),e);return n.lerpLo(t,i,e)}{const t=n.lerpHi(this.getStartY(),this.m_cp.y,e),i=n.lerpHi(this.m_cp.y,this.getEndY(),e);return n.lerpHi(t,i,e)}}cut(e,t,i){const n=new Mr;return this.queryCut(e,t,n,i),n.releaseSegment()}queryCut(e,t,i,n){const s=i.createQuadraticBezier();if(this.cutBezierIgnoreAttributes(e,t,s),n)return;s.assignVertexDescription(this.m_description);const r=this.m_description.getAttributeCount();if(r>1){for(let t=1;t<r;t++){const i=this.m_description.getSemantics(t),n=qe.getComponentCount(i);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,i,t);s.setStartAttribute(i,t,n)}}for(let e=1;e<r;e++){const i=this.m_description.getSemantics(e),n=qe.getComponentCount(i);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,i,e);s.setEndAttribute(i,e,n)}}}}queryDerivative(e,t){!function(e,t,i){const s=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(s),function(e,t,i){t.value()<0&&t.set(0,t.eps()),t.value()>1&&t.set(1,t.eps()),i.setE(function(e,t,i){{const t=y.constructPoint2D(e[1]).subE(y.constructPoint2D(e[0])),s=new n.ECoordinate(1).subE(i),r=y.constructPoint2D(e[2]).subE(y.constructPoint2D(e[1])),o=t.mulE(s).addE(r.mulE(i));return o.mulThisE(new n.ECoordinate(2)),o}}(e,0,t))}(s,t,i)}(this,e,t)}cutBezierIgnoreAttributes(e,i,s){if((e<0||i>1||e>i)&&t.throwInvalidArgumentException("Quadratic_bezier.cut_bezier_ignore_attributes"),0===e&&1===i)return s.setStartXY(this.getStartXY()),s.m_cp.assign(this.m_cp),void s.setEndXY(this.getEndXY());const r=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(r),Ot(r,e,i,r),s.constructPoints(r)}splitBezierIgnoreAttributes(e,i,n){t.geometryReleaseAssert(0)}getAttributeAsDbl(e,t,i){if(0===t)return 0===i?this.getCoordX(e):this.getCoordY(e);const s=this.calculateLength2D(),r=s>0?this.tToLength(e)/s:0,o=qe.getInterpolation(t),a=this.getStartAttributeAsDbl(t,i),l=this.getEndAttributeAsDbl(t,i);return n.interpolate(o,a,l,r,qe.getDefaultValue(t))}getClosestCoordinate(e,t){return Tt(this,e,n.Envelope1D.unit(),t)}getClosestCoordinateOnInterval(e,t,i=-1){return Tt(this,e,t,!1)}getYMonotonicParts(e,t){return this.getMonotonicParts(e,t)}getMonotonicParts(e,i){e.length<2&&t.throwInvalidArgumentException("");const n=gt(this);let s=0;if(2===n.specialPointsCount())return 0;t.geometryReleaseAssert(e.length>=n.specialPointsCount()-1);for(let t=1,r=n.specialPointsCount();t<r;++t)this.queryCut(n.specialPoints[t-1],n.specialPoints[t],e[s],i),s++;for(let t=0;t<s;++t)Mt(e[t].get());return s}intersectionWithAxis2D(e,t,i,s){const r=n.makeObjectArray(n.ECoordinate,3),o=n.makeObjectArray(n.ECoordinate,2),a=new n.Envelope1D(0,1);let l=0;if(e){if(r[0]=new n.ECoordinate(this.getStartY()).sub(t),r[1]=new n.ECoordinate(this.m_cp.y).subE(new n.ECoordinate(this.getStartY())).mulThisByPower2(2),r[2]=new n.ECoordinate(this.getStartY()).add(this.getEndY()).subE(new n.ECoordinate(this.m_cp.y).mulThisByPower2(2)),l=Ae(r[2],r[1],r[0],a,!1,o),i)for(let e=0;e<l;e++)i[e]=this.getCoordX(o[e].value())}else if(r[0]=new n.ECoordinate(this.getStartX()).sub(t),r[1]=new n.ECoordinate(this.m_cp.x).subE(new n.ECoordinate(this.getStartX())).mulThisByPower2(2),r[2]=new n.ECoordinate(this.getStartX()).add(this.getEndX()).subE(new n.ECoordinate(this.m_cp.x).mulThisByPower2(2)),l=Ae(r[2],r[1],r[0],a,!1,o),i)for(let e=0;e<l;e++)i[e]=this.getCoordY(o[e].value());if(s)for(let e=0;e<l;e++)s[e]=o[e].value();else i&&n.numericSortRange(i,l);return l}intersectionOfYMonotonicWithAxisX(e,i){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?i:Number.NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;const n=[0,0],s=this.intersectionWithAxis2D(!0,e,n,null);return t.geometryReleaseAssert(2!==s),-1===s?i:n[0]}isCurve(){return!0}isLine(){return!1}isDegenerate(e){return S(this,e)}isDegenerate3D(e,i){return t.geometryReleaseAssert(0),!1}queryLooseEnvelope(e){if(2===e.m_EnvelopeType)return e.setCoords(this.getStartXY()),e.mergeNe(this.m_cp),void e.mergeNe(this.getEndXY());t.geometryReleaseAssert(0)}clone(e){const t=this.createInstance();return this.copyTo(t),t}queryInterval(e,t){if(0===e){const e=new s.Envelope2D;this.queryEnvelope(e);const i=new n.Envelope1D;return 0===t?e.queryIntervalX(i):e.queryIntervalY(i),i}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){const i=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(i),Ot(i,e.vmin,e.vmax,i),t.setFromPoints(i,4)}changeEndPoints2D(e,t){if(e.isEqual(this.m_XStart,this.m_YStart)&&t.isEqual(this.m_XEnd,this.m_YEnd))return;const i=this.m_cp.isEqual(this.m_XStart,this.m_YStart),n=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(e),this.setEndXY(t),i?this.m_cp.setCoordsPoint2D(e):n&&this.m_cp.setCoordsPoint2D(t),this.normalizeAfterEndpointChange()}tToLength(e){return ft(this,e,!0)}lengthToT(e){const i=function(e,i){const s=ft(e,1,!1);if(i<=0)return i;if(i>=s)return i-s+1;const r=[0];return 1!==be(new mt(e,i),n.Envelope1D.unit(),1,r)&&t.throwInternalErrorException(""),r[0]}(this,e);return i}calculateWeightedAreaCentroid2D(e){const t=n.makeObjectArray(n.Point2D,3);!function(e,t,i=!1){const s=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(s),qt(s,t,i)}(this,t);const i=t[2],s=t[1],r=new n.Point2D,o=i.y*s.x-i.x*s.y;r.x=-(4*i.x+5*s.x)*o/60,r.y=-(4*i.y+5*s.y)*o/60;const a=Et(this);return r.x+=(t[0].x-e.x)*a,r.y+=(t[0].y-e.y)*a,r}calculateWeightedCentroid2D(){const e=new n.Point2D;return this.isDegenerate(0)?(e.setCoords(0,0),e):function(e){const t=n.Point2D.distance(e.getStartXY(),e.getEndXY()),i=e.calculateUpperLength2D();return i-t<=8*Number.EPSILON*i}(this)?(e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e):(e.assign(function(e,i,s){void 0===s&&(s=i,i=0);const r=new n.Point2D;if(i<0||s>1)return r.setNAN(),r;if(i>s&&t.throwInvalidArgumentException("calculate_sub_weighted_centroid"),i===s||e.isDegenerate(0))return r.setCoords(0,0),r;const o=gt(e),a=F(e),l=Math.min(a/e.calculateUpperLength2D(),1e-7);let c=i,h=0;for(let e=1,t=o.specialPointsCount();e<t;e++)if(i<o.specialPoints[e]){h=e-1;break}r.setCoords(0,0);for(let t=h+1,i=o.specialPointsCount();t<i;t++){const i=Math.min(o.specialPoints[t],s),n=dt(e,c,i,l,a);if(r.addThis(n),c=i,s<=o.specialPoints[t])break}return r.add(e.getStartXY().mul(e.calculateLength2D()))}(this,1)),e)}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(e){this.m_cp.setCoordsPoint2D(e),this.afterCompletedModification()}queryControlPoints(e){e[0].assign(this.getStartXY()),e[1].assign(this.m_cp),e[2].assign(this.getEndXY())}queryControlPointsHelper(e){return this.queryControlPoints(e),3}setControlPoints(e){for(let i=0;i<3;i++)e[i].isNAN()&&t.throwInvalidArgumentException("NaN control points in bezier are not supported");this.m_XStart=e[0].x,this.m_YStart=e[0].y,this.m_cp.setCoordsPoint2D(e[1]),this.m_XEnd=e[2].x,this.m_YEnd=e[2].y,this.afterCompletedModification()}getTangent(e){const t=n.snap(e,0,1);let i=Pt(this,1,t);return i.isZero()&&(i=Pt(this,2,t),1===t&&i.negateThis()),i}getDerivative(e){return Pt(this,1,n.snap(e,0,1))}getCurvature(e){const t=Pt(this,1,e),i=Pt(this,2,e),n=t.sqrLength();return 0===n?Number.NaN:(t.divThis(Math.sqrt(n)),t.crossProduct(i)/n)}isIntersecting(e,t,i){return 0!==Pr(!1,this,e,t,i)}isIntersectingPoint(e,t,i){if(i&&(e.isEqualPoint2D(this.getStartXY())||e.isEqualPoint2D(this.getEndXY())))return!1;const r=new s.Envelope2D;if(this.queryLooseEnvelope(r),r.inflateCoords(t,t),!r.contains(e))return!1;const o=this.getClosestCoordinate(e,!1),a=new n.Point2D;return this.queryCoord2D(o,a),n.Point2D.distance(a,e)<=t}isIntersectingPoint3D(e,i,n,s,r=1){return t.geometryReleaseAssert(0),!1}isMonotoneQuickAndDirty(){return!1}getMonotonicPartParams(e,i){const n=gt(this),s=n.specialPointsCount();if(!i)return n.specialPointsCount();e<s&&t.throwInvalidArgumentException("");for(let e=0;e<s;e++)i[e]=n.specialPoints[e];return s}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){n.swap(this.m_XStart,this.m_XStart=this.m_XEnd),n.swap(this.m_YStart,this.m_YStart=this.m_YEnd);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=n.swap(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_cachedValues=null}}isDegenerateToLineHelper(e){const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t);const i=t[2].sub(t[0]),s=i.length();if(n.Point2D.distance(t[0],t[1])+n.Point2D.distance(t[2],t[1])-s>e)return!1;const r=e,o=t[1].clone();return o.subThis(t[0]),!(Math.abs(o.crossProduct(i))/s>r)}copyIgnoreAttributes(e){const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t),e.setControlPoints(t)}calculateArea2DHelper(){return Et(this)}absNorm(){return(e=this).getStartXY().norm(1)+e.getEndXY().norm(1)+e.m_cp.norm(1);var e}queryEnvelopeW(e,t){const i=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(i),It(i,e,t)}setSegmentFromCoordsForStitcher(e,t){this.construct(e[0],this.getControlPoint1(),e[t-1])}snapControlPoints(e){return function(e,t){const i=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(i);const s=n.Point2D.sqrDistance(i[1],i[0]),r=n.Point2D.sqrDistance(i[1],i[2]);let o=i[0].clone(),a=s;s>r&&(o=i[2].clone(),a=r);let l=!1;return a<=t&&0!==a&&(l=!0,e.setControlPoint1(o)),l}(this,e)}writeInBufferStream(e,t){const i=new Float64Array(2);return i[0]=this.m_cp.x,i[1]=this.m_cp.y,e.writeRangeFromArray(t,i.length,i,!0,1),t+i.length}readFromBufferStream(e,t){const i=new Float64Array(2);e.queryRange(t,i.length,i,!0,1),this.m_cp.x=i[0],this.m_cp.y=i[1],this.m_cachedValues=null}needsSnapControlPoints(e){return function(e,t){if(!t)return!1;const i=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(i);const s=n.Point2D.sqrDistance(i[1],i[0]),r=n.Point2D.sqrDistance(i[1],i[2]);i[0].clone();let o=s;return s>r&&(i[2].clone(),o=r),o<=t&&0!==o}(this,e)}calculateSpecialPointsForCracking(e,t){return 0}ensureXYMonotone(){return Mt(this)}setCoordsForIntersector(e,t,i){!function(e,t,i,s){if(t.isEqual(e.m_XStart,e.m_YStart)&&i.isEqual(e.m_XEnd,e.m_YEnd))return;const o=!!s&&e.isMonotoneQuickAndDirty(),a=new r.Transformation2D,l=n.makeObjectArray(n.Point2D,3);l[0].setCoords(e.m_XStart,e.m_YStart),l[2].setCoords(e.m_XEnd,e.m_YEnd);const c=new n.Point2D;c.setSub(l[2],l[0]),c.leftPerpendicularThis(),l[1].setAdd(l[0],c);const h=n.makeObjectArray(n.Point2D,3);h[0].setCoordsPoint2D(t),h[2].setCoordsPoint2D(i),c.setSub(h[2],h[0]),c.leftPerpendicularThis(),h[1].setAdd(h[0],c),a.setFromTwoTriangles(l,h)?a.transformInPlace(e.m_cp):n.lerpPoint2D(t,i,.5,e.m_cp),e.changeEndPoints2D(t,i),o&&Mt(e)}(this,e,t,i)}copyToImpl(e){const t=e;t.m_cp.setCoordsPoint2D(this.m_cp),wt(t,Ct(this))}reverseImpl(){}equalsImplTol(e,t){const i=e;return!!this.m_cp.isEqualPoint2D(i.m_cp,t)}equalsImpl(e){const t=e;return!!this.m_cp.equals(t.m_cp)}swapImpl(e){const t=e;var i;t.m_cp=n.swap(this.m_cp,this.m_cp=t.m_cp),(i=t).m_cachedValues=n.swap(this.m_cachedValues,this.m_cachedValues=i.m_cachedValues)}afterCompletedModification(){pt(this)}intersect(e,t,i,n,s){return Cr(!1,this,e,t,i,n,s)}intersectPoint(e,t,i){return function(e,t,i,s,r){const o=new p;if(function(e,t,i){const s=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(s),It(s,t,i)}(e,n.Envelope1D.unit(),o),o.inflate(r),!o.isIntersectingPoint2D(t))return 0;const a=new n.Point2D,l=Tt(e,t,n.Envelope1D.unit(),!1);return e.queryCoord2D(l,a),n.Point2D.distance(a,t)<=r?(s&&(s[0]=l),1):0}(this,e,t.length,t,i)}endPointModified(){pt(this)}clearEndPointModified(){}}He.type=t.GeometryType.enumBezier2;class Ue{constructor(e){return e.coefsT?(this.m_zeroCtor=e.zeroCtor,this.m_elements=e.coefsT.map((e=>e.clone())),t.geometryReleaseAssert(this.m_elements.length===e.power+1),void this.updatePower()):e.coef0?(this.m_zeroCtor=e.zeroCtor,void(this.m_elements=[e.coef0.clone()])):e.copy?(this.m_zeroCtor=e.copy.m_zeroCtor,void(this.m_elements=e.copy.m_elements.map((e=>e.clone())))):(this.m_zeroCtor=e.zeroCtor,void(this.m_elements=[new this.m_zeroCtor]))}construct(e,t){return this.m_elements=e.map((e=>e.clone())),this.updatePower(),this}construct0(e){return this.m_elements.length=0,this.m_elements.push(e.clone()),this.updatePower(),this}assignCopy(e){return this.m_elements=e.m_elements.map((e=>e.clone())),this.updatePower(),this}assignMove(e){return this.m_elements=e.m_elements,e.m_elements=[],this.updatePower(),this}power(){return this.m_elements.length-1}addElement(e){this.m_elements.push(e.clone())}scaleRangeToUnitInterval(e,t){const i=t;i.subThis(e);const s=this.power();for(let t=0;t<=s;t++){const r=new this.m_zeroCtor;for(let i=t;i<=s;i++){const s=this.m_elements[i];s.mulDoubleThis(n.choose(i,t));const o=e.pow(i-t);s.mulThis(o),r.addThis(s)}const o=i.pow(t);r.mulThis(o),this.m_elements[t]=r}}fmSubThis(e,i){return t.geometryReleaseAssert(0),this}addThis(e){const t=Math.min(this.power(),e.power());for(let i=0;i<=t;++i)this.m_elements[i].addThis(e.m_elements[i]);const i=e.power();this.m_elements.length=Math.max(this.power(),e.power())+1;for(let n=t+1;n<=i;++n)this.m_elements[n]=e.m_elements[n];return this.updatePower(),this}add0(e){return this.m_elements[0].addThis(e),this.updatePower(),this}addNumber0(e){return t.geometryReleaseAssert(0),this}sub(e){const t=Math.min(this.power(),e.power());for(let i=0;i<=t;++i)this.m_elements[i].subThis(e.m_elements[i]);const i=e.power();this.m_elements.length=Math.max(this.power(),e.power())+1;for(let n=t+1;n<=i;++n)this.m_elements[n]=e.m_elements[n].clone(),this.m_elements[n].negateThis();return this.updatePower(),this}sub0(e){return t.geometryReleaseAssert(0),this}subNumber0(e){return t.geometryReleaseAssert(0),this}subShifted(e,t){const i=this.power(),n=e.power()+t,s=Math.min(this.power(),n);let r=0;for(let i=t;i<=s;++i)this.m_elements[i].subThis(e.m_elements[r]),r++;if(n<=i)return this.updatePower(),this;this.m_elements.length=n+1;for(let e=i+1;e<this.m_elements.length;++e)this.m_elements[e]=new this.m_zeroCtor;for(let t=s+1;t<=n;++t)this.m_elements[t].subThis(e.m_elements[r++]);return this.updatePower(),this}subShiftedWithCoef(e,t,i){const n=this.power(),s=e.power()+i,r=Math.min(this.power(),s);let o=0;for(let n=i;n<=r;++n)this.m_elements[n].fmSubThis(e.m_elements[o],t),o++;if(s<=n)return this.updatePower(),this;this.m_elements.length=s+1;for(let e=n+1;e<this.m_elements.length;++e)this.m_elements[e]=new this.m_zeroCtor;for(let i=r+1;i<=s;++i)this.m_elements[i].fmSubThis(e.m_elements[o++],t);return this.updatePower(),this}mulThis(e){if(this.constructor===e.constructor){const t=e,i=[];for(let e=0,n=this.power();e<=n;e++)for(let n=0,s=t.power();n<=s;n++){const s=this.m_elements[e].clone();s.mulThis(t.m_elements[n]),e+n<i.length?i[e+n].addThis(s):i.push(s)}this.m_elements=i}else for(let t=0,i=this.power();t<=i;t++)this.m_elements[t].mulThis(e);return this.updatePower(),this}mulElementThis(e){for(let t=0,i=this.power();t<=i;t++)this.m_elements[t].mulThis(e);return this.updatePower(),this}mulDoubleThis(e){for(let t=0,i=this.power();t<=i;t++)this.m_elements[t].mulDoubleThis(e);return this.updatePower(),this}mulNumber0(e){return t.geometryReleaseAssert(0),this}mulBigint0(e){return t.geometryReleaseAssert(0),this}mulBigIntThis(e){return t.geometryReleaseAssert(0),this}mulInt320(e){return t.geometryReleaseAssert(0),this}div0(e){return t.geometryReleaseAssert(0),this}absThis(){return t.geometryReleaseAssert(0),this}div(e,t,i){if(this.power()<e.power())return i.assignCopy(this),void t.setZero();i.setZero(),t.setZero();const s=e.getElement(e.power()),r=this.clone();let o=r.power();const a=r.power()-e.power();let l=a;for(t.m_elements=n.makeObjectArray(t.m_zeroCtor,a+1);;){if(o<e.power()){i.assignMove(r);break}if(o===r.power()){const i=r.getElement(r.power());i.divThis(s),r.subShiftedWithCoef(e,i,r.power()-e.power()),t.m_elements[l]=i.clone()}l--,o--}i.updatePower(),t.updatePower()}divThis(e){return t.geometryReleaseAssert(0),this}subThis(e){const t=Math.min(this.power(),e.power());for(let i=0;i<=t;++i)this.m_elements[i].subThis(e.m_elements[i]);const i=e.power();this.m_elements.length=Math.max(this.power(),e.power())+1;for(let n=t+1;n<=i;++n)this.m_elements[n]=e.m_elements[n].clone(),this.m_elements[n].negateThis();return this.updatePower(),this}sub0This(e){return this.m_elements[0].subThis(e),this.updatePower(),this}subFrom(e,i){t.geometryReleaseAssert(0)}isZero(){return 0===this.power()&&this.m_elements[0].isZero()}negateThis(){for(let e=this.m_elements.length-1;e>=0;e--)this.m_elements[e].negateThis();return this}getElement(e){return this.m_elements[e].clone()}setElement(e,t){return this.m_elements[e]=t.clone(),this}evaluate(e){const t=this.power(),i=this.m_elements[t].clone();for(let n=t-1;n>=0;--n)i.mulThis(e),i.addThis(this.m_elements[n]);return i}equals(e){if(this===e)return!0;if(this.power()!==e.power())return!1;for(let t=this.m_elements.length-1;t>=0;t--)if(!this.m_elements[t].equals(e.m_elements[t]))return!1;return!0}updatePower(){for(let e=this.m_elements.length-1;e>0&&this.m_elements[e].isZero();e--)this.m_elements.pop();return this}setZero(){return this.m_elements.length=1,this.m_elements[0]=new this.m_zeroCtor,this.updatePower(),this}derivative(e){if(this.power()<e)return this.clone().setZero();if(0===e)return this.clone();const t=new this.constructor({coefsT:this.m_elements.slice(e),power:this.power()-e});for(let i=e,n=this.power();i<=n;i++){let n=BigInt(i);for(let t=i-1,s=i-e;t>s;--t)n*=BigInt(t);t.m_elements[i-e].mulBigIntThis(n)}return t.updatePower(),t}derivative1This(){if(this.m_elements.length>1){this.m_elements=this.m_elements.slice(1);for(let e=1,t=this.power();e<=t;e++)this.m_elements[e].mulThis(n.MPValue.constructInt32(e+1))}else this.m_elements.length=0,this.m_elements.push(new this.m_zeroCtor);return this}limitPrecisionThis(e){for(let t=this.power();t>=0;--t)this.m_elements[t].limitPrecisionThis(e);return this.updatePower(),this}hiBitIndex(){return this.m_elements.reduce(((e,t)=>{const i=t.hiBitIndex();return e<i?i:e}),0)}shiftRight(e){return this.m_elements.splice(0,e),this.updatePower(),this}evaluateDerivative(e){const t=this.power(),i=this.m_elements[t];i.mulDoubleThis(t);for(let n=t-1;n>=1;--n){i.mulThis(e);const t=this.m_elements[n];t.mulDoubleThis(n),i.addThis(t)}return i}static evaluateCoefs(e,t,i){const n=e.power();i.construct0(e.getElement(0).evaluate(t));for(let s=1;s<=n;++s)i.addElement(e.getElement(s).evaluate(t));i.updatePower()}}class ze extends Ue{constructor(e){super(void 0===e?{zeroCtor:n.MPValue}:{...e,zeroCtor:n.MPValue})}clone(){return new ze({copy:this})}absEvaluate(e){const t=this.power(),i=this.m_elements[t].clone();i.absThis();const n=e.clone();n.absThis();for(let e=t-1;e>=0;--e)i.mulThis(n),i.addThis(this.m_elements[e].abs());return i}}class Ye extends Ue{constructor(e){super(void 0===e?{zeroCtor:ze}:{...e,zeroCtor:ze})}clone(){return new Ye({copy:this})}constructFromMPValues(e,t){this.m_elements.length=0;for(let i=0;i<=t;++i)this.m_elements.push(new ze({coef0:e[i]}));return this.updatePower(),this}}function Be(e,i,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P=!1){const b={polypoly1:new Ye,polypoly2:new Ye,polyX2:new ze,polyY2:new ze,polyX2Deriv:new ze,polyY2Deriv:new ze,polypolyX1:new Ye,polypolyY1:new Ye,polypolyX1Deriv:new Ye,polypolyY1Deriv:new Ye,lazyPolypolyD1:new Ye,lazyPolypolyD1Deriv:new Ye,lazyPolyD2:new ze,lazyPolyD2Deriv:null,polypoly11:new Ye,polypoly12:new Ye,tempPp:new Ye,tempPp1:new Ye,tempPp2:new Ye,tempP:new ze,tempP1:new ze,tempP2:new ze};b.polyX2.construct(l,c),b.polyY2.construct(h,u),b.polypolyX1.constructFromMPValues(e,i),b.polypolyY1.constructFromMPValues(s,r),b.polypoly11.assignCopy(b.polypolyX1),b.polypoly12.assignCopy(b.polypolyY1),m&&(b.lazyPolyD2.construct(m,d),b.polypoly11.mulElementThis(b.lazyPolyD2),b.polypoly12.mulElementThis(b.lazyPolyD2)),o?(b.lazyPolypolyD1.constructFromMPValues(o,a),b.lazyPolypolyD1Deriv=new Ye({copy:b.lazyPolypolyD1}),b.lazyPolypolyD1Deriv.derivative1This(),b.tempPp.assignCopy(b.lazyPolypolyD1),b.tempPp.mulElementThis(b.polyX2),b.polypoly11.subThis(b.tempPp),b.tempPp.assignCopy(b.lazyPolypolyD1),b.tempPp.mulElementThis(b.polyY2),b.polypoly12.subThis(b.tempPp)):(b.polypoly11.sub0This(b.polyX2),b.polypoly12.sub0This(b.polyY2)),b.polypolyX1Deriv.assignCopy(b.polypolyX1),b.polypolyX1Deriv.derivative1This(),b.polypolyY1Deriv.assignCopy(b.polypolyY1),b.polypolyY1Deriv.derivative1This(),o&&(b.polypolyX1Deriv.mulThis(b.lazyPolypolyD1),b.tempPp2.assignCopy(b.lazyPolypolyD1Deriv),b.tempPp2.mulThis(b.polypolyX1),b.polypolyX1Deriv.subThis(b.tempPp2),b.polypolyY1Deriv.mulThis(b.lazyPolypolyD1),b.tempPp2.assignCopy(b.lazyPolypolyD1Deriv),b.tempPp2.mulThis(b.polypolyY1),b.polypolyY1Deriv.subThis(b.tempPp2)),b.polyX2Deriv.assignCopy(b.polyX2),b.polyX2Deriv.derivative1This(),b.polyY2Deriv.assignCopy(b.polyY2),b.polyY2Deriv.derivative1This(),m&&(t.geometryReleaseAssert(null===b.lazyPolyD2Deriv),b.lazyPolyD2Deriv=new ze({copy:b.lazyPolyD2}),b.lazyPolyD2Deriv.derivative1This(),b.polyX2Deriv.mulThis(b.lazyPolyD2),b.tempP1.assignCopy(b.lazyPolyD2Deriv),b.tempP1.mulThis(b.polyX2),b.polyX2Deriv.subThis(b.tempP1),b.polyY2Deriv.mulThis(b.lazyPolyD2),b.tempP1.assignCopy(b.lazyPolyD2Deriv),b.tempP1.mulThis(b.polyY2),b.polyY2Deriv.subThis(b.tempP1)),b.polypoly1.assignCopy(b.polypoly11),b.polypoly1.mulElementThis(b.polyX2Deriv),b.tempPp.assignCopy(b.polypoly12),b.tempPp.mulElementThis(b.polyY2Deriv),b.polypoly1.addThis(b.tempPp),b.polypoly2.assignCopy(b.polypolyX1Deriv),b.polypoly2.mulElementThis(b.polyY2Deriv),b.tempPp.assignCopy(b.polypolyY1Deriv),b.tempPp.mulElementThis(b.polyX2Deriv),b.polypoly2.subThis(b.tempPp);let E=[];const S=[];y||(y=[]),f||(f=[]),Je(b.polypoly11,b.polypoly12,b.tempP);const C=n.s_one$1.ldexp(-59).toDouble(),w=[];let T=et(b.tempP,0,_,C,64,w,x,x);if(T<0)return-1;for(let e=0;e<T;e++){const i=b.tempP1,s=b.tempP2;ze.evaluateCoefs(b.polypoly11,w[e],i);const r=n.constructBernsteinCoefficientsFromStandardForm(i.m_elements,i.power()+1);r.sort(((e,t)=>e.compare(t))),ze.evaluateCoefs(b.polypoly12,w[e],s);const o=n.constructBernsteinCoefficientsFromStandardForm(s.m_elements,s.power()+1);o.sort(((e,t)=>e.compare(t)));const a=r[0],l=r.at(-1),c=o[0],h=o.at(-1);l.subThis(a),h.subThis(c);const u=l.subThis(h).GEZ(),m=58,d=[];let p;if(p=et(u?i:s,0,g,n.s_one$1.ldexp(-59).toDouble(),m,d,x,x),p<0&&t.throwInternalErrorException("mp_curve_proximity"),p>0){const r=u?s:i;for(let i=0;i<p;i++){let s;if(u){const t=b.tempP;ze.evaluateCoefs(b.polypoly12,w[e].addDouble(Number.EPSILON),t),s=t.evaluate(d[i])}else{const t=b.tempP;ze.evaluateCoefs(b.polypoly11,w[e].addDouble(Number.EPSILON),t),s=t.evaluate(d[i])}const o=r.evaluateDerivative(d[i]).abs().mulDoubleThis(Number.EPSILON),a=r.evaluate(d[i]);o.addThis(s.sub(a).absThis()),o.ldexpThis(3),a.absThis(),a.lt(o)?S.push(n.makePair(d[i].toDouble(),w[e].toDouble())):t.geometryReleaseAssert(a.gte(o))}}}T=S.length,Je(b.polypoly1,b.polypoly2,b.tempP);const D=[];let I=et(b.tempP,0,_,C,64,D);I<0&&(I=0);for(let e=0;e<I;e++){ze.evaluateCoefs(b.polypoly1,D[e],b.tempP1);const t=[];let i=et(b.tempP1,0,g,C,64,t);if(0!==i)if(ze.evaluateCoefs(b.polypoly2,D[e],b.tempP2),i<0){if(i=et(b.tempP2,0,g,C,64,t),i<0)continue;for(let s=0;s<i;s++)E.push(n.makePair(t[s].toDouble(),D[e].toDouble()))}else{const s=b.tempP2.absEvaluate(n.s_one$1);s.mulThis(n.MPValue.constructDouble(1e-12));for(let r=0;r<i;r++){const i=b.tempP2.evaluate(t[r]);i.absThis(),i.lt(s)&&E.push(n.makePair(t[r].toDouble(),D[e].toDouble()))}}}if(I=E.length,0===T&&0===I)return 0;E=E.concat(S),E.sort(((e,t)=>P?n.standardNumericCompare(e.second,t.second):n.standardNumericCompare(e.first,t.first)));const A=n.unique(E,((e,t)=>e.first===t.first&&e.second===t.second));E=E.slice(0,A),f.length=0,y.length=0;for(const e of E)f.push(e.first),y.push(e.second);return t.geometryReleaseAssert(f.length===y.length),y.length}function Xe(e,t,i,s,r,o,a,l,c,h,u,m,d){const p={polyIntersect:new ze,polyX1:new ze,polyY1:new ze,polyX1Deriv:new ze,polyY1Deriv:new ze,lazyPolyD1:new ze,lazyPolyD1Deriv:new ze,tempP:new ze,tempP1:new ze,tempP2:new ze,polypoly1Proximity:new Ye,polypoly2Proximity:new Ye};p.polyX1.construct(e,t),p.polyY1.construct(i,s),p.polyX1Deriv.assignCopy(p.polyX1),p.polyX1Deriv.derivative1This(),p.polyY1Deriv.assignCopy(p.polyY1),p.polyY1Deriv.derivative1This(),p.polyIntersect.assignCopy(p.polyX1),p.polyIntersect.mulThis(p.polyX1),p.polyIntersect.mulElementThis(a[0]),p.tempP.assignCopy(p.polyY1),p.tempP.mulThis(p.polyY1),p.tempP.mulElementThis(a[1]),p.polyIntersect.addThis(p.tempP),r?(p.lazyPolyD1.construct(r,o),p.tempP.assignCopy(p.lazyPolyD1),p.tempP.mulThis(p.lazyPolyD1),p.tempP.mulElementThis(a[2]),p.polyIntersect.addThis(p.tempP)):p.polyIntersect.add0(a[2]);{const r=a[0].clone(),o=r.clone();o.sqrThis();const l=a[1].clone(),c=l.clone();c.sqrThis();const h=a[2].clone(),u=r.clone();u.subThis(l),p.polyX1.construct(e,t),p.polyX1Deriv.assignCopy(p.polyX1),p.polyX1Deriv.derivative1This(),p.polyY1.construct(i,s),p.polyY1Deriv.assignCopy(p.polyY1),p.polyY1Deriv.derivative1This(),p.tempP.assignCopy(p.polyX1),p.tempP.mulThis(p.polyX1),p.tempP.mulElementThis(c),p.tempP.mulElementThis(h),p.polypoly1Proximity.construct0(p.tempP),p.tempP.assignCopy(p.polyX1),p.tempP.mulThis(l.mul(u).mul(h).ldexpThis(1)),p.polypoly1Proximity.addElement(p.tempP),p.tempP.assignCopy(p.polyX1),p.tempP.mulThis(p.polyX1),p.tempP.mulElementThis(r.mul(c)),p.tempP1.assignCopy(p.polyY1),p.tempP1.mulThis(p.polyY1),p.tempP1.mulElementThis(o.mul(l)),p.tempP.addThis(p.tempP1),p.tempP.add0(u.mul(u).mul(h)),p.polypoly1Proximity.addElement(p.tempP),p.tempP.assignCopy(p.polyX1),p.tempP.mulElementThis(u.mul(r).mul(l).ldexpThis(1)),p.polypoly1Proximity.addElement(p.tempP),p.tempP.construct0(r.mul(u).mul(u)),p.polypoly1Proximity.addElement(p.tempP),p.polypoly1Proximity.updatePower(),p.tempP.construct0(n.s_zero$1),p.polypoly2Proximity.construct0(p.tempP),p.tempP.assignCopy(p.polyX1),p.tempP.mulThis(p.polyX1Deriv),p.tempP1.assignCopy(p.polyY1),p.tempP1.mulThis(p.polyY1Deriv),p.tempP.addThis(p.tempP1),p.tempP.mulElementThis(r.mul(l)),p.polypoly2Proximity.addElement(p.tempP),p.tempP.assignCopy(p.polyX1Deriv),p.tempP.mulElementThis(u.mul(r)),p.polypoly2Proximity.addElement(p.tempP),p.polypoly2Proximity.updatePower()}const g=[],_=[];null===u&&(u=[]);let f=2*p.polyIntersect.power()+58;const y=.5*Number.EPSILON,x=[],v=et(p.polyIntersect,0,c,y,f,x,m,m);if(v<0)return-1;for(const e of x)_.push(e.toDouble());Je(p.polypoly1Proximity,p.polypoly2Proximity,p.tempP),f=2*p.tempP.power()+58,x.length=0;let P=et(p.tempP,0,c,y,f,x);if(P<0&&(P=0),0===v&&0===P)return 0;for(const e of x)g.push(e.toDouble());const b=g.concat(_);u.length=b.length,n.memcpy(u,b,0,0,b.length),n.numericSort(u);const E=n.unique(u,((e,t)=>0===n.standardNumericCompare(e,t)));return u.length=E,u.length}function je(e,t,i,n){return e.isZero()?t.isZero()?-1:0:(n.setThis(t),n.negateThis(),n.divThis(e),i.isEmpty()||i.containsCoordinate(n.value())?1:0)}function We(e,t,i,s,r,o,a){if(e.isZero())return o?(a[0].setInt32(1),r.containsCoordinate(1)?1:0):je(t,i,r,a[0]);if(o){let t=2;return a[0].setInt32(1),i.equals(e)?(a[1].setInt32(1),t=1):a[1].setThis(i.div(e)),r.containsCoordinate(a[1].value())||(t=1),r.containsCoordinate(a[0].value())||(t--,a[0].setThis(a[1])),2===t&&a[0].value()>a[1].value()&&(a[1]=n.swap(a[0],a[0]=a[1])),t}const l=t.clone();l.sqrThis();const c=e.clone();if(c.mulThis(i).ldexpThis(2).negateThis().addThis(l),c.LZ())return 0;const h=s+2,u=n.MPValue.sqrt(c,h),m=u.clone();t.LZ()&&m.negateThis(),m.addThis(t).limitPrecisionThis(h).ldexpThis(-1).negateThis();let d=0;return a[0].setThis(m).divThis(n.MPValue.constructAssign(e,h)).limitPrecisionThis(s),(r.isEmpty()||r.containsCoordinate(a[0].value()))&&d++,u.isZero()||m.isZero()||(a[d].setThis(i).divThis(m).limitPrecisionThis(s),(r.isEmpty()||r.containsCoordinate(a[d].value()))&&d++,2===d&&a[0].gt(a[1])&&(a[1]=n.swap(a[0],a[0]=a[1]))),d}function Ze(e,i,s,r,o,a,l,c){if(e.isZero())return We(i,s,r,o,a,l,c);const h=(e,t)=>{if(e>0){let i=t+e;for(let e=1;e<i;e++)c[e].equals(c[0])&&(c[i-1]=n.swap(c[e],c[e]=c[i-1]),i--);t=i}return n.sortRange(c,0,t,((e,t)=>e.compare(t))),t};if(r.isZero()){let t=0;return a.containsCoordinate(0)&&(c[0].setInt32(0),t=1),h(We(e,i,s,o,a,l,c.slice(1)),t)}if(l){let t=0;a.containsCoordinate(1)&&(c[0].setInt32(1),t=1);const n=i.add(e),s=r.negate(),l=e.add(n).add(s).isZero();return h(We(e,n,s,o,a,l,c.slice(t)),t)}const u=new n.MPValue,m=new n.MPValue,d=new n.MPValue,p=i.clone();if(p.isZero())m.setThis(s),m.divThis(e),d.setThis(r),d.divThis(e);else{p.divThis(e).divDoubleThis(3).negateThis();const t=i.clone();t.sqrThis();const n=e.clone();n.sqrThis(),m.setThis(e),m.mulThis(s).mulDoubleThis(3).subThis(t).divThis(n).divDoubleThis(3),d.setThis(t),d.mulThis(i),d.ldexpThis(1),u.setThis(e),u.mulThis(i).mulThis(s).mulDoubleThis(9),d.subThis(u),u.setThis(n),u.mulThis(r).mulDoubleThis(27),d.addThis(u),d.divThis(n).divThis(e).divDoubleThis(27)}if(m.isZero()){const e=d.clone();return e.negateThis(),e.isZero()?(c[0].setThis(p),at(a,o,c,1)):(c[0].setThis(n.MPValue.cubicRoot(e,o).add(p)),at(a,o,c,1))}const g=d.clone();if(g.sqrThis().ldexpThis(-2),u.setThis(m.clone()),u.sqrThis().mulThis(m).divDoubleThis(27),g.addThis(u),g.isZero())return c[0].setThis(d),c[0].mulDoubleThis(3).divThis(m),c[1].setThis(c[0]),c[1].negateThis(),c[1].ldexpThis(-1),c[0].addThis(p),c[1].addThis(p),at(a,o,c,2);if(g.GZ())return g.setThis(n.MPValue.sqrt(g,o+8)),u.setThis(d),u.ldexpThis(-1).negateThis(),u.addThis(g),c[0].setThis(n.MPValue.cubicRoot(u,o+8)),u.setThis(d),u.ldexpThis(-1).negateThis(),u.subThis(g),c[0].addThis(n.MPValue.cubicRoot(u,o+8)),c[0].addThis(p),at(a,o,c,1);u.setThis(m),u.divDoubleThis(3).negateThis(),t.geometryReleaseAssert(u.GEZ());const _=n.MPValue.sqrt(u,o+8),f=_.clone();f.negateThis(),f.addThis(p),_.addThis(p);const y=n.MPValue.constructDouble(a.isEmpty()?-Number.MAX_VALUE:a.vmin),x=n.MPValue.constructDouble(a.isEmpty()?Number.MAX_VALUE:a.vmax),v=new ze({zeroCtor:n.MPValue});v.construct0(r),v.addElement(s),v.addElement(i),v.addElement(e);const P=new ze({copy:v});P.derivative1This();let b=0;const E=n.makeObjectArray(n.MPValue,4);E[b++].setThis(y),f.gt(y)&&f.lt(x)&&E[b++].setThis(f),_.gt(y)&&_.lt(x)&&E[b++].setThis(_),E[b++].setThis(x);const S=3*o;let C=52,w=Number.EPSILON;for(;C<S;)2*C<=S?(w*=w,C*=2):(w*=Number.EPSILON,C+=52);C+=2;let T=0,D=!1;for(let e=1;e<b;e++)if(nt(v,P,E[e-1],E[e],w,C,c[0])){T=1,D=e+1<b;break}if(!T)return 0;if(D){const e=new ze({zeroCtor:n.MPValue,coef0:c[0]});e.negateThis(),e.addElement(n.s_one$1);const i=new ze({zeroCtor:n.MPValue}),s=new ze({zeroCtor:n.MPValue});v.div(e,i,s),t.geometryReleaseAssert(2===i.power()),t.geometryReleaseAssert(0===s.power());const r=We(i.getElement(2),i.getElement(1),i.getElement(0),o,a,!1,c.slice(1));t.geometryReleaseAssert(r>=0&&r<=2),T+=r}return at(a,o,c,T)}function Qe(e,t,i,s,r,o,a,l,c){if(e.isZero())return Ze(t,i,s,r,o,a,l,c);const h=(e,t)=>{if(e>0){let i=t+e;for(let e=1;e<i;e++)c[e].equals(c[0])&&(c[i-1]=n.swap(c[e],c[e]=c[i-1]),i--);t=i}return n.sortRange(c,0,t,((e,t)=>e.compare(t))),t};if(r.isZero()){let n=0;return a.containsCoordinate(0)&&(c[0].setInt32(0),n=1),h(Ze(e,t,i,s,o,a,l,c.slice(n)),n)}const u=new ze({zeroCtor:n.MPValue,coef0:r});if(u.addElement(s),u.addElement(i),u.addElement(t),u.addElement(e),l){let e=0;a.containsCoordinate(1)&&(c[0].setInt32(1),e=1);const t=new ze({zeroCtor:n.MPValue,coef0:n.MPValue.constructInt32(-1)});t.addElement(n.MPValue.constructInt32(1));const i=new ze({zeroCtor:n.MPValue}),s=new ze({zeroCtor:n.MPValue});return u.div(t,i,s),h(Ze(3===i.power()?i.getElement(3):n.s_zero$1.clone(),i.power()>=2?i.getElement(2):n.s_zero$1.clone(),i.power()>=1?i.getElement(1):n.s_zero$1.clone(),i.getElement(0),o,a,i.evaluate(n.s_one$1).isZero(),c.slice(e)),e)}if(u.getElement(0).isZero()){let e=0;for(a.containsCoordinate(0)&&(e=1,c[0].setDouble(0));u.getElement(0).isZero()&&u.power()>0;)u.shiftRight(1);const t=Ze(3===u.power()?u.getElement(3):n.s_zero$1.clone(),u.power()>=2?u.getElement(2):n.s_zero$1.clone(),u.power()>=1?u.getElement(1):n.s_zero$1.clone(),u.getElement(0),o,a,!1,c.slice(e));return t>0&&(e+=t),n.sortRange(c,0,e,((e,t)=>e.compare(t))),e}let m=52,d=Number.EPSILON;for(;m<o;)2*m<=o?(d*=d,m*=2):(d*=Number.EPSILON,m+=52);m+=2;const p=ot(u),g=n.MPValue.constructDouble(Math.max(Math.abs(a.vmax),Math.abs(a.vmin)));return d=(p.lt(g)?p:g).mul(n.MPValue.constructDouble(d)).toDouble(),rt(u,a,d,m,l,0,c,4)}function $e(e,t){let i=e,s=t;s.power()>i.power()&&(s=n.swap(i,i=s));const r=i.power()-s.power(),o=new ze({copy:i.getElement(i.power())});i.mulThis(s.getElement(s.power()));for(let e=0,t=i.power();e<t;e++)if(e>=r){const t=new ze({copy:s.getElement(e-r)});t.mulThis(o);const n=i.getElement(e).sub(t);i.setElement(e,n)}i.setElement(i.power(),i.getElement(i.power()).setZero()),i.updatePower(),Ke(i)}function Ke(e){let t=0;for(;t<e.power()&&e.getElement(t).isZero();)t++;return t>0&&(e.shiftRight(t),!0)}function Je(e,t,i){const n=e.clone(),s=t.clone();for(Ke(n),Ke(s);0!==n.power()||0!==s.power();)$e(n,s);i.assignMove(n.getElement(0))}function et(e,t,i,s,r,o,a=!1,l=!1){o.length=0;const c=e.power(),h=n.makeObjectArray(n.MPValue,2*c+4),u=function(e,t,i,s,r,o,a){if(0===e.power())return e.isZero()?-1:0;const l=e.evaluate(n.MPValue.constructInt32(1)).isZero();if(1===e.power()){const i=je(e.getElement(1),e.getElement(0),t,o.at(0));return o[0].limitPrecisionThis(s),1!==i?0:(o[0].limitPrecisionThis(s),1)}return 2===e.power()?We(e.getElement(2),e.getElement(1),e.getElement(0),s,t,l,o):3===e.power()?Ze(e.getElement(3),e.getElement(2),e.getElement(1),e.getElement(0),s,t,l,o):4===e.power()?Qe(e.getElement(4),e.getElement(3),e.getElement(2),e.getElement(1),e.getElement(0),s,t,l,o):rt(e,t,i,s,l,0,o,a)}(e,i||n.Envelope1D.unit(),s,r,0,h,h.length);if(u>0){o.length=0;for(let e=0;e<u;e++){const t=h[e];e>0&&t.lte(o.at(-1))||o.push(t.clone())}return o.length}return u}function tt(e,i,n){if(t.geometryReleaseAssert(n>=1),0===e.power())return e.isZero()?-1:0;const s=e.getElement(0);return s.negateThis(),s.divThis(e.getElement(1)),i[0].setThis(s),1}function it(e,i,s,r){if(e.power()<2)return tt(e,s,r);t.geometryReleaseAssert(r>=1);let o=e.getElement(1);o.mulThis(e.getElement(1));const a=e.getElement(0);if(a.mulThis(e.getElement(2)),a.ldexpThis(2),o.subThis(a),o.LZ())return 0;if(o.isZero()){const t=e.getElement(1);return t.negateThis(),t.divThis(e.getElement(2)),t.ldexpThis(-1),t.limitPrecisionThis(i),s[0].setThis(t),1}t.geometryReleaseAssert(r>=2),o=n.MPValue.sqrt(o,i+8);const l=e.getElement(1);l.negateThis();const c=l.clone();c.subThis(o),c.divThis(e.getElement(2)),c.ldexpThis(-1),c.limitPrecisionThis(i);const h=l.clone();return h.addThis(o),h.divThis(e.getElement(2)),h.ldexpThis(-1),h.limitPrecisionThis(i),c.lt(h)?(s[0].setThis(c),s[1].setThis(h)):(s[1].setThis(c),s[0].setThis(h)),2}function nt(e,i,s,r,o,a,l){let c=s.clone(),h=r.clone();c.limitPrecisionThis(a),h.limitPrecisionThis(a);let u=e.evaluate(c);u.limitPrecisionThis(a+2);let m=e.evaluate(h);if(m.limitPrecisionThis(a+2),u.GEZ()&&m.GEZ()||u.LEZ()&&m.LEZ())return u.absLessAbs(m)?(l=c,u.isZero()):(l=h,m.isZero());const d=m.LZ();d&&(m=n.swap(u,u=m),h=n.swap(c,c=h));const p=d?h:c,g=d?c:h,_=c.add(h).ldexpThis(-1);_.limitPrecisionThis(a);const f=h.sub(c);f.limitPrecisionThis(a),f.absThis();const y=f.clone();let x=e.evaluate(_),v=i.evaluate(_);const P=new ze({copy:e}),b=new ze({copy:i});{const t=Math.max(e.hiBitIndex(),i.hiBitIndex()),s=n.s_one$1.clone();s.ldexpThis(-(a+2));for(let n=64;n<t;){P.limitPrecisionThis(n),b.limitPrecisionThis(n);const r=P.evaluate(_),o=b.evaluate(_),a=r.sub(x),l=o.sub(v);if(a.divThis(x).absThis().lt(s)&&(v.isZero()||l.divThis(v).absThis().lt(s)))break;P.assignCopy(e),b.assignCopy(i),n=Math.min(n+64,t)}x.limitPrecisionThis(a+2),v.limitPrecisionThis(a+2)}let E=4,S=1,C=0,w=0,T=1;const D=n.MPValue.constructDouble(.25*o),I=n.MPValue.constructDouble(.5001);let A=0;for(;++A<300;){if(A>32&&C>0||v.isZero()||2===T&&C>1||1===T&&E<4)T=1,S>1&&S--;else if(T=2,w>1){const e=f.mul(v);e.absThis(),e.ldexpThis(-3),e.absLessAbs(x)&&S++}f.setThis(y);const e=new n.MPValue;let t=!1;if(1===T)do{if(w>2){const t=f.clone();if(t.absThis(),t.ldexpThis(4),g.sub(p).ldexpThis(-1).gt(t)){if(_.equals(p)){e.setThis(_),_.setThis(p.add(t)),_.limitPrecisionThis(a),y.setThis(_.sub(e));break}if(_.equals(g)){e.setThis(_),_.setThis(g.sub(t)),_.limitPrecisionThis(a),y.setThis(_.sub(e));break}}}y.setThis(h.sub(c)),y.ldexpThis(-1),y.limitPrecisionThis(a),e.setThis(_),_.setThis(c.add(y)),_.limitPrecisionThis(a),_.lt(p)?_.setThis(p):_.gt(g)&&_.setThis(g),t=c.equals(_)||h.equals(_)}while(0);else for(;;){if(y.setThis(x.div(v)),y.limitPrecisionThis(a),1!==S&&y.mulDoubleThis(S),e.setThis(_),_.subThis(y),_.limitPrecisionThis(a),t=_.equals(e),_.lt(p)){if(S>1){_.setThis(e),S--;continue}y.setThis(e.sub(p)),_.setThis(p)}else if(_.gt(g)){if(S>1){_.setThis(e),S--;continue}y.setThis(e.sub(g)),_.setThis(g)}break}if(t||y.absLessAbs(D)){e.equals(_)||(x=P.evaluate(_),x.limitPrecisionThis(a+2));break}x=P.evaluate(_),x.limitPrecisionThis(a+2),v=b.evaluate(_),v.limitPrecisionThis(a+2);const i=c.clone(),s=h.clone();x.LZ()?(u.setThis(x),c.setThis(_)):(m.setThis(x),h.setThis(_)),2===T&&(c.equals(i)&&h.equals(s)||w>1&&!y.absLessAbs(I.mul(f)))?C++:C=0,1===T?(E++,w=0):(E=0,w++)}return A>=300&&t.throwInternalErrorException("Root_finder iterations exceeded"),l.setThis(_),!0}function st(e,t,i,s,r){const o=e.evaluate(i);if(o.isZero())return!0;const a=n.MPValue.constructDouble(.5*s),l=i.clone();l.subThis(a);const c=e.evaluate(l),h=i.clone();h.addThis(a);const u=e.evaluate(h);if(c.LZ()&&u.GZ()||c.GZ()&&u.LZ())return!0;if(o.GZ()?c.LEZ()||u.LEZ():c.GEZ()||u.GEZ())return!0;const m=c.LEZ()&&u.LEZ(),d=c.GEZ()&&u.GEZ();let p=!1;return m?o.gt(c)&&o.gt(u)&&(p=!0):d&&o.lt(c)&&o.lt(u)&&(p=!0),!!p&&o.absThis().lt(n.MPValue.constructDouble(1e-17))}function rt(e,i,s,r,o,a,l,c){t.geometryReleaseAssert(s>0),t.geometryReleaseAssert(c>=e.power());const h=l,u=[];let m=[];const d=new ze({zeroCtor:e.m_zeroCtor}),p=new ze({zeroCtor:e.m_zeroCtor}),g=new ze({zeroCtor:e.m_zeroCtor}),_=n.MPValue.constructDouble(s),f=n.MPValue.constructDouble(i.vmin),y=n.MPValue.constructDouble(i.vmax),x=f.sub(_),v=y.add(_),P=ot(e),b=P.clone();if(b.negateThis(),x.lt(b))x.setThis(b.sub(_));else if(x.gt(P))return 0;if(v.gt(P))v.setThis(P.add(_));else if(v.lt(b))return 0;let E=e,S=null;if(o){const t=new ze({coef0:n.MPValue.constructInt32(-1)});t.addElement(n.s_one$1),S=new ze,E=S;const i=new ze,s=new ze;for(e.div(t,i,s),S.assignCopy(i);E.evaluate(n.s_one$1).isZero();)E.div(t,i,s),S.assignCopy(i)}let C=!1;if(E.power()>0&&E.getElement(0).isZero())for(C=!0,S||(S=new ze({copy:E}),E=S);E.getElement(0).isZero();)S.shiftRight(1);let w=r+2*E.power()+2,T=s/Math.pow(2,E.power()+2),D=w;if(n.s_zero$1.gt(x)&&n.s_zero$1.lt(v))for(let e=0,t=E.power();e<t;e++)if(E.getElement(e).isZero()){u.push(n.s_zero$1.clone());break}for(let e=E.power()-1;e>0;e--)if(T*=2,w-=2,D-=2,E.power()-e!==1)if(E.power()-e!==2){p.assignMove(g),g.assignMove(E.derivative(e-1));let t=[];for(let e=0,i=m.length;e<i;++e)if(m[e].first.lte(m[e].second)){const i=new n.MPValue;if(nt(p,d,m[e].first,m[e].second,T,w,i)){u.push(i);let s=i.sub(_);s.limitPrecisionThis(D),t.push(n.makePair(m[e].first,s)),s=i.add(_),s.limitPrecisionThis(D),t.push(n.makePair(s,m[e].second))}else t.push(m[e])}m=t,t=[],d.assignMove(p)}else{p.assignMove(E.derivative(e));const i=it(p,w,h,c);t.geometryReleaseAssert(i>=0&&i<=2);for(let e=0;e<i;e++)h[e].gt(x)&&h[e].lt(v)&&!h[e].isZero()&&u.push(h[e].clone());if(u.length>1&&u.sort(((e,t)=>e.compare(t))),u.length>0){let e=u[0].sub(_);e.limitPrecisionThis(D),m.push(n.makePair(x.clone(),e));let t=1===u.length?v.clone():u[1].sub(_);e=u[0].add(_),e.limitPrecisionThis(D),t.limitPrecisionThis(D),m.push(n.makePair(e,t)),u.length>1&&(t=2===u.length?v.clone():u[2].sub(_),t.limitPrecisionThis(D),e=u[1].add(_),e.limitPrecisionThis(D),m.push(n.makePair(e,t)),u.length>2&&(e=u[2].add(_),e.limitPrecisionThis(D),m.push(n.makePair(e,v.clone()))))}else m.push(n.makePair(x.clone(),v.clone()));d.assignCopy(p),g.assignMove(E.derivative(e-1))}else p.assignMove(E.derivative(e)),1===tt(p,h,c)&&(h[0].gt(x)&&h[0].lt(v)&&!h[0].isZero()&&u.push(h[0].clone()),d.assignMove(p),g.assignMove(E.derivative(e-1)));u.sort(((e,t)=>e.compare(t))),0===m.length&&(d.assignMove(E.derivative(E.power())),d.isZero()||m.push(n.makePair(x.clone(),v.clone())));let I=0,A=0,M=0;const N=new n.MPValue;for(;;){if(A<m.length){if(m[A].first.gt(m[A].second)){A++;continue}let e=!1;if(M<u.length&&u[M].lt(m[A].first)&&(e=!0),!e){nt(E,d,m[A].first,m[A].second,s,r,N)&&(N.lt(f)?h[I++].setThis(f):N.gt(y)?h[I++].setThis(y):h[I++].setThis(N)),A++;continue}}if(!(M<u.length))break;0!==M&&u[M-1].equals(u[M])||st(E,0,u[M],s)&&(N.setThis(u[M]),N.lt(f)?N.setThis(f):N.gt(y)&&N.setThis(y),0!==I&&h[I].equals(N)||h[I++].setThis(N)),M++}return C&&n.s_zero$1.gt(x)&&n.s_zero$1.lt(v)&&(h[I++].setThis(n.s_zero$1),n.sortRange(h,0,I,((e,t)=>e.compare(t)))),o&&n.s_one$1.gt(x)&&n.s_one$1.lt(v)&&(h[I++].setThis(n.s_one$1),n.sortRange(h,0,I,((e,t)=>e.compare(t)))),I}function ot(e){const t=e.getElement(e.power());t.limitPrecisionThis(53),t.absThis();const i=n.s_zero$1.clone();for(let t=0,n=e.power();t<n;t++){const n=e.getElement(t);n.limitPrecisionThis(53),n.gt(i)&&i.setThis(n)}return i.divThis(t),i.addThis(n.s_one$1),i.mulThis(n.MPValue.constructDouble(1+100*Number.EPSILON)),i}function at(e,t,i,s){let r=s;if(!e.isEmpty()){r=0;for(let t=0;t<s;++t)e.containsCoordinate(i[t].value())&&(r!==t&&i[r].setThis(i[t]),r++)}r>1&&(i[0].gt(i[1])&&(i[1]=n.swap(i[0],i[0]=i[1])),r>2&&(i[0].gt(i[2])&&(i[2]=n.swap(i[0],i[0]=i[2])),i[1].gt(i[2])&&(i[2]=n.swap(i[1],i[1]=i[2]))));for(let e=0;e<r;++e)i[e].limitPrecisionThis(t);return r}function lt(e,i,s,r,o,a){return function(e,i,s,r,o,a){if(s<i&&t.throwInvalidArgumentException("xTo < xFrom"),s===i)return 0;const l=[0];let c=Number.MAX_VALUE;const h=[Number.MAX_VALUE];let u=0;const m=n.makePrimitiveArray(33,Number.NaN),d=n.makePrimitiveArray(33,Number.NaN),p=[0];m[0]=1;let g=0,_=0;for(let n=0;n<32;n++){if(u=ct(i,s,r,0===n,u,p),d[n]=u,n+1>=e){ht(n+1-e,e,m,d,0,l,h)||t.throwInternalErrorException("polynomial_interpolation");const i=o*Math.abs(l[0])+a,s=Math.abs(c-l[0]);if(s<=i&&Math.abs(h[0])<=i){if(g++,g>1&&(s<=.1*_||0===_||g>2))return l[0]}else g=0;_=s,c=l[0]}d[n+1]=d[n],m[n+1]=.25*m[n]}return l[0]}(e,i,s,a,r,o)}function ct(e,t,i,s,r,o){let a=r;if(s)return o[0]=1,a=.5*(t-e)*(i(e)+i(t)),a;const l=o[0],c=(t-e)/l,h=e,u=new n.KahanSummator(0);for(let e=1;e<=o[0];++e){const t=(e-.5)*c;u.add(i(h+t))}return a=.5*(a+(t-e)*u.getResult()/l),o[0]*=2,a}function ht(e,t,i,s,r,o,a){let l=0,c=Math.abs(r-i[e]);const h=n.makePrimitiveArray(t,Number.NaN),u=n.makePrimitiveArray(t,Number.NaN);for(let n=0;n<t;++n){const t=Math.abs(r-i[e+n]);t<c&&(l=n,c=t),h[n]=s[e+n],u[n]=s[e+n]}let m=0,d=0,p=0;o[0]=s[e+l],l--;for(let n=1;n<t;n++){for(let s=0;s<t-n;s++){if(d=i[e+s]-r,p=i[e+s+n]-r,m=d-p,0===m)return!1;const t=(h[s+1]-u[s])/m;h[s]=d*t,u[s]=p*t}if(2*(l+1)<t-n){const e=l+1;a[0]=h[e]}else{const e=l;a[0]=u[e],l--}o[0]+=a[0]}return!0}class ut{constructor(){this.area=Number.NaN,this.centroid_x=Number.NaN,this.centroid_y=0,this.specialPoints=[],this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}}let mt=class{constructor(e,t){this.b=e,this.len=t}getMaxDerivative(){return 1}getValue(e,t){return 0===e?this.len-ft(this.b,t,!1):0}getError(e){return t.geometryReleaseAssert(0),0}};function dt(e,t,i,s,r){let o=!0;const a=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(a);let l=o?0:1,c=a[1][l]-a[0][l],h=a[2][l]-a[0][l];const u=lt(5,t,i,s,r,(e=>{let t;if(e<=.5){const i=n.lerpLo(0,c,e),s=n.lerpLo(c,h,e);t=n.lerpLo(i,s,e)}else{const i=n.lerpHi(0,c,e),s=n.lerpHi(c,h,e);t=n.lerpHi(i,s,e)}return t*bt(a,1,e).length()}));o=!1,l=o?0:1,c=a[1][l]-a[0][l],h=a[2][l]-a[0][l];const m=lt(5,t,i,s,r,(e=>{let t;if(e<=.5){const i=n.lerpLo(0,c,e),s=n.lerpLo(c,h,e);t=n.lerpLo(i,s,e)}else{const i=n.lerpHi(0,c,e),s=n.lerpHi(c,h,e);t=n.lerpHi(i,s,e)}return t*bt(a,1,e).length()}));return new n.Point2D(u,m)}function pt(e){e.m_cachedValues=null}function gt(e){if(e.m_cachedValues)return e.m_cachedValues;const t=new ut;return _t(e,t.specialPoints),wt(e,t),t}function _t(e,t){const i=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(i);const s=n.makeObjectArray(n.ECoordinate,8);s[0].set(0);let r=1;{const e=n.makeObjectArray(n.ECoordinate,3);!function(e,t,i=!1){const s=new n.ECoordinate(e[1][0]).subE(new n.ECoordinate(e[0][0]));t[1]=s.mul(2),t[2]=new n.ECoordinate(e[2][0]).subE(new n.ECoordinate(e[1][0])).subE(s),i?t[0].set(0):t[0].set(e[0][0])}(i,e,!1);const t=n.makeObjectArray(n.ECoordinate,2),o=new n.Envelope1D(0,1);let a=Ie(e[2].mul(2),e[1],o,t[0]);a<0&&(a=0);for(let e=0;e<a;e++)n.isOneOf(t[e].value(),0,1)||(s[r]=t[e],r++)}{const e=n.makeObjectArray(n.ECoordinate,3);!function(e,t,i=!1){const s=new n.ECoordinate(e[1][1]).subE(new n.ECoordinate(e[0][1]));t[1]=s.mul(2),t[2]=new n.ECoordinate(e[2][1]).subE(new n.ECoordinate(e[1][1])).subE(s),i?t[0].set(0):t[0].set(e[0][1])}(i,e,!1);const t=n.makeObjectArray(n.ECoordinate,2),o=new n.Envelope1D(0,1);let a=Ie(e[2].mul(2),e[1],o,t[0]);a<0&&(a=0);for(let e=0;e<a;e++)n.isOneOf(t[e].value(),0,1)||(s[r]=t[e],r++)}if(s[r].set(1),r++,r>2){n.sortRange(s,0,r,((e,t)=>e.value()-t.value()));let e=0,t=s[0].value(),i=1;for(let n=1;n<r;n++)s[n].eq(s[n-1])?(t+=s[n].value(),i++):(i>1&&(t/=i,s[e].set(t)),e++,s[e]=s[n],t=s[n].value(),i=1);e++,r=e}s[0].set(0),s[r-1].set(1),t.length=r;for(let e=0;e<r;e++)t[e]=s[e].value()}function ft(e,t,i){const s=n.makeObjectArray(n.Point2D,3);return e.queryControlPoints(s),yt(s,t,i)}function yt(e,t,i){if(i){if(t<0)return t;if(t>1)return t-1+yt(e,1,!1)}if(1===t)return xt(e);const s=n.makeObjectArray(n.Point2D,3);return Rt(e,t,s,null),xt(s)}function xt(e){if(e[0].equals(e[1]))return n.Point2D.distance(e[2],e[0]);if(e[1].equals(e[2]))return n.Point2D.distance(e[0],e[2]);const t=n.Point2D.distance(e[0],e[1])+n.Point2D.distance(e[2],e[1]),i=n.Point2D.distance(e[0],e[2]);if(t-i<=t*Number.EPSILON)return i;const s=n.makeObjectArray(n.Point2D,3);qt(e,s,!0);const r=4*(n.sqr(s[2].x)+n.sqr(s[2].y)),o=2*(s[2].x*s[1].x+s[2].y*s[1].y),a=n.sqr(s[1].x)+n.sqr(s[1].y);if(1e-14*(Math.abs(o)+Math.abs(a))>=Math.abs(r))return 1e-14*Math.abs(a)>=Math.abs(o)?1*Math.sqrt(a):2/(3*o)*(Math.pow(1*o+a,1.5)-Math.pow(a,1.5));const l=o/r,c=a/r,h=c-l*l,u=1+l;if(0===h)return l>=0&&u>=0||l<=0&&u<=0?Math.abs(.5*Math.sqrt(r)*(u*u-l*l)):.5*Math.sqrt(r)*(u*u+l*l);const m=Math.sqrt(h+u*u),d=Math.sqrt(c);return.5*Math.sqrt(r)*(u*m-l*d+h*Math.log(Math.abs((u+m)/(l+d))))}function vt(e,t){const i=n.snap(t,0,1);let s=bt(e,1,i);return s.isZero()&&(s=bt(e,2,i)),s}function Pt(e,t,i){const s=n.makeObjectArray(n.Point2D,3);return e.queryControlPoints(s),bt(s,t,i)}function bt(e,t,i){if(1===t){const t=e[1].sub(e[0]).mul(1-i).add(e[2].sub(e[1]).mul(i));return t.mulThis(2),t}return 2===t?e[2].sub(e[1]).sub(e[1].sub(e[0]).mul(2)):n.Point2D.construct(0,0)}function Et(e){const t=n.makeObjectArray(n.Point2D,3);return e.queryControlPoints(t),St(t)}function St(e){return-e[1].sub(e[0]).crossProduct(e[2].sub(e[0]))/3}function Ct(e){return e.m_cachedValues}function wt(e,t){e.m_cachedValues=t}function Tt(e,i,s,r,o){t.checkAndThrow(n.Envelope1D.unit().contains(s),"QuadraticBezierHelper::getClosestCoordinateSegment");const a=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(a);let l=Number.MAX_VALUE;const c=[0],h=Dt(a,i,c);if(s.containsCoordinate(c[0]))l=n.Point2D.distance(i,h);else{c[0]=s.vmin,Ut(a,c[0],h),l=n.Point2D.distance(h,i);const e=new n.Point2D;Ut(a,s.vmax,e);const t=n.Point2D.distance(e,i);l>t&&(h.setCoordsPoint2D(e),c[0]=s.vmax,l=t)}if(!r)return c[0];if(s.vmin<=0){const t=new n.Point2D;e.queryCoord2DExtended(-1,t,!0);const r=new n.Point2D;e.queryCoord2D(s.vmin,r);const o=new Ar({start:t,end:r}),a=o.getClosestCoordinate(i,!0);if(a<1){const e=o.getCoord2D(a),t=n.Point2D.distance(e,i);t<l&&(l=t,c[0]=a-1,h.assign(e))}}if(s.vmin>=1){const t=new n.Point2D;e.queryCoord2DExtended(2,t,!0);const r=new n.Point2D;e.queryCoord2D(s.vmax,r);const o=new Ar({start:r,end:t}),a=o.getClosestCoordinate(i,!0);if(a>0){const e=o.getCoord2D(a),t=n.Point2D.distance(e,i);t<l&&(l=t,c[0]=1+a,h.assign(e))}}return c[0]}function Dt(e,t,i){const s=e[2].sub(e[1]).sub(e[1].sub(e[0])),r=e[1].sub(e[0]),o=e[0].sub(t),a=o.dotProduct(r),l=o.dotProduct(s)+2*r.dotProduct(r),c=3*r.dotProduct(s),h=s.dotProduct(s),u=n.makePrimitiveArray(3,Number.NaN),m=Se(h,c,l,a,n.Envelope1D.unit(),!1,u),d=e[0].clone();let p=0,g=n.Point2D.sqrDistance(e[0],t),_=n.Point2D.sqrDistance(e[2],t);_<g&&(p=1,d.assign(e[2]),g=_);for(let i=0;i<m;i++){const s=new n.Point2D;Ut(e,u[i],s),_=n.Point2D.sqrDistance(s,t),_<g&&(g=_,d.assign(s),p=u[i])}return i&&(i[0]=p),d}function It(e,t,i){if(t.equalsRange(0,1))return void i.setFromPoints(e,3);const s=n.makeObjectArray(n.Point2D,3);Ot(e,t.vmin,t.vmax,s),i.setFromPoints(s,3)}function At(e,t,i){i.setEmpty();const s=[];s.push(new n.Envelope1D(0,1));const r=.5*Math.max(t.width(),t.height());for(;s.length;){const o=s.at(-1);s.pop();const a=new p;if(It(e,o,a),a.isIntersectingW(t)){const e=Math.max(a.width(),a.height());if(t.containsW(a)||e<=r||o.width()<1e-12)i.merge(o);else{const e=o.getCenter();s.push(n.Envelope1D.construct(o.vmin,e)),s.push(n.Envelope1D.construct(e,o.vmax))}}}}function Mt(e){const t=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(t);const i=Nt(t);return i&&(e.m_cp.setCoordsPoint2D(t[1]),e.afterCompletedModification()),i}function Nt(e){let t=!1;for(let i=0;i<2;i++){const s=n.compareNoNANs(e[0][i],e[2][i]);s>0?(n.compareNoNANs(e[0][i],e[1][i])<0&&(e[1][i]=e[0][i],t=!0),n.compareNoNANs(e[1][i],e[2][i])<0&&(e[1][i]=e[2][i],t=!0)):s<0?(n.compareNoNANs(e[0][i],e[1][i])>0&&(e[1][i]=e[0][i],t=!0),n.compareNoNANs(e[1][i],e[2][i])>0&&(e[1][i]=e[2][i],t=!0)):e[1][i]!==e[0][i]&&(e[1][i]=e[0][i],t=!0)}return t}function Rt(e,t,i,s){(new n.Point2D).setCoordsPoint2D(e[0]),(new n.Point2D).setCoordsPoint2D(e[1]),(new n.Point2D).setCoordsPoint2D(e[2]);const r=new n.Point2D,o=new n.Point2D,a=new n.Point2D;if(n.lerpPoint2D(e[0],e[1],t,r),n.lerpPoint2D(e[1],e[2],t,o),n.lerpPoint2D(r,o,t,a),i&&(i[0].assign(e[0]),i[1].assign(r),i[2].assign(a)),s){const t=e[2];s[0].assign(a),s[1].assign(o),s[2].assign(t)}}function Ot(e,t,i,s){if(t===i){const i=new n.Point2D;return Ut(e,t,i),s[0]=i,s[1]=i,void(s[2]=i)}const r=n.makeObjectArray(n.Point2D,3);Rt(e,i,r,null),Rt(r,t/i,null,r),Ut(e,t,r[0]),Ut(e,i,r[2]),s[0].setCoordsPoint2D(r[0]),s[1].setCoordsPoint2D(r[1]),s[2].setCoordsPoint2D(r[2])}function Gt(e,t,i,n,s){if(s){if(0!==Er(t,i))return e?4:2}else if(E(t,i))return 1;return 0!==Vt(e,t,i,null,null,null,n,s??!1,0,!1)?4:0}function kt(e,t,i,n,s){if(s){if(0!==Er(t,i))return e?4:2}else if(E(t,i))return 1;return 0!==Ft(e,t,i,null,null,null,n,s??!1,0,!1)?4:0}function Vt(e,i,s,r,o,a,l,c,h,u){if(null!=o&&(o.length=0),null!==a&&(a.length=0),null!==r&&(r.length=0),s.isDegenerate(0)){const e=[0,0],t=i.intersectPoint(s.getStartXY(),e,l);if(t>0){if(null!==o)for(let i=0;i<t;i++)o.push(e[i]);if(null!==a)for(let e=0;e<t;e++)a.push(0);if(null!==r)for(let s=0;s<t;s++){const t=new n.Point2D;i.queryCoord2D(e[s],t),r.push(t)}}return t}const m=L(i,s);if(l=Math.max(l,m),i.isDegenerateToLineHelper(m)){const e=new Ar({start:i.getStartXY(),end:i.getEndXY()}),t=ie(e,s,r,o,a,l,c,u);if(o)for(let n=0;n<t;++n){const t=e.getCoord2D(o[n]);o[n]=i.getClosestCoordinate(t,!1)}return t}if(q(i,s,l))return 0;const d=v.constructPoint2D(s.getStartXY()),p=v.constructPoint2D(s.getEndXY()).sub(d),g=p.clone();g.leftPerpendicularThis();const _=v.constructPoint2D(i.m_cp).sub(v.constructPoint2D(i.getStartXY())),f=v.constructPoint2D(i.getEndXY()).sub(v.constructPoint2D(i.m_cp));let y=_.dotProduct(g).toDouble(),x=f.sub(_).dotProduct(g).toDouble();const P=n.makePrimitiveArray(12,Number.NaN),b=n.makePrimitiveArray(12,Number.NaN);let E=function(e,t,i,s){const r=new n.ECoordinate,o=Ie(new n.ECoordinate(e),new n.ECoordinate(t),i,r);return s[0]=r.value(),o}(x,y,n.Envelope1D.unit(),P);E<0&&(P[0]=0,P[1]=1,E=2);let S,C=0;for(let e=0,t=C;e<E;++e){const r=i.getCoord2D(P[e+t]);b[C]=s.getClosestCoordinate(r,!1),n.Point2D.distance(r,s.getCoord2D(b[C]))<=l&&(P[C]=P[e+t],C++)}const w=n.makeObjectArray(n.Point2D,3);i.queryControlPoints(w);{const e=n.makeObjectArray(v,3);if(Ht(w,e,!1),e[0]=e[0].sub(d),p.x.abs().gte(p.y.abs())){const t=p.y.div(p.x);x=e[2].y.sub(e[2].x.mul(t)).toDouble(),y=e[1].y.sub(e[1].x.mul(t)).toDouble(),S=e[0].y.sub(e[0].x.mul(t)).toDouble()}else{const t=p.x.div(p.y);x=e[2].x.sub(e[2].y.mul(t)).toDouble(),y=e[1].x.sub(e[1].y.mul(t)).toDouble(),S=e[0].x.sub(e[0].y.mul(t)).toDouble()}}const T=i.getEndXY().equals(s.getStartXY())||i.getEndXY().equals(s.getEndXY()),D=[0,0];E=Ee(x,y,S,n.Envelope1D.unit(),T,D);for(let e=0,t=C;e<E;++e){P[e+t]=D[e];const r=i.getCoord2D(P[e+t]);b[C]=s.getClosestCoordinate(r,!1),n.Point2D.distance(r,s.getCoord2D(b[C]))<=l&&(P[C]=P[e+t],C++)}t.geometryReleaseAssert(C<P.length+4),E=i.intersectPoint(s.getStartXY(),D,l);for(let e=0;e<E;e++)P[C]=D[e],b[C++]=0;E=i.intersectPoint(s.getEndXY(),D,l);for(let e=0;e<E;e++)P[C]=D[e],b[C++]=1;E=s.intersectPoint(i.getStartXY(),D,l);for(let e=0;e<E;e++)b[C]=D[e],P[C++]=0;E=s.intersectPoint(i.getEndXY(),D,l);for(let e=0;e<E;e++)b[C]=D[e],P[C++]=0;return 0===C?0:Tr(e,i,s,P,b,C,r,o,a,l,c,0,u)}function Ft(e,t,i,s,o,a,l,c,h,u){if(Zs(i))return Vt(e,t,new Ar({start:i.getStartXY(),end:i.getEndXY()}),s,o,a,l,c,0,u);const m=L(t,i);if(q(t,i,l=Math.max(l,m)))return 0;const d=[],p=[],g=n.makeObjectArray(n.Point2D,3);{t.queryControlPoints(g);const e=n.makeObjectArray(n.Point2D,3),s=new r.Transformation2D;i.canonicToWorldTransformation(s);const o=new r.Transformation2D;o.setInvert(s),o.transformPoints2D(g,3,e);const a=n.makeObjectArray(v,3);Ht(e,a);const h=[a[0].x,a[1].x,a[2].x],u=[a[0].y,a[1].y,a[2].y],m=n.makeObjectArray(n.MPValue,3);m[0].setDouble(i.getSemiMinorAxis()),m[0].sqrThis(),m[1].setDouble(i.getSemiMajorAxis()),m[1].sqrThis(),m[2]=m[0],m[2].mul(m[1]),m[2].negate();const _=Xe(h,2,u,2,null,0,m,0,n.Envelope1D.unit(),n.Envelope1D.unit(),d,c);if(_>0){let e=0;for(let s=0;s<_;s++){const r=new n.Point2D;t.queryCoord2D(d[s],r);const o=i.getClosestCoordinate(r,!1),a=new n.Point2D;i.queryCoord2D(o,a),n.Point2D.distance(r,a)<=l&&(d[e]=d[s],p.push(o),e++)}d.length=e}}const _=[0,1];for(let e=0;e<2;e++){const t=0===e?i.getStartXY():i.getEndXY(),s=[0];Dt(g,t,s);const r=new n.Point2D;Ut(g,s[0],r),n.Point2D.distance(t,r)<=l&&(d.push(s[0]),p.push(_[e]))}for(let e=0;e<2;e++){const t=[0,2];{const s=i.getClosestCoordinate(g[t[e]],!1),r=new n.Point2D;i.queryCoord2D(s,r),n.Point2D.distance(g[t[e]],r)<=l&&(d.push(_[e]),p.push(s))}}return Tr(e,t,i,d,p,d.length,s,o,a,l,c,0,u)}function Lt(e,t,i,s,r,o,a,l,c,h){const u=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(u);const m=n.makeObjectArray(n.Point2D,3);if(i.queryControlPoints(m),H(u,m,3)<0)return Lt(e,i,t,s,o,r,a,l,c,!h);const d=L(t,i);if(q(t,i,a=Math.max(a,d)))return 0;if(function(e,t,i,s,r,o,a,l,c){const h=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(h);const u=n.makeObjectArray(n.Point2D,3);if(t.queryControlPoints(u),h[0].equals(u[0])){if(h[1].equals(u[1])&&h[2].equals(u[2]))return i&&(i.length=0,i.push(h[0]),i.push(h[2])),s&&(s.length=0,s.push(0),s.push(1)),r&&(r.length=0,r.push(0),r.push(1)),!0;if(!h[0].equals(u[2]))return!1}return!!(h[0].equals(u[2])&&h[1].equals(u[1])&&h[2].equals(u[0]))&&(s&&(s.length=0,s.push(0),s.push(1),c&&(s[1]=n.swap(s[0],s[0]=s[1]))),r&&(r.length=0,r.push(1),r.push(0),c&&(r[1]=n.swap(r[0],r[0]=r[1]))),i&&(i.length=0,i.push(h[0]),i.push(h[2]),c&&(i[1]=n.swap(i[0],i[0]=i[1]))),!0)}(t,i,s,r,o,0,0,0,h))return 2;const g=new n.Envelope1D(0,1),_=new n.Envelope1D(0,1);{const e=new p;It(u,n.Envelope1D.unit(),e);const t=new p;It(m,n.Envelope1D.unit(),t);const i=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*a),t.inflate(3*a),!e.intersectW(t))return 0;if(e.maxDim()<.1*i){if(At(u,e,g),At(m,e,_),g.isEmpty()||_.isEmpty())return 0;Ot(u,g.vmin,g.vmax,u),Ot(m,_.vmin,_.vmax,m)}}const f=Dr(u,2,m,2,a);if(0===f)return 0;const y=[],x=[];if(-1===f){const e=n.makeObjectArray(v,3);Ht(u,e);const t=[e[0].x,e[1].x,e[2].x],i=[e[0].y,e[1].y,e[2].y],s=n.makeObjectArray(v,3);Ht(m,s);const r=Be(t,2,i,2,null,0,[s[0].x,s[1].x,s[2].x],2,[s[0].y,s[1].y,s[2].y],2,null,0,0,n.Envelope1D.unit(),n.Envelope1D.unit(),y,x,h,0,h);if(r>0){let e=0;for(let t=0;t<r;t++){const i=new n.Point2D,s=new n.Point2D;Ut(m,x[t],s),Ut(u,y[t],i),n.Point2D.distance(i,s)<=a&&(y[e]=y[t],x[e]=x[t],e++)}y.length=e,x.length=e}}for(let e=0;e<2;e++){const t=0===e?u:m,i=0===e?m:u;for(let s=0;s<2;s++){const r=0===s?0:2,o=[0];Dt(i,t[r],o);const l=new n.Point2D;Ut(i,o[0],l),n.Point2D.distance(t[r],l)<=a&&(0===e?(y.push(0===r?0:1),x.push(o[0])):(x.push(0===r?0:1),y.push(o[0])))}}if(0===y.length)return 0;if(!g.equalsRange(0,1))for(let e=0;e<y.length;++e)y[e]=He.recalculateParentT(g.vmin,g.vmax,y[e]);if(!_.equalsRange(0,1))for(let e=0;e<x.length;++e)x[e]=He.recalculateParentT(_.vmin,_.vmax,x[e]);return Tr(e,t,i,y,x,y.length,s,r,o,a,l,0,h)}function qt(e,t,i=!1){const n=e[1].sub(e[0]);t[1].assign(n.mul(2)),t[2].assign(e[2].sub(e[1]).sub(n)),i?t[0].setCoords(0,0):t[0].assign(e[0])}function Ht(e,t,i=!1){const s=v.constructPoint2D(e[1]),r=s.sub(v.constructPoint2D(e[0]));t[1]=r.mul(n.MPValue.constructInt32(2)),t[2]=v.constructPoint2D(e[2]).sub(s).sub(r),t[0]=i?new v(n.s_zero$1,n.s_zero$1):v.constructPoint2D(e[0])}function Ut(e,t,i,s){if(s){if(t<0)return void W(new Ar({start:e[0],end:e[0].add(vt(e,0).getUnitVector())}),t,i);if(t>1)return void W(new Ar({start:e[2],end:e[2].add(vt(e,1).getUnitVector())}),t-1,i)}if(t<=.5){const s=e[1].clone(),r=new n.Point2D;n.lerpPointLo(2,e[0],s,t,r);const o=new n.Point2D;n.lerpPointLo(2,s,e[2],t,o);const a=new n.Point2D;n.lerpPointLo(2,r,o,t,a),i.assign(a)}else{const s=e[1].clone(),r=new n.Point2D;n.lerpPointHi(2,e[0],s,t,r);const o=new n.Point2D;n.lerpPointHi(2,s,e[2],t,o);const a=new n.Point2D;n.lerpPointHi(2,r,o,t,a),i.assign(a)}}function zt(e,t){let i=1;e[1].isEqualPoint2D(e[0])&&(i=2,e[2].isEqualPoint2D(e[0])&&(i=3));let s=2;e[2].isEqualPoint2D(e[3])&&(s=1,e[1].isEqualPoint2D(e[3])&&(s=0)),t[0].assign(e[0]),t[2].assign(e[3]);const r=n.Point2D.intersectLinesAtOnePoint(e[0],e[i],e[s],e[3]),o=new n.Point2D;n.lerpPoint2D(e[0],e[3],.5,o);const a=new n.Point2D;Li(e,.5,a);const l=new n.Point2D;t[1].assign(r),Ut(t,.5,l);const c=new n.Point2D;t[1].assign(o),Ut(t,.5,c);const h=n.Point2D.sqrDistance(a,l),u=n.Point2D.sqrDistance(a,c);return h<u?(t[1].setCoordsPoint2D(r),Math.sqrt(h)):(t[1].setCoordsPoint2D(o),Math.sqrt(u))}function Yt(e,t,i){i[0].assign(e[0]),i[1].assign(e[1]),i[2].assign(e[2]);const s=new n.Point2D;is(e,t,.5,s);const r=new n.Point2D;Ut(i,.5,r);const o=n.Point2D.sqrDistance(s,r);return Math.sqrt(o)}const Bt=[[.33998104358485626,.6521451548625461],[.8611363115940526,.34785484513745385]],Xt=[[.1834346424956498,.362683783378362],[.525532409916329,.31370664587788727],[.7966664774136267,.22238103445337448],[.9602898564975363,.10122853629037626]],jt=[[.09501250983763744,.1894506104550685],[.2816035507792589,.18260341504492358],[.45801677765722737,.16915651939500254],[.6178762444026438,.14959598881657674],[.755404408355003,.12462897125553388],[.8656312023878318,.09515851168249279],[.9445750230732326,.062253523938647894],[.9894009349916499,.027152459411754096]],Wt=[[.04830766568773832,.0965400885147278],[.1444719615827965,.09563872007927486],[.23928736225213706,.09384439908080457],[.33186860228212767,.09117387869576389],[.42135127613063533,.08765209300440381],[.5068999089322294,.08331192422694675],[.5877157572407623,.07819389578707031],[.6630442669302152,.0723457941088485],[.7321821187402897,.06582222277636185],[.7944837959679424,.058684093478535544],[.84936761373257,.050998059262376175],[.8963211557660521,.04283589802222668],[.9349060759377397,.03427386291302143],[.9647622555875064,.02539206530926206],[.9856115115452684,.01627439473090567],[.9972638618494816,.007018610009470096]],Zt=[[.024350292663424433,.048690957009139724],[.07299312178779904,.04857546744150343],[.12146281929612056,.048344762234802954],[.16964442042399283,.04799938859645831],[.21742364374000708,.04754016571483031],[.2646871622087674,.04696818281621002],[.31132287199021097,.046284796581314416],[.3572201583376681,.04549162792741814],[.4022701579639916,.044590558163756566],[.4463660172534641,.04358372452932345],[.48940314570705296,.04247351512365359],[.5312794640198946,.04126256324262353],[.571895646202634,.03995374113272034],[.6111553551723933,.038550153178615626],[.6489654712546573,.03705512854024005],[.6852363130542333,.035472213256882386],[.7198818501716109,.033805161837141606],[.7528199072605319,.03205792835485155],[.7839723589433414,.030234657072402478],[.8132653151227975,.028339672614259483],[.8406292962525803,.02637746971505466],[.8659993981540928,.024352702568710874],[.8893154459951141,.022270173808383253],[.9105221370785028,.02013482315353021],[.9295691721319396,.017951715775697343],[.9464113748584028,.015726030476024718],[.9610087996520538,.013463047896718643],[.973326827789911,.011168139460131128],[.983336253884626,.008846759826363947],[.9910133714767443,.006504457968978363],[.9963401167719553,.004147033260562468],[.9993050417357722,.001783280721696433]],Qt=[[.012223698960615764,.024446180196262518],[.03666379096873349,.024431569097850044],[.06108196960413957,.02440235563384958],[.08546364050451549,.024358557264690626],[.10979423112764375,.024300200167971867],[.13405919946118777,.02422731922281525],[.15824404271422493,.024139957989019287],[.18233430598533718,.024038168681024052],[.2063155909020792,.023922012136703457],[.23017356422666,.023791557781003402],[.2538939664226943,.023646883584447616],[.2774626201779044,.02348807601653591],[.3008654388776772,.02331522999406276],[.32408843502441337,.023128448824387027],[.3471177285976355,.022927844143686846],[.369939555349859,.02271353585023646],[.39254027503326744,.022485652032744968],[.414906379552275,.022244328893799764],[.43702450103710416,.02198971066846049],[.4588814198335522,.021721949538052076],[.48046407240417205,.02144120553920846],[.5017595591361445,.02114764646822135],[.5227551520511755,.02084144778075115],[.5434383024128103,.02052279248696007],[.5637966482266181,.020191871042130043],[.5838180216287631,.01984888123283086],[.6034904561585486,.019494028058706602],[.6228021939105849,.019127523609950944],[.6417416925623075,.01874958694054471],[.660297632272646,.01836044393733134],[.6784589224477192,.017960327185008687],[.6962147083695144,.017549475827117706],[.7135543776835874,.01712813542311138],[.7304675667419088,.016696557801589205],[.746944166797062,.016255000909785187],[.7629743300440948,.015803728659399347],[.7785484755064119,.015343010768865144],[.7936572947621933,.014873122602147314],[.8082917575079137,.014394345004166847],[.8224431169556439,.013906964132951985],[.8361029150609068,.013411271288616333],[.8492629875779689,.012907562739267348],[.8619154689395485,.012396139543950923],[.8740527969580318,.01187730737274028],[.8856677173453972,.011351376324080417],[.8967532880491582,.010818660739503076],[.9073028834017568,.010279479015832158],[.9173101980809605,.009734153415006806],[.9267692508789478,.009183009871660874],[.9356743882779164,.00862637779861675],[.9440202878302202,.008064589890486059],[.9518019613412644,.0074979819256347285],[.9590147578536999,.006926892566898814],[.9656543664319652,.006351663161707189],[.9717168187471366,.005772637542865698],[.9771984914639074,.00519016183267633],[.9820961084357185,.004604584256702955],[.9864067427245862,.004016254983738642],[.9901278184917344,.0034255260409102157],[.9932571129002129,.0028327514714579912],[.9957927585349812,.0022382884309626186],[.997733248625514,.0016425030186690294],[.9990774599773758,.0010458126793403489],[.9998248879471319,.00044938096029209035]];function $t(e,t,i,s){const r=.5*(s-i),o=i+r,a=new n.KahanSummator(0);for(let i=0,s=Math.trunc(e/2);i<s;++i){let s,l;switch(e){case 4:s=Bt[i][0],l=Bt[i][1];break;case 8:s=Xt[i][0],l=Xt[i][1];break;case 16:s=jt[i][0],l=jt[i][1];break;case 32:s=Wt[i][0],l=Wt[i][1];break;case 64:s=Zt[i][0],l=Zt[i][1];break;case 128:s=Qt[i][0],l=Qt[i][1];break;default:throw new Error("Quadrature_integral: invalid n")}const c=n.fma(-.5,s,o),h=n.fma(r,s,o);a.pe(t(c)*l),a.pe(t(h)*l)}return a.getResult()*r}class Kt extends _e{constructor(e){e?e.vd?(super({vd:e.vd,bPolygon:!0}),this.m_segmentBufferCTor=Mr):e.copy?(super({vd:e.copy.getDescription(),bPolygon:!0}),this.m_segmentBufferCTor=Mr,e.copy.copyTo(this)):e.move?(super({move:e.move}),this.m_segmentBufferCTor=Mr):e.envelope?t.throwNotImplementedException("envelope constructor not impl"):t.throwInternalErrorException("bad arg to polygon constructor"):(super({bPolygon:!0}),this.m_segmentBufferCTor=Mr)}assignMove(e){return e.copyTo(this),this}assignCopy(e){return e.copyTo(this),this}getBoundary(){return ve(this)}getExteriorRingCount(){return this.getOGCPolygonCount()}getGeometryType(){return Kt.type}getDimension(){return 2}createInstance(){return new Kt({vd:this.getDescription()})}equals(e,t){return this.equalsBase(e,t)}}Kt.type=t.GeometryType.enumPolygon;var Jt=i.VertexDescription;const ei=-1;class ti{constructor(e){this.m_shape=e}userSort(e,t,i){this.m_shape.sortVerticesSimpleByYHelper(i,e,t)}getValue(e){return this.m_shape.getY(e)}}class ii{constructor(e){!function(e){return void 0!==e.parent}(e)?(this.m_parent=e.copy.m_parent,this.m_geometry=e.copy.m_geometry,this.m_path=e.copy.m_path,this.m_vertex=e.copy.m_vertex,this.m_index=e.copy.m_index,this.m_bSkipMultiPoints=e.copy.m_bSkipMultiPoints,this.m_firstVertex=e.copy.m_firstVertex,this.m_bFirst=!0,this.m_selection=e.copy.m_selection,this.m_bOneGeom=e.copy.m_bOneGeom):(this.m_parent=e.parent,this.m_geometry=e.geometry,this.m_path=e.path,this.m_vertex=e.vertex,this.m_firstVertex=e.firstVertex,this.m_index=e.selection?0:e.index,this.m_bSkipMultiPoints=e.bSkipMultiPoints,this.m_selection=e.selection,this.m_bOneGeom=e.bOneGeom,this.m_bFirst=!0)}moveToNextHelper(){for(this.m_path=this.m_parent.getNextPath(this.m_path),this.m_index=0;this.m_geometry!==ei;){for(;this.m_path!==ei;this.m_path=this.m_parent.getNextPath(this.m_path))if(this.m_vertex=this.m_parent.getFirstVertex(this.m_path),this.m_firstVertex=this.m_vertex,this.m_vertex!==ei)return this.m_vertex;if(this.m_bOneGeom)return ei;if(this.m_geometry=this.m_parent.getNextGeometry(this.m_geometry),this.m_geometry===ei)break;this.m_bSkipMultiPoints&&!t.isMultiPath(this.m_parent.getGeometryType(this.m_geometry))||(this.m_path=this.m_parent.getFirstPath(this.m_geometry))}return ei}nextSelection(){for(;this.m_index<this.m_parent.m_selectedVertices.length;){const e=this.m_parent.m_selectedVertices[this.m_index++];if(e!==ei&&(this.m_path=this.m_parent.getPathFromVertex(e),!this.m_bOneGeom||this.m_geometry===this.m_parent.getGeometryFromPath(this.m_path)))return this.m_geometry=this.m_parent.getGeometryFromPath(this.m_path),e}return ei}next(){return this.m_selection?this.nextSelection():this.m_bFirst?(this.m_bFirst=!1,this.m_vertex):this.m_vertex!==ei?(this.m_vertex=this.m_parent.getNextVertex(this.m_vertex),this.m_index++,this.m_vertex!==ei&&this.m_vertex!==this.m_firstVertex?this.m_vertex:this.moveToNextHelper()):ei}currentGeometry(){return this.m_geometry}currentPath(){return this.m_path}static create_(e,t,i,n,s,r,o,a,l){return new ii({parent:e,geometry:t,path:i,vertex:n,firstVertex:s,index:r,bSkipMultiPoints:o,selection:a,bOneGeom:l})}}class ni{constructor(e){this.parentage=e}equals(e){return this.parentage===e.parentage}}class si{setPrevPath(e,t){this.m_pathIndexList.setField(e,1,t)}setNextPath(e,t){this.m_pathIndexList.setField(e,2,t)}setPathFlags(e,t){this.m_pathIndexList.setField(e,6,t)}getPathFlags(e){return this.m_pathIndexList.getField(e,6)}setPathGeometry(e,t){this.m_pathIndexList.setField(e,7,t)}getPathIndex(e){return this.m_pathIndexList.getField(e,0)}setNextGeometry(e,t){this.m_geometryIndexList.setField(e,1,t)}setPrevGeometry(e,t){this.m_geometryIndexList.setField(e,0,t)}getGeometryIndex(e){return this.m_geometryIndexList.getField(e,7)}setFirstPath(e,t){this.m_geometryIndexList.setField(e,3,t)}setLastPath(e,t){this.m_geometryIndexList.setField(e,4,t)}newGeometry(e){const t=this.m_geometryIndexList.newElement();return this.m_geometryIndexList.setField(t,2,e),this.m_geometryIndexList.setField(t,5,0),this.m_geometryIndexList.setField(t,6,0),this.m_geometryIndexList.setField(t,7,this.m_geometryIndexList.elementToIndex(t)),t}freeGeometry(e){this.m_geometryIndexList.deleteElement(e)}newPath(e){const t=this.m_pathIndexList.newElement(),i=this.m_pathIndexList.elementToIndex(t);if(this.m_pathIndexList.setField(t,0,i),this.m_pathIndexList.setField(t,3,0),this.m_pathIndexList.setField(t,6,0),this.setPathGeometry(t,e),i>=this.m_pathAreas.length){const e=Math.trunc(i<16?16:3*i/2);this.m_pathAreas.length=e,this.m_pathLengths.length=e}return this.m_pathAreas[i]=0,this.m_pathLengths[i]=0,this.m_pathCount++,t}freePath(e){this.m_pathIndexList.deleteElement(e),this.m_pathCount--}newVertex(e){const t=this.m_vertexIndexList.newElement(),i=e>=0?e:this.m_vertexIndexList.elementToIndex(t);if(this.m_vertexIndexList.setField(t,0,i),e<0){if(i>=this.m_vertices.getPointCount()){const e=Math.trunc(i<16?16:3*i/2);this.m_vertices.reserveRounded(e),this.m_vertices.resizeNoInit(e),null!==this.m_segments&&(this.m_segments.length=e),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0)}this.m_segments&&(this.m_segments[i]=null)}return this.m_pointCount++,t}freeVertex(e){this.unselect(e);const t=this.getVertexIndex(e);this.m_vertexIndexList.deleteElement(e),this.m_pointCount--;for(let e=0,i=this.m_indices.length;e<i;e++){if(e===this.m_selectionIndex)continue;const i=this.m_indices[e];null!==i&&i.size()>t&&i.write(t,-1)}this.m_weights&&this.m_weights.size()>t&&this.m_weights.write(t,1),this.m_ranks&&this.m_ranks.size()>t&&this.m_ranks.write(t,1),this.m_segmentWeights&&this.m_segmentWeights.size()>t&&this.m_segmentWeights.write(t,1),this.m_segmentRanks&&this.m_segmentRanks.size()>t&&this.m_segmentRanks.write(t,1),this.m_segments&&this.setSegmentToIndex(t,null)}insertVertex_(e,t,i,n){this.m_hasForceSetEnvelope=0;const s=t!==ei?this.getPrevVertex(t):this.getLastVertex(e),r=s!==ei?this.getNextVertex(s):ei,o=this.newVertex(null===i?this.m_pointCount:-1),a=this.getVertexIndex(o);null!==i&&this.m_vertices.setPointByValNoCurves(a,i),this.setPathToVertex(o,e),this.setNextVertex(o,r),this.setPrevVertex(o,s),r!==ei&&this.setPrevVertex(r,o),s!==ei&&this.setNextVertex(s,o);const l=this.isClosedPath(e),c=this.getFirstVertex(e);t===ei&&this.setLastVertex(e,o),t===c&&(l&&n&&c!==ei||this.setFirstVertex(e,o)),l&&r===ei&&(this.setNextVertex(o,o),this.setPrevVertex(o,o)),this.setPathSize(e,this.getPathSize(e)+1);const h=this.getGeometryFromPath(e);return this.setGeometryVertexCount(h,this.getPointCount(h)+1),o}getHelperPoint(){return this.m_helperPoint||(this.m_helperPoint=new i.Point({vd:this.m_vertices.getDescription()}),this.m_helperPoint.setXYCoords(0,0)),this.m_helperPoint}addMultiPoint(e,t){const i=this.createGeometry(e.getGeometryType(),e.getDescription());return this.appendMultiPoint(i,e,t),i}addPoint_(e,i){const n=this.createGeometry(t.GeometryType.enumMultiPoint,e.getDescription());return this.appendPoint(n,e,i),n}appendMultiPath_(e,t){if(t.isEmpty())return;const i=t.getImpl();this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+i.getPointCount()),this.m_verticesMp.addPoints(t,0,i.getPointCount()),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);const n=null!==this.m_segments||null!==i.getSegmentFlagsStreamRef();this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+i.getPointCount()),this.m_pathIndexList.setCapacity(this.m_pathIndexList.size()+i.getPathCount());for(let t=0,s=i.getPathCount();t<s;t++){if(0===i.getPathSize(t))continue;const s=this.insertPath(e,ei);this.setClosedPath(s,i.isClosedPath(t));for(let e=i.getPathStart(t),r=i.getPathEnd(t);e<r;e++){const t=this.insertVertex_(s,ei,null,!1);if(n){const n=this.getVertexIndex(t);if(1&i.getSegmentFlags(e))this.setSegmentToIndex(n,null);else{const t=new Mr;i.querySegment(e,t,!0),this.setSegmentToIndex(n,t.releaseSegment())}}}i.isStrongPathStart(t)&&this.setStrongPathStart(s,!0),i.isStrongPathEnd(t)&&this.setStrongPathEnd(s,!0)}}addMultiPath(e,i){const n=this.createGeometry(e.getGeometryType(),e.getDescription());return e.getGeometryType()===t.GeometryType.enumPolygon&&this.setFillRule(n,e.getFillRule()),this.appendMultiPath(n,e,i),n}appendMultiPathPolyline(e,t,i){const n=t.getImpl(),r=null!==this.m_segments||null!==n.getSegmentFlagsStreamRef(),o=new s.Envelope2D;t.queryEnvelope(o);{const s=i.clone();let o=n.getPointCount();const a=n.getAccelerators();if(a&&a.getQuadTree()&&(o=a.getQuadTree().getIntersectionCount(s,0,n.getPointCount()+1)),o<t.getPointCount()){if(0===o)return;const i=n.queryLimitedSegmentIterator(s);let a=-1,l=-100,c=-1,h=0,u=-1,m=ei,d=!1,p=i.nextSegment();if(null!==p)for(;;p=i.nextSegment()){let s=null===p;const o=null!==p?i.getPathIndex():a,g=null!==p?i.getStartPointIndex():l;if(s||(a===o&&l+1===g?h++:s=!0),s){if(-1!==u){let e=-1,i=-1;if(h===c){this.setClosedPath(m,d);const s=n.getPathEnd(a);this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+s-u),this.m_verticesMp.addPoints(t,u,s),i=n.getPathSize(a),e=s-1}else if(!d||l+1<n.getPathEnd(a))this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+l+2-u),this.m_verticesMp.addPoints(t,u,l+2),i=l-u+2,e=l;else{this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+l+2-u),this.m_verticesMp?.addPoints(t,u,l+1),e=l,i=l-u+1;const s=n.getPathStart(a);this.m_verticesMp.addPoints(t,s,s+1),i+=1}this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);for(let t=0,s=u;t<i;t++,s++){const t=this.insertVertex_(m,ei,null,!1);if(r){const i=this.getVertexIndex(t);if(1&n.getSegmentFlags(s)||s>e)this.setSegmentToIndex(i,null);else{const e=new Mr;n.getSegmentBuffer(s,e,!0),this.setSegmentToIndex(i,e.releaseSegment())}}}}if(null===p)break;h=1,u=g,a!==o?(m=this.insertPath(e,ei),this.setClosedPath(m,!1),c=n.getSegmentCountPath(o),d=n.isClosedPath(o),a=o):m=this.insertPath(e,ei)}l=g}return}}this.appendMultiPath_(e,t)}appendMultiPathPolygon(e,i,r){const o=i.getImpl(),a=null!==this.m_segments||null!==o.getSegmentFlagsStreamRef(),l=s.Envelope2D.constructEmpty();i.queryEnvelope(l),t.geometryReleaseAssert(r.isIntersecting(l)&&!r.containsEnvelope(l));let c=s.Envelope2D.construct(Number.NEGATIVE_INFINITY,r.ymin,Number.POSITIVE_INFINITY,r.ymax),h=s.Envelope2D.construct(r.xmin,Number.NEGATIVE_INFINITY,r.xmax,Number.POSITIVE_INFINITY);const u=o.getAccelerators();if(u&&u.getQuadTree()){const e=u.getQuadTree(),t=e.getIntersectionCount(c,0,0);t>e.getIntersectionCount(h,0,t+1)&&(h=n.swap(c,c=h))}else c.height()>h.width()&&(h=n.swap(c,c=h));const m=[],d=o.queryLimitedSegmentIterator(c);let p=-1,g=-100,_=-1,f=0,y=-1,x=-1,v=ei,P=!0,b=d.nextSegment();if(null!==b)for(;;b=d.nextSegment()){let r=null===b;const l=null!==b?d.getPathIndex():p,c=null!==b?d.getStartPointIndex():g;if(r||(l===p?g+1===c?f++:r=!0:(r=p>=0,p<0&&(p=l,_=o.getSegmentCountPath(p),y=c,v=ei,f=1))),r){if(0!==m.length||_!==f){0!==m.length&&m[0].first===y||(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.addPoints(i,y,y+1),-1===x&&(x=y),v===ei&&(v=this.insertPath(e,ei),this.setClosedPath(v,!0)),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.insertVertex_(v,ei,null,!1));for(const{first:n,second:s}of m){-1===x&&(x=n);let r=-1,l=-1;const c=n+s-1;if(s===_){const e=c+1;l=e-n,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+l),this.m_verticesMp.addPoints(i,n,e),r=c,t.geometryReleaseAssert(1===m.length)}else if(c+1<o.getPathEnd(p)){const e=c+2;l=e-n,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+l),this.m_verticesMp.addPoints(i,n,e),r=c}else{const e=o.getPathStart(p),t=e!==x?1:0,s=c+1;l=s-n+t,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+(s-n)+t),this.m_verticesMp.addPoints(i,n,s),r=c,t>0&&this.m_verticesMp?.addPoints(i,e,e+1)}this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),v===ei&&(v=this.insertPath(e,ei),this.setClosedPath(v,!0));for(let e=0,t=n;e<l;e++,t++){const e=this.insertVertex_(v,ei,null,!1);if(a){const i=this.getVertexIndex(e);if(1&o.getSegmentFlags(t)||t>r)this.setSegmentToIndex(i,null);else{const e=new Mr;o.getSegmentBuffer(t,e,!0),this.setSegmentToIndex(i,e.releaseSegment())}}}}if(0===m.length||m.at(-1).first+m.at(-1).second!==y+f){let e=y+f;e===i.getPathEnd(p)&&(e=i.getPathStart(p)),x!==e&&(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.addPoints(i,e,e+1),this.insertVertex_(v,ei,null,!1))}}m.length=0,P=!0,l!==p&&(p=l,_=o.getSegmentCountPath(p),v=ei,x=-1),y=c,f=1}if(!b)break;{const e=s.Envelope2D.constructEmpty();b.queryLooseEnvelope(e),h.isIntersecting(e)?(P?m.push(n.makePair(c,1)):m.at(-1).second++,P=!1):P=!0}g=c}}appendMultiPath(e,i,n){if(void 0===n)return void this.appendMultiPath_(e,i);if(i.isEmpty())return;const r=i.getGeometryType()===t.GeometryType.enumPolygon,o=s.Envelope2D.constructEmpty();i.queryEnvelope(o),n.isIntersecting(o)&&(!n.containsEnvelope(o)&&i.getPointCount()>10?r?this.appendMultiPathPolygon(e,i,n):this.appendMultiPathPolyline(e,i,n):this.appendMultiPath_(e,i))}appendPoint(e,t,i){if(t.isEmpty())return;if(void 0!==i&&!i.contains(t.getXY()))return;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.add(t),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+1);const n=this.insertPath(e,ei);this.insertVertex_(n,ei,null,!1)}appendMultiPoint_(e,t){this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+t.getPointCount()),this.m_verticesMp.addPoints(t,0,t.getPointCount()),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+t.getPointCount());const i=this.insertPath(e,ei);for(let e=0,n=t.getPointCount();e<n;e++)this.insertVertex_(i,ei,null,!1)}appendMultiPoint(e,t,i){if(void 0===i)return void this.appendMultiPoint_(e,t);const n=t.getAttributeStreamRef(0);let s=0;for(let e=0,r=t.getPointCount();e<r;e++){const t=n.readPoint2D(2*e);i.contains(t)&&s++}this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+s);let r=-1,o=-1,a=0;for(let e=0,s=t.getPointCount();e<s;e++){const s=n.readPoint2D(2*e);i.contains(s)?(-1===r&&(r=e,o=e),o++):r>=0&&(this.m_verticesMp.addPoints(t,r,o-r),r=-1,a++)}if(r>0&&(this.m_verticesMp.addPoints(t,r,o-r),a++),!a)return;this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+s);const l=this.insertPath(e,ei);for(let e=0,s=t.getPointCount();e<s;e++){const t=n.readPoint2D(2*e);i.contains(t)&&this.insertVertex_(l,ei,null,!1)}}splitSegmentForward(e,i,n,s,r){const o=this.getNextVertex(e);o===ei&&t.throwInvalidArgumentException("Edit_shape.split_segment_forward_");const a=this.getHelperPoint(),l=this.getPathFromVertex(e);let c=e;const h=this.hasSegmentParentage();for(let e=0,s=i.getResultSegmentCount(n);e<s;e++){const u=this.getVertexIndex(c),m=this.getNextVertex(c),d=i.getResultSegment(n,e);let p=null;if(d.getGeometryType()!==t.GeometryType.enumLine&&(p=d.clone(),p.dropAllAttributes()),0===e&&(d.queryStart(a),this.setSegmentToIndex(u,null),this.setPointEx(c,a,i.getResultSegmentStartPointRank(n,e),i.getResultSegmentStartPointWeight(n,e),r)),this.setSegmentRank(c,i.getResultSegmentInteriorRank(n,e)),this.setSegmentWeight(c,i.getResultSegmentInteriorWeight(n,e)),h){const t=i.getResultSegmentSegmentParentage(n,e),s=i.getResultSegmentStartPointIsBreak(n,e);this.setSegmentParentageAndBreak(c,t,s)}if(d.queryEnd(a),e<s-1){this.setSegmentToIndex(u,p);const t=this.insertVertex(l,m,a);this.setWeight(t,i.getResultSegmentEndPointWeight(n,e)),this.setRank(t,i.getResultSegmentEndPointRank(n,e)),this.select(t),c=t}else{this.setPointEx(o,a,i.getResultSegmentEndPointRank(n,e),i.getResultSegmentEndPointWeight(n,e),r);const t=i.getResultSegmentEndPointIsBreak(n,e);this.setSegmentParentageBreakVertex(o,t),this.setSegmentToIndex(u,p)}}}splitSegmentBackward(e,i,n,s,r){const o=this.getNextVertex(e);o===ei&&t.throwInvalidArgumentException("Edit_shape.split_segment_backward_");const a=this.getHelperPoint(),l=this.getPathFromVertex(e);let c=e;const h=this.hasSegmentParentage();for(let e=0,s=i.getResultSegmentCount(n);e<s;e++){const u=s-e-1,m=this.getVertexIndex(c),d=this.getNextVertex(c),p=i.getResultSegment(n,u);let g=null;if(p.getGeometryType()!==t.GeometryType.enumLine&&(g=p.clone(),g.reverse(),g.dropAllAttributes()),0===e&&(p.queryEnd(a),this.setSegmentToIndex(m,null),this.setPointEx(c,a,i.getResultSegmentEndPointRank(n,u),i.getResultSegmentEndPointWeight(n,u),r),this.setSegmentParentageAndBreak(c,i.getResultSegmentSegmentParentage(n,u),i.getResultSegmentEndPointIsBreak(n,u))),p.getGeometryType()===t.GeometryType.enumLine?this.setSegmentToIndex(m,null):this.setSegmentToIndex(m,g),this.setSegmentRank(c,i.getResultSegmentInteriorRank(n,u)),this.setSegmentWeight(c,i.getResultSegmentInteriorWeight(n,u)),p.queryStart(a),e<s-1){const e=this.insertVertex(l,d,a);this.setWeight(e,i.getResultSegmentStartPointWeight(n,u)),this.setRank(e,i.getResultSegmentStartPointRank(n,u)),this.select(e),c=e,h&&this.setSegmentParentageAndBreak(e,i.getResultSegmentSegmentParentage(n,u),i.getResultSegmentEndPointIsBreak(n,u))}else this.setPointEx(o,a,i.getResultSegmentStartPointRank(n,u),i.getResultSegmentStartPointWeight(n,u),r)}}selected_(e){return this.getUserIndex(e,this.m_selectionIndex)>=0}allocateIndex(e=!0){if(this.m_deletedIndices.length){const t=this.m_deletedIndices.pop();return e&&t.setRange(-1,0,t.size()),t}return e?i.createIndexStream(0,-1):i.createIndexStream(0)}recycleUserIndex(e){this.m_deletedIndices.push(e)}allocatePathIndex(){if(this.m_deletedPathIndices.length){const e=this.m_deletedPathIndices.at(-1);return this.m_deletedPathIndices.pop(),e}return i.createIndexStream(0)}recyclePathUserIndex(e){this.m_deletedPathIndices.push(e)}peelALoop_(e,t,i){const s=this.getNextVertex(e),r=this.getNextVertex(t),o=this.getVertexIndex(e),a=this.getVertexIndex(t);if(this.setNextVertex(e,r),this.setPrevVertex(r,e),this.setNextVertex(t,s),this.setPrevVertex(s,t),this.m_segments){const e=this.getSegmentFromIndex(o),t=this.getSegmentFromIndex(a);this.setSegmentToIndex(a,null),this.setSegmentToIndex(o,t),this.setSegmentToIndex(a,e)}if(this.hasSegmentParentage()){let i=this.getSegmentParentage(t),s=this.getSegmentParentage(e);-1===i&&-1===s||(s=n.swap(i,i=s),this.setSegmentParentageAndBreak(e,s),this.setSegmentParentageAndBreak(t,i))}if(i){const t=this.getPathFromVertex(e),i=this.getGeometryFromPath(t),n=[!1],o=this.insertClosedPath(i,ei,s,this.getFirstVertex(t),n);n[0]&&this.setFirstVertex(t,r);let a=this.getPathSize(t);return a-=this.getPathSize(o),this.setPathSize(t,a),o}return ei}sortVerticesSimpleByYHelper(e,t,i){e.sort(t,i,((e,t)=>{let i=this.compareVerticesSimpleY(e,t);if(0===i){const n=this.getPathInternalIndexFromVertex(e),s=this.getPathInternalIndexFromVertex(t);i=n<s?-1:n>s?1:0}return i}))}sortVerticesSimpleByYHelper3D(e,i,n){t.geometryReleaseAssert(0)}constructor(){this.m_verticesMp=null,this.m_vertices=null,this.m_xyStream=null,this.m_vertexDescription=null,this.m_segments=null,this.m_weights=null,this.m_ranks=null,this.m_segmentWeights=null,this.m_segmentRanks=null,this.m_indices=[],this.m_deletedIndices=[],this.m_pathAreas=[],this.m_pathLengths=[],this.m_pathindices=[],this.m_deletedPathIndices=[],this.m_geometryIndices=[],this.m_selectedVertices=[],this.m_helperPoint=null,this.m_forceSetEnvelope=i.Envelope3D.constructEmpty(),this.m_hasForceSetEnvelope=0,this.m_workPoint2D=n.Point2D.getNAN(),this.m_workPoint2_2D=n.Point2D.getNAN(),this.m_curveStitcher=null,this.m_pathCount=0,this.m_pointCount=0,this.m_firstGeometry=ei,this.m_lastGeometry=ei,this.m_vertexIndexList=new i.StridedIndexTypeCollection(5),this.m_pathIndexList=new i.StridedIndexTypeCollection(8),this.m_geometryIndexList=new i.StridedIndexTypeCollection(8),this.m_bHasAttributes=!1,this.m_selectedCount=0,this.m_selectionIndex=-1,this.m_selection=!1,this.m_bucketSort=new i.BucketSort,this.m_segmentParentageIndex=-1}getTotalPointCount(){return this.m_pointCount}getEnvelope2D(e){if(0!==this.m_hasForceSetEnvelope)return new s.Envelope2D(this.m_forceSetEnvelope.xmin,this.m_forceSetEnvelope.ymin,this.m_forceSetEnvelope.xmax,this.m_forceSetEnvelope.ymax);const t=this.hasCurves(),i=s.Envelope2D.constructEmpty(),n=this.queryVertexIterator();let r=!0;for(let e=n.next();e!==ei;e=n.next()){if(r?i.merge(this.getXY(e)):i.mergeNe(this.getXY(e)),t){const t=this.getSegment(e);if(null!==t){const e=s.Envelope2D.constructEmpty();t.queryLooseEnvelope(e),i.mergeEnvelope2D(e)}}r=!1}return i}getEnvelope3D(e){return t.geometryReleaseAssert(0),i.Envelope3D.constructEmpty()}forceSetEnvelope2D(e){this.m_hasForceSetEnvelope=1,this.m_forceSetEnvelope.setCoords(e.xmin,e.ymin,0,e.xmax,e.ymax,0)}forceSetEnvelope3D(e){t.geometryReleaseAssert(0)}forgetForceSetEnvelope(){this.m_hasForceSetEnvelope=0}getGeometryCount(){return this.m_geometryIndexList.size()}addGeometry(e,i){const n=e.getGeometryType();if(t.isMultiPath(n))return this.addMultiPath(e,i);if(n===t.GeometryType.enumMultiPoint)return this.addMultiPoint(e,i);if(n===t.GeometryType.enumPoint)return this.addPoint_(e,i);if(n===t.GeometryType.enumEnvelope){const t=new Kt;return t.addEnvelope(e,!1),this.addMultiPath(t,i)}t.throwInvalidArgumentException("")}appendGeometry(e,i){this.mergeVertexDescription(i.getDescription());const n=i.getGeometryType();t.isMultiPath(n)?this.appendMultiPath(e,i):n!==t.GeometryType.enumMultiPoint?t.throwInvalidArgumentException(""):this.appendMultiPoint(e,i)}assignRankToGeometryVertices(e,t){t<1&&(t=1);const i=this.queryVertexIterator();for(let e=i.next();e!==ei;e=i.next())this.setRank(e,t),this.setSegmentRank(e,t)}collapseAllGeometriesToFirst(){this.collapseGeometriesToFirst(t.GeometryType.enumUnknown)}collapseGeometriesToFirst(e){this.dbgVerifyVertexCounts();let i=ei,n=-1,s=-1;for(let r=this.getFirstGeometry();r!==ei;)if(e!==t.GeometryType.enumUnknown&&this.getGeometryType(r)!==e)r=this.getNextGeometry(r);else{if(i===ei){i=r,n=this.getPathCount(i),s=this.getPointCount(i),r=this.getNextGeometry(r);continue}for(let e=this.getFirstPath(r);e!==ei;e=this.getNextPath(e))this.setPathGeometry(e,i);n+=this.getPathCount(r),s+=this.getPointCount(r);const e=this.getLastPath(i),t=this.getFirstPath(r);e!==ei?this.setNextPath(e,t):this.setFirstPath(i,t),t!==ei&&(this.setPrevPath(t,e),this.setLastPath(i,this.getLastPath(r))),this.setFirstPath(r,ei),this.setLastPath(r,ei);const o=r;r=this.getNextGeometry(r),this.setGeometryVertexCount(o,0),this.removeGeometry(o)}return i!==ei&&(this.setGeometryVertexCount(i,s),this.setGeometryPathCount(i,n),this.dbgVerifyVertexCounts()),i}setFillRule(e,t){let i=this.m_geometryIndexList.getField(e,2);i&=-134217729,i|=1===t?134217728:0,this.m_geometryIndexList.setField(e,2,i)}getFillRule(e){return 134217728&this.m_geometryIndexList.getField(e,2)?1:0}setGeometryModified(e,t){let i=this.m_geometryIndexList.getField(e,2);!!(67108864&i)!==t&&(i&=-67108865,i|=t?67108864:0,this.m_geometryIndexList.setField(e,2,i))}getGeometryModified(e){return!!(67108864&this.m_geometryIndexList.getField(e,2))}setGeometryModifiedWithVertex(e,t){const i=this.getPathFromVertex(e),n=this.getGeometryFromPath(i);this.setGeometryModified(n,t)}getGeometryModifiedWithVertex(e){const t=this.getPathFromVertex(e),i=this.getGeometryFromPath(t);return this.getGeometryModified(i)}swapGeometry(e,t){const i=this.getFirstPath(e),n=this.getFirstPath(t),s=this.getLastPath(e),r=this.getLastPath(t);for(let i=this.getFirstPath(e);i!==ei;i=this.getNextPath(i))this.setPathGeometry(i,t);for(let i=this.getFirstPath(t);i!==ei;i=this.getNextPath(i))this.setPathGeometry(i,e);this.setFirstPath(e,n),this.setFirstPath(t,i),this.setLastPath(e,r),this.setLastPath(t,s);const o=this.getPointCount(e),a=this.getPathCount(e),l=this.getPointCount(t),c=this.getPathCount(t);this.setGeometryVertexCount(e,l),this.setGeometryVertexCount(t,o),this.setGeometryPathCount(e,c),this.setGeometryPathCount(t,a);const h=this.m_geometryIndexList.getField(e,2),u=this.m_geometryIndexList.getField(t,2);this.m_geometryIndexList.setField(e,2,u),this.m_geometryIndexList.setField(t,2,h)}addPathFromMultiPath(e,i,n){const s=this.createGeometry(n?t.GeometryType.enumPolygon:t.GeometryType.enumPolyline,e.getDescription()),r=e.getImpl();if(e.getPathSize(i)<2)return s;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+e.getPathSize(i)),this.m_verticesMp.addPoints(e,e.getPathStart(i),r.getPathEnd(i)),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);const o=this.insertPath(s,ei);this.setClosedPath(o,r.isClosedPath(i)||n);const a=null!==this.m_segments||null!==r.getSegmentFlagsStreamRef();for(let e=r.getPathStart(i),t=r.getPathEnd(i);e<t;e++){const t=this.insertVertex_(o,ei,null,!1);if(a){const i=this.getVertexIndex(t);if(1&r.getSegmentFlags(e))this.setSegmentToIndex(i,null);else{const t=new Mr;r.querySegment(e,t,!0),this.setSegmentToIndex(i,t.releaseSegment())}}}return r.isStrongPathStart(i)&&this.setStrongPathStart(o,!0),r.isStrongPathEnd(i)&&this.setStrongPathEnd(o,!0),s}getGeometry(e){const n=this.getGeometryType(e),s=function(e,n){let s,r=n,o=null;switch(r||(o=t.isMesh(e)?i.getDefaultDescription3D():i.getDefaultDescription2D(),r=o),e){case t.GeometryType.enumPoint:s=new i.Point({vd:r});break;case t.GeometryType.enumLine:s=new Ar({vd:r});break;case t.GeometryType.enumBezier:s=new dn({vd:r});break;case t.GeometryType.enumEllipticArc:s=new xs({vd:r});break;case t.GeometryType.enumRationalBezier2:s=new Le({vd:r});break;case t.GeometryType.enumBezier2:s=new He({vd:r});break;case t.GeometryType.enumEnvelope:s=new i.Envelope({vd:r});break;case t.GeometryType.enumMultiPoint:s=new d({vd:r});break;case t.GeometryType.enumPolyline:s=new ye({vd:r});break;case t.GeometryType.enumPolygon:s=new Kt({vd:r});break;case t.GeometryType.enumMultipatch:t.throwNotImplementedException("multipatch not impl");break;case t.GeometryType.enumGeometryCollection:s=new B({vd:r});break;default:t.throwInvalidArgumentException("Geometry.create")}return s}(n,this.m_verticesMp.getDescription()),r=this.getPointCount(e);if(0===r)return s;if(t.isMultiPath(n)){const t=s.getImpl(),n=this.getPathCount(e),o=i.createIndexStream(n+1),a=i.createByteStream(n+1,0),l=s.getDescription(),c=this.hasCurves();for(let s=0,c=l.getAttributeCount();s<c;s++){const c=l.getSemantics(s),h=Jt.getComponentCount(c),u=i.createAttributeStreamFromSemantics(c,r),m=this.m_vertices.getAttributeStreamRef(c);let d=0,p=0,g=0;for(let t=this.getFirstPath(e);t!==ei;t=this.getNextPath(t)){let e=0;this.isClosedPath(t)&&(e|=1),this.isExterior(t)&&(e|=8),this.isStrongPathStart(t)&&(e|=2),this.isStrongPathEnd(t)&&(e|=4),e&&a.setBits(p,e);const i=this.getPathSize(t);if(o.write(p++,g),g+=i,0===c){const e=m,i=u;let n;for(let s=this.getFirstVertex(t);d<g;s=this.getNextVertex(s),d++){const t=this.getVertexIndex(s);n=e.readPoint2D(2*t),i.writePoint2D(2*d,n)}}else for(let e=this.getFirstVertex(t);d<g;e=this.getNextVertex(e),d++){const t=this.getVertexIndex(e);for(let e=0;e<h;e++){const i=m.readAsDbl(t*h+e);u.writeAsDbl(d*h+e,i)}}}t.setAttributeStreamRef(c,u),o.write(n,r)}if(t.setPathFlagsStreamRef(a),t.setPathStreamRef(o),t.notifyModifiedFlags(65535),c){let i=0,n=0;for(let s=this.getFirstPath(e);s!==ei;s=this.getNextPath(s)){i+=this.getPathSize(s);for(let e=this.getFirstVertex(s);n<i;e=this.getNextVertex(e)){const i=this.getSegment(e);null!==i&&i.isCurve()&&t.replaceSegment(n,i,!0),n++}}}}else if(n===t.GeometryType.enumMultiPoint){const t=s.getImpl(),i=s.getDescription();t.reserve(r),t.resizeNoInit(r);for(let n=0,s=i.getAttributeCount();n<s;n++){const s=i.getSemantics(n),r=Jt.getComponentCount(s),o=t.getAttributeStreamRef(s),a=this.m_vertices.getAttributeStreamRef(s);let l=0;const c=this.getFirstPath(e),h=this.getPathSize(c);for(let e=this.getFirstVertex(c);l<h;e=this.getNextVertex(e),l++){const t=this.getVertexIndex(e);for(let e=0;e<r;e++){const i=a.readAsDbl(t*r+e);o.writeAsDbl(l*r+e,i)}}t.setAttributeStreamRef(s,o)}t.notifyModifiedFlags(65535)}else t.throwInternalErrorException("getGeometry");return s}queryPointGeometryOnly(e,i){this.getGeometryType(e)!==t.GeometryType.enumMultiPoint&&t.throwInvalidArgumentException("get_point_geometry_only");const n=this.getPointCount(e);if(n>1&&t.throwInvalidArgumentException("get_point_geometry_only"),0===n)return i.assignVertexDescription(this.m_vertexDescription),void i.setEmpty();const s=this.getFirstPath(e),r=this.getFirstVertex(s);this.queryPoint(r,i)}removeGeometry(e){for(let t=this.getFirstPath(e);t!==ei;t=this.removePath(t));const t=this.getPrevGeometry(e),i=this.getNextGeometry(e);return t!==ei?this.setNextGeometry(t,i):this.m_firstGeometry=i,i!==ei?this.setPrevGeometry(i,t):this.m_lastGeometry=t,this.freeGeometry(e),i}createGeometry(e,t){void 0===t&&(t=i.getDefaultDescription2D());const n=this.newGeometry(e);return this.m_vertices||(this.m_verticesMp=new d({vd:t}),this.m_vertices=this.m_verticesMp.getImpl()),this.mergeVertexDescription(t),this.m_firstGeometry===ei?(this.m_firstGeometry=n,this.m_lastGeometry=n):(this.setPrevGeometry(n,this.m_lastGeometry),this.setNextGeometry(this.m_lastGeometry,n),this.m_lastGeometry=n),n}getFirstGeometry(){return this.m_firstGeometry}getLastGeometry(){return this.m_lastGeometry}getNextGeometry(e){return this.m_geometryIndexList.getField(e,1)}getPrevGeometry(e){return this.m_geometryIndexList.getField(e,0)}getGeometryType(e){return 16777215&this.m_geometryIndexList.getField(e,2)}setGeometryUserIndex(e,t,i){const n=this.m_geometryIndices[t],s=this.getGeometryIndex(e);s>=n.size()&&n.resize(Math.max(1.25*s,16),-1),n.write(s,i)}getGeometryUserIndex(e,t){const i=this.getGeometryIndex(e),n=this.m_geometryIndices[t];return i<n.size()?n.read(i):-1}createGeometryUserIndex(){for(let e=0;e<this.m_geometryIndices.length;e++)if(null===this.m_geometryIndices[e])return this.m_geometryIndices[e]=i.createIndexStream(0),e;this.m_geometryIndices.push(i.createIndexStream(0));const e=this.m_geometryIndices.length-1;return t.geometryReleaseAssert(e>=0&&e<=Number.MAX_SAFE_INTEGER),e}removeGeometryUserIndex(e){for(this.m_geometryIndices[e]=null;this.m_geometryIndices.length>0&&null===this.m_geometryIndices.at(-1);)this.m_geometryIndices.pop()}getFirstPath(e){return this.m_geometryIndexList.getField(e,3)}getLastPath(e){return this.m_geometryIndexList.getField(e,4)}hasPointFeatures(){for(let e=this.getFirstGeometry();e!==ei;e=this.getNextGeometry(e))if(!t.isMultiPath(this.getGeometryType(e)))return!0;return!1}getPointCount(e){return this.m_geometryIndexList.getField(e,5)}getPathCount(e){return this.m_geometryIndexList.getField(e,6)}filterClosePoints(e,i,s,r,o){const a=e*e;let l=0;const c=this.hasCurves(),h=this.hasSegmentParentage(),u=!0;for(let e=o===ei?this.getFirstGeometry():o;e!==ei;e=o===ei?this.getNextGeometry(e):ei){const o=this.getGeometryType(e);if(!t.isMultiPath(o))continue;if(s&&o!==t.GeometryType.enumPolygon)continue;const m=this.getGeometryType(e)===t.GeometryType.enumPolygon;let d=this.getGeometryModified(e);for(let s=this.getFirstPath(e);s!==ei;){let o=0;for(let i=this.getFirstVertex(s);o<Math.trunc(this.getPathSize(s)/2);){const m=this.getNextVertex(i);if(m===ei)break;const p=this.getXY(i),g=this.getXY(m);let _=n.Point2D.sqrDistance(p,g),f=!0;do{if(_<=a){if(c){const e=this.getSegment(i);if(null!==e){const t=e.calculateLength2D();if(_=t*t,_>a)break}}if(0===_?0===l&&(l=-1):l=1,m!==this.getLastVertex(s)){const n=h&&(this.getSegmentParentageBreakVertex(i)||this.getSegmentParentageBreakVertex(m));if(this.transferAllDataToTheVertex(m,i,u),this.removeVertex(m,!1),r&&!d&&(this.setGeometryModified(e,!0),d=!0),h&&i!==m){this.setSegmentParentageBreakVertex(i,n);const e=this.getNextVertex(i);t.geometryReleaseAssert(e!==ei),this.isDiscontinuousSegmentParentage(e)&&this.setSegmentParentageBreakVertex(e,!0)}}f=!1}}while(0);f&&(i=this.getNextVertex(i)),o++}let p=this.getFirstVertex(s);for(let i=this.isClosedPath(s)?p:this.getLastVertex(s);this.getPathSize(s)>0;){const o=this.getPrevVertex(i);if(o===ei)break;{const m=this.getXY(o),g=this.getXY(i);let _=n.Point2D.sqrDistance(m,g),f=!0;do{if(_<=a){if(c){const e=this.getSegment(o);if(null!==e){const t=e.calculateLength2D();if(_=t*t,_>a)break}}if(0===_?0===l&&(l=-1):l=1,h){t.geometryReleaseAssert(this.m_segmentParentageIndex>=0);const e=this.getUserIndex(i,this.m_segmentParentageIndex);this.transferAllDataToTheVertex(o,i,u),this.setUserIndex(i,this.m_segmentParentageIndex,e)}else this.transferAllDataToTheVertex(o,i,u);const n=h&&(this.getSegmentParentageBreakVertex(i)||this.getSegmentParentageBreakVertex(o));this.removeVertex(o,!0),r&&!d&&(this.setGeometryModified(e,!0),d=!0),h&&o!==i&&(n||this.isDiscontinuousSegmentParentage(i))&&this.setSegmentParentageBreakVertex(i,!0),p===o&&(p=this.getFirstVertex(s)),f=!1}}while(0);if(f&&(i=this.getPrevVertex(i),i===p))break}}const g=this.getPathSize(s);let _=i&&g<(m?3:2);_&&m&&2===g&&c&&(_=!this.pathHasCurves(s)),_?(s=this.removePath(s),0===l&&(l=-1),r&&!d&&(this.setGeometryModified(e,!0),d=!0)):s=this.getNextPath(s)}}return l}filterClosePoints3D(e,i,n,s,r,o){return t.geometryReleaseAssert(0),0}hasDegenerateSegments(e){for(let i=this.getFirstGeometry();i!==ei;i=this.getNextGeometry(i))if(t.isMultiPath(this.getGeometryType(i)))for(let t=this.getFirstPath(i);t!==ei;){const i=this.getPathSize(t);if(0===i)return!0;let n=this.getFirstVertex(t);for(let t=0;t<i;t++){const t=this.getNextVertex(n);if(t===ei)break;const i=this.getVertexIndex(n),s=this.getSegmentFromIndex(i);let r=0;if(null!==s){if(r=s.calculateLowerLength2D(),r<=e){if(r=s.calculateUpperLength2D(),r<=e)return!0;if(r=s.calculateLength2D(),r<=e)return!0}}else{const n=this.getVertexIndex(t);if(r=this.m_vertices.getShortestDistance(i,n),r<=e)return!0}n=t}t=this.getNextPath(t)}return!1}hasDegenerateSegments3D(e,i){return t.geometryReleaseAssert(0),!1}transferAllDataToTheVertex(e,t,i=!1){const n=this.getVertexIndex(e),s=this.getVertexIndex(t);if(i){let e=1,t=1;if(this.m_ranks&&(e=this.getRankWithIndex(n),t=this.getRankWithIndex(s)),e>t&&this.setRankWithIndex(s,e),e>=t&&this.m_weights){const i=this.getWeightWithIndex(n),r=this.getWeightWithIndex(s);(e>t||i>r)&&this.setWeightWithIndex(s,i)}}else{if(this.m_weights){const e=this.getWeightWithIndex(n);this.setWeightWithIndex(s,e)}if(this.m_ranks){const e=this.getRankWithIndex(n);this.setRankWithIndex(s,e)}}if(this.m_segmentWeights){const e=this.getSegmentWeightWithIndex(n);this.setSegmentWeightWithIndex(s,e)}if(this.m_segmentRanks){const e=this.getSegmentRankWithIndex(n);this.setSegmentRankWithIndex(s,e)}for(let i=0,n=this.m_indices.length;i<n;i++)if(i!==this.m_selectionIndex&&null!==this.m_indices[i]){const n=this.getUserIndex(e,i);this.setUserIndex(t,i,n)}const r=this.selected(e);r!==this.selected(t)&&(r?this.select(t):this.unselect(t))}splitSegmentAxisAware(e,i,n,s,r){let o=0;const a=this.getNextVertex(e);a===ei&&t.throwInvalidArgumentException("");const l=this.getVertexIndex(e),c=this.getVertexIndex(a),h=this.getSegmentFromIndex(l);let u=this.m_vertices.getShortestDistance(l,c);const m=this.getPathFromVertex(e),d=this.m_bHasAttributes;d&&h&&(u=h.calculateLength2D());const p=this.getSegmentParentage(e),g=this.getHelperPoint();if(h){let e=0,t=0,r=ei;for(let _=0;_<n;_++){const n=i[_];if(e<n&&n<1){const i=h.cut(e,n);if(null!==s&&(_>0&&i.setStartXY(s[_-1]),i.setEndXY(s[_]),i.normalizeAfterEndpointChange(),t=_),d){const e=u>0?h.calculateSubLengthFromStart(n)/u:0;this.m_vertices.interpolateTwoVertices(l,c,e,g)}g.setXY(i.getEndXY()),r=this.insertVertex(m,a,g),o++;const f=this.getPrevVertex(r),y=this.getVertexIndex(f);this.setSegmentToIndex(y,i),-1!==p&&this.setSegmentParentageAndBreak(r,p,!1),e=n}}if(r!==ei){const i=h.cut(e,1);null!==s&&(i.setStartXY(s[t]),i.normalizeAfterEndpointChange());const n=this.getVertexIndex(r);this.setSegmentToIndex(n,i)}}else{let e=0;for(let t=0;t<n;t++){const n=i[t];if(e<n&&n<1){this.m_vertices.interpolateTwoVertices(l,c,n,g);const e=this.insertVertex(m,a,g);o++,-1!==p&&this.setSegmentParentageAndBreak(e,p,!1)}e=n}}return o}splitSegment(e,t,i,n=null){return this.splitSegmentAxisAware(e,t,i,n,-1)}snapControlPoints(e,i,n){this.getNextVertex(e)===ei&&t.throwInvalidArgumentException("");let s=e,r=!1;for(let e=0;e<i;++e){const e=this.getVertexIndex(s),t=this.getSegmentFromIndex(e);if(t){const e=t.snapControlPoints(n);r||=e}s=this.getNextVertex(s)}return r}snapControlPointsOnSelection(e){if(!this.hasCurves())return!1;let t=0;const i=this.queryVertexIteratorOnSelection();for(let n=i.next();n!==ei;n=i.next()){const i=this.getVertexIndex(n),s=this.getSegmentFromIndex(i);s&&(t|=s.snapControlPoints(e)?1:0)}return 0!==t}calculateSubLength2D(e,i,n){return t.geometryReleaseAssert(0),0}setPoint(e,t,i){if(this.setPointOnly(e,t),null!==this.m_segments){const n=this.getVertexIndex(e),s=this.getSegmentFromIndex(n);null!==s&&(s.setStartXY(t.getXY()),s.normalizeAfterEndpointChange(),i&&s.ensureXYMonotone());const r=this.getPrevVertex(e);if(r!==ei){const e=this.getVertexIndex(r),n=this.getSegmentFromIndex(e);null!==n&&(n.setEndXY(t.getXY()),n.normalizeAfterEndpointChange(),i&&n.ensureXYMonotone())}}}setPointEx(e,t,i,n,s){this.setPoint(e,t,s);const r=this.getVertexIndex(e);this.setWeightWithIndex(r,n),this.setRankWithIndex(r,i)}setPointOnly(e,t){const i=this.getVertexIndex(e);this.m_vertices.setPointByValNoCurves(i,t)}setPointOnlyEx(e,i,n,s){t.geometryReleaseAssert(0)}queryPoint(e,t){const i=this.getVertexIndex(e);this.m_vertices.getPointByVal(i,t)}setXY(e,t){this.setXYCoords(e,t.x,t.y)}setXYCoords(e,t,i){const n=this.getVertexIndex(e);if(this.m_vertices?.setXYCoordsNoCurves(n,t,i),null!==this.m_segments){const s=this.getSegmentFromIndex(n);null!==s&&(s.setStartXYCoords(t,i),s.normalizeAfterEndpointChange());const r=this.getPrevVertex(e);if(r!==ei){const e=this.getVertexIndex(r),n=this.getSegmentFromIndex(e);null!=n&&(n.setEndXYCoords(t,i),n.normalizeAfterEndpointChange())}}}setXYMonotonic(e,t,i){const s=this.getVertexIndex(e);if(this.m_vertices.setXYCoordsNoCurves(s,t,i),null!==this.m_segments){const r=this.getSegmentFromIndex(s);if(null!==r){const e=r.getEndXY();r.setCoordsForIntersector(new n.Point2D(t,i),e,!1),r.ensureXYMonotone()}const o=this.getPrevVertex(e);if(o!==ei){const e=this.getVertexIndex(o),s=this.getSegmentFromIndex(e);if(null!==s){const e=s.getStartXY();s.setCoordsForIntersector(e,new n.Point2D(t,i),!1),s.ensureXYMonotone()}}}}setXYMonotonicPoint2D(e,t){this.setXYMonotonic(e,t.x,t.y)}queryXY(e,t){const i=this.getVertexIndex(e);return this.m_vertices.queryXY(i,t)}getXY(e){const t=this.getVertexIndex(e);return this.m_vertices.getXY(t)}getXYWithIndex(e){return this.m_xyStream.readPoint2D(2*e)}static setSegDefault(e,i,n){t.geometryReleaseAssert(0)}setXYZ(e,i,n){t.geometryReleaseAssert(0)}setXYZCoords(e,i,n,s){t.geometryReleaseAssert(0)}queryXYZ(e,i){t.geometryReleaseAssert(0)}getXYZ(e){return t.geometryReleaseAssert(0),i.Point3D.getNAN()}getXYZWithIndex(e){return t.geometryReleaseAssert(0),i.Point3D.getNAN()}mergeVertexDescription(e){this.m_verticesMp.mergeVertexDescription(e),this.m_vertexDescription=this.m_verticesMp.getDescription(),this.m_bHasAttributes=this.m_vertexDescription.getAttributeCount()>1}addAttribute(e){t.geometryReleaseAssert(0)}getAttributeAsDbl(e,t,i){return this.m_vertices.getAttributeAsDbl(e,this.getVertexIndex(t),i)}queryAttributeAsDbl(e,i,n,s){t.geometryReleaseAssert(0)}setAttribute(e,i,n,s){t.geometryReleaseAssert(0)}setAttributeInt(e,i,n,s){t.geometryReleaseAssert(0)}getVertexDescription(){return this.m_vertexDescription}getMinPathVertexY(e){return t.geometryReleaseAssert(0),0}getVertexIndex(e){return this.m_vertexIndexList.getField(e,0)}getY(e){const t=this.getVertexIndex(e);return this.m_vertices.queryXY(t,this.m_workPoint2D),this.m_workPoint2D.y}getX(e){return this.getXY(e).x}isEqualXY(e,t){return this.queryXY(e,this.m_workPoint2D),this.queryXY(t,this.m_workPoint2_2D),this.m_workPoint2D.isEqualPoint2D(this.m_workPoint2_2D)}isEqualXYPoint2D(e,t){return this.queryXY(e,this.m_workPoint2D),this.m_workPoint2D.isEqualPoint2D(t)}isEqualXYZPoint3D(e,i){return t.geometryReleaseAssert(0),!1}setWeight(e,t){t<1&&(t=1);const n=1===t;if(null==this.m_weights){if(n)return;this.m_weights=i.createDoubleStream(this.m_vertices.getPointCount(),1)}const s=this.getVertexIndex(e);if(s>=this.m_weights.size()){if(n)return;this.m_weights.resize(s+1,1)}this.m_weights.write(s,t)}setWeightWithIndex(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_weights){if(n)return;this.m_weights=i.createDoubleStream(this.m_vertices.getPointCount(),1)}if(e>=this.m_weights.size()){if(n)return;this.m_weights.resize(e+1,1)}this.m_weights.write(e,t)}getWeight(e){if(null===this.m_weights)return 1;const t=this.getVertexIndex(e);return t>=this.m_weights.size()?1:this.m_weights.read(t)}getWeightWithIndex(e){return null===this.m_weights||e>=this.m_weights.size()?1:this.m_weights.read(e)}getRank(e){if(null===this.m_ranks)return 1;const t=this.getVertexIndex(e);return t>=this.m_ranks.size()?1:this.m_ranks.read(t)}getRankWithIndex(e){return null===this.m_ranks||e>=this.m_ranks.size()?1:this.m_ranks.read(e)}setRank(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_ranks){if(n)return;this.m_ranks=i.createIndexStream(this.m_vertices.getPointCount(),1)}const s=this.getVertexIndex(e);if(s>=this.m_ranks.size()){if(n)return;this.m_ranks.resize(s+1,1)}this.m_ranks.write(s,t)}setRankWithIndex(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_ranks){if(n)return;this.m_ranks=i.createIndexStream(this.m_vertices.getPointCount(),1)}if(e>=this.m_ranks.size()){if(n)return;this.m_ranks.resize(e+1,1)}this.m_ranks.write(e,t)}setSegmentWeight(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_segmentWeights){if(n)return;this.m_segmentWeights=i.createDoubleStream(this.m_vertices.getPointCount(),1)}const s=this.getVertexIndex(e);if(s>=this.m_segmentWeights.size()){if(n)return;this.m_segmentWeights.resize(s+1,1)}this.m_segmentWeights.write(s,t)}setSegmentWeightWithIndex(e,t){t<1&&(t=1);const n=1===t;if(null==this.m_segmentWeights){if(n)return;this.m_segmentWeights=i.createDoubleStream(this.m_vertices.getPointCount(),1)}if(e>=this.m_segmentWeights.size()){if(n)return;this.m_segmentWeights.resize(e+1,1)}this.m_segmentWeights.write(e,t)}getSegmentWeight(e){if(null===this.m_segmentWeights)return 1;const t=this.getVertexIndex(e);return t>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(t)}getSegmentWeightWithIndex(e){return null==this.m_segmentWeights||e>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(e)}getSegmentRank(e){if(null===this.m_segmentRanks)return si.st_defaultRank;const t=this.getVertexIndex(e);return t>=this.m_segmentRanks.size()?si.st_defaultRank:this.m_segmentRanks.read(t)}getSegmentRankWithIndex(e){return null===this.m_segmentRanks||e>=this.m_segmentRanks.size()?1:this.m_segmentRanks.read(e)}setSegmentRank(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_segmentRanks){if(n)return;this.m_segmentRanks=i.createIndexStream(this.m_vertices.getPointCount(),1)}const s=this.getVertexIndex(e);if(s>=this.m_segmentRanks.size()){if(n)return;this.m_segmentRanks.resize(s+1,1)}this.m_segmentRanks.write(s,t)}setSegmentRankWithIndex(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_segmentRanks){if(n)return;this.m_segmentRanks=i.createIndexStream(this.m_vertices.getPointCount(),1)}if(e>=this.m_segmentRanks.size()){if(n)return;this.m_segmentRanks.resize(e+1,1)}this.m_segmentRanks.write(e,t)}removeWeights(){this.m_weights=null,this.m_segmentWeights=null}removeRanks(){this.m_ranks=null,this.m_segmentRanks=null}setUserIndex(e,t,i){const n=this.m_indices[t],s=this.getVertexIndex(e);if(n.size()<=s){if(-1===i)return;n.resize(this.m_vertices.getPointCount(),-1)}n.write(s,i)}getUserIndex(e,t){const i=this.getVertexIndex(e),n=this.m_indices[t];return i<n.size()?n.read(i):-1}addToUserIndex(e,t,i){const n=this.m_indices[t],s=this.getVertexIndex(e);n.size()<=s&&n.resize(this.m_vertices.getPointCount(),-1);const r=n.read(s);n.write(s,r+i)}createUserIndex(){for(let e=0;e<this.m_indices.length;e++)if(null===this.m_indices[e])return this.m_indices[e]=this.allocateIndex(),e;this.m_indices.push(this.allocateIndex());const e=this.m_indices.length-1;return t.geometryReleaseAssert(e>=0&&e<=n.intMax()),e}createUserIndexUninitialized(){for(let e=0;e<this.m_indices.length;e++)if(null===this.m_indices[e])return this.m_indices[e]=this.allocateIndex(!1),e;this.m_indices.push(this.allocateIndex(!1));const e=this.m_indices.length-1;return t.geometryReleaseAssert(e>=0&&e<=Number.MAX_SAFE_INTEGER),e}fillUserIndexForGeometry(e,t,i){const n=this.m_indices[t],s=n.size();for(let t=this.getFirstPath(e);t!==ei;t=this.getNextPath(t)){let e=this.getFirstVertex(t);for(let r=0,o=this.getPathSize(t);r<o;r++,e=this.getNextVertex(e)){const t=this.getVertexIndex(e);t<s&&n.write(t,i)}}}fillUserIndexForSelection(e,i){t.geometryReleaseAssert(0)}removeUserIndex(e){for(this.recycleUserIndex(this.m_indices[e]),this.m_indices[e]=null;this.m_indices.length>0&&null===this.m_indices[this.m_indices.length-1];)this.m_indices.pop()}replaceCurveWithLine(e){if(null!==this.m_segments){const t=this.getVertexIndex(e);this.setSegmentToIndex(t,null)}}queryLineConnector(e,t,n=!1){const s=this.getNextVertex(e);if(s===ei)return!1;if(!this.m_bHasAttributes||n){const i=this.getXY(e);t.setStartXY(i);const n=this.getXY(s);t.setEndXY(n)}else{const n=new i.Point({vd:this.getVertexDescription()});this.queryPoint(e,n),t.setStart(n),this.queryPoint(s,n),t.setEnd(n)}return!0}queryLineConnector3D(e,i,n=!1){return t.geometryReleaseAssert(0),!1}hasCurves(){return null!==this.m_segments}geometryHasCurves(e){return t.geometryReleaseAssert(0),!1}pathHasCurves(e){if(!this.hasCurves())return!1;const i=this.getFirstVertex(e);if(i===ei)return!1;const n=this.getPathSize(e);let s=i;for(let e=0;e<n;e++,s=this.getNextVertex(s)){const e=this.getSegment(s);if(null!==e&&e.getGeometryType()!==t.GeometryType.enumLine)return!0}return!1}insertPath(e,i){let n=ei;i!==ei?(e!==this.getGeometryFromPath(i)&&t.throwInvalidArgumentException(""),n=this.getPrevPath(i)):n=this.getLastPath(e);const s=this.newPath(e);return i!==ei&&this.setPrevPath(i,s),this.setNextPath(s,i),this.setPrevPath(s,n),n!==ei?this.setNextPath(n,s):this.setFirstPath(e,s),i===ei&&this.setLastPath(e,s),this.setGeometryPathCount(e,this.getPathCount(e)+1),s}removePath(e){const t=this.getPrevPath(e),i=this.getNextPath(e),n=this.getGeometryFromPath(e);return t!==ei?this.setNextPath(t,i):this.setFirstPath(n,i),i!==ei?this.setPrevPath(i,t):this.setLastPath(n,t),this.clearPath(e),this.setGeometryPathCount(n,this.getPathCount(n)-1),this.freePath(e),i}clearPath(e){const t=this.getFirstVertex(e);if(t!==ei){let i=t;for(let t=0,n=this.getPathSize(e);t<n;t++){const e=i;i=this.getNextVertex(i),this.freeVertex(e)}const n=this.getGeometryFromPath(e);this.setGeometryVertexCount(n,this.getPointCount(n)-this.getPathSize(e))}this.setPathSize(e,0)}getNextPath(e){return this.m_pathIndexList.getField(e,2)}getPrevPath(e){return this.m_pathIndexList.getField(e,1)}getPathSize(e){return this.m_pathIndexList.getField(e,3)}isClosedPath(e){return!!(1&this.getPathFlags(e))}setClosedPath(e,t){if(this.isClosedPath(e)===t)return;if(this.getPathSize(e)>0){const i=this.getFirstVertex(e),n=this.getLastVertex(e);if(t){this.setNextVertex(n,i),this.setPrevVertex(i,n);const e=this.getVertexIndex(n);this.setSegmentToIndex(e,null)}else{this.setNextVertex(n,ei),this.setPrevVertex(i,ei);const e=this.getVertexIndex(n);this.setSegmentToIndex(e,null)}}const i=(1|this.getPathFlags(e))-1;this.setPathFlags(e,i|(t?1:0))}closeAllPaths(e){t.geometryReleaseAssert(0)}isStrongPathStart(e){return!!(8&this.getPathFlags(e))}isStrongPathEnd(e){return!!(16&this.getPathFlags(e))}setStrongPathStart(e,t){const i=(8|this.getPathFlags(e))-8;this.setPathFlags(e,i|(t?8:0))}setStrongPathEnd(e,t){const i=(16|this.getPathFlags(e))-16;this.setPathFlags(e,i|(t?16:0))}getGeometryFromPath(e){return this.m_pathIndexList.getField(e,7)}isExterior(e){return!!(2&this.getPathFlags(e))}setExterior(e,t){const i=(2|this.getPathFlags(e))-2;this.setPathFlags(e,i|(t?2:0))}getRingArea(e){if(this.isRingAreaValid(e))return this.m_pathAreas[this.getPathIndex(e)];const i=this.getFirstVertex(e);if(i===ei)return 0;const s=this.getXY(i),r=new n.KahanSummator(0),o=this.getPathSize(e);if(o>2){const e=s.clone(),t=e.x,a=e.y;let l=this.getNextVertex(i);const c=this.getXY(l);l=this.getNextVertex(l);const h=n.Point2D.getNAN();for(let t=2;t<o;t++,l=this.getNextVertex(l))this.queryXY(l,h),r.pe((h.x-e.x)*(c.y-a)),e.setCoordsPoint2D(c),c.setCoordsPoint2D(h);r.pe((t-e.x)*(c.y-a))}if(this.hasCurves()){let e=i;for(let i=0;i<o;i++,e=this.getNextVertex(e)){const i=this.getSegment(e);if(null===i||i.getGeometryType()===t.GeometryType.enumLine)continue;const n=2*i.calculateArea2DHelper();r.pe(n)}}this.setRingAreaValid(e,!0);const a=.5*r.getResult();return this.m_pathAreas[this.getPathIndex(e)]=a,a}getPathIndexInternal(e){return this.getPathIndex(e)}getPathInternalIndexFromVertex(e){return this.getPathIndex(this.getPathFromVertex(e))}setPathUserIndex(e,t,i){const n=this.m_pathindices[t],s=this.getPathIndex(e);n.size()<this.m_pathAreas.length&&n.resize(this.m_pathAreas.length,-1),n.write(s,i)}getPathUserIndex(e,t){const i=this.getPathIndex(e),n=this.m_pathindices[t];return i<n.size()?n.read(i):-1}createPathUserIndex(){for(let e=0;e<this.m_pathindices.length;e++)if(null===this.m_pathindices[e])return this.m_pathindices[e]=this.allocatePathIndex(),e;this.m_pathindices.push(this.allocatePathIndex());const e=this.m_pathindices.length-1;return t.geometryReleaseAssert(e>=0&&e<=Number.MAX_SAFE_INTEGER),e}fillPathUserIndexForGeometry(e,t,i){const n=this.m_pathindices[t],s=n.size();for(let t=this.getFirstPath(e);t!==ei;t=this.getNextPath(t)){const e=this.getPathIndex(t);e<s&&n.write(e,i)}}removePathUserIndex(e){for(this.recyclePathUserIndex(this.m_pathindices[e]),this.m_pathindices[e]=null;this.m_pathindices.length>0&&null===this.m_pathindices.at(-1);)this.m_pathindices.pop()}movePath(e,i,n){if(n===ei&&t.throwInvalidArgumentException(""),i===n)return;const s=this.getNextPath(n);let r=this.getPrevPath(n);const o=this.getGeometryFromPath(n);r===ei?this.setFirstPath(o,s):this.setNextPath(r,s),s===ei?this.setLastPath(o,r):this.setPrevPath(s,r),this.setGeometryVertexCount(o,this.getPointCount(o)-this.getPathSize(n)),this.setGeometryPathCount(o,this.getPathCount(o)-1),r=i===ei?this.getLastPath(e):this.getPrevPath(i),this.setPrevPath(n,r),this.setNextPath(n,i),i===ei?this.setLastPath(e,n):this.setPrevPath(i,n),r===ei?this.setFirstPath(e,n):this.setNextPath(r,n),this.setGeometryVertexCount(e,this.getPointCount(e)+this.getPathSize(n)),this.setGeometryPathCount(e,this.getPathCount(e)+1),this.setPathGeometry(n,e)}addVertex(e,t){return this.m_vertices.getPointByVal(this.getVertexIndex(t),this.getHelperPoint()),this.insertVertex_(e,ei,this.getHelperPoint(),!1)}insertVertex(e,t,i){return this.insertVertex_(e,t,i,!0)}removeVertex(e,t){const i=this.getPathFromVertex(e),n=this.getPrevVertex(e),s=this.getNextVertex(e);n!==ei&&this.setNextVertex(n,s);const r=this.getPathSize(i);if(e===this.getFirstVertex(i)&&this.setFirstVertex(i,r>1?s:ei),s!==ei&&this.setPrevVertex(s,n),e===this.getLastVertex(i)&&this.setLastVertex(i,r>1?n:ei),this.hasCurves()&&n!==ei&&s!==ei){const i=this.getVertexIndex(e),r=this.getVertexIndex(n),o=this.getVertexIndex(s);if(t){const e=this.getSegmentFromIndex(r);if(null!==e){const t=this.m_vertices.getXY(o);e.setEndXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(i,null)}else{const e=this.getSegmentFromIndex(i);if(this.setSegmentToIndex(i,null),null!==e){const t=this.m_vertices.getXY(r);e.setStartXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(r,e)}}this.setPathSize(i,r-1);const o=this.getGeometryFromPath(i);return this.setGeometryVertexCount(o,this.getPointCount(o)-1),this.freeVertex(e),s}removeVertices(e,i){t.geometryReleaseAssert(e!==i);const n=this.getPathFromVertex(e),s=this.getPrevVertex(e),r=this.getPrevVertex(i);s!==ei&&this.setNextVertex(s,i);let o=this.getPathSize(n);const a=this.getVertexIndex(e);this.setSegmentToIndex(a,null),this.setPrevVertex(i,s),this.setPrevVertex(e,ei),this.setNextVertex(r,ei);let l=0,c=e;const h=this.getFirstVertex(n);let u=!1;for(;;){const e=this.getNextVertex(c);if(u||=h===c,this.freeVertex(c),l++,c===r)break;c=e}o-=l,u&&this.setFirstVertex(n,o>0?i:ei),this.setPathSize(n,o);const m=this.getGeometryFromPath(n);this.setGeometryVertexCount(m,this.getPointCount(m)-l)}getFirstVertex(e){return this.m_pathIndexList.getField(e,4)}getLastVertex(e){return this.m_pathIndexList.getField(e,5)}getNextVertex(e){return this.m_vertexIndexList.getField(e,2)}getPrevVertex(e){return this.m_vertexIndexList.getField(e,1)}getNextVertexEx(e,t){return t>0?this.m_vertexIndexList.getField(e,2):this.m_vertexIndexList.getField(e,1)}getPrevVertexEx(e,t){return t>0?this.m_vertexIndexList.getField(e,1):this.m_vertexIndexList.getField(e,2)}getPathFromVertex(e){return this.m_vertexIndexList.getField(e,3)}addPoint(e,t){return this.insertVertex_(e,ei,t,!1)}getGeometryFromVertex(e){return this.getGeometryFromPath(this.getPathFromVertex(e))}replaceNaNs(e,i){this.m_vertexDescription.hasAttribute(e)||t.throwInternalErrorException(""),this.m_vertices.replaceNaNs(e,i)}removeNaNVertices(){for(let e=this.getFirstGeometry();e!==ei;e=this.getNextGeometry(e))for(let t=this.getFirstPath(e);t!==ei;t=this.getNextPath(t)){let e=this.getFirstVertex(t);for(let i=0,n=this.getPathSize(t);i<n;i++)e=this.getXY(e).isFinite()?this.getNextVertex(e):this.removeVertex(e,!0)}}queryVertexIterator(e=-1){return this.queryVertexIteratorEx(!1,e)}queryVertexIteratorEx(e,i=-1){let n=ei,s=ei,r=ei,o=ei,a=0,l=!1;for(n=i!==ei?i:this.getFirstGeometry();n!==ei;n=this.getNextGeometry(n))if(!e||t.isMultiPath(this.getGeometryType(n))){for(s=this.getFirstPath(n);s!==ei;s=this.getNextPath(s))if(r=this.getFirstVertex(s),o=r,a=0,r!==ei){l=!0;break}if(l||i!==ei)break}return l||(n=ei),ii.create_(this,n,s,r,o,a,e,!1,i!==ei)}queryVertexIteratorOnSelection(e=-1){return this.m_selection?ii.create_(this,e,ei,ei,ei,-1,!1,!0,e!==ei):this.queryVertexIteratorEx(!1,e)}hasSelection(){return this.m_selection}createEmptySelection(){t.geometryReleaseAssert(0)}removeSelection(){this.m_selection&&(this.m_selectedVertices.length=0,this.removeUserIndex(this.m_selectionIndex),this.m_selectionIndex=-1,this.m_selection=!1,this.m_selectedCount=0)}select(e){return!!this.selected(e)||(this.setUserIndex(e,this.m_selectionIndex,this.m_selectedVertices.length),this.m_selectedVertices.push(e),this.m_selectedCount++,!1)}unselect(e){if(!this.m_selection)return;const t=this.getUserIndex(e,this.m_selectionIndex);t>=0&&(this.m_selectedVertices[t]=ei,this.setUserIndex(e,this.m_selectionIndex,-1),this.m_selectedCount--)}selected(e){return!this.m_selection||this.selected_(e)}getSelectedCount(){return this.m_selection?this.m_selectedCount:this.getTotalPointCount()}createSelectionForCrackingAndClustering(e,i){return t.geometryReleaseAssert(0),!1}peelALoop(e,t){this.peelALoop_(e,t,!1)}peelALoopIntoAPath(e,t){return this.peelALoop_(e,t,!0)}applyTransformation(e){if(this.m_verticesMp.applyTransformation(e),null!==this.m_segments)for(let t=0,i=this.m_segments.length;t<i;t++)this.m_segments[t]&&this.m_segments[t].applyTransformation(e)}setGeometryType(e,t){this.m_geometryIndexList.setField(e,2,t)}splitSegmentWithIntersector(e,t,i,n,s){n?this.splitSegmentForward(e,t,i,!0,s):this.splitSegmentBackward(e,t,i,!0,s)}setPrevVertex(e,t){this.m_vertexIndexList.setField(e,1,t)}setNextVertex(e,t){this.m_vertexIndexList.setField(e,2,t)}setPathToVertex(e,t){this.m_vertexIndexList.setField(e,3,t)}setPathSize(e,t){this.m_pathIndexList.setField(e,3,t)}setFirstVertex(e,t){this.m_pathIndexList.setField(e,4,t)}setLastVertex(e,t){this.m_pathIndexList.setField(e,5,t)}getSegment(e){if(null!=this.m_segments){const t=this.getVertexIndex(e);return this.getSegmentFromIndex(t)}return null}isCurve(e){if(null===this.m_segments)return!1;const t=this.getVertexIndex(e);return this.m_segments.length>t&&null!==this.m_segments[t]}querySegment(e,t,i=!0,n=!1){const s=this.getNextVertex(e);if(s===ei)return!1;const r=this.getSegment(e);if(!r)return!i&&(this.queryLineConnector(e,t.createLine(),n),!0);if(t.copyFrom(r,!0),n)return!0;if(this.m_vertexDescription.getAttributeCount()>1){const i=this.getHelperPoint();this.queryPoint(e,i),t.get().setStart(i),this.queryPoint(s,i),t.get().setEnd(i)}return!0}getSegmentFromIndex(e){return(null!==this.m_segments&&this.m_segments.length>e?this.m_segments[e]:null)||null}getAndClearSegmentFromIndex(e){return(null!==this.m_segments&&this.m_segments.length>e?this.m_segments[e]:null)||null}setSegmentToIndex(e,t){if(this.m_hasForceSetEnvelope=0,null===this.m_segments){if(!t)return;this.m_segments=[],this.m_segments.length=this.m_vertices.getPointCount()}e>=this.m_segments.length&&(this.m_segments.length=e+1),this.m_segments[e]=t}setGeometryPathCount(e,t){this.m_geometryIndexList.setField(e,6,t)}setGeometryVertexCount(e,t){this.m_geometryIndexList.setField(e,5,t)}ringParentageCheckInternal(e,i){return t.geometryReleaseAssert(0),!1}reverseRingInternal(e){const t=this.hasCurves(),i=this.hasSegmentParentage();let n=null,s=-1,r=e;if(t){const e=this.getVertexIndex(r);n=this.getAndClearSegmentFromIndex(e)}i&&(s=this.getSegmentParentage(r));do{const e=this.getPrevVertex(r),o=this.getNextVertex(r);if(this.setNextVertex(r,e),this.setPrevVertex(r,o),t){const e=this.getVertexIndex(o),t=this.getSegmentFromIndex(e);n&&n.reverse(),this.setSegmentToIndex(e,n),n=t}if(i){const e=this.getSegmentParentage(o);this.setSegmentParentagePreserveBreak(o,s),s=e}r=o}while(r!==e);this.dbgVerifyIntegrity(e)}setTotalPointCount(e){this.m_pointCount=e}removePathOnly(e){const t=this.getPrevPath(e),i=this.getNextPath(e),n=this.getGeometryFromPath(e);t!==ei?this.setNextPath(t,i):this.setFirstPath(n,i),i!==ei?this.setPrevPath(i,t):this.setLastPath(n,t),this.setFirstVertex(e,ei),this.setLastVertex(e,ei),this.freePath(e)}insertClosedPath(e,t,i,n,s){const r=this.insertPath(e,ei);let o=0,a=i;for(s[0]=!1;;){a===n&&(s[0]=!0),this.setPathToVertex(a,r),o++;const e=this.getNextVertex(a);if(e===i)break;a=e}return this.setClosedPath(r,!0),this.setPathSize(r,o),s[0]&&(i=n),this.setFirstVertex(r,i),this.setLastVertex(r,this.getPrevVertex(i)),this.setRingAreaValid(r,!1),r}findVertex2D(e,i){return t.geometryReleaseAssert(0),0}findVertex3D(e,i,n){return t.geometryReleaseAssert(0),0}dbgVerifyMonotone(){}dbgCheckSelection(){}dbgVerifySegment(e){}dbgVerifyIntegrity(e,t=!0){}dbgVerifyVertexCounts(){}dbgVerifyCurves(){}dbgDumpGeometry(e,t){}getNextNthVertex(e,t){if(0===t)return e;let i=e;for(let e=0;e<t;++e)if(i=t>0?this.getNextVertex(i):this.getPrevVertex(i),i===ei)return ei;return i}removeVertexInternal(e,t){const i=this.getPrevVertex(e),n=this.getNextVertex(e);if(i!==ei&&this.setNextVertex(i,n),n!==ei&&this.setPrevVertex(n,i),this.hasCurves()&&i!==ei&&n!==ei){const s=this.getVertexIndex(e),r=this.getVertexIndex(i),o=this.getVertexIndex(n);if(t){const e=this.getSegmentFromIndex(r);if(null!==e){const t=this.m_vertices.getXY(o);e.setEndXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(s,null)}else{const e=this.getSegmentFromIndex(s);if(this.setSegmentToIndex(s,null),null!==e){const t=this.m_vertices.getXY(r);e.setStartXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(r,e)}}return this.freeVertex(e),n}isRingAreaValid(e){return!!(4&this.getPathFlags(e))}setRingAreaValid(e,t){const i=(4|this.getPathFlags(e))-4;this.setPathFlags(e,i|(t?4:0))}compareVerticesSimpleY(e,t){return this.queryXY(e,this.m_workPoint2D),this.queryXY(t,this.m_workPoint2_2D),this.m_workPoint2D.compare(this.m_workPoint2_2D)}compareVerticesSimpleY3D(e,t){return this.getXYZ(e).compare(this.getXYZ(t))}compareVerticesSimpleX(e,t){return this.getXY(e).compareX(this.getXY(t))}sortVerticesSimpleByYHeapMerge(e,i){t.geometryReleaseAssert(0)}sortVerticesSimpleByY(e,t,i){this.m_bucketSort.sort(e,t,i,new ti(this))}sortVerticesSimpleByX(e,i,n){t.geometryReleaseAssert(0)}sortVerticesSimpleByY3D(e,i,n){t.geometryReleaseAssert(0)}snapVertexForPoleClipping(e,t){const i=this.getPrevVertex(e);i!==ei&&this.replaceCurveWithLine(i),this.getNextVertex(e)!==ei&&this.replaceCurveWithLine(e);const s=new n.Point2D;this.queryXY(e,s),s.y=t,this.setXY(e,s)}setSegmentParentageAndBreak(e,i,s=!0){if(-1===this.m_segmentParentageIndex){if(-1===i)return;this.m_segmentParentageIndex=this.createUserIndex()}i>=0&&(t.geometryReleaseAssert(i<=n.indexTypeMax()>>1),i<<=1,i|=s?1:0),this.setUserIndex(e,this.m_segmentParentageIndex,i)}setSegmentParentagePreserveBreak(e,i){if(t.geometryReleaseAssert(i>=-1),-1===this.m_segmentParentageIndex){if(-1===i)return;this.m_segmentParentageIndex=this.createUserIndex()}i>=0&&(t.geometryReleaseAssert(i<=n.indexTypeMax()>>1),i<<=1,i|=this.getSegmentParentageBreakVertex(e)?1:0),this.setUserIndex(e,this.m_segmentParentageIndex,i)}getSegmentParentage(e){if(-1===this.m_segmentParentageIndex)return-1;const t=this.getUserIndex(e,this.m_segmentParentageIndex);return t<0?t:t>>1}getOriginalSegmentInfo(e){if(-1!==this.m_segmentParentageIndex){const t=this.getSegmentParentage(e);return new ni(t)}return new ni(-1)}setSegmentParentageBreakVertex(e,t){if(-1===this.m_segmentParentageIndex)return;let i=this.getUserIndex(e,this.m_segmentParentageIndex);i<0||!!(1&i)!==t&&(t?i|=1:i&=n.indexTypeMax()>>1<<1,this.setUserIndex(e,this.m_segmentParentageIndex,i))}getSegmentParentageBreakVertex(e){if(-1===this.m_segmentParentageIndex)return!0;const t=this.getUserIndex(e,this.m_segmentParentageIndex);return t<0||!!(1&t)}isDiscontinuousSegmentParentage(e){const t=this.getPrevVertex(e);return t!==ei&&this.getSegmentParentage(t)!==this.getSegmentParentage(e)}setCurveStitcherPointer(e){this.m_curveStitcher=e}hasSegmentParentage(){return-1!==this.m_segmentParentageIndex}deleteSegmentParentage(){-1!==this.m_segmentParentageIndex&&(this.removeUserIndex(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),this.m_curveStitcher=null}clearSegments(){this.m_segments=null}}function ri(e,t,n,s=!1){if(t<=262144)return function(e,t,n,s){const r=new i.AttributeStreamOfInt32(0);for(let e=0;e<t;e++)r.add(e);const o={userSort(t,i,n){n.sort(t,i,((t,i)=>e[t].compareX(e[i])))},getValue:t=>e[t].x};s||i.BucketSort.sortEx(r,0,t,o);let a=0;e:for(let i=0;i<t;++i){const t=r.read(i);for(;a>=2;){const s=n[a-2],o=n[a-1];if(e[o].equals(e[t])){r.write(i,-1);continue e}if(!(li(e[s],e[o],e[t])>=0)){o===r.read(i-1)&&r.write(i-1,-1);break}a--}n[a++]=t,2===a&&e[t].equals(e[n[0]])&&(r.write(1,-1),a--)}const l=a+1;e:for(let i=t-2;i>=0;--i){const t=r.read(i);if(!(t<0)){for(;a>=l;){const i=n[a-2],s=n[a-1];if(e[s].equals(e[t]))continue e;if(!(ci(e[i],e[s],e[t])>=0))break;a--}if(0!==i){const i=n[a-1];n[a++]=t,e[t].equals(e[i])&&a--}}}return a>1&&e[n[0]].equals(e[n[a-1]])&&a--,a}(e,t,n,s);const r=new ai({points:e,n:t});let o=1;const a=e[0];for(;o<t&&e[o].equals(a);)o++;if(r.m_treeHull.addElement(0),o<t){r.m_treeHull.addBiggestElement(o);for(let i=o+1;i<t;i++){const t=e[i],n=r.treeHull(t);-1!==n&&r.m_treeHull.setElement(n,i)}}let l=0;for(let e=r.m_treeHull.getFirst();-1!==e;e=r.m_treeHull.getNext(e))n[l++]=r.m_treeHull.getElement(e);return l}si.st_defaultRank=1;class oi{constructor(e){this.m_handleP=-1,this.m_handleQ=-1,this.m_currentSupport=-1,this.m_area=0,this.m_bDone=!0,t.geometryReleaseAssert(0),this.m_convexHull=e,this.m_function=this.done_}next(){return t.geometryReleaseAssert(0),!1}get_vertex_handle_p(){return t.geometryReleaseAssert(0),0}get_vertex_handle_q(){return t.geometryReleaseAssert(0),0}get_current_support(){return t.geometryReleaseAssert(0),0}getNext(e){return t.geometryReleaseAssert(0),0}getPrev(e){return t.geometryReleaseAssert(0),0}intialize_(){return t.geometryReleaseAssert(0),!1}increment_(){return t.geometryReleaseAssert(0),!1}increment_q_(){return t.geometryReleaseAssert(0),!1}increment_p_(){return t.geometryReleaseAssert(0),!1}parallel_edge_with_q_support_(){return t.geometryReleaseAssert(0),!1}parallel_edge_with_p_support_(){return t.geometryReleaseAssert(0),!1}done_(){return t.geometryReleaseAssert(0),!1}}class ai{nullGetXY(e){return t.throwInternalErrorException("m_getXY is null"),{}}nullDeleteNode(e){t.throwInternalErrorException("m_deleteNode is null")}constructor(e){return this.m_treeHull=new i.Treap,this.m_shape=null,this.m_stream=null,this.m_points=null,this.m_geometryHandle=-1,this.m_pathHandle=-1,this.m_getXY=this.nullGetXY,this.m_deleteNode=this.nullDeleteNode,e?e.stream?(this.m_treeHull.setCapacity(Math.min(20,e.n)),this.m_stream=e.stream,this.m_getXY=this.getXYStream,this.m_deleteNode=this.deleteNodeStream,this.m_points=null,this.m_geometryHandle=ei,void(this.m_pathHandle=ei)):e.points?(this.m_treeHull.setCapacity(Math.min(20,e.n)),this.m_points=e.points,this.m_getXY=this.getXYPoints,this.m_deleteNode=this.deleteNodePoints,this.m_stream=null,this.m_geometryHandle=ei,void(this.m_pathHandle=ei)):void t.throwInvalidCallException("unrecognized constructor parameter"):(this.m_treeHull.setCapacity(20),this.m_shape=new si,this.m_geometryHandle=this.m_shape.createGeometry(t.GeometryType.enumMultiPoint),this.m_pathHandle=this.m_shape.insertPath(this.m_geometryHandle,ei),this.m_getXY=this.getXYShape,this.m_deleteNode=this.deleteNodeShape,this.m_stream=null,void(this.m_points=null))}getXYShape(e){return this.m_shape.getXY(e)}getXYStream(e){return this.m_stream.readPoint2D(e<<1)}getXYPoints(e){return t.geometryReleaseAssert(0),new n.Point2D}deleteNodeShape(e){const t=this.m_treeHull.getElement(e);this.m_treeHull.deleteNode(e),this.m_shape.removeVertex(t,!1)}deleteNodeStream(e){this.m_treeHull.deleteNode(e)}deleteNodePoints(e){t.geometryReleaseAssert(0)}addGeometry(e){if(e.isEmpty())return;const i=e.getGeometryType();if(i===t.GeometryType.enumGeometryCollection){const t=e;for(let e=0,i=t.getGeometryCount();e<i;e++)this.addGeometry(t.getGeometry(e))}else t.isMultiVertex(i)?this.addMultiVertexGeometry(e):t.isSegment(i)?this.addSegment(e,!1):i===t.GeometryType.enumEnvelope?this.addEnvelope(e):i===t.GeometryType.enumPoint?this.addPoint(e):t.throwInvalidArgumentException("Convex_hull: geometry not supported")}getBoundingGeometry(){const e=new i.Point,t=this.m_treeHull.getFirst(),n=new Kt({vd:this.m_shape.getVertexDescription()});if(0===this.m_treeHull.size())return n;n.reserve(this.m_treeHull.size()),this.m_shape.queryPoint(this.m_treeHull.getElement(t),e),n.startPathPoint(e);for(let i=this.m_treeHull.getNext(t);-1!==i;i=this.m_treeHull.getNext(i))this.m_shape.queryPoint(this.m_treeHull.getElement(i),e),n.lineToPoint(e);return n}getAntipodalPairsIterator(){return t.geometryReleaseAssert(0),new oi(this)}getXY(e){return t.geometryReleaseAssert(0),new n.Point2D}getXYWithIndex(e){return t.geometryReleaseAssert(0),new n.Point2D}getFirst(){return t.geometryReleaseAssert(0),0}getLast(){return t.geometryReleaseAssert(0),0}getNext(e){return t.geometryReleaseAssert(0),0}getPrev(e){return t.geometryReleaseAssert(0),0}getVertexIndex(e){return t.geometryReleaseAssert(0),0}getPointCount(){return t.geometryReleaseAssert(0),0}addMultiVertexGeometry(e){const s=new i.Point,r=e.getImpl(),o=new n.Point2D;for(let t=0;t<e.getPointCount();t++){r.queryXY(t,o);const i=this.addPoint2D(o);if(-1!==i){e.getPointByVal(t,s);const n=this.m_shape.addPoint(this.m_pathHandle,s);this.m_treeHull.setElement(i,n)}}if(t.isMultiPath(e.getGeometryType())){const t=e;if(t.hasNonLinearSegments()){const e=t.querySegmentIterator();for(;e.nextPath();)for(;e.hasNextSegment();){const t=e.nextCurve();null!==t&&this.addSegment(t,!0)}}}}addEnvelope(e){const t=new i.Point;for(let i=0;i<4;i++){const s=new n.Point2D;e.queryCorner(i,s);const r=this.addPoint2D(s);if(-1!==r){e.queryCornerByVal(i,t);const n=this.m_shape.addPoint(this.m_pathHandle,t);this.m_treeHull.setElement(r,n)}}}static querySegmentControlPoints(e,s,r){const o=e.getGeometryType();if(t.geometryReleaseAssert(o!==t.GeometryType.enumLine),o===t.GeometryType.enumEllipticArc){const t=e,r=60*Math.PI/180,o=Math.abs(t.getSweepAngle());if(o>r){const e=Math.min(6,Math.ceil(o/r)),a=1/e,l=new Mr;t.queryStart(s[0]);let c=1;for(let r=0;r<e;r++){t.queryCut(r*a,(r+1)*a,l);const o=n.makeObjectArray(n.Point2D,3);cr(l.get(),o);const h=n.Point2D.calculateLength(o,3),u=n.Point2D.calculateLength(o,2),m=h>0?u/h:.5;r<e-1?l.get().queryEnd(s[c+1]):t.queryEnd(s[c+1]),i.Point.lerp(s[c-1],s[c+1],m,s[c]),s[c].setXY(o[1]),c+=2}return c}{const t=n.makeObjectArray(n.Point2D,3);cr(e,t);const r=n.Point2D.calculateLength(t,3);e.queryStart(s[0]),e.queryEnd(s[2]);const o=n.Point2D.calculateLength(t,2),a=r>0?o/r:.5;return i.Point.lerp(s[0],s[2],a,s[1]),s[1].setXY(t[1]),3}}if(o===t.GeometryType.enumBezier){const t=e,r=n.makeObjectArray(n.Point2D,4);t.queryControlPoints(r);const o=n.Point2D.calculateLength(r,4),a=n.Point2D.calculateLength(r,2),l=n.Point2D.calculateLength(r,3);e.queryStart(s[0]),e.queryEnd(s[3]);const c=o>0?a/o:.5;i.Point.lerp(s[0],s[3],c,s[1]),s[1].setXY(r[1]);const h=o>0?l/o:.5;return i.Point.lerp(s[0],s[3],h,s[2]),s[2].setXY(r[2]),4}if(o===t.GeometryType.enumBezier2){const t=e,r=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(r);const o=n.Point2D.calculateLength(r,3);e.queryStart(s[0]),e.queryEnd(s[2]);const a=n.Point2D.calculateLength(r,2),l=o>0?a/o:.5;return i.Point.lerp(s[0],s[2],l,s[1]),s[1].setXY(r[1]),3}if(o===t.GeometryType.enumRationalBezier2){const t=e,r=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(r);const o=n.Point2D.calculateLength(r,3);e.queryStart(s[0]),e.queryEnd(s[2]);const a=n.Point2D.calculateLength(r,2),l=o>0?a/o:.5;return i.Point.lerp(s[0],s[2],l,s[1]),s[1].setXY(r[1]),3}t.throwInvalidArgumentException("Convex_hull: segment type not supported")}addSegment(e,t){if(!t){const t=new i.Point,n=e.getStartXY(),s=this.addPoint2D(n);if(-1!==s){e.queryStart(t);const i=this.m_shape.addPoint(this.m_pathHandle,t);this.m_treeHull.setElement(s,i)}const r=e.getEndXY(),o=this.addPoint2D(r);if(-1!==o){e.queryEnd(t);const i=this.m_shape.addPoint(this.m_pathHandle,t);this.m_treeHull.setElement(o,i)}}if(e.isCurve()){const t=n.makeObjectArray(i.Point,13);for(let i=1,n=ai.querySegmentControlPoints(e,t,t.length)-1;i<n;++i){const e=t[i].getXY(),n=this.addPoint2D(e);if(-1!==n){const e=this.m_shape.addPoint(this.m_pathHandle,t[i]);this.m_treeHull.setElement(n,e)}}}}addPoint(e){const t=e.getXY(),i=this.addPoint2D(t);if(-1!==i){const t=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(i,t)}}addPoint2D(e){let t=-1;if(0===this.m_treeHull.size())return t=this.m_treeHull.addElement(-4),t;if(1===this.m_treeHull.size()){const i=this.m_treeHull.getElement(this.m_treeHull.getFirst()),n=this.m_shape.getXY(i);return e.equals(n)||(t=this.m_treeHull.addBiggestElement(-5)),t}return t=this.treeHull(e),t}treeHull(e){let t=-1;do{const i=this.m_treeHull.getFirst(),s=this.m_treeHull.getLast(),r=this.m_treeHull.getElement(i),o=this.m_treeHull.getElement(s),a=this.m_getXY(r),l=this.m_getXY(o),c=n.Point2D.orientationRobust(l,e,a);if(hi(c)){t=this.m_treeHull.addBiggestElement(-1);const n=this.treeHullWalkBackward(e,s,i);n!==i&&this.treeHullWalkForward(e,i,this.m_treeHull.getPrev(n));break}if(ui(c)){let r=this.m_treeHull.getRoot(),o=this.m_treeHull.getFirst(),l=this.m_treeHull.getLast(),c=-1,h=-1,u=-1;for(;o!==this.m_treeHull.getPrev(l);){h=this.m_treeHull.getElement(r);const t=this.m_getXY(h);ui(n.Point2D.orientationRobust(t,e,a))?(l=r,r=this.m_treeHull.getLeft(r)):(o=r,r=this.m_treeHull.getRight(r))}r=l,c=o,h=this.m_treeHull.getElement(r),u=this.m_treeHull.getElement(c);const m=this.m_getXY(h),d=this.m_getXY(u);if(c!==i&&!hi(n.Point2D.orientationRobust(d,e,m)))break;t=this.m_treeHull.addElementAtPosition(c,r,-2,!0,!1),this.treeHullWalkForward(e,r,s),this.treeHullWalkBackward(e,c,i);break}{const n=mi(e,l,a);if(-1===n){const n=this.m_treeHull.getPrev(s);this.m_treeHull.deleteNode(s),t=this.m_treeHull.addBiggestElement(-3),this.treeHullWalkBackward(e,n,i)}else if(1===n){const n=this.m_treeHull.getNext(i);this.m_treeHull.deleteNode(i),t=this.m_treeHull.addElementAtPosition(-1,n,-3,!0,!1),this.treeHullWalkForward(e,n,s)}break}}while(0);return t}treeHullWalkForward(e,t,i){if(t===i)return i;let s=t,r=this.m_treeHull.getElement(s),o=this.m_treeHull.getNext(s);const a=this.m_getXY(r);for(;s!==i&&this.m_treeHull.size()>2;){const t=this.m_treeHull.getElement(o),i=this.m_getXY(t);if(hi(n.Point2D.orientationRobust(i,e,a)))break;const l=s;s=o,r=t,a.assign(i),o=this.m_treeHull.getNext(s),this.m_deleteNode(l)}return s}treeHullWalkBackward(e,t,i){if(t===i)return i;let s=t,r=this.m_treeHull.getElement(s),o=this.m_treeHull.getPrev(s);const a=this.m_getXY(r);for(;s!==i&&this.m_treeHull.size()>2;){const t=this.m_treeHull.getElement(o),i=this.m_getXY(t);if(hi(n.Point2D.orientationRobust(a,e,i)))break;const l=s;s=o,r=t,a.assign(i),o=this.m_treeHull.getPrev(s),this.m_deleteNode(l)}return s}}function li(e,t,i){const s=t.sub(e),r=i.sub(t);if(0===s.x)return r.x>0?-1:0;if(0===s.y)return r.y>0?1:r.y<0?-1:0;const o=s.crossProduct(r),a=4*Number.EPSILON*(Math.abs(r.x*s.y)+Math.abs(r.y*s.x));return o>a?1:o<-a?-1:n.Point2D.orientationRobust(e,t,i)}function ci(e,t,i){const s=t.sub(e),r=i.sub(t);if(0===s.x)return r.x<0?-1:0;if(0===s.y)return r.y>0?-1:r.y<0?1:0;const o=s.crossProduct(r),a=4*Number.EPSILON*(Math.abs(r.x*s.y)+Math.abs(r.y*s.x));return o>a?1:o<-a?-1:n.Point2D.orientationRobust(e,t,i)}function hi(e){return e<0}function ui(e){return e>0}function mi(e,t,i){let n=-1;n=t.y===i.y?0:t.x===i.x?1:Math.abs(t.x-i.x)>=Math.abs(t.y-i.y)?0:1;let s=-1;return s=t[n]<i[n]?e[n]<t[n]?-1:i[n]<e[n]?1:0:t[n]<e[n]?-1:e[n]<i[n]?1:0,s}function di(e){return(e=e.clone()).divThis(Math.max(Math.abs(e.x),Math.abs(e.y))),e.normalize(),e}function pi(e,t,i){e.inc(t,0)===i&&e.set(t,0,0),e.inc(t,1)===i&&e.set(t,1,0)}function gi(e,i,s,r,o){switch(o){case 0:break;case 1:i.rightPerpendicularThis(),e.rightPerpendicularThis();break;case 2:i.negateThis(),e.negateThis();break;case 3:i.leftPerpendicularThis(),e.leftPerpendicularThis();break;default:t.throwInvalidArgumentException("")}return n.Point2D.orientationRobustEx(e,i,s,r)}class _i{constructor(){this.length=Number.NaN,this.specialPoints=[]}specialPointsCount(){return this.specialPoints.length}}function fi(e){var t;return t=e.calculateUpperLength2D(),256*n.doubleEps()*t}function yi(e,t,i=!1){t[1].setCoords(e.m_cp[0].x-e.getStartX(),e.m_cp[0].y-e.getStartY()),t[1].mulThis(3),t[2].setCoords(e.m_cp[1].x-e.m_cp[0].x,e.m_cp[1].y-e.m_cp[0].y),t[2].mulThis(3),t[3]=e.getEndXY().sub(e.getStartXY()),t[3].subThis(t[2]),t[2].subThis(t[1]),i?t[0].setCoords(0,0):t[0]=e.getStartXY()}function xi(e,t,i){const s=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(s),Pi(s,t,i)}function vi(e,t,i){const s=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(s),bi(s,t,i)}function Pi(e,t,i){let n=e[1].x;n-=e[0].x,n*=3;let s=e[2].x;s-=e[1].x,s*=3;let r=e[3].x;r-=e[0].x,r-=s,s-=n,t[3].setWithEps(r),t[2].setWithEps(s),t[1].setWithEps(n),i?t[0].set(0):t[0].set(e[0].x)}function bi(e,t,i){let n=e[1].y;n-=e[0].y,n*=3;let s=e[2].y;s-=e[1].y,s*=3;let r=e[3].y;r-=e[0].y,r-=s,s-=n,t[3].setWithEps(r),t[2].setWithEps(s),t[1].setWithEps(n),i?t[0].set(0):t[0].set(e[0].y)}function Ei(e,t,i=!1){const s=n.makeObjectArray(v,4);s[0].assignPoint2D(e[0]),s[1].assignPoint2D(e[1]),s[2].assignPoint2D(e[2]),s[3].assignPoint2D(e[3]),t[1].setCoords(s[1].x.sub(s[0].x),s[1].y.sub(s[0].y)),t[1].mulThis(n.MPValue.constructInt32(3)),t[2].setCoords(s[2].x.sub(s[1].x),s[2].y.sub(s[1].y)),t[2].mulThis(n.MPValue.constructInt32(3)),t[3]=s[3].sub(s[0]),t[3]=t[3].sub(t[2]),t[2]=t[2].sub(t[1]),i?t[0].setCoords(n.s_zero$1,n.s_zero$1):t[0]=s[0].clone()}function Si(e,t,i){if(i){if(t<0)return t;if(t>1)return t-1+Si(e,1,!1)}if(e.isDegenerate(0))return 0;const n=1===t,s=Ci(e);if(n&&!Number.isNaN(s.length)&&!Number.isNaN(s.length))return s.length;const r=fi(e),o=r/e.calculateUpperLength2D();let a=0,l=0;for(let i=1,n=s.specialPointsCount();i<n;i++){const n=s.specialPoints[i];if(a+=cn(e,l,Math.min(t,n),o,r),t<=n)break;l=n}return n&&(s.length=a),a}function Ci(e){if(e.m_cachedValues)return e.m_cachedValues;const t=new _i,i=n.makeObjectArray(n.ECoordinate,8),s=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(s);const r=sn(s,i);t.specialPoints=[];for(let e=0;e<r;e++)t.specialPoints.push(i[e].value());return Ti(e,t),t}function wi(e){let t=null;return t=e.m_cachedValues,t}function Ti(e,t){e.m_cachedValues=t}function Di(e){e.m_cachedValues=null}function Ii(e,t,i,s){const r=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(r);const o=n.makePrimitiveArray(18,NaN),a=be(new Ji(r,t,NaN),n.Envelope1D.construct(i,s),18,o),l=new n.Point2D;e.queryCoord2D(i,l);let c=i,h=n.Point2D.distance(l,t);const u=new n.Point2D;e.queryCoord2D(s,u);const m=n.Point2D.distance(u,t);m<h&&(h=m,c=s,l.assign(u));for(let i=0;i<a;i++){e.queryCoord2D(o[i],u);const s=n.Point2D.distance(u,t);s<h&&(h=s,c=o[i],l.assign(u))}return function(e,t,i,n,s){return{tmin:e,tmax:t,t:i,d:n,pt:s.clone()}}(i,s,c,h,l)}function Ai(e,i){const s=n.makeObjectArray(n.ECoordinate,4);xi(e,s,!0);const r=n.makeObjectArray(n.ECoordinate,4);vi(e,r,!0);const o=s[3].clone(),a=s[2].clone(),l=s[1].clone(),c=r[3].clone(),h=r[2].clone(),u=r[1].clone(),m=a.mulE(l).addE(h.mulE(u)).mul(4),d=a.mulE(a).mul(8).addE(o.mulE(l).mul(12)).addE(h.mulE(h).mul(8).addE(c.mulE(u).mul(12))),p=o.mulE(a).addE(c.mulE(h)).mul(36),g=o.mulE(o).addE(c.mulE(c)).mul(36),_=n.makeObjectArray(n.ECoordinate,3),f=Me(g,p,d,m,new n.Envelope1D(0,1),!1,_);if(t.geometryReleaseAssert(f<=3),f>0){const t=Ni(e,1,0).sqrLength(),n=Ni(e,1,1).sqrLength();let s=t;i.set(0),s<n&&(s=n,i.set(1));for(let t=0;t<f;t++){const n=Ni(e,1,_[t].value()).sqrLength();n<s&&(s=n,i=_[t])}}}function Mi(e,t,i){const s=new n.Point2D;return function(e,t,i,n){if(1===t){const t=1-i,s=t*t,r=i*i,o=e[1].sub(e[0]),a=e[2].sub(e[1]),l=e[3].sub(e[2]),c=o.mul(s).add(a.mul(2*t*i)).add(l.mul(r));n.assign(c.mul(3))}else if(2===t){const t=1-i,s=e[2].sub(e[1]).sub(e[1].sub(e[0])),r=e[3].sub(e[2]).sub(e[2].sub(e[1])),o=s.mul(t).add(r.mul(i));n.assign(o.mul(6))}else if(3===t){const t=e[2].sub(e[1]),i=e[3].sub(t.mul(3)).sub(e[0]);n.assign(i.mul(6))}else n.setCoords(0,0)}(e,t,i,s),s}function Ni(e,t,i){const s=n.makeObjectArray(n.Point2D,4);return e.queryControlPoints(s),Mi(s,t,i)}function Ri(e){const t=e.m_cp[0].sub(e.getStartXY()),i=e.m_cp[1].sub(e.m_cp[0]),n=e.getEndXY().sub(e.getStartXY());return t.mulThis(3),i.mulThis(3),n.subThis(i),i.subThis(t),(3*n.x*(2*i.y+5*t.y)-3*n.y*(2*i.x+5*t.x)+10*(i.x*t.y-i.y*t.x))/60}function Oi(e){const t=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(t);const i=Gi(t);return i&&(e.m_cp[0].setCoordsPoint2D(t[1]),e.m_cp[1].setCoordsPoint2D(t[2]),e.afterCompletedModification()),i}function Gi(e){return b(e)}function ki(e,t,i){const s=new n.Point2D,r=new n.Point2D,o=new n.Point2D,a=new n.Point2D,l=new n.Point2D;t<=.5?(n.lerpPointLo(2,e[0],e[1],t,s),n.lerpPointLo(2,e[1],e[2],t,r),n.lerpPointLo(2,e[2],e[3],t,o),n.lerpPointLo(2,s,r,t,a),n.lerpPointLo(2,r,o,t,l),n.lerpPointLo(2,a,l,t,i)):(n.lerpPointHi(2,e[0],e[1],t,s),n.lerpPointHi(2,e[1],e[2],t,r),n.lerpPointHi(2,e[2],e[3],t,o),n.lerpPointHi(2,s,r,t,a),n.lerpPointHi(2,r,o,t,l),n.lerpPointHi(2,a,l,t,i))}function Vi(e,i,s,r){t.geometryReleaseAssert(i>=0&&i<=1);const o=new n.Point2D,a=new n.Point2D,l=new n.Point2D,c=new n.Point2D,h=new n.Point2D,u=new n.Point2D;i<=.5?(n.lerpPointLo(2,e[0],e[1],i,o),n.lerpPointLo(2,e[1],e[2],i,a),n.lerpPointLo(2,e[2],e[3],i,l),n.lerpPointLo(2,o,a,i,c),n.lerpPointLo(2,a,l,i,h),n.lerpPointLo(2,c,h,i,u)):(n.lerpPointHi(2,e[0],e[1],i,o),n.lerpPointHi(2,e[1],e[2],i,a),n.lerpPointHi(2,e[2],e[3],i,l),n.lerpPointHi(2,o,a,i,c),n.lerpPointHi(2,a,l,i,h),n.lerpPointHi(2,c,h,i,u));const m=e[3].clone();s&&(s[0].assign(e[0]),s[1].assign(o),s[2].assign(c),s[3].assign(u)),r&&(r[0].assign(u),r[1].assign(h),r[2].assign(l),r[3].assign(m))}function Fi(e,i,s,r){if(t.geometryReleaseAssert(i>=0&&s<=1&&i<=s),i===s){const t=new n.Point2D;return Li(e,i,t),r[0].assign(t),r[1].assign(t),r[2].assign(t),void r[3].assign(t)}if(0===i&&1===s){for(let t=0;t<4;++t)r[t].assign(e[t]);return}const o=n.makeObjectArray(n.Point2D,4);Vi(e,s,o,null),Vi(o,s>0?i/s:0,null,o),Li(e,i,o[0]),Li(e,s,o[3]),r[0].setCoordsPoint2D(o[0]),r[1].setCoordsPoint2D(o[1]),r[2].setCoordsPoint2D(o[2]),r[3].setCoordsPoint2D(o[3])}function Li(e,t,i,s){if(s){if(t<0)return void W(new Ar({start:e[0],end:e[0].add(qi(e,0).getUnitVector())}),t,i);if(t>1)return void W(new Ar({start:e[3],end:e[3].add(qi(e,1).getUnitVector())}),t-1,i)}if(t<=.5){const s=new n.Point2D;n.lerpPointLo(2,e[0],e[1],t,s);const r=new n.Point2D;n.lerpPointLo(2,e[1],e[2],t,r);const o=new n.Point2D;n.lerpPointLo(2,e[2],e[3],t,o);const a=new n.Point2D;n.lerpPointLo(2,s,r,t,a);const l=new n.Point2D;n.lerpPointLo(2,r,o,t,l),n.lerpPointLo(2,a,l,t,i)}else{const s=new n.Point2D;n.lerpPointHi(2,e[0],e[1],t,s);const r=new n.Point2D;n.lerpPointHi(2,e[1],e[2],t,r);const o=new n.Point2D;n.lerpPointHi(2,e[2],e[3],t,o);const a=new n.Point2D;n.lerpPointHi(2,s,r,t,a);const l=new n.Point2D;n.lerpPointHi(2,r,o,t,l),n.lerpPointHi(2,a,l,t,i)}}function qi(e,t){const i=n.snap(t,0,1);let s=Mi(e,1,i);return s.isZero()&&(s=Mi(e,2,i),s.isZero()?s=Mi(e,3,i):1===i&&s.negateThis()),s}function Hi(e,t,i){const s=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(s),function(e,t,i){t.value()<0&&t.set(0,t.eps()),t.value()>1&&t.set(1,t.eps()),i.setE(function(e,t,i){const s=[y.constructPoint2D(e[0]),y.constructPoint2D(e[1]),y.constructPoint2D(e[2]),y.constructPoint2D(e[3])],r=new y;return function(e,t,i,s){{const t=n.s_one.subE(i),r=t.sqr(),o=i.sqr(),a=e[1].subE(e[0]).mulE(r).addE(e[2].subE(e[1]).mulE(new n.ECoordinate(2).mulE(t).mulE(i))).addE(e[3].subE(e[2]).mulE(o));s.setE(a.mulE(new n.ECoordinate(3)))}}(s,0,i,r),r}(e,0,t))}(s,t,i)}function Ui(e,t,i,n,s){if(s){if(0!==Er(t,i))return e?4:2}else if(E(t,i))return 1;return 0!==Xi(e,t,i,null,null,null,n,void 0!==s&&s,0,!1)?4:0}function zi(e,t,i,n,s){if(s){if(0!==Er(t,i))return e?4:2}else if(E(t,i))return 1;return 0!==ji(e,t,i,null,null,null,n,void 0!==s&&s,0,!1)?4:0}function Yi(e,t,i,n,s){if(s){if(0!==Er(t,i))return e?4:2}else if(E(t,i))return 1;return 0!==Zi(e,t,i,null,null,null,n,void 0!==s&&s,!0,!1)?4:0}function Bi(e,t,i,n,s){if(s){if(0!==Er(t,i))return e?4:2}else if(E(t,i))return 1;return 0!==Qi(e,t,i,null,null,null,n,s??!1,0,!1)?4:0}function Xi(e,t,i,s,r,o,a,l,c,h){if(null!==r&&(r.length=0),null!=o&&(o.length=0),null!==s&&(s.length=0),i.isDegenerate(0)){const e=[0,0,0],l=t.intersectPoint(i.getStartXY(),e,a);if(l>0){if(null!==r)for(let t=0;t<l;t++)r.push(e[t]);if(null!==o)for(let e=0;e<l;e++)o.push(0);if(null!=s)for(let i=0;i<l;i++){const r=new n.Point2D;t.queryCoord2D(e[i],r),s.push(r)}}return l}const u=L(t,i);if(q(t,i,a=Math.max(a,u)))return 0;const m=n.makeObjectArray(n.Point2D,4);yi(t,m);const d=i.getEndXY();d.subThis(i.getStartXY());const p=d.clone();p.leftPerpendicularThis();let g=3*m[3].dotProduct(p),_=2*m[2].dotProduct(p),f=m[1].dotProduct(p);const y=n.makePrimitiveArray(15,Number.NaN),x=n.makePrimitiveArray(15,Number.NaN);let v=Ee(g,_,f,n.Envelope1D.unit(),!1,y);v<0&&(y[0]=0,y[1]=1,v=2);let P,b=0;for(let e=0,s=b;e<v;++e){const r=t.getCoord2D(y[e+s]);x[b]=i.getClosestCoordinate(r,!1),n.Point2D.distance(r,i.getCoord2D(x[b]))<=a&&(y[b]=y[e+s],b++)}if(m[0].subThis(i.getStartXY()),Math.abs(d.x)>=Math.abs(d.y)){const e=d.y/d.x;g=m[3].y-m[3].x*e,_=m[2].y-m[2].x*e,f=m[1].y-m[1].x*e,P=m[0].y-m[0].x*e}else{const e=d.x/d.y;g=m[3].x-m[3].y*e,_=m[2].x-m[2].y*e,f=m[1].x-m[1].y*e,P=m[0].x-m[0].y*e}const E=t.getEndXY().equals(i.getStartXY())||t.getEndXY().equals(i.getEndXY()),S=[0,0,0];v=Se(g,_,f,P,n.Envelope1D.unit(),E,S);for(let e=0,s=b;e<v;++e){y[e+s]=S[e];const r=t.getCoord2D(y[e+s]);x[b]=i.getClosestCoordinate(r,!1),n.Point2D.distance(r,i.getCoord2D(x[b]))<=a&&(y[b]=y[e+s],b++)}v=t.intersectPoint(i.getStartXY(),S,a);for(let e=0;e<v;e++)y[b]=S[e],x[b++]=0;v=t.intersectPoint(i.getEndXY(),S,a);for(let e=0;e<v;e++)y[b]=S[e],x[b++]=1;return 0!==i.intersectPoint(t.getStartXY(),S,a)&&(x[b]=S[0],y[b++]=0),0!==i.intersectPoint(t.getEndXY(),S,a)&&(x[b]=S[0],y[b++]=1),0===b?0:Tr(e,t,i,y,x,b,s,r,o,a,l,0,h)}function ji(e,t,i,s,o,a,l,c,h,u){if(Zs(i))return Xi(e,t,new Ar({start:i.getStartXY(),end:i.getEndXY()}),s,o,a,l,c,0,u);const m=L(t,i);if(q(t,i,l=Math.max(l,m)))return 0;const d=[],p=[],g=[],_=n.makeObjectArray(n.Point2D,4);{t.queryControlPoints(_);const e=n.makeObjectArray(n.Point2D,4),s=new r.Transformation2D;i.canonicToWorldTransformation(s);const o=new r.Transformation2D;o.setInvert(s),o.transformPoints2D(_,4,e);const a=n.makeObjectArray(v,4);Ei(e,a);const h=[a[0].x,a[1].x,a[2].x,a[3].x],u=[a[0].y,a[1].y,a[2].y,a[3].y],m=n.makeObjectArray(n.MPValue,3);m[0].setDouble(i.getSemiMinorAxis()),m[0].sqrThis(),m[1].setDouble(i.getSemiMajorAxis()),m[1].sqrThis(),m[2].setThis(m[0]),m[2].mulThis(m[1]),m[2].negateThis();const f=Xe(h,3,u,3,null,0,m,0,n.Envelope1D.unit(),n.Envelope1D.unit(),p,c);if(f>0){let e=0;for(let s=0;s<f;s++){const r=new n.Point2D;t.queryCoord2D(p[s],r);const o=i.getClosestCoordinate(r,!1),a=new n.Point2D;i.queryCoord2D(o,a),n.Point2D.distance(r,a)<=l&&(d.push(r.clone()),p[e]=p[s],g.push(o),e++)}p.length=e,d.length=e}}const f=[0,1];for(let e=0;e<2;e++){const t=0===e?i.getStartXY():i.getEndXY(),s=[0];en(_,t,n.Envelope1D.unit(),!1,-1,1,s);const r=new n.Point2D;Li(_,s[0],r),n.Point2D.distance(t,r)<=l&&(p.push(s[0]),g.push(f[e]),d.push(r.clone()))}for(let e=0;e<2;e++){const t=[0,3];{const s=i.getClosestCoordinate(_[t[e]],!1),r=new n.Point2D;i.queryCoord2D(s,r),n.Point2D.distance(_[t[e]],r)<=l&&(p.push(f[e]),g.push(s),d.push(r.clone()))}}return Tr(e,t,i,p,g,p.length,s,o,a,l,c,0,u)}function Wi(e,i,s,r,o,a,l,c,h,u){const m=n.makeObjectArray(n.Point2D,4);i.queryControlPoints(m);const d=n.makeObjectArray(n.Point2D,4);if(s.queryControlPoints(d),H(m,d,4)<0)return Wi(e,s,i,r,a,o,l,c,h,!u);const g=L(i,s);if(q(i,s,l=Math.max(l,g)))return 0;if(function(e,t,i,s,r,o,a,l,c){const h=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(h);const u=n.makeObjectArray(n.Point2D,4);if(t.queryControlPoints(u),h[0].equals(u[0])){if(h[1].equals(u[1])&&h[2].equals(u[2])&&h[3].equals(u[3]))return i&&(i.length=0,i.push(h[0]),i.push(h[3])),s&&(s.length=0,s.push(0),s.push(1)),r&&(r.length=0,r.push(0),r.push(1)),!0;if(!h[0].equals(u[3]))return!1}return!!(h[0].equals(u[3])&&h[1].equals(u[2])&&h[2].equals(u[1])&&h[3].equals(u[0]))&&(s&&(s.length=0,s.push(0),s.push(1),c&&(s[1]=n.swap(s[0],s[0]=s[1]))),r&&(r.length=0,r.push(1),r.push(0),c&&(r[1]=n.swap(r[0],r[0]=r[1]))),i&&(i.length=0,i.push(h[0]),i.push(h[3]),c&&(i[1]=n.swap(i[0],i[0]=i[1]))),!0)}(i,s,r,o,a,0,0,0,u))return 2;const _=new n.Envelope1D(0,1),f=new n.Envelope1D(0,1);{const e=new p;Ki(m,new n.Envelope1D(0,1),e);const t=new p;Ki(d,new n.Envelope1D(0,1),t);const i=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*l),t.inflate(3*l),!e.intersectW(t))return 0;if(e.maxDim()<.1*i){if(on(m,e,_),_.isEmpty())return 0;if(on(d,e,f),f.isEmpty())return 0;Fi(m,_.vmin,_.vmax,m),Fi(d,f.vmin,f.vmax,d)}}const y=Dr(m,3,d,3,l);if(0===y)return 0;const x=[],P=[],b=[];let E=!1;if(-1===y){const e=n.makeObjectArray(v,4);Ei(m,e);const t=[e[0].x,e[1].x,e[2].x,e[3].x],i=[e[0].y,e[1].y,e[2].y,e[3].y],s=n.makeObjectArray(v,4);Ei(d,s);const r=[],o=[],a=Be(t,3,i,3,null,0,[s[0].x,s[1].x,s[2].x,s[3].x],3,[s[0].y,s[1].y,s[2].y,s[3].y],3,null,0,0,n.Envelope1D.unit(),n.Envelope1D.unit(),r,o,h);if(a>0)for(let e=0;e<a;e++){const t=new n.Point2D;Li(d,o[e],t);const i=new n.Point2D;Li(m,r[e],i),n.Point2D.distance(i,t)<=l&&(x.push(i.clone()),b.push(o[e]),P.push(r[e]))}else-1===a&&(E=!0)}for(let e=0;e<2;e++){const t=0===e?m:d,i=0===e?d:m;for(let s=0;s<2;s++){const r=0===s?0:3,o=[0];en(i,t[r],n.Envelope1D.unit(),!1,-1,1,o);const a=new n.Point2D;Li(i,o[0],a),n.Point2D.distance(t[r],a)<=l&&(0===e?(P.push(0===r?0:1),b.push(o[0])):(b.push(0===r?0:1),P.push(o[0])),x.push(a.clone()))}}if(0===P.length&&E){const e=i.calculateUpperLength2D()>s.calculateUpperLength2D();{const r=[0,0];if(2===nn(e?i:s,r,!0)&&(t.geometryReleaseAssert(n.Envelope1D.unit().containsCoordinate(r[0])),!n.Envelope1D.unit().containsCoordinate(r[1]))){const t=new n.Point2D;Li(e?m:d,r[0],t);const i=[0,0];1===en(e?d:m,t,n.Envelope1D.unit(),!1,-1,2,i)&&(x.push(t.clone()),P.push(e?r[0]:i[0]),b.push(e?i[0]:r[0]))}}}if(0===P.length)return 0;if(!_.equalsRange(0,1))for(let e=0;e<P.length;++e)P[e]=dn.recalculateParentT(_.vmin,_.vmax,P[e]);if(!f.equalsRange(0,1))for(let e=0;e<b.length;++e)b[e]=dn.recalculateParentT(f.vmin,f.vmax,b[e]);return Tr(e,i,s,P,b,P.length,r,o,a,l,c,0,u)}function Zi(e,i,s,r,o,a,l,c,h,u){const m=L(i,s);if(s.isDegenerateToLineHelper(m)){const t=new Ar({start:s.getStartXY(),end:s.getEndXY()}),n=Xi(e,i,t,r,o,a,l,c,0,u);if(a)for(let e=0;e<n;++e){const i=t.getCoord2D(a[e]);a[e]=s.getClosestCoordinate(i,!1)}return n}if(q(i,s,l=Math.max(l,m)))return 0;const d=n.makeObjectArray(n.Point2D,4);i.queryControlPoints(d);const g=n.makeObjectArray(n.Point2D,3);s.queryControlPoints(g);const _=new n.Envelope1D(0,1),f=new n.Envelope1D(0,1),y=[0,0,0];s.queryWeights(y);const x=[1,ss(y),1];{const e=new p;Ki(d,new n.Envelope1D(0,1),e);const t=new p;Fn(g,x,new n.Envelope1D(0,1),t);const i=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*l),t.inflate(3*l),!e.intersectW(t))return 0;if(e.maxDim()<.1*i){if(on(d,e,_),_.isEmpty())return 0;if(ns(g,x,e,f),f.isEmpty())return 0;Fi(d,_.vmin,_.vmax,d),zn(g,x,f.vmin,f.vmax,g,x)}}const P=Dr(d,3,g,2,l);if(0===P)return 0;const b=[],E=[],S=[];if(-1===P){const e=n.makeObjectArray(v,4);Ei(d,e);const t=[e[0].x,e[1].x,e[2].x,e[3].x],i=[e[0].y,e[1].y,e[2].y,e[3].y],s=n.makeObjectArray(n.MPValue,3),r=n.makeObjectArray(n.MPValue,3),o=n.makeObjectArray(n.MPValue,3);Kn(g,x,s,r,o);const a=[],c=[],u=Be(s,2,r,2,o,2,t,3,i,3,null,0,0,n.Envelope1D.unit(),n.Envelope1D.unit(),c,a,h);if(u>0)for(let e=0;e<u;e++){const t=new n.Point2D;Li(d,a[e],t);const i=new n.Point2D;is(g,x,c[e],i),n.Point2D.distance(t,i)<=l&&(b.push(t.clone()),E.push(a[e]),S.push(c[e]))}}for(let e=0;e<2;e++){let i,s;0===e?(i=d,s=g):(s=d,i=g);for(let r=0;r<2;r++){const o=0===r?0:i.length-1,a=[0],c=new n.Point2D;if(0===e){const e=kn(s,x,i[o],n.Envelope1D.unit(),!1,-1,1,a);t.geometryReleaseAssert(1===e),is(s,x,a[0],c)}else{const e=en(s,i[o],n.Envelope1D.unit(),!1,-1,1,a);t.geometryReleaseAssert(1===e),Li(s,a[0],c)}n.Point2D.distance(i[o],c)<=l&&(0===e?(E.push(0===o?0:1),S.push(a[0])):(S.push(0===o?0:1),E.push(a[0])),b.push(c.clone()))}}if(0===E.length)return 0;if(!_.equalsRange(0,1))for(let e=0;e<E.length;++e)E[e]=dn.recalculateParentT(_.vmin,_.vmax,E[e]);if(!f.equalsRange(0,1))for(let e=0;e<S.length;++e)S[e]=Le.recalculateParentT(f.vmin,f.vmax,S[e]);for(let e=0;e<S.length;++e)S[e]=rs(y,S[e]);return Tr(e,i,s,E,S,E.length,r,o,a,l,c,0,u)}function Qi(e,i,s,r,o,a,l,c,h,u){const m=L(i,s);if(q(i,s,l=Math.max(l,m)))return 0;const d=n.makeObjectArray(n.Point2D,4);i.queryControlPoints(d);const p=n.makeObjectArray(n.Point2D,3);s.queryControlPoints(p);const g=Dr(d,3,p,2,l);if(0===g)return 0;const _=[],f=[],y=[];if(-1===g){const e=n.makeObjectArray(v,4);Ei(d,e);const t=[e[0].x,e[1].x,e[2].x,e[3].x],r=[e[0].y,e[1].y,e[2].y,e[3].y],o=n.makeObjectArray(v,3);Ht(p,o);const a=Be([o[0].x,o[1].x,o[2].x],2,[o[0].y,o[1].y,o[2].y],2,null,0,t,3,r,3,null,0,0,n.Envelope1D.unit(),n.Envelope1D.unit(),y,f,c);if(a>0){let e=0;for(let t=0;t<a;t++){const r=new n.Point2D;i.queryCoord2D(f[t],r);const o=new n.Point2D;s.queryCoord2D(y[t],o),n.Point2D.distance(r,o)<=l&&(_.push(r.clone()),f[e]=f[t],y[e]=y[t],e++)}f.length=e,_.length=e}}for(let e=0;e<2;e++){let i,s;0===e?(i=d,s=p):(s=d,i=p);for(let r=0;r<2;r++){const o=0===r?0:i.length-1,a=[0],c=new n.Point2D;if(0===e)Dt(s,i[o],a),Ut(s,a[0],c);else{const e=en(s,i[o],n.Envelope1D.unit(),!1,-1,1,a);t.geometryReleaseAssert(1===e),Li(s,a[0],c)}n.Point2D.distance(i[o],c)<=l&&(0===e?(f.push(0===o?0:1),y.push(a[0])):(y.push(0===o?0:1),f.push(a[0])),_.push(c.clone()))}}return Tr(e,i,s,f,y,f.length,r,o,a,l,c,0,u)}function $i(e,t,i){const s=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(s),Ki(s,t,i)}function Ki(e,t,i){if(t.equalsRange(0,1))return void i.setFromPoints(e,4);const s=n.makeObjectArray(n.Point2D,4);Fi(e,t.vmin,t.vmax,s),i.setFromPoints(s,4)}let Ji=class{constructor(e,t,i){this.dbgCounter=0,this.controlPoints=e,this.point=t.clone(),this.maxDistance=i}getMaxDerivative(){return 6}getValue(e,t){switch(e){case 0:{const e=new n.Point2D;Li(this.controlPoints,t,e);const i=Mi(this.controlPoints,1,t);return 2*e.sub(this.point).dotProduct(i)}case 1:{const e=new n.Point2D;Li(this.controlPoints,t,e);const i=Mi(this.controlPoints,1,t),s=Mi(this.controlPoints,2,t);return 2*(e.sub(this.point).dotProduct(s)+i.dotProduct(i))}case 2:{const e=new n.Point2D;Li(this.controlPoints,t,e);const i=Mi(this.controlPoints,1,t),s=Mi(this.controlPoints,2,t),r=Mi(this.controlPoints,3,t);return 2*(e.sub(this.point).dotProduct(r)+3*i.dotProduct(s))}case 3:{const e=Mi(this.controlPoints,1,t),i=Mi(this.controlPoints,2,t),n=Mi(this.controlPoints,3,t);return 2*(4*e.dotProduct(n)+3*i.sqrLength())}case 4:{const e=Mi(this.controlPoints,2,t),i=Mi(this.controlPoints,3,t);return 10*e.dotProduct(i)*2}case 5:{const e=Mi(this.controlPoints,3,t);return 10*e.dotProduct(e)*2}default:return 0}}getError(e){return 0}isInterestingInterval(e,t){if(e>=0&&t<=1){const i=n.makeObjectArray(n.Point2D,4);Fi(this.controlPoints,e,t,i);const s=new p;if(s.setFromPoints(i,4),Math.sqrt(s.sqrMinDistance(this.point))>this.maxDistance)return!1}return!0}};function en(e,s,r,o,a,l,c){t.checkAndThrow(n.Envelope1D.unit().contains(r)&&l>0,"getClosestCoordinate"),(a<0||Number.isNaN(a))&&(a=Number.MAX_VALUE);const h=[],u=new n.Point2D;Li(e,r.vmin,u);let m=n.Point2D.distance(u,s);if(m<=a&&h.push(new n.Point2D(r.vmin,m)),r.vmin!==r.vmax&&(Li(e,r.vmax,u),m=n.Point2D.distance(u,s),m<=a&&h.push(new n.Point2D(r.vmax,m))),r.width()>0){const t=n.makePrimitiveArray(18,Number.NaN),i=be(new Ji(e,s,a),r,18,t);for(let r=0;r<i;r++)Li(e,t[r],u),m=n.Point2D.distance(u,s),m>a||h.push(new n.Point2D(t[r],m))}if(o){t.geometryReleaseAssert(r.equals(n.Envelope1D.unit()));{Li(e,-1,u,!0);const t=new n.Point2D;Li(e,0,t);const i=new Ar({start:u,end:t}),r=i.getClosestCoordinate(s,!0);r<1&&(u.assign(i.getCoord2D(r)),m=n.Point2D.distance(u,s),m<=a&&h.push(new n.Point2D(r-1,m)))}{Li(e,2,u,!0);const t=new n.Point2D;Li(e,r.vmax,t);const i=new Ar({start:t,end:u}),o=i.getClosestCoordinate(s,!0);o>0&&(u.assign(i.getCoord2D(o)),m=n.Point2D.distance(u,s),m<=a&&h.push(new n.Point2D(1+o,m)))}}if(!h.length)return 0;h.sort(((e,t)=>e.compare(t)));let d=0;const p=h[0].x;if(c[d++]=p,d<l){const t=i.calculateToleranceFromPointsForOps(e,4,!1).total(),s=h[0].y;for(let e=1,i=h.length;e<i;e++)if(h[e].y>s+t){h.length=e;break}h.sort(((e,t)=>n.standardNumericCompare(e.x,t.x))),d=0,c[d++]=h[0].x;for(let e=1,t=h.length;e<t;e++)h[e].x!==c[d-1]&&d<l&&(c[d++]=h[e].x)}return d}function tn(e,t,i,s,r,o,a){const l=n.makeObjectArray(n.Point2D,4);return e.queryControlPoints(l),en(l,t,i,s,r,o,a)}function nn(e,t,i=!1){const s=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(s);const r=n.makeObjectArray(v,4);let o,a,l;Ei(s,r,!0);const c=r[3].x.isZero(),h=r[3].y.isZero();if(c||h)if(c&&!h){if(r[2].x.isZero())return 0;o=r[1].x.div(r[2].x).negate(),a=r[2].y.div(r[3].y),l=r[1].y.div(r[3].y)}else{if(c||!h)return 0;if(r[2].y.isZero())return 0;o=r[1].y.div(r[2].y).negate(),a=r[2].x.div(r[3].x),l=r[1].x.div(r[3].x)}else{r[2].x.divThis(r[3].x),r[1].x.divThis(r[3].x),r[2].y.divThis(r[3].y),r[1].y.divThis(r[3].y);const e=r[2].x.sub(r[2].y);if(e.isZero())return 0;o=r[1].x.sub(r[1].y).div(e).negate(),a=r[2].x.clone(),l=r[1].x.clone()}if(!i&&o.abs().value()>2)return 0;const u=[0,0],m=e.getStartXY().equals(e.getEndXY()),d=Ee(1,-o.toDouble(),o.add(a).mul(o).add(l).toDouble(),n.Envelope1D.unit(),m,u);if(0===d)return 0;if(u[0]>=0&&u[0]<=1){const e=o.toDouble()-u[0];if(i||e>=0&&e<=1)return t[0]=u[0],t[1]=e,t[0]>t[1]&&(t[1]=n.swap(t[0],t[0]=t[1])),2}if(2===d&&u[1]>=0&&u[1]<=1){const e=o.toDouble()-u[1];if(i||e>=0&&e<=1)return t[0]=u[1],t[1]=e,t[0]>t[1]&&(t[1]=n.swap(t[0],t[0]=t[1])),2}return 0}function sn(e,i){i[0].set(0);let s=1;const r=n.makeObjectArray(n.ECoordinate,4);Pi(e,r,!0);const o=n.makeObjectArray(n.ECoordinate,4);bi(e,o,!0);{const e=r[3].mul(3),t=r[2].mul(2),o=r[1].clone(),a=n.makeObjectArray(n.ECoordinate,2);let l=Ae(e,t,o,new n.Envelope1D(0,1),!1,a);l<0&&(l=0);for(let e=0;e<l;e++)n.isOneOf(a[e].value(),0,1)||(i[s]=a[e],s++)}{const e=o[3].mul(3),t=o[2].mul(2),r=o[1].clone(),a=n.makeObjectArray(n.ECoordinate,2);let l=Ae(e,t,r,new n.Envelope1D(0,1),!1,a);l<0&&(l=0);for(let e=0;e<l;e++)n.isOneOf(a[e].value(),0,1)||(i[s]=a[e],s++)}const a=function(e,t,i){const s=e[1].mulE(t[2]).subThisE(e[2].mulE(t[1])),r=e[1].mulE(t[3]).subThisE(e[3].mulE(t[1])).mulThis(3),o=e[2].mulE(t[3]).subThisE(e[3].mulE(t[2])).mulThis(3),a=n.makeObjectArray(n.ECoordinate,2);let l=Ae(o,r,s,new n.Envelope1D(0,1),!1,a);l<0&&(l=0);let c=0;for(let e=0;e<l;e++)n.isOneOf(a[e].value(),0,1)||(i[c].setE(a[e]),c++);return c}(r,o,i.slice(s));if(s+=a,i[s].set(1),s++,s>2){n.sortRange(i,0,s,((e,t)=>{const i=e.value(),n=t.value();return i<n?-1:i>n?1:0}));let t=0;const r=i[0].clone();let o=0;const a=((l=e)[0].norm(1)+l[1].norm(1)+l[2].norm(1)+l[3].norm(1))*n.doubleEps(),c=new n.Point2D;ki(e,i[0].value(),c);for(let l=1;l<s;l++){const s=new n.Point2D;if(ki(e,i[l].value(),s),i[l].eq(r)||s.isEqualPoint2D(c,a)){if(0!==t){if(0===i[l].eps())r.setE(i[l]),o=0;else if(0!==o){const e=n.sqr(1/i[l].eps()),t=1/o,s=e+t;r.set((i[l].value()*e+r.value()*t)/s),o=1/s,r.setError(Math.sqrt(o))}i[t].setE(r),ki(e,r.value(),c)}}else t++,i[t].setE(i[l]),r.setE(i[l]),ki(e,r.value(),c),o=n.sqr(i[l].eps())}t++,s=t}var l;return 1===s&&(s=2,i[1].set(1)),t.geometryReleaseAssert(0===i[0].value()),t.geometryReleaseAssert(1===i[s-1].value()),s}function rn(e,t,i,s){const r=n.makeObjectArray(n.Point2D,i);for(let e=0;e<i;++e)r[e]=new n.Point2D(e/(i-1),0);const o=(e,t,i,s)=>{const r=new n.ECoordinate(t.x).subE(new n.ECoordinate(e.x)).divE(new n.ECoordinate(t.y).subE(new n.ECoordinate(e.y))).mulE(new n.ECoordinate(i).subE(new n.ECoordinate(e.y))).addE(new n.ECoordinate(e.x));if(r.eps()>.1){const s=(t.x-e.x)/(t.y-e.y)*(i-e.y)+e.x;r.set(s,n.doubleEps())}if(r.lt(new n.ECoordinate(0))||r.gt(new n.ECoordinate(1)))return!1;let o=r.value()-r.eps();o=n.snap(o,0,1);let a=r.value()+r.eps();return a=n.snap(a,0,1),s.mergeCoordinate(o),s.mergeCoordinate(a),!0},a=[];{const t=(e,t)=>{a.length=i;const s=ri(r,i,a,!0),l=new n.Envelope1D;l.setEmpty();const c=i=>i.y<e?-1:i.y>t?1:0;let h=r[a[0]],u=c(h);0===u&&l.mergeCoordinate(h.x);for(let i=1;i<=s;++i){const n=r[a[i%s]],m=c(n);0===m&&l.mergeCoordinate(n.x);let d=0;m!==u&&(d=m*u===0?1===m||1===u?2:1:3,1&d&&o(h,n,e,l),2&d&&o(h,n,t,l)),h=n,u=m}return l};for(let t=0;t<i;++t)r[t].y=e[t].x;const l=t(s.xmin,s.xmax);if(l.isEmpty())return new n.Envelope1D(l);for(let t=0;t<i;++t)r[t].y=e[t].y;const c=t(s.ymin,s.ymax);return l.intersect(new n.Envelope1D(c)),new n.Envelope1D(l)}}function on(e,t,i){i.setEmpty(),i.merge(function(e,t,i,s){const r=rn(e,0,4,s.getEnvelope2D());if(r.isEmpty())return new n.Envelope1D(r);const o=n.makeObjectArray(n.Point2D,4);for(let t=0;t<4;++t)s.xyRot(e[t],o[t]);const a=rn(o,0,4,s.getRotatedEnvelope2D());return r.intersect(new n.Envelope1D(a)),new n.Envelope1D(r)}(e,0,0,t))}class an{constructor(e,t){this.b=e,this.len=t}getMaxDerivative(){return 1}getValue(e,t){return 0===e?this.len-Si(this.b,t,!1):0}getError(e){return 0}}function ln(e,i,s,r,o,a,l){for(;;){const c=n.Point2D.distance(i[0],i[3]),h=n.Point2D.distance(i[0],i[1])+n.Point2D.distance(i[1],i[2])+n.Point2D.distance(i[2],i[3]);if(h-c<=r+s*h)return e+n.lerp(c,h,.5);const u=e=>Mi(i,1,e).length();{t.geometryReleaseAssert(l<12);let c=u(0),m=u(1);o[0]+=2,c>m&&(m=n.swap(c,c=m),i[3]=n.swap(i[0],i[0]=i[3]),i[2]=n.swap(i[1],i[1]=i[2]));let d=c/(c+m),p=1,g=h;for(;d<1/32&&g>=32*(r+s*g);){p/=4;const e=u(p);o[0]++,d=c/(e+c);const t=new n.Point2D;if(Li(i,.5*p,t),g=n.Point2D.distance(t,i[0]),g<=r){const e=new n.Point2D;Li(i,p,e),g+=n.Point2D.distance(e,t)}}if(1!==p){const t=n.makeObjectArray(n.Point2D,4);Vi(i,p,i,t),e=ln(e,t,s,r,o,0,l+1),a++,l++;continue}}const m=8;o[0]+=m;const d=$t(m,u,0,1),p=16;o[0]+=p;const g=$t(p,u,0,1);let _=Math.abs(d-g)>r+s*h;if(!_)return e+g;if(a<3){const t=n.makeObjectArray(n.Point2D,4);Vi(i,.5,i,t),e=ln(e,t,s,r,o,a+1,l+1),a++,l++;continue}const f=32;o[0]+=f;const y=$t(f,u,0,1);if(_=Math.abs(g-y)>r+s*h,!_)return e+y;const x=64;o[0]+=x;const v=$t(x,u,0,1);if(_=Math.abs(y-v)>r+s*h,!_)return e+v;const P=128;o[0]+=P;const b=$t(P,u,0,1);return _=Math.abs(v-b)>r+s*h,e+b}}function cn(e,t,i,s,r){if(i===t)return 0;const o=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(o);const a=n.makeObjectArray(n.Point2D,4);return Fi(o,t,i,a),ln(0,a,s,r,[0],0,0)}function hn(e,t,i,s,r){let o=!0;const a=lt(5,t,i,s,r,(t=>{const i=Ni(e,1,t);return(o?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*i.length()}));o=!1;const l=lt(5,t,i,s,r,(t=>{const i=Ni(e,1,t);return(o?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*i.length()}));return new n.Point2D(a,l)}function un(e,i,s,r,o,a,l,c,h,u,m,d){t.geometryReleaseAssert(u+2===d);let p=0,g=0,_=0,f=0,y=0,x=0,v=0;const P=(e,t)=>{const i=1-t,l=s.mul(n.cube(i)),c=r.mul(3*t*i*i),h=o.mul(3*t*t*i),u=a.mul(n.cube(t));return l.add(c).add(h).add(u).sub(m[e]).sqrLength()};for(let t=1,i=d-1;t<i;t++){let i=h[t-1];if(e){t>2?(i=n.snap(2*h[t-2]-h[t-3],0,1),h[t-1]=i):2===t&&(i=n.snap(2*h[t-2],0,1),h[t-1]=i);const e=(e,t,i)=>{let l=-1;for(let c=0;!(Math.abs(t-l)<1e-12)&&10!==c;c++){const c=t*t,h=1-t,u=h*h,d=u*h,p=s.x-2*r.x+o.x,g=s.x-3*r.x+3*o.x-a.x,_=s.y-2*r.y+o.y,f=s.y-3*r.y+3*o.y-a.y,y=s.x-r.x-2*p*t+g*c,x=-m[e].x+s.x*d+t*(3*r.x*u+t*(3*o.x*h+a.x*t)),v=s.y-r.y-2*_*t+f*c,P=-m[e].y+s.y*d+t*(3*r.y*u+t*(3*o.y*h+a.y*t)),b=-6*(y*x+v*P),E=6*(3*n.sqr(y)-(-2*p+2*g*t)*x)+6*(3*n.sqr(v)-(-2*_+2*f*t)*P);if(l=t,0===E)break;{const e=t-b/E;t=n.snap(e,i,1)}}return l};{const i=P(t,h[t-1]);let n=e(t,h[t-1],0),s=P(t,n);if(1.01*i<s){const i=t>1?h[t-2]:0,r=e(t,.3*(h[t-1]-i)+i,0),o=P(t,r);o<s&&(s=o,n=r)}i>s&&(h[t-1]=n)}}const l=h[t-1],c=l*l,u=c*l,d=1-l,b=d*d,E=b*d;p+=3*c*b*b,g+=3*u*E,_+=3*c*c*b;const S=-(E*s.x+u*a.x-m[t].x);f+=S*l*b,y+=S*c*d;const C=-(E*s.y+u*a.y-m[t].y);x+=C*l*b,v+=C*c*d}if(i){const e=p*_-g*g;Math.abs(e)>=1e-12*(Math.abs(p*_)+Math.abs(g*g))+1e-10?(l||(r.x=(f*_-y*g)/e,r.y=(x*_-v*g)/e),c||(o.x=(p*y-g*f)/e,o.y=(p*v-g*x)/e)):(n.lerpPoint2D(s,a,.3,r),n.lerpPoint2D(s,a,.6,o))}let b=0;for(let e=1,t=d-1;e<t;e++)b+=P(e,h[e-1]);return b}var mn=i.VertexDescription;class dn extends X{constructor(e){e&&e.cp?(super({start:e.cp[0],end:e.cp[3],vd:e.vd}),this.m_cp=n.makeObjectArray(n.Point2D,2),this.m_cp[0].assign(e.cp[1]),this.m_cp[1].assign(e.cp[2])):void 0===e||n.isOnlyProperty(e,"vd")?(super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=n.makeObjectArray(n.Point2D,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0)):e.from?(super({start:e.from,end:e.to,vd:e.vd}),this.m_cp=n.makeObjectArray(n.Point2D,2),this.m_cp[0].assign(e.cp1),this.m_cp[1].assign(e.cp2)):(super({XStart:0,YStart:0,XEnd:0,YEnd:0,vd:e.vd}),t.throwInternalErrorException("unrecognized constructor params"),this.m_cp=n.makeObjectArray(n.Point2D,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0)),this.m_cachedValues=0}getBoundary(){return ve(this)}construct(e,t,i,n){this.m_XStart=e.x,this.m_YStart=e.y,this.m_XEnd=n.x,this.m_YEnd=n.y,this.m_cp[0].assign(t),this.m_cp[1].assign(i),this.afterCompletedModification()}constructPoints(e){this.m_XStart=e[0].x,this.m_YStart=e[0].y,this.m_XEnd=e[3].x,this.m_YEnd=e[3].y,this.m_cp[0].assign(e[1]),this.m_cp[1].assign(e[2]),this.afterCompletedModification()}constructFromQuadratic(e){const t=n.makeObjectArray(n.Point2D,4);var i,s;i=e,(s=t)[0].assign(i[0]),s[3].assign(i[2]),n.lerpPoint2D(i[0],i[1],2/3,s[1]),n.lerpPoint2D(i[1],i[2],1/3,s[2]),this.constructPoints(t)}constructFromQuadraticSegment(e){this.dropAllAttributes(),this.assignVertexDescription(e.getDescription()),this.m_XStart=e.getStartX(),this.m_YStart=e.getStartY(),this.m_XEnd=e.getEndX(),this.m_YEnd=e.getEndY(),n.lerpPoint(2,e.getStartXY(),e.getControlPoint1(),2/3,this.m_cp[0]),n.lerpPoint(2,e.getControlPoint1(),e.getEndXY(),1/3,this.m_cp[1]),this.afterCompletedModification(),V(this,e)}getGeometryType(){return t.GeometryType.enumBezier}queryEnvelope(e){if(2!==e.m_EnvelopeType)return void t.geometryReleaseAssert(0);if(e.setCoords(this.getStartXY()),e.mergeNe(this.getEndXY()),e.contains(this.m_cp[0])&&e.contains(this.m_cp[1]))return;const i=wi(this);if(null!==i){const t=new n.Point2D;for(const n of i.specialPoints)this.queryCoord2D(n,t),e.mergeNe(t);return}const s=n.makeObjectArray(n.ECoordinate,8),r=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(r);const o=sn(r,s),a=new n.Point2D;for(let t=1;t<o-1;t++)this.queryCoord2D(s[t].value(),a),e.mergeNe(a)}applyTransformation(e){if(1===e.m_TransformationType){const t=n.makeObjectArray(n.Point2D,4);return this.queryControlPoints(t),e.transformPoints2D(t,4,t),this.setStartXY(t[0]),this.m_cp[0].assign(t[1]),this.m_cp[1].assign(t[2]),this.setEndXY(t[3]),void Di(this)}t.geometryReleaseAssert(0)}createInstance(){return new dn({vd:this.m_description})}calculateLength2D(){return Si(this,1,!1)}calculateLowerLength2D(){return n.Point2D.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return n.Point2D.distance(this.getStartXY(),this.m_cp[0])+n.Point2D.distance(this.m_cp[0],this.m_cp[1])+n.Point2D.distance(this.getEndXY(),this.m_cp[1])}queryCoord2D(e,t){return this.queryCoord2DExtends(e,t,!0)}queryCoord2DMP(e,i){t.geometryReleaseAssert(0)}queryCoord2DExtends(e,t,i){const s=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(s),Li(s,e,t,i)}queryCoord2DE(e,t){!function(e,t,i){const s=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(s),function(e,t,i){if(t.value()<=.5){const s=new y;n.lerpLoPointE(2,y.constructPoint2D(e[0]),y.constructPoint2D(e[1]),t,s);const r=new y;n.lerpLoPointE(2,y.constructPoint2D(e[1]),y.constructPoint2D(e[2]),t,r);const o=new y;n.lerpLoPointE(2,y.constructPoint2D(e[2]),y.constructPoint2D(e[3]),t,o);const a=new y;n.lerpLoPointE(2,s,r,t,a);const l=new y;n.lerpLoPointE(2,r,o,t,l),n.lerpLoPointE(2,a,l,t,i)}else{const s=new y;n.lerpHiPointE(2,y.constructPoint2D(e[0]),y.constructPoint2D(e[1]),t,s);const r=new y;n.lerpHiPointE(2,y.constructPoint2D(e[1]),y.constructPoint2D(e[2]),t,r);const o=new y;n.lerpHiPointE(2,y.constructPoint2D(e[2]),y.constructPoint2D(e[3]),t,o);const a=new y;n.lerpHiPointE(2,s,r,t,a);const l=new y;n.lerpHiPointE(2,r,o,t,l),n.lerpHiPointE(2,a,l,t,i)}}(s,t,i)}(this,e,t)}getCoordX(e){if(e<0||e>1){const t=new n.Point2D;return this.queryCoord2DExtends(e,t,!0),t.x}const t=n.lerp(this.getStartX(),this.m_cp[0].x,e),i=n.lerp(this.m_cp[0].x,this.m_cp[1].x,e),s=n.lerp(this.m_cp[1].x,this.getEndX(),e),r=n.lerp(t,i,e),o=n.lerp(i,s,e);return n.lerp(r,o,e)}getCoordY(e){if(e<0||e>1){const t=new n.Point2D;return this.queryCoord2DExtends(e,t,!0),t.y}const t=n.lerp(this.getStartY(),this.m_cp[0].y,e),i=n.lerp(this.m_cp[0].y,this.m_cp[1].y,e),s=n.lerp(this.m_cp[1].y,this.getEndY(),e),r=n.lerp(t,i,e),o=n.lerp(i,s,e);return n.lerp(r,o,e)}cut(e,t,i){const n=new Mr;return this.queryCut(e,t,n,i),n.releaseSegment()}queryCut(e,t,i,n){const s=i.createCubicBezier();if(this.cutBezierIgnoreAttributes(e,t,s),n)return;s.assignVertexDescription(this.m_description);const r=this.m_description.getAttributeCount();if(r>1){for(let t=1;t<r;t++){const i=this.m_description.getSemantics(t),n=mn.getComponentCount(i);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,i,t);s.setStartAttribute(i,t,n)}}for(let e=1;e<r;e++){const i=this.m_description.getSemantics(e),n=mn.getComponentCount(i);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,i,e);s.setEndAttribute(i,e,n)}}}}queryDerivative(e,t){Hi(this,e,t)}cutBezierIgnoreAttributes(e,i,s){(e<0||i>1||e>i)&&t.throwInvalidArgumentException("Cubic_bezier.cut_bezier_ignore_attributes");const r=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(r);const o=n.makeObjectArray(n.Point2D,4);Fi(r,e,i,o),s.setControlPoints(o)}splitBezierIgnoreAttributes(e,i,s){this===i&&this===s&&t.throwInvalidArgumentException("Cubic_bezier.split_bezier_ignore_attributes");const r=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(r);const o=n.makeObjectArray(n.Point2D,4),a=n.makeObjectArray(n.Point2D,4);Vi(r,e,o,a),i&&i.setControlPoints(o),s&&s.setControlPoints(a)}getAttributeAsDbl(e,t,i){if(0===t)return 0===i?this.getCoordX(e):this.getCoordY(e);if(0===e)return this.getStartAttributeAsDbl(t,i);if(1===e)return this.getEndAttributeAsDbl(t,i);const s=this.getStartAttributeAsDbl(t,i),r=this.getEndAttributeAsDbl(t,i),o=this.calculateLength2D(),a=o>0?this.tToLength(e)/o:0,l=mn.getInterpolation(t);return n.interpolate(l,s,r,a,mn.getDefaultValue(t))}getClosestCoordinate(e,t){const i=[Number.NaN];return tn(this,e,n.Envelope1D.unit(),t,-1,1,i),i[0]}getClosestCoordinateOnInterval(e,t,i=-1){const n=[Number.NaN];return 0===tn(this,e,t,!1,i,1,n)?Number.NaN:n[0]}getYMonotonicParts(e,t=!1){return this.getMonotonicParts(e,t)}getMonotonicParts(e,i){e.length<2&&t.throwInvalidArgumentException("");const n=Ci(this);if(2===n.specialPointsCount()&&this.isMonotoneQuickAndDirty())return 0;let s=0;t.geometryReleaseAssert(e.length>=n.specialPointsCount()-1);for(let t=1,r=n.specialPointsCount();t<r;++t)this.queryCut(n.specialPoints[t-1],n.specialPoints[t],e[s],i),s++;for(let t=0;t<s;++t)Oi(e[t].get());return s}intersectionWithAxis2D(e,t,i,s){const r=n.makeObjectArray(n.Point2D,4);return this.queryControlPoints(r),function(e,t,i,s,r){const o=n.makeObjectArray(n.ECoordinate,4),a=n.makeObjectArray(n.ECoordinate,3),l=new n.Envelope1D(0,1);let c=0;if(t){if(bi(e,o,!1),c=Me(o[3],o[2],o[1],o[0].sub(i),l,!1,a),s)for(let t=0;t<c;t++){const i=new n.Point2D;Li(e,a[t].value(),i),s[t]=i.x}}else if(Pi(e,o,!1),c=Me(o[3],o[2],o[1],o[0].sub(i),l,!1,a),s)for(let t=0;t<c;t++){const i=new n.Point2D;Li(e,a[t].value(),i),s[t]=i.y}if(r)for(let e=0;e<c;e++)r[e]=a[e].value();else s&&n.sortRange(s,0,c,n.standardNumericCompare);return c}(r,e,t,i,s)}intersectionOfYMonotonicWithAxisX(e,i){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?i:Number.NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;const n=[0,0],s=this.intersectionWithAxis2D(!0,e,n,null);return t.geometryReleaseAssert(2!==s),-1===s?i:n[0]}isCurve(){return!0}isDegenerate(e){return S(this,e)}isDegenerate3D(e,i){return t.geometryReleaseAssert(0),!1}queryLooseEnvelope(e){if(2===e.m_EnvelopeType)return e.setCoords({pt:this.getStartXY()}),e.mergeNe(this.m_cp[0]),e.mergeNe(this.m_cp[1]),void e.mergeNe(this.getEndXY());t.geometryReleaseAssert(0)}clone(e){const t=this.createInstance();return this.copyTo(t),t}queryInterval(e,t){if(0===e){const e=s.Envelope2D.constructEmpty();this.queryEnvelope(e);const i=n.Envelope1D.constructEmpty();return 0===t?e.queryIntervalX(i):e.queryIntervalY(i),i}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){const i=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(i),Fi(i,e.vmin,e.vmax,i),t.setFromPoints(i,4)}changeEndPoints2D(e,t){if(e.isEqual(this.m_XStart,this.m_YStart)&&t.isEqual(this.m_XEnd,this.m_YEnd))return;const i=this.m_cp[0].isEqual(this.m_XStart,this.m_YStart),n=this.m_cp[0].isEqual(this.m_XEnd,this.m_YEnd),s=this.m_cp[1].isEqual(this.m_XStart,this.m_YStart),r=this.m_cp[1].isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(e),this.setEndXY(t),i?this.m_cp[0].setCoordsPoint2D(e):n&&this.m_cp[0].setCoordsPoint2D(t),r?this.m_cp[1].setCoordsPoint2D(t):s&&this.m_cp[1].setCoordsPoint2D(e),this.normalizeAfterEndpointChange()}tToLength(e){return Si(this,e,!0)}lengthToT(e){const i=function(e,i){const s=Si(e,1,!1);if(i<=0)return i;if(i>=s)return i-s+1;const r=[0];return 1!==be(new an(e,i),n.Envelope1D.unit(),1,r)&&t.throwInternalErrorException(""),r[0]}(this,e);return i}calculateWeightedAreaCentroid2D(e){const t=n.makeObjectArray(n.Point2D,4);yi(this,t);const i=t[3],s=t[2],r=t[1],o=new n.Point2D;o.x=(5*i.x*i.x*(7*s.y+16*r.y)+i.x*(-35*i.y*s.x+40*s.x*s.y-80*i.y*r.x+140*s.x*r.y+112*r.x*r.y)-2*(i.y*(20*s.x*s.x+70*s.x*r.x+56*r.x*r.x)-7*(4*s.x+5*r.x)*(-s.y*r.x+s.x*r.y)))/840,o.y=(-5*i.y*i.y*(7*s.x+16*r.x)+i.y*(5*i.x*(7*s.y+16*r.y)-4*(10*s.x*s.y+35*s.y*r.x+28*r.x*r.y))+2*(-7*(4*s.y+5*r.y)*(s.y*r.x-s.x*r.y)+i.x*(20*s.y*s.y+70*s.y*r.y+56*r.y*r.y)))/840;const a=Ri(this);return o.x+=(t[0].x-e.x)*a,o.y+=(t[0].y-e.y)*a,o}calculateWeightedCentroid2D(){const e=new n.Point2D;return this.isDegenerate(0)?(e.setCoords(0,0),e):function(e){const t=n.Point2D.distance(e.getStartXY(),e.getEndXY()),i=e.calculateUpperLength2D();return i-t<=8*Number.EPSILON*i}(this)?(e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e):(e.assign(function(e,i,s){void 0===s&&(s=i,i=0);const r=new n.Point2D;if(i<0||s>1)return r.setNAN(),r;if(i>s&&t.throwInvalidArgumentException("calculate_sub_weightedCentroid"),i===s||e.isDegenerate(0))return r.setCoords(0,0),r;const o=Ci(e),a=fi(e),l=a/e.calculateUpperLength2D();let c=i,h=0;for(let e=1,t=o.specialPointsCount();e<t;e++)if(i<o.specialPoints[e]){h=e-1;break}r.setCoords(0,0);for(let t=h+1,i=o.specialPointsCount();t<i;t++){const i=Math.min(o.specialPoints[t],s),n=hn(e,c,i,l,a);if(r.addThis(n),c=i,s<=o.specialPoints[t])break}return r.add(e.getStartXY().mul(e.calculateLength2D()))}(this,1)),e)}getControlPoint1(){return this.m_cp[0].clone()}setControlPoint1(e){this.m_cp[0].setCoordsPoint2D(e),this.afterCompletedModification()}getControlPoint2(){return this.m_cp[1].clone()}setControlPoint2(e){this.m_cp[1].setCoordsPoint2D(e),this.afterCompletedModification()}queryControlPoints(e){e[0].assign(this.getStartXY()),e[1].assign(this.m_cp[0]),e[2].assign(this.m_cp[1]),e[3].assign(this.getEndXY())}queryControlPointsHelper(e){return this.queryControlPoints(e),4}setControlPoints(e){for(let i=0;i<4;i++)e[i].isNAN()&&t.throwInvalidArgumentException("NAN control points in bezier are not supported");this.m_XStart=e[0].x,this.m_YStart=e[0].y,this.m_cp[0].setCoordsPoint2D(e[1]),this.m_cp[1].setCoordsPoint2D(e[2]),this.m_XEnd=e[3].x,this.m_YEnd=e[3].y,this.afterCompletedModification()}getTangent(e){const t=n.makeObjectArray(n.Point2D,4);return this.queryControlPoints(t),qi(t,e)}getDerivative(e){const t=n.makeObjectArray(n.Point2D,4);return this.queryControlPoints(t),Mi(t,1,e)}getCurvature(e){const t=Ni(this,1,e),i=Ni(this,2,e),n=t.sqrLength();return 0===n?Number.NaN:(t.divThis(Math.sqrt(n)),t.crossProduct(i)/n)}isIntersectingPoint(e,t,i){if(i&&(e.equals(this.getStartXY())||e.equals(this.getEndXY())))return!1;const r=new s.Envelope2D;if(this.queryLooseEnvelope(r),r.inflateCoords(t,t),!r.contains(e))return!1;const o=this.getClosestCoordinate(e,!1),a=new n.Point2D;return this.queryCoord2D(o,a),n.Point2D.distance(a,e)<=t}isIntersectingPoint3D(e,i,n,s,r=1){return t.geometryReleaseAssert(0),!1}isMonotoneQuickAndDirty(){const e=n.makeObjectArray(n.Point2D,4);return this.queryControlPoints(e),function(e){return function(e){const t=n.compareNoNANs(e[0].y,e[1].y),i=n.compareNoNANs(e[1].y,e[2].y),s=n.compareNoNANs(e[2].y,e[3].y);if(t>=0&&i>=0&&s>=0||t<=0&&i<=0&&s<=0){const t=n.compareNoNANs(e[0].x,e[1].x),i=n.compareNoNANs(e[1].x,e[2].x),s=n.compareNoNANs(e[2].x,e[3].x);if(t>=0&&i>=0&&s>=0||t<=0&&i<=0&&s<=0)return!0}return!1}(e)}(e)}getMonotonicPartParams(e,i){const n=Ci(this),s=n.specialPointsCount();if(t.geometryReleaseAssert(z.s_maxMonotonicPartParams>=s),!i)return n.specialPointsCount();e<s&&t.throwInvalidArgumentException("");for(let e=0;e<s;e++)i[e]=n.specialPoints[e];return s}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=n.swap(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=n.swap(this.m_YStart,this.m_YStart=this.m_YEnd);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=n.swap(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_cp[1]=n.swap(this.m_cp[0],this.m_cp[0]=this.m_cp[1]),this.m_cachedValues=null}}findMinDeriv(){const e=new n.ECoordinate;return Ai(this,e),e.value()}isLine(){return!1}isDegenerateToLineHelper(e){const t=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(t);const i=t[3].sub(t[0]),s=i.length();if(n.Point2D.distance(t[0],t[1])+n.Point2D.distance(t[2],t[1])+n.Point2D.distance(t[2],t[3])-s>e)return!1;const r=e;let o=t[1].clone();o.subThis(t[0]);let a=Math.abs(o.crossProduct(i))/s;return!(a>r||(o=t[2].clone(),o.subThis(t[1]),a=Math.abs(o.crossProduct(i))/s,a>r))}copyIgnoreAttributes(e){const t=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(t),e.setControlPoints(t)}calculateArea2DHelper(){return Ri(this)}absNorm(){return(e=this).getStartXY().norm(1)+e.getEndXY().norm(1)+e.m_cp[0].norm(1)+e.m_cp[1].norm(1);var e}queryEnvelopeW(e,t){$i(this,e,t)}setSegmentFromCoordsForStitcher(e,i){!function(e,i,s){if(t.geometryReleaseAssert(s>=2),2===s){const t=new n.Point2D;n.lerpPoint2D(i[0],i[s-1],1/3,t);const r=new n.Point2D;return n.lerpPoint2D(i[0],i[s-1],2/3,r),void e.construct(i[0],t,r,i[s-1])}const r=i[0],o=i[s-1],a=[0,0],l=tn(e,r,n.Envelope1D.unit(),!1,Number.NaN,2,a),c=[0,0],h=tn(e,o,n.Envelope1D.unit(),!1,Number.NaN,2,c),u=[];for(let t=0;t<l;t++)for(let l=0;l<h;l++){const h=a[t],m=c[l],d=h>m,p=(t,a)=>{const l=n.makePrimitiveArray(s-2,Number.NaN),c=()=>{let e=0;for(let t=1,r=s-1;t<r;t++){e+=n.Point2D.distance(i[t-1],i[t]);const s=e;l[t-1]=s}e+=n.Point2D.distance(i[s-2],i[s-1]),d&&l.reverse();for(let t=1,i=s-1;t<i;t++)l[t-1]/=e,d&&(l[t-1]=1-l[t-1])};let u=!1,p=!1;{const i=new Mr;d?(e.queryCut(m,h,i,!0),t.assign(i.get().getControlPoint2()),a.assign(i.get().getControlPoint1())):(e.queryCut(h,m,i,!0),t.assign(i.get().getControlPoint1()),a.assign(i.get().getControlPoint2())),r.equals(t)&&(u=!0),o.equals(a)&&(p=!0)}c();let g=Number.MAX_VALUE;const _=t.clone(),f=a.clone();for(let e=0;e<5;e++)g=un(!0,!1,r,_,f,o,u,p,l,s-2,i,s);for(let e=0;e<30;e++){const e=_.clone();f.clone();const t=un(!0,!0,r,_,f,o,u,p,l,s-2,i,s);if(g<=t&&e.equals(_)&&e.equals(f))break;g=t}c();let y=!1,x=Number.MAX_VALUE;const v=t.clone(),P=a.clone();for(let e=0;e<30;e++){const e=v.clone();P.clone();const t=un(y,!0,r,v,P,o,u,p,l,s-2,i,s);if(x<=t&&e.equals(v)&&e.equals(P))break;y=!0,x=t}return x<g?(t.assign(v),a.assign(P)):(t.assign(_),a.assign(f),x=g),x},g=new n.Point2D,_=new n.Point2D,f=[p(g,_),n.Point2D.distance(r,g)+n.Point2D.distance(g,_)+n.Point2D.distance(_,o),g.x,g.y,_.x,_.y];u.splice(u.length,0,...f)}let m=u[0],d=u[1],p=0;for(let e=6;e<u.length;e+=6)u[e]<m&&(m=u[e],d=u[e+1],p=e);let g=p;for(let e=0;e<u.length;e+=6)e!==p&&u[e+1]<d&&Math.abs(m-u[e])<10*m&&(d=u[e+1],g=e);e.construct(r,new n.Point2D(u[g+2],u[g+3]),new n.Point2D(u[g+4],u[g+5]),o)}(this,e,i)}writeInBufferStream(e,t){const i=new Float64Array(4);return this.writeInBuffer_(i),e.writeRangeFromArray(t,i.length,i,!0,1),t+i.length}writeInBuffer_(e){return e[0]=this.m_cp[0].x,e[1]=this.m_cp[0].y,e[2]=this.m_cp[1].x,e[3]=this.m_cp[1].y,4}readFromBufferStream(e,t){const i=new Float64Array(4);e.queryRange(t,i.length,i,!0,1),this.readFromBuffer_(i)}readFromBuffer_(e){this.m_cp=n.makeObjectArray(n.Point2D,2),this.m_cp[0].x=e[0],this.m_cp[0].y=e[1],this.m_cp[1].x=e[2],this.m_cp[1].y=e[3],this.m_cachedValues=null}snapControlPoints(e){const t=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(t);const i=(t,i,s)=>{let r=!1;return n.Point2D.sqrDistance(t,s)<=e&&(r=!t.equals(s),t.setCoordsPoint2D(s),n.Point2D.sqrDistance(i,s)<=e&&(r||=!i.equals(s),i.setCoordsPoint2D(s))),r},s=i(t[1],t[2],t[0]),r=i(t[2],t[1],t[3]);return(s||r)&&this.setControlPoints(t),s||r}needsSnapControlPoints(e){if(!e)return!1;const t=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(t);const i=(t,i,s)=>{let r=!1;return n.Point2D.sqrDistance(t,s)<=e&&(r=!t.equals(s),t.setCoordsPoint2D(s),n.Point2D.sqrDistance(i,s)<=e&&(r||=!i.equals(s),i.setCoordsPoint2D(s))),r},s=i(t[1],t[2],t[0]),r=i(t[2],t[1],t[3]);return s||r}calculateSpecialPointsForCracking(e,t){return function(e,t,i){i.length=0;{const t=new n.ECoordinate;Ai(e,t);const s=new y;if(Hi(e,t,s),s.isZero())return t.isZero()||t.eq(new n.ECoordinate(1))?0:(i.push(t.value()),1)}const s=n.makeObjectArray(n.ECoordinate,4);xi(e,s,!0);const r=n.makeObjectArray(n.ECoordinate,4);vi(e,r,!0);const o=n.makeObjectArray(n.ECoordinate,6),a=s[3].negate().mulE(r[1]).addE(s[2].mulE(r[2]).mul(2)).addE(s[1].mulE(r[3])),l=s[3].negate().mulE(r[1]).subE(s[2].mulE(r[2]).mul(2)).addE(s[1].mulE(r[3])),c=s[2].mulE(s[2]).subE(r[2].mulE(r[2]));o[0]=r[1].mulE(r[1]).mulE(a).addE(s[1].mulE(s[1]).mulE(l)).addE(s[1].mulE(r[1]).mulE(c).mul(2)).mul(6),o[1]=s[2].mulE(r[1]).subE(s[1].mulE(r[2])).mulE(s[2].mulE(s[2]).addE(s[1].mulE(s[3]).mul(2)).addE(r[2].mulE(r[2])).addE(r[1].mulE(r[3]).mul(2))).mul(24);const h=s[1].mulE(r[2]).mulE(r[2]).mulE(r[3]),u=s[2].mulE(s[2]).mulE(s[3]).mulE(r[1]).subE(h).mul(156),m=s[3].mulE(r[1]).subE(s[1].mulE(r[3])),d=s[3].mulE(r[1]).subE(s[1].mulE(r[3])),p=s[1].mulE(s[3]).mulE(d).addE(r[1].mulE(r[3]).mulE(m)).mul(72),g=r[1].mulE(r[3]).subE(s[1].mulE(s[3])),_=s[2].mulE(r[2]).mulE(g).mul(120),f=s[1].mulE(s[2]).mulE(s[2]).mulE(r[3]),x=s[3].mulE(r[1]).mulE(r[2]).mulE(r[2]).subE(f).mul(36);o[2]=u.addE(p).addE(_).addE(x);const v=s[2].mulE(s[3]).mulE(s[3]).mulE(r[1]).subE(s[1].mulE(r[2]).mulE(r[3]).mulE(r[3])).mul(360),P=s[2].mulE(r[2]).mulE(s[2].mulE(s[3]).subE(r[2].mulE(r[3]))).addE(s[3].mulE(r[2]).mulE(r[2]).mulE(r[2])).subE(s[2].mulE(s[2]).mulE(s[2]).mulE(r[3])).mul(24),b=s[2].mulE(r[1]).mulE(r[3]).mulE(r[3]).subE(s[1].mulE(s[3]).mulE(s[3]).mulE(r[2])).mul(72),E=s[3].mulE(r[3]).mulE(r[1].mulE(r[2]).subE(s[1].mulE(s[2]))).mul(288);o[3]=v.addE(P).addE(b).addE(E),o[4]=r[3].mulE(r[3]).addE(s[3].mulE(s[3])).mulE(s[3].mulE(r[1]).subE(s[1].mulE(r[3]))).mul(270).addE(s[3].mulE(r[2]).subE(s[2].mulE(r[3]))).mulE(s[2].mulE(s[3]).addE(r[2].mulE(r[3]))).mul(180),o[5]=s[3].mulE(r[2]).subE(s[2].mulE(r[3])).mulE(s[3].mulE(s[3]).addE(r[3].mulE(r[3]))).mul(216);const S=n.makeObjectArray(n.ECoordinate,5),C=Ne(o,5,new n.Envelope1D(0,1),!1,S,5);if(C>0){let s=Math.abs(e.getCurvature(0)),r=0;const o=Math.abs(e.getCurvature(1));(o>s||!Number.isFinite(o))&&(r=1);for(let t=0;t<C;t++){const i=Math.abs(e.getCurvature(S[t].value()));e.getCoord2D(S[t].value()),(i>s||!Number.isFinite(i))&&(s=i,r=S[t].value())}if((!Number.isFinite(s)||1/s<t)&&!n.isOneOf(r,0,1)){const t=e.getCoord2D(r);if(!t.equals(e.getStartXY())&&!t.equals(e.getEndXY()))return i.push(r),1}}if(!e.isClosed()){const t=[0,0],n=nn(e,t,!1);for(let e=0;e<n;e++)t[e]>0&&t[e]<1&&i.push(t[e]);return i.length}return 0}(this,e,t)}ensureXYMonotone(){return Oi(this)}setCoordsForIntersector(e,t,i){!function(e,t,i,s){if(t.isEqual(e.m_XStart,e.m_YStart)&&i.isEqual(e.m_XEnd,e.m_YEnd))return;const o=!!s&&e.isMonotoneQuickAndDirty(),a=new r.Transformation2D,l=n.makeObjectArray(n.Point2D,3);l[0].setCoords(e.m_XStart,e.m_YStart),l[2].setCoords(e.m_XEnd,e.m_YEnd);const c=new n.Point2D;c.setSub(l[2],l[0]),c.leftPerpendicularThis(),l[1].setAdd(l[0],c);const h=n.makeObjectArray(n.Point2D,3);h[0].setCoordsPoint2D(t),h[2].setCoordsPoint2D(i),c.setSub(h[2],h[0]),c.leftPerpendicularThis(),h[1].setAdd(h[0],c),a.setFromTwoTriangles(l,h)?a.transformPoints2D(e.m_cp,2,e.m_cp):(n.lerpPoint2D(t,i,1/3,e.m_cp[0]),n.lerpPoint2D(t,i,2/3,e.m_cp[1])),e.changeEndPoints2D(t,i),o&&Oi(e)}(this,e,t,i)}copyToImpl(e){const t=e;t.m_cp[0].assign(this.m_cp[0]),t.m_cp[1].assign(this.m_cp[1]),Ti(t,wi(this))}reverseImpl(){this.m_cp[1]=n.swap(this.m_cp[0],this.m_cp[0]=this.m_cp[1])}equalsImpl(e){const t=e;return!!this.m_cp[0].equals(t.m_cp[0])&&!!this.m_cp[1].equals(t.m_cp[1])}equalsImplTol(e,t){const i=e;return!!this.m_cp[0].isEqualPoint2D(i.m_cp[0],t)&&!!this.m_cp[1].isEqualPoint2D(i.m_cp[1],t)}swapImpl(e){const t=e;var i;t.m_cp[0]=n.swap(this.m_cp[0],this.m_cp[0]=t.m_cp[0]),t.m_cp[1]=n.swap(this.m_cp[1],this.m_cp[1]=t.m_cp[1]),(i=t).m_cachedValues=n.swap(this.m_cachedValues,this.m_cachedValues=i.m_cachedValues)}afterCompletedModification(){Di(this)}isIntersecting(e,t,i){return 0!==Pr(!1,this,e,t,i)}intersect(e,t,i,n,s){return Cr(!1,this,e,t,i,n,s)}intersectPoint(e,i,s){return function(e,i,s,r){const o=new p;if($i(e,n.Envelope1D.unit(),o),o.inflate(r),!o.isIntersectingPoint2D(i))return 0;const a=Ci(e);let l=0,c=a.specialPoints[0];const h=[];for(let n=1,s=a.specialPoints.length;n<s;++n){const s=a.specialPoints[n],r=Ii(e,i,c,s);if(0===h.length)h.push(r);else if(r.t===r.tmin)t.geometryReleaseAssert(h.at(-1).d<=r.d),h.at(-1).tmax=r.tmax;else if(h.at(-1).t===h.at(-1).tmax){t.geometryReleaseAssert(h.at(-1).d>=r.d);const e=h.at(-1).tmin;h[h.length-1]=r,h.at(-1).tmin=e}else h.push(r);c=s}for(const e of h)if(e.d<=r){const i=e.t;s?(l>=s.length&&t.throwOutOfRangeException(""),s[l]=i,l++):l++}return l}(this,e,i,s)}endPointModified(){Di(this)}clearEndPointModified(){}}dn.type=t.GeometryType.enumBezier;class pn{constructor(){this.length=Number.NaN,this.area=Number.NaN,this.centroidX=Number.NaN,this.centroidY=0,this.specialPoints=[],this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}}function gn(e,i,s,r,o,a,l,c){for(;;){const h=n.Point2D.distance(i[0],i[2]),u=n.Point2D.distance(i[0],i[1])+n.Point2D.distance(i[1],i[2]);if(u-h<=o+r*u)return e+n.lerp(h,u,.5);const m=n.makeObjectArray(n.Point2D,4),d=e=>(Cn(i,s,1,e,m),m[1].length());if(0===l&&c<8){t.geometryReleaseAssert(c<8);let h=d(0),m=d(1);a[0]+=2,h>m&&(m=n.swap(h,h=m),i[2]=n.swap(i[0],i[0]=i[2]),s[2]=n.swap(s[0],s[0]=s[2]));let p=h/(h+m),g=1,_=u;for(;p<1/32&&_>=o+r*_;){g/=4;const e=d(g);a[0]++,p=h/(e+h);const t=new n.Point2D;if(is(i,s,.5*g,t),_=n.Point2D.distance(t,i[0]),_<=o){const e=new n.Point2D;is(i,s,g,e),_+=n.Point2D.distance(e,t)}}if(1!==g){const t=n.makeObjectArray(n.Point2D,3),h=[0,0,0];Un(i,s,g,i,s,t,h),e=gn(e,t,h,r,o,a,0,c+1),l++,c++;continue}}let p=!1;const g=8;a[0]+=g;const _=$t(g,d,0,1),f=16;a[0]+=f;const y=$t(f,d,0,1);if(p=Math.abs(_-y)>o+r*u,!p)return e+y;if(l<8&&c<9){const t=n.makeObjectArray(n.Point2D,3),h=[0,0,0];Un(i,s,.5,i,s,t,h),e=gn(e,t,h,r,o,a,l+1,c+1),l++,c++;continue}const x=32;a[0]+=x;const v=$t(x,d,0,1);if(p=Math.abs(y-v)>o+r*u,!p)return e+v;const P=64;a[0]+=P;const b=$t(P,d,0,1);if(p=Math.abs(v-b)>o+r*u,!p)return e+b;const E=128;a[0]+=E;const S=$t(E,d,0,1);return p=Math.abs(b-S)>o+r*u,e+S}}function _n(e,t,i,s,r){if(i===t)return 0;const o=n.makeObjectArray(n.Point2D,3),a=[0,0,0];e.queryControlPoints(o),e.queryWeights(a);const l=[0,0,0],c=n.makeObjectArray(n.Point2D,3);return zn(o,a,t,i,c,l),gn(0,c,l,s,r,[0],0,0)}class fn{constructor(e,t,i){this.controlPoints=n.cloneObjectArray(e,3),this.weights=[0,0,0],n.memcpy(this.weights,t,0,0,3),this.point=i.clone()}getMaxDerivative(){return 3}getValue(e,t){if(0===e){const e=new n.Point2D;is(this.controlPoints,this.weights,t,e);const i=n.makeObjectArray(n.Point2D,4);return Cn(this.controlPoints,this.weights,1,t,i),2*e.sub(this.point).dotProduct(i[1])}if(1===e){const e=new n.Point2D;is(this.controlPoints,this.weights,t,e);const i=n.makeObjectArray(n.Point2D,4);return Cn(this.controlPoints,this.weights,2,t,i),2*(e.sub(this.point).dotProduct(i[2])+i[1].dotProduct(i[1]))}if(2===e){const e=new n.Point2D;is(this.controlPoints,this.weights,t,e);const i=n.makeObjectArray(n.Point2D,4);return Cn(this.controlPoints,this.weights,3,t,i),2*(e.sub(this.point).dotProduct(i[3])+3*i[1].dotProduct(i[2]))}return 0}getError(e){return t.geometryReleaseAssert(0),0}}function yn(e,t,i,s){const r={tmin:0,tmax:0,t:0,d:0,pt:n.Point2D.getNAN().clone()},o=n.makePrimitiveArray(18,Number.NaN),a=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(a),a[2].subThis(t),a[1].subThis(t),a[0].subThis(t);const l=[0,0,0];e.queryWeights(l);const c=[1,ss(l),1],h=os(l,i),u=os(l,s),m=be(new fn(a,c,new n.Point2D(0,0)),n.Envelope1D.construct(h,u),18,o);is(a,c,h,r.pt),r.t=h,r.d=n.Point2D.distance(r.pt,new n.Point2D(0,0));const d=new n.Point2D;is(a,c,u,d);const p=n.Point2D.distance(d,new n.Point2D(0,0));p<r.d&&(r.d=p,r.t=u,r.pt.assign(d));for(let e=0;e<m;e++){is(a,c,o[e],d);const t=n.Point2D.distance(d,new n.Point2D(0,0));t<r.d&&(r.d=t,r.t=rs(l,o[e]),r.pt.assign(d))}return r}function xn(e,t,i,s,r){let o=!0;const a=n.makeObjectArray(n.Point2D,4),l=lt(5,t,i,s,r,(t=>(Sn(e,1,t,a),(o?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*a[1].length())));o=!1;const c=lt(5,t,i,s,r,(t=>(Sn(e,1,t,a),(o?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*a[1].length())));return new n.Point2D(l,c)}function vn(e){e.m_cachedValues=null}function Pn(e){if(e.m_cachedValues)return e.m_cachedValues;const t=new pn,i=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(i);const s=[0,0,0];return e.queryWeights(s),bn(i,s,t.specialPoints),On(e,t),t}function bn(e,t,i){if(0===t[1])return i.length=0,i.push(0),void i.push(1);const s=n.makeObjectArray(n.ECoordinate,8);s[0].set(0);let r=1;{const i=new n.ECoordinate(e[1].x).subThis(e[0].x).mulThis(t[1]).mulThis(t[0]),o=new n.ECoordinate(e[2].x).subThis(e[0].x).mulThis(t[2]).mulThis(t[0]),a=i.subE(o).addThisE(new n.ECoordinate(e[2].x).subThis(e[1].x).mulThis(t[2]).mulThis(t[1]));o.subThisE(i.mul(2));const l=n.makeObjectArray(n.ECoordinate,2);let c=Ae(a,o,i,new n.Envelope1D(0,1),!1,l);c<0&&(c=0);for(let e=0;e<c;e++)n.isOneOf(l[e].value(),0,1)||(s[r]=l[e],r++)}{const i=new n.ECoordinate(e[1].y).subThis(e[0].y).mulThis(t[1]).mulThis(t[0]),o=new n.ECoordinate(e[2].y).subThis(e[0].y).mulThis(t[2]).mulThis(t[0]),a=i.subE(o).addThisE(new n.ECoordinate(e[2].y).subThis(e[1].y).mulThis(t[2]).mulThis(t[1]));o.subThisE(i.mul(2));const l=n.makeObjectArray(n.ECoordinate,2);let c=Ae(a,o,i,new n.Envelope1D(0,1),!1,l);c<0&&(c=0);for(let e=0;e<c;e++)n.isOneOf(l[e].value(),0,1)||(s[r]=l[e],r++)}if(s[r].set(1),r++,r>2){n.sortRange(s,0,r,((e,t)=>n.standardNumericCompare(e.value(),t.value())));let e=0,t=s[0].value(),i=1;for(let n=1;n<r;n++)s[n].eq(s[n-1])?(t+=s[n].value(),i++):(i>1&&(t/=i,s[e].set(t)),e++,s[e]=s[n],t=s[n].value(),i=1);e++,r=e}s[0].set(0),s[r-1].set(1),i.length=r;for(let e=0;e<r;e++)i[e]=s[e].value()}function En(e,t,i){if(i){if(t<0)return t;if(t>1)return t-1+En(e,1,!1)}if(e.isDegenerate(0))return 0;const n=1===t,s=Pn(e);if(n&&!Number.isNaN(s.length))return s.length;const r=Nn(e),o=r/e.calculateUpperLength2D();let a=0,l=0;for(let i=1,n=s.specialPointsCount();i<n;i++){const n=s.specialPoints[i];if(a+=_n(e,l,Math.min(t,n),o,r),t<=n)break;l=n}return n&&(s.length=a),a}function Sn(e,t,i,s){const r=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(r);const o=[0,0,0];e.queryWeights(o),Cn(r,o,t,i,s)}function Cn(e,i,s,r,o){const a=[e[0],e[1],e[2]],l=[i[0],i[1],i[2]],c=n.makeObjectArray(n.Point2D,4);!function(e,i,n,s,r){t.geometryReleaseAssert(n>0);const o=[e[0].clone(),e[1].clone(),e[2].clone()];if(!o[0].isZero()){for(let e=1;e<3;++e)o[e].subThis(o[0]);o[0].setCoords(0,0)}const a=wn(o,i,0,s),l=Dn(i,0,s),c=a.divide(l);if(r[0].assign(c),0===n)return;const h=[i[1]*i[0],i[2]*i[0]*.5,i[1]*i[2]],u=[e[1].sub(e[0]),e[2].sub(e[0]),e[2].sub(e[1])],m=l*l,d=wn(u,h,0,s).mul(2).divide(m);if(r[1].assign(d),1===n)return;const p=Dn(i,1,s),g=2*l*p,_=wn(u,h,1,s).mul(2).sub(d.mul(g)).divide(m);if(r[2].assign(_),2===n)return;const f=wn(u,h,2,s).mul(2),y=2*(p*p+l*Dn(i,2,s)),x=f.sub(_.mul(g).mul(2)).sub(d.mul(y)).divide(m);r[3].assign(x),3!==n&&t.throwInternalErrorException("")}(a,l,s,r,c);for(let e=0;e<=s;e++)o[e].setCoords(c[e].x,c[e].y)}function wn(e,i,s,r){if(0===s){if(r<=.5){const t=new n.Point2D;n.lerpPointLo(2,e[0].mul(i[0]),e[1].mul(i[1]),r,t);const s=new n.Point2D;n.lerpPointLo(2,e[1].mul(i[1]),e[2].mul(i[2]),r,s);const o=new n.Point2D;return n.lerpPointLo(2,t,s,r,o),o}{const t=new n.Point2D;n.lerpPointHi(2,e[0].mul(i[0]),e[1].mul(i[1]),r,t);const s=new n.Point2D;n.lerpPointHi(2,e[1].mul(i[1]),e[2].mul(i[2]),r,s);const o=new n.Point2D;return n.lerpPointHi(2,t,s,r,o),o}}if(1===s){const t=e[1].mul(i[1]),n=t.sub(e[0].mul(i[0])).mul(1-r).add(e[2].mul(i[2]).sub(t).mul(r));return n.mulThis(2),n}if(2===s){const t=e[1].mul(i[1]),n=e[2].mul(i[2]).sub(t).sub(t.sub(e[0].mul(i[0])));return n.mulThis(2),n}t.throwInternalErrorException("")}function Tn(e,t,i,s){if(s.toDouble()<=.5){const i=new y;n.lerpLoPointE(2,e[0].mulE(t[0]),e[1].mulE(t[1]),s,i);const r=new y;n.lerpLoPointE(2,e[1].mulE(t[1]),e[2].mulE(t[2]),s,r);const o=new y;return n.lerpLoPointE(2,i,r,s,o),o}{const i=new y;n.lerpHiPointE(2,e[0].mulE(t[0]),e[1].mulE(t[1]),s,i);const r=new y;n.lerpHiPointE(2,e[1].mulE(t[1]),e[2].mulE(t[2]),s,r);const o=new y;return n.lerpHiPointE(2,i,r,s,o),o}}function Dn(e,i,s){if(0===i){const t=n.lerp(e[0],e[1],s),i=n.lerp(e[1],e[2],s);return n.lerp(t,i,s)}return 1===i?2*((1-s)*(e[1]-e[0])+(e[2]-e[1])*s):2===i?2*(e[2]-e[1]-(e[1]-e[0])):void t.throwInternalErrorException("")}function In(e,t,i){const s=n.snap(i,0,1),r=n.makeObjectArray(n.Point2D,4);if(Cn(e,t,3,s,r),r[1].isZero()){if(r[2].isZero())return r[3];{const e=r[2].clone();return 1===s&&e.negateThis(),e}}return r[1]}class An{constructor(e,t){this.len=0,this.b=e,this.len=t}getMaxDerivative(){return 1}getValue(e,t){return 0===e?this.len-En(this.b,t,!1):0}getError(e){return t.geometryReleaseAssert(0),0}}function Mn(e){const i=n.makeObjectArray(n.Point2D,3),s=[0,0,0];return e.queryControlPoints(i),e.queryWeights(s),function(e,i){const s=ss(i);if(1===s)return St(e);if(0===s)return 0;const r=[new n.Point2D(0,0),e[1].sub(e[0]),e[2].sub(e[0])],o=r[1].crossProduct(r[2]);if(s<1){t.geometryReleaseAssert(s>0);const e=1-s;let i;if(e<.01)i=-1/3+e*(2/15+e*(3/35+e*(16/315+e*(20/693+e*(16/1001+e*(56/6435))))));else{const t=e*(1+s),r=Math.atan2(Math.sqrt(e),Math.sqrt(1+s));i=s*(.5*s-n.rsqrt(t)*r)/t}return o*i}{const e=(s-1)*(s+1);return.25*s/Math.pow(e,1.5)*(-2*s*Math.sqrt(e)*o-4*r[1].y*r[2].x*Math.atanh(Math.sqrt((s-1)/(s+1)))-r[1].x*r[2].y*Math.log(2*s*(s-Math.sqrt(e))-1))}}(i,s)}function Nn(e){var t;return t=e.calculateUpperLength2D(),256*n.doubleEps()*t}function Rn(e){return e.m_cachedValues}function On(e,t){e.m_cachedValues=t}function Gn(e,t,i,s,r){const o=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(o);const a=[0,0,0];e.queryWeights(a);const l=[0];return 1===kn(o,a,t,n.Envelope1D.unit(),s,r,1,l)?l[0]:Number.NaN}function kn(e,s,r,o,a,l,c,h){t.checkAndThrow(n.Envelope1D.unit().contains(o)&&c>0,""),(l<0||Number.isNaN(l))&&(l=Number.MAX_VALUE);const u=new Array(3);for(let t=0;t<3;++t)u[t]=e[t].sub(r);const m=ss(s),d=v.constructPoint2D(u[0]),p=v.constructPoint2D(u[1]),g=v.constructPoint2D(u[2]),_=n.MPValue.constructDouble(m),f=_.clone();f.ldexpThis(1);const y=d.dotProduct(p.sub(d)).mul(_),x=_.mul(_.addDouble(2)),P=g.sub(p.mul(x.ldexp(1))),b=p.sqrLength().mul(_.mul(_).ldexp(1)).add(d.sqrLength().mul(_.ldexp(2).subDouble(1))).add(d.dotProduct(P)),E=g.sub(p.mul(f)).add(d.mul(f.subDouble(1))),S=p.mul(_).sub(d).dotProduct(E).mulDouble(3),C=p.dotProduct(g).mul(_.subDouble(3).mul(_)).ldexp(1),w=p.sqrLength().mul(_.mul(_).ldexp(2)),T=d.sqrLength().mul(_.ldexp(2).subDouble(3)),D=d.dotProduct(g.sub(p.mul(_.mulDouble(3).subDouble(1)).mul(_))).ldexp(1),I=g.sqrLength().addThis(C).addThis(w).addThis(T).addThis(D),A=d.add(g).sub(p.mul(f)),M=_.subDouble(1),N=g.sub(d).dotProduct(A).mul(M),R=new n.Point2D(0,0),O=[];let G=new n.Point2D;is(u,s,o.vmin,G);let k=n.Point2D.distance(G,R);if(k<=l&&O.push(new n.Point2D(o.vmin,k)),o.vmin!==o.vmax&&(is(u,s,o.vmax,G),k=n.Point2D.distance(G,R),k<=l&&O.push(new n.Point2D(o.vmax,k))),o.width()>0){const e=u[2].isZero(),t=n.makeObjectArray(n.MPValue,4),i=Qe(N,I,S,b,y,58,o,e,t);for(let e=0;e<i;e++){if(!o.containsExclusiveCoordinate(t[e].toDouble()))continue;let i=t[e].toDouble();i=rs(s,i);const r=new n.Point2D;is(u,s,i,r),k=n.Point2D.distance(r,R),k<=l&&O.push(new n.Point2D(i,k))}}if(a){t.geometryReleaseAssert(o.equals(n.Envelope1D.unit()));{is(u,s,-1,G,!0);const e=new n.Point2D;is(u,s,0,e);const t=new Ar({start:G,end:e}),i=t.getClosestCoordinate(R,!0);i<1&&(G=t.getCoord2D(i),k=n.Point2D.distance(G,R),k<=l&&O.push(new n.Point2D(i-1,k)))}{is(u,s,2,G,!0);const e=new n.Point2D;is(u,s,o.vmax,e);const t=new Ar({start:e,end:G}),i=t.getClosestCoordinate(R,!0);i>0&&(G=t.getCoord2D(i),k=n.Point2D.distance(G,R),k<=l&&O.push(new n.Point2D(1+i,k)))}}if(!O.length)return 0;O.sort(((e,t)=>e.compare(t)));let V=0;const F=O[0].x;if(h[V++]=F,V<c){const e=i.calculateToleranceFromPointsForOps(u,4,!1).total(),t=O[0].y;for(let i=1,n=O.length;i<n;i++)if(O[i].y>t+e){O.length=i;break}O.sort(((e,t)=>n.standardNumericCompare(e.x,t.x))),V=0,h[V++]=O[0].x;for(let e=1,t=O.length;e<t;e++)O[e].x!==h[V-1]&&V<c&&(h[V++]=O[e].x)}return V}function Vn(e,t,i){const s=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(s);const r=[0,0,0];e.queryWeights(r),Fn(s,r,t,i)}function Fn(e,t,i,s){if(i.equalsRange(0,1))return void s.setFromPoints(e,3);const r=n.makeObjectArray(n.Point2D,3);zn(e,t,i.vmin,i.vmax,r,[0,0,0]),s.setFromPoints(r,3)}function Ln(e){const t=n.compareNoNANs(e[0].y,e[1].y),i=n.compareNoNANs(e[1].y,e[2].y);if(t>=0&&i>=0||t<=0&&i<=0){const t=n.compareNoNANs(e[0].x,e[1].x),i=n.compareNoNANs(e[1].x,e[2].x);if(t>=0&&i>=0||t<=0&&i<=0)return!0}return!1}function qn(e){const t=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(t);const i=Hn(t);return i&&(e.m_cp.setCoordsPoint2D(t[1]),e.afterCompletedModification()),i}function Hn(e){let t=!1;for(let i=0;i<2;i++){const s=n.compareNoNANs(e[0][i],e[2][i]);s>0?(n.compareNoNANs(e[0][i],e[1][i])<0&&(e[1][i]=e[0][i],t=!0),n.compareNoNANs(e[1][i],e[2][i])<0&&(e[1][i]=e[2][i],t=!0)):s<0?(n.compareNoNANs(e[0][i],e[1][i])>0&&(e[1][i]=e[0][i],t=!0),n.compareNoNANs(e[1][i],e[2][i])>0&&(e[1][i]=e[2][i],t=!0)):e[1][i]!==e[0][i]&&(e[1][i]=e[0][i],t=!0)}return t}function Un(e,s,r,o,a,l,c){t.geometryReleaseAssert(r>=0&&r<=1&&o!==l&&a!==c),t.geometryReleaseAssert(s[0]>0&&s[2]>0&&s[1]>=0);const h=[1,ss(s),1],u=os(s,r),m=n.cloneObjectArray(e,3),d=n.makeObjectArray(i.Point3D,3);Jn(m,h,d);const p=n.makeObjectArray(i.Point3D,3),g=n.makeObjectArray(i.Point3D,3);as(d,u,o?p:null,l?g:null),ls(s,r,a,c);const _=Ln(m);if(o){for(let e=0;e<3;++e)ts(p[e],o[e]);hs(m,o),_&&Hn(o)}if(l){for(let e=0;e<3;++e)ts(g[e],l[e]);hs(m,l),_&&Hn(l)}}function zn(e,s,r,o,a,l){if(t.geometryReleaseAssert(r>=0&&o<=1&&r<=o),r===o){const t=new n.Point2D,i=es(e,s,r,t);return cs(e,t),a[0].assign(t),a[1].assign(t),a[2].assign(t),l[0]=i,l[1]=i,void(l[2]=i)}if(0===r&&1===o)return a[0].assign(e[0]),a[1].assign(e[1]),a[2].assign(e[2]),l[0]=s[0],l[1]=s[1],void(l[2]=s[2]);const c=n.makeObjectArray(i.Point3D,3);{const t=[1,ss(s),1],i=os(s,r),n=os(s,o);Jn(e,t,c),as(c,n,c,null),as(c,i>=n?1:i/n,null,c)}const h=[0,0,0];ls(s,o,h,null),ls(h,r/o,null,h);const u=Ln(e),m=n.makeObjectArray(n.Point2D,3);ts(c[1],m[1]),is(e,s,r,m[0]),is(e,s,o,m[2]),hs(e,m);for(let e=0;e<3;++e)a[e].assign(m[e]),l[e]=h[e];u&&Hn(a)}function Yn(e,t,i){const s=ss(t),r=[1,s,1],o=4*s/(3*(1+s));i[0].assign(e[0]),i[3].assign(e[2]),n.lerpPoint2D(e[0],e[1],o,i[1]),n.lerpPoint2D(e[2],e[1],o,i[2]),new dn({cp:i}),new Le({points:e,weight:s});let a=0,l=.1,c=0;for(let t=0;t<9;t++,l+=.1){const t=new n.Point2D;is(e,r,l,t);const s=new n.Point2D;Li(i,l,s);const o=n.Point2D.sqrDistance(t,s);o>a&&(a=o,c=l)}{const t=new n.Point2D;is(e,r,c,t);const s=[0];en(i,t,n.Envelope1D.unit(),!1,-1,1,s);const o=new n.Point2D;return Li(i,s[0],o),a=n.Point2D.sqrDistance(t,o),Math.sqrt(a)}}function Bn(e,t,i,n,s){if(s){if(0!==Er(t,i))return e?4:2}else if(E(t,i))return 1;return 0!==Wn(e,t,i,null,null,null,n,void 0!==s&&s,0,!1)?4:0}function Xn(e,t,i,n,s){if(s){if(0!==Er(t,i))return e?4:2}else if(E(t,i))return 1;return 0!==Zn(e,t,i,null,null,null,n,s??!1,0,!1)?4:0}function jn(e,t,i,n,s){if(s){if(0!==Er(t,i))return e?4:2}else if(E(t,i))return 1;return 0!==$n(e,t,i,null,null,null,n,s??!1,0,!1)?4:0}function Wn(e,i,s,r,o,a,l,c,h,u){if(null!==o&&(o.length=0),null!==a&&(a.length=0),null!==r&&(r.length=0),s.isDegenerate(0)){const e=[0,0],t=i.intersectPoint(s.getStartXY(),e,l);if(t>0){if(null!==o)for(let i=0;i<t;i++)o.push(e[i]);if(null!=a)for(let e=0;e<t;e++)a.push(0);if(null!=r)for(let s=0;s<t;s++){const t=new n.Point2D;i.queryCoord2D(e[s],t),r.push(t)}}return t}const m=L(i,s);if(l=Math.max(l,m),i.isDegenerateToLineHelper(m)){const e=new Ar({start:i.getStartXY(),end:i.getEndXY()}),t=ie(e,s,r,o,a,l,c,u);if(o)for(let n=0;n<t;++n){const t=e.getCoord2D(o[n]);o[n]=i.getClosestCoordinate(t,!1)}return t}if(q(i,s,l))return 0;const d=n.makeObjectArray(n.Point2D,3);i.queryControlPoints(d);const p=[0,0,0];i.queryWeights(p);const g=[1,ss(p),1],_=s.getEndXY().sub(s.getStartXY()),f=_.clone();f.leftPerpendicularThis();const y=d[0].clone(),x=d[1].clone(),v=d[2].clone(),P=x.sub(y),b=v.sub(y),E=v.sub(x),S=g[0],C=g[1],w=g[2],T=S*C,D=S*w,I=C*w,A=P.dotProduct(f)*T,M=b.dotProduct(f)*D;let N=A,R=M-2*A,O=E.dotProduct(f)*I+M-M;const G=n.makePrimitiveArray(13,Number.NaN),k=n.makePrimitiveArray(13,Number.NaN);let V=Ee(O,R,N,n.Envelope1D.unit(),!1,G);V<0&&(G[0]=0,G[1]=1,V=2);let F=0;for(let e=0,t=F;e<V;++e){const i=new n.Point2D;is(d,g,G[e+t],i),k[F]=s.getClosestCoordinate(i,!1),n.Point2D.distance(i,s.getCoord2D(k[F]))<=l&&(G[F]=G[e+t],F++)}const H=n.makeObjectArray(n.Point2D,3),U=n.makeObjectArray(n.Point2D,3);if(i.queryControlPoints(U),U[0].subThis(s.getStartXY()),U[1].subThis(s.getStartXY()),U[2].subThis(s.getStartXY()),function(e,t,i,s=!1){const r=n.makeObjectArray(n.Point2D,3);s?(r[0].setCoordsPoint2D(e[0]),r[1].setCoordsPoint2D(e[1]),r[1].subThis(r[0]),r[2].setCoordsPoint2D(e[2]),r[2].subThis(r[0]),r[0].setCoords(0,0)):(r[0].setCoordsPoint2D(e[0]),r[1].setCoordsPoint2D(e[1]),r[2].setCoordsPoint2D(e[2])),r[0].mulThis(t[0]),r[1].mulThis(t[1]),r[2].mulThis(t[2]),i[1].setCoords(r[1].x-r[0].x,r[1].y-r[0].y),i[2].setCoordsPoint2D(r[2].sub(r[1])),i[2].subThis(i[1]),i[1].x*=2,i[1].y*=2,i[0].setCoordsPoint2D(r[0])}(U,g,H,!1),Math.abs(_.x)>=Math.abs(_.y)){const e=_.y/_.x;O=H[2].y-H[2].x*e,R=H[1].y-H[1].x*e,N=H[0].y-H[0].x*e}else{const e=_.x/_.y;O=H[2].x-H[2].y*e,R=H[1].x-H[1].y*e,N=H[0].x-H[0].y*e}const z=i.getEndXY().equals(s.getStartXY())||i.getEndXY().equals(s.getEndXY()),Y=[0,0];V=Ee(O,R,N,n.Envelope1D.unit(),z,Y);for(let e=0,t=F;e<V;++e){G[e+t]=Y[e];const i=new n.Point2D;is(d,g,G[e+t],i),k[F]=s.getClosestCoordinate(i,!1),n.Point2D.distance(i,s.getCoord2D(k[F]))<=l&&(G[F]=G[e+t],F++)}t.geometryReleaseAssert(F<G.length+4);for(let e=0;e<F;e++)G[e]=rs(p,G[e]);V=i.intersectPoint(s.getStartXY(),Y,l);for(let e=0;e<V;e++)G[F]=Y[e],k[F++]=0;V=i.intersectPoint(s.getEndXY(),Y,l);for(let e=0;e<V;e++)G[F]=Y[e],k[F++]=1;V=s.intersectPoint(i.getStartXY(),Y,l);for(let e=0;e<V;e++)k[F]=Y[e],G[F++]=0;V=s.intersectPoint(i.getEndXY(),Y,l);for(let e=0;e<V;e++)k[F]=Y[e],G[F++]=1;return 0===F?0:Tr(e,i,s,G,k,F,r,o,a,l,c,0,u)}function Zn(e,t,i,s,o,a,l,c,h,u){if(Zs(i))return Wn(e,t,new Ar({start:i.getStartXY(),end:i.getEndXY()}),s,o,a,l,c,0,u);const m=L(t,i);if(q(t,i,l=Math.max(l,m)))return 0;const d=[],p=[],g=n.makeObjectArray(n.Point2D,4);{t.queryControlPoints(g);const e=n.makeObjectArray(n.Point2D,4),s=new r.Transformation2D;i.canonicToWorldTransformation(s);const o=new r.Transformation2D;o.setInvert(s),o.transformPoints2D(g,4,e);const a=n.makeObjectArray(n.MPValue,3),h=n.makeObjectArray(n.MPValue,3),u=n.makeObjectArray(n.MPValue,3),m=[0,0,0];t.queryWeights(m),Kn(e,m,a,h,u);const _=n.makeObjectArray(n.MPValue,3);_[0].setDouble(i.getSemiMinorAxis()),_[0].sqrThis(),_[1].setDouble(i.getSemiMajorAxis()),_[1].sqrThis(),_[2].setThis(_[0]),_[2].mulThis(_[1]),_[2].negateThis();const f=Xe(a,2,h,2,u,2,_,0,n.Envelope1D.unit(),n.Envelope1D.unit(),d,c);if(f>0){let e=0;for(let s=0;s<f;s++){const r=new n.Point2D;t.queryCoord2D(d[s],r);const o=i.getClosestCoordinate(r,!1),a=new n.Point2D;i.queryCoord2D(o,a),n.Point2D.distance(r,a)<=l&&(d[e]=d[s],p.push(o),e++)}d.length=e}}const _=[0,1];for(let e=0;e<2;e++){const s=0===e?i.getStartXY():i.getEndXY(),r=Gn(t,s,n.Envelope1D.unit(),!1,-1),o=new n.Point2D;t.queryCoord2D(r,o),n.Point2D.distance(s,o)<=l&&(d.push(r),p.push(_[e]))}for(let e=0;e<2;e++){const t=[0,3];{const s=i.getClosestCoordinate(g[t[e]],!1),r=new n.Point2D;i.queryCoord2D(s,r),n.Point2D.distance(g[t[e]],r)<=l&&(d.push(_[e]),p.push(s))}}return Tr(e,t,i,d,p,d.length,s,o,a,l,c,0,u)}function Qn(e,i,s,r,o,a,l,c,h,u){const m=n.makeObjectArray(n.Point2D,3);i.queryControlPoints(m);const d=n.makeObjectArray(n.Point2D,3);if(s.queryControlPoints(d),H(m,d,3)<0)return Qn(e,s,i,r,a,o,l,c,h,!u);const g=L(i,s);if(i.isDegenerateToLineHelper(g)){const t=new Ar({start:i.getStartXY(),end:i.getEndXY()}),n=Wn(e,s,t,r,a,o,l,c,0,!u);if(o)for(let e=0;e<n;++e){const n=t.getCoord2D(o[e]);o[e]=i.getClosestCoordinate(n,!1)}return n}if(s.isDegenerateToLineHelper(g)){const t=new Ar({start:s.getStartXY(),end:s.getEndXY()}),n=Wn(e,i,t,r,o,a,l,c,0,u);if(a)for(let e=0;e<n;++e){const i=t.getCoord2D(a[e]);a[e]=s.getClosestCoordinate(i,!1)}return n}if(q(i,s,l=Math.max(l,g)))return 0;const _=n.makePrimitiveArray(3,Number.NaN);i.queryWeights(_);const f=n.makePrimitiveArray(3,Number.NaN);s.queryWeights(f);const y=[1,ss(_),1],x=[1,ss(f),1],v=new n.Envelope1D(0,1),P=new n.Envelope1D(0,1);{const e=p.constructEmpty();Fn(m,y,new n.Envelope1D(0,1),e);const t=p.constructEmpty();Fn(d,x,new n.Envelope1D(0,1),t);const i=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*l),t.inflate(3*l),!e.intersectW(t))return 0;if(e.maxDim()<.1*i){if(ns(m,y,e,v),ns(d,x,e,P),v.isEmpty()||P.isEmpty())return 0;zn(m,y,v.vmin,v.vmax,m,y),zn(d,x,P.vmin,P.vmax,d,x)}}const b=Dr(m,2,d,2,l);if(0===b)return 0;const E=[],S=[];if(-1===b){const e=n.makeObjectArray(n.MPValue,3),t=n.makeObjectArray(n.MPValue,3),i=n.makeObjectArray(n.MPValue,3);Kn(m,y,e,t,i);const s=n.makeObjectArray(n.MPValue,3),r=n.makeObjectArray(n.MPValue,3),o=n.makeObjectArray(n.MPValue,3);Kn(d,x,s,r,o);const a=[],h=[],p=Be(e,2,t,2,i,2,s,2,r,2,o,2,0,n.Envelope1D.unit(),n.Envelope1D.unit(),a,h,c,0,u);if(p>0)for(let e=0;e<p;e++){const t=new n.Point2D;is(d,x,h[e],t);const i=new n.Point2D;is(m,y,a[e],i),n.Point2D.distance(i,t)<=l&&(E.push(a[e]),S.push(h[e]))}}for(let e=0;e<2;e++){let i,s,r;0===e?(i=m,s=d,r=x):(i=d,s=m,r=y);for(let o=0;o<2;o++){const a=0===o?0:i.length-1,c=new n.Point2D,h=[0],u=kn(s,r,i[a],n.Envelope1D.unit(),!1,-1,1,h);t.geometryReleaseAssert(1===u),is(s,r,h[0],c),n.Point2D.distance(i[a],c)<=l&&(0===e?(E.push(0===a?0:1),S.push(h[0])):(S.push(0===a?0:1),E.push(h[0])))}}if(0===E.length)return 0;if(!v.equalsRange(0,1))for(let e=0;e<E.length;++e)E[e]=Le.recalculateParentT(v.vmin,v.vmax,E[e]);if(!P.equalsRange(0,1))for(let e=0;e<S.length;++e)S[e]=Le.recalculateParentT(P.vmin,P.vmax,S[e]);for(let e=0;e<E.length;++e)E[e]=rs(_,E[e]);for(let e=0;e<S.length;++e)S[e]=rs(f,S[e]);return Tr(e,i,s,E,S,E.length,r,o,a,l,c,0,u)}function $n(e,t,i,s,r,o,a,l,c,h){if(t.isLine())return Vt(e,i,new Ar({start:t.getStartXY(),end:t.getEndXY()}),s,o,r,a,l,0,!h);if(i.isLine())return Wn(e,t,new Ar({start:i.getStartXY(),end:i.getEndXY()}),s,r,o,a,l,0,h);const u=L(t,i);if(q(t,i,a=Math.max(a,u)))return 0;const m=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(m);const d=n.makeObjectArray(n.Point2D,3);i.queryControlPoints(d);const p=Dr(m,2,d,2,a);if(0===p)return 0;const g=[],_=[];if(-1===p){const e=n.makeObjectArray(n.MPValue,3),s=n.makeObjectArray(n.MPValue,3),r=n.makeObjectArray(n.MPValue,3),o=[0,0,0];t.queryWeights(o),Kn(m,o,e,s,r);const c=n.makeObjectArray(v,3);Ht(d,c);const u=Be(e,2,s,2,r,2,[c[0].x,c[1].x,c[2].x],2,[c[0].y,c[1].y,c[2].y],2,null,0,0,n.Envelope1D.unit(),n.Envelope1D.unit(),g,_,l,0,h);if(u>0){let e=0;for(let s=0;s<u;s++){const r=new n.Point2D;i.queryCoord2D(_[s],r);const o=new n.Point2D;t.queryCoord2D(g[s],o),n.Point2D.distance(o,r)<=a&&(g[e]=g[s],_[e]=_[s],e++)}g.length=e,_.length=e}}for(let e=0;e<2;e++){let s;s=0===e?m:d;for(let r=0;r<2;r++){const o=0===r?0:s.length-1;let l;const c=new n.Point2D;0===e?(l=Tt(i,s[o],n.Envelope1D.unit(),!1),i.queryCoord2D(l,c)):(l=Gn(t,s[o],n.Envelope1D.unit(),!1,-1),t.queryCoord2D(l,c)),n.Point2D.distance(s[o],c)<=a&&(0===e?(g.push(0===o?0:1),_.push(l)):(_.push(0===o?0:1),g.push(l)))}}return Tr(e,t,i,g,_,g.length,s,r,o,a,l,0,h)}function Kn(e,t,i,s,r){const o=n.MPValue.constructDouble(t[0]),a=n.MPValue.constructDouble(t[1]),l=n.MPValue.constructDouble(t[2]);i[0].setDouble(e[0].x),i[0].mulThis(o),i[1].setDouble(e[1].x),i[1].mulThis(a),i[2].setDouble(e[2].x),i[2].mulThis(l),i[2].subThis(i[1]),i[1].subThis(i[0]),i[2].subThis(i[1]),i[1].ldexpThis(1),s[0].setDouble(e[0].y),s[0].mulThis(o),s[1].setDouble(e[1].y),s[1].mulThis(a),s[2].setDouble(e[2].y),s[2].mulThis(l),s[2].subThis(s[1]),s[1].subThis(s[0]),s[2].subThis(s[1]),s[1].ldexpThis(1),r[0].setDouble(t[0]),r[1].setDouble(t[1]),r[2].setThis(r[1]),r[2].ldexpThis(1),r[2].negateThis(),r[2].addThis(r[0]),r[2].addDoubleThis(t[2]),r[1].subThis(r[0]),r[1].ldexpThis(1)}function Jn(e,t,i){for(let n=0;n<3;++n)i[n].setCoordsPoint2DZ(e[n].mul(t[n]),t[n])}function es(e,t,i,s){if(0===i)return s.assign(e[0]),t[0];if(1===i)return s.assign(e[2]),t[2];const r=[e[0].x*t[0],e[1].x*t[1],e[2].x*t[2]],o=[e[0].y*t[0],e[1].y*t[1],e[2].y*t[2]],a=[t[0],t[1],t[2]],l=i;let c,h,u;if(i<=.5){const e=n.lerpLo(r[0],r[1],l),t=n.lerpLo(r[1],r[2],l);c=n.lerp(e,t,l);const i=n.lerpLo(o[0],o[1],l),s=n.lerpLo(o[1],o[2],l);h=n.lerp(i,s,l);const m=n.lerpLo(a[0],a[1],l),d=n.lerpLo(a[1],a[2],l);u=n.lerpLo(m,d,l)}else{const e=n.lerpHi(r[0],r[1],l),t=n.lerpHi(r[1],r[2],l);c=n.lerpHi(e,t,l);const i=n.lerpHi(o[0],o[1],l),s=n.lerpHi(o[1],o[2],l);h=n.lerpHi(i,s,l);const m=n.lerpHi(a[0],a[1],l),d=n.lerpHi(a[1],a[2],l);u=n.lerpHi(m,d,l)}return c/=u,h/=u,s.setCoords(c,h),cs(e,s),u}function ts(e,t){return t.setCoords(e.x/e.z,e.y/e.z),e.z}function is(e,t,i,n,s){if(s){if(i<0)return void W(new Ar({start:e[0],end:e[0].add(In(e,t,0).getUnitVector())}),i,n);if(i>1)return void W(new Ar({start:e[2],end:e[2].add(In(e,t,1).getUnitVector())}),i-1,n)}es(e,t,i,n)}function ns(e,t,i,s){s.setEmpty();const r=[];r.push(new n.Envelope1D(0,1));const o=.5*Math.max(i.width(),i.height());for(;r.length;){const a=r.at(-1);r.pop();const l=new p;if(Fn(e,t,a,l),l.isIntersectingW(i)){const e=Math.max(l.width(),l.height());if(i.containsW(l)||e<=o||a.width()<1e-12)s.merge(a);else{const e=a.getCenter();r.push(n.Envelope1D.construct(a.vmin,e)),r.push(n.Envelope1D.construct(e,a.vmax))}}}}function ss(e){return e[1]/Math.sqrt(e[0]*e[2])}function rs(e,t){const i=Math.sqrt(e[2]/e[0]);return t/n.lerp(i,1,t)}function os(e,t){const i=Math.sqrt(e[0]/e[2]);return t/n.lerp(i,1,t)}function as(e,s,r,o){t.geometryReleaseAssert(s>=0&&s<=1),(new i.Point3D).setCoordsPoint3D(e[0]),(new i.Point3D).setCoordsPoint3D(e[1]),(new i.Point3D).setCoordsPoint3D(e[2]);const a=new i.Point3D,l=new i.Point3D,c=new i.Point3D;n.lerpPoint(3,e[0],e[1],s,a),n.lerpPoint(3,e[1],e[2],s,l),n.lerpPoint(3,a,l,s,c);const h=e[2].clone();r&&(r[0].assign(e[0]),r[1].assign(a),r[2].assign(c)),o&&(o[0].assign(c),o[1].assign(l),o[2].assign(h))}function ls(e,i,s,r){const o=[e[0],e[1],e[2]];t.geometryReleaseAssert(i>=0&&i<=1&&s!==r);const a=n.lerp(o[0],o[1],i),l=n.lerp(o[1],o[2],i),c=n.lerp(a,l,i);s&&(s[0]=o[0],s[1]=a,s[2]=c),r&&(r[0]=c,r[1]=l,r[2]=o[2])}function cs(e,t){const i=n.Envelope1D.constructEmpty();i.vmin=i.vmax=e[0].x,i.mergeNeCoordinate(e[1].x),i.mergeNeCoordinate(e[2].x),t.x=n.snap(t.x,i.vmin,i.vmax),i.vmin=i.vmax=e[0].y,i.mergeNeCoordinate(e[1].y),i.mergeNeCoordinate(e[2].y),t.y=n.snap(t.y,i.vmin,i.vmax)}function hs(e,t){const i=new n.Envelope1D;i.vmin=i.vmax=e[0].x,i.mergeNeCoordinate(e[1].x),i.mergeNeCoordinate(e[2].x),t[0].x=n.snap(t[0].x,i.vmin,i.vmax),t[1].x=n.snap(t[1].x,i.vmin,i.vmax),t[2].x=n.snap(t[2].x,i.vmin,i.vmax),i.vmin=i.vmax=e[0].y,i.mergeNeCoordinate(e[1].y),i.mergeNeCoordinate(e[2].y),t[0].y=n.snap(t[0].y,i.vmin,i.vmax),t[1].y=n.snap(t[1].y,i.vmin,i.vmax),t[2].y=n.snap(t[2].y,i.vmin,i.vmax)}const us=n.geometryPi/180,ms=180/n.geometryPi;function ds(e){let t=e;return t=function(e){let t=e;return t>=-360&&t<720?(t<0?t+=360:t>=360&&(t-=360),t):(t=n.fmod(t,360),t<0&&(t+=360),t)}(t),t>180&&(t-=360),t}function ps(e){return e*us}function gs(e){return e*ms}function _s(e){const t=n.twoPi();let i=e;return i>=-t&&i<2*t?(i<0&&(i+=t),i>=t&&(i-=t),i):(i=n.fmod(i,t),i<0&&(i+=t),i)}function fs(e){const t=n.pi();let i=e;return i>-t&&i<=t||(i=_s(i),i>t&&(i-=n.twoPi())),i}var ys=i.VertexDescription;class xs extends X{constructor(e){if(void 0===e||n.isOnlyProperty(e,"vd"))return super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_semiMajorAxis=0,this.m_minorMajorRatio=1,this.m_rotation=0,this.m_cosr=1,this.m_sinr=0,this.m_center=new n.Point2D(0,0),this.m_sweepAngle=0,this.m_startAngle=0,this.m_interior=new n.Point2D(0,0),void(this.m_bits=0);if(e.copy)return super(e),void(this!==e.copy&&(this.m_center=new n.Point2D(0,0),this.m_interior=new n.Point2D(0,0),e.copy.copyToImpl(this)));if(e.move)super(e),this.m_semiMajorAxis=e.move.m_semiMajorAxis,this.m_minorMajorRatio=e.move.m_minorMajorRatio,this.m_rotation=e.move.m_rotation,this.m_cosr=e.move.m_cosr,this.m_sinr=e.move.m_sinr,this.m_center=e.move.m_center.clone(),this.m_sweepAngle=e.move.m_sweepAngle,this.m_startAngle=e.move.m_startAngle,this.m_interior=e.move.m_interior.clone(),this.m_bits=e.move.m_bits,this.m_cachedValues=e.move.m_cachedValues,e.move.m_cachedValues=null;else{if(e.fromPoint)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new n.Point2D(0,0),this.m_interior=new n.Point2D(0,0),void this.constructCircularArcThreePoint(e.fromPoint,e.toPoint,e.interiorPoint);if(e.center)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new n.Point2D(0,0),this.m_interior=new n.Point2D(0,0),void this.constructCircleRadius(e.radius,e.center,e.bIsCounterClockwise);if(e.semiMajorAxis)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),void this.constructEllipticArcEndPoints(e.fromPoint,e.toPoint,e.semiMajorAxis,e.minorMajorRatio,e.axisXRotationRad,e.bBigArc,e.bIsCounterClockwise)}}getBoundary(){return ve(this)}assignCopy(e){return this!==e&&e.copyTo(this),this}constructCircleRadius(e,t,i=!1){return this.constructEllipse(e,1,t,0,i),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructCircleCenterAndPoint(e,t,i=!1){const s=n.Point2D.distance(e,t);return this.constructEllipticArcEndPointsCenter(t,t,s,1,0,!0,i,e),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructTwoPointCircle(e,t,i=!1){const s=n.Point2D.lerp(e,t,.5);return this.constructCircleCenterAndPoint(s,e,i),this}constructLineEllipticArc(e,t){return Ws(this,e,t,1),this}constructLineCircularArc(e,t){return Ws(this,e,t,0),this}constructEllipse(e,t,i,s,r=!1){this.m_semiMajorAxis=Math.abs(e),this.m_minorMajorRatio=Math.abs(t),this.m_minorMajorRatio>1&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);const o=new n.Point2D(0,this.m_minorMajorRatio*this.m_semiMajorAxis),a=Math.cos(s),l=Math.sin(s);return o.rotateDirect(a,l),o.addThis(i),this.constructEllipticArcEndPointsCenter(o,o,this.m_semiMajorAxis,this.m_minorMajorRatio,s,!0,r,i),this}inflate(e){if(this.isDegenerateToLine())return;let t=this.getSemiMinorAxis()+e;if(t=t<=0?0:(this.getSemiMajorAxis()+e)/this.getSemiMajorAxis(),this.isCircular()){const e=new r.Transformation2D;e.setShiftCoords(-this.m_center.x,-this.m_center.y),e.scale(t,t),e.shiftCoords(this.m_center.x,this.m_center.y),this.applyTransformation(e)}else{const e=new r.Transformation2D;this.canonicToWorldTransformation(e);const i=e.clone();i.invertPreciseThis(),i.scale(t,t),i.multiply(e),this.applyTransformation(i)}}constructEnclosingCircle(e,i,s=!1){return function(e,i,s,r){0===s&&t.throwInvalidArgumentException("construct_enclosing_circle");const o=[0,0,0],a=vs(i,s,o);if(1===a)e.constructCircleRadius(0,i[o[0]],r);else if(2===a){const t=n.Point2D.lerp(i[o[0]],i[o[1]],.5),s=n.Point2D.distance(i[o[0]],t),a=n.Point2D.distance(i[o[1]],t);e.constructCircleRadius(Math.max(s,a),t,r)}else if(3===a){const t=n.Point2D.calculateCircleCenterFromThreePoints(i[o[0]],i[o[1]],i[o[2]]),s=n.Point2D.distance(i[o[0]],t),a=n.Point2D.distance(i[o[1]],t),l=n.Point2D.distance(i[o[2]],t);e.constructCircleRadius(Math.max(s,a,l),t,r)}else t.throwInternalErrorException("unexpected")}(this,e,i,s),this}constructThreePointCircle(e,t,i,s=!1){if(e.equals(t)||t.equals(i)||e.equals(i)){const n=e.clone(),r=t.clone(),o=i.clone();return n.equals(r)&&r.assign(o),this.constructTwoPointCircle(n,r,s)}{const r=n.Point2D.calculateCircleCenterFromThreePoints(e,t,i);if(!r.isFinite()||!Number.isFinite(n.Point2D.distance(e,r))){const s=n.Point2D.distance(e,t),r=n.Point2D.distance(e,i);this.constructLineCircularArc(e,s>=r?t:i)}return this.constructCircleCenterAndPoint(r,e,s)}}constructCircularArcThreePoint(e,t,i){const s=new n.ECoordinate(e.x),r=new n.ECoordinate(t.x),o=new n.ECoordinate(i.x),a=new n.ECoordinate(e.y),l=new n.ECoordinate(t.y),c=new n.ECoordinate(i.y),h=new n.ECoordinate(.5),u=r.subE(s),m=l.subE(a),d=o.subE(s),p=c.subE(a),g=u.mulE(p).subThisE(m.mulE(d));if(g.scaleError(10),g.isZero()){if(!u.isZero()||!m.isZero())return Ws(this,e,t,0),this;{const n=e.clone().addThis(t).mulThis(.5).addThis(i).mulThis(.5),s=i.sub(n).length();this.constructEllipticArcEndPointsCenter(e,t,s,1,0,!0,!1,n),this.m_interior.assign(i)}return this.setProjectionBehavior(0),this}const _=u.sqr().addThisE(m.sqr()).mulThisE(h),f=d.sqr().addThisE(p.sqr()).mulThisE(h),y=_.mulE(p).subThisE(f.mulE(m)),x=u.mulE(f).subThisE(d.mulE(_));y.divThisE(g),x.divThisE(g);const v=y.sqr().addThisE(x.sqr());v.sqrtThis();const P=y.addE(s),b=x.addE(a);let E=e.x-P.value(),S=e.y-b.value();const C=Math.atan2(S,E);E=t.x-P.value(),S=t.y-b.value();const w=Math.atan2(S,E);E=i.x-P.value(),S=i.y-b.value();const T=Math.atan2(S,E);let D=T-2*n.pi();for(;D<C;)D+=2*n.pi();let I=w-2*n.pi();for(;I<D;)I+=2*n.pi();let A=T+2*n.pi();for(;A>C;)A-=2*n.pi();let M,N=w+2*n.pi();for(;N>A;)N-=2*n.pi();M=I-C<C-N?I-C:N-C;const R=new n.Point2D(P.value(),b.value());return this.constructEllipticArcEndPointsCenter(e,t,v.value(),1,0,Math.abs(M)>n.pi(),M>0,R),this.m_interior.assign(i),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructCircularArc(e,t,i,n){return this.constructEllipticArcGeneral(e,1,t,i,n,0),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructEllipticArcEndPoints(e,t,i,n,s,r,o){return js(this,e,t,i,n,s,r,o)}constructEllipticArcEndPointsCenter(e,t,i,n,s,r,o,a){return js(this,e,t,i,n,s,r,o,a)}constructEllipticArcGeneral(e,t,i,s,r,o){this.m_semiMajorAxis=Math.abs(e),this.m_minorMajorRatio=Math.abs(t),this.m_minorMajorRatio>1&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);const a=fs(o),l=Math.cos(a),c=Math.sin(a),h=new n.Point2D(this.m_semiMajorAxis,this.m_minorMajorRatio*this.m_semiMajorAxis),u=n.Point2D.getNAN(),m=fs(s);u.x=h.x*Math.cos(m),u.y=h.y*Math.sin(m),u.rotateDirect(l,c),u.addThis(i);const d=n.snapMagnitude(r,n.twoPi());let p=d;Math.abs(p)===n.twoPi()&&(p=0);const g=n.Point2D.getNAN();return g.x=h.x*Math.cos(m+p),g.y=h.y*Math.sin(m+p),g.rotateDirect(l,c),g.addThis(i),this.constructEllipticArcEndPointsCenter(u,g,this.m_semiMajorAxis,this.m_minorMajorRatio,a,Math.abs(d)>n.pi(),d>0,i)}constructEllipticArcAsNURB(e,i,n,s){return(s>=1||s<0)&&t.throwInvalidArgumentException("construct_elliptic_arc_as_NURB: weight"),i.isFinite()||t.throwInvalidArgumentException("construct_elliptic_arc_as_NURB: control_point"),hr([e,i,n],s*s,null,!1,this),this}constructCanonic(e){return this.assignCopy(e),e.isDegenerateToLine()||e.m_center.isEqual(0,0)&&0===this.m_rotation||(this.m_XStart=e.getSemiMajorAxis()*Math.cos(e.m_startAngle),this.m_YStart=e.getSemiMinorAxis()*Math.sin(e.m_startAngle),this.m_XEnd=e.getSemiMajorAxis()*Math.cos(e.getEndAngle()),this.m_YEnd=e.getSemiMinorAxis()*Math.sin(e.getEndAngle()),this.m_center.setCoords(0,0),this.m_rotation=0,this.m_cosr=1,this.m_sinr=0,dr(this),this.afterCompletedModification(),e!==this&&V(this,e)),this}isCircular(){return 1===this.m_minorMajorRatio&&0===this.m_rotation&&!this.isDegenerateToLine()}isDegenerateToLineHelper(e){if(this.isLine())return!0;if(this.isMajor())return!1;const t=this.getEndXY().sub(this.getStartXY()).length();return!(this.calculateLength2D()-t>e)}isDegenerateToLine(){return Zs(this)}getCenter(){return this.m_center.clone()}setCenter(e){if(!this.m_center.isNAN()){const t=e.sub(this.m_center);this.m_XStart+=t.x,this.m_YStart+=t.y,this.m_XEnd+=t.x,this.m_YEnd+=t.y,this.m_interior.addThis(t),this.m_center.assign(e),this.endPointModified(),this.normalizeAfterEndpointChange()}}getAxisXRotation(){return this.m_rotation}getSemiAxes(){return n.Point2D.construct(this.m_semiMajorAxis,this.m_semiMajorAxis*this.m_minorMajorRatio)}getSemiMajorAxis(){return this.m_semiMajorAxis}getSemiMinorAxis(){return this.m_semiMajorAxis*this.m_minorMajorRatio}getMinorMajorRatio(){return this.m_minorMajorRatio}isClockwise(){return!nr(this)}isMajor(){return rr(this)}getSweepAngle(){return this.m_sweepAngle}getStartAngle(){return this.m_startAngle}getEndAngle(){return this.m_startAngle+this.m_sweepAngle}getGeometryType(){return t.GeometryType.enumEllipticArc}queryEnvelope(e){if(4===e.m_EnvelopeType){e.setEmpty(),e.assignVertexDescription(this.m_description);const t=s.Envelope2D.constructEmpty();this.queryEnvelope(t),e.setEnvelope(t);for(let t=1,i=this.m_description.getAttributeCount();t<i;t++){const i=this.m_description.getSemantics(t);for(let n=0,s=ys.getComponentCount(i);t<s;t++){const t=this.queryInterval(i,n);e.setIntervalEnvelope(i,n,t)}}}else 2===e.m_EnvelopeType?fr(this,n.Envelope1D.unit(),e):t.throwNotImplementedException("3d not impl")}applyTransformation(e){Ks(this,e,!1,null,null)}createInstance(){return new xs}calculateLength2D(){return function(e){if(Zs(e))return 1*n.Point2D.distance(e.getStartXY(),e.getEndXY());if(1===e.m_minorMajorRatio)return Math.abs(-1*e.getSweepAngle())*e.m_semiMajorAxis;const t=Qs(e,0);return Qs(e,1)-t}(this)}queryControlPointsHelper(e){t.throwInternalErrorException("")}queryCoord2D(e,t){if(Zs(this))Z(e,this.getStartXY(),this.getEndXY(),t);else if(0===e)t.assign(n.Point2D.construct(this.m_XStart,this.m_YStart));else if(1===e)t.assign(n.Point2D.construct(this.m_XEnd,this.m_YEnd));else{const i=Us(this,e),s=new n.Point2D(this.m_semiMajorAxis*Math.cos(i),this.getSemiMinorAxis()*Math.sin(i));s.rotateDirect(this.m_cosr,this.m_sinr),s.addThis(this.m_center),t.assign(s)}}queryCoord2DE(e,t){!function(e,t,i){if(Zs(e))K(new Ar({start:e.getStartXY(),end:e.getEndXY()}),t,i);else if(0===t.value())i.set(e.getStartXY());else if(1===t.value())i.set(e.getEndXY());else{const s=new n.ECoordinate;zs(e,t,s);const r=new n.ECoordinate,o=new n.ECoordinate;n.ECoordinate.st_cosAndSin(s,r,o);const a=y.constructCoordsE(new n.ECoordinate(e.m_semiMajorAxis).mulThisE(r),new n.ECoordinate(e.m_semiMajorAxis).mulThis(e.m_minorMajorRatio).mulThisE(o)),l=new n.ECoordinate(e.m_rotation);n.ECoordinate.st_cosAndSin(l,r,o),a.rotateDirect(r,o),a.addThisE(y.constructPoint2D(e.m_center)),i.setE(a)}}(this,e,t)}queryCoord2DMP(e,i){t.throwNotImplementedException("")}getCoordX(e){const t=new n.Point2D;return this.queryCoord2D(e,t),t.x}getCoordY(e){const t=new n.Point2D;return this.queryCoord2D(e,t),t.y}cut(e,t,i){const n=new Mr;return this.queryCut(e,t,n,i),n.releaseSegment()}queryCut(e,t,i,s){const r=i.createEllipticArc();s&&r.dropAllAttributes();let o=0===e&&1===t;if(o&&!s)return void this.copyTo(r);const a=n.Point2D.getNAN();this.queryCoord2D(e,a);const l=n.Point2D.getNAN();if(this.queryCoord2D(t,l),!o)if(a.equals(l))t-e>.5&&this.isMajor()&&this.isClosed()?(o=!0,e=0,t=1):1===t?e=t:t=e;else if(e>0&&a.isEqual(this.m_XStart,this.m_YStart)&&(e=0),t<1&&l.isEqual(this.m_XEnd,this.m_YEnd)&&(t=1),o=0===e&&1===t,o&&!s)return void this.copyTo(r);if(r.m_center.assign(this.m_center),r.m_semiMajorAxis=this.m_semiMajorAxis,r.m_minorMajorRatio=this.m_minorMajorRatio,r.m_interior.assign(this.m_interior),r.m_rotation=this.m_rotation,r.m_cosr=this.m_cosr,r.m_sinr=this.m_sinr,r.m_sweepAngle=this.m_sweepAngle,r.m_startAngle=this.m_startAngle,r.m_bits=this.m_bits,D(r,a.x,a.y),A(r,l.x,l.y),o)return void er(r,Ys(this));r.m_startAngle=Us(this,e),r.m_sweepAngle=Us(this,t)-r.m_startAngle,r.m_startAngle=Vs(r.m_startAngle),sr(r,Math.abs(r.m_sweepAngle)>n.pi()),s&&r.assignVertexDescription(this.m_description),dr(r),qs(r);const c=this.m_description.getAttributeCount();if(c>1&&!s){for(let t=1;t<c;t++){const i=this.m_description.getSemantics(t),n=ys.getComponentCount(i);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,i,t);r.setStartAttribute(i,t,n)}}for(let e=1;e<c;e++){const i=this.m_description.getSemantics(e),n=ys.getComponentCount(i);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,i,e);r.setEndAttribute(i,e,n)}}}r.afterCompletedModification()}queryDerivative(e,t){!function(e,t,i){if(Zs(e))i.setE(y.constructPoint2D(e.getEndXY()).subE(y.constructPoint2D(e.getStartXY())));else{const s=new n.ECoordinate;zs(e,t,s);const r=new y;if(r.setCoordsE(new n.ECoordinate(e.m_semiMajorAxis).negate().mulE((new n.ECoordinate).setSin(s)),new n.ECoordinate(e.getSemiMinorAxis()).mulE((new n.ECoordinate).setCos(s))),e.m_rotation){const t=new n.ECoordinate(e.m_rotation);r.rotateDirect((new n.ECoordinate).setCos(t),(new n.ECoordinate).setSin(t))}r.scaleThis(new n.ECoordinate(e.getSweepAngle())),i.setE(r)}}(this,e,t)}cutArcIgnoreAttributes(e,t,i){let s=0===e&&1===t;const r=new n.Point2D;this.queryCoord2D(e,r);const o=new n.Point2D;this.queryCoord2D(t,o),s||(r.equals(o)?t-e>.5&&this.isMajor()&&this.isClosed()?(s=!0,e=0,t=1):1===t?e=t:t=e:(e>0&&r.isEqual(this.m_XStart,this.m_YStart)&&(e=0),t<1&&o.isEqual(this.m_XEnd,this.m_YEnd)&&(t=1),s=0===e&&1===t)),i.m_center.assign(this.m_center),i.m_semiMajorAxis=this.m_semiMajorAxis,i.m_minorMajorRatio=this.m_minorMajorRatio,i.m_interior.assign(this.m_interior),i.m_rotation=this.m_rotation,i.m_cosr=this.m_cosr,i.m_sinr=this.m_sinr,i.m_sweepAngle=this.m_sweepAngle,i.m_startAngle=this.m_startAngle,i.m_bits=this.m_bits,D(i,r.x,r.y),A(i,o.x,o.y),s?er(i,Ys(this)):(i.m_startAngle=Us(this,e),i.m_sweepAngle=Us(this,t)-i.m_startAngle,i.m_startAngle=Vs(i.m_startAngle),sr(i,Math.abs(i.m_sweepAngle)>Math.PI),dr(i),i.afterCompletedModification())}changeEndPoints2D(e,t){Xs(this,e,t,!1)}getAttributeAsDbl(e,t,i){if(0===t)return 0===i?this.getCoordX(e):this.getCoordY(e);if(0===e)return this.getStartAttributeAsDbl(t,i);if(1===e)return this.getEndAttributeAsDbl(t,i);const s=this.calculateLength2D(),r=s>0?this.tToLength(e)/s:0,o=ys.getInterpolation(t),a=this.getStartAttributeAsDbl(t,i),l=this.getEndAttributeAsDbl(t,i);return n.interpolate(o,a,l,r,ys.getDefaultValue(t))}getClosestCoordinate(e,t){return yr(this,e,n.Envelope1D.unit(),t)}getClosestCoordinateOnInterval(e,t,i=-1){return yr(this,e,t,!1)}getYMonotonicParts(e,i=!1){e.length<2&&t.throwInvalidArgumentException("");const s=this.getSemiAxes(),r=Math.atan2(s.y*this.m_cosr,s.x*this.m_sinr),o=r+n.pi(),a=n.makePrimitiveArray(3,Number.NaN);let l=0;if(a[0]=Hs(this,r),a[0]>0&&a[0]<1&&l++,a[1]=Hs(this,o),a[1]>0&&a[1]<1&&(a[l]=a[1],l++),0===l)return 0;a[l]=1,l++,t.geometryReleaseAssert(e.length>=l);let c=0;for(let t=0;t<l;t++){const n=a[t];this.queryCut(c,n,e[t],i),c=n}return l}getMonotonicParts(e,i){if(e.length<4&&t.throwInvalidArgumentException(""),this.isDegenerateToLine())return e[0].createEllipticArc().assignCopy(this),i&&e[0].get().dropAllAttributes(),1;const s=this.getSemiAxes(),r=n.makePrimitiveArray(4,Number.NaN);r[0]=Math.atan2(s.y*this.m_cosr,s.x*this.m_sinr),r[1]=r[0]+n.pi(),r[2]=Math.atan2(-s.y*this.m_sinr,s.x*this.m_cosr),r[3]=r[2]+n.pi();const o=n.makePrimitiveArray(5,Number.NaN);let a=0;for(let e=0;e<4;e++)o[a]=Hs(this,r[e]),o[a]>0&&o[a]<1&&a++;if(0===a)return 0;n.numericSortRange(o,a),o[a-1]<1&&(o[a]=1,a++),t.geometryReleaseAssert(e.length>=a);let l=0;for(let t=0;t<a;t++){const n=o[t];this.queryCut(l,n,e[t],i),l=n}return a}intersectionWithAxis2D(e,t,i,s){if(Zs(this))return new Ar({start:this.getStartXY(),end:this.getEndXY()}).intersectionWithAxis2D(e,t,i,s);let r,o;const a=new n.ECoordinate(t),l=this.getSemiAxes();if(e){if(t>this.m_center.y+l.x||t<this.m_center.y-l.x)return 0;r=new n.ECoordinate(l.x).mulThis(this.m_sinr),o=new n.ECoordinate(l.y).mulThis(this.m_cosr),a.subThis(this.m_center.y)}else{if(t>this.m_center.x+l.x||t<this.m_center.x-l.x)return 0;r=new n.ECoordinate(l.x).mulThis(this.m_cosr),o=new n.ECoordinate(l.y).mulThis(-this.m_sinr),a.subThis(this.m_center.x)}const c=r.sqr(),h=o.sqr(),u=c.addE(h),m=o.mulE(a).mulThis(-2),d=a.sqr().subThisE(c),p=m.sqr().subThisE(u.mulE(d).mulThis(4)),g=r.mulE(a).mulThis(-2),_=a.sqr().subThisE(h),f=g.sqr().subThisE(u.mulE(_).mulThis(4));let y=p.eps()*Math.abs(f.value())<=f.eps()*Math.abs(p.value());y?r.isZero()&&(y=!1):o.isZero()&&(y=!0),y||(m.setE(g),d.setE(_));const x=n.makeObjectArray(n.ECoordinate,2);let v=Ae(u,m,d,n.Envelope1D.construct(-1,1),!1,x);if(0===v)return 0;const P=[0,0];let b=0;for(let e=0;e<v;e++){const t=new n.ECoordinate,i=new n.ECoordinate;y?(t.setE(x[e]),i.setE(a.subE(o.mulE(x[e])).divThisE(r))):(i.setE(x[e]),t.setE(a.subE(r.mulE(x[e])).divThisE(o)));const s=Hs(this,Math.atan2(t.value(),i.value()));s>=0&&s<=1&&(P[b]=s,b++)}return v=b,0===v?0:(2===v&&P[0]>P[1]&&(P[1]=n.swap(P[0],P[0]=P[1])),s&&n.memcpy(s,P,0,0,v),i&&(i[0]=e?this.getCoordX(P[0]):this.getCoordY(P[0]),v>1&&(i[1]=e?this.getCoordX(P[1]):this.getCoordY(P[1]),!s&&i[0]>i[1]&&(i[1]=n.swap(i[0],i[0]=i[1])))),v)}intersectionOfYMonotonicWithAxisX(e,t){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?t:Number.NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;const i=[0,0];return-1===this.intersectionWithAxis2D(!0,e,i,null)?t:i[0]}isCurve(){return!0}isDegenerate(e){return S(this,e)}isDegenerate3D(e,i){return t.geometryReleaseAssert(0),!1}queryLooseEnvelope(e){3!==e.m_EnvelopeType?this.queryLooseEnvelopeOnInterval(new n.Envelope1D(0,1),e):t.throwNotImplementedException("3d not impl")}clone(e){const t=new xs;return this.copyTo(t),t}queryInterval(e,t){if(0===e){if(Zs(this))return 0===t?n.Envelope1D.construct(this.getStartX(),this.getEndX()):n.Envelope1D.construct(this.getStartY(),this.getEndY());let e;const i=this.getSemiAxes();e=0===t?Math.atan2(-i.y*this.m_sinr,i.x*this.m_cosr):Math.atan2(i.y*this.m_cosr,i.x*this.m_sinr);const s=e+Math.PI,r=[0,0];r[0]=Hs(this,e),r[1]=Hs(this,s);const o=0===t?n.Envelope1D.construct(this.getStartX(),this.getEndX()):n.Envelope1D.construct(this.getStartY(),this.getEndY()),a=new n.Point2D;for(let e=0;e<2;e++){const i=r[e];i>0&&i<1&&(this.queryCoord2D(i,a),o.mergeNeCoordinate(0===t?a.x:a.y))}return o}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){const i=new n.Envelope1D(0,1);if(i.intersect(e),i.isEmpty())return void t.setEmpty();if(Zs(this))return t.setCoords(this.getCoord2D(i.vmin)),void t.mergeNe(this.getCoord2D(i.vmax));const s=this.getCoord2D(i.vmin),r=this.getCoord2D(i.vmax);if(1===this.m_minorMajorRatio&&Math.abs(this.m_sweepAngle)*i.width()<=n.geometryHalfPi){let e=n.Point2D.lerp(s,r,.5);const i=e.sub(this.m_center);return i.normalize(),e=e.add(i.mul(.5*n.Point2D.distance(s,r))),t.setCoords(s),t.mergeNe(r),void t.mergeNe(e)}fr(this,i,t)}tToLength(e){return Zs(this)?e*n.Point2D.distance(this.getStartXY(),this.getEndXY()):1===this.m_minorMajorRatio?Math.abs(this.getSweepAngle()*e)*this.m_semiMajorAxis:Qs(this,e)}parametricAngleToT(e){return Hs(this,e)}tToParametricAngle(e){return Us(this,e)}lengthToT(e){if(Zs(this)){const t=n.Point2D.distance(this.getStartXY(),this.getEndXY());return 0===t?0:e/t}if(1===this.m_minorMajorRatio){const t=Math.abs(this.getSweepAngle())*this.m_semiMajorAxis;return 0===t?0:e/t}{const t=function(e,t){if(Zs(e)){const i=n.Point2D.distance(e.getStartXY(),e.getEndXY());return 0===i?0:t/i}if(1===e.m_minorMajorRatio){const i=Math.abs(e.getSweepAngle()*e.m_semiMajorAxis);return 0===i?0:t/i}if(0===t)return 0;const i=e.getSweepAngle();if(0===i)return.5;const s=Bs(e),r=n.halfPi(),o=$s(e);i<0&&(t=-t);const a=t/e.m_semiMajorAxis+o;let l=n.inverseEllipticE(a,s.e2,s.completeE);return l-=r,l-=e.getStartAngle(),l/i}(this,e);return t}}calculateWeightedAreaCentroid2D(e){if(Zs(this)){const e=new n.Point2D;return e.setCoords(0,0),e}const t=mr(this),i=this.getStartXY().sub(this.m_center),s=this.getEndXY().sub(this.m_center),r=this.m_semiMajorAxis,o=this.getSemiMinorAxis(),a=this.m_startAngle+this.m_sweepAngle,l=new n.Point2D;l.x=r*o*(r*this.m_cosr*(-Math.sin(a)+Math.sin(this.m_startAngle))+o*(-Math.cos(a)+Math.cos(this.m_startAngle))*this.m_sinr)/3,l.y=r*o*(o*(Math.cos(a)-Math.cos(this.m_startAngle))*this.m_cosr+r*(-Math.sin(a)+Math.sin(this.m_startAngle))*this.m_sinr)/3;const c=s.add(i).mul(s.crossProduct(i)/6);return l.x-=c.x,l.y-=c.y,l.add(this.m_center.sub(e).mul(t))}calculateWeightedCentroid2D(){const e=new n.Point2D;if(this.isDegenerate(0))return e.setCoords(0,0),e;if(Zs(this))return e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e;let t=this.m_startAngle,i=this.m_startAngle+this.m_sweepAngle;if(i<t){const e=t;t=i,i=e}const s=Math.sin(t),r=Math.sin(i),o=Math.cos(t),a=Math.cos(i);if(1===this.m_minorMajorRatio){const t=this.getSemiMajorAxis(),i=t*t,n=i*(r-s),l=i*(o-a);e.setCoords(n,l)}else{const t=this.getSemiMajorAxis(),i=this.getSemiMinorAxis(),n=t*t,l=i*i,c=t*i,h=n-l,u=h/l,m=h/n,d=Math.sqrt(u),p=Math.sqrt(m),g=.5*c*(Math.asinh(d*r)/d+r*Math.sqrt(1+u*r*r))-.5*c*(Math.asinh(d*s)/d+s*Math.sqrt(1+u*s*s)),_=-.5*c*(Math.asin(p*a)/p+a*Math.sqrt(1-m*a*a))- -.5*c*(Math.asin(p*o)/p+o*Math.sqrt(1-m*o*o));e.setCoords(g,_)}return e.rotateDirect(this.m_cosr,this.m_sinr),e.assign(e.add(this.m_center.mul(this.calculateLength2D()))),e}isIntersectingPoint(e,t,i){if(i&&(e.isEqualPoint2D(this.getStartXY())||e.isEqualPoint2D(this.getEndXY())))return!1;if(!Zs(this)){const i=n.Point2D.distance(e,this.m_center),s=this.getSemiAxes();if(i<s.x-t||i>s.y+t)return!1}const s=this.getClosestCoordinate(e,!1),r=new n.Point2D;return this.queryCoord2D(s,r),n.Point2D.distance(r,e)<=t}isIntersectingPoint3D(e,i,n,s,r=1){return t.geometryReleaseAssert(0),!1}getTangent(e){if(Zs(this))return this.getEndXY().sub(this.getStartXY());{const t=Us(this,e),i=new n.Point2D;return i.setCoords(-this.m_semiMajorAxis*Math.sin(t),this.getSemiMinorAxis()*Math.cos(t)),this.m_rotation&&i.rotateDirect(this.m_cosr,this.m_sinr),i.scale(this.getSweepAngle()),i}}getDerivative(e){if(Zs(this))return this.getEndXY().sub(this.getStartXY());{const t=Us(this,e),i=new n.Point2D;return i.setCoords(-this.m_semiMajorAxis*Math.sin(t),this.getSemiMinorAxis()*Math.cos(t)),this.m_rotation&&i.rotateDirect(this.m_cosr,this.m_sinr),i.scale(this.getSweepAngle()),i}}normalizeAfterEndpointChange(){return!!or(this)&&(Zs(this)?(ar(this),!1):lr(this,!1))}projectionBehavior(){return(4&this.m_bits)>>2}setProjectionBehavior(e){this.m_bits=-5&this.m_bits|e<<2}convertToCanonic(e){const t=new n.Point2D(e.x,e.y);return t.subThis(this.m_center),t.rotateReverse(this.m_cosr,this.m_sinr),t}convertFromCanonic(e){const t=new n.Point2D(e.x,e.y);return t.rotateDirect(this.m_cosr,this.m_sinr),t.addThis(this.m_center),t}canonicToWorldTransformation(e){e.setRotate(this.m_cosr,this.m_sinr),e.shiftCoords(this.m_center.x,this.m_center.y)}getCurvature(e){const t=Us(this,e),i=new n.Point2D,s=this.getSemiMinorAxis();i.setCoords(-this.m_semiMajorAxis*Math.sin(t),s*Math.cos(t));const r=new n.Point2D;r.setCoords(-this.m_semiMajorAxis*Math.cos(t),-s*Math.sin(t)),this.m_rotation&&(i.rotateDirect(this.m_cosr,this.m_sinr),r.rotateDirect(this.m_cosr,this.m_sinr));const o=i.sqrLength();if(0===o)return Number.NaN;const a=Math.sqrt(o);return i.divThis(a),i.crossProduct(r)/o}getMonotonicPartParams(e,i){const s=n.makePrimitiveArray(6,Number.NaN);s[0]=0;let r=1;if(this.isDegenerateToLine())s[1]=1,r=2;else{const e=this.getSemiAxes(),t=n.makePrimitiveArray(4,Number.NaN);this.m_rotation?(t[0]=Math.atan2(e.y*this.m_cosr,e.x*this.m_sinr),t[1]=t[0]+Math.PI,t[2]=Math.atan2(-e.y*this.m_sinr,e.x*this.m_cosr),t[3]=t[2]+Math.PI):(t[0]=0,t[1]=Math.PI,t[2]=.5*Math.PI,t[3]=n.threeHalfPi());for(let e=0;e<4;e++){const i=Hs(this,t[e]);i>0&&i<1&&(s[r]=i,r++)}r>2&&n.numericSortRange(s,r),s[r]=1,r++}if(i){e<r&&t.throwInvalidArgumentException("");for(let e=0;e<r;e++)i[e]=s[e]}return r}calculateLowerLength2D(){const e=n.Point2D.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return e;const t=Math.abs(this.m_sweepAngle)*this.getSemiMinorAxis();return Math.max(t,e)}calculateUpperLength2D(){const e=n.Point2D.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return e;const t=Math.abs(this.m_sweepAngle)*this.getSemiMajorAxis();return Math.max(t,e)}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=n.swap(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=n.swap(this.m_YStart,this.m_YStart=this.m_YEnd);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=n.swap(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_startAngle=this.m_startAngle+this.m_sweepAngle,this.m_sweepAngle=-this.m_sweepAngle}}isLine(){return Zs(this)}copyIgnoreAttributes(e){e.m_XStart=this.m_XStart,e.m_YStart=this.m_YStart,e.m_XEnd=this.m_XEnd,e.m_YEnd=this.m_YEnd,e.m_center.assign(this.m_center),e.m_semiMajorAxis=this.m_semiMajorAxis,e.m_minorMajorRatio=this.m_minorMajorRatio,e.m_interior.assign(this.m_interior),e.m_rotation=this.m_rotation,e.m_cosr=this.m_cosr,e.m_sinr=this.m_sinr,e.m_sweepAngle=this.m_sweepAngle,e.m_startAngle=this.m_startAngle,e.m_bits=this.m_bits,tr(e)}calculateArea2DHelper(){return mr(this)}absNorm(){let e=this.getStartXY().norm(1)+this.getEndXY().norm(1);return this.isDegenerateToLine()||(e+=this.m_center.norm(1),e+=this.m_semiMajorAxis),e}queryEnvelopeW(e,t){if(t.setCoords(this.getCoord2D(e.vmin)),t.mergeNe(this.getCoord2D(e.vmax)),Zs(this))return;const i=this.getSemiAxes(),s=n.makePrimitiveArray(8,Number.NaN);{const e=Math.atan2(-i.y*this.m_sinr,i.x*this.m_cosr),t=e+Math.PI,n=Math.atan2(i.y*this.m_cosr,i.x*this.m_sinr),r=n+Math.PI;s[0]=Hs(this,e),s[1]=Hs(this,t),s[2]=Hs(this,n),s[3]=Hs(this,r)}{const e=this.m_cosr+this.m_sinr,t=this.m_cosr-this.m_sinr,n=Math.atan2(-i.y*e,i.x*t),r=n+Math.PI,o=Math.atan2(i.y*t,i.x*e),a=o+Math.PI;s[4]=Hs(this,n),s[5]=Hs(this,r),s[6]=Hs(this,o),s[7]=Hs(this,a)}const r=n.Point2D.getNAN();for(let i=0;i<8;i++){const n=s[i];e.containsExclusiveCoordinate(n)&&(this.queryCoord2D(n,r),t.mergeNe(r))}}setSegmentFromCoordsForStitcher(e,t){!function(e,t,i){const s=0===e.projectionBehavior();if(i<=2)return void Ws(e,t[0],t[i-1],s?0:1);if(s){e.constructCircularArcThreePoint(t[0],t[i-1],t[Math.trunc(i/2)]);const s=new n.Point2D;return e.queryCoord2D(.5,s),void e.m_interior.setCoordsPoint2D(s)}const r=e.getSemiMajorAxis(),o=e.getMinorMajorRatio(),a=e.getAxisXRotation(),l=e.getCenter(),c=new Array(4);c[0]=e.isMajor(),c[1]=!c[0],c[2]=c[0],c[3]=!c[0];const h=new Array(4);h[0]=e.isClockwise(),h[1]=h[0],h[2]=!h[0],h[3]=!h[0];const u=Math.trunc(i<5?1:(i+4)/5),m=n.makeObjectArray(xs,4),d=n.makePrimitiveArray(4,Number.NaN);let p=0;for(let e=0;e<4;e++){m[e].constructEllipticArcEndPointsCenter(t[0],t[i-1],r,o,a,c[e],h[e],l),d[e]=0;let s=0;for(let r=u;r<i-1;r+=u){const i=m[e].getClosestCoordinate(t[r],!1);d[e]+=n.Point2D.sqrDistance(m[e].getCoord2D(i),t[r]),s++}d[e]/=s,d[e]<d[p]&&(p=e)}e.assignCopy(m[p])}(this,e,t)}writeInBufferStream(e,t){const i=new Float64Array(10);return i[0]=this.m_bits,i[1]=this.m_semiMajorAxis,i[2]=this.m_minorMajorRatio,i[3]=this.m_rotation,i[4]=this.m_center.x,i[5]=this.m_center.y,i[6]=this.m_sweepAngle,i[7]=this.m_startAngle,i[8]=this.m_interior.x,i[9]=this.m_interior.y,e.writeRangeFromArray(t,i.length,i,!0,1),t+i.length}readFromBufferStream(e,t){const i=new Float64Array(10);e.queryRange(t,i.length,i,!0,1),this.m_bits=i[0],this.m_semiMajorAxis=i[1],this.m_minorMajorRatio=i[2],this.m_rotation=i[3],this.m_center.x=i[4],this.m_center.y=i[5],this.m_sweepAngle=i[6],this.m_startAngle=i[7],this.m_interior.x=i[8],this.m_interior.y=i[9],this.m_cosr=Math.cos(this.m_rotation),this.m_sinr=Math.sin(this.m_rotation),this.m_cachedValues=null}snapControlPoints(e){return!1}needsSnapControlPoints(e){return!1}calculateSpecialPointsForCracking(e,i){return t.throwInternalErrorException("should not1; be called"),0}ensureXYMonotone(){if(Zs(this))return!1;if(this.getStartXY().equals(this.getEndXY()))return Ws(this,this.getStartXY(),this.getEndXY(),this.projectionBehavior()),!0;const e=n.makeObjectArray(n.Point2D,3);let t=cr(this,e);if(Hn(e)){let i=!1;if(0===this.projectionBehavior()){const r=new s.Envelope2D;r.setCoords({pt:e[0]}),r.mergeNe(e[2]);const o=new n.Point2D;o.setSub(e[2],e[0]),o.leftPerpendicularThis(),o.normalize(),o.scale(n.Point2D.distance(e[2],e[0]));const a=n.Point2D.lerp(e[2],e[0],.5),l=a.sub(o),c=a.add(o);r.clipLine(l,c);const h=n.Point2D.getClosestCoordinate(l,c,e[1],!1);e[1]=n.Point2D.lerp(l,c,h);const u=e[2].sub(e[1]),m=e[0].sub(e[1]),d=u.crossProduct(m),p=u.dotProduct(m);t=n.halfPi()-Math.abs(.5*Math.atan2(d,p)),i=!0}return hr(e,t*t,null,i,this),!0}return!1}setCoordsForIntersector(e,t,i){Xs(this,e,t,i)}getInteriorPoint(){return this.m_interior.clone()}copyToImpl(e){const t=e;t.m_center.assign(this.m_center),t.m_semiMajorAxis=this.m_semiMajorAxis,t.m_minorMajorRatio=this.m_minorMajorRatio,t.m_interior.assign(this.m_interior),t.m_rotation=this.m_rotation,t.m_cosr=this.m_cosr,t.m_sinr=this.m_sinr,t.m_sweepAngle=this.m_sweepAngle,t.m_startAngle=this.m_startAngle,t.m_bits=this.m_bits,er(t,Ys(this))}reverseImpl(){ir(this,!nr(this)),qs(this),(0!==this.projectionBehavior()||this.getStartXY().equals(this.getEndXY()))&&dr(this)}equalsImpl(e){const t=e;if(this.m_bits!==t.m_bits)return!1;if(this.m_semiMajorAxis!==t.m_semiMajorAxis)return!1;if(this.m_minorMajorRatio!==t.m_minorMajorRatio)return!1;if(!(this.m_center.isEqualPoint2D(t.m_center)||this.m_center.isNAN()&&t.m_center.isNAN()))return!1;if(this.m_rotation!==t.m_rotation)return!1;if(!this.m_interior.equals(t.m_interior))return!1;const i=t.m_sweepAngle;if(this.m_sweepAngle!==i)return!1;const n=t.m_startAngle;return this.m_startAngle===n}equalsImplTol(e,t){const i=e;if(this.m_bits!==i.m_bits)return!1;if(this.m_center.isNAN()&&i.m_center.isNAN())return!0;if(this.m_center.isNAN()!==i.m_center.isNAN())return!1;if(!this.getSemiAxes().isEqualPoint2D(i.getSemiAxes(),t))return!1;if(!this.m_center.isEqualPoint2D(i.m_center,t))return!1;const s=Math.abs(ps(ds(gs(this.m_rotation-i.m_rotation)))),r=Math.abs(n.pi()-s),o=Math.min(s,r);if(this.m_semiMajorAxis*Math.abs(o)>t)return!1;const a=this.getCoord2D(.5),l=i.getCoord2D(.5);return!!a.isEqualPoint2D(l,t)}swapImpl(e){const t=e;var i;this.m_center=n.swap(t.m_center,t.m_center=this.m_center),this.m_semiMajorAxis=n.swap(t.m_semiMajorAxis,t.m_semiMajorAxis=this.m_semiMajorAxis),this.m_minorMajorRatio=n.swap(t.m_minorMajorRatio,t.m_minorMajorRatio=this.m_minorMajorRatio),this.m_interior=n.swap(t.m_interior,t.m_interior=this.m_interior),this.m_rotation=n.swap(t.m_rotation,t.m_rotation=this.m_rotation),this.m_cosr=n.swap(t.m_cosr,t.m_cosr=this.m_cosr),this.m_sinr=n.swap(t.m_sinr,t.m_sinr=this.m_sinr),this.m_sweepAngle=n.swap(t.m_sweepAngle,t.m_sweepAngle=this.m_sweepAngle),this.m_startAngle=n.swap(t.m_startAngle,t.m_startAngle=this.m_startAngle),this.m_bits=n.swap(t.m_bits,t.m_bits=this.m_bits),(i=t).m_cachedValues=n.swap(this.m_cachedValues,this.m_cachedValues=i.m_cachedValues)}afterCompletedModification(){ar(this),tr(this)}intersect(e,t,i,n,s){return Cr(!1,this,e,t,i,n,s)}intersectPoint(e,i,s){if(i.length<2&&t.throwOutOfRangeException(""),Zs(this))return new Ar({start:this.getStartXY(),end:this.getEndXY()}).intersectPoint(e,i,s);{const t=n.Point2D.distance(e,this.m_center);if(t>this.m_semiMajorAxis+s||t<this.getSemiMinorAxis()-s)return 0}const r=this.getClosestCoordinate(e,!1),o=n.Point2D.getNAN();return this.queryCoord2D(r,o),n.Point2D.distance(o,e)<=s?n.isOneOf(r,0,1)&&(this.queryCoord2D(0===r?1:0,o),n.Point2D.distance(o,e)<=s)?(i&&(i[0]=0,i[1]=1),2):(i&&(i[0]=r),1):0}isIntersecting(e,t,i){return 0!==Pr(!1,this,e,t,i)}endPointModified(){this.m_bits|=8,tr(this)}clearEndPointModified(){ar(this)}}function vs(e,t,i,n){const s=[];return Ps(t,s),bs(e,s,t,i)}function Ps(e,t){t.length=e;for(let e=0;e<t.length;++e)t[e]=e;e>3&&l(e,t)}function bs(e,t,i,s,r){let o=0;const a=[0,0,0];let l=0,c=0;for(let r=0;r<3;++r){let h=!1;for(;c<i;){const i=e.at(t[c]);let u=1;if(3===o?u=n.Point2D.inCircleRobust(e.at(s[0]),e.at(s[1]),e.at(s[2]),i):2===o?u=n.Point2D.inCircleRobust3Point(e.at(s[0]),e.at(s[1]),i):1===o&&i.equals(e.at(s[0]))&&(u=0),u<=0){if(u<0&&r+1<3){t[l]=n.swap(t[c],t[c]=t[l]);for(let e=0;e<o;e++)if(s[e]===t[c]){a[e]=c;break}l++}c++;continue}h=!0;let m=0;for(let e=0;e<o;e++)a[e]>c&&(s[m]=s[e],a[m]=a[e],m++);o=m,s[o]=t[c],a[o]=c,o++,o<3?c=l:(1===n.Point2D.orientationRobust(e.at(s[0]),e.at(s[1]),e.at(s[2]))&&(s[2]=n.swap(s[0],s[0]=s[2]),a[2]=n.swap(a[0],a[0]=a[2])),c++)}if(!h)break;if(r+1<3){l=0;let i=!1;for(let e=0;e<o;e++)for(let t=e+1;t<o;t++)a[e]>a[t]&&(a[t]=n.swap(a[e],a[e]=a[t]),s[t]=n.swap(s[e],s[e]=s[t]),i=!0);for(let e=0;e<o;e++)t[a[e]]=n.swap(t[e],t[e]=t[a[e]]),a[e]=e;i&&3===o&&1===n.Point2D.orientationRobust(e.at(s[0]),e.at(s[1]),e.at(s[2]))&&(s[2]=n.swap(s[0],s[0]=s[2]),a[2]=n.swap(a[0],a[0]=a[2]))}c=o}return o}function Es(e,i,s,r,o,a,l,c){a&&(a.length=0),l&&(l.length=0);const h=e.getGeometryType();if(h===t.GeometryType.enumLine)return a&&(a.push(e.getStartXY()),a.push(n.Point2D.getNAN()),a.push(n.Point2D.getNAN()),a.push(e.getEndXY())),l&&(l.push(0),l.push(1)),1;if(h===t.GeometryType.enumBezier){if(!r)return a&&(a.push(e.getStartXY()),a.push(e.getControlPoint1()),a.push(e.getControlPoint2()),a.push(e.getEndXY())),l&&(l.push(0),l.push(1)),1;const t=n.makePrimitiveArray(9,Number.NaN);let i=e.getMonotonicPartParams(t.length,t);if(t.length=i,i=ws(e,s,t),2===i&&o&&(t[1]=.5,t.push(1),i=3),l&&l.splice(0,0,...t.slice(0,i)),a){const n=new Mr;for(let s=1;s<i;s++){const i=t[s-1],r=t[s];e.queryCut(i,r,n,!0);const o=n.get();Oi(o),1===s&&a.push(o.getStartXY()),a.push(o.getControlPoint1()),a.push(o.getControlPoint2()),a.push(o.getEndXY())}}return i-1}if(h===t.GeometryType.enumEllipticArc){const c=e;if(c.isDegenerateToLine()||c.isDegenerate(0))return a&&(a.push(e.getStartXY()),a.push(n.Point2D.getNAN()),a.push(n.Point2D.getNAN()),a.push(e.getEndXY())),l&&(l.push(0),l.push(1)),1;if(r&&(o||!c.isMonotoneQuickAndDirty())){const h=n.makePrimitiveArray(6,Number.NaN);let u=c.getMonotonicPartParams(h.length,h);h.length=u,u=ws(e,s,h),2===u&&o&&(h[1]=.5,h.push(1),u=3);let m=0;if(u>2){const e=new Mr,n=l||[];let o=0;for(let d=1;d<u;d++){const p=h[o],g=h[d];if(c.queryCut(p,g,e,!0),e.get().isDegenerate(0))continue;const _=n.length,f=Is(1===d,e.get(),i,s,r,a,l);t.geometryReleaseAssert(f>0),m+=f;const y=d===u-1,x=h[o],v=e.get().getSweepAngle()/c.getSweepAngle();for(let e=_,t=n.length;e<t;e++)if(n[e]=!y||e+1<t?x+n[e]*v:1,a){const t=3*e,i=c.getCoord2D(n[e]);a[t].setCoordsPoint2D(i),t>0&&Gi(a.slice(t-3))}o=d}return m}}return Is(!0,c,i,s,r,a,l)}if(h===t.GeometryType.enumRationalBezier2){const t=e;if(r&&(o||!t.isMonotoneQuickAndDirty())){const r=n.makePrimitiveArray(6,Number.NaN);let c=t.getMonotonicPartParams(r.length,r);r.length=c,c=ws(e,s,r),2===c&&o&&(r[1]=.5,r.push(1),c=3);let h=0;if(c>2){const e=new Mr,n=l||[];for(let o=1;o<c;o++){const u=r[o-1],m=r[o];t.queryCut(u,m,e,!0);const d=n.length;h+=Ms(1===o,e.get(),i,s,!1,a,l);const p=o===c-1,g=r[o-1];for(let e=d,i=n.length;e<i;e++)if(n[e]=!p||e+1<i?g+n[e]:1,a){const i=3*e,s=t.getCoord2D(n[e]);a[i].setCoordsPoint2D(s),i>0&&Nt(a.slice(i-3))}}return h}}return Ms(!0,t,i,s,r,a,l)}if(h===t.GeometryType.enumBezier2){const t=e,c=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(c);const h=new dn;h.constructFromQuadratic(c);const u=Es(h,i,s,r,o,a,l);if(null!=a&&null!=l){const e=3;for(let i=1,s=0;i<u;++i,s+=e){const o=new n.Point2D;t.queryCoord2D(l[i],o);const c=a[s+e];!o.equals(c)&&(a[s+e].setCoordsPoint2D(o),r)&&Gi(a.slice(s,s+4))}}return u}t.throwNotImplementedException("")}function Ss(e,i,s,r,o,a,l,c,h){const u=e.getGeometryType();if(a&&(a.length=0,l.length=0),c&&(c.length=0),u===t.GeometryType.enumEllipticArc){const t=e;if(t.isDegenerateToLine()||t.isDegenerate(0))return a&&(a.push(e.getStartXY()),a.push(n.Point2D.getNAN()),a.push(e.getEndXY()),l.push(Number.NaN),l.push(Number.NaN),l.push(Number.NaN)),c&&(c.push(0),c.push(1)),1}const m=n.makePrimitiveArray(9,Number.NaN);let d;if(o)d=e.getMonotonicPartParams(m.length,m),m.length=d,d=ws(e,s,m);else{if(d=2,m[0]=0,m[1]=1,u===xs.type){const t=e.getSweepAngle();if(t>.9*Math.PI){const e=2*Math.PI/3;Math.min(3,Math.trunc(t/e+.5))>2?(m[0]=0,m[1]=1/3,m[2]=2/3,m[3]=1,d=4):(m[0]=0,m[1]=.5,m[2]=1,d=3)}}else t.geometryReleaseAssert(u===Le.type);m.length=d}if(2===d&&r&&(m[1]=.5,m.push(1),d=3),a){const i=new Mr;let s=1;for(;s<d;){const r=m[s-1],c=m[s];e.queryCut(r,c,i,!0);const h=n.makeObjectArray(n.Point2D,3),p=[1,1,1];if(u===t.GeometryType.enumEllipticArc){const e=i.get();if(Math.abs(e.getSweepAngle())>.9*Math.PI){const e=(c-r)/3;m.splice(s,0,r+e),m.splice(s+1,0,r+2*e),d+=2;continue}p[1]=cr(e,h)}else{const e=i.get();e.queryControlPoints(h),e.queryWeights(p)}o&&Hn(h),1===s&&(a.push(h[0].clone()),l.push(p[0])),a.push(h[1].clone()),a.push(h[2].clone()),l.push(p[1]),l.push(p[2]),s++}}return c&&(c.length=d,n.memcpy(c,m,0,0,d)),d-1}xs.type=t.GeometryType.enumEllipticArc;class Cs{static constructDefault(e){return new Cs(0,0,0,e,!1,n.intMax())}constructor(e,s,r,o,a,l){this.m_segmentBuffer=null,this.m_dummyPoint=new i.Point,this.m_progressCounter=0,this.m_progressTracker=o,this.m_bSetDensifyFlag=a,this.m_maxLength=e,this.m_maxDeviation=s,this.m_maxAngle=r>n.halfPi()?n.halfPi():r,this.m_cosMaxAngle=Math.cos(this.m_maxAngle),this.m_bOnlyCurveDensify=this.m_maxAngle>0||this.m_maxDeviation>0,this.m_maxSegmentsPerCurve=l,t.checkAndThrow(this.m_maxSegmentsPerCurve>0,"this.m_maxSegmentsPerCurve > 0"),this.m_minStep=1/this.m_maxSegmentsPerCurve}densify(e){return this.densifyGeom(e)}densifySegment(e,t){this.densifySegmentEx(e,null,!0,!1,t)}densifyEx(e,i,s,r,o,a){return this.m_maxLength=i,this.m_maxDeviation=s,this.m_maxAngle=r>n.halfPi()?n.halfPi():r,this.m_cosMaxAngle=Math.cos(this.m_maxAngle),this.m_bOnlyCurveDensify=this.m_maxAngle>0||this.m_maxDeviation>0,this.m_bSetDensifyFlag=o,this.m_maxSegmentsPerCurve=a,t.checkAndThrow(this.m_maxSegmentsPerCurve>0,"this.m_maxSegmentsPerCurve > 0"),this.m_minStep=1/this.m_maxSegmentsPerCurve,this.densifyGeom(e)}densifyGeom(e){if(e.isEmpty()||e.getDimension()<1)return e;const i=e.getGeometryType();return t.isMesh(i)?e:t.isMultiPath(i)?this.densifyMultiPath(e):t.isSegment(i)?this.densifySegmentImpl(e):i===t.GeometryType.enumEnvelope?this.densifyEnvelope(e):void t.throwInternalErrorException("")}densifySegmentEx(e,i,n,s,r){const o=e.getGeometryType();if(!(this.m_maxLength>0||this.m_bOnlyCurveDensify&&o!==t.GeometryType.enumLine)&&(!s||n))return void(i?o===t.GeometryType.enumLine?i.addSegment(e,n):(n&&(e.queryStart(this.m_dummyPoint),i.startPathPoint(this.m_dummyPoint)),e.queryEnd(this.m_dummyPoint),i.lineToPoint(this.m_dummyPoint)):(n&&r.push(0),r.push(1)));if(o===t.GeometryType.enumBezier)return void this.densifyCubicBezier(e,i,n,s,r);if(o===t.GeometryType.enumRationalBezier2)return void this.densifyRationalBezier2(e,i,n,s,r);if(o===t.GeometryType.enumBezier2)return void this.densifyBezier2(e,i,n,s,r);if(o===t.GeometryType.enumEllipticArc&&!e.isLine()&&e.getMinorMajorRatio()<.25)return void this.densifyEllipticArc(e,i,n,s,r);let a=1;this.m_maxLength>0&&(a=this.calculateLengthSubdivisionStep(e,this.m_maxLength)),this.m_maxDeviation>0&&(a=Math.min(a,this.calculateDeviationSubdivisionStep(e,this.m_maxDeviation))),this.m_maxAngle>0&&(a=Math.min(a,this.calculateAngularSubdivisionStep(e,this.m_maxAngle))),this.densifySegmentByLength(e,a,i,n,s,r)}densifyMultiPath(e){if(!e.hasNonLinearSegments()){if(1===e.getDescription().getAttributeCount())return this.densifyMultiPathLinear(e);if(!(this.m_maxLength>0))return e}const i=e.createInstance();i.getGeometryType()===t.GeometryType.enumPolygon&&i.setFillRule(e.getFillRule()),i.reserve(e.getPointCount());const n=e.getImpl().querySegmentIterator();for(;n.nextPath();){let e=!0;for(;n.hasNextSegment();){const t=n.nextSegment(),s=n.isClosingSegment();this.densifySegmentEx(t,i,e,s,null),s&&i.closePathWithLine(),e=!1}}return i}densifySegmentImpl(e){const t=new ye({vd:e.getDescription()});return this.densifySegmentEx(e,t,!0,!1,[0]),t}densifyEnvelope(e){const t=new Kt({vd:e.getDescription()});t.addEnvelope(e,!1);const i=s.Envelope2D.constructEmpty();e.queryEnvelope(i);const n=i.width(),r=i.height();return!(this.m_maxLength>0)||n<=this.m_maxLength&&r<=this.m_maxLength?t:this.densifyMultiPath(t)}densifyMultiPathLinear(e){if(!(this.m_maxLength>0))return e;const i=e.createInstance();i.getGeometryType()===t.GeometryType.enumPolygon&&i.setFillRule(e.getFillRule()),i.reserve(e.getPointCount());const s=i.getImpl(),r=e.getImpl(),o=r.getAttributeStreamRef(0),a=new Ar;for(let e=0,t=r.getPathCount();e<t;e++){const t=r.isClosedPath(e);if(0===r.getPathSize(e))continue;const l=r.getPathStart(e),c=o.readPoint2D(2*l),h=c.clone();s.startPath(c);for(let t=l+1,c=r.getPathEnd(e);t<c;t++){const e=o.readPoint2D(2*t),r=n.Point2D.distance(h,e);if(r>this.m_maxLength){let t=Math.ceil(r/this.m_maxLength);t>n.intMax()&&(t=n.intMax());const i=1/t;let o,l,c;h.compare(e)<0?(a.setStartXY(h),a.setEndXY(e),o=0,l=1):(a.setStartXY(e),a.setEndXY(h),o=t-2,l=-1);for(let e=0,r=t-1;e<r;e++,o+=l){this.progress_(),c=i*(o+1);const e=new n.Point2D;a.queryCoord2D(c,e),s.lineTo(e),this.m_bSetDensifyFlag&&s.setAttributeNoCurves(10,s.getPointCount()-1,0,1)}}else this.progress_();i.lineTo(e),h.assign(e)}if(t){const e=n.Point2D.distance(h,c);if(e>this.m_maxLength){const t=c;let i=Math.ceil(e/this.m_maxLength);i>n.intMax()&&(i=n.intMax());const r=1/i;let o,l;h.compare(t)<0?(a.setStartXY(h),a.setEndXY(t),o=0,l=1):(a.setStartXY(t),a.setEndXY(h),o=i-2,l=-1);const u=new n.Point2D(0,0);let m;for(let e=0,t=i-1;e<t;e++,o+=l)this.progress_(),m=r*(o+1),a.queryCoord2D(m,u),s.lineTo(u),this.m_bSetDensifyFlag&&s.setAttributeNoCurves(10,s.getPointCount()-1,0,1)}s.closePathWithLine()}}return i}densifySegmentByLength(e,i,s,r,o,a){t.geometryReleaseAssert(e.getGeometryType()!==t.GeometryType.enumBezier);let l=e.getStartXY().compare(e.getEndXY());0===l&&i<1&&(e.getGeometryType()===t.GeometryType.enumEllipticArc?l=e.getSweepAngle()<0?1:-1:t.throwNotImplementedException("densify segment by length"));let c=0;if(r&&(s?(e.queryStart(this.m_dummyPoint),s.startPathPoint(this.m_dummyPoint)):a.push(0),++c),i*this.m_maxSegmentsPerCurve<1&&(i=1/this.m_maxSegmentsPerCurve),i<1){this.m_segmentBuffer||(this.m_segmentBuffer=new Mr);let t=Math.ceil(1/i);t>n.intMax()&&(t=n.intMax()),i=1/t,this.m_segmentBuffer.create(e.getGeometryType());let r,o,h,u=e;l<0?(r=0,o=1):(e.copyTo(this.m_segmentBuffer.get()),this.m_segmentBuffer.get().reverse(),r=t-2,o=-1,u=this.m_segmentBuffer.get());const m=t-1;for(let e=0;e<m;e++,r+=o)h=i*(r+1),s?(u.queryCoord(h,this.m_dummyPoint),s.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==h&&0!==h&&s.setAttribute(10,s.getPointCount()-1,0,1)):a.push(l>0?1-h:h),this.progress_();h=1,c+=m}(!o||o&&r&&c<2)&&(s?(e.queryEnd(this.m_dummyPoint),s.lineToPoint(this.m_dummyPoint)):a.push(1))}densifyCubicBezier(e,t,i,s,r){const o=new dn;let a=e;const l=e.calculateUpperLength2D();let c=e.getStartXY().compare(e.getEndXY());if(0===c&&l>0){const t=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(t),c=t[1].compare(t[2]),0===c&&(c=t[1].compare(t[0]))}c>0&&(e.copyTo(o),o.reverse(),a=o);let h=0;i&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):r.push(0),++h);const u=[],m=[],d=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve));let p=!0,g=0;if(c>0)for(u.push([a.getStartXY(),a.getControlPoint1(),a.getControlPoint2(),a.getEndXY(),new n.Point2D(0,1)]),m.push(0);u.length;){this.progress_();const e=u.at(-1),o=m.at(-1),l=e[4].x,c=e[4].y;if(o<d&&this.bezierNeedsSplit(e)){p&&(g=a.findMinDeriv(),p=!1);let t=.5*(l+c);Math.abs(g-t)<.4*(c-l)&&(t=g);const i=(t-l)/(c-l),s=e[0].mul(1-i).add(e[1].mul(i)),r=e[1].mul(1-i).add(e[2].mul(i)),h=e[2].mul(1-i).add(e[3].mul(i)),d=s.mul(1-i).add(r.mul(i)),_=r.mul(1-i).add(h.mul(i)),f=d.mul(1-i).add(_.mul(i)),y=e[3];e[1]=s,e[2]=d,e[3]=f,e[4].setCoords(l,t);const x=[f,_,h,y,new n.Point2D(t,c)];u.push(x),m[m.length-1]=o+1,m.push(o+1)}else u.pop(),m.pop(),(u.length>0||!s||s&&i&&h<2)&&(t?(a.queryCoord(l,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==l&&0!==l&&t.setAttribute(10,t.getPointCount()-1,0,1)):r.push(1-l),++h)}else for(u.push([a.getStartXY(),a.getControlPoint1(),a.getControlPoint2(),a.getEndXY(),new n.Point2D(0,1)]),m.push(0);u.length;){this.progress_();const e=u.at(-1),o=m.at(-1),l=e[4].x,c=e[4].y;if(o<d&&this.bezierNeedsSplit(e)){p&&(g=a.findMinDeriv(),p=!1);let t=.5*(l+c);Math.abs(g-t)<.4*(c-l)&&(t=g);const i=(t-l)/(c-l),s=e[0].mul(1-i).add(e[1].mul(i)),r=e[1].mul(1-i).add(e[2].mul(i)),h=e[2].mul(1-i).add(e[3].mul(i)),d=s.mul(1-i).add(r.mul(i)),_=r.mul(1-i).add(h.mul(i)),f=d.mul(1-i).add(_.mul(i)),y=e[0];e[0]=f,e[1]=_,e[2]=h,e[4].setCoords(t,c);const x=[y,s,d,f,new n.Point2D(l,t)];u.push(x),m[m.length-1]=o+1,m.push(o+1)}else u.pop(),m.pop(),(u.length>0||!s||s&&i&&h<2)&&(t?(a.queryCoord(c,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==c&&0!==c&&t.setAttribute(10,t.getPointCount()-1,0,1)):r.push(c),++h)}}densifyRationalBezier2(e,t,i,s,r){const o=new Le;let a=e;const l=e.calculateUpperLength2D();let c=e.getStartXY().compare(e.getEndXY());0===c&&l>0&&(c=0),c>0&&(e.copyTo(o),o.reverse(),a=o);let h=0;i&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):r.push(0),++h);const u=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),m=new Le,d=[],p=[];for(d.push(new n.Envelope1D(0,1)),p.push(0);d.length;){this.progress_();const e=d.at(-1).clone(),o=p.at(-1);if(o<u&&this.rationalBezier2NeedsSplit(a,m,e.vmin,e.vmax)){const t=e.getCenter();c>0?(d.at(-1).vmax=t,d.push(new n.Envelope1D(t,e.vmax))):(d.at(-1).vmin=t,d.push(new n.Envelope1D(e.vmin,t))),p[p.length-1]=o+1,p.push(o+1)}else if(d.pop(),p.pop(),d.length>0||!s||s&&i&&h<2){const i=c>0?e.vmin:e.vmax;t?(a.queryCoord(i,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==i&&0!==i&&t.setAttribute(10,t.getPointCount()-1,0,1)):r.push(c>0?1-i:i),++h}}}densifyBezier2(e,t,i,s,r){const o=new He;let a=e;const l=e.calculateUpperLength2D();let c=e.getStartXY().compare(e.getEndXY());0===c&&l>0&&(c=0),c>0&&(e.copyTo(o),o.reverse(),a=o);let h=0;i&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):r.push(0),++h);const u=Math.ceil(Math.log2(this.m_maxSegmentsPerCurve)),m=new He,d=[],p=[];for(d.push(new n.Envelope1D(0,1)),p.push(0);d.length;){this.progress_();const e=d.at(-1).clone(),o=p.at(-1);if(o<u&&this.bezier2NeedsSplit(a,m,e.vmin,e.vmax)){const t=e.getCenter();c>0?(d.at(-1).vmax=t,d.push(new n.Envelope1D(t,e.vmax))):(d.at(-1).vmin=t,d.push(new n.Envelope1D(e.vmin,t))),p[p.length-1]=o+1,p.push(o+1)}else if(d.pop(),p.pop(),d.length>0||!s||s&&i&&h<2){const i=c>0?e.vmin:e.vmax;t?(a.queryCoord(i,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==i&&0!==i&&t.setAttribute(10,t.getPointCount()-1,0,1)):r.push(c>0?1-i:i),++h}}}densifyEllipticArc(e,t,i,s,r){const o=new xs;let a=e;const l=e.calculateUpperLength2D();let c=e.getStartXY().compare(e.getEndXY());0===c&&l>0&&(c=e.isClockwise()?0:1),c>0&&(e.copyTo(o),o.reverse(),a=o);let h=0;i&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):r.push(0),++h);const u=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),m=new xs,d=[],p=[];for(d.push(new n.Envelope1D(0,1)),p.push(0);d.length;){this.progress_();const e=d.at(-1).clone(),o=p.at(-1);if(o<u&&this.ellipticArcNeedsSplit(a,m,e.vmin,e.vmax)){const t=e.getCenter();c>0?(d.at(-1).vmax=t,d.push(new n.Envelope1D(t,e.vmax))):(d.at(-1).vmin=t,d.push(new n.Envelope1D(e.vmin,t))),p[p.length-1]=o+1,p.push(o+1)}else if(d.pop(),p.pop(),d.length>0||!s||s&&i&&h<2){const i=c>0?e.vmin:e.vmax;t?(a.queryCoord(i,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==i&&0!==i&&t.setAttribute(10,t.getPointCount()-1,0,1)):r.push(c>0?1-i:i),++h}}}calculateLengthSubdivisionStep(e,i){const n=e.calculateUpperLength2D();if(!e.isCurve())return n?i/n:1;if(e.getGeometryType()===t.GeometryType.enumEllipticArc){const t=e;if(t.isCircular()||t.isDegenerate(0)||t.isDegenerateToLine()){let e=i/n;return e<this.m_minStep&&(e=this.m_minStep),e}return i/n*t.getSemiAxes().y/t.getSemiAxes().x}e.getGeometryType()===t.GeometryType.enumBezier&&t.throwNotImplementedException(""),t.throwNotImplementedException("")}calculateDeviationSubdivisionStep(e,i){if(!e.isCurve())return 1;if(e.getGeometryType()===t.GeometryType.enumEllipticArc){const t=e;if(t.isDegenerate(0)||t.isDegenerateToLine())return 1;{const n=t.getSemiMajorAxis(),s=1-i/n;let r=Math.PI/2;if(s>0){const e=4*Math.sqrt(i/n*.5);r=Math.min(Math.PI/2,Math.abs(e))}r=Math.max(r,2*Math.PI/this.m_maxSegmentsPerCurve);const o=r*n;return this.calculateLengthSubdivisionStep(e,o)}}t.throwNotImplementedException("")}calculateAngularSubdivisionStep(e,i){if(!e.isCurve())return 1;if(e.getGeometryType()===t.GeometryType.enumEllipticArc){const t=e;return t.isDegenerate(0)||t.isDegenerateToLine()?1:this.calculateLengthSubdivisionStep(e,i*t.getSemiMinorAxis())}t.throwNotImplementedException("")}rationalBezier2NeedsSplit(e,t,i,s){e.cutBezierIgnoreAttributes(i,s,t);let r=!1;if(this.m_maxLength>0&&t.calculateUpperLength2D()>this.m_maxLength)return r=!0,!0;const o=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(o);const a=[0,0,0];return t.queryWeights(a),!r&&this.m_maxDeviation>0&&(r=!Cs.checkRationalBezier2MaxDeviation(o,a,this.m_maxDeviation)),!r&&this.m_maxAngle>0&&(r=!Cs.checkRationalBezier2MaxAngle(o,a,this.m_cosMaxAngle)),r}bezier2NeedsSplit(e,t,i,s){e.cutBezierIgnoreAttributes(i,s,t);let r=!1;if(this.m_maxLength>0&&t.calculateUpperLength2D()>this.m_maxLength)return r=!0,!0;const o=n.makeObjectArray(n.Point2D,3);return t.queryControlPoints(o),!r&&this.m_maxDeviation>0&&(r=!Cs.checkBezier2MaxDeviation(o,this.m_maxDeviation)),!r&&this.m_maxAngle>0&&(r=!Cs.checkBezier2MaxAngle(o,this.m_cosMaxAngle)),r}ellipticArcNeedsSplit(e,t,i,n){e.cutArcIgnoreAttributes(i,n,t);let s=!1;return this.m_maxLength>0&&t.calculateUpperLength2D()>this.m_maxLength?(s=!0,!0):(!s&&this.m_maxDeviation>0&&(s=!Cs.checkEllipticArcMaxDeviation(t,this.m_maxDeviation)),!s&&this.m_maxAngle>0&&(s=!Cs.checkEllipticArcMaxAngle(t,this.m_cosMaxAngle)),s)}bezierNeedsSplit(e){let t=!1;return this.m_maxLength>0&&n.Point2D.distance(e[0],e[1])+n.Point2D.distance(e[1],e[2])+n.Point2D.distance(e[2],e[3])>this.m_maxLength?(t=!0,!0):(!t&&this.m_maxDeviation>0&&(t=!Cs.checkBezierMaxDeviation(e,this.m_maxDeviation)),!t&&this.m_maxAngle>0&&(t=!Cs.checkBezierMaxAngle(e,this.m_cosMaxAngle)),t)}progress_(){}static checkBezierMaxDeviation(e,t){const i=e[3].sub(e[0]);if(i.sqrLength()>0){const s=i.clone();s.leftPerpendicularThis(),s.normalize();const r=s.dotProduct(e[0].sub(e[1])),o=s.dotProduct(e[0].sub(e[2]));if(Math.max(Math.abs(r),Math.abs(o))<=t){const t=new n.Point2D;Li(e,.5,t,!1);const s=t.sub(e[0]).dotProduct(i);return s>=0&&s<=i.sqrLength()}return!1}return Math.max(e[0].sub(e[1]).sqrLength(),e[0].sub(e[2]).sqrLength())<=t*t}static checkBezierMaxAngle(e,t){if(e[0].equals(e[3]))return!(!e[0].equals(e[1])||!e[1].equals(e[2]));const i=e[3].sub(e[0]);i.normalize();{const n=e[1].sub(e[0]),s=n.dotProduct(i);if(s<0)return!1;if(n.length()*t>s)return!1}{const n=e[2].sub(e[0]),s=n.dotProduct(i);if(s<0)return!1;if(n.length()*t>s)return!1}{const n=e[2].sub(e[1]),s=n.dotProduct(i);if(s<0)return!1;if(n.length()*t>s)return!1}return!0}static checkRationalBezier2MaxDeviation(e,t,i){if(0===t[1])return!1;const n=e[2].sub(e[0]);if(n.sqrLength()>0){const t=n.clone();t.leftPerpendicularThis(),t.normalize();const s=t.dotProduct(e[0].sub(e[1]));if(Math.abs(s)<=i){const t=e[1].sub(e[0]).dotProduct(n);return t>=0&&t<=n.sqrLength()}return!1}return e[0].sub(e[1]).sqrLength()<=i*i}static checkRationalBezier2MaxAngle(e,t,i){if(0===t[1])return!1;if(e[0].equals(e[2]))return!!e[0].equals(e[1]);const n=e[2].sub(e[0]);n.normalize();{const t=e[1].sub(e[0]),s=t.dotProduct(n);if(s<0)return!1;if(t.length()*i>s)return!1}return!0}static checkBezier2MaxDeviation(e,t){const i=e[2].sub(e[0]);if(i.sqrLength()>0){const n=i.clone();n.leftPerpendicularThis(),n.normalize();const s=n.dotProduct(e[0].sub(e[1]));if(Math.abs(s)<=t){const t=e[1].sub(e[0]).dotProduct(i);return t>=0&&t<=i.sqrLength()}return!1}return e[0].sub(e[1]).sqrLength()<=t*t}static checkBezier2MaxAngle(e,t){if(e[0].equals(e[2]))return!!e[0].equals(e[1]);const i=e[2].sub(e[0]);i.normalize();{const n=e[1].sub(e[0]),s=n.dotProduct(i);if(s<0)return!1;if(n.length()*t>s)return!1}return!0}static checkEllipticArcMaxDeviation(e,i){if(Math.abs(e.getSweepAngle())<Math.PI){const s=e.getEndXY().sub(e.getStartXY()),o=[0,0],a=function(e,i,s){t.geometryReleaseAssert(!Zs(e));const o=new r.Transformation2D;o.setRotateAngle(-e.getAxisXRotation());const a=new n.Point2D;o.queryTransform(i,a);const l=Math.atan2(-a.x*e.getMinorMajorRatio(),a.y),c=l+n.pi();let h=Hs(e,l),u=Hs(e,c);u<h&&(u=n.swap(h,h=u));let m=0;return h>=0&&h<=1&&(s[m++]=h),u>=0&&u<=1&&(s[m++]=u),m}(e,s,o);if(1===a){const t=e.getCoord2D(o[0]),s=n.Point2D.getClosestCoordinate(e.getStartXY(),e.getEndXY(),t),r=new n.Point2D;return n.lerpPoint2D(e.getStartXY(),e.getEndXY(),s,r),n.Point2D.distance(t,r)<=i}}const s=e.getCoord2D(.5),o=new n.Point2D;return n.lerpPoint2D(e.getEndXY(),e.getStartXY(),.5,o),n.Point2D.distance(s,o)<=i}static checkEllipticArcMaxAngle(e,t){const i=e.getTangent(0),n=e.getTangent(1),s=i.dotProduct(n);return!(s<0||i.length()*n.length()*t>s)}static checkTypeForReplace(e,i){return e.getGeometryType()===i&&(i!==t.GeometryType.enumEllipticArc||e.isCircular())}}function ws(e,t,i){const s=i.length;if(t<=0||s<=2)return s;let r=0;const o=n.makePrimitiveArray(s-1,Number.NaN);for(let t=1,n=s;t<n;t++){const n=e.tToLength(i[t]);o[t-1]=n-r,r=n}for(;o.length>1;){const e=o.findIndex((e=>e<=2*t));if(-1===e)break;let n=e+1,s=e+1;if(e>0){const t=e-1;(s===o.length||o[t]>o[s])&&(s=t,n--)}o[s]+=o[e],o.splice(e,1),i.splice(n,1)}return i.length}function Ts(e,t,n,s,r){const o=[],a=[],l=Es(t,n,0,s,!1,o,a),c=new dn;let h=r;const u=t.getDescription();c.assignVertexDescription(u);const m=u.getAttributeCount()>1,d=new i.Point,p=new Ar;for(let i=0,n=0;i<l;i++){if(o[n+1].isNAN()){if(m){let e=a[i];t.queryCoord(e,d),p.setStart(d),e=a[i+1],t.queryCoord(e,d),p.setEnd(d)}p.setStartXY(o[n]),p.setEndXY(o[n+3]),e.addSegment(p,h)}else{if(m){let e=a[i];t.queryCoord(e,d),c.setStart(d),e=a[i+1],t.queryCoord(e,d),c.setEnd(d)}c.setStartXY(o[n]),c.setControlPoint1(o[n+1]),c.setControlPoint2(o[n+2]),c.setEndXY(o[n+3]),e.addSegment(c,h)}n+=3,h=!1}}function Ds(e,s,r,o,a){const l=[],c=[],h=function(e,i,s,r,o,a,l){a&&(a.length=0),l&&(l.length=0);const c=e.getGeometryType();if(c===t.GeometryType.enumLine)return a&&(a.push(e.getStartXY()),a.push(n.Point2D.getNAN()),a.push(e.getEndXY())),l&&(l.push(0),l.push(1)),1;if(c===t.GeometryType.enumBezier2){const t=n.makePrimitiveArray(9,Number.NaN);let i=e.getMonotonicPartParams(t.length,t);if(t.length=i,i=ws(e,0,t),l&&l.splice(0,0,...t.slice(0,i)),a){const n=new Mr;for(let s=1;s<i;s++){const i=t[s-1],r=t[s];e.queryCut(i,r,n,!0);const o=n.get();Mt(o),1===s&&a.push(o.getStartXY()),a.push(o.getControlPoint1()),a.push(o.getEndXY())}}return i-1}if(c===t.GeometryType.enumEllipticArc){const t=e;if(t.isDegenerateToLine()||t.isDegenerate(0))return a&&(a.push(e.getStartXY()),a.push(n.Point2D.getNAN()),a.push(e.getEndXY())),l&&(l.push(0),l.push(1)),1;if(!t.isMonotoneQuickAndDirty()){const s=n.makePrimitiveArray(6,Number.NaN);let r=t.getMonotonicPartParams(s.length,s);s.length=r,r=ws(e,0,s);let o=0;if(r>2){const e=new Mr,n=l||[];for(let c=1;c<r;c++){const h=s[c-1],u=s[c];t.queryCut(h,u,e,!0);const m=n.length;o+=Ns(1===c,e.get(),i,0,0,a,l);const d=c===r-1,p=s[c-1],g=e.get().getSweepAngle()/t.getSweepAngle();for(let e=m,i=n.length;e<i;e++)if(n[e]=!d||e+1<i?p+n[e]*g:1,a){const i=2*e,s=t.getCoord2D(n[e]);a[i].setCoordsPoint2D(s),i>0&&Nt(a.slice(i-2))}}return o}}return Is(!0,t,i,0,r,a,l)}if(c===t.GeometryType.enumBezier){const t=e;if(!t.isMonotoneQuickAndDirty()){const s=n.makePrimitiveArray(6,Number.NaN);let r=t.getMonotonicPartParams(s.length,s);s.length=r,r=ws(e,0,s);let o=0;if(r>2){const e=new Mr,n=l||[];for(let c=1;c<r;c++){const h=s[c-1],u=s[c];t.queryCut(h,u,e,!0);const m=n.length;o+=Rs(1===c,e.get(),i,0,0,a,l);const d=c===r-1,p=s[c-1];for(let e=m,i=n.length;e<i;e++)if(n[e]=!d||e+1<i?p+n[e]:1,a){const i=2*e,s=t.getCoord2D(n[e]);a[i].setCoordsPoint2D(s),i>0&&Nt(a.slice(i-2))}}return o}}return Rs(!0,t,i,0,0,a,l)}if(c===t.GeometryType.enumRationalBezier2){const t=e;if(!t.isMonotoneQuickAndDirty()){const s=n.makePrimitiveArray(6,Number.NaN);let r=t.getMonotonicPartParams(s.length,s);s.length=r,r=ws(e,0,s);let o=0;if(r>2){const e=new Mr,n=l||[];for(let c=1;c<r;c++){const h=s[c-1],u=s[c];t.queryCut(h,u,e,!0);const m=n.length;o+=As(1===c,e.get(),i,0,0,a,l);const d=c===r-1,p=s[c-1];for(let e=m,i=n.length;e<i;e++)if(n[e]=!d||e+1<i?p+n[e]:1,a){const i=2*e,s=t.getCoord2D(n[e]);a[i].setCoordsPoint2D(s),i>0&&Nt(a.slice(i-2))}}return o}}return As(!0,t,i,0,0,a,l)}t.throwNotImplementedException("")}(s,r,0,o,0,l,c),u=new He;let m=a;const d=s.getDescription();u.assignVertexDescription(d);const p=d.getAttributeCount()>1,g=new i.Point,_=new Ar;for(let t=0,i=0;t<h;t++){if(l[i+1].isNAN()){if(p){let e=c[t];s.queryCoord(e,g),_.setStart(g),e=c[t+1],s.queryCoord(e,g),_.setEnd(g)}_.setStartXY(l[i]),_.setEndXY(l[i+2]),e.addSegment(_,m)}else{if(p){let e=c[t];s.queryCoord(e,g),u.setStart(g),e=c[t+1],s.queryCoord(e,g),u.setEnd(g)}u.setStartXY(l[i]),u.setControlPoint1(l[i+1]),u.setEndXY(l[i+2]),e.addSegment(u,m)}i+=2,m=!1}}function Is(e,t,i,o,a,l,c,h){const u=t.clone();u.dropAllAttributes();const m=(e,t,i,s)=>(t&&(e&&t.push(s.getStartXY()),t.push(n.Point2D.getNAN()),t.push(n.Point2D.getNAN()),t.push(s.getEndXY())),i&&(e&&i.push(0),i.push(1)),1);if(u.isDegenerateToLine()||u.isDegenerate(0))return m(e,l,c,t);const d=u.getStartXY(),p=u.getEndXY(),g=u.getSemiAxes(),_=new r.Transformation2D;if(u.isCircular())_.setIdentity();else{const e=u.getAxisXRotation();_.setScaleCoords(1,u.getMinorMajorRatio()),_.rotateAngle(e)}const f=u.getCenter();_.shift(f);const y=_.clone();y.invertThis(),u.applyTransformation(y);const x=u.getSweepAngle();if(0===x)return m(e,l,c,t);const v=s.Envelope2D.constructEmpty();v.setCoords({center:f,width:2*g.x,height:2*g.x});const P=.05*v.calculateToleranceFromEnvelope(),b=Math.max(i/g.x,P/g.x);let E=4*Math.pow(b/.0741,1/6);E=Math.min(E,Math.PI/2);const S=_s(u.getStartAngle());let C=x>0?Math.floor(S/E):Math.ceil(S/E);C*=E;const w=x>0?E:-E;C+w===S&&(C+=w);let T=4/3*Math.tan(Math.abs(E)/4);x>0&&(T=-T),c&&e&&c.push(0);const D=E/Math.abs(x);let I=(C-S)/x;const A=d.clone(),M=new n.Point2D;u.queryCoord2D(0,M);const N=M.clone(),R=1-.01*D;let O=0,G=0;for(;I<1;){let i;if(I+=D,G>0&&I<R)i=T;else{I>=R&&(I=1);const e=(I-G)*x;i=4/3*Math.tan(Math.abs(e)/4),x>0&&(i=-i)}u.queryCoord2D(I,M);const s=new n.Point2D;_.queryTransform(M,s);const r=t.getClosestCoordinate(s,!1);if(t.queryCoord2D(r,s),1!==I&&(n.Point2D.distance(A,s)<=2*o||n.Point2D.distance(s,p)<=2*o))continue;A.setCoordsPoint2D(s);const h=n.makeObjectArray(n.Point2D,4);h[0].assign(N),h[3].assign(M),h[1].rightPerpendicularOther(N),h[1].scaleAddThis(i,N),h[2].leftPerpendicularOther(M),h[2].scaleAddThis(i,M),_.transformPoints2D(h,3,h),h[3].assign(s),0===G&&h[0].setCoordsPoint2D(d),1===I&&h[3].setCoordsPoint2D(p),a&&Gi(h);let m=!0;for(let e=1;e<4;e++)if(!h[e].isEqualPoint2D(h[0])){m=!1;break}m||(c&&c.push(r),l&&(0===G&&e&&l.push(h[0].clone()),l.push(h[1].clone()),l.push(h[2].clone()),l.push(h[3].clone())),O++),G=I,N.setCoordsPoint2D(M)}return O}function As(e,t,i,r,o,a,l,c){t.clone().dropAllAttributes();const h=new s.Envelope2D;t.queryLooseEnvelope(h);const u=.05*h.calculateToleranceFromEnvelope(),m=Math.max(i,u);l&&e&&l.push(0);let d=0;const p=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(p);const g=[0,0,0];t.queryWeights(g);const _=[],f=n.makePrimitiveArray(9,Number.NaN);let y=t.getMonotonicPartParams(f.length,f);f.length=y,y=ws(t,r,f);let x=0,v=e;for(let e=1;e<y;e++){const t=f[e];for(_.push(x),_.push(t);_.length>1;){const e=_.at(-1);_.pop();const t=_.at(-1),i=n.makeObjectArray(n.Point2D,3);zn(p,g,e,t,i,[0,0,0]);const s=n.makeObjectArray(n.Point2D,3),r=Yt(i,g,s),o=16,c=_.length>o;m>=r||c?(l.push(t),a&&(v&&(a.push(s[0]),v=!1),a.push(s[1]),a.push(s[2])),d++):(_.push(.5*(e+t)),_.push(e))}x=t}return d}function Ms(e,t,i,r,o,a,l,c){t.clone().dropAllAttributes();const h=new s.Envelope2D;t.queryLooseEnvelope(h);const u=.05*h.calculateToleranceFromEnvelope(),m=Math.max(i,u);l&&e&&l.push(0);let d=0;const p=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(p);const g=[0,0,0];t.queryWeights(g);const _=[],f=n.makePrimitiveArray(9,Number.NaN);let y=0;o?(y=t.getMonotonicPartParams(f.length,f),f.length=y,y=ws(t,r,f)):(f.length=2,y=2,f[0]=0,f[1]=1);let x=0,v=e;for(let e=1;e<y;e++){const t=f[e];for(_.length=0,_.push(t),_.push(x);_.length>1;){const e=_.at(-1);_.pop();const t=_.at(-1),i=n.makeObjectArray(n.Point2D,3),s=[0,0,0];zn(p,g,e,t,i,s);const r=n.makeObjectArray(n.Point2D,4),o=Yn(i,s,r),c=16,h=_.length>c;m>=o||h?(l.push(t),a&&(v&&(a.push(r[0]),v=!1),a.push(r[1]),a.push(r[2]),a.push(r[3])),d++):(_.push(.5*(e+t)),_.push(e))}x=t}return d}function Ns(e,t,i,o,a,l,c,h){const u=t.clone();if(u.dropAllAttributes(),u.isDegenerateToLine()||0===u.getSweepAngle())return l&&(e&&l.push(t.getStartXY()),l.push(n.Point2D.getNAN()),l.push(t.getEndXY())),c&&(e&&c.push(0),c.push(1)),1;const m=u.getStartXY(),d=u.getEndXY(),p=u.getSemiAxes(),g=new r.Transformation2D;if(u.isCircular())g.setIdentity();else{const e=u.getAxisXRotation();g.setScaleCoords(1,u.getMinorMajorRatio()),g.rotateAngle(e)}const _=u.getCenter();g.shift(_);const f=g.clone();f.invertThis(),u.applyTransformation(f);const y=s.Envelope2D.constructEmpty();y.setCoords({center:_,width:2*p.x,height:2*p.x});const x=.05*y.calculateToleranceFromEnvelope(),v=Math.max(i/p.x,x/p.x),P=Math.sqrt(2*v+v*v);let b=2*Math.sqrt(2*P*(1+v-P));b=Math.min(b,Math.PI/2);const E=u.getSweepAngle(),S=Math.ceil(Math.abs(E)/b),C=Math.max(S,1);b=E/C;const w=1/C;let T=Math.tan(Math.abs(b)/2);E>0&&(T=-T),c&&e&&c.push(0);const D=new n.Point2D;u.queryCoord2D(0,D);for(let t=0;t<C;t++){const i=D.clone(),s=(t+1)*w;if(c&&c.push(s),!l)continue;u.queryCoord2D(s,D);const r=n.makeObjectArray(n.Point2D,3);r[0].assign(i),r[2].assign(D),r[1].rightPerpendicularOther(r[0]),r[1].mulThis(T),r[1].addThis(r[0]),g.transformPoints2D(r,3,r),0===t&&r[0].setCoordsPoint2D(m),t===C-1&&r[2].setCoordsPoint2D(d),0===t&&e&&l.push(r[0]),l.push(r[1]),l.push(r[2])}return C}function Rs(e,t,i,r,o,a,l,c){t.clone().dropAllAttributes();const h=new s.Envelope2D;t.queryLooseEnvelope(h);const u=.05*h.calculateToleranceFromEnvelope(),m=Math.max(i,u);l&&e&&l.push(0);let d=0;const p=n.makeObjectArray(n.Point2D,4);t.queryControlPoints(p);const g=[],_=n.makePrimitiveArray(9,Number.NaN);let f=t.getMonotonicPartParams(_.length,_);_.length=f,f=ws(t,r,_);let y=0,x=e;for(let e=1;e<f;e++){const t=_[e];for(g.push(y),g.push(t);g.length>1;){const e=g.at(-1);g.pop();const t=g.at(-1),i=n.makeObjectArray(n.Point2D,4);Fi(p,e,t,i);const s=n.makeObjectArray(n.Point2D,3),r=zt(i,s),o=16,c=g.length>o;m>=r||c?(l.push(t),a&&(x&&(a.push(s[0]),x=!1),a.push(s[1]),a.push(s[2])),d++):(g.push(.5*(e+t)),g.push(e))}y=t}return d}class Os{constructor(e,t){this.m_arc=e,this.m_sqrChordLength=t}getMaxDerivative(){return 1}getValue(e,t){return 0===e?n.Point2D.sqrDistance(this.m_arc.getCoord2D(t),this.m_arc.getCoord2D(1-t))-this.m_sqrChordLength:0}getError(e){return 0}}function Gs(e,t){return e.convertToCanonic(t)}function ks(e,t,i,s){let r=e.m_startAngle,o=e.m_sweepAngle;const a=1e-12;for(;r>n.pi();)r-=2*n.pi();for(;r<=-n.pi();)r+=2*n.pi();if(!Number.isNaN(t)){for(;t>n.pi();)t-=2*n.pi();for(;t<=-n.pi();)t+=2*n.pi();!i&&t>r&&(t-=2*n.pi()),i&&t<r&&(t+=2*n.pi()),o=t-r,Math.abs(o)<a&&!s&&(o=i?2*n.pi():-2*n.pi()),Math.abs(o)>2*n.pi()-a&&s&&(o=0)}Math.abs(o)>2*n.pi()-a&&(o=o>=0?2*n.pi():-2*n.pi(),e.setEndXY(e.getStartXY())),Math.abs(o)<a&&(o=0,e.setEndXY(e.getStartXY())),s=Math.abs(o)<=n.pi(),o&&(i=o>0),e.m_startAngle=Vs(r),e.m_sweepAngle=o,sr(e,!s),ir(e,i)}function Vs(e){let t=e,i=!1;return t<=-n.pi()?(t+=n.twoPi(),i=!0):t>n.pi()&&(t-=n.twoPi(),i=!0),t<=-n.pi()?(t=n.fmod(t,n.twoPi()),t<=-n.pi()&&(t+=n.twoPi()),i=!0):t>n.pi()&&(t=n.fmod(t,n.twoPi()),t>n.pi()&&(t-=n.twoPi()),i=!0),i&&(t>n.pi()||t<=-n.pi())&&(t=n.pi()),t}function Fs(e,t,i){const s=i,r=s.getSemiAxes();let o=new n.Point2D(r.x*Math.cos(e[0]),r.y*Math.sin(e[0]));return o=s.convertFromCanonic(o),n.Point2D.sqrDistance(o,s.getStartXY())}function Ls(e,t,i){const s=i,r=s.getSemiAxes(),o=e[0]+s.getStartAngle();let a=new n.Point2D(r.x*Math.cos(o),r.y*Math.sin(o));return a=s.convertFromCanonic(a),n.Point2D.sqrDistance(a,s.getEndXY())}function qs(e){if(e.m_center.isNAN())return e.m_startAngle=0,void(e.m_sweepAngle=0);const t=e.getStartXY(),i=e.getEndXY(),s=t.equals(i),r=rr(e),o=nr(e),a=e.projectionBehavior();if(s){const i=e.convertToCanonic(t),s=new n.Point2D(e.m_semiMajorAxis,e.m_semiMajorAxis*e.m_minorMajorRatio);i.x/=s.x,i.y/=s.y,e.m_startAngle=Vs(Math.atan2(i.y,i.x)),e.m_sweepAngle=r?o?n.twoPi():-n.twoPi():0}else{const s=e.convertToCanonic(t),l=new n.Point2D(e.m_semiMajorAxis,e.m_semiMajorAxis*e.m_minorMajorRatio);s.x/=l.x,s.y/=l.y;const c=e.convertToCanonic(i);c.x/=l.x,c.y/=l.y,e.m_startAngle=Math.atan2(s.y,s.x),e.m_sweepAngle=n.Point2D.calculateAngle(s,c),o?e.m_sweepAngle<0&&(e.m_sweepAngle+=n.twoPi()):e.m_sweepAngle>0&&(e.m_sweepAngle-=n.twoPi()),e.m_startAngle=Vs(e.m_startAngle);let h=Fs([e.m_startAngle],0,e);if(h=Math.sqrt(h),h>.25*F(e)){const t=e.m_startAngle-1e-4,i=e.m_startAngle+1e-4,n=[0];Ce(Fs,e,1,[e.m_startAngle],[t],[i],0,n),e.m_startAngle=Vs(n[0])}if(h=Ls([e.m_sweepAngle],0,e),h=Math.sqrt(h),h>.25*F(e)){const t=e.m_sweepAngle-1e-4,i=e.m_sweepAngle+1e-4,n=[0];Ce(Ls,e,1,[e.m_sweepAngle],[t],[i],0,n),e.m_sweepAngle=n[0]}const u=Math.abs(e.m_sweepAngle)>n.pi();if(sr(e,u),r!==u&&!r&&Math.abs(e.m_sweepAngle)>1.5*n.pi())return void Ws(e,t,i,a);if(0===e.m_sweepAngle||o!==e.m_sweepAngle>0)return void Ws(e,t,i,a)}}function Hs(e,t){const i=function(e,t){const i=new n.Envelope1D(e.getStartAngle(),e.getEndAngle());i.normalize();const s=n.twoPi(),r=n.fmod(t,s);if(r<i.vmin){let e=r+s;for(;e<i.vmin;)e+=s;return i.containsCoordinate(e)?e:i.vmin-r<e-i.vmax?r:e}if(r>i.vmax){let e=r-s;for(;e>i.vmax;)e-=s;return i.containsCoordinate(e)||i.vmin-e<r-i.vmax?e:r}return r}(e,t);return(i-e.getStartAngle())/e.getSweepAngle()}function Us(e,t){return e.m_startAngle+t*e.m_sweepAngle}function zs(e,t,i){i.assign(new n.ECoordinate(e.m_startAngle).addE(t.mulE(new n.ECoordinate(e.m_sweepAngle))))}function Ys(e){return e.m_cachedValues}function Bs(e){if(e.m_cachedValues)return e.m_cachedValues;const t={e2:0,completeE:0};return t.e2=function(e){return 1-n.sqr(e.m_minorMajorRatio)}(e),t.completeE=n.completeEllipticE(t.e2),e.m_cachedValues=t,t}function Xs(e,t,i,s){if(!t.isEqual(e.m_XStart,e.m_YStart)||!i.isEqual(e.m_XEnd,e.m_YEnd)){if(Zs(e))return e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=i.x,e.m_YEnd=i.y,dr(e),void e.afterCompletedModification();if(s&&Math.abs(e.getSweepAngle())<=1.01*n.halfPi()){const s=n.makeObjectArray(n.Point2D,3),r=cr(e,s);if(Ln(s)){if(s[0].assign(t),s[2].assign(i),Hn(s),0===e.projectionBehavior()){let t=0,i=2;n.Point2D.sqrDistance(s[1],s[0])<n.Point2D.sqrDistance(s[1],s[2])&&(i=n.swap(t,t=i));const r=s[i].sub(s[t]),o=r.length();r.divThis(o);const a=s[1].sub(s[t]),l=a.length(),c=a.dotProduct(r)/l,h=a.crossProduct(r)/l,u=new n.Point2D;n.lerpPoint2D(s[t],s[i],.5,u);const m=.5*o/h*n.snap(1-c,0,1),d=s[1].side(s[t],s[i]),p=r.clone();d?p.leftPerpendicularThis():p.rightPerpendicularThis();const g=u.sub(p.mul(m));e.constructCircularArcThreePoint(s[0],s[2],g)}else hr(s,r*r,null,!1,e);return}}0===e.projectionBehavior()?function(e,t,i){const s=e.getStartXY(),o=e.getEndXY(),a=s.equals(o),l=t.equals(i);if(!a&&!l){const a=new r.Transformation2D;a.setShiftCoords(-e.m_XStart,-e.m_YStart);const l=n.Point2D.distance(t,i),c=n.Point2D.distance(s,o),h=l/c;a.scale(h,h);const u=o.sub(s);u.divThis(c);const m=i.sub(t);m.divThis(l);const d=u.crossProduct(m),p=m.dotProduct(u);return a.rotate(p,d),a.shiftCoords(t.x,t.y),void Ks(e,a,!0,t,i)}const c=new n.Point2D;if(e.queryCoord2D(.5,c),l){if(a){const n=e.m_center.add(t.sub(s));e.constructEllipticArcEndPointsCenter(t,i,e.getSemiMajorAxis(),1,0,!0,!e.isClockwise(),n),e.setProjectionBehavior(0)}else if(e.isMajor()){const n=c.sub(t).getUnitVector().mul(2*e.getSemiMajorAxis()).add(t);e.constructCircularArcThreePoint(t,i,n)}else e.constructCircularArcThreePoint(t,i,t);return}const h=t.add(i).mul(.5),u=i.sub(t);u.rightPerpendicularThis();const m=h.add(u),d=n.Point2D.getClosestCoordinate(h,m,e.getCenter(),!0),p=new n.Point2D;n.lerpPoint2D(h,m,d,p);const g=n.Point2D.distance(t,p);e.constructEllipticArcEndPointsCenter(t,i,g,1,0,!0,!e.isClockwise(),p),e.setProjectionBehavior(0)}(e,t,i):vr(e,t,i)}}function js(e,t,i,n,s,r,o,a,l){return e.m_bits=0,e.m_rotation=r,T(e,t),I(e,i),e.m_cosr=Math.cos(r),e.m_sinr=Math.sin(r),sr(e,o),ir(e,a),void 0!==l?e.m_center.assign(l):e.m_center.setNAN(),e.setProjectionBehavior(1),e.m_semiMajorAxis=n,e.m_minorMajorRatio=s,lr(e,void 0===l)}function Ws(e,t,i,n){e.m_bits=0,e.m_rotation=0,T(e,t),I(e,i),e.m_interior.assign(t.add(i).mul(.5)),e.m_startAngle=0,e.m_sweepAngle=0,e.m_cosr=1,e.m_sinr=0,sr(e,!1),ir(e,!1),e.m_center.setNAN(),e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.setProjectionBehavior(n),e.afterCompletedModification()}function Zs(e){return e.m_center.isNAN()}function Qs(e,t){if(0===t)return 0;const i=Bs(e),s=Us(e,t),r=n.halfPi(),o=$s(e),a=n.ellipticE(s+r,i.e2,i.completeE),l=e.m_semiMajorAxis*(a-o);return Math.abs(l)}function $s(e){const t=Bs(e);return n.ellipticE(e.getStartAngle()+n.halfPi(),t.e2,t.completeE)}function Ks(e,i,s,r,o){if(2===i.m_TransformationType)return void t.geometryReleaseAssert(0);if(t.geometryReleaseAssert(!or(e)),i.isIdentity()&&(!r||r.equals(e.getStartXY())&&o.equals(e.getEndXY())))return;tr(e);let a=n.Point2D.getNAN(),l=n.Point2D.getNAN();if(null===r?(a.x=e.m_XStart,a.y=e.m_YStart,i.transformInPlace(a),l.x=e.m_XEnd,l.y=e.m_YEnd,i.transformInPlace(l)):(a=r,l=o),Zs(e))return e.m_XStart=a.x,e.m_YStart=a.y,e.m_XEnd=l.x,void(e.m_YEnd=l.y);const c=e.m_center.clone();if(i.transformInPlace(c),s||i.isUniformNoRotation()){let t=nr(e);if(i.isReflective()&&(t=!t),0===e.projectionBehavior()){if(!a.equals(l)){const t=e.m_interior.clone();return i.transformInPlace(t),void e.constructCircularArcThreePoint(a,l,t)}return void Js(e,a,l,c,t,!1)}const s=new n.Point2D(e.m_cosr,e.m_sinr);i.transformWithoutTranslateInPlace(s);const r=Math.atan2(s.y,s.x),o=e.getSemiAxes();i.transformWithoutTranslateInPlace(o);const h=e.m_center.clone();return i.transformInPlace(h),void e.constructEllipticArcEndPointsCenter(a,l,o.x,o.y/o.x,r,e.isMajor(),t,h)}{{const t=new Array(4);!function(e,t){const i=new n.ECoordinate(e.m_cosr).sqrThis(),s=new n.ECoordinate(e.m_sinr).sqrThis(),r=new n.ECoordinate(e.m_minorMajorRatio),o=new n.ECoordinate(1/e.m_minorMajorRatio),a=r.mulE(i).addThisE(o.mulE(s)),l=r.subE(o).mulThis(2*e.m_cosr*e.m_sinr),c=r.mulE(s).addThisE(o.mulE(i));t[0]=a,t[1]=l,t[2]=c,t[3]=new n.ECoordinate(-e.m_semiMajorAxis).mulThis(e.m_semiMajorAxis).mulThis(e.m_minorMajorRatio)}(e,t);const s=new x;if(s.a11.setE(t[0]),s.a12.setE(t[1]),s.a12.mulThisByPower2(.5),s.a21.setE(s.a12),s.a22.setE(t[2]),!s.det().isZero()){const r=new x;if(r.a11.set(i.xx),r.a12.set(i.xy),r.a21.set(i.yx),r.a22.set(i.yy),r.invertThis()){const o=r.clone();o.transposeThis();const h=s.clone();if(h.mulThis(r),h.mulLeftThis(o),!h.det().isZero()){const s=n.makeObjectArray(n.ECoordinate,4);s[0].setE(h.a11),s[1].setE(h.a12),s[1].mulThisByPower2(2),s[2].setE(h.a22),s[3].setE(t[3]);const r=n.Point2D.getNAN(),o=function(e,t){const i=new x;i.a11.setE(e[0]),i.a12=n.ECoordinate.st_mulByPower2(e[1],.5),i.a21.setE(i.a12),i.a22.setE(e[2]);const s=[n.Point2D.getNAN(),n.Point2D.getNAN()],r=[new n.ECoordinate,new n.ECoordinate];i.eigenSymmetric(r,s);const o=e[3].clone();return o.negateThis(),o.invThis(),r[0].mulThisE(o),r[1].mulThisE(o),r[0].sqrtThis().invThis(),r[1].sqrtThis().invThis(),t.x=r[0].toDouble(),t.y=r[1].toDouble(),Math.atan2(s[0].y,s[0].x)}(s,r);let u=nr(e);return i.isReflective()&&(u=!u),void e.constructEllipticArcEndPointsCenter(a,l,r.x,r.y/r.x,o,e.isMajor(),u,c)}}}}const t=[n.Point2D.getNAN(),n.Point2D.getNAN(),n.Point2D.getNAN()];t[0].setCoords(e.getSemiMajorAxis(),0),t[0].rotateDirect(e.m_cosr,e.m_sinr),t[1].setCoords(e.getSemiMajorAxis(),e.getSemiMinorAxis()),t[1].rotateDirect(e.m_cosr,e.m_sinr),t[2].setCoords(0,e.getSemiMinorAxis()),t[2].rotateDirect(e.m_cosr,e.m_sinr);let s=e.isClockwise();s&&(t[2]=n.swap(t[0],t[0]=t[2]));const r=.5;i.transformWithoutTranslateArray(t,3,t),i.isReflective()&&(s=!s);const o=new n.Point2D(0,0),h=e.createInstance();hr(t,r,o,!1,h),e.constructEllipticArcEndPointsCenter(a,l,h.getSemiMajorAxis(),h.getMinorMajorRatio(),h.getAxisXRotation(),e.isMajor(),!s,c)}}function Js(e,t,i,n,s,r){const o=.5*(n.sub(t).length()+n.sub(i).length());e.m_center.assign(n),e.m_startAngle=Math.atan2(t.y-e.m_center.y,t.x-e.m_center.x),ks(e,Math.atan2(i.y-e.m_center.y,i.x-e.m_center.x),s,r);const a=e.constructEllipticArcEndPointsCenter(t,i,o,1,0,Math.abs(e.m_sweepAngle)>Math.PI,e.m_sweepAngle>0,n);return e.setProjectionBehavior(0),a}function er(e,t){e.m_cachedValues=t}function tr(e){e.m_cachedValues=null}function ir(e,t){const i=t?1:0;e.m_bits=-2&e.m_bits|i}function nr(e){return!!(1&e.m_bits)}function sr(e,t){const i=t?1:0;e.m_bits=-3&e.m_bits|i<<1}function rr(e){return!!(2&e.m_bits)}function or(e){return!!(8&e.m_bits)}function ar(e){e.m_bits&=-9}function lr(e,i){ar(e);const s=e.getStartXY(),r=e.getEndXY();let o=!1;const a=rr(e),l=nr(e),c=e.projectionBehavior(),h=s.equals(r);let u=0===e.m_minorMajorRatio||0===e.m_semiMajorAxis;if(Number.isNaN(e.m_minorMajorRatio)&&(0===e.m_semiMajorAxis?e.m_minorMajorRatio=1:t.throwCorruptedGeometryException("NAN minor major ratio and non-zero major axis")),u||=i?h:e.m_center.isNAN(),u)return Ws(e,s,r,c),!0;e.m_semiMajorAxis=Math.abs(e.m_semiMajorAxis),e.m_minorMajorRatio=Math.abs(e.m_minorMajorRatio),e.m_minorMajorRatio>1&&(e.m_semiMajorAxis*=e.m_minorMajorRatio,e.m_minorMajorRatio=1/e.m_minorMajorRatio);const m=new n.Point2D(e.m_semiMajorAxis,e.m_semiMajorAxis*e.m_minorMajorRatio);if(t.geometryReleaseAssert(m.y>0&&m.x>=m.y),h){const i=e.convertToCanonic(s);t.geometryReleaseAssert(!m.isZero()),i.x/=m.x,i.y/=m.y;const r=Math.sqrt(n.sqr(i.x)+n.sqr(i.y));if(o=1!==r,e.m_semiMajorAxis*=r,m.mulThis(r),e.m_startAngle=Vs(Math.atan2(i.y,i.x)),!a)return e.m_interior.assign(s),e.m_sweepAngle=0,e.afterCompletedModification(),o;e.m_sweepAngle=l?n.twoPi():-n.twoPi()}else{let t=e.m_center.isNAN()||function(e){if(e.m_center.isNAN())return!1;const t=new y;t.setWithEps(e.getStartXY(),8),t.subThisE((new y).setWithEps(e.m_center,8));const i=new n.ECoordinate;i.setWithEps(e.m_rotation,8);const s=new n.ECoordinate,r=new n.ECoordinate;n.ECoordinate.st_cosAndSin(i,s,r),t.rotateReverse(s,r);const o=new y;o.setWithEps(e.getEndXY()),o.subThisE(y.constructPoint2D(e.m_center)),o.rotateReverse(s,r);const a=new n.ECoordinate;a.setWithEps(e.m_semiMajorAxis,8);const l=a.clone(),c=new n.ECoordinate;c.setWithEps(e.m_minorMajorRatio),l.mulThisE(c),t.x.divThisE(a),t.y.divThisE(l),o.x.divThisE(a),o.y.divThisE(l);const h=t.x.sqr().addThisE(t.y.sqr()).subThisE(n.s_one),u=o.x.sqr().addThisE(o.y.sqr()).subThisE(n.s_one);return!h.isZero()||!u.isZero()}(e);if(!t){const i=e.convertToCanonic(s);i.x/=m.x,i.y/=m.y;const o=new n.Point2D(1,0);e.m_startAngle=n.Point2D.calculateAngle(o,i);const a=e.convertToCanonic(r);a.x/=m.x,a.y/=m.y,e.m_sweepAngle=n.Point2D.calculateAngle(i,a),t=!ur(e)}if(t){o=!0;const t=s.sub(r).mulThis(.5);t.rotateReverse(e.m_cosr,e.m_sinr);let i=n.sqr(t.x/m.x)+n.sqr(t.y/m.y);i>1&&(i=Math.sqrt(i),e.m_semiMajorAxis*=i,m.mulThis(i));const c=new n.Point2D(0,0);{const e=m.x*m.x,i=m.y*m.y,n=e*t.y*t.y+i*t.x*t.x,s=e*i-n;if(s>0){const e=Math.sqrt(s/n);c.setCoords(m.x*t.y/m.y,-m.y*t.x/m.x),c.mulThis(e),a===l&&c.negateThis()}}{const t=new n.Point2D(c.x,c.y);t.rotateDirect(e.m_cosr,e.m_sinr),t.addThis(s.add(r).mulThis(.5)),e.m_center.assign(t)}}if(qs(e),!ur(e))return Ws(e,s,r,c),!0}return dr(e),e.afterCompletedModification(),o}function cr(e,i){t.geometryReleaseAssert(Math.abs(e.getSweepAngle())<15*Math.PI/16);const s=e.getSemiMajorAxis(),r=e.getSemiMinorAxis();let o;if(0===s)return i[0].setCoordsPoint2D(e.getStartXY()),i[1].setCoordsPoint2D(e.getStartXY()),i[2].setCoordsPoint2D(e.getStartXY()),o=1,o;if(0===r)return i[0].setCoordsPoint2D(e.getStartXY()),i[2].setCoordsPoint2D(e.getEndXY()),i[1]=n.Point2D.lerp(i[0],i[2],.5),o=1,o;const a=e.getSweepAngle(),l=e.getStartAngle(),c=l+a,h=new n.Point2D(-s*Math.sin(l),r*Math.cos(l)),u=new n.Point2D(-s*Math.sin(c),r*Math.cos(c));h.normalize(),u.normalize(),h.rotateDirect(e.m_cosr,e.m_sinr),u.rotateDirect(e.m_cosr,e.m_sinr),i[0].setCoordsPoint2D(e.getStartXY()),i[2].setCoordsPoint2D(e.getEndXY()),i[1].setSub(i[2],i[0]);const m=h.crossProduct(u);return i[1].assign(h.mul(i[1].crossProduct(u)/m)),i[1].addThis(i[0]),o=Math.cos(.5*a),o}function hr(e,i,s,r,o){if(r){const t=.5,s=Math.sqrt(i),r=n.sqr(1-t)+2*s*t*(1-t)+n.sqr(t),a=e[0].mul(n.sqr(1-t)).add(e[1].mul(2*s*t*(1-t))).add(e[2].mul(n.sqr(t))).divThis(r);return o.constructCircularArcThreePoint(e[0],e[2],a),!0}const a=e[0].sub(e[1]),l=e[2].sub(e[1]),c=a.crossProduct(l),h=a.dotProduct(l),u=i;t.geometryReleaseAssert(u<=1),t.geometryReleaseAssert(u>0);const m=.5/(1-u),d=a.sqrLength(),p=h,g=l.sqrLength(),_=n.sqr(c),f=a.sub(l).sqrLength();if(0===_)return Ws(o,e[0],e[2],1),!1;if(h<=-Math.sqrt(d)*Math.sqrt(g))return Ws(o,e[0],e[2],1),!1;const y=[0,0],x=new n.Envelope1D;x.setInfinite();const v=Ee(2*_,-(f/u+4*p),2*(1-u)/u,x,!1,y);if(0===v)return Ws(o,e[0],e[2],1),!1;1===v&&(y[1]=y[0]);const P=Math.sqrt(m/y[0]),b=Math.sqrt(m/y[1]),E=.5/u;let S=E-g*y[0],C=E-d*y[0];Math.abs(S)>Math.abs(C)?C=p*y[0]-E+1:S=p*y[0]-E+1;const w=a.mul(S).add(l.mul(C)),T=w.norm(1)<1e-15*P?0:Math.atan2(w.y,w.x)+Math.PI,D=a.add(l),I=s?s.clone():e[1].add(D.mul(m)),A=e[0].sub(I),M=e[2].sub(I),N=A.crossProduct(M)<0;return new xs,o.constructEllipticArcEndPointsCenter(e[0],e[2],P,b/P,T,!1,!N,I)}function ur(e){const t=F(e);let i=!1;{const s=new n.Point2D(e.m_semiMajorAxis*Math.cos(e.m_startAngle),e.getSemiMinorAxis()*Math.sin(e.m_startAngle));s.rotateDirect(e.m_cosr,e.m_sinr),s.addThis(e.m_center),i=n.Point2D.distance(e.getStartXY(),s)>t}let s=!1;if(!i){const i=new n.Point2D(e.m_semiMajorAxis*Math.cos(e.m_startAngle+e.m_sweepAngle),e.getSemiMinorAxis()*Math.sin(e.m_startAngle+e.m_sweepAngle));i.rotateDirect(e.m_cosr,e.m_sinr),i.addThis(e.m_center),s=n.Point2D.distance(e.getEndXY(),i)>t}return!i&&!s}function mr(e){if(Zs(e))return 0;if(e.isDegenerate(0))return 0;const t=e.m_semiMajorAxis,i=e.getSemiMinorAxis(),n=t*t+i*i,s=e.getStartAngle(),r=e.getEndAngle(),o=e.m_center.y-e.m_YStart,a=e.m_cosr,l=e.m_sinr;let c=1,h=0;e.m_rotation&&(c=(a-l)*(a+l),h=2*a*l);const u=((-.5*(r-s)+.25*c*(2*Math.cos(r+s)*Math.sin(r-s)))*i+-2*Math.sin(.5*(r+s))*Math.sin(.5*(r-s))*a*o)*t/n;let m=0;return e.m_rotation&&(m=-2*Math.sin(r+s)*Math.sin(r-s)*.125*h-i*o/n*(2*Math.cos(.5*(r+s))*Math.sin(.5*(r-s)))*l),n*(u+m)+-.5*(e.m_XEnd-e.m_XStart)*(e.m_YEnd-e.m_YStart)}function dr(e){e.queryCoord2D(.5,e.m_interior)}function pr(e,t,i,n,s){if(s){if(0!==Er(t,i))return 2}else if(E(t,i))return 1;return 0!==gr(e,t,i,null,null,null,n,void 0!==s&&s,0,!1)?4:0}function gr(e,i,s,r,o,a,l,c,h,u){if(Zs(i))return ie(new Ar({start:i.getStartXY(),end:i.getEndXY()}),s,r,o,a,l,c,u);null!==o&&(o.length=0),null!==a&&(a.length=0),null!==r&&(r.length=0);const m=L(i,s);if(q(i,s,l=Math.max(m,l)))return 0;const d=s.getStartXY();d.subThis(i.m_center);const p=s.getEndXY();p.subThis(i.m_center),d.rotateReverse(i.m_cosr,i.m_sinr),p.rotateReverse(i.m_cosr,i.m_sinr);const g=p.clone();g.subThis(d);const _=i.m_semiMajorAxis,f=1/_,y=i.getSemiMinorAxis(),x=1/y,v=g.clone();v.leftPerpendicularThis();const P=Math.atan2(y*v.y,_*v.x),b=n.makePrimitiveArray(16,Number.NaN),E=n.makePrimitiveArray(16,Number.NaN);let S=0;const C=[P,P+Math.PI];for(let e=0;e<2;++e){const t=Hs(i,C[e]);if(t>=0&&t<=1){b[S]=t;const e=i.getCoord2D(b[S]);E[S]=s.getClosestCoordinate(e,!1),n.Point2D.distance(e,s.getCoord2D(E[S]))<=l&&S++}}const w=d.x*f,T=d.y*x,D=g.x*f,I=g.y*x;let A=Ee(D*D+I*I,2*(w*D+T*I),w*w+T*T-1,n.Envelope1D.unit(),!1,E);t.geometryReleaseAssert(A>=0);for(let e=0;e<A;e++){const t=g.mul(E[e]).add(d);t.x*=f,t.y*=x;const r=Hs(i,Math.atan2(t.y,t.x));if(r>=0&&r<=1){b[S]=r;const e=i.getCoord2D(r);E[S]=s.getClosestCoordinate(e,!1),n.Point2D.distance(e,s.getCoord2D(E[S]))<=l&&S++}}t.geometryReleaseAssert(S<b.length+4);const M=n.makePrimitiveArray(16,Number.NaN);A=i.intersectPoint(s.getStartXY(),M,l);for(let e=0;e<A;e++,S++)b[S]=M[e],E[S]=0;A=i.intersectPoint(s.getEndXY(),M,l);for(let e=0;e<A;e++,S++)b[S]=M[e],E[S]=1;A=s.intersectPoint(i.getStartXY(),M,l);for(let e=0;e<A;e++,S++)b[S]=0,E[S]=M[e];A=s.intersectPoint(i.getEndXY(),M,l);for(let e=0;e<A;e++,S++)b[S]=1,E[S]=M[e];return 0===S?0:Tr(e,i,s,b,E,S,r,o,a,l,c,0,u)}function _r(e,i,s,r,o,a,l,c,h,u){if(Zs(i)){const t=new Ar({start:i.getStartXY(),end:i.getEndXY()});return gr(e,s,t,r,a,o,l,c,0,!0)}if(Zs(s)){const t=new Ar({start:s.getStartXY(),end:s.getEndXY()});return gr(e,i,t,r,o,a,l,c,0,u)}const m=L(i,s);l=Math.max(l,m);let d=!1;{const e=i.getSemiAxes(),r=i.getCenter(),u=s.getSemiAxes(),m=s.getCenter(),p=n.Point2D.distance(m,r),g=e.x+u.x;if(p>g+l)return 0;if(e.y>u.x){if(p+u.x+l<e.y)return 0}else if(u.y>e.x&&p+e.x+l<u.y)return 0;if(h&&!c){const n=1===i.m_minorMajorRatio&&i.isClosed()&&i.isMajor(),r=1===s.m_minorMajorRatio&&s.isClosed()&&s.isMajor();if(n&&r&&(d=!0,p<=g)&&Math.max(e.x,u.x)<=Math.min(e.x,u.x)+p)return t.geometryReleaseAssert(!o&&!a),1}}if(!d&&q(i,s,l))return 0;const p=[],g=[],_=!1,f=!1,y=Ss(i,0,0,_,f,p,g,null),x=[],v=[],P=Ss(s,0,0,_,f,x,v,null);if(1===y&&1===P){const e=new Le({points:p,weights:g}),t=new Le({points:x,weights:v}),m=[],d=[],_=Qn(!1,e,t,r,null===o?null:m,null===a?null:d,l,c,h,u);if(_>0&&null!==o||null!==a){o&&(o.length=0),a&&(a.length=0);for(let r=0;r<_;++r){if(o)if(n.isOneOf(m[r],0,1))o.push(m[r]);else{const t=e.tToLength(m[r]),n=i.lengthToT(t);o.push(n)}if(a)if(n.isOneOf(d[r],0,1))a.push(d[r]);else{const e=t.tToLength(d[r]),i=s.lengthToT(e);a.push(i)}}}return _}let b=[];const E=[];let S=0;const C=h&&!c;for(let e=0;e<y;e++){const t=new Le({points:p.slice(2*e,2*e+3),weights:g.slice(2*e,2*e+3)});let r=0;for(let o=0;o<P;o++){E.length<=o&&E.push(new Le({points:x.slice(2*o,2*o+3),weights:v.slice(2*o,2*o+3)}));const a=[],c=[],h=C?null:a,u=C?null:c,m=Qn(!1,t,E[o],null,h,u,l,!1,C,!1);if(m>0&&C)return 1;for(let l=0;l<m;++l){if(0===a[l]&&0===e)a[l]=0;else if(1===a[l]&&e===y-1)a[l]=1;else{const e=t.tToLength(a[l])+S,n=i.lengthToT(e);a[l]=n}if(0===c[l]&&0===o)c[l]=0;else if(1===c[l]&&o===P-1)c[l]=1;else{const e=E[o].tToLength(c[l])+r,t=s.lengthToT(e);c[l]=t}b.push(n.makePair(a[l],c[l]))}r+=E[o].calculateLength2D()}S+=t.calculateLength2D()}if(0===b.length)return 0;if(c&&(b=b.filter((e=>!n.isOneOf(e.first,0,1)||!n.isOneOf(e.second,0,1)||!i.getCoord2D(e.first).equals(s.getCoord2D(e.second))))),h)return b.length;const w=[],T=[];for(const e of b)w.push(e.first),T.push(e.second);return Tr(e,i,s,w,T,w.length,r,o,a,l,c,0,u)}function fr(e,t,i){if(i.setCoords(e.getCoord2D(t.vmin)),i.mergeNe(e.getCoord2D(t.vmax)),Zs(e))return;const s=e.getSemiAxes(),r=[0,0,0,0];{const t=Math.atan2(-s.y*e.m_sinr,s.x*e.m_cosr),i=t+Math.PI,n=Math.atan2(s.y*e.m_cosr,s.x*e.m_sinr),o=n+Math.PI;r[0]=Hs(e,t),r[1]=Hs(e,i),r[2]=Hs(e,n),r[3]=Hs(e,o)}const o=new n.Point2D;for(let n=0;n<4;n++){const s=r[n];t.containsExclusiveCoordinate(s)&&(e.queryCoord2D(s,o),i.mergeNe(o))}}function yr(e,i,s,r,o){if(0===e.m_semiMajorAxis)return s.vmin;let a=n.Point2D.getNAN();e.queryCoord2D(s.vmin,a);let l=n.Point2D.getNAN();if(e.queryCoord2D(s.vmax,l),Zs(e))return new Ar({start:a,end:l}).getClosestCoordinate(i,r);const c=Gs(e,i);if(a=Gs(e,a),l=Gs(e,l),1===e.m_minorMajorRatio){if(c.isEqual(0,0))return s.vmin;const t=Hs(e,Math.atan2(c.y,c.x));return r||s.containsCoordinate(t)?t:n.Point2D.distance(c,a)<=n.Point2D.distance(c,l)?s.vmin:s.vmax}const h=e.getSemiMajorAxis(),u=e.getSemiMinorAxis(),m=(h-u)*(h+u),d=n.sqr(m),p=c.x,g=c.y,_=n.sqr(u*g),f=u*m*g*2,y=[new n.ECoordinate(_),new n.ECoordinate(f),new n.ECoordinate(d-n.sqr(h*p)-_),new n.ECoordinate(-f),new n.ECoordinate(-d)],x=n.makeObjectArray(n.ECoordinate,4),v=Ne(y,4,new n.Envelope1D(-1,1),!1,x,4);let P=s.vmin,b=n.Point2D.sqrDistance(c,a);{const e=n.Point2D.sqrDistance(c,l);e<b&&(P=s.vmax,b=e)}t.geometryReleaseAssert(!r);let E=n.makePrimitiveArray(8,Number.NaN);for(let t=0;t<v;++t){const i=x[t].value(),n=Math.sqrt(1-i*i),s=Math.atan2(i,n),r=Math.atan2(i,-n);E[2*t]=Hs(e,s),E[2*t+1]=Hs(e,r)}E=E.slice(0,2*v),n.numericSort(E);for(let t=0,r=2*v;t<r;++t)if(E[t]>s.vmin&&E[t]<s.vmax){const s=n.Point2D.sqrDistance(i,e.getCoord2D(E[t]));b>s&&(b=s,P=E[t])}return P}function xr(e,t,i){return e.m_semiMajorAxis===t.m_semiMajorAxis&&e.isMajor()!==t.isMajor()&&!!e.m_center.equals(t.m_center)&&e.m_sinr===t.m_sinr&&e.m_cosr===t.m_cosr&&e.m_minorMajorRatio===t.m_minorMajorRatio&&(i?e.isClockwise()!==t.isClockwise():e.isClockwise()===t.isClockwise())}function vr(e,i,s,o){const a=e.getStartXY(),l=e.getEndXY(),c=a.equals(l),h=i.equals(s);if(!c&&!h){const t=new r.Transformation2D;return t.initializeFromTwoPoints(a,l,i,s),Ks(e,t,!0,i,s),e.endPointModified(),void e.normalizeAfterEndpointChange()}if(!e.isMajor())return void Ws(e,i,s,1);if(c&&h){const t=e.m_center.add(i.sub(a));return void e.constructEllipticArcEndPointsCenter(i,s,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),t)}if(!c){const t=.5*(n.twoPi()-Math.abs(e.getSweepAngle())),r=(e.getSweepAngle()+t*n.sign(e.getSweepAngle()))/e.getSweepAngle(),o=new n.Point2D;e.queryCoord2D(r,o),e.constructEllipticArcEndPointsCenter(o,o,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),e.getCenter());const a=e.getCenter().add(i.sub(o));return void e.constructEllipticArcEndPointsCenter(i,s,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),a)}const u=n.Point2D.sqrDistance(i,s);let m=.25,d=.75;if(u<n.Point2D.sqrDistance(e.getCoord2D(.25),e.getCoord2D(.75))){const i=[0],s=be(new Os(e,u),n.Envelope1D.construct(0,.25),1,i);s>0&&(t.geometryReleaseAssert(1===s),m=i[0],d=1-i[0])}const p=e.getCoord2D(m),g=e.getCoord2D(d);t.geometryReleaseAssert(!p.equals(g)),e.constructEllipticArcEndPointsCenter(p,g,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),e.m_center),vr(e,i,s)}function Pr(e,t,i,n,s){return br(e,!1,t,i,n,s)}function br(e,i,n,s,r,o){const a=n.getGeometryType(),l=s.getGeometryType(),c=Math.max(r,L(n,s));if(a===t.GeometryType.enumLine&&l===t.GeometryType.enumLine)return te(n,s,c,o);let h=n,u=s,m=n.getStartXY(),d=n.getEndXY();if(m.compare(d)>0&&(h=n.clone().reverse()),m=s.getStartXY(),d=s.getEndXY(),m.compare(d)>0&&(u=s.clone().reverse()),i){if(n.equals(s))return 2;if(function(e,i,n){return t.geometryReleaseAssert(e.isCurve()||i.isCurve()),!!(e.getStartXY().equals(i.getStartXY())&&w(e,i,0,0,n,2,[0,0],[0,0])||e.getEndXY().equals(i.getEndXY())&&w(e,i,1,1,n,2,[0,0],[0,0])||e.getStartXY().equals(i.getEndXY())&&w(e,i,0,1,n,2,[0,0],[0,0])||e.getEndXY().equals(i.getStartXY())&&w(e,i,1,0,n,2,[0,0],[0,0]))}(n,s,c))return 4}switch(a){case t.GeometryType.enumLine:switch(l){case t.GeometryType.enumEllipticArc:return pr(e,u,h,c,o);case t.GeometryType.enumBezier:return Ui(e,u,h,c,o);case t.GeometryType.enumRationalBezier2:return Bn(e,u,h,c,o);case t.GeometryType.enumBezier2:return Gt(e,u,h,c,o);default:t.throwInternalErrorException("")}break;case t.GeometryType.enumEllipticArc:switch(l){case t.GeometryType.enumLine:return pr(e,h,u,c,o);case t.GeometryType.enumEllipticArc:return function(e,t,i,n,s){if(s){if(0!==Er(t,i))return 2}else if(E(t,i))return 1;return 0!==_r(e,t,i,null,null,null,n,void 0!==s&&s,!0,!1)?4:0}(e,h,u,c,o);case t.GeometryType.enumBezier:return zi(e,u,h,c,o);case t.GeometryType.enumRationalBezier2:return Xn(e,u,h,c,o);case t.GeometryType.enumBezier2:return kt(e,u,h,c,o);default:t.throwInternalErrorException("")}break;case t.GeometryType.enumBezier:switch(l){case t.GeometryType.enumLine:return Ui(e,h,u,c,o);case t.GeometryType.enumEllipticArc:return zi(e,h,u,c,o);case t.GeometryType.enumBezier:return function(e,t,i,n,s){if(s){if(0!==Er(t,i))return 2}else if(E(t,i))return 1;return 0!==Wi(e,t,i,null,null,null,n,void 0!==s&&s,!0,!1)?4:0}(e,h,u,c,o);case t.GeometryType.enumRationalBezier2:return Yi(e,h,u,c,o);case t.GeometryType.enumBezier2:return Bi(e,h,u,c,o);default:t.throwInternalErrorException("")}break;case t.GeometryType.enumRationalBezier2:switch(l){case t.GeometryType.enumLine:return Bn(e,h,u,c,o);case t.GeometryType.enumEllipticArc:return Xn(e,h,u,c,o);case t.GeometryType.enumBezier:return Yi(e,u,h,c,o);case t.GeometryType.enumRationalBezier2:return function(e,t,i,n,s){if(s){const n=Er(t,i);if(0!==n){if(e){if(1===n){if(t.m_weights[0]===i.m_weights[0]&&t.m_weights[1]===i.m_weights[1]&&t.m_weights[2]===i.m_weights[2])return 2}else if(t.m_weights[0]===i.m_weights[2]&&t.m_weights[1]===i.m_weights[1]&&t.m_weights[2]===i.m_weights[0])return 2;return 4}return 2}}else if(E(t,i))return 1;return 0!==Qn(e,t,i,null,null,null,n,void 0!==s&&s,!0,!1)?4:0}(e,h,u,c,o);case t.GeometryType.enumBezier2:return jn(e,h,u,c,o);default:t.throwInternalErrorException("")}break;case t.GeometryType.enumBezier2:switch(l){case t.GeometryType.enumLine:return Gt(e,h,u,c,o);case t.GeometryType.enumEllipticArc:return kt(e,h,u,c,o);case t.GeometryType.enumBezier:return Bi(e,u,h,c,o);case t.GeometryType.enumRationalBezier2:return jn(e,u,h,c,o);case t.GeometryType.enumBezier2:return function(e,t,i,n,s){if(s){if(0!==Er(t,i))return 2}else if(E(t,i))return 1;return 0!==Lt(e,t,i,null,null,null,n,s??!1,!0,!1)?4:0}(e,h,u,c,o);default:t.throwInternalErrorException("")}break;default:t.throwInternalErrorException("")}}function Er(e,i,n=!0){if(!n&&!Sr(e,i))return 0;const s=e.isLine()&&i.isLine();if(e.getStartXY().equals(i.getStartXY())&&e.getEndXY().equals(i.getEndXY())){const n=1;if(s)return n;const r=e.getGeometryType();if(r!==i.getGeometryType())return 0;if(r===t.GeometryType.enumBezier){const t=e,s=i;return t.getControlPoint1().equals(s.getControlPoint1())&&t.getControlPoint2().equals(s.getControlPoint2())?n:0}if(r===t.GeometryType.enumEllipticArc)return xr(e,i,!1)?n:0;if(r===t.GeometryType.enumRationalBezier2){const t=e,s=i;if(t.getControlPoint1().equals(s.getControlPoint1())&&t.getStandardFormWeight()===s.getStandardFormWeight())return n}else if(r===t.GeometryType.enumBezier2){const t=i;if(e.getControlPoint1().equals(t.getControlPoint1()))return n}return 0}if(e.getStartXY().equals(i.getEndXY())&&e.getEndXY().equals(i.getStartXY())){const n=-1;if(s)return n;const r=e.getGeometryType();if(r!==i.getGeometryType())return 0;if(r===t.GeometryType.enumBezier){const t=e,s=i;return t.getControlPoint1().equals(s.getControlPoint2())&&t.getControlPoint2().equals(s.getControlPoint1())?n:0}if(r===t.GeometryType.enumEllipticArc)return xr(e,i,!0)?n:-1;if(r===t.GeometryType.enumRationalBezier2){const t=e,s=i;if(t.getControlPoint1().equals(s.getControlPoint1())&&t.getStandardFormWeight()===s.getStandardFormWeight())return n}else if(r===t.GeometryType.enumBezier2){const t=i;if(e.getControlPoint1().equals(t.getControlPoint1()))return n}return 0}return 0}function Sr(e,i){const n=e.getGeometryType();return n===i.getGeometryType()&&(n!==t.GeometryType.enumEllipticArc||e.projectionBehavior()===i.projectionBehavior())}function Cr(e,i,n,s,r,o,a){!r&&o&&t.throwInvalidArgumentException("");const l=i.getGeometryType(),c=n.getGeometryType(),h=Math.max(a,L(i,n));if(s&&(s.length=0),r&&(r.length=0),o&&(o.length=0),l===t.GeometryType.enumLine&&c===t.GeometryType.enumLine)return ie(i,n,s,r,o,h,!1,!1);let u=i,m=n,d=i.getStartXY(),p=i.getEndXY(),g=!1,_=!1;d.compare(p)>0&&(u=i.clone(!0).reverse(),g=!0),d=n.getStartXY(),p=n.getEndXY(),d.compare(p)>0&&(m=n.clone(!0).reverse(),_=!0);let f=0;switch(l){case t.GeometryType.enumLine:switch(c){case t.GeometryType.enumEllipticArc:f=gr(e,m,u,s,o,r,h,!1,0,!0);break;case t.GeometryType.enumBezier:f=Xi(e,m,u,s,o,r,h,!1,0,!0);break;case t.GeometryType.enumRationalBezier2:f=Wn(e,m,u,s,o,r,h,!1,0,!0);break;case t.GeometryType.enumBezier2:f=Vt(e,m,u,s,o,r,h,!1,0,!0);break;default:t.throwInternalErrorException("")}break;case t.GeometryType.enumEllipticArc:switch(c){case t.GeometryType.enumLine:f=gr(e,u,m,s,r,o,h,!1,0,!1);break;case t.GeometryType.enumEllipticArc:f=_r(e,u,m,s,r,o,h,!1,!1,!1);break;case t.GeometryType.enumBezier:f=ji(e,m,u,s,o,r,h,!1,0,!0);break;case t.GeometryType.enumRationalBezier2:f=Zn(e,m,u,s,o,r,h,!1,0,!0);break;case t.GeometryType.enumBezier2:f=Ft(e,m,u,s,o,r,h,!1,0,!0);break;default:t.throwInternalErrorException("")}break;case t.GeometryType.enumRationalBezier2:switch(c){case t.GeometryType.enumLine:f=Wn(e,u,m,s,r,o,h,!1,0,!1);break;case t.GeometryType.enumEllipticArc:f=Zn(e,u,m,s,r,o,h,!1,0,!1);break;case t.GeometryType.enumBezier:f=Zi(e,m,u,s,o,r,h,!1,!1,!0);break;case t.GeometryType.enumRationalBezier2:f=Qn(e,u,m,s,r,o,h,!1,!1,!1);break;case t.GeometryType.enumBezier2:f=$n(e,u,m,s,r,o,h,!1,0,!1);break;default:t.throwInternalErrorException("")}break;case t.GeometryType.enumBezier2:switch(c){case t.GeometryType.enumLine:f=Vt(e,u,m,s,r,o,h,!1,0,!1);break;case t.GeometryType.enumEllipticArc:f=Ft(e,u,m,s,r,o,h,!1,0,!1);break;case t.GeometryType.enumBezier:f=Qi(e,m,u,s,o,r,h,!1,0,!0);break;case t.GeometryType.enumRationalBezier2:f=$n(e,m,u,s,o,r,h,!1,0,!0);break;case t.GeometryType.enumBezier2:f=Lt(e,u,m,s,r,o,h,!1,!1,!1);break;default:t.throwInternalErrorException("")}break;case t.GeometryType.enumBezier:switch(c){case t.GeometryType.enumLine:f=Xi(e,u,m,s,r,o,h,!1,0,!1);break;case t.GeometryType.enumEllipticArc:f=ji(e,u,m,s,r,o,h,!1,0,!1);break;case t.GeometryType.enumBezier:f=Wi(e,u,m,s,r,o,h,!1,!1,!1);break;case t.GeometryType.enumRationalBezier2:f=Zi(e,u,m,s,r,o,h,!1,!1,!1);break;case t.GeometryType.enumBezier2:f=Qi(e,u,m,s,r,o,h,!1,0,!1);break;default:t.throwInternalErrorException("")}break;default:t.throwInternalErrorException("")}if(g){if(r){for(let e=0;e<f;e++)r[e]=1-r[e];r.reverse()}s&&s.reverse(),o&&o.reverse()}if(_&&o)for(let e=0;e<f;e++)o[e]=1-o[e];return f}function wr(e,t,i){return t===i?0:(t>i&&(i=n.swap(t,t=i)),e.cut(t,i,!0).calculateUpperLength2D())}function Tr(e,t,i,s,r,o,a,l,c,h,u,m,d){if(!o)return 0;const p=(e,t)=>{for(let i=0;i<o;++i){let s=t[i];if(n.isOneOf(s,0,1)){s=n.normalizeSignedZero(s);continue}const r=e.getCoord2D(s);s<.5?r.equals(e.getStartXY())&&wr(e,0,s)<=F(e)&&(t[i]=0):r.equals(e.getEndXY())&&wr(e,s,1)<=F(e)&&(t[i]=1)}};p(t,s),p(i,r),function(e,t,i,s,r){const o=[],a=[],l=[];for(let c=0,h=r;c<h;c++)o.push(e.calculateSubLengthFromStart(i[c])),a.push(t.calculateSubLengthFromStart(s[c])),n.isOneOf(i[c],0,1)&&n.isOneOf(s[c],0,1)&&e.getCoord2D(i[c]).equals(t.getCoord2D(s[c]))&&l.push(c);if(0===l.length||l.length===r)return;l.sort(((e,t)=>i[e]<i[t]?-1:i[e]>i[t]?1:s[e]<s[t]?-1:s[e]>s[t]?1:0));let c=-1;for(const h of l){if(c>=0&&i[h]===i[c]&&i[h]===i[c]){c=h;continue}c=h;const l=[];l.length=r;for(let e=0;e<l.length;++e)l[e]=e;l.sort(((e,t)=>{const i=o[h],n=a[h],s=o[e]-i,r=a[e]-n,l=s*s+r*r,c=o[t]-i,u=a[t]-n,m=c*c+u*u;return l<m?-1:l>m?1:0}));for(let o=0;o<r;o++){const r=l[o];if(r===h||i[r]===i[h]&&s[r]===s[h]||n.isOneOf(i[r],0,1)&&n.isOneOf(s[r],0,1))continue;const a=(i,s,r,o)=>{const a=new y,l=new n.ECoordinate;l.setWithEps(1);const c=new n.ECoordinate;c.set(s,l.eps()),e.queryCoord2DE(c,a);const h=new y;e.queryCoord2DE(new n.ECoordinate(i),h);let u=!1;return a.eq(h)&&(c.set(o,l.eps()),t.queryCoord2DE(c,a),t.queryCoord2DE(new n.ECoordinate(r),h),u=a.eq(h)),!u},c=n.Point2D.getNAN();e.queryCoord2D(i[r],c);const u=n.Point2D.getNAN();if(t.queryCoord2D(s[r],u),0===n.Point2D.distance(c,u)&&a(i[h],i[r],s[h],s[r]))break;const m=new n.Envelope1D(s[r],s[h]);m.normalizeNoNAN();const d=new n.Envelope1D(i[r],i[h]);d.normalizeNoNAN();let p=-1,g=Number.POSITIVE_INFINITY,_=Number.POSITIVE_INFINITY,f=i[r];c.assign(e.getCoord2D(f));for(let o=0;o<5;o++){const o=t.getClosestCoordinateOnInterval(c,m,-1);u.assign(t.getCoord2D(o));const l=n.Point2D.distance(c,u);if(f=e.getClosestCoordinateOnInterval(u,d,-1),f===i[h]&&o===s[h]){p=1;break}c.assign(e.getCoord2D(f));const y=n.Point2D.distance(u,c);if(!(y<_&&l<g)){p=0;break}if(0===y&&0===l){a(i[h],i[r],s[h],s[r])?(i[r]=f,s[r]=o,p=0):p=1;break}_=y,g=l}if(-1===p&&(p=n.isOneOf(i[r],0,1)||n.isOneOf(s[r],0,1)?0:1),1!==p)break;i[r]=i[h],s[r]=s[h]}}}(t,i,s,r,o);const g=[];for(let e=0,t=o;e<t;e++)g.push(e);const _=(e,t)=>d?n.standardNumericCompare2(r[e],s[e],r[t],s[t]):n.standardNumericCompare2(s[e],r[e],s[t],r[t]);if(g.length>1){g.sort(_);const e=Math.max(F(t),F(i));let o=0;for(let a=1,l=g.length;a<l;a++){const l=s[g[o]],c=s[g[a]],h=r[g[o]],u=r[g[a]];if(l!==c||h!==u)if(!(wr(t,l,c)<=e&&wr(i,h,u)<=e)||n.isOneOf(l,0,1)&&n.isOneOf(h,0,1)||n.isOneOf(c,0,1)&&n.isOneOf(u,0,1))o++,g[o]=g[a];else{const e=n.Point2D.distance(t.getCoord2D(l),i.getCoord2D(h)),s=n.Point2D.distance(t.getCoord2D(c),i.getCoord2D(u));if(e<=s)continue;if(s<e){g[o]=g[a];continue}}}if(g.length=o+1,1===g.length&&0!==g[0]&&(s[0]=s[g[0]],r[0]=r[g[0]],g[0]=0),g.length>2){const e=n.Envelope1D.constructEmpty(),o=n.Envelope1D.constructEmpty();e.setCoords(s[g[0]],s[g.at(-1)]),o.setCoords(r[g[0]],r[g.at(-1)]);let a=!0;for(let t=1,i=g.length-1;t<i;t++)if(!e.containsCoordinate(s[g[t]])||!o.containsCoordinate(r[g[t]])){a=!1;break}if(a){const s=[.5,.2,.7,.1,.3,.4,.6,.8,.9];for(let r=0;r<s.length;r++){let l=n.lerp(e.vmin,e.vmax,s[r]);const c=t.getCoord2D(l);if(!i.isCloserThanDistance(c,o,h)){a=!1;break}l=n.lerp(o.vmin,o.vmax,s[r]);const u=i.getCoord2D(l);if(!t.isCloserThanDistance(u,e,h)){a=!1;break}}}a&&(g[1]=g.at(-1),g.length=2)}}if(1===g.length&&e){const e=0,n=0;w(t,i,s[0],r[0],h,1,[e],[n])&&(g.push(1),s[1]=e,r[1]=n,g.sort(_))}if(u&&1===g.length){let e=!0;for(let o=0,a=g.length;o<a;o++)if(!n.isOneOf(s[g[o]],0,1)||!n.isOneOf(r[g[o]],0,1)||0!==n.Point2D.distance(t.getCoord2D(s[g[o]]),i.getCoord2D(r[g[o]]))){e=!1;break}if(e)return 0}let f=0;for(let e=0,i=g.length;e<i;e++){if(l&&l.push(s[g[e]]),c&&c.push(r[g[e]]),a){const i=n.Point2D.getNAN();t.queryCoord2D(s[g[e]],i),a.push(i)}f++}return f}function Dr(e,i,s,r,o){let a=-1,l=-1,c=-1,h=-1;{const t=[0,i],n=[i,0],o=[0,r],u=[r,0];for(let i=0;i<2&&-1===a;++i)for(let r=0;r<2;++r)if(e[t[i]].equals(s[o[r]])){a=t[i],l=n[i],c=o[r],h=u[r];break}}if(-1===a){const t=new p;t.setFromPoints(e,i+1);const n=new p;return n.setFromPoints(s,r+1),n.inflate(o),t.isIntersectingW(n)?-1:0}{const u=n.makePrimitiveArray(i+1,Number.NaN),m=ri(e,i+1,u);t.geometryReleaseAssert(m>1);let d=0,p=0;for(let e=0;e<m;++e)a===u[e]&&(p=e,d++),l===u[e]&&d++;if(2!==d)return-1;const g=n.makePrimitiveArray(r+1,Number.NaN),_=ri(s,r+1,g);t.geometryReleaseAssert(_>1),d=0;let f=0;for(let e=0;e<_;++e)c===g[e]&&(f=e,d++),h===g[e]&&d++;if(2!==d)return-1;const y=e[u[(p+m-1)%m]],x=e[u[(p+1)%m]],v=s[g[(f+_-1)%_]],P=s[g[(f+1)%_]],b=e[a],E=[y,x,v,P],S=[0,1,2,3];S.sort(((e,t)=>n.Point2D.compareVectorsOrigin(b,E[e],E[t])));let C=S[0];for(let e=1;e<4;e++){if(S[e]!==(C+1)%4)return-1;C=S[e]}{const e=y.sub(b),t=P.sub(b),i=t.dotProduct(e);if(i>0){const n=t.crossProduct(e),s=Math.abs(Math.atan2(n,i)),r=s*e.length(),a=s*t.length();if(r<=o||a<=o)return-1}}{const e=x.sub(b),t=v.sub(b),i=t.dotProduct(e);if(i>0){const n=t.crossProduct(e),s=Math.abs(Math.atan2(n,i)),r=s*e.length(),a=s*t.length();if(r<=o||a<=o)return-1}}return 1}}var Ir=i.VertexDescription;class Ar extends j{constructor(e){super(e||{XStart:0,YStart:0,XEnd:0,YEnd:0})}assignMove(e){return this!==e&&(this.m_description=e.m_description,e.m_description=null,this.m_attributes=e.m_attributes,e.m_attributes=null,this.m_XStart=e.m_XStart,e.m_XStart=Number.NaN,this.m_YStart=e.m_YStart,this.m_XEnd=e.m_XEnd,e.m_XEnd=Number.NaN,this.m_YEnd=e.m_YEnd),this}assignCopy(e){return this!==e&&e.copyTo(this),this}calculateLowerLength3D(){return t.geometryReleaseAssert(0),0}calculateUpperLength3D(){return t.geometryReleaseAssert(0),0}changeEndPoints3D(e,i){t.geometryReleaseAssert(0)}getClosestCoordinate3D(e,i,n){return t.geometryReleaseAssert(0),0}getBoundary(){return ve(this)}getAttributeAsDbl(e,t,i){if(0===t)return 0===i?Q(this,e):$(this,e);const s=Ir.getInterpolation(t),r=this.getStartAttributeAsDbl(t,i),o=this.getEndAttributeAsDbl(t,i);return n.interpolate(s,r,o,e,Ir.getDefaultValue(t))}constructFromCoords(e,t,i,n){this.dropAllAttributes(),this.setStartXYCoords(e,t),this.setEndXYCoords(i,n)}construct(e,t){this.dropAllAttributes(),this.setStartXY(e),this.setEndXY(t)}construct3D(e,i){t.geometryReleaseAssert(0)}constructPoint(e,t){this.assignVertexDescription(e.getDescription()),this.mergeVertexDescription(t.getDescription()),this.setStart(e),this.setEnd(t)}getGeometryType(){return Ar.type}queryEnvelope(e){if(4===e.m_EnvelopeType){e.setEmpty(),e.assignVertexDescription(this.m_description);const t=s.Envelope2D.constructEmpty();this.queryEnvelope(t),e.setEnvelope(t);for(let t=1,i=this.m_description.getAttributeCount();t<i;t++){const i=this.m_description.getSemantics(t);for(let n=0,s=Ir.getComponentCount(i);t<s;t++){const t=this.queryInterval(i,n);e.setIntervalEnvelope(i,n,t)}}}else 2===e.m_EnvelopeType?e.setCoords({xmin:this.m_XStart,ymin:this.m_YStart,xmax:this.m_XEnd,ymax:this.m_YEnd}):3===e.m_EnvelopeType?(e.setEmpty(),e.mergeCoords(this.m_XStart,this.m_YStart,G(this,0,1,0)),e.mergeCoords(this.m_XEnd,this.m_YEnd,G(this,1,1,0))):t.throwNotImplementedException("env type not impl")}applyTransformation(e){t.geometryReleaseAssert(e instanceof r.Transformation2D);const i=new n.Point2D;i.x=this.m_XStart,i.y=this.m_YStart,e.transformInPlace(i),this.m_XStart=i.x,this.m_YStart=i.y,i.x=this.m_XEnd,i.y=this.m_YEnd,e.transformInPlace(i),this.m_XEnd=i.x,this.m_YEnd=i.y}createInstance(){return new Ar({vd:this.m_description})}calculateLength2D(){return Math.sqrt(ae(this))}calculateLength3D(e){return t.geometryReleaseAssert(0),0}changeEndPoints2D(e,t){this.setStartXY(e),this.setEndXY(t),this.normalizeAfterEndpointChange()}queryControlPointsHelper(e){return t.geometryReleaseAssert(e.length>=2),e[0]=this.getStartXY(),e[1]=this.getEndXY(),2}queryCoord2D(e,t){return W(this,e,t)}queryCoord3D(e,i){t.geometryReleaseAssert(0)}getCoordZ(e){return function(e,t){const i=e.getStartZ(),s=e.getEndZ();return n.lerp(i,s,t)}(this,e)}queryCoord2DE(e,t){K(this,e,t)}queryCoord2DMP(e,t){t.assignPoint2D(this.getStartXY());const i=v.constructPoint2D(this.getEndXY());i.subThis(t),i.mulThis(n.MPValue.constructDouble(e)),t.addThis(i)}getCoordX(e){return Q(this,e)}getCoordY(e){return $(this,e)}cut(e,t,i){const n=new Mr;return this.queryCut(e,t,n,i),n.releaseSegment()}queryCut(e,t,i,s){const r=i.createLine();s&&r.assignVertexDescription(this.m_description);const o=n.Point2D.getNAN();if(W(this,e,o),r.setStartXYCoords(o.x,o.y),W(this,t,o),r.setEndXYCoords(o.x,o.y),!s)for(let i=1,n=this.m_description.getAttributeCount();i<n;i++){const n=this.m_description.getSemantics(i),s=Ir.getComponentCount(n);for(let i=0;i<s;i++){const s=this.getAttributeAsDbl(e,n,i);r.setStartAttribute(n,i,s);const o=this.getAttributeAsDbl(t,n,i);r.setEndAttribute(n,i,o)}}}queryDerivative(e,t){!function(e,t,i){const n=y.constructPoint2D(e.getStartXY()),s=y.constructPoint2D(e.getEndXY());i.setCoordsE(s.x.subE(n.x),s.y.subE(n.y))}(this,0,t)}getClosestCoordinate(e,t){return n.Point2D.getClosestCoordinate(this.getStartXY(),this.getEndXY(),e,t)}getClosestCoordinateOnInterval(e,t,i=-1){const s=new n.Point2D;this.queryCoord2D(t.vmin,s);const r=new n.Point2D;this.queryCoord2D(t.vmax,r);const o=n.Point2D.getClosestCoordinate(s,r,e,!1);return z.recalculateParentT(t.vmin,t.vmax,o)}intersectionOfYMonotonicWithAxisX(e,t){const i=this.m_YEnd-this.m_YStart;if(!i)return e===this.m_YEnd?t:Number.NaN;const n=(e-this.m_YStart)/i;let s=Q(this,n);return 1===n&&(s=this.m_XEnd),s}isCurve(){return!1}isMonotoneQuickAndDirty(){return!0}isDegenerate(e){const t=this.m_XStart-this.m_XEnd,i=this.m_YStart-this.m_YEnd;return Math.sqrt(t*t+i*i)<=e}isDegenerate3D(e,i){return t.geometryReleaseAssert(0),!1}queryLooseEnvelope(e){this.queryEnvelope(e)}clone(e){const t=new Ar;return this.copyTo(t),t}tToLength(e){return e*this.calculateLength2D()}lengthToT(e){const t=this.calculateLength2D();return 0!==t?e/t:0}calculateWeightedAreaCentroid2D(e){const t=new n.Point2D;return t.setCoords(0,0),t}calculateWeightedCentroid2D(){return this.getCoord2D(.5).mul(this.calculateLength2D())}getTangent(e){const t=n.Point2D.getNAN();return t.setSub(this.getEndXY(),this.getStartXY()),t}getDerivative(e){const t=new n.Point2D;return t.setSub(this.getEndXY(),this.getStartXY()),t}getCurvature(e){return 0}isIntersectingPoint(e,t,i){return ne(this,e,t,i)>=0}isIntersectingPoint3D(e,i,n,s,r=1){return t.geometryReleaseAssert(0),!1}getYMonotonicParts(e,t){return 0}getMonotonicParts(e,t){return 0}getMonotonicPartParams(e,i){return i&&(e<2&&t.throwInvalidArgumentException(""),i[0]=0,i[1]=1),2}intersectionWithAxis2D(e,t,i,n){if(e){const e=this.m_YEnd-this.m_YStart;if(!e)return t===this.m_YEnd?-1:0;const s=(t-this.m_YStart)/e;return s<0||s>1?0:(i&&(i[0]=Q(this,s)),n&&(n[0]=s),1)}{const e=this.m_XEnd-this.m_XStart;if(!e)return t===this.m_XEnd?-1:0;const s=(t-this.m_XStart)/e;return s<0||s>1?0:(i&&(i[0]=$(this,s)),n&&(n[0]=s),1)}}calculateUpperLength2D(){return this.calculateLength2D()}calculateLowerLength2D(){return this.calculateLength2D()}normalizeAfterEndpointChange(){return!1}queryLooseEnvelopeOnInterval(e,i){if(2===i.m_EnvelopeType){let t=n.snap(e.vmin,0,1);const s=new n.Point2D;return this.queryCoord2D(t,s),i.setCoords({pt:s}),t=n.snap(e.vmax,0,1),this.queryCoord2D(t,s),void i.mergeNe(s)}t.throwNotImplementedException("3d dst not impl")}orientBottomUp(){ee(this)}isLine(){return!0}isDegenerateToLineHelper(e){return!0}copyIgnoreAttributes(e){e.setStartXY(this.getStartXY()),e.setEndXY(this.getEndXY()),e.normalizeAfterEndpointChange()}calculateArea2DHelper(){return 0}absNormXYZ(e){return function(e,t){const i=e.getStartXYZ();i.z*=t;const n=e.getEndXYZ();return n.z*=t,i.norm(1)+n.norm(1)}(this,e)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)}queryEnvelopeW(e,t){t.setCoords(this.getCoord2D(e.vmin)),t.mergeNe(this.getCoord2D(e.vmax))}setSegmentFromCoordsForStitcher(e,t){J(this,e[0],e[t-1])}writeInBufferStream(e,i){return t.geometryReleaseAssert(0),0}readFromBufferStream(e,i){t.geometryReleaseAssert(0)}snapControlPoints(e){return!1}needsSnapControlPoints(e){return!1}calculateSpecialPointsForCracking(e,t){return 0}ensureXYMonotone(){return!1}setCoordsForIntersector(e,t,i){J(this,e,t)}static isIntersectingLineLine(e,t,i,n){return te(e,t,i,n)}static isIntersectingLineLine_(e,t,i,n){return te(e,t,i,n)}copyToImpl(e){}reverseImpl(){}equalsImpl(e){return!0}equalsImplTol(e,t){return!0}swapImpl(e){}afterCompletedModification(){}endPointModified(){}clearEndPointModified(){}intersect(e,t,i,n,s){return Cr(!1,this,e,t,i,n,s)}intersectPoint(e,i,n){i.length<1&&t.throwOutOfRangeException("");const s=ne(this,e,n,!1);return s>=0?(i&&(i[0]=s),1):0}isIntersecting(e,t,i){return 0!==Pr(!1,this,e,t,i)}}Ar.type=t.GeometryType.enumLine;class Mr{constructor(e){this.m_seg=null,this.m_curves=null,this.m_lineBuffer=new Ar,this.m_mask=0,this.m_active=0,void 0!==e&&(e.copy?e.copy.copyTo(this,!1):e.move?this.assignMove(e.move):e.segment?this.copyFrom(e.segment,!!e.bIgnoreAttributes):t.throwInternalErrorException("bad constructor params"))}assignCopy(e){return e instanceof Mr?this!==e&&e.copyTo(this,!1):this.copyFrom(e,!1),this}assignMove(e){if(e instanceof Mr){if(this===e)return this;this.reset(),1&e.m_mask&&(this.m_lineBuffer=e.m_lineBuffer,e.m_lineBuffer=null,this.m_mask=1),this.m_curves=e.m_curves,this.m_mask=e.m_mask,this.m_active=e.m_active,e.reset(),this.m_seg=this.activeSegment(),e.m_seg=null}else{if(this.m_seg===e)return this;this.create(e.getGeometryType()),this.m_seg.swap(e)}return this}activeSegment(){switch(this.m_active){case 0:return null;case 1:return this.line();case 2:return this.arc();case 4:return this.bezier3();case 8:return this.bezier2();case 16:return this.rbezier2();default:t.throwInternalErrorException("")}}get(){return this.m_seg}reset(){1&this.m_mask&&(this.m_lineBuffer=null),this.m_mask>1&&(this.m_curves=null),this.m_mask=0,this.m_active=0}empty(){return null===this.m_seg}copyTo(e,t){this!==e&&(this.empty()?e.m_seg=null:e.copyFrom(this.m_seg,t))}copyToWithZ(e,i){t.geometryReleaseAssert(0)}createImpl(e){switch(e){case t.GeometryType.enumLine:1&this.m_mask||(this.m_lineBuffer=new Ar,this.m_mask|=1,this.m_active=1);break;case t.GeometryType.enumEllipticArc:2&this.m_mask||(this.m_curves=new xs,this.m_mask=1&this.m_mask|2,this.m_active=2);break;case t.GeometryType.enumBezier:4&this.m_mask||(this.m_curves=new dn,this.m_mask=1&this.m_mask|4,this.m_active=4);break;case t.GeometryType.enumBezier2:8&this.m_mask||(this.m_curves=new He,this.m_mask=1&this.m_mask|8,this.m_active=8);break;case t.GeometryType.enumRationalBezier2:16&this.m_mask||(this.m_curves=new Le,this.m_mask=1&this.m_mask|16,this.m_active=16);break;default:t.throwInvalidArgumentException("")}}create(e){e===t.GeometryType.enumLine?this.createLine():e===t.GeometryType.enumEllipticArc?this.createEllipticArc():e===t.GeometryType.enumBezier?this.createCubicBezier():e===t.GeometryType.enumRationalBezier2?this.createQuadraticRationalBezier():e===t.GeometryType.enumBezier2?this.createQuadraticBezier():t.throwInvalidArgumentException("Segment_buffer.create")}copyFrom(e,t){this.m_seg!==e&&(this.create(e.getGeometryType()),t?e.copyIgnoreAttributes(this.m_seg):e.copyTo(this.m_seg))}copyFromWithZ(e,i){t.geometryReleaseAssert(0)}line(){return this.m_lineBuffer}arc(){return this.m_curves}bezier3(){return this.m_curves}bezier2(){return this.m_curves}rbezier2(){return this.m_curves}createLine(){return this.createImpl(t.GeometryType.enumLine),this.m_seg=this.line(),this.line()}createEllipticArc(){return this.createImpl(t.GeometryType.enumEllipticArc),this.m_seg=this.arc(),this.arc()}createCubicBezier(){return this.createImpl(t.GeometryType.enumBezier),this.m_seg=this.bezier3(),this.bezier3()}createQuadraticRationalBezier(){return this.createImpl(t.GeometryType.enumRationalBezier2),this.m_seg=this.rbezier2(),this.rbezier2()}createQuadraticBezier(){return this.createImpl(t.GeometryType.enumBezier2),this.m_seg=this.bezier2(),this.bezier2()}releaseSegment(){if(this.m_seg=null,0===this.m_active&&t.throwInternalErrorException("releaseSegment"),1&this.m_active){const e=this.line();return this.m_mask-=1,this.m_active=0,this.m_lineBuffer=null,e}let e;return 2&this.m_active?e=this.arc():4&this.m_active?e=this.bezier3():8&this.m_active?e=this.bezier2():16&this.m_active?e=this.rbezier2():t.throwInternalErrorException("releaseSegment"),this.m_mask-=this.m_active,this.m_active=0,this.m_curves=null,e}equals(e){return e instanceof Mr?this===e||(this.empty()?e.empty():!e.empty()&&this.get().equals(e.get())):(t.throwNotImplementedException("seg comparison not yet impl"),!1)}}e.ConvexHull=ai,e.CubicBezier=dn,e.Densificator=Cs,e.EPoint2D=y,e.EditShape=si,e.EllipticArc=xs,e.GeometryCollection=B,e.Line=Ar,e.MPPoint2D=v,e.MultiPoint=d,e.Polygon=Kt,e.Polyline=ye,e.QuadraticRationalBezier=Le,e.Segment=z,e.SegmentBuffer=Mr,e.SegmentTypeInfo=ni,e.VertexIterator=ii,e.approximationWithBeziers=Es,e.approximationWithQuadraticRationalBeziers=Ss,e.arcimpl_NormalizeAngles=ks,e.calculate=ve,e.calculateStandardWeight=ss,e.canUseQuadTree=function(e){return!(e.isEmpty()||e.getGeometryType()!==t.GeometryType.enumPolyline&&e.getGeometryType()!==t.GeometryType.enumPolygon||e.getPointCount()<20)},e.canUseQuadTreeForPaths=function(e){return!(e.isEmpty()||e.getGeometryType()!==t.GeometryType.enumPolyline&&e.getGeometryType()!==t.GeometryType.enumPolygon||e.getPointCount()<20)},e.checkSharpCorner=function(e,t,i,s,r,o,a,l,c){if(n.isOneOf(i,0,1)&&n.isOneOf(s,0,1)&&0===n.Point2D.distance(e.getCoord2D(i),t.getCoord2D(s))){const h=1e-12,u=new y,m=Number.EPSILON;if(e.queryDerivative(new n.ECoordinate(i,m),u),u.isTrueZero()){const t=1===i?-1e-12:h;e.queryDerivative(new n.ECoordinate(i,m).add(t),u)}1===i&&u.negateThis();const d=new y;if(t.queryDerivative(new n.ECoordinate(s,m),d),d.isTrueZero()){const e=1===i?-1e-12:h;t.queryDerivative(new n.ECoordinate(s,m).add(e),d)}1===s&&d.negateThis(),u.isZero()||u.normalize(),d.isZero()||d.normalize();const p=u.dotProduct(d),g=u.crossProduct(d);g.scaleError(3);const _=()=>{if(c)return.001;{const i=e.calculateUpperLength2D(),n=t.calculateUpperLength2D();return Math.min(.01*r/Math.min(i,n),1e-10)}};if(p.ge(n.s_zero)&&(g.isZero()||Math.abs(g.value())<_()))return C(e,t,i,s,r,o,a,l)}return 0},e.clearEndPointModified=ar,e.compareConnectedSegments=function(e,i,s){const r=n.makeObjectArray(n.Point2D,4);let o=e.queryControlPointsHelper(r);const a=n.makeObjectArray(n.Point2D,4);let l=i.queryControlPointsHelper(a);r[0].equals(a[0])||t.throwNonSimpleGeometryException("");const c=e.getGeometryType();if(c===i.getGeometryType()&&r.map(((e,t)=>a[t].equals(e))).reduce(((e,t)=>e&&t))){if(c!==t.GeometryType.enumRationalBezier2)return 0;{const t=i,n=[0,0,0],s=[0,0,0];if(e.queryWeights(n),t.queryWeights(s),n.map(((e,t)=>s[t]===e)).reduce(((e,t)=>e&&t)))return 0}}for(;o>2&&r[1].equals(r[0]);)r.splice(1,1),o--;for(;l>2&&a[1].equals(a[0]);)a.splice(1,1),l--;(r[1].equals(r[0])||a[1].equals(r[0]))&&t.throwNonSimpleGeometryException("");const h=n.Point2D.compareVectorsOrigin(r[0],r[1],a[1]);if(0===h){const t=v.constructPoint2D(r[0]),n=new v;e.queryCoord2DMP(1e-16,n),n.sub(t);const s=new v;return i.queryCoord2DMP(1e-16,s),s.sub(t),s.crossProduct(n).sign()}return h},e.construct=function(e){if(e.isEmpty())return new Kt({vd:e.getDescription()});if(t.isMultiPath(e.getGeometryType())&&e.hasNonLinearSegments())return function(e){t.geometryReleaseAssert(e.hasNonLinearSegments()&&!e.isEmpty());const i=new ai;return i.addGeometry(e),i.getBoundingGeometry()}(e);const s=e.getImpl(),r=s.getPointCount();if(r<=2){if(1===r||s.getXY(0).equals(s.getXY(1))){const e=new i.Point({vd:s.getDescription()});return s.getPointByVal(0,e),e}{const e=new i.Point,t=new ye({vd:s.getDescription()});return s.getPointByVal(0,e),t.startPathPoint(e),s.getPointByVal(1,e),t.lineToPoint(e),t}}const o=s.getAttributeStreamRef(0),a=new ai({stream:o,n:r});let l=1;const c=o.readPoint2D(0),h=new n.Point2D;for(;l<r&&o.queryPoint2D(l<<1,h).equals(c);)l++;if(a.m_treeHull.addElement(0),l<r){a.m_treeHull.addBiggestElement(l);const e=new n.Point2D;for(let t=l+1;t<s.getPointCount();t++){o.queryPoint2D(t<<1,e);const i=a.treeHull(e);-1!==i&&a.m_treeHull.setElement(i,t)}}const u=s.getDescription(),m=u.getAttributeCount()>1,d=a.m_treeHull.size();let p=null;if(d>=2){p=d>=3?new Kt({vd:u}):new ye({vd:u});const e=p.getImpl();e.reserve(a.m_treeHull.size()),e.addPathPoint2D(null,0,!0);const t=new n.Point2D;for(let n=a.m_treeHull.getFirst();-1!==n;n=a.m_treeHull.getNext(n))if(m){const t=new i.Point;s.getPointByVal(a.m_treeHull.getElement(n),t),e.insertPoint(0,-1,t)}else o.queryPoint2D(a.m_treeHull.getElement(n)<<1,t),e.insertPoint2D(0,-1,t)}else if(m){const e=new i.Point({vd:u});s.getPointByVal(a.m_treeHull.getElement(a.m_treeHull.getFirst()),e),p=e}else{const e=o.readPoint2D(a.m_treeHull.getElement(a.m_treeHull.getFirst())<<1);p=new i.Point(e)}return p},e.constructCircularArcHelperForOldFormat=Js,e.constructOrientedMinimumBoundingBox=function(e,i,s,r,o){if(function(e,t,i){e.setNAN(),t.setCoords(1,0),i.setCoords(0,0)}(s,r,o),e.isEmpty())return;if(e.getGeometryType()===t.GeometryType.enumPoint)return void s.assign(e.getXY());const a=e,l=a.getPointCount();0!==l&&(1!==l?function(e,t,i,s,r,o){if(2===t){const t=e.getXY(0),i=e.getXY(1);s.assign(t.add(i).mul(.5));const n=i.sub(t);r=di(n),o.setCoords(.5*n.length(),0)}else{let a=Number.MAX_VALUE;const l=[0,1,0,0],c=new n.SmallMatrix(4,2);for(c.set(0,0,0),c.set(0,1,1),c.set(1,0,1),c.set(1,1,2);l[0]<t;++l[0],pi(c,0,t)){l[1]===l[0]&&(++l[1],pi(c,1,t));for(let i=1;;++i){for(;;){const n=gi(e.getXY(c.get(0,0)),e.getXY(c.get(0,1)),e.getXY(c.get(i,0)),e.getXY(c.get(i,1)),2^i);if(n>0)break;if(++l[i],pi(c,i,t),0===n)break}if(3===i)break;l[i+1]<l[i]&&(l[i+1]=l[i],c.set(i+1,0,c.get(i,0)),c.set(i+1,1,c.get(i,1)))}const h=e.getXY(c.get(0,0)).add(e.getXY(c.get(2,0))).mul(.5),u=di(e.getXY(c.get(0,1)).sub(e.getXY(c.get(0,0)))),m=new n.Point2D;let d,p;if(m.x=Math.max(0,u.dotProduct(e.getXY(c.get(1,0)).sub(e.getXY(c.get(3,0))))),m.y=Math.max(0,u.crossProduct(e.getXY(c.get(0,0)).sub(e.getXY(c.get(2,0))))),i?(d=m.x*m.y,p=d<a):(d=m.y,p=d<a),p){a=d;const t=e.getXY(c.get(1,0)),i=e.getXY(c.get(3,0)),n=t.add(i).mul(.5).sub(h);s.assign(h.add(u.mul(u.dotProduct(n)))),r.assign(u),o.assign(m)}}o.mulThis(.5),o.x<o.y&&(o.y=n.swap(o.x,o.x=o.y),r.leftPerpendicularThis())}r.y<0?r.negateThis():0===r.y&&(r.x=1)}(a,l,i,s,r,o):s.assign(a.getXY(0)))},e.convertToDegrees=gs,e.convertToRadians=ps,e.defaultRank=1,e.densify=function(e,t,i,s,r,o){return new Cs(0,0,0,null,!1,n.intMax()).densifyEx(e,t,i,s,!1,o)},e.ensureXYMonotoneSegment$1=Oi,e.forEachDir=function(e,t,i){if(e)for(let e=t.length-1;e>=0;--e)i(t[e]);else t.forEach(i)},e.generateGeometryCursor=function(e,t=-1){return new Y(e,t)},e.getPolynomialCoefs$1=yi,e.groupTransform=function(e,t,i){if(0===e.length)return;let n=0,s=0;for(++s;s!==e.length;++s)t(e[n],e[s])||(i(n,s),n=s);i(n,s)},e.hasNonEmptyBoundary=function e(i,n){if(i.isEmpty())return!1;const s=i.getGeometryType();if(s===xe.enumPolygon)return 0!==i.calculateArea2D();if(s===xe.enumPolyline)return Pe(i.getImpl(),0,!0).bNotEmpty;if(s===xe.enumEnvelope)return!0;if(t.isSegment(s))return!!i.isClosed();if(t.isPoint(s))return!1;if(s===xe.enumGeometryCollection){const t=i;for(let i=0,s=t.getGeometryCount();i<s;i++)if(e(t.getGeometry(i),n))return!0;return!1}t.throwNotImplementedException("")},e.integrateByRomberg=lt,e.intersect=Cr,e.intersectInfiniteLines=function(e,t){const i={bIntersect:!1,t1:Number.NaN,t2:Number.NaN},n=e.m_XEnd-e.m_XStart,s=e.m_YEnd-e.m_YStart,r=t.m_XEnd-t.m_XStart,o=t.m_YEnd-t.m_YStart,a=r*s-n*o;if(0===a)return i;const l=t.m_XStart-e.m_XStart,c=t.m_YStart-e.m_YStart,h=r*c-l*o,u=n*c-l*s,m=1/a;return i.t1=h*m,i.t2=u*m,i.bIntersect=!0,i},e.isEndPointModified=or,e.isExactOverlap2d=Er,e.isIdenticalType=Sr,e.isIntersecting=Pr,e.isIntersectingEx=br,e.isPathConvex=function(e,i,s){if((i<0||i>=e.getPathCount())&&t.throwInvalidArgumentException("path index"),e.hasNonLinearSegmentsPath(i))return!1;const r=e.getImpl(),o=r.getPathStart(i),a=r.getPathEnd(i),l=!r.isClosedPath(i)&&r.isClosedPathInXYPlane(i),c=r.getAttributeStreamRef(0),h=2*o;let u=2*a;if(l&&(u-=2),u-h<6)return!0;const m=c.readPoint2D(h),d=c.readPoint2D(h+2),p=c.readPoint2D(h+4);if(!hi(n.Point2D.orientationRobust(d,p,m)))return!1;const g=d.clone(),_=new n.Point2D;for(let e=h+6;e<u;e+=2){if(_.assign(d),d.assign(p),c.queryPoint2D(e,p),!hi(n.Point2D.orientationRobust(d,p,m)))return!1;if(!hi(n.Point2D.orientationRobust(g,p,m)))return!1;if(!hi(n.Point2D.orientationRobust(d,p,_)))return!1}return!0},e.minTolerance=F,e.minimumBoundingCircle=function(e,i,n){e.isEmpty()&&t.throwEmptyGeometryException(""),t.throwIfCurves(e);const s=e.getImpl(),r=[];return Ps(s.getPointCount(),r),bs((o=s,{at:e=>o.getXY(e)}),r,s.getPointCount(),i);var o},e.minimumBoundingCirclePoint2D=vs,e.nthElement=function(e,t,i,s,r){n.sortRange(e,t,s-t,((e,t)=>r(e,t)?-1:1))},e.nullHandle=ei,e.nurbs2ToArc128=function(e,t,i,n,s){return hr(e,t,i,n,s)},e.orientBottomUp=ee,e.quadraticRealRoots$2=Ee,e.replaceAllCurvesWithBeziers=function(e,i,n,s){return Number.isFinite(i)||t.throwInvalidArgumentException("replace_all_curves_with_beziers: maxDeviation"),function(e,i,n,s){t.geometryReleaseAssert(e===t.GeometryType.enumBezier||e===t.GeometryType.enumEllipticArc||e===t.GeometryType.enumBezier2);const r=i.createInstance();r.getGeometryType()===t.GeometryType.enumPolygon&&r.setFillRule(i.getFillRule());const o=i.querySegmentIterator();for(let a=0,l=i.getPathCount();a<l;++a){if(!i.hasNonLinearSegmentsPath(a)){r.addPath(i,a,!0);continue}const l=i.getPathStart(a);let c=!0,h=0;for(o.resetToPath(a),t.geometryReleaseAssert(o.nextPath());o.hasNextSegment();){const u=o.nextCurve();if(!u)break;{const m=o.getStartPointIndex()-l,d=m-h;d>0&&(r.addSegmentsFromPath(i,a,h,d,c),c=!1),h=m+1,e===t.GeometryType.enumBezier?Ts(r,u,n,s,c):e===t.GeometryType.enumBezier2?Ds(r,u,n,s,c):t.throwInternalErrorException(""),c=!1}}const u=i.getSegmentCountPath(a);u-h!==0&&r.addSegmentsFromPath(i,a,h,u-h,c)}return r}(t.GeometryType.enumBezier,e,i,n)},e.rotate=function(e,t,i,n){c(e,t,i-1),c(e,i,n-1),e.reverse()},e.shorterArcDistance=function(e,t){return ds(t-e)},e.shuffle=l,e.sizeInBuffer=ue,e.solve$1=be,e.tToParametricAngle=Us}))},"esri/chunks/Envelope":function(){define(["exports","./Point2D","./Envelope2D","./Geometry"],(function(e,t,i,n){"use strict";const s=[0,0,Number.NaN,0,0,0,0,0,-1,-1,0,0,0,0],r=[2,1,1,1,3,1,2,3,2,4,1,1,2,1],o=[1,1,1,0,2,1,1,1,0,0,0,0,0,1],a=[1,1,1,2,0,0,0,0,2,2,4,2,2,1],l=[4,8,4,8,1];function c(){return t.makePrimitiveArray(25,Number.NaN)}let h=class e{getAttributeCount(){return this.m_attributeCount}getSemantics(e){return this.m_indexToSemantics[e]}getSemanticsBitArray(){return this.m_semanticsBitArray}getAttributeIndex(e){return this.m_semanticsToIndexMap[e]}static getInterpolation(e){return o[e]}static getPersistence(e){return a[e]}static getPersistenceSize(e){return l[e]}static getPersistenceSizeFromSemantics(t){return e.getPersistenceSize(e.getPersistence(t))*e.getComponentCount(t)}static getComponentCount(e){return r[e]}static maxComponentCount(){return 4}static isInteger(e){return 2===e||3===e||4===e}static isIntegerSemantics(t){return e.isInteger(e.getPersistence(t))}static isTexture(e){return 5===e||6===e||7===e}hasAttribute(e){return!!(this.m_semanticsBitArray&1<<e)}hasAttributesFrom(e){return(this.m_semanticsBitArray&e.m_semanticsBitArray)===e.m_semanticsBitArray}hasZ(){return this.hasAttribute(1)}hasM(){return this.hasAttribute(2)}hasID(){return this.hasAttribute(3)}getTotalComponentCount(){return this.m_totalComponentCount}static getDefaultValue(e){return s[e]}static isDefaultValue(e,i){return t.isEqualNonIEEE(s[e],i)}equals(e){return this===e}getDefaultPointAttributes(){return this.m_defaultPointAttributes}getPointAttributeOffset(e){return this.m_pointAttributeOffsets[e]}constructor(i){this.m_semanticsBitArray=i,this.m_attributeCount=0,this.m_totalComponentCount=0,this.m_semanticsToIndexMap=new Int32Array(14),this.m_indexToSemantics=new Int32Array(14),this.m_pointAttributeOffsets=new Int32Array(14),this.m_defaultPointAttributes=t.makePrimitiveArray(25,Number.NaN),this.m_semanticsToIndexMap.fill(-1),this.m_indexToSemantics.fill(-1);let n=0,s=1,r=14;for(;n<r;n++)i&s&&(this.m_semanticsToIndexMap[n]=this.m_attributeCount,this.m_indexToSemantics[this.m_attributeCount]=n,this.m_attributeCount++,this.m_totalComponentCount+=e.getComponentCount(n)),s<<=1;let o=0;for(n=0,r=this.getAttributeCount();n<r;n++){const t=this.getSemantics(n),i=e.getComponentCount(t),s=e.getDefaultValue(t);this.m_pointAttributeOffsets[n]=o;for(let e=0;e<i;e++)this.m_defaultPointAttributes[o]=s,o++}}};var u=h;function m(){return t.makePrimitiveArray(14,0)}class d{static getInstance(){return d.s_thisInstance}constructor(){this.m_map=new Map,this.m_vd2D=new u(1),this.m_map.set(1,this.m_vd2D),this.m_vd3D=new u(3),this.m_map.set(3,this.m_vd2D)}GetVD2D(){return this.m_vd2D}GetVD3D(){return this.m_vd3D}FindOrAdd(e){if(1===e)return this.GetVD2D();if(3===e)return this.GetVD3D();const t=this.m_map.get(e);if(t)return t;const i=new u(e);return this.m_map.set(e,i),i}}function p(e){return d.getInstance().FindOrAdd(e)}function g(e,t){if(!e||!t)return t||e;const i=e.getSemanticsBitArray()|t.getSemanticsBitArray();return(i&e.getSemanticsBitArray())===i?e:(i&t.getSemanticsBitArray())===i?t:p(i)}function _(e,t){const i=e.getSemanticsBitArray()|1<<t;return(i&e.getSemanticsBitArray())===i?e:p(i)}function f(e,t){const i=(e.getSemanticsBitArray()|1<<t)-(1<<t);return i===e.getSemanticsBitArray()?e:p(i)}function y(){return d.getInstance().GetVD2D()}function x(){return d.getInstance().GetVD3D()}function v(e,t,i){if(i.fill(-1),null!==e&&null!==t)for(let n=0,s=e.getAttributeCount();n<s;n++)i[n]=t.getAttributeIndex(e.getSemantics(n))}d.s_thisInstance=new d;class P{static construct(e,t,i){return new P(e,t,i)}constructor(e,t,i){void 0!==e?(this.x=e,this.y=t,this.z=i):this.x=this.y=this.z=Number.NaN}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}set 0(e){this.x=e}set 1(e){this.y=e}set 2(e){this.z=e}clone(){return new P(this.x,this.y,this.z)}assign(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}setCoords(e,t,i){return this.x=e,this.y=t,this.z=i,this}setCoordsPoint2DZ(e,t){return this.setCoords(e.x,e.y,t)}setCoordsPoint3D(e){this.x=e.x,this.y=e.y,this.z=e.z}setZero(){this.x=0,this.y=0,this.z=0}setNormalized(e){this.assign(e),this.normalizeThis()}normalizeThis(){const e=this.length();return e?(this.x/=e,this.y/=e,this.z/=e):(this.x=1,this.y=0,this.z=0),this}getUnitVector(){const e=new P;return e.setNormalized(this),e}sqrLength(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthXY(){return n.geometryReleaseAssert(0),0}static sqrDistance(e,i){return t.sqr(e.x-i.x)+t.sqr(e.y-i.y)+t.sqr(e.z-i.z)}static sqrDistanceCoords(e,i,n,s,r,o){return t.sqr(e-s)+t.sqr(i-r)+t.sqr(n-o)}static distance(e,t){return Math.sqrt(P.sqrDistance(e,t))}isEqual(e,i){return void 0===i&&(i=0),Math.abs(this.x-e.x)<=i&&Math.abs(this.y-e.y)<=i&&t.isEqualNonIEEETol(this.z,e.z,i)}static compareByLength(e,t,i,s){return n.geometryReleaseAssert(0),0}isEqualCoords(e,t,i,s){return n.geometryReleaseAssert(0),this.x===e&&this.y===t&&this.z===i}isEqualsTols(e,t,i){return n.geometryReleaseAssert(0),!1}isEqualCoordsTols(e,t,i,s,r){return n.geometryReleaseAssert(0),!1}static st_isEqual(e,t,i,s){return n.geometryReleaseAssert(0),!1}equals(e,t){return this.isEqual(e,t)}equalsTols(e,t,i){return n.geometryReleaseAssert(0),!1}divThis(e){return this.x/=e,this.y/=e,this.z/=e,this}subThis(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}setSub(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}sub(e){return P.construct(this.x-e.x,this.y-e.y,this.z-e.z)}addThis(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}add(e){return this.clone().addThis(e)}setAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}mul(e){return P.construct(this.x*e,this.y*e,this.z*e)}dotProduct(e){return this.x*e.x+this.y*e.y+this.z*e.z}crossProductVector(e){const t=this.y*e.z-e.y*this.z,i=e.x*this.z-this.x*e.z,n=this.x*e.y-e.x*this.y;return new P(t,i,n)}setCrossProductVector(e,t){const i=e.y*t.z-t.y*e.z,n=t.x*e.z-e.x*t.z,s=e.x*t.y-t.x*e.y;return this.x=i,this.y=n,this.z=s,this}setScaled(e,t){return this.x=e*t.x,this.y=e*t.y,this.z=e*t.z,this}scaleThis(e){return this.x*=e,this.y*=e,this.z*=e,this}scaleZThis(e){return this.z*=e,this}setNAN(){return n.geometryReleaseAssert(0),this}isNAN(){return Number.isNaN(this.x)||Number.isNaN(this.y)||Number.isNaN(this.z)}static getNAN(){return P.construct(Number.NaN,Number.NaN,Number.NaN)}isFinite(){return n.geometryReleaseAssert(0),!1}isZero(){return 0===this.x&&0===this.y&&0===this.z}norm(e){return n.geometryReleaseAssert(0),0}sqrDistanceFromCenterToSpheroidSurface(e,t){return n.geometryReleaseAssert(0),0}distanceFromCenterToSpheroidSurface(e,t){return Math.sqrt(this.sqrDistanceFromCenterToSpheroidSurface(e,t))}static getClosestCoordinate(e,t,i,s=!1){return n.geometryReleaseAssert(0),0}compare(e){return this.y<e.y?-1:this.y>e.y?1:this.x<e.x?-1:this.x>e.x?1:this.z<e.z?-1:this.z>e.z?1:0}compareXYZ(e){return n.geometryReleaseAssert(0),0}negateThis(){this.x=-this.x,this.y=-this.y,this.z=-this.z}static averageFast(e,t){return n.geometryReleaseAssert(0),{}}static average(e,t){return n.geometryReleaseAssert(0),{}}static size(){return P.dimensions}static lerp(e,i,n){const s=new P;return t.lerpPoint3D(e,i,n,s),s}static slerp(e,t,i){return n.geometryReleaseAssert(0),{}}static compareVectors(e,t){return n.geometryReleaseAssert(0),0}static selectRightHandedBasisFromNormal(e,t,i){const n=e.getUnitVector(),s=n.createAPerpendicular(),r=new P;r.setCrossProductVector(n,s),r.normalizeThis(),t.setCoordsPoint3D(s),i.setCoordsPoint3D(r)}createAPerpendicular(){const e=[this.crossProductVector(new P(0,0,1)),this.crossProductVector(new P(1,0,0)),this.crossProductVector(new P(0,1,0))],t=[e[0].sqrLength(),e[1].sqrLength(),e[2].sqrLength()],i=e[t.reduce(((e,i,n)=>t[e]>t[n]?e:n),0)];return i.normalizeThis(),i}calculateAngle(e){return n.geometryReleaseAssert(0),0}static crossDotSign(e,t,i){return n.geometryReleaseAssert(0),0}static isBisectorRobust(e,t,i){return n.geometryReleaseAssert(0),0}static compareZOrder(e,t){return n.geometryReleaseAssert(0),!1}}P.dimensions=3;class b{static constructEmpty(){return new b(Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN)}constructor(e,t,i,n,s,r){this.m_EnvelopeType=3,this.xmin=e,this.ymin=t,this.zmin=i,this.xmax=n,this.ymax=s,this.zmax=r,this.normalize()}inflate(e){this.inflateCoords(e,e,e)}inflateCoords(e,t,i){n.geometryReleaseAssert(0)}getEnvelope2D(){return new i.Envelope2D(this.xmin,this.ymin,this.xmax,this.ymax)}getEnvelopeZs(){return new t.Envelope1D(this.zmin,this.zmax)}setEmptyZ(){this.zmin=Number.NaN,this.zmax=Number.NaN}normalize(){let e=!1;this.xmin<=this.xmax||(this.xmax=t.swap(this.xmin,this.xmin=this.xmax),e=!0),this.ymin<=this.ymax||(this.ymax=t.swap(this.ymin,this.ymin=this.ymax),e=!0),!e||this.xmin<=this.xmax&&this.ymin<=this.ymax?this.zmin<=this.zmax||(this.zmax=t.swap(this.zmin,this.zmin=this.zmax),this.zmin<=this.zmax||this.setEmptyZ()):this.setEmpty()}isEmpty(){return Number.isNaN(this.xmin)||Number.isNaN(this.ymin)||Number.isNaN(this.xmax)||Number.isNaN(this.ymax)}isEmptyZ(){return Number.isNaN(this.zmin)||Number.isNaN(this.zmax)}setEmpty(){this.xmin=Number.NaN,this.ymin=Number.NaN,this.zmin=Number.NaN,this.xmax=Number.NaN,this.ymax=Number.NaN,this.zmax=Number.NaN}mergeEnv3D(e){e.isEmpty()||(this.mergeCoords(e.xmin,e.ymin,e.zmin),this.mergeCoords(e.xmax,e.ymax,e.zmax))}mergeNe(e){this.mergeNeCoords(e.x,e.y,e.z)}mergeNeCoords(e,t,i){this.xmin>e?this.xmin=e:this.xmax<e&&(this.xmax=e),this.ymin>t?this.ymin=t:this.ymax<t&&(this.ymax=t),this.zmin>i?this.zmin=i:this.zmax<i&&(this.zmax=i)}mergeCoords(e,t,i){this.isEmpty()?(this.xmin=e,this.xmax=e,this.ymin=t,this.ymax=t,this.zmin=i,this.zmax=i):(this.isEmptyZ()&&(this.zmin=i,this.zmax=i),this.mergeNeCoords(e,t,i))}setCoords(e,t,i,n,s,r){this.xmin=e,this.ymin=t,this.zmin=i,this.xmax=n,this.ymax=s,this.zmax=r,this.normalize()}sqrDistanceEnvelope3DAndPoints(e,t,i,s=1){return n.geometryReleaseAssert(0),0}sqrMaxDistance(e,t=1){return n.geometryReleaseAssert(0),0}}var E=h;function S(e,t,i){switch(e){case 0:return new D(t,i);case 1:return new I(t,i);case 2:return new T(t,i);case 3:throw new Error("64 bit int attribute stream not implemented");case 4:return new w(t,i);default:n.throwInvalidArgumentException("")}}class C{size(){return this.m_size}checkResize(e,t){e>this.m_size&&this.resize(e,t)}resize(e,t){if((e=Math.trunc(e))===this.m_size)return;const i=!!t||Number.isNaN(t);if(e<this.m_a.length)this.m_a.length>C.s_resizeMin&&1.25*e<this.m_a.length&&(this.m_a=this.m_a.slice(0,e)),i&&e>this.m_size&&this.m_a.fill(t,this.m_size,e);else if(e>=this.m_a.length){const n=1.25*e,s=new this.m_a.constructor(n);s.set(this.m_a),this.m_a=s,i&&this.m_a.fill(t,this.m_size,e)}this.m_size=e}resizeRounded(e,t){return this.resize(e,t)}reserve(e){}read(e){return this.m_a[e]}readAsDbl(e){return this.read(e)}write(e,t){this.m_a[e]=t}writeAsDbl(e,t){this.write(e,t)}setRange(e,t,i){(t<0||i<0||i+t>this.size())&&n.throwInvalidArgumentException(),this.m_a.fill(e,t,t+i)}add(e){this.resize(this.m_size+1),this.m_a[this.m_size-1]=e}addArray(e,t){const i=this.m_size;void 0===t?(this.resize(this.m_size+e.length),this.m_a.set(e,i)):(this.resize(this.m_size+t),this.m_a.set(e.slice(0,t),i))}equals(e,i,n,s){return this.getPersistence()===e.getPersistence()&&function(e,i,n,s,r){if(e.getPersistence()!==i.getPersistence())return!1;const o=e.getPersistence()<=1,a=e.size(),l=i.size();if(s>a||s>l)return!1;if(r)if(o){for(let o=n;o<s;o++)if(!t.isEqualNonIEEETol(e.read(o),i.read(o),r))return!1}else for(let t=n;t<s;t++){let n=e.read(t)-i.read(t);if(n<0&&(n=-n),n>r)return!1}else for(let t=n;t<s;t++){const n=e.read(t),s=i.read(t);if(n!==s){if(o&&Number.isNaN(n)&&Number.isNaN(s))continue;return!1}}return!0}(this,e,i,n,s)}insertRange(e,t,i,n){const s=this.m_size;this.checkResize(Math.max(0,n)+i),this.m_a.copyWithin(e+i,e,n>=0?n:s),this.m_a.fill(t,e,e+i)}readRange(e,t){return this.m_a.slice(e,e+t)}insertRangeFromStream(e,t,i,s,r,o,a){n.geometryReleaseAssert(this.getPersistence()===t.getPersistence());const l=t,c=this.m_size;s&&this.checkResize(Math.max(0,a)+s),this.m_a.copyWithin(e+s,e,a>=0?a:c),this.m_a.set(l.readRange(i,s),e),r||this.reverseRange(e,s,o)}writeRange(e,t,i,s,r,o){n.geometryReleaseAssert(this.getPersistence()===i.getPersistence());const a=i;if((e<0||t<0||s<0)&&n.throwInvalidArgumentException(),a.size()<s+t&&n.throwInvalidArgumentException(),0===t)return;this.size()<t+e&&this.resize(t+e);const l=a.m_a.subarray(s,s+t);!function(e,t,i,s){if((t<0||i<0)&&n.throwInvalidArgumentException(),0===i)return;if(1===i)return void(e[t]=s[0]);let r=s;i<s.length&&(r=s.subarray(0,i)),e.set(r,t)}(this.m_a,e,t,l)}insertAttributes(e,t,i,n){const s=E.getComponentCount(i);this.m_a.copyWithin(e+s,e,n>=0?n:this.m_size);for(let n=0;n<s;n++)this.m_a[e+n]=t.getAttributeAsDbl(i,n)}insertAttributesFromPoints(e,i,s,r,o){n.geometryReleaseAssert(E.getPersistence(r)===this.getPersistence());const a=E.getComponentCount(r),l=this.m_size;if(this.checkResize(Math.max(0,o)+a*s),this.m_a.copyWithin(e+a*s,e,o>=0?o:l),0===r){const n=new t.Point2D;for(let t=e,r=0;r<s;r++,t+=2)i[r].queryXY(n),this.m_a[t]=n.x,this.m_a[t+1]=n.y}else if(1===a)for(let t=e,n=0;n<s;n++,t++)this.m_a[t]=i[n].getAttributeAsDbl(r,0);else for(let t=e,n=0;n<s;n++,t+=a)for(let e=0;e<a;e++)this.m_a[t+e]=i[n].getAttributeAsDbl(r,e)}eraseRange(e,t,i){this.m_size<e+t&&n.throwInvalidArgumentException(),this.m_a.copyWithin(e,e+t),this.m_size-=t}reverseRange(e,t,i){if((i<1||t%i!==0)&&n.throwInvalidArgumentException(),this.m_a.subarray(e,e+t).reverse(),i>1)for(let n=e,s=e+t;n<s;n+=i){let e=n,t=n+i-1;for(;e<t;){const i=this.m_a[e];this.m_a[e]=this.m_a[t],this.m_a[t]=i,e++,t--}}}rotate(e,t,i){(t<e||t>i||e>i)&&n.throwOutOfRangeException("rotate"),t!==e&&t!==i&&(this.reverseRange(e,t-e,1),this.reverseRange(t,i-t,1),this.reverseRange(e,i-e,1))}sort(e,t,i){this.m_a.subarray(e,t).sort(i)}constructor(e){if(e.move)this.m_a=e.move.m_a,this.m_size=e.move.m_size,e.move.m_a=e.move.m_a.slice(0,0),e.move.m_size=0;else if(e.copy)this.m_size=e.copy.m_size,e.maxSize&&(this.m_size=Math.min(e.maxSize,this.m_size)),this.m_a=e.copy.m_a.slice(0,this.m_size);else{const t=Math.max(e.size,C.s_constructMin);this.m_a=new e.ctor(t),(e.defaultValue||Number.isNaN(e.defaultValue))&&this.m_a.fill(e.defaultValue),this.m_size=e.size}}}C.s_constructMin=2,C.s_resizeMin=30;class w extends C{setBits(e,t){this.m_a[e]|=t}clearBits(e,t){this.m_a[e]&=~t}getPersistence(){return 4}clone(){return new w({ctor:Int8Array,copy:this})}restrictedClone(e){return new w({ctor:Int8Array,copy:this,maxSize:e})}constructor(e,t){super("number"==typeof e?{ctor:Int8Array,size:e,defaultValue:t}:e)}}class T extends C{getPersistence(){return 2}clone(){return new T({ctor:Int32Array,copy:this})}restrictedClone(e){return new T({ctor:Int32Array,copy:this,maxSize:e})}write(e,i){n.geometryReleaseAssert(i<=t.intMax()),super.write(e,i)}constructor(e,t){super("number"==typeof e?{ctor:Int32Array,size:e,defaultValue:t}:e)}}class D extends C{getPersistence(){return 0}clone(){return new D({ctor:Float32Array,copy:this})}restrictedClone(e){return new D({ctor:Float32Array,copy:this,maxSize:e})}constructor(e,t){super("number"==typeof e?{ctor:Float32Array,size:e,defaultValue:t}:e)}}class I extends C{getPersistence(){return 1}getArray(){return this.m_a}applyTransformation(e,t,i){(1&t||t+2*i>this.size())&&n.throwInvalidArgumentException();const s=0===t?this.m_a:this.m_a.subarray(t);e.transformInterleavedPoints(s,i,s)}readPoint2D(e){const i=this.m_a[e],n=this.m_a[e+1];return new t.Point2D(i,n)}queryPoint2D(e,t){return t.x=this.m_a[e],t.y=this.m_a[e+1],t}writePoint2D(e,t){this.write(e,t.x),this.write(e+1,t.y)}insert(e,t,i){this.checkResize(i+2),this.m_a.copyWithin(e+2,e,i),this.m_a[e]=t.x,this.m_a[e+1]=t.y}insertRangeFromPoints(e,t,i,n,s,r){const o=this.m_size;if(this.checkResize(Math.max(r,0)+2*n),this.m_a.copyWithin(e+2*n,e,r>=0?r:o),s)for(let s=i,r=e,o=0;o<n;++o,++s){const e=t[s];this.m_a[r++]=e.x,this.m_a[r++]=e.y}else for(let s=i+n-1,r=e,o=0;o<n;++o,--s){const e=t[s];this.m_a[r++]=e.x,this.m_a[r++]=e.y}}queryRange(e,t,i,s,r){if((e<0||t<0)&&n.throwInvalidArgumentException(),!s&&(r<=0||t%r!==0)&&n.throwInvalidArgumentException(),0===t)return;if(1===t)return void(i[0]=this.m_a[e]);const o=this.m_a.subarray(e,e+t);i.set(o)}writeRangeFromArray(e,t,i,s,r){if((e<0||t<0)&&n.throwInvalidArgumentException(),0===t)return;if(1===t)return void(this.m_a[e]=i[0]);let o=i;t<i.length&&(o=i.subarray(0,t)),this.m_a.set(o,e)}clone(){return new I({ctor:Float64Array,copy:this})}restrictedClone(e){return new I({ctor:Float64Array,copy:this,maxSize:e})}constructor(e,t){super("number"==typeof e?{ctor:Float64Array,size:e,defaultValue:t}:e)}}class A{constructor(){this.m_minValue=-1,this.m_maxValue=-1,this.m_dy=Number.NaN,this.m_buckets=new T(0),this.m_bucketedIndices=new T(0)}static sortEx(e,t,i,n,s=32){i-t<=s?n.userSort(t,i,e):(new A).sort(e,t,i,n,s)}sort(e,t,i,n,s=32){if(i-t<=s)return void n.userSort(t,i,e);let r=!0,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let s=t;s<i;s++){const t=n.getValue(e.read(s));t<o&&(o=t),t>a&&(a=t)}if(this.reset(i-t,o,a,i-t)){for(let s=t;s<i;s++){const i=e.read(s),r=n.getValue(i),o=this.getBucket(r);this.m_buckets.write(o,this.m_buckets.read(o)+1),this.m_bucketedIndices.write(s-t,i)}let s=this.m_buckets.read(0);this.m_buckets.write(0,0);for(let e=1,t=this.m_buckets.size();e<t;e++){const t=this.m_buckets.read(e);this.m_buckets.write(e,s),s+=t}for(let s=t;s<i;s++){const i=this.m_bucketedIndices.read(s-t),r=n.getValue(i),o=this.getBucket(r),a=this.m_buckets.read(o);e.write(a+t,i),this.m_buckets.write(o,a+1)}r=!1}if(r)return void n.userSort(t,i,e);let l=0;for(let i=0,s=this.m_buckets.size();i<s;i++){const s=l;l=this.m_buckets.read(i),l>s&&n.userSort(t+s,t+l,e)}this.m_buckets.size()>100&&(this.m_buckets.resize(0),this.m_bucketedIndices.resize(0))}reset(e,t,i,n){if(e<2||i===t)return!1;const s=Math.min(A.c_maxBuckets,e);return this.m_buckets.resize(s),this.m_buckets.setRange(0,0,this.m_buckets.size()),this.m_minValue=t,this.m_maxValue=i,this.m_bucketedIndices.resize(n),this.m_dy=(i-t)/(s-1),!0}getBucket(e){return Math.trunc((e-this.m_minValue)/this.m_dy)}getBucketCount(){return this.m_buckets.size()}}A.c_maxBuckets=65536;class M{capacity(){return this.capacity_}constructor(e){this.m_buffer=new Int32Array(0),this.m_firstFree=-1,this.m_last=0,this.size_=0,this.capacity_=0,this.stride=e}size(){return this.size_}deleteElement(e){e<this.m_last?(this.m_buffer[e*this.stride]=this.m_firstFree,this.m_firstFree=e):this.m_last--,this.size_--}getField(e,t){return this.m_buffer[e*this.stride+t]}setField(e,t,i){this.m_buffer[e*this.stride+t]=i}elementToIndex(e){return e}newElement(){let e=this.m_firstFree;if(-1===e){if(this.m_last===this.capacity_){let e=0!==this.capacity_?Math.trunc(3*(this.capacity_+1)/2):1;if(e>Number.MAX_SAFE_INTEGER&&(e=Number.MAX_SAFE_INTEGER),e===this.capacity_)throw new Error("index out of bounds");this.grow_(e)}e=this.m_last,this.m_last++}else this.m_firstFree=this.m_buffer[e*this.stride];this.size_++;for(let t=e*this.stride;t<e*this.stride+this.stride;t++)this.m_buffer[t]=-1;return e}newElementPset(e){let t=this.m_firstFree;if(-1===t){if(this.m_last===this.capacity_){let e=0!==this.capacity_?Math.trunc(3*(this.capacity_+1)/2):1;if(e>Number.MAX_SAFE_INTEGER&&(e=Number.MAX_SAFE_INTEGER),e===this.capacity_)throw new Error("index out of bounds");this.grow_(e)}t=this.m_last,this.m_last++}else this.m_firstFree=this.m_buffer[t*this.stride];this.size_++;const i=t*this.stride;for(let t=0;t<e.length;t++)this.m_buffer[i+t]=e[t];return t}deleteAll(e){this.m_firstFree=-1,this.m_last=0,this.size_=0,e&&(this.m_buffer=new Int32Array(0),this.capacity_=0)}setCapacity(e){e>this.capacity_&&this.grow_(e)}swap(e,t){const i=e*this.stride,n=t*this.stride;for(let e=0;e<this.stride;e++){const t=this.m_buffer[n+e];this.m_buffer[n+e]=this.m_buffer[i+e],this.m_buffer[i+e]=t}}swapField(e,t,i){const n=this.m_buffer[this.stride*t+i];this.m_buffer[this.stride*t+i]=this.m_buffer[this.stride*e+i],this.m_buffer[this.stride*e+i]=n}static impossibleIndex2(){return-2}static impossibleIndex3(){return-3}static isValidElement(e){return e>=0}grow_(e){null==this.m_buffer&&(this.m_buffer=new Int32Array(0));const t=this.stride*e,i=new Int32Array(t);i.set(this.m_buffer,0),this.m_buffer=i,this.capacity_=e}}class N{constructor(e,t,n){this.m_extent=new i.Envelope2D,this.m_dataExtent=new i.Envelope2D,this.m_childExtents=[new i.Envelope2D,new i.Envelope2D,new i.Envelope2D,new i.Envelope2D],this.m_elementNodes=new M(4),this.m_data=[],this.m_freeData=[],this.m_root=-1,this.m_height=8,void 0===n&&(n=!1),this.m_quadTreeNodes=new M(n?11:10),this.m_bStoreDuplicates=n,this.reset_(e,t)}reset(e,t){this.m_quadTreeNodes.deleteAll(!1),this.m_elementNodes.deleteAll(!1),this.m_data.length=0,this.m_freeData.length=0,this.reset_(e,t)}insert(e,t){if(-1===this.m_root&&this.createRoot_(),this.m_bStoreDuplicates){const i=this.insertDuplicates_(e,t,0,this.m_extent,this.m_root,!1,-1);return-1!==i&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),i}const i=this.insert_(e,t,0,this.m_extent,this.m_root,!1,-1);return-1!==i&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),i}insertEx(e,t,i){if(-1===this.m_root&&this.createRoot_(),this.m_bStoreDuplicates){const i=this.insertDuplicates_(e,t,0,this.m_extent,this.m_root,!1,-1);return-1!==i&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),i}let n;n=-1===i?this.m_root:this.getQuad_(i);const s=this.getHeight(n),r=this.getExtent(n),o=this.insert_(e,t,s,r,n,!1,-1);return-1!==o&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),o}removeElement(e){n.geometryReleaseAssert(0)}getElement(e){return this.getElementValue_(this.getData_(e))}getElementAtIndex(e){return n.geometryReleaseAssert(0),0}getElementExtent(e){const t=this.getData_(e);return this.getBoundingBoxValue_(t).clone()}getElementExtentAtIndex(e){return n.geometryReleaseAssert(0),{}}getDataExtent(){return this.m_dataExtent.clone()}getQuadTreeExtent(){return n.geometryReleaseAssert(0),{}}getHeight(e){return this.m_quadTreeNodes.getField(e,6)>>N.m_heightBitShift}getMaxHeight(){return this.m_height}getExtent(e){const t=new i.Envelope2D;if(t.setCoords({env2D:this.m_extent}),e===this.m_root)return t;const n=[];let s=e;do{n.push(this.getQuadrant_(s)),s=this.getParent_(s)}while(s!==this.m_root);const r=n.length;for(let e=0;e<r;e++){const e=n.at(-1);n.pop(),0===e?(t.xmin=.5*(t.xmin+t.xmax),t.ymin=.5*(t.ymin+t.ymax)):1===e?(t.xmax=.5*(t.xmin+t.xmax),t.ymin=.5*(t.ymin+t.ymax)):2===e?(t.xmax=.5*(t.xmin+t.xmax),t.ymax=.5*(t.ymin+t.ymax)):(t.xmin=.5*(t.xmin+t.xmax),t.ymax=.5*(t.ymin+t.ymax))}return t}getQuad(e){return this.getQuad_(e)}getElementCount(){return-1===this.m_root?0:this.getSubTreeElementCount_(this.m_root)}getSubTreeElementCount(e){return this.getSubTreeElementCount_(e)}getContainedSubTreeElementCount(e){return this.m_bStoreDuplicates?this.getContainedSubTreeElementCount_(e):this.getSubTreeElementCount_(e)}getIntersectionCount(e,n,s){if(-1===this.m_root)return 0;const r=new i.Envelope2D;r.setCoords({env2D:e}),r.inflateCoords(n,n);const o=[],a=[];o.push(this.m_root),a.push(this.m_extent.clone());const l=t.makeObjectArray(i.Envelope2D,4);let c=0;for(;o.length>0;){let e=!1;const t=o.at(-1),i=a.at(-1);if(o.pop(),a.pop(),r.containsEnvelope(i)){if(c+=this.getSubTreeElementCount(t),s>0&&c>=s)return s}else if(r.isIntersecting(i)){for(let e=this.getFirstElement_(t);-1!==e;e=this.getNextElement_(e)){const t=this.getData_(e);if(this.getBoundingBoxValue_(t).isIntersecting(r)&&(c++,s>0&&c>=s))return s}e=this.getHeight(t)+1<=this.m_height}if(e){N.setChildExtents_(i,l);for(let e=0;e<4;e++){const i=this.getChild_(t,e);-1!==i&&this.getSubTreeElementCount_(i)>0&&r.isIntersecting(l[e])&&(o.push(i),a.push(l[e].clone()))}}}return c}hasData(e,t){return this.getIntersectionCount(e,t,1)>=1}getIterator(e,t){return new R(this,e,t)}getIteratorForQT(){return new R(this)}getSortedIterator(e,t){return new O(this.getIterator(e,t))}getSortedIteratorForQT(){return new O(this.getIteratorForQT())}visitLeavesNearest(e,t,i,s){n.geometryReleaseAssert(0)}reset_(e,t){(t<0||t>127)&&n.throwInvalidArgumentException("invalid height"),this.m_height=t,this.m_extent.setCoords({env2D:e}),this.m_dataExtent.setEmpty(),this.m_root=-1}insert_(e,t,n,s,r,o,a){if(!s.containsEnvelope(t))return 0===n?-1:this.insert_(e,t,0,this.m_extent,this.m_root,o,a);if(!o)for(let e=r;-1!==e;e=this.getParent_(e))this.setSubTreeElementCount_(e,this.getSubTreeElementCount_(e)+1);const l=new i.Envelope2D;l.setCoords({env2D:s});let c,h=r;for(c=n;c<this.m_height&&this.canPushDown_(h);c++){N.setChildExtents_(l,this.m_childExtents);let e=!1;for(let i=0;i<4;i++)if(this.m_childExtents[i].containsEnvelope(t)){e=!0;let t=this.getChild_(h,i);-1===t&&(t=this.createChild_(h,i)),this.setSubTreeElementCount_(t,this.getSubTreeElementCount_(t)+1),h=t,l.setCoords({env2D:this.m_childExtents[i]});break}if(!e)break}return this.insertAtQuad_(e,t,c,l,h,o,r,a,-1)}insertDuplicates_(e,n,s,r,o,a,l){if(!a){if(!r.containsEnvelope(n))return-1;this.setSubTreeElementCount_(o,this.getSubTreeElementCount_(o)+1),this.setContainedSubTreeElementCount_(o,this.getContainedSubTreeElementCount_(o)+1)}const c=Math.max(n.width(),n.height());let h=-1;const u=[],m=[],d=[];u.push(o),m.push(r.clone()),d.push(s);const p=t.makeObjectArray(i.Envelope2D,4);for(;u.length>0;){let t=!1;const i=u.at(-1),s=m.at(-1),r=d.at(-1);if(u.pop(),m.pop(),d.pop(),r+1<this.m_height&&this.canPushDown_(i)&&c<=Math.max(s.width(),s.height())/2&&(t=!0),t){N.setChildExtents_(s,p);let e=!1;for(let t=0;t<4;t++)if(e=p[t].containsEnvelope(n),e){let e=this.getChild_(i,t);-1===e&&(e=this.createChild_(i,t)),u.push(e),m.push(p[t].clone()),d.push(r+1),this.setSubTreeElementCount_(e,this.getSubTreeElementCount_(e)+1),this.setContainedSubTreeElementCount_(e,this.getContainedSubTreeElementCount_(e)+1);break}if(!e)for(let e=0;e<4;e++)if(p[e].isIntersecting(n)){let t=this.getChild_(i,e);-1===t&&(t=this.createChild_(i,e)),u.push(t),m.push(p[e].clone()),d.push(r+1),this.setSubTreeElementCount_(t,this.getSubTreeElementCount_(t)+1)}}else h=this.insertAtQuad_(e,n,r,s,i,a,o,l,h),a=!1}return 0}insertAtQuad_(e,t,i,n,s,r,o,a,l){this.getFirstElement_(s);const c=this.getLastElement_(s);let h=-1;if(r){if(s===o)return a;this.disconnectElementHandle_(a),h=a}else-1===l?(h=this.createElement_(),this.setDataValues_(this.getData_(h),e,t)):h=this.createElementFromDuplicate_(l);return this.setQuad_(h,s),-1!==c?(this.setPrevElement_(h,c),this.setNextElement_(c,h)):this.setFirstElement_(s,h),this.setLastElement_(s,h),this.setLocalElementCount_(s,this.getLocalElementCount_(s)+1),this.canFlush_(s)&&this.flush_(i,n,s),h}static setChildExtents_(e,t){const i=.5*(e.xmin+e.xmax),n=.5*(e.ymin+e.ymax);t[0].setCoords({xmin:i,ymin:n,xmax:e.xmax,ymax:e.ymax}),t[1].setCoords({xmin:e.xmin,ymin:n,xmax:i,ymax:e.ymax}),t[2].setCoords({xmin:e.xmin,ymin:e.ymin,xmax:i,ymax:n}),t[3].setCoords({xmin:i,ymin:e.ymin,xmax:e.xmax,ymax:n})}disconnectElementHandle_(e){const t=this.getQuad_(e),i=this.getFirstElement_(t),n=this.getLastElement_(t),s=this.getPrevElement_(e),r=this.getNextElement_(e);i===e?(-1!==r?this.setPrevElement_(r,-1):this.setLastElement_(t,-1),this.setFirstElement_(t,r)):n===e?(this.setNextElement_(s,-1),this.setLastElement_(t,s)):(this.setPrevElement_(r,s),this.setNextElement_(s,r)),this.setPrevElement_(e,-1),this.setNextElement_(e,-1),this.setLocalElementCount_(t,this.getLocalElementCount_(t)-1)}canFlush_(e){return this.getLocalElementCount_(e)===N.m_flushingCount&&!this.hasChildren_(e)}flush_(e,t,n){let s;const r=new i.Envelope2D;let o=this.getFirstElement_(n),a=-1,l=-1;do{l=this.getData_(o),s=this.getElementValue_(l),r.setCoords({env2D:this.getBoundingBoxValue_(l)}),a=this.getNextElement_(o),this.m_bStoreDuplicates?this.insertDuplicates_(s,r,e,t,n,!0,o):this.insert_(s,r,e,t,n,!0,o),o=a}while(-1!==o)}canPushDown_(e){return this.getLocalElementCount_(e)>=N.m_flushingCount||this.hasChildren_(e)}hasChildren_(e){return-1!==this.getChild_(e,0)||-1!==this.getChild_(e,1)||-1!==this.getChild_(e,2)||-1!==this.getChild_(e,3)}createChild_(e,t){const i=this.m_quadTreeNodes.newElement();return this.setChild_(e,t,i),this.setSubTreeElementCount_(i,0),this.setLocalElementCount_(i,0),this.setParent_(i,e),this.setHeightAndQuadrant_(i,this.getHeight_(e)+1,t),this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(i,0),i}createRoot_(){this.m_root=this.m_quadTreeNodes.newElement(),this.setSubTreeElementCount_(this.m_root,0),this.setLocalElementCount_(this.m_root,0),this.setHeightAndQuadrant_(this.m_root,0,0),this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(this.m_root,0)}createElement_(){const e=this.m_elementNodes.newElement();let t;return this.m_freeData.length>0?(t=this.m_freeData.at(-1),this.m_freeData.pop()):(t=this.m_data.length,this.m_data.length=t+1),this.setData_(e,t),e}createElementFromDuplicate_(e){const t=this.m_elementNodes.newElement(),i=this.getData_(e);return this.setData_(t,i),t}freeElementAndBoxNode_(e){n.geometryReleaseAssert(0)}getChild_(e,t){return this.m_quadTreeNodes.getField(e,t)}setChild_(e,t,i){this.m_quadTreeNodes.setField(e,t,i)}getFirstElement_(e){return this.m_quadTreeNodes.getField(e,4)}setFirstElement_(e,t){this.m_quadTreeNodes.setField(e,4,t)}getLastElement_(e){return this.m_quadTreeNodes.getField(e,5)}setLastElement_(e,t){this.m_quadTreeNodes.setField(e,5,t)}getQuadrant_(e){return this.m_quadTreeNodes.getField(e,6)&N.m_quadrantMask}getHeight_(e){return this.m_quadTreeNodes.getField(e,6)>>N.m_heightBitShift}setHeightAndQuadrant_(e,t,i){const n=t<<N.m_heightBitShift|i;this.m_quadTreeNodes.setField(e,6,n)}getLocalElementCount_(e){return this.m_quadTreeNodes.getField(e,7)}setLocalElementCount_(e,t){this.m_quadTreeNodes.setField(e,7,t)}getSubTreeElementCount_(e){return this.m_quadTreeNodes.getField(e,8)}setSubTreeElementCount_(e,t){this.m_quadTreeNodes.setField(e,8,t)}getParent_(e){return this.m_quadTreeNodes.getField(e,9)}setParent_(e,t){this.m_quadTreeNodes.setField(e,9,t)}getContainedSubTreeElementCount_(e){return this.m_quadTreeNodes.getField(e,10)}setContainedSubTreeElementCount_(e,t){this.m_quadTreeNodes.setField(e,10,t)}getData_(e){return this.m_elementNodes.getField(e,0)}setData_(e,t){this.m_elementNodes.setField(e,0,t)}getPrevElement_(e){return this.m_elementNodes.getField(e,1)}getNextElement_(e){return this.m_elementNodes.getField(e,2)}setPrevElement_(e,t){this.m_elementNodes.setField(e,1,t)}setNextElement_(e,t){this.m_elementNodes.setField(e,2,t)}getQuad_(e){return this.m_elementNodes.getField(e,3)}setQuad_(e,t){this.m_elementNodes.setField(e,3,t)}getElementValue_(e){return this.m_data[e].element}getBoundingBoxValue_(e){return this.m_data[e].box}setDataValues_(e,t,i){this.m_data[e]=function(e,t){return{element:e,box:t.clone()}}(t,i)}}N.m_quadrantMask=3,N.m_heightBitShift=2,N.m_flushingCount=5;class R{constructor(e,n,s){this.m_bLinear=!1,this.m_queryStart=new t.Point2D,this.m_queryEnd=new t.Point2D,this.m_queryBox=new i.Envelope2D,this.m_tolerance=0,this.m_currentElementHandle=-1,this.m_nextElementHandle=-1,this.m_quadsStack=[],this.m_extentsStack=[],this.m_childExtents=[new i.Envelope2D,new i.Envelope2D,new i.Envelope2D,new i.Envelope2D],this.m_quadTree=e,n&&this.resetIterator(n,s)}resetIterator(e,t){if(void 0===t&&(t=0),e instanceof i.Envelope2D)return this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,this.m_queryBox.setCoords({env2D:e}),this.m_queryBox.inflateCoords(t,t),this.m_tolerance=Number.NaN,void(-1!==this.m_quadTree.m_root&&this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)?(this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root),this.m_bLinear=!1):this.m_nextElementHandle=-1);if(this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,e.queryLooseEnvelope(this.m_queryBox),this.m_queryBox.inflateCoords(t,t),-1!==this.m_quadTree.m_root&&this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)){const i=e.getGeometryType();if(this.m_bLinear=i===n.GeometryType.enumLine,this.m_bLinear){const i=e;this.m_queryStart.assign(i.getStartXY()),this.m_queryEnd.assign(i.getEndXY()),this.m_tolerance=t}else this.m_tolerance=Number.NaN;this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root)}else this.m_nextElementHandle=-1}next(){if(0===this.m_quadsStack.length)return-1;this.m_currentElementHandle=this.m_nextElementHandle;const e=new t.Point2D,n=new t.Point2D,s=new i.Envelope2D;let r=!1;for(;!r;){for(;-1!==this.m_currentElementHandle;){const t=this.m_quadTree.getData_(this.m_currentElementHandle);if(s.setCoords({env2D:this.m_quadTree.getBoundingBoxValue_(t)}),s.isIntersecting(this.m_queryBox)){if(!this.m_bLinear){r=!0;break}if(e.setCoordsPoint2D(this.m_queryStart),n.setCoordsPoint2D(this.m_queryEnd),s.inflateCoords(this.m_tolerance,this.m_tolerance),s.clipLine(e,n)>0){r=!0;break}}this.m_currentElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle)}if(-1===this.m_currentElementHandle){const t=this.m_quadsStack.at(-1),s=this.m_extentsStack.at(-1);N.setChildExtents_(s,this.m_childExtents),this.m_quadsStack.pop(),this.m_extentsStack.pop();for(let s=0;s<4;s++){const r=this.m_quadTree.getChild_(t,s);if(-1!==r&&this.m_quadTree.getSubTreeElementCount(r)>0&&this.m_childExtents[s].isIntersecting(this.m_queryBox))if(this.m_bLinear){e.setCoordsPoint2D(this.m_queryStart),n.setCoordsPoint2D(this.m_queryEnd);const t=new i.Envelope2D;t.setCoords({env2D:this.m_childExtents[s]}),t.inflateCoords(this.m_tolerance,this.m_tolerance),t.clipLine(e,n)>0&&(this.m_quadsStack.push(r),this.m_extentsStack.push(this.m_childExtents[s].clone()))}else this.m_quadsStack.push(r),this.m_extentsStack.push(this.m_childExtents[s].clone())}if(0===this.m_quadsStack.length)return-1;this.m_currentElementHandle=this.m_quadTree.getFirstElement_(this.m_quadsStack.at(-1))}}return this.m_nextElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle),this.m_currentElementHandle}clone(){return n.geometryReleaseAssert(0),{}}}class O{constructor(e){this.m_bucketSort=new A,this.m_sortedHandles=new T(0),this.m_index=-1,this.m_quadTreeIteratorImpl=e}resetIterator(e,t){this.m_quadTreeIteratorImpl.resetIterator(e,t),this.m_sortedHandles.resize(0),this.m_index=-1}next(){if(-1===this.m_index){let e=-1;for(;-1!==(e=this.m_quadTreeIteratorImpl.next());)this.m_sortedHandles.add(e);const t=this,i={userSort(e,i,n){n.sort(e,i,((e,i)=>t.m_quadTreeIteratorImpl.m_quadTree.getElement(e)-t.m_quadTreeIteratorImpl.m_quadTree.getElement(i)))},getValue:e=>t.m_quadTreeIteratorImpl.m_quadTree.getElement(e)};this.m_bucketSort.sort(this.m_sortedHandles,0,this.m_sortedHandles.size(),i)}return this.m_index===this.m_sortedHandles.size()-1?-1:(this.m_index++,this.m_sortedHandles.read(this.m_index))}clone(){return n.geometryReleaseAssert(0),{}}}class G{constructor(e=!1){this.m_bNotifyOnActions=e}onDelete(e){}onSet(e){}onEndSearch(e){}onAddUniqueElementFailed(e){}onDeleteImpl(e,t){this.m_bNotifyOnActions&&this.onDelete(e.getElement(t))}onSetImpl(e,t){this.m_bNotifyOnActions&&this.onSet(e.getElement(t))}onAddUniqueElementFailedImpl(e){this.m_bNotifyOnActions&&this.onAddUniqueElementFailed(e)}onEndSearchImpl(e){this.m_bNotifyOnActions&&this.onEndSearch(e)}}class k{static st_nullNode(){return-1}constructor(){this.m_defaultTreap=-1,this.m_random=124234251,this.m_comparator=null,this.m_treapData=new M(7),this.m_treapCount=0,this.m_maxDepthEver=0,this.m_bBalancing=!0}setComparator(e){this.m_comparator=e}getComparator(){return this.m_comparator}disableBalancing(){this.m_bBalancing=!1}enableBalancing(){this.m_bBalancing||(n.geometryReleaseAssert(this.m_treapCount<=1),this.rebalance(-1),this.m_bBalancing=!0)}isAutoBalancing(){return this.m_bBalancing}rebalance(e){if(this.m_bBalancing)return;if(-1===e&&(e=this.m_defaultTreap),0===this.size(e))return;const t=[];for(let i=this.getFirst(e);-1!==i;i=this.getNext(i))t.push(i),this.setParent_(i,-1),this.setRight_(i,-1),this.setLeft_(i,-1);this.setRoot_(-1,e),this.setFirst_(-1,e),this.setLast_(-1,e),this.setSize_(0,e),this.m_bBalancing=!0;for(const i of t)this.addBiggestElement_(i,e);this.m_bBalancing=!1}setCapacity(e){this.m_treapData.setCapacity(e)}createTreap(e){const t=this.m_treapData.newElement();return this.setSize_(0,t),this.setTreapData_(e,t),this.m_treapCount++,t}deleteTreap(e){this.m_treapData.deleteElement(e),this.m_treapCount--}addElement(e,t=-1){return-1===t&&(this.m_defaultTreap===k.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),t=this.m_defaultTreap),this.addElement_(e,0,t)}addUniqueElement(e,t=-1){return-1===t&&(this.m_defaultTreap===k.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),t=this.m_defaultTreap),this.addElement_(e,1,t)}addBiggestElement(e,t=-1){-1===t&&(this.m_defaultTreap===k.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),t=this.m_defaultTreap);const i=this.newNode_(e);return this.addBiggestElement_(i,t),i}addElementAtPosition(e,i,n,s,r,o=-1){if(-1===o&&(this.m_defaultTreap===k.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),o=this.m_defaultTreap),this.getRoot_(o)===k.st_nullNode()){const e=this.newNode_(n);return this.setRoot_(e,o),this.addToList_(-1,e,o),e}let a,l,c,h,u;if(r?(a=i!==k.st_nullNode()?this.m_comparator.compare(this,n,i):-1,l=e!==k.st_nullNode()?this.m_comparator.compare(this,n,e):1):(a=-1,l=1),s&&(0===a||0===l)){this.m_comparator.onAddUniqueElementFailedImpl(n);const t=0===a?i:e;return this.setDuplicateElement_(t,o),-1}u=i!==k.st_nullNode()&&e!==k.st_nullNode()?this.m_random>t.nextRand(this.m_random)>>1:i!==k.st_nullNode(),u?(h=a,c=i):(h=l,c=e);let m=-1,d=-1,p=!0;for(;;){if(h<0){const e=this.getLeft(c);if(e===k.st_nullNode()){d=c,m=this.newNode_(n),this.setLeft_(c,m),this.setParent_(m,c);break}c=e}else{const e=this.getRight(c);if(e===k.st_nullNode()){d=this.getNext(c),m=this.newNode_(n),this.setRight_(c,m),this.setParent_(m,c);break}c=e}p&&(h*=-1,p=!1)}return this.bubbleUp_(m),this.getParent(m)===k.st_nullNode()&&this.setRoot_(m,o),this.addToList_(d,m,o),m}replaceElementAtPosition(e,t,i,n,s=-1){if(n){const n=this.getNext(e);let r=-1;n!==k.st_nullNode()&&(r=this.m_comparator.compare(this,t,n));const o=this.getPrev(e);let a=-1;if(o!==k.st_nullNode()&&(a=this.m_comparator.compare(this,t,o)),i&&(0===r||0===a)){this.m_comparator.onAddUniqueElementFailedImpl(t);const e=0===r?n:o;return s===k.st_nullNode()&&(this.m_defaultTreap===k.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),s=this.m_defaultTreap),this.setDuplicateElement_(e,s),-1}}return this.setElement_(e,t),e}getDuplicateElement(e=-1){return-1===e?this.getDuplicateElement_(this.m_defaultTreap):this.getDuplicateElement_(e)}deleteNode(e,t=-1){this.m_comparator&&this.m_comparator.onDeleteImpl(this,e),-1===t&&(t=this.m_defaultTreap),this.m_bBalancing?this.deleteNode_(e,t):this.unbalancedDelete_(e,t)}search(e,t=-1){let i=this.getRoot(t);for(;i!==k.st_nullNode();){const t=this.m_comparator.compare(this,e,i);if(!t)return i;i=t<0?this.getLeft(i):this.getRight(i)}return this.m_comparator.onEndSearchImpl(e),k.st_nullNode()}searchLowerBound(e,t=-1){let i=this.getRoot(t),n=-1;for(;i!==k.st_nullNode();){const t=e.compare(this,i);if(!t)return i;t<0?i=this.getLeft(i):(n=i,i=this.getRight(i))}return n}searchUpperBound(e,t=-1){let i=this.getRoot(t),n=-1;for(;i!==k.st_nullNode();){const t=e.compare(this,i);if(!t)return i;t<0?(n=i,i=this.getLeft(i)):i=this.getRight(i)}return n}getElement(e){return this.m_treapData.getField(e,3)}getLeft(e){return this.m_treapData.getField(e,0)}getRight(e){return this.m_treapData.getField(e,1)}getParent(e){return this.m_treapData.getField(e,2)}getNext(e){return this.m_treapData.getField(e,6)}getPrev(e){return this.m_treapData.getField(e,5)}getFirst(e=-1){return-1===e?this.getFirst_(this.m_defaultTreap):this.getFirst_(e)}getLast(e=-1){return-1===e?this.getLast_(this.m_defaultTreap):this.getLast_(e)}getTreapData(e=-1){return-1===e?this.getTreapData_(this.m_defaultTreap):this.getTreapData_(e)}setElement(e,t){null!==this.m_comparator&&this.m_comparator.onSetImpl(this,e),this.setElement_(e,t)}getRoot(e=-1){return-1===e?this.getRoot_(this.m_defaultTreap):this.getRoot_(e)}clear(){this.m_treapData.deleteAll(!1),this.m_defaultTreap=k.st_nullNode(),this.m_treapCount=0,this.m_maxDepthEver=0}addToList_(e,t,i){let n;-1!==e?(n=this.getPrev(e),this.setPrev_(e,t)):n=this.getLast_(i),this.setPrev_(t,n),-1!==n&&this.setNext_(n,t),this.setNext_(t,e),e===this.getFirst_(i)&&this.setFirst_(t,i),-1===e&&this.setLast_(t,i),this.setSize_(this.getSize_(i)+1,i)}size(e=-1){return-1===e?this.getSize_(this.m_defaultTreap):this.getSize_(e)}getMaxDepth(e=-1){return this.getMaxDepthHelper_(this.getRoot(e))}getMaxDepthEver(){return this.m_maxDepthEver}static st_isValidNode(e){return M.isValidElement(e)}dbgCheck_(e){}getPriority_(e){return this.m_treapData.getField(e,4)}bubbleDown_(e){let i=this.getLeft(e),n=this.getRight(e);const s=this.getPriority_(e);for(;i!==k.st_nullNode()||n!==k.st_nullNode();){const r=i!==k.st_nullNode()?this.getPriority_(i):t.indexTypeMax(),o=n!==k.st_nullNode()?this.getPriority_(n):t.indexTypeMax();if(s<=Math.min(r,o))return;r<=o?this.rotateRight_(i):this.rotateLeft_(e),i=this.getLeft(e),n=this.getRight(e)}}bubbleUp_(e){if(!this.m_bBalancing)return;const t=this.getPriority_(e);let i=this.getParent(e);for(;i!==k.st_nullNode()&&this.getPriority_(i)>t;)this.getLeft(i)===e?this.rotateRight_(e):this.rotateLeft_(i),i=this.getParent(e)}rotateLeft_(e){const t=e,i=this.getRight(e);let n;this.setParent_(i,this.getParent(t)),this.setParent_(t,i),n=this.getLeft(i),this.setRight_(t,n),n!==k.st_nullNode()&&this.setParent_(n,t),this.setLeft_(i,t),n=this.getParent(i),n!==k.st_nullNode()&&(this.getLeft(n)===t?this.setLeft_(n,i):this.setRight_(n,i))}rotateRight_(e){const t=this.getParent(e),i=e;let n;this.setParent_(i,this.getParent(t)),this.setParent_(t,i),n=this.getRight(i),this.setLeft_(t,n),n!==k.st_nullNode()&&this.setParent_(n,t),this.setRight_(i,t),n=this.getParent(i),n!==k.st_nullNode()&&(this.getLeft(n)===t?this.setLeft_(n,i):this.setRight_(n,i))}setParent_(e,t){this.m_treapData.setField(e,2,t)}setLeft_(e,t){this.m_treapData.setField(e,0,t)}setRight_(e,t){this.m_treapData.setField(e,1,t)}setPriority_(e,t){this.m_treapData.setField(e,4,t)}setPrev_(e,t){this.m_treapData.setField(e,5,t)}setNext_(e,t){this.m_treapData.setField(e,6,t)}setRoot_(e,t){this.m_treapData.setField(t,0,e)}setFirst_(e,t){this.m_treapData.setField(t,1,e)}setLast_(e,t){this.m_treapData.setField(t,2,e)}setDuplicateElement_(e,t){this.m_treapData.setField(t,3,e)}setSize_(e,t){this.m_treapData.setField(t,4,e)}setTreapData_(e,t){this.m_treapData.setField(t,5,e)}getRoot_(e){return-1===e?k.st_nullNode():this.m_treapData.getField(e,0)}getFirst_(e){return-1===e?k.st_nullNode():this.m_treapData.getField(e,1)}getLast_(e){return-1===e?k.st_nullNode():this.m_treapData.getField(e,2)}getDuplicateElement_(e){return-1===e?k.st_nullNode():this.m_treapData.getField(e,3)}getSize_(e){return-1===e?0:this.m_treapData.getField(e,4)}getTreapData_(e){return this.m_treapData.getField(e,5)}newNode_(e){const t=this.m_treapData.newElement();return this.setPriority_(t,this.generatePriority_()),this.setElement_(t,e),t}freeNode_(e,t){e!==k.st_nullNode()&&this.m_treapData.deleteElement(e)}generatePriority_(){return this.m_random=t.nextRand(this.m_random),this.m_random&t.indexTypeMax()>>1}maxPriority(){return n.geometryReleaseAssert(0),0}getMaxDepthHelper_(e){return e===k.st_nullNode()?0:1+Math.max(this.getMaxDepthHelper_(this.getLeft(e)),this.getMaxDepthHelper_(this.getRight(e)))}addElement_(e,t,i){if(this.getRoot(i)===k.st_nullNode()){const t=this.newNode_(e);return this.setRoot_(t,i),this.addToList_(-1,t,i),this.m_maxDepthEver=Math.max(this.m_maxDepthEver,1),t}let n=this.getRoot_(i),s=-1,r=-1,o=1;for(;;){const a=-1===t?1:this.m_comparator.compare(this,e,n);if(a<0){const t=this.getLeft(n);if(t===k.st_nullNode()){r=n,s=this.newNode_(e),this.setLeft_(n,s),this.setParent_(s,n);break}n=t}else{if(1===t&&0===a)return this.m_comparator.onAddUniqueElementFailedImpl(e),this.setDuplicateElement_(n,i),-1;const o=this.getRight(n);if(o===k.st_nullNode()){r=this.getNext(n),s=this.newNode_(e),this.setRight_(n,s),this.setParent_(s,n);break}n=o}o++}return this.bubbleUp_(s),this.getParent(s)===k.st_nullNode()&&this.setRoot_(s,i),this.addToList_(r,s,i),this.m_maxDepthEver=Math.max(o,this.m_maxDepthEver),s}removeFromList_(e,t){const i=this.getPrev(e),n=this.getNext(e);-1!==i?this.setNext_(i,n):this.setFirst_(n,t),-1!==n?this.setPrev_(n,i):this.setLast_(i,t),this.setSize_(this.getSize_(t)-1,t)}unbalancedDelete_(e,i){this.removeFromList_(e,i);let n=this.getLeft(e),s=this.getRight(e),r=this.getParent(e),o=e;if(-1!==n&&-1!==s){let a;this.m_random=t.nextRand(this.m_random),a=this.m_random>t.indexTypeMax()>>1?this.getNext(e):this.getPrev(e);const l=this.getParent(a)===e;this.m_treapData.swapField(e,a,0),this.m_treapData.swapField(e,a,1),this.m_treapData.swapField(e,a,2),-1!==r?this.getLeft(r)===e?this.setLeft_(r,a):this.setRight_(r,a):this.setRoot_(a,i),l?(n===a?(this.setLeft_(a,e),this.setParent_(s,a)):s===a&&(this.setRight_(a,e),this.setParent_(n,a)),this.setParent_(e,a),r=a):(this.setParent_(n,a),this.setParent_(s,a),r=this.getParent(e),o=a),n=this.getLeft(e),s=this.getRight(e),-1!==n&&this.setParent_(n,e),-1!==s&&this.setParent_(s,e)}const a=-1!==n?n:s;-1===r?this.setRoot_(a,i):this.getLeft(r)===o?this.setLeft_(r,a):this.setRight_(r,a),-1!==a&&this.setParent_(a,r),this.freeNode_(e,i)}deleteNode_(e,i){this.setPriority_(e,t.indexTypeMax());let n=k.st_nullNode(),s=k.st_nullNode();const r=this.getRoot_(i),o=r===e;if(o&&(n=this.getLeft(r),s=this.getRight(r),n===k.st_nullNode()&&s===k.st_nullNode()))return this.removeFromList_(r,i),this.freeNode_(r,i),void this.setRoot_(k.st_nullNode(),i);this.bubbleDown_(e);const a=this.getParent(e);a!==k.st_nullNode()&&(this.getLeft(a)===e?this.setLeft_(a,k.st_nullNode()):this.setRight_(a,k.st_nullNode())),this.removeFromList_(e,i),this.freeNode_(e,i),o&&this.setRoot_(n===k.st_nullNode()||this.getParent(n)!==k.st_nullNode()?s:n,i)}setElement_(e,t){this.m_treapData.setField(e,3,t)}addBiggestElement_(e,t){if(this.getRoot_(t)===k.st_nullNode())return this.setRoot_(e,t),void this.addToList_(-1,e,t);const i=this.getLast_(t);this.setRight_(i,e),this.setParent_(e,i),this.bubbleUp_(e),this.getParent(e)===k.st_nullNode()&&this.setRoot_(e,t),this.addToList_(-1,e,t)}}class V{constructor(e){this.m_lists=new M(6),this.m_listOfLists=V.st_nullNode(),void 0===e?(this.m_listNodes=new M(3),this.m_bStoreListIndexWithNode=!1):(this.m_listNodes=new M(e?4:3),this.m_bStoreListIndexWithNode=e)}freeNode_(e){this.m_listNodes.deleteElement(e)}newNode_(){return this.m_listNodes.newElement()}freeList_(e){n.geometryReleaseAssert(0)}newList_(){return this.m_lists.newElement()}setPrev_(e,t){this.m_listNodes.setField(e,1,t)}setNext_(e,t){this.m_listNodes.setField(e,2,t)}setData_(e,t){n.geometryReleaseAssert(0)}setList_(e,t){return this.m_listNodes.setField(e,3,t)}setListSize_(e,t){this.m_lists.setField(e,4,t)}setNextList_(e,t){n.geometryReleaseAssert(0)}setPrevList_(e,t){this.m_lists.setField(e,2,t)}createList(e){const t=this.newList_();return this.m_lists.setField(t,3,this.m_listOfLists),this.m_lists.setField(t,4,0),this.m_lists.setField(t,5,e),this.m_listOfLists!==V.st_nullNode()&&this.setPrevList_(this.m_listOfLists,t),this.m_listOfLists=t,t}deleteList(e){this.clear(e);const t=this.m_lists.getField(e,2),i=this.m_lists.getField(e,3);return t!==V.st_nullNode()?this.setNextList_(t,i):this.m_listOfLists=i,i!==V.st_nullNode()&&this.setPrevList_(i,t),this.freeList_(e),i}reserveLists(e){n.geometryReleaseAssert(0)}getListData(e){return this.m_lists.getField(e,5)}getList(e){return n.geometryReleaseAssert(0),0}setListData(e,t){this.m_lists.setField(e,5,t)}addElement(e,t){return this.insertElement(e,-1,t)}insertElement(e,t,i){const n=this.newNode_();let s=-1;if(t!==V.st_nullNode()&&(s=this.getPrev(t),this.setPrev_(t,n)),this.setNext_(n,t),s!==V.st_nullNode()&&this.setNext_(s,n),t===this.m_lists.getField(e,0)&&this.m_lists.setField(e,0,n),t===V.st_nullNode()){const t=this.m_lists.getField(e,1);this.setPrev_(n,t),-1!==t&&this.setNext_(t,n),this.m_lists.setField(e,1,n)}return this.setData(n,i),this.setListSize_(e,this.getListSize(e)+1),this.m_bStoreListIndexWithNode&&this.setList_(n,e),n}deleteElement(e,t){const i=this.getPrev(t),n=this.getNext(t);return i!==V.st_nullNode()?this.setNext_(i,n):this.m_lists.setField(e,0,n),n!==V.st_nullNode()?this.setPrev_(n,i):this.m_lists.setField(e,1,i),this.freeNode_(t),this.setListSize_(e,this.getListSize(e)-1),n}reserveNodes(e){this.m_listNodes.setCapacity(e)}getData(e){return this.m_listNodes.getField(e,0)}getElement(e){return this.getData(e)}setData(e,t){this.m_listNodes.setField(e,0,t)}getNext(e){return this.m_listNodes.getField(e,2)}getPrev(e){return this.m_listNodes.getField(e,1)}getFirst(e){return this.m_lists.getField(e,0)}getLast(e){return this.m_lists.getField(e,1)}static st_nullNode(){return-1}clear(e){if(void 0!==e){let t=this.getLast(e);for(;t!==V.st_nullNode();){const e=t;t=this.getPrev(e),this.freeNode_(e)}return this.m_lists.setField(e,0,-1),this.m_lists.setField(e,1,-1),void this.setListSize_(e,0)}for(let e=this.getFirstList();-1!==e;)e=this.deleteList(e)}isEmpty(e){return n.geometryReleaseAssert(0),!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getListSize(e){return this.m_lists.getField(e,4)}getFirstList(){return this.m_listOfLists}getNextList(e){return this.m_lists.getField(e,3)}}class F extends G{constructor(e){super(),this.m_intervalTree=e}compare(e,t,i){const n=e.getElement(i),s=this.m_intervalTree.getValue_(t),r=this.m_intervalTree.getValue_(n);return s<r?-1:s===r?L.isLeft_(t)&&L.isRight_(n)?-1:L.isLeft_(n)&&L.isRight_(t)?1:0:1}}class L{constructor(e){this.m_bEnvelopesRef=!1,this.m_intervals=[],this.m_envelopesRef=null,this.m_intervalNodes=new M(3),this.m_intervalHandles=[],this.m_endIndicesUnique=[],this.m_cCount=-1,this.m_root=-1,this.m_bSortIntervals=!1,this.m_bConstructing=!1,this.m_bConstructionEnded=!1,this.m_bOfflineDynamic=e,this.m_tertiaryNodes=new M(this.m_bOfflineDynamic?5:4),this.m_secondaryTreaps=new k,this.m_secondaryTreaps.setComparator(new F(this)),this.m_secondaryLists=new V}addEnvelopesRef(e){this.reset_(!0,!0),this.m_bEnvelopesRef=!0,this.m_envelopesRef=e,this.m_bConstructing=!1,this.m_bConstructionEnded=!0,this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_envelopesRef.length)}startConstruction(){this.reset_(!0,!1)}addInterval(e){this.m_bConstructing||n.throwInvalidCallException(""),this.m_intervals.push(e.clone())}addIntervalCoords(e,t){n.geometryReleaseAssert(0)}endConstruction(){this.m_bConstructing||n.throwInvalidCallException(""),this.m_bConstructing=!1,this.m_bConstructionEnded=!0,this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_intervals.length)}insert(e){if(this.m_bOfflineDynamic&&this.m_bConstructionEnded||n.throwInvalidCallException(""),-1===this.m_root){const e=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;if(this.m_bSortIntervals){const t=new T(0);this.querySortedEndPointIndices_(t),this.m_endIndicesUnique.length=0,this.querySortedDuplicatesRemoved_(t),this.m_intervalHandles.length=e,this.m_intervalHandles.fill(-1),this.m_bSortIntervals=!1}else this.m_intervalHandles.fill(-1,0,e);this.m_root=this.createRoot_()}const t=this.insertIntervalEnd_(e<<1,this.m_root),i=this.getSecondaryFromInterval_(t),s=this.m_secondaryTreaps.addElement(1+(e<<1),i);this.setRightEnd_(t,s),this.m_intervalHandles[e]=t,this.m_cCount++}remove(e){this.m_bOfflineDynamic&&this.m_bConstructionEnded||n.throwInvalidCallException("");const t=this.m_intervalHandles[e];let i;-1===t&&n.throwInvalidArgumentException("the interval does not exist in the interval tree"),this.m_intervalHandles[e]=-1,this.m_cCount--;let s=this.getSecondaryFromInterval_(t),r=-1;r=this.m_secondaryTreaps.getTreapData(s),this.m_secondaryTreaps.deleteNode(this.getLeftEnd_(t),s),this.m_secondaryTreaps.deleteNode(this.getRightEnd_(t),s),i=this.m_secondaryTreaps.size(s),0===i&&(this.m_secondaryTreaps.deleteTreap(s),this.setSecondaryToTertiary_(r,-1)),this.m_intervalNodes.deleteElement(t);let o=this.getPptr_(r),a=this.getLptr_(r),l=this.getRptr_(r);for(;!(i>0||r===this.m_root||-1!==a&&-1!==l);)r===this.getLptr_(o)?-1!==a?(this.setLptr_(o,a),this.setPptr_(a,o),this.setLptr_(r,-1),this.setPptr_(r,-1)):-1!==l?(this.setLptr_(o,l),this.setPptr_(l,o),this.setRptr_(r,-1),this.setPptr_(r,-1)):(this.setLptr_(o,-1),this.setPptr_(r,-1)):-1!==a?(this.setRptr_(o,a),this.setPptr_(a,o),this.setLptr_(r,-1),this.setPptr_(r,-1)):-1!==l?(this.setRptr_(o,l),this.setPptr_(l,o),this.setRptr_(r,-1),this.setPptr_(r,-1)):(this.setRptr_(o,-1),this.setPptr_(r,-1)),this.m_tertiaryNodes.deleteElement(r),r=o,s=this.getSecondaryFromTertiary_(r),i=-1!==s?this.m_secondaryTreaps.size(s):0,a=this.getLptr_(r),l=this.getRptr_(r),o=this.getPptr_(r)}size(){return this.m_cCount}getIteratorQuery(e,i){return e instanceof t.Envelope1D?new q(this,e,i):(n.geometryReleaseAssert(0),{})}getIterator(){return new q(this)}querySortedEndPointIndices_(e){const t=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;for(let i=0;i<2*t;i++)e.add(i);this.sortEndIndices_(e,0,2*t)}querySortedDuplicatesRemoved_(e){let t=Number.NaN;for(let i=0;i<e.size();i++){const n=e.read(i),s=this.getValue_(n);s!==t&&(this.m_endIndicesUnique.push(n),t=s)}}insertIntervalsStatic_(){const e=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length,i=new T(0);this.querySortedEndPointIndices_(i),this.m_endIndicesUnique.length=0,this.querySortedDuplicatesRemoved_(i),this.m_intervalNodes.setCapacity(e),this.m_secondaryLists.reserveNodes(2*e);const n=t.makePrimitiveArray(e,-1);this.m_root=this.createRoot_();for(let e=0;e<i.size();e++){const t=i.read(e);let s=n[t>>1];if(-1!==s){const e=this.getSecondaryFromInterval_(s);this.setRightEnd_(s,this.m_secondaryLists.addElement(e,t))}else s=this.insertIntervalEnd_(t,this.m_root),n[t>>1]=s}}createRoot_(){const e=this.calculateDiscriminantIndex1_(0,this.m_endIndicesUnique.length-1);return this.createTertiaryNode_(e)}insertIntervalEnd_(e,t){let i=-1,n=t,s=-1,r=-1,o=0,a=this.m_endIndicesUnique.length-1,l=0;const c=e>>1;let h=Number.NaN,u=Number.NaN,m=!0;const d=this.getMin_(c),p=this.getMax_(c);let g=-1;for(;m;){l=o+(a-o>>1),g=this.calculateDiscriminantIndex1_(o,a);const t=this.getDiscriminantFromIndex1_(g);if(p<t){if(-1!==n)if(g===this.getDiscriminantIndex1_(n))i=n,h=t,n=this.getLptr_(n),u=-1!==n?this.getDiscriminant_(n):Number.NaN;else if(u>t){const e=this.createTertiaryNode_(g);t<h?this.setLptr_(i,e):this.setRptr_(i,e),this.setRptr_(e,n),this.m_bOfflineDynamic&&(this.setPptr_(e,i),this.setPptr_(n,e)),i=e,h=t,n=-1,u=Number.NaN}a=l;continue}if(d>t){if(-1!==n)if(g===this.getDiscriminantIndex1_(n))i=n,h=t,n=this.getRptr_(n),u=-1!==n?this.getDiscriminant_(n):Number.NaN;else if(u<t){const e=this.createTertiaryNode_(g);t<h?this.setLptr_(i,e):this.setRptr_(i,e),this.setLptr_(e,n),this.m_bOfflineDynamic&&(this.setPptr_(e,i),this.setPptr_(n,e)),i=e,h=t,n=-1,u=Number.NaN}o=l+1;continue}let c=-1;c=-1===n||g!==this.getDiscriminantIndex1_(n)?this.createTertiaryNode_(g):n,s=this.getSecondaryFromTertiary_(c),-1===s&&(s=this.createSecondary_(c),this.setSecondaryToTertiary_(c,s));const _=this.addEndIndex_(s,e);r=this.createIntervalNode_(),this.setSecondaryToInterval_(r,s),this.setLeftEnd_(r,_),-1!==n&&g===this.getDiscriminantIndex1_(n)||(t<h?this.setLptr_(i,c):this.setRptr_(i,c),this.m_bOfflineDynamic&&this.setPptr_(c,i),-1!==n&&(u<t?this.setLptr_(c,n):this.setRptr_(c,n),this.m_bOfflineDynamic&&this.setPptr_(n,c))),m=!1;break}return r}createTertiaryNode_(e){const t=this.m_tertiaryNodes.newElement();return this.setDiscriminantIndex1_(t,e),t}createSecondary_(e){return this.m_bOfflineDynamic?this.m_secondaryTreaps.createTreap(e):this.m_secondaryLists.createList(e)}createIntervalNode_(){return this.m_intervalNodes.newElement()}reset(){this.m_bOfflineDynamic&&this.m_bConstructionEnded||n.throwInvalidCallException(""),this.reset_(!1,this.m_bEnvelopesRef)}reset_(e,t){e?(this.m_bEnvelopesRef=!1,this.m_envelopesRef=null,this.m_bSortIntervals=!0,this.m_bConstructing=!0,this.m_bConstructionEnded=!1,this.m_endIndicesUnique.length=0,t?(this.m_intervals.length=0,this.m_bEnvelopesRef=!0):this.m_intervals.length=0):this.m_bSortIntervals=!1,this.m_bOfflineDynamic?this.m_secondaryTreaps.clear():this.m_secondaryLists.clear(),this.m_intervalNodes.deleteAll(!1),this.m_tertiaryNodes.deleteAll(!1),this.m_root=-1,this.m_cCount=0}getDiscriminant_(e){const t=this.getDiscriminantIndex1_(e);return this.getDiscriminantFromIndex1_(t)}getDiscriminantFromIndex1_(e){if(-1===e)return Number.NaN;if(e>0){const t=e-2,i=this.m_endIndicesUnique[t],n=this.m_endIndicesUnique[t+1];return.5*(this.getValue_(i)+this.getValue_(n))}const t=-e-2,i=this.m_endIndicesUnique[t];return this.getValue_(i)}calculateDiscriminantIndex1_(e,t){let i;return i=e<t?e+(t-e>>1)+2:-(e+2),i}setDiscriminantIndex1_(e,t){this.m_tertiaryNodes.setField(e,0,t)}setSecondaryToTertiary_(e,t){this.m_tertiaryNodes.setField(e,1,t)}setLptr_(e,t){this.m_tertiaryNodes.setField(e,2,t)}setRptr_(e,t){this.m_tertiaryNodes.setField(e,3,t)}setPptr_(e,t){this.m_tertiaryNodes.setField(e,4,t)}setSecondaryToInterval_(e,t){this.m_intervalNodes.setField(e,0,t)}addEndIndex_(e,t){let i=-1;return i=this.m_bOfflineDynamic?this.m_secondaryTreaps.addElement(t,e):this.m_secondaryLists.addElement(e,t),i}setLeftEnd_(e,t){this.m_intervalNodes.setField(e,1,t)}setRightEnd_(e,t){this.m_intervalNodes.setField(e,2,t)}getFirst_(e){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getFirst(e):this.m_secondaryLists.getFirst(e)}getLast_(e){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getLast(e):this.m_secondaryLists.getLast(e)}static isLeft_(e){return!(1&e)}static isRight_(e){return!(1&~e)}getDiscriminantIndex1_(e){return this.m_tertiaryNodes.getField(e,0)}getSecondaryFromTertiary_(e){return this.m_tertiaryNodes.getField(e,1)}getLptr_(e){return this.m_tertiaryNodes.getField(e,2)}getRptr_(e){return this.m_tertiaryNodes.getField(e,3)}getPptr_(e){return this.m_tertiaryNodes.getField(e,4)}getSecondaryFromInterval_(e){return this.m_intervalNodes.getField(e,0)}getLeftEnd_(e){return this.m_intervalNodes.getField(e,1)}getRightEnd_(e){return this.m_intervalNodes.getField(e,2)}getMin_(e){return this.m_bEnvelopesRef?this.m_envelopesRef[e].xmin:this.m_intervals[e].vmin}getMax_(e){return this.m_bEnvelopesRef?this.m_envelopesRef[e].xmax:this.m_intervals[e].vmax}sortEndIndices_(e,t,i){const n=this,s={userSort(e,t,i){n.sortEndIndicesHelper_(i,e,t)},getValue:e=>n.getValue_(e)};(new A).sort(e,t,i,s)}sortEndIndicesHelper_(e,t,i){e.sort(t,i,((e,t)=>{const i=this.getValue_(e),n=this.getValue_(t);return i<n||i===n&&L.isLeft_(e)&&L.isRight_(t)?-1:1}))}getValue_(e){if(!this.m_bEnvelopesRef){const t=this.m_intervals[e>>1];return L.isLeft_(e)?t.vmin:t.vmax}const t=this.m_envelopesRef[e>>1];return L.isLeft_(e)?t.xmin:t.xmax}}class q{constructor(e,i,n){this.m_query=t.Envelope1D.constructEmpty(),this.m_tertiaryHandle=-1,this.m_nextTertiaryHandle=-1,this.m_forkedHandle=-1,this.m_currentEndHandle=-1,this.m_nextEndHandle=-1,this.m_tertiaryStack=[],this.m_functionIndex=0,this.m_intervalTree=e,this.m_functionStack=new Array(2),this.m_functionStack[0]=this.nullFunc_,this.m_functionStack[1]=this.nullFunc_,void 0!==i&&this.resetIterator(i,n)}nullFunc_(){return n.throwInternalErrorException("should not be called"),!1}resetIterator(e,i){if("number"==typeof e){const n=new t.Envelope1D;n.setCoords(e,e),this.resetIterator(n,i)}else void 0===i&&(i=0),this.m_query.vmin=e.vmin-i,this.m_query.vmax=e.vmax+i,this.m_tertiaryStack.length=0,this.m_functionIndex=0,this.m_functionStack[0]=this.initialize_}next(){if(this.m_intervalTree.m_bConstructionEnded||n.throwInvalidCallException(""),this.m_functionIndex<0)return-1;for(;this.m_fi=this.m_functionStack[this.m_functionIndex],this.m_fi(););return-1!==this.m_currentEndHandle?this.getCurrentEndIndex_()>>1:-1}initialize_(){return this.m_tertiaryHandle=-1,this.m_nextTertiaryHandle=-1,this.m_forkedHandle=-1,this.m_currentEndHandle=-1,this.m_intervalTree.m_tertiaryNodes.size()>0?(this.m_functionStack[0]=this.pIn_,this.m_nextTertiaryHandle=this.m_intervalTree.m_root,!0):(this.m_functionIndex=-1,!1)}pIn_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,-1===this.m_tertiaryHandle)return this.m_functionIndex=-1,this.m_currentEndHandle=-1,!1;const e=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<e){const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.left_),!0}if(e<this.m_query.vmin){const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getLast_(e),this.m_functionStack[++this.m_functionIndex]=this.right_),!0}this.m_functionStack[this.m_functionIndex]=this.pL_,this.m_forkedHandle=this.m_tertiaryHandle;const t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==t&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.all_),!0}pL_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,-1===this.m_tertiaryHandle)return this.m_functionStack[this.m_functionIndex]=this.pR_,this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_forkedHandle),!0;if(this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle)<this.m_query.vmin){const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getLast_(e),this.m_functionStack[++this.m_functionIndex]=this.right_),!0}const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.all_);const t=this.m_intervalTree.getRptr_(this.m_tertiaryHandle);return-1!==t&&this.m_tertiaryStack.push(t),!0}pR_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,-1===this.m_tertiaryHandle)return this.m_functionStack[this.m_functionIndex]=this.pT_,!0;const e=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<e){const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.left_),!0}const t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),-1!==t&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.all_);const i=this.m_intervalTree.getLptr_(this.m_tertiaryHandle);return-1!==i&&this.m_tertiaryStack.push(i),!0}pT_(){if(0===this.m_tertiaryStack.length)return this.m_functionIndex=-1,this.m_currentEndHandle=-1,!1;this.m_tertiaryHandle=this.m_tertiaryStack.at(-1),this.m_tertiaryStack.pop();const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.all_),-1!==this.m_intervalTree.getLptr_(this.m_tertiaryHandle)&&this.m_tertiaryStack.push(this.m_intervalTree.getLptr_(this.m_tertiaryHandle)),-1!==this.m_intervalTree.getRptr_(this.m_tertiaryHandle)&&this.m_tertiaryStack.push(this.m_intervalTree.getRptr_(this.m_tertiaryHandle)),!0}left_(){return this.m_currentEndHandle=this.m_nextEndHandle,-1!==this.m_currentEndHandle&&L.isLeft_(this.getCurrentEndIndex_())&&this.m_intervalTree.getValue_(this.getCurrentEndIndex_())<=this.m_query.vmax?(this.m_nextEndHandle=this.getNext_(),!1):(this.m_functionIndex--,!0)}right_(){return this.m_currentEndHandle=this.m_nextEndHandle,-1!==this.m_currentEndHandle&&L.isRight_(this.getCurrentEndIndex_())&&this.m_intervalTree.getValue_(this.getCurrentEndIndex_())>=this.m_query.vmin?(this.m_nextEndHandle=this.getPrev_(),!1):(this.m_functionIndex--,!0)}all_(){return this.m_currentEndHandle=this.m_nextEndHandle,-1!==this.m_currentEndHandle&&L.isLeft_(this.getCurrentEndIndex_())?(this.m_nextEndHandle=this.getNext_(),!1):(this.m_functionIndex--,!0)}getNext_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getNext(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getNext(this.m_currentEndHandle)}getPrev_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getPrev(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getPrev(this.m_currentEndHandle)}getCurrentEndIndex_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getElement(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getData(this.m_currentEndHandle)}}class H{constructor(){this.m_tolerance=0,this.m_sweepIndexRed=-1,this.m_sweepIndexBlue=-1,this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_intervalTreeRed=null,this.m_intervalTreeBlue=null,this.m_iteratorRed=null,this.m_iteratorBlue=null,this.m_envelopesRed=[],this.m_envelopesBlue=[],this.m_elementsRed=[],this.m_elementsBlue=[],this.m_sortedEndIndicesRed=new T(0),this.m_sortedEndIndicesBlue=new T(0),this.m_queuedListRed=-1,this.m_queuedListBlue=-1,this.m_queuedEnvelopes=new V,this.m_queuedIndicesRed=[],this.m_queuedIndicesBlue=[],this.m_bAddRed=!1,this.m_bAddBlue=!1,this.m_bAddRedRed=!1,this.m_bDone=!0,this.m_function=this.nullFunc_,this.reset_()}startConstruction(){this.reset_(),this.m_bAddRedRed=!0,this.m_elementsRed.length=0,this.m_envelopesRed.length=0}addEnvelope(e,t){this.m_bAddRedRed||n.throwInvalidCallException(""),this.m_elementsRed.push(e),this.m_envelopesRed.push(new i.Envelope2D(t))}endConstruction(){this.m_bAddRedRed||n.throwInvalidCallException(""),this.m_bAddRedRed=!1,this.m_envelopesRed.length>0&&(this.m_function=this.initialize_,this.m_bDone=!1)}startRedConstruction(){this.reset_(),this.m_bAddRed=!0,this.m_elementsRed.length=0,this.m_envelopesRed.length=0}addRedEnvelope(e,t){this.m_bAddRed||n.throwInvalidCallException(""),this.m_elementsRed.push(e),this.m_envelopesRed.push(t.clone())}endRedConstruction(){this.m_bAddRed||n.throwInvalidCallException(""),this.m_bAddRed=!1,this.m_envelopesRed.length>0&&this.m_envelopesBlue.length>0&&(this.m_function===this.nullFunc_||this.m_function===this.initializeBlue_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeRed_),this.m_bDone=!1)}startBlueConstruction(){this.reset_(),this.m_bAddBlue=!0,this.m_elementsBlue.length=0,this.m_envelopesBlue.length=0}addBlueEnvelope(e,t){this.m_bAddBlue||n.throwInvalidCallException(""),this.m_elementsBlue.push(e),this.m_envelopesBlue.push(t.clone())}endBlueConstruction(){this.m_bAddBlue||n.throwInvalidCallException(""),this.m_bAddBlue=!1,this.m_envelopesRed.length>0&&this.m_envelopesBlue.length>0&&(this.m_function===this.nullFunc_||this.m_function===this.initializeRed_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeBlue_),this.m_bDone=!1)}next(){if(this.m_bDone)return!1;for(;this.m_function(););return!this.m_bDone}getHandleA(){return this.m_envelopeHandleA}getHandleB(){return this.m_envelopeHandleB}setTolerance(e){this.m_tolerance=e}getElement(e){return this.m_elementsRed[e]}getRedEnvelope(e){return this.m_envelopesRed[e]}getBlueEnvelope(e){return this.m_envelopesBlue[e]}getRedElement(e){return this.m_elementsRed[e]}getBlueElement(e){return this.m_elementsBlue[e]}isTop_(e){return!(1&~e)}isBottom_(e){return!(1&e)}reset_(){this.m_bAddRed=!1,this.m_bAddBlue=!1,this.m_bAddRedRed=!1,this.m_sweepIndexRed=-1,this.m_sweepIndexBlue=-1,this.m_queuedListRed=-1,this.m_queuedListBlue=-1,this.m_bDone=!0}initialize_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new L(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_sortedEndIndicesRed.resize(0);for(let e=0;e<2*this.m_envelopesRed.length;e++)this.m_sortedEndIndicesRed.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,2*this.m_envelopesRed.length,!0),this.m_sweepIndexRed=2*this.m_envelopesRed.length,this.m_function=this.sweep_,!0}initializeRed_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new L(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_sortedEndIndicesRed.resize(0);for(let e=0;e<2*this.m_envelopesRed.length;e++)this.m_sortedEndIndicesRed.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0),this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_function=this.sweepRedBlue_,this.resetBlue_()}initializeBlue_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeBlue||(this.m_intervalTreeBlue=new L(!0)),this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue),null==this.m_iteratorBlue&&(this.m_iteratorBlue=this.m_intervalTreeBlue.getIterator()),this.m_sortedEndIndicesBlue.resize(0);for(let e=0;e<2*this.m_envelopesBlue.length;e++)this.m_sortedEndIndicesBlue.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1),this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_function=this.sweepRedBlue_,this.resetRed_()}initializeRedBlue_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new L(!0)),this.m_intervalTreeBlue||(this.m_intervalTreeBlue=new L(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue),null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),null===this.m_iteratorBlue&&(this.m_iteratorBlue=this.m_intervalTreeBlue.getIterator()),this.m_sortedEndIndicesRed.resize(0),this.m_sortedEndIndicesBlue.resize(0);for(let e=0;e<2*this.m_envelopesRed.length;e++)this.m_sortedEndIndicesRed.add(e);for(let e=0;e<2*this.m_envelopesBlue.length;e++)this.m_sortedEndIndicesBlue.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0),this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1),this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_function=this.sweepRedBlue_,!0}sweep_(){const e=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed),i=e>>1;if(this.isBottom_(e))return this.m_intervalTreeRed.remove(i),0!==this.m_sweepIndexRed||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);const n=t.Envelope1D.construct(this.m_envelopesRed[i].xmin,this.m_envelopesRed[i].xmax);return this.m_iteratorRed.resetIterator(n,this.m_tolerance),this.m_envelopeHandleA=i,this.m_function=this.iterate_,!0}sweepBruteForce_(){return-1===--this.m_sweepIndexRed?(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1):(this.m_envelopeHandleA=this.m_sweepIndexRed,this.m_sweepIndexBlue=this.m_sweepIndexRed,this.m_function=this.iterateBruteForce_,!0)}sweepRedBlueBruteForce_(){return-1===--this.m_sweepIndexRed?(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1):(this.m_envelopeHandleA=this.m_sweepIndexRed,this.m_sweepIndexBlue=this.m_envelopesBlue.length,this.m_function=this.iterateRedBlueBruteForce_,!0)}sweepRedBlue_(){const e=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed-1),t=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue-1),i=this.getAdjustedValue_(e,!0),n=this.getAdjustedValue_(t,!1);return i>n?this.sweepRed_():i<n?this.sweepBlue_():this.isTop_(e)?this.sweepRed_():this.isTop_(t)?this.sweepBlue_():this.sweepRed_()}sweepRed_(){const e=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed),i=e>>1;if(this.isBottom_(e))return-1!==this.m_queuedListRed&&-1!==this.m_queuedIndicesRed[i]?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,this.m_queuedIndicesRed[i]),this.m_queuedIndicesRed[i]=-1):this.m_intervalTreeRed.remove(i),0!==this.m_sweepIndexRed||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);if(-1!==this.m_queuedListBlue&&this.m_queuedEnvelopes.getListSize(this.m_queuedListBlue)>0){let e=this.m_queuedEnvelopes.getFirst(this.m_queuedListBlue);for(;-1!==e;){const t=this.m_queuedEnvelopes.getData(e);this.m_intervalTreeBlue.insert(t),this.m_queuedIndicesBlue[t]=-1;const i=this.m_queuedEnvelopes.getNext(e);this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,e),e=i}}if(this.m_intervalTreeBlue.size()>0){const e=t.Envelope1D.construct(this.m_envelopesRed[i].xmin,this.m_envelopesRed[i].xmax);this.m_iteratorBlue.resetIterator(e,this.m_tolerance),this.m_envelopeHandleA=i,this.m_function=this.iterateBlue_}else-1===this.m_queuedListRed&&(t.initializePrimitiveArray(this.m_queuedIndicesRed,this.m_envelopesRed.length,-1),this.m_queuedListRed=this.m_queuedEnvelopes.createList(1)),this.m_queuedIndicesRed[i]=this.m_queuedEnvelopes.addElement(this.m_queuedListRed,i),this.m_function=this.sweepRedBlue_;return!0}sweepBlue_(){const e=this.m_sortedEndIndicesBlue.read(--this.m_sweepIndexBlue),i=e>>1;if(this.isBottom_(e))return-1!==this.m_queuedListBlue&&-1!==this.m_queuedIndicesBlue[i]?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,this.m_queuedIndicesBlue[i]),this.m_queuedIndicesBlue[i]=-1):this.m_intervalTreeBlue.remove(i),0!==this.m_sweepIndexBlue||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);if(-1!==this.m_queuedListRed&&this.m_queuedEnvelopes.getListSize(this.m_queuedListRed)>0){let e=this.m_queuedEnvelopes.getFirst(this.m_queuedListRed);for(;-1!==e;){const t=this.m_queuedEnvelopes.getData(e);this.m_intervalTreeRed.insert(t),this.m_queuedIndicesRed[t]=-1;const i=this.m_queuedEnvelopes.getNext(e);this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,e),e=i}}if(this.m_intervalTreeRed.size()>0){const e=t.Envelope1D.construct(this.m_envelopesBlue[i].xmin,this.m_envelopesBlue[i].xmax);this.m_iteratorRed.resetIterator(e,this.m_tolerance),this.m_envelopeHandleB=i,this.m_function=this.iterateRed_}else-1===this.m_queuedListBlue&&(t.initializePrimitiveArray(this.m_queuedIndicesBlue,this.m_envelopesBlue.length,-1),this.m_queuedListBlue=this.m_queuedEnvelopes.createList(0)),this.m_queuedIndicesBlue[i]=this.m_queuedEnvelopes.addElement(this.m_queuedListBlue,i),this.m_function=this.sweepRedBlue_;return!0}iterate_(){if(this.m_envelopeHandleB=this.m_iteratorRed.next(),-1!==this.m_envelopeHandleB)return!1;const e=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>1;return this.m_intervalTreeRed.insert(e),this.m_function=this.sweep_,!0}iterateRed_(){if(this.m_envelopeHandleA=this.m_iteratorRed.next(),-1!==this.m_envelopeHandleA)return!1;this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1;const e=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue)>>1;return this.m_intervalTreeBlue.insert(e),this.m_function=this.sweepRedBlue_,!0}iterateBlue_(){if(this.m_envelopeHandleB=this.m_iteratorBlue.next(),-1!==this.m_envelopeHandleB)return!1;const e=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>1;return this.m_intervalTreeRed.insert(e),this.m_function=this.sweepRedBlue_,!0}iterateBruteForce_(){if(-1===--this.m_sweepIndexBlue)return this.m_function=this.sweepBruteForce_,!0;const e=this.m_envelopesRed[this.m_sweepIndexRed].clone(),t=this.m_envelopesRed[this.m_sweepIndexBlue];return e.inflateCoords(this.m_tolerance,this.m_tolerance),!e.isIntersecting(t)||(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1)}iterateRedBlueBruteForce_(){if(-1===--this.m_sweepIndexBlue)return this.m_function=this.sweepRedBlueBruteForce_,!0;const e=this.m_envelopesRed[this.m_sweepIndexRed].clone(),t=this.m_envelopesBlue[this.m_sweepIndexBlue];return e.inflateCoords(this.m_tolerance,this.m_tolerance),!e.isIntersecting(t)||(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1)}resetRed_(){return this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_intervalTreeRed.size()>0&&this.m_intervalTreeRed.reset(),-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_bDone=!1,!0}resetBlue_(){return this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),this.m_intervalTreeBlue.size()>0&&this.m_intervalTreeBlue.reset(),-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_bDone=!1,!0}nullFunc_(){return n.throwInternalErrorException("should not be called"),!1}sortYEndIndices_(e,t,i,n){const s=this,r={userSort(e,t,i){s.sortYEndIndicesHelper_(i,e,t,n)},getValue:e=>s.getAdjustedValue_(e,n)};(new A).sort(e,t,i,r)}sortYEndIndicesHelper_(e,t,i,n){e.sort(t,i,((e,t)=>{const i=this.getAdjustedValue_(e,n),s=this.getAdjustedValue_(t,n);return i<s||i===s&&this.isBottom_(e)&&this.isTop_(t)?-1:1}))}getAdjustedValue_(e,t){const i=.5*this.m_tolerance;if(t){const t=this.m_envelopesRed[e>>1];return this.isBottom_(e)?t.ymin-i:t.ymax+i}const n=this.m_envelopesBlue[e>>1];return this.isBottom_(e)?n.ymin-i:n.ymax+i}}var U=h;class z{constructor(e,t){this.tolerance=void 0!==e?e:Number.NaN,this.resolution=void 0!==t?t:Number.NaN}add(e){return new z(this.tolerance+e,this.resolution)}scale(e){return new z(this.tolerance*e,this.resolution*e)}total(){return this.tolerance+this.resolution}}function Y(e,t,i){return n=>0===i?(n+e)*t:1*(n-e*t)/t}function B(e,t,i){return W(0,e,t.calculateToleranceFromEnvelope(),i,!1)}function X(e,t,i){return W(1,e,t.calculateToleranceFromEnvelope(),i,!1)}function j(e,t,i=!1){return W(0,e,t.calculateToleranceFromEnvelope(),i,!0).total()}function W(e,t,i,n,s){const r=new z(0,0);if(null!==t&&(r.tolerance=t.getTolerance(e),(!s||n)&&null!==t)){const i=t.getResolution(e);r.resolution=i,n&&(r.resolution*=2)}return n&&(i*=4,r.tolerance*=1.01,r.resolution*=1.01),r.total()<i?new z(i,0):r}function Z(e){return e>=3}function Q(e,t,i,n,s){let r=!1;const o=s.vmin,a=s.vmax;for(let s=i;s<t;s+=n){const t=e.read(s);t<o?(r=!0,e.write(s,o)):t>a&&(r=!0,e.write(s,a))}return r}var $=h;class K{constructor(e){if(this.m_description=null,this.x=Number.NaN,this.y=Number.NaN,this.m_attribs=null,e){if(!e.copy)return e.move?(this.m_description=e.move.m_description,e.move.m_description=null,this.m_attribs=e.move.m_attribs,e.move.m_attribs=null,this.x=e.move.x,void(this.y=e.move.y)):e.vd?(this.m_description=e.vd,void(e.attribBuffer?(this.m_attribs=e.attribBuffer,e.initDefaultValues&&this.setDefaultAttributeValues()):this.ensureAttributes())):e.pt?(this.m_description=y(),void this.setXY(e.pt)):void("x"in e&&("z"in e?(this.m_description=x(),this.ensureAttributes(),this.setXYZ(new P(e.x,e.y,e.z))):(this.m_description=y(),this.setXYCoords(e.x,e.y))));e.copy.copyTo(this)}else this.m_description=y()}assignCopy(e){return this.m_attribs=null,e.copyTo(this),this}assignMove(e){return this.m_attribs=null,e.copyTo(this),e.setEmpty(),this}getXY(){return new t.Point2D(this.x,this.y)}queryXY(e){e.x=this.x,e.y=this.y}setXY(e){this.x=e.x,this.y=e.y}setXYCoords(e,t){this.x=e,this.y=t}getXYZ(){const e=new P;return e.x=this.x,e.y=this.y,e.z=this.getZ(),e}setXYZ(e){this.addAttribute(1),this.x=e.x,this.y=e.y,this.m_attribs[0]=e.z}getX(){return this.x}setX(e){this.x=e}getY(){return this.y}setY(e){this.y=e}getZ(){return this.m_description.hasZ()?this.m_attribs[0]:$.getDefaultValue(1)}setZ(e){this.addAttribute(1),this.m_attribs[0]=e}getM(){return this.getAttributeAsDbl(2,0)}setM(e){this.addAttribute(2),this.m_description.hasZ()?this.m_attribs[1]=e:this.m_attribs[0]=e}getID(){return this.getAttributeAsInt(3,0)}setID(e){this.setAttributeBasic(3,0,e)}isEqualXY(e,t){return void 0===t&&(t=0),Math.abs(e.x-this.x)<=t&&Math.abs(e.y-this.y)<=t}isEqualXYCoords(e,t,i){return void 0===i&&(i=0),Math.abs(e-this.x)<=i&&Math.abs(t-this.y)<=i}getAttributeAsDbl(e,t){if(0===e){if(0===t)return this.x;if(1===t)return this.y;n.throwOutOfRangeException("")}const i=$.getComponentCount(e);(t<0||t>=i)&&n.throwOutOfRangeException("");const s=this.m_description.getAttributeIndex(e);return s>=0?this.m_attribs[this.m_description.getPointAttributeOffset(s)-2+t]:$.getDefaultValue(e)}getAttributeAsInt(e,t){return Math.trunc(this.getAttributeAsDbl(e,t))}setAttributeBasic(e,t,i){if(0===e)return void(0===t?this.x=i:1===t?this.y=i:n.throwOutOfRangeException(""));const s=$.getComponentCount(e);(t<0||t>=s)&&n.throwOutOfRangeException("");let r=this.m_description.getAttributeIndex(e);r<0&&(this.addAttribute(e),r=this.m_description.getAttributeIndex(e)),this.m_attribs[this.m_description.getPointAttributeOffset(r)-2+t]=i}copyAttributesFrom(e,t){if(this===e)return;const i=e.getDescription();for(let n=t&&i.hasZ()?2:1,s=i.getAttributeCount();n<s;++n){const t=i.getSemantics(n),s=$.getComponentCount(t);for(let i=0;i<s;++i){const n=e.getAttributeAsDbl(t,i);this.setAttributeBasic(t,i,n)}}}getAttributeArray(){return this.m_attribs}getDescription(){return this.m_description}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;const t=_(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;const t=f(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){const e=y();e!==this.m_description&&this.assignVertexDescription(e)}getGeometryType(){return n.GeometryType.enumPoint}getDimension(){return 0}queryEnvelope(e){if(e instanceof ie)return e.setEmpty(),e.assignVertexDescription(this.m_description),void e.merge(this);if(e instanceof b){if(this.isEmpty())return void e.setEmpty();const t=this.getXYZ();return e.xmin=t.x,e.ymin=t.y,e.zmin=t.z,e.xmax=t.x,e.ymax=t.y,void(e.zmax=t.z)}this.isEmpty()?e.setEmpty():(e.xmin=this.x,e.ymin=this.y,e.xmax=this.x,e.ymax=this.y)}queryLooseEnvelope(e){this.queryEnvelope(e)}queryInterval(e,i){const n=new t.Envelope1D;if(this.isEmpty())return n.setEmpty(),n;const s=this.getAttributeAsDbl(e,i);return n.vmin=s,n.vmax=s,n}applyTransformation(e){if(!this.isEmpty()){if(1===e.m_TransformationType){const t=this.getXY();return e.transformInPlace(t),void this.setXY(t)}n.throwNotImplementedException("3d not impl")}}transformAttribute(e,t,i,n,s){if(this.isEmpty())return;this.addAttribute(e);const r=this.getAttributeAsDbl(e,t),o=Y(i,n,s);this.setAttributeBasic(e,t,o(r))}createInstance(){return new K({vd:this.m_description})}copyTo(e){if(this===e)return;e.getGeometryType()!==n.GeometryType.enumPoint&&n.throwInvalidArgumentException();const t=e;t.x=this.x,t.y=this.y,this.m_attribs?(t.assignVertexDescription(this.m_description),t.m_attribs=this.m_attribs.slice()):(t.releaseAttributes(),t.assignVertexDescription(this.m_description))}isEmpty(){return Number.isNaN(this.x)||Number.isNaN(this.y)}setEmpty(){this.m_description||(this.m_description=y(),this.releaseAttributes()),this.x=Number.NaN,this.y=Number.NaN,this.m_attribs&&t.memcpy(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,this.m_description.getTotalComponentCount()-2)}calculateArea2D(){return 0}calculateLength2D(){return 0}calculateLength3D(e){return 0}equals(e,i){if(e===this)return!0;if(e.getGeometryType()!==n.GeometryType.enumPoint)return!1;const s=e;if(this.m_description!==s.m_description)return!1;if(this.isEmpty()!==s.isEmpty())return!1;if(this.isEmpty())return!0;if(void 0===i&&(i=0),Math.abs(this.x-s.x)>i)return!1;if(Math.abs(this.y-s.y)>i)return!1;for(let e=0,n=this.m_description.getTotalComponentCount()-2;e<n;e++)if(!t.isEqualNonIEEETol(this.m_attribs[e],s.m_attribs[e],i))return!1;return!0}getBoundary(){return null}clone(){const e=new K({vd:this.m_description});return this.copyTo(e),e}swap(e){if(this===e)return;e.getGeometryType()!==n.GeometryType.enumPoint&&n.throwInvalidArgumentException("wrong geometry type");const i=e;i.m_description=t.swap(this.m_description,this.m_description=i.m_description),i.x=t.swap(this.x,this.x=i.x),i.y=t.swap(this.y,this.y=i.y),i.m_attribs=t.swap(this.m_attribs,this.m_attribs=i.m_attribs)}replaceNaNs(e,t){if(this.addAttribute(e),this.isEmpty())return;const i=$.getComponentCount(e);for(let n=0;n<i;n++){const i=this.getAttributeAsDbl(e,n);Number.isNaN(i)&&this.setAttributeBasic(e,n,t)}}lerp(e,i,s){if(e.getDescription()!==i.getDescription()&&n.throwInvalidArgumentException("Point.lerp"),this.assignVertexDescription(e.getDescription()),e.isEmpty()||i.isEmpty())return this.setEmpty(),this;this.ensureAttributes();const r=c();e.queryValues(r,r.length);const o=c();i.queryValues(o,o.length);const a=c();let l=r,h=o;const u=a;let m=0;for(let e=0,i=this.m_description.getAttributeCount();e<i;e++){const i=this.m_description.getSemantics(e),n=$.getInterpolation(i),r=$.getComponentCount(i),o=$.getDefaultValue(i);t.interpolateArray(n,l,h,u,m,r,s,o),l=l.slice(r),h=h.slice(r),m+=r}return this.setValues(a,m),this}static lerp(e,t,i,n){n.lerp(e,t,i)}setDefaultAttributeValues(){const e=this.m_description.getTotalComponentCount()-2;e>0&&(this.m_attribs?t.memcpy(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,e):this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}static sqrDistance2D(e,i){return t.Point2D.sqrDistanceCoords(e.x,e.y,i.x,i.y)}getImpl(){return this}mergeVertexDescriptionImpl(e){const t=g(this.getDescription(),e);this.assignVertexDescription(t)}releaseAttributes(){this.m_attribs=null}assignVertexDescriptionImpl(e){this.m_description||(this.m_description=y());const t=m();v(e,this.m_description,t);let i=null;e.getTotalComponentCount()-2>0&&(i=e.getDefaultPointAttributes().slice(2));for(let n=1,s=e.getAttributeCount();n<s;n++){const s=t[n];if(-1!==s){const t=this.m_description.getPointAttributeOffset(s)-2,r=e.getPointAttributeOffset(n)-2,o=$.getComponentCount(e.getSemantics(n));for(let e=0;e<o;e++)i[r+e]=this.m_attribs[t+e]}}this.m_attribs=i,this.m_description=e}ensureAttributes(){this.m_description.getTotalComponentCount()-2>0&&null===this.m_attribs&&(this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}queryValues(e,i){const s=this.m_description.getTotalComponentCount();n.geometryReleaseAssert(s<=i),e[0]=this.x,e[1]=this.y,t.memcpy(e,this.m_attribs,2,0,s-2)}copyCommonAttributesTo(e){e.x=this.x,e.y=this.y;const i=e.getDescription();if(i===this.m_description)this.m_attribs&&t.memcpy(e.m_attribs,this.m_attribs,0,0,this.m_description.getTotalComponentCount()-2);else{let t=0;for(let n=1,s=i.getAttributeCount();n<s;n++){const s=i.getSemantics(n);let r=$.getComponentCount(s);if(this.m_description.hasAttribute(s)){let i=this.m_description.getPointAttributeOffset(this.m_description.getAttributeIndex(s))-2;for(;0!==r;)e.m_attribs[t++]=this.m_attribs[i++],r--}else{const i=$.getDefaultValue(s);for(;0!==r;)e.m_attribs[t++]=i,r--}}}}setValues(e,i){const s=this.m_description.getTotalComponentCount();n.geometryReleaseAssert(s<=i),this.x=e[0],this.y=e[1],t.memcpy(this.m_attribs,e,0,2,s-2)}dbgDefaultAttribs(){}}K.type=n.GeometryType.enumPoint;var J=h;function ee(e,t){return t*(e.getTotalComponentCount()-2)}class te{constructor(e){if(this.m_attributes=null,e)if(void 0!==e.xmin)this.m_envelope2D=new i.Envelope2D(e.xmin,e.ymin,e.xmax,e.ymax);else if(void 0!==e.env2D)this.m_envelope2D=new i.Envelope2D(e.env2D);else if(e.move)this.m_envelope2D=new i.Envelope2D(e.move.m_envelope2D),this.m_attributes=e.move.m_attributes,e.move.m_attributes=null;else{if(!e.moveEnv)throw new Error("unrecognized EnvelopeData constructor options");{const t=e.moveEnv.accessEnvelopeData();this.m_envelope2D=new i.Envelope2D(t.m_envelope2D),this.m_attributes=t.m_attributes,t.m_attributes=null}}else this.m_envelope2D=i.Envelope2D.constructEmpty()}ensureAttributes(e){const i=e.getTotalComponentCount()-2;!this.m_attributes&&i&&(this.m_attributes=t.makePrimitiveArray(2*i,Number.NaN),this.m_attributes.fill(Number.NaN))}copyTo(e,s){const r=s,o=e.getTotalComponentCount()-2;if(r.m_description!==e&&(r.releaseAttributes_(),r.m_description=e,o&&(r.m_data.m_attributes=t.makePrimitiveArray(2*o,Number.NaN))),o){n.geometryReleaseAssert(this.m_attributes&&r.m_data.m_attributes);const e=2*o;t.memcpy(r.m_data.m_attributes,this.m_attributes,0,0,e)}r.m_data.m_envelope2D=new i.Envelope2D(this.m_envelope2D)}copyToIfNotNull(e,t){t.m_envelope2D=new i.Envelope2D(this.m_envelope2D),t.releaseAttributes(),e.getTotalComponentCount()-2&&this.m_attributes&&(t.m_attributes=this.m_attributes.slice())}releaseAttributes(){this.m_attributes=null}isEmpty(){return this.m_envelope2D.isEmpty()}transformAttribute(e,t,i,s,r){n.geometryReleaseAssert(0)}queryInterval(e,t,i,s){if(this.isEmpty())return void s.setEmpty();if(0===t)return void(0===i?this.m_envelope2D.queryIntervalX(s):1===i?this.m_envelope2D.queryIntervalY(s):n.throwOutOfRangeException(""));const r=J.getComponentCount(t);(i<0||i>=r)&&n.throwOutOfRangeException("");const o=e.getAttributeIndex(t);if(o>=0)return s.vmin=this.m_attributes[ee(e,0)+e.getPointAttributeOffset(o)-2+i],void(s.vmax=this.m_attributes[ee(e,1)+e.getPointAttributeOffset(o)-2+i]);{const e=J.getDefaultValue(t);return void s.setCoords(e,e)}}queryEnvelope3D(e,i){const n=new t.Envelope1D;this.queryInterval(e,1,0,n),i.setCoords(this.m_envelope2D.xmin,this.m_envelope2D.ymin,n.vmin,this.m_envelope2D.xmax,this.m_envelope2D.ymax,n.vmax)}setEmpty(e){this.m_envelope2D.setEmpty();const i=e.getTotalComponentCount()-2;i&&(this.m_attributes?this.dbgAssertSize(i):this.m_attributes=t.makePrimitiveArray(2*i,Number.NaN),this.m_attributes.fill(Number.NaN))}dbgAssertSize(e){}}let ie=class e{constructor(e){if(this.m_EnvelopeType=4,this.m_description=y(),void 0===e)this.m_data=new te;else if(void 0!==e.vd)this.m_description=e.vd,this.m_data=new te,this.ensureAttributes_();else if(e?.env2D)this.m_data=new te({env2D:e.env2D});else if(void 0!==e.xmin)this.m_data=new te({xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax});else if(e.copy)this.m_data=new te,e.copy.copyTo(this);else if(e.move)this.m_description=e.move.m_description,e.move.m_description=null,this.m_data=new te({move:e.move.m_data});else{if(!e.centerPoint)throw new Error("unrecognized Envelope constructor options");this.m_description=e.centerPoint.getDescription(),this.m_data=new te,this.ensureAttributes_(),this.setFromPoint(e.centerPoint,e.width,e.height)}}accessEnvelopeData(){return this.m_description=null,this.m_data}assignMove(e){return this===e||(this.m_description=e.m_description,e.m_description=null,this.m_data=new te({move:e.m_data})),this}assignCopy(e){return this===e||e.copyTo(this),this}transformAttribute(e,t,i,s,r){n.geometryReleaseAssert(0)}setAttributeBasic(e,t,i){if(this.addAttribute(e),this.m_data.isEmpty())return;const n=this.queryInterval(e,t);n.vmin=i,n.vmax=i,this.setIntervalEnvelope(e,t,n)}mergeVertexDescriptionImpl(e){const t=g(this.getDescription(),e);this.assignVertexDescription(t)}asEnvelope2D(){return new i.Envelope2D(this.m_data.m_envelope2D)}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}getGeometryType(){return n.GeometryType.enumEnvelope}getDimension(){return 2}getXMin(){return this.m_data.m_envelope2D.xmin}getYMin(){return this.m_data.m_envelope2D.ymin}getXMax(){return this.m_data.m_envelope2D.xmax}getYMax(){return this.m_data.m_envelope2D.ymax}width(){return this.m_data.isEmpty()?Number.NaN:this.m_data.m_envelope2D.width()}height(){return this.m_data.isEmpty()?Number.NaN:this.m_data.m_envelope2D.height()}getCenterXY(){return this.m_data.isEmpty()?new t.Point2D:this.m_data.m_envelope2D.getCenter()}getCenter(e){if(e.assignVertexDescription(this.m_description),this.m_data.isEmpty())return void e.setEmpty();const t=this.m_description.getAttributeCount();for(let i=1;i<t;i++){const t=this.m_description.getSemantics(i),n=J.getComponentCount(t);for(let i=0;i<n;i++){const n=.5*(this.getAttributeAsDblImpl(0,t,i)+this.getAttributeAsDblImpl(1,t,i));e.setAttributeBasic(t,i,n)}}e.setXY(this.m_data.m_envelope2D.getCenter())}setCoords(e,t,i,n){this.m_data.m_envelope2D.setCoords({xmin:e,ymin:t,xmax:i,ymax:n})}setEnvelope(e){if(e instanceof i.Envelope2D)this.m_data.m_envelope2D=new i.Envelope2D(e),this.m_data.m_envelope2D.normalize();else{this.addAttribute(1),this.m_data.m_envelope2D=e.getEnvelope2D(),this.m_data.m_envelope2D.normalize();const i=t.Envelope1D.constructEmpty();i.setCoords(e.zmin,e.zmax),this.setInterval(1,0,i.vmin,i.vmax)}}merge(t){if(t instanceof i.Envelope2D)return t.isValid()||n.throwInvalidArgumentException(""),void this.m_data.m_envelope2D.mergeEnvelope2D(t);if(t instanceof e){if(t.m_data.isEmpty())return;const e=t.getDescription();this.mergeVertexDescription(e),this.m_data.m_envelope2D.mergeEnvelope2D(t.m_data.m_envelope2D);for(let i=1,n=e.getAttributeCount();i<n;i++){const n=e.getSemantics(i),s=J.getComponentCount(n);for(let e=0;e<s;e++){const i=t.queryInterval(n,e),s=this.queryInterval(n,e);s.merge(i),this.setIntervalEnvelope(n,e,s)}}}else if(t instanceof K){const e=t;if(e.isEmpty())return;const i=e.getDescription();if(this.mergeVertexDescription(i),this.m_data.isEmpty())return void this.setFromPoint(e);this.m_data.m_envelope2D.merge(e.getXY());for(let t=1,n=i.getAttributeCount();t<n;t++){const n=i.getSemantics(t),s=J.getComponentCount(n);for(let t=0;t<s;t++){const i=e.getAttributeAsDbl(n,t),s=this.queryInterval(n,t);s.mergeCoordinate(i),this.setIntervalEnvelope(n,t,s)}}}else n.throwNotImplementedException("unrecognized type for envelope.merge")}intersect(e){if(!this.m_data.m_envelope2D.intersect(e.m_data.m_envelope2D))return this.setEmpty(),!1;const t=e.getDescription();this.mergeVertexDescription(t);for(let t=1,i=this.m_description.getAttributeCount();t<i;t++){const i=this.m_description.getSemantics(t),n=J.getComponentCount(i);for(let t=0;t<n;t++){const n=e.queryInterval(i,t),s=this.queryInterval(i,t);s.intersect(n),this.setIntervalEnvelope(i,t,s)}}return!0}intersectCommonAttributes(e){if(!this.m_data.m_envelope2D.intersect(e.m_data.m_envelope2D))return this.setEmpty(),!1;const t=e.getDescription();for(let i=1,n=this.m_description.getAttributeCount();i<n;i++){const n=this.m_description.getSemantics(i);if(!t.hasAttribute(n))continue;const s=J.getComponentCount(n);for(let t=0;t<s;t++){const i=e.queryInterval(n,t),s=this.queryInterval(n,t);s.intersect(i),this.setIntervalEnvelope(n,t,s)}}return!0}move(e,t){this.m_data.m_envelope2D.move(e,t)}centerAt(e,t){this.m_data.m_envelope2D.centerAtCoords(e,t)}centerAtPoint(e){this.m_data.m_envelope2D.centerAt(e)}reaspect(e,t){this.m_data.m_envelope2D.reaspect(e,t)}inflateCoords(e,t){this.m_data.m_envelope2D.inflateCoords(e,t)}containsCoords(e,t){return this.m_data.m_envelope2D.containsCoords(e,t)}contains(e){return this.m_data.m_envelope2D.contains(e)}containsPoint(e){return!e.isEmpty()&&this.m_data.m_envelope2D.contains(e.getXY())}containsEnvelope(e){return this.m_data.m_envelope2D.containsEnvelope(e.m_data.m_envelope2D)}setIntervalEnvelope(e,i,s){if(this.addAttribute(e),this.m_data.isEmpty())return;const r=new t.Envelope1D(s);if(r.normalize(),0===e){if(r.isEmpty())return void this.setEmpty();0===i?(this.m_data.m_envelope2D.xmin=r.vmin,this.m_data.m_envelope2D.xmax=r.vmax):1===i?(this.m_data.m_envelope2D.ymin=r.vmin,this.m_data.m_envelope2D.ymax=r.vmax):n.throwOutOfRangeException("")}else this.setAttributeAsDblImpl(0,e,i,r.vmin),this.setAttributeAsDblImpl(1,e,i,r.vmax)}setInterval(e,i,n,s){this.setIntervalEnvelope(e,i,new t.Envelope1D(n,s))}queryInterval(e,i){const n=new t.Envelope1D;return this.m_data.queryInterval(this.m_description,e,i,n),n}queryEnvelope(e){2!==e.m_EnvelopeType?3!==e.m_EnvelopeType?4!==e.m_EnvelopeType?n.throwNotImplementedException("unrecognized type for queryEnveloper"):this.copyTo(e):this.m_data.queryEnvelope3D(this.m_description,e):e.setCoords({env2D:this.m_data.m_envelope2D})}applyTransformation(e){1!==e.m_TransformationType?n.geometryReleaseAssert(0):e.transformEnvInPlace(this.m_data.m_envelope2D)}createInstance(){return new e({vd:this.m_description})}copyTo(e){e!==this&&this.m_data.copyTo(this.m_description,e)}isEmpty(){return this.m_data.isEmpty()}setEmpty(){this.m_description||(this.m_description=y()),this.m_data.setEmpty(this.m_description)}calculateArea2D(){return this.m_data.m_envelope2D.getArea()}calculateLength2D(){return this.m_data.m_envelope2D.getLength()}calculateLength3D(e){return n.geometryReleaseAssert(0),0}equals(e,i){if(e===this)return!0;const n=e;if(this.m_description!==n.m_description)return!1;if(this.m_data.isEmpty()!==n.m_data.isEmpty())return!1;if(this.m_data.isEmpty())return!0;if(void 0===i&&(i=0),Math.abs(this.m_data.m_envelope2D.xmin-n.m_data.m_envelope2D.xmin)>i)return!1;if(Math.abs(this.m_data.m_envelope2D.ymin-n.m_data.m_envelope2D.ymin)>i)return!1;if(Math.abs(this.m_data.m_envelope2D.xmax-n.m_data.m_envelope2D.xmax)>i)return!1;if(Math.abs(this.m_data.m_envelope2D.ymax-n.m_data.m_envelope2D.ymax)>i)return!1;for(let e=0,s=2*(this.m_description.getTotalComponentCount()-2);e<s;e++)if(!t.isEqualNonIEEETol(this.m_data.m_attributes[e],n.m_data.m_attributes[e],i))return!1;return!0}getBoundary(){return n.throwNotImplementedException("getBoundary not available in this context. Use the boundary operator with an envelope parameter"),null}clone(){return new e({copy:this})}swap(e){if(this===e)return;e.getGeometryType()!==n.GeometryType.enumEnvelope&&n.throwInvalidArgumentException("wrong geometry type");const i=e;i.m_description=t.swap(this.m_description,this.m_description=i.m_description),i.m_data.m_envelope2D=t.swap(this.m_data.m_envelope2D,this.m_data.m_envelope2D=i.m_data.m_envelope2D),i.m_data.m_attributes=t.swap(this.m_data.m_attributes,this.m_data.m_attributes=i.m_data.m_attributes)}queryCoordinates(e){this.m_data.isEmpty()&&n.throwInvalidArgumentException(""),this.m_data.m_envelope2D.queryCorners(e)}queryCornerByVal(e,t){(e<0||e>3)&&n.throwOutOfRangeException(""),t.assignVertexDescription(this.m_description);const i=this.getDescription().getAttributeCount();for(let n=1;n<i;n++){const i=this.m_description.getSemantics(n),s=J.getComponentCount(i);for(let n=0;n<s;n++)t.setAttributeBasic(i,n,this.getAttributeAsDblImpl(e%2,i,n))}t.setXY(this.m_data.m_envelope2D.queryCorner(e))}queryCorner(e,t){t.assign(this.m_data.m_envelope2D.queryCorner(e))}getDescription(){return this.m_description}mergeVertexDescription(e){this.m_description!==e&&(this.m_description&&this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;const t=_(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;const t=f(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){const e=y();e!==this.m_description&&this.assignVertexDescription(e)}queryLooseEnvelope(e){this.queryEnvelope(e)}replaceNaNs(e,t){if(this.addAttribute(e),this.m_data.isEmpty())return;const i=J.getComponentCount(e);for(let n=0;n<i;n++){const i=this.queryInterval(e,n);i.isEmpty()&&(i.vmin=t,i.vmax=t,this.setIntervalEnvelope(e,n,i))}}getImpl(){return this}setFromPoint(e,t,i){this.m_data.m_envelope2D.setCoords({center:e.getXY(),width:t??0,height:i??0});const n=e.getDescription();for(let t=1,i=n.getAttributeCount();t<i;t++){const i=n.getSemantics(t),s=J.getComponentCount(i);for(let t=0;t<s;t++){const n=e.getAttributeAsDbl(i,t);this.setInterval(i,t,n,n)}}}assignVertexDescriptionImpl(e){const i=m();v(e,this.m_description,i);let n=null;const s=e.getTotalComponentCount()-2,r=this.m_description?this.m_description.getTotalComponentCount()-2:0;s>0&&(n=t.makePrimitiveArray(2*s,Number.NaN));for(let o=1;o<e.getAttributeCount();o++){const a=i[o];if(-1!==a){const i=e.getPointAttributeOffset(o)-2,l=J.getComponentCount(e.getSemantics(o)),c=this.m_description.getPointAttributeOffset(a)-2;t.memcpy(n,this.m_data.m_attributes,i,c,l),t.memcpy(n,this.m_data.m_attributes,s+i,r+c,l)}}this.releaseAttributes_(),this.m_data.m_attributes=n,this.m_description=e}getAttributeAsDblImpl(e,t,i){if(this.m_data.isEmpty()&&n.throwEmptyGeometryException(""),0===t)return e?i?this.m_data.m_envelope2D.ymax:this.m_data.m_envelope2D.xmax:i?this.m_data.m_envelope2D.ymin:this.m_data.m_envelope2D.xmin;i>=J.getComponentCount(t)&&n.throwOutOfRangeException("");const s=this.m_description.getAttributeIndex(t);return s>=0?this.m_data.m_attributes[ee(this.m_description,e)+this.m_description.getPointAttributeOffset(s)-2+i]:h.getDefaultValue(t)}setAttributeAsDblImpl(e,t,i,s){0===t&&(e?1===i?this.m_data.m_envelope2D.ymax=s:0===i?this.m_data.m_envelope2D.xmax=s:n.throwOutOfRangeException(""):1===i?this.m_data.m_envelope2D.ymin=s:0===i?this.m_data.m_envelope2D.xmin=s:n.throwOutOfRangeException(""));const r=J.getComponentCount(t);(i<0||i>=r)&&n.throwOutOfRangeException(""),this.addAttribute(t);const o=this.m_description.getAttributeIndex(t);this.m_data.m_attributes[ee(this.m_description,e)+this.m_description.getPointAttributeOffset(o)-2+i]=s}releaseAttributes_(){this.m_data.releaseAttributes()}ensureAttributes_(){this.m_data.ensureAttributes(this.m_description)}};ie.type=n.GeometryType.enumEnvelope;const ne=Object.freeze(Object.defineProperty({__proto__:null,Envelope:ie,EnvelopeData:te},Symbol.toStringTag,{value:"Module"}));e.AttributeStreamOfDbl=I,e.AttributeStreamOfInt32=T,e.AttributeStreamOfInt8=w,e.BucketSort=A,e.CombinedTolerance=z,e.Comparator=G,e.Envelope=ie,e.Envelope$1=ne,e.Envelope2DIntersector=H,e.Envelope3D=b,e.EnvelopeData=te,e.IndexMultiDCList=V,e.OrdinateBufferLength=25,e.Point=K,e.Point3D=P,e.StridedIndexTypeCollection=M,e.Treap=k,e.VertexDescription=h,e.adjustToleranceForTEClustering=function(e){return Math.sqrt(2)*(2*e.tolerance+e.resolution)},e.adjustToleranceForTECracking=function(e){return Math.sqrt(2)*(e.tolerance+e.resolution)},e.applyShiftAndScale=Y,e.buildQuadTree=function(e,t){if(!t){const t=new i.Envelope2D;e.queryLooseEnvelope(t);const s=new N(t,8);let r=-1;const o=new i.Envelope2D,a=e.querySegmentIterator();let l=!1;for(;a.nextPath();)for(;a.hasNextSegment();){const i=a.nextSegment(),c=a.getStartPointIndex();if(i.queryLooseEnvelope(o),r=s.insertEx(c,o,r),-1===r){l&&n.throwInternalErrorException(""),t.assign(e.calculateEnvelope2D(!1)),l=!0,s.reset(t,8),a.resetToFirstPath();break}}return s}const s=new i.Envelope2D;e.queryLooseEnvelope(s);const r=new N(s,8);let o=-1;const a=new i.Envelope2D,l=e.querySegmentIterator();let c=!1;for(;l.nextPath();)for(;l.hasNextSegment();){const i=l.nextSegment(),h=l.getStartPointIndex();if(i.queryLooseEnvelope(a),a.isIntersecting(t)&&(o=r.insertEx(h,a,o),-1===o)){c&&n.throwInternalErrorException(""),s.assign(e.calculateEnvelope2D(!1)),c=!0,r.reset(s,8),l.resetToFirstPath();break}}return r},e.buildQuadTreeForPaths=function(e){const t=new i.Envelope2D;return e.queryLooseEnvelope(t),t.inflateCoords(1,1),function(e,t){const s=new i.Envelope2D;if(e.queryLooseEnvelope(s),s.isEmpty())return null;e.getGeometryType();const r=new N(s,8);let o=-1;const a=new i.Envelope2D;let l=!1;do{for(let i=0,c=e.getPathCount();i<c;i++)if(e.queryLoosePathEnvelope(i,a),a.isIntersecting(t)){if(o=r.insertEx(i,a,o),-1===o){l&&n.throwInternalErrorException("build_quad_tree_for_paths"),s.assign(e.calculateEnvelope2D(!1)),l=!0,r.reset(s,8);break}l=!1}}while(l);return r}(e,t)},e.buildQuadTreeMpt=function(e,s){if(s){const r=new N(s,8),o=new t.Point2D,a=new i.Envelope2D;let l=!1;for(let t=0;t<e.getPointCount();t++)o.setCoordsPoint2D(e.getXY(t)),s.contains(o)&&(a.setCoords({pt:o}),-1!==r.insert(t,a)||(l&&n.throwInternalErrorException(""),l=!0,r.reset(e.calculateEnvelope2D(),8),t=-1));return r}return n.throwNotImplementedException("no-extent version not yet impl"),null},e.c_deadBeef=-559038737,e.calculateToleranceFromGeometryForOp=B,e.calculateToleranceFromGeometryForOpFromGeom=function(e,t,n){const s=i.Envelope2D.constructEmpty();return t.queryEnvelope(s),B(e,s,n)},e.calculateToleranceFromGeometryForRel=j,e.calculateToleranceFromGeometryForRelGeom=function(e,t,n){const s=i.Envelope2D.constructEmpty();return t.queryEnvelope(s),j(e,s,n)},e.calculateToleranceFromPointsForOps=function(e,t,n){const s=i.Envelope2D.constructEmpty();return s.setFromPoints(e,t),W(0,null,s.calculateToleranceFromEnvelope(),n,!1)},e.calculateZToleranceFromGeometryForOpEnv1D=X,e.calculateZToleranceFromGeometryForOpFromGeom=function(e,t,i){return X(e,t.queryInterval(1,0),i)},e.checkFinite=function(e,t){return Number.isFinite(e)&&Number.isFinite(t)},e.checkNanOrFinite=function(e,t){return(Number.isFinite(e)||Number.isNaN(e))&&(Number.isFinite(t)||Number.isNaN(t))},e.createAttributeMap=m,e.createAttributeStream=S,e.createAttributeStreamFromSemantics=function(e,t){const i=E.getComponentCount(e);return S(E.getPersistence(e),t*i,E.getDefaultValue(e))},e.createAttributeStreamUninitialized=function(e,t){const i=E.getComponentCount(e);return S(E.getPersistence(e),t*i)},e.createByteStream=function(e,t){return new w(e,t)},e.createDoubleStream=function(e,t){return new I(e,t)},e.createIndexStream=function(e,t){return new T(e,t)},e.getDefaultDescription2D=y,e.getDefaultDescription3D=x,e.getEnvelope2DIntersector=function(e,t,n){const s=i.Envelope2D.constructEmpty(),r=i.Envelope2D.constructEmpty();e.queryLooseEnvelope(s),t.queryLooseEnvelope(r),s.inflateCoords(n,n),r.inflateCoords(n,n);const o=i.Envelope2D.constructEmpty();o.setCoords({env2D:s}),o.intersect(r);const a=e.querySegmentIterator(),l=t.querySegmentIterator(),c=i.Envelope2D.constructEmpty(),h=i.Envelope2D.constructEmpty(),u=new H;u.setTolerance(n);let m=!1;for(u.startRedConstruction();a.nextPath();)for(;a.hasNextSegment();)a.nextSegment().queryLooseEnvelope(c),c.isIntersecting(o)&&(m=!0,u.addRedEnvelope(a.getStartPointIndex(),c));if(u.endRedConstruction(),!m)return null;let d=!1;for(u.startBlueConstruction();l.nextPath();)for(;l.hasNextSegment();)l.nextSegment().queryLooseEnvelope(h),h.isIntersecting(o)&&(d=!0,u.addBlueEnvelope(l.getStartPointIndex(),h));return u.endBlueConstruction(),d?u:null},e.getEnvelope2DIntersectorForParts=function(e,t,n,s,r){e.getGeometryType(),t.getGeometryType();const o=i.Envelope2D.constructEmpty(),a=i.Envelope2D.constructEmpty();e.queryLooseEnvelope(o),t.queryLooseEnvelope(a),o.inflateCoords(n,n),a.inflateCoords(n,n);const l=i.Envelope2D.constructEmpty();l.setCoords({env2D:o}),l.intersect(a);const c=new H;c.setTolerance(n);let h=!1;c.startRedConstruction();for(let t=0,i=e.getPathCount();t<i;t++)e.queryLoosePathEnvelope(t,o),o.isIntersecting(l)&&(h=!0,c.addRedEnvelope(t,o));if(c.endRedConstruction(),!h)return null;let u=!1;c.startBlueConstruction();for(let e=0,i=t.getPathCount();e<i;e++)t.queryLoosePathEnvelope(e,a),a.isIntersecting(l)&&(u=!0,c.addBlueEnvelope(e,a));return c.endBlueConstruction(),u?c:null},e.getEnvelope2DIntersectorMptMpt=function(e,n,s){const r=i.Envelope2D.constructEmpty(),o=i.Envelope2D.constructEmpty();e.queryEnvelope(r),n.queryEnvelope(o),r.inflateCoords(s,s),o.inflateCoords(s,s);const a=i.Envelope2D.constructEmpty();a.setCoords({env2D:r}),a.intersect(o);const l=new H;l.setTolerance(s);let c=!1;l.startRedConstruction();const h=new t.Point2D;for(let t=0,n=e.getPointCount();t<n;t++)e.queryXY(t,h),a.contains(h)&&(c=!0,l.addRedEnvelope(t,i.Envelope2D.construct(h.x,h.y,h.x,h.y)));if(l.endRedConstruction(),!c)return null;let u=!1;l.startBlueConstruction();const m=new t.Point2D;for(let e=0,t=n.getPointCount();e<t;e++)n.queryXY(e,m),a.contains(m)&&(u=!0,l.addBlueEnvelope(e,i.Envelope2D.construct(m.x,m.y,m.x,m.y)));return l.endBlueConstruction(),u?l:null},e.getEnvelope2DIntersectorMpthMpt=function(e,t,n){const s=i.Envelope2D.constructEmpty(),r=i.Envelope2D.constructEmpty();e.queryLooseEnvelope(s),t.queryEnvelope(r),s.inflateCoords(n,n),r.inflateCoords(n,n);const o=i.Envelope2D.constructEmpty();o.setCoords({env2D:s}),o.intersect(r);const a=e.querySegmentIterator(),l=new H;l.setTolerance(n);let c=!1;for(l.startRedConstruction();a.nextPath();)for(;a.hasNextSegment();)a.nextSegment().queryLooseEnvelope(s),s.isIntersecting(o)&&(c=!0,l.addRedEnvelope(a.getStartPointIndex(),s));if(l.endRedConstruction(),!c)return null;let h=!1;l.startBlueConstruction();for(let e=0,n=t.getPointCount();e<n;e++){const n=t.getXY(e);o.contains(n)&&(h=!0,l.addBlueEnvelope(e,i.Envelope2D.construct(n.x,n.y,n.x,n.y)))}return l.endBlueConstruction(),h?l:null},e.getMergedExtent=function(e,t){const n=i.Envelope2D.constructEmpty();e.queryLooseEnvelope(n);const s=i.Envelope2D.constructEmpty();return t.queryLooseEnvelope(s),n.mergeEnvelope2D(s),n},e.getMergedExtentEnv2D=function(e,t){const n=new i.Envelope2D;return e.queryLooseEnvelope(n),n.mergeEnvelope2D(t),n},e.getMergedVertexDescription=g,e.getMergedVertexDescriptionSemantics=_,e.isAngleTooSharp=function(e,i,n,s,r){const o=s*s,a=e.sub(i),l=n.sub(i),c=a.sqrLength(),h=l.sqrLength();if(c<=o||h<=o)return!0;const u=t.sqr(a.crossProduct(l));return(u<=o*c||u<=o*h)&&a.dotProduct(l)>=0},e.isAtLeastPlanarSimple=function(e){return e>=4},e.isAtLeastSimpleAsFeature=function(e,t){return e===n.GeometryType.enumPolygon?Z(t):t>=1},e.isAtLeastWeakSimple=Z,e.isAtLeastWeakSimpleGeom=function(e,t){return e.getImpl().getIsSimple(t,[0])>=3},e.isCoincidentForClustering=function(e,i,n,s){if(t.sqr(i.x-e.x)+t.sqr(i.y-e.y)<=n*n){const n=e.z,r=i.z;return t.isEqualNonIEEETol(n,r,s)}return!1},e.mapAttributes=v,e.newOrdinateBuffer=c,e.removeSemanticsFromVertexDescription=f,e.setWeakSimple=function(e,t){e.getImpl().setIsSimple(3,t)},e.snapCoordinate=function e(t,i,s,r){if(!t.hasAttribute(s))return!1;const o=t.getGeometryType();if(o===n.GeometryType.enumGeometryCollection){const n=t,o=n.getGeometryCount();let a=0;for(let t=0;t<o;++t)a|=e(n.getGeometry(t),i,s,r)?1:0;return!!a}if(n.isMultiVertex(o)){const e=t,o=U.getPersistence(s),a=U.getComponentCount(s),l=e.getPointCount();if(1===o){const t=Q(e.getAttributeStreamRef(s),l*a,r,a,i);return t&&e.notifyModified(),t}if(2===o){const t=Q(e.getAttributeStreamRef(s),l*a,r,a,i);return t&&e.notifyModified(),t}n.throwInternalErrorException("snap_coordinate not implemented")}if(o===n.GeometryType.enumEnvelope){const e=t,n=e.queryInterval(s,r);let o=!1;return n.vmin<i.vmin&&(o=!0,n.vmin=i.vmin),n.vmax>i.vmax&&(o=!0,n.vmax=i.vmax),o&&e.setIntervalEnvelope(s,r,n),o}if(o===n.GeometryType.enumPoint){const e=t;let n=e.getAttributeAsDbl(s,r),o=!1;return n<i.vmin&&(o=!0,n=i.vmin),n>i.vmax&&(o=!0,n=i.vmax),o&&e.setAttributeBasic(s,r,n),o}if(n.isSegment(o)){const e=t;let n=e.getStartAttributeAsDbl(s,r),o=!1;return n<i.vmin&&(o=!0,n=i.vmin),n>i.vmax&&(o=!0,n=i.vmax),o&&e.setStartAttribute(s,r,n),n=e.getEndAttributeAsDbl(s,r),n<i.vmin&&(o=!0,n=i.vmin),n>i.vmax&&(o=!0,n=i.vmax),o&&e.setEndAttribute(s,r,n),o}n.throwInternalErrorException("snap_coordinate not implemented")}}))},"esri/chunks/Point2D":function(){define(["exports","./Geometry"],(function(e,t){"use strict";class i{constructor(e){this.sum=e,this.compensation=0}assign(e){return this.compensation=e.compensation,this.sum=e.sum,this}reset(){this.sum=this.compensation=0}resetToStart(e){this.sum=e,this.compensation=0}normalize(){const e=[Number.NaN];this.sum=O(this.sum,this.compensation,e),this.compensation=e[0]}add(e){const t=this.sum+e;let i;if(Math.abs(this.sum)>=Math.abs(e)){const n=this.sum-t+e;i=this.compensation+n}else{const n=e-t+this.sum;i=this.compensation+n}this.sum=t,this.compensation=i}sub(e){this.add(-e)}addProduct(e,t){const i=[0],n=A(e,t,i);this.add(n),this.add(i[0])}mul(e){const t=new i(0);t.addProduct(this.sum,e),t.addProduct(this.compensation,e),this.assign(t)}getResult(){return this.sum+this.compensation}pe(e){return this.add(e),this}me(e){return this.add(-e),this}}const n=[5,1,2,1,3,1,2,1,4,1,2,1,3,1,2,1],s=[-1,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3];function r(e){let t=0;return 65535n&e||(t+=16,e>>=16n),255n&e||(t+=8,e>>=8n),15n&e||(t+=4,e>>=4n),t+n[Number(BigInt.asUintN(4,e))]}function o(e){let t=0;return 4294967295n&e||(t=32,e>>=32n),t+r(BigInt.asUintN(32,e))}class a{constructor(e,t){if(this.m_EnvelopeType=1,void 0!==e){if(e instanceof a)return this.vmin=e.vmin,void(this.vmax=e.vmax);this.vmin=e,this.vmax=t,this.normalize()}else this.setEmpty()}static construct(e,t){return new a(e,t)}static constructEmpty(){return new a}setCoords(e,t){this.vmin=e,this.vmax=t,this.normalize()}setCoordsFromEnvelope(e){this.vmin=e.vmin,this.vmax=e.vmax}setEmpty(){this.vmin=Number.NaN,this.vmax=Number.NaN}getCenter(){return.5*(this.vmin+this.vmax)}equalsRange(e,t){return ae(this.vmin,e)&&ae(this.vmax,t)}equals(e,t){return!(!this.isEmpty()||!e.isEmpty())||(void 0!==t?Math.abs(this.vmin-e.vmin)<=t&&Math.abs(this.vmax-e.vmax)<=t:this.vmin===e.vmin&&this.vmax===e.vmax)}width(){return this.vmax-this.vmin}isEmpty(){return Number.isNaN(this.vmin)||Number.isNaN(this.vmax)}isZero(){return this.vmin===this.vmax}setInfinite(){this.vmin=Number.NEGATIVE_INFINITY,this.vmax=Number.POSITIVE_INFINITY}move(e){this.isEmpty()||(this.vmin+=e,this.vmax+=e)}contains(e){return e.vmin>=this.vmin&&e.vmax<=this.vmax}containsCoordinate(e){return e>=this.vmin&&e<=this.vmax}containsRightExclusive(e){return e>=this.vmin&&e<this.vmax}containsExclusiveCoordinate(e){return e>this.vmin&&e<this.vmax}containsExclusive(e){return e.vmin>this.vmin&&e.vmax<this.vmax}isIntersecting(e){return this.vmin<=e.vmin?this.vmax>=e.vmin:e.vmax>=this.vmin}mergeCoordinate(e){if(this.isEmpty())return this.vmin=e,void(this.vmax=e);this.mergeNeCoordinate(e)}merge(e){if(e.isEmpty())return;const t=e.vmin,i=e.vmax;this.mergeCoordinate(t),this.mergeCoordinate(i)}mergeNe(e){const t=e.vmin,i=e.vmax;this.mergeNeCoordinate(t),this.mergeNeCoordinate(i)}mergeNeCoordinate(e){e<this.vmin?this.vmin=e:e>this.vmax&&(this.vmax=e)}intersect(e){this.isEmpty()||e.isEmpty()?this.setEmpty():(this.vmin<e.vmin&&(this.vmin=e.vmin),this.vmax>e.vmax&&(this.vmax=e.vmax),this.vmin>this.vmax&&this.setEmpty())}inflate(e){this.isEmpty()||(this.vmin-=e,this.vmax+=e,this.vmax<this.vmin&&this.setEmpty())}normalize(){this.vmin<=this.vmax||(this.vmin>this.vmax?this.vmax=Y(this.vmin,this.vmin=this.vmax):this.setEmpty())}isValid(){return this.isEmpty()||this.vmin<=this.vmax}snapClip(e){return xe(e,this.vmin,this.vmax)}calculateToleranceFromEnvelope(){return this.isEmpty()?fe():(Math.abs(this.vmin)+Math.abs(this.vmax)+1)*fe()}static unit(){return l}normalizeNoNAN(){this.vmin>this.vmax&&(this.vmax=Y(this.vmin,this.vmin=this.vmax))}setCoordsNoNAN(e,t){this.vmin=e,this.vmax=t,this.normalizeNoNAN()}clone(){return new a(this.vmin,this.vmax)}}const l=new a(0,1);class c{static getNAN(){return new c(Number.NaN)}constructor(e,t){this.m_value=e??0,this.m_eps=t??0}[Symbol.toPrimitive](e){return this}clone(){return new c(this.m_value,this.m_eps)}assign(e){return this.m_value=e.m_value,this.m_eps=e.m_eps,this}scaleError(e){this.m_eps*=e}setError(e){this.m_eps=e}set(e,t){return this.m_value=e,this.m_eps=t??0,this}setWithEps(e,t){return void 0===t&&(t=1),this.m_value=e,this.m_eps=c.ulp(e)*t,this}setE(e){return this.m_value=e.m_value,this.m_eps=e.m_eps,this}precise(){return new c(this.m_value)}value(){return this.m_value}toDouble(){return this.m_value}eps(){return this.m_eps}resetError(){return this.m_eps=0,this}absThis(){return this.m_value=Math.abs(this.m_value),this}add(e){return this.clone().addThis(e)}addE(e){return this.clone().addThisE(e)}addThisE(e){const t=this.m_value+e.m_value,i=this.m_eps+e.m_eps+c.ulp(t);return this.m_value=t,this.m_eps=i,this}addThis(e){const t=this.m_value+e,i=this.m_eps+c.ulp(t);return this.m_value=t,this.m_eps=i,this}subE(e){return this.clone().subThisE(e)}sub(e){return this.clone().subThis(e)}subThisE(e){const t=this.m_value-e.m_value,i=this.m_eps+e.m_eps+c.ulp(t);return this.m_value=t,this.m_eps=i,this}subThis(e){const t=this.m_value-e,i=this.m_eps+c.ulp(t);return this.m_value=t,this.m_eps=i,this}setAddE(e,t){return this.m_value=e.m_value+t.m_value,this.m_eps=e.m_eps+t.m_eps+c.ulp(this.m_value),this}setAdd(e,t){return this.m_value=e+t,this.m_eps=c.ulp(this.m_value),this}setAddEN(e,t){return this.m_value=e.m_value+t,this.m_eps=e.m_eps+c.ulp(this.m_value),this}setAddNE(e,t){return this.m_value=e+t.m_value,this.m_eps=t.m_eps+c.ulp(this.m_value),this}setSubE(e,t){return this.m_value=e.m_value-t.m_value,this.m_eps=e.m_eps+t.m_eps+c.ulp(this.m_value),this}setSub(e,t){return this.m_value=e-t,this.m_eps=c.ulp(this.m_value),this}setSubEN(e,t){return this.m_value=e.m_value-t,this.m_eps=e.m_eps+c.ulp(this.m_value),this}setSubNE(e,t){return this.m_value=e-t.m_value,this.m_eps=t.m_eps+c.ulp(this.m_value),this}mulThisE(e){const t=this.m_value*e.m_value;return this.m_eps=this.m_eps*Math.abs(e.m_value)+e.m_eps*Math.abs(this.m_value)+this.m_eps*e.m_eps+c.ulp(t),this.m_value=t,this}mulThis(e){const t=this.m_value*e;return this.m_eps=this.m_eps*Math.abs(e)+c.ulp(t),this.m_value=t,this}mul(e){return this.clone().mulThis(e)}mulE(e){return this.clone().mulThisE(e)}setMulE(e,t){const i=e.m_value*t.m_value;return this.m_eps=e.m_eps*Math.abs(t.m_value)+t.m_eps*Math.abs(e.m_value)+e.m_eps*t.m_eps+c.ulp(i),this.m_value=i,this}setMul(e,t){return this.m_value=e*t,this.m_eps=c.ulp(this.m_value),this}setMulEN(e,t){return this.setE(e),this.mulThis(t)}setMulNE(e,t){return this.setE(t),this.mulThis(e)}mulThisByPower2(e){return this.m_value*=e,this.m_eps*=Math.abs(e),this}static st_mulByPower2(e,t){return new c(e.m_value,e.m_eps).mulThisByPower2(t)}divE(e){return this.clone().divThisE(e)}divThisE(e){const t=Math.abs(e.m_value),i=this.m_value/e.m_value;let n=(this.m_eps+Math.abs(i)*e.m_eps)/t;if(e.m_eps>.01*t){const i=e.m_eps/t;n*=1+(1+i)*i}return this.m_value=i,this.m_eps=n+c.ulp(i),this}divThis(e){const t=Math.abs(e);return this.m_value/=e,this.m_eps=this.m_eps/t+c.ulp(this.m_value),this}setDivE(e,t){return this.setE(e),this.divThisE(t)}setDiv(e,t){return this.m_value=e/t,this.m_eps=c.ulp(this.m_value),this}setDivEN(e,t){return this.setE(e),this.divThis(t)}setDivNE(e,t){return this.set(e),this.divThisE(t)}divThisByPower2(e){return this.m_value/=e,this.m_eps/=Math.abs(e),this}invThis(){return this.setE(_.clone().divThisE(this)),this}sqrt(){return this.clone().sqrtThis()}sqrtThis(){let e,t;return this.m_value>=0?(e=Math.sqrt(this.m_value),t=this.m_value>10*this.m_eps?.5*this.m_eps/e:this.m_value>this.m_eps?e-Math.sqrt(this.m_value-this.m_eps):Math.max(e,Math.sqrt(this.m_value+this.m_eps)-e),t+=c.ulp(e)):this.m_value<-this.m_eps?(e=Number.NaN,t=Number.NaN):(e=0,t=Math.sqrt(this.m_eps)),this.m_value=e,this.m_eps=t,this}sqr(){return this.clone().sqrThis()}sqrThis(){const e=this.m_value*this.m_value;return this.m_eps=2*this.m_eps*Math.abs(this.m_value)+this.m_eps*this.m_eps+c.ulp(e),this.m_value=e,this}setSin(e){const t=Math.sin(e.m_value),i=Math.cos(e.m_value);this.m_value=t;const n=Math.abs(t),s=Math.abs(e.value());return this.m_eps=(Math.abs(i)+.5*n*e.m_eps)*e.m_eps+c.ulp(n+s),this}static ulp(e){let t=ne(e);const i=((0x7ff0000000000000n&t)>>52n)-1075n;return i>-1023n?(t=i+0x3ffn<<52n,n=t,te[0]=n,ee[0]):0===e?0:Number.MIN_VALUE;var n}setCos(e){const t=Math.sin(e.m_value),i=Math.cos(e.m_value);this.m_value=i;const n=Math.abs(i),s=Math.abs(e.value());return this.m_eps=(Math.abs(t)+.5*n*e.m_eps)*e.m_eps+c.ulp(n+s),this}static st_cosAndSin(e,t,i){const n=Math.sin(e.m_value),s=Math.cos(e.m_value);i.m_value=n,t.m_value=s;const r=Math.abs(n),o=Math.abs(s),a=Math.abs(e.value());i.m_eps=(Math.abs(s)+.5*r*e.m_eps)*e.m_eps+c.ulp(r+a),t.m_eps=(Math.abs(n)+.5*o*e.m_eps)*e.m_eps+c.ulp(o+a)}negate(){return this.clone().negateThis()}negateThis(){return this.m_value=-this.m_value,this}setAbs(){return this.m_value=Math.abs(this.m_value),this}isInInterval(e){return a.construct(this.m_value-this.m_eps,this.m_value+this.m_eps).isIntersecting(e)}eq(e){return Math.abs(this.m_value-e.m_value)<=this.m_eps+e.m_eps}ne(e){return!this.eq(e)}gt(e){return this.m_value-e.m_value>this.m_eps+e.m_eps}lt(e){return e.m_value-this.m_value>this.m_eps+e.m_eps}ge(e){return!this.lt(e)}le(e){return!this.gt(e)}tolEQ(e,t){return Math.abs(this.m_value-e.m_value)<=t||this.eq(e)}tolNE(e,t){return!this.tolEQ(e,t)}tolGT(e,t){return this.m_value-e.m_value>t&&this.gt(e)}tolLT(e,t){return e.m_value-this.m_value>t&&this.lt(e)}tolGE(e,t){return!this.tolLT(e,t)}tolLE(e,t){return!this.tolGT(e,t)}isZero(){return Math.abs(this.m_value)<=this.m_eps}isFuzzyZero(){return this.isZero()&&0!==this.m_eps}tolIsZero(e){return Math.abs(this.m_value)<=Math.max(this.m_eps,e)}setPi(){this.setE(p)}setEuler(){this.set(2.718281828459045,d())}static size(){return 1}}function h(e,t){const i=se(e),n=se(t),s=53-o(i),r=53-o(n);return(s>=0?s:0)+(r>=0?r:0)<=52}function u(e,t){const i=e+t;return i-e===t&&i-t===e}function m(e,t){const i=e-t;return e-i===t&&t+i===e}function d(){return ye()}c.dimensions=1;const p=new c(Math.PI,.5*d()),g=new c(0,0),_=new c(1,0),f=new c(4,0);function y(e){const t=Math.PI*Math.PI/6;let i;if(1===e)i=t;else if(e>1)i=t;else if(0===e)i=e;else if(e<0){const t=1+(e=Math.abs(e)),n=Math.log(t);i=n*n/-2-y(e/t)}else if(e>.5){const n=1-e,s=Math.log(e)*Math.log(n);i=t-y(n)-s}else{i=0;const t=1+Math.trunc(-16*Math.log(10)/Math.log(e)+1.5);let n=t;for(let s=t;s>0;s--,n-=1)i*=e,i+=1/(n*n);i*=e}return i}function x(e,t,i,n,s){s[0]=t[0]+(i[0]-t[0])*n,s[1]=t[1]+(i[1]-t[1])*n,3===e&&(s[2]=t[2]+(i[2]-t[2])*n)}function v(e,t,i,n,s){s[0]=i[0]-(i[0]-t[0])*(1-n),s[1]=i[1]-(i[1]-t[1])*(1-n),3===e&&(s[2]=i[2]-(i[2]-t[2])*(1-n))}function P(e,t,i){let n;return n=i<=.5?e+(t-e)*i:t-(t-e)*(1-i),n}function b(e,t,i,n){i<=.5?(n.x=e.x+(t.x-e.x)*i,n.y=e.y+(t.y-e.y)*i):(n.x=t.x-(t.x-e.x)*(1-i),n.y=t.y-(t.y-e.y)*(1-i))}function E(e){return e*e}const S=[0],C=[0],w=[0],T=[0],D=[0],I=[0];function A(e,t,i){const n=e*t;return M(e,w,T),M(t,D,I),i[0]=T[0]*I[0]-(n-w[0]*D[0]-T[0]*D[0]-w[0]*I[0]),n}function M(e,t,i){const n=134217729*e;t[0]=n-(n-e),i[0]=e-t[0]}const N=[0],R=[0];function O(e,t,i){const n=e+t;return Math.abs(e)>Math.abs(t)?i[0]=e-n+t:i[0]=t-n+e,n}function G(e){const t=1-e;if(0===t)return 1;let i;if(t<=.01){const e=t,n=Math.log(e);i=1+e*(.4431471805599453-.25*n+e*(.05680519270997949-.09375*n+e*(.02183137044373718-.05859375*n+e*(.011544521417308362-.042724609375*n+e*(.00714200031339596-.0336456298828125*n+e*(.004854743337164948-.027757644653320312*n+e*(.003514687963781376-.023627042770385742*n)))))))}else{if(e<.016){const t=e,i=.25,n=.046875,s=.01953125,r=.01068115234375,o=.0067291259765625,a=.004626274108886719,l=.0033752918243408203,c=.0025710230693221092;return Pe()*(1-t*(i+t*(n+t*(s+t*(r+t*(o+t*(a+t*(l+t*c))))))))}i=V(0,t,1)-e*F(0,t,1)/3}return xe(i,1,Pe())}function k(e,i,n=Number.NaN){if(t.geometryReleaseAssert(i>=0&&i<=1),0===i)return e;let s=1,r=e;if(r<0&&(r=-r,s=-1),1===i){const e=Math.round(r/ve()),t=r-e*ve();return s*(2*e+Math.sin(t))}const o=Pe(),a=Math.floor(r/o);1&a?r=(a+1)*o-r:r-=a*o;const l=Math.sin(r),c=Number.isNaN(n)?G(i):n;let h;if(1===l)h=c+Math.sqrt(1-i)*(r-o);else{const e=r*r;if(.01424*Math.pow(e,4)<=2*ye())h=r*(1+e*i*(-1/6+e*((4-3*i)/120-(16+(45*i-60)*i)/5040*e)));else if(i<=.01){const e=Math.sin(2*r),t=Math.sin(4*r),n=Math.sin(6*r),s=Math.sin(8*r),o=Math.sin(10*r);h=r+i*((2*-r+e)/8+i*((-3*r+2*e-.25*t)/64+i*((-20*r+15*e-3*t+n/3)/1024+i*(5*(-140*r+112*e-28*t+16/3*n-.5*s)/65536+7*i*((-63*r+52.5*e-15*t+3.75*n-.625*s+.05*o)/65536+i*(-693*r+594*e-185.625*t+1.375*n-12.375*s+1.8*o-.125*Math.sin(12*r))/1048576)))))}else{const e=l*l,t=Math.cos(r),n=t*t,s=L(l,t,i);h=l*(V(n,s,1)-i*e*F(n,s,1)/3)}}return 1&a?h=c*(a+1)-h:h+=c*a,s*h}function V(e,i,n){t.geometryReleaseAssert((0!==e?1:0)+(0!==i?1:0)+1>1);let s=e,r=i,o=n;for(;;){const e=Math.sqrt(s*r)+Math.sqrt(r*o)+Math.sqrt(o*s);s=.25*(s+e),r=.25*(r+e),o=.25*(o+e);const t=(s+r+o)/3,i=(t-s)/t,n=(t-r)/t,a=(t-o)/t;if(Math.abs(i)<=.0024&&Math.abs(n)<=.0024&&Math.abs(a)<=.0024){const e=i*n-a*a,s=i*n*a;return(1+(1/24*e-.1-3/44*s-5*e*e/208+e*s/16)*e+(1/14+3*s/104)*s)/Math.sqrt(t)}}}function F(e,n,s){t.geometryReleaseAssert(0!==e||0!==n);let r=e,o=n,a=s;const l=new i(0);let c=1;for(;;){const e=.2*(r+o+3*a),t=(e-r)/e,i=(e-o)/e,n=(e-a)/e;if(Math.abs(t)<=.0015&&Math.abs(i)<=.0015&&Math.abs(n)<=.0015){const s=t*i,r=n*n,o=s-r,a=s-6*r,h=a+o+o,u=3/26,m=a*(9/22*.25*a-.21428571428571427-1.5*u*n*h),d=n*(1/6*h+n*(-.4090909090909091*o+n*u*s));return 3*l.getResult()+c*(1+m+d)/(e*Math.sqrt(e))}const s=Math.sqrt(r),h=Math.sqrt(o),u=Math.sqrt(a),m=s*(h+u)+h*u;l.add(c/(u*(a+m))),c*=.25,r=.25*(r+m),o=.25*(o+m),a=.25*(a+m)}}function L(e,t,i){return e<.999?1-i*E(e):1-i+i*E(t)}const q=new class{constructor(e){for(this.values=[[1]];this.values.length<e+1;){const e=this.values.at(-1),t=j(e.length+1,1);for(let i=1;i<e.length;++i)t[i]=e[i-1]+e[i];this.values.push(t)}}get(e,t){return this.values[e][t]}}(32);function H(e,i){if(e<q.values.length)return q.get(e,i);const n=Math.exp((t.geometryReleaseAssert(0),0));return n+.01>2147483647&&t.throwOutOfRangeException("The result value of n choose k is out of range"),n+.01}function U(e,t){if(e.isZero())return e.clone();const i=e.clone().divThis(e);if(t<0)return i.divThis(U(e,-t));for(e=e.clone(),t=Math.trunc(t);1&t&&i.mulThis(e),t>>=1;)e.mulThis(e);return i}function z(e,t,i,n,s){if(0===s)return;let r=0,o=i,a=n;for(;r++<s;)e[o++]=t[a++]}function Y(e,t){return e}function B(e){e.sort(((e,t)=>e<t?-1:e>t?1:0))}function X(e,t){const i=new Array(t);for(let n=0;n<t;++n)i[n]=new e;return i}function j(e,t){const i=new Array(e);return i.fill(t),i}class W{constructor(...e){this.m_elts=e}get length(){return this.m_elts.length}at(e){return this.m_elts[e]}[Symbol.dispose](){for(const e of this.m_elts)e[Symbol.dispose]()}}function Z(e,t){return{first:e,second:t}}const Q=Math.PI,$=2*Math.PI,K=.5*Math.PI,J=new ArrayBuffer(8),ee=new Float64Array(J),te=new BigUint64Array(J),ie=0x0fffffffffffffn;function ne(e){return ee[0]=e,te[0]}function se(e){return ne(e)&ie}function re(e){return Number((9218868437227405312n&ne(e))>>52n)}function oe(e){if(0n===e)return-1n;if(1n===e||-1n===e)return 0n;e<0n&&(e=-e);let t=0n,i=512n,n=1n<<t+i;for(;e>=n;)t+=i,i<<=1n,n<<=i;let s=t;i>>=1n;let r=s+i;for(;i>0n;)e<1n<<r||(s=r),i>>=1n,r=s+i;return s}function ae(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}const le=2147483647,ce=BigInt(le),he=2166136261,ue=16777619,me=1099511628211n;function de(e,t){return t+2654435769+(e<<6)+(e>>2)&le}function pe(e){return de(3735928559,e)}function ge(e){return Number(function(e){let t=14695981039346656037n,i=e;return t=(t^0xffn&i)*me,i>>=8n,t=(t^0xffn&i)*me,i>>=8n,t=(t^0xffn&i)*me,i>>=8n,t=(t^0xffn&i)*me,i>>=8n,t=(t^0xffn&i)*me,i>>=8n,t=(t^0xffn&i)*me,i>>=8n,t=(t^0xffn&i)*me,t&ce}(e))}const _e=100;function fe(){return Number.EPSILON*_e}function ye(){return Number.EPSILON}function xe(e,t,i){return e>=t?e<=i?e:i:t}function ve(){return Q}function Pe(){return K}const be=3*Pe();function Ee(e){return e+0}function Se(e){return{v:e}}class Ce{constructor(){this.m_rn=Se(0n),this.m_rd=Se(1n),this.m_bNaN=!1,this.m_bNormalized=!1,this.m_power=0,this.m_sign=0}static constructAssign(e,t){const i=e.clone();return void 0!==t&&i.limitPrecisionThis(t),i}static constructDouble(e){return(new Ce).setDouble(e)}static constructInt64(e){return(new Ce).setInt64(e)}static constructRational(e,t){return(new Ce).setRational(e,t)}static constructInt32(e){return this.constructInt64(BigInt(Math.trunc(e)))}[Symbol.toPrimitive](e){return this}compare(e){return this.lt(e)?-1:this.gt(e)?1:0}assignCopy(e){return this.setThis(e)}abs(){return this.clone().absThis()}absThis(){return this.isNAN()||(this.m_sign*=this.m_sign),this}clone(){return(new Ce).setThis(this)}setThis(e){return this.m_bNaN=e.m_bNaN,this.m_bNormalized=e.m_bNormalized,this.m_rn.v=e.m_rn.v,this.m_rd.v=e.m_rd.v,this.m_power=e.m_power,this.m_sign=e.m_sign,this}setZero(){return this.m_rn.v=0n,this.m_rd.v=1n,this.m_bNaN=!1,this.m_power=0,this.m_bNormalized=!0,this.m_sign=0,this}setDouble(e){if(this.setZero(),0===e)return this;if(Number.isInteger(e)&&Math.abs(e)<2147483647)return this.setInt32(e);const i=ne(e),n=(i&Ce.s_em)>>52n,s=!!(i&Ce.s_sm),r=i&Ce.s_fm;if(n===Ce.s_emax)return r?(this.m_rn.v=this.m_rd.v=0n,this.m_bNaN=!0,this):(this.m_rn.v=s?-1n:1n,this.m_rd.v=0n,this);0n===n&&t.throwNotImplementedException("denormalized numbers not yet implemented");const o=n-1023n,a=o>=0n?o:0n,l=o<0n?-o:0n;return this.m_rn.v=(1n<<52n|r)<<a,this.m_rd.v=1n<<52n+l,this.m_sign=s?-1:1,this.m_bNormalized=!1,this.normalizeThis()}setInt64(e){return 0n===e?this.setZero():(this.m_bNaN=!1,this.m_sign=e>0n?1:-1,this.m_rn.v=e>0n?e:-e,this.m_rd.v=1n,this.m_power=0,this.m_bNormalized=!1,this.normalizeThis())}setRational(e,t){return 0n===e?0n===t?this.setNAN():this.setZero():0n===t?e>0n?this.setPositiveInf():this.setNegativeInf():(this.m_sign=(e>0n?1:-1)*(t>0n?1:-1),this.m_rn.v=e>0n?e:-e,this.m_rd.v=t>0n?t:-t,this.m_power=0,this.m_bNormalized=!1,this.normalizeThis())}setInt32(e){return this.setInt64(BigInt(Math.trunc(e)))}getDouble(){return this.convertToDouble()}toDouble(){return this.convertToDouble()}value(){return this.convertToDouble()}isNAN(){return this.m_bNaN}isPositiveInf(){return!this.isNAN()&&0n===this.m_rd.v&&1===this.m_sign}isNegativeInf(){return!this.isNAN()&&0n===this.m_rd.v&&-1===this.m_sign}isFinite(){return!this.isNAN()&&0n!==this.m_rd.v}setNAN(){return this.m_bNaN=!0,this.m_rn.v=0n,this.m_rd.v=0n,this.m_power=0,this.m_bNormalized=!0,this}setPositiveInf(){return this.m_rn.v=1n,this.m_rd.v=0n,this.m_bNaN=!1,this.m_bNormalized=!0,this.m_sign=1,this.m_power=0,this}setNegativeInf(){return this.m_rn.v=1n,this.m_rd.v=0n,this.m_bNaN=!1,this.m_bNormalized=!0,this.m_sign=-1,this.m_power=0,this}subThis(e){if(e.isNAN()&&this.setNAN(),this.isPositiveInf()&&e.isPositiveInf())this.setNAN();else{if(this.isPositiveInf()&&e.isNegativeInf())return this.setPositiveInf(),this;if(this.isNegativeInf()&&e.isNegativeInf())this.setNAN();else if(this.isNegativeInf()&&e.isPositiveInf())return this.setNegativeInf(),this}return this.isNAN()?this:this.opPlusMinus(e,!1)}thisSubAbs(e){return t.geometryReleaseAssert(0),this}mulThis(e){return e.isNAN()&&this.setNAN(),this.isNAN()?this:(this.m_sign*=e.m_sign,0===this.m_sign?this.setZero():(this.m_rn.v*=e.m_rn.v,this.m_rd.v*=e.m_rd.v,this.m_power+=e.m_power,this.m_bNormalized=!1,this.normalizeThis(),this))}mulDoubleThis(e){return this.mulThis(Ce.constructDouble(e))}thisMulInt64(e){return t.geometryReleaseAssert(0),this}thisMulInt32(e){return t.geometryReleaseAssert(0),this}divThis(e){return this.mulThis(e.clone().invertThis())}divDoubleThis(e){return this.divThis(Ce.constructDouble(e))}addDoubleThis(e){return this.addThis(Ce.constructDouble(e))}subDoubleThis(e){return this.subThis(Ce.constructDouble(e))}mul(e){return this.clone().mulThis(e)}mulBigIntThis(e){return this.mulThis(Ce.constructInt64(e))}mulDouble(e){return this.clone().mulThis(Ce.constructDouble(e))}div(e){return this.clone().divThis(e)}divDouble(e){return this.clone().divDoubleThis(e)}add(e){return this.clone().addThis(e)}fmSubThis(e,t){return this.subThis(e.clone().mulThis(t))}fmAddThis(e,t){return this.addThis(e.clone().mulThis(t))}addThis(e){if(e.isNAN()&&this.setNAN(),this.isPositiveInf()&&e.isPositiveInf())return this.setPositiveInf(),this;if(this.isPositiveInf()&&e.isNegativeInf())this.setNAN();else{if(this.isNegativeInf()&&e.isNegativeInf())return this.setNegativeInf(),this;this.isNegativeInf()&&e.isPositiveInf()&&this.setNAN()}return this.isNAN()?this:this.opPlusMinus(e,!0)}addDouble(e){return this.clone().addThis(Ce.constructDouble(e))}sub(e){return this.clone().subThis(e)}subDouble(e){return this.clone().subThis(Ce.constructDouble(e))}isZero(){return 0===this.m_sign}equals(e){return this.clone().subThis(e).isZero()}lt(e){return!this.isNAN()&&!e.isNAN()&&!(this.isPositiveInf()&&e.isPositiveInf()||this.isNegativeInf()&&e.isNegativeInf())&&!this.isPositiveInf()&&(!!e.isPositiveInf()||this.clone().sub(e).LZ())}absLessAbs(e){return this.abs().lt(e.abs())}gt(e){return this.clone().sub(e).GZ()}lte(e){return this.sub(e).LEZ()}gte(e){return this.sub(e).GEZ()}normalizeThis(){if(this.m_bNormalized)return this;if(0n===this.m_rn.v)return this.setZero();let e=0,t=0xffffffffn;for(;0n===(this.m_rn.v&t)&&t<=this.m_rn.v;)t<<=32n,e+=32;t&=this.m_rn.v,t>>=BigInt(e),e+=r(BigInt.asUintN(32,t))-1;let i=0;for(t=0xffffffffn;0n===(this.m_rd.v&t)&&t<=this.m_rd.v;)t<<=32n,i+=32;return t&=this.m_rd.v,t>>=BigInt(i),i+=r(BigInt.asUintN(32,t))-1,this.m_rn.v>>=BigInt(e),this.m_rd.v>>=BigInt(i),this.m_power+=e-i,this.m_rn.v>1n&&this.m_rd.v>1n&&(this.m_rn.v%this.m_rd.v===0n?(this.m_rn.v/=this.m_rd.v,this.m_rd.v=1n):this.m_rd.v%this.m_rn.v===0n&&(this.m_rd.v/=this.m_rn.v,this.m_rn.v=1n)),this.m_bNormalized=!0,this}negateThis(){return this.isNAN()||(this.m_sign*=-1),this}negate(){return this.clone().negateThis()}invertThis(){return this.isNAN()?this:this.isPositiveInf()||this.isNegativeInf()?(this.setZero(),this):0n===this.m_rn.v?(this.setPositiveInf(),this):(this.m_rd=Y(this.m_rn,this.m_rn=this.m_rd),this.m_power=-this.m_power,this)}limitPrecisionThis(e){if(0===e)return this;if(this.isZero())return this.setZero();if(!this.isFinite())return this;this.normalizeThis();let t=Number(oe(this.m_rn.v));if(t>e){const i=t-e;this.m_rn.v>>=BigInt(t-e),this.m_power+=i}if(t=Number(oe(this.m_rd.v)),t>e){const i=t-e;this.m_rd.v>>=BigInt(t-e),this.m_power-=i}return this}hiBitIndex(){return Math.max(Number(oe(this.m_rn.v)),Number(oe(this.m_rd.v)))}ldexp(e){return this.clone().ldexpThis(e)}ldexpThis(e){return e&&(this.m_bNormalized=!1,this.m_power+=e,this.normalizeThis()),this}static lerp(e,t,i){return Ce.lerpLo(t,t,i)}static lerpLo(e,t,i){return t.sub(e).mulThis(i).addThis(e)}static lerpHi(e,t,i){return t.sub(e).mulThis(we.sub(i)).addThis(e)}LZ(){return!this.isNAN()&&-1===this.m_sign}GZ(){return!this.isNAN()&&1===this.m_sign}LEZ(){return!this.isNAN()&&this.m_sign<=0}GEZ(){return!this.isNAN()&&this.m_sign>=0}toString(){return this.toDouble().toString()}sqr(){return this.clone().sqrThis()}sqrThis(){return this.mulThis(this.clone())}static sqrt(e,i){if(e.m_sign<0n&&t.throwOutOfRangeException("MP_value: sqrt(-1)"),e.isZero())return e.clone();let n=52,s=2220446049250313e-31;for(;n<i;)2*n<=i?(s*=s,n*=2):(s*=2220446049250313e-31,n+=52);n+=52;const r=oe(e.m_rn.v),o=oe(e.m_rd.v);let a,l=e.m_power+Number(r-o);const c=new Ce;Math.abs(l)>200?(1&Math.abs(l)&&(l+=1),a=Ce.constructAssign(e,53).ldexpThis(-l).value(),c.setThis(e).ldexpThis(-l),t.geometryReleaseAssert(Number.isFinite(a))):(c.setThis(e),a=c.value(),t.geometryReleaseAssert(Number.isFinite(a)),l=0),a=Math.sqrt(a);const h=Ce.constructDouble(a),u=Ce.constructDouble(s);u.mulThis(h).ldexpThis(1);const m=s*a*2,d=h.clone(),p=new Ce;let g;for(let e=0;e<10;++e){d.mulThis(h),p.setThis(c).subThis(d).absThis();let e=p.value();if(g=1,e<.9)for(;e>m;)e*=e,++g;else g=4;if(p.lte(u))break;for(let e=0;e<g;e++)d.setThis(h).divThis(c).invertThis().addThis(h).ldexpThis(-1).limitPrecisionThis(n),h.setThis(d)}return h.ldexpThis(l/2)}static cubicRoot(e,t){if(e.isZero())return e.clone();let i=52,n=2220446049250313e-31;for(;i<t;)2*i<=t?(n*=n,i*=2):(n*=2220446049250313e-31,i+=52);i+=52;const s=Math.pow(Math.abs(e.value()),1/3),r=Ce.constructDouble(s),o=r.clone();o.sqrThis().mulDoubleThis(3).mulDoubleThis(n),o.limitPrecisionThis(32),e.LZ()&&r.negateThis();for(let t=0;t<10;++t){const t=r.clone();t.sqrThis().mulThis(r);const n=t.clone();if(n.subThis(e),n.absThis().limitPrecisionThis(32),n.lte(o))break;n.setThis(e),n.ldexpThis(1),n.addThis(t);const s=t.clone();s.ldexpThis(1),s.addThis(e),n.divThis(s),r.mulThis(n),r.limitPrecisionThis(i)}return r}isInTheRangeOfDouble(){return t.geometryReleaseAssert(0),!1}sign(){return this.m_sign}cosAndSin(e,i){t.geometryReleaseAssert(0)}pow(e){return U(this,e)}static nan(){return t.geometryReleaseAssert(0),new Ce}convertToDouble(){if(this.m_bNaN)return Number.NaN;if(this.isZero())return 0;if(0n===this.m_rd.v)return 1===this.m_sign?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;const e=-1===this.m_sign,t=this.m_rn.v<<(this.m_power>=0?BigInt(this.m_power):0n);let i=this.m_rd.v<<(this.m_power<0?BigInt(-this.m_power):0n);const n=t/i;let s=Number(n);if(BigInt(s)!==n)return e?-s:s;let r=t-n*i;if(r){let e=oe(i)-1023n;e>0n&&(i>>=e,r<<=52n,r>>=e);let t=Number(r);Number.isFinite(t)||(r>>=52n,t=Number(r),e=0n),e>0n&&(t/=Math.pow(2,52)),s+=t/Number(i)}return e?-s:s}signVal(){return 1===this.m_sign?1n:-1===this.m_sign?-1n:0n}opPlusMinus(e,t){const i=Math.min(this.m_power,e.m_power);let n,s;this.m_power>i?(n=BigInt(this.m_power-i),s=0n):(n=0n,s=BigInt(e.m_power-i));const r=this.signVal()*this.m_rn.v*e.m_rd.v<<n,o=e.signVal()*e.m_rn.v*this.m_rd.v<<s;return this.m_rn.v=t?r+o:r-o,this.m_rd.v*=e.m_rd.v,this.m_power=i,this.m_sign=1,this.m_rn.v<0n&&(this.m_sign=-1,this.m_rn.v=-this.m_rn.v),this.m_bNormalized=!1,this.normalizeThis(),this}}Ce.s_sm=0x8000000000000000n,Ce.s_em=0x7ff0000000000000n,Ce.s_fm=0x000fffffffffffffn,Ce.s_emax=0x7ffn;const we=Ce.constructInt32(1),Te=Ce.constructInt32(0),De=Ce.constructDouble(.5);function Ie(e,t){let i=re(e);const n=re(t);if(i===n){const n=53-function(e,t){return function(e){let t=0;return 0xffffffff00000000n&e&&(t=32,e>>=32n),t+function(e){let t=0;return 4294901760n&e&&(t+=16,e>>=16n),65280n&e&&(t+=8,e>>=8n),240n&e&&(t+=4,e>>=4n),t+s[Number(BigInt.asUintN(4,e))]+1}(e)}(e^t)}(se(e),se(t));return i-=n,i}return i>n?i:n}class Ae{static construct(e,t){return new Ae(e,t)}constructor(e,t){void 0!==e?(this.x=e,this.y=t):this.x=this.y=Number.NaN}clone(){return new Ae(this.x,this.y)}assign(e){this.setCoordsPoint2D(e)}setCoords(e,t){return this.x=e,this.y=t,this}setCoordsPoint2D(e){this.x=e.x,this.y=e.y}isEqualPoint2D(e,t){return void 0!==t?Math.abs(this.x-e.x)<=t&&Math.abs(this.y-e.y)<=t:this.x===e.x&&this.y===e.y}isEqual(e,t,i){return void 0!==i?Math.abs(this.x-e)<=i&&Math.abs(this.y-t)<=i:this.x===e&&this.y===t}equalsPoint2D(e,t){return this.isEqualPoint2D(e,t)}setSub(e,t){this.x=e.x-t.x,this.y=e.y-t.y}addThis(e){return this.x+=e.x,this.y+=e.y,this}setAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}absoluteOther(e){}absolute(){return t.geometryReleaseAssert(0),this}setNegate(){this.x=-this.x,this.y=-this.y}setNegateOther(e){this.x=-e.x,this.y=-e.y}interpolateThis(e,t){}interpolate(e,i,n){t.geometryReleaseAssert(0)}scaleAddThis(e,t){this.x=this.x*e+t.x,this.y=this.y*e+t.y}setScaleAdd(e,t,i){this.x=t.x*e+i.x,this.y=t.y*e+i.y}scaleOther(e,i){t.geometryReleaseAssert(0)}scale(e){this.x*=e,this.y*=e}compare(e){return this.y<e.y?-1:this.y>e.y?1:this.x<e.x?-1:this.x>e.x?1:0}compareX(e){return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0}normalizeOther(e){t.geometryReleaseAssert(0)}normalize(){const e=this.length();return e?(this.x/=e,this.y/=e):(this.x=1,this.y=0),this}getUnitVector(){return this.clone().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}sqrLength(){return this.x*this.x+this.y*this.y}static averageFast(e,i){return t.geometryReleaseAssert(0),{}}static average(e,t){const n=new Ae;if(0===t)return n.setNAN(),n;if(1===t)return n.assign(e[0]),n;const s=new i(e[0].x),r=new i(e[0].y);for(let i=1;i<t;i++)s.add(e[i].x),r.add(e[i].y),255&i||(s.normalize(),r.normalize());return n.x=s.getResult()/t,n.y=r.getResult()/t,n}static calculateLength(e,t){const n=new i(0);for(let i=1;i<t;i++)n.add(Ae.distance(e[i],e[i-1]));return n.getResult()}offset(e,t){const i=Ae.distance(e,t),n=Ae.construct(this.x,this.y);if(0===i)return Ae.distance(n,e);const s=t.clone();return s.subThis(e),n.subThis(e),n.crossProduct(s)/i}side(e,t){return e.equals(t)?this.equals(e)?0:1:Ae.orientationRobust(t,e,this)}static sqrDistance(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n}static sqrDistanceCoords(e,t,i,n){const s=i-e,r=n-t;return s*s+r*r}static distance(e,t){return Math.sqrt(Ae.sqrDistance(e,t))}dotProduct(e){return this.x*e.x+this.y*e.y}dotProductAbs(e){return Math.abs(this.x*e.x)+Math.abs(this.y*e.y)}crossProduct(e){return this.x*e.y-this.y*e.x}crossProductAbs(e){return t.geometryReleaseAssert(0),0}rotateDirect(e,t){const i=this.x*e-this.y*t,n=this.x*t+this.y*e;this.x=i,this.y=n}rotateReverse(e,t){const i=this.x*e+this.y*t,n=-this.x*t+this.y*e;this.x=i,this.y=n}leftPerpendicularThis(){const e=this.x;this.x=-this.y,this.y=e}leftPerpendicularOther(e){const t=e.x;this.x=-e.y,this.y=t}rightPerpendicularThis(){const e=this.x;this.x=this.y,this.y=-e}rightPerpendicularOther(e){const t=e.x;this.x=e.y,this.y=-t}equals(e){return this.x===e.x&&this.y===e.y}notequals(e){return this.x!==e.x||this.y!==e.y}not(){return!this.x&&!this.y}gt(e){return this.y>e.y||this.y===e.y&&this.x>e.x}gte(e){return!this.lt(e)}lt(e){return this.y<e.y||this.y===e.y&&this.x<e.x}lte(e){return!this.gt(e)}subThis(e){return this.x-=e.x,this.y-=e.y,this}divThis(e){return this.x/=e,this.y/=e,this}add(e){return new Ae(this.x+e.x,this.y+e.y)}sub(e){return new Ae(this.x-e.x,this.y-e.y)}negateThis(){return this.x=-this.x,this.y=-this.y,this}negate(){return new Ae(-this.x,-this.y)}mul(e){return new Ae(this.x*e,this.y*e)}mulThis(e){return this.x*=e,this.y*=e,this}divide(e){return new Ae(this.x/e,this.y/e)}setNAN(){this.x=this.y=Number.NaN}isNAN(){return Number.isNaN(this.x)||Number.isNaN(this.y)}static getNAN(){return new Ae(Number.NaN,Number.NaN)}isFinite(){return Number.isFinite(this.x)&&Number.isFinite(this.y)}isZero(){return 0===this.x&&0===this.y}norm(e){switch(e){case 0:{const e=Math.abs(this.x),t=Math.abs(this.y),i=e-t;return i>=0?e:i<=0?t:Number.NaN}case 1:return Math.abs(this.x)+Math.abs(this.y);case 2:return Math.sqrt(this.x*this.x+this.y*this.y);default:t.throwInvalidArgumentException("norm")}}getQuarter(){return Ae.getQuarterCoords(this.x,this.y)}static getQuarterCoords(e,t){return e>0?t>=0?1:4:t>0?2:0===e?4:3}static compareVectors(e,t){const i=e.getQuarter(),n=t.getQuarter();return n===i?Ae.orientationRobustImpl(Ae.construct(0,0),t,e,!0):i<n?-1:1}static compareVectorsOrigin(e,t,i){const n=t.sub(e),s=i.sub(e),r=n.getQuarter(),o=s.getQuarter();return o===r?Ae.orientationRobustImpl(e,i,t,!0):r<o?-1:1}static orientationRobust(e,t,i){return Ae.orientationRobustImpl(e,t,i,!1)}static orientationRobustEx(e,t,i,n){if(e.equals(t)||i.equals(n))return 0;const s=t.x-e.x,r=t.y-e.y,o=n.x-i.x,a=n.y-i.y;{const e=Ae.getQuarterCoords(s,r)-1,t=Ae.getQuarterCoords(o,a)-1,i=Ae.d[e][t];if(0!==i)return i}const l=s*a,c=r*o,h=4*ye()*(Math.abs(l)+Math.abs(c)),u=l-c;return Math.abs(u)>=h?u<0?-1:u>0?1:0:Ae.orientationRobustExMp(e,t,i,n)}static orientationRobustExMp(e,t,i,n){const s=Ce.constructDouble(t.x),r=Ce.constructDouble(n.x);s.subThis(Ce.constructDouble(e.x)),r.subThis(Ce.constructDouble(i.x));const o=Ce.constructDouble(t.y),a=Ce.constructDouble(n.y);return o.subThis(Ce.constructDouble(e.y)),a.subThis(Ce.constructDouble(i.y)),s.mulThis(a),o.mulThis(r),s.subThis(o),s.LZ()?-1:s.GZ()?1:0}static orientationNonRobust(e,t,i){const n=t.sub(e).crossProduct(i.sub(e));return n<0?-1:n>0?1:0}static orientationRobustImpl(e,t,i,n){if(t.isEqualPoint2D(e)||i.isEqualPoint2D(e)||t.isEqualPoint2D(i))return 0;const s=t.x-e.x,r=t.y-e.y,o=i.x-e.x,a=i.y-e.y;if(!n){const e=Ae.getQuarterCoords(s,r)-1,t=Ae.getQuarterCoords(o,a)-1,i=Ae.d[e][t];if(0!==i)return i}const l=(Math.abs(s)+Math.abs(r)+Math.abs(o)+Math.abs(a))*(Math.abs(t.x)+Math.abs(t.y)+Math.abs(i.x)+Math.abs(i.y))*8*d(),c=s*a-r*o;if(Math.abs(c)>l)return c<0?-1:1;if(m(t.x,e.x)&&m(i.y,e.y)&&m(t.y,e.y)&&m(i.x,e.x)&&h(s,a)&&h(r,o)){const e=s*a,t=r*o;if(m(e,t)){const i=e-t;return i<0?-1:i>0?1:0}}return Ae.orientationRobustMp(e,t,i)}static orientationRobustMp(e,t,i){const n=Ce.constructDouble(t.x),s=Ce.constructDouble(i.x);{const t=Ce.constructDouble(e.x);n.subThis(t),s.subThis(t)}const r=Ce.constructDouble(i.y),o=Ce.constructDouble(t.y);{const t=Ce.constructDouble(e.y);r.subThis(t),o.subThis(t)}return n.mulThis(r),o.mulThis(s),n.subThis(o),n.LZ()?-1:n.GZ()?1:0}static inCircleRobust(e,t,i,n){const s=new c,r=new c;s.set(e.x),s.subThis(n.x),r.set(e.y),r.subThis(n.y);const o=new c,a=new c;o.set(t.x),o.subThis(n.x),a.set(t.y),a.subThis(n.y);const l=new c,h=new c;l.set(i.x),l.subThis(n.x),h.set(i.y),h.subThis(n.y);const u=s.mulE(a).subE(r.mulE(o)),m=o.mulE(h).subE(a.mulE(l)),d=s.mulE(h).subE(r.mulE(l)),p=s.mulE(s).addE(r.mulE(r)),g=o.mulE(o).addE(a.mulE(a)),_=l.mulE(l).addE(h.mulE(h)),f=p.mulE(m).subE(g.mulE(d)).addE(_.mulE(u));if(!f.isFuzzyZero()){const e=f.value();return e<0?-1:e>0?1:0}return Ae.inCircleRobustMp(e,t,i,n)}static inCircleRobustMp(e,t,i,n){do{if(!m(e.x,n.x)||!m(e.y,n.y))break;if(!m(t.x,n.x)||!m(t.y,n.y))break;if(!m(i.x,n.x)||!m(i.y,n.y))break;const s=e.x-n.x,r=e.y-n.y,o=t.x-n.x,a=t.y-n.y,l=i.x-n.x,c=i.y-n.y;if(!h(s,a)||!h(r,o))break;if(!h(o,c)||!h(a,l))break;if(!h(s,c)||!h(r,l))break;if(!h(s,s)||!h(r,r))break;if(!h(o,o)||!h(a,a))break;if(!h(l,l)||!h(c,c))break;const d=s*a,p=r*o,g=o*c,_=a*l,f=s*c,y=r*l,x=s*s,v=r*r,P=o*o,b=a*a,E=l*l,S=c*c;if(!m(d,p))break;if(!m(g,_))break;if(!m(f,y))break;if(!u(x,v))break;if(!u(P,b))break;if(!u(E,S))break;const C=d-p,w=g-_,T=f-y,D=x+v,I=P+b,A=E+S;if(!h(D,w))break;if(!h(I,T))break;if(!h(A,C))break;const M=D*w,N=I*T,R=A*C;if(!m(M,N))break;const O=M-N;if(!u(O,R))break;const G=O+R;return G<0?-1:G>0?1:0}while(0);const s=Ce.constructDouble(n.x),r=Ce.constructDouble(n.y),o=Ce.constructDouble(e.x),a=Ce.constructDouble(e.y);o.subThis(s),a.subThis(r);const l=Ce.constructDouble(t.x),c=Ce.constructDouble(t.y);l.subThis(s),c.subThis(r);const d=Ce.constructDouble(i.x),p=Ce.constructDouble(i.y);d.subThis(s),p.subThis(r);const g=o.mul(c).sub(a.mul(l)),_=l.mul(p).sub(c.mul(d)),f=o.mul(p).sub(a.mul(d)),y=o.mul(o).add(a.mul(a)),x=l.mul(l).add(c.mul(c)),v=d.mul(d).add(p.mul(p)),P=y.mul(_).sub(x.mul(f)).add(v.mul(g));return P.LZ()?-1:P.GZ()?1:0}static inCircleRobustMp3Point(e,t,i){const n=Ce.constructDouble(e.x),s=Ce.constructDouble(e.y),r=Ce.constructDouble(t.x),o=Ce.constructDouble(t.y),a=Ce.constructDouble(i.x),l=Ce.constructDouble(i.y),c=a.mul(a).add(l.mul(l)).sub(a.mul(n).add(l.mul(s)).add(a.mul(r)).add(l.mul(o))).add(n.mul(r).add(s.mul(o)));return c.LZ()?-1:c.GZ()?1:0}static inCircleRobust3Point(e,t,i){const n=new c(e.x),s=new c(e.y),r=new c(t.x),o=new c(t.y),a=new c(i.x),l=new c(i.y),h=a.mulE(a).addE(l.mulE(l)).subE(a.mulE(n).addE(l.mulE(s)).addE(a.mulE(r)).addE(l.mulE(o))).addE(n.mulE(r).addE(s.mulE(o)));if(!h.isFuzzyZero()){const e=h.value();return e<0?-1:e>0?1:0}return Ae.inCircleRobustMp3Point(e,t,i)}static calculateCircleCenterFromThreePoints(e,t,i){if(e.equals(i)||e.equals(t)||i.equals(t))return Ae.getNAN();const n=function(e,t,i){const n=new c(t.x);n.subThis(e.x);const s=new c(t.y);s.subThis(e.y);const r=new c(i.x);r.subThis(e.x);const o=new c(i.y);o.subThis(e.y);const a=n.clone();a.mulThisE(o);let l=s.clone();if(l.mulThisE(r),a.subThisE(l),0===a.value())return Ae.getNAN();a.mulThis(2);const h=n.clone();h.mulThisE(n);const u=s.clone();u.mulThisE(s);const m=h.clone();m.addThisE(u);const d=r.clone();d.mulThisE(r);const p=o.clone();p.mulThisE(o);const g=d.clone();g.addThisE(p);const _=s.clone();_.mulThisE(g),l=o.clone(),l.mulThisE(m),_.subThisE(l),_.divThisE(a);const f=n.clone();f.mulThisE(g),l=r.clone(),l.mulThisE(m),f.subThisE(l),f.divThisE(a);const y=Ae.construct(e.x-_.value(),e.y+f.value()),x=e.sub(y).length(),v=t.sub(y).length(),P=i.sub(y).length(),b=1e-15*(x+Math.abs(e.x)+Math.abs(t.x)+Math.abs(i.x)+Math.abs(e.y)+Math.abs(t.y)+Math.abs(i.y));return Math.abs(x-v)<=b&&Math.abs(x-P)<=b&&_.eps()<b&&f.eps()<b?y:Ae.getNAN()}(e,t,i);return n.isNAN()?function(e,t,i){const n=Ce.constructDouble(t.x);n.subDoubleThis(e.x);const s=Ce.constructDouble(t.y);s.subDoubleThis(e.y);const r=Ce.constructDouble(i.x);r.subDoubleThis(e.x);const o=Ce.constructDouble(i.y);o.subDoubleThis(e.y);const a=n.clone();a.mulThis(o);let l=s.clone();if(l.mulThis(r),a.subThis(l),a.isZero())return Ae.getNAN();a.mulDoubleThis(2);const c=n.clone();c.mulThis(n);const h=s.clone();h.mulThis(s);const u=c.clone();u.addThis(h);const m=r.clone();m.mulThis(r);const d=o.clone();d.mulThis(o);const p=m.clone();p.addThis(d);const g=s.clone();g.mulThis(p),l=o.clone(),l.mulThis(u),g.subThis(l),g.divThis(a);const _=n.clone();return _.mulThis(p),l=r.clone(),l.mulThis(u),_.subThis(l),_.divThis(a),Ae.construct(e.x-g.value(),e.y+_.value())}(e,t,i):n}static calculateAngle(e,t){return Math.atan2(e.crossProduct(t),e.dotProduct(t))}static isBisectorRobust(e,i,n){return t.geometryReleaseAssert(0),!1}static size(){return 2}get 0(){return this.x}get 1(){return this.y}set 0(e){this.x=e}set 1(e){this.y=e}static compareZorder(e,t){const i=Ae.c_compare_zorder_xx[e.x<0?1:0]|Ae.c_compare_zorder_yy[e.y<0?1:0],n=Ae.c_compare_zorder_xx[t.x<0?1:0]|Ae.c_compare_zorder_yy[t.y<0?1:0];if(i===n){let i=0,n=0;for(let s=0;s<2;++s){const r=Ie(e[s],t[s]);r>i&&(i=r,n=s)}return e[n]<t[n]}return i<n}static lerp(e,t,i){const n=new Ae;return b(e,t,i,n),n}static getClosestCoordinate(e,t,i,n=!1){const s=Ae.getNAN();s.setSub(t,e);const r=s.sqrLength();if(0===r)return.5;if(t.isEqualPoint2D(i))return 1;const o=Ae.getNAN();o.setSub(i,e);let a=o.dotProduct(s)/r;return n||(a<0?a=0:a>1&&(a=1)),a}static intersectLinesAtOnePoint(e,t,i,n){if(e.equals(t)||i.equals(n))return Ae.getNAN();const s=t.x-e.x,r=i.x-n.x,o=t.y-e.y,a=i.y-n.y,l=s*a-r*o;if(!l)return Ae.getNAN();const c=l;if(0===c)return Ae.getNAN();let h=(i.x-e.x)*a-(i.y-e.y)*r;h/=c;const u=new Ae;return b(e,t,h,u),u.isFinite()?u:Ae.getNAN()}toString(){return`[${this.x},${this.y}]`}}Ae.dimensions=2,Ae.d=[[0,1,0,-1],[-1,0,1,0],[0,-1,0,1],[1,0,-1,0]],Ae.c_compare_zorder_xx=[2,0],Ae.c_compare_zorder_yy=[1,0],e.ECoordinate=c,e.Envelope1D=a,e.KahanSummator=i,e.MPValue=Ce,e.Point2D=Ae,e.SimpleDisposableArray=W,e.SmallMatrix=class{constructor(e,t){this.m_cr=e,this.m_cc=t,this.m_v=j(e*t,0)}get(e,t){return this.m_v[e*this.m_cc+t]}set(e,t,i){this.m_v[e*this.m_cc+t]=i}inc(e,t){return++this.m_v[e*this.m_cc+t]}},e.assignObjectArray=function(e,t,i){for(let n=0;n<i;++n)e[n].assign(t[n]);return i},e.atanhUOverU=function(e){let t;if(0===e)t=1;else if(Math.abs(e)>.01)t=function(e){return Math.atanh(e)}(e)/e;else{let i;const n=-36.841361487904734;t=0;const s=e*e;for(let e=2*Math.trunc(n/Math.log(s)+2.5)-1;e>1;e-=2)i=1/e,t=(t+i)*s;t+=1}return t},e.choose=H,e.cloneObjectArray=function(e,t){const i=e.slice(0,t);for(let e=0;e<t;++e)i[e]=i[e].clone();return i},e.compareNoNANs=function(e,t){return e<t?-1:e>t?1:0},e.compareWithNANs=function(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;{const i=Number.isNaN(e),n=Number.isNaN(t);return i<n?-1:i>n?1:0}},e.compensatedDot=function(e,t,i,n){const s=[0],r=[0],o=[0];return O(A(e,i,s),A(t,n,r),o)+(s[0]+r[0]+o[0])},e.completeEllipticE=G,e.constructBernsteinCoefficientsFromStandardForm=function(e,t){if(0===t)return[];const i=e[0].clone().mulDoubleThis(0),n=[];n.length=t;const s=t-1;for(let t=0;t<=s;++t){n[t]=i.clone();for(let i=0;i<=t;++i)n[t].addThis(e[i].clone().mulDoubleThis(H(t,i)/H(s,i)))}return n},e.coordinateArrayToPoint2DArray=function(e){const t=X(Ae,e.length);for(let i=0,n=e.length;i<n;++i)t[i].setCoords(e[i][0],e[i][1]);return t},e.copySign=function(e,t){const i=Math.abs(e);return t>=0?i:-i},e.cube=function(e){return e*e*e},e.dilogarithmEzOverE=function(e,t){const i=t*e;if(Math.abs(t)<.1){let t=0;for(let e=60;e>=1;e--)t*=i,t+=1/e/e;return t*=e,t}return y(i)/t},e.doubleEps=ye,e.ellipticE=k,e.float64ArrayToPoint2DArray2=function(e,t){for(let i=0,n=0,s=e.length;i<s;i+=2,n++)t[n].x=e[i],t[n].y=e[i+1]},e.fma=function(e,t,i){return function(e,t,i,n){const s=O(e,t,N),r=O(s,i,R);return O(r,N[0]+R[0],n)}(A(e,t,S),i,S[0],C)},e.fmod=function(e,t){return e%t},e.geographyEpsFactor=function(){return 100*Number.EPSILON},e.geomEpsFactor=fe,e.geometry2Pi=$,e.geometryHalfPi=K,e.geometryPi=Q,e.goldenRatio=function(){return.38196601125010515},e.halfPi=Pe,e.hashCombine=de,e.hashCombineInt64=function(e,t){return de(e,ge(t))},e.hashDouble=function(e){return ge(ne(Ee(e)))},e.hashForClustering=pe,e.hashForClustering2=function(e,t){return de(e,pe(t))},e.hashInt32=function(e){return function(e){let t=he,i=e;return t=(t^255&i)*ue,i>>=8,t=(t^255&i)*ue,i>>=8,t=(t^255&i)*ue,i>>=8,t=(t^255&i)*ue,t&le}(e)},e.hashString=function(e){let t=he;for(let i=0,n=e.length;i<n;++i)t=(t^e.charCodeAt(i))*ue;return t&le},e.indexTypeMax=function(){return 2147483647},e.initializeObjectArray=function(e,t,i){e.length=i;for(let n=0;n<i;++n)e[n]=new t},e.initializePrimitiveArray=function(e,t,i){e.length=t,e.fill(i)},e.intMax=function(){return 2147483647},e.intMin=function(){return-2147483648},e.interpolate=function(e,i,n,s,r){return 0===e?0===s?i:1===s?n:r:1===e?0===s?i:1===s?n:P(i,n,s):(2===e&&t.throwNotImplementedException("angular interpolation"),void t.throwNotImplementedException(""))},e.interpolateArray=function(e,i,n,s,r,o,a,l){if(0===e)for(let e=0;e<o;++e)s[e+r]=0===a?i[e]:1===a?n[e]:l;else if(1===e)if(0===a)z(s,i,r,0,o);else if(1===a)z(s,n,r,0,o);else for(let e=0;e<o;++e)s[e+r]=P(i[e],n[e],a);else if(2===e)if(0===a)z(s,i,r,0,o);else if(1===a)z(s,n,r,0,o);else{let e=0;for(let t=0,l=r;t<o;++t,++l)s[l]=P(i[t],n[t],a),e+=s[l]*s[l];if(e>0){e=Math.sqrt(e);for(let t=r;t<r+o;++t)s[t]/=e}else{for(let e=r;e<r+o;++e)s[e]=0;s[r]=1}}else t.throwNotImplementedException("")},e.inverseEllipticE=function(e,t,i=Number.NaN){if(0===e)return 0;let n=1,s=e;e<0&&(s=-s,n=-1);const r=Number.isNaN(i)?G(t):i,o=Math.floor(s/r);1&o?s=(o+1)*r-s:s-=o*r;let a=s<=0?0:s>=r?Pe():function(e,t,i){if(0===t)return e;if(1===t)return Math.asin(e);let n=0,s=!0;if(e<.2){const i=e*e,r=e*(1+i*t*(1/6+i*((13*t-4)/120+(16-284*t+493*t*t)/5040*i))),o=Math.abs(t*(4944*t-64-31224*t*t+37369*t*t*t)/362880*Math.pow(e,9));if(o<Math.abs(r)*ye())return r;n=r,s=o>.1*r}if(s){const s=1-t,r=1-e/i,o=Math.sqrt(r*r+s*s),a=Math.atan2(s,e+ye());n=Pe()+Math.sqrt(o)*(a-Pe())}let r=0;for(let s=0;s<7;s++){r=k(n,t,i);const o=L(Math.sin(n),Math.cos(n),t);if(n-=(r-e)/Math.sqrt(o),s>0&&Math.abs(r-e)<=4*ye()*e)break}return n}(s,t,r);return 1&o?a=Pe()*(o+1)-a:a+=Pe()*o,n*a},e.isEqualNonIEEE=ae,e.isEqualNonIEEETol=function(e,t,i){return e===t||Math.abs(e-t)<=i||Number.isNaN(e)&&Number.isNaN(t)},e.isOneOf=function(e,t,i){return e===t||e===i},e.isOnlyProperty=function(e,t){return t in e&&1===Object.getOwnPropertyNames(e).length},e.lerp=P,e.lerpHi=function(e,t,i){return t-(t-e)*(1-i)},e.lerpHiE=function(e,t,i){return t.subE(t.subE(e).mulE(_.subE(i)))},e.lerpHiPointE=function(e,t,i,n,s){s[0]=i[0].subE(i[0].subE(t[0]).mulE(_.subE(n))),s[1]=i[1].subE(i[1].subE(t[1]).mulE(_.subE(n)))},e.lerpLo=function(e,t,i){return e+(t-e)*i},e.lerpLoE=function(e,t,i){return e.addE(t.subE(e).mulE(i))},e.lerpLoPointE=function(e,t,i,n,s){s[0]=t[0].addE(i[0].subE(t[0]).mulE(n)),s[1]=t[1].addE(i[1].subE(t[1]).mulE(n))},e.lerpPoint=function(e,t,i,n,s){n<=.5?x(e,t,i,n,s):v(e,t,i,n,s)},e.lerpPoint2D=b,e.lerpPoint3D=function(e,t,i,n){i<=.5?(n.x=e.x+(t.x-e.x)*i,n.y=e.y+(t.y-e.y)*i,n.z=e.z+(t.z-e.z)*i):(n.x=t.x-(t.x-e.x)*(1-i),n.y=t.y-(t.y-e.y)*(1-i),n.z=t.z-(t.z-e.z)*(1-i))},e.lerpPointHi=v,e.lerpPointLo=x,e.makeNullArray=function(e){return Array.from({length:e},(()=>null))},e.makeObjectArray=X,e.makePair=Z,e.makePrimitiveArray=j,e.makeScopedCall=function(e,t=!1){return{[Symbol.dispose](){this.bForget||e()},bForget:t}},e.makeStructArray=function(e,t){return Array.from({length:t},(()=>e()))},e.memcmp=function(e,t,i){let n=0;for(let s=0;!n&&s<i;++s)n=e[s]-t[s];return n},e.memcpy=z,e.minMax=function(e,t){return e<t?Z(e,t):Z(t,e)},e.nextRand=function(e){return function(e){return 1103515245*e+12345&2147483647}(e)},e.normalizeSignedZero=Ee,e.numericSort=B,e.numericSortRange=function(e,t){const i=e.slice(0,t);B(i),z(e,i,0,0,t)},e.pi=ve,e.point2DArrayToFloat64Array=function(e){const t=new Float64Array(2*e.length);for(let i=0,n=e.length;i<n;++i){const n=i<<1;t[n]=e[i].x,t[n+1]=e[i].y}return t},e.querySnap=function(e,t,i){const n=e[0];if(n>=t){if(n<=i)return!1;e[0]=i}else e[0]=t;return!0},e.round=function(e){return Math.round(e)},e.rsqrt=function(e){return 1/Math.sqrt(e)},e.s_four=f,e.s_half=De,e.s_one=_,e.s_one$1=we,e.s_zero=g,e.s_zero$1=Te,e.shortMax=function(){return 32767},e.sign=function(e){return e<0?-1:e>0?1:0},e.snap=xe,e.snapMagnitude=function(e,t){return e>=t?t:e<-t?-t:e},e.sortRange=function(e,t,i,n){const s=e.slice(t,t+i);s.sort(n),z(e,s,t,0,i)},e.sqr=E,e.sqrt2=function(){return 1.4142135623730951},e.standardNumericCompare=function(e,t){return e<t?-1:e>t?1:0},e.standardNumericCompare2=function(e,t,i,n){return e<i?-1:e>i?1:t<n?-1:t>n?1:0},e.swap=Y,e.threeHalfPi=function(){return be},e.twoPi=function(){return $},e.unique=function(e,t){if(e.length<2)return e.length;let i=0;for(let n=1;n<e.length;++n)t(e[n],e[i])||(i++,e[n]=Y(e[i],e[i]=e[n]));return 1+i},e.unorderedPop=function(e,t){e[t]=e.at(-1),e.pop()}}))},"esri/chunks/Envelope2D":function(){define(["exports","./Geometry","./Point2D"],(function(e,t,i){"use strict";class n{static construct(e,t,i,s){return new n(e,t,i,s)}constructor(e,t,i,n){this.m_EnvelopeType=2,void 0===e?(this.xmin=Number.NaN,this.ymin=Number.NaN,this.xmax=Number.NaN,this.ymax=Number.NaN):"number"==typeof e?(this.xmin=e,this.ymin=t,this.xmax=i,this.ymax=n):(this.xmin=e.xmin,this.ymin=e.ymin,this.xmax=e.xmax,this.ymax=e.ymax),this.normalize()}static constructEmpty(){return new n(Number.NaN,Number.NaN,Number.NaN,Number.NaN)}clone(){return new n(this)}assign(e){return this.xmin=e.xmin,this.xmax=e.xmax,this.ymin=e.ymin,this.ymax=e.ymax,this}width(){return this.xmax-this.xmin}height(){return this.ymax-this.ymin}maxDimension(){return Math.max(this.width(),this.height())}minDimension(){return Math.min(this.width(),this.height())}sqrDiagonal(){const e=this.width(),t=this.height();return e*e+t*t}diagonal(){return Math.sqrt(this.sqrDiagonal())}getCenterX(){return.5*(this.xmin+this.xmax)}getCenterY(){return.5*(this.ymin+this.ymax)}getCenter(){return i.Point2D.construct(this.getCenterX(),this.getCenterY())}queryCenter(e){e.x=.5*(this.xmin+this.xmax),e.y=.5*(this.ymin+this.ymax)}setEmpty(){this.xmin=Number.NaN,this.ymin=Number.NaN,this.xmax=Number.NaN,this.ymax=Number.NaN}setInfinite(){this.xmin=Number.NEGATIVE_INFINITY,this.xmax=Number.POSITIVE_INFINITY,this.ymin=Number.NEGATIVE_INFINITY,this.ymax=Number.POSITIVE_INFINITY}isDegenerate(e){return!this.isEmpty()&&(this.width()<=e||this.height()<=e)}isZero(){return!(this.isEmpty()||this.width()&&this.height())}isEmpty(){return Number.isNaN(this.xmin)||Number.isNaN(this.ymin)||Number.isNaN(this.xmax)||Number.isNaN(this.ymax)}mergeNeCoords(e,t){this.xmin>e?this.xmin=e:this.xmax<e&&(this.xmax=e),this.ymin>t?this.ymin=t:this.ymax<t&&(this.ymax=t)}mergeNe(e){this.mergeNeCoords(e.x,e.y)}mergeCoords(e,t){this.isEmpty()?(this.xmin=e,this.ymin=t,this.xmax=e,this.ymax=t):(this.xmin>e?this.xmin=e:this.xmax<e&&(this.xmax=e),this.ymin>t?this.ymin=t:this.ymax<t&&(this.ymax=t))}merge(e){this.mergeCoords(e.x,e.y)}mergeEnvelope2D(e){e.isEmpty()||(this.mergeCoords(e.xmin,e.ymin),this.mergeNeCoords(e.xmax,e.ymax))}mergePoints(e,t){for(let i=0;i<t;){if(!this.isEmpty()){for(let n=i;n<t;n++)this.mergeNe(e[n]);break}this.setCoords(e[i]),i++}}mergePointsInterleaved(e,t,i){for(let n=2*t,s=n+2*i;n<s;n+=2)this.mergeCoords(e.read(n),e.read(n+1))}inflateCoords(e,t){this.isEmpty()||(this.xmin-=e,this.xmax+=e,this.ymin-=t,this.ymax+=t,(this.xmin>this.xmax||this.ymin>this.ymax)&&this.setEmpty())}getInflatedCoords(e,t){const i=this.clone();return i.inflateCoords(e,t),i}inflate(e){this.inflateCoords(e,e)}getInflated(e){const t=this.clone();return t.inflateCoords(e,e),t}zoom(e,t){this.isEmpty()||this.setCoords({center:this.getCenter(),width:e*this.width(),height:t*this.height()})}scale(e){e<0&&this.setEmpty(),this.xmin*=e,this.xmax*=e,this.ymin*=e,this.ymax*=e}equals(e,t){return!(!this.isEmpty()||!e.isEmpty())||(t?Math.abs(this.xmin-e.xmin)<=t&&Math.abs(this.ymin-e.ymin)<=t&&Math.abs(this.xmax-e.xmax)<=t&&Math.abs(this.ymax-e.ymax)<=t:this.xmin===e.xmin&&this.ymin===e.ymin&&this.xmax===e.xmax&&this.ymax===e.ymax)}setCoords(e){void 0!==e.xmin?(this.xmin=e.xmin,this.xmax=e.xmax,this.ymin=e.ymin,this.ymax=e.ymax):void 0!==e.x?(this.xmin=e.x,this.xmax=e.x,this.ymin=e.y,this.ymax=e.y):void 0!==e.pt1?(this.xmin=e.pt1.x,this.ymin=e.pt1.y,this.xmax=e.pt2.x,this.ymax=e.pt2.y,this.normalize()):void 0!==e.env2D?(this.xmin=e.env2D.xmin,this.xmax=e.env2D.xmax,this.ymin=e.env2D.ymin,this.ymax=e.env2D.ymax,this.normalize()):void 0!==e.pt?(this.xmin=e.pt.x,this.xmax=e.pt.x,this.ymin=e.pt.y,this.ymax=e.pt.y):void 0!==e.center?(this.xmin=e.center.x-.5*e.width,this.xmax=this.xmin+e.width,this.ymin=e.center.y-.5*e.height,this.ymax=this.ymin+e.height,this.normalize()):t.throwNotImplementedException("unrecognized input type for setCoords"),this.normalize()}queryIntervalX(e){this.isEmpty()?e.setEmpty():e.setCoords(this.xmin,this.xmax)}queryIntervalY(e){this.isEmpty()?e.setEmpty():e.setCoords(this.ymin,this.ymax)}setFromPoints(e,t){if(0===t)return void this.setEmpty();if(Array.isArray(e)){const i=e;this.setCoords(i[0]);for(let e=1;e<t;){if(!this.isEmpty()){for(let n=e;n<t;n++)this.mergeNe(i[n]);return}this.setCoords(i[e]),e++}return}const i=e;this.setCoords({x:i[0],y:i[1]});for(let e=1,n=2*t;e<n;e+=2){if(!this.isEmpty()){for(let n=e,s=2*t;n<s;n+=2)this.mergeNeCoords(i[n],i[n+1]);return}this.setCoords({x:i[e],y:i[e+1]}),e+=2}}normalize(){let e=!1;this.xmin<=this.xmax||([this.xmin,this.xmax]=[this.xmax,this.xmin],e=!0),this.ymin<=this.ymax||([this.ymin,this.ymax]=[this.ymax,this.ymin],e=!0),!e||this.xmin<=this.xmax&&this.ymin<=this.ymax||this.setEmpty()}isValid(){return this.isEmpty()||this.xmin<=this.xmax&&this.ymin<=this.ymax}getLowerLeft(){return new i.Point2D(this.xmin,this.ymin)}getLowerRight(){return new i.Point2D(this.xmax,this.ymin)}getUpperLeft(){return new i.Point2D(this.xmin,this.ymax)}getUpperRight(){return new i.Point2D(this.xmax,this.ymax)}move(e,t){this.isEmpty()||(this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t)}centerAtCoords(e,t){this.move(e-this.getCenterX(),t-this.getCenterY())}centerAt(e){this.centerAtCoords(e.x,e.y)}containsCoords(e,t){return e>=this.xmin&&e<=this.xmax&&t>=this.ymin&&t<=this.ymax}contains(e){return this.containsCoords(e.x,e.y)}containsEnvelope(e){return e.xmin>=this.xmin&&e.xmax<=this.xmax&&e.ymin>=this.ymin&&e.ymax<=this.ymax}containsExclusiveCoords(e,t){return e>this.xmin&&e<this.xmax&&t>this.ymin&&t<this.ymax}containsExclusive(e){return this.containsExclusiveCoords(e.x,e.y)}containsExclusiveEnvelope(e){return e.xmin>this.xmin&&e.xmax<this.xmax&&e.ymin>this.ymin&&e.ymax<this.ymax}isIntersecting(e){return(this.xmin<=e.xmin?this.xmax>=e.xmin:e.xmax>=this.xmin)&&(this.ymin<=e.ymin?this.ymax>=e.ymin:e.ymax>=this.ymin)}isIntersectingNe(e){return(this.xmin<=e.xmin?this.xmax>=e.xmin:e.xmax>=this.xmin)&&(this.ymin<=e.ymin?this.ymax>=e.ymin:e.ymax>=this.ymin)}intersect(e){if(this.isEmpty())return!1;if(e.isEmpty())return this.setEmpty(),!1;e.xmin>this.xmin&&(this.xmin=e.xmin),e.xmax<this.xmax&&(this.xmax=e.xmax),e.ymin>this.ymin&&(this.ymin=e.ymin),e.ymax<this.ymax&&(this.ymax=e.ymax);const t=this.xmin<=this.xmax&&this.ymin<=this.ymax;return t||this.setEmpty(),t}queryCorner(e){switch(3&e){case 0:return new i.Point2D(this.xmin,this.ymin);case 1:return new i.Point2D(this.xmin,this.ymax);case 2:return new i.Point2D(this.xmax,this.ymax);default:return new i.Point2D(this.xmax,this.ymin)}}queryCorners(e){e[0].setCoords(this.xmin,this.ymin),e[1].setCoords(this.xmin,this.ymax),e[2].setCoords(this.xmax,this.ymax),e[3].setCoords(this.xmax,this.ymin)}queryCornersReversed(e){e[0].setCoords(this.xmin,this.ymin),e[1].setCoords(this.xmax,this.ymin),e[2].setCoords(this.xmax,this.ymax),e[3].setCoords(this.xmin,this.ymax)}reaspect(e,t){if(this.isEmpty())return;const i=e/t,n=.5*this.width(),s=.5*this.height()*i;if(n<=s){const e=this.getCenterX();this.xmin=e-s,this.xmax=e+s}else{const e=n/i,t=this.getCenterY();this.ymin=t-e,this.ymax=t+e}this.normalize()}getArea(){return this.isEmpty()?0:this.width()*this.height()}getLength(){return this.isEmpty()?0:2*(this.width()+this.height())}clipCode(e){return(e.x<this.xmin?1:0)|(e.x>this.xmax?1:0)<<1|(e.y<this.ymin?1:0)<<2|(e.y>this.ymax?1:0)<<3}clipLine(e,t){let i=this.clipCode(e),s=this.clipCode(t);if(i&s)return 0;if(!(i|s))return 4;const r=(i?1:0)|(s?2:0);do{const r=t.x-e.x,o=t.y-e.y;if(Math.abs(r)>Math.abs(o)?i&n.XMASK?(i&n.XLESSXMIN?(e.y+=o*(this.xmin-e.x)/r,e.x=this.xmin):(e.y+=o*(this.xmax-e.x)/r,e.x=this.xmax),i=this.clipCode(e)):s&n.XMASK?(s&n.XLESSXMIN?(t.y+=o*(this.xmin-t.x)/r,t.x=this.xmin):(t.y+=o*(this.xmax-t.x)/r,t.x=this.xmax),s=this.clipCode(t)):i?(i&n.YLESSYMIN?(e.x+=r*(this.ymin-e.y)/o,e.y=this.ymin):(e.x+=r*(this.ymax-e.y)/o,e.y=this.ymax),i=this.clipCode(e)):(s&n.YLESSYMIN?(t.x+=r*(this.ymin-t.y)/o,t.y=this.ymin):(t.x+=r*(this.ymax-t.y)/o,t.y=this.ymax),s=this.clipCode(t)):i&n.YMASK?(i&n.YLESSYMIN?(e.x+=r*(this.ymin-e.y)/o,e.y=this.ymin):(e.x+=r*(this.ymax-e.y)/o,e.y=this.ymax),i=this.clipCode(e)):s&n.YMASK?(s&n.YLESSYMIN?(t.x+=r*(this.ymin-t.y)/o,t.y=this.ymin):(t.x+=r*(this.ymax-t.y)/o,t.y=this.ymax),s=this.clipCode(t)):i?(i&n.XLESSXMIN?(e.y+=o*(this.xmin-e.x)/r,e.x=this.xmin):(e.y+=o*(this.xmax-e.x)/r,e.x=this.xmax),i=this.clipCode(e)):(s&n.XLESSXMIN?(t.y+=o*(this.xmin-t.x)/r,t.x=this.xmin):(t.y+=o*(this.xmax-t.x)/r,t.x=this.xmax),s=this.clipCode(t)),i&s)return 0}while(i|s);return r}distanceFromEnvelope(e){return Math.sqrt(this.sqrDistanceEnvelope(e,null,null))}distance(e){return Math.sqrt(this.sqrDistance(e))}sqrDistanceEnvelope(e,t,i){if(!t&&!i){if(this.isEmpty()||e.isEmpty())return Number.NaN;let t,i=0,n=0;return t=this.xmin-e.xmax,t>i&&(i=t),t=this.ymin-e.ymax,t>n&&(n=t),t=e.xmin-this.xmax,t>i&&(i=t),t=e.ymin-this.ymax,t>n&&(n=t),i*i+n*n}if(this.isEmpty()||e.isEmpty())return t&&t.setNAN(),i&&i.setNAN(),Number.NaN;let n,s=0,r=0;const o=Math.max(this.xmin,e.xmin),a=Math.max(this.ymin,e.ymin);return t&&t.setCoords(o,a),i&&i.setCoords(o,a),n=this.xmin-e.xmax,n>s&&(s=n,t&&(t.x=this.xmin),i&&(i.x=e.xmax)),n=this.ymin-e.ymax,n>r&&(r=n,t&&(t.y=this.ymin),i&&(i.y=e.ymax)),n=e.xmin-this.xmax,n>s&&(s=n,t&&(t.x=this.xmax),i&&(i.x=e.xmin)),n=e.ymin-this.ymax,n>r&&(r=n,t&&(t.y=this.ymax),i&&(i.y=e.ymin)),s*s+r*r}sqrDistance(e,t){if(void 0===t){if(this.isEmpty()||e.isNAN())return Number.NaN;let t,i=0,n=0;return t=this.xmin-e.x,t>i&&(i=t),t=this.ymin-e.y,t>n&&(n=t),t=e.x-this.xmax,t>i&&(i=t),t=e.y-this.ymax,t>n&&(n=t),i*i+n*n}if(this.isEmpty()||e.isNAN())return t.setNAN(),Number.NaN;t.assign(e);let i,n=0,s=0;return i=this.xmin-e.x,i>n&&(n=i,t.x=this.xmin),i=this.ymin-e.y,i>s&&(s=i,t.y=this.ymin),i=e.x-this.xmax,i>n&&(n=i,t.x=this.xmax),i=e.y-this.ymax,i>s&&(s=i,t.y=this.ymax),n*n+s*s}sqrMaxMinDistanceEnvelope(e){if(this.isEmpty()||e.isEmpty())return Number.NaN;let t=Number.MAX_VALUE;{const n=i.Point2D.sqrDistanceCoords(this.xmin,this.ymin,e.xmax,e.ymin),s=i.Point2D.sqrDistanceCoords(this.xmin,this.ymin,e.xmax,e.ymax),r=i.Point2D.sqrDistanceCoords(this.xmin,this.ymax,e.xmax,e.ymin),o=i.Point2D.sqrDistanceCoords(this.xmin,this.ymax,e.xmax,e.ymax),a=Math.max(n,s),l=Math.max(r,o),c=Math.max(a,l);t=Math.min(c,t)}{const n=i.Point2D.sqrDistanceCoords(this.xmin,this.ymin,e.xmin,e.ymax),s=i.Point2D.sqrDistanceCoords(this.xmin,this.ymin,e.xmax,e.ymax),r=i.Point2D.sqrDistanceCoords(this.xmax,this.ymin,e.xmin,e.ymax),o=i.Point2D.sqrDistanceCoords(this.xmax,this.ymin,e.xmax,e.ymax),a=Math.max(n,s),l=Math.max(r,o),c=Math.max(a,l);t=Math.min(c,t)}{const n=i.Point2D.sqrDistanceCoords(this.xmax,this.ymin,e.xmin,e.ymin),s=i.Point2D.sqrDistanceCoords(this.xmax,this.ymin,e.xmin,e.ymax),r=i.Point2D.sqrDistanceCoords(this.xmax,this.ymax,e.xmin,e.ymin),o=i.Point2D.sqrDistanceCoords(this.xmax,this.ymax,e.xmin,e.ymax),a=Math.max(n,s),l=Math.max(r,o),c=Math.max(a,l);t=Math.min(c,t)}{const n=i.Point2D.sqrDistanceCoords(this.xmin,this.ymax,e.xmin,e.ymin),s=i.Point2D.sqrDistanceCoords(this.xmin,this.ymax,e.xmax,e.ymin),r=i.Point2D.sqrDistanceCoords(this.xmax,this.ymax,e.xmin,e.ymin),o=i.Point2D.sqrDistanceCoords(this.xmax,this.ymax,e.xmax,e.ymin),a=Math.max(n,s),l=Math.max(r,o),c=Math.max(a,l);t=Math.min(c,t)}return t}sqrMaxDistanceEnvelope(e){if(this.isEmpty()||e.isEmpty())return Number.NaN;let t=0;const n=i.makeObjectArray(i.Point2D,4);this.queryCorners(n);const s=i.makeObjectArray(i.Point2D,4);e.queryCorners(s);for(let e=0;e<4;e++)for(let r=0;r<4;r++){const o=i.Point2D.sqrDistance(n[e],s[r]);o>t&&(t=o)}return t}sqrMaxMinDistance(e){const t=i.Point2D.sqrDistance(e,this.getLowerLeft()),n=i.Point2D.sqrDistance(e,this.getUpperLeft()),s=i.Point2D.sqrDistance(e,this.getLowerRight()),r=i.Point2D.sqrDistance(e,this.getUpperRight());let o,a=Math.max(t,n);return o=Math.max(t,s),a>o&&(a=o),o=Math.max(n,r),a>o&&(a=o),o=Math.max(s,r),a>o&&(a=o),a}sqrMinDistance(e){return this.contains(e)?0:this.sqrDistance(e)}sqrMaxDistance(e){let t=i.Point2D.sqrDistance(e,this.getLowerLeft());return t=Math.max(i.Point2D.sqrDistance(e,this.getUpperLeft()),t),t=Math.max(i.Point2D.sqrDistance(e,this.getUpperRight()),t),t=Math.max(i.Point2D.sqrDistance(e,this.getLowerRight()),t),t}snapToBoundary(e){if(e.isNAN())return!1;if(this.isEmpty())return e.setNAN(),!0;let t=!0;if(e.x<this.xmin?e.x=this.xmin:e.x>this.xmax?e.x=this.xmax:t=!1,e.y<this.ymin?e.y=this.ymin:e.y>this.ymax?e.y=this.ymax:t=!1,t)return!0;if(e.x===this.xmin||e.x===this.xmax||e.y===this.ymin||e.y===this.ymax)return!1;const i=this.xmax-e.x,n=e.x-this.xmin,s=this.ymax-e.y,r=e.y-this.ymin;return Math.max(i,n)>Math.max(s,r)?e.y=r<s?this.ymin:this.ymax:e.x=n<i?this.xmin:this.xmax,!0}snapClip(e){const t=i.snap(e.x,this.xmin,this.xmax),n=i.snap(e.y,this.ymin,this.ymax);return i.Point2D.construct(t,n)}boundaryDistance(e){if(this.isEmpty()||e.isNAN())return Number.NaN;if(e.x===this.xmin)return e.y-this.ymin;const t=this.ymax-this.ymin,n=this.xmax-this.xmin;if(e.y===this.ymax)return t+e.x-this.xmin;if(e.x===this.xmax)return t+n+this.ymax-e.y;if(e.y===this.ymin)return 2*t+n+this.xmax-e.x;const s=new i.Point2D;return s.setCoordsPoint2D(e),this.snapToBoundary(s),this.boundaryDistance(s)}envelopeSide(e){if(this.isEmpty())return-1;let t=this.boundaryDistance(e);const i=this.ymax-this.ymin,n=this.xmax-this.xmin;return t<i?0:(t-=i)<n?1:t-n<i?2:3}querySide(e,i){switch(e){case 0:i.constructFromCoords(this.xmin,this.ymin,this.xmin,this.ymax);break;case 1:i.constructFromCoords(this.xmin,this.ymax,this.xmax,this.ymax);break;case 2:i.constructFromCoords(this.xmax,this.ymax,this.xmax,this.ymin);break;case 3:i.constructFromCoords(this.xmax,this.ymin,this.xmin,this.ymin);break;default:t.throwInvalidArgumentException("query_side")}return i}isPointOnBoundary(e,t){return Math.abs(e.x-this.xmin)<=t||Math.abs(e.x-this.xmax)<=t||Math.abs(e.y-this.ymin)<=t||Math.abs(e.y-this.ymax)<=t}calculateToleranceFromEnvelope(){return this.isEmpty()?i.geomEpsFactor():(Math.abs(this.xmin)+Math.abs(this.xmax)+Math.abs(this.ymin)+Math.abs(this.ymax)+1)*i.geomEpsFactor()}toString(){return`[${this.xmin}, ${this.ymin}, ${this.xmax}, ${this.ymax}]`}}n.XLESSXMIN=1,n.YLESSYMIN=4,n.XMASK=3,n.YMASK=12,e.Envelope2D=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/Transformation2D":function(){define(["exports","./Geometry","./Point2D"],(function(e,t,i){"use strict";class n{constructor(e,t,i){if(e instanceof n)return this.data=e.data,this.N=e.N,this.M=e.M,e.data=null,e.N=0,void(e.M=0);this.data=e,this.N=t,this.M=i}assignCopy(e){return this===e||(t.geometryReleaseAssert(this.N*this.M===e.N*e.M),this.data.set(e.data),this.N=e.N,this.M=e.M),this}setZero(){return this.data?.fill(0),this}setIdentity(){for(let e=0;e<this.N;e++)for(let t=0;t<this.M;t++)this.setRowCol(e,t,e===t?1:0);return this}rows(){return this.N}cols(){return this.M}row(e){return t.geometryReleaseAssert(0),{}}set(e,t){return this.data[e]=t,this}setRowCol(e,t,i){return this.data[e*this.M+t]=i,this}at(e){return this.data[e]}atRowCol(e,t){return this.data[e*this.M+t]}mulScalar(e,i){t.geometryReleaseAssert(0)}mul(e,i){if(t.geometryReleaseAssert(this.M===e.rows()),t.geometryReleaseAssert(this.N===i.rows()),t.geometryReleaseAssert(e.cols()===i.cols()),i===this){const t=new Float64Array(this.N*this.M),s=new n(t,this.N,this.M);return this.mul(e,s),void i.assignCopy(s)}if(i===e){const t=new Float64Array(e.N*e.M),s=new n(t,e.N,e.M);return this.mul(e,s),void i.assignCopy(s)}const s=e.cols();for(let t=0;t<this.N;t++)for(let n=0;n<s;n++){let s=0;for(let i=0;i<this.M;i++)s+=this.atRowCol(t,i)*e.atRowCol(i,n);i.setRowCol(t,n,s)}}mulTranspose(e,i){if(t.geometryReleaseAssert(this.M===e.cols()),t.geometryReleaseAssert(this.N===i.rows()),t.geometryReleaseAssert(e.rows()===i.cols()),i===this){const t=new Float64Array(this.N*this.M),s=new n(t,this.N,this.M);return this.mulTranspose(e,s),void i.assignCopy(s)}if(i===e){const t=new Float64Array(e.N*e.M),s=new n(t,e.N,e.M);return this.mulTranspose(e,s),void i.assignCopy(s)}const s=e.rows();for(let t=0;t<this.N;t++)for(let n=0;n<s;n++){let s=0;for(let i=0;i<this.M;i++)s+=this.atRowCol(t,i)*e.atRowCol(n,i);i.setRowCol(t,n,s)}}mulLeft(e,i){t.geometryReleaseAssert(0)}mulLeftTranspose(e,i){t.geometryReleaseAssert(0)}mulDiag(e,i){if(t.geometryReleaseAssert(this.M===e.N*e.M),t.geometryReleaseAssert(this.N===i.rows()),t.geometryReleaseAssert(this.M===i.cols()),i===this){const t=new Float64Array(this.N*this.M),s=new n(t,this.N,this.M);return this.mulDiag(e,s),void i.assignCopy(s)}const s=this.M;for(let t=0;t<this.N;t++)for(let n=0;n<s;n++)i.setRowCol(t,n,this.atRowCol(t,n)*e.at(n))}transposeInPlace(){if(this.N===this.M){for(let e=0;e<this.N;e++)for(let t=e+1;t<this.M;t++){const i=this.atRowCol(e,t);this.setRowCol(e,t,this.atRowCol(t,e)),this.setRowCol(t,e,i)}return this}const e=new Float64Array(this.N*this.M),t=new n(e,this.N,this.M);return t.assignCopy(this),this.M=i.swap(this.N,this.N=this.M),t.transpose(this),this}transpose(e){if(this!==e){n.checkDims(e,this.M,this.N);for(let t=0;t<this.N;t++)for(let i=0;i<this.M;i++)e.setRowCol(i,t,this.atRowCol(t,i))}else e.transposeInPlace()}add(e,t){}svd(e,i,s,r=!1){if(n.checkDims(e,this.N,this.M),n.checkDims(i,this.M,1),n.checkDims(s,this.M,this.M),r){if(t.geometryReleaseAssert(this.N===this.M),!this.symmetricEigen(i,s))return!1;for(let e=0;e<this.M;++e)i.at(e)<0&&i.set(e,0);return e.assignCopy(s),!0}let o,a,l,c,h,u,m,d=0,p=0,g=0,_=0,f=0;const y=this.M,x=this.N;e.assignCopy(this);const v=new Float64Array(y),P=new n(v,y,1),b=(e,t)=>t>=0?Math.abs(e):-Math.abs(e),E=(e,t)=>{if((e=Math.abs(e))>(t=Math.abs(t))){const i=t/e;return e*Math.sqrt(i*i+1)}if(t>0){const i=e/t;return t*Math.sqrt(i*i+1)}return 0};for(let t=0;t<y;t++){if(d=t+1,P.set(t,_*g),g=c=_=0,t<x){for(let i=t;i<x;i++)_+=Math.abs(e.atRowCol(i,t));if(_){for(let i=t;i<x;i++)e.setRowCol(i,t,e.atRowCol(i,t)/_),c+=e.atRowCol(i,t)*e.atRowCol(i,t);a=e.atRowCol(t,t),g=-b(Math.sqrt(c),a),l=a*g-c,e.setRowCol(t,t,a-g);for(let i=d;i<y;i++){c=0;for(let n=t;n<x;n++)c+=e.atRowCol(n,t)*e.atRowCol(n,i);a=c/l;for(let n=t;n<x;n++)e.setRowCol(n,i,e.atRowCol(n,i)+a*e.atRowCol(n,t))}for(let i=t;i<x;i++)e.setRowCol(i,t,e.atRowCol(i,t)*_)}}if(i.set(t,_*g),g=c=_=0,t<x&&t!==y-1){for(let i=d;i<y;i++)_+=Math.abs(e.atRowCol(t,i));if(_){for(let i=d;i<y;i++)e.setRowCol(t,i,e.atRowCol(t,i)/_),c+=e.atRowCol(t,i)*e.atRowCol(t,i);a=e.atRowCol(t,d),g=-b(Math.sqrt(c),a),l=a*g-c,e.setRowCol(t,d,a-g);for(let i=d;i<y;i++)P.set(i,e.atRowCol(t,i)/l);for(let i=d;i<x;i++){c=0;for(let n=d;n<y;n++)c+=e.atRowCol(i,n)*e.atRowCol(t,n);for(let t=d;t<y;t++)e.setRowCol(i,t,e.atRowCol(i,t)+c*P.at(t))}for(let i=d;i<y;i++)e.setRowCol(t,i,e.atRowCol(t,i)*_)}}const n=Math.abs(i.at(t))+Math.abs(P.at(t));f=n>f?n:f}for(let t=y-1;t>=0;t--){if(t<y-1){if(g){for(let i=d;i<y;i++)s.setRowCol(i,t,e.atRowCol(t,i)/e.atRowCol(t,d)/g);for(let i=d;i<y;i++){c=0;for(let n=d;n<y;n++)c+=e.atRowCol(t,n)*s.atRowCol(n,i);for(let e=d;e<y;e++)s.setRowCol(e,i,s.atRowCol(e,i)+c*s.atRowCol(e,t))}}for(let e=d;e<y;e++)s.setRowCol(t,e,0),s.setRowCol(e,t,0)}s.setRowCol(t,t,1),g=P.at(t),d=t}for(let t=(x<y?x:y)-1;t>=0;t--){d=t+1,g=i.at(t);for(let i=d;i<y;i++)e.setRowCol(t,i,0);if(g){g=1/g;for(let i=d;i<y;i++){c=0;for(let n=d;n<x;n++)c+=e.atRowCol(n,t)*e.atRowCol(n,i);a=c/e.atRowCol(t,t)*g;for(let n=t;n<x;n++)e.setRowCol(n,i,e.atRowCol(n,i)+a*e.atRowCol(n,t))}for(let i=t;i<x;i++)e.setRowCol(i,t,e.atRowCol(i,t)*g)}else for(let i=t;i<x;i++)e.setRowCol(i,t,0);e.setRowCol(t,t,e.atRowCol(t,t)+1)}for(let t=y-1;t>=0;t--)for(let n=1;;n++){let r=1;for(d=t;d>=0;d--){if(p=d-1,Math.abs(P.at(d))+f===f){r=0;break}if(Math.abs(i.at(p))+f===f)break}if(r){o=0,c=1;for(let n=d;n<=t&&(a=c*P.at(n),P.set(n,P.at(n)*o),Math.abs(a)+f!==f);n++){g=i.at(n),l=E(a,g),i.set(n,l),l=1/l,o=g*l,c=-a*l;for(let t=0;t<x;t++)u=e.atRowCol(t,p),m=e.atRowCol(t,n),e.setRowCol(t,p,u*o+m*c),e.setRowCol(t,n,m*o-u*c)}}if(m=i.at(t),d===t){if(m<0){i.set(t,-m);for(let e=0;e<y;e++)s.setRowCol(e,t,-s.atRowCol(e,t))}break}if(100===n)return!1;h=i.at(d),p=t-1,u=i.at(p),g=P.at(p),l=P.at(t),a=((u-m)*(u+m)+(g-l)*(g+l))/(2*l*u),g=E(a,1),a=((h-m)*(h+m)+l*(u/(a+b(g,a))-l))/h,o=c=1;for(let t=d;t<=p;t++){const n=t+1;g=P.at(n),u=i.at(n),l=c*g,g*=o,m=E(a,l),P.set(t,m),o=a/m,c=l/m,a=h*o+g*c,g=g*o-h*c,l=u*c,u*=o;for(let e=0;e<y;e++)h=s.atRowCol(e,t),m=s.atRowCol(e,n),s.setRowCol(e,t,h*o+m*c),s.setRowCol(e,n,m*o-h*c);m=E(a,l),i.set(t,m),m&&(m=1/m,o=a*m,c=l*m),a=o*g+c*u,h=o*u-c*g;for(let i=0;i<x;i++)u=e.atRowCol(i,t),m=e.atRowCol(i,n),e.setRowCol(i,t,u*o+m*c),e.setRowCol(i,n,m*o-u*c)}P.set(d,0),P.set(t,a),i.set(t,h)}const S=new Float64Array(this.N),C=new Float64Array(this.M),w=new n(S,this.N,1),T=new n(C,this.M,1);let D=1;do{D*=3,D++}while(D<=this.M);do{D/=3,D=Math.trunc(D);for(let t=D;t<this.M;t++){const n=i.at(t);for(let i=0;i<this.N;i++)w.set(i,e.atRowCol(i,t));for(let e=0;e<this.M;e++)T.set(e,s.atRowCol(e,t));let r=t;for(;i.at(r-D)<n;){i.set(r,i.at(r-D));for(let t=0;t<this.N;t++)e.setRowCol(t,r,e.atRowCol(t,r-D));for(let e=0;e<this.M;e++)s.setRowCol(e,r,s.atRowCol(e,r-D));if(r-=D,r<D)break}i.set(r,n);for(let t=0;t<this.N;t++)e.setRowCol(t,r,w.at(t));for(let e=0;e<this.M;e++)s.setRowCol(e,r,T.at(e))}}while(D>1);for(let t=0;t<this.M;t++){let i=0;for(let n=0;n<this.N;n++)e.atRowCol(n,t)<0&&i++;for(let e=0;e<this.M;e++)s.atRowCol(e,t)<0&&i++;if(i>Math.trunc((this.N+this.M)/2)){for(let i=0;i<this.N;i++)e.setRowCol(i,t,-e.atRowCol(i,t));for(let e=0;e<this.M;e++)s.setRowCol(e,t,-s.atRowCol(e,t))}}return!0}isSymmetric(){if(this.N!==this.M)return!1;for(let e=0;e<this.N;e++)for(let t=e+1;t<this.M;t++)if(this.atRowCol(e,t)!==this.atRowCol(t,e))return!1;return!0}isZero(){return t.geometryReleaseAssert(0),!1}isIdentity(){return t.geometryReleaseAssert(0),!1}equals(e,i){if(void 0!==i&&t.geometryReleaseAssert(0),this.N!==e.N||this.M!==e.M)return!1;for(let t=0;t<this.N*this.M;t++)if(this.data[t]!==e.data[t])return!1;return!0}maxElement(){return t.geometryReleaseAssert(0),0}minElement(){return t.geometryReleaseAssert(0),0}determinant(){if(t.geometryReleaseAssert(this.N===this.M),1===this.N)return this.data[0];if(2===this.N)return this.data[0]*this.data[3]-this.data[1]*this.data[2];if(3===this.N){const e=this;return e.atRowCol(0,0)*(e.atRowCol(1,1)*e.atRowCol(2,2)-e.atRowCol(1,2)*e.atRowCol(2,1))-e.atRowCol(0,1)*(e.atRowCol(1,0)*e.atRowCol(2,2)-e.atRowCol(2,0)*e.atRowCol(1,2))+e.atRowCol(0,2)*(e.atRowCol(1,0)*e.atRowCol(2,1)-e.atRowCol(1,1)*e.atRowCol(2,0))}const e=new Float64Array(this.N*this.N),i=new n(e,this.N,this.N),s=new Float64Array(this.N);if(!this.luDecomposition(i,s))return 0;let r=1;for(let e=0;e<this.N;e++)r*=i.atRowCol(e,e),s[e]!==e&&(r=-r);return r}submatrix(e,i,n){t.geometryReleaseAssert(0)}inverse(e){t.geometryReleaseAssert(0)}pseudoInverse(e,t=!1,i=2220446049250313e-31){if(e.setZero(),1===this.N&&1===this.M)return 0!==this.atRowCol(0,0)?e.setRowCol(0,0,1/this.atRowCol(0,0)):e.setRowCol(0,0,0),!0;if(2===this.N&&2===this.M){const t=this.atRowCol(0,0)*this.atRowCol(1,1)-this.atRowCol(0,1)*this.atRowCol(1,0),i=1e-5*(Math.abs(this.atRowCol(0,0)*this.atRowCol(1,1))+Math.abs(this.atRowCol(0,1)*this.atRowCol(1,0)));if(Math.abs(t)>i)return e.setRowCol(0,0,this.atRowCol(1,1)/t),e.setRowCol(0,1,-this.atRowCol(0,1)/t),e.setRowCol(1,0,-this.atRowCol(1,0)/t),e.setRowCol(1,1,this.atRowCol(0,0)/t),!0}const s=new Float64Array(this.N*this.M),r=new n(s,this.N,this.M),o=new Float64Array(this.M),a=new n(o,this.M,1),l=new Float64Array(this.M*this.M),c=new n(l,this.M,this.M);if(!this.svd(r,a,c,t))return!1;const h=Math.max(this.N,this.M),u=i*Math.abs(a.at(0))*h;for(let e=0;e<this.M;e++)a.at(e)>u?a.set(e,1/a.at(e)):a.set(e,0);return c.mulDiag(a,e),e.mulTranspose(r,e),!0}luDecomposition(e,i){return t.geometryReleaseAssert(0),!1}symmetricEigen(e,i){t.geometryReleaseAssert(this.rows()===this.cols()),t.geometryReleaseAssert(this.rows()===e.rows()),t.geometryReleaseAssert(i.rows()===i.cols()&&i.rows()===this.rows()),t.geometryReleaseAssert(this.isSymmetric());const s=new Float64Array(this.N*this.M),r=new n(s,this.N,this.M);r.assignCopy(this);const o=100/Number.EPSILON,a=this.rows(),l=new Float64Array(a),c=new Float64Array(a),h=new n(l,a,1),u=new n(c,a,1);for(let t=0;t<a;t++)h.set(t,r.atRowCol(t,t)),e.set(t,r.atRowCol(t,t)),u.set(t,0);i.setIdentity();const m=()=>{const t=h;i.transposeInPlace();let n=1;do{n*=3,n++}while(n<=a);do{n/=3,n=Math.trunc(n);for(let s=n;s<a;s++){const r=e.at(s),o=Math.abs(r);for(let e=0;e<this.M;e++)t.set(e,i.atRowCol(e,s));let a=s;for(;Math.abs(e.at(a-n))<o;){e.set(a,e.at(a-n));for(let e=0;e<this.M;e++)i.setRowCol(e,a,i.atRowCol(e,a-n));if(a-=n,a<n)break}if(a!==s){e.set(a,r);for(let e=0;e<this.M;e++)i.setRowCol(e,a,t.at(e))}}}while(n>1)};for(let t=1;;t++){let n=0;for(let e=1;e<a;e++)for(let t=0;t<e;t++)n+=Math.abs(r.atRowCol(e,t));if(0===n)return m(),!0;const s=t<4?.2*n/(a*a):0;for(let n=0;n<a;n++)for(let l=n+1;l<a;l++){let c=o*Math.abs(r.atRowCol(l,n));if(t>4&&c<=Math.abs(e.at(n))&&c<=Math.abs(e.at(l)))r.setRowCol(l,n,0);else if(Math.abs(r.atRowCol(l,n))>s){let t,s=e.at(l)-e.at(n);if(c<Math.abs(s))t=r.atRowCol(l,n)/s;else{const e=.5*s/r.atRowCol(l,n);t=1/(Math.abs(e)+Math.sqrt(1+e*e)),e<0&&(t=-t)}const o=1/Math.sqrt(1+t*t),h=t*o,m=h/(1+o);s=t*r.atRowCol(l,n),u.set(n,u.at(n)-s),u.set(l,u.at(l)+s),e.set(n,e.at(n)-s),e.set(l,e.at(l)+s),r.setRowCol(l,n,0);let d=0;for(;d<n;d++)c=r.atRowCol(n,d),s=r.atRowCol(l,d),r.setRowCol(n,d,c-h*(s+c*m)),r.setRowCol(l,d,s+h*(c-s*m));for(d++;d<l;d++)c=r.atRowCol(d,n),s=r.atRowCol(l,d),r.setRowCol(d,n,c-h*(s+c*m)),r.setRowCol(l,d,s+h*(c-s*m));for(d++;d<a;d++)c=r.atRowCol(d,n),s=r.atRowCol(d,l),r.setRowCol(d,n,c-h*(s+c*m)),r.setRowCol(d,l,s+h*(c-s*m));for(d=0;d<a;d++)c=i.atRowCol(n,d),s=i.atRowCol(l,d),i.setRowCol(n,d,c-h*(s+c*m)),i.setRowCol(l,d,s+h*(c-s*m))}}for(let t=0;t<a;t++)h.set(t,h.at(t)+u.at(t)),e.set(t,h.at(t)),u.set(t,0)}}static checkDims(e,i,n){t.geometryReleaseAssert(e.rows()===i&&e.cols()===n)}}class s extends n{constructor(e){if(e.copy){const t=new Float64Array(e.copy.N*e.copy.M);return super(t,e.copy.N,e.copy.M),this.buffer=t,void this.assignCopy(e.copy)}const t=new Float64Array(e.NN*e.MM);super(t,e.NN,e.MM),this.buffer=t,e.initializerList&&i.memcpy(this.buffer,e.initializerList,0,0,e.initializerList.length)}assignCopy(e){return this===e||super.assignCopy(e),this}}class r{constructor(e){this.m_TransformationType=1,void 0===e?this.setIdentity():e instanceof r?this.set(e):this.setScale(e)}set(e){return this.xx=e.xx,this.xy=e.xy,this.xd=e.xd,this.yx=e.yx,this.yy=e.yy,this.yd=e.yd,this}clone(){return(new r).set(this)}setZero(){this.xx=0,this.yy=0,this.xy=0,this.yx=0,this.xd=0,this.yd=0}isEqual(e){return this===e||this.xx===e.xx&&this.xy===e.xy&&this.xd===e.xd&&this.yx===e.yx&&this.yy===e.yy&&this.yd===e.yd}transformInPlace(e){const t=this.xx*e.x+this.xy*e.y+this.xd,i=this.yx*e.x+this.yy*e.y+this.yd;e.x=t,e.y=i}transform(e){const t=e.clone();return this.transformInPlace(t),t}queryTransform(e,t){const i=this.xx*e.x+this.xy*e.y+this.xd,n=this.yx*e.x+this.yy*e.y+this.yd;t.setCoords(i,n)}transformEnvInPlace(e){if(e.isEmpty())return;const t=i.makeObjectArray(i.Point2D,4);e.queryCorners(t),this.transformPoints2D(t,4,t),e.setFromPoints(t,4)}queryTransformEnv(e,i){t.geometryReleaseAssert(0)}transformPoints2D(e,t,i){for(let n=0;n<t;++n)this.queryTransform(e[n],i[n])}transformInterleavedPoints(e,t,n){t*=2;const s=i.Point2D.getNAN();for(let i=0;i<t;i+=2)s.x=e[i],s.y=e[i+1],this.transformInPlace(s),n[i]=s.x,n[i+1]=s.y}multiply(e){return r.st_multiply(this,e,this),this}mulLeft(e){return t.geometryReleaseAssert(0),this}static st_multiply(e,t,i){const n=e.xx*t.xx+e.yx*t.xy,s=e.xy*t.xx+e.yy*t.xy,r=e.xd*t.xx+e.yd*t.xy+t.xd,o=e.xx*t.yx+e.yx*t.yy,a=e.xy*t.yx+e.yy*t.yy,l=e.xd*t.yx+e.yd*t.yy+t.yd;i.xx=n,i.xy=s,i.xd=r,i.yx=o,i.yy=a,i.yd=l}getCoefficients(e){t.geometryReleaseAssert(e.length>=6),e[0]=this.xx,e[1]=this.xy,e[2]=this.xd,e[3]=this.yx,e[4]=this.yy,e[5]=this.yd}setCoefficients(e){t.geometryReleaseAssert(e.length>=6),this.xx=e[0],this.xy=e[1],this.xd=e[2],this.yx=e[3],this.yy=e[4],this.yd=e[5]}copyTo(e){t.geometryReleaseAssert(0)}initializeFromRect(e,t){e.isEmpty()||t.isEmpty()||!e.width()||!e.height()?this.setZero():(this.xy=this.yx=0,this.xx=t.width()/e.width(),this.yy=t.height()/e.height(),this.xd=t.xmin-e.xmin*this.xx,this.yd=t.ymin-e.ymin*this.yy)}initializeFromRectIsotropic(e,t){if(e.isEmpty()||!e.width()||!e.height()||t.isEmpty())this.setZero();else{this.yx=0,this.xy=0,this.xx=t.width()/e.width(),this.yy=t.height()/e.height(),this.xx>this.yy?this.xx=this.yy:this.yy=this.xx;const i=t.getCenter(),n=e.getCenter();this.xd=i.x-n.x*this.xx,this.yd=i.y-n.y*this.yy}}initializeFromTwoPointsArray(e,n){if(e[0].equals(n[0])&&e[1].equals(n[1]))return void this.setIdentity();if(e[0].equals(e[1])){if(n[0].equals(n[1]))return void this.setShift(n[0].sub(e[0]));t.throwInvalidArgumentException("")}if(!e[0].equals(e[1])&&n[0].equals(n[1]))return this.setZero(),void this.shift(n[0]);this.setShiftCoords(-e[0].x,-e[0].y);const s=i.Point2D.distance(e[0],e[1]),r=i.Point2D.distance(n[0],n[1]),o=r/s;this.scale(o,o);const a=e[1].sub(e[0]);a.divThis(s);const l=n[1].sub(n[0]);l.divThis(r);const c=a.crossProduct(l),h=a.dotProduct(l);this.rotate(h,c),this.shiftCoords(n[0].x,n[0].y)}initializeFromTwoPoints(e,t,i,n){const s=[e,t],r=[i,n];this.initializeFromTwoPointsArray(s,r)}transformSizeInPlace(e){t.geometryReleaseAssert(0)}transformSize(e,i){t.geometryReleaseAssert(0)}transformTol(e){return t.geometryReleaseAssert(0),0}transformWithoutTranslateArray(e,t,i){for(let n=0;n<t;++n)this.transformWithoutTranslate(e[n],i[n])}transformWithoutTranslateInPlace(e){const t=this.xx*e.x+this.xy*e.y,i=this.yx*e.x+this.yy*e.y;e.setCoords(t,i)}transformWithoutTranslate(e,t){const i=this.xx*e.x+this.xy*e.y,n=this.yx*e.x+this.yy*e.y;t.setCoords(i,n)}setIdentity(){this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=1,this.yd=0}isIdentity(){return!(1!==this.xx||1!==this.yy||this.xy||this.xd||this.yx||this.yd)}isIdentityTol(e){const t=e*e;return!(i.sqr(this.xd)+i.sqr(this.yd)>t||i.sqr(this.xy+this.xd)+i.sqr(this.yy+this.yd-1)>t||i.sqr(this.xx+this.xd-1)+i.sqr(this.yx+this.yd)>t)}isReflective(){return this.xx*this.yy-this.yx*this.xy<0}isUniform(e){const t=this.xx*this.xx+this.yx*this.yx,i=this.xy*this.xy+this.yy*this.yy,n=(t+i)*e;return Math.abs(t-i)<=n&&Math.abs(this.xx*this.xy+this.yx*this.yy)<=n}isUniformNoRotation(){return 0!==this.xx&&Math.abs(this.xx)===Math.abs(this.yy)&&0===this.xy&&0===this.yx}isTranslate(){return 1===this.xx&&1===this.yy&&!this.xy&&!this.yx}isTranslateTol(e){const t=new i.Point2D;return t.setCoords(0,1),this.transformWithoutTranslateInPlace(t),t.y-=1,!(t.sqrLength()>e*e)&&(t.setCoords(1,0),this.transformWithoutTranslateInPlace(t),t.x-=1,t.sqrLength()<=e*e)}isOrthonormal(e){const t=new r;return t.xx=this.xx*this.xx+this.xy*this.xy,t.xy=this.xx*this.yx+this.xy*this.yy,t.yx=this.yx*this.xx+this.yy*this.xy,t.yy=this.yx*this.yx+this.yy*this.yy,t.xd=0,t.yd=0,t.isIdentityTol(e)}isDegenerate(e){return Math.abs(this.xx*this.yy-this.yx*this.xy)<=2*e*(Math.abs(this.xx*this.yy)+Math.abs(this.yx*this.xy))}isZero(){return 0===this.xx&&0===this.yy&&0===this.xy&&0===this.yx&&0===this.xd&&0===this.yd}isScaleAndTranslateTol(e){return this.xy*this.xy+this.yx*this.yx<=(this.xx*this.xx+this.yy*this.yy)*e}setTranslate(e,t){return this.xx=1,this.xy=0,this.xd=e,this.yx=0,this.yy=1,this.yd=t,this}setShiftCoords(e,t){return this.xx=1,this.xy=0,this.xd=e,this.yx=0,this.yy=1,this.yd=t,this}setShift(e){return this.xx=1,this.xy=0,this.xd=e.x,this.yx=0,this.yy=1,this.yd=e.y,this}setScaleCoords(e,t){return this.xx=e,this.xy=0,this.xd=0,this.yx=0,this.yy=t,this.yd=0,this}setScale(e){return this.setScaleCoords(e,e),this}setFlipX(e,t){return this.xx=-1,this.xy=0,this.xd=e+t,this.yx=0,this.yy=1,this.yd=0,this}setFlipY(e,t){return this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=-1,this.yd=e+t,this}setShear(e,t){return this.xx=1,this.xy=e,this.xd=0,this.yx=t,this.yy=1,this.yd=0,this}scale(e,t){return this.xx*=e,this.xy*=e,this.xd*=e,this.yx*=t,this.yy*=t,this.yd*=t,this}setRotateAngle(e){return this.setRotate(Math.cos(e),Math.sin(e))}setRotate(e,t){return this.xx=e,this.xy=-t,this.xd=0,this.yx=t,this.yy=e,this.yd=0,this}setRotateAngleAbout(e,t){return this.setRotateAbout(Math.cos(e),Math.sin(e),t)}setRotateAbout(e,t,i){return this.setTranslate(-i.x,-i.y),this.rotate(e,t),this.translate(i.x,i.y)}setSwapCoordinates(){return this.xx=0,this.xy=1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}setRotateCw90(){return this.xx=0,this.xy=1,this.xd=0,this.yx=-1,this.yy=0,this.yd=0,this}setRotateCcw90(){return this.xx=0,this.xy=-1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}shiftCoords(e,t){return this.xd+=e,this.yd+=t,this}shift(e){return this.xd+=e.x,this.yd+=e.y,this}translate(e,t){return this.xd+=e,this.yd+=t,this}flipX(e,t){return this.xx=-this.xx,this.xy=-this.xy,this.xd=e+t-this.xd,this}flipY(e,t){return this.yx=-this.yx,this.yy=-this.yy,this.yd=e+t-this.yd,this}shear(e,t){const i=new r;return i.setShear(e,t),this.multiply(i)}rotateAngle(e){const t=new r;return t.setRotateAngle(e),this.multiply(t)}rotate(e,t){const i=new r;return i.setRotate(e,t),this.multiply(i)}rotateAbout(e,t,i){return this.translate(-i.x,-i.y),this.rotate(e,t),this.translate(i.x,i.y)}rotateAngleAbout(e,t){return this.rotateAbout(Math.cos(e),Math.sin(e),t)}setInvert(e){return this.set(e),this.invertThis()}invertThis(){let e=this.xx*this.yy-this.xy*this.yx;if(0===e)return this.setZero(),this;e=1/e;const t=(this.xy*this.yd-this.xd*this.yy)*e,i=(this.xd*this.yx-this.xx*this.yd)*e,n=this.yy*e,s=-this.xy*e,r=-this.yx*e,o=this.xx*e;return this.xd=t,this.yd=i,this.xx=n,this.yy=o,this.xy=s,this.yx=r,this}invertPrecise(e){return this.set(e),this.invertPreciseThis()}invertPreciseThis(){const e=i.MPValue.constructDouble(this.xy),t=i.MPValue.constructDouble(this.xx),n=t.mulDouble(this.yy).sub(e.mulDouble(this.yx));if(n.isZero())return this.setZero(),this;const s=n.clone();s.invertThis();const r=i.MPValue.constructDouble(this.xd),o=e.mulDouble(this.yd).sub(r.mulDouble(this.yy)).mul(s).toDouble(),a=r.mulDouble(this.yx).sub(t.mulDouble(this.yd)).mul(s).toDouble(),l=s.mulDouble(this.yy).toDouble(),c=s.mulDouble(-this.xy).toDouble(),h=s.mulDouble(-this.yx).toDouble(),u=s.mulDouble(this.xx).toDouble();return this.xd=o,this.yd=a,this.xx=l,this.yy=u,this.xy=c,this.yx=h,this}extractScaleTransform(e,t){const i=Math.sqrt(this.xx*this.xx+this.xy*this.xy),n=Math.sqrt(this.yx*this.yx+this.yy*this.yy);t.setScaleCoords(1/i,1/n),t.multiply(this),e.setScaleCoords(i,n)}setFromTwoTriangles(e,t){let n=!0;for(let i=0;i<3;++i)n=n&&e[i].equals(t[i]);if(n)return this.setIdentity(),!0;const s=new i.Point2D;s.setSub(e[0],e[1]);const r=new i.Point2D;r.setSub(e[0],e[2]);const o=new i.Point2D;o.setSub(t[0],t[1]);const a=new i.Point2D;a.setSub(t[0],t[2]);const l=4*Number.EPSILON*(Math.abs(s.x*r.y)+Math.abs(r.x*s.y));let c=s.x*r.y-s.y*r.x;return Math.abs(c)>l?(c=1/c,this.xx=(o.x*r.y-s.y*a.x)*c,this.xy=(s.x*a.x-o.x*r.x)*c,this.yx=(o.y*r.y-s.y*a.y)*c,this.yy=(s.x*a.y-o.y*r.x)*c,this.xd=t[0].x-(this.xx*e[0].x+this.xy*e[0].y),this.yd=t[0].y-(this.yx*e[0].x+this.yy*e[0].y),!0):(this.setZero(),!1)}initializeFromControlPoints(e,n,l,c,h=null){return 0===n?(this.setIdentity(),void(h&&h.setIdentity())):1===n?(this.setShift(c[0].sub(l[0])),void(h&&h.setShift(l[0].sub(c[0])))):(n<3&&(e=1),void(4===e&&n>2?function(e,n,r,o,l){const c=i.Point2D.average(r,n),h=i.Point2D.average(o,n),u=new s({NN:2,MM:2});u.setZero();const m=new s({NN:2,MM:2});m.setZero();for(let e=0;e<n;++e)u.setRowCol(0,0,u.atRowCol(0,0)+(r[e].x-c.x)*(r[e].x-c.x)),u.setRowCol(0,1,u.atRowCol(0,1)+(r[e].x-c.x)*(r[e].y-c.y)),u.setRowCol(1,1,u.atRowCol(1,1)+(r[e].y-c.y)*(r[e].y-c.y)),m.setRowCol(0,0,m.atRowCol(0,0)+(o[e].x-h.x)*(r[e].x-c.x)),m.setRowCol(0,1,m.atRowCol(0,1)+(o[e].x-h.x)*(r[e].y-c.y)),m.setRowCol(1,0,m.atRowCol(1,0)+(o[e].y-h.y)*(r[e].x-c.x)),m.setRowCol(1,1,m.atRowCol(1,1)+(o[e].y-h.y)*(r[e].y-c.y));u.setRowCol(1,0,u.atRowCol(0,1));const d=new s({NN:2,MM:2});u.pseudoInverse(d,!0)||t.throwMathSingularityException("Failed to compute pseudo inverse"),m.mul(d,m),a(e,m);const p=c.clone();e.transformInPlace(p),e.xd=h.x-p.x,e.yd=h.y-p.y,l&&(m.pseudoInverse(d,!1)||t.throwMathSingularityException("Failed to compute pseudo inverse"),a(l,d),l.transformInPlace(h),l.xd=c.x-h.x,l.yd=c.y-h.y)}(this,n,l,c,h):function(e,n,l,c,h,u){t.geometryReleaseAssert(1===e||0===e||2===e||3===e),n.setIdentity();const m=i.Point2D.average(c,l),d=i.Point2D.average(h,l);if(t.geometryReleaseAssert(e<o.length&&e>0),8&o[e]){const i=new s({NN:2,MM:2});i.setZero();for(let e=0;e<l;++e)i.setRowCol(0,0,i.atRowCol(0,0)+(h[e].x-d.x)*(c[e].x-m.x)),i.setRowCol(1,0,i.atRowCol(1,0)+(h[e].x-d.x)*(c[e].y-m.y)),i.setRowCol(0,1,i.atRowCol(0,1)+(h[e].y-d.y)*(c[e].x-m.x)),i.setRowCol(1,1,i.atRowCol(1,1)+(h[e].y-d.y)*(c[e].y-m.y));const u=new s({NN:2,MM:2}),p=new s({NN:2,MM:1}),g=new s({NN:2,MM:2});i.svd(u,p,g)||t.throwMathSingularityException("Failed to compute svd");const _=new s({NN:2,MM:2});u.transpose(_);const f=new s({NN:2,MM:2});g.mul(_,f),32&o[e]||f.determinant()<0&&(_.setRowCol(1,0,-_.atRowCol(1,0)),_.setRowCol(1,1,-_.atRowCol(1,1)),g.mul(_,f));const y=new r;a(y,f),n.set(y)}if(2&o[e]){let e=0,t=0;for(let i=0;i<l;++i){const s=c[i].sub(m);e+=s.sqrLength(),n.transformInPlace(s),t+=s.dotProduct(h[i].sub(d))}if(0===e)0===t?n.setIdentity():n.setZero();else{const i=t/e;n.scale(i,i)}}else t.geometryReleaseAssert(!(4&o[e]));const p=m.clone();n.transformInPlace(p),n.xd=d.x-p.x,n.yd=d.y-p.y,u&&(u.set(n),u.invertThis(),u.isZero()&&(u.xd=m.x,u.yd=m.y))}(e,this,n,l,c,h)))}calculateErrors(e,n,s,r){t.geometryReleaseAssert(e>0&&null!==n&&null!==s);let o=0;for(let t=0;t<e;++t){const e=this.transform(n[t]),a=i.Point2D.sqrDistance(s[t],e);o+=a,r&&(r[t]=Math.sqrt(a))}return Math.sqrt(o/e)}}const o=[43,11,41,9,61];function a(e,i){t.geometryReleaseAssert(!(2!==i.rows()&&3!==i.rows()||2!==i.cols()&&3!==i.rows())),e.xx=i.atRowCol(0,0),e.xy=i.atRowCol(0,1),e.yx=i.atRowCol(1,0),e.yy=i.atRowCol(1,1),3===i.cols()?(e.xd=i.atRowCol(0,2),e.yd=i.atRowCol(1,2)):(e.xd=0,e.yd=0)}e.Transformation2D=r}))},"esri/chunks/SimpleGeometryCursor":function(){define(["exports"],(function(e){"use strict";class t{*[Symbol.iterator](){let e=this.next();for(;e;)yield e,e=this.next()}}e.GeometryCursor=t,e.OverlayGeometryCursor=class extends t{},e.SimpleGeometryCursor=class extends t{constructor(e){super(),this.m_iGeom=-1,this.m_aGeoms=e?e.slice():[]}next(){if(this.m_iGeom<this.m_aGeoms.length-1){const e=this.m_aGeoms[++this.m_iGeom];return this.m_aGeoms[this.m_iGeom]=null,e}return null}tock(){return!1}getGeometryID(){return this.m_iGeom}getRank(){return 1}}}))},"esri/chunks/ProjectionTransformation":function(){define(["exports","./Envelope2D","./Geometry","./MultiPathImpl","./Envelope","./Point2D","./tslib.es6","./Transformation2D","./OperatorClip","./OperatorDensify","./SimpleGeometryCursor","./OperatorDefinitions"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";class m{constructor(e){if(this.m_geom=this.m_sr=null,e){if(e.move)return this.m_geom=e.move.m_geom,e.move.m_geom=null,this.m_sr=e.move.m_sr,void(e.move.m_sr=null);if(e.copy)return this.m_geom=e.copy.m_geom?e.copy.m_geom.clone():null,void(this.m_sr=e.copy.m_sr);e.geom&&(this.m_geom=e.geom),e.sr&&(this.m_sr=e.sr)}}getGeometry(){return this.m_geom}getSpatialReference(){return this.m_sr}setGeometry(e){this.m_geom=e}setSpatialReference(e){this.m_sr=e}equals(e,t){const i=e;return!(!this.m_sr&&i.m_sr||this.m_sr&&!i.m_sr||!this.m_geom&&i.m_geom||this.m_geom&&!i.m_geom||this.m_sr&&i.m_sr&&!this.m_sr.equals(i.m_sr)||this.m_geom&&i.m_geom&&!this.m_geom.equals(i.m_geom,t))}clone(){let e=null;return this.m_geom&&(e=this.m_geom.clone()),new m({geom:e,sr:this.m_sr})}hasGeom(){return!!this.m_geom}}class d{constructor(e){this.m_factor=1,this.m_wkid=0,this.m_peUnit=null,e&&(this.m_peUnit=e,this.m_factor=e.getUnitFactor(),this.m_wkid=e.getCode(),this.m_wkid<0&&(this.m_wkid=0))}getName(){return this.m_peUnit?this.m_peUnit.getName():""}getID(){return this.m_wkid}getConversionFactor(e){return this.getUnitType()!==e.getUnitType()&&i.throwInvalidArgumentException("unit type mismatch"),this.getUnitToBaseFactor()/e.getUnitToBaseFactor()}getUnitToBaseFactor(){return this.m_factor}getHashCode(){return r.hashCombine(r.hashInt32(this.getUnitType()),r.hashInt32(this.getUnitToBaseFactor()))}equals(e){return!!e&&this.getUnitType()===e.getUnitType()&&this.getUnitToBaseFactor()===e.getUnitToBaseFactor()&&this.getID()===e.getID()&&this.getName()===e.getName()}static isValidWkid(e){return!1}}const p={330:104878,500:104879,1300:104899,1450:104986,2230:104988,3800:104978,5e3:104919,6200:104906,8200:104909,9500:104927,9600:104977,1e4:[104911,104936],11e3:104941,11080:104872,11100:104907,12e3:104920,12400:104995,13e3:104948,14e3:[104923,104989],15e3:[104913,104954],15100:104976,16e3:[104926,104931],18e3:[104922,104982],21e3:104947,21500:104877,27e3:[104950,104957],29e3:104964,3e4:104921,31e3:104949,33e3:104946,4e4:[104914,104967],40600:104897,41900:104937,42e3:104951,43100:104993,49300:104924,50100:104939,54e3:104955,58200:104981,59500:104930,74e3:104961,77e3:104956,79e3:104962,83500:104910,85e3:104917,88800:104934,89200:104985,96e3:104997,104e3:104963,106500:104898,11e4:104938,133e3:104932,135e3:104983,17e4:104965,198200:104987,198630:104935,208e3:104966,235800:104952,249400:104929,252100:104980,255e3:104973,47e4:104972,529800:104942,531e3:104996,56e4:104928,561400:104979,578900:104945,584700:104959,593e3:104970,606e3:104999,718e3:104933,745700:104984,761400:104953,763500:104994,764e3:104940,788900:104958,1188300:104998,1195e3:104969,1352600:104968,1560800:104874,1562090:104915,1737400:104903,1821460:104918,1821490:104876,2409300:104912,2410300:104873,2439400:104974,2439700:104900,2575e3:104943,2631200:104875,2632345:104916,3393400:104904,3396190:[104905,104971],6051e3:104901,6051800:104902,637e4:104128,6370997:[4052,37008],6371e3:4035,6371007:4047,6371228:[4053,10346],6376045:[8042,8043],6376523:[4027,4901,4902],6376896:37007,6378135:[4122,4322,4324,4720,4985,4987],6378136:[4740,4923,7678,7680,9474,9475,104017,104018],6378137:[3823,3824,3888,3889,4017,4019,4023,4031,4040,4046,4055,4074,4075,4080,4081,4121,4126,4130,4133,4140,4141,4148,4151,4152,4163,4166,4167,4170,4171,4172,4173,4176,4180,4189,4190,4258,4269,4283,4318,4319,4326,4463,4466,4469,4470,4480,4482,4483,4490,4557,4558,4612,4617,4619,4624,4627,4659,4661,4667,4669,4670,4674,4686,4687,4693,4694,4702,4737,4742,4747,4749,4750,4755,4756,4757,4758,4759,4761,4762,4763,4764,4765,4883,4885,4887,4889,4893,4895,4898,4907,4909,4921,4925,4927,4929,4931,4933,4935,4937,4939,4941,4943,4945,4947,4949,4951,4953,4955,4957,4959,4961,4963,4965,4967,4971,4975,4977,4979,4981,4983,4989,4997,4999,5012,5013,5245,5246,5251,5252,5263,5264,5323,5324,5340,5342,5353,5354,5359,5360,5364,5365,5370,5371,5372,5373,5380,5381,5392,5393,5488,5489,5545,5546,5592,5593,5885,5886,6134,6135,6310,6311,6318,6319,6321,6322,6324,6325,6364,6365,6667,6668,6705,6706,6782,6783,6980,6982,6983,6987,6989,6990,7034,7035,7036,7037,7038,7039,7040,7041,7042,7072,7073,7084,7085,7086,7087,7133,7135,7136,7138,7139,7372,7373,7657,7659,7661,7663,7665,7685,7686,7797,7798,7816,7843,7844,7880,7881,7885,7886,7900,7901,7902,7903,7904,7905,7906,7907,7908,7909,7910,7911,7912,7915,7917,7919,7921,7923,7925,7927,7929,7931,8085,8086,8231,8232,8235,8237,8239,8240,8244,8246,8248,8249,8251,8252,8254,8255,8399,8403,8426,8427,8449,8542,8544,8545,8684,8685,8698,8699,8817,8818,8860,8888,8899,8900,8901,8902,8906,8907,8916,8918,8920,8922,8924,8926,8928,8930,8932,8934,8936,8938,8940,8942,8944,8946,8948,8949,8972,8973,8974,8975,8976,8977,8978,8979,8980,8981,8982,8983,8984,8985,8986,8987,8988,8989,8990,8991,8992,8993,8994,8995,8996,8997,8998,8999,9e3,9002,9003,9005,9006,9008,9009,9011,9012,9013,9014,9016,9017,9018,9019,9053,9054,9055,9056,9057,9059,9060,9061,9062,9063,9064,9065,9066,9067,9068,9069,9071,9072,9074,9075,9139,9140,9147,9148,9152,9153,9183,9184,9293,9294,9299,9308,9309,9332,9333,9364,9372,9379,9380,9384,9453,9469,9470,9546,9547,9695,9696,9701,9702,9739,9754,9755,9758,9763,9776,9777,9778,9779,9781,9782,9783,9784,9866,9871,9939,9964,9969,9974,9989,9990,10175,10177,10178,10185,10191,10196,10204,10209,10214,10219,10224,10229,10237,10272,10277,10283,10284,10298,10299,10300,10304,10305,10307,10309,10310,10311,10312,10327,10328,10413,10414,10468,10474,10475,10570,10571,10605,10606,10623,10628,10638,10639,10670,10671,10672,10673,10689,10690,10724,10725,10738,10739,10761,10762,10780,10781,10784,10785,10799,10800,20033,20040,20041,20045,20046,104009,104010,104011,104012,104013,104014,104015,104016,104019,104020,104021,104022,104024,104027,104028,104050,104100,104107,104108,104110,104111,104114,104115,104116,104117,104118,104119,104120,104121,104122,104123,104124,104129,104133,104134,104137,104141,104142,104143,104144,104145,104179,104180,104181,104182,104183,104184,104185,104186,104199,104223,104257,104258,104259,104260,104286,104287,104602,104613,104644,104645,104646,104647,104653,104804,104896,104991],6378140:4610,6378145:[4025,4276,4760,4891,37001],6378150:37003,6378155:[37004,37207],6378160:[3821,4003,4021,4036,4202,4203,4237,4238,4291,4618,4708,5527,37231,104023,104136],6378166:37002,6378200:[4020,4229,4286,4303,4706],6378245:[4024,4147,4164,4178,4179,4191,4200,4205,4214,4284,4317,4555,4676,4677,4678,4991,4993,5560,5561,37257,104135],6378270:[4732,37005,37229],6378273:[4054,10345],6378300:[4029,4168,4174],6378388:[4022,4123,4153,4154,4158,4159,4160,4161,4165,4181,4182,4183,4184,4185,4192,4194,4195,4196,4199,4204,4207,4208,4215,4218,4221,4224,4225,4230,4231,4233,4235,4236,4247,4248,4249,4254,4255,4259,4264,4265,4271,4272,4274,4285,4287,4288,4292,4297,4309,4311,4313,4316,4472,4475,4611,4614,4615,4616,4621,4622,4623,4625,4626,4628,4629,4630,4631,4632,4633,4636,4637,4639,4641,4642,4643,4644,4645,4646,4658,4660,4662,4663,4664,4665,4668,4672,4673,4684,4688,4689,4690,4691,4692,4698,4704,4705,4707,4709,4710,4711,4712,4714,4715,4716,4718,4719,4721,4722,4724,4725,4727,4728,4729,4730,4733,4734,4735,4739,4741,4753,4754,4802,4803,4806,4809,4810,4823,4824,4900,5524,6883,8428,8430,8431,9248,9251,9253,9403,9893,10158,10249,10252,10635,10636,10735,10736,10758,37201,37204,37205,37212,37213,37214,37215,37216,37217,37218,37219,37221,37222,37224,37226,37227,37230,37232,37233,37234,37235,37237,37238,37241,37242,37245,37246,37247,37249,37250,37251,37253,37259,104104,104106,104125,104126,104127,104130,104138,104248],6378523:104786,24764e3:104960,25559e3:104944,60268e3:104925,71492e3:104908,6957e5:104975,6377397.155:[3819,3906,4004,4120,4124,4125,4149,4150,4156,4162,4211,4219,4257,4262,4280,4289,4294,4295,4301,4306,4308,4312,4314,4613,4666,4745,4746,4801,4804,4805,4808,4813,4814,4815,4818,4820,4904,5132,5228,5229,5681,5830,8351,9267,10268,37255,104101,104102,104105,104131,104648,104696,104697,104990,104992],6377563.396:[4001,4188,4277,4278,4279],6377340.189:[4002,4299,4300],6377492.018:[4005,4273,4817],6377483.865280418:[4006,4293],6378293.645208759:[4007,4157,4302,4738,5464],6378206.4:[4008,4127,4128,4129,4135,4136,4137,4138,4139,4169,4216,4242,4253,4267,4608,4609,4638,4675,4683,4695,4717,4723,4726,4995,5451,5467,37220,37239,37243,37252,37260,104e3,104109,104112,104113,104132],6378450.047:[4009,4268],6378300.789:[4010,4281],6378249.2:[4011,4014,4155,4193,4206,4213,4223,4226,4227,4228,4252,4261,4266,4275,4282,4296,4304,4310,4315,4671,4807,4811,4816,4821,37223,37225,104139,104140,104261,104304],6378249.145:[4012,4013,4132,4134,4142,4143,4175,4197,4198,4201,4209,4210,4212,4220,4222,4232,4234,4246,4250,4251,4256,4260,4263,4270,4305,4307,4600,4601,4602,4603,4604,4605,4606,4607,4620,4679,4680,4696,4697,4699,4700,4701,4703,4713,4731,4736,4743,4744,4812,4819,6881,6882,6892,6894,8694,37206,37208,37211,37228,37240,37254,104025,104026,104103,104305],6377276.345:[4015,4131,4144,4239,4240,4244,4682,5233,6207,37202,104256,104664,104693],6377298.556:[4016,4298],6377304.063:[4018,4245],6378298.3:[4028,4903],6378136.2:4032,6378136.3:4033,6378249.144808011:[4034,4241],20922931.8:[4042,4243],6377301.243:[4044,4145,37203],6377299.151:[4045,4146],6377019.27:[4657,10256,10260,10265],6378306.3696:[4748,4752],6377295.664:[4751,37006],6378136.5:[7682,7683],6371008.7714:104047,6378418.941:[104700,104726,104760],6378586.581:[104701,104743],6378505.809:104702,6378544.823:104703,6378490.569:104704,6378470.757:[104705,104776],6378403.701:[104706,104750],6378434.181:[104707,104724,104739,104764],6378454.907:104708,6378400.653:104709,6378567.378:104710,6378546.957:[104711,104717,104780],6378476.853:[104712,104736],6378411.321:[104713,104728],6378647.541:[104714,104715],6378514.953:[104716,104782],6378421.989:[104718,104770],6378481.425:[104719,104753,104774,104781],6378518.001:[104720,104725],6378521.049:[104721,104723,104731,104745,104748],6378464.661:104722,6378436.619:104727,6378574.389:[104729,104730],6378472.281:[104732,104756],6378498.189:[104733,104746],6378449.421:[104734,104766],6378525.621:[104735,104754],6378466.185:104737,6378496.665:104738,6378643.579:104740,6378559.758:104741,6378414.369:[104742,104763,104772],6378441.801:104744,6378502.761:[104747,104759,104773,104775],6378617.061:104749,6378624.681:[104751,104765],6378468.623:104752,6378445.763:[104755,104758,104761],6378670.401:104757,6378438.753:104762,6378543.909:104767,6378605.783:104768,6378540.861:104769,6378443.325:[104771,104784],6378548.481:104777,6378463.746:104778,6378426.561:104779,6378453.688:104783,6378530.193:104785,6378376.271:[104800,104828],6378471.92:104801,6378472.931:104802,6378411.351:104803,6378380.991:104805,6378414.96:104806,6378345.09:[104807,104819,104844,104870],6378412.542:104808,6378470.401:104809,6378376.331:104810,6378379.031:104811,6378407.621:104812,6378376.811:[104813,104827],6378313.92:104814,6378414.93:104815,6378413.021:104816,6378380.381:104817,6378530.851:104818,6378591.521:104820,6378378.881:104821,6378408.481:[104822,104832],6378375.601:[104823,104838],6378408.041:104824,6378655.071:104825,6378409.151:104826,6378315.7:[104829,104840,104845,104851],6378285.86:[104830,104835,104859],6378379.301:104831,6378560.121:104833,6378531.821:104834,6378500.6:104836,6378376.041:104837,6378406.601:104839,6378438.991:104841,6378345.42:104842,6378593.86:104843,6378381.271:[104846,104847],6378413.671:104848,6378344.377:104849,6378563.891:104850,6378408.091:104852,6378377.671:104853,6378472.751:104854,6378412.511:104855,6378407.281:104856,6378534.451:104857,6378406.051:104858,6378532.921:104860,6378380.091:104861,6378408.941:104862,6378624.171:104863,6378377.411:104864,6378474.591:104865,6378407.141:104866,6378376.871:104867,6378375.251:104868,6378405.971:104869,6378437.651:104871};class g extends d{constructor(e){if("number"==typeof e)return super(),this.m_factor=e,void(this.m_wkid=0);super(e)}getUnitType(){return 1}convertFromRadians(e){return e/this.getUnitToBaseFactor()}convertToRadians(e){return e*this.getUnitToBaseFactor()}}class _{constructor(e,t,n){void 0===e?(this.x=new r.ECoordinate,this.y=new r.ECoordinate,this.z=new r.ECoordinate):e instanceof s.Point3D?(this.x=new r.ECoordinate(e.x),this.y=new r.ECoordinate(e.y),this.z=new r.ECoordinate(e.z)):e instanceof r.ECoordinate?(this.x=e.clone(),this.y=t.clone(),this.z=n.clone()):i.throwInvalidArgumentException("EPoint3D constructor")}dotProduct(e){return this.x.mulE(e.x).addE(this.y.mulE(e.y)).addE(this.z.mulE(e.z))}crossProduct(e){return new _(this.y.mulE(e.z).subE(this.z.mulE(e.y)),this.z.mulE(e.x).subE(this.x.mulE(e.z)),this.x.mulE(e.y).subE(this.y.mulE(e.x)))}crossProductVector(e){const t=this.y.mulE(e.z).subE(e.y.mulE(this.z)),i=e.x.mulE(this.z).subE(this.x.mulE(e.z)),n=this.x.mulE(e.y).subE(e.x.mulE(this.y));return new _(t,i,n)}sqrLength(){return this.x.mulE(this.x).addE(this.y.mulE(this.y)).addE(this.z.mulE(this.z))}length(){return this.sqrLength().sqrt()}static distance(e,t){return e.sub(t).length()}negate(){return new _(this.x.negate(),this.y.negate(),this.z.negate())}add(e){return new _(this.x.addE(e.x),this.y.addE(e.y),this.z.addE(e.z))}sub(e){return new _(this.x.subE(e.x),this.y.subE(e.y),this.z.subE(e.z))}subThis(e){return this.x.subThisE(e.x),this.y.subThisE(e.y),this.z.subThisE(e.z),this}addThis(e){return this.x.addThisE(e.x),this.y.addThisE(e.y),this.z.addThisE(e.z),this}mul(e){return new _(this.x.mulE(e),this.y.mulE(e),this.z.mulE(e))}div(e){return new _(this.x.divE(e),this.y.divE(e),this.z.divE(e))}eq(e){return this.x.eq(e.x)&&this.y.eq(e.y)&&this.z.eq(e.z)}isZero(){return this.x.isZero()&&this.y.isZero()&&this.z.isZero()}value(){return s.Point3D.construct(this.x.value(),this.y.value(),this.z.value())}}class f{constructor(e){if(this.m_origin=new s.Point3D,this.m_normal=new s.Point3D,this.m_axisX=new s.Point3D,this.m_axisY=new s.Point3D,!e)return this.m_origin=new s.Point3D,this.m_normal=new s.Point3D(0,0,1),this.m_axisX=new s.Point3D(1,0,0),void(this.m_axisY=new s.Point3D(0,1,0));e.pt0&&e.pt1&&e.pt2?this.setFromPoints(e.pt0,e.pt1,e.pt2):i.geometryReleaseAssert(0,`unimplemented constructor options ${JSON.stringify(e)}`)}assign(e){return i.geometryReleaseAssert(0),this}set(e,t,n,s){i.geometryReleaseAssert(0)}setFromPoints(e,t,i){let n=t.sub(e);const s=i.sub(e);this.m_normal=n.crossProductVector(s);let r=!0;if(this.m_normal.isZero()){if(r=!1,n.isZero()&&(n=s),n.isZero()){const t=0,i=1;return this.m_normal.setCoords(t,t,i),this.m_axisX.setCoords(i,t,t),this.m_axisY.setCoords(t,i,t),this.m_origin=e,!1}this.m_axisX=n.getUnitVector(),this.m_normal=this.m_axisX.createAPerpendicular()}else this.m_normal.normalizeThis(),this.m_axisX=n.getUnitVector();return this.m_axisY=this.m_normal.crossProductVector(this.m_axisX),this.m_origin=e,r}getCoord(e,t){return i.geometryReleaseAssert(0),{}}getCoord2D(e){return i.geometryReleaseAssert(0),{}}getCoordX(e,t){return i.geometryReleaseAssert(0),0}getCoordY(e,t){return i.geometryReleaseAssert(0),0}getCoordZ(e,t){return i.geometryReleaseAssert(0),0}setPreferredAxisX(e){i.geometryReleaseAssert(0)}getOrigin(){return i.geometryReleaseAssert(0),{}}getNormal(){return i.geometryReleaseAssert(0),{}}getAxisX(){return this.m_axisX.clone()}getAxisY(){return this.m_axisY.clone()}setAxisX(e,t=!1){i.geometryReleaseAssert(0)}setAxisY(e,t=!1){i.geometryReleaseAssert(0)}recalculateAxisY(){i.geometryReleaseAssert(0)}setOrigin(e){i.geometryReleaseAssert(0)}setNormal(e,t){i.geometryReleaseAssert(0)}intersect(e,t){return i.geometryReleaseAssert(0),!1}intersectLine(e){return i.geometryReleaseAssert(0),0}intersectLineEx(e,t){return i.geometryReleaseAssert(0),0}closestCoordinate(e){const t=e.sub(this.m_origin),i=new r.Point2D;return i.x=t.dotProduct(this.m_axisX),i.y=t.dotProduct(this.m_axisY),i}projectVector(e){return i.geometryReleaseAssert(0),{}}signedDistance(e){return i.geometryReleaseAssert(0),0}distance(e){return i.geometryReleaseAssert(0),0}}function y(e,t){return!1}function x(e,t,n,s,o=100,a=y){let l,c,h,u,m,d,p,g,_;i.geometryReleaseAssert(s>0);let f,x,v,P=0,b=0;const E=r.goldenRatio();t>n&&(n=r.swap(t,t=n));const S=e(t),C=e(n);S<C?(l=c=h=t,u=m=d=S):(l=c=h=n,u=m=d=C);let w=0;for(;w<o&&(v=.5*(n-t),_=t+v,f=s*(Math.abs(l)+.25),x=2*f,!(a(l,u)||Math.abs(l-_)<=x-v));++w){if(Math.abs(b)>f){const e=(l-c)*(u-d);let i=(l-h)*(u-m),s=(l-h)*i-(l-c)*e;i=2*(i-e),i>0&&(s=-s),i=Math.abs(i);const o=b;b=P,Math.abs(s)>=Math.abs(i*o*.5)||s<=i*(t-l)||s>=i*(n-l)?(b=l>=_?t-l:n-l,P=r.goldenRatio()*b):(P=s/i,g=l+P,(g-t<x||n-g<x)&&(P=_-l<0?-Math.abs(f):Math.abs(f)))}else b=l>=_?t-l:n-l,P=b*E;g=l+P,p=e(g),p<u?(g>=l?t=l:n=l,h=c,c=l,l=g,d=m,m=u,u=p):(g<l?t=g:n=g,p<=m||c===l?(h=c,c=g,d=m,m=p):(p<=d||h===l||h===c)&&(h=g,d=p))}return r.makePair(l,u)}function v(e,t,i){return e>i?e-=Math.ceil((e-i)/r.geometry2Pi)*r.geometry2Pi:e<t&&(e+=Math.ceil((t-e)/r.geometry2Pi)*r.geometry2Pi),e}function P(e,t,i){return function(e,t,i){const n=i.x,s=i.y;return b(e,t,Math.cos(n),Math.sin(n),Math.cos(s),Math.sin(s),0)}(e,t,i)}function b(e,t,i,n,r,o,a){const l=e/Math.sqrt(1-t*o*o),c=l+a,h=c*r*i,u=c*r*n,m=(l*(1-t)+a)*o;return s.Point3D.construct(h,u,m)}function E(e,t,i){const n=new r.ECoordinate,s=new r.ECoordinate,o=new r.ECoordinate,a=new r.ECoordinate;n.setCos(i.x),s.setSin(i.x),o.setCos(i.y),a.setSin(i.y);const l=a.negate().mulE(a.mul(t)).add(1).sqrt(),c=new r.ECoordinate(e).divE(l),h=c.mulE(o).mulE(n),u=c.mulE(o).mulE(s),m=c.mul(1-t).mulE(a);return new _(h,u,m)}function S(e,t,i){const n=i.x,s=i.y,o=i.z,a=Math.atan2(s,n),l=Math.sqrt(n*n+s*s),c=Math.atan2(o,(1-t)*l);return r.Point2D.construct(a,c)}function C(e,t,i){const n=1-t,s=e/Math.sqrt(r.sqr(i.x)+r.sqr(i.y)+r.sqr(i.z)/n);return i.mul(s)}function w(e,t,i,n,r){const o=P(e,t,i),a=P(e,t,n);return S(0,t,s.Point3D.lerp(o,a,r))}function T(e,t,i){const n=new s.Point3D;return n.setCrossProductVector(t,i),Math.abs(Math.atan2(n.length(),t.dotProduct(i)))*e}function D(t,n,a,l,c,h=0,u){if(2===h||3===h)return function(e,t,i,n,o,a=!1,l){const c=C(e,t,i);if(a){const a=new f({pt0:new s.Point3D(0,0,0),pt1:n,pt2:o}),h=a.closestCoordinate(i),u=a.closestCoordinate(n),m=a.closestCoordinate(o),d=r.Point2D.getClosestCoordinate(u,m,h),p=C(e,t,s.Point3D.lerp(n,o,d)),g=s.Point3D.distance(p,c);return l&&l.assign(p),r.makePair(d,g)}const h=i=>{const r=C(e,t,s.Point3D.lerp(n,o,i));return s.Point3D.distance(r,c)},u=s.Point3D.distance(n,o);if(u>0){const i=R(e,u),{first:a,second:c}=x(h,0,1,i);return l&&l.assign(C(e,t,s.Point3D.lerp(n,o,a))),r.makePair(a,c)}{const e=s.Point3D.distance(i,n);return l&&l.assign(i),r.makePair(.5,e)}}(t,n,a,l,c,3===h,u);const m=S(0,n,a),d=r=>{const a=S(0,n,s.Point3D.lerp(l,c,r));return function(t,n,r,a,l){switch(i.geometryReleaseAssert(r.isFinite()&&a.isFinite()),l){case 0:return function(t,i,n,s){const r={stack:[],error:void 0,hasError:!1};try{const a=o.__addDisposableResource(r,new e.PeDoubleClass,!1);return e.peLineType.geodeticDistance(t,i,n.x,n.y,s.x,s.y,a,null,null,e.peDefs.PE_LINETYPE_GEODESIC),a.val}catch(e){r.error=e,r.hasError=!0}finally{o.__disposeResources(r)}}(t,n,r,a);case 1:return function(t,i,n){const s={stack:[],error:void 0,hasError:!1};try{const r=o.__addDisposableResource(s,new e.PeDoubleClass,!1);return e.peLineType.greatEllipticDistance(t,i,n.x,n.y,n.x,n.y,r,null,null),r.val}catch(e){s.error=e,s.hasError=!0}finally{o.__disposeResources(s)}}(t,n,r);case 2:case 3:{const e=P(t,n,r),i=P(t,n,a);return s.Point3D.distance(e,i)}default:i.throwNotImplementedException("")}}(t,n,m,a,h)},p=s.Point3D.distance(l,c);if(p>0){const e=R(t,p),{first:i,second:o}=x(d,0,1,e);return u&&u.assign(C(t,n,s.Point3D.lerp(l,c,i))),r.makePair(i,o)}{const e=d(0);return u&&u.assign(l),r.makePair(.5,e)}}function I(e,t,i,s,o,a){if(a[0]=Number.NaN,a[1]=Number.NaN,Math.abs(i.x-s.x)>Math.PI)return 0;if(Math.abs(i.y)>r.geometryHalfPi||Math.abs(s.y)>r.geometryHalfPi)return 0;if((Math.abs(i.y)===r.geometryHalfPi||Math.abs(s.y)===r.geometryHalfPi)&&i.x!==s.x)return 0;if(Math.abs(o)>=r.geometryHalfPi)return 0;if(i.y>0&&s.y>0&&i.y>o&&s.y>o||i.y<0&&s.y<0&&i.y<o&&s.y<o)return 0;const l=n.EPoint2D.constructPoint2D(i),c=n.EPoint2D.constructPoint2D(s),h=E(1,t,l),u=E(1,t,c),m=h.crossProductVector(u);if(m.z.isZero())return r.Envelope1D.construct(i.y,s.y).containsCoordinate(o)?(a[0]=i.x,1):0;const d=m.x.divE(m.z.negate()),p=m.y.divE(m.z.negate()),g=d.mulE(d).addE(p.mulE(p)).sqrt();if(g.isZero()||d.isZero()&&p.isZero())return 0===o?(a[0]=i.x,a[1]=s.x,2):0;const _=(1-t)*Math.tan(o)/g.value();if(Math.abs(_)>1)return 0;const f=Math.acos(_),y=Math.atan2(p.value(),d.value()),x=y-f;let P=y+f;const b=Math.min(i.x,s.x),S=Math.max(i.x,s.x);v(x,b,S),0!==o?v(P,b,S):P=x;let C=0;return b<=x&&x<=S&&(a[C]=x,C++),P!==x&&b<=P&&P<=S&&(a[C]=P,C++),C}function A(e,t){t[0]>.5*Math.PI?(e[0]+=Math.PI,t[0]=Math.PI-t[0]):t[0]<.5*-Math.PI&&(e[0]-=Math.PI,t[0]=-Math.PI-t[0]),i.geometryReleaseAssert(t[0]>=.5*-Math.PI&&t[0]<=.5*Math.PI)}function M(e,t){if(0===t)return 0;const i=Math.sin(t);let n=i,s=i;if(0!==e){n/=1-e*i*i;const t=Math.sqrt(e);s=i*r.atanhUOverU(t*i)}return n+s}function N(e,t){return(1-t)*e}function R(e,t){if(0!==t){const i=e*r.geographyEpsFactor()/t;return Math.min(i,1e-10)}return 0}class O{constructor(e){this.m_currentShift=63n,this.m_currentElt=0n,this.m_iCurrentElt=-1,this.m_parent=e,this.m_aiSetElts=e.m_bits.flatMap(((e,t)=>t))}next(){if(this.m_currentShift++,64n===this.m_currentShift){if(this.m_iCurrentElt++,this.m_iCurrentElt===this.m_aiSetElts.length)return O.npos();this.m_currentShift=0n,this.m_currentElt=this.m_parent.m_bits[this.m_aiSetElts[this.m_iCurrentElt]]}for(;this.m_currentShift<63n&&!(this.m_currentElt&1n<<this.m_currentShift);)this.m_currentShift++;return this.m_currentElt&1n<<this.m_currentShift?64*this.m_aiSetElts[this.m_iCurrentElt]+Number(this.m_currentShift):this.next()}static npos(){return Number.MAX_SAFE_INTEGER}}function G(e){return 1n<<(0x3fn&BigInt(e))}function k(e){return e>>6}class V{constructor(e){this.m_bits=[],void 0!==e&&e.copy&&(this.m_bits=e.copy.m_bits.slice())}assignMove(){return this}assignCopy(){return this}hasBit(e){const t=G(e),i=k(e);return void 0!==this.m_bits[i]&&!!(this.m_bits[i]&t)}setBit(e){const t=G(e),i=k(e);void 0===this.m_bits[i]&&(this.m_bits[i]=0n),this.m_bits[i]|=t}clearBit(e){}flipBit(e){const t=G(e),i=k(e);return void 0===this.m_bits[i]&&(this.m_bits[i]=0n),this.m_bits[i]^=t,0n!==(this.m_bits[i]&t)}clear(){this.m_bits.length=0}isZero(){let e=0;return this.m_bits.forEach((t=>{e|=t?2:1})),!(2&e)}equals(e){if(this===e)return!0;if(this.m_bits.length!==e.m_bits.length)return!1;let t=0;return this.m_bits.forEach(((i,n)=>{t|=i===e.m_bits[n]?2:1})),!(1&t||(e.m_bits.forEach(((e,i)=>{t|=e===this.m_bits[i]?2:1})),1&t))}notEquals(e){return!this.equals(e)}assignOr(e){return e.m_bits.forEach(((e,t)=>{void 0===this.m_bits[t]?this.m_bits[t]=e:this.m_bits[t]|=e})),this}assignSubtract(e){return e.m_bits.forEach(((e,t)=>{void 0!==this.m_bits[t]&&(this.m_bits[t]&=~e)})),this}assignAnd(e){return e.m_bits.forEach(((e,t)=>{void 0!==this.m_bits[t]&&(this.m_bits[t]&=e)})),this}assignXor(e){return e.m_bits.forEach(((e,t)=>{void 0===this.m_bits[t]?this.m_bits[t]=e:this.m_bits[t]^=e})),this}getHashCode(){return this.m_bits.reduce(((e,t)=>r.hashCombineInt64(e,t)),r.hashInt32(0))}getUnorderedBitIterator(){return new O(this)}}class F{constructor(e,t){this.m_map=new Map,this.m_hf=e,this.m_ef=t}add(e){const t=this.m_hf(e);if(!this.m_map.has(t))return this.m_map.set(t,e),this;const i=this.m_map.get(t);return i instanceof Array?i.find((t=>this.m_ef(t,e)))||i.push(e):this.m_ef(i,e)||this.m_map.set(t,[i,e]),this}clear(){this.m_map.clear()}delete(e){return!1}has(e){const t=this.m_hf(e);if(!this.m_map.has(t))return!1;const i=this.m_map.get(t);return i instanceof Array?void 0!==i.find((t=>this.m_ef(t,e))):this.m_ef(i,e)}get(e){const t=this.m_hf(e),i=this.m_map.get(t);if(void 0!==i)return i instanceof Array?i.find((t=>this.m_ef(t,e))):i}get size(){let e=0;for(const t of this.m_map.values())e+=t instanceof Array?t.length:1;return e}forEach(e,t){}[Symbol.iterator](){return(new Set)[Symbol.iterator]()}entries(){return(new Set).entries()}keys(){return(new Set).keys()}values(){return(new Set).values()}get[Symbol.toStringTag](){return"ValueSet"}}class L extends s.Comparator{constructor(e){super(),this.m_bufferLeft=new n.SegmentBuffer,this.m_bufferRight=new n.SegmentBuffer,this.m_intervalLeft=r.Envelope1D.constructEmpty(),this.m_intervalRight=r.Envelope1D.constructEmpty(),this.m_yScanline=Number.NaN,this.m_helper=e}compare(e,t,i){const n=t,s=e.getElement(i);this.m_helper.querySegmentXY(n,this.m_bufferLeft),this.m_helper.querySegmentXY(s,this.m_bufferRight);const r=this.m_bufferLeft.get(),o=this.m_bufferRight.get();if(this.m_intervalLeft.setCoords(r.getStartX(),r.getEndX()),this.m_intervalRight.setCoords(o.getStartX(),o.getEndX()),this.m_intervalLeft.vmax<this.m_intervalRight.vmin)return-1;if(this.m_intervalLeft.vmin>this.m_intervalRight.vmax)return 1;const a=r.getStartY()===r.getEndY(),l=o.getStartY()===o.getEndY();if(a||l){if(a&&l)return 0;if(r.getStartY()===o.getStartY()&&r.getStartX()===o.getStartX())return a?1:-1;if(r.getEndY()===o.getEndY()&&r.getEndX()===o.getEndX())return a?-1:1}let c=r.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalLeft.vmin),h=o.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalRight.vmin);if(c===h){const e=r.getEndY(),t=o.getEndY(),i=Math.min(e,t);let n=.5*(i+this.m_yScanline);n===this.m_yScanline&&(n=i),c=r.intersectionOfYMonotonicWithAxisX(n,this.m_intervalLeft.vmin),h=o.intersectionOfYMonotonicWithAxisX(n,this.m_intervalRight.vmin)}return c<h?-1:c>h?1:0}setY(e){this.m_yScanline=e}}class q{constructor(e){this.m_segmentBuffer=new n.SegmentBuffer,this.m_point=r.Point2D.getNAN(),this.m_parent=e}setPointXY(e){this.m_point.assign(e)}compare(e,t){const i=e.getElement(t);this.m_parent.querySegmentXY(i,this.m_segmentBuffer);const n=this.m_segmentBuffer.get(),s=new r.Envelope1D;if(s.setCoords(n.getStartX(),n.getEndX()),this.m_point.x<s.vmin)return-1;if(this.m_point.x>s.vmax)return 1;const o=n.intersectionOfYMonotonicWithAxisX(this.m_point.y,this.m_point.x);return this.m_point.x<o?-1:this.m_point.x>o?1:0}}var H,U;function z(e,t){return{parentage:e,rank:t}}function Y(e,t){const i=e.length;if(i!==t.length)return!1;const n=e[0].parentage;if(n!==t[0].parentage)return!1;if(-1===n)return!0;for(let n=1;n<i;++n)if(e[n].parentage!==t[n].parentage)return!1;return!0}function B(e,t,i){i.length=0;let s=!1;{let r=e.getHalfEdgeVertexIterator(t);for(;r!==n.nullHandle;){const t=e.getVertexFromVertexIterator(r),n=e.getShape().getSegmentRank(t),o=e.getShape().getSegmentParentage(t);s||=o>=0,i.push(z(o,n)),r=e.incrementVertexIterator(r)}}{let r=e.getHalfEdgeVertexIterator(e.getHalfEdgeTwin(t));for(;r!==n.nullHandle;){const t=e.getVertexFromVertexIterator(r),n=e.getShape().getSegmentRank(t),o=e.getShape().getSegmentParentage(t);s||=o>=0,i.push(z(o,n)),r=e.incrementVertexIterator(r)}}s&&i.sort(((e,t)=>e.rank>t.rank?-1:e.rank<t.rank?1:e.parentage<t.parentage?-1:e.parentage>t.parentage?1:0)),-1===i[0].parentage&&(i.length=1)}!function(e){e[e.enumInputModeBuildGraph=0]="enumInputModeBuildGraph",e[e.enumInputModeSimplifyAlternate=1]="enumInputModeSimplifyAlternate",e[e.enumInputModeSimplifyWinding=2]="enumInputModeSimplifyWinding"}(H||(H={})),function(e){e[e.enumSegmentParentageBreakNode=1]="enumSegmentParentageBreakNode",e[e.enumPathBreakNode=2]="enumPathBreakNode"}(U||(U={}));class X{constructor(){this.m_shape=null,this.m_clusterData=new s.StridedIndexTypeCollection(8),this.m_clusterVertices=new s.StridedIndexTypeCollection(2),this.m_firstCluster=n.nullHandle,this.m_lastCluster=n.nullHandle,this.m_halfEdgeData=new s.StridedIndexTypeCollection(8),this.m_chainData=new s.StridedIndexTypeCollection(8),this.m_chainAreas=null,this.m_chainPerimeters=null,this.m_universeChain=-1,this.m_simplifiedGeometry=-1,this.m_edgeIndices=[],this.m_clusterIndices=[],this.m_chainIndices=[],this.m_bBuildGeometryParentageSets=!1,this.m_chainBitSetIndex=-1,this.m_edgeBitSetIndex=-1,this.m_edgeBitSetIndexLeft=-1,this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_uniqueBitSets=null,this.m_chainBitSets=[],this.m_edgeBitSets=[],this.m_checkDirtyPlanesweepTolerance=Number.NaN,this.m_geometryIDIndex=-1,this.m_clusterIndex=-1,this.m_halfEdgeIndex=-1,this.m_tmpHalfEdgeParentageIndex=-1,this.m_tmpHalfEdgeParentageIndexLeft=-1,this.m_tmpHalfEdgeWindingNumberIndex=-1,this.m_tmpHalfEdgeOddEvenNumberIndex=-1,this.m_segmentParentageIndex=-1,this.m_segmentIndexHe=-1,this.m_clusterBreakNodeIndex=-1,this.m_universeGeomID=-1,this.m_pointCount=0,this.m_progressCounter=0,this.m_bBuildChains=!0,this.m_bDirtyCheckFailed=!1}setCheckDirtyPlanesweepTolerance(e){this.m_checkDirtyPlanesweepTolerance=e}dirtyCheckFailed(){return this.m_bDirtyCheckFailed}getShape(){return this.m_shape}setEditShape(e,t,i=!0,n=!1){n?this.setEditShapeImpl3D_(e,H.enumInputModeBuildGraph,null,t,!1):this.setEditShapeImpl_(e,H.enumInputModeBuildGraph,null,t,i)}setAndSimplifyEditShapeAlternate(e,t,n=null,s=!1){const r=[];r.push(t),this.m_simplifiedGeometry=t,s?this.setEditShapeImpl3D_(e,H.enumInputModeSimplifyAlternate,r,n,!1):this.setEditShapeImpl_(e,H.enumInputModeSimplifyAlternate,r,n,e.getGeometryType(t)===i.GeometryType.enumPolygon)}setAndSimplifyEditShapeWinding(e,t,i=null){const n=[];n.push(t),this.m_simplifiedGeometry=t,this.setEditShapeImpl_(e,H.enumInputModeSimplifyWinding,n,i,!0)}removeShape(){null!==this.m_shape&&(-1!==this.m_geometryIDIndex&&(this.m_shape.removeGeometryUserIndex(this.m_geometryIDIndex),this.m_geometryIDIndex=-1),-1!==this.m_clusterIndex&&(this.m_shape.removeUserIndex(this.m_clusterIndex),this.m_clusterIndex=-1),-1!==this.m_halfEdgeIndex&&(this.m_shape.removeUserIndex(this.m_halfEdgeIndex),this.m_halfEdgeIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),-1!==this.m_tmpHalfEdgeWindingNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),-1!==this.m_tmpHalfEdgeOddEvenNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1),-1!==this.m_segmentParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),-1!==this.m_segmentIndexHe&&(this.deleteUserIndexForHalfEdges(this.m_segmentIndexHe),this.m_segmentIndexHe=-1),-1!==this.m_clusterBreakNodeIndex&&(this.deleteUserIndexForClusters(this.m_clusterBreakNodeIndex),this.m_clusterBreakNodeIndex=-1),this.deleteEdgeBitSets_(),this.deleteChainBitSets_(),this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_shape=null,this.m_clusterData.deleteAll(!0),this.m_clusterVertices.deleteAll(!0),this.m_firstCluster=n.nullHandle,this.m_lastCluster=n.nullHandle,this.m_halfEdgeData.deleteAll(!0),this.m_edgeIndices.length=0,this.m_clusterIndices.length=0,this.m_chainIndices.length=0,this.m_chainData.deleteAll(!0),this.m_universeChain=n.nullHandle,this.m_chainAreas=null)}getClusterHalfEdge(e){return this.m_clusterData.getField(e,2)}queryXY(e,t){const i=this.getClusterVertexIndex_(e);t.assign(this.m_shape.getXYWithIndex(i))}queryXYZ(e,t){i.geometryReleaseAssert(0)}getClusterParentage(e){return this.m_clusterData.getField(e,1)}getFirstCluster(){return this.m_firstCluster}getPrevCluster(e){return this.m_clusterData.getField(e,3)}getNextCluster(e){return this.m_clusterData.getField(e,4)}getClusterChain(e){return this.m_clusterData.getField(e,6)}getClusterVertexIterator(e){return this.m_clusterData.getField(e,7)}incrementVertexIterator(e){return this.m_clusterVertices.getField(e,1)}getVertexFromVertexIterator(e){return this.m_clusterVertices.getField(e,0)}getClusterUserIndex(e,t){const i=this.getClusterIndex_(e),n=this.m_clusterIndices[t];return n.size()<=i?-1:n.read(i)}setClusterUserIndex(e,t,i){const n=this.getClusterIndex_(e),s=this.m_clusterIndices[t];s.size()<=n&&s.resize(this.m_clusterData.size(),-1),s.write(n,i)}hasClusterUserIndexFlags(e,t,i){if(-1===t)return!1;const n=this.getClusterUserIndex(e,t);return-1!==n&&0!==(i&n)}setClusterUserIndexFlags(e,t,i){const n=this.getClusterIndex_(e),s=this.m_clusterIndices[t];s.size()<=n&&s.resize(this.m_clusterData.size(),-1);let r=s.read(n);-1===r&&(r=0),s.write(n,i|r)}clearClusterUserIndexFlags(e,t,i){const n=this.getClusterIndex_(e),s=this.m_clusterIndices[t];s.size()<=n&&s.resize(this.m_clusterData.size(),-1);let r=s.read(n);-1===r&&(r=0),s.write(n,~i&r)}createUserIndexForClusters(e=-1){const t=new s.AttributeStreamOfInt32(this.m_clusterData.capacity(),e);for(let e=0,i=this.m_clusterIndices.length;e<i;e++)if(null===this.m_clusterIndices[e])return this.m_clusterIndices[e]=t,e;return this.m_clusterIndices.push(t),this.m_clusterIndices.length-1}deleteUserIndexForClusters(e){this.m_clusterIndices[e]=null}getHalfEdgeOrigin(e){return this.m_halfEdgeData.getField(e,1)}getHalfEdgeTo(e){return this.getHalfEdgeOrigin(this.getHalfEdgeTwin(e))}getHalfEdgeTwin(e){return this.m_halfEdgeData.getField(e,4)}getHalfEdgePrev(e){return this.m_halfEdgeData.getField(e,5)}getHalfEdgeNext(e){return this.m_halfEdgeData.getField(e,6)}getHalfEdgeChain(e){return this.m_halfEdgeData.getField(e,2)}getHalfEdgeFaceParentage(e){return this.getChainParentage(this.getHalfEdgeChain(e))}getHalfEdgeVertexIterator(e){return this.m_halfEdgeData.getField(e,7)}getHalfEdgeFromXY(e,t){this.queryXY(this.getHalfEdgeOrigin(e),t)}getHalfEdgeToXY(e,t){this.queryXY(this.getHalfEdgeTo(e),t)}isHalfEdgeCurve(e){return-1!==this.m_segmentIndexHe&&-1!==this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe)}getHalfEdgeFromXYZ(e,t){i.geometryReleaseAssert(0)}getHalfEdgeToXYZ(e,t){i.geometryReleaseAssert(0)}getHalfEdgeParentage(e){return this.m_halfEdgeData.getField(e,3)&X.c_EdgeParentageMask}getHalfEdgeUserIndex(e,t){const i=this.getHalfEdgeIndex_(e),n=this.m_edgeIndices[t];return n.size()<=i?-1:n.read(i)}setHalfEdgeUserIndex(e,t,i){const n=this.getHalfEdgeIndex_(e),s=this.m_edgeIndices[t];s.size()<=n&&s.resize(this.m_halfEdgeData.size(),-1),s.write(n,i)}createUserIndexForHalfEdges(e){void 0===e&&(e=-1);const t=new s.AttributeStreamOfInt32(this.m_halfEdgeData.capacity(),e);for(let e=0,i=this.m_edgeIndices.length;e<i;e++)if(null===this.m_edgeIndices[e])return this.m_edgeIndices[e]=t,e;this.m_edgeIndices.push(t);const n=this.m_edgeIndices.length-1;return i.geometryReleaseAssert(n>=0&&n<=Number.MAX_SAFE_INTEGER),n}deleteUserIndexForHalfEdges(e){this.m_edgeIndices[e]=null}deleteEdgesBreakFaces_(e){for(let t=0,i=e.length;t<i;t++){const i=e[t],s=this.getHalfEdgeChain(i),r=this.getHalfEdgeTwin(i),o=this.getHalfEdgeChain(r);this.setChainHalfEdge_(s,n.nullHandle),this.setChainHalfEdge_(o,n.nullHandle),this.updateVertexToHalfEdgeConnection_(i,!0),this.deleteEdgeImpl_(i)}}doesHalfEdgeBelongToAPolygonInterior(e,t){return i.geometryReleaseAssert(0),!1}doesHalfEdgeBelongToAPolygonExterior(e,t){return i.geometryReleaseAssert(0),!1}doesHalfEdgeBelongToAPolygonBoundary(e,t){return i.geometryReleaseAssert(0),!1}doesHalfEdgeBelongToAPolylineInterior(e,t){return i.geometryReleaseAssert(0),!1}doesHalfEdgeBelongToAPolylineExterior(e,t){return i.geometryReleaseAssert(0),!1}doesClusterBelongToAPolygonInterior(e,t){return i.geometryReleaseAssert(0),!1}doesClusterBelongToAPolygonExterior(e,t){return i.geometryReleaseAssert(0),!1}doesClusterBelongToAPolygonBoundary(e,t){return i.geometryReleaseAssert(0),!1}getFirstChain(){return this.m_universeChain}getChainHalfEdge(e){return this.m_chainData.getField(e,1)}getChainParentage(e){return this.m_chainData.getField(e,2)}getChainParent(e){return this.m_chainData.getField(e,3)}getChainFirstIsland(e){return this.m_chainData.getField(e,4)}getChainNextInParent(e){return this.m_chainData.getField(e,5)}getChainNext(e){return this.m_chainData.getField(e,7)}getChainArea(e){const t=this.getChainIndex_(e);let i=this.m_chainAreas.read(t);return Number.isNaN(i)&&(this.updateChainAreaAndPerimeter_(e),i=this.m_chainAreas.read(t)),i}getChainPerimeter(e){return i.geometryReleaseAssert(0),0}getChainUserIndex(e,t){const i=this.getChainIndex_(e),n=this.m_chainIndices[t];return n.size()<=i?-1:n.read(i)}setChainUserIndex(e,t,i){const n=this.getChainIndex_(e),s=this.m_chainIndices[t];s.size()<=n&&s.resize(this.m_chainData.size(),-1),s.write(n,i)}createUserIndexForChains(){const e=new s.AttributeStreamOfInt32(this.m_chainData.capacity(),-1);for(let t=0,i=this.m_chainIndices.length;t<i;t++)if(null===this.m_chainIndices[t])return this.m_chainIndices[t]=e,t;return this.m_chainIndices.push(e),this.m_chainIndices.length-1}deleteUserIndexForChains(e){this.m_chainIndices[e]=null}extractPolygonFromChainAndIslands(e,t,s,r){const o=t===n.nullHandle?e.createGeometry(i.GeometryType.enumPolygon):t,a=new n.SegmentBuffer;this.extractPolygonPathFromChain_(e,o,s,r,a);for(let t=this.getChainFirstIsland(s);t!==n.nullHandle;t=this.getChainNextInParent(t))this.extractPolygonPathFromChain_(e,o,t,r,a);return o}getGeometryID(e){const t=this.m_shape.getGeometryUserIndex(e,this.m_geometryIDIndex);return i.geometryReleaseAssert(t>=0),1<<Math.min(t,31)}getClusterFromVertex(e){return this.m_shape.getUserIndex(e,this.m_clusterIndex)}getHalfEdgeFromVertex(e){return this.m_shape.getUserIndex(e,this.m_halfEdgeIndex)}buildGeometryParentageSets(){this.m_bBuildGeometryParentageSets=!0}getChainBitSet(e){if(i.geometryReleaseAssert(this.m_bBuildGeometryParentageSets),-1===this.m_chainBitSetIndex)return this.getEmptySet();const t=this.getChainUserIndex(e,this.m_chainBitSetIndex);i.geometryReleaseAssert(t>=0);let n=this.m_chainBitSets.at(t);return n||(n=this.getEmptySet()),n}getChainBoundaryBitSet(e){i.geometryReleaseAssert(this.m_bBuildGeometryParentageSets);const t=new V,s=e=>{const i=this.getChainHalfEdge(e);let n=i;do{const e=this.getEdgeBitSet_(n);null!==e&&t.assignOr(e);const i=this.getEdgeBitSet_(this.getHalfEdgeTwin(n));null!==i&&t.assignOr(i),n=this.getHalfEdgeNext(n)}while(n!==i)};s(e);for(let t=this.getChainFirstIsland(e);t!==n.nullHandle;t=this.getChainNextInParent(t))s(e);return t}getChainPolygons(e){return i.geometryReleaseAssert(0),[]}getGeometriesFromBits(e){if(!this.m_bBuildGeometryParentageSets||null===e)return[];if(null===this.m_geometryMapID){this.m_geometryMapID=new Map;for(let e=this.m_shape.getFirstGeometry();e!==n.nullHandle;e=this.m_shape.getNextGeometry(e))this.m_geometryMapID.set(this.m_shape.getGeometryUserIndex(e,this.m_geometryIDIndex),e)}const t=[],s=e.getUnorderedBitIterator();for(let e=s.next();e!==O.npos();e=s.next())i.geometryReleaseAssert(this.m_geometryMapID.has(e)),t.push(this.m_geometryMapID.get(e));return t}getVertexDominant(e,t){if(t===n.nullHandle)return e;const i=this.getClusterFromVertex(e);return this.getVertexDominantFromCluster(i,t)}getVertexDominantFromCluster(e,t){if(t!==n.nullHandle){let i=n.nullHandle;for(let s=this.getClusterVertexIterator(e);s!==n.nullHandle;s=this.incrementVertexIterator(s)){const e=this.getVertexFromVertexIterator(s);i===n.nullHandle&&(i=e);const r=this.m_shape.getPathFromVertex(e);if(this.m_shape.getGeometryFromPath(r)===t){i=e;break}}return i}{const t=this.getClusterVertexIterator(e);return t!==n.nullHandle?this.getVertexFromVertexIterator(t):n.nullHandle}}isBreakNode(e){return this.hasClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,U.enumSegmentParentageBreakNode)}setBreakNode(e,t){i.geometryReleaseAssert(-1!==this.m_clusterBreakNodeIndex),t?this.setClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,U.enumSegmentParentageBreakNode):this.clearClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,U.enumSegmentParentageBreakNode)}isStrongPathNode(e){return this.hasClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,U.enumPathBreakNode)}setStrongPathNode(e,t){if(-1===this.m_clusterBreakNodeIndex){if(!t)return;this.m_clusterBreakNodeIndex=this.createUserIndexForClusters()}t?this.setClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,U.enumPathBreakNode):this.clearClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,U.enumPathBreakNode)}getSegmentParentage(e){if(-1===this.m_segmentParentageIndex)return-1;const t=this.getHalfEdgeUserIndex(e,this.m_segmentParentageIndex);return t>=0?t:-1}isCrossroadAhead(e){const t=this.getHalfEdgeNext(e);if(this.isStrongPathNode(this.getHalfEdgeOrigin(t)))return!0;const i=this.getHalfEdgeTwin(t),n=this.getHalfEdgeNext(i);return e!==this.getHalfEdgeTwin(n)}isCrossroadBehind(e){return i.geometryReleaseAssert(0),!1}getHalfEdgeConnector(e,t){const i=this.getClusterHalfEdge(e);if(i===n.nullHandle)return n.nullHandle;let s=i,r=n.nullHandle,o=n.nullHandle;do{if(this.getHalfEdgeTo(s)===t)return s;if(r===n.nullHandle){if(r=this.getClusterHalfEdge(t),r===n.nullHandle)return n.nullHandle;o=r}if(this.getHalfEdgeTo(o)===e)return s=this.getHalfEdgeTwin(o),s;s=this.getHalfEdgeNext(this.getHalfEdgeTwin(s)),o=this.getHalfEdgeNext(this.getHalfEdgeTwin(o))}while(s!==i&&o!==r);return n.nullHandle}querySegmentXY(e,t){if(-1!==this.m_segmentIndexHe){let i=this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe);if(-1!==i){if(-2!==i){const e=this.m_shape.getSegmentFromIndex(i);t.copyFrom(e,!0)}else{i=this.getHalfEdgeUserIndex(this.getHalfEdgeTwin(e),this.m_segmentIndexHe);const n=this.m_shape.getSegmentFromIndex(i);t.copyFrom(n,!0),t.get().reverse()}return}}t.createLine();const i=t.get(),n=r.Point2D.getNAN();this.getHalfEdgeFromXY(e,n),i.setStartXY(n),this.getHalfEdgeToXY(e,n),i.setEndXY(n)}isCurveEdge(e){return-1!==this.m_segmentIndexHe&&-1!==this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe)}compareEdgeAnglesCurveHelper_(e,t,s){const o=new n.SegmentBuffer,a=new n.SegmentBuffer;this.querySegmentXY(e,o),this.querySegmentXY(t,a);const l=o.get(),c=a.get();if(l.equals(c))return 0;const h=new r.Point2D;this.getHalfEdgeFromXY(e,h);const u=new r.Point2D;this.getHalfEdgeToXY(e,u);const m=new r.Point2D;return this.getHalfEdgeToXY(t,m),i.geometryReleaseAssert(!u.isEqualPoint2D(m)),n.compareConnectedSegments(l,c)}compareEdgeAnglesHelper_(e,t,i){if(e===t)return 0;if(this.isHalfEdgeCurve(e)||this.isHalfEdgeCurve(t))return this.compareEdgeAnglesCurveHelper_(e,t,i);const n=r.Point2D.getNAN();this.getHalfEdgeToXY(e,n);const s=r.Point2D.getNAN();if(this.getHalfEdgeToXY(t,s),n.isEqualPoint2D(s))return 0;const o=r.Point2D.getNAN();this.getHalfEdgeFromXY(e,o);const a=r.Point2D.getNAN();a.setSub(n,o);const l=r.Point2D.getNAN();return l.setSub(s,o),!i||l.y>=0&&a.y>0?r.Point2D.compareVectors(a,l):0}compareEdgeAngles_(e,t){return this.compareEdgeAnglesHelper_(e,t,!1)}compareEdgeAnglesForPair_(e,t){return this.compareEdgeAnglesHelper_(e,t,!0)}compareEdgeAngles3D_(e,t){return i.geometryReleaseAssert(0),0}compareEdgeAnglesForPair3D_(e,t){return i.geometryReleaseAssert(0),0}dbgDumpChains_(){}dbgDumpChainToPolygon_(e,t){}deleteEdgeInternal_(e){const t=this.getHalfEdgeChain(e),s=this.getHalfEdgeTwin(e),r=this.getHalfEdgeChain(s);i.geometryReleaseAssert(r===t),i.geometryReleaseAssert(e===this.getHalfEdgeNext(s)||s===this.getHalfEdgeNext(e));let o=this.getHalfEdgeNext(e);o===s&&(o=this.getHalfEdgeNext(o),o===e&&(o=n.nullHandle));const a=this.getChainIndex_(t),l=this.m_chainAreas.read(a);Number.isNaN(l)||(this.setChainArea_(t,Number.NaN),this.setChainPerimeter_(t,Number.NaN));const c=this.getChainHalfEdge(t);c!==e&&c!==s||this.setChainHalfEdge_(t,o),this.updateVertexToHalfEdgeConnection_(e,!0),this.deleteEdgeImpl_(e)}getFirstUnvisitedHalfEdgeOnCluster_(e,t,i){let s=t!==n.nullHandle?t:this.getClusterHalfEdge(e);if(s===n.nullHandle)return n.nullHandle;const r=s;for(;;){if(1!==this.getHalfEdgeUserIndex(s,i))return s;const e=this.getHalfEdgeNext(this.getHalfEdgeTwin(s));if(e===r)return n.nullHandle;s=e}}removeSpikes_(){let e=!1;const t=this.createUserIndexForHalfEdges();for(let i=this.getFirstCluster();i!==n.nullHandle;i=this.getNextCluster(i)){let s=n.nullHandle;for(;;){let r=this.getFirstUnvisitedHalfEdgeOnCluster_(i,s,t);if(r===n.nullHandle)break;s=this.getHalfEdgeNext(this.getHalfEdgeTwin(r));let o=r;for(;;){const i=this.getHalfEdgeNext(o),a=this.getHalfEdgePrev(o),l=this.getHalfEdgeTwin(o);if(a===l){if(this.deleteEdgeInternal_(o),e=!0,s!==o&&s!==l||(s=n.nullHandle),o===r||a===r){if(r=i,o===r||a===r)break;o=i;continue}}else this.setHalfEdgeUserIndex(o,t,1);if(o=i,o===r)break}}}return this.deleteUserIndexForHalfEdges(t),e}progress_(e,t=!1){}newCluster_(){const e=this.m_clusterData.newElement();return this.m_clusterData.setField(e,1,0),e}newHalfEdgePair_(){const e=this.m_halfEdgeData.newElement();this.m_halfEdgeData.setField(e,2,0),this.m_halfEdgeData.setField(e,3,0);const t=this.m_halfEdgeData.newElement();return this.m_halfEdgeData.setField(t,2,0),this.m_halfEdgeData.setField(t,3,0),this.setHalfEdgeTwin_(e,t),this.setHalfEdgeTwin_(t,e),e}newChain_(){const e=this.m_chainData.newElement();return this.m_chainData.setField(e,2,0),e}deleteChain_(e){return i.geometryReleaseAssert(0),0}getClusterIndex_(e){return this.m_clusterData.elementToIndex(e)}setClusterVertexIterator_(e,t){this.m_clusterData.setField(e,7,t)}setClusterHalfEdge_(e,t){this.m_clusterData.setField(e,2,t)}setClusterParentage_(e,t){this.m_clusterData.setField(e,1,t)}setPrevCluster_(e,t){this.m_clusterData.setField(e,3,t)}setNextCluster_(e,t){this.m_clusterData.setField(e,4,t)}setClusterVertexIndex_(e,t){this.m_clusterData.setField(e,5,t)}getClusterVertexIndex_(e){return this.m_clusterData.getField(e,5)}setClusterChain_(e,t){this.m_clusterData.setField(e,6,t)}addClusterToExteriorChain_(e,t){this.setClusterChain_(t,e)}getHalfEdgeIndex_(e){return this.m_halfEdgeData.elementToIndex(e)}setHalfEdgeOrigin_(e,t){this.m_halfEdgeData.setField(e,1,t)}setHalfEdgeTwin_(e,t){this.m_halfEdgeData.setField(e,4,t)}setHalfEdgePrev_(e,t){this.m_halfEdgeData.setField(e,5,t)}setHalfEdgeNext_(e,t){this.m_halfEdgeData.setField(e,6,t)}setHalfEdgeChain_(e,t){this.m_halfEdgeData.setField(e,2,t)}setHalfEdgeParentage_(e,t){this.m_halfEdgeData.setField(e,3,t)}getHalfEdgeParentageMask_(e){return this.m_halfEdgeData.getField(e,3)}setHalfEdgeVertexIterator_(e,t){this.m_halfEdgeData.setField(e,7,t)}updateVertexToHalfEdgeConnectionHelper_(e,t){const i=t?n.nullHandle:e;for(let t=this.getHalfEdgeVertexIterator(e);t!==n.nullHandle;t=this.incrementVertexIterator(t)){const e=this.getVertexFromVertexIterator(t);this.m_shape.setUserIndex(e,this.m_halfEdgeIndex,i)}}updateVertexToHalfEdgeConnection_(e,t){e!==n.nullHandle&&(this.updateVertexToHalfEdgeConnectionHelper_(e,t),this.updateVertexToHalfEdgeConnectionHelper_(this.getHalfEdgeTwin(e),t))}getChainIndex_(e){return this.m_chainData.elementToIndex(e)}setChainHalfEdge_(e,t){this.m_chainData.setField(e,1,t)}setChainParentage_(e,t){this.m_chainData.setField(e,2,t)}setChainParent_(e,t){this.m_chainData.setField(e,3,t);const i=this.getChainFirstIsland(t);this.setChainNextInParent_(e,i),this.setChainFirstIsland_(t,e)}setChainFirstIsland_(e,t){this.m_chainData.setField(e,4,t)}setChainNextInParent_(e,t){this.m_chainData.setField(e,5,t)}setChainPrev_(e,t){this.m_chainData.setField(e,6,t)}setChainNext_(e,t){this.m_chainData.setField(e,7,t)}setChainArea_(e,t){const i=this.getChainIndex_(e);this.m_chainAreas.write(i,t)}setChainPerimeter_(e,t){const i=this.getChainIndex_(e);this.m_chainPerimeters.write(i,t)}updateChainAreaAndPerimeter_(e){const t=this.m_shape.hasCurves(),i=new r.KahanSummator(0),s=new r.KahanSummator(0),o=this.getChainHalfEdge(e),a=r.Point2D.getNAN(),l=r.Point2D.getNAN(),c=r.Point2D.getNAN();this.getHalfEdgeFromXY(o,a),l.setCoordsPoint2D(a);let h=o;do{this.getHalfEdgeToXY(h,c),t&&this.isCurveEdge(h)||s.pe(r.Point2D.distance(l,c)),this.getHalfEdgeChain(this.getHalfEdgeTwin(h))!==e&&i.pe((c.x-a.x-(l.x-a.x))*(c.y-a.y+(l.y-a.y))*.5),l.setCoordsPoint2D(c),h=this.getHalfEdgeNext(h)}while(h!==o);if(t){const t=new n.SegmentBuffer;h=o;do{this.getHalfEdgeToXY(h,c);const n=this.isCurveEdge(h);if(n&&(this.querySegmentXY(h,t),s.pe(t.get().calculateLength2D())),this.getHalfEdgeChain(this.getHalfEdgeTwin(h))!==e&&n){const e=t.get().calculateArea2DHelper();i.pe(e)}h=this.getHalfEdgeNext(h)}while(h!==o)}const u=this.getChainIndex_(e);this.m_chainAreas.write(u,i.getResult()),this.m_chainPerimeters.write(u,s.getResult())}getChainTopmostEdge_(e){return i.geometryReleaseAssert(0),0}planeSweepParentage_(e,t){const i=new L(this),o=new s.Treap;o.setCapacity(Math.trunc(this.m_pointCount/2)),o.setComparator(i);const a=[],l=this.createUserIndexForHalfEdges();let c=null;const h=r.Point2D.getNAN();for(let r=this.getFirstCluster();r!==n.nullHandle;r=this.getNextCluster(r)){this.progress_(t);const u=this.getClusterHalfEdge(r);if(u!==n.nullHandle){if(a.length=0,!this.tryOptimizedInsertion_(o,l,a,r,u)){this.queryXY(r,h),i.setY(h.y);let e=u;do{const t=this.getHalfEdgeUserIndex(e,l);-1!==t&&(o.deleteNode(t),this.setHalfEdgeUserIndex(e,l,s.StridedIndexTypeCollection.impossibleIndex2())),e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(u!==e);e=u;do{if(-1===this.getHalfEdgeUserIndex(e,l)){const t=o.addElement(e);a.push(t)}e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(u!==e)}for(let t=a.length-1;t>=0;t--){const i=a[t],n=o.getElement(i),s=this.getHalfEdgeTwin(n);this.setHalfEdgeUserIndex(s,l,i),this.planeSweepParentagePropagateParentage_(o,i,e)}}else if(this.getClusterChain(r)===n.nullHandle){null===c&&(c=new q(this)),this.queryXY(r,h),c.setPointXY(h);const e=o.searchLowerBound(c);let t=this.m_universeChain;if(-1!==e){let i=o.getElement(e);this.getHalfEdgeChain(i)===this.getHalfEdgeChain(this.getHalfEdgeTwin(i))&&(i=this.getLeftSkipPolylines_(o,e)),i!==n.nullHandle&&(t=this.getHalfEdgeChain(i))}this.addClusterToExteriorChain_(t,r)}}this.deleteUserIndexForHalfEdges(l)}planeSweepParentagePropagateParentage_(e,t,s){const r=e.getElement(t),o=this.getHalfEdgeChain(r);if(this.getChainParent(o)!==n.nullHandle)return;const a=this.getLeftSkipPolylines_(e,t),l=this.getHalfEdgeTwin(r),c=this.getHalfEdgeChain(l);let h=this.getChainParent(o),u=this.getChainParent(c);if(a===n.nullHandle)h===n.nullHandle&&(c===o?(this.setChainParent_(c,this.m_universeChain),u=this.m_universeChain,h=u):(u===n.nullHandle&&(this.setChainParent_(c,this.m_universeChain),u=this.m_universeChain),this.setChainParent_(o,c),h=c));else{const e=this.getHalfEdgeChain(a);if(u===n.nullHandle){if(this.getChainArea(e)<=0){const t=this.getChainParent(e);this.setChainParent_(c,t),u=t}else this.setChainParent_(c,e),u=e;c===o&&(h=u)}}h===n.nullHandle&&(this.trySetChainParentFromTwin_(o,c),h=this.getChainParent(o)),i.geometryReleaseAssert(h!==n.nullHandle),s===H.enumInputModeBuildGraph?this.propagateParentageBuildGraph_(e,t,r,a):s===H.enumInputModeSimplifyWinding?this.propagateParentageWinding_(e,t,r,a,l,o,c):s===H.enumInputModeSimplifyAlternate&&this.propagateParentageAlternate_(e,t,r,a,l,o,c)}propagateParentageBuildGraph_(e,t,i,s){let r,o=t;s===n.nullHandle?(o=e.getNext(o),r=this.getHalfEdgeChain(i)):r=this.getHalfEdgeChain(s);let a=null,l=this.getChainParentage(r);for(this.m_bBuildGeometryParentageSets&&(a=this.getChainBitSet(r));-1!==o;o=e.getNext(o)){const t=e.getElement(o),i=this.getHalfEdgeTwin(t);r=this.getHalfEdgeChain(t);const n=this.getHalfEdgeChain(i);if(this.m_bBuildGeometryParentageSets){let e=this.getChainBitSet(n);e=new V({copy:e}),e.assignOr(a),this.setChainBitSet_(n,e);let i=this.getChainBitSet(r);const s=this.getLeftEdgeBitSet_(t),o=new V({copy:a});if(o.assignSubtract(s),o.isZero())break;i=new V({copy:i}),i.assignOr(o),this.setChainBitSet_(r,i),a=i}const s=this.getChainParentage(n),c=s|l;c!==s&&this.setChainParentage_(n,c);let h=this.getChainParentage(r);const u=l&~this.getHalfEdgeUserIndex(t,this.m_tmpHalfEdgeParentageIndexLeft);if(u&&(h|=u,this.setChainParentage_(r,h)),0===u)break;l=h}}propagateParentageWinding_(e,t,s,r,o,a,l){if(a===l)return;let c=this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeWindingNumberIndex);c+=this.getHalfEdgeUserIndex(o,this.m_tmpHalfEdgeWindingNumberIndex);let h=0;const u=[],m=[];m.push(0);for(let s=e.getFirst();s!==t;s=e.getNext(s)){const t=e.getElement(s),r=this.getHalfEdgeTwin(t),o=this.getHalfEdgeChain(t),a=this.getHalfEdgeChain(r);if(o!==a){let e=this.getHalfEdgeUserIndex(t,this.m_tmpHalfEdgeWindingNumberIndex);e+=this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeWindingNumberIndex),h+=e;let s=!1;0!==u.length&&u.at(-1)===a&&(m.pop(),u.pop(),s=!0),i.geometryReleaseAssert(this.getChainParent(a)!==n.nullHandle),s&&this.getChainParent(a)===o||(m.push(h),u.push(o))}}if(h+=c,0!==u.length&&u.at(-1)===l&&(m.pop(),u.pop()),0!==h){if(0===m.at(-1)){const e=this.m_simplifiedGeometry,t=this.getGeometryID(e);this.setChainParentage_(a,t)}}else if(0!==m.at(-1)){const e=this.m_simplifiedGeometry,t=this.getGeometryID(e);this.setChainParentage_(a,t)}}propagateParentageAlternate_(e,t,i,s,r,o,a){const l=this.m_simplifiedGeometry,c=this.getGeometryID(l);if(s===n.nullHandle)this.setChainParentage_(a,this.m_universeGeomID),1&this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,c):this.setChainParentage_(o,this.m_universeGeomID);else{const e=this.getChainParentage(a);if(0===e){const e=this.getHalfEdgeChain(s),t=this.getChainParentage(e);this.setChainParentage_(a,t),1&this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,t===c?this.m_universeGeomID:c):this.setChainParentage_(o,t)}else 1&this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,e===c?this.m_universeGeomID:c):this.setChainParentage_(o,e)}}tryOptimizedInsertion_(e,t,i,r,o){let a=o,l=-1,c=n.nullHandle,h=0;do{if(2===h)return!1;const e=this.getHalfEdgeUserIndex(a,t);if(-1!==e){if(-1!==l)return!1;l=e}else{if(c!==n.nullHandle)return!1;c=a}h++,a=this.getHalfEdgeNext(this.getHalfEdgeTwin(a))}while(o!==a);return c!==n.nullHandle&&-1!==l&&(this.setHalfEdgeUserIndex(e.getElement(l),t,s.StridedIndexTypeCollection.impossibleIndex2()),e.setElement(l,c),i.push(l),!0)}trySetChainParentFromTwin_(e,t){const i=this.getChainArea(e);if(0===i)return!1;const s=this.getChainArea(t);if(i>0&&s<0||i<0&&s>0)return this.setChainParent_(e,t),!0;{const i=this.getChainParent(t);if(i!==n.nullHandle)return this.setChainParent_(e,i),!0}return!1}createHalfEdges_(e,t){this.m_halfEdgeIndex=this.m_shape.createUserIndex();for(let s=0,r=t.size();s<r;s++){const r=t.read(s),o=this.m_shape.getUserIndex(r,this.m_clusterIndex),a=this.m_shape.getPathFromVertex(r),l=this.m_shape.getGeometryFromPath(a),c=this.m_shape.getGeometryType(l);if(i.isMultiPath(c)){const t=this.m_shape.getNextVertex(r);if(t===n.nullHandle)continue;const s=this.m_shape.getUserIndex(t,this.m_clusterIndex);if(o===s)continue;const a=this.newHalfEdgePair_(),h=this.getHalfEdgeTwin(a),u=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(u,0,r),this.m_clusterVertices.setField(u,1,-1),this.setHalfEdgeVertexIterator_(a,u),this.m_shape.setUserIndex(r,this.m_halfEdgeIndex,a),this.setHalfEdgeOrigin_(a,o);const m=this.getClusterHalfEdge(o);if(m===n.nullHandle)this.setClusterHalfEdge_(o,a),this.setHalfEdgePrev_(a,h),this.setHalfEdgeNext_(h,a);else{const e=this.getHalfEdgePrev(m);this.setHalfEdgePrev_(m,h),this.setHalfEdgeNext_(h,m),this.setHalfEdgeNext_(e,a),this.setHalfEdgePrev_(a,e)}this.setHalfEdgeOrigin_(h,s);const d=this.getClusterHalfEdge(s);if(d===n.nullHandle)this.setClusterHalfEdge_(s,h),this.setHalfEdgeNext_(a,h),this.setHalfEdgePrev_(h,a);else{const e=this.getHalfEdgePrev(d);this.setHalfEdgePrev_(d,a),this.setHalfEdgeNext_(a,d),this.setHalfEdgeNext_(e,h),this.setHalfEdgePrev_(h,e)}const p=this.getGeometryID(l);if(e===H.enumInputModeBuildGraph){const e=c===i.GeometryType.enumPolygon?p:0;if(this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndex,0),this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeParentageIndex,e),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndexLeft,e),this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeParentageIndexLeft,0),this.m_bBuildGeometryParentageSets){const e=new V,t=this.m_shape.getGeometryUserIndex(l,this.m_geometryIDIndex);e.setBit(t),this.setEdgeBitSet_(a,e),this.setEdgeBitSet_(h,null),this.setLeftEdgeBitSet_(h,e),this.setLeftEdgeBitSet_(a,null)}}else if(e===H.enumInputModeSimplifyWinding){const e=this.m_shape.getXY(r),i=this.m_shape.getXY(t);let n=0,s=0;e.compare(i)<0?n=1:s=-1,this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeWindingNumberIndex,n),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeWindingNumberIndex,s)}else e===H.enumInputModeSimplifyAlternate&&(this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeOddEvenNumberIndex,1),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeOddEvenNumberIndex,1));const g=c===i.GeometryType.enumPolygon?X.c_EdgeBitMask:0;this.setHalfEdgeParentage_(a,p|g),this.setHalfEdgeParentage_(h,p|g)}}if(this.m_shape.hasCurves()){this.m_segmentIndexHe=this.createUserIndexForHalfEdges();for(let e=0,i=t.size();e<i;e++){const i=t.read(e);if(this.m_shape.getSegment(i)){const e=this.m_shape.getUserIndex(i,this.m_halfEdgeIndex);e!==n.nullHandle&&(this.setHalfEdgeUserIndex(e,this.m_segmentIndexHe,this.m_shape.getVertexIndex(i)),this.setHalfEdgeUserIndex(this.getHalfEdgeTwin(e),this.m_segmentIndexHe,-2))}}}}mergeVertexListsOfEdges_(e,t){{const i=this.getHalfEdgeVertexIterator(t);if(i!==n.nullHandle){const s=this.getHalfEdgeVertexIterator(e);this.m_clusterVertices.setField(i,1,s),this.setHalfEdgeVertexIterator_(e,i),this.setHalfEdgeVertexIterator_(t,n.nullHandle)}}const i=this.getHalfEdgeTwin(e),s=this.getHalfEdgeTwin(t);{const e=this.getHalfEdgeVertexIterator(s);if(e!==n.nullHandle){const t=this.getHalfEdgeVertexIterator(i);this.m_clusterVertices.setField(e,1,t),this.setHalfEdgeVertexIterator_(i,e),this.setHalfEdgeVertexIterator_(s,n.nullHandle)}}if(-1!==this.m_segmentIndexHe){let n=this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe);if(-1!==n){if(-2===n){const i=this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(e,this.m_segmentIndexHe,i)}if(n=this.getHalfEdgeUserIndex(i,this.m_segmentIndexHe),-2===n){const e=this.getHalfEdgeUserIndex(s,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(i,this.m_segmentIndexHe,e)}}}}sortHalfEdgesByAngle_(e){const t=[];for(let i=this.getFirstCluster();i!==n.nullHandle;i=this.getNextCluster(i)){t.length=0;const s=this.getClusterHalfEdge(i);if(s!==n.nullHandle){let o=s;do{t.push(o),o=this.getHalfEdgeNext(this.getHalfEdgeTwin(o))}while(o!==s);if(t.length>1){let o=!0;t.length>2?(t.sort(((e,t)=>this.compareEdgeAngles_(e,t))),t.push(t[0])):this.compareEdgeAnglesForPair_(t[0],t[1])>0?t[1]=r.swap(t[0],t[0]=t[1]):o=!1;let a=t[0],l=a,c=this.getHalfEdgeTo(l),h=this.getHalfEdgeTwin(l),u=n.nullHandle;for(let i=1,s=t.length;i<s;i++){const s=t[i],r=this.getHalfEdgeTwin(s),o=this.getHalfEdgeOrigin(r);if(o!==c||s===l)this.updateVertexToHalfEdgeConnection_(u,!1),u=n.nullHandle,l=s,c=o,h=r;else{if(e===H.enumInputModeBuildGraph){const e=this.getHalfEdgeParentageMask_(l)|this.getHalfEdgeParentageMask_(s);if(this.setHalfEdgeParentage_(l,e),this.setHalfEdgeParentage_(h,e),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeParentageIndexLeft)),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeParentageIndexLeft)),this.m_bBuildGeometryParentageSets){let e,t,i;e=this.getEdgeBitSet_(l),t=this.getEdgeBitSet_(s),i=new V({copy:e}),i.assignOr(t),this.setEdgeBitSet_(l,i),e=this.getEdgeBitSet_(h),t=this.getEdgeBitSet_(r),i=new V({copy:e}),i.assignOr(t),this.setEdgeBitSet_(h,i),e=this.getLeftEdgeBitSet_(l),t=this.getLeftEdgeBitSet_(s),i=new V({copy:e}),i.assignOr(t),this.setLeftEdgeBitSet_(l,i),e=this.getLeftEdgeBitSet_(h),t=this.getLeftEdgeBitSet_(r),i=new V({copy:e}),i.assignOr(t),this.setLeftEdgeBitSet_(h,i)}}else if(-1!==this.m_tmpHalfEdgeWindingNumberIndex){const e=this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeWindingNumberIndex),t=this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeWindingNumberIndex);this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeWindingNumberIndex,e),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeWindingNumberIndex,t)}else if(-1!==this.m_tmpHalfEdgeOddEvenNumberIndex){const e=this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex),t=this.getHalfEdgeUserIndex(h,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeOddEvenNumberIndex);this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeOddEvenNumberIndex,e),this.setHalfEdgeUserIndex(h,this.m_tmpHalfEdgeOddEvenNumberIndex,t)}this.mergeVertexListsOfEdges_(l,s),this.deleteEdgeImpl_(s),u=l,t[i]=n.nullHandle,s===a&&(t[0]=n.nullHandle,a=n.nullHandle)}}if(this.updateVertexToHalfEdgeConnection_(u,!1),u=n.nullHandle,!o){a=n.nullHandle;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(i!==n.nullHandle){a=i;break}}s!==a&&this.setClusterHalfEdge_(i,a);continue}a=n.nullHandle;for(let e=0,i=t.length;e<i;e++){const i=t[e];if(i===n.nullHandle)continue;if(a===n.nullHandle){a=i,l=a,c=this.getHalfEdgeTo(l),h=this.getHalfEdgeTwin(l);continue}if(i===l)continue;const s=this.getHalfEdgeTwin(i),r=this.getHalfEdgeOrigin(s);this.setHalfEdgeNext_(h,i),this.setHalfEdgePrev_(i,h),l=i,c=r,h=s}this.setClusterHalfEdge_(i,a)}}}}sortHalfEdgesByAngle3D_(e){i.geometryReleaseAssert(0)}buildChains_(e){this.m_universeChain=this.newChain_(),this.setChainHalfEdge_(this.m_universeChain,n.nullHandle);let t=this.m_universeChain;const i=this.createUserIndexForHalfEdges();for(let e=this.getFirstCluster();e!==n.nullHandle;e=this.getNextCluster(e)){const s=this.getClusterHalfEdge(e);if(s!==n.nullHandle){let e=s;do{if(1!==this.getHalfEdgeUserIndex(e,i)){const n=this.newChain_();this.setChainHalfEdge_(n,e),this.setChainPrev_(n,t),this.setChainNext_(t,n);let s=null;this.m_bBuildGeometryParentageSets&&(s=new V),t=n;let r=0,o=e;do{-1!==this.m_tmpHalfEdgeParentageIndex&&(r|=this.getHalfEdgeUserIndex(o,this.m_tmpHalfEdgeParentageIndex)),this.m_bBuildGeometryParentageSets&&s.assignOr(this.getEdgeBitSet_(o)),this.setHalfEdgeChain_(o,n),this.setHalfEdgeUserIndex(o,i,1),o=this.getHalfEdgeNext(o)}while(o!==e);this.m_bBuildGeometryParentageSets&&this.setChainBitSet_(n,s),this.setChainParentage_(n,r)}e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(e!==s)}}this.m_chainAreas=new s.AttributeStreamOfDbl(this.m_chainData.size(),Number.NaN),this.m_chainPerimeters=new s.AttributeStreamOfDbl(this.m_chainData.size(),Number.NaN),this.setChainArea_(this.m_universeChain,Number.POSITIVE_INFINITY),this.setChainPerimeter_(this.m_universeChain,Number.POSITIVE_INFINITY),this.deleteUserIndexForHalfEdges(i)}simplify_(e){i.geometryReleaseAssert(0)}simplifyAlternate_(){i.geometryReleaseAssert(0)}simplifyWinding_(){i.geometryReleaseAssert(0)}setEditShapeImpl_(e,t,o,a,l){this.removeShape(),this.m_bBuildChains=l,this.m_shape=e,this.m_geometryIDIndex=this.m_shape.createGeometryUserIndex();let c=this.m_shape.getTotalPointCount();if(o){c=0;for(let e=0,t=o.length;e<t;e++)c+=this.m_shape.getPointCount(o[e])}const h=new s.AttributeStreamOfInt32(0);let u=0,m=0;{let e=null!=o?o[0]:this.m_shape.getFirstGeometry(),t=1;for(;e!==n.nullHandle;){this.m_shape.setGeometryUserIndex(e,this.m_geometryIDIndex,m++);for(let t=this.m_shape.getFirstPath(e);t!==n.nullHandle;t=this.m_shape.getNextPath(t)){let e=this.m_shape.getFirstVertex(t);for(let i=0,n=this.m_shape.getPathSize(t);i<n;i++)h.add(e),e=this.m_shape.getNextVertex(e)}i.isPoint(this.m_shape.getGeometryType(e))||(u+=this.m_shape.getPathCount(e)),null!=o?(e=t<o.length?o[t]:n.nullHandle,t++):e=this.m_shape.getNextGeometry(e)}}this.m_universeGeomID=1<<Math.min(m,31),this.m_pointCount=h.size(),this.m_shape.sortVerticesSimpleByY(h,0,this.m_pointCount),this.m_clusterVertices.setCapacity(this.m_pointCount),this.progress_(a,!0),this.m_clusterData.setCapacity(this.m_pointCount+10),this.m_halfEdgeData.setCapacity(2*this.m_pointCount+32),this.m_chainData.setCapacity(Math.max(32,u)),this.m_clusterIndex=this.m_shape.createUserIndex();const d=r.Point2D.getNAN();let p=0;const g=r.Point2D.getNAN();for(let e=0;e<=this.m_pointCount;e++){if(e<this.m_pointCount){const t=h.read(e);this.m_shape.queryXY(t,g)}else g.setNAN();if(!d.isEqualPoint2D(g)){if(p<e){const t=this.newCluster_();let i=n.nullHandle,s=-1;for(let n=p;n<e;n++){s=h.read(n),this.m_shape.setUserIndex(s,this.m_clusterIndex,t);const e=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(e,0,s),this.m_clusterVertices.setField(e,1,i),i=e;const r=this.m_shape.getPathFromVertex(s),o=this.m_shape.getGeometryFromPath(r),a=this.getGeometryID(o);this.setClusterParentage_(t,this.getClusterParentage(t)|a)}this.setClusterVertexIterator_(t,i),this.setClusterVertexIndex_(t,this.m_shape.getVertexIndex(s)),this.m_lastCluster!==n.nullHandle&&this.setNextCluster_(this.m_lastCluster,t),this.setPrevCluster_(t,this.m_lastCluster),this.m_lastCluster=t,this.m_firstCluster===n.nullHandle&&(this.m_firstCluster=t)}p=e,d.setCoordsPoint2D(g)}}if(this.m_shape.hasSegmentParentage()){-1===this.m_clusterBreakNodeIndex&&(this.m_clusterBreakNodeIndex=this.createUserIndexForClusters());for(let e=0;e<this.m_pointCount;e++){const t=h.read(e);if(this.m_shape.getSegmentParentageBreakVertex(t)){const e=this.getClusterFromVertex(t);this.setBreakNode(e,!0)}}}this.progress_(a,!0);{let e=null!=o?o[0]:this.m_shape.getFirstGeometry(),t=1;for(;e!==n.nullHandle;){for(let t=this.m_shape.getFirstPath(e);t!==n.nullHandle;t=this.m_shape.getNextPath(t)){if(this.m_shape.isStrongPathStart(t)){const e=this.m_shape.getFirstVertex(t),i=this.getClusterFromVertex(e);this.setStrongPathNode(i,!0)}if(this.m_shape.isStrongPathEnd(t)){const e=this.m_shape.isClosedPath(t)?this.m_shape.getFirstVertex(t):this.m_shape.getLastVertex(t),i=this.getClusterFromVertex(e);this.setStrongPathNode(i,!0)}}null!=o?(e=t<o.length?o[t]:n.nullHandle,t++):e=this.m_shape.getNextGeometry(e)}}if(t===H.enumInputModeBuildGraph&&(this.m_tmpHalfEdgeParentageIndex=this.createUserIndexForHalfEdges(),this.m_tmpHalfEdgeParentageIndexLeft=this.createUserIndexForHalfEdges()),t===H.enumInputModeSimplifyWinding&&(this.m_tmpHalfEdgeWindingNumberIndex=this.createUserIndexForHalfEdges()),t===H.enumInputModeSimplifyAlternate&&(this.m_tmpHalfEdgeOddEvenNumberIndex=this.createUserIndexForHalfEdges()),this.createHalfEdges_(t,h),this.dbgNavigate_(),this.sortHalfEdgesByAngle_(t),!Number.isNaN(this.m_checkDirtyPlanesweepTolerance)&&!this.checkStructureAfterDirtySweep_())return this.m_bDirtyCheckFailed=!0,void this.cleanSetEditShapeImpl_();this.buildChains_(t),-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),this.m_bBuildChains&&this.planeSweepParentage_(t,a),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),this.dbgChkChainParents_(),this.dbgDumpChains_(),this.mergeSegmentParentage_(),this.dbgNavigate_(),this.dbgDumpChains_(),this.cleanSetEditShapeImpl_()}setEditShapeImpl3D_(e,t,n,s,r){i.geometryReleaseAssert(0)}cleanSetEditShapeImpl_(){-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),-1!==this.m_tmpHalfEdgeWindingNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),-1!==this.m_tmpHalfEdgeOddEvenNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1)}cleanSetEditShapeImpl3D_(){i.geometryReleaseAssert(0)}dbgNavigate_(){}dbgChkChainParents_(){}deleteEdgeImpl_(e){const t=this.getHalfEdgeNext(e),i=this.getHalfEdgePrev(e),s=this.getHalfEdgeTwin(e),r=this.getHalfEdgeNext(s),o=this.getHalfEdgePrev(s);t!==s&&(this.setHalfEdgeNext_(o,t),this.setHalfEdgePrev_(t,o)),i!==s&&(this.setHalfEdgeNext_(i,r),this.setHalfEdgePrev_(r,i));const a=this.getHalfEdgeOrigin(e);this.getClusterHalfEdge(a)===e&&(r!==e?this.setClusterHalfEdge_(a,r):this.setClusterHalfEdge_(a,n.nullHandle));const l=this.getHalfEdgeOrigin(s);this.getClusterHalfEdge(l)===s&&(t!==s?this.setClusterHalfEdge_(l,t):this.setClusterHalfEdge_(l,n.nullHandle)),this.m_halfEdgeData.deleteElement(e),this.m_halfEdgeData.deleteElement(s)}getLeftSkipPolylines_(e,t){let i=t;for(;;){if(i=e.getPrev(i),-1===i)return n.nullHandle;{const t=e.getElement(i);if(this.getHalfEdgeChain(t)!==this.getHalfEdgeChain(this.getHalfEdgeTwin(t)))return t}}}checkStructureAfterDirtySweep_(){const e=r.sqr(this.m_checkDirtyPlanesweepTolerance),t=new r.Point2D,i=new r.Point2D,s=new r.Point2D,o=new r.Point2D,a=new r.Point2D;for(let r=this.getFirstCluster();r!==n.nullHandle;r=this.getNextCluster(r)){const l=this.getClusterHalfEdge(r);if(l!==n.nullHandle){let n=l;this.getHalfEdgeFromXY(n,t),this.getHalfEdgeToXY(n,i),s.setSub(i,t);let r=s.sqrLength();do{const l=n;if(n=this.getHalfEdgeNext(this.getHalfEdgeTwin(n)),n!==l){this.getHalfEdgeToXY(n,o),a.setSub(o,t);const l=a.sqrLength(),c=a.crossProduct(s),h=c*c/(l*r);if(Math.min(l,r)*h<=e&&a.dotProduct(s)>=0)return!1;s.assign(a),r=l,i.assign(o)}}while(n!==l)}}return!0}extractPolygonPathFromChain_(e,t,i,r,o){const a=this.m_shape.hasSegmentParentage(),l=this.getChainHalfEdge(i);let c=l,h=n.nullHandle;const u=new s.Point;do{const s=this.getHalfEdgeTwin(c);if(this.getHalfEdgeChain(s)!==i){let i=n.nullHandle;const s=this.getHalfEdgeOrigin(c);if(r===n.nullHandle){const e=this.getClusterVertexIterator(s);i=this.getVertexFromVertexIterator(e)}else for(let e=this.getClusterVertexIterator(s);e!==n.nullHandle;e=this.incrementVertexIterator(e)){const t=this.getVertexFromVertexIterator(e);i===n.nullHandle&&(i=t);const s=this.m_shape.getPathFromVertex(t);if(this.m_shape.getGeometryFromPath(s)===r){i=t;break}}let l;if(h===n.nullHandle&&(h=e.insertPath(t,n.nullHandle),e.setClosedPath(h,!0)),this.m_shape===e?l=e.addVertex(h,i):(this.m_shape.queryPoint(i,u),l=e.addPoint(h,u)),this.isHalfEdgeCurve(c)&&(this.querySegmentXY(c,o),e.setSegmentToIndex(e.getVertexIndex(l),o.get().clone())),a){const t=this.getSegmentParentage(c);e.setSegmentParentageAndBreak(l,t,this.isBreakNode(s))}}c=this.getHalfEdgeNext(c)}while(c!==l)}mergeSegmentParentage_(){if(!this.m_shape.hasSegmentParentage())return;i.geometryReleaseAssert(-1!==this.m_clusterBreakNodeIndex),i.geometryReleaseAssert(-1===this.m_segmentParentageIndex);for(let e=this.getFirstCluster();e!==n.nullHandle;e=this.getNextCluster(e)){let t=0;const i=this.getClusterHalfEdge(e);if(i!==n.nullHandle){let e=i;do{t++,e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(e!==i&&t<3)}2!==t&&this.setBreakNode(e,!0)}let e=[],t=[];this.m_segmentParentageIndex=this.createUserIndexForHalfEdges();const s=this.createUserIndexForHalfEdges();for(let i=this.getFirstCluster();i!==n.nullHandle;i=this.getNextCluster(i)){const o=this.getClusterHalfEdge(i);if(o!==n.nullHandle){let i=!1,n=o;do{let o=n;for(;-1===this.getHalfEdgeUserIndex(o,s);){const n=this.getHalfEdgeNext(o),a=this.getHalfEdgeTwin(o);B(this,o,t);const l=t.at(-1).parentage;if(!i){const t=this.getHalfEdgeOrigin(o);if(!this.isBreakNode(t)){const t=this.getHalfEdgePrev(o);o!==t&&(B(this,t,e),i=!0)}}if(i&&!Y(t,e)){const e=this.getHalfEdgeOrigin(o);this.setBreakNode(e,!0)}e=r.swap(t,t=e),i=!0;const c=this.getHalfEdgeOrigin(n);this.isBreakNode(c)&&(i=!1),this.setHalfEdgeUserIndex(o,this.m_segmentParentageIndex,l),this.setHalfEdgeUserIndex(a,this.m_segmentParentageIndex,l),this.setHalfEdgeUserIndex(o,s,1),this.setHalfEdgeUserIndex(a,s,1),o=n}n=this.getHalfEdgeNext(this.getHalfEdgeTwin(n))}while(n!==o)}}this.deleteUserIndexForHalfEdges(s)}registerNewBitSet(e){return null===this.m_uniqueBitSets&&(this.m_uniqueBitSets=new F((e=>e.getHashCode()),((e,t)=>e.equals(t))),this.m_uniqueBitSets.add(this.getEmptySet())),null===e?this.getEmptySet():this.m_uniqueBitSets.has(e)?this.m_uniqueBitSets.get(e):(this.m_uniqueBitSets.add(e),e)}getLeftEdgeBitSet_(e){const t=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft);return i.geometryReleaseAssert(t>=0),i.geometryReleaseAssert(this.m_edgeBitSets.at(t)),this.m_edgeBitSets.at(t)}getEdgeBitSet_(e){const t=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndex);return i.geometryReleaseAssert(t>=0),this.m_edgeBitSets.at(t)}setEdgeBitSet_(e,t){i.geometryReleaseAssert(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),-1===this.m_edgeBitSetIndex&&(this.m_edgeBitSetIndex=this.createUserIndexForHalfEdges());const n=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndex);-1!==n?this.m_edgeBitSets[n]=t:(this.setHalfEdgeUserIndex(e,this.m_edgeBitSetIndex,this.m_edgeBitSets.length),this.m_edgeBitSets.push(t))}setLeftEdgeBitSet_(e,t){i.geometryReleaseAssert(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),-1===this.m_edgeBitSetIndexLeft&&(this.m_edgeBitSetIndexLeft=this.createUserIndexForHalfEdges());const n=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft);-1!==n?this.m_edgeBitSets[n]=t:(this.setHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft,this.m_edgeBitSets.length),this.m_edgeBitSets.push(t))}setChainBitSet_(e,t){i.geometryReleaseAssert(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),-1===this.m_chainBitSetIndex&&(this.m_chainBitSetIndex=this.createUserIndexForChains());const n=this.getChainUserIndex(e,this.m_chainBitSetIndex);-1!==n?this.m_chainBitSets[n]=t:(this.setChainUserIndex(e,this.m_chainBitSetIndex,this.m_chainBitSets.length),this.m_chainBitSets.push(t))}getEmptySet(){return this.m_emptyBitSet||(this.m_emptyBitSet=new V),this.m_emptyBitSet}deleteEdgeBitSets_(){-1!==this.m_edgeBitSetIndex&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndex),this.m_edgeBitSetIndex=-1),-1!==this.m_edgeBitSetIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndexLeft),this.m_edgeBitSetIndexLeft=-1),this.m_edgeBitSets.length=0,this.m_uniqueBitSets=null}deleteChainBitSets_(){-1!==this.m_chainBitSetIndex&&(this.deleteUserIndexForChains(this.m_chainBitSetIndex),this.m_chainBitSetIndex=-1,this.m_chainBitSets.length=0)}dbgPrintEdge_(e){}dbgVerifyEdgeSegment(e){}}X.c_EdgeParentageMask=~(1<<31),X.c_EdgeBitMask=1<<31;class j{freeNode_(e){this.m_listNodes.deleteElement(e)}newNode_(){return this.m_listNodes.newElement()}freeList_(e){this.m_lists.deleteElement(e)}newList_(){return this.m_lists.newElement()}Init_(e){i.geometryReleaseAssert(0)}constructor(e){this.m_listNodes=new s.StridedIndexTypeCollection(2),this.m_listOfLists=j.st_nullNode(),this.m_bAllowNavigationBetweenLists=!0,void 0===e&&(e=!0),this.m_bAllowNavigationBetweenLists=e,this.m_lists=new s.StridedIndexTypeCollection(this.m_bAllowNavigationBetweenLists?4:2)}createList(){const e=this.newList_();return this.m_bAllowNavigationBetweenLists&&(this.m_lists.setField(e,3,this.m_listOfLists),this.m_listOfLists!==j.st_nullNode()&&this.m_lists.setField(this.m_listOfLists,2,e),this.m_listOfLists=e),e}deleteList(e){let t=this.getFirst(e);for(;t!==j.st_nullNode();){const e=t;t=this.getNext(t),this.freeNode_(e)}if(this.m_bAllowNavigationBetweenLists){const t=this.m_lists.getField(e,2),i=this.m_lists.getField(e,3);t!==j.st_nullNode()?this.m_lists.setField(t,3,i):this.m_listOfLists=i,i!==j.st_nullNode()&&this.m_lists.setField(i,2,t)}this.freeList_(e)}reserveLists(e){this.m_lists.setCapacity(e)}addElement(e,t){this.m_lists.getField(e,0);const i=this.m_lists.getField(e,1),n=this.newNode_();return i!==j.st_nullNode()?(this.m_listNodes.setField(i,1,n),this.m_lists.setField(e,1,n)):(this.m_lists.setField(e,0,n),this.m_lists.setField(e,1,n)),this.m_listNodes.setField(n,0,t),n}reserveNodes(e){this.m_listNodes.setCapacity(e)}deleteElementDirect(e,t,i){t!==j.st_nullNode()?(this.m_listNodes.setField(t,1,this.m_listNodes.getField(i,1)),this.m_lists.getField(e,1)===i&&this.m_lists.setField(e,1,t)):(this.m_lists.setField(e,0,this.m_listNodes.getField(i,1)),this.m_lists.getField(e,1)===i&&this.m_lists.setField(e,1,j.st_nullNode())),this.freeNode_(i)}deleteElementSearch(e,t){let i=-1,n=this.getFirst(e);for(;n!==t;)i=n,n=this.getNext(n);this.deleteElementDirect(e,i,t)}concatenateLists(e,t){const i=this.m_lists.getField(e,1),n=this.m_lists.getField(t,0);if(n!==j.st_nullNode()&&(i!==j.st_nullNode()?(this.m_listNodes.setField(i,1,n),this.m_lists.setField(e,1,this.m_lists.getField(t,1))):(this.m_lists.setField(e,0,n),this.m_lists.setField(e,1,this.m_lists.getField(t,1)))),this.m_bAllowNavigationBetweenLists){const e=this.m_lists.getField(t,2),i=this.m_lists.getField(t,3);e!==j.st_nullNode()?this.m_lists.setField(e,3,i):this.m_listOfLists=i,i!==j.st_nullNode()&&this.m_lists.setField(i,2,e)}return this.freeList_(t),e}getElement(e){return this.m_listNodes.getField(e,0)}getData(e){return this.getElement(e)}setElement(e,t){i.geometryReleaseAssert(0)}getNext(e){return this.m_listNodes.getField(e,1)}getFirst(e){return this.m_lists.getField(e,0)}getFirstElement(e){const t=this.getFirst(e);return this.getElement(t)}static st_nullNode(){return-1}clear(){this.m_listNodes.deleteAll(!0),this.m_lists.deleteAll(!0),this.m_listOfLists=j.st_nullNode()}isEmpty(e){return i.geometryReleaseAssert(0),!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getFirstList(){return this.m_listOfLists}getNextList(e){return this.m_lists.getField(e,3)}}function W(e=-1){return{m_value:e,m_line:new n.Line,m_segment:null,m_segmentInfo:new n.SegmentTypeInfo(-1),m_env:new r.Envelope1D(0,0),m_dxdy:55555555,m_bHorizontal:!1,m_bCurve:!1}}class Z extends s.Comparator{constructor(e,t,i){super(!0),this.m_bIntersectionDetected=!1,this.m_nonSimpleResult=new u.NonSimpleResult,this.m_tempSimpleEdge1=W(),this.m_tempSimpleEdge2=W(),this.m_prev1=n.nullHandle,this.m_prev2=n.nullHandle,this.m_vertex1=n.nullHandle,this.m_vertex2=n.nullHandle,this.m_currentNode=-1,this.m_prevX1=Number.NaN,this.m_prevX2=Number.NaN,this.m_prevY=Number.NaN,this.m_prevX=0,this.m_sweepY=Number.NaN,this.m_sweepX=0,this.m_ptSweep=new r.Point2D,this.m_simpleEdgesCache=[],this.m_simpleEdgesRecycle=[],this.m_cOutstandingConstructedEdges=0,this.m_shape=e,this.m_bShapeHasSegments=this.m_shape.hasCurves(),this.m_tolerance=t,this.m_tolerance10=10*t,this.m_bIsSimple=i;const s=Math.trunc(Math.min(3*e.getTotalPointCount()/2,67)),o=Math.min(7,s);this.m_simpleEdgesCache.length=o}tryGetCachedEdge_(e){const t=this.m_simpleEdgesCache[(e&r.indexTypeMax())%this.m_simpleEdgesCache.length];return t&&t.m_value===e?t:null}tryDeleteCachedEdge_(e){const t=(e&r.indexTypeMax())%this.m_simpleEdgesCache.length,i=this.m_simpleEdgesCache[t];i&&i.m_value===e&&(this.m_simpleEdgesRecycle.push(i),this.m_simpleEdgesCache[t]=null)}tryCreateCachedEdge_(e){const t=(e&r.indexTypeMax())%this.m_simpleEdgesCache.length;let i=this.m_simpleEdgesCache[t];return i?null:(0===this.m_simpleEdgesRecycle.length?(i=W(),this.m_cOutstandingConstructedEdges++):i=this.m_simpleEdgesRecycle.pop(),i.m_value=e,this.m_simpleEdgesCache[t]=i,i)}initSimpleEdge_(e,t){this.m_bShapeHasSegments&&this.initSimpleEdgeHelper_(e,t)||e.m_bCurve||(this.m_shape.queryLineConnector(t,e.m_line,!0),e.m_segment=e.m_line,e.m_env.setCoordsNoNAN(e.m_line.getStartX(),e.m_line.getEndX()),e.m_env.vmax+=this.m_tolerance,e.m_line.orientBottomUp(),e.m_bHorizontal=e.m_line.getEndY()===e.m_line.getStartY(),e.m_bHorizontal||(e.m_dxdy=(e.m_line.getEndX()-e.m_line.getStartX())/(e.m_line.getEndY()-e.m_line.getStartY())))}initSimpleEdgeHelper_(e,t){if(e.m_segment=this.m_shape.getSegment(t),e.m_segmentInfo=this.m_shape.getOriginalSegmentInfo(t),e.m_bCurve=null!==e.m_segment,e.m_bCurve){const t=e.m_segment.clone();return t.orientBottomUp(),e.m_segment=t,e.m_env=e.m_segment.queryInterval(0,0),e.m_env.vmax+=this.m_tolerance,!0}return!1}compareTwoSegments_(e,t){const i=e.getStartXY(),n=e.getEndXY(),s=t.getStartXY(),o=t.getEndXY();if(this.m_ptSweep.setCoords(this.m_sweepX,this.m_sweepY),i.isEqualPoint2D(s)&&this.m_sweepY===i.y){this.m_ptSweep.assign(n.compare(o)<0?n:o);const i=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),s=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x);if(Math.abs(i-s)>this.m_tolerance)return i<s?-1:1}const a=i.compare(s)<0?s:i,l=n.compare(o)<0?n:o;let c=0,h=0;for(let i=1;i<5;i++){r.lerpPoint2D(a,l,i/5,this.m_ptSweep);const n=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),s=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),o=Math.abs(n-s);o>c&&(c=o,h=n<s?-1:1)}return 0===h?this.errorCracking():h}compareNonHorizontal_(e,t){if(e.m_line.getStartY()===t.m_line.getStartY()&&e.m_line.getStartX()===t.m_line.getStartX())return e.m_line.getEndY()===t.m_line.getEndY()&&e.m_line.getEndX()===t.m_line.getEndX()?this.m_bIsSimple?this.errorCoincident():0:this.compareNonHorizontalUpperEnd_(e,t);if(e.m_line.getEndY()===t.m_line.getEndY()&&e.m_line.getEndX()===t.m_line.getEndX())return this.compareNonHorizontalLowerEnd_(e,t);const i=this.compareNonHorizontalLowerEnd_(e,t),n=this.compareNonHorizontalUpperEnd_(e,t);return i<0&&n<0?-1:i>0&&n>0?1:this.errorCracking()}compareHorizontal1Case1_(e,t){if(e.getEndX()>t.getEndX()){if(t.getEndX()>t.getStartX()&&t.getEndY()-t.getStartY()<2*this.m_tolerance&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((t.getEndY()-t.getStartY())/(t.getEndX()-t.getStartX())*(e.getEndX()-e.getStartX())<this.m_tolerance10&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return 1}compareHorizontal1Case2_(e,t){if(e.getStartX()<t.getStartX()){if(t.getEndX()>t.getStartX()&&t.getEndY()-t.getStartY()<2*this.m_tolerance&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((t.getEndY()-t.getStartY())/(t.getEndX()-t.getStartX())*(e.getStartX()-e.getEndX())<this.m_tolerance10&&t.isIntersectingPoint(e.getStartXY(),this.m_tolerance,!0))return this.errorCracking();return-1}compareHorizontal1Case3_(e,t){const i=r.Point2D.getNAN();i.setSub(t.getEndXY(),t.getStartXY()),i.rightPerpendicularThis(),i.normalize();const n=r.Point2D.getNAN();n.setSub(e.getStartXY(),t.getStartXY());const s=r.Point2D.getNAN();s.setSub(e.getEndXY(),t.getStartXY());const o=n.dotProduct(i),a=s.dotProduct(i),l=Math.abs(o),c=Math.abs(a);if(l<c){if(l<this.m_tolerance10&&t.isIntersectingPoint(e.getStartXY(),this.m_tolerance,!0))return this.errorCracking()}else if(c<this.m_tolerance10&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return o<0&&a<0?-1:o>0&&a>0?1:this.errorCracking()}compareHorizontal1_(e,t){return e.getStartY()===t.getStartY()&&e.getStartX()===t.getStartX()?this.compareHorizontal1Case1_(e,t):e.getEndY()===t.getEndY()&&e.getEndX()===t.getEndX()?this.compareHorizontal1Case2_(e,t):this.compareHorizontal1Case3_(e,t)}compareHorizontal2_(e,t){return e.getEndY()===t.getEndY()&&e.getEndX()===t.getEndX()&&e.getStartY()===t.getStartY()&&e.getStartX()===t.getStartX()?this.m_bIsSimple?this.errorCoincident():0:this.errorCracking()}compareNonHorizontalLowerEnd_(e,t){let i=1;if(e.m_line.getStartY()<t.m_line.getStartY()){i=-1;const n=e;e=t,t=n}const n=e.m_line,s=t.m_line,r=n.getStartX()-s.getStartX(),o=t.m_dxdy*(n.getStartY()-s.getStartY()),a=this.m_tolerance10;return r<o-a?-i:r>o+a?i:s.isIntersectingPoint(n.getStartXY(),this.m_tolerance,!0)?this.errorCracking():r<o?-i:i}compareNonHorizontalUpperEnd_(e,t){let i=1;if(t.m_line.getEndY()<e.m_line.getEndY()){i=-1;const n=e;e=t,t=n}const n=e.m_line,s=t.m_line,r=n.getEndX()-s.getStartX(),o=t.m_dxdy*(n.getEndY()-s.getStartY()),a=this.m_tolerance10;return r<o-a?-i:r>o+a?i:s.isIntersectingPoint(n.getEndXY(),this.m_tolerance,!0)?this.errorCracking():r<o?-i:i}errorCoincident(){return this.m_bIntersectionDetected=!0,this.m_nonSimpleResult=new u.NonSimpleResult(7,this.m_vertex1,this.m_vertex2),-1}errorCracking(){if(this.m_bIntersectionDetected=!0,this.m_bIsSimple){const e=6;this.m_nonSimpleResult=new u.NonSimpleResult(e,this.m_vertex1,this.m_vertex2)}else this.m_prev1=n.nullHandle,this.m_prev2=n.nullHandle,this.m_vertex1=n.nullHandle,this.m_vertex2=n.nullHandle;return-1}compareSegments_(e,t,i,s){if(i.m_env.vmax<s.m_env.vmin)return-1;if(s.m_env.vmax<i.m_env.vmin)return 1;if(!i.m_bCurve&&!s.m_bCurve){let e=i.m_bHorizontal?1:0;return e|=s.m_bHorizontal?2:0,0===e?this.compareNonHorizontal_(i,s):1===e?this.compareHorizontal1_(i.m_line,s.m_line):2===e?-1*this.compareHorizontal1_(s.m_line,i.m_line):this.compareHorizontal2_(i.m_line,s.m_line)}if(this.m_bIntersectionDetected)return-1;const r=this.m_prevY===this.m_sweepY&&this.m_prevX===this.m_sweepX;let o,a;if(r&&e===this.m_prev1?o=this.m_prevX1:(o=Number.NaN,this.m_prev1=n.nullHandle),r&&t===this.m_prev2?a=this.m_prevX2:(a=Number.NaN,this.m_prev2=n.nullHandle),this.m_prevY=this.m_sweepY,this.m_prevX=this.m_sweepX,Number.isNaN(o)){this.m_prev1=e;const t=i.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);o=t,this.m_prevX1=t}if(Number.isNaN(a)){this.m_prev2=t;const e=s.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);a=e,this.m_prevX2=e}const l=n.isIntersectingEx(!0,!0,i.m_segment,s.m_segment,this.m_tolerance,!0);return 0!==l?2===l?this.m_bIsSimple?this.errorCoincident():i.m_segmentInfo.equals(s.m_segmentInfo)?0:this.errorCracking():this.errorCracking():Math.abs(o-a)<=this.m_tolerance?this.compareTwoSegments_(i.m_segment,s.m_segment):o<a?-1:o>a?1:0}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1}intersectionDetected(){return this.m_bIntersectionDetected}getLastComparedNode(){return this.m_currentNode}getResult(){return this.m_nonSimpleResult}setSweepY(e,t){this.m_sweepY=e,this.m_sweepX=t,this.m_prev1=n.nullHandle,this.m_prev2=n.nullHandle,this.m_vertex1=n.nullHandle,this.m_vertex2=n.nullHandle}compare(e,t,i){if(this.m_bIntersectionDetected)return-1;const n=e.getElement(i),s=t;return this.m_currentNode=i,this.compareSegments(s,s,n,n)}compareSegments(e,t,i,n){let s=this.tryGetCachedEdge_(e);null===s?this.m_vertex1===t?s=this.m_tempSimpleEdge1:(this.m_vertex1=t,s=this.tryCreateCachedEdge_(e),null===s&&(s=this.m_tempSimpleEdge1,this.m_tempSimpleEdge1.m_value=e),this.initSimpleEdge_(s,t)):this.m_vertex1=t;let r=this.tryGetCachedEdge_(i);return null===r?this.m_vertex2===n?r=this.m_tempSimpleEdge2:(this.m_vertex2=n,r=this.tryCreateCachedEdge_(i),null===r&&(r=this.m_tempSimpleEdge2,this.m_tempSimpleEdge2.m_value=i),this.initSimpleEdge_(r,n)):this.m_vertex2=n,this.compareSegments_(t,n,s,r)}onDelete(e){this.tryDeleteCachedEdge_(e)}onSet(e){this.tryDeleteCachedEdge_(e)}onEndSearch(e){this.tryDeleteCachedEdge_(e)}onAddUniqueElementFailed(e){this.tryDeleteCachedEdge_(e)}}class Q{constructor(e,t){this.m_bIntersectionDetected=!1,this.m_pointOfInterest=r.Point2D.getNAN(),this.m_line1=new n.Line,this.m_seg1=null,this.m_env=r.Envelope1D.constructEmpty(),this.m_vertex1=-1,this.m_currentNode=-1,this.m_minDist=Number.MAX_VALUE,this.m_shape=e,this.m_tolerance=t}getCurrentNode(){return this.m_currentNode}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1,this.m_minDist=Number.MAX_VALUE}intersectionDetected(){return this.m_bIntersectionDetected}setPoint(e){this.m_pointOfInterest.assign(e)}compare(e,t){const i=e.getElement(t);return this.compareVertex(e,t,i)}compareVertex(e,i,s){let o,a=this.m_shape.getSegment(s),l=!0;if(null==a)this.m_shape.queryLineConnector(s,this.m_line1,!0),this.m_env.setCoordsNoNAN(this.m_line1.getStartX(),this.m_line1.getEndX()),a=this.m_line1,o=this.m_line1.getStartY()===this.m_line1.getEndY();else{const e=t.Envelope2D.constructEmpty();a.queryLooseEnvelope(e),e.queryIntervalX(this.m_env),o=0===e.height(),l=!1}if(this.m_pointOfInterest.x+this.m_tolerance<this.m_env.vmin)return-1;if(this.m_pointOfInterest.x-this.m_tolerance>this.m_env.vmax)return 1;if(o)return this.m_currentNode=i,this.m_bIntersectionDetected=!0,0;let c=0;if(l){n.orientBottomUp(this.m_line1);const e=this.m_line1.getStartXY(),t=new r.Point2D;t.setSub(this.m_line1.getEndXY(),e),t.rightPerpendicularThis();const i=new r.Point2D;i.setSub(this.m_pointOfInterest,e),c=t.dotProduct(i),c/=t.length()}else c=a.intersectionOfYMonotonicWithAxisX(this.m_pointOfInterest.y,this.m_pointOfInterest.x)-this.m_pointOfInterest.x;return c<10*-this.m_tolerance?-1:c>10*this.m_tolerance?1:(a.isIntersectingPoint(this.m_pointOfInterest,this.m_tolerance)&&(Math.abs(c)<this.m_minDist&&(this.m_currentNode=i,this.m_minDist=c),this.m_bIntersectionDetected=!0),c<0?-1:c>0?1:0)}}class ${constructor(e,t){this.m_lists=new j(!1),this.m_hash=t,this.m_hashBuckets=new Int32Array(e),this.m_hashBuckets.fill($.st_nullNode()),this.m_bitFilter=new Int32Array(10*e+31>>5)}reserveElements(e){this.m_lists.reserveLists(Math.min(this.m_hashBuckets.length,e)),this.m_lists.reserveNodes(e)}addElement(e,t){void 0===t&&(t=this.m_hash.getHash(e));const i=t%(this.m_bitFilter.length<<5);this.m_bitFilter[i>>5]|=1<<(31&i);const n=t%this.m_hashBuckets.length;let s=this.m_hashBuckets[n];return s===j.st_nullNode()&&(s=this.m_lists.createList(),this.m_hashBuckets[n]=s),this.m_lists.addElement(s,e)}deleteElement(e,t){void 0===t&&(t=this.m_hash.getHash(e));const n=t%this.m_hashBuckets.length,s=this.m_hashBuckets[n];s===j.st_nullNode()&&i.throwInvalidArgumentException("");let r=this.m_lists.getFirst(s),o=j.st_nullNode();for(;r!==j.st_nullNode();){const t=this.m_lists.getData(r),i=this.m_lists.getNext(r);t===e?(this.m_lists.deleteElementDirect(s,o,r),this.m_lists.getFirst(s)===j.st_nullNode()&&(this.m_lists.deleteList(s),this.m_hashBuckets[n]=j.st_nullNode())):o=r,r=i}}getFirstInBucket(e){const t=e%(this.m_bitFilter.length<<5);if(!(this.m_bitFilter[t>>5]&1<<(31&t)))return j.st_nullNode();const i=e%this.m_hashBuckets.length,n=this.m_hashBuckets[i];return n===j.st_nullNode()?j.st_nullNode():this.m_lists.getFirst(n)}getNextInBucket(e){return this.m_lists.getNext(e)}findNode(e){const t=this.m_hash.getHash(e);let i=this.getFirstInBucket(t);for(;i!==j.st_nullNode();){const t=this.m_lists.getData(i);if(this.m_hash.equal(t,e))return i;i=this.m_lists.getNext(i)}return j.st_nullNode()}deleteNode(e){const t=this.getElement(e),n=this.m_hash.getHash(t)%this.m_hashBuckets.length,s=this.m_hashBuckets[n];s===j.st_nullNode()&&i.throwInvalidArgumentException(""),this.m_lists.deleteElementSearch(s,e),this.m_lists.getFirst(s)===j.st_nullNode()&&(this.m_lists.deleteList(s),this.m_hashBuckets[n]=j.st_nullNode())}getElement(e){return this.m_lists.getData(e)}static st_nullNode(){return j.st_nullNode()}clear(){i.geometryReleaseAssert(0)}size(){return this.m_lists.getNodeCount()}dbgPrintBucketHistogram(){}}function K(e,t,i,n,s){const r=new ne(s);return r.m_shape=e,r.m_sqrTolerance=t*t,r.m_cellSize=2*t,r.m_invCellSize=1/r.m_cellSize,r.m_geometry=i,r.m_bTrackChanges=n,r.m_bHasSegmentParentage=e.hasSegmentParentage(),r.clusterNonReciprocal()}function J(e,t,i,n,s){const r=e-i,o=t-n;return r*r+o*o<=s}function ee(e,t,i,n,s,o){const a={pt:new r.Point2D,weight:0,rank:0,bMerged:!1},l=i+s;let c=!1,h=e.x;e.x!==t.x&&(n===o&&(h=(e.x*i+t.x*s)/l),c=!0);let u=e.y;return e.y!==t.y&&(n===o&&(u=(e.y*i+t.y*s)/l),c=!0),n!==o?n>o?(a.rank=n,a.weight=i,a.pt=e):(a.rank=o,a.weight=s,a.pt=t):(a.pt.setCoords(h,u),a.weight=l,a.rank=n),a.bMerged=c,a}function te(e,t){const i=r.hashForClustering(e);return r.hashForClustering2(i,t)}class ie{constructor(e,t,i,n,s){this.m_workPt=new r.Point2D,this.m_shape=e,this.m_sqrTolerance=i,this.m_invCellSize=n,this.m_origin=t.clone(),this.m_hashValues=s}getHash(e){return this.m_shape.getUserIndex(e,this.m_hashValues)}calculateHashFromVertex(e){this.m_shape.queryXY(e,this.m_workPt);const t=this.m_workPt.x-this.m_origin.x,i=Math.trunc(t*this.m_invCellSize+.5),n=this.m_workPt.y-this.m_origin.y;return te(i,Math.trunc(n*this.m_invCellSize+.5))}equal(e,t){return i.geometryReleaseAssert(0),!1}}class ne{constructor(e){this.m_origin=r.Point2D.getNAN(),this.m_sqrTolerance=0,this.m_cellSize=0,this.m_invCellSize=0,this.m_geometry=n.nullHandle,this.m_bucketArray=r.makePrimitiveArray(4,Number.NaN),this.m_bucketHash=r.makePrimitiveArray(4,Number.NaN),this.m_dbgCandidateCheckCount=0,this.m_nsr=new u.NonSimpleResult,this.m_hashValues=-1,this.m_newClusters=-1,this.m_bTrackChanges=!1,this.m_bHasSegmentParentage=!1,this.m_shape=null,this.m_clusters=new j,this.m_hashFunction=null,this.m_hashTable=null,this.m_progressCounter=0,this.m_progressTracker=e}progress_(){}collectClusterCandidates(e,t){const i=r.Point2D.getNAN();this.m_shape.queryXY(e,i);const n=(i.x-this.m_origin.x)*this.m_invCellSize,s=(i.y-this.m_origin.y)*this.m_invCellSize,o=Math.trunc(n),a=Math.trunc(s);let l=0;for(let e=0;e<=1;e+=1)for(let t=0;t<=1;t+=1){const i=te(o+e,a+t),n=this.m_hashTable.getFirstInBucket(i);n!==$.st_nullNode()&&(this.m_bucketArray[l]=n,this.m_bucketHash[l]=i,l++)}for(let e=l-1;e>=1;e--){const t=this.m_bucketArray[e];for(let i=e-1;i>=0;i--)if(t===this.m_bucketArray[i]){this.m_bucketHash[i]=-1,l--,e!==l&&(this.m_bucketHash[e]=this.m_bucketHash[l],this.m_bucketArray[e]=this.m_bucketArray[l]);break}}for(let n=0;n<l;n++)this.collectNearestNeighbourCandidates(e,this.m_bucketHash[n],i,this.m_bucketArray[n],t)}collectNearestNeighbourCandidates(e,t,i,n,s){const o=r.Point2D.getNAN();for(let r=n;r!==$.st_nullNode();r=this.m_hashTable.getNextInBucket(r)){const n=this.m_hashTable.getElement(r);e===n||-1!==t&&this.m_shape.getUserIndex(n,this.m_hashValues)!==t||(this.m_shape.queryXY(n,o),J(i.x,i.y,o.x,o.y,this.m_sqrTolerance)&&s.push(r))}}mergeClusters(e,t,i){let n=this.m_shape.getUserIndex(e,this.m_newClusters);const r=this.m_shape.getUserIndex(t,this.m_newClusters);-1===n&&(n=this.m_clusters.createList(),this.m_clusters.addElement(n,e),this.m_shape.setUserIndex(e,this.m_newClusters,n)),-1===r?this.m_clusters.addElement(n,t):this.m_clusters.concatenateLists(n,r),this.m_shape.setUserIndex(t,this.m_newClusters,s.StridedIndexTypeCollection.impossibleIndex2());const o=this.mergeVertices(e,t);if(i){const t=this.m_hashFunction.calculateHashFromVertex(e);this.m_shape.setUserIndex(e,this.m_hashValues,t)}return o}mergeVertices(e,t){const i=r.Point2D.getNAN();this.m_shape.queryXY(e,i);const n=r.Point2D.getNAN();this.m_shape.queryXY(t,n);const s=this.m_shape.getRank(e),o=this.m_shape.getRank(t),a=this.m_shape.getWeight(e),l=this.m_shape.getWeight(t);let c,h,u,m,d=!1;if(s===o?(c=s,h=a+l,u=i.x,i.x!==n.x&&(u=(i.x*a+n.x*l)/h,d=!0),m=i.y,i.y!==n.y&&(m=(i.y*a+n.y*l)/h,d=!0)):(s>o?(u=i.x,m=i.y,h=a,c=s):(u=n.x,m=n.y,h=l,c=o),d=!i.equals(n)),d&&(this.m_shape.setXYMonotonic(e,u,m),this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(e,!0),this.m_bHasSegmentParentage)){const i=this.m_shape.getSegmentParentageBreakVertex(e)||this.m_shape.getSegmentParentageBreakVertex(t);this.m_shape.setSegmentParentageBreakVertex(e,i),this.m_shape.setSegmentParentageBreakVertex(t,i)}return this.m_shape.setWeight(e,h),this.m_shape.setRank(e,c),d}needsClustering(){const e={stack:[],error:void 0,hasError:!1};try{o.__addDisposableResource(e,r.makeScopedCall((()=>{this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters)})),!1);const t=this.m_shape.getSelectedCount(),i=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin.assign(i.getLowerLeft());const a=Math.max(i.height(),i.width())/(r.intMax()-1);this.m_cellSize<a&&(this.m_cellSize=a,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(this.m_shape.getSelectedCount()/3+1),this.m_clusters.reserveNodes(this.m_shape.getSelectedCount()/3+1),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new ie(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new $(4*t/3,this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let l=!1;for(let e=0;e<2;e++){const t=[],i=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let r=i.next();r!==n.nullHandle;r=i.next()){if(this.progress_(),e>0&&this.m_shape.getUserIndex(r,this.m_newClusters)===s.StridedIndexTypeCollection.impossibleIndex2())continue;let i;if(0===e?(i=this.m_hashFunction.calculateHashFromVertex(r),this.m_shape.setUserIndex(r,this.m_hashValues,i)):i=this.m_shape.getUserIndex(r,this.m_hashValues),this.collectClusterCandidates(r,t),0!==t.length){for(let e=0,i=t.length;e<i;e++){this.progress_();const i=t[e],n=this.m_hashTable.getElement(i);if(this.m_hashTable.deleteNode(i),!this.m_shape.isEqualXY(r,n))return this.m_nsr=new u.NonSimpleResult(5,this.m_shape.getVertexIndex(r),this.m_shape.getVertexIndex(n)),l=!0,l;this.mergeClusters(r,n,!1)}t.length=0}0===e&&this.m_hashTable.addElement(r,i)}}return l}catch(t){e.error=t,e.hasError=!0}finally{o.__disposeResources(e)}}clusterNonReciprocal(){const e=this.m_shape.getSelectedCount(),t=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin=t.getLowerLeft();const i=Math.max(t.height(),t.width())/(r.intMax()-1);this.m_cellSize<i&&(this.m_cellSize=i,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_clusters.reserveNodes(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new ie(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new $(Math.trunc(4*e/3),this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let o=!1;{const e=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let t=e.next();t!==n.nullHandle;t=e.next()){this.progress_();const e=this.m_hashFunction.calculateHashFromVertex(t);this.m_shape.setUserIndex(t,this.m_hashValues,e),this.m_hashTable.addElement(t,e)}}{const e=[],t=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let i=t.next();i!==n.nullHandle;i=t.next()){if(this.m_shape.getUserIndex(i,this.m_newClusters)===s.StridedIndexTypeCollection.impossibleIndex2())continue;let t=this.m_shape.getUserIndex(i,this.m_hashValues);this.m_hashTable.deleteElement(i,t);let n=!1;for(;this.collectClusterCandidates(i,e),0!==e.length;){let t=0;for(let n=0,s=e.length;n<s;n++){this.progress_();const r=e[n],o=this.m_hashTable.getElement(r);this.m_hashTable.deleteNode(r);const a=n+1===s;t|=this.mergeClusters(i,o,a)?1:0}if(n||=0!==t,o||=0!==t,e.length=0,!t)break}n&&(t=this.m_shape.getUserIndex(i,this.m_hashValues)),this.m_hashTable.addElement(i,t)}e.length=0}return o&&this.applyClusterPositions_(),this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters),o}applyClusterPositions_(){const e=r.Point2D.getNAN();for(let t=this.m_clusters.getFirstList();t!==j.st_nullNode();t=this.m_clusters.getNextList(t)){let i=this.m_clusters.getFirst(t);const n=this.m_clusters.getElement(i);this.m_shape.queryXY(n,e);const s=this.m_shape.getRank(n),r=this.m_shape.getWeight(n);for(i=this.m_clusters.getNext(i);i!==j.st_nullNode();i=this.m_clusters.getNext(i)){const t=this.m_clusters.getElement(i);if(this.m_bTrackChanges?this.m_shape.isEqualXYPoint2D(t,e)||(this.m_shape.setXYMonotonicPoint2D(t,e),this.m_shape.setGeometryModifiedWithVertex(t,!0)):this.m_shape.setXYMonotonicPoint2D(t,e),this.m_bHasSegmentParentage){const e=this.m_shape.getSegmentParentageBreakVertex(n)||this.m_shape.getSegmentParentageBreakVertex(t);this.m_shape.setSegmentParentageBreakVertex(n,e),this.m_shape.setSegmentParentageBreakVertex(t,e)}this.m_shape.setWeight(t,r),this.m_shape.setRank(t,s)}}}}class se{constructor(){this.m_inputParts=[],this.m_resultParts1=[],this.m_resultParts2=[],this.m_resultSegments=[],this.m_freeSegments=[],this.m_inputSegments=[],this.m_param1=[],this.m_param2=[],this.m_tolerance=0,this.m_toleranceZ=0,this.m_point=new s.Point,this.m_pointWeight=1,this.m_maxDensifyLimit=0,this.m_pointRank=0,this.m_changed1=!1,this.m_changed2=!1,this.m_adaptiveDensify=!1}clear(){this.freeAllResultSegments(),this.m_inputSegments.length=0,this.m_inputParts.length=0,this.m_resultParts1.length=0,this.m_resultParts2.length=0,this.m_param1.length=0,this.m_param2.length=0,this.m_adaptiveDensify=!1,this.m_changed1=!1,this.m_changed2=!1}newIntersectionPart_(e,t,i,n,s,r,o,a,l,c){return function(e,t,i,n,s,r,o,a,l,c){return{segmentIndex:e,weightStart:t,rankStart:i,weightEnd:n,rankEnd:s,weightInterior:r,rankInterior:o,segmentParentage:c,u:re(a,l)}}(e,t,i,n,s,r,o,a,l,c)}pushSegment(e,t,i,n,s,r,o,a,l,c){return this.m_inputParts.push(this.newIntersectionPart_(this.m_inputSegments.length,t,i,n,s,r,o,a,l,c)),this.m_inputSegments.push(e),this.m_inputParts.length-1}getResultSegmentCount(e){return this.m_adaptiveDensify?0===e?this.m_param1.length-1:this.m_param2.length-1:0===e?this.m_resultParts1.length:this.m_resultParts2.length}getResultPart_(e,t){return 0===e?this.m_resultParts1[t]:this.m_resultParts2[t]}getResultSegment(e,t){return this.m_resultSegments[this.getResultPart_(e,t).segmentIndex].get()}getSegmentChanged(e){return 0===e?this.m_changed1:this.m_changed2}getResultSegmentStartPointWeight(e,t){return this.getResultPart_(e,t).weightStart}getResultSegmentStartPointRank(e,t){return this.getResultPart_(e,t).rankStart}getResultSegmentSegmentParentage(e,t){return this.getResultPart_(e,t).segmentParentage}getResultSegmentStartPointIsBreak(e,t){return this.getResultPart_(e,t).u.bBreakStart}getResultSegmentEndPointWeight(e,t){return this.getResultPart_(e,t).weightEnd}getResultSegmentEndPointRank(e,t){return this.getResultPart_(e,t).rankEnd}getResultSegmentEndPointIsBreak(e,t){return this.getResultPart_(e,t).u.bBreakEnd}getResultSegmentInteriorRank(e,t){return this.getResultPart_(e,t).rankInterior}getResultSegmentInteriorWeight(e,t){return this.getResultPart_(e,t).weightInterior}getResultPoint(){return this.m_point}getResultPointWeight(){return this.m_pointWeight}getResultPointRank(){return this.m_pointRank}getResultPointChanged(){return this.m_changed2}intersectLines(e,t){2!==this.m_inputSegments.length&&i.throwInternalErrorException(""),this.m_changed1=!1,this.m_changed2=!1,this.m_tolerance=e;const s=r.sqr(e*se.c_smallToleranceFactor);let o=!1;const a=this.m_inputParts[0],l=this.m_inputParts[1],c=this.m_inputSegments[a.segmentIndex],h=this.m_inputSegments[l.segmentIndex];if(t||5&n.isIntersecting(!0,c,h,e,!0)){const t=n.intersect(!0,c,h,null,this.m_param1,this.m_param2,e);0===t&&i.throwInternalErrorException("");const u=new Array(t);for(let e=0;e<t;++e)u[e]=r.Point2D.getNAN();const m=new Float64Array(t),d=new Int32Array(t),p=new Array(t),g=new Array(t);for(let e=0;e<t;++e)p[e]={bBigMove:!1,bIsBreak:!1},g[e]={bBigMove:!1,bIsBreak:!1};for(let e=0;e<t;e++){const t=this.m_param1[e],i=this.m_param2[e];let n,_=a.rankInterior,f=a.weightInterior;0===t?(_=a.rankStart,f=a.weightStart,n=a.u.bBreakStart):1===t?(_=a.rankEnd,f=a.weightEnd,n=a.u.bBreakEnd):(this.m_changed1=!0,n=!1);let y,x=l.rankInterior,v=l.weightInterior;0===i?(x=l.rankStart,v=l.weightStart,y=l.u.bBreakStart):1===i?(x=l.rankEnd,v=l.weightEnd,y=l.u.bBreakEnd):(this.m_changed2=!0,y=!1);const P=_,b=x;let E=1,S=0,C=r.Point2D.getNAN();if(P===b){const n=c.getCoord2D(t),o=h.getCoord2D(i);E=f+v;const a=v/E;S=_,r.lerpPoint2D(n,o,a,C);const l=r.Point2D.sqrDistance(C,n),u=r.Point2D.sqrDistance(C,o);p[e].bBigMove=l>s,g[e].bBigMove=u>s,this.m_changed1||n.equals(C)||(this.m_changed1=!0),this.m_changed2||o.equals(C)||(this.m_changed2=!0)}else if(P>b){C=c.getCoord2D(t);const n=h.getCoord2D(i);E=f,S=_;const o=r.Point2D.sqrDistance(C,n);p[e].bBigMove=!1,g[e].bBigMove=o>s,this.m_changed2||n.equals(C)||(this.m_changed2=!0)}else{C=h.getCoord2D(i),E=v,S=x;const n=c.getCoord2D(t),o=r.Point2D.sqrDistance(C,n);p[e].bBigMove=o>s,g[e].bBigMove=!1,this.m_changed1||n.equals(C)||(this.m_changed1=!0)}u[e].assign(C),m[e]=E,d[e]=S,p[e].bIsBreak=n||y,g[e].bIsBreak=n||y,o||=p[e].bBigMove||g[e].bBigMove}const _=a.rankInterior,f=a.weightInterior;let y=0,x=-1;for(let i=0;i<=t;i++){const n=i<t?this.m_param1[i]:1;if(n!==y){const s=this.allocResultSegment(),o=this.m_resultSegments[s];let l,h,g,v;c.queryCut(y,n,o,!1),o.get().snapControlPoints(e*e);let P=!1,b=!1,E=!1,S=!1,C=!1,w=r.Point2D.getNAN(),T=r.Point2D.getNAN();-1!==x?(h=d[x],l=m[x],P=p[x].bBigMove,w.assign(u[x]),E=p[x].bIsBreak,C=!0):(l=a.weightStart,h=a.rankStart,w=o.get().getStartXY(),E=a.u.bBreakStart),i<t?(v=d[i],g=m[i],b=p[i].bBigMove,T.assign(u[i]),S=p[i].bIsBreak,C=!0):(g=a.weightEnd,v=a.rankEnd,T=o.get().getEndXY(),S=a.u.bBreakEnd),C&&o.get().setCoordsForIntersector(w,T,!0),this.m_resultParts1.push(this.newIntersectionPart_(s,l,h,g,v,f,_,E,S,a.segmentParentage));const D=this.m_resultParts1.at(-1);D.u.bBigMoveStart=P,D.u.bBigMoveEnd=b,y=n,x=i}else-1===x&&(x=i)}const v=r.makePrimitiveArray(t,0);for(let e=0;e<t;e++)v[e]=e;t>2?(v.sort(((e,t)=>this.m_param2[e]<this.m_param2[t]?-1:this.m_param2[e]>this.m_param2[t]?1:0)),r.numericSort(this.m_param2)):2===t&&this.m_param2[0]>this.m_param2[1]&&(this.m_param2[1]=r.swap(this.m_param2[0],this.m_param2[0]=this.m_param2[1]),v[1]=r.swap(v[0],v[0]=v[1]));const P=l.rankInterior,b=l.weightInterior;y=0,x=-1;for(let i=0;i<=t;i++){const n=i<t?this.m_param2[i]:1;if(n!==y){const s=this.allocResultSegment(),o=this.m_resultSegments[s];let a,c,p,_;h.queryCut(y,n,o,!1),o.get().snapControlPoints(e*e);let f=r.Point2D.getNAN(),E=r.Point2D.getNAN(),S=!1,C=!1,w=!1,T=!1,D=!1;if(-1!==x){const e=v[x];a=m[e],c=d[e],f.assign(u[e]),w=g[e].bBigMove,S=g[e].bIsBreak,D=!0}else a=l.weightStart,c=l.rankStart,f=o.get().getStartXY(),S=l.u.bBreakStart;if(i!==t){const e=v[i];p=m[e],_=d[e],E.assign(u[e]),T=g[e].bBigMove,C=g[e].bIsBreak,D=!0}else p=l.weightEnd,_=l.rankEnd,E=o.get().getEndXY(),C=l.u.bBreakEnd;D&&o.get().setCoordsForIntersector(f,E,!0),this.m_resultParts2.push(this.newIntersectionPart_(s,a,c,p,_,b,P,S,C,l.segmentParentage));const I=this.m_resultParts2.at(-1);I.u.bBigMoveStart=w,I.u.bBigMoveEnd=T,y=n,x=i}else-1===x&&(x=i)}return o?3:2}return 0}intersectLines3D(e,t,n,s){return i.geometryReleaseAssert(0),1}intersect2D(e,t){const n=this.m_inputParts[0],s=this.m_inputParts[1],r=this.m_inputSegments[n.segmentIndex].getGeometryType(),o=this.m_inputSegments[s.segmentIndex].getGeometryType();return r!==i.GeometryType.enumLine||o!==i.GeometryType.enumLine?new he(this).intersectCurves(e,t):this.intersectLines(e,t)}intersect2DEx(e,t,n,s,o){this.m_point.assignCopy(t),1!==this.m_inputSegments.length&&i.throwInternalErrorException(""),this.m_tolerance=e,this.m_changed1=!1,this.m_changed2=!1;const a=r.sqr(e*se.c_smallToleranceFactor);let l=!1;const c=this.m_inputParts[0],h=this.m_inputSegments[c.segmentIndex];if(o||h.isIntersectingPoint(t.getXY(),e,!0)){this.m_param1=r.makePrimitiveArray(16,Number.NaN);const i=h.getClosestCoordinate(t.getXY(),!1);this.m_param1[0]=i;let o=c.rankInterior,u=c.weightInterior;0===i?(o=c.rankStart,u=c.weightStart):1===i?(o=c.rankEnd,u=c.weightEnd):this.m_changed1=!0;let m=o;const d=n,p=s;m===d&&h.isCurve()&&(m=d+1);let g=1,_=0;const f=new r.Point2D;if(m===d){const e=h.getCoord2D(i),n=t.getXY();g=u+p,_=o;const s=p/g;r.lerpPoint2D(e,n,s,f),this.m_changed1||e.equals(f)||(this.m_changed1=!0),this.m_changed2||n.equals(f)||(this.m_changed2=!0),l=r.Point2D.sqrDistance(f,e)>a}else m>d?(f.assign(h.getCoord2D(i)),g=u,_=o,this.m_changed2||f.equals(t.getXY())||(this.m_changed2=!0)):(f.assign(h.getCoord2D(i)),g=p,_=d,this.m_changed1||f.equals(t.getXY())||(this.m_changed1=!0),l=r.Point2D.sqrDistance(f,t.getXY())>a);let y=0,x=-1;const v=1;for(let t=0;t<=v;t++){const i=t<v?this.m_param1[0]:1;if(i!==y){const n=this.allocResultSegment(),s=this.m_resultSegments[n];h.queryCut(y,i,s),s.get().snapControlPoints(e*e);let r=c.weightStart,o=c.weightEnd,a=c.rankStart,l=c.rankEnd;const u=c.rankInterior,m=c.weightInterior;let d=c.u.bBreakStart,p=c.u.bBreakEnd;-1!==x&&(r=g,a=_,d=!0,s.get().setCoordsForIntersector(f,s.get().getEndXY(),!0)),t!==v&&(o=g,l=_,p=!0,s.get().setCoordsForIntersector(s.get().getStartXY(),f,!0)),y=i,this.m_resultParts1.push(this.newIntersectionPart_(n,r,a,o,l,m,u,d,p,c.segmentParentage))}x=t}return this.m_point.setXY(f),this.m_pointWeight=g,this.m_pointRank=_,l?3:2}return 0}intersect3D(e,t,n,s){return i.geometryReleaseAssert(0),1}intersect3DEx(e,t,n,s,r,o,a){return i.geometryReleaseAssert(0),1}getTolerance(){return this.m_tolerance}freeAllResultSegments(){this.m_resultSegments.length=0,this.m_freeSegments.length=0}freeResultSegment(e){this.m_freeSegments.push(e)}allocResultSegment(){if(this.m_freeSegments.length)return this.m_freeSegments.pop();const e=new n.SegmentBuffer,t=this.m_resultSegments.length;return this.m_resultSegments.push(e),t}allocResultSegmentFromBuffer(e){if(this.m_freeSegments.length)return this.m_freeSegments.pop();const t=new n.SegmentBuffer({copy:e}),i=this.m_resultSegments.length;return this.m_resultSegments.push(t),i}allocResultSegmentFromSegment(e){if(this.m_freeSegments.length)return this.m_freeSegments.pop();const t=new n.SegmentBuffer({segment:e}),i=this.m_resultSegments.length;return this.m_resultSegments.push(t),i}}function re(e,t){return{bBigMoveStart:!1,bBigMoveEnd:!1,bBreakStart:e,bBreakEnd:t}}function oe(){return{bBigMove:!1,bIsBreak:!1}}se.maxWeight=.1*Number.MAX_VALUE,se.c_smallToleranceFactor=.01,se.c_maxGeometryTypeToRankDelta=8;let ae=class{constructor(){this.start=null,this.end=null,this.equalEdge=null,this.segmentIndex=-1,this.segmentParentage=-1,this.weight=0,this.rank=0}hasSegment(){return this.segmentIndex>=0}transferAttributes(e,t,i){if(1===t.getDescription().getAttributeCount())return;const n=e.parent.m_resultSegments[this.segmentIndex].get().getStartXY(),r=e.parent.m_resultSegments[this.segmentIndex].get().getEndXY(),o=new s.Point;t.queryStart(o),i?(o.setXY(n),e.parent.m_resultSegments[this.segmentIndex].get().setStart(o)):(o.setXY(r),e.parent.m_resultSegments[this.segmentIndex].get().setEnd(o)),t.queryEnd(o),i?(o.setXY(r),e.parent.m_resultSegments[this.segmentIndex].get().setEnd(o)):(o.setXY(n),e.parent.m_resultSegments[this.segmentIndex].get().setStart(o))}copyFromWhenOverlap(e,t,i){this.equalEdge=t,t.equalEdge=this,this.segmentIndex=e.parent.allocResultSegmentFromBuffer(e.parent.m_resultSegments[t.segmentIndex]),this.segmentParentage=t.segmentParentage,this.weight=t.weight,this.rank=t.rank,i?(this.start.copyFrom(t.start),this.end.copyFrom(t.end)):(this.start.copyFrom(t.end),this.end.copyFrom(t.start),e.parent.m_resultSegments[this.segmentIndex].get().reverse())}getEnd(){return this.end}getNextInChain(){return this.end.nextInChain}getPrevInChain(){return this.start.prevInChain}};class le{constructor(){this.hash=0,this.pt=new r.Point2D,this.prevInChain=null,this.nextInChain=null,this.prevInHash=null,this.nextInHash=null,this.prevEqual=null,this.nextEqual=null,this.weight=0,this.rank=0,this.bBigMove=!1,this.bIsBreak=!1}copyFrom(e){this.pt.assign(e.pt),this.weight=e.weight,this.rank=e.rank,this.bBigMove=e.bBigMove,this.bIsBreak=e.bIsBreak}nextNode(){return this.nextInChain?this.nextInChain.end:null}prevNode(){return this.prevInChain?this.prevInChain.start:null}equalListHead(){let e=this;for(;null!==e.prevEqual;e=e.prevEqual);return e}}function ce(e,t,i,n){return{edge1:e,edge2:t,recursion:i,bIsIntersecting:n}}class he{constructor(e){this.m_pairs=[],this.m_chainOrigin1=null,this.m_chainOrigin2=null,this.m_newNodes=[],this.m_hashTableOfEquals=[],this.m_hashTableOfEqualsSize=0,this.m_origin=new r.Point2D,this.m_cell=new r.Point2D,this.parent=e}addSegment(e,t,n,s,r,o,a,l,c,h,u){const m=this.newNode(this.parent.m_resultSegments[e].get().getStartXY(),n,s,c),d=this.newNode(this.parent.m_resultSegments[e].get().getEndXY(),r,o,h);this.newEdge(m,d,e,a,l,u),null===this.m_chainOrigin1?this.m_chainOrigin1=m:null===this.m_chainOrigin2?this.m_chainOrigin2=m:i.geometryReleaseAssert(0)}intersectCurvesHelper(e,t,s,o,a){const l=this.getSegment(e).get(),c=this.getSegment(t).get();if(l.isDegenerate(0)||c.isDegenerate(0))return 0;const h=this.tryOverlapIntersectCurves(e,t,s,o);if(0!==h)return h;const u=r.sqr(.01*s);let m=!1,d=this.processSharpCorners(l,c,s,a>4);const p=d>0;if(!p){const e=!0;if(!(o||5&n.isIntersectingEx(!0,!1,l,c,s,e)))return 0;d=n.intersect(!0,l,c,null,this.parent.m_param1,this.parent.m_param2,s)}0===d&&i.throwInternalErrorException("");const g=l.getGeometryType(),_=c.getGeometryType(),f=r.makeObjectArray(r.Point2D,d),y=r.makeObjectArray(r.Point2D,d),x=r.makePrimitiveArray(d,Number.NaN),v=r.makePrimitiveArray(d,Number.NaN),P=r.makePrimitiveArray(d,Number.NaN),b=r.makePrimitiveArray(d,Number.NaN),E=r.makeStructArray(oe,d),S=r.makeStructArray(oe,d);let C=!1,w=!1;for(let i=0;i<d;i++){const n=this.parent.m_param1[i],o=this.parent.m_param2[i];let a=e.rank,h=e.weight,d=!0,T=!1;0===n?(a=e.start.rank,h=e.start.weight,T=e.start.bIsBreak):1===n?(a=e.end.rank,h=e.end.weight,T=e.end.bIsBreak):(C=!0,d=!1);let D=t.rank,I=t.weight,A=!1,M=!0;0===o?(D=t.start.rank,I=t.start.weight,A=t.start.bIsBreak):1===o?(D=t.end.rank,I=t.end.weight,A=t.end.bIsBreak):(w=!0,M=!1);let N=a,R=D;if(N===R&&(N*=se.c_maxGeometryTypeToRankDelta,R*=se.c_maxGeometryTypeToRankDelta,N+=ue(g,l,!1),R+=ue(_,c,!1)),d&&M&&R===N){const e=l.getCoord2D(n),t=c.getCoord2D(o);e.equals(t)&&(R=N-1)}let O=1,G=0,k=1,V=0;const F=new r.Point2D,L=new r.Point2D,q=l.getCoord2D(n),H=c.getCoord2D(o);if(p&&r.Point2D.distance(q,H)>s)F.setCoordsPoint2D(q),L.setCoordsPoint2D(H),O=h,k=I,G=a,V=D,E[i].bBigMove=!1,S[i].bBigMove=!1,T=!0,A=!0;else if(N===R){k=O=h+I,V=G=a;const e=I/O;r.lerpPoint2D(q,H,e,F),L.setCoordsPoint2D(F);const t=r.Point2D.sqrDistance(F,q),n=r.Point2D.sqrDistance(F,H);E[i].bBigMove=t>u,S[i].bBigMove=n>u,C||q.equals(F)||(C=!0),w||H.equals(L)||(w=!0)}else if(N>R){F.setCoordsPoint2D(q),L.setCoordsPoint2D(F),k=O=h,V=G=a;const e=r.Point2D.sqrDistance(F,H);E[i].bBigMove=!1,S[i].bBigMove=e>u,w||H.equals(L)||(w=!0)}else{L.setCoordsPoint2D(H),F.setCoordsPoint2D(L),k=O=I,V=G=D;const e=r.Point2D.sqrDistance(F,q);E[i].bBigMove=e>u,S[i].bBigMove=!1,C||q.equals(F)||(C=!0)}f[i].assign(F),y[i].assign(L),x[i]=O,v[i]=k,P[i]=G,b[i]=V,E[i].bIsBreak=T||A,S[i].bIsBreak=T||A,m||=E[i].bBigMove||S[i].bBigMove,i>0&&(n!==this.parent.m_param1[i-1]&&o!==this.parent.m_param2[i-1]||(P[i]<=P[i-1]?(f[i].assign(y[i-1]),x[i]=v[i-1],P[i]=b[i-1],y[i].assign(y[i-1]),v[i]=v[i-1],b[i]=b[i-1],E[i].bBigMove||=E[i-1].bBigMove,S[i].bBigMove||=S[i-1].bBigMove,E[i].bIsBreak||=E[i-1].bIsBreak,S[i].bIsBreak||=S[i-1].bIsBreak):(f[i-1].assign(f[i]),x[i-1]=x[i],P[i-1]=P[i],y[i-1].assign(y[i]),v[i-1]=v[i],b[i-1]=b[i],E[i-1].bBigMove||=E[i].bBigMove,S[i-1].bBigMove||=S[i].bBigMove,E[i-1].bIsBreak||=E[i].bIsBreak,S[i-1].bIsBreak||=S[i].bIsBreak)))}if(!(C||w||2!==d||g===i.GeometryType.enumLine&&_===i.GeometryType.enumLine)){if(this.processDoublyConnectedEdges(e,t,a+1,s))return this.parent.m_changed1=!0,this.parent.m_changed2=!0,2;i.geometryReleaseAssert(0)}this.parent.m_changed1||=C,this.parent.m_changed2||=w;let T=e,D=e.end.weight,I=e.end.rank,A=e.end.bBigMove,M=e.end.bIsBreak,N=0,R=-1;for(let t=0;t<=d;t++){const i=t<d?this.parent.m_param1[t]:1;if(i!==N){const n=this.parent.allocResultSegment(),o=this.parent.m_resultSegments[n];let a,c,h,u;l.queryCut(N,i,o,!1),o.get().snapControlPoints(s*s);let m=!1,p=!1,g=!1,_=!1;const y=new r.Point2D,v=new r.Point2D;-1!==R?(c=P[R],a=x[R],g=E[R].bBigMove,m=E[R].bIsBreak,y.assign(f[R])):(a=e.start.weight,c=e.start.rank,g=e.start.bBigMove,m=e.start.bIsBreak,y.assign(o.get().getStartXY())),t<d?(u=P[t],h=x[t],_=E[t].bBigMove,p=E[t].bIsBreak,v.assign(f[t])):(h=D,u=I,_=A,p=M,v.assign(o.get().getEndXY()));let b=T;i<1&&(this.splitEdgeInPlace(T),b=T.getNextInChain()),this.updateSegmentOnly(T,n),0===T.start.hash||T.start.pt.equals(y)||(this.m_newNodes.push(T.start),this.removeNodeFromHash(T.start),T.start.hash=0),0===T.end.hash||T.end.pt.equals(v)||(this.m_newNodes.push(T.end),this.removeNodeFromHash(T.end),T.end.hash=0),T.start.pt.assign(y),T.end.pt.assign(v),T.start.bBigMove||=g,T.end.bBigMove||=_,T.start.bIsBreak||=m,T.end.bIsBreak||=p,T.start.weight=a,T.start.rank=c,T.end.weight=h,T.end.rank=u,T=b,N=i,R=t}else-1===R&&(R=t)}const O=T.getNextInChain(),G=[];G.length=d;for(let e=0;e<d;e++)G[e]=e;d>2?(G.sort(((e,t)=>r.standardNumericCompare(this.parent.m_param2[e],this.parent.m_param2[t]))),this.parent.m_param2.sort(r.standardNumericCompare)):2===d&&this.parent.m_param2[0]>this.parent.m_param2[1]&&(this.parent.m_param2[1]=r.swap(this.parent.m_param2[0],this.parent.m_param2[0]=this.parent.m_param2[1]),G[1]=r.swap(G[0],G[0]=G[1])),T=t,D=t.end.weight,I=t.end.rank,A=t.end.bBigMove,M=t.end.bIsBreak,N=0,R=-1;for(let e=0;e<=d;e++){const i=e<d?this.parent.m_param2[e]:1;if(i!==N){const n=this.parent.allocResultSegment(),o=this.parent.m_resultSegments[n];let a,l,h,u;c.queryCut(N,i,o,!1),o.get().snapControlPoints(s*s);const m=new r.Point2D,p=new r.Point2D;let g=!1,_=!1,f=!1,x=!1;if(-1!==R){const e=G[R];a=v[e],l=b[e],m.assign(y[e]),f=S[e].bBigMove,g=S[e].bIsBreak}else a=t.start.weight,l=t.start.rank,f=t.start.bBigMove,g=t.start.bIsBreak,m.assign(o.get().getStartXY());if(e!==d){const t=G[e];h=v[t],u=b[t],p.assign(y[t]),x=S[t].bBigMove,_=S[t].bIsBreak}else h=D,u=I,x=A,_=M,p.assign(o.get().getEndXY());let P=T;i<1&&(this.splitEdgeInPlace(T),P=T.getNextInChain()),this.updateSegmentOnly(T,n),0===T.start.hash||T.start.pt.equals(m)||(this.m_newNodes.push(T.start),this.removeNodeFromHash(T.start),T.start.hash=0),0===T.end.hash||T.end.pt.equals(p)||(this.m_newNodes.push(T.end),this.removeNodeFromHash(T.end),T.end.hash=0),T.start.pt.assign(m),T.end.pt.assign(p),T.start.bBigMove||=f,T.end.bBigMove||=x,T.start.bIsBreak||=g,T.end.bIsBreak||=_,T.start.weight=a,T.start.rank=l,T.end.weight=h,T.end.rank=u,T=P,N=i,R=e}else-1===R&&(R=e)}const k=T.getNextInChain();return this.postProcessResultPartsForCurves(e,O,t,k,a+1),m?3:2}intersectCurves(e,n){2!==this.parent.m_inputSegments.length&&i.throwInternalErrorException(""),this.parent.m_changed1=!1,this.parent.m_changed2=!1,this.parent.m_tolerance=e,this.m_hashTableOfEqualsSize=0,this.m_hashTableOfEquals=r.makeNullArray(16);const s=t.Envelope2D.constructEmpty();for(let e=0;e<2;e++){const i=this.parent.allocResultSegmentFromSegment(this.parent.m_inputSegments[this.parent.m_inputParts[e].segmentIndex]),n=t.Envelope2D.constructEmpty();this.parent.m_inputSegments[this.parent.m_inputParts[e].segmentIndex].queryLooseEnvelope(n),s.mergeEnvelope2D(n);const r=this.parent.m_inputParts[e];this.addSegment(i,0,r.weightStart,r.rankStart,r.weightEnd,r.rankEnd,r.weightInterior,r.rankInterior,r.u.bBreakStart,r.u.bBreakEnd,r.segmentParentage)}s.inflateCoords(100*e,100*e),this.m_origin.assign(s.getLowerLeft()),this.m_cell.setCoords(2*e,2*e),this.m_pairs.push(ce(this.m_chainOrigin1.nextInChain,this.m_chainOrigin2.nextInChain,0,n));let o=0,a=!0;for(;this.m_pairs.length;){const t=this.m_pairs.at(-1);this.m_pairs.pop(),i.geometryReleaseAssert(t.recursion>=0),i.geometryReleaseAssert(t.recursion<=256),this.clusterNodes(e);const n=this.intersectCurvesHelper(t.edge1,t.edge2,e,t.bIsIntersecting,t.recursion);a&&(a=!1,o=n)}for(let e=0;e<2;e++){const t=0===e?this.parent.m_resultParts1:this.parent.m_resultParts2;for(let i=(0===e?this.m_chainOrigin1:this.m_chainOrigin2).nextInChain;null!=i;i=i.getNextInChain())t.push(this.parent.newIntersectionPart_(i.segmentIndex,i.start.weight,i.start.rank,i.end.weight,i.end.rank,i.weight,i.rank,i.start.bIsBreak,i.end.bIsBreak,i.segmentParentage)),t.at(-1).u.bBigMoveStart=i.start.bBigMove,t.at(-1).u.bBigMoveEnd=i.end.bBigMove}return o}tryOverlapIntersectCurves(e,t,s,o){const a=this.parent.m_resultSegments[e.segmentIndex].get(),l=this.parent.m_resultSegments[t.segmentIndex].get(),c=a.getStartXY().equals(l.getStartXY())&&a.getEndXY().equals(l.getEndXY()),h=a.getStartXY().equals(l.getEndXY())&&a.getEndXY().equals(l.getStartXY());if(!c&&!h)return 0;const u=n.isExactOverlap2d(a,l,!0);if(0!==u&&n.isIdenticalType(a,l)&&e.segmentParentage===t.segmentParentage){let e=!1;if(u>0)e=a.equals(l);else{i.geometryReleaseAssert(-1===u);const t=new n.SegmentBuffer({segment:l});t.get().reverse(),e=a.equals(t.get())}if(e)return 1}const m=s*se.c_smallToleranceFactor;let d=!1;if(0===u){const e=[.5,.25,.75,.125,.375,.625,.875,.5625,.3125];for(let t=0,i=e.length;t<i;++t){const i=e[t],n=new r.Point2D;a.queryCoord2D(i,n);const o=l.getClosestCoordinate(n,!1),c=new r.Point2D;l.queryCoord2D(o,c);const h=r.Point2D.distance(n,c);if(h>s)return 0;d||=h>m}for(let t=0,i=e.length;t<i;++t){const i=e[t],n=new r.Point2D;l.queryCoord2D(i,n);const o=a.getClosestCoordinate(n,!1),c=new r.Point2D;a.queryCoord2D(o,c);const h=r.Point2D.distance(n,c);if(h>s)return 0;d||=h>m}}let p=e.rank,g=t.rank;return p===g&&(p*=se.c_maxGeometryTypeToRankDelta,g*=se.c_maxGeometryTypeToRankDelta,p+=ue(a.getGeometryType(),a,!0),g+=ue(l.getGeometryType(),l,!0)),p>g?(t.copyFromWhenOverlap(this,e,c),t.transferAttributes(this,a,c)):g>p?(e.copyFromWhenOverlap(this,t,c),e.transferAttributes(this,l,c)):e.segmentParentage<=t.segmentParentage?(e.weight=e.weight+t.weight,t.copyFromWhenOverlap(this,e,c),t.transferAttributes(this,a,c)):(t.weight=e.weight+t.weight,e.copyFromWhenOverlap(this,t,c),e.transferAttributes(this,l,c)),d?3:2}postProcessResultPartsForCurves(e,t,n,s,o){o===r.shortMax()&&i.throwInternalErrorException("curve_helper");for(let i=e;i!==t;i=i.getNextInChain())this.updateSegmentToNodes(i);for(let e=n;e!==s;e=e.getNextInChain())this.updateSegmentToNodes(e);for(let a=e;a!==t;a=a.getNextInChain()){const e=a.end.pt.sub(a.start.pt);for(let t=n;t!==s;t=t.getNextInChain()){let n=0;if(a.start.pt.equals(t.start.pt)&&a.end.pt.equals(t.end.pt)?n=1:a.start.pt.equals(t.end.pt)&&a.end.pt.equals(t.start.pt)&&(n=-1),!n){let n=a.start.pt.equals(t.start.pt)?1:0;if(n||(n=a.end.pt.equals(t.end.pt)?2:0,n||(n=a.end.pt.equals(t.start.pt)?3:0,n||(n=a.start.pt.equals(t.end.pt)?4:0))),n){const s=t.end.pt.sub(t.start.pt),r=e.dotProduct(s);let l;switch(n){case 1:case 2:l=r>0;break;case 3:case 4:l=r<0;break;default:i.throwInternalErrorException("post_process_result_parts_for_curves_")}l&&this.m_pairs.push(ce(a,t,o,!1))}continue}const s=this.parent.m_resultSegments[a.segmentIndex],l=this.parent.m_resultSegments[t.segmentIndex],c=[.5,.25,.75];for(let e=0,t=c.length;e<t;++e){const t=c[e],i=new r.Point2D;s.get().queryCoord2D(t,i);const o=l.get().getClosestCoordinate(i,!1),a=new r.Point2D;if(l.get().queryCoord2D(o,a),r.Point2D.distance(i,a)>this.parent.m_tolerance){n=0;break}}if(!n){this.m_pairs.push(ce(a,t,o,!1));continue}for(let e=0,t=c.length;e<t;++e){const t=c[e],i=new r.Point2D;l.get().queryCoord2D(t,i);const o=s.get().getClosestCoordinate(i,!1),a=new r.Point2D;if(s.get().queryCoord2D(o,a),r.Point2D.distance(i,a)>this.parent.m_tolerance){n=0;break}}if(!n){this.m_pairs.push(ce(a,t,o,!1));continue}a.equalEdge=t,t.equalEdge=a;let h=a.rank,u=t.rank;h===u&&(h*=se.c_maxGeometryTypeToRankDelta,u*=se.c_maxGeometryTypeToRankDelta,h+=ue(s.get().getGeometryType(),s.get(),!0),u+=ue(l.get().getGeometryType(),l.get(),!0)),h>u||h===u&&a.segmentParentage<=t.segmentParentage?(s.copyTo(l,!1),t.segmentParentage=a.segmentParentage,-1===n&&l.get().reverse()):(l.copyTo(s,!1),a.segmentParentage=t.segmentParentage,-1===n&&s.get().reverse());break}}this.updateAttachedEdgesAfterNodeChange(e.start),t&&this.updateAttachedEdgesAfterNodeChange(t.start),this.updateAttachedEdgesAfterNodeChange(n.start),s&&this.updateAttachedEdgesAfterNodeChange(s.start)}processDoublyConnectedEdges(e,t,s,o){s===r.shortMax()&&i.throwInternalErrorException("curve_helper");const a=this.getSegment(e).get(),l=this.getSegment(t).get(),c=a.getStartXY().equals(l.getStartXY())&&a.getEndXY().equals(l.getEndXY())?1:a.getEndXY().equals(l.getStartXY())&&a.getStartXY().equals(l.getEndXY())?-1:0;if(0!==c){const i=new n.SegmentBuffer;a.queryCut(0,.5,i),i.get().snapControlPoints(o*o);const r=new n.SegmentBuffer;a.queryCut(.5,1,r),r.get().snapControlPoints(o*o),this.splitEdgeInPlace(e),e.end.pt=i.get().getEndXY(),e.segmentIndex=this.parent.allocResultSegmentFromBuffer(i),e.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(r);let h=l.getClosestCoordinate(e.end.pt,!1);return Math.abs(h-.5)>.2&&(h=.5),l.queryCut(0,h,i),i.get().snapControlPoints(o*o),l.queryCut(h,1,r),r.get().snapControlPoints(o*o),this.splitEdgeInPlace(t),t.end.pt=i.get().getEndXY(),t.segmentIndex=this.parent.allocResultSegmentFromBuffer(i),t.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(r),c>0?(this.m_pairs.push(ce(e,t,s,!1)),this.m_pairs.push(ce(e.getNextInChain(),t.getNextInChain(),s,!1))):(this.m_pairs.push(ce(e,t.getNextInChain(),s,!1)),this.m_pairs.push(ce(e.getNextInChain(),t,s,!1))),!0}return!1}newNode(e,t,i,n){const s=new le;return this.m_newNodes.push(s),s.pt=e,s.rank=i,s.weight=t,s.bIsBreak=n,s}newEdge(e,t,i,n,s,r){const o=new ae;return o.start=e,o.end=t,e.nextInChain=o,t.prevInChain=o,o.segmentIndex=i,o.segmentParentage=r,o.rank=s,o.weight=n,o}splitEdgeInPlace(e){e.segmentIndex=-1;const t=new ae,i=new le;this.m_newNodes.push(i),i.pt.setNAN(),i.nextInChain=t,i.prevInChain=e,i.prevInHash=null,i.nextInHash=null,i.prevEqual=null,i.nextEqual=null,i.weight=e.weight,i.rank=e.rank,i.bIsBreak=!1,i.bBigMove=!1,t.start=i,t.segmentIndex=-1,t.end=e.end,t.end.prevInChain=t,t.rank=e.rank,t.weight=e.weight,t.segmentParentage=e.segmentParentage,e.end=i,e.equalEdge&&(e.equalEdge.equalEdge=null),e.equalEdge=null}updateSegmentOnly(e,t){e.segmentIndex=t}updateAttachedEdgesAfterNodeChange(e){for(let t=e.equalListHead();null!==t;t=t.nextEqual)this.updateAttachedEdgesAfterNodeChangeImpl(t)}updateAttachedEdgesAfterNodeChangeImpl(e){const t=e.prevInChain;if(t&&t.hasSegment()){const i=this.getSegment(t).get();e.pt.equals(i.getEndXY())||(i.setCoordsForIntersector(t.start.pt,t.end.pt,!1),i.ensureXYMonotone())}const i=e.nextInChain;if(i&&i.hasSegment()){const t=this.getSegment(i).get();e.pt.equals(t.getStartXY())||(t.setCoordsForIntersector(i.start.pt,i.end.pt,!1),t.ensureXYMonotone())}}updateSegmentToNodes(e){const t=this.getSegment(e).get();e.start.pt.equals(t.getStartXY())&&e.end.pt.equals(t.getEndXY())||(t.setCoordsForIntersector(e.start.pt,e.end.pt,!1),t.ensureXYMonotone()),this.updateAttachedEdgesAfterNodeChange(e.start),this.updateAttachedEdgesAfterNodeChange(e.end)}getSegment(e){return this.parent.m_resultSegments[e.segmentIndex]}clusterNodes(e){let t=!1;const i=[],n=[],s=[];for(let e=0,t=this.m_newNodes.length;e<t;e++){const i=this.m_newNodes[e];if(null===i)continue;let n=i;for(let s=e+1;s<t;s++){const e=this.m_newNodes[s];null!==e&&i.pt.equals(e.pt)&&(n.nextInHash=e,e.prevInHash=n,n=e,this.m_newNodes[s]=null)}}for(let o=0,a=this.m_newNodes.length;o<a;o++){const a=this.m_newNodes[o];if(null==a)continue;for(a.hash=this.calculateHash(a.pt);;){const o=r.makeNullArray(4),l=this.hashTableBinsToCheck(a,o);for(let t=0;t<l;t++)if(null!==o[t])for(let l=o[t];null!==l;){const t=l.nextInHash;r.Point2D.distance(a.pt,l.pt)<=e&&(i.push(l),this.removeNodeFromHash(l),l.hash=0,s.push(l),n.push(l)),l=t}let c=!1;for(const e of i)if(!a.pt.equals(e.pt)){const i=ee(a.pt,e.pt,a.weight,a.rank,e.weight,e.rank);a.pt.assign(i.pt),a.weight=i.weight,a.rank=i.rank,c=!0,t=!0}if(i.length=0,!c)break;a.hash=this.calculateHash(a.pt)}s.push(a),n.push(a);for(let e=a.nextInHash;null!==e;){e.prevInHash=null;const t=e.nextInHash;e.nextInHash=null,s.push(e),n.push(e),e=t}const l=a.hash;let c=null,h=null;for(const e of n)a!==e&&(e.hash=l,e.pt.assign(a.pt),e.rank=a.rank,e.weight=a.weight),e.prevInHash=c,c&&(c.nextInHash=e),e.prevEqual=h,e.nextEqual=null,h&&(h.nextEqual=e),h=e,c=e;const u=l%this.m_hashTableOfEquals.length;c.nextInHash=this.m_hashTableOfEquals[u],null!==this.m_hashTableOfEquals[u]&&(this.m_hashTableOfEquals[u].prevInHash=c),this.m_hashTableOfEquals[u]=n[0],this.m_hashTableOfEqualsSize+=n.length,n.length=0,this.rehashIfNeeded()}if(this.m_newNodes.length=0,t)for(const e of s)this.updateAttachedEdgesAfterNodeChange(e)}rehashIfNeeded(){if(2*this.m_hashTableOfEqualsSize>this.m_hashTableOfEquals.length){const e=this.m_hashTableOfEquals;this.m_hashTableOfEquals=r.makeNullArray(2*e.length),this.m_hashTableOfEqualsSize=0;for(const t of e){let e=t;for(;e;){const t=e.nextInHash;e.nextInHash=null,e.prevInHash=null,this.addNodeToHashImpl(e),e=t}}}}addNodeToHashImpl(e){const t=e.hash%this.m_hashTableOfEquals.length,i=this.m_hashTableOfEquals[t];e.nextInHash=i,null!==i&&(i.prevInHash=e),this.m_hashTableOfEquals[t]=e,this.m_hashTableOfEqualsSize++}removeNodeFromHash(e){const t=e.hash%this.m_hashTableOfEquals.length,i=e.prevInHash,n=e.nextInHash;i?i.nextInHash=n:this.m_hashTableOfEquals[t]=n,n&&(n.prevInHash=i),this.m_hashTableOfEqualsSize--,e.prevInHash=null,e.nextInHash=null}hashTableBinsToCheck(e,t){const i=(e.pt.x-this.m_origin.x)/this.m_cell.x,n=(e.pt.y-this.m_origin.y)/this.m_cell.y,s=r.intMax()-1,o=Math.round(r.snap(i,-2147483646,s)),a=Math.round(r.snap(n,-2147483646,s));let l=o|a<<32;l=r.hashInt32(l),t[0]=this.m_hashTableOfEquals[l%this.m_hashTableOfEquals.length];let c=o+1|a<<32;c=r.hashInt32(c);let h=1;t[1]=this.m_hashTableOfEquals[c%this.m_hashTableOfEquals.length],t[1]!==t[0]&&(h=2);let u=o+1|a+1<<32;u=r.hashInt32(u),t[h]=this.m_hashTableOfEquals[u%this.m_hashTableOfEquals.length];for(let e=0;e<h;e++)if(t[h]===t[e]){h--;break}h++;let m=o|a+1<<32;m=r.hashInt32(m),t[h]=this.m_hashTableOfEquals[m%this.m_hashTableOfEquals.length];for(let e=0;e<h;e++)if(t[h]===t[e]){h--;break}return h++,h}calculateHash(e){const t=(e.x-this.m_origin.x)/this.m_cell.x,i=(e.y-this.m_origin.y)/this.m_cell.y,n=r.intMax()-1;let s=Math.round(r.snap(t,-2147483646,n))|Math.round(r.snap(i,-2147483646,n))<<32;return s=r.hashInt32(s),0===s&&(s=1),s}processSharpCorners(e,t,i,s){if(this.parent.m_param1.length=0,this.parent.m_param2.length=0,e.getStartXY().equals(t.getStartXY())){const r=[0,0],o=[0,0],a=n.checkSharpCorner(e,t,0,0,i,2,r,o,s);if(a){this.parent.m_param1.push(0),this.parent.m_param2.push(0);for(let e=0;e<a;e++)this.parent.m_param1.push(r[e]),this.parent.m_param2.push(o[e]);return a+1}}if(e.getEndXY().equals(t.getEndXY())){const r=[0,0],o=[0,0],a=n.checkSharpCorner(e,t,1,1,i,2,r,o,s);if(a){for(let e=0;e<a;e++)this.parent.m_param1.push(r[e]),this.parent.m_param2.push(o[e]);return this.parent.m_param1.push(1),this.parent.m_param2.push(1),a+1}}if(e.getStartXY().equals(t.getEndXY())){const r=[0,0],o=[0,0],a=n.checkSharpCorner(e,t,0,1,i,2,r,o,s);if(a){this.parent.m_param1.push(0),this.parent.m_param2.push(1);for(let e=0;e<a;e++)this.parent.m_param1.push(r[e]),this.parent.m_param2.push(o[e]);return a+1}}if(e.getEndXY().equals(t.getStartXY())){const r=[0,0],o=[0,0],a=n.checkSharpCorner(e,t,1,0,i,2,r,o,s);if(a){for(let e=0;e<a;e++)this.parent.m_param1.push(r[e]),this.parent.m_param2.push(o[e]);return this.parent.m_param1.push(1),this.parent.m_param2.push(0),a+1}}return 0}}function ue(e,t,n){let s=0;switch(e){case i.GeometryType.enumLine:s=0;break;case i.GeometryType.enumBezier:s=2;break;case i.GeometryType.enumRationalBezier2:s=3;break;case i.GeometryType.enumBezier2:s=1;break;case i.GeometryType.enumEllipticArc:s=0===t.projectionBehavior()?5:4;break;default:i.throwInternalErrorException("")}return n?5-s:s}class me extends Z{constructor(e){super(e.m_shape,e.m_tolerance,!1),this.m_parent=e}compare(e,t,i){if(this.m_bIntersectionDetected)return-1;const n=e.getElement(i),s=this.m_parent.getEdgeOriginVertices(t),r=this.m_parent.m_edgeVertices.getFirstElement(s),o=this.m_parent.getEdgeOriginVertices(n),a=this.m_parent.m_edgeVertices.getFirstElement(o);return this.m_currentNode=i,this.compareSegments(t,r,n,a)}}class de extends Q{constructor(e){super(e.m_shape,e.m_tolerance),this.m_parent=e}compare(e,t){if(this.m_bIntersectionDetected)return-1;const i=e.getElement(t),n=this.m_parent.getEdgeOriginVertices(i),s=this.m_parent.m_edgeVertices.getFirstElement(n);return this.m_currentNode=t,this.compareVertex(e,t,s)}}class pe extends s.Comparator{constructor(e){super(),this.pt1=r.Point2D.getNAN(),this.pt2=r.Point2D.getNAN(),this.m_shape=e}compare(e,t,i){this.m_shape.queryXY(t,this.pt1);const n=e.getElement(i);return this.m_shape.queryXY(n,this.pt2),this.pt1.compare(this.pt2)}}class ge{constructor(e){this.m_point=r.Point2D.getNAN(),this.m_pt=r.Point2D.getNAN(),this.m_shape=e}setPoint(e){this.m_point.setCoordsPoint2D(e)}compare(e,t){const i=e.getElement(t);return this.m_shape.queryXY(i,this.m_pt),this.m_point.compare(this.m_pt)}}class _e{constructor(e,t){this.m_shape=null,this.m_progressTracker=null,this.m_edges=new s.StridedIndexTypeCollection(8),this.m_clusters=new s.StridedIndexTypeCollection(5),this.m_clusterVertices=new j(!1),this.m_edgeVertices=new j(!1),this.m_helperPoint=new s.Point,this.m_eventQ=new s.Treap,this.m_sweepStructure=new s.Treap,this.m_bComplications=!1,this.m_sweepComparator=null,this.m_tempEdgeBuffer=[],this.m_modifiedClusters=[],this.m_edgesToInsertInSweepStructure=[],this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1,this.m_progressCounter=0,this.m_segmentIntersector=new se,this.m_segBuf1=new n.SegmentBuffer,this.m_segBuf2=new n.SegmentBuffer,this.m_sweepPoint=new r.Point2D(0,0),this.m_tolerance=0,this.m_toleranceSqr=0,this.m_sweepPointCluster=-1,this.m_vertexClusterIndex=-1,this.m_bCracked=!1,this.m_bSweepPointClusterWasModified=!1,this.m_progressTracker=e,this.m_bTrackChanges=t}hadComplications(){return this.m_bComplications}sweep(e,t){const i=new a.Transformation2D;i.setSwapCoordinates(),e.applyTransformation(i),this.setEditShape_(e),this.m_bCracked=!1,this.m_tolerance=t,this.m_toleranceSqr=t*t;let n=this.sweepImpl_();return e.applyTransformation(i),n||(this.fillEventQueuePass2(),n=this.sweepImpl_()||n),this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_shape=null,this.m_bCracked}sweepVertical(e,t){this.setEditShape_(e),this.m_bCracked=!1,this.m_tolerance=t,this.m_toleranceSqr=t*t,this.m_bComplications=!1;let i=this.sweepImpl_();if(!this.m_bComplications){const s=e.filterClosePoints(t,!0,!1,this.m_bTrackChanges,n.nullHandle);this.m_bComplications=1===s,i||=1===s}return-1!==this.m_vertexClusterIndex&&(this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_vertexClusterIndex=-1),this.m_shape=null,i}getEdgeCluster(e,t){return this.m_edges.getField(e,0+t)}setEdgeCluster_(e,t,i){this.m_edges.setField(e,0+t,i)}getEdgeOriginVertices(e){return this.m_edges.getField(e,2)}setEdgeOriginVertices_(e,t){this.m_edges.setField(e,2,t)}getNextEdgeEx(e,t){return this.m_edges.getField(e,3+t)}setNextEdgeEx_(e,t,i){this.m_edges.setField(e,3+t,i)}getEdgeSweepNode(e){return this.m_edges.getField(e,7)}setEdgeSweepNode_(e,t){this.m_edges.setField(e,7,t)}getNextEdge(e,t){const i=this.getEdgeEnd(e,t);return this.m_edges.getField(e,3+i)}setNextEdge_(e,t,i){const n=this.getEdgeEnd(e,t);this.m_edges.setField(e,3+n,i)}getPrevEdge(e,t){const i=this.getEdgeEnd(e,t);return this.m_edges.getField(e,5+i)}setPrevEdge_(e,t,i){const n=this.getEdgeEnd(e,t);this.m_edges.setField(e,5+n,i)}getClusterVertices(e){return this.m_clusters.getField(e,0)}setClusterVertices_(e,t){this.m_clusters.setField(e,0,t)}getClusterSweepEdgeList(e){return this.m_clusters.getField(e,2)}setClusterSweepEdgeList_(e,t){this.m_clusters.setField(e,2,t)}getClusterFirstEdge(e){return this.m_clusters.getField(e,1)}setClusterFirstEdge_(e,t){this.m_clusters.setField(e,1,t)}getClusterEventQNode(e){return this.m_clusters.getField(e,3)}setClusterEventQNode_(e,t){this.m_clusters.setField(e,3,t)}newCluster_(e){const t=this.m_clusters.newElement(),i=this.m_clusterVertices.createList();return this.setClusterVertices_(t,i),e!==n.nullHandle&&(this.m_clusterVertices.addElement(i,e),this.m_shape.setUserIndex(e,this.m_vertexClusterIndex,t)),t}deleteCluster_(e){this.m_clusters.deleteElement(e)}addVertexToCluster_(e,t){const i=this.getClusterVertices(e);this.m_clusterVertices.addElement(i,t),this.m_shape.setUserIndex(t,this.m_vertexClusterIndex,e)}newEdge_(e){const t=this.m_edges.newElement(),i=this.m_edgeVertices.createList();return this.setEdgeOriginVertices_(t,i),-1!==e&&this.m_edgeVertices.addElement(i,e),t}addVertexToEdge_(e,t){const i=this.getEdgeOriginVertices(e);this.m_edgeVertices.addElement(i,t)}deleteEdge_(e){this.m_edges.deleteElement(e);const t=this.m_edgesToInsertInSweepStructure.findIndex((t=>t===e));t>=0&&r.unorderedPop(this.m_edgesToInsertInSweepStructure,t)}addEdgeToCluster(e,t){-1===this.getEdgeCluster(e,0)?this.setEdgeCluster_(e,0,t):-1===this.getEdgeCluster(e,1)?this.setEdgeCluster_(e,1,t):i.throwInternalErrorException(""),this.addEdgeToClusterImpl_(e,t)}addEdgeToClusterImpl_(e,t){const i=this.getClusterFirstEdge(t);if(-1!==i){const n=this.getNextEdge(i,t);this.setPrevEdge_(n,t,e),this.setNextEdge_(e,t,n),this.setNextEdge_(i,t,e),this.setPrevEdge_(e,t,i)}else this.setPrevEdge_(e,t,e),this.setNextEdge_(e,t,e),this.setClusterFirstEdge_(t,e)}getEdgeEnd(e,t){return this.getEdgeCluster(e,0)===t?0:1}mergeClusters_(e,t){this.dbgCheckCluster_(e),this.dbgCheckCluster_(t);const i=this.getClusterEventQNode(t);-1!==i&&(this.m_eventQ.deleteNode(i),this.setClusterEventQNode_(t,-1));let n=this.getClusterFirstEdge(e),s=this.getClusterFirstEdge(t);if(-1!==s){let i=s,r=s,o=!1;do{this.dbgCheckEdge_(i),o=!1;const n=this.getEdgeEnd(i,t),a=this.getNextEdgeEx(i,n);if(this.getEdgeCluster(i,n+1&1)===e){this.disconnectEdge_(i);const e=this.getEdgeOriginVertices(i);if(this.m_edgeVertices.deleteList(e),this.deleteEdge_(i),i===a){s=-1;break}s===i&&(s=this.getClusterFirstEdge(t),r=a,o=!0)}i=a}while(i!==r||o);if(-1!==s){do{const n=this.getEdgeEnd(i,t),s=this.getNextEdgeEx(i,n);this.setEdgeCluster_(i,n,e),i=s}while(i!==r);if(n=this.getClusterFirstEdge(e),-1!==n){const t=this.getNextEdge(n,e),i=this.getNextEdge(s,e);t===n?(this.setClusterFirstEdge_(e,s),this.addEdgeToClusterImpl_(n,e),this.setClusterFirstEdge_(e,n)):i===s&&this.addEdgeToClusterImpl_(s,e),this.setNextEdge_(s,e,t),this.setPrevEdge_(t,e,s),this.setNextEdge_(n,e,i),this.setPrevEdge_(i,e,n)}else this.setClusterFirstEdge_(e,s)}}const r=this.getClusterVertices(e),o=this.getClusterVertices(t);for(let t=this.m_clusterVertices.getFirst(o);-1!==t;t=this.m_clusterVertices.getNext(t)){const i=this.m_clusterVertices.getElement(t);this.m_shape.setUserIndex(i,this.m_vertexClusterIndex,e)}this.m_clusterVertices.concatenateLists(r,o),this.deleteCluster_(t),this.dbgCheckCluster_(e)}mergeEdges_(e,t){this.dbgCheckEdge_(e),this.dbgCheckEdge_(t);const i=this.getEdgeCluster(e,0),n=this.getEdgeCluster(e,1),s=this.getEdgeCluster(t,0),r=this.getEdgeCluster(t,1),o=this.getEdgeOriginVertices(e),a=this.getEdgeOriginVertices(t);if(this.m_edgeVertices.concatenateLists(o,a),t===this.getClusterFirstEdge(i)&&this.setClusterFirstEdge_(i,e),t===this.getClusterFirstEdge(n)&&this.setClusterFirstEdge_(n,e),this.disconnectEdge_(t),this.deleteEdge_(t),!(i===s&&n===r||n===s&&i===r)){const e=this.getClusterXY(i),t=this.getClusterXY(s);e.isEqualPoint2D(t)?(i!==s&&this.mergeClusters_(i,s),n!==r&&this.mergeClusters_(n,r)):(n!==s&&this.mergeClusters_(n,s),i!==r&&this.mergeClusters_(i,r))}this.dbgCheckEdge_(e)}disconnectEdge_(e){const t=this.getEdgeCluster(e,0),i=this.getEdgeCluster(e,1);this.disconnectEdgeFromCluster_(e,t),this.disconnectEdgeFromCluster_(e,i)}disconnectEdgeFromCluster_(e,t){const i=this.getNextEdge(e,t),n=this.getPrevEdge(e,t),s=this.getClusterFirstEdge(t);i!==e?(this.setNextEdge_(n,t,i),this.setPrevEdge_(i,t,n),s===e&&this.setClusterFirstEdge_(t,i)):this.setClusterFirstEdge_(t,-1)}applyIntersectorToEditShape_(e,t,i){let n=this.m_edgeVertices.getFirst(e);const s=this.m_edgeVertices.getElement(n),r=this.getClusterFromVertex(s),o=this.m_shape.getNextVertex(s),a=this.getClusterFromVertex(o),l=this.m_shape.getXY(s),c=this.m_shape.getXY(o);let h=!1,u=!1;const m=t.getResultSegment(i,0).getStartXY(),d=t.getResultSegment(i,t.getResultSegmentCount(i)-1).getEndXY();l.equals(m)||(h=!0),c.equals(d)||(u=!0),this.m_shape.splitSegmentWithIntersector(s,t,i,!0,!0);const p=this.m_bTrackChanges&&t.getSegmentChanged(i);for(p&&this.m_shape.setGeometryModifiedWithVertex(s,!0),n=this.m_edgeVertices.getNext(n);-1!==n;n=this.m_edgeVertices.getNext(n)){const e=this.m_edgeVertices.getElement(n),s=this.getClusterFromVertex(e)===r;this.m_shape.splitSegmentWithIntersector(e,t,i,s,!0),p&&this.m_shape.setGeometryModifiedWithVertex(e,!0)}if(h&&this.updateClusterXY(!0,r,m,t.getResultSegmentStartPointWeight(i,0),t.getResultSegmentStartPointRank(i,0)),u){const e=t.getResultSegmentCount(i)-1;this.updateClusterXY(!0,a,d,t.getResultSegmentEndPointWeight(i,e),t.getResultSegmentEndPointRank(i,e))}}createEdgesAndClustersFromSplitEdge_(e,t,i){this.dbgCheckNewEdgesArray_();const n=this.getEdgeOriginVertices(e),r=this.getEdgeCluster(e,0),o=this.getEdgeCluster(e,1);let a=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(a);const l=s.StridedIndexTypeCollection.impossibleIndex3();this.setEdgeSweepNode_(a,l),this.m_tempEdgeBuffer.push(a),this.addEdgeToCluster(a,r);const c=t.getResultSegmentCount(i);for(let e=1;e<c;e++){const e=this.newCluster_(-1);this.m_modifiedClusters.push(e),this.m_tempEdgeBuffer.push(e),this.addEdgeToCluster(a,e);const t=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(t),this.setEdgeSweepNode_(t,l),this.m_tempEdgeBuffer.push(t),this.addEdgeToCluster(t,e),a=t}this.addEdgeToCluster(a,o);for(let e=this.m_edgeVertices.getFirst(n);-1!==e;e=this.m_edgeVertices.getNext(e)){let t=this.m_edgeVertices.getElement(e);if(this.getClusterFromVertex(t)===r){let e=0;const i=this.m_tempEdgeBuffer.length;do{if(e>0){const i=this.m_tempEdgeBuffer[e-1];this.addVertexToCluster_(i,t)}const i=this.m_tempEdgeBuffer[e];e+=2,this.addVertexToEdge_(i,t),t=this.m_shape.getNextVertex(t)}while(e<i)}else{let e=this.m_tempEdgeBuffer.length-1;do{if(e<this.m_tempEdgeBuffer.length-2){const i=this.m_tempEdgeBuffer[e+1];this.addVertexToCluster_(i,t)}const i=this.m_tempEdgeBuffer[e];e-=2,this.addVertexToEdge_(i,t),t=this.m_shape.getNextVertex(t)}while(e>=0)}}this.m_tempEdgeBuffer.length=0,this.dbgCheckNewEdgesArray_()}getVertexFromClusterIndex(e){const t=this.getClusterVertices(e);return this.m_clusterVertices.getFirstElement(t)}getClusterFromVertex(e){return this.m_shape.getUserIndex(e,this.m_vertexClusterIndex)}processSplitHelper1_(e,t,i){const n=this.getEdgeCluster(t,0),r=this.getClusterXY(n),o=this.getEdgeCluster(t,1),a=this.getClusterXY(o),l=i.getResultSegmentCount(e);let c=i.getResultSegment(e,0);const h=c.getStartXY();if(r.isEqualPoint2D(h)||(this.m_bComplications||r.compare(this.m_sweepPoint)*h.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(n,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(n)),!this.m_bComplications&&l>1){const e=r.compare(a),t=c.getEndXY();(r.compare(t)!==e||t.compare(a)!==e||t.compare(this.m_sweepPoint)<0)&&(this.m_bComplications=!0)}c=i.getResultSegment(e,l-1);const u=c.getEndXY();a.isEqualPoint2D(u)||(this.m_bComplications||a.compare(this.m_sweepPoint)*u.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(o,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(o)),this.m_tempEdgeBuffer.push(t);for(let e=0,i=this.m_tempEdgeBuffer.length;e<i;e++){const i=this.m_tempEdgeBuffer[e],n=this.getEdgeSweepNode(i);s.StridedIndexTypeCollection.isValidElement(n)&&(this.m_sweepStructure.deleteNode(n),this.setEdgeSweepNode_(i,-1));const r=s.StridedIndexTypeCollection.impossibleIndex3();i!==t&&this.getEdgeSweepNode(i)!==r&&(this.m_edgesToInsertInSweepStructure.push(i),this.setEdgeSweepNode_(i,r))}this.m_tempEdgeBuffer.length=0}checkAndFixIntersection_(e,t){const i=this.m_sweepStructure.getElement(e);return this.m_sweepComparator.compare(this.m_sweepStructure,i,t),!!this.m_sweepComparator.intersectionDetected()&&(this.m_sweepComparator.clearIntersectionDetectedFlag(),this.fixIntersection_(e,t),!0)}fixIntersection_(e,t){this.m_bCracked=!0;const i=this.m_sweepStructure.getElement(e),n=this.m_sweepStructure.getElement(t);let s=null,r=null;const o=this.getEdgeOriginVertices(i),a=this.m_edgeVertices.getFirstElement(o),l=this.getEdgeOriginVertices(n),c=this.m_edgeVertices.getFirstElement(l);this.m_shape.querySegment(a,this.m_segBuf1,!1,!1),s=this.m_segBuf1.get();const h=this.m_shape.getNextVertex(a),u=this.m_shape.getWeight(a),m=this.m_shape.getSegmentParentageBreakVertex(a),d=this.m_shape.getWeight(h),p=this.m_shape.getSegmentParentageBreakVertex(h),g=this.m_shape.getSegmentWeight(a),_=this.m_shape.getRank(a),f=this.m_shape.getRank(h),y=this.m_shape.getSegmentRank(a),x=this.m_shape.getSegmentParentage(a);this.m_shape.querySegment(c,this.m_segBuf2,!1,!1),r=this.m_segBuf2.get();const v=this.m_shape.getNextVertex(c),P=this.m_shape.getWeight(c),b=this.m_shape.getSegmentParentageBreakVertex(c),E=this.m_shape.getWeight(v),S=this.m_shape.getSegmentParentageBreakVertex(v),C=this.m_shape.getSegmentWeight(c),w=this.m_shape.getRank(c),T=this.m_shape.getRank(v),D=this.m_shape.getSegmentRank(c),I=this.m_shape.getSegmentParentage(c);this.m_segmentIntersector.pushSegment(s,u,_,d,f,g,y,m,p,x),this.m_segmentIntersector.pushSegment(r,P,w,E,T,C,D,b,S,I),3===this.m_segmentIntersector.intersect2D(this.m_tolerance,!0)&&(this.m_bComplications=!0),this.splitEdge_(i,n,-1,this.m_segmentIntersector),this.m_segmentIntersector.clear()}fixIntersectionPointSegment_(e,t){this.m_bCracked=!0;const i=this.m_sweepStructure.getElement(t);let n=null;const s=this.getEdgeOriginVertices(i),r=this.m_edgeVertices.getFirstElement(s);this.m_shape.querySegment(r,this.m_segBuf1,!1,!1),n=this.m_segBuf1.get();const o=this.m_shape.getNextVertex(r),a=this.m_shape.getWeight(r),l=this.m_shape.getSegmentParentageBreakVertex(r),c=this.m_shape.getWeight(o),h=this.m_shape.getSegmentParentageBreakVertex(o),u=this.m_shape.getSegmentWeight(r),m=this.m_shape.getRank(r),d=this.m_shape.getRank(o),p=this.m_shape.getSegmentRank(r),g=this.m_shape.getSegmentParentage(r),_=this.getClusterFirstVertex(e);this.m_segmentIntersector.pushSegment(n,a,m,c,d,u,p,l,h,g),this.m_shape.queryPoint(_,this.m_helperPoint);const f=this.m_shape.getWeight(_),y=this.m_shape.getRank(_);this.m_segmentIntersector.intersect2DEx(this.m_tolerance,this.m_helperPoint,y,f,!0),this.splitEdge_(i,-1,e,this.m_segmentIntersector),this.m_segmentIntersector.clear()}insertNewEdges_(){if(0===this.m_edgesToInsertInSweepStructure.length)return!0;this.dbgCheckNewEdgesArray_();let e=!0,t=0;const i=this.m_edgesToInsertInSweepStructure.length,n=Math.max(2*i+200,this.m_sweepStructure.size()+200);for(;this.m_edgesToInsertInSweepStructure.length;){if(this.m_edgesToInsertInSweepStructure.length>Math.max(100,this.m_shape.getTotalPointCount())||t>n){this.m_edgesToInsertInSweepStructure.length=0,this.m_bComplications=!0,e=!1;break}const i=this.m_edgesToInsertInSweepStructure.at(-1);this.m_edgesToInsertInSweepStructure.pop(),this.setEdgeSweepNode_(i,-1);const r=this.isEdgeOnSweepLine_(i);s.StridedIndexTypeCollection.isValidElement(r)?(this.insertNewEdgeToSweepStructure_(i,r),t++):r!==s.StridedIndexTypeCollection.impossibleIndex2()&&(e=!1),this.m_bContinuingSegmentChainOptimization=!1}return e}insertNewEdgeToSweepStructure_(e,t){let i;if(this.m_bContinuingSegmentChainOptimization?(i=this.m_sweepStructure.addElementAtPosition(this.m_prevNeighbour,this.m_nextNeighbour,e,!0,!0),this.m_bContinuingSegmentChainOptimization=!1):i=this.m_sweepStructure.addUniqueElement(e),-1===i){const t=this.m_sweepStructure.getDuplicateElement(),i=this.m_sweepStructure.getElement(t);return this.mergeEdges_(i,e),!1}if(this.setEdgeSweepNode_(e,i),this.m_sweepComparator.intersectionDetected()){this.m_sweepComparator.clearIntersectionDetectedFlag();const e=this.m_sweepComparator.getLastComparedNode();return this.m_prevNeighbour===e&&(this.m_prevNeighbour=-1),this.m_nextNeighbour===e&&(this.m_nextNeighbour=-1),this.fixIntersection_(e,i),!0}return!1}isEdgeOnSweepLine_(e){const t=this.getEdgeCluster(e,0),i=this.getEdgeCluster(e,1),n=this.getClusterXY(t),o=this.getClusterXY(i);if(r.Point2D.sqrDistance(n,o)<=this.m_toleranceSqr)return this.m_bComplications=!0,-1;const a=n.compare(this.m_sweepPoint),l=o.compare(this.m_sweepPoint);return a<=0&&l>0?i:l<=0&&a>0?t:a>0&&l>0?s.StridedIndexTypeCollection.impossibleIndex2():-1}fillEventQueue(){const e=new s.AttributeStreamOfInt32(0),t=this.m_shape.queryVertexIteratorOnSelection();for(let i=t.next();i!==n.nullHandle;i=t.next())-1!==this.m_shape.getUserIndex(i,this.m_vertexClusterIndex)&&e.add(i);this.m_shape.sortVerticesSimpleByY(e,0,e.size()),this.progress_(!0),this.m_eventQ.clear(),this.m_eventQ.setCapacity(e.size()),this.m_eventQ.setComparator(new pe(this.m_shape));const i=r.Point2D.getNAN();i.setNAN();let o=-1;for(let t=0,n=e.size();t<n;t++){const n=e.read(t);if(this.m_shape.getXY(n).isEqualPoint2D(i)){const e=this.m_shape.getUserIndex(n,this.m_vertexClusterIndex);this.mergeClusters_(o,e);continue}o=this.getClusterFromVertex(n),this.m_shape.queryXY(n,i);const s=this.m_eventQ.addBiggestElement(n);this.setClusterEventQNode_(o,s)}}fillEventQueuePass2(){const e=new s.AttributeStreamOfInt32(0);for(let t=this.m_eventQ.getFirst();-1!==t;t=this.m_eventQ.getNext(t)){const i=this.m_eventQ.getElement(t);e.add(i)}this.m_eventQ.clear(),this.m_shape.sortVerticesSimpleByY(e,0,e.size()),this.progress_(!0);for(let t=0,i=e.size();t<i;t++){const i=e.read(t),n=this.getClusterFromVertex(i),s=this.m_eventQ.addBiggestElement(i);this.setClusterEventQNode_(n,s)}}getAffectedEdges(e,t){const i=this.getClusterFirstEdge(e);if(-1===i)return;let n=i;do{const i=this.getEdgeSweepNode(n);s.StridedIndexTypeCollection.isValidElement(i)&&t.push(n),n=this.getNextEdge(n,e)}while(n!==i)}updateClusterXY(e,t,i,n,s){const r=this.getClusterVertices(t);for(let t=this.m_clusterVertices.getFirst(r);-1!==t;t=this.m_clusterVertices.getNext(t)){const r=this.m_clusterVertices.getElement(t);this.m_shape.setXYMonotonicPoint2D(r,i),this.m_shape.setWeight(r,n),this.m_shape.setRank(r,s),e&&this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(r,!0),this.m_shape.setSegmentParentageBreakVertex(r,!0)}}splitEdge_(e,t,i,n){this.dbgCheckEdge_(e),-1!==t&&this.dbgCheckEdge_(t),this.disconnectEdge_(e),-1!==t&&this.disconnectEdge_(t),this.processSplitHelper1_(0,e,n),-1!==t&&this.processSplitHelper1_(1,t,n),-1!==i&&n.getResultPointChanged()&&this.m_modifiedClusters.push(i);for(let e=0,t=this.m_modifiedClusters.length;e<t;e++){const t=this.m_modifiedClusters[e],i=this.getClusterEventQNode(t);-1!==i&&(this.m_eventQ.deleteNode(i),this.setClusterEventQNode_(t,-1))}const s=this.getEdgeOriginVertices(e),r=-1!==t?this.getEdgeOriginVertices(t):-1;if(this.applyIntersectorToEditShape_(s,n,0),-1!==r)this.applyIntersectorToEditShape_(r,n,1);else{const e=n.getResultPoint().getXY();this.updateClusterXY(n.getResultPointChanged(),i,e,n.getResultPointWeight(),n.getResultPointRank())}this.createEdgesAndClustersFromSplitEdge_(e,n,0),-1!==t&&this.createEdgesAndClustersFromSplitEdge_(t,n,1),this.m_edgeVertices.deleteList(s),this.deleteEdge_(e),-1!==t&&(this.m_edgeVertices.deleteList(r),this.deleteEdge_(t));for(let e=0,t=this.m_modifiedClusters.length;e<t;e++){const t=this.m_modifiedClusters[e];t===this.m_sweepPointCluster&&(this.m_bSweepPointClusterWasModified=!0);let i=this.getClusterEventQNode(t);if(-1===i){const e=this.getClusterFirstVertex(t);if(i=this.m_eventQ.addUniqueElement(e),-1===i){const e=this.m_eventQ.getDuplicateElement(),i=this.m_eventQ.getElement(e),n=this.getClusterFromVertex(i);this.mergeClusters_(n,t)}else this.setClusterEventQNode_(t,i)}}this.m_modifiedClusters.length=0}getClusterXY(e){const t=this.getClusterFirstVertex(e);return this.m_shape.getXY(t)}getClusterFirstVertex(e){const t=this.getClusterVertices(e);return this.m_clusterVertices.getFirstElement(t)}dbgCheckEdge_(e){}dbgCheckCluster_(e){}dbgCheckNewEdgesArray_(){}dbgSaveSweepStructure_(e){}sweepImpl_(){this.progress_(!0),this.m_bSweepPointClusterWasModified=!1,this.m_sweepPointCluster=-1,null===this.m_sweepComparator&&(this.m_sweepStructure.disableBalancing(),this.m_sweepComparator=new me(this),this.m_sweepStructure.setComparator(this.m_sweepComparator));const e=[];let t=null,i=null;this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1;const n=s.StridedIndexTypeCollection.impossibleIndex2(),r=s.StridedIndexTypeCollection.impossibleIndex3();for(let s=this.m_eventQ.getFirst();-1!==s;){this.progress_(),this.dbgCheckSweepStructure_(),this.m_bContinuingSegmentChainOptimization=!1,this.m_prevNeighbour=-1,this.m_nextNeighbour=-1;const o=this.m_eventQ.getElement(s);this.m_sweepPointCluster=this.getClusterFromVertex(o),this.m_shape.queryXY(o,this.m_sweepPoint),this.m_sweepComparator.setSweepY(this.m_sweepPoint.y,this.m_sweepPoint.x);let a=!1;{const t=this.getClusterFirstEdge(this.m_sweepPointCluster);if(a=-1===t,!a){let i=t;do{const t=this.getEdgeSweepNode(i);-1===t?(this.m_edgesToInsertInSweepStructure.push(i),this.setEdgeSweepNode_(i,r)):t!==r&&e.push(t),i=this.getNextEdge(i,this.m_sweepPointCluster)}while(i!==t)}}if(!this.m_sweepStructure.isAutoBalancing()&&(this.m_sweepStructure.getMaxDepthEver()>4||this.m_edgesToInsertInSweepStructure.length>10)&&this.m_sweepStructure.enableBalancing(),e.length>0){this.m_bContinuingSegmentChainOptimization=1===e.length&&1===this.m_edgesToInsertInSweepStructure.length;for(let t=0,i=e.length;t<i;t++){const i=this.m_sweepStructure.getElement(e[t]);this.setEdgeSweepNode_(i,n)}let t=n,i=n;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(t===n){const e=this.m_sweepStructure.getPrev(r);if(-1!==e){const i=this.m_sweepStructure.getElement(e);this.getEdgeSweepNode(i)!==n&&(t=e)}else t=-1}if(i===n){const e=this.m_sweepStructure.getNext(r);if(-1!==e){const t=this.m_sweepStructure.getElement(e);this.getEdgeSweepNode(t)!==n&&(i=e)}else i=-1}if(t!==n&&i!==n)break}for(let t=0,i=e.length;t<i;t++){const i=e[t],n=this.m_sweepStructure.getElement(i);this.m_sweepStructure.deleteNode(i),this.setEdgeSweepNode_(n,-1)}e.length=0,this.m_prevNeighbour=t,this.m_nextNeighbour=i,-1!==t&&-1!==i?this.m_bContinuingSegmentChainOptimization||this.checkAndFixIntersection_(t,i):-1===t&&-1===i&&(this.m_bContinuingSegmentChainOptimization=!1)}else a&&(null===t&&(t=new de(this)),t.setPoint(this.m_sweepPoint),this.m_sweepStructure.searchUpperBound(t),t.intersectionDetected()&&(t.clearIntersectionDetectedFlag(),this.fixIntersectionPointSegment_(this.m_sweepPointCluster,t.getCurrentNode())));const l=this.m_bContinuingSegmentChainOptimization;!this.insertNewEdges_()&&l&&-1!==this.m_prevNeighbour&&-1!==this.m_nextNeighbour&&this.checkAndFixIntersection_(this.m_prevNeighbour,this.m_nextNeighbour),this.m_bSweepPointClusterWasModified?(this.m_bSweepPointClusterWasModified=!1,null===i&&(i=new ge(this.m_shape)),i.setPoint(this.m_sweepPoint),s=this.m_eventQ.searchUpperBound(i)):s=this.m_eventQ.getNext(s)}return this.m_bCracked}setEditShape_(e){this.m_shape=e,this.m_vertexClusterIndex=this.m_shape.createUserIndex(),this.m_edges.setCapacity(e.getSelectedCount()+32),this.m_clusters.setCapacity(e.getSelectedCount()),this.m_clusterVertices.reserveLists(e.getSelectedCount()),this.m_clusterVertices.reserveNodes(e.getSelectedCount()),this.m_edgeVertices.reserveLists(e.getSelectedCount()+32),this.m_edgeVertices.reserveNodes(e.getSelectedCount()+32);for(let t=this.m_shape.getFirstGeometry();t!==n.nullHandle;t=this.m_shape.getNextGeometry(t))if(i.isMultiPath(this.m_shape.getGeometryType(t)))for(let i=this.m_shape.getFirstPath(t);i!==n.nullHandle;i=this.m_shape.getNextPath(i)){const t=this.m_shape.getPathSize(i),s=this.m_shape.getFirstVertex(i);if(s===n.nullHandle)continue;let r=this.m_shape.getNextVertex(s);if(r===n.nullHandle||r===s)continue;let o=-1;e.selected(s)&&(o=this.newCluster_(s));let a=-1;-1!==o&&e.selected(r)&&(a=this.newEdge_(s),this.addEdgeToCluster(a,o));let l=a;for(let e=0,i=t-2;e<i;e++){const e=this.m_shape.getNextVertex(r);let t=-1;if(this.m_shape.selected(r)){const i=this.newCluster_(r);-1!==l&&this.addEdgeToCluster(l,i),this.m_shape.selected(e)&&(t=this.newEdge_(r),this.addEdgeToCluster(t,i))}l=t,r=e}if(this.m_shape.isClosedPath(i)){const e=this.m_shape.getNextVertex(r);if(this.m_shape.selected(r)){const t=this.newCluster_(r);if(-1!==l&&this.addEdgeToCluster(l,t),this.m_shape.selected(e)){const e=this.newEdge_(r);this.addEdgeToCluster(e,t),this.addEdgeToCluster(e,o)}}}else{let e=-1;this.m_shape.selected(r)&&(e=this.newCluster_(r),-1!==l&&this.addEdgeToCluster(l,e))}}else for(let e=this.m_shape.getFirstPath(t);e!==n.nullHandle;e=this.m_shape.getNextPath(e)){let t=this.m_shape.getFirstVertex(e);for(let i=0,n=this.m_shape.getPathSize(e);i<n;i++)this.m_shape.selected(t)&&this.newCluster_(t),t=this.m_shape.getNextVertex(t)}this.fillEventQueue()}progress_(e=!1){}dbgCheckSweepStructure_(){}}function fe(e,t,i){return{vertex0:e,vertex1:t,dir:i}}class ye{constructor(e){this.m_shape=null,this.m_spikes=[],this.m_points=new s.AttributeStreamOfInt32(0),this.m_pointsIndex=-1,this.m_dissolvedEdges=0,this.m_progressTracker=e}executeImpl_(e,t){if(this.m_shape=e,e.getPathCount(t)<2&&e.getPointCount(t)<6)return;this.m_points.resize(0);for(let i=e.getFirstPath(t);i!==n.nullHandle;i=e.getNextPath(i)){let t=e.getFirstVertex(i);for(let n=0,s=e.getPathSize(i);n<s;n++,t=e.getNextVertex(t))this.m_points.add(t)}this.m_pointsIndex=e.createUserIndex();for(let t=0,i=this.m_points.size();t<i;++t)e.setUserIndex(this.m_points.read(t),this.m_pointsIndex,t);e.sortVerticesSimpleByY(this.m_points,0,this.m_points.size());let s=this.m_points.read(0);const r=e.getXY(s);let o=1,a=0;const l=[];for(let t=1;t<this.m_points.size();t++){const i=this.m_points.read(t);if(i===n.nullHandle)continue;if(-1===e.getUserIndex(i,this.m_pointsIndex))continue;const c=e.getXY(i);if(c.isEqualPoint2D(r))o++;else{if(o>1){for(let i=a;i<t;i++){const t=this.m_points.read(i);if(-1===e.getUserIndex(t,this.m_pointsIndex))continue;const n=e.getNextVertex(t),s=e.getPrevVertex(t);if(t!==n&&!e.isEqualXYPoint2D(n,r)){const e=fe(t,n,1);l.push(e)}if(t!==s&&s!==n&&!e.isEqualXYPoint2D(s,r)){const e=fe(t,s,-1);l.push(e)}}l.length>0&&this.processBunch_(l,r)}s=i,r.assign(c),o=1,a=t}}if(0===this.m_dissolvedEdges)return e.removeUserIndex(this.m_pointsIndex),void(this.m_pointsIndex=-1);let c=e.getPointCount(t);for(let t=0;t<this.m_points.size();t++){const i=this.m_points.read(t);if(i===n.nullHandle)continue;if(-1!==e.getUserIndex(i,this.m_pointsIndex)){e.setUserIndex(i,this.m_pointsIndex,-1);continue}const s=e.getPathFromVertex(i);e.getFirstVertex(s)===i&&e.setFirstVertex(s,n.nullHandle),e.freeVertex(i),this.m_points.write(t,n.nullHandle),c--}const h=e.createPathUserIndex();let u=e.getPathCount(t);for(let s=0,r=this.m_points.size();s<r;++s){if(this.m_points.read(s)===n.nullHandle)continue;let r=this.m_points.read(s);if(-1!==e.getUserIndex(r,this.m_pointsIndex))continue;let o=e.getPathFromVertex(r),a=-1;if(2===e.getPathUserIndex(o,h)){o=n.nullHandle;for(let t=e.getNextVertex(r);t!==r;t=e.getNextVertex(t)){const i=e.getPathFromVertex(t);if(2!==e.getPathUserIndex(i,h)){o=i,r=t;break}}o===n.nullHandle&&(o=e.insertPath(t,n.nullHandle),e.setClosedPath(o,!0),u++),i.geometryReleaseAssert(o!==n.nullHandle)}e.setPathUserIndex(o,h,2),a=e.getFirstVertex(o);let l=0,c=!1,m=r;do{a===m&&(c=!0),e.setUserIndex(m,this.m_pointsIndex,1);const t=e.getPathFromVertex(m);t!==o&&(2!==e.getPathUserIndex(t,h)&&(e.setPathUserIndex(t,h,1),e.setFirstVertex(t,n.nullHandle)),e.setPathToVertex(m,o)),l++,m=e.getNextVertex(m)}while(m!==r);c||e.setFirstVertex(o,r),e.setPathSize(o,l)}for(let i=e.getFirstPath(t);i!==n.nullHandle;){const t=e.getNextPath(i);1!==e.getPathUserIndex(i,h)&&e.getFirstVertex(i)!==n.nullHandle||(e.removePathOnly(i),u--),i=t}e.setGeometryVertexCount(t,c),e.setGeometryPathCount(t,u),e.removePathUserIndex(h),e.removeUserIndex(this.m_pointsIndex),this.m_pointsIndex=-1,e.dbgVerifyVertexCounts(),e.filterClosePoints(0,!0,!1,!1,t)}processBunch_(e,t){e.sort(((e,i)=>{const n=this.m_shape.getXY(e.vertex1).sub(t),s=this.m_shape.getXY(i.vertex1).sub(t),o=r.Point2D.compareVectors(n,s);return 0===o?e.dir<i.dir?-1:1:o}));let i=0;const n=this.m_shape.getXY(e[0].vertex1);let s=1;const o=this.m_shape.hasCurves();for(let t=1,r=e.length;t<r;t++){const a=this.m_shape.getXY(e[t].vertex1);if(!(a.isEqualPoint2D(n)&&(s++,t+1<r))){if(2===s){const t=e[i],n=e[i+1],s=t.dir;if(s!==n.dir){let e=!0;if(o&&(e=!this.m_shape.isCurve(1===t.dir?t.vertex0:t.vertex1)&&!this.m_shape.isCurve(1===n.dir?n.vertex0:n.vertex1)),e){if(1===s){const e=t.vertex0,i=n.vertex0;this.m_shape.setNextVertex(e,i),this.m_shape.setPrevVertex(i,e),this.m_shape.getPrevVertex(e)===i&&(this.m_shape.setUserIndex(e,this.m_pointsIndex,-1),this.m_shape.setUserIndex(i,this.m_pointsIndex,-1));const s=t.vertex1,r=n.vertex1;this.m_shape.setPrevVertex(s,r),this.m_shape.setNextVertex(r,s),this.m_shape.getNextVertex(s)===r&&(this.m_shape.setUserIndex(s,this.m_pointsIndex,-1),this.m_shape.setUserIndex(r,this.m_pointsIndex,-1))}else{const e=t.vertex0,i=n.vertex0;this.m_shape.setPrevVertex(e,i),this.m_shape.setNextVertex(i,e),this.m_shape.getNextVertex(e)===i&&(this.m_shape.setUserIndex(e,this.m_pointsIndex,-1),this.m_shape.setUserIndex(i,this.m_pointsIndex,-1));const s=t.vertex1,r=n.vertex1;this.m_shape.setNextVertex(s,r),this.m_shape.setPrevVertex(r,s),this.m_shape.getPrevVertex(s)===r&&(this.m_shape.setUserIndex(s,this.m_pointsIndex,-1),this.m_shape.setUserIndex(r,this.m_pointsIndex,-1))}this.m_dissolvedEdges+=2}}}n.assign(a),i=t,s=1}}e.length=0}}function xe(e){for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t))if(i.isMultiPath(e.getGeometryType(t)))return!0;return!1}function ve(e,t,i,n,s){if(!xe(t))return!1;let r=new be(s);if(r.m_shape=t,r.m_tolerance=i,r.m_bAllowCoincident=e,r.m_bNeedsNonSimpleResult=null!==n,r.needsCrackingImpl_())return n&&n.assign(r.m_nonSimpleResult),!0;const o=new a.Transformation2D;o.setSwapCoordinates(),t.applyTransformation(o),r=new be(s),r.m_shape=t,r.m_tolerance=i,r.m_bAllowCoincident=e,r.m_bNeedsNonSimpleResult=null!==n;const l=r.needsCrackingImpl_();return t.applyTransformation(o),!!l&&(n&&n.assign(r.m_nonSimpleResult),!0)}function Pe(e,t){return{t:e,index:t}}class be{crackBruteForce_(){let e=this.crackBruteForceImpl_();if(!e&&this.m_shape.hasCurves()){const t=new a.Transformation2D;t.setSwapCoordinates(),this.m_shape.applyTransformation(t),e=this.crackBruteForceImpl_(),this.m_shape.applyTransformation(t)}return e}crackBruteForceImpl_(){let e=!1;const r=new n.SegmentBuffer,o=new n.SegmentBuffer,a=t.Envelope2D.constructEmpty(),l=t.Envelope2D.constructEmpty(),c=!1,h=new s.Point,u=new se,m=this.m_shape.getTotalPointCount(),d=m*m*2,p=this.m_shape.queryVertexIteratorOnSelection();for(let t=p.next();t!==n.nullHandle;t=p.next()){const s=this.m_shape.getGeometryType(p.currentGeometry());let m=1,g=1,_=1,f=0,y=0,x=0;const v=this.m_shape.getSegmentParentage(t);let P=!1,b=!1,E=null,S=!1;if(i.isPoint(s))m=this.m_shape.getWeight(t),f=this.m_shape.getRank(t);else{if(E=this.getSegment_(t,r),null===E)continue;const e=this.m_shape.getVertexIndex(t);m=this.m_shape.getWeightWithIndex(e),f=this.m_shape.getRankWithIndex(e),_=this.m_shape.getSegmentWeightWithIndex(e),x=this.m_shape.getSegmentRankWithIndex(e),P=this.m_shape.getSegmentParentageBreakVertex(t);{const e=this.m_shape.getNextVertex(t);g=this.m_shape.getWeight(e),y=this.m_shape.getRank(e),b=this.m_shape.getSegmentParentageBreakVertex(e)}if(E.queryLooseEnvelope(a),a.inflateCoords(this.m_tolerance,this.m_tolerance),E.isDegenerate(this.m_tolerance)){if(!E.isDegenerate(0))continue;S=!0,E=null}}const C=new n.VertexIterator({copy:p});let w=C.next();w!==n.nullHandle&&(w=C.next());let T=0;for(;w!==n.nullHandle;w=C.next()){if(0!==T){T--;continue}if(this.m_shape.getTotalPointCount()>d)return e;this.progress_();const s=this.m_shape.getGeometryType(C.currentGeometry());let D=null,I=!1,A=0,M=0,N=0,R=0,O=0,G=0,k=!1,V=!1;const F=this.m_shape.getSegmentParentage(w);if(i.isPoint(s))A=this.m_shape.getWeight(w),R=this.m_shape.getRank(w);else{if(D=this.getSegment_(w,o),null===D)continue;const e=this.m_shape.getVertexIndex(w);A=this.m_shape.getWeightWithIndex(e),R=this.m_shape.getRankWithIndex(e),N=this.m_shape.getSegmentWeightWithIndex(e),G=this.m_shape.getSegmentRankWithIndex(e),k=this.m_shape.getSegmentParentageBreakVertex(w);{const e=this.m_shape.getNextVertex(w);M=this.m_shape.getWeight(e),O=this.m_shape.getRank(e),V=this.m_shape.getSegmentParentageBreakVertex(e)}if(D.queryLooseEnvelope(l),D.isDegenerate(this.m_tolerance)){if(!D.isDegenerate(0))continue;I=!0,D=null}}let L=0,q=0;if(null!==E&&null!==D)a.isIntersectingNe(l)&&0!==n.isIntersectingEx(!0,!0,E,D,this.m_tolerance,!0)&&(u.pushSegment(E,m,f,g,y,_,x,P,b,v),u.pushSegment(D,A,R,M,O,N,G,k,V,F),u.intersect2D(this.m_tolerance,!0),e||=u.getSegmentChanged(0)||u.getSegmentChanged(1),L=u.getResultSegmentCount(0),q=u.getResultSegmentCount(1),L+q>0&&(this.m_shape.splitSegmentWithIntersector(t,u,0,!0,!0),this.m_shape.splitSegmentWithIntersector(w,u,1,!0,!0),this.m_bTrackChanges&&(u.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(t,!0),u.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(w,!0))),q>1&&(T+=q-1),u.clear());else if(null!==E){const i=this.m_shape.getXY(w);if(a.contains(i)){if(u.pushSegment(E,m,f,g,y,_,x,P,b,v),this.m_shape.queryPoint(w,h),u.intersect2DEx(this.m_tolerance,h,R,A,c),e||=u.getSegmentChanged(0)||u.getResultPointChanged(),L=u.getResultSegmentCount(0),L>0)if(this.m_bTrackChanges&&(u.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(t,!0),u.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(w,!0)),this.m_shape.splitSegmentWithIntersector(t,u,0,!0,!0),I){let e=n.nullHandle;for(let t=this.m_shape.getNextVertex(w);t!==n.nullHandle&&t!==w&&(D=this.getSegment_(t,o),e=t,null!=D&&D.isDegenerate(0));t=this.m_shape.getNextVertex(t));for(let t=w;t!==n.nullHandle&&(this.m_shape.setPoint(t,u.getResultPoint(),!0),t!==e);t=this.m_shape.getNextVertex(t));}else this.m_shape.setPoint(w,u.getResultPoint(),!0);u.clear()}}else{if(null===D)continue;{const i=this.m_shape.getXY(t);if(l.inflateCoords(this.m_tolerance,this.m_tolerance),l.contains(i)){if(u.pushSegment(D,A,R,M,O,N,G,k,V,F),this.m_shape.queryPoint(t,h),u.intersect2DEx(this.m_tolerance,h,f,m,c),e||=u.getSegmentChanged(0)||u.getResultPointChanged(),q=u.getResultSegmentCount(0),q>0)if(this.m_bTrackChanges&&(u.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(w,!0),u.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(t,!0)),this.m_shape.splitSegmentWithIntersector(w,u,0,!0,!0),T+=q-1,S){let e=n.nullHandle;for(let i=this.m_shape.getNextVertex(t);i!==n.nullHandle&&i!==t&&(D=this.getSegment_(i,o),e=i,null!=D&&D.isDegenerate(0));i=this.m_shape.getNextVertex(i));for(let i=t;i!==n.nullHandle&&(this.m_shape.setPoint(i,u.getResultPoint(),!0),i!==e);i=this.m_shape.getNextVertex(i));}else this.m_shape.setPoint(t,u.getResultPoint(),!0);u.clear()}}}if(L+q!==0&&0!==L){let e=!1;for(;E=this.getSegment_(t,r),null!=E&&(E.queryEnvelope(a),E.isDegenerate(this.m_tolerance));){if(!(L>1)){e=!0;break}t=p.next(),L--,i.geometryReleaseAssert(t!==n.nullHandle)}if(e)break}}}return e}crackerPlaneSweep_(){return this.planesweep_()}planesweep_(){return new _e(this.m_progressTracker,this.m_bTrackChanges).sweep(this.m_shape,this.m_tolerance)}needsCrackingImpl_(){let e=!1;const t=new s.AttributeStreamOfInt32(0);t.resize(this.m_shape.getSelectedCount());const o=this.m_shape.queryVertexIteratorOnSelection();for(let e=0,i=o.next();i!==n.nullHandle;++e,i=o.next())t.write(e,i);this.m_shape.sortVerticesSimpleByY(t,0,t.size()),t.add(n.nullHandle);const a=this.m_shape.createUserIndex(),l=this.m_shape.createUserIndex();this.m_sweepComparator=new Z(this.m_shape,this.m_tolerance,!this.m_bAllowCoincident),this.m_sweepStructure.setComparator(this.m_sweepComparator);let c=null;const h=[],m=[];let d=0;const p=new r.Point2D;for(let s=t.read(d++);s!==n.nullHandle;){this.m_shape.queryXY(s,p);let o=!1;do{let e=this.m_shape.getNextVertex(s),i=this.m_shape.getPrevVertex(s);o||=e!==n.nullHandle||i!==n.nullHandle,e===n.nullHandle||this.m_shape.selected(e)||(e=n.nullHandle),i===n.nullHandle||this.m_shape.selected(i)||(i=n.nullHandle),e!==n.nullHandle&&this.m_shape.compareVerticesSimpleY(s,e)<0&&(m.push(s),m.push(e)),i!==n.nullHandle&&this.m_shape.compareVerticesSimpleY(s,i)<0&&(m.push(i),m.push(i));const r=this.m_shape.getUserIndex(s,a);-1!==r&&(h.push(r),this.m_shape.setUserIndex(s,a,-1));const c=this.m_shape.getUserIndex(s,l);-1!==c&&(h.push(c),this.m_shape.setUserIndex(s,l,-1)),s=t.read(d++)}while(s!==n.nullHandle&&this.m_shape.isEqualXYPoint2D(s,p));if(!o&&(null===c&&(c=new Q(this.m_shape,this.m_tolerance)),c.setPoint(p),this.m_sweepStructure.searchUpperBound(c),c.intersectionDetected())){e=!0,this.m_bNeedsNonSimpleResult&&(i.throwInternalErrorException("needsCrackingIMpl_"),this.m_nonSimpleResult=new u.NonSimpleResult(6,-1,-1));break}let g=1===h.length&&2===m.length;const _=32;h.length>_&&r.numericSort(h);let f=-1,y=-1;if(!g)for(let t=0,i=h.length;t<i;t++){const i=h[t],n=this.m_sweepStructure.getPrev(i);if(-1!==n&&-1===h.indexOf(n))if(-1===f)f=n;else{if(e=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new u.NonSimpleResult(6,-1,-1)}const s=this.m_sweepStructure.getNext(i);if(-1!==s&&-1===h.indexOf(s))if(-1===y)y=s;else{if(e=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new u.NonSimpleResult(6,-1,-1)}if(-1!==f&&-1!==y)break}if(e&&!this.m_bNeedsNonSimpleResult)break;if(this.m_sweepComparator.setSweepY(p.y,p.x),!g){for(let e=0,t=h.length;e<t;e++){const t=h[e];this.m_sweepStructure.deleteNode(t)}h.length=0}if(!g&&-1!==f&&-1!==y&&this.checkForIntersections_(f,y)){e=!0,this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult());break}for(let t=0,i=m.length;t<i;t+=2){const i=m[t],n=m[t+1];let s;if(g?(s=this.m_sweepStructure.replaceElementAtPosition(h[0],i,!0,!0),h.length=0,g=!1):s=this.m_sweepStructure.addElement(i),this.m_sweepComparator.intersectionDetected()){this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult()),e=!0;break}-1===this.m_shape.getUserIndex(n,a)?this.m_shape.setUserIndex(n,a,s):this.m_shape.setUserIndex(n,l,s)}if(e)break;m.length=0}return this.m_shape.removeUserIndex(a),this.m_shape.removeUserIndex(l),e}checkForIntersections_(e,t){const i=this.m_sweepStructure.getElement(e);this.m_sweepComparator.compare(this.m_sweepStructure,i,t);const n=this.m_sweepComparator.intersectionDetected();return this.m_sweepComparator.clearIntersectionDetectedFlag(),n}getSegment_(e,t){return be.st_getSegment(this.m_shape,e,t)}static st_getSegment(e,t,i){return e.querySegment(t,i,!1,!1)?i.get():null}dbgPrintSweepEdge(e){}dbgPrintSweepStructure(){}dbgSaveSweepStructure(e=null){}dbgCheckSweepStructure(){}progress_(e=!1){this.m_progressCounter++}crackAWithBMultiPath_(e,o,a){const l=t.Envelope2D.constructEmpty();e.queryLooseEnvelope(l);const c=t.Envelope2D.constructEmpty();if(o.queryLooseEnvelope(c),c.inflateCoords(a,a),!c.isIntersecting(l))return e;const h=e.getImpl(),u=h.getAccelerators();let m=null,d=null;u&&(d=u.getQuadTree()),function(e,t){const i=e.getPointCount();return!(i<16)&&2*i+Math.log(i)/Math.log(2)*1*t<1*i*t}(e,i.vertexCount(o))&&(m=s.buildQuadTree(h,c),d=m);const p=d?d.getIteratorForQT():null,g=o.querySegmentIterator(),_=e.querySegmentIterator(),f=r.makePrimitiveArray(15,Number.NaN),y=[];for(;g.nextPath();)for(;g.hasNextSegment();){const e=g.nextSegment();if(d){p.resetIterator(e,a);for(let t=p.next();-1!==t;t=p.next()){this.progress_();const i=d.getElement(t);if(_.resetToVertex(i,-1),_.hasNextSegment()){const t=_.nextSegment().intersect(e,null,f,null,a);for(let e=0;e<t;e++){const t=f[e];if(0===t||1===t)continue;const i=Pe(t,_.getStartPointIndex());y.push(i)}}}}else{const i=t.Envelope2D.constructEmpty();if(e.queryLooseEnvelope(i),i.inflateCoords(a,a),!l.isIntersecting(i))continue;for(_.resetToFirstPath();_.nextPath();)for(;_.hasNextSegment();){const n=_.nextSegment(),s=t.Envelope2D.constructEmpty();if(n.queryLooseEnvelope(s),!s.isIntersecting(i))continue;const r=n.intersect(e,null,f,null,a);for(let e=0;e<r;e++){const t=f[e];if(0===t||1===t)continue;const i=Pe(t,_.getStartPointIndex());y.push(i)}}}}if(0===y.length)return e;y.sort(((e,t)=>e.index<t.index?-1:e.index>t.index?1:e.t<t.t?-1:e.t>t.t?1:0));const x=e.createInstance();for(x.getGeometryType()===i.GeometryType.enumPolygon&&x.setFillRule(e.getFillRule()),_.resetToFirstPath();_.nextPath()&&!_.hasNextSegment(););i.geometryReleaseAssert(_.hasNextSegment());let v=_.nextSegment();const P=new n.SegmentBuffer;let b=-1;for(let e=0,t=y.length;e<t;){const n=y[e].index;let s=e+1;for(;s<t&&y[s].index===n;)++s;for(;_.getStartPointIndex()<n;){this.progress_();const e=_.hasNextSegment(),t=_.getPathIndex();if((e||!_.isClosingSegment()||_.isCurve())&&(i.geometryReleaseAssert(null!==v),x.addSegment(v,b!==t)),b=t,!e){for(_.isPathClosed();_.nextPath()&&!_.hasNextSegment(););i.geometryReleaseAssert(_.hasNextSegment())}v=_.nextSegment()}let r=0;for(let t=e;t<s;t++){const e=y[t].t;if(e===r)continue;i.geometryReleaseAssert(null!==v),v.queryCut(r,e,P),r=e;const n=_.getPathIndex();x.addSegment(P.get(),b!==n),b=n}const o=_.hasNextSegment();if((o||!_.isClosingSegment()||_.isCurve())&&(i.geometryReleaseAssert(null!=v),v.queryCut(r,1,P),x.addSegment(P.get(),!1)),o)v=_.nextSegment();else{for(;_.nextPath()&&!_.hasNextSegment(););v=_.hasNextSegment()?_.nextSegment():null}e=s}if(null!==v){const e=_.getPathIndex();(_.hasNextSegment()||!_.isClosingSegment()||_.isCurve())&&x.addSegment(v,b!==e),b=e}let E=_.hasNextSegment();for(;;){if(!E){for(;_.nextPath()&&(E=_.hasNextSegment(),!E););if(!E)break}v=_.nextSegment();const e=_.getPathIndex();E=_.hasNextSegment(),(E||!_.isClosingSegment()||_.isCurve())&&x.addSegment(v,b!==e),b=e}return x}constructor(e){this.m_shape=null,this.m_progressTracker=null,this.m_nonSimpleResult=new u.NonSimpleResult,this.m_tolerance=0,this.m_sweepComparator=null,this.m_progressCounter=0,this.m_bTrackChanges=!1,this.m_bNeedsNonSimpleResult=!1,this.m_bAllowCoincident=!0,this.m_sweepStructure=new s.Treap,this.m_progressTracker=e}}be.s_bForceBruteForce=!0;class Ee{constructor(e,t){this.m_monotoneParts=r.makeObjectArray(n.SegmentBuffer,16),this.m_xOrds=r.makePrimitiveArray(16,Number.NaN),this.m_inputPoint=r.Point2D.getNAN(),this.m_miny=0,this.m_maxy=0,this.m_windnum=0,this.m_bAlternate=e,this.m_tolerance=t,this.m_toleranceSqr=t*t,this.m_bTestBorder=!!t,this.m_bBreak=!1}_DoOne(e){if(!this.m_bTestBorder&&(this.m_bAlternate&&this.m_inputPoint.equals(e.getStartXY())||this.m_inputPoint.equals(e.getEndXY())))return void(this.m_bBreak=!0);if(e.getStartY()===this.m_inputPoint.y&&e.getStartY()===e.getEndY()){if(this.m_bAlternate&&!this.m_bTestBorder){const t=Math.min(e.getStartX(),e.getEndX()),i=Math.max(e.getStartX(),e.getEndX());this.m_inputPoint.x>t&&this.m_inputPoint.x<i&&(this.m_bBreak=!0)}return}let t=!1;const i=Math.max(e.getStartX(),e.getEndX());if(this.m_inputPoint.x>i)t=!0;else if(this.m_inputPoint.x>=Math.min(e.getStartX(),e.getEndX())){const n=e.intersectionOfYMonotonicWithAxisX(this.m_inputPoint.y,i);t=!Number.isNaN(n)&&n<=this.m_inputPoint.x}if(t){if(this.m_inputPoint.y===e.getStartY()){if(this.m_inputPoint.y<e.getEndY())return}else if(this.m_inputPoint.y===e.getEndY()&&this.m_inputPoint.y<e.getStartY())return;this.m_bAlternate?this.m_windnum^=1:this.m_windnum+=e.getStartY()>e.getEndY()?1:-1}}_Result(){return!!this.m_windnum}testBorder(e){const t=e.getClosestCoordinate(this.m_inputPoint,!1),i=e.getCoord2D(t);return r.Point2D.sqrDistance(i,this.m_inputPoint)<=this.m_toleranceSqr}setInputPoint(e){this.m_inputPoint.setCoordsPoint2D(e),this.m_miny=e.y-this.m_tolerance,this.m_maxy=e.y+this.m_tolerance}processSegment(e){const t=e.queryInterval(0,1);if(t.vmin>this.m_maxy||t.vmax<this.m_miny)return!1;if(this.m_bTestBorder&&this.testBorder(e))return!0;if(t.vmin>this.m_inputPoint.y||t.vmax<this.m_inputPoint.y)return!1;let n=0;if(e.isCurve()&&(0===this.m_monotoneParts.length&&(this.m_monotoneParts.length=128),n=e.getMonotonicParts(this.m_monotoneParts,!0),i.geometryReleaseAssert(this.m_monotoneParts.length>=n)),n>0)for(let e=0;e<n;e++){const t=this.m_monotoneParts[e].get(),i=r.Envelope1D.construct(t.getStartY(),t.getEndY());if(!(i.vmin>this.m_inputPoint.y||i.vmax<this.m_inputPoint.y)&&(this._DoOne(t),this.m_bBreak))return!0}else if(this._DoOne(e),this.m_bBreak)return!0;return!1}result(){return i.geometryReleaseAssert(0),2}}function Se(e,n,s){if(e.isEmpty())return 0;const r=t.Envelope2D.constructEmpty();if(e.queryLooseEnvelope(r),r.inflateCoords(s,s),!r.contains(n))return 0;const o=e.getImpl().getAccelerators();if(o){o.getRasterizedGeometry()&&i.geometryReleaseAssert(0);const r=o.getQuadTree();if(r)return function(e,i,n,s){const r=new t.Envelope2D;e.queryLooseEnvelope(r),r.inflateCoords(s,s);const o=0===e.getFillRule(),a=new Ee(o,s);a.setInputPoint(n);const l=r.clone();l.xmax=n.x+s,l.ymin=n.y-s,l.ymax=n.y+s;const c=e.getImpl().querySegmentIterator(),h=i.getIterator(l,s);for(let e=h.next();-1!==e;e=h.next())if(c.resetToVertex(i.getElement(e),-1),c.hasNextSegment()){const e=c.nextSegment();if(a.processSegment(e))return-1}return a._Result()?1:0}(e,r,n,s)}return function(e,t,i){const n=0===e.getFillRule(),s=new Ee(n,i);s.setInputPoint(t);const r=e.getImpl().querySegmentIterator();for(;r.nextPath();)for(;r.hasNextSegment();){const e=r.nextSegment();if(s.processSegment(e))return-1}return s._Result()?1:0}(e,n,s)}function Ce(e,t){const i=e.getPointCount();return!(i<16)&&2*i+Math.log(i)/Math.log(2)*1*t<1*i*t}class we{getDirection_(e){return this.m_shape.getNextVertex(this.getEnd1(e))===this.getEnd2(e)}getEnd_(e){const t=this.getEnd1(e),i=this.getEnd2(e);return this.m_shape.getNextVertex(t)===i?i:t}constructor(e){this.m_end1Nodes=[],this.m_end2Nodes=[],this.m_directions=[],this.m_shape=e,this.m_firstFree=-1}getSegment(e){return this.m_shape.getSegment(this.getStart(e))}isBottomUp(e){let t=this.getEnd1(e),n=this.getEnd2(e);this.m_shape.getPrevVertex(t)===n&&(n=r.swap(t,t=n));const s=r.Point2D.getNAN(),o=r.Point2D.getNAN();return this.m_shape.queryXY(t,s),this.m_shape.queryXY(n,o),i.geometryReleaseAssert(!s.equals(o)),s.y<o.y}getStart(e){const t=this.getEnd1(e),i=this.getEnd2(e);return this.m_shape.getNextVertex(t)===i?t:i}getEnd1(e){return this.m_end1Nodes[e]}getEnd2(e){return this.m_end2Nodes[e]}freeEdge(e){this.m_end1Nodes[e]=this.m_firstFree,this.m_firstFree=e}newEdge(e){if(-1!==this.m_firstFree){const t=this.m_firstFree;return this.m_firstFree=this.m_end1Nodes[t],this.m_end1Nodes[t]=e,this.m_end2Nodes[t]=this.m_shape.getNextVertex(e),t}const t=this.m_end1Nodes.length;return this.m_end1Nodes.push(e),this.m_end2Nodes.push(this.m_shape.getNextVertex(e)),t}getShape(){return this.m_shape}getPath(e){return this.m_shape.getPathFromVertex(this.getEnd1(e))}}let Te=class extends s.Comparator{constructor(e){super(),this.m_line1=new n.Line,this.m_line2=new n.Line,this.m_leftElm=-1,this.m_leftx=0,this.m_seg1=null,this.m_helper=e}compare(e,t,n){const s=e.getElement(n),r=this.m_helper.m_edges;let o;this.m_leftElm===t?o=this.m_leftx:(this.m_seg1=r.getSegment(t),this.m_seg1?o=this.m_seg1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(r.getShape().queryLineConnector(r.getStart(t),this.m_line1,!0),this.m_seg1=this.m_line1,o=this.m_line1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),this.m_leftx=o,this.m_leftElm=t);let a,l=r.getSegment(s);if(l?a=l.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(r.getShape().queryLineConnector(r.getStart(s),this.m_line2,!0),l=this.m_line2,a=this.m_line2.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),o===a){const e=r.isBottomUp(t),n=r.isBottomUp(s),c=e?this.m_seg1.getEndY():this.m_seg1.getStartY(),h=n?l.getEndY():l.getStartY(),u=Math.min(c,h);let m=.5*(u+this.m_helper.m_yScanline);m===this.m_helper.m_yScanline&&(m=u),o=this.m_seg1.intersectionOfYMonotonicWithAxisX(m,0),a=l.intersectionOfYMonotonicWithAxisX(m,0),o===a&&i.throwNonSimpleGeometryException("")}return o<a?-1:o>a?1:0}reset(){this.m_leftElm=-1}};class De{constructor(e){this.m_node=-1,this.m_index=0,this.m_sortedVertices=e.m_sortedVertices,this.m_sortedVerticesArray=e.m_sortedVerticesArray,this.m_sortedVertices&&(this.m_node=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList()))}next(){if(this.m_sortedVertices){const e=this.m_node;if(-1===e)return n.nullHandle;const t=this.m_sortedVertices.getData(e);return this.m_node=this.m_sortedVertices.getNext(e),t}if(this.m_index<this.m_sortedVerticesArray.size()){const e=this.m_sortedVerticesArray.read(this.m_index);return this.m_index++,e}return n.nullHandle}}class Ie{constructor(e){this.m_edges=null,this.m_shape=null,this.m_AET=new s.Treap,this.m_yScanline=0,this.m_geometry=n.nullHandle,this.m_unknownRingOrientationCount=-1,this.m_sortedVertices=null,this.m_sortedVerticesArray=null,this.m_unknownNodes=[],this.m_node1UserIndex=-1,this.m_node2UserIndex=-1,this.m_pathOrientationIndex=-1,this.m_pathParentageIndex=-1,this.m_pathParentsIndex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_progressTracker=e,this.m_AET.disableBalancing(),this.m_sweepComparator=new Te(this),this.m_AET.setComparator(this.m_sweepComparator)}fixRingOrientation_(){const e=this.fixRingOrientationImplMain_();return-1===this.m_pathOrientationIndex||this.fixRingOrientationImplSimplify_(),e}fixRingOrientationForMp2sp_(){return this.fixRingOrientationImplMain_(),-1===this.m_pathOrientationIndex?-1:this.fixRingOrientationImplMp2sp_()}processBunchForRingOrientationTest_(e){return this.processBunchForRingOrientationTestOddEven_(e)}processBunchForRingOrientationTestOddEven_(e){let t=!1;if(this.m_edges||(this.m_edges=new we(this.m_shape)),this.m_unknownNodes.length=0,this.processBunchForRingOrientationRemoveEdges_(e),!this.m_AET.isAutoBalancing()){let t=0;for(let i=0,n=e.length;i<n;i++)-1!==e[i]&&t++;(t>10||this.m_AET.getMaxDepthEver()>4)&&this.m_AET.enableBalancing()}for(let t=0,i=e.length;t<i;t++){const i=e[t];i!==n.nullHandle&&this.insertEdge_(i,-1)}for(let e=0;e<this.m_unknownNodes.length&&this.m_unknownRingOrientationCount>0;e++){const r=this.m_unknownNodes[e],o=this.m_AET.getElement(r),a=this.m_edges.getPath(o),l=this.m_shape.getPathUserIndex(a,this.m_pathOrientationIndex);let c=n.nullHandle;if(0===l){let e=this.m_AET.getPrev(r),n=r,o=!1;for(;e!==s.Treap.st_nullNode();){const t=this.m_AET.getElement(e),i=this.m_edges.getPath(t);if(0!==this.m_shape.getPathUserIndex(i,this.m_pathOrientationIndex)){c=i;break}n=e,e=this.m_AET.getPrev(e)}if(e===s.Treap.st_nullNode())o=!0,e=n;else{const t=this.m_AET.getElement(e);o=this.m_edges.isBottomUp(t),e=this.m_AET.getNext(e),o=!o}do{const s=this.m_AET.getElement(e),r=this.m_edges.getPath(s);if(0===this.m_shape.getPathUserIndex(r,this.m_pathOrientationIndex)){if(o!==this.m_edges.isBottomUp(s)){const e=this.m_shape.getFirstVertex(r);this.m_shape.reverseRingInternal(e),this.m_shape.setLastVertex(r,this.m_shape.getPrevVertex(e)),t=!0}if(this.m_shape.setPathUserIndex(r,this.m_pathOrientationIndex,o?3:2),!o){let e=this.m_shape.getPathUserIndex(c,this.m_pathOrientationIndex);2===e?(c=this.m_shape.getPathUserIndex(c,this.m_pathParentsIndex),e=this.m_shape.getPathUserIndex(c,this.m_pathOrientationIndex),i.geometryReleaseAssert(3===e)):i.geometryReleaseAssert(3===e);const t=this.m_shape.getPathUserIndex(c,this.m_pathParentageIndex);this.m_shape.setPathUserIndex(c,this.m_pathParentageIndex,r),this.m_shape.setPathUserIndex(r,this.m_pathParentageIndex,t),this.m_shape.setPathUserIndex(r,this.m_pathParentsIndex,c)}if(this.m_unknownRingOrientationCount--,!this.m_unknownRingOrientationCount)return t}c=r,n=e,e=this.m_AET.getNext(e),o=!o}while(n!==r)}}return t}processBunchForRingOrientationRemoveEdges_(e){for(let t=0,i=e.length;t<i;t++){const i=e[t],s=this.m_shape.getUserIndex(i,this.m_node1UserIndex),r=this.m_shape.getUserIndex(i,this.m_node2UserIndex);if(-1!==s){const e=this.m_AET.getElement(s);this.m_edges.freeEdge(e),this.m_shape.setUserIndex(i,this.m_node1UserIndex,-1)}if(-1!==r){const e=this.m_AET.getElement(r);this.m_edges.freeEdge(e),this.m_shape.setUserIndex(i,this.m_node2UserIndex,-1)}let o=-1;-1!==s&&-1!==r?(this.m_AET.deleteNode(s),this.m_AET.deleteNode(r),e[t]=n.nullHandle):o=-1!==s?s:r,-1!==o&&(this.insertEdge_(i,o)||this.m_AET.deleteNode(o),e[t]=n.nullHandle)}}dbgVerifyRingOrientation_(){}insertEdge_(e,t){const i=r.Point2D.getNAN(),n=r.Point2D.getNAN();this.m_shape.queryXY(e,i);const s=this.m_shape.getNextVertex(e);this.m_shape.queryXY(s,n);let o=!1;if(i.y<n.y){o=!0;const i=this.m_edges.newEdge(e);let n;-1===t?n=this.m_AET.addElement(i):(n=t,this.m_AET.setElement(n,i)),-1===this.m_shape.getUserIndex(s,this.m_node1UserIndex)?this.m_shape.setUserIndex(s,this.m_node1UserIndex,n):this.m_shape.setUserIndex(s,this.m_node2UserIndex,n);const r=this.m_shape.getPathFromVertex(e);0===this.m_shape.getPathUserIndex(r,this.m_pathOrientationIndex)&&this.m_unknownNodes.push(n)}const a=this.m_shape.getPrevVertex(e);if(this.m_shape.queryXY(a,n),i.y<n.y){o=!0;const i=this.m_edges.newEdge(a);let n;-1===t?n=this.m_AET.addElement(i):(n=t,this.m_AET.setElement(n,i)),-1===this.m_shape.getUserIndex(a,this.m_node1UserIndex)?this.m_shape.setUserIndex(a,this.m_node1UserIndex,n):this.m_shape.setUserIndex(a,this.m_node2UserIndex,n);const s=this.m_shape.getPathFromVertex(e);0===this.m_shape.getPathUserIndex(s,this.m_pathOrientationIndex)&&this.m_unknownNodes.push(n)}return o}fixRingSelfTangency_(){const e=[],t=[];let s=-1,o=-1;const a=new r.Point2D;let l=n.nullHandle,c=n.nullHandle,h=-1;const u=new De(this);for(let i=u.next();i!==n.nullHandle;i=u.next()){const n=new r.Point2D;this.m_shape.queryXY(i,n);const u=this.m_shape.getPathFromVertex(i);a.equals(n)&&c===u?(-1===o&&(s=this.m_shape.createPathUserIndex(),this.m_shape.fillPathUserIndexForGeometry(this.m_geometry,s,-1),o=this.m_shape.createUserIndex(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,o,-1)),-1===h&&(h=t.length,this.m_shape.setUserIndex(l,o,h),t.push(1),-1===this.m_shape.getPathUserIndex(u,s)&&(this.m_shape.setPathUserIndex(u,s,l),e.push(u))),this.m_shape.setUserIndex(i,o,h),t[t.length-1]++):(h=-1,a.assign(n)),l=i,c=u}if(0===e.length)return!1;i.geometryReleaseAssert(-1!==s);for(let i=0,n=e.length;i<n;i++){const n=e[i];let r=this.m_shape.getPathUserIndex(n,s);const a=this.m_shape.getUserIndex(r,o),l=[],c=[];l.push(r),c.push(a);for(let e=this.m_shape.getNextVertex(r);e!==r;e=this.m_shape.getNextVertex(e)){const i=e,n=this.m_shape.getUserIndex(i,o);if(-1!==n){if(0===c.length){c.push(n),l.push(i);continue}if(c.at(-1)===n){const s=l.at(-1);this.m_shape.peelALoopIntoAPath(s,i),this.m_shape.setUserIndex(e,o,-1),t[n]--,1===t[n]&&(t[n]=0,c.pop(),l.pop()),r=s,e=s}else l.push(e),c.push(n)}}}return this.m_shape.removePathUserIndex(s),this.m_shape.removeUserIndex(o),this.m_shape.dbgVerifyVertexCounts(),!0}progress_(e=!1){}fixRingOrientationImplMain_(){const e={stack:[],error:void 0,hasError:!1};try{let t,i=!1;const a=o.__addDisposableResource(e,r.makeScopedCall((()=>{this.m_sortedVerticesArray=null})),!1);if(null===this.m_sortedVertices){const e=this.m_shape.getPointCount(this.m_geometry);t=new s.AttributeStreamOfInt32(0);for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==n.nullHandle;e=this.m_shape.getNextPath(e)){let i=this.m_shape.getFirstVertex(e);for(let n=0,s=this.m_shape.getPathSize(e);n<s;n++)t.add(i),i=this.m_shape.getNextVertex(i)}this.m_shape.sortVerticesSimpleByY(t,0,e),this.progress_(!0),this.m_sortedVerticesArray=t}else a.bForget=!0;if(this.m_bFixSelfTangency&&(i=this.fixRingSelfTangency_()),1===this.m_shape.getPathCount(this.m_geometry)){const e=this.m_shape.getFirstPath(this.m_geometry),t=this.m_shape.getRingArea(e);if(this.m_shape.setExterior(e,!0),t<0){const t=this.m_shape.getFirstVertex(e);return this.m_shape.reverseRingInternal(t),this.m_shape.setLastVertex(e,this.m_shape.getPrevVertex(t)),!0}return!1}this.m_shape.dbgVerifyCurves(),this.m_pathOrientationIndex=this.m_shape.createPathUserIndex(),this.m_pathParentageIndex=this.m_shape.createPathUserIndex(),this.m_pathParentsIndex=this.m_shape.createPathUserIndex();for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==n.nullHandle;e=this.m_shape.getNextPath(e))this.m_shape.setPathUserIndex(e,this.m_pathOrientationIndex,0),this.m_shape.setPathUserIndex(e,this.m_pathParentageIndex,-1),this.m_shape.setPathUserIndex(e,this.m_pathParentsIndex,-1);const l=[];this.m_yScanline=Number.NaN;const c=r.Point2D.getNAN();this.m_unknownRingOrientationCount=this.m_shape.getPathCount(this.m_geometry),this.m_node1UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node1UserIndex,-1),this.m_node2UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node2UserIndex,-1);const h=new De(this);for(let e=h.next();e!==n.nullHandle&&(this.progress_(),this.m_shape.queryXY(e,c),c.y!==this.m_yScanline&&l.length&&(i=this.processBunchForRingOrientationTest_(l)||i,this.m_sweepComparator.reset(),l.length=0),l.push(e),this.m_yScanline=c.y,0!==this.m_unknownRingOrientationCount);e=h.next());return this.m_unknownRingOrientationCount>0&&(i=this.processBunchForRingOrientationTest_(l)||i,l.length=0),this.m_shape.removeUserIndex(this.m_node1UserIndex),this.m_shape.removeUserIndex(this.m_node2UserIndex),this.dbgVerifyRingOrientation_(),i}catch(t){e.error=t,e.hasError=!0}finally{o.__disposeResources(e)}}fixRingOrientationImplSimplify_(){const e=[];for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==n.nullHandle;)if(this.progress_(),3===this.m_shape.getPathUserIndex(t,this.m_pathOrientationIndex)){this.m_shape.setExterior(t,!0);for(let i=this.m_shape.getPathUserIndex(t,this.m_pathParentageIndex);i!==n.nullHandle;){const n=this.m_shape.getPathUserIndex(i,this.m_pathParentageIndex);e.push(i),this.m_shape.setExterior(i,!1),this.m_shape.setPathUserIndex(i,this.m_pathParentageIndex,t),i=n}let i=t,r=e.length;for(let e=this.m_shape.getNextPath(t);r>0&&e!==n.nullHandle;e=this.m_shape.getNextPath(e),--r){if(this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex)!==t){i=n.nullHandle;break}i=e}if(0!==r){i=t;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.m_shape.setPathUserIndex(n,this.m_pathParentageIndex,s.c_deadBeef),this.m_shape.movePath(this.m_geometry,this.m_shape.getNextPath(i),n),i=n}}e.length=0,t=this.m_shape.getNextPath(i)}else t=this.m_shape.getNextPath(t);this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex)}fixRingOrientationImplMp2sp_(){const e=this.m_shape.createPathUserIndex();let t=0;const i=[];for(let r=this.m_shape.getFirstPath(this.m_geometry);r!==n.nullHandle;)if(this.progress_(),3===this.m_shape.getPathUserIndex(r,this.m_pathOrientationIndex)){this.m_shape.setExterior(r,!0),this.m_shape.setPathUserIndex(r,e,t),t++;for(let e=this.m_shape.getPathUserIndex(r,this.m_pathParentageIndex);e!==n.nullHandle;){const t=this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex);i.push(e),this.m_shape.setExterior(e,!1),this.m_shape.setPathUserIndex(e,this.m_pathParentageIndex,r),e=t}let o=r,a=i.length,l=t;for(let t=this.m_shape.getNextPath(r);a>0&&t!==n.nullHandle;t=this.m_shape.getNextPath(t),--a){if(this.m_shape.getPathUserIndex(t,this.m_pathParentageIndex)!==r){o=n.nullHandle;break}o=t,this.m_shape.setPathUserIndex(t,e,-l),l++}if(0!==a){o=r,l=t;for(let t=0,n=i.length;t<n;t++){const n=i[t];this.m_shape.setPathUserIndex(n,e,-l),l++,this.m_shape.setPathUserIndex(n,this.m_pathParentageIndex,s.c_deadBeef)}o=r}t=l,i.length=0,r=this.m_shape.getNextPath(o)}else r=this.m_shape.getNextPath(r);return this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex),e}}function Ae(e,t,i,n,s,r){const o=new Me(r);return o.m_shape=e,o.m_geometry=t,o.m_knownSimpleResult=i,o.m_bFixSelfTangency=n,o.m_polylineDegeneracies=s,o.m_bHasSegmentParentage=e.hasSegmentParentage(),o.m_bHasSegments=e.hasCurves(),o.simplify_()}class Me{constructor(e){this.m_shape=null,this.m_geometry=n.nullHandle,this.m_sortedVertices=new s.IndexMultiDCList,this.m_bunchEdgeEndPoints=[],this.m_bunchEdgeCenterPoints=[],this.m_bunchEdgeIndices=[],this.m_sorterSegmentBuffer1=null,this.m_sorterSegmentBuffer2=null,this.m_knownSimpleResult=-1,this.m_sortedVerticesListIndex=-1,this.m_polylineDegeneracies=n.nullHandle,this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_bHasSegmentParentage=!1,this.m_bHasSegments=!1,this.m_progressTracker=e}compareAngles_(e,t){return this.m_bHasSegments?this.compareAnglesCurves_(e,t):this.compareAnglesLines_(e,t)}compareAnglesLines_(e,t){const n=this.m_bunchEdgeEndPoints[e],s=new r.Point2D;this.m_shape.queryXY(n,s);const o=new r.Point2D,a=this.m_bunchEdgeEndPoints[t];if(this.m_shape.queryXY(a,o),s.equals(o))return 0;const l=this.m_bunchEdgeCenterPoints[e],c=new r.Point2D;this.m_shape.queryXY(l,c);const h=this.m_bunchEdgeCenterPoints[t],u=new r.Point2D;this.m_shape.queryXY(h,u);const m=new r.Point2D;m.setSub(s,c);const d=new r.Point2D;return d.setSub(o,u),(m.isZero()||d.isZero())&&i.throwNonSimpleGeometryException(""),r.Point2D.compareVectors(m,d)}compareAnglesCurves_(e,t){const i=this.m_bunchEdgeEndPoints[e],s=this.m_bunchEdgeEndPoints[t],r=this.m_bunchEdgeCenterPoints[e],o=this.m_bunchEdgeCenterPoints[t],a=this.m_shape.getNextVertex(r)===i,l=this.m_shape.getNextVertex(o)===s,c=a?this.m_shape.isCurve(r):this.m_shape.isCurve(i),h=l?this.m_shape.isCurve(o):this.m_shape.isCurve(s);return c||h?(this.m_sorterSegmentBuffer1||(this.m_sorterSegmentBuffer1=new n.SegmentBuffer),this.m_sorterSegmentBuffer2||(this.m_sorterSegmentBuffer2=new n.SegmentBuffer),a?this.m_shape.querySegment(r,this.m_sorterSegmentBuffer1,!1,!0):(this.m_shape.querySegment(i,this.m_sorterSegmentBuffer1,!1,!0),this.m_sorterSegmentBuffer1.get().reverse()),l?this.m_shape.querySegment(o,this.m_sorterSegmentBuffer2,!1,!0):(this.m_shape.querySegment(s,this.m_sorterSegmentBuffer2,!1,!0),this.m_sorterSegmentBuffer2.get().reverse()),n.compareConnectedSegments(this.m_sorterSegmentBuffer1.get(),this.m_sorterSegmentBuffer2.get())):this.compareAnglesLines_(e,t)}beforeRemoveVertex_(e,t){const i=this.m_shape.getUserIndex(e,this.m_userIndexSortedIndexToVertex);if(this.m_nextVertexToProcess===i&&(this.m_nextVertexToProcess=this.m_sortedVertices.getNext(this.m_nextVertexToProcess)),this.m_firstCoincidentVertex===i&&(this.m_firstCoincidentVertex=this.m_sortedVertices.getNext(this.m_firstCoincidentVertex)),this.m_sortedVertices.deleteElement(this.m_sortedVerticesListIndex,i),this.removeAngleSortInfo_(e),t){const t=this.m_shape.getPathFromVertex(e);if(t!==n.nullHandle&&this.m_shape.getFirstVertex(t)===e){const i=this.m_shape.getNextVertex(e);if(i!==e){if(this.m_shape.getPathFromVertex(i)===t)return void this.m_shape.setFirstVertex(t,i);{const i=this.m_shape.getPrevVertex(e);if(i!==e&&this.m_shape.getPathFromVertex(i)===t)return void this.m_shape.setFirstVertex(t,i)}}this.m_shape.setFirstVertex(t,n.nullHandle),this.m_shape.setLastVertex(t,n.nullHandle)}}}processBunch_(){let e=!1;const t=new r.Point2D(0,0);for(;;){this.m_bunchEdgeEndPoints.length=0,this.m_bunchEdgeCenterPoints.length=0,this.m_bunchEdgeIndices.length=0;let i=this.m_firstCoincidentVertex,n=0,r=!0;for(;i!==this.m_nextVertexToProcess;){const e=this.m_sortedVertices.getData(i);r&&(this.m_shape.queryXY(e,t),r=!1);const o=this.m_shape.getPrevVertex(e),a=this.m_shape.getNextVertex(e);this.m_shape.getUserIndex(o,this.m_userIndexSortedAngleIndexToVertex)!==s.c_deadBeef&&(this.m_bunchEdgeEndPoints.push(o),this.m_shape.setUserIndex(o,this.m_userIndexSortedAngleIndexToVertex,s.c_deadBeef),this.m_bunchEdgeCenterPoints.push(e),this.m_bunchEdgeIndices.push(n++)),this.m_shape.getUserIndex(a,this.m_userIndexSortedAngleIndexToVertex)!==s.c_deadBeef&&(this.m_bunchEdgeEndPoints.push(a),this.m_shape.setUserIndex(a,this.m_userIndexSortedAngleIndexToVertex,s.c_deadBeef),this.m_bunchEdgeCenterPoints.push(e),this.m_bunchEdgeIndices.push(n++)),i=this.m_sortedVertices.getNext(i)}if(this.m_bunchEdgeEndPoints.length<2){1===this.m_bunchEdgeEndPoints.length&&this.m_shape.setUserIndex(this.m_bunchEdgeEndPoints[0],this.m_userIndexSortedAngleIndexToVertex,-1);break}this.m_bunchEdgeIndices.sort(((e,t)=>this.compareAngles_(e,t)));for(let e=0,t=this.m_bunchEdgeIndices.length;e<t;e++){const t=this.m_bunchEdgeIndices[e],i=this.m_bunchEdgeEndPoints[t];this.m_shape.setUserIndex(i,this.m_userIndexSortedAngleIndexToVertex,e)}const o=this.processCrossOvers_(t);for(let e=0,t=this.m_bunchEdgeIndices.length;e<t;e++){const t=this.m_bunchEdgeIndices[e];if(-1===t)continue;const i=this.m_bunchEdgeEndPoints[t];this.m_shape.setUserIndex(i,this.m_userIndexSortedAngleIndexToVertex,-1)}if(!o)break;e=!0}return e}processCrossOvers_(e){let t=!1,i=!0;for(;i;){i=!1;let n=0;-1===this.m_bunchEdgeIndices[n]&&(n=this.getNextEdgeIndex_(n));let s=this.getNextEdgeIndex_(n);for(let r=0,o=this.m_bunchEdgeIndices.length;r<o&&-1!==n&&-1!==s&&n!==s;r++){const r=this.m_bunchEdgeIndices[n],o=this.m_bunchEdgeIndices[s],a=this.m_bunchEdgeEndPoints[r],l=this.m_bunchEdgeEndPoints[o];let c=this.m_shape.getNextVertex(a),h=!1;this.m_shape.isEqualXYPoint2D(c,e)||(c=this.m_shape.getPrevVertex(a),h=!0);let u=this.m_shape.getNextVertex(l),m=!1;this.m_shape.isEqualXYPoint2D(u,e)||(u=this.m_shape.getPrevVertex(l),m=!0);const d=h?this.m_shape.getPrevVertex(c):this.m_shape.getNextVertex(c),p=m?this.m_shape.getPrevVertex(u):this.m_shape.getNextVertex(u);let g=!1;(this.removeSpike_(c)||this.removeSpike_(u)||this.removeSpike_(a)||this.removeSpike_(l)||this.removeSpike_(d)||this.removeSpike_(p))&&(g=!0),c!==u&&(!g&&this.m_shape.isEqualXY(a,l)&&(g=this.resolveOverlap_(h,m,c,a,u,l)),!g&&this.m_shape.isEqualXY(d,p)&&(g=this.resolveOverlap_(!h,!m,c,d,u,p)),!g&&this.m_shape.isEqualXY(a,p)&&(g=this.resolveOverlap_(h,!m,c,a,u,p)),!g&&this.m_shape.isEqualXY(d,l)&&(g=this.resolveOverlap_(!h,m,c,d,u,l))),g&&(t=!0),i||=g,n=g?this.getNextEdgeIndex_(n):s,s=this.getNextEdgeIndex_(n)}}if(!t){let i=0;-1===this.m_bunchEdgeIndices[i]&&(i=this.getNextEdgeIndex_(i));let n=this.getNextEdgeIndex_(i);for(let s=0,r=this.m_bunchEdgeIndices.length;s<r&&-1!==i&&-1!==n&&i!==n;s++){const s=this.m_bunchEdgeIndices[i],r=this.m_bunchEdgeIndices[n],o=this.m_bunchEdgeEndPoints[s],a=this.m_bunchEdgeEndPoints[r];let l=this.m_shape.getNextVertex(o);this.m_shape.isEqualXYPoint2D(l,e)||(l=this.m_shape.getPrevVertex(o));let c=this.m_shape.getNextVertex(a);this.m_shape.isEqualXYPoint2D(c,e)||(c=this.m_shape.getPrevVertex(a));const h=this.getDirection_(l,o),u=this.getDirection_(c,a),m=h?this.m_shape.getPrevVertex(l):this.m_shape.getNextVertex(l),d=u?this.m_shape.getPrevVertex(c):this.m_shape.getNextVertex(c),p=this.detectAndResolveCrossOver_(h,u,o,l,m,a,c,d);1!==p?0===p?(i=this.getNextEdgeIndex_(i),n=this.getNextEdgeIndex_(i)):(i=this.getPrevEdgeIndex_(i),n=this.getNextEdgeIndex_(i)):t=!0}}return t}simplify_(){this.m_shape.getGeometryType(this.m_geometry)===i.GeometryType.enumPolygon&&1===this.m_shape.getFillRule(this.m_geometry)&&new Ti(this.m_progressTracker).planarSimplifyNoCrackingAndCluster(this.m_bFixSelfTangency,this.m_shape,this.m_geometry,0);let e=!1;this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=this.m_shape.createUserIndexUninitialized();const t=this.m_shape.getPointCount(this.m_geometry),o=new s.AttributeStreamOfInt32(0);this.m_shape.dbgVerifyMonotone();for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==n.nullHandle;e=this.m_shape.getNextPath(e)){let t=this.m_shape.getFirstVertex(e);for(let i=0,n=this.m_shape.getPathSize(e);i<n;i++)this.m_shape.setUserIndex(t,this.m_userIndexSortedAngleIndexToVertex,-1),o.add(t),t=this.m_shape.getNextVertex(t)}this.m_shape.sortVerticesSimpleByY(o,0,t),this.progress_(!0),this.m_userIndexSortedIndexToVertex=this.m_shape.createUserIndexUninitialized(),this.m_sortedVertices.reserveNodes(t),this.m_sortedVerticesListIndex=this.m_sortedVertices.createList(0);for(let e=0;e<t;e++){const t=o.read(e),i=this.m_sortedVertices.addElement(this.m_sortedVerticesListIndex,t);this.m_shape.setUserIndex(t,this.m_userIndexSortedIndexToVertex,i)}this.m_nextVertexToProcess=-1,this.cleanupSpikes_()&&(e=!0);let a=0,l=!1;do{l=!1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=this.m_sortedVertices.getFirst(this.m_sortedVerticesListIndex);const t=new r.Point2D(0,0);this.m_firstCoincidentVertex!==s.IndexMultiDCList.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(this.m_firstCoincidentVertex),t);let n=0,o=this.m_firstCoincidentVertex;for(;o!==s.IndexMultiDCList.st_nullNode()&&(o=this.m_sortedVertices.getNext(o),o!==s.IndexMultiDCList.st_nullNode());){this.progress_();const e=this.m_sortedVertices.getData(o),i=r.Point2D.getNAN();if(this.m_shape.queryXY(e,i),t.equals(i))n++;else{if(n>0){this.m_nextVertexToProcess=o;const e=this.processBunch_();o=this.m_nextVertexToProcess,o!==s.IndexMultiDCList.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(o),i),e&&(l=!0)}t.setCoordsPoint2D(i),this.m_firstCoincidentVertex=o,n=0}}this.m_nextVertexToProcess=-1,n>0&&this.processBunch_()&&(l=!0),a++>10&&i.throwInternalErrorException(""),l&&this.fixOrphanVertices_(),this.cleanupSpikes_()&&(l=!0),e||=l}while(l);return this.m_shape.dbgVerifyMonotone(),this.m_shape.dbgVerifyCurves(),this.m_shape.removeUserIndex(this.m_userIndexSortedIndexToVertex),this.m_shape.removeUserIndex(this.m_userIndexSortedAngleIndexToVertex),e=function(e,t,i,n,s){const r=new Ie(s);return r.m_shape=e,r.m_geometry=t,r.m_sortedVertices=i,r.m_bFixSelfTangency=n,r.fixRingOrientation_()}(this.m_shape,this.m_geometry,this.m_sortedVertices,this.m_bFixSelfTangency,this.m_progressTracker)||e,this.m_shape.dbgVerifyCurves(),e}getDirection_(e,t){return this.m_shape.getNextVertex(t)!==e}detectAndResolveCrossOver_(e,t,i,n,s,o,a,l){if(n===a)return this.removeAngleSortInfo_(i),this.removeAngleSortInfo_(o),-1;const c=this.m_shape.getUserIndex(i,this.m_userIndexSortedAngleIndexToVertex),h=this.m_shape.getUserIndex(s,this.m_userIndexSortedAngleIndexToVertex),u=this.m_shape.getUserIndex(o,this.m_userIndexSortedAngleIndexToVertex),m=this.m_shape.getUserIndex(l,this.m_userIndexSortedAngleIndexToVertex),d=r.makePrimitiveArray(8,Number.NaN),p=r.makePrimitiveArray(4,Number.NaN);d[0]=0,p[0]=c,d[1]=0,p[1]=h,d[2]=1,p[2]=u,d[3]=1,p[3]=m;for(let e=1;e<4;e++){const t=p[e],i=d[e];let n=e-1;for(;n>=0&&p[n]>t;)p[n+1]=p[n],d[n+1]=d[n],n--;p[n+1]=t,d[n+1]=i}let g=0;if(d[0]&&(g|=1),d[1]&&(g|=2),d[2]&&(g|=4),d[3]&&(g|=8),5!==g&&10!==g)return 0;if(e!==t&&(l=r.swap(o,o=l)),e)this.m_shape.setNextVertex(l,n),this.m_shape.setPrevVertex(n,l),this.m_shape.setNextVertex(s,a),this.m_shape.setPrevVertex(a,s),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(n,!0),this.m_shape.setSegmentParentageBreakVertex(a,!0));else{if(this.m_shape.setPrevVertex(l,n),this.m_shape.setNextVertex(n,l),this.m_shape.setPrevVertex(s,a),this.m_shape.setNextVertex(a,s),this.m_bHasSegmentParentage){const e=this.m_shape.getSegmentParentage(n),t=this.m_shape.getSegmentParentage(a);this.m_shape.setSegmentParentageAndBreak(n,t,!0),this.m_shape.setSegmentParentageAndBreak(a,e,!0)}if(this.m_bHasSegments){const e=this.m_shape.getVertexIndex(n),t=this.m_shape.getVertexIndex(a),i=this.m_shape.getSegmentFromIndex(e);this.m_shape.setSegmentToIndex(e,null);const s=this.m_shape.getSegmentFromIndex(t);this.m_shape.setSegmentToIndex(t,null),this.m_shape.setSegmentToIndex(e,s),this.m_shape.setSegmentToIndex(t,i)}}return 1}resolveOverlap_(e,t,i,n,s,r){return this.resolveOverlapOddEven_(e,t,i,n,s,r)}resolveOverlapOddEven_(e,t,i,n,s,o){if(e!==t){e||(s=r.swap(i,i=s),o=r.swap(n,n=o));const t=this.m_shape.getNextVertex(s),a=this.m_shape.getNextVertex(i);if(this.m_shape.setNextVertex(i,t),this.m_shape.setPrevVertex(t,i),this.m_shape.setNextVertex(s,a),this.m_shape.setPrevVertex(a,s),this.m_bHasSegments){const e=this.m_shape.getVertexIndex(i),t=this.m_shape.getVertexIndex(s),n=this.m_shape.getSegmentFromIndex(e);this.m_shape.setSegmentToIndex(e,null);const r=this.m_shape.getSegmentFromIndex(t);this.m_shape.setSegmentToIndex(t,null),this.m_shape.setSegmentToIndex(e,r),this.m_shape.setSegmentToIndex(t,n)}if(this.m_bHasSegmentParentage){const e=this.m_shape.getSegmentParentage(i),t=this.m_shape.getSegmentParentage(s);this.m_shape.setSegmentParentageAndBreak(i,t,!0),this.m_shape.setSegmentParentageAndBreak(s,e,!0),this.m_shape.setSegmentParentageBreakVertex(n,!0),this.m_shape.setSegmentParentageBreakVertex(o,!0)}this.removeSpike_(s)}else{const r=e?i:n,a=t?s:o,l=e?n:i,c=t?o:s;let h=null;if(this.m_bHasSegments){const e=this.m_shape.getVertexIndex(c);h=this.m_shape.getSegmentFromIndex(e),this.m_shape.setSegmentToIndex(e,null);const t=this.m_shape.getVertexIndex(a);this.m_shape.setSegmentToIndex(t,null);const i=this.m_shape.getVertexIndex(r);this.m_shape.setSegmentToIndex(i,null)}let u=-1;this.m_bHasSegmentParentage&&(u=this.m_shape.getSegmentParentage(c));let m=!1;this.m_shape.setNextVertex(r,a),this.m_shape.setNextVertex(a,r),this.m_shape.setPrevVertex(l,c),this.m_shape.setPrevVertex(c,l);let d=c;for(;d!==a;){const e=this.m_shape.getPrevVertex(d),t=this.m_shape.getNextVertex(d);if(this.m_shape.setPrevVertex(d,t),this.m_shape.setNextVertex(d,e),m||=d===r,this.m_bHasSegments&&d!==r){const e=this.m_shape.getVertexIndex(t),i=h;h=this.m_shape.getSegmentFromIndex(e),null!==i&&i.reverse(),this.m_shape.setSegmentToIndex(e,i)}if(this.m_bHasSegmentParentage){const e=this.m_shape.getSegmentParentage(t);this.m_shape.setSegmentParentagePreserveBreak(t,u),u=e}d=t}let p=null;if(!m){const e=this.m_shape.getPrevVertex(a),t=this.m_shape.getNextVertex(a);if(this.m_shape.setPrevVertex(a,t),this.m_shape.setNextVertex(a,e),this.m_bHasSegments){const e=this.m_shape.getVertexIndex(a);p=this.m_shape.getSegmentFromIndex(e),this.m_shape.setSegmentToIndex(e,null)}}let g=-1,_=-1;if(this.m_bHasSegmentParentage&&(g=m?this.m_shape.getSegmentParentage(r):this.m_shape.getSegmentParentage(a),_=this.m_shape.getSegmentParentage(l)),this.transferVertexData_(a,r),this.beforeRemoveVertex_(a,!0),this.m_shape.removeVertexInternal(a,!0),this.removeAngleSortInfo_(r),this.transferVertexData_(c,l),this.beforeRemoveVertex_(c,!0),this.m_shape.removeVertexInternal(c,!0),this.removeAngleSortInfo_(l),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageAndBreak(r,g,!0),this.m_shape.setSegmentParentageAndBreak(l,_,!0)),p){const e=this.m_shape.getVertexIndex(r);this.m_shape.setSegmentToIndex(e,p)}}return!0}cleanupSpikes_(){let e=!1;for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==n.nullHandle;){const i=this.m_shape.getNextPath(t);let s=this.m_shape.getFirstVertex(t);for(let i=0,r=this.m_shape.getPathSize(t);i<r&&r>1;){this.progress_();const{v:o,bModified:a}=this.checkAndCleanupSpike_(t,s);if(o===n.nullHandle)break;a?(e=!0,s=o,i=0,r=this.m_shape.getPathSize(t)):(s=o,i++)}t=i}return e}checkAndCleanupSpike_(e,t){const i={v:n.nullHandle,bModified:!1};let s=this.m_shape.getPrevVertex(t),r=this.m_shape.getNextVertex(t),o=n.nullHandle,a=n.nullHandle;for(;this.m_shape.isEqualXY(s,r)&&(o=s,a=r,r!==t);)s=this.m_shape.getPrevVertex(s),r=this.m_shape.getNextVertex(r);if(o===n.nullHandle)return i.v=r,i;i.bModified=!0;for(let e=this.m_shape.getNextVertex(o);this.beforeRemoveVertex_(e,!1),e!==a;e=this.m_shape.getNextVertex(e));if(o===t)return this.m_polylineDegeneracies!==n.nullHandle?this.m_shape.movePath(this.m_polylineDegeneracies,n.nullHandle,e):this.m_shape.removePath(e),i.v=n.nullHandle,i;{const e=this.m_shape.peelALoopIntoAPath(o,a);this.m_polylineDegeneracies!==n.nullHandle?this.m_shape.movePath(this.m_polylineDegeneracies,n.nullHandle,e):this.m_shape.removePath(e)}return i.v=o,i}removeSpike_(e){let t=this.m_shape.getPrevVertex(e),i=this.m_shape.getNextVertex(e),s=n.nullHandle,r=n.nullHandle;for(;this.m_shape.isEqualXY(t,i)&&(s=t,r=i,i!==e);)t=this.m_shape.getPrevVertex(t),i=this.m_shape.getNextVertex(i);if(s===n.nullHandle)return!1;if(this.m_shape.peelALoop(s,r),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(s,!0),this.m_shape.setSegmentParentageBreakVertex(r,!0)),this.removeAngleSortInfo_(s),this.m_polylineDegeneracies===n.nullHandle)for(let e=this.m_shape.getNextVertex(r);;){const t=this.m_shape.getNextVertex(e);if(this.removeAngleSortInfo_(e),this.beforeRemoveVertex_(e,!0),this.m_shape.setSegmentToIndex(this.m_shape.getVertexIndex(e),null),this.m_shape.removeVertexInternal(e,!1),e===r)break;e=t}else{for(let e=r;;){const t=this.m_shape.getNextVertex(e);if(this.removeAngleSortInfo_(e),this.beforeRemoveVertex_(e,!1),e=t,e===r)break}const e=[!1];this.m_shape.insertClosedPath(this.m_polylineDegeneracies,n.nullHandle,r,r,e)}return!0}fixOrphanVertices_(){let e=0;for(let e=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());-1!==e;e=this.m_sortedVertices.getNext(e)){const t=this.m_sortedVertices.getData(e);this.m_shape.setPathToVertex(t,n.nullHandle)}let t=0;for(let i=this.m_shape.getFirstPath(this.m_geometry);i!==n.nullHandle;){const s=this.m_shape.getFirstVertex(i);if(s===n.nullHandle||this.m_shape.getPathFromVertex(s)!==n.nullHandle){const e=i;i=this.m_shape.getNextPath(i),this.m_shape.removePathOnly(e);continue}this.m_shape.setPathToVertex(s,i);let r=1;for(let e=this.m_shape.getNextVertex(s);e!==s;e=this.m_shape.getNextVertex(e))this.m_shape.setPathToVertex(e,i),r++;this.m_shape.setRingAreaValid(i,!1),this.m_shape.setPathSize(i,r),this.m_shape.setLastVertex(i,this.m_shape.getPrevVertex(s)),t+=r,e++,i=this.m_shape.getNextPath(i)}for(let i=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());-1!==i;i=this.m_sortedVertices.getNext(i)){const s=this.m_sortedVertices.getData(i);if(this.m_shape.getPathFromVertex(s)!==n.nullHandle)continue;const r=[!1],o=this.m_shape.insertClosedPath(this.m_geometry,n.nullHandle,s,s,r);t+=this.m_shape.getPathSize(o),e++}this.m_shape.setGeometryPathCount(this.m_geometry,e),this.m_shape.setGeometryVertexCount(this.m_geometry,t);let i=0;for(let e=this.m_shape.getFirstGeometry();e!==n.nullHandle;e=this.m_shape.getNextGeometry(e))i+=this.m_shape.getPointCount(e);this.m_shape.setTotalPointCount(i)}getNextEdgeIndex_(e){if(-1===e)return-1;for(let t=0,i=this.m_bunchEdgeIndices.length-1;t<i;t++)if(e=(e+1)%this.m_bunchEdgeIndices.length,-1!==this.m_bunchEdgeIndices[e])return e;return-1}getPrevEdgeIndex_(e){if(-1===e)return-1;for(let t=0,i=this.m_bunchEdgeIndices.length-1;t<i;t++)if(e=(this.m_bunchEdgeIndices.length+e-1)%this.m_bunchEdgeIndices.length,-1!==this.m_bunchEdgeIndices[e])return e;return-1}transferVertexData_(e,t){const i=this.m_shape.getUserIndex(t,this.m_userIndexSortedIndexToVertex),n=this.m_shape.getUserIndex(t,this.m_userIndexSortedAngleIndexToVertex);this.m_shape.transferAllDataToTheVertex(e,t),this.m_shape.setUserIndex(t,this.m_userIndexSortedIndexToVertex,i),this.m_shape.setUserIndex(t,this.m_userIndexSortedAngleIndexToVertex,n)}removeAngleSortInfo_(e){const t=this.m_shape.getUserIndex(e,this.m_userIndexSortedAngleIndexToVertex);-1!==t&&(this.m_bunchEdgeIndices[t]=-1,this.m_shape.setUserIndex(e,this.m_userIndexSortedAngleIndexToVertex,-1))}progress_(e=!1){}}function Ne(e,o,a,l,c,h=!0){switch(Re(l)){case 0:break;case 1:i.throwInvalidArgumentException("relation string length has to be 9 characters");break;default:i.throwInvalidArgumentException("relation string")}if(h){const t=function(e,t,i){return function(e){return"T*F**FFF*"===e}(e)?3:function(e){return"FF*FF****"===e}(e)?4:function(e,t,i){return!(0===t&&0===i||(2===t&&2===i?"F***T****"!==e:2!==t&&1!==t||0!==i||"F**T*****"!==e))}(e,t,i)?8:function(e,t,i){return t>i?"T*****T**"===e:1===t&&1===i&&"0********"===e}(e,t,i)?16:function(e){return"T**FF*FF*"===e}(e)?64:function(e){return"T*****FF*"===e}(e)?1:function(e,t,i){return t===i&&(1!==t?"T*T***T**"===e:"1*T***T**"===e)}(e,t,i)?32:0}(l,e.getDimension(),o.getDimension());if(0!==t)return Ze(e,o,a,t,c)}let u=0;if("number"==typeof a)u=a;else{const i=t.Envelope2D.constructEmpty();e.queryEnvelope(i);const n=t.Envelope2D.constructEmpty();o.queryEnvelope(n);const r=t.Envelope2D.constructEmpty();r.setCoords({env2D:i}),r.mergeEnvelope2D(n),u=s.calculateToleranceFromGeometryForRel(a,r,!1)}const m=Ye(e,u),d=Ye(o,u);if(m.isEmpty()||d.isEmpty())return function(e,s,o){const a=r.makePrimitiveArray(9,-1);if(e.isEmpty()&&s.isEmpty())return qe(a,o);let l,c=!1;e.isEmpty()?(l=s,c=!0):l=e,a[0]=-1,a[1]=-1,a[3]=-1,a[4]=-1,a[6]=-1,a[7]=-1,a[8]=2;const h=l.getGeometryType();if(i.isMultiPath(h))if(h===i.GeometryType.enumPolygon)if(0!==l.calculateArea2D())a[2]=2,a[5]=1;else{a[5]=-1;const e=t.Envelope2D.constructEmpty();l.queryEnvelope(e),a[2]=e.height()||e.width()?1:0}else{const e=0!==l.calculateLength2D();a[2]=e?1:0,a[5]=n.hasNonEmptyBoundary(l)?0:-1}else a[2]=0,a[5]=-1;return c&&ze(a),qe(a,o)}(m,d,l);const p=m.getGeometryType(),g=d.getGeometryType();let _=!1;switch(p){case i.GeometryType.enumPolygon:switch(g){case i.GeometryType.enumPolygon:_=function(e,i,r,o,a){const l=new Ue;l.resetMatrix_(),l.setPredicates_(o),l.setAreaAreaPredicates_();const c=t.Envelope2D.constructEmpty(),h=t.Envelope2D.constructEmpty();e.queryEnvelope(c),i.queryEnvelope(h);let u=!1;if($e(c,h,r)&&(l.areaAreaDisjointPredicates_(e,i),u=!0),u||Ke(e,i),!u){const t=new n.EditShape,o=t.addGeometry(e),c=t.addGeometry(i);l.setEditShapeCrackAndCluster_(t,new s.CombinedTolerance(r,0),a),l.computeMatrixTopoGraphHalfEdges_(o,c),l.m_topoGraph.removeShape()}return qe(l.m_matrix,l.m_scl)}(m,d,u,l,c);break;case i.GeometryType.enumPolyline:_=Oe(m,d,u,l,c);break;case i.GeometryType.enumPoint:_=Ve(m,d,u,l);break;case i.GeometryType.enumMultiPoint:_=Ge(m,d,u,l,c)}break;case i.GeometryType.enumPolyline:switch(g){case i.GeometryType.enumPolygon:_=Oe(d,m,u,Be(l),c);break;case i.GeometryType.enumPolyline:_=function(e,i,r,o,a){const l=new Ue;l.resetMatrix_(),l.setPredicates_(o),l.setLineLinePredicates_();const c=t.Envelope2D.constructEmpty(),h=t.Envelope2D.constructEmpty();e.queryEnvelope(c),i.queryEnvelope(h);let u=!1;if($e(c,h,r)&&(l.lineLineDisjointPredicates_(e,i),u=!0),u||Ke(e,i),!u){const t=new n.EditShape,o=t.addGeometry(e),c=t.addGeometry(i);l.setEditShapeCrackAndCluster_(t,new s.CombinedTolerance(r,0),a),l.m_clusterIndexA=l.m_topoGraph.createUserIndexForClusters(),l.m_clusterIndexB=l.m_topoGraph.createUserIndexForClusters(),He(o,l.m_topoGraph,l.m_clusterIndexA),He(c,l.m_topoGraph,l.m_clusterIndexB),l.computeMatrixTopoGraphHalfEdges_(o,c),l.m_topoGraph.deleteUserIndexForClusters(l.m_clusterIndexA),l.m_topoGraph.deleteUserIndexForClusters(l.m_clusterIndexB),l.m_topoGraph.removeShape()}return qe(l.m_matrix,l.m_scl)}(m,d,u,l,c);break;case i.GeometryType.enumPoint:_=Fe(m,d,u,l,c);break;case i.GeometryType.enumMultiPoint:_=ke(m,d,u,l,c)}break;case i.GeometryType.enumPoint:switch(g){case i.GeometryType.enumPolygon:_=Ve(d,m,u,Be(l));break;case i.GeometryType.enumPolyline:_=Fe(d,m,u,Be(l),c);break;case i.GeometryType.enumPoint:_=function(e,t,i,n){const s=e.getXY(),o=t.getXY(),a=r.makePrimitiveArray(9,-1);return r.Point2D.sqrDistance(s,o)<=i*i?a[0]=0:(a[2]=0,a[6]=0),a[8]=2,qe(a,n)}(m,d,u,l);break;case i.GeometryType.enumMultiPoint:_=Le(d,m,u,Be(l))}break;case i.GeometryType.enumMultiPoint:switch(g){case i.GeometryType.enumPolygon:_=Ge(d,m,u,Be(l),c);break;case i.GeometryType.enumPolyline:_=ke(d,m,u,Be(l),c);break;case i.GeometryType.enumMultiPoint:_=function(e,i,r,o,a){const l=new Ue;l.resetMatrix_(),l.setPredicates_(o),l.setPointPointPredicates_();const c=new t.Envelope2D,h=new t.Envelope2D;e.queryEnvelope(c),i.queryEnvelope(h);let u=!1;if($e(c,h,r)&&(l.pointPointDisjointPredicates_(),u=!0),!u){const t=new n.EditShape,o=t.addGeometry(e),c=t.addGeometry(i);l.setEditShapeCrackAndCluster_(t,new s.CombinedTolerance(r,0),a),l.computeMatrixTopoGraphClusters_(o,c),l.m_topoGraph.removeShape()}return qe(l.m_matrix,l.m_scl)}(m,d,u,l,c);break;case i.GeometryType.enumPoint:_=Le(m,d,u,l)}break;default:_=!1}return _}function Re(e){if(9!==e.length)return 1;for(let t=0;t<9;t++){const i=e[t];if("*"!==i&&"T"!==i&&"F"!==i&&"0"!==i&&"1"!==i&&"2"!==i)return 2}return 0}function Oe(e,i,r,o,a){const l=new Ue;l.resetMatrix_(),l.setPredicates_(o),l.setAreaLinePredicates_();const c=t.Envelope2D.constructEmpty(),h=t.Envelope2D.constructEmpty();e.queryEnvelope(c),i.queryEnvelope(h);let u=!1;if($e(c,h,r)&&(l.areaLineDisjointPredicates_(e,i),u=!0),u||Ke(e,i),!u){const t=new n.EditShape,o=t.addGeometry(e),c=t.addGeometry(i);l.setEditShapeCrackAndCluster_(t,new s.CombinedTolerance(r,0),a),l.m_clusterIndexB=l.m_topoGraph.createUserIndexForClusters(),He(c,l.m_topoGraph,l.m_clusterIndexB),l.computeMatrixTopoGraphHalfEdges_(o,c),l.m_topoGraph.deleteUserIndexForClusters(l.m_clusterIndexB),l.m_topoGraph.removeShape()}return qe(l.m_matrix,l.m_scl)}function Ge(e,i,r,o,a){const l=new Ue;l.resetMatrix_(),l.setPredicates_(o),l.setAreaPointPredicates_();const c=t.Envelope2D.constructEmpty(),h=t.Envelope2D.constructEmpty();e.queryEnvelope(c),i.queryEnvelope(h);let u=!1;if($e(c,h,r)&&(l.areaPointDisjointPredicates_(e),u=!0),u||Ke(e,i),!u){const t=new n.EditShape,o=t.addGeometry(e),c=t.addGeometry(i);l.setEditShapeCrackAndCluster_(t,new s.CombinedTolerance(r,0),a),l.computeMatrixTopoGraphClusters_(o,c),l.m_topoGraph.removeShape()}return qe(l.m_matrix,l.m_scl)}function ke(e,i,r,o,a){const l=new Ue;l.resetMatrix_(),l.setPredicates_(o),l.setLinePointPredicates_();const c=t.Envelope2D.constructEmpty(),h=t.Envelope2D.constructEmpty();e.queryEnvelope(c),i.queryEnvelope(h);let u=!1;if($e(c,h,r)&&(l.linePointDisjointPredicates_(e),u=!0),u||Ke(e,i),!u){const t=new n.EditShape,o=t.addGeometry(e),c=t.addGeometry(i);l.setEditShapeCrackAndCluster_(t,new s.CombinedTolerance(r,0),a),l.m_clusterIndexA=l.m_topoGraph.createUserIndexForClusters(),He(o,l.m_topoGraph,l.m_clusterIndexA),l.computeMatrixTopoGraphClusters_(o,c),l.m_topoGraph.deleteUserIndexForClusters(l.m_clusterIndexA),l.m_topoGraph.removeShape()}return qe(l.m_matrix,l.m_scl)}function Ve(e,i,n,s,r){const o=new Ue;o.resetMatrix_(),o.setPredicates_(s),o.setAreaPointPredicates_();const a=t.Envelope2D.constructEmpty();e.queryEnvelope(a);const l=i.getXY();let c=!1;if(Je(l,a,n)&&(o.areaPointDisjointPredicates_(e),c=!0),!c){const i=Qt(e,l,n);if(1===i)o.m_matrix[0]=0,o.m_matrix[2]=2,o.m_matrix[3]=-1,o.m_matrix[5]=1,o.m_matrix[6]=-1;else if(2===i)if(o.m_matrix[6]=-1,0!==e.calculateArea2D())o.m_matrix[0]=-1,o.m_matrix[3]=0,o.m_matrix[2]=2,o.m_matrix[5]=1;else{o.m_matrix[0]=0,o.m_matrix[3]=-1,o.m_matrix[5]=-1;const i=t.Envelope2D.constructEmpty();e.queryEnvelope(i),o.m_matrix[2]=i.height()||i.width()?1:-1}else o.areaPointDisjointPredicates_(e)}return qe(o.m_matrix,s)}function Fe(e,i,s,r,o){const a=new Ue;a.resetMatrix_(),a.setPredicates_(r),a.setLinePointPredicates_();const l=t.Envelope2D.constructEmpty();e.queryEnvelope(l);let c=!1;if(Je(i.getXY(),l,s)&&(a.linePointDisjointPredicates_(e),c=!0),!c){let t=null,r=!1,l=!1;if((a.m_performPredicates[0]||a.m_performPredicates[6])&&(Ze(e,i,s,4,o)?(a.m_matrix[0]=-1,a.m_matrix[6]=0):(a.m_performPredicates[0]&&(t=n.calculate(e),l=!Ze(t,i,s,4,o),r=!0,a.m_matrix[0]=l?-1:0),a.m_matrix[6]=-1)),a.m_performPredicates[3]&&(null!==t&&t.isEmpty()?a.m_matrix[3]=-1:(r||(null==t&&(t=n.calculate(e)),l=!Ze(t,i,s,4,o),r=!0),a.m_matrix[3]=l?0:-1)),a.m_performPredicates[5])if(null!==t&&t.isEmpty())a.m_matrix[5]=-1;else if(r&&!l)a.m_matrix[5]=0;else{null===t&&(t=n.calculate(e));const r=Ze(t,i,s,3,o);a.m_matrix[5]=r?-1:0}if(a.m_performPredicates[2])if(0!==e.calculateLength2D())a.m_matrix[2]=1;else{const t=new n.MultiPoint({vd:e.getDescription()});t.addPoints(e,0,e.getPointCount());const r=Ze(t,i,s,3,o);a.m_matrix[2]=r?-1:0}}return qe(a.m_matrix,a.m_scl)}function Le(e,i,n,s,o){const a=new Ue;a.resetMatrix_(),a.setPredicates_(s),a.setPointPointPredicates_();const l=t.Envelope2D.constructEmpty();e.queryEnvelope(l);const c=i.getXY(),h=new r.Point2D;let u=!1;if(Je(c,l,n)&&(a.pointPointDisjointPredicates_(),u=!0),!u){let t=!1,i=!0;const s=n*n;for(let n=0;n<e.getPointCount()&&(e.queryXY(n,h),r.Point2D.sqrDistance(h,c)<=s?t=!0:i=!1,!t||i);n++);t?(a.m_matrix[0]=0,a.m_matrix[2]=i?-1:0,a.m_matrix[6]=-1):(a.m_matrix[0]=-1,a.m_matrix[2]=0,a.m_matrix[6]=0)}return qe(a.m_matrix,s)}function qe(e,t){for(let i=0;i<9;i++)switch(t[i]){case"T":if(-1===e[i])return!1;break;case"F":if(-1!==e[i])return!1;break;case"0":if(0!==e[i])return!1;break;case"1":if(1!==e[i])return!1;break;case"2":if(2!==e[i])return!1}return!0}function He(e,t,i){const s=t.getGeometryID(e);for(let e=t.getFirstCluster();e!==n.nullHandle;e=t.getNextCluster(e)){if(0===(t.getClusterParentage(e)&s))continue;const r=t.getClusterHalfEdge(e);if(r===n.nullHandle){t.setClusterUserIndex(e,i,0);continue}let o=r,a=0;do{const e=o;0!==(t.getHalfEdgeParentage(e)&s)&&a++,o=t.getHalfEdgeNext(t.getHalfEdgeTwin(e))}while(o!==r);t.setClusterUserIndex(e,i,a)}}class Ue{nullFunc(){return i.throwInternalErrorException("should not be called"),!1}constructor(){this.m_clusterIndexA=-1,this.m_clusterIndexB=-1,this.m_visitedIndex=-1,this.m_topoGraph=new X,this.m_matrix=r.makePrimitiveArray(9,0),this.m_maxDim=r.makePrimitiveArray(9,0),this.m_performPredicates=r.makePrimitiveArray(9,!1),this.m_scl="",this.m_predicateCount=0,this.m_predicatesHalfEdge=this.nullFunc,this.m_predicatesCluster=this.nullFunc}resetMatrix_(){this.m_matrix.fill(-2),this.m_maxDim.fill(-2)}setPredicates_(e){this.m_scl=e;for(let e=0;e<9;e++)"*"!==this.m_scl[e]?(this.m_performPredicates[e]=!0,this.m_predicateCount++):this.m_performPredicates[e]=!1}setRemainingPredicatesToFalse_(){for(let e=0;e<9;e++)this.m_performPredicates[e]&&-2===this.m_matrix[e]&&(this.m_matrix[e]=-1,this.m_performPredicates[e]=!1)}isPredicateKnown_(e){return!(-2===this.m_matrix[e]||(-1===this.m_matrix[e]?(this.m_performPredicates[e]=!1,this.m_predicateCount--,0):"T"!==this.m_scl[e]&&"F"!==this.m_scl[e]&&this.m_matrix[e]<this.m_maxDim[e]||(this.m_performPredicates[e]=!1,this.m_predicateCount--,0)))}setAreaAreaPredicates_(){this.m_predicatesHalfEdge=this.areaAreaPredicates_,this.m_maxDim[0]=2,this.m_maxDim[1]=1,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=1,this.m_maxDim[5]=1,this.m_maxDim[6]=2,this.m_maxDim[7]=1,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaLinePredicates_(){this.m_predicatesHalfEdge=this.areaLinePredicates_,this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=0,this.m_maxDim[5]=1,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLineLinePredicates_(){this.m_predicatesHalfEdge=this.lineLinePredicates_,this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=0,this.m_maxDim[5]=0,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaPointPredicates_(){this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=2,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLinePointPredicates_(){this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=0,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setPointPointPredicates_(){this.m_predicatesCluster=this.pointPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=0,this.m_maxDim[3]=-1,this.m_maxDim[4]=-1,this.m_maxDim[5]=-1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[3]&&(this.m_matrix[3]=-1,this.m_performPredicates[3]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[5]&&(this.m_matrix[5]=-1,this.m_performPredicates[5]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}areaAreaDisjointPredicates_(e,t){this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5]),this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[6]?6:-1,this.m_scl[6],this.m_performPredicates[7]?7:-1,this.m_scl[7])}areaGeomContainsOrDisjointPredicates_(e,i,n,s,r){const o=-1!==i,a=-1!==s;if(o||a)if(("T"!==n&&"F"!==n&&o||"T"!==r&&"F"!==r&&a)&&0===e.calculateArea2D()){if(a&&(this.m_matrix[s]=-1),o){const n=t.Envelope2D.constructEmpty();e.queryEnvelope(n),this.m_matrix[i]=n.height()||n.width()?1:0}}else o&&(this.m_matrix[i]=2),a&&(this.m_matrix[s]=1)}areaAreaContainsPredicates_(e){this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[0]?0:-1,this.m_scl[0],this.m_performPredicates[1]?1:-1,this.m_scl[1])}areaAreaWithinPredicates_(e){this.areaAreaContainsPredicates_(e),ze(this.m_matrix)}areaLineDisjointPredicates_(e,t){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[6]){const e=this.m_scl[6],i="T"===e||"F"===e||0!==t.calculateLength2D();this.m_matrix[6]=i?1:0}if(this.m_performPredicates[7]){const e=n.hasNonEmptyBoundary(t);this.m_matrix[7]=e?0:-1}this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaLineContainsPredicates_(e,t){if(this.m_performPredicates[0]){const e=this.m_scl[0],i="T"===e||"F"===e||0!==t.calculateLength2D();this.m_matrix[0]=i?1:0}if(this.m_performPredicates[1]){const e=n.hasNonEmptyBoundary(t);this.m_matrix[1]=e?0:-1}this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1}areaPointDisjointPredicates_(e){this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_matrix[6]=0,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaPointContainsPredicates_(e){this.m_matrix[0]=0,this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1}lineLineDisjointPredicates_(e,t){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[2]){const t=this.m_scl[2],i="T"===t||"F"===t||0!==e.calculateLength2D();this.m_matrix[2]=i?1:0}if(this.m_performPredicates[5]){const t=n.hasNonEmptyBoundary(e);this.m_matrix[5]=t?0:-1}if(this.m_performPredicates[6]){const e=this.m_scl[6],i="T"===e||"F"===e||0!==t.calculateLength2D();this.m_matrix[6]=i?1:0}if(this.m_performPredicates[7]){const e=n.hasNonEmptyBoundary(t);this.m_matrix[7]=e?0:-1}}linePointDisjointPredicates_(e){if(this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_performPredicates[2]){const t=this.m_scl[2],i="T"===t||"F"===t||0!==e.calculateLength2D();this.m_matrix[2]=i?1:0}if(this.m_performPredicates[5]){const t=n.hasNonEmptyBoundary(e);this.m_matrix[5]=t?0:-1}this.m_matrix[6]=0}pointPointDisjointPredicates_(){this.m_matrix[0]=-1,this.m_matrix[2]=0,this.m_matrix[6]=0}areaAreaPredicates_(e,t,i){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorArea_(e,t,i);const s=this.isPredicateKnown_(0);n&&=s}if(this.m_performPredicates[1]){this.interiorAreaBoundaryArea_(e,t,1);const i=this.isPredicateKnown_(1);n&&=i}if(this.m_performPredicates[2]){this.interiorAreaExteriorArea_(e,t,i,2);const s=this.isPredicateKnown_(2);n&&=s}if(this.m_performPredicates[3]){this.interiorAreaBoundaryArea_(e,i,3);const t=this.isPredicateKnown_(3);n&&=t}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryArea_(e,t,i);const s=this.isPredicateKnown_(4);n&&=s}if(this.m_performPredicates[5]){this.boundaryAreaExteriorArea_(e,t,i,5);const s=this.isPredicateKnown_(5);n&&=s}if(this.m_performPredicates[6]){this.interiorAreaExteriorArea_(e,i,t,6);const s=this.isPredicateKnown_(6);n&&=s}if(this.m_performPredicates[7]){this.boundaryAreaExteriorArea_(e,i,t,7);const s=this.isPredicateKnown_(7);n&&=s}return n}areaLinePredicates_(e,t,i){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorLine_(e,t,i);const s=this.isPredicateKnown_(0);n&&=s}if(this.m_performPredicates[1]){this.interiorAreaBoundaryLine_(e,t,i,this.m_clusterIndexB);const s=this.isPredicateKnown_(1);n&&=s}if(this.m_performPredicates[2]){this.interiorAreaExteriorLine_(e,t,i);const s=this.isPredicateKnown_(2);n&&=s}if(this.m_performPredicates[3]){this.boundaryAreaInteriorLine_(e,t,i,this.m_clusterIndexB);const s=this.isPredicateKnown_(3);n&&=s}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryLine_(e,t,i,this.m_clusterIndexB);const s=this.isPredicateKnown_(4);n&&=s}if(this.m_performPredicates[5]){this.boundaryAreaExteriorLine_(e,t,i);const s=this.isPredicateKnown_(5);n&&=s}if(this.m_performPredicates[6]){this.exteriorAreaInteriorLine_(e,t);const i=this.isPredicateKnown_(6);n&&=i}if(this.m_performPredicates[7]){this.exteriorAreaBoundaryLine_(e,t,i,this.m_clusterIndexB);const s=this.isPredicateKnown_(7);n&&=s}return n}lineLinePredicates_(e,t,i){let n=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorLine_(e,t,i,this.m_clusterIndexA,this.m_clusterIndexB);const s=this.isPredicateKnown_(0);n&&=s}if(this.m_performPredicates[1]){this.interiorLineBoundaryLine_(e,t,i,this.m_clusterIndexA,this.m_clusterIndexB,1);const s=this.isPredicateKnown_(1);n&&=s}if(this.m_performPredicates[2]){this.interiorLineExteriorLine_(e,t,i,2);const s=this.isPredicateKnown_(2);n&&=s}if(this.m_performPredicates[3]){this.interiorLineBoundaryLine_(e,i,t,this.m_clusterIndexB,this.m_clusterIndexA,3);const s=this.isPredicateKnown_(3);n&&=s}if(this.m_performPredicates[4]){this.boundaryLineBoundaryLine_(e,t,i,this.m_clusterIndexA,this.m_clusterIndexB);const s=this.isPredicateKnown_(4);n&&=s}if(this.m_performPredicates[5]){this.boundaryLineExteriorLine_(e,t,i,this.m_clusterIndexA,5);const s=this.isPredicateKnown_(5);n&&=s}if(this.m_performPredicates[6]){this.interiorLineExteriorLine_(e,i,t,6);const s=this.isPredicateKnown_(6);n&&=s}if(this.m_performPredicates[7]){this.boundaryLineExteriorLine_(e,i,t,this.m_clusterIndexB,7);const s=this.isPredicateKnown_(7);n&&=s}return n}areaPointPredicates_(e,t,i){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorPoint_(e,t);const i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[2]){this.interiorAreaExteriorPoint_(e,t);const i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.boundaryAreaInteriorPoint_(e,t,i);const s=this.isPredicateKnown_(3);n&&=s}if(this.m_performPredicates[5]){this.boundaryAreaExteriorPoint_(e,t);const i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.exteriorAreaInteriorPoint_(e,t);const i=this.isPredicateKnown_(6);n&&=i}return n}linePointPredicates_(e,t,i){let n=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorPoint_(e,t,i,this.m_clusterIndexA);const s=this.isPredicateKnown_(0);n&&=s}if(this.m_performPredicates[2]){this.interiorLineExteriorPoint_(e,t,i,this.m_clusterIndexA);const s=this.isPredicateKnown_(2);n&&=s}if(this.m_performPredicates[3]){this.boundaryLineInteriorPoint_(e,t,i,this.m_clusterIndexA);const s=this.isPredicateKnown_(3);n&&=s}if(this.m_performPredicates[5]){this.boundaryLineExteriorPoint_(e,t,i,this.m_clusterIndexA);const s=this.isPredicateKnown_(5);n&&=s}if(this.m_performPredicates[6]){this.exteriorLineInteriorPoint_(e,t,i);const s=this.isPredicateKnown_(6);n&&=s}return n}pointPointPredicates_(e,t,i){let n=!0;if(this.m_performPredicates[0]){this.interiorPointInteriorPoint_(e,t,i);const s=this.isPredicateKnown_(0);n&&=s}if(this.m_performPredicates[2]){this.interiorPointExteriorPoint_(e,t,i,2);const s=this.isPredicateKnown_(2);n&&=s}if(this.m_performPredicates[6]){this.interiorPointExteriorPoint_(e,i,t,6);const s=this.isPredicateKnown_(6);n&&=s}return n}interiorAreaInteriorArea_(e,t,i){if(2===this.m_matrix[0])return;const n=this.m_topoGraph.getHalfEdgeFaceParentage(e);0!==(n&t)&&0!==(n&i)&&(this.m_matrix[0]=2)}interiorAreaBoundaryArea_(e,t,i){if(1===this.m_matrix[i])return;const n=this.m_topoGraph.getHalfEdgeFaceParentage(e),s=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));0!==(n&t)&&0!==(s&t)&&(this.m_matrix[i]=1)}interiorAreaExteriorArea_(e,t,i,n){if(2===this.m_matrix[n])return;const s=this.m_topoGraph.getHalfEdgeFaceParentage(e);0!==(s&t)&&0===(s&i)&&(this.m_matrix[n]=2)}boundaryAreaBoundaryArea_(e,t,i){if(1===this.m_matrix[4])return;const n=this.m_topoGraph.getHalfEdgeParentage(e);if(0===(n&t)||0===(n&i)){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const n=this.m_topoGraph.getHalfEdgeTo(e),s=this.m_topoGraph.getClusterParentage(n);if(0!==(s&t)&&0!==(s&i))return void(this.m_matrix[4]=0)}}else this.m_matrix[4]=1}boundaryAreaExteriorArea_(e,t,i,n){if(1===this.m_matrix[n])return;const s=this.m_topoGraph.getHalfEdgeFaceParentage(e),r=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));0===(s&i)&&0===(r&i)&&(this.m_matrix[n]=1)}interiorAreaInteriorLine_(e,t,i){if(1===this.m_matrix[0])return;const n=this.m_topoGraph.getHalfEdgeFaceParentage(e),s=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));0!==(n&t)&&0!==(s&t)&&(this.m_matrix[0]=1)}interiorAreaBoundaryLine_(e,t,i,n){if(0!==this.m_matrix[1]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const s=this.m_topoGraph.getHalfEdgeTo(e),r=this.m_topoGraph.getClusterParentage(s);if(0===(r&t)&&0!==(this.m_topoGraph.getHalfEdgeFaceParentage(e)&t)){const e=this.m_topoGraph.getClusterUserIndex(s,n);if(0!==(r&i)&&e%2!=0)return void(this.m_matrix[1]=0)}}}interiorAreaExteriorLine_(e,t,i){2!==this.m_matrix[2]&&0!==(this.m_topoGraph.getHalfEdgeParentage(e)&t)&&(this.m_matrix[2]=2)}boundaryAreaInteriorLine_(e,t,i,n){if(1===this.m_matrix[3])return;const s=this.m_topoGraph.getHalfEdgeParentage(e);if(0===(s&t)||0===(s&i)){if(0!==this.m_matrix[3]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const s=this.m_topoGraph.getHalfEdgeTo(e),r=this.m_topoGraph.getClusterParentage(s);if(0!==(r&t)){const e=this.m_topoGraph.getClusterUserIndex(s,n);if(0!==(r&i)&&e%2==0)return void(this.m_matrix[3]=0)}}}else this.m_matrix[3]=1}boundaryAreaBoundaryLine_(e,t,i,n){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const s=this.m_topoGraph.getHalfEdgeTo(e),r=this.m_topoGraph.getClusterParentage(s);if(0!==(r&t)){const e=this.m_topoGraph.getClusterUserIndex(s,n);if(0!==(r&i)&&e%2!=0)return void(this.m_matrix[4]=0)}}}boundaryAreaExteriorLine_(e,t,i){if(1===this.m_matrix[5])return;const n=this.m_topoGraph.getHalfEdgeParentage(e);0!==(n&t)&&0===(n&i)&&(this.m_matrix[5]=1)}exteriorAreaInteriorLine_(e,t){if(1===this.m_matrix[6])return;const i=this.m_topoGraph.getHalfEdgeFaceParentage(e),n=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));0===(i&t)&&0===(n&t)&&(this.m_matrix[6]=1)}exteriorAreaBoundaryLine_(e,t,i,n){if(0!==this.m_matrix[7]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const s=this.m_topoGraph.getHalfEdgeTo(e),r=this.m_topoGraph.getClusterParentage(s);if(0===(r&t)&&0===(this.m_topoGraph.getHalfEdgeFaceParentage(e)&t)){const e=this.m_topoGraph.getClusterUserIndex(s,n);if(0!==(r&i)&&e%2!=0)return void(this.m_matrix[7]=0)}}}interiorLineInteriorLine_(e,t,i,n,s){if(1===this.m_matrix[0])return;const r=this.m_topoGraph.getHalfEdgeParentage(e);if(0===(r&t)||0===(r&i)){if(0!==this.m_matrix[0]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const r=this.m_topoGraph.getHalfEdgeTo(e),o=this.m_topoGraph.getClusterParentage(r);if(0!==(o&t)&&0!==(o&i)){const e=this.m_topoGraph.getClusterUserIndex(r,n),t=this.m_topoGraph.getClusterUserIndex(r,s);if(e%2==0&&t%2==0)return void(this.m_matrix[0]=0)}}}else this.m_matrix[0]=1}interiorLineBoundaryLine_(e,t,i,n,s,r){if(0!==this.m_matrix[r]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const o=this.m_topoGraph.getHalfEdgeTo(e),a=this.m_topoGraph.getClusterParentage(o);if(0!==(a&t)&&0!==(a&i)){const e=this.m_topoGraph.getClusterUserIndex(o,n),t=this.m_topoGraph.getClusterUserIndex(o,s);if(e%2==0&&t%2!=0)return void(this.m_matrix[r]=0)}}}interiorLineExteriorLine_(e,t,i,n){if(1===this.m_matrix[n])return;const s=this.m_topoGraph.getHalfEdgeParentage(e);0!==(s&t)&&0===(s&i)&&(this.m_matrix[n]=1)}boundaryLineBoundaryLine_(e,t,i,n,s){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const r=this.m_topoGraph.getHalfEdgeTo(e),o=this.m_topoGraph.getClusterParentage(r);if(0!==(o&t)&&0!==(o&i)){const e=this.m_topoGraph.getClusterUserIndex(r,n),t=this.m_topoGraph.getClusterUserIndex(r,s);if(e%2!=0&&t%2!=0)return void(this.m_matrix[4]=0)}}}boundaryLineExteriorLine_(e,t,i,n,s){if(0!==this.m_matrix[s]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const t=this.m_topoGraph.getHalfEdgeTo(e);if(0===(this.m_topoGraph.getClusterParentage(t)&i)&&this.m_topoGraph.getClusterUserIndex(t,n)%2!=0)return void(this.m_matrix[s]=0)}}interiorAreaInteriorPoint_(e,t){if(0!==this.m_matrix[0]&&0===(this.m_topoGraph.getClusterParentage(e)&t)){const i=this.m_topoGraph.getClusterChain(e);if(0!==(this.m_topoGraph.getChainParentage(i)&t))return void(this.m_matrix[0]=0)}}interiorAreaExteriorPoint_(e,t){2!==this.m_matrix[2]&&0!==(this.m_topoGraph.getClusterParentage(e)&t)&&(this.m_matrix[2]=2)}boundaryAreaInteriorPoint_(e,t,i){if(0===this.m_matrix[3])return;const n=this.m_topoGraph.getClusterParentage(e);0===(n&t)||0===(n&i)||(this.m_matrix[3]=0)}boundaryAreaExteriorPoint_(e,t){1!==this.m_matrix[5]&&0!==(this.m_topoGraph.getClusterParentage(e)&t)&&(this.m_matrix[5]=1)}exteriorAreaInteriorPoint_(e,t){if(0!==this.m_matrix[6]&&0===(this.m_topoGraph.getClusterParentage(e)&t)){const i=this.m_topoGraph.getClusterChain(e);if(0===(this.m_topoGraph.getChainParentage(i)&t))return void(this.m_matrix[6]=0)}}interiorLineInteriorPoint_(e,t,i,n){if(0===this.m_matrix[0])return;const s=this.m_topoGraph.getClusterParentage(e);0===(s&t)||0===(s&i)||this.m_topoGraph.getClusterUserIndex(e,n)%2!=0||(this.m_matrix[0]=0)}interiorLineExteriorPoint_(e,t,i,n){if(1!==this.m_matrix[2])if(-1===this.m_topoGraph.getClusterHalfEdge(e)){if(0!==this.m_matrix[2]&&0===(this.m_topoGraph.getClusterParentage(e)&i))return void(this.m_matrix[2]=0)}else this.m_matrix[2]=1}boundaryLineInteriorPoint_(e,t,i,n){if(0===this.m_matrix[3])return;const s=this.m_topoGraph.getClusterParentage(e);0===(s&t)||0===(s&i)||this.m_topoGraph.getClusterUserIndex(e,n)%2==0||(this.m_matrix[3]=0)}boundaryLineExteriorPoint_(e,t,i,n){if(0===this.m_matrix[5])return;const s=this.m_topoGraph.getClusterParentage(e);0===(s&t)||0!==(s&i)||this.m_topoGraph.getClusterUserIndex(e,n)%2==0||(this.m_matrix[5]=0)}exteriorLineInteriorPoint_(e,t,i){if(0===this.m_matrix[6])return;const n=this.m_topoGraph.getClusterParentage(e);0!==(n&t)||0===(n&i)||(this.m_matrix[6]=0)}interiorPointInteriorPoint_(e,t,i){if(0===this.m_matrix[0])return;const n=this.m_topoGraph.getClusterParentage(e);0===(n&t)||0===(n&i)||(this.m_matrix[0]=0)}interiorPointExteriorPoint_(e,t,i,n){if(0===this.m_matrix[n])return;const s=this.m_topoGraph.getClusterParentage(e);0===(s&t)||0!==(s&i)||(this.m_matrix[n]=0)}computeMatrixTopoGraphHalfEdges_(e,t){let i=!1;const s=this.m_topoGraph.getGeometryID(e),r=this.m_topoGraph.getGeometryID(t);this.m_visitedIndex=this.m_topoGraph.createUserIndexForHalfEdges();for(let e=this.m_topoGraph.getFirstCluster();e!==n.nullHandle;e=this.m_topoGraph.getNextCluster(e)){const t=this.m_topoGraph.getClusterHalfEdge(e);if(t===n.nullHandle){if(null!==this.m_predicatesCluster&&(i=this.m_predicatesCluster(e,s,r),i))break;continue}let o=t;do{let e=o;if(1!==this.m_topoGraph.getHalfEdgeUserIndex(e,this.m_visitedIndex))do{if(i=this.m_predicatesHalfEdge(e,s,r),i)break;this.m_topoGraph.setHalfEdgeUserIndex(e,this.m_visitedIndex,1),e=this.m_topoGraph.getHalfEdgeNext(e)}while(e!==o&&!i);if(i)break;o=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(e))}while(o!==t);if(i)break}i||this.setRemainingPredicatesToFalse_(),this.m_topoGraph.deleteUserIndexForHalfEdges(this.m_visitedIndex)}computeMatrixTopoGraphClusters_(e,t){let i=!1;const s=this.m_topoGraph.getGeometryID(e),r=this.m_topoGraph.getGeometryID(t);for(let e=this.m_topoGraph.getFirstCluster();e!==n.nullHandle&&(i=this.m_predicatesCluster(e,s,r),!i);e=this.m_topoGraph.getNextCluster(e));i||this.setRemainingPredicatesToFalse_()}setEditShape_(e,t){this.m_topoGraph.setEditShape(e,t)}setEditShapeCrackAndCluster_(e,t,s){let r=0;if(e.hasCurves()){const i=new li,n=e.getEnvelope2D(s),o=ri(t.total(),n);r=ai(o,0),ii(e,o,t.total(),0,i,null,s),i.clearStitcher(e)}hi(e,t.add(r),s,!1,!1),e.filterClosePoints(0,!0,!0,!1,n.nullHandle);for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t))e.getGeometryType(t)===i.GeometryType.enumPolygon&&Ae(e,t,-1,!1,n.nullHandle,s);this.setEditShape_(e,s)}}function ze(e){const t=e[1],i=e[2],n=e[5];e[1]=e[3],e[2]=e[6],e[5]=e[7],e[3]=t,e[6]=i,e[7]=n}function Ye(e,r,o){const a=e.getGeometryType();if(i.isSegment(a)){const t=new n.Polyline({vd:e.getDescription()});return t.addSegment(e,!0),t}if(a===i.GeometryType.enumEnvelope){const i=e,o=t.Envelope2D.constructEmpty();if(e.queryEnvelope(o),o.height()<=r&&o.width()<=r){const t=new s.Point({vd:e.getDescription()});return i.getCenter(t),t}if(o.height()<=r||o.width()<=r){const t=new n.Polyline({vd:e.getDescription()}),r=new s.Point;return i.queryCornerByVal(0,r),t.startPathPoint(r),i.queryCornerByVal(2,r),t.lineToPoint(r),t}const a=new n.Polygon({vd:e.getDescription()});return a.addEnvelope(i,!1),a}return e}function Be(e){return`${e[0]}${e[3]}${e[6]}${e[1]}${e[4]}${e[7]}${e[2]}${e[5]}${e[8]}`}class Xe{nullFunc(){return i.throwInternalErrorException("should not be called"),!1}constructor(e,n,r,o=!1){this.m_bDone=!1,this.m_tolerance=0,this.m_elementHandle=-1,this.m_query=t.Envelope2D.constructEmpty(),this.m_envInter=t.Envelope2D.constructEmpty(),this.m_quadTree=null,this.m_intersector=null,this.m_function=this.nullFunc;const a=e.getAccelerators();let l=null;null!=a&&(l=o?a.getQuadTreeForPaths():a.getQuadTree());const c=n.getAccelerators();let h=null;if(null!=c&&(h=o?c.getQuadTreeForPaths():c.getQuadTree()),null===l&&null===h&&!o){const o=e.getPointCount(),a=n.getPointCount();if(o>10&&a>10){const c=t.Envelope2D.constructEmpty(),u=t.Envelope2D.constructEmpty(),m=t.Envelope2D.constructEmpty();e.queryLooseEnvelope(c),n.queryLooseEnvelope(u),c.inflateCoords(r,r),u.inflateCoords(r,r),m.setCoords({env2D:c}),m.intersect(u),o>=a?l=i.isMultiPath(e.getGeometryType())?s.buildQuadTree(e,m):s.buildQuadTreeMpt(e,m):h=i.isMultiPath(n.getGeometryType())?s.buildQuadTree(n,m):s.buildQuadTreeMpt(n,m)}}this.construct_(e,l,n,h,r,o)}next(){if(this.m_bQuadTree){if(this.m_bDone)return!1;for(;this.m_function(););return!this.m_bDone}return!!this.m_intersector&&this.m_intersector.next()}getRedElement(){return this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElement(this.m_elementHandle):i.isMultiPath(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_bSwapElements?this.m_intersector.getBlueElement(this.m_intersector.getHandleB()):this.m_intersector.getRedElement(this.m_intersector.getHandleA())}getBlueElement(){return this.m_bQuadTree?this.m_bSwapElements?i.isMultiPath(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_quadTree.getElement(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedElement(this.m_intersector.getHandleA()):this.m_intersector.getBlueElement(this.m_intersector.getHandleB())}getRedEnvelope(){return this.m_bPaths||i.throwInvalidCallException(""),this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_query:this.m_bSwapElements?this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB()):this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA())}getBlueEnvelope(){return this.m_bPaths||i.throwInvalidCallException(""),this.m_bQuadTree?this.m_bSwapElements?this.m_query:this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA()):this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB())}construct_(e,n,r,o,a,l){const c=t.Envelope2D.constructEmpty(),h=t.Envelope2D.constructEmpty();e.queryLooseEnvelope(c),r.queryLooseEnvelope(h),c.inflateCoords(a,a),h.inflateCoords(a,a),this.m_envInter.setCoords({env2D:c}),this.m_envInter.intersect(h),this.m_multiVertexImplA=e,this.m_multiVertexImplB=r;const u=e.getGeometryType(),m=r.getGeometryType();this.m_bPaths=l,this.m_pathIndex=-1,this.m_pointIndex=-1,this.m_bSwapElements=!1,this.m_queryType=i.GeometryType.enumUnknown,this.m_bQuadTree=!1,null!==n&&(this.m_bDone=!1,this.m_tolerance=a,this.m_quadTree=n,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!0,i.isMultiPath(m)?(this.m_queryType=m,this.m_function=this.nextPath_,l?this.m_pathIndex=r.getPathCount():this.m_segIter=r.querySegmentIterator()):(this.m_queryType=m,this.m_function=this.nextPoint_,this.m_pointIndex=r.getPointCount())),this.m_bQuadTree||null!==o&&(this.m_bDone=!1,this.m_tolerance=a,this.m_quadTree=o,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!1,i.isMultiPath(u)?(this.m_queryType=u,this.m_function=this.nextPath_,l?this.m_pathIndex=e.getPathCount():this.m_segIter=e.querySegmentIterator()):(this.m_queryType=u,this.m_function=this.nextPoint_,this.m_pointIndex=e.getPointCount())),this.m_bQuadTree||(l&&i.isMultiPath(u)&&i.isMultiPath(m)?this.m_intersector=s.getEnvelope2DIntersectorForParts(e,r,a):i.isMultiPath(u)&&i.isMultiPath(m)?(this.m_intersector=s.getEnvelope2DIntersector(e,r,a),this.m_bSwapElements=!1):i.isMultiPath(u)&&!i.isMultiPath(m)?(this.m_intersector=s.getEnvelope2DIntersectorMpthMpt(e,r,a),this.m_bSwapElements=!1):!i.isMultiPath(u)&&i.isMultiPath(m)?(this.m_intersector=s.getEnvelope2DIntersectorMpthMpt(r,e,a),this.m_bSwapElements=!0):(this.m_intersector=s.getEnvelope2DIntersectorMptMpt(e,r,a),this.m_bSwapElements=!1))}nextPath_(){return this.m_bPaths?-1===--this.m_pathIndex?(this.m_bDone=!0,!1):(this.m_bSwapElements?this.m_multiVertexImplB.queryPathEnvelope(this.m_pathIndex,this.m_query):this.m_multiVertexImplA.queryPathEnvelope(this.m_pathIndex,this.m_query),this.m_qtIter.resetIterator(this.m_query,this.m_tolerance),this.m_function=this.iterate_,!0):this.m_segIter.nextPath()?(this.m_function=this.nextSegment_,!0):(this.m_bDone=!0,!1)}nextSegment_(){if(!this.m_segIter.hasNextSegment())return this.m_function=this.nextPath_,!0;const e=this.m_segIter.nextSegment(),i=new t.Envelope2D;return e.queryLooseEnvelope(i),!i.isIntersecting(this.m_envInter)||(this.m_qtIter.resetIterator(e,this.m_tolerance),this.m_function=this.iterate_,!0)}nextPoint_(){if(-1===--this.m_pointIndex)return this.m_bDone=!0,!1;const e=new r.Point2D;if(this.m_bSwapElements){const t=this.m_multiVertexImplB.getXY(this.m_pointIndex);e.setCoordsPoint2D(t)}else{const t=this.m_multiVertexImplA.getXY(this.m_pointIndex);e.setCoordsPoint2D(t)}return!this.m_envInter.contains(e)||(this.m_qtIter.resetIterator(t.Envelope2D.construct(e.x,e.y,e.x,e.y),this.m_tolerance),this.m_function=this.iterate_,!0)}iterate_(){return this.m_elementHandle=this.m_qtIter.next(),-1===this.m_elementHandle&&(i.isMultiPath(this.m_queryType)?(this.m_function=this.m_bPaths?this.nextPath_:this.nextSegment_,!0):(this.m_function=this.nextPoint_,!0))}}function je(e){return 2===e?1:1===e?2:128===e?64:64===e?128:e}function We(e,i,n){let r;if(e instanceof Br||null===e){const o=t.Envelope2D.constructEmpty();o.setCoords({env2D:i}),o.mergeEnvelope2D(n),r=s.calculateToleranceFromGeometryForRel(e,o,!1)}else r=e;return r}function Ze(e,o,a,c,h){if(e.isEmpty()||o.isEmpty())return 4===c;i.throwIfMesh(e),i.throwIfMesh(o);let u=e.getGeometryType(),m=o.getGeometryType();if(u===i.GeometryType.enumEnvelope){if(m===i.GeometryType.enumEnvelope)return function(e,i,n,s){if(e.isEmpty()||i.isEmpty())return 4===s;const r=t.Envelope2D.constructEmpty();e.queryEnvelope(r);const o=t.Envelope2D.constructEmpty();i.queryEnvelope(o);const a=We(n,r,o);switch(s){case 4:return $e(r,o,a);case 2:return wt(o,r,a,!1);case 128:return wt(o,r,a,!0);case 1:return wt(r,o,a,!1);case 64:return wt(r,o,a,!0);case 3:return Ct(r,o,a);case 8:return function(e,i,n){if(e.height()<=n||e.width()<=n||i.height()<=n||i.width()<=n)return!1;const s=new t.Envelope2D;return s.setCoords({env2D:e}),s.inflateCoords(-n,-n),s.intersect(i),!(!s.isEmpty()&&s.height()>n&&s.width()>n||(s.setCoords({env2D:e}),s.inflateCoords(n,n),s.intersect(i),s.isEmpty()))}(r,o,a);case 32:return function(e,i,n){if(e.height()<=n||e.width()<=n||i.height()<=n||i.width()<=n)return!1;if(It(e,i,n))return!1;if(It(i,e,n))return!1;const s=new t.Envelope2D;return s.setCoords({env2D:e}),s.inflateCoords(-n,-n),s.intersect(i),!s.isEmpty()&&(s.height()>n||s.width()>n)}(r,o,a);case 16:return!1}return!1}(e,o,a,c);if(m===i.GeometryType.enumPoint)return Qe(o,e,a,je(c))}else if(u===i.GeometryType.enumPoint){if(m===i.GeometryType.enumEnvelope)return Qe(e,o,a,c);if(m===i.GeometryType.enumPoint)return function(e,i,n,o){if(e.isEmpty()||i.isEmpty())return 4===o;const a=e.getXY(),l=i.getXY();let c;if(n instanceof Br||null===n){const e=t.Envelope2D.constructEmpty();e.setCoords({pt:a}),e.merge(l),c=s.calculateToleranceFromGeometryForRel(n,e,!1)}else c=n;switch(o){case 4:return function(e,t,i){return r.Point2D.sqrDistance(e,t)>i*i}(a,l,c);case 2:case 128:return St(l,a,c);case 1:case 64:return St(a,l,c);case 3:return Et(a,l,c)}return!1}(e,o,a,c)}const d=t.Envelope2D.constructEmpty();e.queryEnvelope(d);const p=t.Envelope2D.constructEmpty();o.queryEnvelope(p);const g=We(a,d,p);if($e(d,p,g))return 4===c;let _=!1,f=null,y=null,x=null,v=null;switch(i.isSegment(u)?(f=new n.Polyline({vd:e.getDescription()}),f.addSegment(e,!0),x=f,u=i.GeometryType.enumPolyline):x=e,i.isSegment(m)?(y=new n.Polyline({vd:o.getDescription()}),y.addSegment(o,!0),v=y,m=i.GeometryType.enumPolyline):v=o,u!==i.GeometryType.enumEnvelope&&m!==i.GeometryType.enumEnvelope?(x.getDimension()<v.getDimension()||u===i.GeometryType.enumPoint&&m===i.GeometryType.enumMultiPoint)&&(c=je(c)):u!==i.GeometryType.enumPolygon&&m!==i.GeometryType.enumEnvelope&&(c=je(c)),u){case i.GeometryType.enumPolygon:switch(m){case i.GeometryType.enumPolygon:_=function(e,t,i,n,s){switch(n){case 4:return function(e,t,i){return Ke(e,t,0,!0),1===Tt(e,t,i,!0)}(e,t,i);case 2:return ht(t,e,i,s);case 128:return ut(t,e,i);case 1:return ht(e,t,i,s);case 64:return ut(e,t,i);case 3:return ct(e,t,i,s);case 8:return function(e,t,i){return Ke(e,t),Ht(e,t,i,null)}(e,t,i);case 32:return function(e,t,i,n){return Ke(e,t),Ut(e,t,i,n)}(e,t,i,s)}return!1}(x,v,g,c,h);break;case i.GeometryType.enumPolyline:_=et(x,v,g,c,h);break;case i.GeometryType.enumPoint:_=tt(x,v,g,c);break;case i.GeometryType.enumMultiPoint:_=it(x,v,g,c);break;case i.GeometryType.enumEnvelope:_=nt(x,v,g,c,h)}break;case i.GeometryType.enumPolyline:switch(m){case i.GeometryType.enumPolygon:_=et(v,x,g,c,h);break;case i.GeometryType.enumPolyline:_=function(e,i,s,r,o){switch(r){case 4:return function(e,t,i){Ke(e,t);const n=e.getImpl(),s=t.getImpl();return!new Xe(n,s,i,!0).next()||!kt(e,t,i)}(e,i,s);case 2:return _t(i,e,s,o);case 128:return ft(i,e,s,o);case 1:return _t(e,i,s,o);case 64:return ft(e,i,s,o);case 3:return function(e,i,n,s){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),i.queryEnvelope(o),!!Ct(r,o,n)&&(Ke(e,i),!!Nt(e,i,n)||(e.hasNonLinearSegments()||i.hasNonLinearSegments()?Ne(e,i,n,"**F**FFF*",s,!1):Ot(e,i,n,!1)))}(e,i,s,o);case 8:return function(e,i,s,r){Ke(e,i);const o=[],a=Vt(e,i,s,o);if(-2===a){const n=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty(),a=t.Envelope2D.constructEmpty();let c,h;if(e.queryEnvelope(n),i.queryEnvelope(o),n.inflateCoords(1e3*s,1e3*s),o.inflateCoords(1e3*s,1e3*s),a.setCoords({env2D:n}),a.intersect(o),e.getPointCount()>10){if(c=l.clip$1(e,a,s,0,r),c.isEmpty())return!1}else c=e;if(i.getPointCount()>10){if(h=l.clip$1(i,a,s,0,r),h.isEmpty())return!1}else h=i;return Ne(c,h,s,"F********",r,!1)}if(0!==a)return!1;const c=new n.MultiPoint;for(let e=0;e<o.length;e+=2){const t=o[e],i=o[e+1];c.addXY(t,i)}const h=e.getBoundary(),u=i.getBoundary();return h.addPoints(u,0,u.getPointCount()),!h.isEmpty()&&xt(h,c,s)}(e,i,s,o);case 32:return function(e,i,n,s){Ke(e,i);const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();e.queryEnvelope(r),i.queryEnvelope(o);const a=Mt(r,o,n),c=Mt(o,r,n),h=e.hasNonLinearSegments(),u=i.hasNonLinearSegments(),m=Vt(e,i,n,null);if(-1===m)return!1;if(1===m){if(a&&c)return!0;if(!h&&!u)return a&&!c?!Gt(i,e,n,!1):c&&!a?!Gt(e,i,n,!1):!Gt(e,i,n,!1)&&!Gt(i,e,n,!1)}const d=t.Envelope2D.constructEmpty(),p=t.Envelope2D.constructEmpty(),g=t.Envelope2D.constructEmpty();let _,f;d.setCoords({env2D:r}),d.inflateCoords(1e3*n,1e3*n),p.setCoords({env2D:o}),p.inflateCoords(1e3*n,1e3*n),g.setCoords({env2D:d}),g.intersect(p);let y="";if(y+="1*",a){if(i.getPointCount()>10){if(f=l.clip$1(i,g,n,0,s),f.isEmpty())return!1}else f=i;y+="****"}else f=i,y+="T***";if(c){if(e.getPointCount()>10){if(_=l.clip$1(e,g,n,0,s),_.isEmpty())return!1}else _=e;y+="***"}else _=e,y+="T**";return Ne(_,f,n,y,s,!1)}(e,i,s,o);case 16:return function(e,i,s,r){Ke(e,i);const o=[],a=Vt(e,i,s,o);if(-2===a){const n=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty(),a=t.Envelope2D.constructEmpty();let c,h;if(e.queryEnvelope(n),i.queryEnvelope(o),n.inflateCoords(1e3*s,1e3*s),o.inflateCoords(1e3*s,1e3*s),a.setCoords({env2D:n}),a.intersect(o),e.getPointCount()>10){if(c=l.clip$1(e,a,s,0,r),c.isEmpty())return!1}else c=e;if(i.getPointCount()>10){if(h=l.clip$1(i,a,s,0,r),h.isEmpty())return!1}else h=i;return Ne(c,h,s,"0********",r,!1)}if(0!==a)return!1;const c=new n.MultiPoint;for(let e=0;e<o.length;e+=2){const t=o[e],i=o[e+1];c.addXY(t,i)}const h=e.getBoundary(),u=i.getBoundary();return h.addPoints(u,0,u.getPointCount()),!!h.isEmpty()||!xt(h,c,s)}(e,i,s,o)}return!1}(x,v,g,c,h);break;case i.GeometryType.enumPoint:_=st(x,v,g,c);break;case i.GeometryType.enumMultiPoint:_=rt(x,v,g,c);break;case i.GeometryType.enumEnvelope:_=ot(x,v,g,c,h)}break;case i.GeometryType.enumPoint:switch(m){case i.GeometryType.enumPolygon:_=tt(v,x,g,c);break;case i.GeometryType.enumPolyline:_=st(v,x,g,c);break;case i.GeometryType.enumMultiPoint:_=at(v,x,g,c)}break;case i.GeometryType.enumMultiPoint:switch(m){case i.GeometryType.enumPolygon:_=it(v,x,g,c);break;case i.GeometryType.enumPolyline:_=rt(v,x,g,c);break;case i.GeometryType.enumMultiPoint:_=function(e,i,n,s){switch(s){case 4:return function(e,t,i){const n=e,s=t,o=new Xe(n,s,i,!1),a=i*i,l=new r.Point2D,c=new r.Point2D;for(;o.next();){const e=o.getRedElement(),t=o.getBlueElement();if(n.queryXY(e,l),s.queryXY(t,c),r.Point2D.sqrDistance(l,c)<=a)return!1}return!0}(e,i,n);case 2:case 128:return xt(i,e,n);case 1:case 64:return xt(e,i,n);case 3:return function(e,i,n){const s=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(s),i.queryEnvelope(o),!!Ct(s,o,n)&&(!!function(e,t,i){if(e.getPointCount()!==t.getPointCount())return!1;const n=new r.Point2D,s=new r.Point2D;let o=!0;const a=i*i;for(let i=0;i<e.getPointCount();i++)if(e.queryXY(i,n),t.queryXY(i,s),r.Point2D.sqrDistance(n,s)>a){o=!1;break}return!!o}(e,i,n)||Rt(e,i,n,!1,!0,!1))}(e,i,n);case 32:return function(e,t,i){return Rt(e,t,i,!1,!1,!0)}(e,i,n)}return!1}(x,v,g,c);break;case i.GeometryType.enumPoint:_=at(x,v,g,c);break;case i.GeometryType.enumEnvelope:_=lt(x,v,g,c)}break;case i.GeometryType.enumEnvelope:switch(m){case i.GeometryType.enumPolygon:_=nt(v,x,g,c,h);break;case i.GeometryType.enumPolyline:_=ot(v,x,g,c,h);break;case i.GeometryType.enumMultiPoint:_=lt(v,x,g,c)}}return _}function Qe(e,i,n,r,o){if(e.isEmpty()||i.isEmpty())return 4===r;const a=e.getXY(),l=t.Envelope2D.constructEmpty();i.queryEnvelope(l);const c=function(e,i,n){let r;if(e instanceof Br||null===e){const o=t.Envelope2D.constructEmpty();o.setCoords({pt:i}),o.mergeEnvelope2D(n),r=s.calculateToleranceFromGeometryForRel(e,o,!1)}else r=e;return r}(n,a,l);switch(r){case 4:return Je(a,l,c);case 2:case 128:return function(e,i,n){if(i.height()<=n||i.width()<=n)return!1;const s=t.Envelope2D.constructEmpty();return s.setCoords({env2D:i}),s.inflateCoords(-n,-n),s.containsExclusive(e)}(a,l,c);case 1:case 64:return!1;case 3:return function(e,i,n){const s=new t.Envelope2D;return s.setCoords({pt:e}),Ct(s,i,n)}(a,l,c);case 8:return function(e,i,n){if(i.height()<=n||i.width()<=n)return!1;const s=new t.Envelope2D,r=new t.Envelope2D;return s.setCoords({env2D:i}),s.inflateCoords(n,n),!!s.contains(e)&&(r.setCoords({env2D:i}),r.inflateCoords(-n,-n),!r.containsExclusive(e))}(a,l,c)}return!1}function $e(e,i,n){const s=t.Envelope2D.constructEmpty();return s.setCoords({env2D:i}),s.inflateCoords(n,n),!e.isIntersecting(s)}function Ke(e,t,n,s=!1){const r=e.getGeometryType(),o=t.getGeometryType();if(i.isMultiVertex(r)){const t=e.getImpl().getAccelerators();if(null!==t){const e=t.getRasterizedGeometry();i.geometryReleaseAssert(null===e)}}if(i.isMultiVertex(o)){const e=t.getImpl().getAccelerators();if(null!==e){const t=e.getRasterizedGeometry();i.geometryReleaseAssert(null===t)}}return 0}function Je(e,i,n,s){const r=t.Envelope2D.constructEmpty();return r.setCoords({env2D:i}),r.inflateCoords(n,n),!r.contains(e)}function et(e,i,o,a,c){switch(a){case 4:return function(e,t,i){return Ke(e,t,0,!0),1===Tt(e,t,i,!0)}(e,i,o);case 1:return function(e,i,r,o){const a=t.Envelope2D.constructEmpty(),c=t.Envelope2D.constructEmpty();return e.queryEnvelope(a),i.queryEnvelope(c),!!It(a,c,r)&&(Ke(e,i),function(e,i,r,o){const a=[!1],c=Dt(e,i,r,a);if(a[0])return c;const h=t.Envelope2D.constructEmpty();let u;if(i.queryEnvelope(h),h.inflateCoords(1e3*r,1e3*r),e.getPointCount()>10){if(u=l.clip$1(e,h,r,0,o),u.isEmpty())return!1}else u=e;return function(e,i,r,o){const a=new Ue;a.resetMatrix_(),a.setPredicates_("T*****F**"),a.setAreaLinePredicates_();const l=t.Envelope2D.constructEmpty(),c=t.Envelope2D.constructEmpty();e.queryEnvelope(l),i.queryEnvelope(c);let h=!1;if($e(l,c,r)&&(a.areaLineDisjointPredicates_(e,i),h=!0),h||Ke(e,i),h)return qe(a.m_matrix,a.m_scl);const u=new n.EditShape,m=u.addGeometry(e),d=u.addGeometry(i);return a.setEditShapeCrackAndCluster_(u,new s.CombinedTolerance(r,0),o),0!==u.getPointCount(m)&&(a.computeMatrixTopoGraphHalfEdges_(m,d),a.m_topoGraph.removeShape(),qe(a.m_matrix,a.m_scl))}(u,i,r,o)}(e,i,r,o))}(e,i,o,c);case 64:return function(e,i,n){const s=t.Envelope2D.constructEmpty(),r=t.Envelope2D.constructEmpty();return e.queryEnvelope(s),i.queryEnvelope(r),!!It(s,r,n)&&(Ke(e,i),2===Tt(e,i,n,!1))}(e,i,o);case 8:return mt(e,i,o,c);case 16:return function(e,i,n){return Ke(e,i),function(e,i,n,s){const o=e.getImpl(),a=i.getImpl(),c=o.querySegmentIterator(),h=a.querySegmentIterator(),u=r.makePrimitiveArray(2,Number.NaN),m=r.makePrimitiveArray(2,Number.NaN),d=new Xe(o,a,n);let p=!1;for(;d.next();){const e=d.getRedElement(),t=d.getBlueElement();c.resetToVertex(e,-1),h.resetToVertex(t,-1);const i=c.nextSegment(),s=h.nextSegment();let r=0;if(Xt(i,s)?!p&&s.isIntersecting(i,n)&&(p=!0):r=s.intersect(i,null,m,u,n),2===r)p=!0;else if(r){const e=u[0],t=m[0];if(e>0&&e<1&&t>0&&t<1)return!0;p=!0}}if(!p)return!1;const g=t.Envelope2D.constructEmpty(),_=t.Envelope2D.constructEmpty(),f=t.Envelope2D.constructEmpty(),y=t.Envelope2D.constructEmpty(),x=t.Envelope2D.constructEmpty();if(e.queryEnvelope(g),i.queryEnvelope(_),Mt(_,g,n)){let t,r;if(f.setCoords({env2D:g}),f.inflateCoords(1e3*n,1e3*n),y.setCoords({env2D:_}),y.inflateCoords(1e3*n,1e3*n),x.setCoords({env2D:f}),x.intersect(y),e.getPointCount()>10){if(t=l.clip$1(e,x,n,0,s),t.isEmpty())return!1}else t=e;if(i.getPointCount()>10){if(r=l.clip$1(i,x,n,0,s),r.isEmpty())return!1}else r=i;return Ne(t,r,n,"T********",s,!1)}return Ne(e,i,n,"T*****T**",s,!1)}(e,i,n,null)}(e,i,o)}return!1}function tt(e,t,i,n,s){switch(n){case 4:return function(e,t,i){return 0===Zt(e,t,i)}(e,t,i);case 1:case 64:return function(e,t,i){return function(e,t,i){return 1===Qt(e,t,i)}(e,t.getXY(),i)}(e,t,i);case 8:return function(e,t,i){return function(e,t,i){return 2===Qt(e,t,i)}(e,t.getXY(),i)}(e,t,i)}return!1}function it(e,i,s,o,a){switch(o){case 4:return function(e,i,s){Ke(e,i);const o=function(e,i,s){const o=t.Envelope2D.constructEmpty();e.queryEnvelope(o),o.inflateCoords(s,s);const a=new r.Point2D,l=e.getImpl(),c=new n.Polygon;let h=e,u=!1,m=!1,d=!1;for(let t=0;t<i.getPointCount();t++){if(i.queryXY(t,a),o.contains(a)){const e=Qt(h,a,s);if(1===e)return m=!0,4;if(2===e)return 4;d=!0}else d=!0;u||(!Ce(e,i.getPointCount()-1)||null!==l.getAccelerators()&&null!=l.getAccelerators().getQuadTree()?h=e:(e.copyTo(c),c.getImpl().buildQuadTreeAccelerator(1),h=c),u=!0)}return m?d?4:2:1}(e,i,s);return 1===o}(e,i,s);case 1:return dt(e,i,s,!1);case 64:return dt(e,i,s,!0);case 8:return function(e,i,s){Ke(e,i);const o=t.Envelope2D.constructEmpty();e.queryEnvelope(o),o.inflateCoords(s,s);const a=new r.Point2D;let l=!1;const c=e.getImpl(),h=new n.Polygon;let u=e,m=!1;for(let t=0;t<i.getPointCount();t++){if(i.queryXY(t,a),o.contains(a)){const e=Qt(u,a,s);if(2===e)l=!0;else if(1===e)return!1}m||(!Ce(e,i.getPointCount()-1)||null!==c.getAccelerators()&&null!==c.getAccelerators().getQuadTree()?u=e:(e.copyTo(h),h.getImpl().buildQuadTreeAccelerator(1),u=h),m=!0)}return!!l}(e,i,s);case 16:return function(e,i,s){Ke(e,i);const o=new t.Envelope2D,a=new t.Envelope2D,l=new t.Envelope2D;e.queryEnvelope(o),i.queryEnvelope(l),a.setCoords({env2D:o}),a.inflateCoords(s,s);let c=!1,h=!1;const u=new r.Point2D,m=e.getImpl(),d=new n.Polygon;let p=e,g=!1;for(let t=0;t<i.getPointCount();t++){if(i.queryXY(t,u),a.contains(u)){const e=Qt(p,u,s);0===e?h=!0:1===e&&(c=!0)}else h=!0;if(c&&h)return!0;g||(!Ce(e,i.getPointCount()-1)||null!==m.getAccelerators()&&null!==m.getAccelerators().getQuadTree()?p=e:(e.copyTo(d),d.getImpl().buildQuadTreeAccelerator(1),p=d),g=!0)}return!1}(e,i,s)}return!1}function nt(e,i,s,r,o){if(function(e,i,n){Ke(e,i);const s=t.Envelope2D.constructEmpty(),r=t.Envelope2D.constructEmpty();return e.queryEnvelope(s),i.queryEnvelope(r),!It(r,s,n)&&(0===Qt(e,r.getLowerLeft(),0)&&!r.contains(e.getXY(0))&&!qt(e,r,n))}(e,i,s))return 4===r;if(4===r)return!1;switch(r){case 2:return pt(e,i,s,!1);case 128:return pt(e,i,s,!0);case 1:return gt(e,i,s,!1,o);case 64:return gt(e,i,s,!0,o);case 3:return function(e,i,s,r){const o=new t.Envelope2D,a=new t.Envelope2D;if(e.queryEnvelope(o),i.queryEnvelope(a),!Ct(o,a,s))return!1;const l=new n.Polygon;return l.addEnvelope(i,!1),ct(e,l,s,r)}(e,i,s,o);case 8:return function(e,i,s,r){Ke(e,i);const o=new t.Envelope2D,a=new t.Envelope2D;if(e.queryEnvelope(o),i.queryEnvelope(a),It(a,o,s))return!1;if(a.height()<=s||a.width()<=s)return!1;const l=new n.Polygon;return l.addEnvelope(i,!1),Ht(e,l,s,r)}(e,i,s,o);case 32:return function(e,i,s,r){Ke(e,i);const o=new t.Envelope2D,a=new t.Envelope2D;if(e.queryEnvelope(o),i.queryEnvelope(a),It(a,o,s))return!1;if(a.height()<=s||a.width()<=s)return!1;const l=new n.Polygon;return l.addEnvelope(i,!1),Ut(e,l,s,r)}(e,i,s,o);case 16:return!1}return!1}function st(e,t,i,n,s){switch(n){case 4:return function(e,t,i){return Ke(e,t),!Lt(e,t.getXY(),i)}(e,t,i);case 1:case 64:return function(e,t,i){return Ke(e,t),function(e,t,i){return Lt(e,t,i)&&!Bt(e,t,i)}(e,t.getXY(),i)}(e,t,i);case 8:return function(e,t,i){return Ke(e,t),Bt(e,t.getXY(),i)}(e,t,i)}return!1}function rt(e,i,s,o,a){switch(o){case 4:return function(e,t,i){return Ke(e,t),!Ft(e,t,i,!1)}(e,i,s);case 1:case 64:return function(e,i,n){const s=t.Envelope2D.constructEmpty(),r=t.Envelope2D.constructEmpty();if(e.queryEnvelope(s),i.queryEnvelope(r),!It(s,r,n))return!1;Ke(e,i);const o=Ft(e,i,n,!0);if(!o)return o;const a=e.getBoundary();return a.isEmpty()?o:!xt(a,i,n)}(e,i,s);case 8:return function(e,t,i){Ke(e,t);const s=e.getImpl(),r=t.getImpl(),o=new n.MultiPoint,a=new Xe(s,r,i,!1),l=s.querySegmentIterator();let c=!1;for(;a.next();){const e=a.getRedElement(),t=a.getBlueElement();l.resetToVertex(e,-1);const n=l.nextSegment(),s=r.getXY(t);n.isIntersectingPoint(s,i)&&(c=!0,o.addPoint2D(s))}if(!c)return!1;const h=e.getBoundary();return!h.isEmpty()&&xt(h,o,i)}(e,i,s);case 16:return function(e,t,i){Ke(e,t);const s=e.getImpl(),o=t.getImpl(),a=o.getPointCount(),l=r.makePrimitiveArray(a,!1),c=new Xe(s,o,i,!1),h=s.querySegmentIterator();let u=!1;for(;c.next();){const e=c.getRedElement(),t=c.getBlueElement();h.resetToVertex(e,-1);const n=h.nextSegment(),s=o.getXY(t);n.isIntersectingPoint(s,i)&&(u=!0,l[t]=!0)}if(!u)return!1;let m=!1;for(let e=0;e<a;e++)if(!l[e]){m=!0;break}if(!m)return!1;const d=e.getBoundary();if(d.isEmpty())return!0;const p=new n.MultiPoint;for(let e=0;e<a;e++)l[e]&&p.addPoint2D(o.getXY(e));return!xt(d,p,i)}(e,i,s)}return!1}function ot(e,s,o,a,l){if(function(e,i,n){const s=t.Envelope2D.constructEmpty(),r=t.Envelope2D.constructEmpty();e.queryEnvelope(s),i.queryEnvelope(r);const o=function(e,i,n){const s=t.Envelope2D.constructEmpty();return s.setCoords({env2D:e}),s.inflateCoords(n,n),s.containsEnvelope(i)?1073741824:s.isIntersecting(i)?e.isIntersecting(i)?e.xmin<i.xmin&&i.xmax<e.xmax?i.ymin<e.ymin&&i.ymax>e.ymax?0:1073741824:e.ymin<i.ymin&&i.ymax<e.ymax?i.xmin<e.xmin&&i.xmax>e.xmax?0:1073741824:0:0:4}(r,s,n);return 0===o?!qt(e,r,n):4===o}(e,s,o))return 4===a;if(4===a)return!1;switch(a){case 2:return yt(e,s,o,!1);case 128:return yt(e,s,o,!0);case 1:case 64:case 32:return!1;case 3:return function(e,i,n){const s=new t.Envelope2D,r=new t.Envelope2D;return e.queryEnvelope(s),i.queryEnvelope(r),!(r.height()>n&&r.width()>n)&&Ct(s,r,n)}(e,s,o);case 8:return function(e,s,o,a){const l=new t.Envelope2D,c=new t.Envelope2D;if(e.queryEnvelope(l),s.queryEnvelope(c),c.height()<=o||c.width()<=o)return!1;const h=new t.Envelope2D,u=new t.Envelope2D;if(h.setCoords({env2D:c}),u.setCoords({env2D:c}),h.inflateCoords(o,o),u.inflateCoords(-o,-o),u.containsEnvelope(l)||!l.isIntersecting(h))return!1;const m=e.getImpl().querySegmentIterator();m.stripAttributes();const d=e.getImpl().getAccelerators();let p=null,g=null;null!==d&&(p=d.getQuadTree(),null!==p&&(g=p.getIterator(c,o))),g||m.nextPath()||i.throwInternalErrorException("relational_operations");let _=!1,f=null;const y=new r.Point2D,x=new r.Point2D,v=e.hasNonLinearSegments();let P=!1;for(;;){if(null!==g){const e=g.next();if(-1===e)break;m.resetToVertex(p.getElement(e),-1),f=m.nextSegment()}else{for(;!m.hasNextSegment()&&m.nextPath(););if(!m.hasNextSegment())break;f=m.nextSegment()}if(v&&f.getGeometryType()!==i.GeometryType.enumLine){const e=new t.Envelope2D;if(f.queryEnvelope(e),u.containsEnvelope(e))return!1;if(h.isIntersecting(e)){P=!0;break}}else{y.assign(f.getStartXY()),x.assign(f.getEndXY());let e=u.clipLine(y,x);if(0!==e)return!1;_||(e=h.clipLine(y,x),0!==e&&(_=!0))}}if(!P)return _;const b=new n.Polygon;return b.addEnvelope(c,!1),mt(b,e,o,a)}(e,s,o,l);case 16:return function(e,s,o){const a=new t.Envelope2D,l=new t.Envelope2D;if(e.queryEnvelope(a),s.queryEnvelope(l),l.height()<=o||l.width()<=o)return!1;const c=new t.Envelope2D;if(c.setCoords({env2D:l}),c.inflateCoords(o,o),c.containsEnvelope(a))return!1;const h=new t.Envelope2D;if(h.setCoords({env2D:l}),h.inflateCoords(-o,-o),!h.isIntersecting(a))return!1;const u=e.getImpl().querySegmentIterator();u.stripAttributes();const m=e.getImpl().getAccelerators();let d=null,p=null;if(null!==m&&(d=m.getQuadTree(),null!==d&&(p=d.getIterator(l,o))),!p){const e=u.nextPath();i.geometryReleaseAssert(e)}let g=!1,_=null;const f=new r.Point2D,y=new r.Point2D;let x=null,v=null,P=null,b=null;for(e.hasNonLinearSegments()&&(x=new n.Line,v=new n.Line,P=new n.Line,b=new n.Line,h.querySide(0,x),h.querySide(1,v),h.querySide(2,P),h.querySide(3,b));;){if(null!==p){const e=p.next();if(-1===e)break;u.resetToVertex(d.getElement(e),-1),_=u.nextSegment()}else{for(;!u.hasNextSegment()&&u.nextPath(););if(!u.hasNextSegment())break;_=u.nextSegment()}if(_.getGeometryType()===i.GeometryType.enumLine){if(f.assign(_.getStartXY()),y.assign(_.getEndXY()),0!==h.clipLine(f,y)){g=!0;break}}else{if(x.isIntersecting(_,o)){g=!0;break}if(v.isIntersecting(_,o)){g=!0;break}if(P.isIntersecting(_,o)){g=!0;break}if(b.isIntersecting(_,o)){g=!0;break}}}return g&&!0}(e,s,o)}return!1}function at(e,t,i,n,s){switch(n){case 4:return Pt(e,t,i);case 2:case 128:return function(e,t,i){return vt(e,t,i)}(e,t,i);case 1:case 64:return function(e,t,i){return!Pt(e,t,i)}(e,t,i);case 3:return vt(e,t,i)}return!1}function lt(e,i,n,s,o){switch(s){case 4:return function(e,i,n){const s=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();if(e.queryEnvelope(s),i.queryEnvelope(o),It(o,s,n))return!1;const a=t.Envelope2D.constructEmpty();a.setCoords({env2D:o}),a.inflateCoords(n,n);const l=new r.Point2D;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,l),a.contains(l))return!1;return!0}(e,i,n);case 2:return bt(e,i,n,!1);case 128:return bt(e,i,n,!0);case 1:case 64:return!1;case 3:return function(e,i,n){const s=new t.Envelope2D,r=new t.Envelope2D;return e.queryEnvelope(s),i.queryEnvelope(r),!(r.height()>n||r.width()>n)&&Ct(s,r,n)}(e,i,n);case 8:return function(e,i,n){const s=new t.Envelope2D,o=new t.Envelope2D,a=new t.Envelope2D;if(i.queryEnvelope(s),s.height()<=n||s.width()<=n)return!1;o.setCoords({env2D:s}),a.setCoords({env2D:s}),o.inflateCoords(n,n),a.inflateCoords(-n,-n);const l=new r.Point2D;let c=!1;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,l),o.contains(l)){if(a.containsExclusive(l))return!1;c=!0}return c}(e,i,n);case 16:return function(e,i,n){const s=new t.Envelope2D,o=new t.Envelope2D;if(e.queryEnvelope(s),i.queryEnvelope(o),It(o,s,n))return!1;if(o.height()<=n||o.width()<=n)return!1;const a=new t.Envelope2D,l=new t.Envelope2D;a.setCoords({env2D:o}),a.inflateCoords(-n,-n),l.setCoords({env2D:o}),l.inflateCoords(n,n);const c=new r.Point2D;let h=!1,u=!1;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,c),!h&&a.containsExclusive(c)&&(h=!0),u||l.contains(c)||(u=!0),h&&u)return!0;return!1}(e,i,n)}return!1}function ct(e,i,n,s){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();if(e.queryEnvelope(r),i.queryEnvelope(o),!Ct(r,o,n))return!1;if(Ke(e,i),Nt(e,i,n))return!0;const a=e.calculateLength2D(),l=i.calculateLength2D(),c=Math.max(e.getPointCount(),i.getPointCount());return!(Math.abs(a-l)>4*c*n)&&(e.hasNonLinearSegments()||i.hasNonLinearSegments()?Ne(e,i,n,"**F**FFF*",s,!1):Ot(e,i,n,!0))}function ht(e,i,n,s){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),i.queryEnvelope(o),!!It(r,o,n)&&(Ke(e,i),zt(e,i,n,s))}function ut(e,i,n,s){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),i.queryEnvelope(o),!!It(r,o,n)&&(Ke(e,i),2===Tt(e,i,n,!1))}function mt(e,i,n,s){return Ke(e,i),function(e,i,n,s){const o=e.getImpl(),a=i.getImpl(),c=o.querySegmentIterator(),h=a.querySegmentIterator(),u=r.makePrimitiveArray(2,Number.NaN),m=r.makePrimitiveArray(2,Number.NaN),d=new Xe(o,a,n);let p=!1;for(;d.next();){const e=d.getRedElement(),t=d.getBlueElement();c.resetToVertex(e,-1),h.resetToVertex(t,-1);const i=c.nextSegment(),s=h.nextSegment();let r=0;if(Xt(i,s)?!p&&s.isIntersecting(i,n)&&(p=!0):r=s.intersect(i,null,m,u,n),2===r)p=!0;else if(r){const e=u[0],t=m[0];if(e>0&&e<1&&t>0&&t<1)return!1;p=!0}}if(!p)return!1;const g=t.Envelope2D.constructEmpty(),_=t.Envelope2D.constructEmpty(),f=t.Envelope2D.constructEmpty();let y,x;if(e.queryEnvelope(g),i.queryEnvelope(_),g.inflateCoords(1e3*n,1e3*n),_.inflateCoords(1e3*n,1e3*n),f.setCoords({env2D:g}),f.intersect(_),e.getPointCount()>10){if(y=l.clip$1(e,f,n,0,s),y.isEmpty())return!1}else y=e;if(i.getPointCount()>10){if(x=l.clip$1(i,f,n,0,s),x.isEmpty())return!1}else x=i;return Ne(y,x,n,"F********",s,!1)}(e,i,n,s)}function dt(e,i,s,o,a){const l=t.Envelope2D.constructEmpty(),c=t.Envelope2D.constructEmpty();if(e.queryEnvelope(l),i.queryEnvelope(c),!It(l,c,s))return!1;Ke(e,i);let h=!1;const u=new r.Point2D,m=e.getImpl(),d=new n.Polygon;let p=e,g=!1;for(let t=0;t<i.getPointCount();t++){if(i.queryXY(t,u),!l.contains(u))return!1;const n=Qt(p,u,s);if(1===n)h=!0;else if(0===n)return!1;if(o&&2===n)return!1;g||(!Ce(e,i.getPointCount()-1)||null!==m.getAccelerators()&&null!==m.getAccelerators().getQuadTree()?p=e:(e.copyTo(d),d.getImpl().buildQuadTreeAccelerator(1),p=d),g=!0)}return h}function pt(e,i,n,s,r){const o=t.Envelope2D.constructEmpty(),a=t.Envelope2D.constructEmpty();return e.queryEnvelope(o),i.queryEnvelope(a),s?At(a,o,n):It(a,o,n)}function gt(e,i,s,r,o){const a=t.Envelope2D.constructEmpty(),l=t.Envelope2D.constructEmpty();if(e.queryEnvelope(a),i.queryEnvelope(l),!It(a,l,s))return!1;Ke(e,i);const c=new n.Polygon;return c.addEnvelope(i,!1),r?2===Tt(e,c,s,!1):zt(e,c,s,o)}function _t(e,i,n,s){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),i.queryEnvelope(o),!!It(r,o,n)&&(Ke(e,i),e.hasNonLinearSegments()||i.hasNonLinearSegments()?Ne(e,i,n,"******FF*",s,!1):Gt(i,e,n,!1))}function ft(e,i,n,s){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),i.queryEnvelope(o),!!It(r,o,n)&&(Ke(e,i),Ne(e,i,n,"T**FF*FF*",s,!1))}function yt(e,s,r,o,a){const l=t.Envelope2D.constructEmpty(),c=t.Envelope2D.constructEmpty();if(e.queryEnvelope(l),s.queryEnvelope(c),c.height()<=r||c.width()<=r)return!1;if(o)return At(c,l,r);if(!It(c,l,r))return!1;const h=t.Envelope2D.constructEmpty();h.setCoords({env2D:c}),h.inflateCoords(-r,-r);const u=t.Envelope2D.constructEmpty();if(u.setCoords({env2D:c}),u.inflateCoords(r,r),h.containsEnvelope(l))return!0;const m=e.getImpl().querySegmentIterator();m.stripAttributes(),m.nextPath()||i.throwInternalErrorException("relational_operations");let d,p,g,_,f,y,x=!1;const v=e.hasNonLinearSegments();for(v&&(g=new n.Line,_=new n.Line,f=new n.Line,y=new n.Line,h.querySide(0,g),h.querySide(1,_),h.querySide(2,f),h.querySide(3,y));;){for(;!m.hasNextSegment()&&m.nextPath(););if(!m.hasNextSegment())break;const e=m.nextSegment();if(v&&e.getGeometryType()!==i.GeometryType.enumLine){if(e.isIntersecting(g,r)){x=!0;break}if(e.isIntersecting(_,r)){x=!0;break}if(e.isIntersecting(f,r)){x=!0;break}if(e.isIntersecting(y,r)){x=!0;break}}else if(d=e.getStartXY(),p=e.getEndXY(),0!==h.clipLine(d,p)){x=!0;break}}return x}function xt(e,i,n,s){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),i.queryEnvelope(o),!!It(r,o,n)&&Rt(i,e,n,!0,!1,!1)}function vt(e,i,n,s){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),i.queryEnvelope(o),Ct(r,o,n)}function Pt(e,t,i,n){return Yt(e,t.getXY(),i)}function bt(e,i,n,s,o){const a=t.Envelope2D.constructEmpty(),l=t.Envelope2D.constructEmpty();if(e.queryEnvelope(a),i.queryEnvelope(l),l.height()<=n||l.width()<=n)return!1;if(s)return At(l,a,n);if(!It(l,a,n))return!1;let c=!1;const h=t.Envelope2D.constructEmpty(),u=t.Envelope2D.constructEmpty();h.setCoords({env2D:l}),u.setCoords({env2D:l}),h.inflateCoords(-n,-n),u.inflateCoords(n,n);const m=new r.Point2D;for(let t=0;t<e.getPointCount();t++){if(e.queryXY(t,m),!u.contains(m))return!1;h.containsExclusive(m)&&(c=!0)}return c}function Et(e,t,i,n){return r.Point2D.sqrDistance(e,t)<=i*i}function St(e,t,i,n){return Et(e,t,i)}function Ct(e,t,i,n){return It(e,t,i)&&It(t,e,i)}function wt(e,i,n,s,r){if(e.height()<=n||e.width()<=n)return!1;if(s)return At(e,i,n);if(!It(e,i,n))return!1;const o=t.Envelope2D.constructEmpty();return o.setCoords({env2D:e}),o.inflateCoords(-n,-n),o.intersect(i),!o.isEmpty()}function Tt(e,s,o,a,l){const c=new r.Point2D,h=new r.Point2D,u=t.Envelope2D.constructEmpty(),m=t.Envelope2D.constructEmpty(),d=e.getImpl(),p=s.getImpl(),g=p.getGeometryType(),_=new Xe(d,p,o,!0);if(!_.next())return 1;if(kt(e,s,o))return a?4:0;const f=new n.Polygon;let y=e;const x=new n.Polygon;let v=null;g===i.GeometryType.enumPolygon&&(v=s);const P=g===i.GeometryType.enumPolygon?r.makePrimitiveArray(d.getPathCount(),!1):[],b=r.makePrimitiveArray(p.getPathCount(),!1);let E=!1,S=!1,C=!1,w=!1,T=!1,D=!1;do{if(C&&T||w&&D)break;if(C&&w)break;const t=_.getRedElement(),n=_.getBlueElement();if(!b[n]&&(h.assign(s.getXY(s.getPathStart(n))),u.setCoords({env2D:_.getRedEnvelope()}),u.inflateCoords(o,o),u.contains(h))){if(0!==Qt(y,h,0)){if(w=!0,a)return 4}else D=!0;b[n]=!0}if(g===i.GeometryType.enumPolygon&&!P[t]&&(c.assign(e.getXY(e.getPathStart(t))),m.setCoords({env2D:_.getBlueEnvelope()}),m.inflateCoords(o,o),m.contains(c))){if(0!==Qt(v,c,0)){if(C=!0,a)return 4}else T=!0;P[t]=!0}if(E||(!Ce(e,s.getPathCount()-1)||null!==d.getAccelerators()&&null!==d.getAccelerators().getQuadTree()?y=e:(e.copyTo(f),f.getImpl().buildQuadTreeAccelerator(1),y=f),E=!0),g===i.GeometryType.enumPolygon&&!S){const t=s;!Ce(t,e.getPathCount()-1)||null!==p.getAccelerators()&&null!==p.getAccelerators().getQuadTree()?v=s:(t.copyTo(x),x.getImpl().buildQuadTreeAccelerator(1),v=x),S=!0}}while(_.next());if(!C&&!w)return 1;if(!T||!D){if(g===i.GeometryType.enumPolygon)for(let e=0,t=d.getPathCount();e<t;e++)if(!P[e]){T=!0;break}for(let e=0,t=p.getPathCount();e<t;e++)if(!b[e]){D=!0;break}}return C&&T||w&&D||C&&w?4:w?2:3}function Dt(e,s,r,o,a){o[0]=!1;const l=e.getImpl(),c=s.getImpl(),h=l.querySegmentIterator(),u=c.querySegmentIterator(),m=[0,0],d=[0,0],p=new Xe(l,c,r);let g=!1;for(;p.next();){const e=p.getRedElement(),t=p.getBlueElement();h.resetToVertex(e,-1),u.resetToVertex(t,-1);const i=h.nextSegment(),n=u.nextSegment();let s=0;if(Xt(i,n)?!g&&n.isIntersecting(i,r)&&(g=!0):s=n.intersect(i,null,d,m,r),0!==s&&(g=!0,1===s)){const e=m[0],t=d[0];if(e>0&&e<1&&t>0&&t<1)return o[0]=!0,!1}}if(!g){o[0]=!0;const a=t.Envelope2D.constructEmpty();e.queryEnvelope(a),a.inflateCoords(r,r);const h=new n.Polygon;let u=e,m=!1;for(let n=0,r=s.getPathCount();n<r;n++)if(s.getPathSize(n)>0){const r=t.Envelope2D.constructEmpty();if(s.queryPathEnvelope(n,r),!a.isIntersecting(r))return!1;{const e=Se(u,s.getXY(s.getPathStart(n)),0);if(i.geometryReleaseAssert(-1!==e),0===e)return!1}m||(!Ce(e,s.getPathCount()-1)||null!==l.getAccelerators()&&null!==l.getAccelerators().getQuadTree()?u=e:(e.copyTo(h),h.getImpl().buildQuadTreeAccelerator(1),u=h),m=!0)}if(1===e.getPathCount()||s.getGeometryType()===i.GeometryType.enumPolyline)return!0;const d=s,p=t.Envelope2D.constructEmpty();d.queryEnvelope(p),p.inflateCoords(r,r);const g=new n.Polygon;let _=d,f=!1;for(let n=0,s=e.getPathCount();n<s;n++)if(e.getPathSize(n)>0){const s=t.Envelope2D.constructEmpty();if(e.queryPathEnvelope(n,s),p.isIntersecting(s)){const t=Se(_,e.getXY(e.getPathStart(n)),0);if(i.geometryReleaseAssert(-1!==t),1===t)return!1}f||(!Ce(d,e.getPathCount()-1)||null!==c.getAccelerators()&&null!==c.getAccelerators().getQuadTree()?_=d:(d.copyTo(g),g.getImpl().buildQuadTreeAccelerator(1),_=g),f=!0)}return!0}return!1}function It(e,i,n){const s=t.Envelope2D.constructEmpty();return s.setCoords({env2D:e}),s.inflateCoords(n,n),s.containsEnvelope(i)}function At(e,i,n){const s=t.Envelope2D.constructEmpty();return s.setCoords({env2D:i}),s.inflateCoords(n,n),e.containsExclusiveEnvelope(s)}function Mt(e,i,n){const s=t.Envelope2D.constructEmpty();return s.setCoords({env2D:i}),s.inflateCoords(n,n),!(s.contains(e.getLowerLeft())&&s.contains(e.getLowerRight())&&s.contains(e.getUpperLeft())&&s.contains(e.getUpperRight()))}function Nt(e,t,i,n){if(e.getPathCount()!==t.getPathCount()||e.getPointCount()!==t.getPointCount())return!1;if(e.hasNonLinearSegments()||t.hasNonLinearSegments())return e.equals(t);const s=new r.Point2D,o=new r.Point2D;let a=!0;const l=i*i;for(let i=0;i<e.getPathCount();i++){if(e.getPathEnd(i)!==t.getPathEnd(i)){a=!1;break}for(let n=e.getPathStart(i);n<t.getPathEnd(i);n++)if(e.queryXY(n,s),t.queryXY(n,o),r.Point2D.sqrDistance(s,o)>l){a=!1;break}if(!a)break}return!!a}function Rt(e,t,i,n,s,o,a){const l=e.getImpl(),c=t.getImpl(),h=l.getPointCount(),u=c.getPointCount(),m=r.makePrimitiveArray(h,!1),d=s||o?r.makePrimitiveArray(u,!1):[],p=i*i,g=new Xe(l,c,i);for(;g.next();){const e=g.getRedElement(),t=g.getBlueElement(),i=l.getXY(e),n=c.getXY(t);r.Point2D.sqrDistance(i,n)<=p&&(m[e]=!0,(s||o)&&(d[t]=!0))}let _=!1,f=!1;for(let e=0;e<h;e++){const t=m[e];if(_||=!t,f||=t,(s||n)&&_)return!1}if(n)return!0;let y=!1,x=!1;for(let e=0;e<u;e++){const t=d[e];if(y||=!t,x||=t,s&&y)return!1}return!!s||_&&f&&y&&x}function Ot(e,t,i,n){return Gt(e,t,i,n)&&Gt(t,e,i,n)}function Gt(e,n,o,a){if(i.throwIfCurves(e),i.throwIfCurves(n),n.isEmpty())return!1;let l=!0;const c=r.makePrimitiveArray(2,Number.NaN),h=r.makePrimitiveArray(2,Number.NaN),u=[],m=new Wt;let d;const p=t.Envelope2D.constructEmpty(),g=t.Envelope2D.constructEmpty(),_=t.Envelope2D.constructEmpty();e.queryEnvelope(p),n.queryEnvelope(g),p.inflateCoords(o,o),g.inflateCoords(o,o),_.setCoords({env2D:p}),_.intersect(g);const f=e.getImpl().querySegmentIterator(),y=n.getImpl().querySegmentIterator(),x=n.getImpl().getAccelerators();let v=null,P=null,b=null,E=null;if(null!==x&&(v=x.getQuadTree(),P=x.getQuadTreeForPaths(),null!==P&&(E=P.getIteratorForQT())),null===v){const t=e.getPointCount(),i=n.getPointCount();t>10&&i>10&&(v=s.buildQuadTree(n.getImpl(),_))}for(null!==v&&(b=v.getIteratorForQT());f.nextPath();)for(;f.hasNextSegment();){let e=f.nextSegment();if(e.queryEnvelope(p),!p.isIntersecting(_))return l=!1,!1;if(null!==E&&(E.resetIterator(p,o),-1===E.next()))continue;let t=0,n=null;if(null!=b)b.resetIterator(e,o);else if(y.resetToFirstPath(),!y.nextPath())return l=!1,!1;do{if(t=0,null!==b){const i=b.next();if(-1===i)return l=!1,!1;y.resetToVertex(v.getElement(i),-1),n=y.nextSegment(),t=e.intersect(n,null,c,h,o)}else{for(;!y.hasNextSegment();)if(!y.nextPath())return l=!1,!1;n=y.nextSegment(),n.queryEnvelope(g),g.inflateCoords(o,o),p.isIntersecting(g)&&(t=e.intersect(n,null,c,h,o))}}while(2!==t||0!==c[0]||a&&!(h[0]<=h[1]));let r=Number.NaN,x=!1;do{let i=!1;if(1===c[1]){if(!f.hasNextSegment()){x=!0;break}e=f.nextSegment(),i=!0}if(1===h[1]&&h[0]<=h[1]){if(-1===r)break;if(r=1,!y.hasNextSegment())break;n=y.nextSegment(),i=!0}if(0===h[1]&&h[0]>h[1]){if(1===r)break;if(Number.isNaN(r)){if(!y.hasPreviousSegment())break;y.previousSegment(),r=-1}if(!y.hasPreviousSegment())break;n=y.previousSegment(),i=!0}if(!i)break;t=e.intersect(n,null,c,h,o)}while(2===t&&(!a||h[0]<=h[1]));if(x)continue;const P=e.calculateLength2D();e.queryEnvelope(p),u.length=0,m.m_overlapEvents.length=0;let S=!1,C=!1,w=0;const T=s.calculateToleranceFromGeometryForRel(null,p,!0);for(null!==b?b.resetIterator(e,o):(y.resetToFirstPath(),y.nextPath()||i.throwInternalErrorException("relational_operations"));;){if(t=0,null!==b){const i=b.next();if(-1===i)break;y.resetToVertex(v.getElement(i),-1),n=y.nextSegment(),t=e.intersect(n,null,c,h,o)}else{for(;!y.hasNextSegment()&&y.nextPath(););if(!y.hasNextSegment())break;n=y.nextSegment(),n.queryEnvelope(g),g.inflateCoords(o,o),p.isIntersecting(g)&&(t=e.intersect(n,null,c,h,o))}if(2===t&&(!a||h[0]<=h[1])){const e=f.getStartPointIndex(),t=f.getPathIndex(),i=y.getStartPointIndex(),n=y.getPathIndex();if(d=jt(e,t,c[0],c[1],i,n,h[0],h[1]),m.m_overlapEvents.push(d),u.push(u.length),!(S||d.m_scalarA0<w&&d.m_scalarA1<w))if(0===w&&P*(d.m_scalarA0-w)>o)S=!0;else if(0!==w&&P*(d.m_scalarA0-w)>T)S=!0;else if(w=d.m_scalarA1,P*(1-w)<=o||1===w){C=!0;break}}}if(!C){if(!S)return l=!1,!1;u.length>1&&u.sort(((e,t)=>m.compareOverlapEvents(e,t))),w=0;for(let e=0;e<m.m_overlapEvents.length;e++)if(d=m.m_overlapEvents[u[e]],!(d.m_scalarA0<w&&d.m_scalarA1<w)){if(0===w&&P*(d.m_scalarA0-w)>o)return l=!1,!1;if(0!==w&&P*(d.m_scalarA0-w)>T)return l=!1,!1;if(w=d.m_scalarA1,P*(1-w)<=o||1===w)break}if(P*(1-w)>o)return l=!1,!1;u.length=0,m.m_overlapEvents.length=0}}return l}function kt(e,t,i){const n=e.getImpl(),s=t.getImpl(),r=n.querySegmentIterator(),o=s.querySegmentIterator(),a=new Xe(n,s,i);for(;a.next();){const e=a.getRedElement(),t=a.getBlueElement();r.resetToVertex(e,-1),o.resetToVertex(t,-1);const n=r.nextSegment();if(o.nextSegment().isIntersecting(n,i))return!0}return!1}function Vt(e,t,i,n){const s=e.getImpl(),o=t.getImpl(),a=s.querySegmentIterator(),l=o.querySegmentIterator(),c=r.makePrimitiveArray(2,Number.NaN),h=new Xe(s,o,i);let u=!1,m=-1;for(;h.next();){const e=h.getRedElement(),t=h.getBlueElement();a.resetToVertex(e,-1),l.resetToVertex(t,-1);const s=a.nextSegment(),o=l.nextSegment();let d=0;if(Xt(s,o)){if(o.isIntersecting(s,i))return-2}else d=s.intersect(o,null,c,null,i);if(d)if(2===d){const e=s.calculateLength2D(),t=c[0];if(e*(c[1]-t)>i)return m=1,m;u=!0}else if(m=0,n){const e=c[0],t=new r.Point2D;s.queryCoord2D(e,t),n.push(t.x),n.push(t.y)}}return u?-2:m}function Ft(e,t,i,n){const s=e.getImpl(),o=t,a=o.getPointCount(),l=n?r.makePrimitiveArray(a,!1):[],c=new Xe(s,o,i,!1),h=s.querySegmentIterator();for(;c.next();){const e=c.getRedElement(),t=c.getBlueElement();h.resetToVertex(e,-1);const s=h.nextSegment(),r=o.getXY(t);if(s.isIntersectingPoint(r,i)){if(!n)return!0;l[t]=!0}}if(!n)return!1;for(let e=0;e<a;e++)if(!l[e])return!1;return!0}function Lt(e,i,n){const s=new r.Point2D,o=n*n,a=e.querySegmentIterator(),l=e.getImpl().getAccelerators();if(null!==l){const e=l.getQuadTree();if(null!==e){const l=t.Envelope2D.constructEmpty();l.setCoords({pt:i});const c=e.getIterator(l,n);for(let t=c.next();-1!==t;t=c.next())if(a.resetToVertex(e.getElement(t),-1),a.hasNextSegment()){const e=a.nextSegment(),t=e.getClosestCoordinate(i,!1);if(e.queryCoord2D(t,s),r.Point2D.sqrDistance(i,s)<=o)return!0}return!1}}const c=t.Envelope2D.constructEmpty();for(;a.nextPath();)for(;a.hasNextSegment();){const e=a.nextSegment();if(e.queryEnvelope(c),c.inflateCoords(n,n),!c.contains(i))continue;const t=e.getClosestCoordinate(i,!1);if(e.queryCoord2D(t,s),r.Point2D.sqrDistance(i,s)<=o)return!0}return!1}function qt(e,s,o,a){const l=e.querySegmentIterator(),c=e.getImpl().getAccelerators(),h=e.hasNonLinearSegments();let u=null,m=null,d=null,p=null;if(null!==c){const e=c.getQuadTree();if(null!==e){const r=e.getIterator(s,o);h&&(u=new n.Line,m=new n.Line,d=new n.Line,p=new n.Line,s.querySide(0,u),s.querySide(1,m),s.querySide(2,d),s.querySide(3,p));const a=t.Envelope2D.constructEmpty();a.setCoords({env2D:s}),a.inflateCoords(o,o);for(let t=r.next();-1!==t;t=r.next())if(l.resetToVertex(e.getElement(t),-1),l.hasNextSegment()){const e=l.nextSegment();if(e.getGeometryType()===i.GeometryType.enumLine){const t=e.getStartXY(),i=e.getEndXY();if(a.clipLine(t,i))return!0;continue}if(s.contains(e.getStartXY())||s.contains(e.getEndXY()))return!0;if(e.isIntersecting(u,o))return!0;if(e.isIntersecting(m,o))return!0;if(e.isIntersecting(d,o))return!0;if(e.isIntersecting(p,o))return!0}return!1}}if(h){u=new n.Line,m=new n.Line,d=new n.Line,p=new n.Line,s.querySide(0,u),s.querySide(1,m),s.querySide(2,d),s.querySide(3,p);const t=e.querySegmentIterator();for(;t.nextPath();)for(;t.hasNextSegment();){const e=t.nextSegment();if(s.contains(e.getStartXY())||s.contains(e.getEndXY()))return!0;if(e.isIntersecting(u,o))return!0;if(e.isIntersecting(m,o))return!0;if(e.isIntersecting(d,o))return!0;if(e.isIntersecting(p,o))return!0}}else{const i=t.Envelope2D.constructEmpty();i.setCoords({env2D:s}),i.inflateCoords(o,o);const n=e.getImpl(),a=n.getAttributeStreamRef(0),l=new r.Point2D;for(let e=0,t=n.getPathCount();e<t;e++){let t=!0;const s=new r.Point2D,o=new r.Point2D,c=new r.Point2D,h=n.getPathStart(e),u=new r.Point2D;for(let r=h,m=n.getPathEnd(e);r<m;r++)if(t)a.queryPoint2D(2*r,s),u.assign(s),t=!1;else{if(a.queryPoint2D(2*r,l),o.setCoordsPoint2D(s),c.setCoordsPoint2D(l),i.clipLine(o,c))return!0;s.assign(l)}if(n.isClosedPath(e)&&!t&&(o.setCoordsPoint2D(s),c.setCoordsPoint2D(u),i.clipLine(o,c)))return!0}}return!1}function Ht(e,i,n,o){const a=e.getImpl(),c=i.getImpl(),h=[0],u=s.isAtLeastWeakSimple(a.getIsSimple(0,h))&&s.isAtLeastWeakSimple(c.getIsSimple(0,h)),m=a.querySegmentIterator(),d=c.querySegmentIterator(),p=r.makePrimitiveArray(2,0),g=r.makePrimitiveArray(2,0),_=new Xe(a,c,n);let f=!1;for(;_.next();){const e=_.getRedElement(),t=_.getBlueElement();m.resetToVertex(e,-1),d.resetToVertex(t,-1);const i=m.nextSegment(),s=d.nextSegment();let r=0;if(Xt(i,s)){if(s.isIntersecting(i,n)){f=!0;break}}else r=s.intersect(i,null,g,p,n);if(2===r){const e=p[0],t=p[1],s=i.calculateLength2D();if(u&&(t-e)*s>n)return!1;f=!0}else if(r){const e=p[0],t=g[0];if(e>0&&e<1&&t>0&&t<1)return!1;f=!0}}if(!f)return!1;const y=t.Envelope2D.constructEmpty(),x=t.Envelope2D.constructEmpty(),v=t.Envelope2D.constructEmpty();let P,b;if(e.queryEnvelope(y),i.queryEnvelope(x),y.inflateCoords(1e3*n,1e3*n),x.inflateCoords(1e3*n,1e3*n),v.setCoords({env2D:y}),v.intersect(x),e.getPointCount()>10){if(P=l.clip$1(e,v,n,0,o),P.isEmpty())return!1}else P=e;if(i.getPointCount()>10){if(b=l.clip$1(i,v,n,0,o),b.isEmpty())return!1}else b=i;return Ne(P,b,n,"F********",o,!1)}function Ut(e,i,n,o){const a=e.getImpl(),c=i.getImpl(),h=[0],u=s.isAtLeastWeakSimple(a.getIsSimple(0,h))&&s.isAtLeastWeakSimple(c.getIsSimple(0,h)),m=t.Envelope2D.constructEmpty(),d=t.Envelope2D.constructEmpty(),p=t.Envelope2D.constructEmpty();e.queryEnvelope(m),i.queryEnvelope(d);let g=!1;const _=Mt(m,d,n),f=Mt(d,m,n),y=a.querySegmentIterator(),x=c.querySegmentIterator(),v=r.makePrimitiveArray(2,Number.NaN),P=r.makePrimitiveArray(2,Number.NaN),b=new Xe(a,c,n);for(;b.next();){const e=b.getRedElement(),t=b.getBlueElement();y.resetToVertex(e,-1),x.resetToVertex(t,-1);const i=y.nextSegment(),s=x.nextSegment();let r=0;if(Xt(i,s)){if(s.isIntersecting(i,n))break}else r=s.intersect(i,null,P,v,n);if(2===r){const e=v[0],t=v[1],s=i.calculateLength2D();if(u&&(t-e)*s>n&&(g=!0,_&&f))return!0}else if(r){const e=v[0],t=P[0];if(e>0&&e<1&&t>0&&t<1)return!0}}const E=t.Envelope2D.constructEmpty(),S=t.Envelope2D.constructEmpty();let C,w;E.setCoords({env2D:m}),E.inflateCoords(1e3*n,1e3*n),S.setCoords({env2D:d}),S.inflateCoords(1e3*n,1e3*n),p.setCoords({env2D:E}),p.intersect(S);let T="";if(T+=g?"**":"T*",_){if(i.getPointCount()>10){if(w=l.clip$1(i,p,n,0,o),w.isEmpty())return!1}else w=i;T+="****"}else w=i,T+="T***";if(f){if(e.getPointCount()>10){if(C=l.clip$1(e,p,n,0,o),C.isEmpty())return!1}else C=e;T+="***"}else C=e,T+="T**";return Ne(C,w,n,T,o,!1)}function zt(e,i,r,o){const a=[!1],c=Dt(e,i,r,a);if(a[0])return c;const h=t.Envelope2D.constructEmpty();let u;if(i.queryEnvelope(h),h.inflateCoords(1e3*r,1e3*r),e.getPointCount()>10){if(u=l.clip$1(e,h,r,0,o),u.isEmpty())return!1}else u=e;const m=function(e,i,r,o){const a=new Ue;a.resetMatrix_(),a.setPredicates_("T*****F**"),a.setAreaAreaPredicates_();const l=t.Envelope2D.constructEmpty(),c=t.Envelope2D.constructEmpty();e.queryEnvelope(l),i.queryEnvelope(c);let h=!1;if($e(l,c,r)&&(a.areaAreaDisjointPredicates_(e,i),h=!0),h||Ke(e,i),h)return qe(a.m_matrix,a.m_scl);let u=new n.EditShape,m=u.addGeometry(e),d=u.addGeometry(i),p=null,g=0;if(e.hasNonLinearSegments()||i.hasNonLinearSegments()){p=new li;const e=ri(r,u.getEnvelope2D(o));g=ai(e,0),ii(u,e,r,0,p,null,o)}hi(u,new s.CombinedTolerance(r,0).add(g),o,!1,!1);const _=u.getGeometry(d).getBoundary();if(u.filterClosePoints(0,!0,!0,!1,n.nullHandle),Ae(u,m,-1,!1,n.nullHandle,o),0===u.getPointCount(m))return!1;Ae(u,d,-1,!1,n.nullHandle,o),a.setEditShape_(u,o);const f=0===u.getPointCount(d);if(!f){a.computeMatrixTopoGraphHalfEdges_(m,d),a.m_topoGraph.removeShape();const e=qe(a.m_matrix,a.m_scl);if(!e)return e}const y=u.getGeometry(m);return u=new n.EditShape,m=u.addGeometry(y),d=u.addGeometry(_),a.setEditShape_(u,o),a.m_predicateCount=0,a.resetMatrix_(),a.setPredicates_(f?"T*****F**":"******F**"),a.setAreaLinePredicates_(),a.computeMatrixTopoGraphHalfEdges_(m,d),a.m_topoGraph.removeShape(),qe(a.m_matrix,a.m_scl)}(u,i,r,o);return m}function Yt(e,t,i,n){const s=new r.Point2D,o=i*i;for(let i=0;i<e.getPointCount();i++)if(e.queryXY(i,s),r.Point2D.sqrDistance(s,t)<=o)return!1;return!0}function Bt(e,t,i){const n=e.getBoundary();return!n.isEmpty()&&!Yt(n,t,i)}function Xt(e,t){return e.getGeometryType()!==i.GeometryType.enumLine||t.getGeometryType()!==i.GeometryType.enumLine}function jt(e,t,i,n,s,r,o,a){return{m_ivertexA:e,m_ipathA:t,m_scalarA0:i,m_scalarA1:n,m_ivertexB:s,m_ipathB:r,m_scalarB0:o,m_scalarB1:a}}class Wt{constructor(){this.m_overlapEvents=[]}compareOverlapEvents(e,t){const i=this.m_overlapEvents[e],n=this.m_overlapEvents[t];if(i.m_ipathA<n.m_ipathA)return-1;if(i.m_ipathA===n.m_ipathA){if(i.m_ivertexA<n.m_ivertexA)return-1;if(i.m_ivertexA===n.m_ivertexA){if(i.m_scalarA0<n.m_scalarA0)return-1;if(i.m_scalarA0===n.m_scalarA0){if(i.m_scalarA1<n.m_scalarA1)return-1;if(i.m_scalarA1===n.m_scalarA1&&i.m_ivertexB<n.m_ivertexB)return-1}}}return 1}}function Zt(e,t,i){const n=function(e,t,i){return t.isEmpty()?0:Se(e,t.getXY(),i)}(e,t,i);return n?1===n?1:2:0}function Qt(e,t,i){const n=Se(e,t,i);return n?1===n?1:2:0}function $t(e,n,s,r,o){if(e.getGeometryType()===i.GeometryType.enumPolygon)!function(e,t,i,n,s){for(let r=0;r<i;r++)s[r]=Qt(e,t[r],n)}(e,n,s,r,o);else if(e.getGeometryType()===i.GeometryType.enumEnvelope){const i=t.Envelope2D.constructEmpty();e.queryEnvelope(i),function(e,t,i,n,s){if(e.isEmpty()){for(let e=0;e<i;e++)s[e]=0;return}const r=e.clone();r.inflateCoords(.5*-n,.5*-n);const o=e.clone();o.inflateCoords(.5*n,.5*n);for(let e=0;e<i;e++)r.contains(t[e])?s[e]=1:o.contains(t[e])?s[e]=2:s[e]=0}(i,n,s,r,o)}else i.throwInvalidCallException("")}function Kt(e,n,r,o,a){const l=e.getGeometryType();l===i.GeometryType.enumPolyline?function(e,n,r,o,a){const l=e.getImpl(),c=l.getAccelerators();let h=null;c&&(h=c.getRasterizedGeometry());let u=r;for(let e=0;e<r;e++)a[e]=1,h&&i.geometryReleaseAssert(0);if(u){if(c){let e=null;null!==c&&null!==c.getQuadTree()&&(e=c.getQuadTree());const i=l.getPointCount();if(null===e&&i>20&&i*r>4*i+Math.log(i)*r&&(e=s.buildQuadTree(l)),e){let i=null;const s=l.querySegmentIterator(),c=new t.Envelope2D;for(let t=0;t<r&&u;t++)if(1===a[t]){c.setCoords(n[t]),null===i?i=e.getIterator(c,o):i.resetIterator(c,o);let r=-1;for(let l=i.next();-1!==l;l=i.next()){if(s.resetToVertex(e.getElement(l),r),r=s.getPathIndex(),s.nextSegment().isIntersectingPoint(n[t],o)){a[t]=2,u--;break}a[t]=0}}return}}const e=l.querySegmentIterator();for(;e.nextPath()&&u;)for(;e.hasNextSegment()&&u;){const t=e.nextSegment();for(let e=0;e<r&&u;e++)1===a[e]&&t.isIntersectingPoint(n[e],o)&&(a[e]=2,u--)}}for(let e=0;e<r;e++)1===a[e]&&(a[e]=0)}(e,n,r,o,a):i.isSegment(l)?i.geometryReleaseAssert(0):i.throwInvalidCallException("")}function Jt(){return Number.isNaN(this.radius.value())}function ei(e,t,i,n){return{pt:e.clone(),t,err:i,checkCount:n}}class ti{constructor(e,t,i,s,o){this.m_left=e,this.m_tracker=o,this.m_eps=i,this.m_trackerCounter=0,this.m_tolerance=s,this.m_circleCheckCounter=0,this.m_bReversedLeft=!1,this.m_leftArc={ptStart:new r.Point2D,ptEnd:new r.Point2D,center:new n.EPoint2D,radius:new r.ECoordinate,fcenter:new n.MPPoint2D,fradius2:new r.MPValue,maxError:Number.NaN,isLine:Jt}}closeToCircularArc(e,t,i,s,o,a){if(this.m_circleCheckCounter++,a.maxError=0,!ti.checkSweepAngle(e,t))return!1;if(a.ptStart.setCoordsPoint2D(i),a.ptEnd.setCoordsPoint2D(o),e.isCircular()){const t=e;return a.fradius2=r.MPValue.constructDouble(t.getSemiMajorAxis()).mulDouble(t.getSemiMajorAxis()),a.radius.set(t.getSemiMajorAxis()),a.fcenter.assignPoint2D(t.getCenter()),a.center.set(t.getCenter()),!0}const l=a.ptEnd.sub(a.ptStart).clone();if(l.leftPerpendicularThis(),l.normalize(),Math.abs(l.dotProduct(s.sub(a.ptStart)))<=this.m_eps)return!!this.confirmIsLine(a,l)&&(a.radius.set(Number.NaN),a.center.setCoords(0,0),!0);{const i=a.ptEnd.sub(a.ptStart),n=s.sub(a.ptStart),r=i.crossProduct(n);if(0===r)return!1;const o=.5*i.sqrLength(),l=.5*n.sqrLength();let c=o*n.y-l*i.y;c/=r;let h=i.x*l-n.x*o;h/=r;const u=Math.sqrt(c*c+h*h);if(4*Number.EPSILON*u>this.m_eps)return!1;const m=c+a.ptStart.x,d=h+a.ptStart.y;a.radius.set(u),a.center.setCoords(m,d);const p=this.maxCircleApproximationError(e,t,a);if(p>this.m_eps)return a.maxError=p,!1}const c=(new n.MPPoint2D).assignPoint2D(a.ptStart),h=(new n.MPPoint2D).assignPoint2D(a.ptEnd).sub(c),u=(new n.MPPoint2D).assignPoint2D(s).sub(c),m=h.crossProduct(u);if(m.isZero())return!1;const d=h.sqrLength().mulDouble(.5),p=u.sqrLength().mulDouble(.5),g=d.mul(u.y).sub(p.mul(h.y)),_=h.x.mul(p).sub(u.x.mul(d)),f=g.mul(g).add(_.mul(_)),y=m.clone();y.invertThis(),a.fradius2=f.mul(y).mul(y),a.fcenter.setCoords(g.mul(y).add(c.x),_.mul(y).add(c.y)),a.center.setWithEps(a.fcenter.asPoint2D()),a.radius.setWithEps(Math.sqrt(a.fradius2.toDouble()));const x=n.EPoint2D.constructPoint2D(a.ptStart).subE(a.center),v=n.EPoint2D.constructPoint2D(a.ptEnd).subE(a.center);if(!x.dotProduct(v).gt(r.s_zero))return!1;const P=this.maxCircleApproximationError(e,t,a);return a.maxError=P,P<=this.m_eps}static checkSweepAngle(e,t){if(e.getGeometryType()===i.GeometryType.enumEllipticArc){const i=e,s=n.tToParametricAngle(i,t.vmin),o=n.tToParametricAngle(i,t.vmax);return!(Math.abs(o-s)>.5*r.geometryHalfPi)}return!0}confirmIsLine(e,t){const i=e.ptEnd.sub(e.ptStart);return!(Math.abs(t.dotProduct(i.mul(.25)))>this.m_eps||Math.abs(t.dotProduct(i.mul(.75)))>this.m_eps)}maxCircleApproximationError(e,t,n){const s=[.25,.75],o=[.1,.25,.75,.9];let a,l;e.getGeometryType()===i.GeometryType.enumEllipticArc?(a=s,l=s.length):(a=o,l=o.length);let c=0;for(let i=0;i<l;++i){const s=new r.Point2D;e.queryCoord2D(r.lerp(t.vmin,t.vmax,a[i]),s);const o=s.sub(n.center.value()).length(),l=Math.abs(o-n.radius.value());l>c&&(c=l)}return c}approximateWithCirclesImpl(e,t){let i=1;t&&t.push(0);const n=r.makePrimitiveArray(9,Number.NaN);let s;e?s=this.m_left.getMonotonicPartParams(n.length,n):(n[0]=0,n[1]=1,s=2);const o=[],a=[],l=new r.Point2D(0,0);for(let e=1;e<s;e++){const s=new r.Envelope1D(n[e-1],n[e]);for(this.m_bReversedLeft=!ti.goodOrientation(this.m_left,s),this.m_bReversedLeft?(o.push(ei(l,s.vmin,0,0)),o.push(ei(l,s.vmax,0,0))):(o.push(ei(l,s.vmax,0,0)),o.push(ei(l,s.vmin,0,0))),o[0].pt=this.m_left.getCoord2D(o[0].t),o[1].pt=this.m_left.getCoord2D(o[1].t);o.length>1;){this.progress_();const e=o.at(-1);let n=e.checkCount,s=e.err;const l=e.pt.clone(),c=e.t,h=o[o.length-2].t,u=.5*(c+h),m=this.m_left.getCoord2D(u);if(s<=this.m_eps||n>=5){const e=new r.Envelope1D;if(e.setCoords(c,h),this.closeToCircularArc(this.m_left,e,l,m,o[o.length-2].pt,this.m_leftArc)){t&&(this.m_bReversedLeft?a.push(c):t.push(h)),i++,o.pop();continue}n=0,s=this.m_leftArc.maxError}e.t=u,e.pt.setCoordsPoint2D(m),s*=.125,n++,e.err=s,e.checkCount=n,o.push(ei(l,c,s,n))}this.m_bReversedLeft&&t&&(t.length=t.length+a.length,r.memcpy(t,a.reverse(),t.length-a.length,0,a.length),a.length=0),o.length=0}return i}approximateWithCirclesImplPolyline(e){const t=new n.Polyline,i=[];if(!this.approximateWithCirclesImpl(!0,i))return t;let s=0;const o=this.m_left.getStartXY();t.startPath(o);for(let a=1;a<i.length;++a)if(e)t.lineTo(this.m_left.getCoord2D(i[a]));else{const e=new r.Point2D;this.m_left.queryCoord2D(i[a],e);const l=new r.Point2D;this.m_left.queryCoord2D(.5*(i[a]+s),l);const c=new n.EllipticArc;c.constructCircularArcThreePoint(o,e,l),t.addSegment(c,!1),o.assign(e),s=i[a]}return t}static goodOrientation(e,t){const i=e.getCoord2D(t.vmin),n=e.getCoord2D(t.vmax);return i.compare(n)<0}progress_(e=!1){}}function ii(e,t,i,n,s,r,o){!function(e,t,i,n,s,r){e.hasCurves()?(e.setCurveStitcherPointer(n),n.m_impl=new ci(r,!1,null),n.m_impl.buildMonotonicCurveParentage(e,t,i,s)):n.m_impl=null}(e,t,i,s,r,o),mi(e,i,o)}function ni(e,t,i,n,s,r,o,a){e.hasCurves()?(e.setCurveStitcherPointer(r),r.m_impl=new ci(a,!0,s),r.m_impl.buildMonotonicCurveParentage(e,t,i,o),mi(e,i,a)):r.m_impl=null}function si(e){if(!e.hasSegmentParentage())return;const t=e.queryVertexIteratorOnSelection();for(let i=t.next();i!==n.nullHandle;i=t.next())if(!e.getSegmentParentageBreakVertex(i)){e.getPathFromVertex(i);const t=e.getPrevVertex(i),s=t!==n.nullHandle?e.getSegmentParentage(t):-1,r=e.getSegmentParentage(i);-1!==r&&-1!==s&&r!==s&&e.setSegmentParentageBreakVertex(i,!0)}}function ri(e,i){return i||(i=t.Envelope2D.constructEmpty()),function(e,t){let i=t.isEmpty()?e:s.calculateToleranceFromGeometryForOp(null,t,!0).total();return i>e&&(i=e),.125*i}(e,i)}function oi(e,t){return.125*e}function ai(e,t){return 3*e+3*t}class li{constructor(){this.m_impl=null}stitchCurves(e,t,i,n){this.m_impl&&(this.m_impl.stitchCurves(e,t,i),n&&this.clearStitcher(e))}clearStitcher(e){this.m_impl&&(this.m_impl.clearStitcher(e),this.m_impl=null)}getOriginalVertexIndex(e,t){return this.m_impl.getOriginalVertexIndex(e,t)}getOriginalSegmentTypeInfo(e){return this.m_impl.getOriginalSegmentTypeInfo(e)}}class ci{constructor(e,t,i){this.m_originalPlanarSegments=[],this.m_progressTracker=null,this.m_nsr=null,this.m_progressTracker=e,this.m_nsr=i,this.m_tolerance=0,this.m_originalVertexIndex=-1,this.m_type=1,this.m_progressCounter=0,this.m_bIsSimple=t,this.m_densificationDeviation=NaN,this.m_maxSegmentsPerCurve=-1}buildMonotonicCurveParentage(e,t,r,o){const a=!1;if(!e.hasCurves())return;i.geometryReleaseAssert(!e.hasSegmentParentage()),this.m_originalPlanarSegments.length=0,this.m_bIsSimple&&(this.m_originalVertexIndex=e.createUserIndex()),this.m_tolerance=r;const l=new s.Point,c=new n.SegmentBuffer,h=[],m=[],d=[];for(let s=e.getFirstGeometry();s!==n.nullHandle;s=e.getNextGeometry(s))for(let o=e.getFirstPath(s);o!==n.nullHandle;o=e.getNextPath(o)){let s=e.getPathSize(o),p=e.getFirstVertex(o),g=0,_=-1;for(let f=0;f<s;f++){let y=e.getNextVertex(p);if(!e.querySegment(p,c,!0,!1)){p=y;continue}if(0===g){_=e.getVertexIndex(p);const t=ci.regularizeCurve(e,c.get(),p,r);if(t>=0){this.m_nsr&&0===this.m_nsr.m_reason&&this.m_nsr.assign(new u.NonSimpleResult(13,_,-1)),g=t,s=e.getPathSize(o),y=e.getNextVertex(p);const n=e.querySegment(p,c,!0,!1);i.geometryReleaseAssert(n)}}else g--;const x=e.getVertexIndex(p);let v;-1!==this.m_originalVertexIndex&&e.setUserIndex(p,this.m_originalVertexIndex,_),e.setSegmentToIndex(x,null);let P=!1;switch(c.get().getGeometryType()){case i.GeometryType.enumEllipticArc:case i.GeometryType.enumRationalBezier2:v=n.approximationWithQuadraticRationalBeziers(c.get(),t,r,a,!0,m,d,h),P=!0;break;default:{const e=!this.m_bIsSimple||!c.get().isMonotoneQuickAndDirty();v=n.approximationWithBeziers(c.get(),t,r,e,a,m,h)}}const b=this.m_originalPlanarSegments.length;if(e.setSegmentParentageAndBreak(p,b,!0),!m[1].isNAN()){let t=null;t=P?new n.QuadraticRationalBezier({points:m,weights:d}):new n.CubicBezier({cp:m}),t.snapControlPoints(r*r),e.setSegmentToIndex(x,t)}const E=P?2:3;for(let t=1,i=v,s=E;t<i;++t,s+=E){c.get().queryCoord(h[t],l);const i=e.insertVertex(o,y,l);if(-1!==this.m_originalVertexIndex&&e.setUserIndex(i,this.m_originalVertexIndex,_),!m[s+1].isNAN())if(P){const t=new n.QuadraticRationalBezier({points:m.slice(s),weights:d.slice(s)});t.snapControlPoints(r*r),e.setSegmentToIndex(e.getVertexIndex(i),t)}else{const t=new n.CubicBezier({cp:m.slice(s)});t.snapControlPoints(r*r),e.setSegmentToIndex(e.getVertexIndex(i),t)}e.setSegmentParentageAndBreak(i,b,!1)}v>1&&(f+=v-1,s=e.getPathSize(o)),this.m_originalPlanarSegments.push(c.releaseSegment()),p=y}}}buildLinearSegmentParentage(e,t,r,o,a){if(this.m_type=0,this.m_densificationDeviation=t,this.m_maxSegmentsPerCurve=o,!e.hasCurves())return;i.geometryReleaseAssert(!e.hasSegmentParentage()),this.m_tolerance=r,this.m_originalPlanarSegments=[],this.m_bIsSimple&&(this.m_originalVertexIndex=e.createUserIndex());const l=new s.Point,c=new n.SegmentBuffer,h=new n.Densificator(0,t,0,this.m_progressTracker,!1,o),u=[];for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t))for(let s=e.getFirstPath(t);s!==n.nullHandle;s=e.getNextPath(s)){let t=e.getPathSize(s),n=e.getFirstVertex(s);for(let o=0;o<t;o++){let o=e.getNextVertex(n);if(!e.querySegment(n,c,!0,!1)){n=o;continue}if(ci.regularizeCurve(e,c.get(),n,r)>=0){t=e.getPathSize(s),o=e.getNextVertex(n);const r=e.querySegment(n,c,!0,!1);i.geometryReleaseAssert(r)}const a=e.getVertexIndex(n);-1!==this.m_originalVertexIndex&&e.setUserIndex(n,this.m_originalVertexIndex,a),e.setSegmentToIndex(a,null),u.length=0,h.densifySegment(c.get(),u),this.progress_();const m=this.m_originalPlanarSegments.length;e.setSegmentParentageAndBreak(n,m,!0);for(let t=1,i=u.length-1;t<i;++t){c.get().queryCoord(u[t],l);const i=e.insertVertex(s,o,l);e.setSegmentParentageAndBreak(i,m,!1),-1!==this.m_originalVertexIndex&&e.setUserIndex(i,this.m_originalVertexIndex,a)}this.m_originalPlanarSegments.push(c.releaseSegment()),n=o}}e.clearSegments()}stitchCurves(e,t,i){ci.st_stitchCurvesImpl(this,e,t,i,!1)}clearStitcher(e){this.m_originalPlanarSegments.length=0,-1!==this.m_originalVertexIndex&&(e.removeUserIndex(this.m_originalVertexIndex),this.m_originalVertexIndex=-1),e.deleteSegmentParentage()}static st_verifyParentage(e){ci.st_stitchCurvesImpl(null,e,n.nullHandle,0,!0)}getOriginalVertexIndex(e,t){return-1!==this.m_originalVertexIndex&&t!==n.nullHandle?e.getUserIndex(t,this.m_originalVertexIndex):-1}getOriginalSegmentTypeInfo(e){if(-1!==e){const t=this.m_originalPlanarSegments[e];switch(t.getGeometryType()){case i.GeometryType.enumEllipticArc:return 0===t.projectionBehavior()?0:1;case i.GeometryType.enumBezier:return 2;case i.GeometryType.enumBezier2:return 3;case i.GeometryType.enumLine:return-1;case i.GeometryType.enumRationalBezier2:return 4;default:i.throwNotImplementedException("")}}return-1}progress_(e=!1){this.m_progressCounter++}processSpanSmartTe_(e,t,s,o,a,l,c){if(t===s&&0===o)return i.geometryReleaseAssert(e.getNextVertex(t)===n.nullHandle),e.setSegmentToIndex(e.getVertexIndex(t),null),void e.setSegmentParentageAndBreak(t,-1);const h=e.getNextVertex(t),u=e.getXY(t),m=e.getXY(s);let d,p=0;{let t=2,n=u;for(let i=h;i!==s;i=e.getNextVertex(i)){const s=e.getXY(i);p+=r.Point2D.distance(s,n),n=s,t++}p+=r.Point2D.distance(m,n),i.geometryReleaseAssert(t===o)}if(null===a)return e.setSegmentToIndex(e.getVertexIndex(t),null),void e.removeVertices(h,s);const g=c;let _=a.getClosestCoordinate(u,!1),f=a.getClosestCoordinate(m,!1);const y=a.calculateLength2D();let x=a.tToLength(_),v=a.tToLength(f);const P=Math.abs(x)>10*g&&Math.abs(x-y)>10*g,b=Math.abs(v)>10*g&&Math.abs(v-y)>10*g,E=e=>{const t=e.calculateLength2D();return Math.abs(t-p)>Math.max(.2*p,4*g)?null:e};let S=a.isClosed();if(!S){const e=r.Point2D.distance(a.getStartXY(),a.getEndXY());e<=g&&y>5*e&&(S=!0)}if(S){let n,l,c=new r.Point2D;if(2===o)c=r.Point2D.lerp(u,m,.5),n=a.getClosestCoordinate(c,!1),l=a.tToLength(n);else{let i=e.getNextNthVertex(t,(o-1)/2);c=e.getXY(i),n=a.getClosestCoordinate(c,!1),l=a.tToLength(n);let s=Math.abs(l)>10*g&&Math.abs(l-y)>10*g;if(!s&&(o-1>=4&&(i=e.getNextNthVertex(t,(o-1)/4),n=a.getClosestCoordinate(c,!1),l=a.tToLength(n),s=Math.abs(l)>10*g&&Math.abs(l-y)>10*g),!s))return}let h=!1;const p=x===v;if(p){const i=0;let n=2,s=4;o-1<=4&&(n=i+1,s=i+2);const l=u,c=e.getXY(e.getNextNthVertex(t,n)),m=e.getXY(e.getNextNthVertex(t,s));h=-r.Point2D.orientationNonRobust(l,c,m)*r.sign(a.calculateArea2DHelper())>0}else b?P?h=l>x:l<v?(x=0,_=0):(x=y,_=1):l>x?(v=y,f=1):(v=0,f=0);if(p)d=a.clone(),d.dropAllAttributes(),h||d.reverse(),i.geometryReleaseAssert(u.equals(m));else{let e=!1;_>f&&(e=!0,[_,f]=[f,_]),d=a.cut(_,f,!0),d.getDescription().getAttributeCount(),e&&d.reverse()}d.setCoordsForIntersector(u,m,!1),d=E(d),d&&(this.removeSpanBetween(e,t,s),e.setSegmentToIndex(e.getVertexIndex(t),d))}else if(P||b){if((!P||!b)&&r.Point2D.distance(a.getStartXY(),a.getEndXY())<10*g){const i=[r.makePair(_,f),r.makePair(_,f),r.makePair(_,f)];P?(i[1].second=0,i[2].second=1):(i[1].first=1,i[2].first=0);const n=[null,null,null],o=[0,0,0];let l=Number.MAX_VALUE,c=0;for(let e=0;e<3;e++){let t=!1;if(i[e].first>i[e].second){t=!0;const n=i[e].first;i[e].first=i[e].second,i[e].second=n}n[e]=a.cut(i[e].first,i[e].second,!0),n[e].dropAllAttributes(),t&&n[e].reverse(),n[e].setCoordsForIntersector(u,m,!1),o[e]=n[e].calculateLength2D();const s=Math.abs(p-o[e]);s<l&&(l=s,c=e)}return d=n[c],d=E(d),void(d&&(this.removeSpanBetween(e,t,s),e.setSegmentToIndex(e.getVertexIndex(t),d)))}let i=!1;_>f&&(i=!0,[_,f]=[f,_]),d=a.cut(_,f,!0),d.dropAllAttributes(),i&&d.reverse(),d.setCoordsForIntersector(u,m,!1),d=E(d),d&&(this.removeSpanBetween(e,t,s),e.setSegmentToIndex(e.getVertexIndex(t),d))}else{if(d=a.clone(),d.dropAllAttributes(),x>v&&d.reverse(),p<Math.max(.75*y,y-this.m_densificationDeviation*(o-1))){const e=_>f?f:_,t=d.tToLength(e)+p;let i=d.lengthToT(t);i=r.snap(i,e,1),d=d.cut(e,i,!0)}d.setCoordsForIntersector(u,m,!1),d=E(d),d&&(this.removeSpanBetween(e,t,s),e.setSegmentToIndex(e.getVertexIndex(t),d))}}processSpanCurves_(e,t,s,r,o,a,l){if(t===s&&0===r)return i.geometryReleaseAssert(e.getNextVertex(t)===n.nullHandle),e.setSegmentToIndex(e.getVertexIndex(t),null),void e.setSegmentParentageAndBreak(t,-1);const c=e.getNextVertex(t);{let t=2;for(let i=c;i!==s;i=e.getNextVertex(i))t++;i.geometryReleaseAssert(t===r)}if(null===o)return e.setSegmentToIndex(e.getVertexIndex(t),null),void e.removeVertices(c,s);const h=e.getXY(t),u=e.getXY(s);if(o.isClosed()){if(h.isEqualPoint2D(u)&&h.isEqualPoint2D(o.getStartXY())){let i;if(i=this.verifySegmentFitnessCurves(e,t,s,r,o,a,l)){const n=o.clone();return n.dropAllAttributes(),i<0&&n.reverse(),this.removeSpanBetween(e,t,s),void e.setSegmentToIndex(e.getVertexIndex(t),n)}}}else if(h.isEqualPoint2D(o.getStartXY())){if(u.isEqualPoint2D(o.getEndXY())){const n=o.clone();n.dropAllAttributes();const c=this.verifySegmentFitnessCurves(e,t,s,r,n,a,l);if(c)return i.geometryReleaseAssert(c>0),this.removeSpanBetween(e,t,s),void e.setSegmentToIndex(e.getVertexIndex(t),n)}}else if(u.isEqualPoint2D(o.getStartXY())&&h.isEqualPoint2D(o.getEndXY())){const n=o.getReversed();n.dropAllAttributes();const c=this.verifySegmentFitnessCurves(e,t,s,r,n,a,l);if(c)return i.geometryReleaseAssert(c>0),this.removeSpanBetween(e,t,s),void e.setSegmentToIndex(e.getVertexIndex(t),n)}this.processSpanSplitSegmentCurves(e,t,s,r,o,a,l)}processSpan_(e,t,i,n,s,r,o){return 0===this.m_type?void this.processSpanSmartTe_(e,t,i,n,s,r,o):void this.processSpanCurves_(e,t,i,n,s,r,o)}processSpanSplitSegmentCurves(e,t,i,n,s,o,a){if(s.isLine())return;if(this.fitSegmentToSpanCurves(e,t,i,n,s,o,a))return;const l=a*a;let c=n,h=t;const u=e.getXY(t);let m=s.getClosestCoordinate(u,!1);const d=s.getCoord2D(m);let p=!1;const g=r.Point2D.sqrDistance(u,d);if(g>l){const n=e.getNextVertex(t);if(this.approximateSpanSectionCurves(e,t,s,o,a),n===i)return;h=n,p=!0,c-=1}let _=i;const f=e.getXY(i);m=s.getClosestCoordinate(f,!1);const y=s.getCoord2D(m);let x=!1;const v=r.Point2D.sqrDistance(f,y);if(v>l){const t=e.getPrevVertex(i);if(this.approximateSpanSectionCurves(e,t,s,o,a),t===h)return;_=t,x=!0,c-=1}if((p||x)&&this.fitSegmentToSpanCurves(e,h,_,c,s,o,a))return;let P=!1;if(!p&&g>0){const i=e.getNextVertex(t);if(this.approximateSpanSectionCurves(e,t,s,o,a),i===_)return;h=i,p=!0,P=!0,c-=1}if(!x&&v>0){const t=e.getPrevVertex(i);if(this.approximateSpanSectionCurves(e,t,s,o,a),t===h)return;_=t,x=!0,P=!0,c-=1}if(P&&this.fitSegmentToSpanCurves(e,h,_,c,s,o,a))return;let b=h;for(;;){const t=e.getNextVertex(b);if(this.approximateSpanSectionCurves(e,b,s,o,a),b=t,b===_)return}}fitSegmentToSpanCurves(e,t,i,s,o,a,l){const c=[];c.push(e.getXY(t));let h=t;const u=new n.SegmentBuffer;for(;;){e.querySegment(h,u,!1,!0);const t=[.1,.25,.4,.5,.6,.75,.9,1];let n=0;for(const e of t)(2===s||1&n)&&c.push(u.get().getCoord2D(e)),n++;if(h=e.getNextVertex(h),h===i)break}const m=(()=>{let e=c[0].compare(c.at(-1));if(0===e){const t=new r.KahanSummator(0);!function(e,t,i){if(i.reset(),t<3)return;const n=e[0].clone(),s=n.x,o=n.y,a=e[1].clone(),l=new r.Point2D;for(let s=2;s<t;s++)l.assign(e[s]),i.pe((l.x-n.x)*(a.y-o)),n.assign(a),a.assign(l);i.pe((s-n.x)*(a.y-o))}(c,c.length,t),e=t.getResult()>=0?-1:1}return e>0})();m&&c.reverse();const d=o.clone();if(d.dropAllAttributes(),m&&d.reverse(),d.setSegmentFromCoordsForStitcher(c,c.length),m&&d.reverse(),d.snapControlPoints(this.m_tolerance*this.m_tolerance),this.verifySegmentFitnessCurves(e,t,i,s,d,a,l)){this.removeSpanBetween(e,t,i);const n=e.getVertexIndex(t);return e.setSegmentToIndex(n,d),!0}return!1}approximateSpanSectionCurves(e,t,o,a,l){const c=new n.SegmentBuffer;if(!e.querySegment(t,c,!0,!1))return;const h=o.getGeometryType();if(h!==c.get().getGeometryType()){if(h===i.GeometryType.enumEllipticArc){if(c.get().getGeometryType()!==i.GeometryType.enumRationalBezier2)return;if(0===o.projectionBehavior()){const i=[];!function(e,t,i,s,r){const o=n.minTolerance(t),a=Math.max(4*o,i);new ti(t,null,a,Number.NaN,r).approximateWithCirclesImpl(!1,s)}(0,c.get(),l,i,this.m_progressTracker);const o=e.getNextVertex(t),a=e.getPathFromVertex(t),h=new s.Point;let u=t;for(let t=1,s=i.length;t<s;t++){const s=i[t],l=c.get().getCoord2D(i[t-1]),m=c.get().getCoord2D(r.lerp(i[t-1],s,.5));c.get().queryCoord(s,h);const d=h.getXY(),p=new n.EllipticArc;p.constructCircularArcThreePoint(l,d,m);let g=n.nullHandle;s<1&&(g=e.insertVertex(a,o,h)),e.setSegmentToIndex(e.getVertexIndex(u),p),u=g}return}{const i=r.makeObjectArray(r.Point2D,3);c.get().queryControlPoints(i);const s=[0,0,0];c.get().queryWeights(s);const o=n.calculateStandardWeight(s),a=new n.EllipticArc;return n.nurbs2ToArc128(i,o*o,null,!1,a),void e.setSegmentToIndex(e.getVertexIndex(t),a)}}i.throwInternalErrorException("approximate_span_section_")}}verifySegmentFitnessCurves(e,t,i,s,o,a,l){const c=e.getXY(t),h=e.getXY(i);if(!c.isEqualPoint2D(o.getStartXY())||!h.isEqualPoint2D(o.getEndXY()))return 0;let u=0;if(o.isClosed()){const e=o.getCoord2D(.1).sub(c);u=o.getCoord2D(.7).sub(c).crossProduct(e)>=0?1:-1}const m=r.makePrimitiveArray(n.Segment.s_maxMonotonicPartParams,Number.NaN);let d=o.getMonotonicPartParams(m.length,m);d--;const p=new n.Line,g=[1,.5,.75,.25];let _=0,f=t;const y=c.clone();for(;;){const t=e.getNextVertex(f);let n=e.getSegment(f);null===n&&(e.queryLineConnector(f,p,!0),n=p);for(let e=t===i?1:0;e<g.length;e++){const t=n.getCoord2D(g[e]);if(!o.isCloserThanDistance(t,r.Envelope1D.unit(),l))return 0}if(d>1)for(let e=1;e<d;){const t=o.getCoord2D(m[e]);n.isCloserThanDistance(t,r.Envelope1D.unit(),l)?(m[d-1]=r.swap(m[e],m[e]=m[d-1]),d--):e++}if(u){const e=n.getCoord2D(.25);_+=e.sub(c).crossProduct(y.sub(c)),y.assign(e),e.assign(n.getCoord2D(.75)),_+=e.sub(c).crossProduct(y.sub(c)),y.assign(e)}if(f=t,f===i)return d>1?0:u?_<0?-u:u:1}}removeSpanBetween(e,t,i){e.setSegmentToIndex(e.getVertexIndex(t),null);const n=e.getNextVertex(t);n!==i&&e.removeVertices(n,i)}static st_stitchCurvesImpl(e,t,s,r,o){if(!t.hasSegmentParentage())return;si(t);let a=s===n.nullHandle?t.getFirstGeometry():s;for(;a!==n.nullHandle;)if(i.isLinear(t.getGeometryType(a))){for(let s=t.getFirstPath(a);s!==n.nullHandle;s=t.getNextPath(s)){let a=t.getPathSize(s);const l=t.isClosedPath(s);l&&(a+=1);let c=t.getFirstVertex(s);const h=t.getSegmentParentage(c);if(l){if(-1!==h&&!t.getSegmentParentageBreakVertex(c)){let e=t.getPrevVertex(c);const n=c;for(let s=0;;s++){const r=t.getSegmentParentage(e);if(h!==r){i.geometryReleaseAssert(-1===r);break}if(c=e,t.getSegmentParentageBreakVertex(e))break;if(e===n){c=n,t.setSegmentParentageBreakVertex(c,!0);break}e=t.getPrevVertex(e),i.geometryReleaseAssert(s<a)}}}else i.geometryReleaseAssert(-1===h||t.getSegmentParentageBreakVertex(c));let u=c;for(let s=0;s<a&&u!==n.nullHandle;){const l=t.getSegmentParentage(u);if(-1===l){if(s++,u=t.getNextVertex(u),u===c)break;continue}let h=0,m=n.nullHandle;const d=u;h=1;let p=t.getNextVertex(d);for(;s<a&&p!==n.nullHandle;){s++,m=p,h++;const e=t.getSegmentParentage(p);if(-1===e||t.getSegmentParentageBreakVertex(p))break;i.geometryReleaseAssert(e===l),p=t.getNextVertex(p)}if(m===n.nullHandle){i.geometryReleaseAssert(0);break}if(!o){const i=e.m_originalPlanarSegments[l];e.processSpan_(t,d,m,h,i,l,r)}if(u=m,u===c)break}}if(s!==n.nullHandle)break;a=t.getNextGeometry(a)}else a=s===n.nullHandle?t.getNextGeometry(a):n.nullHandle}static st_stitchCurvesFromLinesImpl(e,t,s,r,o){let a=s===n.nullHandle?t.getFirstGeometry():s;for(;a!==n.nullHandle;){for(let s=t.getFirstPath(a);s!==n.nullHandle;s=t.getNextPath(s)){let a=t.getPathSize(s);t.isClosedPath(s)&&(a+=1);let l=!0,c=!1;const h=t.getFirstVertex(s);let u=h;for(let s=0;s<a&&u!==n.nullHandle;){let m=t.getSegmentParentage(u);if(-1===m||l){l=!1,s++,u=t.getNextVertex(u),c=!0;continue}let d,p,g=0;if(c?(d=t.getPrevVertex(u),p=u,i.geometryReleaseAssert(d!==n.nullHandle),i.geometryReleaseAssert(p!==d),i.geometryReleaseAssert(-1===t.getSegmentParentage(d)||h===d)):(d=u,p=t.getNextVertex(d),s++,i.geometryReleaseAssert(p!==n.nullHandle),i.geometryReleaseAssert(p!==d),m=t.getSegmentParentage(p)),g=2,c=!1,-1===m||t.getSegmentParentageBreakVertex(p)){u=p;continue}let _=t.getNextVertex(p);for(s++;s<a&&_!==n.nullHandle;){p=_,g++;const e=t.getSegmentParentage(_);if(-1===e||t.getSegmentParentageBreakVertex(_))break;i.geometryReleaseAssert(e===m),s++,_=t.getNextVertex(_)}if(!o){const i=e.m_originalPlanarSegments[m];e.processSpan_(t,d,p,g,i,m,r)}u=p}}if(s!==n.nullHandle)break;a=t.getNextGeometry(a)}}static st_stitchCurvesFromCurvesImpl(e,t,s,r,o){let a=s===n.nullHandle?t.getFirstGeometry():s;for(;a!==n.nullHandle;)if(i.isLinear(t.getGeometryType(a))){for(let s=t.getFirstPath(a);s!==n.nullHandle;s=t.getNextPath(s)){let a=t.getPathSize(s);const l=t.isClosedPath(s);l&&(a+=1);let c=t.getFirstVertex(s);if(l){if(-1!==t.getSegmentParentage(c)){let e=c;for(let i=0;!t.getSegmentParentageBreakVertex(e);i++){if(i===a){c=t.getFirstVertex(s),t.setSegmentParentageBreakVertex(e,!0);break}e=t.getPrevVertex(e)}}}else i.geometryReleaseAssert(-1===t.getSegmentParentage(c)||t.getSegmentParentageBreakVertex(c));let h=c;for(let s=0;s<a&&h!==n.nullHandle;){const l=t.getSegmentParentage(h);if(-1===l){s++,h=t.getNextVertex(h);continue}let c=0,u=n.nullHandle;const m=h;c=1;let d=t.getNextVertex(m);for(;s<a&&d!==n.nullHandle;){s++,u=d,c++;const e=t.getSegmentParentage(d);if(-1===e||t.getSegmentParentageBreakVertex(d))break;i.geometryReleaseAssert(e===l),d=t.getNextVertex(d)}if(u===n.nullHandle)break;if(!o){const i=e.m_originalPlanarSegments[l];e.processSpan_(t,m,u,c,i,l,r)}h=u}}if(s!==n.nullHandle)break;a=t.getNextGeometry(a)}else a=s===n.nullHandle?t.getNextGeometry(a):n.nullHandle}static regularizeCurve(e,t,i,s){let o=t.snapControlPoints(s*s);if(o){const n=e.getVertexIndex(i),s=t.clone();e.setSegmentToIndex(n,s)}if(t.getGeometryType()===n.CubicBezier.type){const n=[],a=t.calculateSpecialPointsForCracking(s,n);if(a>0){const l=[];if(a>1)for(let e=0;e<a;e++)if(l.push(t.getCoord2D(n[e])),e>0){const t=(Math.abs(l[e].x)+Math.abs(l[e].y))*r.geomEpsFactor(),i=r.Point2D.distance(l[e-1],l[e]);if(i<t&&i>0){const t=new r.Point2D;r.lerpPoint2D(l[e-1],l[e],.5,t),l[e-1]=t,l[e]=t}}e.splitSegment(i,n,a),o=e.snapControlPoints(i,a+1,s*s)||o;for(let t=0;t<a;t++)i=e.getNextVertex(i),e.setSegmentParentageBreakVertex(i,!0);return a}}return o?0:-1}}function hi(e,t,i,n,s){return new pi(e,i,t,n,s).do_()}function ui(e,t,i=1,n=1,r=1,o=1){if(n>o)return e;if(o>n)return t;const a=new s.Point;return function(e,t,i,n,s,r,o,a,l){const c=e.equals(t);if(n>r)return o.assignCopy(e),l[0]=n,a[0]=i,c;if(r>n)return o=t,l[0]=r,a[0]=s,c;o.assignCopy(e);const h=ee(e.getXY(),t.getXY(),i,n,s,r);o.setXY(h.pt),a[0]=h.weight,l[0]=h.rank}(e,t,i,n,r,o,a,[0],[0]),a}function mi(e,t,i){return pi.fixCurveTwoPointLoops(e,t,i)}function di(e){return s.adjustToleranceForTEClustering(e)}class pi{constructor(e,t,i,n,s){this.m_shape=e,this.m_progressTracker=t,this.m_tolerance=i,this.m_bFilterDegenerateSegments=n,this.m_bTrackChanges=s,this.m_progressCounter=0}do_(){const e=new s.CombinedTolerance(this.m_tolerance.tolerance,this.m_tolerance.resolution),t=di(e);let o=s.adjustToleranceForTECracking(e);const a=1.00001*o;o*=1.000001;let l=!1;const c=this.m_shape.getTotalPointCount()+10>30?1e3:(this.m_shape.getTotalPointCount()+10)*(this.m_shape.getTotalPointCount()+10),h=this.m_shape.hasPointFeatures();for(let e=0;;e++){this.m_shape.dbgCheckSelection(),e>c&&i.throwInternalErrorException("crack_and_cluster_iteration_exceeded"),this.m_shape.dbgVerifyMonotone();let s=-1;0===e&&(s=this.firstCrack_(),l||=s>0);const r=this.cluster_(t);if(this.m_shape.dbgVerifyMonotone(),l||=r,this.m_bFilterDegenerateSegments){const e=0!==this.m_shape.filterClosePoints(t,!0,!1,this.m_bTrackChanges,n.nullHandle);l||=e,this.m_shape.dbgVerifyMonotone()}const u=this.m_shape.snapControlPointsOnSelection(a*a);l||=u,this.m_shape.dbgCheckSelection();let m=!1;if((0===e&&-1===s||h||ve(!0,this.m_shape,o,null,this.m_progressTracker))&&(m=this.crack_(a),l||=m,this.m_shape.dbgVerifyMonotone()),!m&&!pi.fixCurveTwoPointLoops(this.m_shape,t,this.m_progressTracker)){this.m_shape.dbgVerifyMonotone();break}}return l&&function(e){if(!e.hasSegmentParentage())return;si(e);const t=new s.AttributeStreamOfInt32(0),i=e.queryVertexIteratorOnSelection();for(let e=i.next();e!==n.nullHandle;e=i.next())t.add(e);if(0===t.size())return;e.sortVerticesSimpleByY(t,0,t.size()),t.add(n.nullHandle);const o=r.Point2D.getNAN();e.queryXY(t.read(0),o);let a=0;const l=r.Point2D.getNAN();for(let i=1,s=t.size();i<s;i++){{const s=t.read(i);s!==n.nullHandle?e.queryXY(s,l):l.setNAN()}if(!l.isEqualPoint2D(o)){if(i-a>1){let s=!1;for(let n=a;n<i;++n){const i=t.read(n);if(e.getSegmentParentageBreakVertex(i)){s=!0;break}}if(!s){const o=(t,i,s)=>{const r=e.getPrevVertex(t),o=e.getNextVertex(t);r!==n.nullHandle?i.assign(e.getXY(r)):i.setNAN(),o!==n.nullHandle?s.assign(e.getXY(o)):s.setNAN()},l=new r.Point2D,c=new r.Point2D;o(t.read(a),l,c);for(let e=a+1;e<i;++e){const i=t.read(e);if(i===n.nullHandle)continue;const a=new r.Point2D,h=new r.Point2D;o(i,a,h);const u=(e,t)=>!!(e.equals(t)||e.isNAN()&&t.isNAN());if(!(u(a,l)&&u(h,c)||u(h,l)&&u(a,c))){s=!0;break}}}if(s)for(let n=a;n<i;++n)e.setSegmentParentageBreakVertex(t.read(n),!0)}o.setCoordsPoint2D(l),a=i}}}(this.m_shape),l}cluster_(e){return K(this.m_shape,e,n.nullHandle,this.m_bTrackChanges,this.m_progressTracker)}crack_(e){return function(e,t,i,n){if(!xe(e))return!1;const s=new be(n);s.m_shape=e,s.m_tolerance=t,s.m_bTrackChanges=i;let r=!1;const o=e.hasCurves()?5:15;return r=e.getTotalPointCount()<o?s.crackBruteForce_():s.crackerPlaneSweep_(),r}(this.m_shape,e,this.m_bTrackChanges,this.m_progressTracker)}static fixCurveTwoPointLoops(e,t,o){if(!e.hasCurves())return!1;e.dbgVerifyCurves();const a=e.createUserIndexUninitialized(),l=new s.AttributeStreamOfInt32(0),c=e.queryVertexIteratorOnSelection();for(let t=c.next();t!==n.nullHandle;t=c.next())l.add(t),e.setUserIndex(t,a,-1);if(0===l.size())return!1;l.add(n.nullHandle),e.sortVerticesSimpleByY(l,0,l.size()-1);let h=0;const u=e.getXY(l.read(h)),m=new r.Point2D(Number.NaN,Number.NaN),d=[];for(let t=1,i=l.size();t<i;++t){const i=l.read(t),s=i!==n.nullHandle?e.getXY(i):m;if(s.equals(u))continue;const o=[];for(let i=h;i<t;i++){const t=l.read(i),s=e.getPrevVertex(t);if(s!==n.nullHandle&&-1===e.getUserIndex(s,a)){const t=gi(e.getXY(s),e.getSegment(s));0!==r.Point2D.sqrDistance(u,t.otherPt)&&(t.vert=s,t.dir=-1,o.push(t)),e.setUserIndex(s,a,1)}const c=e.getNextVertex(t);if(c!==n.nullHandle&&-1===e.getUserIndex(t,a)){const i=gi(e.getXY(c),e.getSegment(t));0!==r.Point2D.sqrDistance(u,i.otherPt)&&(i.vert=t,i.dir=1,o.push(i)),e.setUserIndex(t,a,1)}}if(o.length>1){o.sort(((e,t)=>fi(e,t)));const e=gi(m.clone(),null);o.push(e);let t=0;for(let e=1,i=o.length;e<i;e++)if(!o[e].otherPt.equals(o[e-1].otherPt)){if(e-t>1&&null!==o[t].seg){let i=!1;const n=t;for(let s=t+1;s<e;s++)if(!_i(o[n],o[s])){i=!0;break}if(i)for(let i=t;i<e&&null!==o[i].seg;i++)d.push(o[i].vert)}t=e}}h=t,u.setCoordsPoint2D(s)}for(const n of d){const s=e.getSegment(n);i.geometryReleaseAssert(null!==s);const o=e.getXY(n),a=e.getXY(e.getNextVertex(n));if(r.Point2D.distance(o,a)<3*t)e.setSegmentToIndex(e.getVertexIndex(n),null);else{const t=s.lengthToT(.5*s.calculateLength2D());e.splitSegment(n,[t],1)}}return e.removeUserIndex(a),d.length>0}firstCrack_(){const e=this.m_shape.getEnvelope2D(this.m_progressTracker),t=s.calculateToleranceFromGeometryForOp(null,e,!0).total();if(4*t<this.m_tolerance.total()){let e=!1;const i=1.1*t,s=t,r=this.cluster_(i);e||=r;let o=0;this.m_bFilterDegenerateSegments&&(o=this.m_shape.filterClosePoints(0,!0,!1,this.m_bTrackChanges,n.nullHandle));const a=this.crack_(s);return e||=a,e?1:o?2:0}return-1}progress_(e=!1){this.m_progressCounter++,!e&&4095&this.m_progressCounter||(this.m_progressCounter=0)}}function gi(e,t){return{otherPt:e,seg:t,vert:-1,dir:0}}function _i(e,t){if(i.geometryReleaseAssert(e.otherPt.equals(t.otherPt)),null===e.seg)return null===t.seg;if(null===t.seg)return!1;const n=e.seg.getGeometryType();if(n!==t.seg.getGeometryType())return!1;if(n===i.GeometryType.enumBezier){const i=e.seg,n=t.seg;let s=i.getControlPoint1(),o=i.getControlPoint2();-1===e.dir&&(o=r.swap(s,s=o));let a=n.getControlPoint1(),l=n.getControlPoint2();return-1===t.dir&&(l=r.swap(a,a=l)),s.equals(a)&&o.equals(l)}if(n===i.GeometryType.enumRationalBezier2){const i=e.seg,n=t.seg,s=i.getControlPoint1(),o=n.getControlPoint1();if(!s.equals(o))return!1;const a=[0,0,0];i.queryWeights(a),-1===e.dir&&(a[2]=r.swap(a[0],a[0]=a[2]));const l=[0,0,0];return n.queryWeights(l),-1===t.dir&&(l[2]=r.swap(l[0],l[0]=l[2])),a[0]===l[0]&&a[1]===l[1]&&a[2]===l[2]}i.throwInternalErrorException("")}function fi(e,t){const i=e.otherPt.compare(t.otherPt);return 0!==i?i:function(e,t){if(null===e.seg||null===t.seg)return null!==e.seg?-1:null!==t.seg?1:0;const i=e.seg.getGeometryType(),n=t.seg.getGeometryType();return i<n?-1:i>n?1:0}(e,t)}var yi=i.isMultiPath,xi=i.isSegment,vi=i.getDimensionFromType;function Pi(e,t,n,r,o,a,l){const c=new Ti(o);c.m_bOGCOutput=!0;const h=e.getGeometryType()===i.GeometryType.enumPolygon&&1===e.getFillRule()&&!s.isAtLeastWeakSimple(r);return c.planarSimplifyImpl_(e,t,h,n,r,o,a,l)}function bi(e,t,i,n,s,r,o,a){return new Ti(r).planarSimplifyImpl_(e,t,i,n,s,r,o,a)}function Ei(e,t,n){return function(e,t,n){const s=e.createInstance(),o=r.makeObjectArray(r.Point2D,100),a=new Array(100),l=e.getPointCount();let c=!0;const h=2===t.getDimension();1!==t.getDimension()&&2!==t.getDimension()&&i.throwInternalErrorException("");for(let i=0;i<l;){const r=e.queryCoordinates(o,o.length,i,-1)-i;h?$t(t,o,r,n.total(),a):Kt(t,o,r,n.total(),a);let l=0;for(let t=0;t<r;t++)0===a[t]&&(c&&(c=!1,s.addPoints(e,0,i)),l!==t&&s.addPoints(e,i+l,i+t),l=t+1);c||l===r||s.addPoints(e,i+l,i+r),i+=r}return c?e:s}(e,t,n)}function Si(e,t,n){return function(e,t,n){if(e.isEmpty())return e.createInstance();if(t.isEmpty())return e.createInstance();const s=[new r.Point2D],o=[0],a=2===t.getDimension();return 1!==t.getDimension()&&2!==t.getDimension()&&i.throwInternalErrorException(""),s[0]=e.getXY(),a?$t(t,s,1,n.total(),o):Kt(t,s,1,n.total(),o),0!==o[0]?e:e.createInstance()}(e,t,n)}function Ci(e,t,r,o,a,l=!1){0===t&&i.throwInvalidArgumentException("not enough geometries to dissolve");let c=0;for(let i=0,n=t;i<n;i++)c=Math.max(e[i].getDimension(),c);if(2===c||1===c)return new Ti(o).dissolveMultiPaths_(c,!1,e,t,r,a,l);let h=0,u=-1;for(let i=0,n=t;i<n;i++)e[i].getDimension()===c&&(-1===u&&(u=i),e[i].isEmpty()||(u=i,h++));if(h<2)return Ii(e[u]);const m=s.Envelope3D.constructEmpty(),d=new n.EditShape;let p=n.nullHandle;for(let i=0,r=t;i<r;i++)if(e[i].getDimension()===c&&!e[i].isEmpty()){p===n.nullHandle?p=d.addGeometry(Ii(e[i])):d.appendGeometry(p,Ii(e[i]));const t=s.Envelope3D.constructEmpty();e[i].queryLooseEnvelope(t),m.mergeEnv3D(t)}const g=s.calculateToleranceFromGeometryForOp(r,m.getEnvelope2D(),!0),_=new Ti(o);if(l){const e=s.calculateZToleranceFromGeometryForOpEnv1D(r,m.getEnvelopeZs(),!0);return _.planarSimplify3DImpl_(d,g,e,0,!0)}return _.m_bOGCOutput=!0,_.planarSimplifyMultiPoints(d,g,!1,-1)}function wi(e,t,r,o,a,l=!1){t<2&&i.throwInvalidArgumentException("not enough geometries to dissolve");let c=0;for(let i=0,n=t;i<n;i++)c=Math.max(e[i].getDimension(),c);if(2===c||1===c)return new Ti(o).dissolveMultiPaths_(c,!0,e,t,r,a,l);const h=s.Envelope3D.constructEmpty(),u=new n.EditShape;let m=n.nullHandle,d=0,p=-1;for(let i=0,r=t;i<r;i++)if(e[i].getDimension()===c&&(-1===p&&(p=i),!e[i].isEmpty())){p=i,m===n.nullHandle?m=u.addGeometry(Ii(e[i])):u.appendGeometry(m,Ii(e[i]));const t=s.Envelope3D.constructEmpty();e[i].queryLooseEnvelope(t),h.mergeEnv3D(t),d++}if(d<2)return Ii(e[p]);const g=0===c?r:null,_=s.calculateToleranceFromGeometryForOp(g,h.getEnvelope2D(),!0),f=new Ti(o);if(l){const e=s.calculateZToleranceFromGeometryForOpEnv1D(g,h.getEnvelopeZs(),!0);return f.m_bOGCOutput=!0,f.planarSimplify3DImpl_(u,_,e,0,!0)}return f.planarSimplifyMultiPoints(u,_,!0,-1)}class Ti{constructor(e){this.m_topoGraph=null,this.m_maskLookup=[],this.m_dummyPt1=r.Point2D.getNAN(),this.m_dummyPt2=r.Point2D.getNAN(),this.m_fromEdgeForPolylines=n.nullHandle,this.m_progressCounter=0,this.m_bOGCOutput=!1,this.m_progressTracker=e}linesToPolygonsImpl(e,t){let i=0,s=0,r=null;if(e.hasCurves()){r=new li;const n=e.getEnvelope2D(this.m_progressTracker);s=oi(t.total());const o=ri(t.total(),n);i=ai(o,s),ii(e,o,t.total(),0,r,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(e,t.add(i));const o=this.m_topoGraph.createUserIndexForChains(),a=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(a,o,1);for(let e=this.m_topoGraph.getChainFirstIsland(a);e!==n.nullHandle;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,o,1);const l=[];for(let t=this.m_topoGraph.getFirstChain();t!==n.nullHandle;t=this.m_topoGraph.getChainNext(t)){if(1===this.m_topoGraph.getChainUserIndex(t,o))continue;this.m_topoGraph.setChainUserIndex(t,o,1);for(let e=this.m_topoGraph.getChainFirstIsland(t);e!==n.nullHandle;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,o,1);if(0===this.m_topoGraph.getChainArea(t))continue;const i=this.m_topoGraph.extractPolygonFromChainAndIslands(e,n.nullHandle,t,n.nullHandle);null!=r&&r.stitchCurves(e,i,s,!1);const a=e.getGeometry(i);l.push(a)}return new h.SimpleGeometryCursor(l)}autoCompleteImpl(e,t,i){let s=0,r=0,o=null;if(e.hasCurves()){o=new li;const t=e.getEnvelope2D(this.m_progressTracker);r=oi(i.total());const n=ri(i.total(),t);s=ai(n,r),ii(e,n,i.total(),0,o,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(e,i.add(s));const a=this.m_topoGraph.getGeometryID(t),l=this.m_topoGraph.createUserIndexForChains(),c=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(c,l,1);for(let e=this.m_topoGraph.getChainFirstIsland(c);e!==n.nullHandle;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,l,1);const u=[];for(let t=this.m_topoGraph.getFirstChain();t!==n.nullHandle;t=this.m_topoGraph.getChainNext(t)){if(1===this.m_topoGraph.getChainUserIndex(t,l))continue;this.m_topoGraph.setChainUserIndex(t,l,1);for(let e=this.m_topoGraph.getChainFirstIsland(t);e!==n.nullHandle;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,l,1);if(0!==this.m_topoGraph.getChainParentage(t))continue;const i=this.m_topoGraph.getChainHalfEdge(t);let s=i,c=!1;do{const e=this.m_topoGraph.getHalfEdgeTwin(s);if(this.m_topoGraph.getHalfEdgeChain(e)!==t&&0!==(this.m_topoGraph.getHalfEdgeParentage(s)&a)){c=!0;break}s=this.m_topoGraph.getHalfEdgeNext(s)}while(s!==i);if(!c)continue;if(0===this.m_topoGraph.getChainArea(t))continue;const h=this.m_topoGraph.extractPolygonFromChainAndIslands(e,n.nullHandle,t,n.nullHandle);null!==o&&o.stitchCurves(e,h,r,!1);const m=e.getGeometry(h);u.push(m)}return new h.SimpleGeometryCursor(u)}setEditShape(e,t=!1){null===this.m_topoGraph&&(this.m_topoGraph=new X),this.m_topoGraph.setEditShape(e,this.m_progressTracker,!0,t)}setEditShapeCrackAndCluster(e,t){hi(e,t,this.m_progressTracker,!0,!1);for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t))e.getGeometryType(t)===i.GeometryType.enumPolygon&&Ae(e,t,-1,this.m_bOGCOutput,n.nullHandle,this.m_progressTracker);this.setEditShape(e)}setHalfEdgeOrientations_(e,t){const i=this.m_topoGraph.getShape();for(let s=i.getFirstGeometry();s!==n.nullHandle;s=i.getNextGeometry(s))if(s===t)for(let t=i.getFirstPath(s);t!==n.nullHandle;t=i.getNextPath(t)){let s=i.getFirstVertex(t);if(s===n.nullHandle)continue;let r=i.getNextVertex(s);for(;r!==n.nullHandle;){const t=this.m_topoGraph.getClusterFromVertex(s),o=this.m_topoGraph.getClusterFromVertex(r),a=this.m_topoGraph.getHalfEdgeConnector(t,o);if(a!==n.nullHandle){const t=this.m_topoGraph.getHalfEdgeTwin(a);this.m_topoGraph.setHalfEdgeUserIndex(a,e,1),this.m_topoGraph.setHalfEdgeUserIndex(t,e,2)}s=r,r=i.getNextVertex(s)}}}flushVertices_(e,t){const i=this.m_topoGraph.getShape(),s=i.hasSegmentParentage(),r=new n.SegmentBuffer,o=i.insertPath(e,n.nullHandle);t.push(t[0]);const a=t.length;let l=n.nullHandle;for(let e=0;e<a;e++){const n=t[e];if(l=i.addVertex(o,n),!s)continue;const c=this.m_topoGraph.getClusterFromVertex(n);if(e>0&&this.m_topoGraph.isBreakNode(c)&&i.setSegmentParentageBreakVertex(l,!0),e<a-1){const n=this.m_topoGraph.getHalfEdgeConnector(c,this.m_topoGraph.getClusterFromVertex(t[e+1])),s=this.m_topoGraph.getSegmentParentage(n);i.setSegmentParentageAndBreak(l,s,e>0||this.m_topoGraph.isBreakNode(c)),this.m_topoGraph.isHalfEdgeCurve(n)&&(this.m_topoGraph.querySegmentXY(n,r),i.setSegmentToIndex(i.getVertexIndex(l),r.get().clone()))}}if(s){const e=this.m_topoGraph.getClusterFromVertex(t[a-1]);this.m_topoGraph.isBreakNode(e)&&i.setSegmentParentageBreakVertex(l,!0)}i.setClosedPath(o,!0)}processPolygonCuts_(e,t,s,r){const o=this.m_topoGraph.getGeometryID(s),a=this.m_topoGraph.getGeometryID(r),l=[],c=this.m_topoGraph.getShape(),h=this.m_topoGraph.createUserIndexForHalfEdges();for(let s=this.m_topoGraph.getFirstCluster();s!==n.nullHandle;s=this.m_topoGraph.getNextCluster(s)){const r=this.m_topoGraph.getClusterHalfEdge(s);if(r===n.nullHandle)continue;let u=r;do{if(1!==this.m_topoGraph.getHalfEdgeUserIndex(u,h)){let n=u,s=u,r=!1,m=0;do{if(this.m_topoGraph.setHalfEdgeUserIndex(n,h,1),r||0!==(this.m_topoGraph.getHalfEdgeParentage(n)&a)&&0!==(this.m_topoGraph.getHalfEdgeFaceParentage(n)&o)&&(s=n,r=!0),r){const t=this.m_topoGraph.getHalfEdgeOrigin(n),i=this.m_topoGraph.getClusterVertexIterator(t),s=this.m_topoGraph.getVertexFromVertexIterator(i);l.push(s),-1!==e&&0!==(this.m_topoGraph.getHalfEdgeParentage(n)&a)&&(m|=this.m_topoGraph.getHalfEdgeUserIndex(n,e))}n=this.m_topoGraph.getHalfEdgeNext(n)}while(n!==s);if(r&&this.m_topoGraph.getChainArea(this.m_topoGraph.getHalfEdgeChain(s))>0){const e=c.createGeometry(i.GeometryType.enumPolygon);this.flushVertices_(e,l),-1!==t&&c.setGeometryUserIndex(e,t,m)}l.length=0}u=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(u))}while(u!==r)}this.m_topoGraph.deleteUserIndexForHalfEdges(h)}cutPolygonPolyline_(e,t,i,s){this.m_topoGraph.removeSpikes_();let r=-1;-1!==e&&(r=this.m_topoGraph.createUserIndexForHalfEdges(),this.setHalfEdgeOrientations_(r,i)),this.processPolygonCuts_(r,e,t,i),-1!==r&&(this.m_topoGraph.deleteUserIndexForHalfEdges(r),r=-1);const o=this.m_topoGraph.getShape();for(let e=o.getFirstGeometry();e!==n.nullHandle;e=o.getNextGeometry(e))e!==t&&e!==i&&s.push(e);s.sort(((e,t)=>{const i=o.getFirstPath(e),n=o.getRingArea(i),s=o.getFirstPath(t),r=o.getRingArea(s);return n<r?-1:n>r?1:0}))}cut(e,t,n,s,r){const o=this.m_topoGraph.getShape().getGeometryType(n),a=this.m_topoGraph.getShape().getGeometryType(s),l=i.getDimensionFromType(o),c=i.getDimensionFromType(a);2!==l||1!==c?1!==l||1!==c?i.throwInternalErrorException(""):new Mi(this,e,t,n,s,r).Do():this.cutPolygonPolyline_(t,n,s,r)}progress_(e=!1){}isGoodParentage(e){return e>=0&&e<this.m_maskLookup.length&&this.m_maskLookup[e]}normalizeInputGeometry(e){const t=e.getGeometryType();if(t===i.GeometryType.enumEnvelope){const t=new n.Polygon({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(t===i.GeometryType.enumPoint){const t=new n.MultiPoint({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if(i.isSegment(t)){const t=new n.Polyline({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}return t!==i.GeometryType.enumMultiPoint&&t!==i.GeometryType.enumPolyline&&t!==i.GeometryType.enumPolygon&&i.throwInvalidArgumentException("Unexpected geometry type"),e}dissolveNonSimplePolygons(e,t,s,r){i.geometryReleaseAssert(t>0);const o=new n.EditShape;let a=0,l=-1;for(let i=0,n=t;i<n;i++)2===e[i].getDimension()&&(-1===l&&(l=i),e[i].isEmpty()||(a++,o.addGeometry(e[i])));return 0===a?(i.geometryReleaseAssert(l>=0),this.normalizeInputGeometry(e[l])):this.planarSimplifyPolygons(o,s,!0,!1,-1,!0)}dissolveMultiPaths_(e,o,a,l,c,h,u){i.geometryReleaseAssert(e>=1&&e<=2),i.geometryReleaseAssert(l>0);const m=8&h?1:2,d=s.Envelope3D.constructEmpty();let p=0,g=-1,_=!0;for(let t=0,n=l;t<n;t++)if(a[t].getDimension()===e&&(-1===g&&(g=t),!a[t].isEmpty())){g=t,p++;const n=s.Envelope3D.constructEmpty();if(a[t].queryLooseEnvelope(n),d.mergeEnv3D(n),2===e&&_&&a[t].getGeometryType()===i.GeometryType.enumPolygon)if(16&h){const e=[0],i=a[t].getImpl().getIsSimple(0,e),n=this.m_bOGCOutput?5===i:s.isAtLeastPlanarSimple(i);_&&=n}else{const e=s.isAtLeastWeakSimpleGeom(a[t],0);_&&=e}}if(p<2&&(i.geometryReleaseAssert(g>=0),0===p||!(16&h)))return this.normalizeInputGeometry(a[g]);if(!_){const e=s.calculateToleranceFromGeometryForOp(o?null:c,d.getEnvelope2D(),!0);return this.dissolveNonSimplePolygons(a,l,e,h)}const f=a.slice(0,l),y=s.calculateToleranceFromGeometryForOp(c,d.getEnvelope2D(),!0),x=10*s.adjustToleranceForTEClustering(y);let v=new s.CombinedTolerance(0,0);if(u&&(v=s.calculateZToleranceFromGeometryForOpEnv1D(c,d.getEnvelopeZs(),!0)),1===p&&1===e&&2===m&&!o)return u?(i.geometryReleaseAssert(0),{}):this.m_bOGCOutput?Pi(f[g],y,!1,-1,this.m_progressTracker,m,!1):bi(f[g],y,!1,!1,-1,this.m_progressTracker,m,!1);const P=new s.Envelope2DIntersector;P.startConstruction();let b=2===e?3:4,E=0;for(let n=0,r=l;n<r;n++){if(f[n].getDimension()!==e||f[n].isEmpty())continue;let r=f[n].getGeometryType();if(r!==i.GeometryType.enumEnvelope){if(i.isSegment(r)?(f[n]=this.normalizeInputGeometry(f[n]),r=i.GeometryType.enumPolyline):i.geometryReleaseAssert(i.isMultiPath(r)),1===e){i.geometryReleaseAssert(r===i.GeometryType.enumPolyline);let e=-1;if(u)i.geometryReleaseAssert(0,"3d not implemented yet");else{const t=[0];e=f[n].getImpl().getIsSimple(y.total(),t)}if(this.m_bOGCOutput?5!==e:!s.isAtLeastPlanarSimple(e))if(o)b=-1;else{u?i.geometryReleaseAssert(0,"3d not implemented yet"):this.m_bOGCOutput?f[n]=Pi(f[n],y,!1,-1,this.m_progressTracker,m,!1):f[n]=bi(f[n],y,!1,!1,-1,this.m_progressTracker,m,!1);const e=[0];i.geometryReleaseAssert(s.isAtLeastPlanarSimple(f[n].getImpl().getIsSimple(y.total(),e)))}}else{i.geometryReleaseAssert(r===i.GeometryType.enumPolygon);const e=[0],t=f[n].getImpl().getIsSimple(0,e);i.geometryReleaseAssert(s.isAtLeastWeakSimple(t))}const a=f[n].getImpl();for(let e=0,i=a.getPathCount();e<i;e++){const i=t.Envelope2D.constructEmpty();a.queryLoosePathEnvelope(e,i),i.inflateCoords(x,x),P.addEnvelope(E,i),E++}}else{i.geometryReleaseAssert(r===i.GeometryType.enumEnvelope);const e=t.Envelope2D.constructEmpty();f[n].queryLooseEnvelope(e),e.inflateCoords(x,x),P.addEnvelope(E,e),E++,b=-1}}P.endConstruction();const S=E,C=r.makePrimitiveArray(S,-2147483647),w=r.makePrimitiveArray(S,-1);let T=0;g=-1,E=0;for(let t=0,n=l;t<n;t++){if(f[t].getDimension()!==e)continue;if(-1===g&&(g=t),f[t].isEmpty())continue;g=t,T++;const n=f[t].getGeometryType();if(i.isMultiPath(n))for(let e=0,i=f[t].getPathCount();e<i;e++)w[E]=t,C[E]=-e-1,E++;else i.geometryReleaseAssert(n===i.GeometryType.enumEnvelope),w[E]=t,C[E]=-1,E++}if(T<2&&2===e)return i.geometryReleaseAssert(g>=0),this.normalizeInputGeometry(f[g]);let D=S;for(;P.next()&&D>0;){this.progress_();const e=P.getHandleA(),t=P.getHandleB(),i=P.getElement(e),n=P.getElement(t);w[i]!==w[n]&&(C[i]<0&&(D--,C[i]=-(C[i]+1)),C[n]<0&&(D--,C[n]=-(C[n]+1)))}const I=new n.EditShape;let A,M=!1,N=0;for(let t=0,s=l;t<s;t++){if(f[t].getDimension()!==e||f[t].isEmpty())continue;const s=f[t].getGeometryType(),r=N;let o=0,a=0;const l=i.isMultiPath(s)?f[t]:null;for(let e=r,n=C.length;e<n&&w[e]===t;e++)C[e]>=0&&(o++,a+=l?l.getPathSize(C[e]):i.vertexCount(f[t])),N++;if(a>.95*i.vertexCount(f[t])){I.addGeometry(this.normalizeInputGeometry(f[t]));for(let e=r;e<N;e++)C[e]<0&&(C[e]=-(C[e]+1))}else{if(0===o){M=!0;continue}{M=!0,i.geometryReleaseAssert(i.isMultiPath(s)),i.geometryReleaseAssert(null!=l);const e=new n.Polygon({vd:f[t].getDescription()}),o=new n.Polyline({vd:f[t].getDescription()}),a=s===i.GeometryType.enumPolygon?e:o;for(let e=r;e<N;e++)C[e]>=0&&a.addPath(l,C[e],!0);I.addGeometry(a)}}}if(I.getFirstGeometry()!==n.nullHandle){const t=2===e,i=o?s.calculateToleranceFromGeometryForOp(null,d.getEnvelope2D(),!0):y;let r=new s.CombinedTolerance(0,0);if(u&&(r=o?s.calculateZToleranceFromGeometryForOpEnv1D(null,d.getEnvelopeZs(),!0):v),2===e&&!(2&h)){I.collapseAllGeometriesToFirst();let e=0,t=null;if(I.hasCurves()&&!I.hasSegmentParentage()){t=new li;const n=I.getEnvelope2D(this.m_progressTracker);e=oi(i.total()),ii(I,ri(i.total(),n),i.total(),0,t,null,this.m_progressTracker)}!function(e,t,i,n){i>0&&K(e,i,t,!1,n),new ye(n).executeImpl_(e,t)}(I,I.getFirstGeometry(),i.total(),this.m_progressTracker),null!==t&&t.stitchCurves(I,n.nullHandle,e,!0)}if(u)A=this.planarSimplify3DImpl_(I,i,r,m,!0);else if(2===e)A=this.planarSimplifyPolygons(I,i,t,o,-1,!1);else{const e={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};e.ogcRule=this.m_bOGCOutput,e.allCrossRoadsImpassable=!0,e.unsplitBehavior=m,A=this.planarSimplifyPolylines(I,i,o,e,-1)}if(!M){const e=[0];b=A.getImpl().getIsSimple(i.total(),e)}}else i.geometryReleaseAssert(M),i.geometryReleaseAssert(g>=0),A=2===e?new n.Polygon({vd:f[g].getDescription()}):new n.Polyline({vd:f[g].getDescription()});if(M){let e=0;for(let t=0,n=C.length;t<n;t++){const n=w[t];if(!(n<0)&&C[t]<0){const s=f[n].getGeometryType(),r=i.isMultiPath(s)?f[n]:null;if(r){const i=-(C[t]+1);e+=r.getPathSize(i)}else e+=4}}A.reserve(A.getPointCount()+e);for(let e=0,t=C.length;e<t;e++){const t=w[e];if(!(t<0)&&C[e]<0){const n=f[t].getGeometryType(),s=i.isMultiPath(n)?f[t]:null;if(s){const t=-(C[e]+1);A.addPath(s,t,!0)}else n===i.GeometryType.enumEnvelope?A.addEnvelope(f[t],!1):(i.geometryReleaseAssert(i.isSegment(n)),A.addSegment(f[t],!0))}}}let R=0;if(2===e?-1!==b&&(b=3,R=o?0:y.total()):(i.geometryReleaseAssert(1===e),o||-1===b||(R=y.total())),u||A.getImpl().setIsSimple(b,R),!o&&M)if(2===e){if(!u)return(new Ui).execute(A,c,!1,this.m_progressTracker);i.geometryReleaseAssert(0,"3d not yet implemented")}else 1===e&&1!==m&&(u?(i.geometryReleaseAssert(0),A={}):A=function(e,t,s,r){const o=new Ti(r),a=new n.EditShape,l=a.addGeometry(t),c=o.planarSimplifyNoCrackingAndCluster(e,a,l,s);return i.geometryReleaseAssert(c,"planar_simplify_no_cracking_and_cluster"),a.getGeometry(l)}(this.m_bOGCOutput,A,m,this.m_progressTracker),A.getImpl().setIsSimple(b,R));return A}dissolveTopoGraphCommonEdges_(){const e=this.m_topoGraph.createUserIndexForHalfEdges(),t=[];for(let i=this.m_topoGraph.getFirstCluster();i!==n.nullHandle;i=this.m_topoGraph.getNextCluster(i)){const s=this.m_topoGraph.getClusterHalfEdge(i);let r=s;if(s!==n.nullHandle)do{if(this.progress_(),1!==this.m_topoGraph.getHalfEdgeUserIndex(r,e)){const i=this.m_topoGraph.getHalfEdgeTwin(r);this.m_topoGraph.setHalfEdgeUserIndex(i,e,1),this.m_topoGraph.setHalfEdgeUserIndex(r,e,1);const n=this.m_topoGraph.getHalfEdgeFaceParentage(r);if(this.isGoodParentage(n)){const e=this.m_topoGraph.getHalfEdgeFaceParentage(i);this.isGoodParentage(e)&&t.push(r)}}r=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(r))}while(r!==s)}this.m_topoGraph.deleteUserIndexForHalfEdges(e),this.m_topoGraph.deleteEdgesBreakFaces_(t)}chooseVertexByOrder(e,t,s,o){let a=r.indexTypeMax(),l=n.nullHandle;for(let i=this.m_topoGraph.getClusterVertexIterator(e);i!==n.nullHandle;i=this.m_topoGraph.incrementVertexIterator(i)){const e=this.m_topoGraph.getVertexFromVertexIterator(i),n=t.getUserIndex(e,s);n>=0&&n<a&&(a=n,l=e)}i.geometryReleaseAssert(l!==n.nullHandle);let c=t.getUserIndex(l,o);return c>0&&(t.setUserIndex(l,o,--c),0===c&&t.setUserIndex(l,s,-1)),l}chooseVertexFromCluster_(e,t){return this.m_topoGraph.getVertexDominantFromCluster(e,t)}chooseVertexFromVertexCluster_(e,t){return this.m_topoGraph.getVertexDominant(e,t)}collectPolygonPathsPreservingFrom_(e,t,s,r,o){const a=this.m_topoGraph.getShape();if(a.getGeometryType(e)!==i.GeometryType.enumPolygon)return;const l=a.hasSegmentParentage(),c=new n.SegmentBuffer;for(let i=a.getFirstPath(e);i!==n.nullHandle;i=a.getNextPath(i)){const e=a.getFirstVertex(i);this.m_topoGraph.getClusterFromVertex(e);const h=this.m_topoGraph.getHalfEdgeFromVertex(e);if(h===n.nullHandle)continue;const u=this.m_topoGraph.getHalfEdgeUserIndex(h,s);if(1===u||2===u)continue;const m=this.m_topoGraph.getHalfEdgeFaceParentage(h);if(!this.isGoodParentage(m)){this.m_topoGraph.setHalfEdgeUserIndex(h,s,2);continue}this.m_topoGraph.setHalfEdgeUserIndex(h,s,1);const d=a.insertPath(t,n.nullHandle);a.setClosedPath(d,!0);let p=h,g=e,_=this.m_topoGraph.getClusterFromVertex(g),f=1;do{this.progress_();const e=this.chooseVertexFromVertexCluster_(g,o),t=a.addVertex(d,e);if(this.m_topoGraph.isHalfEdgeCurve(p)&&(this.m_topoGraph.querySegmentXY(p,c),a.setSegmentToIndex(a.getVertexIndex(t),c.get().clone())),l){const e=this.m_topoGraph.getSegmentParentage(p);a.setSegmentParentageAndBreak(t,e,this.m_topoGraph.isBreakNode(_))}let i,h;-1!==r&&this.m_topoGraph.setClusterUserIndex(_,r,1),this.m_topoGraph.setHalfEdgeUserIndex(p,s,1),p=this.m_topoGraph.getHalfEdgeNext(p);do{i=1===f?a.getNextVertex(g):a.getPrevVertex(g),h=i!==n.nullHandle?this.m_topoGraph.getClusterFromVertex(i):n.nullHandle}while(h===_);const u=this.m_topoGraph.getHalfEdgeOrigin(p);if(u!==h){do{i=1===f?a.getPrevVertex(g):a.getNextVertex(g),h=i!==n.nullHandle?this.m_topoGraph.getClusterFromVertex(i):n.nullHandle}while(h===_);if(u!==h){h=u;const e=this.m_topoGraph.getClusterVertexIterator(h);i=this.m_topoGraph.getVertexFromVertexIterator(e)}else f=-f}_=h,g=i}while(p!==h)}}topoOperationPolygonPolygonHelper_(e,t,i,s,r,o){this.progress_(!0),e!==n.nullHandle&&this.collectPolygonPathsPreservingFrom_(e,i,r,o,s),t!==n.nullHandle&&this.collectPolygonPathsPreservingFrom_(t,i,r,o,s);const a=new n.SegmentBuffer,l=this.m_topoGraph.getShape();l.dbgVerifyCurves();const c=l.hasSegmentParentage();for(let e=this.m_topoGraph.getFirstCluster();e!==n.nullHandle;e=this.m_topoGraph.getNextCluster(e)){const t=this.m_topoGraph.getClusterHalfEdge(e);if(t===n.nullHandle)continue;let h=t;do{this.progress_();const e=this.m_topoGraph.getHalfEdgeUserIndex(h,r);if(1!==e&&2!==e){const e=this.m_topoGraph.getHalfEdgeFaceParentage(h);if(this.isGoodParentage(e)){const e=l.insertPath(i,n.nullHandle);l.setClosedPath(e,!0);let t=h;do{const i=this.m_topoGraph.getHalfEdgeVertexIterator(t);let h=n.nullHandle;if(i!==n.nullHandle)h=this.m_topoGraph.getVertexFromVertexIterator(i);else{const e=this.m_topoGraph.getHalfEdgeVertexIterator(this.m_topoGraph.getHalfEdgeTwin(t));h=this.m_topoGraph.getVertexFromVertexIterator(e),h=l.getNextVertex(h)}const u=this.chooseVertexFromVertexCluster_(h,s),m=l.addVertex(e,u);if(c){const e=this.m_topoGraph.getSegmentParentage(t),i=this.m_topoGraph.getHalfEdgeOrigin(t);l.setSegmentParentageAndBreak(m,e,this.m_topoGraph.isBreakNode(i))}if(this.m_topoGraph.isHalfEdgeCurve(t)&&(this.m_topoGraph.querySegmentXY(t,a),l.setSegmentToIndex(l.getVertexIndex(m),a.get().clone())),this.m_topoGraph.setHalfEdgeUserIndex(t,r,1),-1!==o){const e=this.m_topoGraph.getClusterFromVertex(u);this.m_topoGraph.setClusterUserIndex(e,o,1)}t=this.m_topoGraph.getHalfEdgeNext(t)}while(t!==h)}else this.m_topoGraph.setHalfEdgeUserIndex(h,r,2)}h=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(h))}while(h!==t)}}topoOperationPolygonPolygon_(e,t,s,r=!1){this.dissolveTopoGraphCommonEdges_();const o=this.m_topoGraph.getShape(),a=o.createGeometry(i.GeometryType.enumPolygon),l=this.m_topoGraph.createUserIndexForHalfEdges();return this.topoOperationPolygonPolygonHelper_(e,t,a,s,l,-1),this.m_topoGraph.deleteUserIndexForHalfEdges(l),r||Ae(o,a,3,this.m_bOGCOutput,n.nullHandle,this.m_progressTracker),a}topoOperationPolyline_(e,t){const i={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};return i.ogcRule=t,i.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(n.nullHandle,e,!1,i).first}topoOperationMultiPoint_(){const e=this.m_topoGraph.getShape(),t=e.createGeometry(i.GeometryType.enumMultiPoint),s=e.insertPath(t,n.nullHandle);for(let t=this.m_topoGraph.getFirstCluster();t!==n.nullHandle;t=this.m_topoGraph.getNextCluster(t)){const i=this.m_topoGraph.getClusterParentage(t);if(this.isGoodParentage(i)){let i=n.nullHandle;for(let s=this.m_topoGraph.getClusterVertexIterator(t);s!==n.nullHandle;s=this.m_topoGraph.incrementVertexIterator(s)){const t=this.m_topoGraph.getVertexFromVertexIterator(s);i===n.nullHandle&&(i=t);const r=e.getGeometryFromPath(e.getPathFromVertex(t)),o=this.m_topoGraph.getGeometryID(r);if(this.isGoodParentage(o)){i=t;break}}e.addVertex(s,i)}}return t}intersection(e,t){const s=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),o=i.getDimensionFromType(s),a=i.getDimensionFromType(r),l=this.m_topoGraph.getGeometryID(e),c=this.m_topoGraph.getGeometryID(t);i.geometryReleaseAssert(l>=0),i.geometryReleaseAssert(c>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(l|c),this.m_maskLookup[l|c]=!0;let h=n.nullHandle;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(h=e),2===o&&2===a?this.topoOperationPolygonPolygon_(e,t,h):1===o&&a>0||1===a&&o>0?this.topoOperationPolyline_(h,this.m_bOGCOutput):0===o||0===a?this.topoOperationMultiPoint_():void i.throwInternalErrorException("")}topoOperationPolygonPolygonEx(e,t,s){const r=this.m_topoGraph.getShape(),o=r.createGeometry(i.GeometryType.enumPolygon),a=r.createGeometry(i.GeometryType.enumPolyline),l=r.createGeometry(i.GeometryType.enumMultiPoint);this.dissolveTopoGraphCommonEdges_();let c=n.nullHandle;const h=this.m_topoGraph.createUserIndexForHalfEdges(),u=this.m_topoGraph.createUserIndexForClusters();r.dbgVerifyCurves(),this.topoOperationPolygonPolygonHelper_(e,t,o,s,h,u),r.dbgVerifyCurves();const m=r.hasSegmentParentage(),d=new n.SegmentBuffer;for(let e=this.m_topoGraph.getFirstCluster();e!==n.nullHandle;e=this.m_topoGraph.getNextCluster(e)){const t=this.m_topoGraph.getClusterHalfEdge(e);if(t===n.nullHandle)continue;let i=t;do{let t=this.m_topoGraph.getHalfEdgeUserIndex(i,h),o=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(i),h),l=t|o;if(2===l){let c=this.m_topoGraph.getHalfEdgeParentage(i);if(this.isGoodParentage(c)){const p=r.insertPath(a,n.nullHandle);let g=i;const _=this.chooseVertexFromCluster_(e,s);let f=r.addVertex(p,_);if(m){const e=this.m_topoGraph.getSegmentParentage(i),t=this.m_topoGraph.getHalfEdgeOrigin(i);r.setSegmentParentageAndBreak(f,e,this.m_topoGraph.isBreakNode(t))}this.m_topoGraph.isHalfEdgeCurve(i)&&(this.m_topoGraph.querySegmentXY(i,d),r.setSegmentToIndex(r.getVertexIndex(f),d.get().clone())),this.m_topoGraph.setClusterUserIndex(e,u,1);do{this.progress_();const e=this.m_topoGraph.getHalfEdgeTo(g),n=this.chooseVertexFromCluster_(e,s);if(f=r.addVertex(p,n),m){const e=this.m_topoGraph.getSegmentParentage(i),t=this.m_topoGraph.getHalfEdgeOrigin(i);r.setSegmentParentageAndBreak(f,e,this.m_topoGraph.isBreakNode(t))}if(this.m_topoGraph.setHalfEdgeUserIndex(g,h,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(g),h,1),this.m_topoGraph.setClusterUserIndex(e,u,1),g=this.m_topoGraph.getHalfEdgeNext(g),t=this.m_topoGraph.getHalfEdgeUserIndex(g,h),o=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(g),h),l=t|o,2!==l)break;if(c=this.m_topoGraph.getHalfEdgeParentage(g),!this.isGoodParentage(c)){this.m_topoGraph.setHalfEdgeUserIndex(g,h,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(g),h,1);break}this.m_topoGraph.isHalfEdgeCurve(i)&&g!==i&&(this.m_topoGraph.querySegmentXY(i,d),r.setSegmentToIndex(r.getVertexIndex(f),d.get().clone()))}while(g!==i)}else this.m_topoGraph.setHalfEdgeUserIndex(i,h,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(i),h,1)}i=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(i))}while(i!==t)}for(let e=this.m_topoGraph.getFirstCluster();e!==n.nullHandle;e=this.m_topoGraph.getNextCluster(e)){if(this.progress_(),1===this.m_topoGraph.getClusterUserIndex(e,u))continue;const t=this.m_topoGraph.getClusterParentage(e);if(this.isGoodParentage(t)){c===n.nullHandle&&(c=r.insertPath(l,n.nullHandle));const t=this.m_topoGraph.getClusterVertexIterator(e);let i=n.nullHandle;if(t!==n.nullHandle){i=this.m_topoGraph.getVertexFromVertexIterator(t);const e=this.chooseVertexFromVertexCluster_(i,s);r.addVertex(c,e)}}}this.m_topoGraph.deleteUserIndexForClusters(u),this.m_topoGraph.deleteUserIndexForHalfEdges(h),r.dbgVerifyCurves(),Ae(r,o,3,this.m_bOGCOutput,n.nullHandle,this.m_progressTracker);const p=[n.nullHandle,n.nullHandle,n.nullHandle];return p[0]=l,p[1]=a,p[2]=o,p}topoOperationPolylinePolylineOrPolygonEx(e,t){const i={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};return i.ogcRule=t,i.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(n.nullHandle,e,!0,i)}topoOperationMultiPoint(){const e=this.m_topoGraph.getShape(),t=e.createGeometry(i.GeometryType.enumMultiPoint),s=e.insertPath(t,n.nullHandle);for(let t=this.m_topoGraph.getFirstCluster();t!==n.nullHandle;t=this.m_topoGraph.getNextCluster(t)){const i=this.m_topoGraph.getClusterParentage(t);if(this.isGoodParentage(i)){let i=n.nullHandle;for(let s=this.m_topoGraph.getClusterVertexIterator(t);s!==n.nullHandle;s=this.m_topoGraph.incrementVertexIterator(s)){const t=this.m_topoGraph.getVertexFromVertexIterator(s);i===n.nullHandle&&(i=t);const r=e.getGeometryFromPath(e.getPathFromVertex(t)),o=this.m_topoGraph.getGeometryID(r);if(this.isGoodParentage(o)){i=t;break}}e.addVertex(s,i)}}return t}intersectionEx(e,t){const s=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),o=vi(s),a=vi(r),l=this.m_topoGraph.getGeometryID(e),c=this.m_topoGraph.getGeometryID(t);i.geometryReleaseAssert(l>=0),i.geometryReleaseAssert(c>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(l|c),this.m_maskLookup[l|c]=!0;let h=n.nullHandle;if(this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(h=e),2===o&&2===a)return this.topoOperationPolygonPolygonEx(e,t,h);if(1===o&&a>0||1===a&&o>0){const{first:e,second:t}=this.topoOperationPolylinePolylineOrPolygonEx(h,this.m_bOGCOutput);return[t,e]}if(0===o||0===a){const e=[];return e.push(this.topoOperationMultiPoint()),e}i.throwInternalErrorException("")}getCombinedHalfEdgeParentage(e){return this.m_topoGraph.getHalfEdgeParentage(e)|this.m_topoGraph.getHalfEdgeFaceParentage(e)|this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e))}prevailingDirection(e,t){const i=this.getCombinedHalfEdgeParentage(t),s=this.m_topoGraph.getHalfEdgeOrigin(t),o=this.m_topoGraph.getHalfEdgeTo(t);let a=0,l=0;for(let r=this.m_topoGraph.getClusterVertexIterator(s);r!==n.nullHandle;r=this.m_topoGraph.incrementVertexIterator(r)){const s=this.m_topoGraph.getVertexFromVertexIterator(r),c=e.getPathFromVertex(s),h=e.getGeometryFromPath(c),u=this.m_topoGraph.getGeometryID(h),m=e.getFirstVertex(c),d=0!==(u&i);d&&m===s&&(this.m_fromEdgeForPolylines=t);const p=e.getNextVertex(s);if(p!==n.nullHandle&&this.m_topoGraph.getClusterFromVertex(p)===o){if(a++,d){if(this.m_fromEdgeForPolylines===n.nullHandle&&m===p){const e=this.m_topoGraph.getHalfEdgeNext(t);this.isGoodParentage(this.getCombinedHalfEdgeParentage(e))&&(this.m_fromEdgeForPolylines=e)}l++}}else{const i=e.getPrevVertex(s);if(i!==n.nullHandle&&this.m_topoGraph.getClusterFromVertex(i)===o&&(a--,d)){if(this.m_fromEdgeForPolylines===n.nullHandle&&m===i){const e=this.m_topoGraph.getHalfEdgeNext(t);this.isGoodParentage(this.getCombinedHalfEdgeParentage(e))&&(this.m_fromEdgeForPolylines=e)}l--}}}return this.m_topoGraph.queryXY(s,this.m_dummyPt1),this.m_topoGraph.queryXY(o,this.m_dummyPt2),(0!==l?l:a)*r.Point2D.distance(this.m_dummyPt1,this.m_dummyPt2)}tryMoveThroughCrossroadBackwards(e,t){const i=this.m_topoGraph.getHalfEdgePrev(e),s=this.m_topoGraph.getHalfEdgeTwin(i);if(!t){if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(e)))return n.nullHandle;const t=this.m_topoGraph.getHalfEdgeTwin(e);if(s===this.m_topoGraph.getHalfEdgeNext(t))return i}let r=s,o=n.nullHandle;for(;r!==e;){const e=this.getCombinedHalfEdgeParentage(r);if(this.isGoodParentage(e)){if(o!==n.nullHandle)return n.nullHandle;o=this.m_topoGraph.getHalfEdgeTwin(r)}r=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgePrev(r))}return o}tryMoveThroughCrossroadForward(e,t){const i=this.m_topoGraph.getHalfEdgeNext(e),s=this.m_topoGraph.getHalfEdgeTwin(i);if(!t){const t=this.m_topoGraph.getHalfEdgeTwin(e);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(t)))return n.nullHandle;if(s===this.m_topoGraph.getHalfEdgePrev(t))return i}let r=s,o=n.nullHandle;for(;r!==e;){const e=this.getCombinedHalfEdgeParentage(r);if(this.isGoodParentage(e)){if(o!==n.nullHandle)return n.nullHandle;o=this.m_topoGraph.getHalfEdgeTwin(r)}r=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgeNext(r))}return o}isOnALoop(e,t){let n=e;const s=2*this.m_topoGraph.getShape().getTotalPointCount()+10;for(let i=0;i<s;i++){if(1===this.m_topoGraph.getHalfEdgeUserIndex(n,t))return!1;const i=this.m_topoGraph.getHalfEdgeNext(n);if(i===this.m_topoGraph.getHalfEdgeTwin(n))return!1;if(n=i,n===e)return!0}i.throwInternalErrorException("is_on_a_loop_")}restorePolylineParts(e,t,s,o,a,l,c,h,u,m){i.geometryReleaseAssert(a===n.nullHandle&&l>=0&&c>=0||-1===l&&-1===c),i.geometryReleaseAssert(-1===h&&1!==m.unsplitBehavior||-1!==h&&1===m.unsplitBehavior);const d=m.ogcRule,p=m.allCrossRoadsImpassable,g=1===m.unsplitBehavior,_=0===m.unsplitBehavior,f=this.m_topoGraph.getShape(),y=f.hasSegmentParentage();let x=e,v=this.m_topoGraph.getHalfEdgeTwin(x);const P=new n.SegmentBuffer;this.m_fromEdgeForPolylines=n.nullHandle;let b=this.prevailingDirection(f,x),E=x,S=n.nullHandle,C=!1,w=!1,T=!1;if(!g)for(;;){const t=this.m_topoGraph.getHalfEdgePrev(x);if(t===v){T=!0;break}const i=this.m_topoGraph.getHalfEdgeNext(v);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(i))){C=!0;break}if(this.m_topoGraph.getHalfEdgeTwin(t)!==i){if(p){C=!0;break}if(x=this.tryMoveThroughCrossroadBackwards(x,!0),x===n.nullHandle){C=!0;break}v=this.m_topoGraph.getHalfEdgeTwin(x)}else x=t,v=i;if(1===this.m_topoGraph.getHalfEdgeUserIndex(x,s)){T=!0;break}if(x===e){S=e,w=!0;break}const r=this.getCombinedHalfEdgeParentage(x);if(!this.isGoodParentage(r))break;E=x,b+=this.prevailingDirection(f,x)}if(S===n.nullHandle){for(x=e,v=this.m_topoGraph.getHalfEdgeTwin(x),S=x;;){const e=this.m_topoGraph.getHalfEdgeNext(x),t=this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(e));if(t){C=!0;break}if(e===v){T=!0;break}if(-1!==h){const e=this.m_topoGraph.getHalfEdgeOrigin(v);if(1===this.m_topoGraph.getClusterUserIndex(e,h)){C=!0;break}}const i=this.m_topoGraph.getHalfEdgePrev(v);if(this.m_topoGraph.getHalfEdgeTwin(e)!==i){if(t||p){C=!0;break}if(x=this.tryMoveThroughCrossroadForward(x,!0),x===n.nullHandle){C=!0;break}v=this.m_topoGraph.getHalfEdgeTwin(x)}else x=e,v=i;if(1===this.m_topoGraph.getHalfEdgeUserIndex(x,s)){T=!0;break}const r=this.getCombinedHalfEdgeParentage(x);if(!this.isGoodParentage(r))break;S=x,b+=this.prevailingDirection(f,x)}const t=this.m_topoGraph.getHalfEdgeOrigin(E);w=this.m_topoGraph.getHalfEdgeTo(S)===t}else if(this.m_fromEdgeForPolylines!==n.nullHandle){E=e,S=this.tryMoveThroughCrossroadBackwards(E,!1),i.geometryReleaseAssert(S!==n.nullHandle);const t=this.m_topoGraph.getHalfEdgeTwin(E);this.m_topoGraph.getHalfEdgeNext(t)}let D=w;w||T||u&&(D=this.isOnALoop(e,s),D||(D=this.isOnALoop(v,s)));const I=b>=0;let A=!1;D&&C&&(w?(A=d,I&&(A||g||_)&&E!==e&&(i.geometryReleaseAssert(!g),E=e,A=!1)):(g||I&&_)&&(E=e));let M=0;for(x=E;v=this.m_topoGraph.getHalfEdgeTwin(x),this.m_topoGraph.setHalfEdgeUserIndex(x,s,1),this.m_topoGraph.setHalfEdgeUserIndex(v,s,1),M++,x!==S;)x=p?this.m_topoGraph.getHalfEdgeNext(x):this.tryMoveThroughCrossroadForward(x,!1);I||(S=r.swap(E,E=S),S=this.m_topoGraph.getHalfEdgeTwin(S),E=this.m_topoGraph.getHalfEdgeTwin(E));let N=f.insertPath(t,n.nullHandle);x=E;const R=this.m_topoGraph.getHalfEdgeOrigin(E);let O;O=-1!==l?this.chooseVertexByOrder(R,f,l,c):this.chooseVertexFromCluster_(R,a),this.m_topoGraph.isStrongPathNode(R)&&f.setStrongPathStart(N,!0);let G=f.addVertex(N,O),k=G;-1!==o&&this.m_topoGraph.setClusterUserIndex(R,o,1);let V=0;const F=A?Math.trunc((M+1)/2):-1;let L=n.nullHandle,q=!0,H=n.nullHandle;for(;;){if(y){const e=this.m_topoGraph.getSegmentParentage(x),t=this.m_topoGraph.getHalfEdgeOrigin(x);f.setSegmentParentageAndBreak(k,e,q||this.m_topoGraph.isBreakNode(t))}q=!1,this.m_topoGraph.isHalfEdgeCurve(x)&&(this.m_topoGraph.querySegmentXY(x,P),f.setSegmentToIndex(f.getVertexIndex(k),P.get().clone())),L!==n.nullHandle&&-1!==c&&f.addToUserIndex(L,c,-1);const e=p?this.m_topoGraph.getHalfEdgeNext(x):this.tryMoveThroughCrossroadForward(x,!1),i=this.m_topoGraph.getHalfEdgeTo(x);let s;if(s=-1!==l?this.chooseVertexByOrder(i,f,l,c):this.chooseVertexFromCluster_(i,a),G=f.addVertex(N,s),H=i,-1!==o&&this.m_topoGraph.setClusterUserIndex(i,o,1),y&&this.m_topoGraph.isBreakNode(i)&&f.setSegmentParentageBreakVertex(G,!0),L=s,V++,A&&V===F&&(N=f.insertPath(t,n.nullHandle),G=f.addVertex(N,s),q=!0,-1!==c&&f.addToUserIndex(s,c,-1),L=n.nullHandle),x===S)break;x=e,k=G}H!==n.nullHandle&&this.m_topoGraph.isStrongPathNode(H)&&f.setStrongPathEnd(N,!0)}topoOperationPolylineSimplify_(e,t){return this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,n.nullHandle,!1,t).first}topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,t,s,o){i.geometryReleaseAssert(t===n.nullHandle||e===n.nullHandle);const a=this.m_topoGraph.getShape(),l=t=>e===n.nullHandle?t===n.nullHandle?a.getFirstGeometry():a.getNextGeometry(t):t===n.nullHandle?e:n.nullHandle,c=a.createGeometry(i.GeometryType.enumPolyline);let h=-1;s&&(h=this.m_topoGraph.createUserIndexForClusters());const u=this.m_topoGraph.createUserIndexForHalfEdges(),m=t===n.nullHandle?a.createUserIndex():-1,d=t===n.nullHandle?a.createUserIndex():-1;let p=-1;if(1===o.unsplitBehavior){p=this.m_topoGraph.createUserIndexForClusters();for(let e=l(n.nullHandle);e!==n.nullHandle;e=l(e))for(let t=a.getFirstPath(e);t!==n.nullHandle;t=a.getNextPath(t)){{const e=a.getFirstVertex(t),i=this.m_topoGraph.getClusterFromVertex(e);this.m_topoGraph.setClusterUserIndex(i,p,1)}if(!a.isClosedPath(t)){const e=a.getLastVertex(t),i=this.m_topoGraph.getClusterFromVertex(e);this.m_topoGraph.setClusterUserIndex(i,p,1)}}}if(t===n.nullHandle){let e=0;for(let t=l(n.nullHandle);t!==n.nullHandle;t=l(t))for(let i=a.getFirstPath(t);i!==n.nullHandle;i=a.getNextPath(i))if(a.isClosedPath(i)){let t=a.getFirstVertex(i);for(let n=0,s=a.getPathSize(i);n<s;n++,t=a.getNextVertex(t))a.setUserIndex(t,m,e++),a.setUserIndex(t,d,2)}else{const t=a.getFirstVertex(i);a.setUserIndex(t,m,e++),a.setUserIndex(t,d,1);let n=a.getNextVertex(t);for(let t=1,s=a.getPathSize(i)-1;t<s;++t)a.setUserIndex(n,m,e++),a.setUserIndex(n,d,2),n=a.getNextVertex(n);a.setUserIndex(n,m,e++),a.setUserIndex(n,d,1)}}for(let e=l(n.nullHandle);e!==n.nullHandle;e=l(e))for(let i=a.getFirstPath(e);i!==n.nullHandle;i=a.getNextPath(i)){let e=a.getFirstVertex(i);for(let s=0,r=a.getPathSize(i);s<r;s++,e=a.getNextVertex(e)){const i=this.m_topoGraph.getHalfEdgeFromVertex(e);if(i===n.nullHandle)continue;if(1===this.m_topoGraph.getHalfEdgeUserIndex(i,u))continue;const r=this.getCombinedHalfEdgeParentage(i);if(this.isGoodParentage(r)){const e=0===s;this.restorePolylineParts(i,c,u,h,t,m,d,p,e,o)}}}let g=n.nullHandle;if(s){g=a.createGeometry(i.GeometryType.enumMultiPoint);let e=n.nullHandle;for(let i=this.m_topoGraph.getFirstCluster();i!==n.nullHandle;i=this.m_topoGraph.getNextCluster(i))if(this.progress_(),1!==this.m_topoGraph.getClusterUserIndex(i,h)){const s=this.m_topoGraph.getClusterParentage(i);if(this.isGoodParentage(s)){e===n.nullHandle&&(e=a.insertPath(g,n.nullHandle));const s=this.m_topoGraph.getClusterVertexIterator(i);if(s!==n.nullHandle){let n;this.m_topoGraph.getVertexFromVertexIterator(s),n=-1!==m?this.chooseVertexByOrder(i,a,m,d):this.chooseVertexFromCluster_(i,t),a.addVertex(e,n)}}}}return-1!==d&&a.removeUserIndex(d),-1!==m&&a.removeUserIndex(m),-1!==h&&a.removeUserIndex(h),this.m_topoGraph.deleteUserIndexForHalfEdges(u),r.makePair(c,g)}difference(e,t){const s=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),o=i.getDimensionFromType(s),a=i.getDimensionFromType(r);if(o>a)return e;const l=this.m_topoGraph.getGeometryID(e),c=this.m_topoGraph.getGeometryID(t);if(this.m_maskLookup.length=0,this.m_maskLookup.length=1+(l|c),this.m_maskLookup[l]=!0,2===o&&2===a){let i=n.nullHandle;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(i=e),this.topoOperationPolygonPolygon_(e,t,i)}if(1===o&&2===a){const t={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};return t.ogcRule=this.m_bOGCOutput,t.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,n.nullHandle,!1,t).first}if(1===o&&1===a){const t={unsplitBehavior:0,allCrossRoadsImpassable:!0,ogcRule:!1};return t.ogcRule=this.m_bOGCOutput,t.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,n.nullHandle,!1,t).first}if(0===o)return this.topoOperationMultiPoint_();i.throwInternalErrorException("")}symmetricDifference(e,t){const s=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),o=vi(s),a=vi(r),l=this.m_topoGraph.getGeometryID(e),c=this.m_topoGraph.getGeometryID(t);return i.geometryReleaseAssert(l>=0),i.geometryReleaseAssert(c>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(l|c),this.m_maskLookup[l]=!0,this.m_maskLookup[l]=!0,this.m_maskLookup[c]=!0,2===o&&2===a?this.topoOperationPolygonPolygon_(e,t,n.nullHandle):1===o&&1===a?this.topoOperationPolyline_(n.nullHandle,this.m_bOGCOutput):0===o&&0===a?this.topoOperationMultiPoint():void i.throwInternalErrorException("")}planarSimplifyNoCrackingAndCluster(e,t,s,r){this.m_bOGCOutput=e,this.m_topoGraph=new X;const o=t.getFillRule(s),a=t.getGeometryType(s);if(1!==o||a===i.GeometryType.enumMultiPoint?this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,s,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeWinding(t,s,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return!1;this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const l=this.m_topoGraph.getGeometryID(s);if(i.geometryReleaseAssert(l>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=l+1,this.m_maskLookup[l]=!0,t.getGeometryType(s)===i.GeometryType.enumPolygon||1===o&&t.getGeometryType(s)!==i.GeometryType.enumMultiPoint){t.setFillRule(s,0);const i=this.topoOperationPolygonPolygon_(s,n.nullHandle,n.nullHandle);if(t.swapGeometry(i,s),t.removeGeometry(i),1===o&&this.m_bOGCOutput)return this.planarSimplifyNoCrackingAndCluster(e,t,s,r)}else if(t.getGeometryType(s)===i.GeometryType.enumPolyline){const e={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};e.ogcRule=this.m_bOGCOutput,e.allCrossRoadsImpassable=!0,e.unsplitBehavior=r;const i=this.topoOperationPolylineSimplify_(t.getFirstGeometry(),e);t.swapGeometry(i,s),t.removeGeometry(i)}else if(t.getGeometryType(s)===i.GeometryType.enumMultiPoint){const e=this.topoOperationMultiPoint_();t.swapGeometry(e,s),t.removeGeometry(e)}else i.throwInternalErrorException("");return!0}unsplitPolylineExact(e){return i.geometryReleaseAssert(0),new n.Polyline}planarSimplifyPolylines(e,t,s,r,o){for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t)){const n=e.getGeometryType(t);i.geometryReleaseAssert(n===i.GeometryType.enumPolyline)}let a=0,l=0,c=null;if(e.hasCurves()&&!e.hasSegmentParentage()){c=new li;const i=e.getEnvelope2D(this.m_progressTracker);l=oi(t.total());const n=ri(t.total(),i);a=ai(n,l),ii(e,n,t.total(),0,c,null,this.m_progressTracker)}{const i=di(t.add(a));e.filterClosePoints(i,!1,!1,!1,n.nullHandle)}if(this.m_topoGraph=new X,4!==o&&5!==o)if(null===c&&s){const i=new _e(this.m_progressTracker,!1);i.sweepVertical(e,t.total()),i.hadComplications()?(hi(e,t,this.m_progressTracker,!0,!1),s=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(t.total())}else hi(e,t.add(a),this.m_progressTracker,!0,!1),s=!1;else s=!1;e.removeSelection(),e.collapseAllGeometriesToFirst();const h=e.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,h,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return i.geometryReleaseAssert(s&&null===c),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolylines(e,t,!1,r,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const u=this.m_topoGraph.getGeometryID(h);i.geometryReleaseAssert(u>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=u+1,this.m_maskLookup[u]=!0;const m=this.topoOperationPolylineSimplify_(e.getFirstGeometry(),r);null!==c&&c.stitchCurves(e,m,l,!0);const d=e.getGeometry(m);return s||d.getImpl().setIsSimple(4,t.total()),d}planarSimplifyMultiPoints(e,t,s,r){for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t)){const n=e.getGeometryType(t);i.geometryReleaseAssert(n===i.GeometryType.enumMultiPoint)}this.m_topoGraph=new X,4!==r&&5!==r?(hi(e,t,this.m_progressTracker,!0,!1),s=!1):s=!1,e.removeSelection(),e.collapseAllGeometriesToFirst();const o=e.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,o,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return i.geometryReleaseAssert(s),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyMultiPoints(e,t,!1,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const a=this.m_topoGraph.getGeometryID(o);i.geometryReleaseAssert(a>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=a+1,this.m_maskLookup[a]=!0;const l=this.topoOperationMultiPoint(),c=e.getGeometry(l);return s||c.getImpl().setIsSimple(4,t.total()),c}planarSimplifyPolygons(e,t,s,r,o,a){for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t)){const n=e.getGeometryType(t);i.geometryReleaseAssert(n===i.GeometryType.enumPolygon||n===i.GeometryType.enumPolyline&&s)}let l=0,c=0,h=null;if(e.hasCurves()&&!e.hasSegmentParentage()){h=new li;const i=e.getEnvelope2D(this.m_progressTracker);c=oi(t.total());const n=ri(t.total(),i);l=ai(n,c),ii(e,n,t.total(),0,h,null,this.m_progressTracker)}if(a){hi(e,t.add(l),this.m_progressTracker,!0,!1);for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t))e.getGeometryType(t)===i.GeometryType.enumPolygon&&Ae(e,t,-1,!1,n.nullHandle,this.m_progressTracker)}if(this.m_topoGraph=new X,a||4===o||5===o)r=!1;else if(null===h&&r){const i=new _e(this.m_progressTracker,!1);i.sweepVertical(e,t.total()),i.hadComplications()?(hi(e,t,this.m_progressTracker,!0,!1),r=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(t.total())}else hi(e,t.add(l),this.m_progressTracker,!0,!1),r=!1;e.removeSelection(),e.collapseAllGeometriesToFirst();const u=e.getFirstGeometry();if(s?this.m_topoGraph.setAndSimplifyEditShapeWinding(e,u,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,u,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return i.geometryReleaseAssert(r&&null===h),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolygons(e,t,s,!1,-1,!1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const m=this.m_topoGraph.getGeometryID(u);i.geometryReleaseAssert(m>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=m+1,this.m_maskLookup[m]=!0,e.setFillRule(u,0);const d=this.m_bOGCOutput&&s,p=d;let g=this.topoOperationPolygonPolygon_(u,n.nullHandle,n.nullHandle,p);d&&(this.m_topoGraph.removeShape(),this.m_topoGraph=null,e.removeGeometry(u),this.m_topoGraph=new X,this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,g,this.m_progressTracker),g=this.topoOperationPolygonPolygon_(g,n.nullHandle,n.nullHandle,!1)),null!==h&&h.stitchCurves(e,g,c,!0);const _=e.getGeometry(g);return _.setFillRule(0),r?_.getImpl().setIsSimple(3,0):(_.getImpl().setIsSimple(4,t.total()),_.getImpl().updateOGCFlagsProtected()),_}planarSimplify3DImpl_(e,t,n,s,r){return i.geometryReleaseAssert(0),{}}planarSimplifyImpl_(e,t,r,o,a,l,c,h){if(e.isEmpty())return e.clone();const u=e.getGeometryType(),m=new n.EditShape,d=m.addGeometry(e);if(s.isAtLeastWeakSimple(a)&&u===i.GeometryType.enumPolygon&&(r=!1,m.setFillRule(d,0)),h&&(e.hasAttribute(1)&&m.replaceNaNs(1,0),m.removeNaNVertices()),u===i.GeometryType.enumPolygon||u===i.GeometryType.enumPolyline&&r)return this.planarSimplifyPolygons(m,t,r,o,a,!1);if(u===n.Polyline.type){const e={unsplitBehavior:0,allCrossRoadsImpassable:!0,ogcRule:!1};return e.ogcRule=this.m_bOGCOutput,e.unsplitBehavior=c,this.planarSimplifyPolylines(m,t,o,e,a)}if(u===i.GeometryType.enumMultiPoint)return this.planarSimplifyMultiPoints(m,t,o,a);i.throwInternalErrorException("what else?")}}function Di(e,t,r,o){const a=e.getGeometryType();if(a===i.GeometryType.enumEnvelope){const t=new n.Polygon({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(a===i.GeometryType.enumPoint&&("|"===o||"^"===o)){const t=new n.MultiPoint({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if(a===i.GeometryType.enumLine){const t=new n.Polyline({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}if(a===i.GeometryType.enumMultiPoint&&"-"===o&&t.getGeometryType()===i.GeometryType.enumPoint){const t=new s.Point({vd:e.getDescription()});return e.isEmpty()||e.getPointByVal(0,t),t}if(a===i.GeometryType.enumMultiPoint&&"&"===o&&t.getGeometryType()===i.GeometryType.enumPoint){const t=new s.Point({vd:e.getDescription()});return e.isEmpty()||e.getPointByVal(0,t),t}return e}function Ii(e){const t=e.getGeometryType();if(t===i.GeometryType.enumEnvelope){const t=new n.Polygon({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(t===i.GeometryType.enumPoint){const t=new n.MultiPoint({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if(xi(t)){const t=new n.Polyline({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}return t!==i.GeometryType.enumMultiPoint&&t!==i.GeometryType.enumPolyline&&t!==i.GeometryType.enumPolygon&&i.throwInvalidArgumentException("Unexpected geometry type"),e}function Ai(e,t,s,r){const o=s===n.nullHandle?e.getClusterHalfEdge(t):s;let a=o;i.geometryReleaseAssert(e.getHalfEdgeOrigin(o)===t);do{r(a),a=e.getHalfEdgeNext(e.getHalfEdgeTwin(a))}while(a!==o)}class Mi{constructor(e,t,i,s,r,o){this.m_rParent=e,this.m_rTopoGraph=e.m_topoGraph,this.m_rShape=this.m_rTopoGraph.getShape(),this.m_IDCuttee=this.m_rTopoGraph.getGeometryID(s),this.m_IDCutter=this.m_rTopoGraph.getGeometryID(r),this.m_IDBoth=this.m_IDCuttee|this.m_IDCutter,this.m_bConsiderTouch=t,this.m_sideIndex=i,this.m_cuttee=s,this.m_cutter=r,this.m_rCutHandles=o,this.m_cutteeBreadcrumbsIndex=this.m_rShape.createUserIndexUninitialized(),this.m_clusterParentageIndex=this.m_rShape.createUserIndexUninitialized();for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==n.nullHandle;e=this.m_rShape.getNextPath(e)){let t=0;const i=this.m_rShape.getPathSize(e);for(let n=this.m_rShape.getFirstVertex(e);t<i;t++,n=this.m_rShape.getNextVertex(n))this.m_rShape.setUserIndex(n,this.m_clusterParentageIndex,this.m_rTopoGraph.getClusterParentage(this.m_rTopoGraph.getClusterFromVertex(n)))}}Do(){this.cutPolylinePolyline_(),this.m_rShape.removeUserIndex(this.m_cutteeBreadcrumbsIndex),this.m_rShape.removeUserIndex(this.m_clusterParentageIndex)}setTbd(e){return 8|e}classifyStandardCut(e,t,i,s){const r=this.m_rShape.getPrevVertex(e),o=this.m_rShape.getNextVertex(e),a=r===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(r)),l=o===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(o)),c=this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(i)),h=this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(s));let u=1,m=32,d=32;if(Ai(this.m_rTopoGraph,t,h,(e=>{e===c&&(u=2),e===a&&(m=u),e===l&&(d=u)})),this.m_bConsiderTouch)32!==m&&this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex)|m),32!==d&&this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|d);else{if(32===m||32===d)return 1;if(m===d&&a!==c&&a!==h&&l!==c&&l!==h)return 1;this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex)|m),this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|d)}return 0}classifyTouchCut(e,t,i,s){const r=this.m_rShape.getPrevVertex(e),o=this.m_rShape.getNextVertex(e),a=r===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(r)),l=o===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(o)),c=i===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(i)),h=s===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(s));if(!this.m_bConsiderTouch){let t;return(t=c===a||h===a)?this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))):(t=c===l||h===l)&&this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex))),t?0:1}if(a===n.nullHandle)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(l===n.nullHandle)return this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex))),0;if(a===l)return this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex))),this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(h!==n.nullHandle){if(a===h)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(l===h)return this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex))),0;let i=1;Ai(this.m_rTopoGraph,t,h,(t=>{if(t===a){const e=this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex)|i;this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,e),i=2}else if(t===l){const t=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|i;this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,t),i=2}}))}else{if(a===c)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(l===c)return this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex))),0;let i=2;Ai(this.m_rTopoGraph,t,c,(t=>{if(t===a){const e=this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex)|i;this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,e),i=1}else if(t===l){const t=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|i;this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,t),i=1}}))}return 0}classifyCutVertex(e,t){let i=0,s=0;for(let r=this.m_rTopoGraph.getClusterVertexIterator(t);r!==n.nullHandle;r=this.m_rTopoGraph.incrementVertexIterator(r)){const o=this.m_rTopoGraph.getVertexFromVertexIterator(r);if(this.m_rShape.getGeometryFromVertex(o)===this.m_cutter){s++;const r=this.m_rShape.getPrevVertex(o),a=this.m_rShape.getNextVertex(o);r===n.nullHandle||a===n.nullHandle?i+=this.classifyTouchCut(e,t,r,a):i+=this.classifyStandardCut(e,t,r,a)}}s&&i===s&&!this.m_bConsiderTouch&&this.m_rShape.setUserIndex(e,this.m_clusterParentageIndex,this.m_IDCuttee)}cutPolylinePolyline_(){this.m_rShape.getGeometryType(this.m_cuttee),this.m_rShape.getGeometryType(this.m_cutter),this.m_rParent.m_maskLookup.length=0,this.m_rParent.m_maskLookup.length=this.m_IDBoth+1,this.m_rParent.m_maskLookup[this.m_IDBoth]=!0;for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==n.nullHandle;e=this.m_rShape.getNextPath(e)){const t=this.m_rShape.getPathSize(e);let i=this.m_rShape.getFirstVertex(e);for(let e=0;e<t;++e,i=this.m_rShape.getNextVertex(i))this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,0);i=this.m_rShape.getFirstVertex(e);for(let e=0;e<t;++e,i=this.m_rShape.getNextVertex(i)){const e=this.m_rTopoGraph.getClusterFromVertex(i);this.m_rTopoGraph.getClusterParentage(e)===this.m_IDBoth&&this.classifyCutVertex(i,e)}}const e=(e,t)=>{let i=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex);const n=this.m_rTopoGraph.getHalfEdgeConnector(this.m_rTopoGraph.getClusterFromVertex(e),this.m_rTopoGraph.getClusterFromVertex(t));return(this.m_rTopoGraph.getHalfEdgeParentage(n)&this.m_IDBoth)===this.m_IDBoth&&(i|=4),i};for(let t=this.m_rShape.getFirstPath(this.m_cuttee);t!==n.nullHandle;t=this.m_rShape.getNextPath(t)){let i=this.m_rShape.getFirstVertex(t);const n=this.m_rShape.isClosedPath(t),s=this.m_rShape.getPathSize(t)+(n?1:0);let r=1,o=32;for(let t=this.m_rShape.getNextVertex(i);r<s;++r,i=t,t=this.m_rShape.getNextVertex(t)){const n=e(i,t);this.m_rShape.getUserIndex(i,this.m_clusterParentageIndex)===this.m_IDBoth&&(o=n),32!==o&&this.m_rShape.setUserIndex(i,this.m_cutteeBreadcrumbsIndex,o|n)}i=this.m_rShape.getLastVertex(t);let a=32;r=1;for(let t=this.m_rShape.getPrevVertex(i);r<s;++r,i=t,t=this.m_rShape.getPrevVertex(t)){const n=e(t,i);this.m_rShape.getUserIndex(i,this.m_clusterParentageIndex)===this.m_IDBoth&&(a=n),32!==a&&this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,a|n)}}let t=n.nullHandle,s=n.nullHandle,r=32;const o=this.m_rShape.hasSegmentParentage(),a=new n.SegmentBuffer;for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==n.nullHandle;e=this.m_rShape.getNextPath(e)){const l=this.m_rShape.isClosedPath(e),c=this.m_rShape.getPathSize(e)+(l?1:0);let h=1,u=this.m_rShape.getFirstVertex(e),m=n.nullHandle,d=!0;for(let e=this.m_rShape.getNextVertex(u);h<c;++h,e=this.m_rShape.getNextVertex(e)){let l=this.m_rShape.getUserIndex(u,this.m_cutteeBreadcrumbsIndex);8===l?l=3:(l&=-9,4&l?l=4:3&~l||(l=3)),l!==r?(t!==n.nullHandle&&(m=this.m_rShape.addVertex(s,u),o&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(u))&&this.m_rShape.setSegmentParentageBreakVertex(m,!0),this.m_rCutHandles.push(t),this.m_rShape.setGeometryUserIndex(t,this.m_sideIndex,r)),t=this.m_rShape.createGeometry(i.GeometryType.enumPolyline),s=this.m_rShape.insertPath(t,n.nullHandle),r=l,d=!0):this.m_rShape.getUserIndex(u,this.m_clusterParentageIndex)===this.m_IDBoth&&4!==l&&(m=this.m_rShape.addVertex(s,u),o&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(u))&&this.m_rShape.setSegmentParentageBreakVertex(m,!0),s=this.m_rShape.insertPath(t,n.nullHandle),d=!0),m=this.m_rShape.addVertex(s,u);const c=this.m_rTopoGraph.getClusterFromVertex(u);!d&&o&&this.m_rTopoGraph.isBreakNode(c)&&this.m_rShape.setSegmentParentageBreakVertex(m,!0);const h=this.m_rTopoGraph.getHalfEdgeFromVertex(u);if(o){const e=this.m_rTopoGraph.getSegmentParentage(h);this.m_rShape.setSegmentParentageAndBreak(m,e,d||this.m_rTopoGraph.isBreakNode(c))}this.m_rTopoGraph.isHalfEdgeCurve(h)&&(this.m_rTopoGraph.querySegmentXY(h,a),this.m_rShape.setSegmentToIndex(this.m_rShape.getVertexIndex(m),a.get().clone())),u=e,d=!1}m=this.m_rShape.addVertex(s,u),o&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(u))&&this.m_rShape.setSegmentParentageBreakVertex(m,!0),this.m_rCutHandles.push(t),this.m_rShape.setGeometryUserIndex(t,this.m_sideIndex,r),t=n.nullHandle,s=n.nullHandle,r=32}}}function Ni(e,r,o,a,l){if(a&&(a.m_reason=0,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),e.isEmpty())return 5;const c=e.getGeometryType();if(c===i.GeometryType.enumPoint)return Oi(e,a);const h=s.calculateToleranceFromGeometryForOpFromGeom(r,e,!1).total();if(c===i.GeometryType.enumEnvelope){const i=e,n=t.Envelope2D.constructEmpty();return i.queryEnvelope(n),n.isDegenerate(h)?(a&&(a.m_reason=4,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),0):5}if(i.isSegment(c)){const t=e,i=new n.Polyline({vd:t.getDescription()});return i.addSegment(t,!0),Ni(i,r,o,a,l)}const u=e.getImpl().getIsSimple(h,[0]);let m=o?-1:u;if(-1!==m)return m;const d=new Hi(e,r,m,l,!1);return c===i.GeometryType.enumMultiPoint?m=d.multipointIsSimpleAsFeature():c===i.GeometryType.enumPolyline?m=d.polylineIsSimpleAsFeature():c===i.GeometryType.enumPolygon?m=d.polygonIsSimpleAsFeature():i.throwInternalErrorException(""),e.getImpl().setIsSimple(m,h),a&&a.assign(d.m_nonSimpleResult),m}function Ri(e,r,o,a){if(e.isEmpty())return e;const l=e.getGeometryType();if(l===i.GeometryType.enumPoint){const t=new u.NonSimpleResult;if(Oi(e,t),3===t.m_reason){const t=e.clone();return t.replaceNaNs(1,0),t}return 2===t.m_reason?e.createInstance():e}if(l===i.GeometryType.enumEnvelope){const i=s.calculateToleranceFromGeometryForOpFromGeom(r,e,!0).total(),n=e,o=t.Envelope2D.constructEmpty();return n.queryEnvelope(o),o.isDegenerate(i)?n.createInstance():e}if(i.isSegment(l)){const t=e,i=new n.Polyline({vd:t.getDescription()});return i.addSegment(t,!0),Ri(i,r,o,a)}i.throwIfGeometryCollectionType(l);const c=s.calculateToleranceFromGeometryForOpFromGeom(r,e,!1).total(),h=e.getImpl().getIsSimple(c,[0]),m=o?-1:h;if(s.isAtLeastPlanarSimple(m)){if(l===i.GeometryType.enumPolygon&&0!==e.getFillRule()){const t=e.clone();return t.setFillRule(0),t}return e}if((l===i.GeometryType.enumMultiPoint||l===i.GeometryType.enumPolyline)&&m>=1)return e;const d=new Hi(e,r,m,a,!1);let p;return l===i.GeometryType.enumMultiPoint?p=d.multipointSimplifyAsFeature():l===i.GeometryType.enumPolyline?p=d.polylineSimplifyAsFeature():l===i.GeometryType.enumPolygon?p=d.polygonSimplifyAsFeature():i.throwInternalErrorException(""),p}function Oi(e,t){const i=e.getX(),n=e.getY();if(!Number.isFinite(i)||!Number.isFinite(n))return t&&(t.m_reason=2,t.m_vertexIndex1=-1,t.m_vertexIndex2=-1),0;if(e.hasAttribute(1)){const i=e.getZ();if(!Number.isFinite(i))return t&&(t.m_reason=Number.isNaN(i)?3:2,t.m_vertexIndex1=-1,t.m_vertexIndex2=-1),0}return 5}class Gi{constructor(){this.m_segment=null,this.m_vertexIndex=-1,this.m_pathIndex=-1,this.m_flags=0}setReversed(e){this.m_flags&=-2,this.m_flags=this.m_flags|(e?1:0)}getReversed(){return!!(1&this.m_flags)}getRightSide(){return this.getReversed()?0:1}}function ki(e,t,i,n,s){return{x:e,y:t,ipath:i,ivertex:n,ipolygon:s}}function Vi(e,t){e.x=t.x,e.y=t.y,e.ipath=t.ipath,e.ivertex=t.ivertex,e.ipolygon=t.ipolygon}function Fi(e,t,i,n,s,r){return{x:e,y:t,ipath:i,ivertex:n,bBoundary:s,bEndPoint:r}}class Li extends s.Comparator{constructor(e){super(),this.m_helper=e}compare(e,t,i){const n=e.getElement(i),s=this.m_helper.m_xy.read(2*t)-this.m_helper.m_xy.read(2*n);return s<0?-1:s>0?1:0}}class qi extends s.Comparator{constructor(e){super(),this.m_helper=e}compare(e,t,i){const n=e.getElement(i),s=this.m_helper.m_edges[t],r=this.m_helper.m_edges[n],o=s.getReversed(),a=r.getReversed();let l=s.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0),c=r.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0);if(l===c){const e=o?s.m_segment.getStartY():s.m_segment.getEndY(),t=a?r.m_segment.getStartY():r.m_segment.getEndY(),i=Math.min(e,t);let n=.5*(i-this.m_helper.m_yScanline)+this.m_helper.m_yScanline;n===this.m_helper.m_yScanline&&(n=i),l=s.m_segment.intersectionOfYMonotonicWithAxisX(n,0),c=r.m_segment.intersectionOfYMonotonicWithAxisX(n,0)}return l<c?-1:l>c?1:0}}class Hi{constructor(e,t,i,n,r){this.m_multiVertexGeom=null,this.m_edges=[],this.m_freeEdges=[],this.m_lineEdgesRecycle=[],this.m_newEdges=[],this.m_recycledSegIter=null,this.m_crossOverHelperList=new s.IndexMultiDCList,this.m_progressTracker=null,this.m_progressCounter=0,this.m_AET=new s.Treap,this.m_xyToNode1=null,this.m_xyToNode2=null,this.m_pathOrientations=null,this.m_pathParentage=null,this.m_xy=null,this.m_pairs=[],this.m_pairIndices=null,this.m_pathsForOGCTests=[],this.m_curveStitcher=null,this.m_editShape=null,this.m_multiPathStitcher=null,this.m_nonSimpleResult=new u.NonSimpleResult,this.m_progressCounter=0,this.m_progressTracker=n,this.m_geometry=e,this.m_knownSimpleResult=i,this.m_sr=t;const o=s.calculateToleranceFromGeometryForOpFromGeom(t,e,!1);this.m_toleranceIsSimple=o,this.m_toleranceIsSimpleClustering=s.adjustToleranceForTEClustering(o),this.m_toleranceIsSimpleCracking=s.adjustToleranceForTECracking(o),this.m_toleranceSimplify=s.calculateToleranceFromGeometryForOpFromGeom(t,e,!0),this.m_description=this.m_geometry.getDescription(),this.m_attributeCount=this.m_description.getAttributeCount(),this.m_bOGCRestrictions=r,this.m_bPlanarSimplify=this.m_bOGCRestrictions,this.m_unknownOrientationPathCount=-1,this.m_yScanline=0,this.m_progressCounter=0}isSimplePlanarImpl(){if(this.m_bPlanarSimplify=!0,!this.checkStructure())return 0;const e=this.m_geometry.getGeometryType();return i.isMultiPath(e)&&!this.checkDegenerateSegments(!1)?0:this._CheckClustering()?i.isMultiPath(e)?this._CheckCracking()?this.m_geometry.getGeometryType()===i.GeometryType.enumPolyline?this.checkSelfIntersectionsPolylinePlanar()?4:0:this._CheckSelfIntersections()?this._CheckValidRingOrientation():0:0:5:0}isSimplePlanarImpl3D(){return i.geometryReleaseAssert(0),7}generateSortedPairs(e){let t=null;i.isMultiPath(e.getGeometryType())&&(t=e);const n=(this.m_bPlanarSimplify||this.m_bOGCRestrictions)&&null!==t,o=e.getPointCount();this.m_xy=e.getAttributeStreamRef(0),this.m_pairs.length=0,this.m_pairIndices=new s.AttributeStreamOfInt32(0),n&&(this.m_pathsForOGCTests.length=0);let a=0;for(let e=0;e<o;e++)if(this.m_pairs.push(2*e),this.m_pairs.push(2*e+1),this.m_pairIndices.add(2*e),this.m_pairIndices.add(2*e+1),n){for(;e>=t.getPathEnd(a);)a++;this.m_pathsForOGCTests.push(a)}const l=new s.BucketSort,c={parent:this,workPt:new r.Point2D,userSort(e,t,i){i.sort(e,t,((e,t)=>this.parent.compareVerticesForPlanarClustering(e,t,n)))},getValue(e){const t=this.parent.m_pairs[e],i=t>>1;return this.parent.m_xy.queryPoint2D(2*i,this.workPt),this.workPt.y+(1&t?this.parent.m_toleranceIsSimpleClustering:-this.parent.m_toleranceIsSimpleClustering)}};l.sort(this.m_pairIndices,0,2*o,c)}_TestToleranceDistancePlanar(e,t){const i=this.m_xy.read(2*e),n=this.m_xy.read(2*e+1),s=this.m_xy.read(2*t),r=this.m_xy.read(2*t+1);return!J(i,n,s,r,this.m_toleranceIsSimpleClustering*this.m_toleranceIsSimpleClustering)||0!==this.m_geometry.getDimension()&&i===s&&n===r}checkStructure(){const e=this.m_geometry.getGeometryType();if(i.isMultiPath(e)){const e=this.m_geometry.getImpl(),t=this.m_geometry.getGeometryType()===i.GeometryType.enumPolygon?3:2;for(let i=0,n=e.getPathCount();i<n;i++)if(e.getPathSize(i)<t){if(e.hasNonLinearSegments()&&e.hasNonLinearSegmentsPath(i)&&e.getPathSize(i)>0)continue;return this.m_nonSimpleResult=new u.NonSimpleResult(1,i,0),!1}}if(i.isMultiVertex(e)){const e=this.m_geometry.getImpl(),t=e.getAttributeStreamRef(0);for(let i=0,n=e.getPointCount();i<n;i++)if(!t.readPoint2D(2*i).isFinite())return this.m_nonSimpleResult=new u.NonSimpleResult(2,i,0),!1;if(this.m_geometry.hasAttribute(1)){const t=e.getAttributeStreamRef(1);for(let i=0,n=e.getPointCount();i<n;i++){const e=t.read(i);if(!Number.isFinite(e))return Number.isNaN(e)?this.m_nonSimpleResult=new u.NonSimpleResult(3,i,0):this.m_nonSimpleResult=new u.NonSimpleResult(2,i,0),!1}}}return!0}checkDegenerateSegments(e){const t=this.m_geometry.getImpl(),i=t.querySegmentIterator(),n=t.hasAttribute(1),r=n?s.calculateZToleranceFromGeometryForOpFromGeom(this.m_sr,t,!1).total():0,o=t.hasNonLinearSegments(),a=this.m_toleranceIsSimple.total();for(;i.nextPath();)for(;i.hasNextSegment();){const t=i.nextSegment();let s=t.calculateLowerLength2D();if(!(s>a||o&&t.isCurve()&&(s=t.calculateLength2D(),s>a))){if(e&&n){const e=t.getStartAttributeAsDbl(1,0),i=t.getEndAttributeAsDbl(1,0);if(Math.abs(i-e)>r)continue}return this.m_nonSimpleResult=new u.NonSimpleResult(4,i.getStartPointIndex(),-1),!1}}return!0}checkDegenerateSegments3D(){return i.geometryReleaseAssert(0),!1}_CheckClustering(){const e=this.m_geometry.getImpl();this.generateSortedPairs(e);const t=e.getPointCount();this.m_AET.clear(),this.m_AET.setComparator(new Li(this)),this.m_AET.setCapacity(t);for(let e=0,i=2*t;e<i;e++){this.progress_();const t=this.m_pairIndices.read(e),i=this.m_pairs[t],n=i>>1;if(1&i){const e=this.m_AET.search(n),t=this.m_AET.getPrev(e),i=this.m_AET.getNext(e);if(this.m_AET.deleteNode(e),t!==s.Treap.st_nullNode()&&i!==s.Treap.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(t),this.m_AET.getElement(i)))return this.m_nonSimpleResult=new u.NonSimpleResult(5,this.m_AET.getElement(t),this.m_AET.getElement(i)),!1}else{const e=this.m_AET.addElement(n),t=this.m_AET.getPrev(e);if(t!==s.Treap.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(t),n))return this.m_nonSimpleResult=new u.NonSimpleResult(5,n,this.m_AET.getElement(t)),!1;const i=this.m_AET.getNext(e);if(i!==s.Treap.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(i),n))return this.m_nonSimpleResult=new u.NonSimpleResult(5,n,this.m_AET.getElement(i)),!1}}return!0}_CheckCracking(){const e=this.m_geometry.getImpl(),t=e.getPointCount();return!e.hasNonLinearSegments()&&t<10?this._CheckCrackingBrute():this._CheckCrackingPlanesweep()}_CheckCrackingPlanesweep(){if(this.m_editShape=new n.EditShape,this.m_editShape.addGeometry(this.m_geometry),this.m_editShape.hasCurves()){this.m_curveStitcher=new li;const e=t.Envelope2D.constructEmpty();this.m_geometry.queryEnvelope(e);const i=ri(this.m_toleranceSimplify.total(),e),n=new u.NonSimpleResult;if(ni(this.m_editShape,i,this.m_toleranceSimplify.total(),0,n,this.m_curveStitcher,null,this.m_progressTracker),0!==n.m_reason)return this.m_editShape=null,this.m_nonSimpleResult.assign(n),!1}const e=new u.NonSimpleResult;return ve(!1,this.m_editShape,this.m_toleranceIsSimpleCracking,e,this.m_progressTracker)?(null!=this.m_curveStitcher?(e.m_vertexIndex1=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,e.m_vertexIndex1),e.m_vertexIndex2=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,e.m_vertexIndex2),this.m_curveStitcher=null):(e.m_vertexIndex1=this.m_editShape.getVertexIndex(e.m_vertexIndex1),e.m_vertexIndex2=this.m_editShape.getVertexIndex(e.m_vertexIndex2)),this.m_editShape=null,this.m_nonSimpleResult.assign(e),!1):(null==this.m_curveStitcher&&(this.m_editShape=null),!0)}_CheckCrackingBrute(){const e=this.m_geometry.getImpl(),t=e.querySegmentIterator(),i=e.querySegmentIterator();for(;t.nextPath();)for(;t.hasNextSegment();){const e=t.nextSegment();if(!t.isLastSegmentInPath()||!t.isLastPath()){i.resetTo(t);do{for(;i.hasNextSegment();){const s=i.nextSegment(),r=n.isIntersecting(!0,e,s,this.m_toleranceIsSimpleCracking,!0);if(r){const e=2===r?7:6;return this.m_nonSimpleResult=new u.NonSimpleResult(e,t.getStartPointIndex(),i.getStartPointIndex()),!1}}}while(i.nextPath())}}return!0}_CheckSelfIntersections(){let e=this.m_geometry.getImpl();null!==this.m_curveStitcher&&(this.m_multiPathStitcher=this.m_editShape.getGeometry(this.m_editShape.getFirstGeometry()),e=this.m_multiPathStitcher.getImpl(),this.generateSortedPairs(e)),this.m_edges.length=0,this.m_lineEdgesRecycle.length=0,this.m_recycledSegIter=e.querySegmentIterator(),this.m_recycledSegIter.setCirculator(!0);const t=[],i=e.getPointCount();let n=Number.NaN,s=0;for(let e=0,r=2*i;e<r;e++){this.progress_();const i=this.m_pairIndices.read(e),r=this.m_pairs[i];if(1&r)continue;const o=r>>1,a=this.m_xy.read(2*o),l=this.m_xy.read(2*o+1);if(t.length&&(a!==n||l!==s)){if(!this.processBunchForSelfIntersectionTest(t))return!1;t.length=0}t.push(o),n=a,s=l}return!!this.processBunchForSelfIntersectionTest(t)}checkSelfIntersectionsPolylinePlanar(){const e=this.m_geometry.getImpl(),t=[];for(let i=0,n=e.getPathCount();i<n;i++)t.push(e.isClosedPathInXYPlane(i));const i={x:-1,y:-1,ipath:-1,ivertex:-1,bBoundary:!1,bEndPoint:!1};let n,s,r;{const o=this.m_pairIndices.read(0),a=this.m_pairs[o]>>1,l=this.m_xy.readPoint2D(2*a),c=this.m_pathsForOGCTests[a];n=t[c],s=e.getPathStart(c),r=e.getPathEnd(c)-1,i.bEndPoint=a===s||a===r,this.m_bOGCRestrictions?i.bBoundary=!n&&i.bEndPoint:i.bBoundary=i.bEndPoint,i.ipath=c,i.x=l.x,i.y=l.y,i.ivertex=a}for(let l=1,c=this.m_pairIndices.size();l<c;l++){const c=this.m_pairIndices.read(l),h=this.m_pairs[c];if(1&h)continue;const m=h>>1,d=this.m_xy.readPoint2D(2*m),p=this.m_pathsForOGCTests[m];let g;p!==i.ipath&&(n=t[p],s=e.getPathStart(p),r=e.getPathEnd(p)-1);const _=m===s||m===r;g=this.m_bOGCRestrictions?!n&&_:_;const f=Fi(d.x,d.y,p,m,g,_);if(f.x===i.x&&f.y===i.y)if(this.m_bOGCRestrictions){if(!(f.bBoundary&&i.bBoundary||f.ipath===i.ipath&&f.bEndPoint&&i.bEndPoint))return this.m_nonSimpleResult=new u.NonSimpleResult(10,f.ivertex,i.ivertex),!1}else if(!f.bEndPoint||!i.bEndPoint)return this.m_nonSimpleResult=new u.NonSimpleResult(7,f.ivertex,i.ivertex),!1;a=f,(o=i).x=a.x,o.y=a.y,o.ipath=a.ipath,o.ivertex=a.ivertex,o.bBoundary=a.bBoundary,o.bEndPoint=a.bEndPoint}var o,a;return!0}checkSelfIntersectionsPolylinePlanar3D(e){return i.geometryReleaseAssert(0),!1}checkSelfIntersectionsPolygonsOGC(){const e=this.m_geometry.getImpl(),t=[];let i=-1,n=!1;for(let s=0,r=e.getPathCount();s<r;s++)e.isExteriorRingOGC(s)&&(n=!1,i++,s<r-1&&(e.isExteriorRingOGC(s+1)||(n=!0))),t.push(n?i:-1);const o={x:-1,y:-1,ipath:-1,ivertex:-1,ipolygon:-1};{const e=this.m_pairIndices.read(0),i=this.m_pairs[e]>>1,n=this.m_xy.readPoint2D(2*i),s=this.m_pathsForOGCTests[i];o.ipath=s,o.x=n.x,o.y=n.y,o.ivertex=i,o.ipolygon=t[s]}const a=[];for(let e=1,i=this.m_pairIndices.size();e<i;e++){const i=this.m_pairIndices.read(e),n=this.m_pairs[i];if(1&n)continue;const s=n>>1,r=this.m_xy.readPoint2D(2*s),h=this.m_pathsForOGCTests[s],m=ki(r.x,r.y,h,s,t[h]);if(m.x===o.x&&m.y===o.y){if(m.ipath===o.ipath)return this.m_nonSimpleResult=new u.NonSimpleResult(11,m.ivertex,o.ivertex),!1;t[m.ipath]>=0&&t[m.ipath]===t[o.ipath]&&(0!==a.length&&(c=o,(l=a.at(-1)).x===c.x&&l.y===c.y&&l.ipath===c.ipath&&l.ivertex===c.ivertex&&l.ipolygon===c.ipolygon)||a.push({...o}),a.push(m))}Vi(o,m)}var l,c;if(0===a.length)return!0;const h=new s.IndexMultiDCList(!0);t.fill(-1);let m=-1;const d=new r.Point2D;for(let e=0,i=a.length;e<i;e++){const i=a[e];i.x===d.x&&i.y===d.y||(m=h.createList(0),d.x=i.x,d.y=i.y);let n=t[i.ipath];-1===n&&(n=h.createList(2),t[i.ipath]=n),h.addElement(n,m),h.addElement(m,n)}const p=[];for(let e=h.getFirstList();-1!==e;e=h.getNextList(e)){const i=h.getListData(e);if(1&i||!(2&i))continue;let n=-1;for(p.push(e),p.push(-1);p.length;){const e=p.at(-1);p.pop();const t=p.at(-1);p.pop();const i=h.getListData(t);if(1&i){n=2&i?t:e;break}h.setListData(t,1|i);for(let i=h.getFirst(t);-1!==i;i=h.getNext(i)){const n=h.getData(i);n!==e&&(p.push(n),p.push(t))}}if(-1!==n){const e=t.indexOf(n);return this.m_nonSimpleResult=new u.NonSimpleResult(12,e,-1),!1}}return!0}_CheckValidRingOrientation(){const e=null!==this.m_multiPathStitcher?this.m_multiPathStitcher.getImpl():this.m_geometry.getImpl();if(e.calculateArea2D()<=0)return this.m_nonSimpleResult=new u.NonSimpleResult(8,1===e.getPathCount()?1:-1,-1),0;if(1===e.getPathCount())return this.m_bOGCRestrictions&&!this.checkSelfIntersectionsPolygonsOGC()?0:4;this.m_pathOrientations=new s.AttributeStreamOfInt8(e.getPathCount(),0),this.m_pathParentage=new s.AttributeStreamOfInt32(e.getPathCount(),-1);let t=-1,i=0;for(let n=0,s=e.getPathCount();n<s;n++){const s=e.calculateRingArea2D(n);if(this.m_pathOrientations.write(n,s<0?0:8),s>0)t=n,i=s;else{if(0===s)return this.m_nonSimpleResult=new u.NonSimpleResult(8,n,-1),0;if((t<0||i<Math.abs(s))&&(this.m_nonSimpleResult=new u.NonSimpleResult(9,n,-1),this.m_bOGCRestrictions))return 0;this.m_pathParentage.write(n,t)}}this.m_unknownOrientationPathCount=e.getPathCount(),this.m_newEdges.length=0;const n=e.getPointCount();this.m_yScanline=Number.NaN;const r=[];this.m_xyToNode1=new s.AttributeStreamOfInt32(n,s.Treap.st_nullNode()),this.m_xyToNode2=new s.AttributeStreamOfInt32(n,s.Treap.st_nullNode()),this.m_freeEdges.length=0,this.m_AET.clear(),this.m_AET.setComparator(new qi(this));for(let e=0,t=2*n;this.m_unknownOrientationPathCount>0&&e<t;e++){const t=this.m_pairIndices.read(e),i=this.m_pairs[t];if(1&i)continue;const n=i>>1,s=this.m_xy.read(2*n+1);if(s!==this.m_yScanline&&r.length){if(!this.processBunchForRingOrientationTest(r))return 0;r.length=0}r.push(n),this.m_yScanline=s}return this.m_unknownOrientationPathCount>0&&!this.processBunchForRingOrientationTest(r)?0:this.m_bOGCRestrictions?0!==this.m_nonSimpleResult.m_reason?0:this.checkSelfIntersectionsPolygonsOGC()?5:0:0===this.m_nonSimpleResult.m_reason?4:3}processBunchForSelfIntersectionTest(e){if(1===e.length)return!0;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.m_recycledSegIter.resetToVertex(i,-1);const n=this.m_recycledSegIter.previousSegment();this.m_edges.push(this.createEdge(n,i,this.m_recycledSegIter.getPathIndex(),!0)),this.m_recycledSegIter.nextSegment();const s=this.m_recycledSegIter.nextSegment();this.m_edges.push(this.createEdge(s,i,this.m_recycledSegIter.getPathIndex(),!1))}this.m_edges.sort(((e,t)=>this.edgeAngleCompare(e,t)));let t=this.m_crossOverHelperList.getFirstList();-1===t&&(t=this.m_crossOverHelperList.createList(0)),this.m_crossOverHelperList.reserveNodes(this.m_edges.length);for(let e=0,i=this.m_edges.length;e<i;e++)this.m_crossOverHelperList.addElement(t,e);let i=!0,n=-1,s=-1;for(;i;){i=!1;let e=this.m_crossOverHelperList.getFirst(t);if(-1===e)break;let r=this.m_crossOverHelperList.getNext(e);for(;-1!==r;){const o=this.m_crossOverHelperList.getData(e),a=this.m_crossOverHelperList.getData(r);if(n=this.m_edges[o].m_vertexIndex,s=this.m_edges[a].m_vertexIndex,n!==s)e=r,r=this.m_crossOverHelperList.getNext(e);else if(i=!0,this.m_crossOverHelperList.deleteElement(t,e),e=this.m_crossOverHelperList.getPrev(r),r=this.m_crossOverHelperList.deleteElement(t,r),-1===r||-1===e)break}}const r=this.m_crossOverHelperList.getListSize(t);if(this.m_crossOverHelperList.clear(t),r>0)return this.m_nonSimpleResult=new u.NonSimpleResult(7,n,s),!1;for(let t=0,i=e.length;t<i;t++)this.recycleEdge(this.m_edges[t]);return this.m_edges.length=0,!0}processBunchForRingOrientationTest(e){for(let t=0,i=e.length;t<i;t++){const i=e[t];let n=this.m_xyToNode1.read(i);if(n!==s.Treap.st_nullNode()){const e=this.m_AET.getElement(n);this.m_freeEdges.push(e),this.m_AET.deleteNode(n),this.recycleEdge(this.m_edges[e]),this.m_edges[e]=null,this.m_xyToNode1.write(i,s.Treap.st_nullNode())}if(n=this.m_xyToNode2.read(i),n!==s.Treap.st_nullNode()){const e=this.m_AET.getElement(n);this.m_freeEdges.push(e),this.m_AET.deleteNode(n),this.recycleEdge(this.m_edges[e]),this.m_edges[e]=null,this.m_xyToNode2.write(i,s.Treap.st_nullNode())}}for(let t=0,i=e.length;t<i;t++){const i=e[t];this.m_recycledSegIter.resetToVertex(i,-1);const n=this.m_recycledSegIter.previousSegment();if(n.getStartY()>n.getEndY()){const e=this.m_recycledSegIter.getStartPointIndex(),t=this.createEdge(n,i,this.m_recycledSegIter.getPathIndex(),!0);let r;this.m_freeEdges.length>0?(r=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[r]=t):(r=this.m_edges.length,this.m_edges.push(t));const o=this.m_AET.addElement(r);this.m_xyToNode1.read(e)===s.Treap.st_nullNode()?this.m_xyToNode1.write(e,o):this.m_xyToNode2.write(e,o),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(o)}this.m_recycledSegIter.nextSegment();const r=this.m_recycledSegIter.nextSegment();if(r.getStartY()<r.getEndY()){const e=this.m_recycledSegIter.getEndPointIndex(),t=this.createEdge(r,i,this.m_recycledSegIter.getPathIndex(),!1);let n;this.m_freeEdges.length>0?(n=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[n]=t):(n=this.m_edges.length,this.m_edges.push(t));const o=this.m_AET.addElement(n);this.m_xyToNode1.read(e)===s.Treap.st_nullNode()?this.m_xyToNode1.write(e,o):this.m_xyToNode2.write(e,o),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(o)}}for(let e=0,t=this.m_newEdges.length;e<t&&this.m_unknownOrientationPathCount>0;e++){const t=this.m_newEdges[e],i=this.m_AET.getElement(t),n=this.m_edges[i].m_pathIndex;if(!(3&this.m_pathOrientations.read(n))){let e=-1,i=this.m_AET.getPrev(t),n=t,r=0;{let t=-1,o=null,a=-1,l=0;for(;i!==s.Treap.st_nullNode()&&(t=this.m_AET.getElement(i),o=this.m_edges[t],a=o.m_pathIndex,l=this.m_pathOrientations.read(a),!(3&l));)n=i,i=this.m_AET.getPrev(i);i===s.Treap.st_nullNode()?(r=1,i=n):(e=1==(3&l)?a:this.m_pathParentage.read(a),r=o.getRightSide()?0:1,i=this.m_AET.getNext(i))}do{const t=this.m_AET.getElement(i),s=this.m_edges[t],o=s.m_pathIndex;let a=this.m_pathOrientations.read(o);if(!(3&a)){if(r!==s.getRightSide())return this.m_nonSimpleResult=new u.NonSimpleResult(8,o,-1),!1;const t=r&&!s.getReversed()?1:2;if(a=-4&a|t,this.m_pathOrientations.write(o,a),2===t&&0===this.m_nonSimpleResult.m_reason){const t=this.m_pathParentage.read(o);if(t!==e&&(this.m_nonSimpleResult=new u.NonSimpleResult(9,o,t),this.m_bOGCRestrictions))return!1}if(this.m_unknownOrientationPathCount--,!this.m_unknownOrientationPathCount)return!0}e=1==(3&a)?o:this.m_pathParentage.read(o),n=i,i=this.m_AET.getNext(i),r=r?0:1}while(n!==t)}}return this.m_newEdges.length=0,!0}createEdge(e,t,n,s){let r;return e.getGeometryType()===i.GeometryType.enumLine?r=this.createEdgeLine(e):(r=new Gi,r.m_segment=e.clone()),r.m_vertexIndex=t,r.m_pathIndex=n,r.m_flags=0,r.setReversed(s),r}createEdgeLine(e){let t;return this.m_lineEdgesRecycle.length>0?(t=this.m_lineEdgesRecycle.at(-1),this.m_lineEdgesRecycle.pop(),e.copyTo(t.m_segment)):(t=new Gi,t.m_segment=e.clone()),t}recycleEdge(e){e.m_segment.getGeometryType()===i.GeometryType.enumLine&&this.m_lineEdgesRecycle.push(e)}static isShortSegment(e,t,i,n){let s=e.calculateLowerLength2D();if(s<=i){let r=!0;if(e.isCurve()&&(s=e.calculateLength2D(),r=s<=i),r){if(t){let t=e.getEndAttributeAsDbl(1,0);Number.isNaN(t)&&(t=0);let i=e.getStartAttributeAsDbl(1,0);return Number.isNaN(i)&&(i=0),Math.abs(i-t)<=n}return!0}return!1}return!1}static isShortSegmentPoints(e,t,i,n,o){if(i){const i=e.getXYZ(),r=t.getXYZ();return s.isCoincidentForClustering(i,r,n,o)}{const i=e.getXY(),s=t.getXY();return r.Point2D.sqrDistance(i,s)<=n*n}}removeDegenerateSegmentsFromCurvedPath(e,t,n,o){const a=e.hasAttribute(1),l=e.querySegmentIterator();l.resetToPath(t),i.geometryReleaseAssert(l.nextPath());const c=this.m_toleranceSimplify.total();let h=!1,u=!0;const m=new s.Point,d=new s.Point,p=new r.Point2D;for(;l.hasNextSegment();){this.progress_();const e=l.nextSegment();if(Hi.isShortSegment(e,a,c,n))if(h){if(e.queryEnd(d),Hi.isShortSegmentPoints(m,d,a,c,n))continue;u&&(o.startPathPoint(m),u=!1),e.queryEnd(m),o.lineToPoint(m),h=!1}else p.assign(e.getStartXY()),e.queryStart(m),h=!0;else if(h)if(e.isCurve()){const t=e.clone();if(t.setCoordsForIntersector(p,e.getEndXY(),!1),t.setStart(m),Hi.isShortSegment(t,a,c,n))continue;o.addSegment(t,u),u=!1,h=!1}else{if(e.queryEnd(d),Hi.isShortSegmentPoints(m,d,a,c,n))continue;u&&(o.startPathPoint(m),u=!1),o.lineToPoint(d),h=!1}else o.addSegment(e,u),u=!1}if(u)return;if(!h)return;e.isClosedPath(t)?e.getPointByVal(e.getPathStart(t),m):e.getPointByVal(e.getPathEnd(t)-1,m);const g=o.querySegmentIterator();g.resetToLastPath(),g.resetToLastSegment();const _=o.getDescription().getAttributeCount()>1;for(i.geometryReleaseAssert(g.previousPath());g.hasPreviousSegment();){const e=g.previousSegment();if(e.isCurve()){const t=e.clone();if(t.setCoordsForIntersector(e.getStartXY(),m.getXY(),!1),!Hi.isShortSegment(t,a,c,n)){_&&t.setEnd(m);const e=g.getEndPointIndex();for(let t=o.getPointCount()-1;t>=e;t--)o.removePoint(t);return void o.addSegment(t,!1)}}else if(e.queryStart(d),!Hi.isShortSegmentPoints(d,m,a,c,n)){const e=g.getEndPointIndex();for(let t=o.getPointCount()-1;t>=e;t--)o.removePoint(t);return void o.lineToPoint(m)}}o.removePath(o.getPathCount()-1)}multipointIsSimpleAsFeature(){if(!this.checkStructure())return 0;const e=this.m_geometry.getImpl();this.m_multiVertexGeom=e;const t=e.getPointCount(),i=r.makePrimitiveArray(t,0);for(let e=0;e<t;e++)i[e]=e;i.sort(((e,t)=>this.compareVerticesMultiPoint(e,t)));for(let e=1;e<t;e++)if(0===this.compareVerticesMultiPoint(i[e-1],i[e]))return this.m_nonSimpleResult=new u.NonSimpleResult(5,i[e-1],i[e]),0;return 1}polylineIsSimpleAsFeature(){return this.checkStructure()&&this.checkDegenerateSegments(!0)?1:0}polygonIsSimpleAsFeature(){return this.isSimplePlanarImpl()}multipointSimplifyAsFeature(){let e=this.m_geometry.getImpl();const t=Hi.hasNanZs(e);let i,n=this.m_geometry;t&&(i=this.m_geometry.clone(),e=i.getImpl(),i.replaceNaNs(1,s.VertexDescription.getDefaultValue(1)),n=i),this.m_multiVertexGeom=e;const o=e.getPointCount(),a=r.makePrimitiveArray(o,0);for(let e=0;e<o;e++)a[e]=e;a.sort(((e,t)=>this.compareVerticesMultiPoint(e,t)));const l=new Array(o);l.fill(!1);let c=-1;for(let t=0;t<o;t++){const i=a[t];e.getXY(i).isFinite()&&((c<0||0!==this.compareVerticesMultiPoint(c,i))&&(l[i]=!0),c=i)}const h=this.m_geometry.createInstance();let u=0,m=0;for(let e=0;e<o;e++)l[e]?m=e+1:(u<m&&h.addPoints(n,u,m),u=e+1);return u<m&&h.addPoints(n,u,m),h.getImpl().setIsSimple(1,this.m_toleranceSimplify.total()),h}polylineSimplifyAsFeature(){const e=this.m_geometry.getImpl(),t=e.querySegmentIterator(),i=e.querySegmentIterator(),n=this.m_geometry.createInstance(),o=this.m_geometry,a=e.hasAttribute(1),l=a?s.calculateZToleranceFromGeometryForOpFromGeom(this.m_sr,e,!0).total():0,c=[],h=[];let u=null;a&&(u=e.getAttributeStreamRef(1));const m=new s.Point,d=e.hasNonLinearSegments(),p=this.m_toleranceSimplify.total();for(;t.nextPath();){if(i.nextPath(),e.getPathSize(t.getPathIndex())<2)continue;if(d&&e.hasNonLinearSegmentsPath(t.getPathIndex())){this.removeDegenerateSegmentsFromCurvedPath(e,t.getPathIndex(),l,n);continue}i.resetToLastSegment();let s=0,g=0,_=!0,f=!0;for(;t.hasNextSegment();){this.progress_();const n=t.nextSegment(),o=i.previousSegment();if(t.getStartPointIndex()>i.getStartPointIndex())break;if(_){const i=t.getStartPointIndex();e.getXY(i).isNAN()||(_=!1,c.push(i))}if(f){const t=i.getEndPointIndex();e.getXY(t).isNAN()||(h.push(t),f=!1)}if(!_){const i=c.at(-1),o=t.getEndPointIndex();if(o-i>1){const t=new r.Point2D;t.setSub(e.getXY(i),e.getXY(o)),s=t.length()}else s=n.calculateLength2D();if(s>p)c.push(o),s=0;else if(a){let e=u.read(i);Number.isNaN(e)&&(e=0);let t=u.read(o);Number.isNaN(t)&&(t=0),Math.abs(t-e)>l&&(c.push(o),s=0)}}if(!f){const t=h.at(-1),n=i.getStartPointIndex();if(n-t>1){const i=new r.Point2D;i.setSub(e.getXY(t),e.getXY(n)),g=i.length()}else g=o.calculateLength2D();if(g>p)h.push(n),g=0;else if(a){let e=u.read(t);Number.isNaN(e)&&(e=0);let i=u.read(n);Number.isNaN(i)&&(i=0),Math.abs(i-e)>l&&(h.push(n),g=0)}}}if(c.length>0&&h.length>0&&(c.at(-1)<h.at(-1)?c.length>h.length?c.pop():h.pop():(c.at(-1)===h.at(-1)||h.pop(),h.pop())),h.length+c.length>=2){let e=!1;for(let t=0,i=c.length;t<i;t++)o.getPointByVal(c[t],m),e?n.lineToPoint(m):(n.startPathPoint(m),e=!0);for(let t=h.length-1;t>0;t--)o.getPointByVal(h[t],m),e?n.lineToPoint(m):(n.startPathPoint(m),e=!0);o.isClosedPath(t.getPathIndex())?n.closePathWithLine():h.length>0&&(o.getPointByVal(h[0],m),n.lineToPoint(m))}c.length=0,h.length=0}return a&&n.replaceNaNs(1,0),n.getImpl().setIsSimple(1,p),n}polygonSimplifyAsFeature(){return this.simplifyPlanar()}simplifyPlanar(){if(1===this.m_geometry.getFillRule()&&!s.isAtLeastWeakSimple(this.m_knownSimpleResult))return bi(this.m_geometry,this.m_toleranceSimplify,!0,!1,this.m_knownSimpleResult,this.m_progressTracker,0,!0);const e=new n.EditShape;if(e.addGeometry(this.m_geometry),this.m_geometry.hasAttribute(1)&&e.replaceNaNs(1,0),e.removeNaNVertices(),0!==e.getTotalPointCount()){let n=null,r=0,o=0;if(e.hasCurves()){n=new li;const i=t.Envelope2D.constructEmpty();this.m_geometry.queryEnvelope(i);const s=ri(this.m_toleranceSimplify.total(),i);r=oi(this.m_toleranceSimplify.total()),o=ai(s,r),ii(e,s,this.m_toleranceSimplify.total(),0,n,null,this.m_progressTracker)}s.isAtLeastWeakSimple(this.m_knownSimpleResult)||hi(e,this.m_toleranceSimplify.add(o),this.m_progressTracker,!0,!1),this.m_geometry.getGeometryType()===i.GeometryType.enumPolygon&&Ae(e,e.getFirstGeometry(),this.m_knownSimpleResult,!1,-1,this.m_progressTracker),null!==n&&n.stitchCurves(e,e.getFirstGeometry(),r,!0)}const r=e.getGeometry(e.getFirstGeometry());return r.getGeometryType()===i.GeometryType.enumPolygon&&(r.getImpl().updateOGCFlagsProtected(),r.setFillRule(0)),r.getImpl().setIsSimple(4,this.m_toleranceSimplify.total()),r}progress_(){}static hasNanZs(e){if(e.hasAttribute(1)){const t=e.getAttributeStreamRef(1);for(let i=0,n=e.getPointCount();i<n;i++){const e=t.read(i);if(Number.isNaN(e))return!0}}return!1}compareVerticesForPlanarClustering(e,t,i){if(e===t)return 0;const n=this.m_pairs[e],s=this.m_pairs[t],o=n>>1,a=s>>1,l=this.m_xy.readPoint2D(2*o);l.y+=1&n?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;const c=this.m_xy.readPoint2D(2*a);c.y+=1&s?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;const h=l.compare(c);if(0===h&&i){const e=this.m_pathsForOGCTests[o]-this.m_pathsForOGCTests[a];return r.sign(e)}return h}compareVerticesMultiPoint(e,t){if(e===t)return 0;const i=this.m_multiVertexGeom.getXY(e),n=this.m_multiVertexGeom.getXY(t),o=!i.isFinite(),a=!n.isFinite();if(o||a)return o<a?-1:o>a?1:0;if(i.y<n.y)return-1;if(i.y>n.y)return 1;if(i.x<n.x)return-1;if(i.x>n.x)return 1;for(let i=1;i<this.m_attributeCount;i++){const n=this.m_description.getSemantics(i),o=s.VertexDescription.getComponentCount(n);for(let i=0;i<o;i++){const s=this.m_multiVertexGeom.getAttributeAsDbl(n,e,i),o=this.m_multiVertexGeom.getAttributeAsDbl(n,t,i),a=r.compareWithNANs(s,o);if(0!==a)return a}}return 0}edgeAngleCompare(e,t){if(e===t)return 0;const i=e.m_segment.getTangent(e.getReversed()?1:0);e.getReversed()&&i.negateThis();const n=t.m_segment.getTangent(t.getReversed()?1:0);t.getReversed()&&n.negateThis();const s=i.getQuarter(),r=n.getQuarter();if(r===s){const e=i.crossProduct(n);return e<0?1:e>0?-1:0}return s<r?-1:1}}class Ui{getOperatorType(){return 10103}accelerateGeometry(e,t,i){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}isSimpleAsFeature(e,t,i,n,r){const o=Ni(e,t,i,n,r);return s.isAtLeastSimpleAsFeature(e.getGeometryType(),o)}isSimplePlanarDONOTUSE(e,r,o,a,l){const c=function(e,r,o,a,l){if(a&&(a.m_reason=0,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),e.isEmpty())return 5;const c=e.getGeometryType();if(c===i.GeometryType.enumPoint)return Oi(e,a);const h=s.calculateToleranceFromGeometryForOpFromGeom(r,e,!1).total();if(c===i.GeometryType.enumEnvelope){const i=e,n=new t.Envelope2D;return i.queryEnvelope(n),n.isDegenerate(h)?(a&&(a.m_reason=4,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),0):5}if(i.isSegment(c)){const t=e,i=new n.Polyline({vd:t.getDescription()});return i.addSegment(t,!0),Ni(i,r,o,a,l)}const u=e.getImpl().getIsSimple(h,[0]);let m=o?-1:u;if(s.isAtLeastPlanarSimple(m)||0===m)return m;const d=new Hi(e,r,m,l,!1);return c===i.GeometryType.enumMultiPoint||c===i.GeometryType.enumPolyline||c===i.GeometryType.enumPolygon?m=d.isSimplePlanarImpl():i.throwInternalErrorException(""),e.getImpl().setIsSimple(m,h),a&&a.assign(d.m_nonSimpleResult),m}(e,r,o,a,l);return s.isAtLeastPlanarSimple(c)}executeMany(e,t,i,n){return new zi(e,t,i,n)}execute(e,t,n,s){const r=new h.SimpleGeometryCursor([e]),o=this.executeMany(r,t,n,s).next();return o||i.throwInternalErrorException("null geometry"),o}}class zi extends h.GeometryCursor{constructor(e,t,i,n){super(),this.m_progressTracker=n,this.m_bForceSimplify=i,this.m_index=-1,this.m_inputGeometryCursor=e,this.m_spatialReference=t}next(){const e=this.m_inputGeometryCursor.next();return e?(this.m_index=this.m_inputGeometryCursor.getGeometryID(),this.simplify(e)):null}getGeometryID(){return this.m_index}tock(){return!1}getRank(){return 1}simplify(e){if(e||i.throwInvalidArgumentException(""),e.getGeometryType()===i.GeometryType.enumGeometryCollection){const t=n.generateGeometryCursor(e,-1),i=(new Ui).executeMany(t,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker),s=e.createInstance();for(let e=i.next();null!=e;e=i.next())s.addGeometry(e);return s}return Ri(e,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker)}}class Yi{constructor(e,t,n,s){this.m_intersectorGeom=null,this.m_sr=null,this.m_dimensionMask=-1,this.m_progressTracker=null,this.m_intersectorGeomType=i.GeometryType.enumUnknown,this.m_geomIntersectorEmptyGeom=null,this.m_intersectorGeom=e,this.m_sr=t,this.m_dimensionMask=n,this.m_progressTracker=s,this.m_intersectorGeomType=e.getGeometryType()}intersect(e){const o=this.tryFastImplementation(e);if(null!==o)return o;const a=s.getMergedExtent(this.m_intersectorGeom,e),c=s.calculateToleranceFromGeometryForOp(this.m_sr,a,!0).total(),h=t.Envelope2D.constructEmpty();this.m_intersectorGeom.queryEnvelope(h);const u=t.Envelope2D.constructEmpty();e.queryEnvelope(u),h.inflateCoords(2*c,2*c),h.intersect(u),h.inflateCoords(100*c,100*c);let m=l.clip$1(this.m_intersectorGeom,h,0,0,this.m_progressTracker),d=l.clip$1(e,h,0,0,this.m_progressTracker);return e.getDimension()>this.m_intersectorGeom.getDimension()&&(m=r.swap(d,d=m)),function(e,r,o,a){const l=t.Envelope2D.constructEmpty();e.queryEnvelope(l);const c=t.Envelope2D.constructEmpty();r.queryEnvelope(c);const h=t.Envelope2D.constructEmpty();h.setCoords({env2D:l}),h.mergeEnvelope2D(c);const u=s.calculateToleranceFromGeometryForOp(o,h,!0),m=new t.Envelope2D(c),d=s.adjustToleranceForTEClustering(u);if(m.inflateCoords(d,d),!l.isIntersecting(m)){if(e.getDimension()<=r.getDimension())return Di(Ii(e.createInstance()),e,0,"&");if(e.getDimension()>r.getDimension())return Di(Ii(r.createInstance()),e,0,"&")}const p=new Ti(a),g=new n.EditShape,_=g.addGeometry(Ii(e)),f=g.addGeometry(Ii(r));let y=0,x=0,v=null;if(g.hasCurves()){v=new li;const e=g.getEnvelope2D(a);x=oi(u.total());const t=ri(u.total(),e);y=ai(t,x),ii(g,t,u.total(),0,v,null,a)}p.setEditShapeCrackAndCluster(g,u.add(y));const P=p.intersection(_,f);null!==v&&v.stitchCurves(g,P,x,!0);const b=Di(g.getGeometry(P),e,0,"&");return yi(b.getGeometryType())&&(b.getImpl().setIsSimple(4,u.total()),b.getGeometryType()===i.GeometryType.enumPolygon&&b.getImpl().updateOGCFlagsProtected()),b}(d,m,this.m_sr,this.m_progressTracker)}intersectEx(e){const o=this.tryFastImplementation(e);if(null!==o){const t=[];return t.length=3,t[o.getDimension()]=o,this.prepareVector(e.getDescription(),this.m_dimensionMask,t)}const a=s.getMergedExtent(this.m_intersectorGeom,e),c=s.calculateToleranceFromGeometryForOp(this.m_sr,a,!0).total(),h=t.Envelope2D.constructEmpty();this.m_intersectorGeom.queryEnvelope(h);const u=t.Envelope2D.constructEmpty();e.queryEnvelope(u),h.inflateCoords(2*c,2*c),h.intersect(u),h.inflateCoords(100*c,100*c);let m=l.clip$1(this.m_intersectorGeom,h,0,0,this.m_progressTracker),d=l.clip$1(e,h,0,0,this.m_progressTracker);e.getDimension()>this.m_intersectorGeom.getDimension()&&(m=r.swap(d,d=m));const p=function(e,r,o,a){const l=new Array(3),c=t.Envelope2D.constructEmpty();e.queryEnvelope(c);const h=t.Envelope2D.constructEmpty();r.queryEnvelope(h);const u=t.Envelope2D.constructEmpty();u.setCoords({env2D:c}),u.mergeEnvelope2D(h);const m=s.calculateToleranceFromGeometryForOp(o,u,!0),d=new t.Envelope2D(h),p=s.adjustToleranceForTEClustering(m);if(d.inflateCoords(p,p),!c.isIntersecting(d)){if(e.getDimension()<=r.getDimension()){const t=Di(Ii(e.createInstance()),e,0,"&");return l[t.getDimension()]=t,l}if(e.getDimension()>r.getDimension()){const t=Di(Ii(r.createInstance()),e,0,"&");return l[t.getDimension()]=t,l}}const g=new Ti(a),_=new n.EditShape,f=_.addGeometry(Ii(e)),y=_.addGeometry(Ii(r));let x=0,v=0,P=null;if(_.hasCurves()){P=new li;const e=_.getEnvelope2D(a);v=oi(m.total());const t=ri(m.total(),e);x=ai(t,v),ii(_,t,m.total(),0,P,null,a)}g.setEditShapeCrackAndCluster(_,m.add(x)),_.dbgVerifyCurves();const b=g.intersectionEx(f,y);for(const t of b){null!==P&&P.stitchCurves(_,t,v,!1);const n=Di(_.getGeometry(t),e,0,"&");yi(n.getGeometryType())&&(n.getImpl().setIsSimple(4,m.total()),n.getGeometryType()===i.GeometryType.enumPolygon&&n.getImpl().updateOGCFlagsProtected()),l[n.getDimension()]=n}return null!==P&&P.clearStitcher(_),l}(d,m,this.m_sr,this.m_progressTracker);return this.prepareVector(e.getDescription(),this.m_dimensionMask,p)}init(e,t,n,s=null){i.geometryReleaseAssert(0)}static intersectPoints(e,t,i){const n=s.getMergedExtent(e,t);return o=e,a=t,l=s.calculateToleranceFromGeometryForOp(i,n,!0),o.isEmpty()||a.isEmpty()?o.createInstance():function(e,t,i){const n=s.adjustToleranceForTEClustering(e);return J(t.getX(),t.getY(),i.getX(),i.getY(),r.sqr(n))}(l,o,a)?new s.Point({copy:ui(o,a)}):o.createInstance();var o,a,l}tryFastImplementation(e){const r=e.getGeometryType();if(this.m_intersectorGeomType===i.GeometryType.enumPoint&&r===i.GeometryType.enumPoint){const t=Yi.intersectPoints(e,this.m_intersectorGeom,this.m_sr);if(-1!==this.m_dimensionMask){const e=new n.MultiPoint({vd:t.getDescription()});return t.isEmpty()||e.add(t),e}return t}if(r===i.GeometryType.enumEnvelope&&this.m_intersectorGeomType===i.GeometryType.enumEnvelope&&(-1===this.m_dimensionMask||4===this.m_dimensionMask)){const t=e,i=this.m_intersectorGeom,n=new s.Envelope({copy:t});return n.intersect(i),n}const o=s.getMergedExtent(e,this.m_intersectorGeom),a=s.calculateToleranceFromGeometryForOp(this.m_sr,o,!0),c=e.isEmpty(),h=this.m_intersectorGeom.isEmpty();let u=c||h;if(!u){const n=function(e,n,s){const r=new t.Envelope2D;e.queryEnvelope(r);const o=new t.Envelope2D;n.queryEnvelope(o);const a=new t.Envelope2D(o);if(a.inflate(2*s),!a.isIntersecting(r))return 4;const l=e.getGeometryType(),c=n.getGeometryType();if(l===i.GeometryType.enumEnvelope&&r.containsEnvelope(a))return 1;if(c===i.GeometryType.enumEnvelope){const e=new t.Envelope2D(r);if(e.inflate(2*s),o.containsEnvelope(e))return 2}return 0}(this.m_intersectorGeom,e,a.total());if(4===n)u=!0;else{if(2&n)return this.m_intersectorGeom;if(1&n)return e}}if(u){const t=i.getDimensionFromType(r),n=i.getDimensionFromType(this.m_intersectorGeomType);return t<n?Yi.ReturnEmpty(e,c):t>n||0===t&&r===i.GeometryType.enumMultiPoint&&this.m_intersectorGeomType===i.GeometryType.enumPoint?this.ReturnEmptyIntersector():Yi.ReturnEmpty(e,c)}if(r===i.GeometryType.enumEnvelope&&0===i.getDimensionFromType(this.m_intersectorGeomType)||this.m_intersectorGeomType===i.GeometryType.enumEnvelope&&0===i.getDimensionFromType(r)){const n=r===i.GeometryType.enumEnvelope?e:this.m_intersectorGeom,s=r===i.GeometryType.enumEnvelope?this.m_intersectorGeom:e,o=t.Envelope2D.constructEmpty();return n.queryEnvelope(o),l.clip$1(s,o,a.total(),0,this.m_progressTracker)}if(0===i.getDimensionFromType(r)&&i.getDimensionFromType(this.m_intersectorGeomType)>0||i.getDimensionFromType(r)>0&&0===i.getDimensionFromType(this.m_intersectorGeomType)){if(r===i.GeometryType.enumMultiPoint)return Ei(e,this.m_intersectorGeom,a);if(r===i.GeometryType.enumPoint)return Si(e,this.m_intersectorGeom,a);if(this.m_intersectorGeomType===i.GeometryType.enumMultiPoint)return Ei(this.m_intersectorGeom,e,a);if(this.m_intersectorGeomType===i.GeometryType.enumPoint)return Si(this.m_intersectorGeom,e,a);i.throwInternalErrorException("")}return null}ReturnEmptyIntersector(){return null===this.m_geomIntersectorEmptyGeom&&(this.m_geomIntersectorEmptyGeom=this.m_intersectorGeom.createInstance()),this.m_geomIntersectorEmptyGeom}static ReturnEmpty(e,t){return t?e:e.createInstance()}prepareVector(e,t,i){let s=0;return 1&t?(i[0]||(i[0]=new n.MultiPoint({vd:e})),s++):i.shift(),2&t?(i[s]||(i[s]=new n.Polyline({vd:e})),s++):i.splice(s,1),4&t?i[s]||(i[s]=new n.Polygon({vd:e})):i.splice(s,1),new h.SimpleGeometryCursor(i)}}class Bi extends h.GeometryCursor{constructor(e,t,n,s,r){super(),this.m_smallCursor=null,this.m_progressTracker=s,this.m_geomIntersector=t.next(),this.m_intersector=new Yi(this.m_geomIntersector,n,r,s),this.m_index=-1,this.m_inputGeoms=e,this.m_dimensionMask=r,-1!==this.m_dimensionMask&&(this.m_dimensionMask<=0||this.m_dimensionMask>7)&&i.throwInvalidArgumentException("bad dimension mask")}next(){if(!this.m_geomIntersector)return null;let e;if(null!==this.m_smallCursor){if(e=this.m_smallCursor.next(),e)return e;this.m_smallCursor=null}for(;e=this.m_inputGeoms.next();)return i.throwIfMesh(e),this.m_index=this.m_inputGeoms.getGeometryID(),-1===this.m_dimensionMask?this.m_intersector.intersect(e):(this.m_smallCursor=this.m_intersector.intersectEx(e),this.m_smallCursor.next());return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class Xi{getOperatorType(){return 1e4}accelerateGeometry(e,t,r){if(!this.canAccelerateGeometry(e))return!1;s.calculateToleranceFromGeometryForOpFromGeom(t,e,!0);let o=0;return e.getGeometryType()!==i.GeometryType.enumPolygon&&e.getGeometryType()!==i.GeometryType.enumPolyline||!n.canUseQuadTree(e)||0===r||(o|=e.getImpl().buildQuadTreeAccelerator(r)?1:0),!!o}canAccelerateGeometry(e){return n.canUseQuadTree(e)}supportsCurves(){return!0}executeMany(e,t,i,n,s=-1){return new Bi(e,t,i,n,s)}execute(e,t,n,s){if(e.getGeometryType()===i.GeometryType.enumPoint&&t.getGeometryType()===i.GeometryType.enumPoint)return Yi.intersectPoints(e,t,n);const r=new h.SimpleGeometryCursor([e]),o=new h.SimpleGeometryCursor([t]),a=this.executeMany(r,o,n,s,-1).next();return a||i.throwInternalErrorException("null output"),a}}function ji(e,t,i){return t.m_projector.project(e,i)}function Wi(e,t,i,n,s){return e.m_projector.transformInPlaceZ(t,null,i,n,null,s)}function Zi(e,r,o,a){if(e&&r&&r.isPannable()||i.throwInvalidArgumentException("fold_into_360_range_geodetic"),e.isEmpty())return e;if(4===o)return Qi(e,r,a);let l=e;const c=l.getGeometryType();if(i.isMultiPath(c)){l=ds(e,r);const i=new t.Envelope2D;l.queryEnvelope(i);const n=s.calculateToleranceFromGeometryForOp(r,i,!1).total(),a=r.getPannableExtent();let c=Math.floor((i.xmin-a.xmin)/a.width())*a.width()+a.xmin,h=l;for(;c<i.xmax;)c>i.xmin+n&&c<i.xmax-n&&(h=us(h,r,o,!0,c)),c+=a.width();l=h}else{if(c===i.GeometryType.enumEnvelope){const e=new n.Polygon({vd:l.getDescription()});return e.addEnvelope(l,!1),Zi(e,r,o,a)}if(i.isSegment(c)){const e=new n.Polyline({vd:l.getDescription()});return e.addSegment(l,!0),Zi(e,r,o,a)}}return Qi(l,r,a)}function Qi(e,t,s){if(e&&t&&t.isPannable()||i.throwInvalidArgumentException(""),e.isEmpty())return e;let r;const o=e.getGeometryType();if(o===i.GeometryType.enumEnvelope){const t=new n.Polygon({vd:e.getDescription()});t.addEnvelope(e,!1),r=t}else if(i.isSegment(o)){const t=new n.Polyline({vd:e.getDescription()});t.addSegment(e,!0),r=t}else r=e;const a=ds(r,t);return a.isEmpty()?a:os(a,t,0,a!==e,0,s)}function $i(e,t,i,n){const o=t.getXYGridRange(),a=e.hasAttribute(1),c=e.hasAttribute(2);let h=new r.Envelope1D,u=new r.Envelope1D;a&&(h=t.getZGridRange()),c&&(u=t.getMGridRange());let m=(new l.OperatorClip).execute(e,o,i,n);if(a){const t=m.queryInterval(1,0);h.contains(t)||(e===m&&(m=m.clone()),s.snapCoordinate(m,h,1,0))}if(c){const t=m.queryInterval(2,0);u.contains(t)||(e===m&&(m=m.clone()),s.snapCoordinate(m,u,2,0))}return m}class Ki{constructor(e){this.m_inputPCSHorizonClipOption=0,this.m_outputPCSHorizonClipOption=0,this.m_bDontGeonormalizePolygon=!1,this.m_bClipOutCurvedPoles=!1,this.m_bNormalizeOutputGeometry=!1,this.m_bDontHackPolesInGeogToGeog=!1,this.m_centralMeridianOfOutputGCS=0,this.m_densificationStepInput=0,e||i.throwInvalidArgumentException(""),this.m_projTransform=e,this.m_bClipOutCurvedPoles=!1;const t=this.m_projTransform.getExtendedParamsImpl();this.m_bNormalizeOutputGeometry=t.normalizeResultGeometry,this.m_bNormalizeOutputGeometry&&(t.legacyHorizonClipping?this.m_bNormalizeOutputGeometry=!1:this.m_projTransform.getOutputSR().isPannable()||(this.m_bNormalizeOutputGeometry=!1)),t.clipWithInputHorizon?(this.m_inputPCSHorizonClipOption=0,!t.legacyHorizonClipping&&this.m_projTransform.getInputSR().isPannable()&&(this.m_inputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_inputPCSHorizonClipOption=1,t.clipWithOutputHorizon?(this.m_outputPCSHorizonClipOption=0,!t.legacyHorizonClipping&&this.m_projTransform.getOutputSR().isPannable()&&(this.m_outputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_outputPCSHorizonClipOption=1,this.m_centralMeridianOfOutputGCS=t.centralMeridianOfOutputGCS,this.m_densificationStepInput=t.densificationStep;const n=this.m_projTransform.getExtendedParamsInternal();this.m_bDontGeonormalizePolygon=n.hasFlag(2147483648),this.m_bDontHackPolesInGeogToGeog=n.hasFlag(1073741824),this.m_bClipOutCurvedPoles=n.hasFlag(536870912)}project(e,t){if(this.m_projTransform.isIdentity()||e.isEmpty())return e;const n=e.getGeometryType();if(n===i.GeometryType.enumPoint)return this.projectPoint(e,t);const s=this.m_projTransform.getInputSR().getCoordinateSystemType(),r=this.m_projTransform.getOutputSR().getCoordinateSystemType(),o=this.m_projTransform.getInputSR(),a=this.m_projTransform.getOutputSR();if(0===s&&s===r){const t=en(o,a),i=e.clone();return i.applyTransformation(t),i}switch(n){case i.GeometryType.enumPolyline:case i.GeometryType.enumPolygon:return this.projectMultiPath(e,t);case i.GeometryType.enumMultiPoint:return this.projectMultiPoint(e,t);case i.GeometryType.enumEnvelope:return this.projectEnvelope(e,t);case i.GeometryType.enumGeometryCollection:return this.projectGeometryCollection(e,t);default:i.throwInternalErrorException("")}}projectPoint(e,t){const i=[e.getXY()];let n,s=null;(n=e.hasAttribute(1))&&(s=[e.getZ()]),this.transformInPlaceZ(i,s,1,i,s,null);const r=e.clone();return r.setXY(i[0]),n&&r.setZ(s[0]),r}projectMultiPoint(e,t){let s=new n.MultiPoint({copy:e});const r=this.m_projTransform.getInputSR(),o=this.m_projTransform.getOutputSR(),a=r.getCoordinateSystemType(),l=o.getCoordinateSystemType();if(3===a&&i.geometryReleaseAssert(0),s=xs(s,r,this.m_inputPCSHorizonClipOption,t),s.isEmpty())return s;2===a&&Ss(r,0,s),As(this.m_projTransform,s,!1);let c=0;3===l&&i.geometryReleaseAssert(0);const h=2===l;return h?c=o.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(c=this.m_centralMeridianOfOutputGCS),h&&0!==this.m_outputPCSHorizonClipOption||(s=os(s,Or(o),c,!1,0,t)),h&&(s=is(s,o,this.m_outputPCSHorizonClipOption,t),Ps(o,s,this.m_bNormalizeOutputGeometry),s.isEmpty()),s}projectMultiPath(e,t){const n=e.getGeometryType();return n===i.GeometryType.enumPolygon?this.projectPolygon(e,t):n===i.GeometryType.enumPolyline?this.projectPolyline(e,t):void i.throwInternalErrorException("project_multi_path_")}projectEnvelope(e,t){this.m_projTransform.getInputSR(),this.m_projTransform.getOutputSR();const i=this.m_projTransform.isVertical()&&e.hasAttribute(1);let n=r.Envelope1D.constructEmpty();if(i&&(n=e.queryInterval(1,0)),n.width()>0){const i=e.clone();i.setInterval(1,0,n.vmin,n.vmin);const s=this.projectEnvelopeHelper(i,t);i.setInterval(1,0,n.vmax,n.vmax);const r=this.projectEnvelopeHelper(i,t);return s.merge(r),s}return this.projectEnvelopeHelper(e,t)}projectPolygon(e,s){i.geometryReleaseAssert(e.getGeometryType()===i.GeometryType.enumPolygon),i.geometryReleaseAssert(!this.m_projTransform.isIdentity()),i.geometryReleaseAssert(!e.isEmpty());const r=this.m_projTransform.getInputSR(),o=this.m_projTransform.getOutputSR(),a=r.getCoordinateSystemType(),h=o.getCoordinateSystemType(),u=new n.Polygon({copy:e});3===a&&i.geometryReleaseAssert(0),3===h&&i.geometryReleaseAssert(0);const m=2===a,d=2===h,p=m?r.getGCS():r,g=d?o.getGCS():o,_=!d&&!this.m_bDontHackPolesInGeogToGeog;let f=!1,y=xs(u,r,this.m_inputPCSHorizonClipOption,s);if(y.isEmpty())return y;let x=this.m_densificationStepInput;const v=!Number.isNaN(x);let P;v&&(y=(new c.OperatorDensify).execute(y,x,0,0,s));let b=d?o.getPCSInfo():null,E=Number.NaN;m&&(E=r.getCentralMeridian());const S=null!==o.getGCSSplitLines();if(this.m_bDontGeonormalizePolygon){const e=y;if(m&&(Ts(r,E,e),v)){const e=r.getUnitsPerMillimeter();x*=r.getGCS().getUnitsPerMillimeter()/e}if(Ns(this.m_projTransform,e,_),v){const e=r.getGCS().getUnitsPerMillimeter();x*=o.getGCS().getUnitsPerMillimeter()/e}P=e}else{let e=new n.Polyline({vd:y.getDescription()});if(e.addAndExplicitlyOpenAllPaths(y,!1),m){if(Ts(r,E,e),v){const e=r.getUnitsPerMillimeter();x*=r.getGCS().getUnitsPerMillimeter()/e}if(this.m_bClipOutCurvedPoles){const i=r.getPCSInfo(),n=i.getSouthPoleGeometry()===ao.PE_POLE_LINE_CURVED,o=i.getNorthPoleGeometry()===ao.PE_POLE_LINE_CURVED;if(n||o){const i=t.Envelope2D.constructEmpty();e.queryLooseEnvelope(i),i.inflateCoords(1,1);const r=89.9999*p.getOneDegreeGCSUnit();n&&(i.ymin=-r),o&&(i.ymax=r),e=l.clipPolesOut(e,i,p,0,0,s)}}}if(Ns(this.m_projTransform,e,_),v){const e=Or(r).getUnitsPerMillimeter();x*=Or(o).getUnitsPerMillimeter()/e}let i=Number.NaN;d?(b=o.getPCSInfo(),i=o.getCentralMeridian()):Number.isNaN(this.m_centralMeridianOfOutputGCS)||(i=this.m_centralMeridianOfOutputGCS);let a=Ji(r)|Ji(o),c=10*g.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(a=3,c=10*g.getTolerance(0)),P=function(e,t,i,n,s,r,o,a,l){return new Rn(e,null,i,t,n,s,o,a,r).geoNormalizePolygonGeometry(l)}(y,r,e,g,i,s,a,c,this.m_bNormalizeOutputGeometry),a=0}if(S&&(i.geometryReleaseAssert(!o.isPannable()),P=Jn(P,o,s)),d){if(!f){const e=g.getPannableExtent().width();if(P.queryInterval(0,0).width()>=e-10*g.getTolerance(0)){const e=b.getNorthPoleLocation(),t=b.getSouthPoleLocation(),i=b.getNorthPoleGeometry(),n=b.getSouthPoleGeometry();let s=0;i===ao.PE_POLE_POINT&&e!==ao.PE_POLE_OUTSIDE_BOUNDARY&&(s=1),n===ao.PE_POLE_POINT&&t!==ao.PE_POLE_OUTSIDE_BOUNDARY&&(s|=2),f||=0!==s}}P=is(P,o,this.m_outputPCSHorizonClipOption,s),v&&(P=(new c.OperatorDensify).execute(P,x,0,0,s)),Es(o,P,this.m_bNormalizeOutputGeometry)}return P.isEmpty()||f&&(P=(new Ui).execute(P,o,!1,s)),P}projectPolyline(e,t){i.geometryReleaseAssert(e.getGeometryType()===i.GeometryType.enumPolyline),i.geometryReleaseAssert(!this.m_projTransform.isIdentity()),i.geometryReleaseAssert(!e.isEmpty());const s=this.m_projTransform.getInputSR(),r=this.m_projTransform.getOutputSR(),o=s.getCoordinateSystemType(),a=r.getCoordinateSystemType(),l=new n.Polyline({copy:e});3===o&&i.geometryReleaseAssert(0),3===a&&i.geometryReleaseAssert(0);const h=2===o,u=2===a;h&&s.getGCS();const m=u?r.getGCS():r,d=!u&&!this.m_bDontHackPolesInGeogToGeog;let p=xs(l,s,this.m_inputPCSHorizonClipOption,t);if(p.isEmpty())return p;let g=Number.NaN;h&&(g=s.getCentralMeridian());const _=null!==r.getGCSSplitLines();let f=this.m_densificationStepInput;const y=!Number.isNaN(f);let x;if(y&&(p=(new c.OperatorDensify).execute(p,f,0,0,t)),this.m_bDontGeonormalizePolygon){if(h&&(Ts(s,g,p),y)){const e=s.getUnitsPerMillimeter();f*=s.getGCS().getUnitsPerMillimeter()/e}if(Ns(this.m_projTransform,p,d),y){const e=s.getGCS().getUnitsPerMillimeter();f*=r.getGCS().getUnitsPerMillimeter()/e}x=p}else{const e=new n.Polyline({vd:p.getDescription()});if(e.addAndExplicitlyOpenAllPaths(p,!1),h&&(Ts(s,g,e),y)){const e=s.getUnitsPerMillimeter();f*=s.getGCS().getUnitsPerMillimeter()/e}if(Ns(this.m_projTransform,e,d),y){const e=s.getGCS().getUnitsPerMillimeter();f*=r.getGCS().getUnitsPerMillimeter()/e}let i=Number.NaN;u?i=r.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(i=this.m_centralMeridianOfOutputGCS);let o=Ji(s)|Ji(r),a=10*m.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(o=3,a=0),x=function(e,t,i,n,s,r,o,a,l){return new Rn(e,null,i,t,n,s,o,a,r).geoNormalizePolylineGeometry(l)}(p,s,e,m,i,t,o,a,this.m_bNormalizeOutputGeometry),o=0}return _&&(i.geometryReleaseAssert(!r.isPannable()),x=Jn(x,r,t)),u&&(x=is(x,r,this.m_outputPCSHorizonClipOption,t),y&&(x=(new c.OperatorDensify).execute(x,f,0,0,t)),Es(r,x,this.m_bNormalizeOutputGeometry)),x.isEmpty(),x}projectGeometryCollection(e,t){return i.geometryReleaseAssert(0),{}}projectEnvelopeHelper(e,i){const r=(e.height()+e.width())/400;if(0!==r){const o=(new c.OperatorDensify).execute(e,r,0,0,i),a=this.projectMultiPath(o,i),l=new s.Envelope({vd:e.getDescription()});if(a.isEmpty()){const r=Math.min(e.height(),e.width()),a=s.calculateToleranceFromGeometryForOpFromGeom(this.m_projTransform.getInputSR(),e,!0).total();if(r>100*a){const e=t.Envelope2D.constructEmpty(),i=s.calculateToleranceFromGeometryForOp(this.m_projTransform.getOutputSR(),e,!0).total(),n=this.m_projTransform.getInputSR().getOneMeter()/this.m_projTransform.getOutputSR().getOneMeter();if(r>100*Math.max(a,i*n))return l}const c=new n.Polyline;c.addAndExplicitlyOpenAllPaths(o,!1),this.projectMultiPath(c,i).queryEnvelope(l);const h=new n.MultiPoint({vd:e.getDescription()});h.reserve(4);const u=new s.Point;for(let t=0;t<4;t++)e.queryCornerByVal(t,u),h.add(u);const m=this.projectMultiPoint(h,i),d=new s.Envelope;return m.queryEnvelope(d),l.merge(d),l}return a.queryEnvelope(l),l}{const t=e.getCenterXY(),n=new s.Point(t),r=this.projectPoint(n,i),o=new s.Envelope({vd:e.getDescription()});if(r.isEmpty())o.setEmpty();else{e.copyTo(o);const t=r.getXY();o.setCoords(t.x,t.y,t.x,t.y)}return o}}transformInPlace(e,t,n,s){return i.geometryReleaseAssert(0),0}transformInPlaceZ(e,t,n,s,o,a){if(this.m_projTransform.isIdentity())return e!==s&&r.assignObjectArray(s,e,n),t!==o&&r.memcpy(o,t,0,0,n),n;const l=this.m_projTransform,c=l.getInputSR(),h=l.getOutputSR(),u=c.getCoordinateSystemType(),m=h.getCoordinateSystemType();if(0===u&&u===m)return en(c,h).transformPoints2D(e,n,s),l.isVertical()&&i.geometryReleaseAssert(0),n;3===u&&i.throwNotImplementedException("image: transform_in_place_"),3===m&&i.throwNotImplementedException("image: transform_in_place_"),function(e,t,n,s,o){const a=s.getCoordinateSystemType();if(2===a){if(0===o)n!==e&&r.assignObjectArray(n,e,t),function(e,t,n){const s=e.getPCSHorizon();if(s.getGeometryType()!==i.GeometryType.enumPolygon)if(s.getGeometryType()!==i.GeometryType.enumEnvelope)i.throwInvalidArgumentException("");else{const e=s;for(let i=0;i<n;i++)e.contains(t[i])||t[i].setNAN()}else{const i=e.getDefaultPrecisionSR().getTolerance(0),r=s;for(let e=0;e<n;e++)1!==Qt(r,t[e],i)&&t[e].setNAN()}}(s,n,t);else if(n!==e&&r.assignObjectArray(n,e,t),s.isPannable()){const e=s.getTolerance(0);!function(e,t,i,n){for(let s=0;s<t;s++){if(e[s].y<i.ymin||e[s].y>i.ymax){e[s].setNAN();continue}const t=e[s].x;e[s].x=cs(t,i,n)}}(n,t,s.getPannableExtent(),e),as(n,t,s,0)}}else{i.geometryReleaseAssert(1===a);const r=s.getTolerance(0),o=s.getPannableExtent();for(let i=0;i<t;i++)n[i].assign(ys(e[i],o,r))}}(e,n,s,c,this.m_inputPCSHorizonClipOption),o!==t&&r.memcpy(o,t,0,0,n),2===u&&Ds(c,0,s,n),ks(this.m_projTransform,s,o,n,!1);let d=0;const p=2===m;if(p?d=h.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(d=this.m_centralMeridianOfOutputGCS),p&&0!==this.m_outputPCSHorizonClipOption||as(s,n,h.getGCS(),d),p){if(!rs(s,n,h,this.m_outputPCSHorizonClipOption))for(let e=0;e<n;++e)s[e].setNAN();vs(h,s,n,!1)}let g=n;for(let e=0;e<n;++e)s[e].isNAN()&&(o&&(o[e]=Number.NaN),g--);return g}}function Ji(e){if(2!==e.getCoordinateSystemType())return 0;let t=0;const i=e.getPCSInfo(),n=i.getNorthPoleLocation(),s=i.getSouthPoleLocation(),r=i.getNorthPoleGeometry(),o=i.getSouthPoleGeometry();return r===ao.PE_POLE_POINT&&n!==ao.PE_POLE_OUTSIDE_BOUNDARY&&(t=1),o===ao.PE_POLE_POINT&&s!==ao.PE_POLE_OUTSIDE_BOUNDARY&&(t|=2),t}function en(e,t){const i=e.getHorzUnitFactor(),n=t.getHorzUnitFactor();let s=1,r=1;const o=20015077/180;1===e.getUnit().getUnitType()&&(s=o),1===t.getUnit().getUnitType()&&(r=o);const l=i/n*(s!==r?s/r:1),c=new a.Transformation2D;return c.setScaleCoords(l,l),c}let tn=class{getOperatorType(){return 10300}supportsCurves(){return!0}accelerateGeometry(e,t,i){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,i){return!t||t.isIdentity()?e:new nn(e,t,i)}execute(e,t,i){return t.isIdentity()?e:ji(e,t,i)}transform(e,t,i,n,s=!0){return s?function(e,t,i,n){e.m_projector.transformInPlaceZ(t,null,i,n,null,null);const s=n.slice(0,i).filter((e=>!e.isNAN()));for(let e=0,t=s.length;e<t;++e)n[e].assign(s[e]);return s.length}(e,t,i,n):Wi(e,t,i,n,null)}transform3D(e,t,n,s,r=!0){return i.geometryReleaseAssert(0),0}foldInto360Range(e,t){return Qi(e,t,null)}foldInto360RangeGeodetic(e,t,i){return Zi(e,t,i,null)}normalizeGeometryEx(e,t,o,l,c=0){return function(e,t,o,l,c){if(!t.isPannable()||e.isEmpty())return e;const h=e.getGeometryType();h===i.GeometryType.enumGeometryCollection&&i.throwNotImplementedException("not yet impl for geometry collection");const u=t.getPannableExtent();Number.isNaN(o)&&(o=u.getCenterX());const m=u.width(),d=.5*m,p=c>0,g=e.queryInterval(0,0);if(!p&&g.width()<d||!i.isMultiVertex(e.getGeometryType())){const t=g.getCenter();if(Math.abs(t-o)<=d)return e;{const i=new a.Transformation2D,n=o-t,s=r.round(n/m)*m;i.setShiftCoords(s,0);const l=e.clone();return l.applyTransformation(i),l}}if(h===i.GeometryType.enumPolygon){let i=new n.Polyline({vd:e.getDescription()});i.addAndExplicitlyOpenAllPaths(e,!1),p&&(i=sn(i,t,2,c,Number.NaN,null,!0));const a=[];if(!l){{let o=e;p&&(o=new n.Polygon,o.add(i,!1));const l=function(e,t,i){const n=Er();t.querySpheroidData(n);const o=t.getGCS()!==t?t.getSRToGCSTransform():null,a=r.makeObjectArray(r.Point2D,100),l=new s.Point3D(0,0,0),c=e.getPointCount(),h=t.getGCS().getUnit().getUnitToBaseFactor();for(let t=0,i=c;t<i;){const s=Math.min(100,i-t);e.queryCoordinates(a,s,t,t+s),o&&(new tn).transform(o,a,s,a,!1);for(let e=0;e<s;e++){if(a[e].isNAN())continue;a[e].scale(h);const t=P(n.majorSemiAxis,n.e2,a[e]);l.addThis(t)}t+=s}const u=S(n.majorSemiAxis,n.e2,l);u.scale(1/h);const m=e;if(!new Tn(t.getGCS(),u).project(m))return 0;i.length=e.getPathCount();const d=m.calculateArea2D()<0;for(let t=0,n=e.getPathCount();t<n;t++){const e=m.calculateRingArea2D(t),n=d?e<0:e>0;i[t]=n}return d?-1:1}(e,t,a);if(l)l<0&&i.reverseAllPaths();else{const e=o.getPathCount();for(let t=0;t<e;t++)a.push(o.calculateRingArea2D(t)>0)}}l=a}return new Rn(null,l,i,null,t,o,3,0,null).geoNormalizePolygonGeometry(!0)}if(h===i.GeometryType.enumPolyline){let i=new n.Polyline({vd:e.getDescription()});return i.addAndExplicitlyOpenAllPaths(e,!1),p&&(i=sn(i,t,2,c,Number.NaN,null,!0)),new Rn(null,null,i,null,t,o,3,0,null).geoNormalizePolylineGeometry(!0)}if(h===i.GeometryType.enumMultiPoint){const t=e,i=t.getAttributeStreamRef(0);let n,s=null,a=o,l=0;const c=.1*m;for(let o=0,h=t.getPointCount();o<h;o++){const t=i.read(2*o);let h=t-a;if(Math.abs(h)>d&&(h=r.round(h/m)*m,l-=h,Math.abs(l)<c&&(l=0)),0!==l){s||(n=e.clone(),s=n.getAttributeStreamRef(0));const i=t+l;s.write(2*o,i)}a=t}return s?(n.notifyModified(),n):e}i.throwInternalErrorException("")}(e,t,o,l,c)}normalizeGeometry(e,t,n){return function(e,t,n){if(!t.isPannable()||e.isEmpty())return e;const s=t.getPannableExtent().width(),o=.5*s,l=e.queryInterval(0,0);if(l.width()<o||!i.isMultiVertex(e.getGeometryType())){if(Number.isNaN(n))return e;const t=l.getCenter();if(Math.abs(t-n)<=o)return e;{const i=new a.Transformation2D,o=n-t,l=r.round(o/s)*s;i.setShiftCoords(l,0);const c=e.clone();return c.applyTransformation(i),c}}const c=e.getGeometryType(),h=e,u=h.getAttributeStreamRef(0),m=e.clone(),d=m.getAttributeStreamRef(0);let p=0,g=0,_=0,f=i.isMultiPath(c)?0:-1;const y=r.Envelope1D.constructEmpty();let x=!1;for(let e=0,t=h.getPointCount();e<t;e++){const t=u.read(2*e);e===g&&(i.isMultiPath(c)?(0===f&&Number.isNaN(n)&&(x=!0),f>0&&Number.isNaN(n)&&(n=y.getCenter(),x=!1),g=h.getPathEnd(f),f++):g=h.getPointCount(),Number.isNaN(n)?_=t:(_=n,p=0));let a=t-_;Math.abs(a)>o&&(a=r.round(a/s)*s,p-=a,Math.abs(p)<.1*s&&(p=0));const l=t+p;d.write(2*e,l),x&&y.mergeCoordinate(l),_=t}return m.notifyModified(),m}(e,t,n)}clipToSpatialReference(e,n,s,r=0){return function(e,n,s,r){const o=n.getCoordinateSystemType();if(0===o){const t=new Xr;return n.queryPrecisionDescriptor(t),$i(e,t,n,s)}let a=e;2!==r&&3!==r||!n.isPannable()||(a=Qi(a,n,s));const c=new Xr;if(n.queryPrecisionDescriptor(c),a=$i(a,c,n,s),0===r||a.isEmpty())return a;if(1===o){if(1===r){const e=new t.Envelope2D;a.queryLooseEnvelope(e);const i=n.getPannableExtent(),r=.01*i.width();return i.xmin=e.xmin-r,i.xmax=e.xmax+r,(new l.OperatorClip).execute(a,i,n,s)}return a}if(2===o){const e=n.getPCSHorizon();if(1===r||2===r){const t=(new Xi).execute(a,e,n,s);return t===e?t.clone():t}return a}if(3===o)return a;i.throwInternalErrorException("missing implementation")}(e,n,s,r)}};class nn extends h.GeometryCursor{constructor(e,t,n){super(),this.m_projTrans=t,this.m_progressTracker=n,this.m_index=-1,e||i.throwInvalidArgumentException(""),this.m_inputGeoms=e}next(){const e=this.m_inputGeoms.next();return null!=e?(i.throwIfCurves(e),i.throwIfMesh(e),this.m_index=this.m_inputGeoms.getGeometryID(),ji(e,this.m_projTrans,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}function sn(e,t,s,r,o,a,l=!1){e||i.throwInvalidArgumentException("Geometry.Geodetic_densify.densify");let c=e.getGeometryType();if(i.throwIfMesh(e),e.isEmpty()||i.isPoint(c))return e;const h=new cn;h.m_sr=t,h.m_gcs=t.getGCS(),h.m_transform=h.m_gcs!==t?t.getSRToGCSTransform():null,h.m_progressTracker=a;const u=Er();let m,d,p;if(h.m_gcs.querySpheroidData(u),h.m_a=u.majorSemiAxis,h.m_eSquared=u.e2,h.m_rpu=h.m_gcs.getUnit().getUnitToBaseFactor(),h.m_gcsTolerance=h.m_gcs.getTolerance(0),h.m_radTolerance=h.m_gcsTolerance*h.m_rpu,h.m_maxLength=r,h.m_maxDeviation=o,h.m_curveType=s,c===i.GeometryType.enumEnvelope){const t=new n.Polygon({vd:e.getDescription()});t.addEnvelope(e,!1),m=t,c=i.GeometryType.enumPolygon}else if(i.isSegment(c)){const t=new n.Polyline({vd:e.getDescription()});t.addSegment(e,!0),m=t,c=i.GeometryType.enumPolyline}else m=e;if(4!==h.m_curveType){if(i.geometryReleaseAssert(i.isMultiPath(c)),d=h.replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(m),d.isEmpty())return d;d=rn(h.m_rpu,d);let e=h.geodeticDensify(d);l||(e=(new tn).foldInto360RangeGeodetic(e,h.m_gcs,h.m_curveType)),p=h.m_transform&&!h.m_transform.isIdentity()?(new tn).execute(e,h.m_transform.getInverse(),a):e}else{let e;if(i.geometryReleaseAssert(i.isMultiPath(c)),t.isPannable())e=ds(m,t);else{const i=t.getPCSHorizon();e=(new Xi).execute(m,i,t,a),e===i&&(e=i.clone())}if(d=e,d.isEmpty())return d;p=h.shapePreservingDensify(d)}return p}function rn(e,i){const n=new t.Envelope2D;if(i.queryLooseEnvelope(n),n.width()*e<Math.PI)return i;let o=!1;const a=i.querySegmentIterator(),l=new r.Point2D,c=new r.Point2D;for(;a.nextPath();)for(;a.hasNextSegment();){const t=a.nextSegment();if(l.setCoordsPoint2D(t.getStartXY()),c.setCoordsPoint2D(t.getEndXY()),l.scale(e),c.scale(e),Math.abs(l.x-c.x)>Math.PI){if(!on(l,c)){o=!0;break}if(Math.abs(l.x-c.x)>2*Math.PI){o=!0;break}}}if(!o)return i;const h=i.createInstance();h.reserve(i.getPointCount());const u=i.getDescription().getAttributeCount()>1,m=new r.Point2D,d=new r.Point2D,p=new r.Point2D(0,0),g=new r.Point2D(0,0),_=new s.Point;for(a.resetToFirstPath();a.nextPath();){let t=Number.NaN,i=0;for(;a.hasNextSegment();){const n=a.nextSegment();if(l.setCoordsPoint2D(n.getStartXY()),c.setCoordsPoint2D(n.getEndXY()),l.scale(e),c.scale(e),Number.isNaN(t)?(i=vn(l.x,Number.NaN,i),p.setCoordsPoint2D(l)):p.setCoordsPoint2D(g),t=p.x,on(l,c)){if(c.x-l.x>2*Math.PI)for(;c.x-l.x>2*Math.PI;)c.x-=2*Math.PI;else if(c.x-l.x<2*-Math.PI)for(;c.x-l.x<2*-Math.PI;)c.x+=2*Math.PI;i=vn(c.x,Number.NaN,i),g.setCoordsPoint2D(c)}else m.setCoordsPoint2D(c),Cn(m),i=vn(m.x,t,i),g.setCoords(i+m.x,m.y);if(Math.abs(g.x-c.x)<.5&&g.setCoordsPoint2D(c),u)n.queryCoord(0,_),d.setCoordsPoint2D(p),d.scale(1/e),_.setXY(d),a.isFirstSegmentInPath()?h.startPathPoint(_):h.lineToPoint(_),a.isLastSegmentInPath()&&!a.isPathClosed()&&(n.queryCoord(1,_),d.setCoordsPoint2D(g),d.scale(1/e),_.setXY(d),h.lineToPoint(_));else{a.isFirstSegmentInPath()&&h.insertPath2D(-1,null,0,0,!0);const t=h.getPathCount()-1;d.setCoordsPoint2D(p),d.scale(1/e),h.insertPoint2D(t,-1,d),a.isLastSegmentInPath()&&!a.isPathClosed()&&(d.setCoordsPoint2D(g),d.scale(1/e),h.insertPoint2D(t,-1,d))}}}return h}function on(e,t){return!(!so(e.y,r.geometryHalfPi)||!so(t.y,r.geometryHalfPi))||!(!so(e.y,-r.geometryHalfPi)||!so(t.y,-r.geometryHalfPi))}function an(e,t){return!(!so(e.y,r.geometryHalfPi)||so(t.y,r.geometryHalfPi))||!(!so(e.y,-r.geometryHalfPi)||so(t.y,-r.geometryHalfPi))}function ln(e,t){return!(!so(t.y,r.geometryHalfPi)||so(e.y,r.geometryHalfPi))||!(!so(t.y,-r.geometryHalfPi)||so(e.y,-r.geometryHalfPi))}class cn{constructor(){this.m_sr=null,this.m_gcs=null,this.m_transform=null,this.m_progressTracker=null,this.m_a=0,this.m_eSquared=0,this.m_rpu=0,this.m_gcsTolerance=0,this.m_radTolerance=0,this.m_maxLength=0,this.m_maxDeviation=0,this.m_curveType=0}geodeticDensify(e){const t=e.createInstance(),s=e.querySegmentIterator(),o=[],a=[],l=new n.SegmentBuffer,c=e.getDescription().getAttributeCount()>1;for(;s.nextPath();){const e=[0];for(;s.hasNextSegment();){const n=s.nextSegment(),h=n.getStartXY(),u=n.getEndXY();h.scale(this.m_rpu),u.scale(this.m_rpu);const m=new r.Point2D,d=new r.Point2D,p=h.compare(u)>0;yn(p,h,u,m,d),o.length=0,a.length=0,this.m_maxLength>0?mn(this.m_a,this.m_eSquared,this.m_curveType,m,d,this.m_maxLength,this.m_maxDeviation,this.m_radTolerance,null,null,c?a:null,o,e):i.geometryReleaseAssert(0),p&&fn(null,null,c?a:null,o),o[0].setCoordsPoint2D(n.getStartXY()),o.at(-1).setCoordsPoint2D(n.getEndXY());const g=1/this.m_rpu;for(let e=1,t=o.length-1;e<t;e++)o[e].scale(g);if(c){const e=xn(p,n,l);un(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),n,e,a,o,t)}else hn(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),o,t)}}return t}shapePreservingDensify(e){const t=e.createInstance(),i=e.querySegmentIterator(),s=[],r=[],o=new n.SegmentBuffer,a=e.getDescription().getAttributeCount()>1;for(;i.nextPath();)for(;i.hasNextSegment();){const e=i.nextSegment(),n=e.getStartXY(),l=e.getEndXY(),c=n.compare(l)>0,h=xn(c,e,o);s.length=0,r.length=0,_n(this.m_a,this.m_eSquared,this.m_rpu,h,this.m_sr,this.m_maxLength,this.m_maxDeviation,a?r:null,s),c&&fn(null,null,a?r:null,s),a?un(i.isFirstSegmentInPath(),i.isLastSegmentInPath()&&!i.isPathClosed(),e,h,r,s,t):hn(i.isFirstSegmentInPath(),i.isLastSegmentInPath()&&!i.isPathClosed(),s,t)}return t}replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(e){const t=e.hasNonLinearSegments();if((!this.m_transform||this.m_transform.isIdentity())&&(e=ds(e,this.m_gcs),!t))return e;const i=e.createInstance();i.reserveParts(e.getPointCount(),e.getPathCount());for(let t=0,r=e.getPathCount();t<r;++t){let r=new n.MultiPoint;const o=e.getPathStart(t),a=e.getPathEnd(t);r.addPoints(e,o,a);const l=e.isClosedPath(t);let c=!1;if(l&&a-o===1&&e.hasNonLinearSegmentsPath(t)){const t=new s.Point;e.getPointByVal(o,t),r.add(t),c=!0}if(this.m_transform&&!this.m_transform.isIdentity()){if(l&&!c){const t=new s.Point;e.getPointByVal(o,t),r.add(t)}if(r=(new tn).execute(r,this.m_transform,this.m_progressTracker),l&&r.getPointCount()>1){const e=r.getXY(0),t=r.getXY(r.getPointCount()-1);e.equals(t)&&r.removePoint(r.getPointCount()-1)}}r.getPointCount()>1&&(i.addPathMultiPoint(r,0,-1,!0),l&&i.closePathWithLine())}return i}}function hn(e,t,i,n){e&&n.insertPath2D(-1,null,0,0,!0);const s=n.getPathCount()-1;n.insertPointsFromPoints(s,-1,i,0,i.length-1,!0),t&&n.insertPoint2D(s,-1,i.at(-1))}function un(e,t,i,n,r,o,a){a.reserve(a.getPointCount()+o.length-1);const l=new s.Point;if(i.queryStart(l),e?a.startPathPoint(l):a.lineToPoint(l),o.length>2){const e=n.calculateLength2D();for(let t=1;t<o.length-1;t++){const i=n.lengthToT(r[t]*e);n.queryCoord(i,l),l.setXY(o[t]),a.lineToPoint(l)}}t&&(i.queryEnd(l),a.lineToPoint(l))}function mn(t,i,n,s,a,l,c,h,u,m,d,p,g){const _={stack:[],error:void 0,hasError:!1};try{const f=o.__addDisposableResource(_,new e.PeDoubleClass,!1),y=o.__addDisposableResource(_,new e.PeDoubleClass,!1),x=o.__addDisposableResource(_,new e.PeDoubleClass,!1);e.peLineType.geodeticDistance(t,i,s.x,s.y,a.x,a.y,x,f,y,n);const v=x.val,P=f.val,b=y.val;let E=P,S=b;E<0&&(E+=2*Math.PI),S<0&&(S+=2*Math.PI),u&&(u[0]=E),m&&(m[0]=S);let C=Number.NaN,w=Number.NaN;if(null!==d){const n=e.peMath.q90(t,i),r=e.peMath.q(t,i,s.y);C=(n-r)/v,w=(n+r)/v}const T=an(s,a),D=ln(s,a),I=T||D,A=function(e,t,i){return!(!Sn(e,t,i)||so(e.y,r.geometryHalfPi)||so(e.y,-r.geometryHalfPi)||so(t.y,r.geometryHalfPi)||so(t.y,-r.geometryHalfPi))}(s,a,h),M=o.__addDisposableResource(_,new r.SimpleDisposableArray(new e.PeDoubleClass,new e.PeDoubleClass),!1),N=new r.Point2D,R=new r.Point2D,O=new r.Point2D;g[0]=vn(s.x,Number.NaN,g[0]);let G=g[0];if(v<=l)return p.push(s.clone()),g[0]=vn(a.x,Number.NaN,g[0]),null!=d&&d.push(0),I?(T&&Pn(s,a,d,p),D&&bn(s,a,d,p)):A?En(s,a,P,C,w,d,p):c>0&&(R.setCoords(s.x-G,s.y),N.setCoords(a.x-g[0],a.y),G=dn()),p.push(a.clone()),v;const k=1+Math.ceil(v/l),V=v/(k-1),F=new r.Point2D;p.push(s.clone()),F.setCoordsPoint2D(s),R.setCoords(s.x-g[0],s.y),null!==d&&d.push(0);for(let r=1;r<k;r++){let o;if(r<k-1){const a=r*V;e.peLineType.geodeticCoordinate(t,i,s.x,s.y,a,P,M.at(0),M.at(1),n),N.setCoords(M.at(0).val,M.at(1).val),g[0]=vn(N.x,F.x,g[0]),O.setCoords(g[0]+N.x,N.y),o=r/(k-1)}else g[0]=vn(a.x,Number.NaN,g[0]),N.setCoords(a.x-g[0],a.y),O.setCoordsPoint2D(a),o=1;I?(1===r&&T&&Pn(s,O,d,p),r===k-1&&D&&bn(F,a,d,p)):A?Sn(F,O,h)&&(s.x<a.x?F.x>O.x&&(g[0]+=2*Math.PI,O.setCoords(g[0]+N.x,N.y)):F.x<O.x&&(g[0]-=2*Math.PI,O.setCoords(g[0]+N.x,N.y)),En(F,O,P,C,w,d,p)):c>0&&dn(),p.push(O.clone()),null!=d&&d.push(o),F.setCoordsPoint2D(O),R.setCoordsPoint2D(N),G=g[0]}return v}catch(e){_.error=e,_.hasError=!0}finally{o.__disposeResources(_)}}function dn(e,t,n,s,r,o,a,l,c,h,u,m,d,p,g){return i.geometryReleaseAssert(0),0}function pn(e,t,i,n){const r=P(e,t,i),o=P(e,t,n);return s.Point3D.distance(r,o)}function gn(t,n,o,a,l,c,h,u){const m=new Array,d=r.makeObjectArray(Array,8);let p=2,g=l.getCoord2D(c);d[0][0]=g.x,d[0][1]=g.y,g=l.getCoord2D(h),d[1][0]=g.x,d[1][1]=g.y;const _=t=>{if(null!==o){const n=e.peCSTransformations.projToGeog(o,t,d);i.geometryReleaseAssert(n===t)}for(const e of d)e[0]*=a,e[1]*=a};_(2),m.push(P(t,n,new r.Point2D(d[0][0],d[0][1]))),m.push(P(t,n,new r.Point2D(d[1][0],d[1][1])));let f=s.Point3D.distance(m[0],m[1]);if(f>u)return f;let y=0;for(p=3;p<=17;){const e=1/(p-1);let o=0;for(let t=1;t<p;++t)if(1&t){const i=r.lerp(c,h,t*e);l.queryCoord2D(i,g),d[o][0]=g.x,d[o][1]=g.y,o++}_(o);let a=1;for(let e=0;e<o;++e)m.splice(a,0,P(t,n,new r.Point2D(d[e][0],d[e][1]))),a++;a=0;let x=m[a];a++;let v=0;for(;a!==m.length;++a){const e=m[a];v+=s.Point3D.distance(x,e),x=e}if(v>u)return v;if(y=v-f,i.geometryReleaseAssert(y>=0||Math.abs(y)<1e-14*v),y<0&&(y=0),f=v,v+y<=u)return v+y;p=2*p-1}return f+y}function _n(t,n,s,o,a,l,c,h,u){const m=o.isCurve(),d=function(e,t){return e*Math.sqrt(1-t)}(t,n)*Math.PI*179/180;let p=l;l>0&&!(l>d)||(p=d);const g=c,_=g>0;let f=Number.NaN;_&&(f=function(e,t,i){const n=i/(2*N(e,t)),s=n*n;return i*(1-s*(.16666666666666666-.008333333333333333*s))}(t,n,g));const y=1===a.getCoordinateSystemType();let x=null;y||(x=a.getPECoordSys());const v=a.getTolerance(0),b=o.getStartXY(),E=o.getEndXY(),S=new r.Point2D,C=new r.Point2D;if(y)S.setCoordsPoint2D(b),S.scale(s),C.setCoordsPoint2D(E),C.scale(s);else{const t=[b.x,b.y,E.x,E.y];e.peCSTransformations.projToGeog(x,2,t),S.setCoords(t[0],t[1]),S.scale(s),C.setCoords(t[2],t[3]),C.scale(s)}let T=0,I=0;const A=[],M=[],R=[];A.push(E.clone()),M.push(C.clone()),R.push(1),u.push(b.clone()),null!==h&&h.push(I);const O=a.isPannable(),G=b.clone(),k=[.5,.33333333333333337,.6666666666666666,.16666666666666669,.8333333333333333];let V=5;m||(_?(k[0]=.5,k[1]=.25,k[2]=.75,V=3):V=1),i.geometryReleaseAssert(p>0);const F=t=>{if(t=t.clone(),null!==x){const i=[t.x,t.y];e.peCSTransformations.projToGeog(x,1,i),t.setCoords(i[0],i[1])}return t.scale(s),t};for(;M.length>0;){const e=A.at(-1).clone();C.assign(M.at(-1));const l=R.at(-1);let c=!1,d=Number.NaN;const g=gn(t,n,x,s,o,I,l,p);let b=p>=g&&Math.abs(S.y-C.y)<.9*Math.PI;y&&b&&(b=Math.abs(S.x-C.x)<.9*Math.PI);const E=new r.Point2D,N=new r.Point2D;let L=!1;if(!_&&b&&b&&(L=!0),o.calculateSubLength(I,l)<=v&&(L=!0),!L)for(let h=0;h<V;h++){const u=r.lerp(I,l,k[h]),p=new r.Point2D;o.queryCoord2D(u,p);const g=F(p);if(0===h&&(d=u,E.setCoordsPoint2D(p),N.setCoordsPoint2D(g),!b)){c=!0;break}if(i.geometryReleaseAssert(_),y&&Math.abs(S.x-g.x)>=Math.PI){c=!0;break}let x=new r.Point2D,v=new r.Point2D;m?(x=r.Point2D.lerp(G,e,k[h]),v=F(x)):(x=p.clone(),v=g.clone());const T=w(t,n,S,C,k[h]),A=T.clone();if(y?(A.x/=s,A.y/=s):(A.x/=s,A.y/=s,Wi(a.getGCSToSRTransform(),[A],1,[A],null)),A.isNAN()){const e=P(t,n,g),i=P(t,n,S),s=P(t,n,C),{second:r}=D(t,n,e,i,s,2,null);if(r>f){c=!0;break}}else{if(O){const e=a.getPannableExtent().width(),t=r.lerp(o.getStartX(),o.getEndX(),.5);for(;A.x<t-.5*e;)A.x+=e;for(;A.x>=t+.5*e;)A.x-=e}const e=o.getClosestCoordinateOnInterval(A,new r.Envelope1D(I,l),-1);let i=o.getCoord2D(e);i=F(i);let s=pn(t,n,i,T);if(s>f){if(s<4*f){const e=P(t,n,i),r=P(t,n,S),o=P(t,n,C),{second:a}=D(t,n,e,r,o,2,null);s=a}if(s>f){c=!0;break}}else if(m){let e=P(t,n,g);const i=P(t,n,S),s=P(t,n,C);let{second:r}=D(t,n,e,i,s,3,null);if(r<=f){e=P(t,n,v);const{second:o}=D(t,n,e,i,s,3,null);r=o}if(r>f){c=!0;break}}}}c?(A.push(E.clone()),M.push(N.clone()),R.push(d)):(A.pop(),M.pop(),R.pop(),u.push(e.clone()),T+=g,null!==h&&h.push(T),G.setCoordsPoint2D(e),S.setCoordsPoint2D(C),I=l)}if(null!==h){const e=1/T;for(let t=0;t<h.length;t++)h[t]*=e}}function fn(e,t,i,n){if(n.reverse(),null!==i&&i.reverse(),e){const i=e[0],n=t[0];e[0]=n,t[0]=i}}function yn(e,t,i,n,s){e?(n.setCoordsPoint2D(i),s.setCoordsPoint2D(t)):(n.setCoordsPoint2D(t),s.setCoordsPoint2D(i))}function xn(e,t,i){return e?(i.create(t.getGeometryType()),t.copyTo(i.get()),i.get().reverse(),i.get()):t}function vn(e,t,i){if(Number.isNaN(t)){for(;i-e>Math.PI;)i-=2*Math.PI;for(;e-i>Math.PI;)i+=2*Math.PI;return i}return i+e-t>Math.PI?i-=2*Math.PI:t-(i+e)>Math.PI&&(i+=2*Math.PI),i}function Pn(e,t,i,n){if(e.y>0){const s=new r.Point2D;s.setCoords(t.x,r.geometryHalfPi),so(e.x,s.x)||so(t.y,s.y)||(n.push(s),null!==i&&i.push(0))}else{const s=new r.Point2D;s.setCoords(t.x,-r.geometryHalfPi),so(e.x,s.x)||so(t.y,s.y)||(n.push(s),null!==i&&i.push(0))}}function bn(e,t,i,n){if(t.y>0){const s=new r.Point2D;s.setCoords(e.x,r.geometryHalfPi),so(t.x,s.x)||so(e.y,s.y)||(n.push(s),null!==i&&i.push(1))}else{const s=new r.Point2D;s.setCoords(e.x,-r.geometryHalfPi),so(t.x,s.x)||so(e.y,s.y)||(n.push(s),null!==i&&i.push(1))}}function En(e,t,i,n,s,o,a){if(c=no,0===(l=i)||Math.abs(l)<=c){if(r.geometryHalfPi-e.y>0){const t=new r.Point2D;t.setCoords(e.x,r.geometryHalfPi),a.push(t),null!==o&&o.push(n)}if(r.geometryHalfPi-t.y>0){const e=new r.Point2D;e.setCoords(t.x,r.geometryHalfPi),a.push(e),null!==o&&o.push(n)}}else{if(r.geometryHalfPi+e.y>0){const t=new r.Point2D;t.setCoords(e.x,-r.geometryHalfPi),a.push(t),null!==o&&o.push(s)}if(r.geometryHalfPi+t.y>0){const e=new r.Point2D;e.setCoords(t.x,-r.geometryHalfPi),a.push(e),null!==o&&o.push(s)}}var l,c}function Sn(e,t,i){return Math.abs(Math.abs(e.x-t.x)-Math.PI)<=i}function Cn(e){if(e.x<-Math.PI)for(;e.x<-Math.PI;)e.x+=2*Math.PI;else if(e.x>Math.PI)for(;e.x>Math.PI;)e.x-=2*Math.PI}function wn(e,i,n,r,o){const c=new t.Envelope2D;n.queryEnvelope(c);const h=s.calculateToleranceFromGeometryForOpFromGeom(null,n,!0).total();if(i.xmin-c.xmin<=h&&c.xmax-i.xmax<=h)return n;const u=i.width();let m=0;for(;i.xmin+m*u<c.xmin;)m++;for(;i.xmin+m*u>c.xmin;)m--;const d=m*u,p=new a.Transformation2D;p.setShiftCoords(-d,0);const g=n;g.applyTransformation(p);const _=new t.Envelope2D;g.queryEnvelope(_);let f=null;if(_.xmax>i.xmax){let n=0;const r=new t.Envelope2D;r.setCoords({env2D:i}),r.ymin-=1,r.ymax+=1;let a=g;for(;r.xmin<_.xmax;){_.xmax>r.xmax&&(a=us(a,e,2,!0,r.xmax));const t=s.getMergedExtentEnv2D(a,r),c=s.calculateToleranceFromGeometryForOp(null,t,!0).total(),h=l.clip$1(a,r,c,Number.NaN,o);null===f?f=h===a?h.clone():h:(p.setShiftCoords(-n*u,0),h.applyTransformation(p),f.add(h,!1)),n++,r.xmin=r.xmax,r.xmax=i.xmax+n*u}}else f=g;return f}class Tn{constructor(e,t){this.m_basisX=new s.Point3D,this.m_basisY=new s.Point3D,this.m_normal=new s.Point3D,i.geometryReleaseAssert(1===e.getCoordinateSystemType()),this.m_gcs=e;const n=Er();e.querySpheroidData(n),this.m_a=n.majorSemiAxis,this.m_e2=n.e2,this.m_rpu=e.getUnit().getUnitToBaseFactor(),this.m_curvCenterRad=t.mul(this.m_rpu);const o=this.m_curvCenterRad.x,a=this.m_curvCenterRad.y,l=Math.cos(o),c=Math.sin(o),h=Math.cos(a),u=Math.sin(a);this.m_cartCenter3D=function(e,t,i,n,s,r){return b(e,t,i,n,s,r,0)}(this.m_a,this.m_e2,l,c,h,u),this.m_normal.setCoordsPoint3D(this.m_cartCenter3D),this.m_d=this.m_cartCenter3D.length(),this.m_normal.divThis(this.m_d),s.Point3D.selectRightHandedBasisFromNormal(this.m_normal,this.m_basisX,this.m_basisY),this.m_northPolePcs=this.projectPoint(r.Point2D.construct(0,.5*Math.PI/this.m_rpu)),this.m_southPolePcs=this.projectPoint(r.Point2D.construct(0,.5*-Math.PI/this.m_rpu))}project(e){const t=e.getGeometryType();if(i.isMultiVertex(t)){i.throwIfCurves(e);const t=e;return this.projectMultiVertex(t)}i.throwInvalidArgumentException("Gnomonic.project")}unproject(e,o,a){const l=e.getGeometryType();if(i.isMultiVertex(l)){i.throwIfCurves(e);let c=e;const h=[];if(l===i.GeometryType.enumPolygon){const e=c.getPathCount();for(let t=0;t<e;t++){const e=c.calculateRingArea2D(t);h.push(e)}}return this.unprojectMultiVertex(o,c),i.isMultiPath(l)?(function(e,t,i){const n=e.getPannableExtent(),s=r.Point2D.construct(0,0);n.centerAt(s);const o=n.width(),a=.5*o,l=new r.Point2D;l.setNAN();let c=Number.NaN;for(let e=0;e<i.getPathCount();e++)for(let t=i.getPathStart(e);t<i.getPathEnd(e);t++){const s=i.getXY(t),r=so(s.y,n.ymax)||so(n.ymin,s.y);t===i.getPathStart(e)?(l.setNAN(),c=0):l.isNAN()||r||(c=An(s.x,l.x,a,o,c)),s.x+=c,i.setXYNoCurves(t,s),r||l.setCoordsPoint2D(s)}i.getImpl().notifyModifiedFlags(2001)}(this.m_gcs,0,c),function(e,o,a,l,c){const h=l.getGeometryType(),u=o.getPannableExtent();let m=l,d=!1,p=!1;if(h===i.GeometryType.enumPolygon){const i=new t.Envelope2D,a=r.Point2D.construct(0,0);i.setCoords({env2D:u}),i.centerAt(a),d=function(e,i,s,o,a){const l=function(e,i){const s=new t.Envelope2D;i.queryEnvelope(s);const o=so(e.ymax,s.ymax),a=so(e.ymin,s.ymin),l=o||a;return!!l&&(function(e,i){const s=new n.Polygon,o=new t.Envelope2D;for(let t=0;t<i.getPathCount();t++){i.queryPathEnvelope(t,o);let n=so(e.ymax,o.ymax),a=so(e.ymin,o.ymin);if(!n&&!a){s.addPath(i,t,!0);continue}s.insertPath2D(-1,null,0,0,!0);const l=i.getPathStart(t),c=i.getPathEnd(t),h=c-l;let u=-1;for(u=l;u<c;u++){const t=i.getXY(u);if(n=so(e.ymax,t.y),a=so(e.ymin,t.y),!n&&!a)break}let m=u,d=!1,p=Number.NaN;do{const o=i.getXY(m);n=so(e.ymax,o.y),a=so(e.ymin,o.y);const c=l+(m+1-l)%h;if(n||a){let n=r.Point2D.construct(p,o.y);s.insertPoint2D(t,-1,n);const a=i.getXY(c),l=so(e.ymax,a.y),h=so(e.ymin,a.y);l||h||(n=r.Point2D.construct(a.x,o.y),d?s.setXYNoCurves(s.getPointCount()-1,n):s.insertPoint2D(t,-1,n)),d=!0}else s.insertPoint2D(t,-1,o),p=o.x,d=!1;m=c}while(m!==u)}i.setEmpty(),i.add(s,!1)}(e,i),l)}(s,o),c=function(e,t,i,s,r){const o=[],a=[],l=.5*i.width();for(let n=0;n<s.getPathCount();n++){const c=s.getXY(s.getPathStart(n)),h=s.getXY(s.getPathEnd(n)-1),u=e[n]<0;if(Math.abs(c.x-h.x)>l){const e=Dn(u,t,i,n,s,r);o.push(e),a.push(n)}else if(!u&&s.calculateRingArea2D(n)<0){const e=In(t,i,n,s,r);o.push(e),a.push(n)}}if(0===o.length)return!1;const c=new n.Polygon({vd:s.getDescription()});let h=0,u=a[h];for(let e=0;e<s.getPathCount();e++)e===u?(c.add(o[h],!1),h++,h<a.length&&(u=a[h])):c.addPath(s,e,!0);return s.setEmpty(),s.add(c,!1),!0}(e,i,s,o,a);return l||c}(e,o,i,m,c);const l=function(e,i,n,r){const o=new t.Envelope2D;n.queryEnvelope(o);const a=s.calculateToleranceFromGeometryForOpFromGeom(null,n,!0).total();if(i.xmin-o.xmin<=a&&o.xmax-i.xmax<=a)return n;const l=n.createInstance();let c=n.createInstance();const h=new t.Envelope2D,u=n.getPathCount();for(let t=0;t<u;t++)n.queryPathEnvelope(t,h),i.xmin-h.xmin<=a&&h.xmax-i.xmax<=a?l.addPath(n,t,!0):(c.setEmpty(),c.addPath(n,t,!0),c=wn(e,i,c,0,r),l.add(c,!0));return l}(o,i,m,c);l!==m&&(p=!0),m=l}else m=(new tn).foldInto360RangeGeodetic(m,o,2);h===i.GeometryType.enumPolygon&&(d||p)&&(m=(new Ui).execute(m,o,!1,c)),m!==l&&(l.setEmpty(),l.add(m,!1))}(h,this.m_gcs,0,c,a)):c=os(c,this.m_gcs,0,!0,0,a),c}i.throwInvalidArgumentException("Gnomonic.unproject")}projectPoint(e){const t=e.mul(this.m_rpu),i=P(this.m_a,this.m_e2,t),n=this.m_normal.dotProduct(i);if(n<=0)return r.Point2D.construct(Number.NaN,Number.NaN);const s=this.m_d/n,o=i.mul(s).sub(this.m_cartCenter3D),a=new r.Point2D;return a.x=this.m_basisX.dotProduct(o),a.y=this.m_basisY.dotProduct(o),a}unprojectPoint(e){const t=this.m_cartCenter3D.add(this.m_basisX.mul(e.x).add(this.m_basisY.mul(e.y)));return S(this.m_a,this.m_e2,t).divide(this.m_rpu)}projectMultiVertex(e){const t=e.getImpl();let i=!0;const n=new r.Point2D,s=new r.Point2D;for(let e=0,r=t.getPointCount();e<r;e++)t.queryXY(e,n),n.y*this.m_rpu>.5*Math.PI?s.assign(this.m_northPolePcs):n.y*this.m_rpu<.5*-Math.PI?s.assign(this.m_southPolePcs):s.assign(this.projectPoint(n)),t.setXYNoCurves(e,s),s.isNAN()&&(i=!1);return t.notifyModifiedFlags(2001),i}unprojectMultiVertex(e,t){const i=t.getImpl(),n=e*e,s=!this.m_northPolePcs.isNAN(),o=!this.m_southPolePcs.isNAN();for(let e=0,t=i.getPointCount();e<t;e++){const t=i.getXY(e);let a=new r.Point2D;s&&r.Point2D.sqrDistance(t,this.m_northPolePcs)<=n?(a.setCoords(this.m_curvCenterRad.x,.5*Math.PI),a.scale(1/this.m_rpu)):o&&r.Point2D.sqrDistance(t,this.m_southPolePcs)<=n?(a.setCoords(this.m_curvCenterRad.x,.5*-Math.PI),a.scale(1/this.m_rpu)):a=this.unprojectPoint(t),i.setXYNoCurves(e,a)}i.notifyModifiedFlags(2001)}}function Dn(e,i,o,c,h,u){const m=new n.Polygon,d=new n.Polygon,p=new a.Transformation2D,g=h.getXY(h.getPathStart(c)),_=h.getXY(h.getPathEnd(c)-1),f=o.width(),y=.5*f,x=new t.Envelope2D;h.queryEnvelope(x);const v=Math.ceil(x.width()/f)+1;let P,b;g.x>_.x?(P=-f,b=e?o.ymin:o.ymax):(P=f,b=e?o.ymax:o.ymin),p.setShiftCoords(P,0),m.addPath(h,c,!0),d.add(m,!1);const E=new s.Point;for(let e=0;e<v;e++)d.applyTransformation(p),d.getPointByVal(0,E),m.lineToPoint(E),m.addSegmentsFromPath(d,0,0,d.getSegmentCount()-1,!1);const S=m.getXY(0),C=m.getXY(m.getPointCount()-1);S.y=b,C.y=b,m.lineTo(C);const w=new r.Point2D;for(w.setCoordsPoint2D(C),w.x-=.5*P;Math.abs(w.x-S.x)>y;)m.lineTo(w),w.x-=.5*P;m.lineTo(S);const T=o.getCenter().x,D=new t.Envelope2D;m.queryEnvelope(D);let I=0;const A=D.getCenter().x;A-T>y?I=-Math.ceil((A-T-y)/f):T-A>y&&(I=Math.ceil((T-A-y)/f)),0!==I&&(p.setShiftCoords(I*f,0),m.applyTransformation(p));const M=new n.EditShape,N=M.addGeometry(m);ms(M,N,i,0,2,!0,o.xmin),ms(M,N,i,0,2,!0,o.xmax);const R=M.getGeometry(N),O=s.getMergedExtentEnv2D(R,o);O.inflateCoords(0,1);const G=s.calculateToleranceFromGeometryForOp(null,O,!0);return l.clip$1(R,o,G.total(),Number.NaN,u)}function In(e,i,o,c,h){const u=i.width(),m=.5*u,d=i.getCenter().x,p=new t.Envelope2D;c.queryPathEnvelope(o,p);let g,_=0,f=p.getCenter().x;if(f-d>m?_=-Math.ceil((f-d-m)/u):d-f>m&&(_=Math.ceil((d-f-m)/u)),0!==_){const e=new a.Transformation2D;e.setShiftCoords(_*u,0),c.getImpl().applyTransformationToPath(e,o),c.queryPathEnvelope(o,p),f=p.getCenter().x}const y=new t.Envelope2D;i.containsExclusiveEnvelope(p)?(g=!1,y.setCoords({env2D:i})):(g=!0,y.setCoords({env2D:i}),y.xmin-=u,y.xmax+=u);let x=c.createInstance();x.addPathPoint2D(null,0,!0);const v=new r.Point2D;if(v.setCoords(y.xmin,y.ymin),x.insertPoint2D(0,-1,v),v.setCoords(y.xmin,y.ymax),x.insertPoint2D(0,-1,v),v.setCoords(.5*(y.xmin+y.xmax),y.ymax),x.insertPoint2D(0,-1,v),v.setCoords(y.xmax,y.ymax),x.insertPoint2D(0,-1,v),v.setCoords(y.xmax,y.ymin),x.insertPoint2D(0,-1,v),v.setCoords(.5*(y.xmin+y.xmax),y.ymin),x.insertPoint2D(0,-1,v),g){x.addPath(c,o,!0);const t=new a.Transformation2D;f<d?t.setShiftCoords(u,0):t.setShiftCoords(-u,0),c.getImpl().applyTransformationToPath(t,o),x.addPath(c,o,!0);const r=new n.EditShape,m=r.addGeometry(x);ms(r,m,e,0,2,!0,i.xmin),ms(r,m,e,0,2,!0,i.xmax),x=r.getGeometry(m);const p=s.getMergedExtentEnv2D(x,i);p.inflateCoords(0,1);const g=s.calculateToleranceFromGeometryForOp(null,p,!0).total();x=l.clip$1(x,i,g,Number.NaN,h)}else x.addPath(c,o,!0);return x}function An(e,t,i,n,s){return s+e-t>i?s-=n:t-(s+e)>i&&(s+=n),s}function Mn(e,t,i,o,a,l){const c=t.getAttributeStreamRef(0),h=t.getPointCount();let u=!1;const m=new r.Point2D;for(let e=0;e<h;++e){if(c.queryPoint2D(2*e,m),1&l&&m.y>=i){u=!0;break}if(2&l&&m.y<=-i){u=!0;break}}if(!u)return!1;let d=!1;e&&(d=t.getImpl().isClosedPathInXYPlane(0));const p=new n.EditShape,g=p.addGeometry(t),_=p.getFirstPath(g);let f=-1,y=!0;const x=new r.Point2D,v=new s.Point;let P=n.nullHandle;const b=Nn*a/360;for(let e=p.getFirstVertex(_);e!==n.nullHandle;e=p.getNextVertex(e)){p.queryXY(e,m);let t=1&l&&m.y>=i?1:0;if(t|=2&l&&m.y<=-i?2:0,f>0&&f!==t){if(x.x!==m.x){const t=p.getPrevVertex(e);p.queryPoint(t,v);const i=p.insertVertex(_,e,v);x.x=m.x,p.setXY(i,x)}if(d){let t=P!==n.nullHandle?p.getNextVertex(P):p.getFirstVertex(_);const i=p.getPrevVertex(e);for(;t!==i;)t=p.removeVertex(t,!1);if(P!==n.nullHandle){const e=p.getXY(P),t=p.getXY(i);if(Math.abs(e.x-t.x)>b){p.queryPoint(P,v);const n=p.insertVertex(_,i,v);e.x=r.lerp(e.x,t.x,.5),p.setXY(n,e)}}}P=n.nullHandle}if(t&&(m.y=r.copySign(o,m.y),p.setXY(e,m),!y&&f!==t))if(m.x!==x.x){p.queryPoint(e,v);const t=p.insertVertex(_,e,v);p.setXYCoords(t,x.x,m.y),P=t}else P=e;f=t,x.assign(m),y=!1}if(d){if(P!==n.nullHandle){let e=p.getNextVertex(P);for(;e!==n.nullHandle;)e=p.removeVertex(e,!1)}const e=p.getFirstVertex(_);let t=p.getLastVertex(_);const i=p.getXY(e),s=p.getXY(t);if(!i.equals(s)&&(p.queryPoint(e,v),t=p.insertVertex(_,n.nullHandle,v),Math.abs(i.x-s.x)>b)){const e=p.insertVertex(_,t,v);i.x=r.lerp(i.x,s.x,.5),p.setXY(e,i)}}return t.assignCopy(p.getGeometry(g)),!0}const Nn=210;class Rn{constructor(e,t,n,s,r,o,a,l,c){this.m_bAdjustedAtPoles=0,this.m_inputPoly=n,this.m_progressTracker=c,this.m_originalGeometry=e,this.m_originalSR=s,this.m_polygonRingFlags=t,this.m_pannableSR=r,this.m_poleSnappingTolerance=l,this.m_poleFlags=a,this.m_bAdjustedAtPoles=0,this.m_pannableExtent=function(e,t){const i=e.getPannableExtent();return Number.isNaN(t)||i.centerAtCoords(t,0),i}(this.m_pannableSR,o),this.m_centralLongitude=Number.isNaN(o)?this.m_pannableExtent.getCenterX():o,this.m_width360=this.m_pannableExtent.width(),this.m_degree=this.m_width360/360,this.m_GCSLargeDelta=Nn*this.m_degree,i.geometryReleaseAssert(null===this.m_originalGeometry&&null===this.m_originalSR||null!==this.m_originalGeometry&&null!==this.m_originalSR)}geonormalizeRing(e,t,o,a,l,c,h){let u=o;const m=new n.Polyline({vd:this.m_inputPoly.getDescription()});m.addPath(this.m_inputPoly,e,!0),0!==this.m_poleFlags&&(this.m_bAdjustedAtPoles|=Mn(!0,m,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,this.m_pannableExtent.width(),this.m_poleFlags)?1:0,this.m_bAdjustedAtPoles&&(u=!1));let d=-1;u&&(d=this.m_originalGeometry.getPathStart(e));const p=m.getAttributeStreamRef(0),g=m.getPointCount();let _=0,f=p.read(0),y=0;const x=3*this.m_pannableSR.getTolerance(0);let v=!1;const P=new r.Point2D,b=new r.Point2D;let E=!1;const S=m.hasNonLinearSegments(),C=new r.Point2D;for(let e=1;e<g;++e){p.queryPoint2D(2*e,C);const t=C.x;let n=t+_;const o=n-f;if(C.x=n,Math.abs(o)>this.m_GCSLargeDelta){if(u){const t=d+e-1,i=d+(e+1<g?e:0),n=c.read(2*t),s=(c.read(2*i)-n)*a;Math.abs(o-s)>1*this.m_degree&&(u=!1)}u||(_-=r.copySign(this.m_width360,n-f),n=t+_,++y,E=0!==_,C.x=n)}else v||s.isAngleTooSharp(P,b,C,x)&&(v=!0);E&&(S&&i.throwInternalErrorException("error in geonormalize_ring_ for curves"),p.write(2*e,n)),f=n,P.setCoordsPoint2D(b),b.setCoordsPoint2D(C)}y&&m.notifyModified();const w=m.getXY(0),T=m.getXY(g-1);if(r.Point2D.distance(w,T)<x){const e=this.finalizeGeoNormalizeClosedRing(m,v,l);h.add(e,!1)}else{t<0&&(null!==this.m_originalGeometry?(i.geometryReleaseAssert(null!==this.m_originalGeometry),t=this.m_originalGeometry.calculateRingArea2D(e)>0?1:0):t=1);const n=this.finalizeGeoNormalizeOpenedRing(t>0,m);h.add(n,!1)}}geoNormalizePolygonGeometry(e){i.geometryReleaseAssert(this.m_originalSR&&this.m_originalGeometry||!this.m_originalGeometry&&!this.m_originalSR),i.geometryReleaseAssert(this.m_pannableSR.isPannable());let s=null,r=Number.NaN;const o=!!this.m_originalSR&&this.m_originalSR.isPannable();o&&(s=this.m_originalGeometry.getAttributeStreamRef(0),r=this.m_width360/this.m_originalSR.getPannableExtent().width()),this.m_bAdjustedAtPoles=0;const a=new n.Polygon({vd:this.m_inputPoly.getDescription()});for(let t=0,i=this.m_inputPoly.getPathCount();t<i;++t){const i=this.m_polygonRingFlags?this.m_polygonRingFlags[t]?1:0:-1;this.geonormalizeRing(t,i,o,r,e,s,a)}const h=this.m_pannableSR.getTolerance(0),u=this.m_pannableExtent.width()/180;fs(a,this.m_pannableExtent,.1*h,!1);const m=t.Envelope2D.constructEmpty();if(m.setCoords({env2D:this.m_pannableExtent}),e){let e=!0;for(let i=0;i<2;i++){e=!0;const i=t.Envelope2D.constructEmpty();for(let t=0,n=a.getPathCount();t<n;t++)if(a.queryPathEnvelope(t,i),!(m.xmin<=i.xmin&&m.xmax>=i.xmax||i.xmin>=m.xmax||i.xmax<=m.xmin)){e=!1;break}if(e)break;m.move(.5*this.m_width360,0)}e||m.setCoords({env2D:this.m_pannableExtent})}let d=l.clip$1(a,m,h,u,this.m_progressTracker),p=a!==d;const g=this.m_originalGeometry?this.m_originalGeometry.calculateArea2D():1,_=d.calculateArea2D();let f=0;if(_>0&&g<0)f=1;else if(_<=0&&g>0)if(0===_){if(this.m_originalSR){let e=Number.NaN;2===this.m_originalSR.getCoordinateSystemType()?e=this.m_originalSR.getPCSHorizon().calculateArea2D():1===this.m_originalSR.getCoordinateSystemType()&&(e=this.m_originalSR.getPannableExtent().getArea()),g>.99*e&&(f=-1)}}else f=-1;if(0!==f){const e=function(e,t){let i=new n.Polygon({vd:e});i.addEnvelope(t,!1);const s=t.width()/180;return i=(new c.OperatorDensify).execute(i,s,0,0,null),i}(d.getDescription(),m);e.add(d,!1),p=!0,d=e}return p&&(d=(new Ui).execute(d,this.m_pannableSR,!1,this.m_progressTracker)),d}geoNormalizePolylineGeometry(e){i.geometryReleaseAssert(this.m_pannableSR.isPannable());let s=null;const o=this.m_originalSR&&this.m_originalSR.isPannable();let c=1;o&&(i.geometryReleaseAssert(this.m_originalGeometry),c=this.m_width360/this.m_originalSR.getPannableExtent().width(),s=this.m_originalGeometry.getAttributeStreamRef(0));const h=this.m_pannableExtent.width(),u=h*r.doubleEps()*4;let m=e,d=Number.NaN;const p=r.Envelope1D.constructEmpty();this.m_bAdjustedAtPoles=0;let g=new n.Polyline({vd:this.m_inputPoly.getDescription()});for(let e=0,l=this.m_inputPoly.getPathCount();e<l;++e){let l=o;const _=new n.Polyline({vd:this.m_inputPoly.getDescription()});_.addPath(this.m_inputPoly,e,!0);const f=this.m_inputPoly.isClosedPath(e);0!==this.m_poleFlags&&(this.m_bAdjustedAtPoles|=Mn(f,_,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,h,this.m_poleFlags)?1:0,this.m_bAdjustedAtPoles&&(l=!1));let y=-1;const x=_.getPointCount();let v=!1;l&&(y=this.m_originalGeometry.getPathStart(e),v=this.m_originalGeometry.isClosedPath(e));const P=_.getAttributeStreamRef(0);let b=0,E=P.read(0),S=0;const C=new r.Point2D,w=new r.Point2D;let T=!1;const D=_.hasNonLinearSegments(),I=new r.Point2D;for(let e=1;e<x;++e){P.queryPoint2D(2*e,I);const t=I.x;let n=t+b;const o=n-E;if(I.x=n,Math.abs(o)>this.m_GCSLargeDelta){if(l){const t=y+e-1;let i=y;(!v||e+1<x)&&(i+=e);const n=s.read(2*t),r=(s.read(2*i)-n)*c;Math.abs(o-r)>1*this.m_degree&&(l=!1)}l||(b-=r.copySign(this.m_width360,n-E),n=t+b,++S,T=0!==b,I.x=n)}T&&(D&&i.throwInternalErrorException("error in geonormalize_ring_ for curves"),P.write(2*e,n)),E=n,C.setCoordsPoint2D(w),w.setCoordsPoint2D(I)}if(S&&_.notifyModified(),m){let e=!1;if(!_.isEmpty()){const n=t.Envelope2D.constructEmpty();if(_.queryEnvelope(n),n.width()>=h||n.ymin<=this.m_pannableExtent.ymin||n.ymax>=this.m_pannableExtent.ymax)e=!0;else{if(Number.isNaN(d)){const e=this.m_centralLongitude-.5*h;d=n.xmin,d+=Math.round((e-n.xmin)/h)*h,d>e&&(d-=h),i.geometryReleaseAssert(d<=e),d<e&&(d+=h),i.geometryReleaseAssert(d>=e)}let t=Math.round((d-n.xmin)/h)*h;if(n.xmin+t>d+u&&(t-=h),n.xmin+t<d-u&&(t+=h),p.mergeCoordinate(n.xmin+t),p.mergeCoordinate(n.xmax+t),e=p.width()>=h,!e){const e=new a.Transformation2D;e.setShiftCoords(t,0),_.applyTransformation(e)}}}g.add(_,!1),e&&(g=(()=>{const e=new n.Polyline({vd:g.getDescription()});for(let t=0,i=g.getPathCount();t<i;++t){const i=new n.Polyline({vd:g.getDescription()});i.addPath(g,t,!0);const s=os(i,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);e.add(s,!1)}return e})(),m=!1)}else{const e=os(_,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);g.add(e,!1)}}if(m)return g;const _=this.m_pannableSR.getTolerance(0),f=this.m_pannableExtent.width()/180;return fs(g,this.m_pannableExtent,.1*_,!1),l.clip$1(g,this.m_pannableExtent,_,f,this.m_progressTracker)}finalizeGeoNormalizeOpenedRing(e,s){const o=s.getPointCount(),l=s.getXY(0),c=s.getXY(o-1);{const e=Math.abs(c.x-l.x),t=Math.round(e/this.m_width360)*this.m_width360;i.geometryReleaseAssert(Math.abs(e-t)<this.m_pannableSR.getTolerance(0))}const h=r.sign(c.x-l.x),u=t.Envelope2D.constructEmpty();s.queryLooseEnvelope(u);const m=this.m_pannableExtent.getCenterX();let d=0,p=m-this.m_width360,g=m+this.m_width360;if(h>=0){let e=Math.ceil((p-u.xmin)/this.m_width360);for(e*=this.m_width360;p>u.xmin+e;)e+=this.m_width360;for(;p<u.xmax+e;)e-=this.m_width360;for(d=e,u.width()>720&&(g=p+360*Math.ceil(u.width()/360));g<u.xmax;)g+=this.m_width360}else{let e=Math.ceil((g-u.xmax)/this.m_width360);for(e*=this.m_width360;g<u.xmax+e;)e-=this.m_width360;for(;g>u.xmin+e;)e+=this.m_width360;for(d=e,u.width()>720&&(p=g-360*Math.ceil(u.width()/360));p>u.xmin;)p-=this.m_width360}const _=Math.round(Math.abs(c.x-l.x)/this.m_width360)*this.m_width360,f=h*_,y=u.clone();y.move(d,0);const x=new r.Point2D(0,0),v=new a.Transformation2D;v.setShiftCoords(d,0),s.applyTransformation(v);const P=new n.Polyline({vd:s.getDescription()});P.add(s,!1),x.assign(s.getXY(o-1));let b=0,E=P.getXY(0).x;for(;h>0?y.xmax<g:y.xmin>p;)y.move(f,0),v.xd=f,s.applyTransformation(v),E+=f,this.m_pannableExtent.xmin<=E&&this.m_pannableExtent.xmax>=E&&(b=P.getPointCount()-1),s.setXY(0,x),x.assign(s.getXY(o-1)),P.addSegmentsFromPath(s,0,0,o-1,!1);const S=new n.Polygon({vd:P.getDescription()});S.add(P,!1);const C=P.getXY(0),w=P.getXY(P.getPointCount()-1),T=h<0?e:!e,D=S.getPointCount()-1;if(T){const e=new r.Point2D(w.x,this.m_pannableExtent.ymax);S.lineTo(e);const t=new r.Point2D(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymax);S.lineTo(t);const i=new r.Point2D(C.x,this.m_pannableExtent.ymax);S.lineTo(i)}else{const e=new r.Point2D(w.x,this.m_pannableExtent.ymin);S.lineTo(e);const t=new r.Point2D(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymin);S.lineTo(t);const i=new r.Point2D(C.x,this.m_pannableExtent.ymin);S.lineTo(i)}if(S.interpolateAttributesPath(0,D,0),S.getImpl().changeRingStartPoint(b),_>this.m_width360){const e=new n.Polygon({copy:S});v.setShiftCoords(this.m_width360,0),e.applyTransformation(v),S.add(e,!1)}return S}finalizeGeoNormalizeClosedRing(e,s,o){const l=new n.Polygon({vd:e.getDescription()});if(l.add(e,!1),l.hasNonLinearSegments()&&(()=>{const e=l.getPointCount()-2;return l.getSegmentType(e)!==i.GeometryType.enumLine})()){const e=new n.SegmentBuffer,t=l.getPointCount()-2;l.getSegmentBuffer(t,e,!1),l.removePointFromPath(0,t+1),l.closeLastPathWithSegment(e.get())}else l.removePointFromPath(0,l.getPointCount()-1);const c=t.Envelope2D.constructEmpty();l.queryLooseEnvelope(c);let h=Math.ceil((this.m_pannableExtent.xmin-c.xmin)/this.m_width360);for(h*=this.m_width360;this.m_pannableExtent.xmin>c.xmin+h;)h+=this.m_width360;for(;this.m_pannableExtent.xmin<c.xmax+h;)h-=this.m_width360;if(h+=this.m_width360,0!==h){c.move(h,0);const e=new a.Transformation2D;e.setShiftCoords(h,0),l.applyTransformation(e)}if(this.m_pannableExtent.xmin<=c.xmin&&this.m_pannableExtent.xmax>=c.xmax){if(s){const e=l.calculateArea2D(),t=(new Ui).execute(l,this.m_pannableSR,!0,this.m_progressTracker);if(t!==l){const i=t.calculateArea2D();r.sign(e)!==r.sign(i)&&t.reverseAllPaths(),l.assignMove(t)}}let e;if(e=o?new n.Polygon({copy:l}):new n.Polygon({move:l}),o)for(;c.xmin<this.m_pannableExtent.xmax;){c.move(this.m_width360,0);const t=new a.Transformation2D;t.setShiftCoords(this.m_width360,0),l.applyTransformation(t),e.add(l,!1)}return e}let u=new n.Polygon({vd:e.getDescription()});u.add(l,!1);const m=s||c.width()>this.m_width360-10*this.m_pannableSR.getTolerance(0);for(;c.xmin<this.m_pannableExtent.xmax;){c.move(this.m_width360,0);const e=new a.Transformation2D;e.setShiftCoords(this.m_width360,0),l.applyTransformation(e),u.add(l,!1)}if(m){const e=u.calculateArea2D();u.setFillRule(1),u=(new Ui).execute(u,this.m_pannableSR,!0,this.m_progressTracker);const t=u.calculateArea2D();r.sign(e)!==r.sign(t)&&u.reverseAllPaths()}return u}geonormalize_ring_(e,t,n,s,r,o,a){i.geometryReleaseAssert(0)}}function On(e){i.geometryReleaseAssert(0);const t=function(e){const t=new Bs({},!0);return t.m_WKID=e,t}(e),n=new Gn;return n.setVertProj_(t),n}class Gn{constructor(){this.m_hashCode=0,this.m_peVertSysVal=null,this.m_verticalUnit=new gr,this.m_verticalShift=0,this.m_userVerticalWKID=0,this.m_bIsDepth=!1}getType(){return i.geometryReleaseAssert(0),0}getID(){return i.geometryReleaseAssert(0),0}getLatestID(){return this.m_peVertSysVal?this.m_peVertSysVal.getLatestID():0}getOldID(){return this.m_peVertSysVal?this.m_peVertSysVal.getOldID():0}getText(){return i.geometryReleaseAssert(0),""}getTextExtended(e){return i.geometryReleaseAssert(0),""}getText2(e){return i.geometryReleaseAssert(0),""}getUnit(){return i.geometryReleaseAssert(0),{}}equals(e){return i.geometryReleaseAssert(0),!1}equalForProjection(e){return i.geometryReleaseAssert(0),!1}getPeVertcsCopy(){return i.geometryReleaseAssert(0),{}}getOneMeter(){return 1/this.m_verticalUnit.getUnitToBaseFactor()}getUnitToBaseFactor(){return i.geometryReleaseAssert(0),0}isDepth(){return i.geometryReleaseAssert(0),!1}getVerticalShift(){return i.geometryReleaseAssert(0),0}isCustomWkid(){return!!this.m_peVertSysVal&&this.m_peVertSysVal.isCustomWkid()}getHashCode(){return this.m_hashCode}setVertProj_(e){this.m_peVertSysVal=e}getPEVerticalCoordSys(){return this.m_peVertSysVal?this.m_peVertSysVal.m_peVertcs:null}}function kn(e,t,i,s,r){if(e.equals(t))return!1;if(s){let i=1,n=0,o=1,a=1,l=0,c=1;Number.isNaN(e.m_heightMetersPerUnit)||(i=e.m_heightMetersPerUnit,n=e.m_heightZ0,o=e.m_heightSign,a=t.m_heightMetersPerUnit,l=t.m_heightZ0,c=t.m_heightSign);const h=o*c*i/a;for(let e=0;e<r;e++)s[e]=(s[e]-n)*h+l}let o=1,a=0;if(Number.isNaN(e.m_XYToRadians)||(o=e.m_XYToRadians/t.m_XYToRadians,a=e.m_PrimeMeridianDegrees-t.m_PrimeMeridianDegrees,0!==a&&(a=n.convertToRadians(a),a/=t.m_XYToRadians)),Array.isArray(i)){const e=i;for(let t=0;t<r;t++)e[t][0]=e[t][0]*o+a,e[t][1]=e[t][1]*o}else{const e=i;for(let t=0;t<r;t++){const i=t<<1;e[i]=e[i]*o+a,e[i+1]=e[i+1]*o}}return!0}function Vn(){return{m_heightMetersPerUnit:0,m_heightSign:0,m_heightZ0:0,m_XYToRadians:0,m_PrimeMeridianDegrees:0,assign(e){this.m_heightMetersPerUnit=e.m_heightMetersPerUnit,this.m_heightSign=e.m_heightSign,this.m_heightZ0=e.m_heightZ0,this.m_XYToRadians=e.m_XYToRadians,this.m_PrimeMeridianDegrees=e.m_PrimeMeridianDegrees},equals(e){return r.isEqualNonIEEE(this.m_heightSign,e.m_heightSign)&&r.isEqualNonIEEE(this.m_heightMetersPerUnit,e.m_heightMetersPerUnit)&&r.isEqualNonIEEE(this.m_heightZ0,e.m_heightZ0)&&r.isEqualNonIEEE(this.m_XYToRadians,e.m_XYToRadians)&&r.isEqualNonIEEE(this.m_PrimeMeridianDegrees,e.m_PrimeMeridianDegrees)},initFromGcsAndVcsPe(e,t){this.m_heightSign=1,this.m_heightMetersPerUnit=Number.NaN,this.m_heightZ0=0,this.m_XYToRadians=Number.NaN,this.m_PrimeMeridianDegrees=Number.NaN,t&&i.geometryReleaseAssert(0),e&&(this.m_XYToRadians=e.getUnit().getUnitFactor(),this.m_PrimeMeridianDegrees=e.getPrimem().getLongitude())},initFromGcsAndVcs(e,t){const i=e?e.getPECoordSys():null,n=t?t.getPEVerticalCoordSys():null;this.initFromGcsAndVcsPe(i,n)},processUnitParams(e){Number.isNaN(this.m_heightMetersPerUnit)&&(this.m_heightMetersPerUnit=e.m_heightMetersPerUnit,this.m_heightSign=e.m_heightSign,this.m_heightZ0=e.m_heightZ0),Number.isNaN(this.m_XYToRadians)&&(this.m_XYToRadians=e.m_XYToRadians,this.m_PrimeMeridianDegrees=e.m_PrimeMeridianDegrees)}}}class Fn{constructor(t){this.m_constantsLoaded=-1,this.m_isUsable=-1,this.m_inputSR=null,this.m_outputSR=null,this.m_inputSRHorz=null,this.m_outputSRHorz=null,this.m_inputVCS=null,this.m_outputVCS=null,this.m_hashCode=0,this.m_areaOfUse=new s.Envelope,this.m_inputUnitParams=Vn(),this.m_outputUnitParams=Vn(),i.geometryReleaseAssert(t),this.m_geogTran=t,this.m_vertTran=null,this.m_latestID=e.peFactory.getCode(this.m_geogTran),this.m_latestID<0&&(this.m_latestID=0);const n=this.m_geogTran.getGeogcs1();e.peFactory.getCode(n);const r=this.m_geogTran.getGeogcs2();e.peFactory.getCode(r),this.initUnitParams()}getLatestId(){return this.m_latestID}getText(){return this.m_geogTran?this.m_geogTran.toString():(i.geometryReleaseAssert(0),"")}getGeogtran(){return this.m_geogTran}getVerttran(){return null}loadConstants(t){let n=this.m_constantsLoaded;if(-1===n){if(!t){this.m_geogTran||i.throwInternalErrorException("vcs not impl");const n=this.m_geogTran.getParameters();null!==n[e.peDefs.PE_PARM_ND]&&(t=0===n[e.peDefs.PE_PARM_ND].getValue())}n=this.m_geogTran.loadConstants()?1:0,this.m_constantsLoaded=n}return 0!==n}isUsable(){let e=this.m_isUsable;return-1===e&&(this.m_geogTran?this.m_isUsable=e=this.m_geogTran?1:0:this.m_isUsable=e=this.m_vertTran?1:0),1===e}getInputSr(e){return this.updateSrs(),e?this.m_inputSR:this.m_inputSRHorz}getOutputSr(e){return this.updateSrs(),e?this.m_outputSR:this.m_outputSRHorz}getHashCode(){let e=this.m_hashCode;return 0===e&&(e=this.m_latestID>0?r.hashInt32(this.m_latestID):r.hashString(this.getText()),0===e&&(e=345),this.m_hashCode=e),e}isGeogtran(){return null!==this.m_geogTran}prepareOrThrow(){}getName(){return this.isGeogtran()?this.getGeogtran().getName():(i.throwNotImplementedException("vcs not impl"),"")}updateSrs(){if(this.m_inputSR||this.m_inputVCS)return;let e,t,n,s,r,o;if(this.m_geogTran){const i=this.m_geogTran.getGeogcs1(),a=rr(i),l=this.m_geogTran.getGeogcs2(),c=rr(l);let h=-1,u=-1;h=a.getVcsCode(),u=c.getVcsCode(),n=Ar(i,null,0,1),s=Ar(l,null,0,1),h>0&&u>0?(r=On(h),o=On(u),e={},t={}):(e=n,t=s)}else i.geometryReleaseAssert(0);this.m_inputSR||this.m_inputVCS||(this.m_inputSR=e,this.m_outputSR=t,this.m_inputSRHorz=n,this.m_outputSRHorz=s,this.m_inputVCS=r,this.m_outputVCS=o)}initUnitParams(){if(this.m_inputUnitParams.m_heightSign=1,this.m_inputUnitParams.m_heightMetersPerUnit=Number.NaN,this.m_inputUnitParams.m_heightZ0=0,this.m_outputUnitParams.m_heightSign=1,this.m_outputUnitParams.m_heightMetersPerUnit=Number.NaN,this.m_outputUnitParams.m_heightZ0=0,this.m_inputUnitParams.m_XYToRadians=Number.NaN,this.m_inputUnitParams.m_PrimeMeridianDegrees=Number.NaN,this.m_outputUnitParams.m_XYToRadians=Number.NaN,this.m_outputUnitParams.m_PrimeMeridianDegrees=Number.NaN,this.m_vertTran)i.geometryReleaseAssert(0);else if(this.m_geogTran){const e=this.m_geogTran;let t=e.getGeogcs1();this.m_inputUnitParams.m_XYToRadians=t.getUnit().getUnitFactor(),this.m_inputUnitParams.m_PrimeMeridianDegrees=t.getPrimem().getLongitude(),t=e.getGeogcs2(),this.m_outputUnitParams.m_XYToRadians=t.getUnit().getUnitFactor(),this.m_outputUnitParams.m_PrimeMeridianDegrees=t.getPrimem().getLongitude()}}}function Ln(e,t,i,n,s,r,o){let a=null;t&&(a=t.getPEVerticalCoordSys());let l=null;e&&(l=e.getPECoordSys());let c=null;n&&(c=n.getPEVerticalCoordSys());let h=null;if(i&&(h=i.getPECoordSys()),!(l||a||h||c))return!1;const u=Vn();u.initFromGcsAndVcsPe(l,a);const m=Vn();return m.initFromGcsAndVcsPe(h,c),kn(u,m,s,r,o)}function qn(e,t,i,n,s,r,o,a){const l=t,c=e,h=Vn();h.initFromGcsAndVcsPe(c,l),a.assign(n?i.m_outputUnitParams:i.m_inputUnitParams),a.processUnitParams(h),h.processUnitParams(a),o>0&&kn(h,a,s,r,o)}function Hn(e,t,i,n,s,r,o,a,l){const c=Vn(),h=Vn();c.assign(i?t.m_inputUnitParams:t.m_outputUnitParams),h.assign(s?n.m_outputUnitParams:n.m_inputUnitParams),c.processUnitParams(e),h.processUnitParams(c),c.processUnitParams(h),a>0&&kn(c,h,r,o,a),l.assign(h)}function Un(t,i,n,s,r,o,a){const l=i.getVerttran(),c=i.getGeogtran();if(a.assign(n?i.m_inputUnitParams:i.m_outputUnitParams),a.processUnitParams(t),o>0){i.prepareOrThrow();const t=n?e.peDefs.PE_TRANSFORM_2_TO_1:e.peDefs.PE_TRANSFORM_1_TO_2;l?Os():Gs(c,o,s,r,t)}}class zn{supportsCurves(){return!0}accelerateGeometry(e,t,i){return Yn(e,t,i)}canAccelerateGeometry(e){return Bn(e)}}function Yn(e,t,r){if(!Bn(e))return!1;s.calculateToleranceFromGeometryForRelGeom(t,e,!1);let o=0;const a=e.getGeometryType();return i.isMultiPath(a)&&n.canUseQuadTree(e)&&0!==r&&(o|=e.getImpl().buildQuadTreeAccelerator(r)?1:0),i.isMultiPath(a)&&n.canUseQuadTreeForPaths(e)&&0!==r&&(o|=e.getImpl().buildQuadTreeForPathsAccelerator(r)?1:0),o>0}function Bn(e){return n.canUseQuadTree(e)||n.canUseQuadTreeForPaths(e)}class Xn extends zn{getOperatorType(){return 8}execute(e,t,i,n){return Ze(e,t,i,1,n)}}class jn{getOperatorType(){return 10002}supportsCurves(){return!0}accelerateGeometry(e,t,i){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,i,n){return new Wn(e,t,i,n)}execute(e,t,i,n){return this.executeMany(new h.SimpleGeometryCursor([e]),new h.SimpleGeometryCursor([t]),i,n).next()}}class Wn extends h.GeometryCursor{constructor(e,t,i,s){super(),this.m_progressTracker=s,this.m_index=-1,this.m_inputGeoms=e,this.m_spatialReference=i;const r=t.next();this.m_geomSubtractor=r||new n.Polygon}next(){const e=this.m_inputGeoms.next();return e?(i.throwIfMesh(e),i.throwIfGeometryCollection(e),this.m_index=this.m_inputGeoms.getGeometryID(),function(e,o,a,c){if(e.isEmpty()||o.isEmpty())return e;const h=e.getDimension(),u=o.getDimension();if(h>u)return e;const m=e.getGeometryType(),d=o.getGeometryType(),p=new t.Envelope2D,g=new t.Envelope2D,_=new t.Envelope2D;e.queryEnvelope(p),o.queryEnvelope(g),_.setCoords({env2D:p}),_.mergeEnvelope2D(g);const f=s.calculateToleranceFromGeometryForOp(a,_,!0),y=s.adjustToleranceForTEClustering(f),x=new t.Envelope2D;if(x.setCoords({env2D:p}),x.inflateCoords(y,y),!x.isIntersecting(g))return e;if(1===h&&2===u){const r=function(e,r,o,a,l){const c=new s.Envelope;e.queryEnvelope(c);const h=new t.Envelope2D;r.queryEnvelope(h),c.merge(h);const u=.1*c.width(),m=.1*c.height();c.inflateCoords(u,m);const d=new n.Polygon;d.addEnvelope(c,!1);const p=d.getImpl();if(o===i.GeometryType.enumPolygon){const e=r.getImpl();p.add(e,!0)}else p.addEnvelope(r,!0);return new Yi(d,a,-1,l).tryFastImplementation(e)}(e,o,d,a,c);if(r)return r}if(m===i.GeometryType.enumPoint){let a;switch(i.isSegment(d)?(a=new n.Polyline({vd:o.getDescription()}),a.addSegment(o,!0)):a=o,d){case i.GeometryType.enumPolygon:return function(e,t,i){return 0===Zt(t,e,i.total())?e:e.createInstance()}(e,a,f);case i.GeometryType.enumPolyline:return function(e,i,n){const o=e.getXY(),a=i.querySegmentIterator(),l=s.adjustToleranceForTEClustering(n),c=l*l;for(;a.nextPath();)for(;a.hasNextSegment();){const i=a.nextSegment(),s=new t.Envelope2D;if(i.queryEnvelope(s),s.inflateCoords(l,l),!s.contains(o))continue;if(i.isIntersectingPoint(o,n.total()))return e.createInstance();let h=i.getStartXY();if(r.Point2D.sqrDistance(o,h)<=c)return e.createInstance();if(h=i.getEndXY(),r.Point2D.sqrDistance(o,h)<=c)return e.createInstance()}return e}(e,a,f);case i.GeometryType.enumMultiPoint:return function(e,t,i){const n=t.getImpl().getAttributeStreamRef(0),o=t.getPointCount(),a=e.getXY(),l=s.adjustToleranceForTEClustering(i),c=l*l,h=new r.Point2D;for(let t=0;t<o;t++)if(n.queryPoint2D(2*t,h),r.Point2D.sqrDistance(h,a)<=c)return e.createInstance();return e}(e,a,f);case i.GeometryType.enumEnvelope:return function(e,i,n){const s=new t.Envelope2D;i.queryEnvelope(s),s.inflate(n.total());const r=e.getXY();return s.contains(r)?e.createInstance():e}(e,a,f);case i.GeometryType.enumPoint:return function(e,t,i){const n=s.adjustToleranceForTEClustering(i),o=n*n,a=e.getXY(),l=t.getXY();return r.Point2D.sqrDistance(a,l)<=o?e.createInstance():e}(e,a,f);default:i.throwInvalidArgumentException("invalid shape type")}}else if(m===i.GeometryType.enumMultiPoint)switch(d){case i.GeometryType.enumPolygon:return function(e,i,n){const s=new t.Envelope2D;i.queryEnvelope(s),s.inflate(n.total());const o=e.getPointCount();let a=!1;const l=r.makePrimitiveArray(o,!1),c=new r.Point2D;for(let t=0;t<o;t++)e.queryXY(t,c),s.contains(c)&&0!==Qt(i,c,n.total())&&(a=!0,l[t]=!0);if(!a)return e;const h=e.createInstance();for(let t=0;t<o;t++)l[t]||h.addPoints(e,t,t+1);return h}(e,o,f);case i.GeometryType.enumEnvelope:return function(e,i,n){const s=new t.Envelope2D;i.queryEnvelope(s),s.inflate(n.total());const o=e.getPointCount();let a=!1;const l=r.makePrimitiveArray(o,!1),c=new r.Point2D;for(let t=0;t<o;t++)e.queryXY(t,c),s.contains(c)&&(a=!0,l[t]=!0);if(!a)return e;const h=e.createInstance();for(let t=0;t<o;t++)l[t]||h.addPoints(e,t,t+1);return h}(e,o,f);case i.GeometryType.enumPoint:return function(e,t,i){const n=e.getImpl().getAttributeStreamRef(0),o=e.getPointCount(),a=t.getXY();let l=!1;const c=r.makePrimitiveArray(o,!1),h=s.adjustToleranceForTEClustering(i),u=h*h,m=new r.Point2D;for(let e=0;e<o;e++)n.queryPoint2D(2*e,m),r.Point2D.sqrDistance(m,a)<=u&&(l=!0,c[e]=!0);if(!l)return e;const d=e.createInstance();for(let t=0;t<o;t++)c[t]||d.addPoints(e,t,t+1);return d}(e,o,f)}const v=new t.Envelope2D(p);return v.inflate(100*f.total()),function(e,r,o,a){if(e.isEmpty()||r.isEmpty()||e.getDimension()>r.getDimension())return Di(Ii(e),e,0,"-");const l=new t.Envelope2D;e.queryEnvelope(l);const c=new t.Envelope2D;r.queryEnvelope(c);const h=new t.Envelope2D;h.setCoords({env2D:l}),h.mergeEnvelope2D(c);const u=s.calculateToleranceFromGeometryForOp(o,h,!0),m=c.clone(),d=s.adjustToleranceForTEClustering(u);if(m.inflateCoords(d,d),!l.isIntersecting(m))return Di(Ii(e),e,0,"-");const p=new Ti(a),g=new n.EditShape,_=g.addGeometry(Ii(e)),f=g.addGeometry(Ii(r));let y=0,x=0,v=null;if(g.hasCurves()){v=new li;const e=g.getEnvelope2D(a);x=oi(u.total());const t=ri(u.total(),e);y=ai(t,x),ii(g,t,u.total(),0,v,null,a)}p.setEditShapeCrackAndCluster(g,u.add(y));const P=p.difference(_,f);null!==v&&v.stitchCurves(g,P,x,!0);const b=Di(g.getGeometry(P),e,0,"-");return yi(b.getGeometryType())&&(b.getImpl().setIsSimple(4,u.total()),b.getGeometryType()===i.GeometryType.enumPolygon&&b.getImpl().updateOGCFlagsProtected()),b}(e,l.clip$1(o,v,0,0,c),a,c)}(e,this.m_geomSubtractor,this.m_spatialReference,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class Zn{getOperatorType(){return 10001}supportsCurves(){return!0}accelerateGeometry(e,t,i){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,i,n=0){return new $n(e,t,i,n)}execute(e,t,n,s){const r=new h.SimpleGeometryCursor([e,t]),o=new $n(r,n,s,0).next();return o||i.throwInternalErrorException("null output"),o}}class Qn{constructor(){this.binVertexCount=0,this.geometries=[]}addPair(e){this.binVertexCount+=e.vertexCount,this.geometries.push(e)}sort(){this.geometries.sort(((e,t)=>function(e,t){return r.Point2D.compareZorder(e.location,t.location)?-1:e.location.equals(t.location)?0:1}(e,t)))}geomCount(){return this.geometries.length}geomPairs(){return this.geometries}clear(){this.binVertexCount=0,this.geometries.length=0}getBinVertexCount(){return this.binVertexCount}}class $n extends h.GeometryCursor{constructor(e,t,i,n,s=!1){super(),this.m_index=-1,this.m_currentDim=-1,this.m_bDone=!1,this.m_unionBins=[],this.m_readyGeoms=r.makeNullArray(4),this.m_dimGeomCounts=r.makePrimitiveArray(4,0),this.m_addedGeoms=0,this.m_maxDimension=-1,this.m_bHadGeometry=r.makePrimitiveArray(4,!1),this.m_complexUnionGeoms=r.makeNullArray(4),this.m_totalNonEmptyGeomCounters=r.makePrimitiveArray(4,0),this.m_progressTracker=i,this.m_bUnionAllDimensions=!!(4&n),this.m_bPreserveAllPathEnds=!!(8&n),this.m_inputGeoms=e,this.m_spatialReference=t,this.m_options=n,this.m_bIs3D=s}next(){if(this.m_bDone&&this.m_currentDim===this.m_maxDimension)return null;for(;!this.step_(););if(-1===this.m_maxDimension)return null;if(this.m_bUnionAllDimensions){if(-1===this.m_currentDim)for(let e=0;e<=this.m_maxDimension;e++)if(this.m_bHadGeometry[e]){this.m_complexUnionGeoms[e]=this.getResultGeometry(e);for(let t=e+1;t<=this.m_maxDimension;t++)this.m_complexUnionGeoms[t]=this.getResultGeometry(t),this.m_bHadGeometry[t]&&!this.m_complexUnionGeoms[t].isEmpty()&&(this.m_bIs3D?i.geometryReleaseAssert(0):this.m_complexUnionGeoms[e]=(new jn).execute(this.m_complexUnionGeoms[e],this.m_complexUnionGeoms[t],this.m_spatialReference,this.m_progressTracker))}for(;this.m_currentDim++,(this.m_currentDim>this.m_maxDimension||this.m_currentDim<0)&&i.throwInternalErrorException(""),!this.m_bHadGeometry[this.m_currentDim];);if(this.m_index++,0===this.m_currentDim&&this.m_complexUnionGeoms[this.m_currentDim].getGeometryType()===i.GeometryType.enumPoint){const e=new n.MultiPoint({vd:this.m_complexUnionGeoms[this.m_currentDim].getDescription()});return this.m_complexUnionGeoms[this.m_currentDim].isEmpty()||e.add(this.m_complexUnionGeoms[this.m_currentDim]),e}return this.m_complexUnionGeoms[this.m_currentDim]}return this.m_index=0,this.m_currentDim=this.m_maxDimension,this.getResultGeometry(this.m_maxDimension)}getGeometryID(){return this.m_index}getRank(){return 1}tock(){return this.step_()}getResultGeometry(e){return this.m_readyGeoms[e]}finishDim(e,t,r){let o=t;if(!r)return 16&this.m_options?(o=Ci([o],1,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D),o):o;if(1&this.m_options)return o;if(1===e)if(8&this.m_options||!(16&this.m_options||this.m_totalNonEmptyGeomCounters[e]>1))1===this.m_totalNonEmptyGeomCounters[e]&&(this.m_bIs3D?i.geometryReleaseAssert(0):o=(new Ui).execute(o,this.m_spatialReference,!1,this.m_progressTracker));else{o=Ci([o],1,this.m_spatialReference,this.m_progressTracker,16|this.m_options,this.m_bIs3D);const e=[0],t=o.getImpl().getIsSimple(0,e);i.geometryReleaseAssert(this.m_bIs3D||s.isAtLeastPlanarSimple(t))}else this.m_bIs3D?i.geometryReleaseAssert(0):o=(new Ui).execute(o,this.m_spatialReference,!1,this.m_progressTracker);if(0===e&&o.getGeometryType()===i.GeometryType.enumPoint){const e=new n.MultiPoint({vd:o.getDescription()});o.isEmpty()||e.add(o),o=e}return o}static getLevel(e){const t=i.vertexCount(e);let n=t>0?(Math.log(t)-Math.log(32))/Math.log(4):0;return n<0&&(n=0),Math.floor(n)}step_(){if(this.m_bDone)return!0;let e;if(this.m_inputGeoms?(e=this.m_inputGeoms.next(),null===e?(this.m_bDone=!0,this.m_inputGeoms=null):(this.checkAndThrow(e),e.isEmpty()||this.m_totalNonEmptyGeomCounters[e.getDimension()]++)):e=null,null!==e){const t=e.getDimension();this.m_bHadGeometry[t]=!0,(t>=this.m_maxDimension||this.m_bUnionAllDimensions)&&(this.addGeom(t,!1,e),t>this.m_maxDimension&&!this.m_bUnionAllDimensions&&this.removeAllBinsWithLowerDimension(t))}if(this.m_addedGeoms>0)for(let e=0;e<=this.m_maxDimension;e++){for(;this.m_dimGeomCounts[e]>1;){const t=this.collectGeometriesToUnion(e);if(null===t)break;{let i;i=1&this.m_options?Ci(t,t.length,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D):wi(t,t.length,this.m_spatialReference,this.m_progressTracker,8|this.m_options,this.m_bIs3D),this.addGeom(e,!0,i)}}if(this.m_bDone&&(i.geometryReleaseAssert(this.m_dimGeomCounts[e]<=1),0!==this.m_dimGeomCounts[e])){const t=this.m_unionBins[e].entries().next().value,i=t[1].geomPairs()[0].geom,n=t[1].geomPairs()[0].bUnioned;this.m_unionBins[e].clear(),this.m_readyGeoms[e]=this.finishDim(e,i,n)}}return this.m_bDone}addGeom(e,n,s){const o={geom:null,vertexCount:-1,bUnioned:!1,location:new r.Point2D};o.geom=s;const a=i.vertexCount(s);o.vertexCount=a;const l=t.Envelope2D.constructEmpty();s.queryEnvelope(l),o.location=a>0?l.getCenter():new r.Point2D(0,0);const c=$n.getLevel(s);if(e+1>this.m_unionBins.length)for(;this.m_unionBins.length<Math.max(2,e+1);)this.m_unionBins.push(new Map);let h=null;const u=this.m_unionBins[e].get(c);u&&(h=u),null===h&&(h=new Qn,this.m_unionBins[e].set(c,h)),o.bUnioned=n,h.addPair(o),this.m_dimGeomCounts[e]++,this.m_addedGeoms++,this.m_maxDimension=Math.max(this.m_maxDimension,e)}removeAllBinsWithLowerDimension(e){for(let t=0;t<e;t++)this.m_unionBins[t].clear(),this.m_addedGeoms-=this.m_dimGeomCounts[t],this.m_dimGeomCounts[t]=0}collectGeometriesToUnion(e){if(1&this.m_options&&!this.m_bDone)return null;let t=null;const i=[];for(const t of this.m_unionBins[e].keys())i.push(t);r.numericSort(i);for(let n=0;n<i.length;n++){if(-1===i[n])continue;const s=this.m_unionBins[e].get(i[n]);{const r=5e3,o=4,a=s.getBinVertexCount()>r&&s.geomCount()>=o;if(this.m_bDone||a){for(let s=0;s<n;s++){if(-1===i[s])continue;const n=this.m_unionBins[e].get(i[s]);n.sort(),this.m_dimGeomCounts[e]-=n.geomCount(),this.m_addedGeoms-=n.geomCount();for(const e of n.geomPairs())t||(t=new Array),t.push(e.geom);n.clear(),this.m_unionBins[e].delete(i[s]),i[s]=-1}s.sort(),this.m_dimGeomCounts[e]-=s.geomCount(),this.m_addedGeoms-=s.geomCount();for(const e of s.geomPairs())t||(t=new Array),t.push(e.geom);if(s.clear(),this.m_unionBins[e].delete(i[n]),i[n]=-1,!this.m_bDone)break}}}return t}checkAndThrow(e){this.m_bIs3D&&(e.getDimension()>1&&i.throwInvalidGeometryTypeFor3DOps(),e.hasAttribute(1)||i.throwInvalidArgumentException("Geometry must have Zs")),i.throwIfMesh(e)}}class Kn extends zn{getOperatorType(){return 3}execute(e,t,i,n=null){return Ze(e,t,i,4,n)}}function Jn(e,o,l){const c=o.getGCSSplitLines();if(null===c)return e;const h=o.getGCS(),u=h.getPannableExtent().width(),m=t.Envelope2D.constructEmpty();e.queryLooseEnvelope(m);const d=r.Envelope1D.constructEmpty();m.queryIntervalX(d);const p=c.querySegmentIterator();let g=null;const _=new a.Transformation2D;for(;p.nextPath();)for(;p.hasNextSegment();){const e=p.nextSegment(),t=e.queryInterval(0,0),i=r.Envelope1D.constructEmpty();i.setCoordsFromEnvelope(t);let s=0;for(;i.vmax>d.vmin;)i.move(-u),s--;for(;i.vmin<=d.vmax;){if(i.isIntersecting(d)){null===g&&(g=new n.Polyline);const t=new n.Line({start:e.getStartXY(),end:e.getEndXY()});0!==s&&(_.setShiftCoords(s*u,0),t.applyTransformation(_)),g.addSegment(t,!0)}i.move(u),++s}}if(null!==g){const t=s.calculateToleranceFromGeometryForOpFromGeom(h,g,!0);return function(e,t,n,s){const r=t.getGeometryType();if(i.isMultiPath(r))return new be(s).crackAWithBMultiPath_(e,t,n);i.throwNotImplementedException("crack_A_with_B")}(e,g,s.adjustToleranceForTEClustering(t),l)}return e}function es(t,i,n){let s=t.getName();return Hr(s)||(n||i>0?(s=t.toString(e.peDefs.PE_STR_NAME_CANON|e.peDefs.PE_STR_AUTH_NONE),s=s.toLocaleUpperCase("en-US")):s=t.toString(e.peDefs.PE_STR_AUTH_TOP)),s}function ts(t,n=-1){if((n>1||n<-1)&&i.throwInvalidArgumentException("verbosity"),-1===n)return t.toString();{const i=0===n?e.peDefs.PE_STR_AUTH_TOP:e.peDefs.PE_STR_AUTH_ALL;return t.toString(i)}}function is(e,n,r,o){if(e.isEmpty()||1===r)return e;const c=e.getGeometryType();if(c===i.GeometryType.enumPoint){const t=e,i=t.getXY();return 0===rs([i],1,n,r)||i.isNAN()?t.setEmpty():t.setXY(i),e}if(c===i.GeometryType.enumMultiPoint){const t=e,i=e.createInstance(),o=t.getPointCount();i.reserve(o);const a=t.getAttributeStreamRef(0),l=t.getDescription().getAttributeCount()>1,c=new s.Point,h=Float64Array.from(a.getArray());if(rs(h,o,n,r)>0)for(let e=0,n=2*o;e<n;e+=2)Number.isNaN(h[e])||(l?(t.getPointByVal(e>>1,c),c.setXYCoords(h[e],h[e+1]),i.add(c)):i.addXY(h[e],h[e+1]));return i}let h=e;const u=n.getOneDegreeGCSUnit(),m=90*u,d=180*u,p=360*u,g=n.getCentralMeridian(),_=.5*u,f=t.Envelope2D.constructEmpty();h.queryEnvelope(f);const y=n.getGCSHorizon(),x=n.getGCSHorisonIsInclusive(),v=y.getGeometryType()===i.GeometryType.enumEnvelope,P=t.Envelope2D.constructEmpty();y.queryEnvelope(P);const b=n.getGCS();if(2!==r&&4!==r||(P.xmin=g-d,P.xmax=P.xmin+p),4===r){if(!(f.width()>p-u)){const e=t.Envelope2D.constructEmpty();e.setCoords({xmin:f.xmin-u,ymin:P.ymin,xmax:f.xmax+u,ymax:P.ymax}),h=(new l.OperatorClip).execute(h,e,b,o);let i=Math.floor((g-f.getCenterX())/p);for(f.move(i*p,0);f.xmin>P.xmax;)i-=1,f.move(-p,0);for(;f.xmin<P.xmin;)i+=1,f.move(p,0);if(0!==i){const e=new a.Transformation2D;e.setShiftCoords(i*p,0),h.applyTransformation(e)}return h}r=2}if(2===r&&(P.xmin=g-d,P.xmax=P.xmin+p),f.ymin<-m||f.ymax>m){const e=t.Envelope2D.constructEmpty();if(e.setCoords({xmin:f.xmin-u,ymin:-m,xmax:f.xmax+u,ymax:m}),h=(new l.OperatorClip).execute(h,e,b,o),h.isEmpty())return h;h.queryEnvelope(f)}if(x&&(P.ymax<f.ymin||P.ymin>f.ymax))return h.createInstance();f.width()>p&&(h=gs(h,g-d,p,b,!0,0,!0,o),h.queryEnvelope(f));let E=(S=f.xmin,C=f.xmax,w=P.xmin,T=P.xmax,S>=w&&C<=T?0:ps(.5*(C+S),w,T,p));var S,C,w,T;if(0!==E&&f.move(E,0),f.xmax>P.xmax||f.xmin<P.xmin){if(f.xmax>P.xmax)for(;f.xmin>=P.xmax;)f.move(-p,0),E-=p;for(;f.xmin<P.xmax-p;)f.move(p,0),E+=p}const D=s.calculateToleranceFromGeometryForRelGeom(b,y,!1);if(0!==E){const e=new a.Transformation2D;e.setShiftCoords(E,0),h.applyTransformation(e),E=0}if(x){if(v&&P.containsEnvelope(f))return h;const e=new Array(2);for(let t=0;t<2;t++){let n;if(v?n=i.isMultiPath(c)?l.clip$1(h,P,D,_,o):l.clip$1(h,P,D,0,o):(n=(new Xi).execute(h,y,b,o),n===y&&(n=n.clone())),P.xmin<=f.xmin&&P.xmax>=f.xmax)return n;if(P.xmin>=f.xmin&&P.xmax<=f.xmax)return n;if(e[t]=n,0===t){f.move(-p,0);const e=new a.Transformation2D;e.setShiftCoords(-p,0),h.applyTransformation(e)}}return i.isMultiPath(c)?e[0].add(e[1],!1):i.throwInternalErrorException("intersect_with_GCS_horizon: unexpected geometry type"),e[0]}{if(P.ymax<f.ymin||P.ymin>f.ymax)return h;let e=0;for(;!h.isEmpty()&&f.xmax>P.xmin;){if(0!==e){const t=new a.Transformation2D;t.setShiftCoords(e,0),h.applyTransformation(t)}if((new Kn).execute(h,y,b,o)||(h=(new jn).execute(h,y,b,o),y===h&&(h=h.clone())),0!==e){const t=new a.Transformation2D;t.setShiftCoords(-e,0),h.applyTransformation(t)}e-=p,f.move(-p,0)}return h}}function ns(t,i,a,l,c,h){const u={stack:[],error:void 0,hasError:!1};try{if(2===h)return function(e,t,i,o,a){if(Math.abs(i.x-o.x)>Math.PI)return Number.NaN;if(Math.abs(i.y)>r.geometryHalfPi||Math.abs(o.y)>r.geometryHalfPi)return Number.NaN;if((Math.abs(i.y)===r.geometryHalfPi||Math.abs(o.y)===r.geometryHalfPi)&&i.x!==o.x)return Number.NaN;const{first:l,second:c}=r.minMax(i.x,o.x);let h=a;if(h=v(h,l,c),!r.Envelope1D.construct(i.x,o.x).containsCoordinate(h))return Number.NaN;const u=n.EPoint2D.constructPoint2D(i),m=n.EPoint2D.constructPoint2D(o),d=E(1,t,u),p=E(1,t,m),g=d.crossProductVector(p);if(g.z.isZero())return i.y;const _=g.x.divE(g.z.negate()),f=g.y.divE(g.z.negate()),y=_.mulE(_).addE(f.mulE(f)).sqrt();if(y.isZero()||_.isZero()&&f.isZero())return i.y;const x=Math.atan2(f.value(),_.value());let b=Math.atan2(y.value()*Math.cos(x-h),1-t);const S=P(1,t,r.Point2D.construct(h,b)),C=s.Point3D.construct(S.x,S.y,-S.z),w=g.value().dotProduct(S),T=g.value().dotProduct(C);return Math.abs(T)<Math.abs(w)&&(b=-b),b}(0,i,a,l,c);if(Math.abs(a.x-l.x)>=Math.PI||!qs(a.x,l.x,c))return Number.NaN;a.x>l.x&&(l=r.swap(a,a=l));const m=o.__addDisposableResource(u,new e.PeDoubleClass,!1),d=o.__addDisposableResource(u,new e.PeDoubleClass,!1),p=o.__addDisposableResource(u,new e.PeDoubleClass,!1),g=a.clone();e.peLineType.geodeticDistance(t,i,a.x,a.y,l.x,l.y,d,m,null,h);const _=d.val;let f=0,y=1;for(;_*(y-f)>1e-12*t;){const n=.5*(f+y);if(e.peLineType.geodeticCoordinate(t,i,a.x,a.y,_*n,m.val,d,p,h),g.x=d.val,g.y=p.val,g.x===c)return g.y;if(qs(a.x,g.x,c))y=n;else{if(!qs(l.x,g.x,c))return Number.NaN;f=n}}return g.y}catch(e){u.error=e,u.hasError=!0}finally{o.__disposeResources(u)}}function ss(e,t,i,n){for(let s=0,r=0;s<n;s++,r+=2)t[i+s].x=e[r],t[i+s].y=e[r+1]}function rs(e,n,o,a){if(0===n||1===a)return n;const l=function(e,t){let i;if(Array.isArray(e)){const n=e;i=new Float64Array(2*t);for(let e=0,s=0;e<t;e++,s+=2)i[s]=n[e].x,i[s+1]=n[e].y}else i=e;return i}(e,n);if(2===a){const t=o.getPannableExtentInGCS();let i=n;for(let e=0,s=2*n;e<s;e+=2)(l[e+1]>t.ymax||l[e+1]<t.ymin)&&(l[e]=Number.NaN,i--);return i?(_s(l,n,t.xmin,t.width(),!0),e!==l&&ss(l,e,0,n),i):0}const c=o.getOneDegreeGCSUnit(),h=90*c,u=180*c,m=360*c;let d=n;for(let e=0,t=2*n;e<t;e+=2)(l[e+1]>h||l[e+1]<-h)&&(l[e]=Number.NaN,d--);if(!d)return 0;const p=t.Envelope2D.constructEmpty();p.setFromPoints(l,n);const g=o.getGCSHorizon(),_=o.getGCSHorisonIsInclusive(),f=g.getGeometryType()===i.GeometryType.enumEnvelope,y=t.Envelope2D.constructEmpty();if(g.queryEnvelope(y),_&&(y.ymax<p.ymin||y.ymin>p.ymax))return 0;if(_)if(_s(l,n,y.getCenterX()-u,m,!0),d=n,f)for(let e=0,t=2*n;e<t;e+=2)y.containsCoords(l[e],l[e+1])||(l[e]=Number.NaN,d--);else{const e=s.calculateToleranceFromGeometryForRelGeom(o.getGCS(),g,!1),t=new r.Point2D;for(let i=0,s=2*n;i<s;i+=2)t.setCoords(l[i],l[i+1]),0!==Qt(g,t,e)||(l[i]=Number.NaN,d--)}else{_s(l,n,-u,m,!0),d=n;const e=s.calculateToleranceFromGeometryForRelGeom(o.getGCS(),g,!1),t=new r.Point2D;for(let i=0,s=2*n;i<s;i+=2){t.setCoords(l[i],l[i+1]),t.isNAN()&&d--;const n=ps(t.x,y.xmin,y.xmax,m);t.x+=n,0!==Qt(g,t,e)&&(l[i]=Number.NaN,d--)}}return d>0&&Array.isArray(e)&&ss(l,e,0,n),d}function os(e,t,n,s,r,o){if(t.isPannable()||i.throwInvalidArgumentException("fold_into_360_degree_range"),e.isEmpty())return e;let a,l;if(2===t.getCoordinateSystemType()){const e=t.getPannableExtent();l=e.xmin,a=e.width()}else{const e=t.getOneDegreeGCSUnit();a=360*e,l=n-180*e}return gs(e,l,a,t,s,r,!0,o)}function as(e,t,i,n){let s,r;if(2===i.getCoordinateSystemType()){const e=i.getPannableExtent();s=e.xmin,r=e.width()}else{const e=i.getOneDegreeGCSUnit();r=360*e,s=n-180*e}_s(e,t,s,r)}function ls(e,t){const i=t.width();let n=r.fmod(e-t.vmin,i);return n<0&&(n+=i),t.snapClip(n+t.vmin)}function cs(e,t,i){return e>t.xmax&&e-t.xmax<i?t.xmax:e<t.xmin&&t.xmin-e<i?t.xmin:e}function hs(e,t,i){if(e[0]<t.vmin||e[0]>t.vmax||i&&e[0]===t.vmax){const i=t.width();return e[0]+=Math.ceil((t.vmin-e[0])/i)*i,e[0]=t.snapClip(e[0]),!0}return!1}function us(e,t,i,r,o){const a=new n.EditShape,l=a.addGeometry(e);return ms(a,l,t,s.calculateToleranceFromGeometryForRelGeom(t,e,!1),i,r,o),a.getGeometry(l)}function ms(t,s,a,l,c,h,u){const m={stack:[],error:void 0,hasError:!1};try{i.geometryReleaseAssert(Cr()),a.isPannable()||i.throwInvalidCallException("insert_geodetic_points");const d=a.getPannableExtent(),p=a.getGCS(),g=Er();p.querySpheroidData(g);const _=p.getUnit().getUnitToBaseFactor(),f=g.majorSemiAxis,y=g.e2;let x=0;const v=new r.Envelope1D;d.queryIntervalX(v);let P=null;const b=r.makePrimitiveArray(4,Number.NaN);2===a.getCoordinateSystemType()?(P=a.getPECoordSys(),h?(b[0]=ls(u,v),b[1]=d.getCenterY(),e.peCSTransformations.projToGeog(P,1,b),x=b[0]*_):(b[0]=d.getCenterX(),b[1]=u,e.peCSTransformations.projToGeog(P,1,b),x=b[1]*_)):x=u*_,h||0===x||2===c||i.throwInvalidCallException("insert_geodetic_points: 1");const E=o.__addDisposableResource(m,new e.PeDoubleClass,!1),S=new r.Point2D,C=new r.Point2D,w=new r.Point2D,T=new r.Point2D,D=new r.Point2D,A=new r.Point2D;for(let i=t.getFirstPath(s);i!==n.nullHandle;i=t.getNextPath(i)){const s=t.getFirstVertex(i);t.queryXY(s,w);let o=!1;const m=t.getNextVertex(s);for(let i=m;i!==n.nullHandle;i=t.getNextVertex(i)){if(i===m){if(o)break;o=!0}if(t.queryXY(i,T),h&&(l<u-w.x&&T.x-u>l||l<u-T.x&&w.x-u>l)||!h&&(0!==u||l<-w.y&&T.y>l||l<-T.y&&w.y>l))do{if(Math.abs(w.x-T.x)>=.5*v.width())break;2===a.getCoordinateSystemType()?(b[0]=ls(w.x,v),b[1]=w.y,b[2]=ls(T.x,v),b[3]=T.y,ws(P,2,b,0),D.x=b[0]*_,D.y=b[1]*_,A.y=b[3]*_):(D.x=w.x*_,D.y=w.y*_,A.y=T.y*_),A.x=(T.x-w.x)*Math.PI*2/v.width()+D.x;let n=0;const s=r.makeObjectArray(r.Point2D,2);if(h){if(C.x=x,C.y=ns(f,y,D,A,x,c),Number.isNaN(C.y))break;s[0]=C,n=1}else if(2===c){const e=[0,0];if(n=I(0,y,D,A,x,e),!n)break;s[0].x=e[0],s[0].y=x,2===n&&(s[1].x=e[1],s[1].y=x)}else{if(C.x=Hs(f,y,D,A,c),Number.isNaN(C.x))break;C.y=0,s[0]=C,n=1}let o=-1;for(let l=0;l<n;l++){e.peLineType.geodeticDistance(f,y,D.x,D.y,A.x,A.y,E,null,null,c);const n=E.val;e.peLineType.geodeticDistance(f,y,D.x,D.y,s[l].x,s[l].y,E,null,null,c);const m=E.val;2===a.getCoordinateSystemType()?(b[0]=s[l].x/_,b[1]=s[l].y/_,e.peCSTransformations.geogToProj(P,1,b),h?(S.y=b[1],S.x=u):(S.x=Us(b[0],w.x,T.x,v),S.y=u)):h?(S.x=u,S.y=s[l].y/_):(S.x=Us(s[l].x/_,w.x,T.x,v),S.y=u);const d=n>0?r.snap(m/n,0,1):.5;if(0===d||1===d)continue;if(o>d)continue;const p=t.getPrevVertex(i);t.splitSegment(p,[d],1);const g=t.getNextVertex(p);t.setXYCoords(g,S.x,S.y),o=d}}while(0);w.setCoordsPoint2D(T)}}}catch(e){m.error=e,m.hasError=!0}finally{o.__disposeResources(m)}}function ds(e,n){i.geometryReleaseAssert(n.isPannable());const r=n.getPannableExtent();if(e.getGeometryType()===i.GeometryType.enumPoint){const t=e.getY();return r.ymin<=t&&t<=r.ymax?e:e.createInstance()}const o=t.Envelope2D.constructEmpty();e.queryEnvelope(o);const a=t.Envelope2D.constructEmpty();a.setCoords({env2D:r}),a.xmin=o.xmin,a.xmax=o.xmax,a.inflateCoords(.01*a.height(),0);const c=s.calculateToleranceFromGeometryForRel(n,o,!1);let h;return h=a.containsEnvelope(o)?e:l.clip$1(e,a,c,0,null),h}function ps(e,t,i,n){const s=.5*(i+t);return r.round((s-e)/n)*n}function gs(e,s,o,c,h,u,m,d){const p=e.getGeometryType(),g=r.Envelope1D.constructEmpty();g.setCoords(s,s+o);const _=[0];if(p===i.GeometryType.enumPoint){const t=e;if(_[0]=t.getX(),hs(_,g,m)){const t=h?e:e.clone();return t.setX(_[0]),t}return e}const f=t.Envelope2D.constructEmpty();if(e.queryEnvelope(f),f.isEmpty())return e;if(p===i.GeometryType.enumMultiPoint){const t=h?e:e.clone(),i=t.getImpl(),n=i.getAttributeStreamRef(0),s=2*i.getPointCount();let r=!1;for(let e=0;e<s;e+=2)_[0]=n.read(e),hs(_,g,m)&&(n.write(e,_[0]),r=!0);return r&&i.notifyModifiedFlags(2001),t}const y=r.Envelope1D.constructEmpty();if(f.queryIntervalX(y),g.contains(y))return g.vmax,y.vmax,e;const x=t.Envelope2D.constructEmpty();if(x.setCoords({env2D:f}),0===y.width()){let t=y.vmin;t+=Math.ceil((g.vmin-t)/o)*o,t=g.snapClip(t);const i=h?e:e.clone();return i.setAttributeBasic(0,0,t),i}if(p===i.GeometryType.enumEnvelope){const t=h?e:e.clone();return f.intersect(x),t.setEnvelope(f),t}const v=.1*Math.max(f.height(),f.width())*1;x.inflateCoords(0,v);let P=e;const b=c.getTolerance(0),E=new a.Transformation2D;for(;;){const e=Math.floor((y.vmin-s)/o),t=Math.ceil((y.vmax-s)/o);if(!(t-e>3))break;{const n=Math.floor(.5*(t+e));x.xmin=f.xmin-v,x.xmax=s+o*n;const r=l.clip$1(P,x,b,u,d);x.xmin=x.xmax,x.xmax=f.xmax+v;const a=l.clip$1(P,x,b,u,d);E.setShiftCoords((n-t)*o,0),a.applyTransformation(E),p===i.GeometryType.enumPolygon?P=(new Zn).execute(r,a,c,d):(P=r,P.add(a,!1)),P.queryEnvelope(f),f.queryIntervalX(y)}}x.xmin=s,x.xmax=s+o;const S=t.Envelope2D.constructEmpty();S.setCoords({env2D:x}),S.inflateCoords(b,0);const C=Math.floor((f.xmin-x.xmin)/o)*o;let w;C?(x.move(C,0),E.setShiftCoords(-C,0)):E.setIdentity(),w=p===i.GeometryType.enumPolyline?new n.Polyline({vd:P.getDescription()}):new n.Polygon({vd:P.getDescription()});const T=t.Envelope2D.constructEmpty(),D=t.Envelope2D.constructEmpty();for(;f.xmax>x.xmin;){const e=l.clip$1(P,x,b,0,d);e.queryEnvelope(D);let t=!1;t=p===i.GeometryType.enumPolyline?!e.isEmpty()&&(D.width()>b||D.height()>b):!e.isEmpty()&&(p!==i.GeometryType.enumPolygon||D.width()>b),t&&(e.applyTransformation(E),e.queryEnvelope(D),w.queryEnvelope(T),T.inflateCoords(b,b),T.isIntersecting(D)&&p===i.GeometryType.enumPolygon?w=(new Zn).execute(w,e,c,d):w.add(e,!1)),x.move(o,0),E.shiftCoords(-o,0)}return w}function _s(e,t,i,n,s=!0){const o=new r.Envelope1D;o.setCoords(i,i+n);const a=[0];if(Array.isArray(e)){const i=e;for(let e=0;e<t;e++)o.containsRightExclusive(i[e].x)||(a[0]=i[e].x,hs(a,o,s),i[e].x=a[0])}else{const i=e;for(let e=0;e<t;e++){const t=e<<1;o.containsRightExclusive(i[t])||(a[0]=i[t],hs(a,o,s),i[t]=a[0])}}}function fs(e,n,s,r=!0){if(e.isEmpty())return;const o=e.getGeometryType();if(!r||o!==i.GeometryType.enumPolygon)if(i.isMultiVertex(o)){let t=!1;if(i.isMultiPath(o)&&e.hasNonLinearSegments()){const r=e.getImpl(),o=r.getAttributeStreamRef(0),a=r.getSegmentFlagsStreamRef();i.geometryReleaseAssert(null!==a);for(let e=0,i=r.getPathCount();e<i;e++){let i=!0;const l=r.isClosedPath(e),c=r.getPathEnd(e);l&&r.getPathSize(e)>0&&(i=1==(31&a.read(c-1)));for(let l=r.getPathStart(e);l<c;l++)if(1==(31&a.read(l))){if(i){const e=o.read(2*l),i=cs(e,n,s);i!==e&&(t=!0,o.write(2*l,i))}i=!0}else i=!1}}else{const i=e.getImpl(),r=i.getAttributeStreamRef(0);for(let e=0,o=i.getPointCount();e<o;e++){const i=r.read(2*e),o=cs(i,n,s);o!==i&&(t=!0,r.write(2*e,o))}}t&&e.getImpl().notifyModifiedFlags(2001)}else if(o===i.GeometryType.enumEnvelope){const i=e,r=t.Envelope2D.constructEmpty();i.queryEnvelope(r),r.xmin=cs(r.xmin,n,s),r.xmax=cs(r.xmax,n,s),i.setEnvelope(r)}else if(o===i.GeometryType.enumPoint){const t=e;t.setX(cs(t.getX(),n,s))}else i.throwInternalErrorException("")}function ys(e,t,i){const n=new r.Point2D;return n.x=cs(e.x,t,i),n.y=e.y,n}function xs(n,o,a,c){const h=n.getGeometryType();i.geometryReleaseAssert(h===i.GeometryType.enumPolygon||h===i.GeometryType.enumPolyline||h===i.GeometryType.enumMultiPoint);const u=o.getCoordinateSystemType();if(2===u){let u=n;if(0===a){const a=function(i,n){if(n.isEmpty())return 0;const s=i.getPECoordSys();if(s.getProjection().getCode()===e.peDefs.PE_PRJ_AZIMUTHAL_EQUIDISTANT){const o=Er();i.querySpheroidData(o);const a=s.getParameters();if(null===a[e.peDefs.PE_PARM_LAM0])return 0;if(null===a[e.peDefs.PE_PARM_PHI0])return 0;const l=[a[e.peDefs.PE_PARM_LAM0].getValue(),a[e.peDefs.PE_PARM_PHI0].getValue()];e.peCSTransformations.geogToProj(s,1,l);const c=new r.Point2D(l[0],l[1]),h=t.Envelope2D.constructEmpty();n.queryEnvelope(h);const u=r.makeObjectArray(r.Point2D,4);h.queryCorners(u);let m=0;const d=i.getOneMeter();let p=Math.max(o.majorSemiAxis,o.minorSemiAxis)*Math.PI,g=Math.min(o.majorSemiAxis,o.minorSemiAxis)*Math.PI;g-=p/180,p*=d,g*=d;for(let e=0;e<4;e++){const t=r.Point2D.distance(u[e],c);if(t>p)m++;else if(t>g)return-1}if(0===m)return 1;if(4===m){const e=t.Envelope2D.constructEmpty();return e.setCoords({center:c,width:p,height:p}),h.isIntersectingNe(e)?-1:0}return-1}return-1}(o,n);if(0===a)return n.createInstance();if(1===a)return n;const h=o.getPCSHorizon(),m=h.getGeometryType(),d=o.getDefaultPrecisionSR();if(m===i.GeometryType.enumEnvelope){const e=t.Envelope2D.constructEmpty();h.queryEnvelope(e);const i=s.calculateToleranceFromGeometryForRel(d,e,!1);u=l.clip$1(n,e,i,5e4*o.getOneMeterPCSUnit(),c)}else(new Xn).execute(h,n,d,c)||(u=(new Xi).execute(u,h,d,c),u===h&&(u=u.clone()))}else if(o.isPannable()){const e=t.Envelope2D.constructEmpty();u.queryEnvelope(e);const n=o.getPannableExtent();n.containsEnvelope(e)||(fs(u,n,o.getTolerance(0)),2!==a&&4!==a||(u=ds(u,o)),4!==a?u=os(u,o,0,!0,1e5*o.getOneMeterPCSUnit(),c):h===i.GeometryType.enumPolygon&&e.width()>2*n.width()&&(u=gs(u,-2*n.width(),2*n.width(),o,!0,0,!0,c)))}return u}if(i.geometryReleaseAssert(1===u),h===i.GeometryType.enumMultiPoint)return fs(n,o.getPannableExtent(),o.getTolerance(0)),n;{const e=t.Envelope2D.constructEmpty();n.queryEnvelope(e);let s=n;const r=o.getPannableExtent();if(e.ymin<r.ymin||e.ymax>r.ymax){const i=Math.max(1,e.calculateToleranceFromEnvelope()),n=new t.Envelope2D(e.xmin-i,r.ymin,e.xmax+i,r.ymax);if(s=(new l.OperatorClip).execute(s,n,o,c),s.isEmpty())return s}return h===i.GeometryType.enumPolygon&&e.width()>2*r.width()&&(s=gs(s,-2*r.width(),2*r.width(),o,!0,0,!0,c)),s}}function vs(t,i,n,s){if(!n)return;const o=t.getPECoordSys();if(1===n){const n=[i[0].x,i[0].y];if(e.peCSTransformations.geogToProj(o,1,n),s){const{first:e,second:s}=t.m_peCoordSysVal.getGeogToProjFactors();n[0]=e*(i[0].x-t.getCentralMeridian())+s}return void i[0].setCoords(n[0],n[1])}const a=t.isPannable(),l=a?t.getPannableExtent().width():0,c=179*l/360;let h=0;a&&(h=t.getCentralMeridian());const u=new Float64Array(512);for(let m=0;m<n;){for(let e=m;e<n&&i[e].isNAN();++e)m++;let d=Math.min(256,n-m);if(d>0){for(let e=1,t=m+1;e<d;++e,++t)if(i[t].isNAN()){d=e;break}for(let e=0;e<d;++e){const t=e<<1;u[t]=i[m+e].x,u[t+1]=i[m+e].y}if(e.peCSTransformations.geogToProj(o,d,u),s){const{first:e,second:n}=t.m_peCoordSysVal.getGeogToProjFactors();for(let t=0;t<d;++t)u[t<<1]=e*(i[m+t].x-h)+n}if(a)for(let e=0,t=m;e<d;e++,t++){const n=e<<1,s=u[n],o=r.sign(s),a=i[t].x-h;o*r.sign(a)<0&&Math.abs(s)>c&&(u[n]-=o*l)}ss(u,i,m,d),m+=d}}}function Ps(t,n,s){i.geometryReleaseAssert(!s||t.isPannable());const o=n.getPointCount();if(!o)return;const a=n.getImpl(),l=a.getAttributeStreamRef(0),c=t.getPECoordSys();let h=0;const u=l.readRange(0,2*o);let m=()=>{e.peCSTransformations.geogToProj(c,o,u)};const d=t.isPannable()&&!s,p=d?t.getPannableExtent().width():0,g=179*p/360;if(t.isPannable()&&(h=t.getCentralMeridian(),s)){const i=t.m_peCoordSysVal.getGeogToProjFactors(),n=i.first,s=i.second;m=()=>{e.peCSTransformations.geogToProj(c,o,u);for(let e=0;e<o;e++){const t=e<<1,i=l.read(t),r=n*(i-h)+s;u[t]=r}}}if(m(),d)for(let e=0;e<o;e++){const t=e<<1,i=u[t],n=r.sign(i),s=l.read(t)-h;n*r.sign(s)<0&&Math.abs(i)>g&&(u[t]+=-n*p)}l.writeRangeFromArray(0,2*o,u,!0,1),a.notifyModifiedFlags(2001)}function bs(e,t,n){switch(t.getGeometryType()){case i.GeometryType.enumLine:return void function(e,t,i){const n=[t.getStartXY(),t.getEndXY()];vs(e,n,2,i),t.setStartXY(n[0]),t.setEndXY(n[1]),t.normalizeAfterEndpointChange()}(e,t,n);case i.GeometryType.enumBezier:return void function(e,t,i){const n=r.makeObjectArray(r.Point2D,4);t.queryControlPoints(n),Vs(e,n,4,i),t.setControlPoints(n)}(e,t,n);case i.GeometryType.enumEllipticArc:return void function(e,t,i){if(0===t.projectionBehavior())!function(e,t,i){Ls(!0,e,0,t,i)}(e,t,i);else{const n=t.isClosed()&&t.isMajor(),s=[t.getStartXY(),n?t.getCenter():t.getEndXY()],r=[s[0].clone(),s[1].clone()];Vs(e,r,2,i);const o=new a.Transformation2D;o.initializeFromTwoPointsArray(s,r),t.applyTransformation(o);const l=n?0:1;t.setCoordsForIntersector(r[0],r[l],!1)}}(e,t,n);case i.GeometryType.enumBezier2:case i.GeometryType.enumRationalBezier2:return void i.geometryReleaseAssert(0);default:i.throwInternalErrorException("")}}function Es(t,o,a){if(!o.hasNonLinearSegments())return void Ps(t,o,a);if(i.geometryReleaseAssert(!a||t.isPannable()),o.isEmpty())return;const l=t.getPECoordSys(),c=t.isPannable(),h=c?t.getPannableExtent().width():0,u=179*h/360;let m=0;c&&(m=t.getCentralMeridian());const d=o.createInstance();d.reserveParts(o.getPointCount(),o.getPathCount());const p=o.getImpl(),g=new n.SegmentBuffer;for(let i=0,n=o.getPathCount();i<n;++i)if(p.hasNonLinearSegmentsPath(i)){let e=!0,n=-1;const o=p.getPathStart(i),l=o+p.getSegmentCountPath(i);p.isClosedPath(i)&&(n=l-1);const c=new r.Point2D;for(let i=o;i<l;++i){if(p.getSegmentBuffer(i,g,!1),bs(t,g.get(),a),e||g.get().getStartXY().equals(c)||g.get().moveTo(c),i!==n)d.addSegment(g.get(),e);else{if(e){const e=new s.Point;g.get().queryStart(e),d.startPathPoint(e)}d.closeLastPathWithSegment(g.get())}c.assign(g.get().getEndXY()),e=!1}}else{const t=1024;let n,s=p.getPathSize(i),a=Math.min(s,t);d.insertPath(-1,o,i,!0);const g=p.getAttributeStreamRef(0),_=d.getAttributeStreamRef(0);for(let o=p.getPathStart(i),d=p.getPathEnd(i);o<d;){if(n=g.readRange(o,a),e.peCSTransformations.geogToProj(l,a,n),c)for(let e=0;e<a;e++){const t=e<<1,i=n[t],s=r.sign(i),o=g.read(2*(0+e))-m;s*r.sign(o)<0&&Math.abs(i)>u&&(n[t]+=-s*h)}_.writeRangeFromArray(o,a,n,!0,1),o+=a,s-=a,a=Math.min(s,t)}}o.assignMove(d)}function Ss(e,t,i){let n=i.getPointCount();if(!n)return;const s=i.getImpl(),o=s.getAttributeStreamRef(0);let a=Math.min(n,1e3),l=0;const c=e.getPECoordSys();Number.isNaN(t)&&(t=0);const h=e.isPannable(),u=e.getOneDegreeGCSUnit(),m=360*u,d=179*u;let p;for(;n;){if(p=o.readRange(2*l,2*a),ws(c,a,p,t),h)for(let e=0;e<a;e++){const i=e<<1,n=p[i]-t,s=r.sign(n),a=o.read(2*(l+e));s*r.sign(a)<0&&Math.abs(n)>d&&(p[i]+=-s*m)}o.writeRangeFromArray(2*l,2*a,p,!0,1),l+=a,n-=a,a=Math.min(n,1e3)}s.notifyModifiedFlags(2001)}function Cs(e,t,n){switch(n.getGeometryType()){case i.GeometryType.enumLine:return void function(e,t,i){const n=[i.getStartXY(),i.getEndXY()];Ds(e,t,n,2),i.setStartXY(n[0]),i.setEndXY(n[1]),i.normalizeAfterEndpointChange()}(e,t,n);case i.GeometryType.enumBezier:return void function(e,t,i){const n=r.makeObjectArray(r.Point2D,4);i.queryControlPoints(n),Fs(e,t,n,4),i.setControlPoints(n)}(e,t,n);case i.GeometryType.enumEllipticArc:return void function(e,t,i){if(0===i.projectionBehavior())!function(e,t,i){Ls(!1,e,t,i,!1)}(e,t,i);else{const n=i.isClosed()&&i.isMajor(),s=[i.getStartXY(),n?i.getCenter():i.getEndXY()],r=[s[0].clone(),s[1].clone()];Fs(e,t,r,2);const o=new a.Transformation2D;o.initializeFromTwoPointsArray(s,r),i.applyTransformation(o);const l=n?0:1;i.setCoordsForIntersector(r[0],r[l],!1)}}(e,t,n);case i.GeometryType.enumBezier2:case i.GeometryType.enumRationalBezier2:return void i.geometryReleaseAssert(0);default:i.throwInternalErrorException("")}}function ws(t,n,s,r){const o=e.peCSTransformations.projToGeogCenter(t,n,s,r);for(let e=0;e<n;++e){const t=e<<1;i.geometryReleaseAssert(Number.isFinite(s[t]+s[t+1]))}return o}function Ts(e,t,i){if(!i.hasNonLinearSegments())return void Ss(e,t,i);if(i.isEmpty())return;const o=e.getPECoordSys();Number.isNaN(t)&&(t=0);const a=e.isPannable(),l=e.getOneDegreeGCSUnit(),c=360*l,h=179*l,u=i.createInstance();u.reserveParts(i.getPointCount(),i.getPathCount());const m=i.getImpl(),d=new n.SegmentBuffer;for(let n=0,l=i.getPathCount();n<l;++n)if(m.hasNonLinearSegmentsPath(n)){let i=!0,o=-1;const a=m.getPathStart(n),l=a+m.getSegmentCountPath(n);m.isClosedPath(n)&&(o=l-1);const c=new r.Point2D;for(let n=a;n<l;++n){if(m.getSegmentBuffer(n,d,!1),Cs(e,t,d.get()),i||d.get().getStartXY().equals(c)||d.get().moveTo(c),n!==o)u.addSegment(d.get(),i);else{if(i){const e=new s.Point;d.get().queryStart(e),u.startPathPoint(e)}u.closeLastPathWithSegment(d.get())}c.assign(d.get().getEndXY()),i=!1}}else{const e=1e3;let s,l=m.getPathSize(n),d=Math.min(l,e);u.insertPath(-1,i,n,!0);const p=m.getAttributeStreamRef(0),g=u.getAttributeStreamRef(0);for(let i=m.getPathStart(n),u=m.getPathEnd(n);i<u;){if(s=p.readRange(2*i,2*d),ws(o,d,s,t),a)for(let e=0;e<d;e++){const n=e<<1,o=s[n]-t,a=r.sign(o),l=p.read(2*i);a*r.sign(l)<0&&Math.abs(o)>h&&(s[n]+=-a*c)}g.writeRangeFromArray(2*i,2*d,s,!0,1),i+=d,l-=d,d=Math.min(l,e)}}i.assignMove(u)}function Ds(e,t,i,n){const s=e.getPECoordSys();Number.isNaN(t)&&(t=0);const o=e.isPannable(),a=e.getOneDegreeGCSUnit(),l=360*a,c=179*a,h=new Float64Array(512);for(let e=0;e<n;){for(let t=e;t<n&&i[t].isNAN();++t)e++;let a=Math.min(256,n-e);if(a>0){for(let t=1,n=e+1;t<a;++t,++n)if(i[n].isNAN()){a=t;break}for(let t=0;t<a;t++){const n=t<<1;h[n]=i[e+t].x,h[n+1]=i[e+t].y}if(ws(s,a,h,t),o)for(let n=0,s=e;n<a;++n,++s){const e=n<<1,o=i[s].x,a=h[e]-t,u=r.sign(a);u*r.sign(o)<0&&Math.abs(a)>c&&(h[e]-=u*l)}for(let t=0;t<a;t++){const n=t<<1;i[e+t].x=h[n],i[e+t].y=h[n+1]}e+=a}}}function Is(e,t,n,s){i.geometryReleaseAssert(0)}function As(e,t,i){let n=t.getPointCount();if(!n)return!1;const s=t.getImpl(),o=s.getAttributeStreamRef(0);let a=null;const l=e.getInputSR(),c=e.getOutputSR();l.getVCS(),c.getVCS();const h=l.getOneDegreeGCSUnit(),u=c.getOneDegreeGCSUnit(),m=e.isVertical();m&&t.hasAttribute(1)&&(a=s.getAttributeStreamRef(1));const d=e.getDatumTransformation(),p=!!d&&1===d.getType();if(p||null===a||(Is(a.getArray()),a=null),!d||0===d.count()){const e=l.getGcsUnitFactor()/c.getGcsUnitFactor(),t=(l.getPrimeMeridian()-c.getPrimeMeridian())*u,i=-90*h,a=90*h;let m=0;const d=o.getArray(),p=[0];for(let e=1,t=2*n;e<t;)p[0]=d[e],m|=r.querySnap(p,i,a)?1:0,d[e]=p[0],e+=2;if(0!==t||1!==e){m=1;const i=o.getArray();for(let s=0,r=2*n;s<r;){let n=i[s];n*=e,n+=t,i[s]=n,i[s+1]*=e,s+=2}}return 0!==m&&s.notifyModifiedFlags(2001),!!m}let g=Math.min(n,1e3);const _=r.makePrimitiveArray(g,Number.NaN),f=r.makePrimitiveArray(g,Number.NaN);let y=null;null!==a&&(y=new Float64Array(g));let x=0,v=Number.NaN,P=Number.NaN;const b=360*u,E=u/h;i&&(P=90*u,v=89.9*h,f.fill(0));let S=!0,C=0;for(;n;){let e=!1;const t=o.readRange(2*x,2*g);for(let e=0;e<g;e++)_[e]=t[e<<1];if(i)for(let i=0;i<g;i++){const n=1+(i<<1),s=Math.abs(t[n])-v;if(s>0){const o=t[n];t[n]=r.copySign(v,o),f[i]=r.copySign(s,o),e=!0}}const s=t[0];if(p){const e=d;y&&a.queryRange(x,g,y,!0,1),e.transform(!1,t,y,g),y&&a.writeRangeFromArray(x,g,y,!0,1)}else d.transform(!1,t,g);S&&(C=t[0]-E*s,S=!1);for(let e=0;e<g;e++){const i=e<<1,n=t[i]-_[e]*E-C;Math.abs(n)>200&&(t[i]+=n>0?-b:b)}if(e){for(let e=0;e<g;e++)if(f[e]){const i=1+(e<<1);t[i]+=E*f[e],t[i]>P?t[i]=P:t[i]<-P&&(t[i]=-P)}f.fill(0)}o.writeRangeFromArray(2*x,2*g,t,!0,1),m&&a&&a.writeRangeFromArray(x,g,y,!0,1),x+=g,n-=g,g=Math.min(n,1e3)}return s.notifyModifiedFlags(2001),!0}function Ms(e,t,n){switch(t.getGeometryType()){case i.GeometryType.enumLine:return function(e,t,i){const n=[t.getStartXY(),t.getEndXY()];let s=null;t.hasAttribute(1)&&(s=[0,0],s[0]=t.getAttributeAsDbl(0,1,0),s[1]=t.getAttributeAsDbl(1,1,0));const r=ks(e,n,s,2,i);return t.setStartXY(n[0]),t.setEndXY(n[1]),s&&(t.setStartAttribute(1,0,s[0]),t.setEndAttribute(1,0,s[1])),t.normalizeAfterEndpointChange(),r}(e,t,n);case i.GeometryType.enumBezier:return function(e,t,i){const n=r.makeObjectArray(r.Point2D,4);t.queryControlPoints(n);let s=null;t.hasAttribute(1)&&(s=[0,0,0,0],s[0]=t.getAttributeAsDbl(0,1,0),s[3]=t.getAttributeAsDbl(1,1,0),s[1]=r.lerp(s[0],s[3],.5),s[2]=s[1]);const o=ks(e,n,s||null,n.length,i);return t.setControlPoints(n),s&&(t.setStartAttribute(1,0,s[0]),t.setEndAttribute(1,0,s[3])),t.normalizeAfterEndpointChange(),o}(e,t,n);case i.GeometryType.enumEllipticArc:return function(e,t,i){if(0===t.projectionBehavior())return function(e,t,i){const n=[t.getStartXY(),t.getEndXY(),t.getInteriorPoint(),t.getCenter()];let s=4;t.isDegenerateToLine()&&(s=2);const o=[0,0,0,0];let a=null;if(t.hasAttribute(1)){a=o,a[0]=t.getAttributeAsDbl(0,1,0),a[1]=t.getAttributeAsDbl(1,1,0);const e=r.lerp(a[0],a[1],.5);a[2]=e,a[3]=e}const l=t.getStartXY().equals(t.getEndXY())&&!t.isDegenerateToLine(),c=ks(e,n,a,s,i);return l?t.constructCircleCenterAndPoint(n[3],n[0],!t.isClockwise()):t.isDegenerateToLine()?t.constructLineCircularArc(n[0],n[1]):t.constructCircularArcThreePoint(n[0],n[1],n[2]),a&&(t.setStartAttribute(1,0,a[0]),t.setEndAttribute(1,0,a[1])),c}(e,t,i);const n=t.getStartXY().equals(t.getEndXY()),s=r.makeObjectArray(r.Point2D,3),o=r.makeObjectArray(r.Point2D,3);let l=null;s[0].assign(t.getStartXY()),s[1].assign(n?t.getCenter():t.getEndXY());let c=!1;t.hasAttribute(1)&&(l=[0,0,0],l[0]=t.getAttributeAsDbl(0,1,0),l[1]=t.getAttributeAsDbl(1,1,0),l[2]=r.lerp(l[0],l[1],.5),n&&(l[1]=l[2])),o[0].setCoordsPoint2D(s[0]),o[1].setCoordsPoint2D(s[1]);const h=new a.Transformation2D;if(n||t.isDegenerateToLine())c=ks(e,o,l,2,i),h.initializeFromTwoPoints(s[0],s[1],o[0],o[1]);else{const n=new r.Point2D;t.queryCoord2D(.5,n),s[2].setCoordsPoint2D(n),o[2].setCoordsPoint2D(n),c=ks(e,o,l,3,i),h.setFromTwoTriangles(s,o)}return h.isIdentity()||(t.applyTransformation(h),t.setStartXY(o[0]),t.setEndXY(n?o[0]:o[1]),t.normalizeAfterEndpointChange()),l&&(t.setStartAttribute(1,0,l[0]),t.setEndAttribute(1,0,n?l[0]:l[1])),c}(e,t,n);case i.GeometryType.enumBezier2:case i.GeometryType.enumRationalBezier2:return i.geometryReleaseAssert(0),!1;default:i.throwInternalErrorException("")}}function Ns(e,t,i){if(!t.hasNonLinearSegments())return As(e,t,i);if(t.isEmpty())return!1;const o=t.createInstance();o.reserveParts(t.getPointCount(),t.getPathCount());const a=t.getImpl(),l=new n.SegmentBuffer;for(let n=0,c=t.getPathCount();n<c;++n){let t=!0,c=-1;const h=a.getPathStart(n),u=h+a.getSegmentCountPath(n);a.isClosedPath(n)&&(c=u-1);const m=new r.Point2D;for(let n=h;n<u;++n){if(a.getSegmentBuffer(n,l,!1),Ms(e,l.get(),i),t||l.get().getStartXY().equals(m)||l.get().moveTo(m),n!==c)o.addSegment(l.get(),t);else{if(t){const e=new s.Point;l.get().queryStart(e),o.startPathPoint(e)}o.closeLastPathWithSegment(l.get())}m.assign(l.get().getEndXY()),t=!1}}return t.assignMove(o),!0}function Rs(e,t,i,n,s,o){if(e.isIdentityGeogToGeog()){const i=90*e.getInputSR().getOneDegreeGCSUnit();let s=0;const o=[0];for(let e=0;e<n;e++)o[0]=t[e].y,s|=r.querySnap(o,-i,i)?1:0,t[e].y=o[0];return s}const a=e.getInputSR(),l=e.getOutputSR(),c=a.getVCS(),h=l.getVCS(),u=a.getOneDegreeGCSUnit(),m=90*u,d=l.getOneDegreeGCSUnit(),p=e.isVertical(),g=e.getDatumTransformation(),_=!!g&&1===g.getType();if(p||(i=null),!g||0===g.count()){let e=0;const s=[0];for(let i=0;i<n;i++)s[0]=t[i].y,e|=r.querySnap(s,-m,m)?1:0,t[i].y=s[0];return e|=Ln(a.getGCS(),c,l.getGCS(),h,t,i,n)?1:0,e}_||null===i||Is();let f=Math.min(n,1024);const y=r.makePrimitiveArray(f,Number.NaN),x=r.makePrimitiveArray(f,Number.NaN);let v=0,P=Number.NaN,b=Number.NaN;const E=360*d,S=d/u;s&&(b=90*d,P=89.9*u);let C=!0,w=0,T=n;for(;T;){let e=!1;for(let e=0;e<f;e++)y[e]=t[e+v].x;if(s)for(let i=0;i<f;i++){const n=Math.abs(t[i+v].y)-P;if(n>0){const s=t[i+v].y;t[i+v].y=r.copySign(P,s),x[i]=r.copySign(n,s),e=!0}}const n=t[0].x;_?g.transform(!1,t,i,f):g.transform(!1,t,f),C&&(w=t[0].x-S*n,C=!1);for(let e=0;e<f;e++){const i=t[v+e].x-y[e]*S-w;Math.abs(i)>200&&(i>0?t[v+e].x-=E:t[v+e].x+=E)}if(e){for(let e=0;e<f;e++)x[e]&&(t[v+e].y+=S*x[e],t[v+e].y>b?t[v+e].y=b:t[v+e].y<-b&&(t[v+e].y=-b));x.fill(0,0,f)}v+=f,T-=f,f=Math.min(T,1024)}return 1}function Os(e,t,n,s,r){return i.geometryReleaseAssert(0),0}function Gs(e,t,n,s,o){i.geometryReleaseAssert(null===s),i.geometryReleaseAssert(t<2147483647);const a=Array.isArray(n);let l;l=a?r.point2DArrayToFloat64Array(n):n;const c=oo.geogToGeog(e,t,l,null,o);return a&&r.float64ArrayToPoint2DArray2(l,n),c}function ks(e,t,i,n,s,r){let o=0,a=!0,l=0;for(let r=0;r<n;++r)t[r].isNAN()?a||(o|=Rs(e,t.slice(l,r-l),i?i.slice(l,r-l):null,r-l,s),l=r,a=!0):a&&(l=r,a=!1);return a||(o|=Rs(e,0===l?t:t.slice(l),i?0===l?i:i.slice(l):null,n-l,s)),0!==o}function Vs(e,t,i,n){vs(e,t,i,n)}function Fs(e,i,n,s){Ds(e,i,n,s);const r=new t.Envelope2D;r.setFromPoints(n,s);const o=e.getOneDegreeGCSUnit(),a=360*o,l=180*o;if(r.width()>l){for(let e=0;e<s;e++)for(;n[e].x<i;)n[e].x+=a;if(r.setFromPoints(n,s),r.xmax>l+i)for(let e=0;e<s;e++)n[e].x-=a}}function Ls(e,t,i,n,s){const o=r.makeObjectArray(r.Point2D,3);let a=0,l=!1,c=!1;const h=n.isDegenerateToLine();h?(o[0].assign(n.getStartXY()),o[1].assign(n.getEndXY()),o[2].setCoords(0,0),a=2):n.isClosed()&&n.isMajor()?(l=!0,c=!n.isClockwise(),o[0].assign(n.getStartXY()),o[1].assign(n.getCenter()),o[2].setCoords(0,0),a=2):(o[0].assign(n.getStartXY()),o[1].assign(n.getEndXY()),o[2].assign(n.getInteriorPoint()),a=3),e?Vs(t,o,a,s):Fs(t,i,o,a),h?n.constructLineCircularArc(o[0],o[1]):l?n.constructCircleCenterAndPoint(o[1],o[0],c):n.constructCircularArcThreePoint(o[0],o[1],o[2])}function qs(e,t,i){const s=n.convertToDegrees(e),r=n.convertToDegrees(t),o=n.shorterArcDistance(s,r),a=n.shorterArcDistance(s,n.convertToDegrees(i));return 0===a||o>0&&a>0&&a<=o||o<0&&a<0&&a>=o}function Hs(t,n,s,a,l){const c={stack:[],error:void 0,hasError:!1};try{const h=s.clone(),u=a.clone();if(2===l){const e=[0,0];return I(0,n,h,u,0,e),e[0]}if(h.y>u.y){const e=new r.Point2D;e.assign(h),h.assign(u),u.assign(e)}const m=o.__addDisposableResource(c,new e.PeDoubleClass,!1),d=o.__addDisposableResource(c,new e.PeDoubleClass,!1),p=o.__addDisposableResource(c,new e.PeDoubleClass,!1),g=new r.Envelope1D;if(g.setCoords(h.y,u.y),!g.containsCoordinate(0)||Math.abs(h.x-u.x)>=Math.PI)return Number.NaN;if(h.x===u.x)return h.x;e.peLineType.geodeticDistance(t,n,h.x,h.y,u.x,u.y,d,m,null,l);const _=d.val;let f=0,y=1;const x=h.clone();for(;_*(y-f)>1e-12*t;){const s=.5*(f+y);if(e.peLineType.geodeticCoordinate(t,n,h.x,h.y,_*s,m.val,d,p,l),x.x=d.val,x.y=p.val,g.setCoords(h.y,x.y),0===x.y)return x.x;if(g.containsCoordinate(0))y=s;else{if(g.setCoords(u.y,x.y),!g.containsCoordinate(0))return i.geometryReleaseAssert(!1),Number.NaN;f=s}}return x.x}catch(e){c.error=e,c.hasError=!0}finally{o.__disposeResources(c)}}function Us(e,t,i,n){const s=new r.Envelope1D;s.setCoords(t,i);const o=n.width();let a=Math.floor((e-t)/o)*o+e;const l=s.getCenter();for(;Math.abs(a-l)>Math.abs(a+o-l);)a+=o;return a}class zs extends h.GeometryCursor{constructor(){super(),this.m_geometryDeque=[],this.m_index=-1}next(){if(this.m_geometryDeque.length>0){this.m_index++;const e=this.m_geometryDeque[0];return this.m_geometryDeque.shift(),e}return null}getGeometryID(){return this.m_index}tick(e){this.m_geometryDeque.push(e)}tock(){return!0}getRank(){return 1}}class Ys{constructor(n,s=!0){this.m_PCSHorizon=null,this.m_GCSHorizon=null,this.m_GCSSplitLines=null,this.m_bGCSHorisonIsInclusive=!1,this.m_oneMeterPCS=0,this.m_oneDegreeGCS=0,this.m_gcsUnitFactor=0,this.m_northPole=r.Point2D.getNAN(),this.m_southPole=r.Point2D.getNAN(),this.m_polesUpdated=0,this.m_domain=t.Envelope2D.constructEmpty(),this.m_primeMeridian=Number.NaN,this.m_geogToProjFactor=1,this.m_geogToProjOffset=0,this.m_geogToProjFactorsUpdated=0,this.m_oneMillimeter=0,this.m_centralMeridian=0,this.m_pPCSInfoNoDomain=null,this.m_oldWKID=-1973,this.m_vcsWKID=-1,this.m_bIsPannable=!1,this.m_bCached=!1,this.m_pannableExtent=t.Envelope2D.constructEmpty(),this.m_pannableExtentGCS=t.Envelope2D.constructEmpty(),this.m_areaOfUse=null,this.m_canonicalWkt="",this.m_peCoordSys=n,this.m_WKID=e.peFactory.getCode(n),this.m_WKID<=0?(this.m_WKID=0,this.m_canonicalWkt=es(n,0,!0),this.m_hashCode=r.hashString(this.m_canonicalWkt)):this.m_hashCode=r.nextRand(this.m_WKID);const o=this.m_peCoordSys.getType();this.m_csType=o===e.peDefs.PE_TYPE_PROJCS?2:1,i.geometryReleaseAssert(o===e.peDefs.PE_TYPE_PROJCS||o===e.peDefs.PE_TYPE_GEOGCS),o===e.peDefs.PE_TYPE_PROJCS&&(n.loadConstants()||i.throwInvalidArgumentException("PeProjcs.loadConstants failed"));const a=o===e.peDefs.PE_TYPE_GEOGCS?this.m_peCoordSys:this.m_peCoordSys.getGeogcs();o!==e.peDefs.PE_TYPE_GEOGCS&&e.peFactory.getCode(a),this.m_unit=function(t){const n=ro(null);return t.getType()===e.peDefs.PE_TYPE_PROJCS||t.getType()===e.peDefs.PE_TYPE_GEOGCS?n.reset(t.getUnit()):i.throwInvalidArgumentException("PE_coord_sys"),n.get()||i.throwInternalErrorException("cannot create units from coord sys"),function(t){return t.getType()===e.peDefs.PE_TYPE_LINUNIT?new gr(t):t.getType()===e.peDefs.PE_TYPE_ANGUNIT?new g(t):void i.throwInvalidArgumentException("peUnit")}(n.get())}(n),this.m_primeMeridian=a.getPrimem().getLongitude();{const e=a.getUnit().getUnitFactor();this.m_gcsUnitFactor=e;let t=Math.PI/(180*e);Math.abs(t-1)<1e-10&&(t=1),this.m_oneDegreeGCS=t}if(o===e.peDefs.PE_TYPE_PROJCS){const e=this.m_peCoordSys,t=e.getUnit().getUnitFactor();this.m_oneMeterPCS=1/t,this.m_oneMillimeter=.001/t,this.m_pPCSInfoNoDomain=ao.generate(e,ao.PE_PCSINFO_OPTION_NONE),this.m_pPCSInfoNoDomain||i.throwInternalErrorException("cannot create pcs info"),this.m_bIsPannable=this.m_pPCSInfoNoDomain.isPannableRectangle(),this.m_centralMeridian=this.m_pPCSInfoNoDomain.getCentralMeridian()}else{this.m_bIsPannable=!0,this.m_polesUpdated=1,this.m_oneMeterPCS=0;const e=1/a.getUnit().getUnitFactor(),t=a.getDatum().getSpheroid().getAxis();this.m_oneMillimeter=.001/t*e,this.m_centralMeridian=0}this.m_bIsPannable&&(this.updateGCSHorizon(),this.updatePCSHorizon(),this.updatePoles(),this.updateDomain(),this.updatePannableExtent(),this.updatePannableExtentGCS())}[Symbol.dispose](){}getHashCode(){return this.m_hashCode}getPCSHorizonPannable(){return this.m_PCSHorizon}getGCSHorizonPannable(){return this.m_GCSHorizon}getPCSInfo(){return i.geometryReleaseAssert(this.m_pPCSInfoNoDomain),this.m_pPCSInfoNoDomain}getCentralMeridian(){return this.m_centralMeridian}updateGCSHorizon(){if(this.m_peCoordSys.getType()!==e.peDefs.PE_TYPE_PROJCS)return;let o=!0;const c=this.m_peCoordSys,h=c.getGeogcs(),u=c.horizonGcsGenerate();if(!u)return;i.geometryReleaseAssert(u.length>0);const m=u[0].getNump(),d=u[0].getKind();let p,g;o=u[0].getInclusive()>0;const _=this.getOneDegreeGCSUnit(),f=90*_,y=360*_,x=370*_,v=180*_*e.peDefs.PE_HORIZON_DELTA/Math.PI,P=t.Envelope2D.constructEmpty();let b=null;if(m>1)for(let t=1;t<m;t++)if(u[t].getKind()===e.peDefs.PE_HORIZON_LINE){b||(b=new n.Polyline);const e=u[t].getCoord();b.startPathCoords(e[0][0],e[0][1]),b.lineToCoords(e[1][0],e[1][1])}if(d===e.peDefs.PE_HORIZON_RECT){const e=u[0].getCoord();if(P.setFromPoints([new r.Point2D(e[0][0],e[0][1]),new r.Point2D(e[1][0],e[1][1])],2),Math.abs(P.ymax-f)<1e-7*v&&(P.ymax=f),Math.abs(P.ymin+f)<1e-7*v&&(P.ymin=-f),P.width()>x){const e=-400*_,t=e+5*y;P.setCoords({xmin:e,ymin:P.ymin,xmax:t,ymax:P.ymax})}const t=new s.Envelope({env2D:P});this.m_GCSHorizon||(this.m_GCSHorizon=t,this.m_bGCSHorisonIsInclusive=o)}else{let s=this.getPCSInfo().isGcsHorizonMultiOverlap();const c=Ar(h,null,0,1),d=[],x=new r.Envelope1D;for(let i=0;i<m;i++){if(u[i].getKind()!==e.peDefs.PE_HORIZON_POLY)continue;p=u[i].getSize();const n=u[i].getCoord(),s=t.Envelope2D.constructEmpty();s.setFromPoints(r.coordinateArrayToPoint2DArray(n),p),d.push(new r.Envelope1D(s.xmin,s.xmax)),s.width(),x.merge(d.at(-1))}let v=!1;const P=new r.Envelope1D;x.width()>y&&d.length>1?(P.vmin=this.getCentralMeridian()-y,P.vmax=P.vmin+2*y,v=!0,s=!0):(P.vmin=x.vmin,P.vmax=P.vmin+y);const E=e=>{let t=0;for(;d[e].vmin+t<P.vmin;)t+=y;for(;d[e].vmax+t-y>P.vmin;)t-=y;return t};let S=new n.Polygon;if(s){const t=new zs,i=(new Zn).executeMany(t,c,null);for(let s=0;s<m;s++){if(u[s].getKind()!==e.peDefs.PE_HORIZON_POLY)continue;p=u[s].getSize();const o=u[s].getCoord();g=u[s].getInclusive()>0;const l=new n.Polygon;if(l.addPathPoint2D(r.coordinateArrayToPoint2DArray(o),p-1,!0),v){const e=E(s),i=d[s].clone();i.move(e);let n=e;const r=new a.Transformation2D;do{r.setShiftCoords(n,0);const e=l.clone();e.applyTransformation(r),t.tick(e),t.tock(),n+=y,i.move(y)}while(i.vmin<P.vmax)}else t.tick(l),i.tock()}S=i.next()}else{S=new n.Polygon;for(let t=0;t<m;t++){if(u[t].getKind()!==e.peDefs.PE_HORIZON_POLY)continue;p=u[t].getSize();const s=u[t].getCoord();if(g=u[t].getInclusive()>0,i.geometryReleaseAssert(g===o),v){const e=new n.Polygon;e.addPathPoint2D(r.coordinateArrayToPoint2DArray(s),p-1,!0);const i=E(t),o=d[t].clone();o.move(i);let l=i;const c=new a.Transformation2D;do{if(0!==l){c.setShiftCoords(l,0);const t=new n.Polygon({copy:e});t.applyTransformation(c),S.addPath(t,0,!0)}else S.addPath(e,0,!0);l+=y,o.move(y)}while(o.vmin<P.vmax)}else S.addPathPoint2D(r.coordinateArrayToPoint2DArray(s),p-1,!0)}}v&&(S=(new l.OperatorClip).execute(S,new t.Envelope2D(P.vmin,-f-_,P.vmax,f+_),c,null)),o?(new Xi).accelerateGeometry(S,c,1):(new jn).accelerateGeometry(S,c,1),(new Kn).accelerateGeometry(S,c,1),null===this.m_GCSHorizon&&(this.m_GCSHorizon=S,this.m_bGCSHorisonIsInclusive=o,this.m_GCSSplitLines=b)}}updateAreaOfUse(){return null}updatePCSHorizon(){if(this.m_peCoordSys.getType()!==e.peDefs.PE_TYPE_PROJCS)return;const o=this.m_peCoordSys.horizonPcsGenerate();if(!o)return;let a;this.getPCSInfo();const l=o[0].getKind();o[0].getInclusive();const h=t.Envelope2D.constructEmpty(),u=o[0].getNump();let m=!1;if(l===e.peDefs.PE_HORIZON_RECT){const e=o[0].getCoord();h.setFromPoints(r.coordinateArrayToPoint2DArray(e),2),a=new s.Envelope({env2D:h})}else{let t=-1;for(let i=0;i<u;i++)o[i].getKind()===e.peDefs.PE_HORIZON_POLY&&(t=i);i.geometryReleaseAssert(t>=0);const s=o[t].getSize()-1,l=o[t].getCoord(),c=new n.Polygon;a=c,c.addPathPoint2D(r.coordinateArrayToPoint2DArray(l),s,!0),m=!0}if(this.getPCSInfo().isDensificationNeeded()){i.geometryReleaseAssert(l!==e.peDefs.PE_HORIZON_RECT);const t=1e5*this.getOneMeterPCSUnit();a=(new c.OperatorDensify).execute(a,t,0,0,null)}if(m){{const e=new s.Envelope;a.queryEnvelope(e),a.calculateArea2D(),a.calculateLength2D(),a.getExteriorRingCount()}(new Xi).accelerateGeometry(a,null,1)}null===this.m_PCSHorizon&&(this.m_PCSHorizon=a)}updatePannableExtent(){const n=this.m_peCoordSys.getType();if(n===e.peDefs.PE_TYPE_PROJCS){const n=this.m_peCoordSys,s=this.getPCSInfo().getCentralMeridian(),r=n.getGeogcs();r||i.throwInternalErrorException("");const o=[s+1/r.getUnit().getUnitFactor()*Math.PI,0];e.peCSTransformations.geogToProj(n,1,o);const a=o[0],l=n.getParameters()[e.peDefs.PE_PARM_X0].getValue(),c=this.getPCSHorizon(),h=t.Envelope2D.constructEmpty();c.queryEnvelope(h);const u=Math.abs(a-l),m=u+l,d=-1*u+l,p=h.ymax,g=h.ymin;this.m_pannableExtent.setCoords({xmin:d,ymin:g,xmax:m,ymax:p})}else if(n===e.peDefs.PE_TYPE_GEOGCS){const e=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtent.setCoords({xmin:-e,ymin:-e/2,xmax:e,ymax:e/2})}else i.throwInternalErrorException("")}updatePannableExtentGCS(){const n=this.m_peCoordSys.getType();if(n===e.peDefs.PE_TYPE_PROJCS){const e=this.m_peCoordSys,n=this.m_centralMeridian,s=e.getGeogcs();s||i.throwInternalErrorException("");const r=1/s.getUnit().getUnitFactor()*Math.PI,o=this.getGCSHorizon(),a=t.Envelope2D.constructEmpty();o.queryEnvelope(a),this.m_pannableExtentGCS.setCoords({xmin:n-r,ymin:a.ymin,xmax:n+r,ymax:a.ymax})}else if(n===e.peDefs.PE_TYPE_GEOGCS){const e=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtentGCS.setCoords({xmin:-e,ymin:-e/2,xmax:e,ymax:e/2})}else i.throwInternalErrorException("")}updateDomain(){if(1===this.m_csType){const e=400*this.getOneDegreeGCSUnit();this.m_domain=t.Envelope2D.construct(-e,-e,e,e)}else{i.geometryReleaseAssert(2===this.m_csType);const e=ao.generate(this.m_peCoordSys,ao.PE_PCSINFO_OPTION_DOMAIN);e||i.throwInternalErrorException("generate pcs info failed");const n=new t.Envelope2D(e.getDomainMinx(),e.getDomainMiny(),e.getDomainMaxx(),e.getDomainMaxy());this.m_domain.isEmpty()&&this.m_domain.setCoords({env2D:n})}}updatePoles(){if(this.m_peCoordSys.getType()===e.peDefs.PE_TYPE_PROJCS){const t=90*this.getOneDegreeGCSUnit(),i=[[0,t],[0,-t]];e.peCSTransformations.geogToProj(this.m_peCoordSys,2,i);const n=this.getPCSInfo().getNorthPoleLocation()!==ao.PE_POLE_OUTSIDE_BOUNDARY,s=this.getPCSInfo().getSouthPoleLocation()!==ao.PE_POLE_OUTSIDE_BOUNDARY;this.m_polesUpdated||(n&&this.m_northPole.setCoords(i[0][0],i[0][1]),s&&this.m_southPole.setCoords(i[1][0],i[1][1]),this.m_polesUpdated=1)}else this.m_polesUpdated=1}updateGeogToProjFactors(){if(this.m_peCoordSys.getType()===e.peDefs.PE_TYPE_PROJCS){const t=this.getOneDegreeGCSUnit(),n=this.m_pPCSInfoNoDomain.getCentralMeridian(),s=[0,0,0,0];s[0]=n,s[1]=0,s[2]=n+t,s[3]=0;const r=e.peCSTransformations.geogToProj(this.m_peCoordSys,2,s);i.geometryReleaseAssert(2===r);const o=(s[2]-s[0])/t,a=s[0];0===this.m_geogToProjFactorsUpdated&&(this.m_geogToProjFactor=o,this.m_geogToProjOffset=a,this.m_geogToProjFactorsUpdated=1)}else this.m_geogToProjFactorsUpdated=1}getOneMeterPCSUnit(){return this.m_oneMeterPCS}getOneDegreeGCSUnit(){return this.m_oneDegreeGCS}getGcsUnitFactor(){return this.m_gcsUnitFactor}getUnitsPerMillimeter(){return this.m_oneMillimeter}getGCSSplitLines(){return this.m_bIsPannable?null:(this.m_GCSHorizon||this.updateGCSHorizon(),this.m_GCSSplitLines)}getGCSHorizon(){return this.m_bIsPannable?this.getGCSHorizonPannable():(null!==this.m_GCSHorizon||this.updateGCSHorizon(),this.m_GCSHorizon)}getGCSHorisonIsInclusive(){return this.m_bIsPannable||this.getGCSHorizon(),this.m_bGCSHorisonIsInclusive}getPCSHorizon(){return this.m_bIsPannable?this.getPCSHorizonPannable():(null!==this.m_PCSHorizon||this.updatePCSHorizon(),this.m_PCSHorizon)}getPole(e){return this.m_bIsPannable||0!==this.m_polesUpdated||this.updatePoles(),e?this.m_southPole:this.m_northPole}getGeogToProjFactors(){return 0===this.m_geogToProjFactorsUpdated&&this.updateGeogToProjFactors(),r.makePair(this.m_geogToProjFactor,this.m_geogToProjOffset)}getDomainXY(){if(this.m_bIsPannable)return this.m_domain.clone();let e=!1;return e=this.m_domain.isEmpty(),e&&this.updateDomain(),this.m_domain.clone()}getPrimeMeridian(){return this.m_primeMeridian}getLatestID(){return this.m_WKID}getOldID(){let e=this.m_oldWKID;if(e<0){if(e=0,this.m_WKID>0){const t=[0],n=[0];(function(e,t,i,n){return t<=0?(i[0]=0,n[0]=0,!1):(i[0]=t,n[0]=t,!0)})(this.m_peCoordSys.getType(),this.m_WKID,t,n)||i.throwInternalErrorException("query_code_change"),e=t[0]}this.m_oldWKID=e}return e}isCustomWkid(){return!1}isPannable(){return this.m_bIsPannable}getPannableExtent(){return this.m_pannableExtent.clone()}getPannableExtentGCS(){return this.m_pannableExtentGCS.clone()}getAreaOfUse(){return null!==this.m_areaOfUse?this.m_areaOfUse:this.updateAreaOfUse()}getVcsCode(){return 0}saveMemory(){}getCSType(){return this.m_csType}getUnit(){return this.m_unit}setCached(){this.m_bCached=!0}getCached(){return this.m_bCached}static equal(e,t){return!1}static equal_for_projection(e,t){return!1}}class Bs{constructor(e,t=!0){this.m_oneMeter=0,this.m_WKID=-1,this.m_oldWKID=-1,this.m_canonicalWkt="not yet implemented",this.m_model=0,this.m_unit=new gr,this.m_cached=!1}setCached(e=!0){this.m_cached=e}getCached(){return this.m_cached}getOneMeterUnit(){return 0}getLatestID(){return this.m_WKID}getOldID(){let e=this.m_oldWKID;return e<0&&(e=0,this.m_WKID>0&&(e=this.m_WKID),this.m_oldWKID=e),e}getModel(){return 0}isCustomWkid(){return!1}getVerticalUnit(){return this.m_unit}static equal(e,t){return!1}static equal_for_projection(e,t){return!1}}function Xs(e,n,s,r){return function(e,n,s,r,o){return Cr()||i.throwProjectionEngineNotLoadedException("cannot create projection transformation"),n.hasVCS()&&s.hasVCS()?(i.geometryReleaseAssert(0),{}):function(e,n,s,r){e&&n||i.throwInvalidArgumentException("!inputSR || !outputSR");const o=e.getLatestID(),a=n.getLatestID();if(3857===o&&4326===a){if(e.m_bDefaultDescriptor&&n.m_bDefaultDescriptor)return ur()}else if(4326===o&&3857===a&&e.m_bDefaultDescriptor&&n.m_bDefaultDescriptor)return cr||(cr=ur().getInverse()),cr;const l=t.Envelope2D.constructEmpty();l.setCoords({env2D:s});const c=e.getCoordinateSystemType(),h=n.getCoordinateSystemType();if(0===c||0===h)return $s(e,n);if(r){const t=r.find(0,e.getGCS(),n.getGCS());if(t)return $s(e,n,t)}const u=e.getGCS().getLatestID(),m=n.getGCS().getLatestID();if(u>0&&u===m)return $s(e,n);const d=new or(e,n,s);{const e=function(e){if(ar.has(e.getHashCode()))return ar.get(e.getHashCode())}(d);if(e)return e}const p=Zs(0,e,n,l,1,!0);return function(e,t){return ar.set(e.getHashCode(),t),t}(d,$s(e,n,p.length?p[0]:void 0))}(n,s,r,o)}(0,e,n,s,r)}function js(e,t,i,n){return Ws(!0,e,t,i,n)}function Ws(e,t,n,s,r,o){return Cr()||i.throwProjectionEngineNotLoadedException("cannot create projection transformation"),new tr(e?2:1,t,n,s,r,o)}function Zs(e,t,n,s,r,o=!1){if(t&&n||i.throwInvalidArgumentException(""),Cr()||i.throwProjectionEngineNotLoadedException("cannot obtain geotransformation list"),1===e&&t.hasVCS()&&n.hasVCS())return i.throwNotImplementedException("hv xform not impl"),[];{const e=vo(t,n,s,r,o),i=[];for(const t of e)i.push(t);return i}}function Qs(){return{centralMeridianOfOutputGCS:Number.NaN,densificationStep:Number.NaN,clipWithInputHorizon:!0,clipWithOutputHorizon:!0,legacyHorizonClipping:!1,normalizeResultGeometry:!1,equals(e){return r.isEqualNonIEEE(this.centralMeridianOfOutputGCS,e.centralMeridianOfOutputGCS)&&r.isEqualNonIEEE(this.densificationStep,e.densificationStep)&&this.clipWithInputHorizon===e.clipWithInputHorizon&&this.clipWithOutputHorizon===e.clipWithOutputHorizon&&this.legacyHorizonClipping===e.legacyHorizonClipping&&this.normalizeResultGeometry===e.normalizeResultGeometry}}}function $s(e,t,i,n,s){return new tr(1,e,t,i,n,s)}function Ks(){return{flagsMask:0,setFlag(e,t){t?this.flagsMask|=e:this.flagsMask&=~e},hasFlag(e){return 0!==(this.flagsMask&e)}}}function Js(){return{m_extendedParams:Qs(),m_extendedParamsInternal:Ks()}}function er(){return Js()}let tr=class e{constructor(e,t,n,s,r,o){let a,l;this.m_datumTran=null,this.m_bIdentity=!0,this.m_bIdentityGeogToGeog=!0,this.m_bVertical=!1,this.m_bNormalize=!1,t&&n||i.throwInvalidArgumentException("!inputSR || !outputSR"),s&&0===s.getType()&&(s.m_bReadOnly=!0),this.m_bNormalize=!1,1!==e&&(a=t.getVCS(),l=n.getVCS(),this.m_bVertical=null!=a&&null!=l),this.m_inputSR=t,this.m_outputSR=n,this.m_bIdentity=!1,this.m_bIdentityGeogToGeog=!1,i.geometryReleaseAssert(!this.m_params),r&&(this.m_params=Js(),this.m_params.m_extendedParams=r),o&&(this.m_params||(this.m_params=Js()),this.m_params.m_extendedParamsInternal=o);let c=!1;const h=null!=s,u=t.getCoordinateSystemType(),m=n.getCoordinateSystemType();if(n.isPannable()&&0!==u&&r){const e=r.centralMeridianOfOutputGCS;if(!Number.isNaN(e)&&n.isPannable()){const t=n.getPannableExtent(),i=t.getCenterX();if(i!==e){const n=Math.ceil(t.width());e+n!==i+n&&(c=!0)}}}const d=r&&r.normalizeResultGeometry;if(t.equals(n))return this.m_bIdentity=!c,this.m_bIdentityGeogToGeog=!0,void this.updateProjector();const p=!h&&t.equalForProjection(n,this.m_bVertical);this.m_bIdentity=p&&!c,this.m_bIdentity?this.m_bIdentityGeogToGeog=!0:0!==u&&0!==m&&(d&&this.m_outputSR.isPannable()&&(this.m_bNormalize=d),this.m_datumTran=s||null,this.m_bIdentityGeogToGeog=(!this.m_datumTran||0===this.m_datumTran.count())&&this.m_inputSR.getGCS().equalForProjection(this.m_outputSR.getGCS(),this.m_bVertical)),this.updateProjector()}getInputSR(){return this.m_inputSR}getOutputSR(){return this.m_outputSR}getDatumTransformation(){return this.m_datumTran}getInverse(){const t=new e(1,this.m_outputSR,this.m_inputSR,this.m_datumTran?.createInverse());return t.m_bIdentity=this.m_bIdentity,t.m_bVertical=this.m_bVertical,t.m_bIdentityGeogToGeog=this.m_bIdentityGeogToGeog,t.updateProjector(),t}isIdentity(){return this.m_bIdentity}getExtendedParams(){return this.m_params?this.m_params.m_extendedParams:er().m_extendedParams}equals(e){return i.geometryReleaseAssert(0),!1}isVertical(){return this.m_bVertical}isMatchingTransformation(e,t){return i.geometryReleaseAssert(0),!1}getGeographicTransformations(){return this.m_datumTran}getExtendedParamsImpl(){return this.m_params?this.m_params.m_extendedParams:er().m_extendedParams}getExtendedParamsInternal(){return this.m_params?this.m_params.m_extendedParamsInternal:er().m_extendedParamsInternal}isIdentityGeogToGeog(){return this.m_bIdentityGeogToGeog}normalizeOutput(){return this.m_bNormalize}updateProjector(){this.m_projector=new Ki(this)}};const ir=new Map,nr=new Map,sr=new Map;function rr(t){let i=t.getCode();if(i>0)return pr(i)||dr(e.peFactory.coordsys(i));const n=t.getName();if(nr.has(n)){const e=nr.get(n);if(e&&e.deref()){const i=e.deref();if(i.m_peCoordSys.isEqual(t))return i}}return i=e.peFactory.getCode(t),dr(i>0?e.peFactory.coordsys(i):t)}class or{constructor(e,t,i){this.m_hashCode=-1,e&&(this.m_inputSR=e,this.m_outputSR=t,this.m_env=i.clone(),this.m_hashCode=this.m_inputSR.getHashCode(),this.m_hashCode=r.hashCombine(this.m_hashCode,this.m_outputSR.getHashCode()),this.m_env.isEmpty()||(this.m_hashCode=r.hashCombine(this.m_hashCode,r.hashDouble(this.m_env.xmin)),this.m_hashCode=r.hashCombine(this.m_hashCode,r.hashDouble(this.m_env.xmax)),this.m_hashCode=r.hashCombine(this.m_hashCode,r.hashDouble(this.m_env.ymin)),this.m_hashCode=r.hashCombine(this.m_hashCode,r.hashDouble(this.m_env.ymax))))}getHashCode(){return this.m_hashCode}equals(e){return!(this.m_inputSR&&!e.m_inputSR||!this.m_inputSR&&e.m_inputSR)&&this.m_env.equals(e.m_env)&&this.m_inputSR.equals(e.m_inputSR)&&this.m_outputSR.equals(e.m_outputSR)}clear(){this.m_inputSR=void 0,this.m_outputSR=void 0,this.m_hashCode=-1,this.m_env=void 0}}const ar=new Map;let lr,cr,hr;function ur(){return lr||(lr=js(jr(),Zr())),lr}const mr=new Map;function dr(e){const t=ro(e),i=e.getCode();if(i>0){const e=pr(i);if(e)return e}const n=e.getName();let s=nr.get(n);if(s){const t=s.deref();if(t&&t.m_peCoordSys.isEqual(e))return t}const r=new Ys(t.release());if(i>0)return r.setCached(),ir.set(i,new WeakRef(r)),nr.set(n,new WeakRef(r)),r;const o=es(e,0,!1);if(s=sr.get(o),s){const e=s.deref();if(e)return e}return r.setCached(),sr.set(o,new WeakRef(r)),r}function pr(e){const t=ir.get(e);if(t)return t.deref()}class gr extends d{constructor(t){return void 0===t?(super(),this.m_wkid=9001,void(this.m_peUnit=null)):"number"==typeof t?(super(),this.m_factor=t,void(this.m_wkid=0)):(super(t),void(t||(this.m_factor=1,this.m_wkid=9001,this.m_peUnit=(hr||(hr=e.peFactory.unit(9001)),hr))))}getUnitType(){return 0}convertFromMeters(e){return e/this.getUnitToBaseFactor()}convertToMeters(e){return e*this.getUnitToBaseFactor()}}const _r=["0","1","2","3","4","5","6","7","8","9","b","c","d","e","f","g","h","j","k","m","n","p","q","r","s","t","u","v","w","x","y","z"];function fr(e,t,n,s,r){i.geometryReleaseAssert(s>>5<r.length);let o=t,a=n;for(let t=s;t>=0;t-=2){const i=31&t,n=.5*(a+o);e>=n?(r[t>>5]|=1<<i,o=n):a=n}}let yr=new Set;const xr=2147483645n,vr=9007199254740990n,Pr="operation is not supported for unknown coordinate systems";var br;function Er(){return{majorSemiAxis:0,e2:0,minorSemiAxis:0,flattening:0,isSphere(){return 0===this.e2}}}function Sr(e){uo=e,i.geometryReleaseAssert(uo)}function Cr(){return!!e.peFactory}function wr(){return!!uo}function Tr(){return!!e.peFactory||!!uo}function Dr(e,t,n){return i.geometryReleaseAssert(Tr()),eo(e,void 0===t?0:t,0,!1)}function Ir(t,n){i.geometryReleaseAssert(Tr());const s=new Br;let r;return Cr()?(r=function(t){const n=ro(e.peFactory.fromString(e.peDefs.PE_TYPE_COORDSYS,t));return n.get()||i.throwInvalidWktException(t),rr(n.release())}(t),s.setHorzProj_(r),s.m_vertcs=null,s.m_userWKID=r.getLatestID()):(r=mo(t),s.m_unit=r.isPCS?new gr(r.metersOrRadiansPerUnit):new g(r.metersOrRadiansPerUnit)),$r(s.m_precisionDescriptor,r,null,1),s.m_bDefaultDescriptor=!0,s.m_userWKT=t,s.calculateHashCode(),s.initDbgName(),s}function Ar(e,t,n,s,r=!0){let o=null;return t&&(i.geometryReleaseAssert(0),o={}),function(e,t,n,s,r){e||i.throwInvalidArgumentException("!PE_coord_sys");const o=new Br;let a;return a=r?rr(e):new Ys(e,!1),$r(o.m_precisionDescriptor,a,t,s),o.m_bDefaultDescriptor=!0,o.setHorzProj_(a),o.m_vertcs=t,o.m_userWKID=a.getLatestID(),o.calculateHashCode(),o.initDbgName(),o}(e,o,0,s,r)}function Mr(e,t,n=!1){3===e.getCoordinateSystemType()&&i.throwInvalidArgumentException("image spatial reference cannot be altered");const s=new Br,r=e;return s.m_peCoordSysVal=r.m_peCoordSysVal,s.m_vertcs=r.m_vertcs,s.m_unit=r.m_unit,s.m_precisionDescriptor.assign(t),s.m_localZToXYFactor=r.m_localZToXYFactor,(Number.isNaN(s.m_precisionDescriptor.m_falseX)||Number.isNaN(s.m_precisionDescriptor.m_falseY))&&(s.m_precisionDescriptor.m_falseX=r.m_precisionDescriptor.m_falseX,s.m_precisionDescriptor.m_falseY=r.m_precisionDescriptor.m_falseY),s.m_precisionDescriptor.snapPrecision(),s.m_precisionDescriptor.fixTolerance(),s.m_userWKID=r.m_userWKID,s.m_precisionDescriptor.equals(r.m_precisionDescriptor)?s.m_bDefaultDescriptor=r.m_bDefaultDescriptor:s.m_bDefaultDescriptor=!1,n&&(s.m_bDefaultDescriptor=!0),s.calculateHashCode(),s.initDbgName(),s}function Nr(e,t,n){void 0===t&&(t=1),(t<=0||!Number.isFinite(t))&&i.throwInvalidArgumentException(""),e||1===t||i.throwInvalidArgumentException("null Unit has to have z_to_xy_factor equal to 1");const s=new Br;s.m_unit=e;const r=e||new gr(9001);return Jr(s.m_precisionDescriptor,r,null,1),s.m_bDefaultDescriptor=!0,Number.isNaN(s.m_precisionDescriptor.m_falseX)&&i.throwInvalidArgumentException("NAN false X/Y are not allowed here"),s.m_localZToXYFactor=t,s.calculateHashCode(),s.initDbgName(),s}function Rr(e,t){return e.snapGeometry(t)}function Or(e){const t=e.getCoordinateSystemType();return 1===t?e:(3===t&&i.geometryReleaseAssert(0),e.getGCS())}function Gr(t){return i.geometryReleaseAssert(Tr()),wr()?function(t){return i.geometryReleaseAssert(wr()),!!uo(t).isPCS||(n=t,e.peFactory&&i.throwInvalidCallException("pe has been loaded. no-pe methods should not be used at this point."),io||go(),io.has(n));var n}(t):function(t){if(mr.has(t))return mr.get(t);{const i=function(t){return null!==ro(e.peFactory.coordsys(t)).get()}(t);return mr.set(t,i),i}}(t)}function kr(t){if(Cr())return null!==ro(e.peFactory.fromString(e.peDefs.PE_TYPE_COORDSYS,t)).get();try{return mo(t),!0}catch(e){}return!1}let Vr;function Fr(){return Vr||(Vr=(()=>{const e=Math.trunc(Math.random()*r.intMax()),t=Date.now();return`|abba_000|${e.toString(16)}|${t.toString(16)}|`})()),Vr}!function(e){e[e.utmDefault=0]="utmDefault",e[e.utmNorthSouth=1]="utmNorthSouth"}(br||(br={}));let Lr=0;function qr(e=""){let t=`${Fr()}${Lr++}`;return""!==e&&(t+=`|${e}`),t}function Hr(e){return e.startsWith(Fr())}let Ur,zr,Yr,Br=class t{destroy(){var e;e=this.m_peCoordSysVal,nr.delete(e.m_peCoordSys.getName()),sr.delete(es(e.m_peCoordSys,0,!1)),1===this.getCoordinateSystemType()||2===this.getCoordinateSystemType()?this.getPECoordSys().destroy():i.throwInternalErrorException("SpatialReference.destroy")}constructor(){this.m_vertcs=null,this.m_peCoordSysVal=null,this.m_userWKID=0,this.m_userWKT=null,this.m_geogSpatialReference=null,this.m_srToGcs=null,this.m_gcsToSr=null,this.m_defaultPrecisionSR=null,this.m_localZToXYFactor=-1,this.m_precisionDescriptor=new Xr,this.m_hashCode=0,this.m_bDefaultDescriptor=!1,Qr(this.m_precisionDescriptor),yr&&yr.add(new WeakRef(this))}attachToPe(){(this.m_userWKID>0?Dr(this.m_userWKID):Ir(this.m_userWKT)).copyTo(this,!1)}copyTo(e,t=!0){(t||e.m_bDefaultDescriptor)&&(e.m_bDefaultDescriptor=this.m_bDefaultDescriptor,e.m_precisionDescriptor.assign(this.m_precisionDescriptor)),e.m_defaultPrecisionSR=null,e.m_gcsToSr=this.m_gcsToSr,e.m_geogSpatialReference=this.m_geogSpatialReference,e.m_hashCode=this.m_hashCode,e.m_localZToXYFactor=this.m_localZToXYFactor,e.m_peCoordSysVal=this.m_peCoordSysVal,e.m_srToGcs=this.m_srToGcs,e.m_userWKID=this.m_userWKID,e.m_userWKT=this.m_userWKT,e.m_vertcs=this.m_vertcs,e.m_unit=this.m_unit}getHashCode(){return this.m_hashCode}getHashCodeHorizontal(){let e=0;return e=this.m_peCoordSysVal?this.m_peCoordSysVal.getHashCode():this.m_unit?this.m_unit.getHashCode():305419891,e}updateTransform(e){if(1===this.getCoordinateSystemType())return js(this,this,null);let t=e?this.m_srToGcs:this.m_gcsToSr;if(t)return t;const i=this.getGCS();t=e?js(this,i,null):js(i,this,null);const n=t;return(e?this.m_srToGcs:this.m_gcsToSr)||(e?this.m_srToGcs=n:this.m_gcsToSr=n,t)}getHashCodeVertical(){return this.m_vertcs?this.m_vertcs.getHashCode():0}calculateHashCode(){let e=this.getHashCodeHorizontal();const t=this.getHashCodeVertical(),i=this.m_precisionDescriptor.getHashCode();e=r.hashCombine(e,t),this.m_hashCode=r.hashCombine(e,i)}initDbgName(){}setHorzProj_(e){this.m_peCoordSysVal=e,this.m_unit=this.m_peCoordSysVal.getUnit()}getTolerance(e=0){return this.m_precisionDescriptor.getTolerance(e)}getResolution(e=0){return this.m_precisionDescriptor.getResolution(e)}getPECoordSys(){return this.m_peCoordSysVal?this.m_peCoordSysVal.m_peCoordSys:null}getPCSInfo(){return this.throwIfNotGCSOrPCS(),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSInfo()}getCentralMeridian(){return this.throwIfNotGCSOrPCS(),1===this.getCoordinateSystemType()?0:this.getPCSInfo().getCentralMeridian()}getCoordinateSystemType(){const t=this.getPECoordSys();if(t)switch(t.getType()){case e.peDefs.PE_TYPE_GEOGCS:return 1;case e.peDefs.PE_TYPE_PROJCS:return 2;default:return 0}else{if((this.m_userWKID>0||this.m_userWKT)&&this.m_unit instanceof gr)return 2;if(this.m_unit instanceof g)return 1}return 0}getID(){return this.m_userWKID}getLatestID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getLatestID():this.m_userWKID}getOldID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getOldID():this.m_userWKID}getVerticalID(){return i.throwNotImplementedException("vcs not implemented"),0}getLatestVerticalID(){return this.m_vertcs?this.m_vertcs.getLatestID():0}getOldVerticalID(){return i.throwNotImplementedException("vcs not implemented"),0}getPEVerticalCoordSys(){return null}getPole(e){return this.throwIfNotGCSOrPCS(),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPole(e)}getText(){const e=this.getPECoordSys();return e?ts(e):this.m_userWKT??""}getTextExtended(e){const t=this.getPECoordSys();return t?this.getPEVerticalCoordSys()?(this.getPEVerticalCoordSys(),i.geometryReleaseAssert(0),""):ts(t,e):this.m_userWKT??""}getText2(t=-1){const n=this.getPECoordSys();return n?function(t,n){(n>1||n<-1)&&i.throwInvalidArgumentException("verbosity");let s=e.peDefs.PE_STR_FMT_WKT2;return-1!==n&&(s|=0===n?e.peDefs.PE_STR_AUTH_TOP:e.peDefs.PE_STR_AUTH_ALL),t.toString(s)}(n,t):this.m_userWKT??""}getUnit(){return this.m_unit}getUnitsPerMillimeter(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getUnitsPerMillimeter():this.m_unit instanceof gr?.001/this.m_unit.getUnitToBaseFactor():this.m_unit instanceof g?.001/(mo(this.m_userWKT??this.m_userWKID).semiMajor*this.m_unit.getUnitToBaseFactor()):(i.throwInvalidCallException("sr object not in valid state"),0)}getAuthorityName(){return this.getPECoordSys()?(i.geometryReleaseAssert(0),""):""}getVerticalUnit(){return i.throwNotImplementedException("vcs not implemented"),{}}getVCS(){return this.m_vertcs}hasVCS(){return!1}getGCSHorisonIsInclusive(){return this.throwIfNotGCSOrPCS(),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorisonIsInclusive()}getGCSHorizon(){return this.throwIfNotGCSOrPCS(),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorizon()}getGCS(){const e=this.getCoordinateSystemType();if(0===e)i.throwInvalidCallException(Pr);else{if(1===e)return this;3===e&&i.throwInvalidCallException("image cs not supported")}if(this.m_geogSpatialReference)return this.m_geogSpatialReference;let t;if(this===jr()||this===Wr())t=Zr();else{i.geometryReleaseAssert(this.m_peCoordSysVal);const e=this.m_peCoordSysVal.m_peCoordSys.getGeogcs();e||i.throwInternalErrorException(""),t=Ar(e,this.m_vertcs,0,this.m_precisionDescriptor.getPrecision(),this.m_peCoordSysVal.getCached())}return this.m_geogSpatialReference?t=this.m_geogSpatialReference:this.m_geogSpatialReference=t,t}getGCSSplitLines(){return this.throwIfNotGCSOrPCS(),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSSplitLines()}toGCS(e,t){if(0===e.length)return 0;e.length>t.length&&i.throwInvalidArgumentException("coordsSrc.size() > coordsDst.size()");const n=this.getCoordinateSystemType();if(0===n&&i.throwInvalidCallException(Pr),1===n)return r.assignObjectArray(t,e,e.length),e.length;i.geometryReleaseAssert(this.m_peCoordSysVal);const s=this.getSRToGCSTransform();return(new tn).transform(s,e,e.length,t)}toGeohash(e,t=8){const i=e.clone();i.scale(9102===this.getGCS().getUnit().getID()?1:this.getGCS().getUnit().getUnitToBaseFactor()/Math.PI*180),i.x<-180?(i.x=r.fmod(i.x,360),i.x<-180&&(i.x+=360)):i.x>180&&(i.x=r.fmod(i.x,360),i.x>180&&(i.x-=360)),i.y>90&&(i.y=90),i.y<-90&&(i.y=-90);const n=5*t,s=new Uint32Array(4);return fr(i.x,-180,180,n-1,s),fr(i.y,-90,90,n-2,s),function(e,t,i){const n=r.makePrimitiveArray(t,"R");let s=0,o=0;for(let i=0;i<t;i++){let r=e[s]>>o&31;if(o+=5,o>31){const t=37-o;r&=(1<<t)-1,o-=32,s++,r|=(e[s]&(1<<o)-1)<<t}const a=_r[r];n[t-1-i]=a}return i>t?n.push(..."0".repeat(i-t)):i<t&&(n.length=i),n.join("")}(s,t,t)}isPannable(){const e=this.getCoordinateSystemType();return 0!==e&&3!==e&&(i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.isPannable())}getPannableExtent(){return this.isPannable()||i.throwInvalidArgumentException("!is_pannable"),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtent()}getPannableExtentInGCS(){return this.isPannable()||i.throwInvalidArgumentException("!is_pannable"),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtentGCS()}throwIfNotGCSOrPCS(){const e=this.getCoordinateSystemType();1!==e&&2!==e&&i.throwInvalidArgumentException("Not a GCS or PCS")}getDomainXY(){return this.throwIfNotGCSOrPCS(),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getDomainXY()}getFullWorldExtent(){return this.throwIfNotGCSOrPCS(),this.isPannable()?this.getPannableExtent():this.getDomainXY()}queryPrecisionDescriptor(e){if(e.assign(this.m_precisionDescriptor),Number.isNaN(e.m_falseX))if(Cr()||i.throwProjectionEngineNotLoadedException("cannot query precision descriptor"),i.geometryReleaseAssert(null!==this.m_peCoordSysVal),2!==this.m_precisionDescriptor.m_precision){const t=this.m_peCoordSysVal.getDomainXY();e.m_falseX=t.xmin,e.m_falseY=t.ymin}else e.m_falseX=-Number.MAX_VALUE,e.m_falseY=-Number.MAX_VALUE}queryPrecisionDescriptorWithoutFalseXY(e){e.assign(this.m_precisionDescriptor),e.m_falseX=Number.NaN,e.m_falseY=Number.NaN}queryDefaultPrecisionDescriptorWithoutFalseXY(e){if(this.m_bDefaultDescriptor)e.assign(this.m_precisionDescriptor);else{const t=this.getCoordinateSystemType();0===t?Jr(e,this.m_unit,this.m_vertcs,this.m_precisionDescriptor.getPrecision()):3===t?i.throwNotImplementedException("image cs"):$r(e,this.m_peCoordSysVal,this.m_vertcs,this.m_precisionDescriptor.getPrecision())}e.m_falseX=Number.NaN,e.m_falseY=Number.NaN}horizontalEqual(e){return(t=this.m_peCoordSysVal)===(i=e.m_peCoordSysVal)||null!==t&&null!==i&&t.m_csType===i.m_csType&&(0===t.m_WKID&&0===i.m_WKID?t.m_hashCode===i.m_hashCode&&t.m_canonicalWkt===i.m_canonicalWkt:t.m_WKID===i.m_WKID);var t,i}verticalEqual(e){return null!==this.m_vertcs==(null!==e.m_vertcs)&&(!this.m_vertcs||this.m_vertcs.equals(e.m_vertcs))}equals(e){const t=e;if(this===t)return!0;if(!this.horizontalEqual(t)||!this.verticalEqual(t))return!1;if(!t.m_peCoordSysVal){if(i.geometryReleaseAssert(!this.m_peCoordSysVal),null!==this.m_unit!=(null!==t.m_unit))return!1;if(this.m_unit&&!this.m_unit.equals(t.m_unit))return!1;if(this.m_localZToXYFactor!==t.m_localZToXYFactor)return!1}if(!this.m_bDefaultDescriptor||!t.m_bDefaultDescriptor){if(this.m_peCoordSysVal){if(!this.m_precisionDescriptor.equalsWithoutFalseXY(t.m_precisionDescriptor))return!1;i.geometryReleaseAssert(t.m_peCoordSysVal);let e=this.m_precisionDescriptor.m_falseX,n=this.m_precisionDescriptor.m_falseY;if(Number.isNaN(e)){const t=this.m_peCoordSysVal.getDomainXY();e=t.xmin,n=t.ymin}let s=t.m_precisionDescriptor.m_falseX,r=t.m_precisionDescriptor.m_falseY;if(Number.isNaN(s)){const e=t.m_peCoordSysVal.getDomainXY();s=e.xmin,r=e.ymin}return e===s&&n===r}return this.m_precisionDescriptor.equals(t.m_precisionDescriptor)}return!0}equalForProjection(e,t){if(this===e)return!0;const i=this.getCoordinateSystemType(),n=e.getCoordinateSystemType();if(0===i||0===n)return 0===i&&0===n?(!t||this.getZToXYFactor()===e.getZToXYFactor())&&(!this.getUnit()||!e.getUnit()||this.getUnit().equals(e.getUnit())):3!==i&&3!==n&&(null===this.getUnit()||null===e.getUnit()||(!t||this.getZToXYFactor()===e.getZToXYFactor())&&this.getUnit().equals(e.getUnit()));if(i!==n)return!1;if(3===i)return this.equals(e);if((s=this.m_peCoordSysVal)===(r=e.m_peCoordSysVal)||null!==s&&null!==r&&s.m_csType===r.m_csType&&(0===s.m_WKID&&0===r.m_WKID?1===s.m_csType?s.m_peCoordSys.isEqual(r.m_peCoordSys):s.m_peCoordSys===r.m_peCoordSys:s.m_WKID===r.m_WKID)){if(!t)return!0;if(null!==this.m_vertcs==(null!==e.m_vertcs))return!this.m_vertcs||this.m_vertcs.equalForProjection(e.m_vertcs)}var s,r;return!1}equalHorizontal(e){return this.horizontalEqual(e)}equalVertical(e){return i.geometryReleaseAssert(0),!1}equalVerticalVCS(e){return i.geometryReleaseAssert(0),!1}convergenceAngle(e){return i.geometryReleaseAssert(0),0}getPeCoordsysCopy(){if(this.m_peCoordSysVal){const e=this.m_peCoordSysVal.m_peCoordSys;return e||i.throwInternalErrorException("cannot clone coord sys"),e}return null}getPeVertcsCopy(){return i.geometryReleaseAssert(0),0}throwIfLocal(){0===this.getCoordinateSystemType()&&i.throwInvalidArgumentException(Pr)}getPrimeMeridian(){return this.throwIfLocal(),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPrimeMeridian()}getSRToGCSTransform(){return this.updateTransform(!0)}getGCSToSRTransform(){return this.updateTransform(!1)}getOneMeter(){return 1e3*this.getUnitsPerMillimeter()}getOneMeterPCSUnit(){return this.throwIfNotGCSOrPCS(),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneMeterPCSUnit()}getDefaultPrecisionSR(){if(this.m_bDefaultDescriptor)return this;if(null===this.m_defaultPrecisionSR){const e=new Xr;this.queryDefaultPrecisionDescriptorWithoutFalseXY(e),this.m_defaultPrecisionSR=Mr(this,e,!0)}return this.m_defaultPrecisionSR}getPCSHorizon(){return this.throwIfNotGCSOrPCS(),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSHorizon()}getHorzUnitFactor(){return this.m_unit?this.m_unit.getUnitToBaseFactor():1}querySpheroidData(e){this.throwIfNotGCSOrPCS(),i.geometryReleaseAssert(this.m_peCoordSysVal);const t=this.getGCS().getPECoordSys().getDatum().getSpheroid(),n=t.getFlattening();var s,r,o;r=t.getAxis(),o=n,(s=e).majorSemiAxis=r,s.minorSemiAxis=r*(1-o),s.e2=o*(2-o),s.flattening=o}getAreaOfUse(){0===this.getCoordinateSystemType()&&i.throwInvalidCallException(""),i.geometryReleaseAssert(this.m_peCoordSysVal);const e=this.m_peCoordSysVal.getAreaOfUse();return null===e?new m:new m({geom:e.clone(),sr:Dr(4326)})}getZToXYFactor(){return 1}isCustomWkid(){return!1}getOneDegreeGCSUnit(){return this.throwIfNotGCSOrPCS(),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneDegreeGCSUnit()}getGcsUnitFactor(){return this.throwIfNotGCSOrPCS(),i.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getGcsUnitFactor()}snapGeometry(e){if(e.isEmpty())return!1;if(2===this.m_precisionDescriptor.getPrecision())return!1;const t=e.getGeometryType();if(i.isMultiVertex(t))return this.snapMultiVertex_(e);if(t===i.GeometryType.enumPoint)return this.snapPoint_(e);if(t===i.GeometryType.enumEnvelope)return this.snapEnvelope_(e);if(i.isSegment(t))return this.snapSegment_(e);if(t===i.GeometryType.enumGeometryCollection){const t=e;let i=!1;for(let e=0,n=t.getGeometryCount();e<n;++e)i=this.snapGeometry(t.getGeometry(e))||i;return i}i.throwInternalErrorException("what else?")}snapMultiVertex_(e){if(i.geometryReleaseAssert(!e.isEmpty()),i.geometryReleaseAssert(2!==this.m_precisionDescriptor.getPrecision()),i.isMultiPath(e.getGeometryType())){const t=e;if(t.hasNonLinearSegments())return this.snapGeometryWithCurves_(t)}const t=e.getImpl(),n=t.getDescription();let s=!1;for(let e=0,i=n.getAttributeCount();e<i;e++){const i=n.getSemantics(e),r=t.getAttributeStreamRef(i);s=this.snapAttributes(i,r,0,t.getPointCount())||s}return s&&t.notifyModifiedFlags(2001),s}snapPoint_(e){return!1}snapEnvelope_(e){return!1}snapSegment_(e){i.geometryReleaseAssert(!e.isEmpty()),i.geometryReleaseAssert(2!==this.m_precisionDescriptor.getPrecision());const t=new Xr;this.queryPrecisionDescriptor(t);const n=e.getStartXY(),s=new r.Point2D;s.x=to(n.x,t.getFalseX(),t.getGridUnitsXY()),s.y=to(n.y,t.getFalseY(),t.getGridUnitsXY());let o=!s.equals(n);const a=e.getEndXY(),l=new r.Point2D;l.x=to(a.x,t.getFalseX(),t.getGridUnitsXY()),l.y=to(a.y,t.getFalseY(),t.getGridUnitsXY()),o||=!l.equals(a),o&&e.changeEndPoints2D(s,l);const c=(t,i,n)=>{let s=!1;{const o=e.getStartAttributeAsDbl(t,0),a=to(o,i,n),l=!r.isEqualNonIEEE(a,o);s||=l,l&&e.setStartAttribute(t,0,a)}{const o=e.getEndAttributeAsDbl(t,0),a=to(o,i,n),l=!r.isEqualNonIEEE(a,o);s||=l,l&&e.setEndAttribute(t,0,a)}return s};let h=o?1:0;return e.hasAttribute(1)&&(h|=c(1,t.getFalseZ(),t.getGridUnitsZ())?1:0),e.hasAttribute(2)&&(h|=c(2,t.getFalseM(),t.getGridUnitsM())?1:0),!!h}snapGeometryWithCurves_(e){i.geometryReleaseAssert(!e.isEmpty()),i.geometryReleaseAssert(2!==this.m_precisionDescriptor.getPrecision());const t=e.createInstance(),r=new n.SegmentBuffer;let o=0;for(let i=0,n=e.getPathCount();i<n;++i){const n=e.getSegmentCountPath(i);if(0===n){if(t.addPath(e,i,!0),1===t.getPathSize(i)){const e=new s.Point;t.getPointByVal(t.getPointCount()-1,e),o|=this.snapGeometry(e)?1:0,t.setPointByVal(t.getPointCount()-1,e)}continue}const a=e.isClosedPath(i);for(let s=0,l=a?n-1:n;s<l;++s)e.getSegmentFromPath(i,s,r,!1),o|=this.snapGeometry(r.get())?1:0,t.addSegment(r.get(),0===s);a&&(e.getSegmentFromPath(i,n-1,r,!1),o|=this.snapGeometry(r.get())?1:0,1===n?t.addPathFromClosedSegment(r.get(),!1):t.closeLastPathWithSegment(r.get()))}return o&&t.copyTo(e),!!o}snapAttributes(e,i,n,s){let o=!1;const a=new Xr;if(this.queryPrecisionDescriptor(a),0===e){const e=i;for(let i=n;i<s;i++){const n=e.read(2*i),s=t.s_SnapValue(n,a.getFalseX(),a.getGridUnitsXY()),r=e.read(2*i+1),l=t.s_SnapValue(r,a.getFalseY(),a.getGridUnitsXY());o=o||s!==n||l!==r,o&&(e.write(2*i,s),e.write(2*i+1,l))}}else if(1===e){const e=i;for(let i=n;i<s;i++){const n=e.read(i),s=t.s_SnapValue(n,a.getFalseZ(),a.getGridUnitsZ());o=o||!r.isEqualNonIEEE(s,n),o&&e.write(i,s)}}else if(2===e){const e=i;for(let i=n;i<s;i++){const n=e.read(i),s=t.s_SnapValue(n,a.getFalseM(),a.getGridUnitsM());o=o||!r.isEqualNonIEEE(s,n),o&&e.write(i,s)}}return o}static s_SnapValue(e,t,i){return r.round((e-t)*i)/i+t}};class Xr{constructor(){const e=vr,t=.001,i=1e-4*Number(e)*.5;this.m_precision=1,this.m_falseX=-i,this.m_falseY=-i,this.m_unitsXY=Number(e)/(2*i),this.m_falseM=-1e5,this.m_unitsM=1e4,this.m_falseZ=-1e5,this.m_unitsZ=1e4,this.m_toleranceXY=t,this.m_toleranceM=t,this.m_toleranceZ=t}getHashCode(){let e=7777,t=7777;return t=r.hashCombine(t,this.m_falseM),t=r.hashCombine(t,this.m_unitsM),e=r.hashCombine(e,this.m_unitsXY),t=r.hashCombine(t,this.m_toleranceXY),e=r.hashCombine(e,this.m_falseZ),t=r.hashCombine(t,this.m_toleranceZ),e=r.hashCombine(e,this.m_unitsZ),t=r.hashCombine(t,this.m_toleranceM),e=r.hashCombine(e,this.m_precision),r.hashCombine(e,t)}clone(){const e=new Xr;return e.m_falseX=this.m_falseX,e.m_falseY=this.m_falseY,e.m_unitsXY=this.m_unitsXY,e.m_falseZ=this.m_falseZ,e.m_unitsZ=this.m_unitsZ,e.m_falseM=this.m_falseM,e.m_unitsM=this.m_unitsM,e.m_toleranceXY=this.m_toleranceXY,e.m_toleranceZ=this.m_toleranceZ,e.m_toleranceM=this.m_toleranceM,e.m_precision=this.m_precision,e}assign(e){return this.m_falseX=e.m_falseX,this.m_falseY=e.m_falseY,this.m_unitsXY=e.m_unitsXY,this.m_falseZ=e.m_falseZ,this.m_unitsZ=e.m_unitsZ,this.m_falseM=e.m_falseM,this.m_unitsM=e.m_unitsM,this.m_toleranceXY=e.m_toleranceXY,this.m_toleranceZ=e.m_toleranceZ,this.m_toleranceM=e.m_toleranceM,this.m_precision=e.m_precision,this}initialize2D(e,t){}getTolerance(e){switch(e){case 0:return this.m_toleranceXY;case 1:return this.m_toleranceZ;case 2:return this.m_toleranceM;default:return 0}}getResolution(e){if(2===this.m_precision)return 0;switch(e){case 0:return 1/this.m_unitsXY;case 1:return 1/this.m_unitsZ;case 2:return 1/this.m_unitsM;default:return 0}}getFalseX(){return this.m_falseX}getFalseY(){return this.m_falseY}getFalseZ(){return this.m_falseZ}getFalseM(){return this.m_falseM}getGridUnitsXY(){return this.m_unitsXY}getGridUnitsZ(){return this.m_unitsZ}getGridUnitsM(){return this.m_unitsM}getPrecision(){return this.m_precision}static getLimit32(){return 2147483645}static getLimit64(){return 9007199254740990n}static getLimitFloat(){return 0}getXYGridRange(){const e=new t.Envelope2D;switch(this.m_precision){case 0:{const t=Xr.getLimit32()/this.getGridUnitsXY();e.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+t,ymax:this.getFalseY()+t})}break;case 1:{const t=Number(Xr.getLimit64())/this.getGridUnitsXY();e.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+t,ymax:this.getFalseY()+t})}break;case 2:e.setCoords({xmin:-Number.MAX_VALUE,ymin:-Number.MAX_VALUE,xmax:Number.MAX_VALUE,ymax:Number.MAX_VALUE});break;default:e.setEmpty(),i.throwInternalErrorException("")}return e}getZGridRange(){const e=new r.Envelope1D;switch(this.m_precision){case 0:{const t=Xr.getLimit32()/this.getGridUnitsZ();e.setCoords(this.getFalseZ(),this.getFalseZ()+t)}break;case 1:{const t=Number(Xr.getLimit64())/this.getGridUnitsZ();e.setCoords(this.getFalseZ(),this.getFalseZ()+t)}break;case 2:e.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:e.setEmpty(),i.throwInternalErrorException("")}return e}getMGridRange(){const e=new r.Envelope1D;switch(this.m_precision){case 0:{const t=Xr.getLimit32()/this.getGridUnitsM();e.setCoords(this.getFalseM(),this.getFalseM()+t)}break;case 1:{const t=Number(Xr.getLimit64())/this.getGridUnitsM();e.setCoords(this.getFalseM(),this.getFalseM()+t)}break;case 2:e.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:e.setEmpty(),i.throwInternalErrorException("")}return e}setTolerance(e,t){switch(t<0&&i.throwInvalidArgumentException("tol < 0"),Number.isFinite(t)||i.throwInvalidArgumentException("tol is not finite"),e){case 0:this.m_toleranceXY=t;break;case 1:this.m_toleranceZ=t;break;case 2:this.m_toleranceM=t;break;default:i.throwInvalidArgumentException("cannot set tolerance for this attribute")}}setGridParams(e,t,n){Number.isFinite(e)&&Number.isFinite(t)&&Number.isFinite(n)||i.throwInvalidArgumentException("grid params are not finite"),n<1&&i.throwInvalidArgumentException("grid units cannot be smaller than 1.0"),this.m_falseX=e,this.m_falseY=t,this.m_unitsXY=n}setZParams(e,t){Number.isFinite(e)&&Number.isFinite(t)||i.throwInvalidArgumentException("grid params are not finite"),t<1&&i.throwInvalidArgumentException("grid units cannot be smaller than 1.0"),this.m_falseZ=e,this.m_unitsZ=t}setMParams(e,t){Number.isFinite(e)&&Number.isFinite(t)||i.throwInvalidArgumentException("grid params are not finite"),t<1&&i.throwInvalidArgumentException("grid units cannot be smaller than 1.0"),this.m_falseM=e,this.m_unitsM=t}setPrecision(e){}equals(e){return this===e||r.isEqualNonIEEE(this.m_falseX,e.m_falseX)&&r.isEqualNonIEEE(this.m_falseY,e.m_falseY)&&this.equalsWithoutFalseXY(e)}snapPrecision(){if(2===this.m_precision)return;const e=(e,t,i,n)=>{if(!Number.isFinite(t)||!Number.isFinite(i))return i;if(i<1)return 1;if(!n)return i;const s=Number(e)/i;return Math.trunc((t+s-t)*i)>e&&(i=e/(t+s-t)),Math.max(1,i)},t=Number(0===this.m_precision?xr:vr);this.m_unitsXY=e(t,this.m_falseX,this.m_unitsXY,!0),this.m_unitsXY=e(t,this.m_falseY,this.m_unitsXY,!0),this.m_unitsZ=e(t,this.m_falseZ,this.m_unitsZ,!1),this.m_unitsM=e(t,this.m_falseM,this.m_unitsM,!1)}verifyPrecision(){if(2===this.m_precision)return!0;const e=(e,t,i,n)=>{if(i<1)return!1;if(!Number.isFinite(t)||!Number.isFinite(i))return!1;if(!n)return!0;const s=Number(e)/i;return!(BigInt((t+s-t)*i)>e)},t=0===this.m_precision?xr:vr;return!!(e(t,this.m_falseX,this.m_unitsXY,!0)&&e(t,this.m_falseY,this.m_unitsXY,!0)&&e(t,this.m_falseZ,this.m_unitsZ,!1)&&e(t,this.m_falseM,this.m_unitsM,!1))}fixTolerance(){2!==this.m_precision&&(this.m_toleranceXY=Math.max(2/this.m_unitsXY,this.m_toleranceXY),this.m_toleranceZ=Math.max(2/this.m_unitsZ,this.m_toleranceZ),this.m_toleranceM=Math.max(2/this.m_unitsM,this.m_toleranceM),(Number.isNaN(this.m_falseX)||Number.isNaN(this.m_falseY))&&(this.m_falseX=this.m_falseY=Number.NaN))}equalsWithoutFalseXY(e){return this===e||this.m_unitsXY===e.m_unitsXY&&this.m_falseZ===e.m_falseZ&&this.m_unitsZ===e.m_unitsZ&&this.m_falseM===e.m_falseM&&this.m_unitsM===e.m_unitsM&&this.m_toleranceXY===e.m_toleranceXY&&this.m_toleranceZ===e.m_toleranceZ&&this.m_toleranceM===e.m_toleranceM&&this.m_precision===e.m_precision}setBestXyDomainFromEnvelope(e,t){}setBestZDomainFromZRange(e,t,i){}setBestMDomainFromMRange(e,t,i){}}function jr(){return(!Ur||Cr()&&null===Ur.getPECoordSys())&&(Ur=eo(3857,0,0,!0)),Ur}function Wr(){return(!zr||Cr()&&null===zr.getPECoordSys())&&(zr=eo(102100,0,0,!0)),zr}function Zr(){return(!Yr||Cr()&&null===Yr.getPECoordSys())&&(Yr=eo(4326,0,0,!0)),Yr}function Qr(e){e.m_falseX=0,e.m_falseY=0,e.m_unitsXY=1,e.m_falseZ=0,e.m_unitsZ=1,e.m_falseM=0,e.m_unitsM=1,e.m_toleranceXY=100*r.doubleEps(),e.m_toleranceZ=100*r.doubleEps(),e.m_toleranceM=100*r.doubleEps(),e.m_precision=2}function $r(e,t,n,s){const r=t instanceof Ys;Qr(e),e.m_precision=s,e.m_falseX=Number.NaN,e.m_falseY=Number.NaN;const o=1e-4,a=.001,l=r?t.m_csType:t.isPCS?2:1;if(1===l){const i=(0===s?1/18e5:1e-9)*(r?t.getOneDegreeGCSUnit():Math.PI/t.metersOrRadiansPerUnit/180);e.m_unitsXY=1/i}else if(2===l){const i=(0===s?a:o)*(r?t.getOneMeterPCSUnit():1/t.metersOrRadiansPerUnit);e.m_unitsXY=1/i}else i.throwInvalidArgumentException("unrecognized cs type");e.m_falseM=-1e5,e.m_unitsM=1/(0===s?a:o),e.m_unitsM=Math.max(1,e.m_unitsM),e.m_unitsXY=Math.max(1,e.m_unitsXY);let c=0,h=0;0!==s&&1!==s||(c=2/e.m_unitsXY,h=2/e.m_unitsM),e.m_toleranceXY=Math.max(c,r?t.getUnitsPerMillimeter():2===l?.001/t.metersOrRadiansPerUnit:.001/(t.semiMajor*t.metersOrRadiansPerUnit)),e.m_toleranceM=Math.max(a,h),Kr(e,n)}function Kr(e,t){const i=1e-4,n=.001;if(e.m_falseZ=-1e5,t){const s=(0===e.m_precision?n:i)*t.getOneMeter();e.m_unitsZ=1/s}else e.m_unitsZ=1/(0===e.m_precision?n:i);e.m_unitsZ=Math.max(1,e.m_unitsZ);let s=0;0!==e.m_precision&&1!==e.m_precision||(s=2/e.m_unitsZ),e.m_toleranceZ=Math.max(t?t.getOneMeter()*n:n,s)}function Jr(e,t,i,n){Qr(e),e.m_precision=n;const s=0===n?xr:vr,r=1e-4,o=.001;let a=1,l=1,c=.001;t&&(l=t.getUnitToBaseFactor()),t&&1===t.getUnitType()?(a=400*Math.PI/180,c=8.983152841195215e-9*Math.PI/180/l):(a=(0===n?o:r)*Number(s)*.5,c=o/l),a/=l,e.m_falseX=-a,e.m_falseY=-a,e.m_unitsXY=Number(s)/(2*a),e.m_falseM=-1e5,e.m_unitsM=1/(0===n?o:r),e.m_unitsM=Math.max(1,e.m_unitsM),e.snapPrecision();let h=0,u=0;0!==e.m_precision&&1!==e.m_precision||(u=2/e.m_unitsM,h=2/e.m_unitsXY),e.m_toleranceXY=Math.max(h,c),e.m_toleranceM=Math.max(o,u),Kr(e,i)}function eo(t,n,s,r){if(!r&&n<=0){if(3857===t)return jr();if(102100===t)return Wr();if(4326===t)return Zr()}const o=new Br;let a,l=null;return Cr()?(a=function(t){t<=0&&i.throwInvalidWkidException(t);{const e=pr(t);if(e)return e}const n=ro(e.peFactory.coordsys(t));n.get()||i.throwInvalidWkidException(t);const s=dr(n.release());return s.getLatestID()!==t&&ir.set(t,new WeakRef(s)),s}(t),n>0?l=null:n=0,o.setHorzProj_(a),o.m_vertcs=l):(a=mo(t),o.m_unit=a.isPCS?new gr(a.metersOrRadiansPerUnit):new g(a.metersOrRadiansPerUnit)),$r(o.m_precisionDescriptor,a,l,1),o.m_bDefaultDescriptor=!0,o.m_userWKID=t,o.calculateHashCode(),o.initDbgName(),o}function to(e,t,i){return r.round((e-t)*i)/i+t}let io=null;const no=3552713678800501e-30;function so(e,t){return function(e,t,i){return e===t||Math.abs(e-t)<=i*(1+(Math.abs(e)+Math.abs(t))/2)}(e,t,no)}function ro(e){return{_this:e,get(){return this._this},reset(e){this._this=e},release(){const e=this._this;return this._this=null,e}}}let oo,ao,lo,co,ho;e.PeDoubleClass=void 0,e.peFactory=void 0,e.peDefs=void 0,e.peCSTransformations=void 0,e.peLineType=void 0,e.peMath=void 0;let uo=null;function mo(t){i.geometryReleaseAssert(uo);const n=uo(t);return n.semiMajor=n.isPCS?Number.NaN:function(t){if(e.peFactory&&i.throwInvalidCallException("pe has been loaded. no-pe methods should not be used at this point."),"string"==typeof t){const e=t.match(po);e&&2===e.length||i.throwInvalidArgumentException("bad gcs wkt");const n=Number.parseFloat(e[1]);return Number.isFinite(n)||i.throwInvalidArgumentException("bad gcs wkt"),n}return io||go(),io.has(t)||i.throwInvalidCallException("gcs wkid not found"),io.get(t)}(t),n}const po=/(?:ELLIPSOID|SPHEROID)\["(?:\w|[-()])+",(\d+\.\d+)/;function go(){io=new Map;for(const e in p){const t=Number.parseFloat(e),i=p[e];if(Array.isArray(i))for(const e of i)io.set(e,t);else io.set(i,t)}!function(){for(const e in p)delete p[e]}()}function _o(e,t){return new xo(e,t)}const fo=r.hashInt32(0),yo=r.hashInt32(1);let xo=class t{constructor(e,i){if(e instanceof t)return this.m_geogTranWrapper=e.m_geogTranWrapper,this.m_bInverted=i?!e.m_bInverted:e.m_bInverted,void(this.m_hashCode=r.hashCombine(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?yo:fo));this.m_geogTranWrapper=new Fn(e),this.m_bInverted=i,this.m_hashCode=r.hashCombine(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?yo:fo)}getID(){return this.m_geogTranWrapper.getLatestId()}getLatestID(){return this.m_geogTranWrapper.getLatestId()}getText(){return this.m_geogTranWrapper.getText()}getTextExtended(t){if(!this.m_geogTranWrapper.getGeogtran())return"";if(-1===t)return this.m_geogTranWrapper.getGeogtran().toString();{const i=0===t?e.peDefs.PE_STR_AUTH_TOP:e.peDefs.PE_STR_AUTH_ALL;return this.m_geogTranWrapper.getGeogtran().toString(i)}}getText2(t=-1){let i=e.peDefs.PE_STR_FMT_WKT2;return-1!==t&&(i|=0===t?e.peDefs.PE_STR_AUTH_TOP:e.peDefs.PE_STR_AUTH_ALL),this.m_geogTranWrapper.getGeogtran().toString(i)}getName(){return this.m_geogTranWrapper&&this.m_geogTranWrapper.getGeogtran()?this.m_geogTranWrapper.getGeogtran().getName():""}getInputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getOutputSr(!1):this.m_geogTranWrapper.getInputSr(!1)}getOutputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getInputSr(!1):this.m_geogTranWrapper.getOutputSr(!1)}getInverse(){return new t(this,!0)}isInverted(){return this.m_bInverted}getHashCode(){return this.m_hashCode}GetPeGeogtran(){return this.m_geogTranWrapper.getGeogtran()}equals(e){const t=e;return t===this||this.m_bInverted===t.m_bInverted&&(this.GetPeGeogtran()===t.GetPeGeogtran()||this.getID()===t.getID()&&!(0===this.getID()&&!this.GetPeGeogtran().isEqual(t.GetPeGeogtran())))}referencesMissingData(){return!!this.m_geogTranWrapper&&!this.m_geogTranWrapper.isUsable()}getWrapper(){return this.m_geogTranWrapper}};function vo(e,t,n,o,a){const l=e.getGCS(),c=t.getGCS(),h=l.getPECoordSys(),u=c.getPECoordSys();let m=null;if(!n.isEmpty()){const t=n.clone();if(!t.isEmpty()&&2===e.getCoordinateSystemType()){let i=new s.Envelope({env2D:t});const n=js(e,l,null);i=(new tn).execute(i,n,null),i.queryEnvelope(t)}if(!t.isEmpty()){const e=h.getPrimem().getLongitude(),i=h.getUnit().getUnitFactor();m=new ho(t.xmin,t.ymin,t.xmax,t.ymax,e,i)}}let d=o;d>=r.intMax()&&(d=0);const p=[];let g=lo.PE_GTLIST_OPTS_COMMON;a||(g&=~lo.PE_GTLIST_OPTS_USABLE);for(let e=0;e<2;e++){p.length=0;const e=d,t=lo.getGTlist(h,u,2,g,m,e);let n=!1;if(t&&t.length>0)for(let e=0,s=t.length;e<s;e++){const s=Po([t[e]]);if(i.geometryReleaseAssert(s),a&&s.referencesMissingData())n=!0;else if(p.push(s),o>0&&p.length===o)break}if(!n)break;0===d||(d=0)}return m&&m.destroy(),p}function Po(e){i.geometryReleaseAssert(null!==e);const t=new Eo,n=e[0].getSteps();if(n){const i=e[0].getEntries();for(let e=0;e<n;e++){const n=0!==i[e].getDirection(),s=_o(i[e].getGeogtran(),n);t.add(s)}return t.create()}return null}let bo=class{constructor(e,t,i,n){this.m_bReadOnly=!0,this.m_name="",this.m_fastTrack=-1,this.m_bNameIsSet=!1,this.m_transforms=e,t&&(this.m_name=t,this.m_bNameIsSet=!0),this.m_inputSr=i,this.m_outputSr=n}getType(){return 0}getName(){if(this.m_bNameIsSet)return this.m_name;if(0===this.m_transforms.length)return"";let e="";for(const t of this.m_transforms)e.length>0&&(e+=" + "),t.isInverted()&&(e+="~"),e+=t.getName();return e}count(){return this.m_transforms.length}createInverse(){return this.getInverse()}getHashCode(){let e=1973;for(let t=0;t<this.m_transforms.length;t++)e=r.hashCombine(e,this.m_transforms[t].getHashCode());return e}equals(e){return i.geometryReleaseAssert(0),!1}referencesMissingData(){if(0===this.m_transforms.length)return!1;for(const e of this.m_transforms)if(e.referencesMissingData())return!0;return!1}isMatchingTransformation(e,t){return i.geometryReleaseAssert(0),!1}validateTransformation(e,t){return i.geometryReleaseAssert(0),!1}nameIsSet(){return i.geometryReleaseAssert(0),!1}getInputSpatialReference(){return this.m_inputSr}getOutputSpatialReference(){return this.m_outputSr}getStep(e){return(e<0||e>this.count())&&i.throwOutOfRangeException(""),this.m_transforms[e]}getInverse(){const e=new Eo;return e.addSteps(this,!0),e.setInputSpatialReference(this.m_outputSr),e.setOutputSpatialReference(this.m_inputSr),e.create()}transform(t,i,s){if(0===this.count())return;let o=this.m_inputSr,a=this.m_outputSr;if(t&&(a=r.swap(o,o=a)),0===this.m_transforms.length)return void Ln(o,null,a,null,i,null,s);let l=this.m_fastTrack;if(1===l)return void n.forEachDir(t,this.m_transforms,(n=>{!function(t,i,n,s,r){const o=t.getVerttran(),a=t.getGeogtran();if(r>0){t.prepareOrThrow();const s=i?e.peDefs.PE_TRANSFORM_2_TO_1:e.peDefs.PE_TRANSFORM_1_TO_2;o?Os():Gs(a,r,n,null,s)}}(n.getWrapper(),t!==n.isInverted(),i,0,s)}));const c=Vn();-1===l&&c.initFromGcsAndVcs(o,null);const h=Vn();let u=t?this.m_transforms.length-1:0;const m=t?-1:1;for(let e=0,n=this.m_transforms.length;e<n;e++,u+=m){if(0===e){const e=this.m_transforms[u];qn(o.getPECoordSys(),null,e.getWrapper(),t!==e.isInverted(),i,null,s,h),-1===l&&(c.equals(h)||(l=0)),c.assign(h)}else{const e=this.m_transforms[u-m],n=this.m_transforms[u];Hn(c,e.getWrapper(),t!==e.isInverted(),n.getWrapper(),t!==n.isInverted(),i,null,s,h),-1===l&&(c.equals(h)||(l=0)),c.assign(h)}const n=this.m_transforms[u];Un(c,n.getWrapper(),t!==n.isInverted(),i,null,s,h),c.assign(h)}const d=this.m_transforms[u-m];!function(e,t,i,n,s,r,o,a){const l=Vn();l.assign(i?t.m_inputUnitParams:t.m_outputUnitParams),l.processUnitParams(e);let c=null;n&&(c=n.getPECoordSys());const h=Vn();h.initFromGcsAndVcsPe(c,null),h.processUnitParams(l),l.processUnitParams(h),a>0&&kn(l,h,r,null,a)}(c,d.getWrapper(),t!==d.isInverted(),a,0,i,0,s),-1===l&&(h.initFromGcsAndVcs(a,null),c.equals(h)||(l=0)),this.m_fastTrack=0===l?0:1}};class Eo{constructor(){this.m_transforms=[],this.m_inputGCS=null,this.m_outputGCS=null,this.m_name="",this.m_bNameIsSet=!1}getInputSpatialReference(){return null!==this.m_inputGCS?this.m_inputGCS:this.count()>0?this.m_transforms[0].getInputSpatialReference():null}setInputSpatialReference(e){this.m_inputGCS=e?e.getGCS():null}getOutputSpatialReference(){return null!==this.m_outputGCS?this.m_outputGCS:this.count()>0?this.m_transforms.at(-1).getOutputSpatialReference():null}setOutputSpatialReference(e){this.m_outputGCS=e?e.getGCS():null}getName(){if(this.m_bNameIsSet)return this.m_name;if(0===this.m_transforms.length)return"";let e="";for(const t of this.m_transforms)e.length>0&&(e+=" + "),t.isInverted()&&(e+="~"),e+=t.getName();return e}count(){return this.m_transforms.length}getStep(e){return(e<0||e>this.count())&&i.throwOutOfRangeException(""),this.m_transforms[e]}setStep(e,t){i.geometryReleaseAssert(0)}add(e){this.m_transforms.push(e)}addSteps(e,t){if(t)for(let t=e.count()-1;t>=0;--t)this.add(e.getStep(t).getInverse());else for(let t=0;t<e.count();++t)this.add(e.getStep(t))}clear(){this.m_transforms=[],this.m_name="",this.m_bNameIsSet=!1,this.m_inputGCS=null,this.m_outputGCS=null}remove(e){i.geometryReleaseAssert(0)}create(){const e=this.getInputSpatialReference(),t=this.getOutputSpatialReference(),i=new bo(this.m_transforms,this.m_bNameIsSet?this.m_name:null,e,t);return i.m_bReadOnly=!0,this.clear(),i}}const So=Object.freeze(Object.defineProperty({__proto__:null,SpatialReference:Br,SpatialReferencePrecisionDescriptor:Xr,create:Dr,createFromWKT:Ir,createImplFromPe:Ar,createLocal:Nr,createWithNewPrecision:Mr,createWithNewVCS:function(e,t,i){return{}},getGCS:Or,getTempName:qr,hasNoPe:wr,hasPe:Cr,injectNoPe:Sr,injectPe:function(t){if(e.peFactory)return;!function(t){const n=t;e.peFactory=n.PeFactory,i.geometryReleaseAssert(e.peFactory),ho=n.PeGCSExtent,i.geometryReleaseAssert(ho),e.peLineType=n.PeLineType,i.geometryReleaseAssert(e.peLineType),e.peMath=n.PeMath,i.geometryReleaseAssert(e.peMath),e.PeDoubleClass=n.PeDouble,i.geometryReleaseAssert(e.PeDoubleClass),e.peDefs=n.PeDefs,i.geometryReleaseAssert(e.peDefs),e.peCSTransformations=n.PeCSTransformations,i.geometryReleaseAssert(e.peCSTransformations),oo=n.PeGTTransformations,i.geometryReleaseAssert(oo),ao=n.PePCSInfo,i.geometryReleaseAssert(ao),lo=n.PeGTlistExtended,i.geometryReleaseAssert(lo),e.peFactory.initialize(),co=n.PeGTlistExtendedEntry,i.geometryReleaseAssert(co),e.peDefs.PE_TYPE_ANGUNIT=512,e.peDefs.PE_STR_AUTH_ALL=2,ao.PE_POLE_LINE_STRAIGHT=2,ao.PE_POLE_LINE_CURVED=3,e.peDefs.PE_PARM_LAM0=2,e.peDefs.PE_PARM_PHI0=6,e.peDefs.PE_PRJ_AZIMUTHAL_EQUIDISTANT=43032,e.peDefs.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA=43033,e.peDefs.PE_PRJ_ALBERS=43007,e.peDefs.PE_PRJ_CYLINDRICAL_EQAREA=43034,e.peDefs.PE_TYPE_VERTCS=8,e.peDefs.PE_LINETYPE_GEODESIC=0,e.peDefs.PE_LINETYPE_LOXODROME=1,e.peDefs.PE_LINETYPE_GREAT_ELLIPTIC=2,e.peDefs.PE_LINETYPE_NORMAL_SECTION=3,lo.PE_GTLIST_OPTS_USABLE=1,uo=null}(t);const n=yr;yr=null,n.forEach((e=>{const t=e.deref();t&&t.attachToPe()}))},isInitialized:Tr,isTempName:Hr,isValidWkid:Gr,isValidWkt:kr,makeSpheroidData:Er,snapGeometry:Rr,webMercator:jr,webMercator102100:Wr,wgs84:Zr},Symbol.toStringTag,{value:"Module"})),Co=Object.freeze(Object.defineProperty({__proto__:null,OperatorProject:tn},Symbol.toStringTag,{value:"Module"})),wo=Object.freeze(Object.defineProperty({__proto__:null,CompositeGeographicTransformation:bo,CompositeGeographicTransformationEditor:Eo,createImpl:Po,queryGtListImpl:vo},Symbol.toStringTag,{value:"Module"})),To=Object.freeze(Object.defineProperty({__proto__:null,GeographicTransformation:xo,create:function(t,n){const s=e.peFactory.geogtran(t);return s||i.throwInvalidWkidException(t),new xo(s,n)},createFromPe:_o,createFromWKT:function(t,n){const s=e.peFactory.fromString(e.peDefs.PE_TYPE_GEOGTRAN,t);return s||i.throwInvalidWktException(t),new xo(s,n)}},Symbol.toStringTag,{value:"Module"})),Do=Object.freeze(Object.defineProperty({__proto__:null,ProjectionTransformation:tr,create:function(e,i,n){return Xs(e,i,t.Envelope2D.constructEmpty(),n)},createEx:js,createFromAoi:Xs,createImplEx:Ws,makeExtendedParams:Qs,makeExtendedParamsInternal:Ks,queryTransformationList:Zs},Symbol.toStringTag,{value:"Module"}));e.CompositeGeographicTransformation=wo,e.CurveStitcher=li,e.GeographicTransformation=To,e.Gnomonic=Tn,e.IndexMultiList=j,e.ListeningGeometryCursor=zs,e.MapGeometry=m,e.OperatorContains=Xn,e.OperatorDifference=jn,e.OperatorDisjoint=Kn,e.OperatorIntersection=Xi,e.OperatorProject=tn,e.OperatorProject$1=Co,e.OperatorSimpleRelation=zn,e.OperatorSimplify=Ui,e.OperatorUnion=Zn,e.PEGeogToGeogStable=ks,e.PEGeogToProj=vs,e.PEGeogToProjSimple=function(t,i){const n=i.getPointCount();if(!n)return;const s=i.getImpl(),r=s.getAttributeStreamRef(0),o=t;e.peCSTransformations.geogToProj(o,n,r.getArray()),s.notifyModifiedFlags(2001)},e.PEProjToGeogCenterPoint2D=Ds,e.PE_EQ=so,e.ProjectionTransformation=Do,e.SpatialReference=So,e.SpatialReferencePrecisionDescriptor=Xr,e.TopoGraph=X,e.TopologicalOperations=Ti,e.UnorderedBitIterator=O,e.accelerateGeometry=Yn,e.applySplitLines=Jn,e.areaBetweenParallelsAndMeridiansOfUnitSpheroid=function(e,t,i,n,s){n=r.snap(n,-r.geometryHalfPi,r.geometryHalfPi),s=r.snap(s,-r.geometryHalfPi,r.geometryHalfPi);const o=r.geometryHalfPi-.03;let a;a=n>o&&s>o||n<-o&&s<-o?function(e,t,i){let n=1;if(t<0&&(n=-1,t=-t,i=-i),0!==e){const s=e*e,o=s*e,a=[1,(1+11*e)/12,(1+118*e+241*s)/360,(1+1089*e+10419*s+8651*o)/20160,(1+9836*e+318246*s+1027436*o+o*e*458881)/1814400],l=t=>{let i=0;const n=r.sqr(t)/(e-1);for(let e=a.length-1;e>=0;--e)i=a[e]+i*n;return i*=-r.sqr(t/(1-e)),i},c=l(r.geometryHalfPi-t);return(l(r.geometryHalfPi-i)-c)*n}{const e=r.geometryHalfPi-t,s=r.geometryHalfPi-i,o=-4*r.sqr(Math.sin(e/2));return(-4*r.sqr(Math.sin(s/2))-o)*n}}(e,n,s):M(e,s)-M(e,n);const l=function(e){return 1-e}(e);return.5*(i-t)*a*l},e.autoComplete=function(e,t,i,n){return new Ti(n).autoCompleteImpl(e,t,i)},e.brentMinimization=x,e.buildSegmentParentage=ii,e.buildSegmentParentageForIsSimple=ni,e.calculateLargeRadius=function(e,t){return e/Math.sqrt(1-t)},e.calculateSmallRadius=N,e.calculateTightRadiusInMeters=function(t,i,n,s){const r={stack:[],error:void 0,hasError:!1};try{const a=[n.x],l=[n.y-s],c=[n.x],h=[n.y+s];A(a,l),A(c,h);const u=o.__addDisposableResource(r,new e.PeDoubleClass,!1),m=o.__addDisposableResource(r,new e.PeDoubleClass,!1);return e.peLineType.greatEllipticDistance(t,i,n.x,n.y,a[0],l[0],u,null,null),e.peLineType.greatEllipticDistance(t,i,n.x,n.y,c[0],h[0],m,null,null),Math.min(u.val,m.val)}catch(e){r.error=e,r.hasError=!0}finally{o.__disposeResources(r)}},e.canAccelerateGeometry=Bn,e.cartToCurv=S,e.checkEndForPoleTouch=ln,e.checkForWithinPole=on,e.checkStartForPoleTouch=an,e.clipGeometryFromTopAndBottom=ds,e.closestCoordinate=D,e.create$2=Dr,e.create$5=function(e){return new gr},e.createEx=js,e.createFromWKT$2=Ir,e.createImplEx=Ws,e.createLocal=Nr,e.createWithNewPrecision=Mr,e.curvToCart=P,e.densificationDeviationFromTolerance=ri,e.densify=sn,e.execute=hi,e.execute$1=Ae,e.executeMp2sp=function(e,t,i){const n=new Ie(i);return n.m_shape=e,n.m_geometry=t,n.m_sortedVertices=null,n.m_bFixSelfTangency=!1,n.fixRingOrientationForMp2sp_()},e.extraToleranceForCrackingAndClustering=ai,e.foldGeometry=gs,e.foldInto360NoUnion=wn,e.geodeticDensifySegment=function(e,t,i,n,s,o,a,l,c,h,u,m){const d=new r.Point2D,p=new r.Point2D,g=n.compare(s)>0;yn(g,n,s,d,p);const _=mn(e,t,i,d,p,o,a,l,c,h,null,u,m);return g&&fn(c,h,null,u),_},e.getTempName=qr,e.hasPe=Cr,e.injectNoPe$1=Sr,e.insertGeodeticPointsEditShape=ms,e.isPoint2DInPolygon2D=Qt,e.isSimpleOGC=function e(r,o,a,l,c){if(l&&(l.m_reason=0,l.m_vertexIndex1=-1,l.m_vertexIndex2=-1),r.isEmpty())return 5;const h=r.getGeometryType();if(h===i.GeometryType.enumPoint)return Oi(r,l);const u=s.calculateToleranceFromGeometryForOpFromGeom(o,r,!1).total();if(h===i.GeometryType.enumEnvelope){const e=r,i=new t.Envelope2D;return e.queryEnvelope(i),i.isDegenerate(u)?(l&&(l.m_reason=4,l.m_vertexIndex1=-1,l.m_vertexIndex2=-1),0):5}if(i.isSegment(h)){const t=r,i=new n.Polyline({vd:t.getDescription()});return i.addSegment(t,!0),e(i,o,a,l,c)}i.throwIfGeometryCollectionType(h),i.isMultiVertex(h)||i.throwNotImplementedException("OGC simplify is not implemented for this geometry type");const m=r.getImpl().getIsSimple(u,[0]);let d=a?-1:m;if(5===d||0===d)return d;const p=new Hi(r,o,d,c,!0);return h===i.GeometryType.enumMultiPoint||h===i.GeometryType.enumPolyline||h===i.GeometryType.enumPolygon?(d=p.isSimplePlanarImpl(),s.isAtLeastPlanarSimple(d)&&(d=5)):i.throwInternalErrorException(""),r.getImpl().setIsSimple(d,u),l&&l.assign(p.m_nonSimpleResult),d},e.isValidWkid$1=Gr,e.isValidWkid$2=function(e){return!1},e.isValidWkt$1=kr,e.linesToPolygons=function(e,t,i){return new Ti(i).linesToPolygonsImpl(e,t)},e.makeExtendedParams=Qs,e.makeExtendedParamsInternal=Ks,e.makeSpheroidData=Er,e.needsCrackingAndClustering=function(e,t,i){const r=s.adjustToleranceForTEClustering(t),o=s.adjustToleranceForTECracking(t);return!!function(e,t,i,n,s){const r=new ne(s);return r.m_shape=e,r.m_sqrTolerance=t*t,r.m_cellSize=2*t,r.m_invCellSize=1/r.m_cellSize,r.m_geometry=i,r.m_bTrackChanges=!1,r.needsClustering()}(e,r,n.nullHandle,0,i)||ve(!0,e,o,null,i)},e.normalizeMultiPathGcs=rn,e.normalizeX=ls,e.planarSimplify=bi,e.processCurves=function(e,t,r,o){if(!i.isMultiPath(e.getGeometryType()))return e;const a=e.getImpl();if(!a.hasNonLinearSegments())return e;const l=e.createInstance();l.getGeometryType()===i.GeometryType.enumPolygon&&l.setFillRule(e.getFillRule()),new n.EditShape;const c=new s.Point,h=new n.SegmentBuffer,u=[],m=[],d=[],p=e.getDescription().getAttributeCount()>1,g=a.querySegmentIterator();for(;g.nextPath();){let e=!0;for(;g.hasNextSegment();){const s=g.isClosingSegment(),o=g.nextSegment();if(!o.isCurve()){l.addSegment(o,e,s),e=!1;continue}let a,_=!1;const f=!0,y=!0;switch(o.getGeometryType()){case i.GeometryType.enumEllipticArc:case i.GeometryType.enumRationalBezier2:a=n.approximationWithQuadraticRationalBeziers(o,t,r,f,y,m,d,u),_=!0;break;default:a=n.approximationWithBeziers(o,t,r,!0,f,m,u)}const x=_?2:3;m[1].isNAN()?(h.createLine(),h.get().construct(m[0],m[x])):_?(h.createQuadraticRationalBezier(),h.get().constructArrayWeights(m,d)):(h.createCubicBezier(),h.get().constructPoints(m)),p&&e&&(o.queryCoord(u[0],c),h.get().setStart(c)),p&&(o.queryCoord(u[1],c),h.get().setEnd(c)),l.addSegment(h.get(),e,s&&1===a),e=!1;for(let e=1,t=a,i=x;e<t;++e,i+=x)m[i+1].isNAN()?(h.createLine(),h.get().construct(m[i],m[i+x])):_?(h.createQuadraticRationalBezier(),h.get().constructArrayWeights(m.slice(i),d.slice(i))):(h.createCubicBezier(),h.get().constructPoints(m.slice(i))),p&&(o.queryCoord(u[e+1],c),h.get().setEnd(c)),l.addSegment(h.get(),!1,s&&e+1===t)}}return l},e.processWithPCSHorizon=xs,e.projectMultiPathVerticesPCSToGCS=function(e,i,s,r){const o=new n.MultiPoint({vd:i.getDescription()});let a;o.addPoints(i,0,-1),a=(new tn).execute(o,e,r);const l=i.getPointCount();if(s.setEmpty(),e.getInputSR().isPannable()){if(l!==a.getPointCount())return!1;const n=new t.Envelope2D;i.queryEnvelope(n);const r=new t.Envelope2D;a.queryEnvelope(r);const o=n.width(),c=r.width();if(0!==o&&0!==c){const t=c/o,i=e.getOutputSR().getPannableExtent().width()/e.getInputSR().getPannableExtent().width();if(Math.abs(t/i-1)>1e-10)return!1}else if(0!==o||0!==c)return!1;s.add(i,!1);for(let e=0;e<l;e++){const t=a.getXY(e);s.setXY(e,t)}return!0}return!1},e.projectPointsToGCS=function(e,t,i,n){const s=e.getSRToGCSTransform();return(new tn).transform(s,t,i,n,!1)},e.querySinglePartCount=function(e){if(e.isEmpty())return 0;switch(e.getGeometryType()){case i.GeometryType.enumMultiPoint:return e.getImpl().getPointCount();case i.GeometryType.enumPolyline:return e.getImpl().getPathCount();case i.GeometryType.enumPolygon:return e.getImpl().getOGCPolygonCount();case i.GeometryType.enumGeometryCollection:return e.getGeometryCount()}return 1},e.relate=Ze,e.relate$1=Ne,e.s_IntToPublicCutSide=function(e){switch(e){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 0:return 0;default:i.geometryReleaseAssert(0,"unrecognized cut side")}return 3},e.simplifyOGC=function e(r,o,a,l){if(r.isEmpty())return r;const c=r.getGeometryType();if(c===i.GeometryType.enumPoint){const e=new u.NonSimpleResult;if(Oi(r,e),3===e.m_reason){const e=r.clone();return e.replaceNaNs(1,0),e}return 2===e.m_reason?r.createInstance():r}if(c===i.GeometryType.enumEnvelope){const e=r,i=new t.Envelope2D;e.queryEnvelope(i);const n=s.calculateToleranceFromGeometryForOpFromGeom(o,r,!0).total();return i.isDegenerate(n)?e.createInstance():r}if(i.isSegment(c)){const t=r,i=new n.Polyline({vd:t.getDescription()});return i.addSegment(t,!0),e(i,o,a,l)}i.throwIfGeometryCollectionType(c),i.isMultiVertex(c)||i.throwNotImplementedException("OGC simplify is not implemented for this geometry type");const h=s.calculateToleranceFromGeometryForOpFromGeom(o,r,!1).total(),m=r.getImpl().getIsSimple(h,[0]),d=a?-1:m;if(5===d){if(c===i.GeometryType.enumPolygon&&0!==r.getFillRule()){const e=r.clone();return e.setFillRule(0),e}return r}return Pi(r,s.calculateToleranceFromGeometryForOpFromGeom(o,r,!0),!1,d,l,0,!0)},e.snapGeometry=Rr,e.sphericalDistance=T,e.sphericalDistancePointToSegment=function(e,t,i,n,r){const o=i.getUnitVector(),a=n.getUnitVector(),l=t.getUnitVector(),c=new s.Point3D;if(c.setCrossProductVector(o,a),!c.isZero()){c.normalizeThis();const t=l.sub(c.mul(c.dotProduct(l)));if(!t.isZero()){t.normalizeThis();const i=o.add(a).mul(.5);if(i.dotProduct(t)>i.dotProduct(o)){const i=Math.abs(c.dotProduct(l)),n=Math.asin(i);return r.assign(t.getUnitVector().mul(e)),n*e}}}const h=T(1,o,l),u=T(1,a,l);return h<=u?(r.assign(i),h*e):(r.assign(n),u*e)},e.stitchingDensificationDeviationFromTolerance=oi,e.symmetricDifference=function(e,r,o,a){if(e.getDimension()>r.getDimension())return Di(Ii(e),e,0,"^");if(e.getDimension()<r.getDimension())return Di(Ii(r),e,0,"^");if(e.isEmpty())return Di(Ii(r),e,0,"^");if(r.isEmpty())return Di(Ii(e),e,0,"^");const l=new t.Envelope2D;e.queryEnvelope(l);const c=new t.Envelope2D;r.queryEnvelope(c);const h=new t.Envelope2D;h.setCoords({env2D:l}),h.mergeEnvelope2D(c);const u=s.calculateToleranceFromGeometryForOp(o,h,!0),m=new Ti(a),d=new n.EditShape,p=d.addGeometry(Ii(e)),g=d.addGeometry(Ii(r));let _=0,f=null;if(d.hasCurves()){f=new li;const e=d.getEnvelope2D(a);_=oi(u.total()),ii(d,ri(u.total(),e),u.total(),0,f,null,a)}m.setEditShapeCrackAndCluster(d,u);const y=m.symmetricDifference(p,g);null!==f&&f.stitchCurves(d,y,_,!0);const x=Di(d.getGeometry(y),e,0,"^");return yi(x.getGeometryType())&&(x.getImpl().setIsSimple(4,u.total()),x.getGeometryType()===i.GeometryType.enumPolygon&&x.getImpl().updateOGCFlagsProtected()),x},e.testPointsInArea2D=$t,e.transformInPlace=Wi,e.validateSclString=Re}))},"esri/chunks/OperatorClip":function(){define(["exports","./SimpleGeometryCursor","./Geometry","./Envelope","./Envelope2D","./MultiPathImpl","./Point2D"],(function(e,t,i,n,s,r,o){"use strict";function a(e,t,i,n,s){return l(e,t,null,i,n,s)}function l(e,t,r,o,l,h){const u=e.getGeometryType();if(u===i.GeometryType.enumPoint){const i=e.getXY();return t.contains(i)?e:e.createInstance()}if(u===i.GeometryType.enumEnvelope){const i=s.Envelope2D.constructEmpty();if(e.queryEnvelope(i),i.intersect(t)){const t=e.clone();return t.setEnvelope(i),t}return e.createInstance()}if(e.isEmpty())return e;if(t.isEmpty())return e.createInstance();const m=t.clone();{const t=new s.Envelope2D;if(e.queryLooseEnvelope(t),m.containsEnvelope(t))return e;if(!m.isIntersecting(t))return e.createInstance();0===l&&(t.intersect(m),t.inflate(Math.max(.1*t.maxDimension(),1)),t.intersect(m),m.assign(t))}let d=o;if((null!==r||Number.isNaN(d))&&(d=n.calculateToleranceFromGeometryForOp(r,m,!1).total()),u===i.GeometryType.enumGeometryCollection){const t=e,i=e.createInstance();for(let e=0,n=t.getGeometryCount();e<n;e++){const n=t.getGeometry(e);if(n.isEmpty())continue;const s=a(n,m,d,l,h);s.isEmpty()||(s===n?i.addGeometry(s.clone()):i.addGeometry(s))}return i}i.isMultiVertex(u)||i.throwInvalidArgumentException("Clip: geometry not supported");const p=e.getImpl().getAccelerators();if(null!==p){const e=p.getRasterizedGeometry();i.geometryReleaseAssert(null===e)}switch(u){case i.GeometryType.enumMultiPoint:{const t=e;let n;const s=t.getPointCount(),r=t.getImpl().getAttributeStreamRef(0);let o=0;for(let e=0;e<s;e++){const i=r.readPoint2D(2*e);m.contains(i)||(0===o&&(n=t.createInstance()),o<e&&n.addPoints(t,o,e),o=e+1)}return o>0&&n.addPoints(t,o,s),0===o?t:(i.geometryReleaseAssert(null!==n),n)}case i.GeometryType.enumPolygon:case i.GeometryType.enumPolyline:return function(e,t,i,n,s){return new c(t,s).clipMultiPath2(e,i,n)}(e,m,d,l,h);default:i.throwInternalErrorException("")}}class c{constructor(e,t){this.m_shape=new r.EditShape,this.m_geometry=r.nullHandle,this.m_verticesOnExtentIndex=-1,this.m_verticesOnExtent=[],this.m_progressCounter=0,this.m_extent=new s.Envelope2D(e),this.m_progressTracker=t}progress_(){}clipMultiPath2(e,t,n){return e.getGeometryType()===i.GeometryType.enumPolygon?this.clipPolygonOrProjectedPolyline2(e,n):this.clipPolyline(e,t)}clipPolygonOrProjectedPolyline2(e,t){const n=e.getGeometryType()===i.GeometryType.enumPolyline;if(0===this.m_extent.width()||0===this.m_extent.height())return e.createInstance();const a=s.Envelope2D.constructEmpty();e.queryLooseEnvelope(a),this.m_geometry=n?this.m_shape.addGeometry(e):this.m_shape.addGeometry(e,this.m_extent);const l=s.Envelope2D.constructEmpty(),h=s.Envelope2D.constructEmpty(),u=new o.Point2D,m=new o.Point2D,d=o.makePrimitiveArray(9,Number.NaN),p=o.makePrimitiveArray(9,Number.NaN),g=o.makeObjectArray(o.Point2D,9);let _=null;const f=new r.Line,y=[];let x=!1;for(let e=0;!x&&e<4;e++){let t=!1;const s=!!(1&e);let o=0;switch(e){case 0:o=this.m_extent.xmin,t=a.xmin<=o&&a.xmax>=o;break;case 1:o=this.m_extent.ymin,t=a.ymin<=o&&a.ymax>=o;break;case 2:o=this.m_extent.xmax,t=a.xmin<=o&&a.xmax>=o;break;case 3:o=this.m_extent.ymax,t=a.ymin<=o&&a.ymax>=o}if(t){x=!0;for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==r.nullHandle;){let a=!0,v=-1,P=-1;const b=this.m_shape.getFirstVertex(t);let E=b;do{this.progress_(),_=this.m_shape.getSegment(E);let t=_;if(null===t){const e=this.m_shape.getNextVertex(E);if(e===r.nullHandle){i.geometryReleaseAssert(n),0===v&&y.push(E);break}this.m_shape.queryXY(E,u),f.setStartXY(u),this.m_shape.queryXY(e,m),f.setEndXY(m),t=f}t.queryLooseEnvelope(l);let b=c.checkSegmentIntersection(l,e,o);t.isCurve()&&0===b&&t.isCurve()&&(f.setStartXY(t.getStartXY()),f.setEndXY(t.getEndXY()),this.m_shape.replaceCurveWithLine(E),t=f,f.queryEnvelope(l),b=c.checkSegmentIntersection(l,e,o));let S=0,C=r.nullHandle;if(-1===b){const n=t.intersectionWithAxis2D(s,o,d,p);if(n>0){let e=null;if(t.isCurve()){e=g,i.geometryReleaseAssert(n<=9);for(let e=0;e<n;e++)s?g[e].setCoords(d[e],o):g[e].setCoords(o,d[e]);S=this.m_shape.splitSegmentAxisAware(E,p,n,e,s?1:0)}else S=this.m_shape.splitSegmentAxisAware(E,p,n,null,-1)}else S=0;S+=1;let r=E,l=this.m_shape.getNextVertex(r);t=null;for(let t=0;t<S;t++){this.m_shape.queryXY(r,u),this.m_shape.queryXY(l,m),_=this.m_shape.getSegment(r);let t=_;null===t&&(f.setStartXY(u),f.setEndXY(m),t=f),t.queryEnvelope(h);let i=c.checkSegmentIntersection(h,e,o);t.isCurve()&&0===i&&(this.m_shape.replaceCurveWithLine(r),f.setStartXY(u),f.setEndXY(m),t=f,t.queryEnvelope(h),i=c.checkSegmentIntersection(h,e,o)),-1===i&&(s?Math.abs(u.y-o)<Math.abs(m.y-o)?(u.y=o,this.m_shape.setXY(r,u)):(m.y=o,this.m_shape.setXY(l,m)):Math.abs(u.x-o)<Math.abs(m.x-o)?(u.x=o,this.m_shape.setXY(r,u)):(m.x=o,this.m_shape.setXY(l,m)),_=this.m_shape.getSegment(r),t=_,null===t&&(f.setStartXY(u),f.setEndXY(m),t=f),t.queryEnvelope(h),i=c.checkSegmentIntersection(h,e,o),-1===i&&(i=c.checkSegmentIntersectionLoose(h,e,o)));const n=v;v=i,-1===P&&(P=v),0===n&&1===v||1===n&&0===v||0===n&&0===v&&y.push(r),1===v&&(x=!1,a=!1),r=l,C=r,l=this.m_shape.getNextVertex(l)}}if(0===S){const e=v;v=b,-1===P&&(P=v),0===e&&v>=1||e>=1&&0===v||0===e&&0===v&&y.push(E),1===v&&(x=!1,a=!1),C=this.m_shape.getNextVertex(E)}if(E=C,y.length>=256){for(let e=1,t=y.length-1;e<t;e++){const t=y[e];n?this.m_shape.snapVertexForPoleClipping(t,o):this.m_shape.removeVertex(t,!1)}y[1]=y.at(-1),y.length=2}}while(E!==b);if(!a){0!==P||!n&&0!==v&&2!==v||y.push(b);for(let e=0,t=y.length;e<t;e++){const t=y[e];n?this.m_shape.snapVertexForPoleClipping(t,o):this.m_shape.removeVertex(t,!1)}}y.length=0,t=a||0===this.m_shape.getPathSize(t)?this.m_shape.removePath(t):this.m_shape.getNextPath(t)}}}if(x)return e.createInstance();_=null,n?this.removeSpikesAlongPoles():this.resolveBoundaryOverlaps(),t>0&&this.densifyAlongClipExtent(t);const v=this.m_shape.getGeometry(this.m_geometry);return v.getGeometryType()===i.GeometryType.enumPolygon&&v.setFillRule(e.getFillRule()),v}clipPolyline(e,t){const i=s.Envelope2D.constructEmpty(),n=s.Envelope2D.constructEmpty(),a=o.makePrimitiveArray(9,Number.NaN),l=o.makePrimitiveArray(9,Number.NaN),h=new r.SegmentBuffer;let u=e;const m=s.Envelope2D.constructEmpty();e.queryLooseEnvelope(m);for(let t=0;t<4;t++){let s=!1;const r=!!(1&t);let d=0;switch(t){case 0:d=this.m_extent.xmin,s=m.xmin<=d&&m.xmax>=d;break;case 1:d=this.m_extent.ymin,s=m.ymin<=d&&m.ymax>=d;break;case 2:d=this.m_extent.xmax,s=m.xmin<=d&&m.xmax>=d;break;case 3:d=this.m_extent.ymax,s=m.ymin<=d&&m.ymax>=d}if(!s)continue;const p=u;u=e.createInstance();const g=p.getImpl().querySegmentIterator();g.resetToFirstPath();const _=new o.Point2D,f=new o.Point2D;for(;g.nextPath();){let e=-1,s=!0;for(;g.hasNextSegment();){this.progress_();const o=g.nextSegment(),m=o.isDegenerate(0);o.queryLooseEnvelope(i);const p=c.checkSegmentIntersection(i,t,d);if(-1===p){const i=o.intersectionWithAxis2D(r,d,a,l);let p=0;_.assign(o.getStartXY());for(let g=0;g<=i;g++){const y=g<i?l[g]:1;if(p===y)continue;o.queryCut(p,y,h,!1);const x=h.get();let v=!1;if(x.getStartXY().equals(_)||(x.setStartXY(_),v=!0),g<i&&(r?(f.x=a[g],f.y=d):(f.x=d,f.y=a[g]),x.getEndXY().equals(f)||(x.setEndXY(f),v=!0)),v&&x.normalizeAfterEndpointChange(),!m&&x.isDegenerate(0))continue;x.queryEnvelope(n);let P=c.checkSegmentIntersection(n,t,d);if(-1===P){const e=x.getStartXY(),i=x.getEndXY();v=!1,r?Math.abs(e.y-d)<Math.abs(i.y-d)?(e.y=d,x.setStartXY(e),e.equals(x.getStartXY())||(x.setStartXY(e),v=!0)):(i.y=d,i.equals(x.getEndXY())||(x.setEndXY(i),v=!0)):Math.abs(e.x-d)<Math.abs(i.x-d)?(e.x=d,e.equals(x.getStartXY())||(x.setStartXY(e),v=!0)):(i.x=d,i.equals(x.getEndXY())||(x.setEndXY(i),v=!0)),v&&x.normalizeAfterEndpointChange(),x.queryEnvelope(n),P=c.checkSegmentIntersection(n,t,d),-1===P&&(P=c.checkSegmentIntersectionLoose(n,t,d))}_.assign(x.getEndXY()),p=y,e=P,e>=1?(u.addSegment(x,s),s=!1):s=!0}}else e=p,e>=1?(u.addSegment(o,s),s=!1):s=!0}}}return u}static checkSegmentIntersection(e,t,n){switch(t){case 0:return e.xmin<n&&e.xmax<=n?0:e.xmin>=n?e.xmax===n?2:1:-1;case 1:return e.ymin<n&&e.ymax<=n?0:e.ymin>=n?e.ymax===n?2:1:-1;case 2:return e.xmin>=n&&e.xmax>n?0:e.xmax<=n?e.xmin===n?2:1:-1;case 3:return e.ymin>=n&&e.ymax>n?0:e.ymax<=n?e.ymin===n?2:1:-1}return i.throwInternalErrorException(""),0}static checkSegmentIntersectionLoose(e,t,n){switch(t){case 0:{const t=Math.abs(e.xmin-n),s=Math.abs(e.xmax-n);return e.xmin<n?t>s?0:1:(i.throwInternalErrorException(""),1)}case 1:{const t=Math.abs(e.ymin-n),s=Math.abs(e.ymax-n);return e.ymin<n?t>s?0:1:(i.throwInternalErrorException(""),1)}case 2:{const t=Math.abs(e.xmin-n),s=Math.abs(e.xmax-n);return e.xmax>n?t<s?0:1:(i.throwInternalErrorException(""),1)}case 3:{const t=Math.abs(e.ymin-n),s=Math.abs(e.ymax-n);return e.ymax>n?t<s?0:1:(i.throwInternalErrorException(""),1)}}return i.throwInternalErrorException(""),0}resolveBoundaryOverlaps(){this.m_verticesOnExtentIndex=-1,this.splitSegments(!1,this.m_extent.xmin),this.splitSegments(!1,this.m_extent.xmax),this.splitSegments(!0,this.m_extent.ymin),this.splitSegments(!0,this.m_extent.ymax),this.m_verticesOnExtent.length=0,this.m_verticesOnExtentIndex=this.m_shape.createUserIndex();const e=new o.Point2D;for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==r.nullHandle;t=this.m_shape.getNextPath(t)){let i=this.m_shape.getFirstVertex(t);for(let n=0,s=this.m_shape.getPathSize(t);n<s;n++,i=this.m_shape.getNextVertex(i))this.progress_(),this.m_shape.queryXY(i,e),this.m_extent.xmin!==e.x&&this.m_extent.xmax!==e.x&&this.m_extent.ymin!==e.y&&this.m_extent.ymax!==e.y||(this.m_shape.setUserIndex(i,this.m_verticesOnExtentIndex,this.m_verticesOnExtent.length),this.m_verticesOnExtent.push(i))}this.dbgCheckPathFirst(),this.resolveOverlaps(!1,this.m_extent.xmin),this.dbgCheckPathFirst(),this.resolveOverlaps(!1,this.m_extent.xmax),this.dbgCheckPathFirst(),this.resolveOverlaps(!0,this.m_extent.ymin),this.dbgCheckPathFirst(),this.resolveOverlaps(!0,this.m_extent.ymax),this.fixPaths()}densifyAlongClipExtent(e){const t=new o.Point2D(0,0),n=new o.Point2D(0,0),s=o.makePrimitiveArray(2048,Number.NaN);for(let a=this.m_shape.getFirstPath(this.m_geometry);a!==r.nullHandle;a=this.m_shape.getNextPath(a)){const r=this.m_shape.getFirstVertex(a);let l=r;do{const r=this.m_shape.getNextVertex(l);this.m_shape.queryXY(l,t);let a=-1;if(t.x===this.m_extent.xmin?(this.m_shape.queryXY(r,n),n.x===this.m_extent.xmin&&(a=1)):t.x===this.m_extent.xmax&&(this.m_shape.queryXY(r,n),n.x===this.m_extent.xmax&&(a=1)),t.y===this.m_extent.ymin?(this.m_shape.queryXY(r,n),n.y===this.m_extent.ymin&&(a=0)):t.y===this.m_extent.ymax&&(this.m_shape.queryXY(r,n),n.y===this.m_extent.ymax&&(a=0)),-1===a){l=r;continue}if(this.isCurve(l)){l=r;continue}const c=t.clone(),h=new o.Point2D(0,0);if(a){const i=t.y-this.m_extent.ymin;h.y=o.sign(n.y-t.y),c.y=e*o.copySign(Math.floor(Math.abs(i)/e),i)+this.m_extent.ymin,h.y<0&&(c.y+=e)}else{const i=t.x-this.m_extent.xmin;h.x=o.sign(n.x-t.x),c.x=e*o.copySign(Math.floor(Math.abs(i)/e),i)+this.m_extent.xmin,h.x<0&&(c.x+=e)}const u=a?n.y-t.y:n.x-t.x,m=Math.abs(u);if(m/e>65536&&i.throwInternalErrorException(""),m>0){const n=Math.trunc(m/e)+2;s.length<n&&(s.length=n);let r=0;for(let n=0;;n++){const o=c.add(h.mul(n*e)),l=(a?o.y-t.y:o.x-t.x)/u;if(l>=1)break;l<=0||(i.geometryReleaseAssert(r<=s.length),s[r]=l,r++)}0!==r&&this.m_shape.splitSegment(l,s,r)}l=r}while(l!==r)}}splitSegments(e,t){let i=-1;const n=new o.Point2D,s=[];for(let o=this.m_shape.getFirstPath(this.m_geometry);o!==r.nullHandle;o=this.m_shape.getNextPath(o)){let a=this.m_shape.getFirstVertex(o),l=r.nullHandle;for(let r=0,c=this.m_shape.getPathSize(o);r<c;r++,a=l)if(this.progress_(),l=this.m_shape.getNextVertex(a),this.m_shape.queryXY(a,n),(e?n.y===t:n.x===t)&&(this.m_shape.queryXY(l,n),e?n.y===t:n.x===t)){if(this.isCurve(a))continue;-1===i&&(i=this.m_shape.createUserIndex()),1!==this.m_shape.getUserIndex(a,i)&&(s.push(a),this.m_shape.setUserIndex(a,i,1)),1!==this.m_shape.getUserIndex(l,i)&&(s.push(l),this.m_shape.setUserIndex(l,i,1))}}if(-1!==i&&this.m_shape.removeUserIndex(i),s.length<3)return;s.sort(((e,t)=>this.compareVertices(e,t)));const a=new o.Point2D,l=new o.Point2D,c=new o.Point2D;l.setNAN();let h=-1,u=[],m=[];const d=this.m_shape.createUserIndex(),p=this.m_shape.createUserIndex();for(let i=0,r=s.length;i<r;i++){const r=s[i];if(this.m_shape.queryXY(r,n),!n.isEqualPoint2D(l)){if(-1===h){h=i,l.setCoordsPoint2D(n);continue}for(let n=h;n<i;n++){const i=s[n],r=this.m_shape.getNextVertex(i),o=this.m_shape.getPrevVertex(i);let c=!1;this.m_shape.queryXY(r,a),l.compare(a)<0&&(e?a.y===t:a.x===t)&&(this.isCurve(i)||(u.push(i),c=!0,this.m_shape.setUserIndex(i,p,1))),this.m_shape.queryXY(o,a),l.compare(a)<0&&(e?a.y===t:a.x===t)&&(this.isCurve(o)||(c||u.push(i),this.m_shape.setUserIndex(i,d,1)))}for(let e=0,t=u.length;e<t;e++){const t=u[e],i=this.m_shape.getUserIndex(t,d),s=this.m_shape.getUserIndex(t,p);if(1===i){const e=this.m_shape.getPrevVertex(t);this.m_shape.queryXY(e,c);let i=0;if(!c.isEqualPoint2D(n)){const s=o.Point2D.distance(l,c);i=o.Point2D.distance(c,n)/s,0===i?i=Number.EPSILON:1===i&&(i=1-Number.EPSILON),this.m_shape.splitSegment(e,[i],1);const r=this.m_shape.getPrevVertex(t);this.m_shape.setXY(r,n),m.push(r),this.m_shape.setUserIndex(r,d,1),this.m_shape.setUserIndex(r,p,-1)}}if(1===s){const e=this.m_shape.getNextVertex(t);this.m_shape.queryXY(e,c);let i=0;if(!c.isEqualPoint2D(n)){const e=o.Point2D.distance(l,c);i=o.Point2D.distance(l,n)/e,0===i?i=Number.EPSILON:1===i&&(i=1-Number.EPSILON),this.m_shape.splitSegment(t,[i],1);const s=this.m_shape.getNextVertex(t);this.m_shape.setXY(s,n),m.push(s),this.m_shape.setUserIndex(s,d,-1),this.m_shape.setUserIndex(s,p,1)}}}const r=u;u=m,m=r,m.length=0,h=i,l.setCoordsPoint2D(n)}}this.m_shape.removeUserIndex(d),this.m_shape.removeUserIndex(p)}resolveOverlaps(e,t){const n=new o.Point2D,s=[];let a=-1;for(let i=0,o=this.m_verticesOnExtent.length;i<o;i++){this.progress_();const o=this.m_verticesOnExtent[i];if(o===r.nullHandle)continue;const l=this.m_shape.getNextVertex(o);if(this.m_shape.queryXY(o,n),(e?n.y===t:n.x===t)&&(this.m_shape.queryXY(l,n),e?n.y===t:n.x===t)){if(this.isCurve(o))continue;-1===a&&(a=this.m_shape.createUserIndex()),-2!==this.m_shape.getUserIndex(o,a)&&(s.push(o),this.m_shape.setUserIndex(o,a,-2)),-2!==this.m_shape.getUserIndex(l,a)&&(s.push(l),this.m_shape.setUserIndex(l,a,-2))}}if(0===s.length)return void(-1!==a&&this.m_shape.removeUserIndex(a));i.geometryReleaseAssert(-1!==a),s.sort(((e,t)=>this.compareVertices(e,t)));for(let e=0,t=s.length;e<t;e++){const t=s[e];this.m_shape.setUserIndex(t,a,e)}const l=new o.Point2D,c=new o.Point2D;c.setNAN();let h=-1;for(let i=0,o=s.length;i<o;i++){this.progress_();const o=s[i];if(o!==r.nullHandle&&(this.m_shape.queryXY(o,n),!n.isEqualPoint2D(c))){if(-1!==h)for(;;){let n=!1;const o=i;for(let u=h;u<o;u++){const o=s[u];if(o===r.nullHandle)continue;let h=r.nullHandle;const m=this.m_shape.getNextVertex(o);this.m_shape.queryXY(m,l),c.compare(l)<0&&(e?l.y===t:l.x===t)&&(this.isCurve(o)||(h=m));let d=r.nullHandle;const p=this.m_shape.getPrevVertex(o);if(this.m_shape.queryXY(p,l),c.compare(l)<0&&(e?l.y===t:l.x===t)&&(this.isCurve(p)||(d=p)),h===r.nullHandle||d===r.nullHandle){if(h!==r.nullHandle||d!==r.nullHandle){for(let m=u+1;m<i;m++){const i=s[m];if(i===r.nullHandle)continue;const u=this.m_shape.getNextVertex(i);let p=r.nullHandle;this.m_shape.queryXY(u,l),c.compare(l)<0&&(e?l.y===t:l.x===t)&&(this.isCurve(i)||(p=u));const g=this.m_shape.getPrevVertex(i);let _=r.nullHandle;if(this.m_shape.queryXY(g,l),c.compare(l)<0&&(e?l.y===t:l.x===t)&&(this.isCurve(g)||(_=g)),p!==r.nullHandle&&_!==r.nullHandle){this.beforeRemoveVertex(i,s,a),this.m_shape.removeVertex(i,!1),this.beforeRemoveVertex(p,s,a),this.m_shape.removeVertex(p,!1),n=!0;break}if(h!==r.nullHandle&&_!==r.nullHandle){this.removeOverlap(s,o,h,i,_,a),n=!0;break}if(d!==r.nullHandle&&p!==r.nullHandle){this.removeOverlap(s,i,p,o,d,a),n=!0;break}}if(n)break}}else this.beforeRemoveVertex(o,s,a),this.m_shape.removeVertex(o,!1),this.beforeRemoveVertex(h,s,a),this.m_shape.removeVertex(h,!1),n=!0}if(!n)break}h=i,c.setCoordsPoint2D(n)}}this.m_shape.removeUserIndex(a)}beforeRemoveVertex(e,t,n){let s=this.m_shape.getUserIndex(e,n);i.geometryReleaseAssert(s>=0),t[s]=r.nullHandle,s=this.m_shape.getUserIndex(e,this.m_verticesOnExtentIndex),i.geometryReleaseAssert(s>=0),this.m_verticesOnExtent[s]=r.nullHandle;const o=this.m_shape.getPathFromVertex(e);o!==r.nullHandle&&this.m_shape.getFirstVertex(o)===e&&(this.m_shape.setFirstVertex(o,r.nullHandle),this.m_shape.setLastVertex(o,r.nullHandle))}removeOverlap(e,t,i,n,s,r){this.m_shape.setNextVertex(t,n),this.m_shape.setPrevVertex(n,t),this.m_shape.setPrevVertex(i,s),this.m_shape.setNextVertex(s,i),this.beforeRemoveVertex(n,e,r),this.m_shape.removeVertexInternal(n,!1),this.beforeRemoveVertex(s,e,r),this.m_shape.removeVertexInternal(s,!0)}removeSpikesAlongPoles(){this.removeSpikesOnPole(this.m_extent.ymin),this.removeSpikesOnPole(this.m_extent.ymax)}removeSpikesOnPole(e){for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==r.nullHandle;t=this.m_shape.getNextPath(t)){const i=this.m_shape.getPathSize(t);if(i<3)continue;let n=this.m_shape.getFirstVertex(t);const s=new o.Point2D;this.m_shape.queryXY(n,s);let r=s.y===e&&!this.isCurve(n);n=this.m_shape.getNextVertex(n);const a=new o.Point2D;this.m_shape.queryXY(n,a);let l=a.y===e&&!this.isCurve(n);n=this.m_shape.getNextVertex(n);const c=new o.Point2D;for(let t=0,o=i-2;t<o;t++,n=this.m_shape.getNextVertex(n)){this.progress_(),this.m_shape.queryXY(n,c);const t=c.y===e;l&&r&&t&&(a.x-s.x)*(c.x-a.x)<=0?(this.m_shape.removeVertex(this.m_shape.getPrevVertex(n),!1),a.setCoordsPoint2D(c),l=t&&!this.isCurve(n)):(s.setCoordsPoint2D(a),r=l,a.setCoordsPoint2D(c),l=t&&!this.isCurve(n))}}}fixPaths(){for(let e=0,t=this.m_verticesOnExtent.length;e<t;e++){const t=this.m_verticesOnExtent[e];t!==r.nullHandle&&this.m_shape.setPathToVertex(t,r.nullHandle)}const e=this.m_shape.hasCurves();let t=0,n=0;for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==r.nullHandle;){const i=this.m_shape.getFirstVertex(e);if(i===r.nullHandle||e!==this.m_shape.getPathFromVertex(i)){const t=e;e=this.m_shape.getNextPath(e),this.m_shape.setFirstVertex(t,r.nullHandle),this.m_shape.removePathOnly(t);continue}let s=i,o=0;do{this.m_shape.setPathToVertex(s,e),o++,s=this.m_shape.getNextVertex(s)}while(s!==i);this.m_shape.setRingAreaValid(e,!1),this.m_shape.setLastVertex(e,this.m_shape.getPrevVertex(i)),this.m_shape.setPathSize(e,o),n+=o,t++,e=this.m_shape.getNextPath(e)}for(let s=0,o=this.m_verticesOnExtent.length;s<o;s++){let o=this.m_verticesOnExtent[s];if(o===r.nullHandle)continue;let a=this.m_shape.getPathFromVertex(o);if(a!==r.nullHandle)continue;a=this.m_shape.insertPath(this.m_geometry,r.nullHandle);let l=!1,c=0;const h=o;do{this.m_shape.setPathToVertex(o,a),c++,e&&c<=2&&(l||=this.isCurve(o)),o=this.m_shape.getNextVertex(o)}while(o!==h);if(l?0===c:c<=2){let e=this.m_shape.getUserIndex(h,this.m_verticesOnExtentIndex);i.geometryReleaseAssert(e>=0),this.m_verticesOnExtent[e]=r.nullHandle;const t=this.m_shape.removeVertex(h,!1);2===c&&(e=this.m_shape.getUserIndex(t,this.m_verticesOnExtentIndex),e>=0&&(this.m_verticesOnExtent[e]=r.nullHandle),this.m_shape.removeVertex(t,!1));const n=a;a=this.m_shape.getNextPath(a),this.m_shape.setFirstVertex(n,r.nullHandle),this.m_shape.removePathOnly(n)}else this.m_shape.setClosedPath(a,!0),this.m_shape.setPathSize(a,c),this.m_shape.setFirstVertex(a,h),this.m_shape.setLastVertex(a,this.m_shape.getPrevVertex(h)),this.m_shape.setRingAreaValid(a,!1),n+=c,t++}this.m_shape.setGeometryPathCount(this.m_geometry,t),this.m_shape.setGeometryVertexCount(this.m_geometry,n);let s=0;for(let e=this.m_shape.getFirstGeometry();e!==r.nullHandle;e=this.m_shape.getNextGeometry(e))s+=this.m_shape.getPointCount(e);this.m_shape.setTotalPointCount(s)}dbgCheckPathFirst(){}isCurve(e){return null!==this.m_shape.getSegment(e)}compareVertices(e,t){const i=new o.Point2D;this.m_shape.queryXY(e,i);const n=new o.Point2D;return this.m_shape.queryXY(t,n),i.compare(n)}clipPolesOut(e,t){return this.clipPolygonOrProjectedPolyline2(e,t)}}class h extends t.GeometryCursor{constructor(e,t,s,r){super(),this.m_progressTracker=r,this.m_index=-1,e||i.throwInvalidArgumentException(""),this.m_envelope=t,this.m_inputGeometryCursor=e,this.m_spatialRefImpl=s,this.m_tolerance=n.calculateToleranceFromGeometryForOp(s,t,!1).total()}next(){let e;return(e=this.m_inputGeometryCursor.next())?(i.throwIfMesh(e),this.m_index=this.m_inputGeometryCursor.getGeometryID(),a(e,this.m_envelope,this.m_tolerance,0,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}e.OperatorClip=class{getOperatorType(){return 10004}supportsCurves(){return!0}accelerateGeometry(e,t,i){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,i,n){return new h(e,t,i,n)}execute(e,t,i,n){return function(e,t,i,n){return l(e,t,i,Number.NaN,0,n)}(e,t,i,n)}},e.clip$1=a,e.clipPolesOut=function(e,t,i,n,r,o){const a=new c(t,o),l=new s.Envelope2D;return e.queryLooseEnvelope(l),t.containsEnvelope(l)?e:t.isIntersecting(l)?a.clipPolesOut(e,r):e.createInstance()}}))},"esri/chunks/OperatorDensify":function(){define(["exports","./SimpleGeometryCursor","./Geometry","./MultiPathImpl"],(function(e,t,i,n){"use strict";var s=n.Densificator;class r extends t.GeometryCursor{constructor(e,t,i,n,r,o){super(),this.m_densificator=new s(t,i,n,o,!1,r),this.m_index=-1,this.m_inputGeoms=e}tock(){return!0}getRank(){return 1}next(){let e=null;for(;e=this.m_inputGeoms.next();)return i.throwIfMesh(e),this.m_index=this.m_inputGeoms.getGeometryID(),this.densify(e);return null}getGeometryID(){return this.m_index}densify(e){return this.m_densificator.densify(e)}}e.OperatorDensify=class{getOperatorType(){return 10202}accelerateGeometry(e,t,i){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}executeMany(e,t,i,n,s,o=12e3){return new r(e,t,i,n,o,s)}execute(e,t,i,s,r,o=12e3){return n.densify(e,t,i,s,r,o)}}}))},"esri/chunks/OperatorDefinitions":function(){define(["exports"],(function(e){"use strict";e.NonSimpleResult=class{assign(e){this.m_reason=e.m_reason,this.m_vertexIndex1=e.m_vertexIndex1,this.m_vertexIndex2=e.m_vertexIndex2}constructor(e,t,i){void 0!==e?(this.m_reason=e,this.m_vertexIndex1=t,this.m_vertexIndex2=i):(this.m_reason=0,this.m_vertexIndex1=-1,this.m_vertexIndex2=-2)}clear(){this.m_reason=0,this.m_vertexIndex1=-1,this.m_vertexIndex2=-1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/operators/support/apiConverter":function(){define(["exports","../../../chunks/Point2D","../../../chunks/Envelope2D","../../../chunks/Geometry","../../../chunks/Envelope","../../../chunks/MultiPathImpl","../../../chunks/ProjectionTransformation","../../Extent","../../Multipoint","../../Point","../../Polygon","../../Polyline","./initNoPeFactory","./jsonConverter"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d){"use strict";const p="_gxVersion";function g(e){if(!e.getCacheValue(p)){const t=new s.Envelope;t.setCoords(e.xmin,e.ymin,e.xmax,e.ymax),e.hasM&&t.setInterval(2,0,e.mmin,e.mmax),e.hasZ&&t.setInterval(1,0,e.zmin,e.zmax),e.setCacheValue(p,t)}return e.getCacheValue(p)}function _(e){if(!e.getCacheValue(p)){const t=new r.MultiPoint,i=new s.Point,n=e.points,o=e.hasM,a=e.hasZ,l=a?3:2;for(let e=0,s=n.length;e<s;e++){const s=n[e];i.setXYCoords(s[0],s[1]),a&&i.setZ(s[2]??0),o&&i.setM(s[l]??NaN),t.add(i)}e.setCacheValue(p,t)}return e.getCacheValue(p)}function f(e){if(!e.getCacheValue(p)){const t=new s.Point;t.setXYCoords(e.x,e.y),e.hasM&&t.setM(e.m),e.hasZ&&t.setZ(e.z),e.setCacheValue(p,t)}return e.getCacheValue(p)}function y(e){if(!e.getCacheValue(p)){const{curveRings:t,hasM:i,hasZ:n,rings:s}=e,r=d.fromGeometryToGXGeometry({curveRings:t,hasM:i,hasZ:n,rings:s});e.setCacheValue(p,r)}return e.getCacheValue(p)}function x(e){if(!e.getCacheValue(p)){const{curvePaths:t,hasM:i,hasZ:n,paths:s}=e,r=d.fromGeometryToGXGeometry({curvePaths:t,hasM:i,hasZ:n,paths:s});e.setCacheValue(p,r)}return e.getCacheValue(p)}function v(e,t){if(e.isEmpty())return null;const i=new a({xmin:e.getXMin(),ymin:e.getYMin(),xmax:e.getXMax(),ymax:e.getYMax(),spatialReference:t}),n=e.getDescription();if(n.hasM()){const t=e.queryInterval(2,0);i.mmin=t.vmin,i.mmax=t.vmax}if(n.hasZ()){const t=e.queryInterval(1,0);i.zmin=t.vmin,i.zmax=t.vmax}return i.setCacheValue(p,e),i}function P(e,t){if(e.isEmpty())return null;const i=e.getDescription(),n=i.hasM(),r=i.hasZ(),o=[],a=new s.Point;for(let t=0,i=e.getPointCount();t<i;t++){e.getPointByVal(t,a);const i=[a.getX(),a.getY()];r&&i.push(a.getZ()),n&&i.push(a.getM()),o.push(i)}const c=new l({hasM:n,hasZ:r,points:o,spatialReference:t});return c.setCacheValue(p,e),c}function b(e,i){if(e instanceof t.Point2D)return new c({x:e.x,y:e.y,spatialReference:i});if(e.isEmpty())return null;const n=new c({x:e.getX(),y:e.getY(),spatialReference:i}),s=e.getDescription();return s.hasM()&&(n.m=e.getM()),s.hasZ()&&(n.z=e.getZ()),n.setCacheValue(p,e),n}function E(e,t){if(e.isEmpty())return null;const i=h.fromJSON({spatialReference:t,...d.toGeometry(e,null)});return i.setCacheValue(p,e),i}function S(e,t){if(e.isEmpty())return null;const i=u.fromJSON({spatialReference:t,...d.toGeometry(e,null)});return i.setCacheValue(p,e),i}e.fromExtent=g,e.fromGeometry=function(e){switch(e.type){case"point":return f(e);case"multipoint":return _(e);case"polyline":return x(e);case"polygon":return y(e);case"extent":return g(e);default:throw new Error(`Unsupported geometry type: ${e.type}`)}},e.fromMultipoint=_,e.fromPoint=f,e.fromPolygon=y,e.fromPolyline=x,e.fromSpatialReference=function(e){if(e.wkid)return o.create$2(e.wkid);const t=e.wkt2||e.wkt;return t?o.createFromWKT$2(t):null},e.getSpatialReference=function(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference},e.toExtent=v,e.toGeometry=function(e,t){if(e)switch(e.getGeometryType()){case n.GeometryType.enumPoint:return b(e,t);case n.GeometryType.enumEnvelope:return v(e,t);case n.GeometryType.enumMultiPoint:return P(e,t);case n.GeometryType.enumPolyline:return S(e,t);case n.GeometryType.enumPolygon:return E(e,t)}return null},e.toMultipoint=P,e.toPoint=b,e.toPolygon=E,e.toPolyline=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/operators/support/initNoPeFactory":function(){define(["../../../chunks/Envelope2D","../../../chunks/Geometry","../../../chunks/MultiPathImpl","../../../chunks/Envelope","../../../chunks/Point2D","../../../chunks/ProjectionTransformation","../../../core/unitUtils","../../support/spatialReferenceUtils"],(function(e,t,i,n,s,r,o,a){"use strict";r.injectNoPe$1((e=>{let t,i;"number"==typeof e?t=e:i=e;const n={wkid:t,wkt:i};let s,r;if(i){s=o.isProjectedWKT(i);const e=a.isGeographic(n);if(!s&&!e)throw new Error(`Unsupported WKT type: ${i}`)}else s=!a.isGeographic(n);return r=t&&o.gradGcsIds.has(t)?Math.PI/200:s?o.getMetersPerUnit(n):Math.PI/180,{isPCS:s,metersOrRadiansPerUnit:r,semiMajor:0,wkidOrWkt:e}}))}))},"esri/geometry/operators/support/jsonConverter":function(){define(["exports","../../../chunks/Geometry","../../../chunks/Point2D","../../../chunks/ProjectionTransformation","../../../chunks/Envelope","../../../chunks/MultiPathImpl","./initNoPeFactory"],(function(e,t,i,n,s,r,o){"use strict";function a(){if(-1===this.m_i)return this.m_i=0,{value:{m_token:1,m_value:null},done:!1};if(this.m_i<this.m_keys.length){const e=this.m_bReturnKey,t=Math.trunc(this.m_i);return this.m_bReturnKey=!this.m_bReturnKey,this.m_i+=.5,e?{value:{m_token:5,m_value:this.m_keys[t]},done:!1}:{value:{m_token:6,m_value:this.m_o[this.m_keys[t]]},done:!1}}return{value:{m_token:3,m_value:null},done:!0}}function l(){if(-1===this.m_i)return this.m_i=0,{value:{m_token:2,m_value:null},done:!1};if(this.m_i<this.m_a.length){const e={value:{m_token:6,m_value:this.m_a[this.m_i++]},done:!1};return this.m_strict||void 0===e.value.m_value&&(e.value.m_value=Number.NaN),e}return{value:{m_token:4,m_value:null},done:!0}}class c{createJSONObjectIterator(e){return{m_iteratorType:"object",m_o:e,m_keys:this.m_options.strict?Object.keys(e):Object.keys(e).filter((t=>void 0!==e[t])),m_i:-1,m_bReturnKey:!0,next:a}}createJSONArrayIterator(e){return{m_iteratorType:"array",m_strict:this.m_options.strict,m_i:-1,m_a:e,next:l}}constructor(e,t){this.m_currentToken=0,this.m_options=t?{...t}:{strict:!0};const i=e;this.m_iteratorStack=[i instanceof Array?this.createJSONArrayIterator(i):this.createJSONObjectIterator(i)],this.m_nextFlatToken={m_value:null,m_token:0}}nextToken(){if(0===this.m_iteratorStack.length)return this.m_currentToken=0;switch(this.m_nextFlatToken=this.m_iteratorStack.at(-1).next().value,this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_currentToken=1;case 3:return this.m_iteratorStack.pop(),this.m_currentToken=3;case 2:return this.m_currentToken=2;case 4:return this.m_iteratorStack.pop(),this.m_currentToken=4;case 5:return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=5;case 6:if(this.m_nextFlatToken.m_value instanceof Array)return this.m_iteratorStack.push(this.createJSONArrayIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(this.m_nextFlatToken.m_value instanceof Object)return this.m_iteratorStack.push(this.createJSONObjectIterator(this.m_nextFlatToken.m_value)),this.nextToken();if("number"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,Number.isSafeInteger(this.m_currentValue)&&this.m_currentValue>=i.intMin()&&this.m_currentValue<=i.intMax()?this.m_currentToken=8:this.m_currentToken=7;if("string"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=6;if("boolean"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=this.m_nextFlatToken.m_value?11:12;if("object"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=null,this.m_currentToken=10;t.throwInternalErrorException("unrecognized json element type")}return t.throwInternalErrorException("unrecognized json element type"),0}currentToken(){return this.m_currentToken}skipChildren(){if(0!==this.m_iteratorStack.length)switch(this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=3,void(this.m_currentToken=3);case 2:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=4,void(this.m_currentToken=4)}}currentString(){return 6!==this.m_currentToken&&5!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}currentDoubleValue(){return 7!==this.m_currentToken&&8!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}currentInt32Value(){return 8!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}currentInt64Value(){return t.geometryReleaseAssert(0),0n}currentBoolValue(){return 12!==this.m_currentToken&&11!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}isError(){return 0}}class h{constructor(e){return this.m_buffer=null,this.m_view=null,this.m_sz=0,this.m_offset=0,this.m_bOwnsBuffer=!0,this.m_bLittleEndian=!0,this.m_element=new ArrayBuffer(8),this.m_elementBytes=new Uint8Array(this.m_element),this.m_elementView=new DataView(this.m_element),this.m_elementDouble=new Float64Array(this.m_element),this.m_elementFloat=new Float32Array(this.m_element),this.m_elementInt64=new BigInt64Array(this.m_element),this.m_elementInt32=new Int32Array(this.m_element),this.m_elementInt16=new Int16Array(this.m_element),void 0!==e.sz?(this.m_sz=e.sz,e.buffer?(this.m_sz<0&&t.throwOutOfRangeException("size out of range"),this.m_buffer=e.buffer,this.m_offset=void 0!==e.offset?e.offset:0,this.m_view=void 0!==e.offset?new DataView(e.buffer,e.offset,e.sz):new DataView(this.m_buffer),this.m_bOwnsBuffer=!1,void(this.m_bLittleEndian=!0)):(this.m_sz<0&&t.throwOutOfRangeException("size out of range"),void(this.m_sz>0&&(this.m_buffer=new ArrayBuffer(this.m_sz),this.m_view=new DataView(this.m_buffer))))):e.move?(this.m_sz=e.move.m_sz,this.m_buffer=e.move.m_buffer,this.m_view=e.move.m_view,this.m_bOwnsBuffer=e.move.m_bOwnsBuffer,this.m_bLittleEndian=e.move.m_bLittleEndian,e.move.m_buffer=null,e.move.m_view=null,e.move.m_sz=0,void(e.move.m_bOwnsBuffer=!0)):void t.throwInternalErrorException("unrecognized constructor options")}swapBytesDouble(){this.doSwap()&&(this.m_elementDouble[0]=this.m_elementBytes[0]<<56|this.m_elementBytes[1]<<48|this.m_elementBytes[2]<<40|this.m_elementBytes[3]<<32|this.m_elementBytes[4]<<24|this.m_elementBytes[5]<<16|this.m_elementBytes[6]<<8|this.m_elementBytes[7])}swapBytesInt32(){this.doSwap()&&(this.m_elementInt32[0]=this.m_elementBytes[0]<<24|this.m_elementBytes[1]<<16|this.m_elementBytes[2]<<8|this.m_elementBytes[3])}getOffset(){return this.m_offset}assignMove(e){return this===e||(this.clear(),this.m_sz=e.m_sz,this.m_buffer=e.m_buffer,this.m_view=e.m_view,this.m_bOwnsBuffer=e.m_bOwnsBuffer,this.m_bLittleEndian=e.m_bLittleEndian,e.m_buffer=null,e.m_sz=0,e.m_bOwnsBuffer=!0),this}doSwap(){return this.m_bLittleEndian!==(1===h.getNativeByteOrder())}setNativeByteOrder(){this.m_bLittleEndian=1===h.getNativeByteOrder()}setOrder(e){this.m_bLittleEndian=1===e}getOrder(){return this.m_bLittleEndian?1:0}getView(){return this.m_view||t.throwInvalidCallException("buffer not defined"),this.m_view}static getNativeByteOrder(){return 1}clear(){this.m_buffer=null,this.m_sz=0,this.m_bOwnsBuffer=!0}size(){return this.m_sz}readDouble(e){return this.doSwap()?(this.m_elementDouble[0]=this.m_view.getFloat64(e,this.m_bLittleEndian),this.swapBytesDouble(),this.m_elementDouble[0]):this.m_view.getFloat64(e,this.m_bLittleEndian)}writeDouble(e,t){this.m_elementDouble[0]=t,this.swapBytesDouble(),this.m_view.setFloat64(e,this.m_elementDouble[0],this.m_bLittleEndian)}readInt32(e){return this.doSwap()?(this.m_elementInt32[0]=this.m_view.getInt32(e,this.m_bLittleEndian),this.swapBytesInt32(),this.m_elementInt32[0]):this.m_view.getInt32(e,this.m_bLittleEndian)}writeInt32(e,t){this.m_elementInt32[0]=t,this.swapBytesInt32(),this.m_view.setInt32(e,this.m_elementInt32[0],this.m_bLittleEndian)}getPtr(){return this.m_buffer}setSizeNoRealloc(e){t.geometryReleaseAssert(e>=0&&e<=this.m_sz),this.m_sz=e}}function u(e){let t=!1;for(;3!==e.nextToken();){const i=e.currentString();e.nextToken(),"uwkid"===i?t||(t=!0,8===e.currentToken()&&e.currentInt32Value()):e.skipChildren()}return null}function m(e){let t=!1,i=!1,s=!1,r=!1,o=!1,a=!1,l=!1,c=!1,h=!1,m=!1,d=!1,p=!1,g=!1,_=!1,f=!1,y=!1,x=!1,v=-1,P=-1,b=-1,E=-1,S=0,C=0,w=0,T=0,D=0,I=0,A=0,M=0,N=0,R=0,O="",G="",k=null;for(;3!==e.nextToken();){const n=e.currentString();e.nextToken(),"wkid"===n?t||(t=!0,8===e.currentToken()&&(v=e.currentInt32Value())):"latestWkid"===n?i||(i=!0,8===e.currentToken()&&(P=e.currentInt32Value())):"wkt"===n?o||(o=!0,6===e.currentToken()&&(O=e.currentString())):"wkt2"===n?o||6===e.currentToken()&&(G=e.currentString()):"vcsWkid"===n?s||(s=!0,8===e.currentToken()&&(b=e.currentInt32Value())):"latestVcsWkid"===n?r||(r=!0,8===e.currentToken()&&(E=e.currentInt32Value())):"xyTolerance"===n?l||(l=!0,a=!0,S=e.currentDoubleValue()):"zTolerance"===n?c||(c=!0,a=!0,C=e.currentDoubleValue()):"mTolerance"===n?h||(h=!0,a=!0,w=e.currentDoubleValue()):"falseX"===n?m||(m=!0,a=!0,A=e.currentDoubleValue()):"falseY"===n?d||(d=!0,a=!0,M=e.currentDoubleValue()):"falseZ"===n?p||(p=!0,a=!0,N=e.currentDoubleValue()):"falseM"===n?g||(g=!0,a=!0,R=e.currentDoubleValue()):"xyUnits"===n?_||(_=!0,a=!0,T=e.currentDoubleValue()):"zUnits"===n?f||(f=!0,a=!0,D=e.currentDoubleValue()):"mUnits"===n?y||(y=!0,a=!0,I=e.currentDoubleValue()):"unit"===n?x||(x=!0,k=u(e)):e.skipChildren()}E<=0&&b>0&&(E=b),b<=0&&E>0&&(b=E);let V=null,F=!0;if(0!==O.length&&(F=!1,n.isValidWkt$1(O)&&(V=n.createFromWKT$2(O))),V||0===G.length||(F=!1,n.isValidWkt$1(G)&&(V=n.createFromWKT$2(G))),!V&&P>0&&(F=!1,n.isValidWkid$1(P)&&(E<=0||n.isValidWkid$2())&&(V=n.create$2(P,E))),!V&&v>0&&(F=!1,n.isValidWkid$1(v)&&(b<=0||n.isValidWkid$2())&&(V=n.create$2(v,b))),F&&(V=n.createLocal(k)),a&&V){const e=new n.SpatialReferencePrecisionDescriptor;V.queryPrecisionDescriptorWithoutFalseXY(e),l&&e.setTolerance(0,S),c&&e.setTolerance(1,C),h&&e.setTolerance(2,w),_&&m&&d&&e.setGridParams(A,M,T),f&&p&&e.setZParams(N,D),y&&g&&e.setMParams(R,I),V=n.createWithNewPrecision(V,e)}return V}function d(e,n,o,a){2!==a.currentToken()&&t.throwInvalidArgumentException("failed to parse multipath: array of array of vertices is expected");const l=e?new r.Polygon:new r.Polyline,c=l,h=s.createIndexStream(0),u=s.createDoubleStream(2,0),m=s.createByteStream(0);let d=null,p=null,g=null,f=null,P=null,b=0,E=0,S=0;const C=new r.SegmentBuffer,w=i.Point2D.getNAN();let T=0,D=0;const I=e?1:0;for(;4!==a.nextToken();){2!==a.currentToken()&&t.throwInvalidArgumentException("failed to parse multipath: ring/path array is expected");let o=2,l=0,A=!0;const M=4;let N=0,R=0;const O=i.Point2D.getNAN(),G=i.makePrimitiveArray(M,Number.NaN),k=i.makePrimitiveArray(M,Number.NaN);let V=!1;for(a.nextToken();4!==a.currentToken();){if(n&&1===a.currentToken())A&&t.throwInvalidArgumentException("failed to parse multipath: starting vertex array is expected"),g||(g=s.createByteStream(T-1,1),f=s.createIndexStream(T-1,-1),P=s.createDoubleStream(0)),V=!0,o=1,({segFlag:S,toPointSz:N}=v(C,G,w,a));else{for(V=!1,2!==a.currentToken()&&t.throwInvalidArgumentException("failed to parse multipath: array is expected, rings/paths vertices consist of arrays of coordinates"),N=0;4!==a.nextToken();)N===M&&t.throwInvalidArgumentException("failed to parse multipath: each vertex array has to have at most 4 elements"),G[N++]=_(a);N<2&&t.throwInvalidArgumentException("failed to parse multipath: each vertex array has to have at least 2 elements"),s.checkFinite(G[0],G[1])||t.throwInvalidArgumentException("failed to parse multipath: x and y must be finite")}a.nextToken();do{if(u.size()===2*T&&u.resize(y(T)),u.writePoint2D(2*T,O.setCoords(G[0],G[1])),d&&d.size()===T&&d.resize(x(T)),N>2?(d||(d=s.createDoubleStream(T+1,Number.NaN)),d.write(T,G[2])):d&&d.write(T,Number.NaN),p&&p.size()===T&&p.resize(x(T)),N>3?(p||(p=s.createDoubleStream(T+1,Number.NaN)),p.write(T,G[3])):p&&p.write(T,Number.NaN),A)D++,h.add(T),m.add(I),A=!1,R=N,i.memcpy(k,G,0,0,R);else if(null!==g)if(V){const e=r.sizeInBuffer(S),t=P.size();P.resize(t+e),g.add(S),f.add(b),C.get().writeInBufferStream(P,b),b+=e,c.incCurveType(S,1),E++}else g.add(1),f.add(-1);T++,l++,w.setCoords(G[0],G[1])}while(l<o&&4===a.currentToken())}0!==l&&(e&&l>o&&N===R&&0===i.memcmp(G,k,N)?(T--,l--):null!==g&&(g.add(1),f.add(-1)))}return T&&(h.resize(D),m.resize(D),T>0&&(h.add(T),m.add(0)),c.setAttributeStreamRef(0,u),c.setPathFlagsStreamRef(m),c.setPathStreamRef(h),null!==g&&(c.updateCurveCounter(E),c.setSegmentData(f,P,g,b)),c.notifyModifiedFlags(65535)),{geometry:l,as:d,bs:p}}function p(e,n){2!==n.currentToken()&&t.throwInvalidArgumentException("failed to parse multipoint: array of vertices is expected");let o=0;const a=new r.MultiPoint,l=s.createDoubleStream(2,0);let c=0;const h=i.makePrimitiveArray(4,Number.NaN),u=new i.Point2D;let m=null,d=null;for(;4!==n.nextToken();){for(2!==n.currentToken()&&t.throwInvalidArgumentException("failed to parse multipoint: array is expected, multipoint vertices consist of arrays of cooridinates"),c=0;4!==n.nextToken();)4===c&&t.throwInvalidArgumentException("failed to parse multipoint: each vertex array has to have at most 4 elements"),h[c++]=_(n);c<2&&t.throwInvalidArgumentException("failed to parse multipoint: each vertex array has to have at least 2 elements"),s.checkFinite(h[0],h[1])||t.throwInvalidArgumentException("failed to parse multipoint: x and y must be finite"),l.size()===2*o&&l.resize(y(o)),l.writePoint2D(2*o,u.setCoords(h[0],h[1])),m&&m.size()===o&&m.resize(x(o)),c>2?(m||(m=s.createDoubleStream(o+1,Number.NaN)),m.write(o,h[2])):m&&m.write(o,Number.NaN),d&&d.size()===o&&d.resize(x(o)),c>3?(d||(d=s.createDoubleStream(o+1,Number.NaN)),d.write(o,h[3])):d&&d.write(o,Number.NaN),o++}if(o){const e=a.getImpl();e.setAttributeStreamRef(0,l),e.resizeNoInit(o),e.notifyModifiedFlags(65535)}return{geometry:a,as:m,bs:d}}function g(e,i){2!==i.currentToken()&&t.throwInvalidArgumentException("failed to parse array of IDs: array of array of integers is expected");const n=s.createAttributeStream(2,0);let r=0,o=-1;for(;4!==i.nextToken();){const e=r;n.size()===r&&n.resize(x(r)),r++;let s=0;for(-1===o?o=2===i.currentToken()?1:0:1===o&&2!==i.currentToken()&&t.throwInvalidArgumentException("failed to parse array of IDs: array of array of integers is expected"),0===o&&(n.size()===r&&n.resize(x(r)),n.write(r,f(i)),s++,r++);4!==i.nextToken();)n.size()===r&&n.resize(x(r)),n.write(r,f(i)),s++,r++;if(n.write(e,s),0===o)break}return n.resize(r),n}function _(e){const t=e.currentToken();if(10===t||6===t&&"NaN"===e.currentString())return Number.NaN;{const t=e.currentDoubleValue();return Number.isNaN(t)?Number.NaN:t}}function f(e){return e.currentInt32Value()}function y(e){let t=2*Math.trunc(3*(e+1)/2);return t<8?t=8:t<32&&(t=32),t}function x(e){let t=Math.trunc(3*(e+1)/2);return t<4?t=4:t<16&&(t=16),t}function v(e,n,s,o,a){const l={segFlag:0,toPointSz:0};let c=o.currentToken();c=o.nextToken();const u=o.currentString(),m=u[0];for((1!==u.length||"a"!==m&&"b"!==m&&"c"!==m&&"n"!==m&&"q"!==m)&&t.throwInvalidArgumentException('failed to parse curve: expecting "a", "b", "n", "q", or "c"'),c=o.nextToken(),2!==c&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for curve parameters"),c=o.nextToken(),2!==c&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for to point"),l.toPointSz=0;4!==o.nextToken();)4===l.toPointSz&&t.throwInvalidArgumentException("failed to parse curve: vertex array cannot have more than 4 elements"),n[l.toPointSz++]=_(o);l.toPointSz<2&&t.throwInvalidArgumentException("failed to parse curve: vertex array must have at least 2 elements");const d=i.Point2D.construct(n[0],n[1]),p=i.Point2D.getNAN();let g=-1,f=-1,y=!1,x=Number.NaN,v=Number.NaN,b=Number.NaN;const E=[i.Point2D.getNAN(),i.Point2D.getNAN(),i.Point2D.getNAN()],S=i.Point2D.getNAN();if("a"===m){c=o.nextToken(),2!==c&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for center point"),c=o.nextToken();const e=_(o);c=o.nextToken();const i=_(o);c=o.nextToken(),4!==c&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for center point"),p.setCoords(e,i),c=o.nextToken(),g=o.currentInt32Value(),c=o.nextToken(),f=o.currentInt32Value(),c=o.nextToken(),4!==c?(y=!1,x=_(o),c=o.nextToken(),v=_(o),c=o.nextToken(),b=_(o),c=o.nextToken(),4!==c&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters")):y=!0,l.segFlag=4}else if("b"===m){for(let e=0;e<2;e++){c=o.nextToken(),2!==c&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for control point"),c=o.nextToken();const i=_(o);c=o.nextToken();const n=_(o);c=o.nextToken(),4!==c&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for control point"),E[e].setCoords(i,n)}c=o.nextToken(),4!==c&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),l.segFlag=2}else if("n"===m){{c=o.nextToken(),2!==c&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for control point"),c=o.nextToken();const e=_(o);c=o.nextToken();const i=_(o);c=o.nextToken(),4!==c&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for control point"),E[0].setCoords(e,i)}c=o.nextToken();const e=_(o);c=o.nextToken();const i=_(o);c=o.nextToken();const n=_(o);E[1].setCoords(e,i),E[2].setCoords(n,n),c=o.nextToken(),4!==c&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),l.segFlag=8}else if("q"===m){for(let e=0;e<1;e++){c=o.nextToken(),2!==c&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for control point"),c=o.nextToken();const i=_(o);c=o.nextToken();const n=_(o);c=o.nextToken(),4!==c&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for control point"),E[e].setCoords(i,n)}c=o.nextToken(),4!==c&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),l.segFlag=16}else{c=o.nextToken(),2!==c&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for interior point"),c=o.nextToken();const e=_(o);c=o.nextToken();const i=_(o);c=o.nextToken(),4!==c&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for interior point"),S.setCoords(e,i),c=o.nextToken(),4!==c&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),l.segFlag=4}if(c=o.nextToken(),3!==c&&t.throwInvalidArgumentException("failed to parse curve: end object is expected for curve"),"a"===m)if(e.createEllipticArc(),y){const t=!0;P(e.get(),s,d,p,t,g,f)}else!function(e,t,i,n,s,o,a,l,c){e.dropAllAttributes();const u=new ArrayBuffer(44),m=new h({sz:44,buffer:u});let d=0;m.writeDouble(d,n.x),d+=8,m.writeDouble(d,n.y),d+=8,m.writeDouble(d,a),d+=8,m.writeDouble(d,l),d+=8,m.writeDouble(d,c),d+=8;let p=0;o||(p|=2048),s&&(p|=4096),m.writeInt32(d,p),d+=4,function(e,t,i,n){e.m_bits=0,e.m_center.x=n.readDouble(0),e.m_center.y=n.readDouble(8),e.m_rotation=n.readDouble(16),e.m_semiMajorAxis=n.readDouble(24),e.m_minorMajorRatio=n.readDouble(32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=i.x,e.m_YEnd=i.y;const s=n.readInt32(40);if(1&s)return!1;let o=!!(64&s),a=!!(128&s);const l=!!(2048&s),c=!!(4096&s);!(512&s)&&!(1024&s)||a||(o=!0),a&&!t.equals(i)?(a=!1,o=!0):o&&t.equals(i)&&(a=!0,o=!1),a?(e.m_center.assign(t),e.m_startAngle=e.m_center.x,e.m_sweepAngle=e.m_center.y,r.arcimpl_NormalizeAngles(e,Number.NaN,l,c),e.m_semiMajorAxis=0,e.m_interior.setCoordsPoint2D(t)):o?(e.m_center.setNAN(),e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,r.clearEndPointModified(e),e.queryCoord2D(.5,e.m_interior)):e.constructEllipticArcEndPointsCenter(t,i,e.m_semiMajorAxis,e.m_minorMajorRatio,e.m_rotation,!c,l,e.m_center),e.setProjectionBehavior(1),r.clearEndPointModified(e)}(e,t,i,m)}(e.get(),s,d,p,g,f,x,v,b);else if("b"===m)e.createCubicBezier(),function(e,n,s,r){e.dropAllAttributes();const o=new ArrayBuffer(32),a=new h({sz:32,buffer:o});let l=0;a.writeDouble(l,r[0].x),l+=8,a.writeDouble(l,r[0].y),l+=8,a.writeDouble(l,r[1].x),l+=8,a.writeDouble(l,r[1].y),l+=8,function(e,n,s,r){t.geometryReleaseAssert(32<=r.size()),e.m_cp=i.makeObjectArray(i.Point2D,2),e.m_cp[0].x=r.readDouble(0),e.m_cp[0].y=r.readDouble(8),e.m_cp[1].x=r.readDouble(16),e.m_cp[1].y=r.readDouble(24),e.m_XStart=n.x,e.m_YStart=n.y,e.m_XEnd=s.x,e.m_YEnd=s.y}(e,n,s,a)}(e.get(),s,d,E);else if("n"===m)e.createQuadraticRationalBezier(),function(e,t,i,n,s,r,o){e.dropAllAttributes();const a=new ArrayBuffer(40),l=new h({sz:40,buffer:a});let c=0;l.writeDouble(c,n.x),c+=8,l.writeDouble(c,n.y),c+=8,l.writeDouble(c,s),c+=8,l.writeDouble(c,r),c+=8,l.writeDouble(c,o),c+=8,function(e,t,i,n){e.m_cp.x=n.readDouble(0),e.m_cp.y=n.readDouble(8),e.m_weights[0]=n.readDouble(16),e.m_weights[1]=n.readDouble(24),e.m_weights[2]=n.readDouble(32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=i.x,e.m_YEnd=i.y}(e,t,i,l)}(e.get(),s,d,E[0],E[1].x,E[1].y,E[2].x);else if("q"===m)e.createQuadraticBezier(),e.get().construct(s,E[0],d);else{e.createEllipticArc();const t=!1;P(e.get(),s,d,S,t,-1,-1)}return l}function P(e,n,s,o,a,l,c){e.dropAllAttributes();const u=new ArrayBuffer(20),m=new h({sz:20,buffer:u});let d=0;m.writeDouble(d,o.x),d+=8,m.writeDouble(d,o.y),d+=8;let p=0;a?(c||(p|=8),l&&(p|=16)):p|=128,m.writeInt32(d,p),d+=4,function(e,n,s,o){0>=o.size()&&t.throwOutOfRangeException("Byte_buffer out of range access"),e.m_bits=0,e.m_rotation=0,e.m_cosr=1,e.m_sinr=0,e.setStartXY(n),e.setEndXY(s);const a=i.Point2D.getNAN();a.x=o.readDouble(0),a.y=o.readDouble(8);const l=o.readInt32(16);if(1&l)return e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.assign(a),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,r.clearEndPointModified(e),!1;let c=!!(64&l);const h=!!(128&l);let u=!!(32&l);const m=!!(8&l),d=!!(16&l),p=n.equals(s);c&&!p&&(c=!1,u=!0),u&&p&&(c=!0,u=!1,a.setCoords(0,0)),c||(h?u?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_interior.assign(a),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0):(e.constructCircularArcThreePoint(n,s,a),p&&m===e.isClockwise()&&e.reverse()):u?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,r.clearEndPointModified(e),e.queryCoord2D(.5,e.m_interior)):r.constructCircularArcHelperForOldFormat(e,n,s,a,m,d)),c&&(e.m_center.assign(n),e.m_startAngle=a.x,e.m_sweepAngle=a.y,r.arcimpl_NormalizeAngles(e,Number.NaN,m,d),e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.setCoordsPoint2D(n)),e.setProjectionBehavior(0),r.clearEndPointModified(e)}(e,n,s,m)}function b(e,i,n,s,o){const a=e.getGeometryType();if(a===t.GeometryType.enumEllipticArc)return function(e,i,n,s,o){t.geometryReleaseAssert(!r.isEndPointModified(e));const a=e.getEndXY(),l=e.hasAttribute(1)&&!i,c=e.hasAttribute(2)&&!n;let h=Number.NaN,u=Number.NaN;if(l&&(h=e.getEndAttributeAsDbl(1,0)),c&&(u=e.getEndAttributeAsDbl(2,0)),e.isDegenerateToLine()||e.isDegenerate(0))return S(l,c,a.x,a.y,h,u,s,o),!0;const m=0===e.projectionBehavior(),d=!!m&&e.isClosed();if(m&&!d)o.startObject(),o.addFieldName("c"),o.startArray(),S(l,c,a.x,a.y,h,u,s,o),C(e.m_interior.x,e.m_interior.y,17,o),o.endArray(),o.endObject();else if(m){o.startObject(),o.addFieldName("a"),o.startArray(),S(l,c,a.x,a.y,h,u,s,o);const t=0,i=0;C(e.m_center.x+t,e.m_center.y+i,17,o);const n=!e.isMajor();o.addInt32(n?1:0);const r=e.isClockwise();o.addInt32(r?1:0),o.endArray(),o.endObject()}else{o.startObject(),o.addFieldName("a"),o.startArray(),S(l,c,a.x,a.y,h,u,s,o);const t=e;C(t.m_center.x,t.m_center.y,17,o);const i=!t.isMajor();o.addInt32(i?1:0);const n=t.isClockwise();o.addInt32(n?1:0),o.addDouble(t.m_rotation,17),o.addDouble(t.m_semiMajorAxis,17),o.addDouble(t.m_minorMajorRatio,17),o.endArray(),o.endObject()}return!1}(e,i,n,s,o);if(a===t.GeometryType.enumBezier)return E(e,i,n,s,o);if(a===t.GeometryType.enumRationalBezier2)return function(e,t,i,n,s){const r=e.getEndXY(),o=e.hasAttribute(1)&&!t,a=e.hasAttribute(2)&&!i;let l=Number.NaN,c=Number.NaN;o&&(l=e.getEndAttributeAsDbl(1,0)),a&&(c=e.getEndAttributeAsDbl(2,0)),s.startObject(),s.addFieldName("n"),s.startArray(),S(o,a,r.x,r.y,l,c,n,s),C(e.m_cp.x,e.m_cp.y,n,s);const h=n;return s.addDouble(e.m_weights[0],h),s.addDouble(e.m_weights[1],h),s.addDouble(e.m_weights[2],h),s.endArray(),s.endObject(),!1}(e,i,n,s,o);if(a===t.GeometryType.enumBezier2){const t=new r.CubicBezier;return t.constructFromQuadraticSegment(e),E(t,i,n,s,o)}t.throwNotImplementedException("")}function E(e,t,i,n,s){const r=e.getEndXY(),o=e.hasAttribute(1)&&!t,a=e.hasAttribute(2)&&!i;let l=Number.NaN,c=Number.NaN;return o&&(l=e.getEndAttributeAsDbl(1,0)),a&&(c=e.getEndAttributeAsDbl(2,0)),s.startObject(),s.addFieldName("b"),s.startArray(),S(o,a,r.x,r.y,l,c,n,s),C(e.m_cp[0].x,e.m_cp[0].y,n,s),C(e.m_cp[1].x,e.m_cp[1].y,n,s),s.endArray(),s.endObject(),!1}function S(e,t,i,n,s,r,o,a){a.startArray(),a.addDouble(i,o),a.addDouble(n,o),e&&a.addDouble(s,o),t&&a.addDouble(r,o),a.endArray()}function C(e,t,i,n){n.startArray(),n.addDouble(e,i),n.addDouble(t,i),n.endArray()}function w(e,i,n,o){const a=n.getImpl(),l=!!(2&i),c=!!(4&i),h=!!(8&i),u=a.hasAttribute(1)&&!l,m=a.hasAttribute(2)&&!c,d=a.hasAttribute(3)&&!h,p=a.hasNonLinearSegments();u&&(o.addFieldName("hasZ"),o.addBool(!0)),m&&(o.addFieldName("hasM"),o.addBool(!0)),e?p?o.addFieldName("curveRings"):o.addFieldName("rings"):p?o.addFieldName("curvePaths"):o.addFieldName("paths");let g=null;const _=[];if(n.isEmpty())o.startArray(),o.endArray();else{const e=17-(31&i>>13);o.startArray();const h=n.getPathCount();let f=0;const y=a.getAttributeStreamRef(0);let x=null,v=null,P=null;const E=new r.SegmentBuffer;let S=null,C=null,w=null;p&&(S=a.getSegmentFlagsStreamRef(),C=a.getSegmentIndexStreamRef(),w=a.getSegmentDataStreamRef()),u&&(x=a.getAttributeStreamRef(1)),m&&(v=a.getAttributeStreamRef(2)),d&&(P=a.getAttributeStreamRef(3),g=s.createAttributeStreamFromSemantics(3,0));for(let i=0;i<h;i++){o.startArray(),d&&_.push(0);const s=n.getPathEnd(i);if(f===s){o.endArray();continue}const r=n.isClosedPath(i);let a=y.read(2*f),h=y.read(2*f+1),p=u?x.read(f):Number.NaN,D=m?v.read(f):Number.NaN,I=d?P.read(f):0;T(u,m,a,h,p,D,e,o);let A=1;d&&(g.add(I),_[_.length-1]++);const M=a,N=h,R=p,O=D,G=I;let k=!1,V=0,F=Number.NaN,L=Number.NaN,q=0;for(let i=f+1,n=f,H=r?s+1:s;i<H;i++,n++){const r=null!==S?31&S.read(n):1;let f,H;if(i<s?(f=y.read(2*i),H=y.read(2*i+1),u&&(F=x.read(i)),m&&(L=v.read(i)),d&&(q=P.read(i))):(f=M,H=N,F=R,L=O,q=G),1!==r){k=!0,4===r?E.createEllipticArc():2===r?E.createCubicBezier():16===r?E.createQuadraticBezier():8===r?E.createQuadraticRationalBezier():t.throwNotImplementedException("JSON export.unsupported curve");const i=E.get(),s=C.read(n);i.setStartXYCoords(a,h),i.setEndXYCoords(f,H),u&&(i.setStartAttribute(1,0,p),i.setEndAttribute(1,0,F)),m&&(i.setStartAttribute(2,0,D),i.setEndAttribute(2,0,L)),i.readFromBufferStream(w,s),b(E.get(),l,c,e,o)&&V++}else T(u,m,f,H,F,L,e,o);d&&(g.add(q),_[_.length-1]++),A++,a=f,h=H,p=F,D=L,I=q}k&&0===V||(A<2&&V<1&&(T(u,m,a,h,p,D,e,o),A++,d&&(g.add(I),_[_.length-1]++)),r&&A<3&&V<2&&(T(u,m,M,N,R,O,e,o),A++,a=M,h=N,p=R,D=O,I=G,d&&(g.add(G),_[_.length-1]++))),o.endArray(),f=s}o.endArray()}if(d){o.addFieldName("ids"),o.startArray();let e=0;for(let i=0,n=_.length;i<n;++i){const n=_[i];t.geometryReleaseAssert(0===n||null!==g&&e+n<=g.size()),o.startArray();for(let t=0;t<n;++t)o.addInt32(g.read(e)),e++;o.endArray()}o.endArray()}}function T(e,t,i,n,s,r,o,a){a.startArray(),a.addDouble(i,o),a.addDouble(n,o),e&&a.addDouble(s,o),t&&a.addDouble(r,o),a.endArray()}const D="a".charCodeAt(0),I="A".charCodeAt(0),A="*".charCodeAt(0),M="b".charCodeAt(0),N="\\".charCodeAt(0),R="[".charCodeAt(0),O="{".charCodeAt(0),G=":".charCodeAt(0),k=".".charCodeAt(0),V=",".charCodeAt(0),F='"'.charCodeAt(0),L="]".charCodeAt(0),q="}".charCodeAt(0),H="e".charCodeAt(0),U="E".charCodeAt(0),z="f".charCodeAt(0),Y="F".charCodeAt(0),B="/".charCodeAt(0),X="-".charCodeAt(0),j="+".charCodeAt(0),W="n".charCodeAt(0),Z="N".charCodeAt(0),Q="r".charCodeAt(0),$="t".charCodeAt(0),K="u".charCodeAt(0),J="0".charCodeAt(0),ee="9".charCodeAt(0);class te{constructor(e){this.m_functionStack=[],this.m_pushPositions=[],this.m_utf8Decoder=new TextDecoder("utf-8",{fatal:!0}),void 0===e?(this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_endToken=0,this.m_currentTokenType=0,this.m_functionStack.push((()=>this.accept_())),this.m_jsonString=null,this.m_bHasEscapes=!1):e.jsonString?this.resetParserFromString(e.jsonString):e.jsonStream?t.throwNotImplementedException("streaming json parsing not yet impl"):t.throwInternalErrorException("invalid constructor parameter")}prepSubstrString_(){}getCurrentSubstrString_(){return this.m_jsonString.slice(this.m_startToken,this.m_endToken)}stepOverCharString_(){this.m_endToken++}peekCharString_(){return this.m_jsonString.charCodeAt(this.m_endToken)}getString_(e){const t=this.m_jsonString?.slice(this.m_startToken,this.m_startToken+e-1);return this.m_endToken+=e-1,{s:t,bDone:this.m_endToken>=this.m_jsonString.length}}incrementString_(){this.m_endToken++}eofString_(){return this.m_endToken>=this.m_jsonString.length}setStringFunctions_(){this.m_prepSubstr=this.prepSubstrString_,this.m_getCurrentSubstr=this.getCurrentSubstrString_,this.m_stepOverChar=this.stepOverCharString_,this.m_peekChar=this.peekCharString_,this.m_get=this.getString_,this.m_increment=this.incrementString_,this.m_eof=this.eofString_}setStreamFunctions_(){t.throwNotImplementedException("streaming json parsing not yet impl")}reset_(){this.m_jsonString=null,this.m_endToken=0,this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_currentTokenType=0,this.m_bHasEscapes=!1,this.m_functionStack.length=0,this.m_functionStack.push((()=>this.start_())),this.m_pushPositions.length=0}resetParserFromString(e){this.reset_(),this.setStringFunctions_(),this.m_jsonString=e}resetParserFromStream(e){t.throwNotImplementedException("streaming json parsing not yet impl")}resetToPosition(e){return!!this.m_jsonString&&(this.m_endToken=e,this.m_startToken=Number.MAX_VALUE,this.m_currentTokenType=0,this.m_functionStack.length=0,e>=this.m_jsonString.length?(this.m_functionStack.push((()=>this.accept_())),!1):(this.m_functionStack.push((()=>this.start_())),!0))}nextToken(){return this.m_functionStack.at(-1)(),this.m_currentTokenType}currentToken(){return this.m_currentTokenType}currentTokenStartIndex(){return this.m_startToken}currentTokenEndIndex(){return this.m_endToken}currentText(){return t.geometryReleaseAssert(0),""}childrenAsString(){return t.geometryReleaseAssert(0),""}skipChildren(){this.skipChildren_()}skipChildren_(){if(1!==this.m_currentTokenType)if(2!==this.m_currentTokenType);else{let e=1;do{this.m_currentTokenType=this.nextToken(),2===this.m_currentTokenType?e++:4===this.m_currentTokenType&&e--}while(4!==this.m_currentTokenType||0!==e)}else{let e=1;do{this.m_currentTokenType=this.nextToken(),1===this.m_currentTokenType?e++:3===this.m_currentTokenType&&e--}while(3!==this.m_currentTokenType||0!==e)}}currentTerminalAsString_(){switch(this.m_currentTokenType){case 7:case 8:case 9:return this.m_getCurrentSubstr().slice(0,this.m_endToken-this.m_startToken);case 10:return"null";case 11:return"true";case 12:return"false"}t.throwInvalidArgumentException("invalid token")}toUTF8_(e,t){let i=0,n=e;for(;t.charCodeAt(n)===N&&t.charCodeAt(n+1)===K;)i++,n+=6;n=e;const s=new Uint8Array(i);let r=0;for(;t.charCodeAt(n)===N&&t.charCodeAt(n+1)===K;)s[r++]=Number.parseInt(t.slice(n+2,n+6),16),n+=6;return{u8s:this.m_utf8Decoder.decode(s),end:n}}unquoteCurrentString_(){let e="",t=1;const i=this.m_endToken-this.m_startToken-1;let n=0;const s=this.m_getCurrentSubstr();for(let r=t;r<i;r++)if(s.charCodeAt(r)!==N)n++;else{switch(n>0&&(e+=s.slice(t,t+n)),s.charCodeAt(++r)){case F:e+='"';break;case K:{const{u8s:t,end:i}=this.toUTF8_(r-1,s);r=i-1,e+=t;break}case N:e+="\\";break;case B:e+="/";break;case M:e+="\b";break;case z:e+="\f";break;case W:e+="\n";break;case Q:e+="\r";break;case $:e+="\t"}t=r+1,n=0}return n>0&&(e+=s.slice(t,t+n)),e}currentString(){return 5!==this.m_currentTokenType&&6!==this.m_currentTokenType?this.currentTerminalAsString_():this.m_bHasEscapes?this.unquoteCurrentString_():this.m_getCurrentSubstr().slice(1,this.m_endToken-this.m_startToken-2+1)}currentDoubleValue(){if(7!==this.m_currentTokenType&&8!==this.m_currentTokenType&&9!==this.m_currentTokenType&&6!==this.m_currentTokenType&&10!==this.m_currentTokenType&&t.throwInvalidArgumentException("invalid token"),10===this.m_currentTokenType)return Number.NaN;let e=this.m_getCurrentSubstr(),i=this.m_endToken-this.m_startToken;if(6===this.m_currentTokenType){if("NaN"===this.currentString())return Number.NaN;e=e.slice(1),i-=2,0===i&&t.throwInvalidArgumentException("invalid token")}const n=Number.parseFloat(e);if(6===this.m_currentTokenType)Number.isNaN(n)&&t.throwInvalidArgumentException("invalid token");else if(Number.isNaN(n))return Number.NaN;return n}currentInt32Value(){8!==this.m_currentTokenType&&6!==this.m_currentTokenType&&t.throwInvalidArgumentException("invalid token");let e=this.m_getCurrentSubstr(),i=this.m_endToken-this.m_startToken;6===this.m_currentTokenType&&(e=e.slice(1),i-=2,0===i&&t.throwInvalidArgumentException("invalid token"));const n=parseInt(e);return Number.isNaN(n)&&t.throwInvalidArgumentException("invalid token"),n}currentInt64Value(){return t.geometryReleaseAssert(0),0n}currentBoolValue(){return t.geometryReleaseAssert(0),!1}isError(){return 0}JSONString(){return t.geometryReleaseAssert(0),""}pushPosition(){return t.geometryReleaseAssert(0),!1}popPosition(){return t.geometryReleaseAssert(0),!1}skipCStyleComments_(){t.geometryReleaseAssert(0)}skipCppStyleComments_(){t.geometryReleaseAssert(0)}skipComments_(){this.m_prepSubstr();let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e===A?this.skipCStyleComments_():e===B?this.skipCppStyleComments_():t.throwInvalidArgumentException("invalid token")}skipWhiteSpace_(){let e;do{this.m_eof()&&t.throwInvalidArgumentException("invalid token");let i=this.m_peekChar();for(;i>=9&&i<=13||32===i;)this.m_increment(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),i=this.m_peekChar();i===B?(this.m_startToken=this.m_endToken,e=!0,this.skipComments_()):e=!1}while(e)}rightBracket_(){return this.m_peekChar()===L&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=4,!0)}rightBrace_(){return this.m_peekChar()===q&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=3,!0)}string_(){this.m_prepSubstr(),this.m_bHasEscapes=!1,this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token");let e=this.m_peekChar();for(;e!==F;){const i=e===N;if(this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),i)if(this.m_bHasEscapes=!0,e===F||e===N||e===B||e===M||e===z||e===W||e===Q||e===$)this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar();else if(e===K)for(let i=0;i<4;i++)this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e>=J&&e<=ee||e>=D&&e<=z||e>=I&&e<=Y||t.throwInvalidArgumentException("invalid token");else t.throwInvalidArgumentException("invalid token")}this.m_stepOverChar()}comma_(){return this.m_peekChar()===V&&(this.m_increment(),!0)}colon_(){return this.m_peekChar()===G&&(this.m_increment(),!0)}fieldNameEnd_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.colon_()?(this.skipWhiteSpace_(),this.value_()):t.throwInvalidArgumentException("invalid token")}fieldNameStart_(){this.m_startToken=this.m_endToken,this.m_peekChar()!==F&&t.throwInvalidArgumentException("invalid token"),this.string_(),this.m_currentTokenType=5,this.m_functionStack.push((()=>this.fieldNameEnd_()))}pairEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.fieldNameStart_()):this.rightBrace_()?this.m_functionStack.pop():t.throwInvalidArgumentException("invalid token")}arrayStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBracket_()||(this.m_functionStack.push((()=>this.elementEnd_())),this.value_())}elementEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.value_()):this.rightBracket_()?this.m_functionStack.pop():t.throwInvalidArgumentException("invalid token")}objectStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBrace_()||(this.m_functionStack.push((()=>this.pairEnd_())),this.fieldNameStart_())}valueStartObject_(){this.m_increment(),this.m_currentTokenType=1,this.m_functionStack.push((()=>this.objectStart_()))}valueStartArray_(){this.m_increment(),this.m_currentTokenType=2,this.m_functionStack.push((()=>this.arrayStart_()))}valueString_(){this.string_(),this.m_currentTokenType=6}int_(){this.m_peekChar()!==J?this.digits_():this.m_stepOverChar()}digits_(){let e=this.m_peekChar();do{this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar()}while(e>=J&&e<=ee)}frac_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e>=J&&e<=ee||t.throwInvalidArgumentException("invalid token"),this.digits_()}exp_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e!==j&&e!==X||(this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar()),e>=J&&e<=ee||t.throwInvalidArgumentException("invalid token"),this.digits_()}valueNumber_(){this.m_prepSubstr();let e=!1,i=this.m_peekChar();if(i===X?(this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),i=this.m_peekChar(),e=!0,i>=J&&i<=ee||t.throwInvalidArgumentException("invalid token"),this.int_()):this.int_(),i=this.m_peekChar(),i===k)this.m_currentTokenType=7,this.frac_(),i=this.m_peekChar(),i!==H&&i!==U||this.exp_();else if(i===H||i===U)this.m_currentTokenType=7,this.exp_();else{let t=0;e&&t++;const i=this.m_endToken-this.m_startToken-t;if(i<10)this.m_currentTokenType=8;else if(10===i){const i=this.m_getCurrentSubstr();e?i.slice(t)<="2147483648"?this.m_currentTokenType=8:this.m_currentTokenType=9:i.slice(t)<="2147483647"?this.m_currentTokenType=8:this.m_currentTokenType=9}else if(i<19)this.m_currentTokenType=9;else if(19===i){const i=this.m_getCurrentSubstr();e?i.slice(t)<="9223372036854775808"?this.m_currentTokenType=9:this.m_currentTokenType=7:i.slice(t)<="9223372036854775807"?this.m_currentTokenType=9:this.m_currentTokenType=7}else this.m_currentTokenType=7}}valueNull_(){const{s:e,bDone:i}=this.m_get(5);i&&t.throwInvalidArgumentException("invalid token"),"null"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=10}valueTrue_(){const{s:e,bDone:i}=this.m_get(5);i&&t.throwInvalidArgumentException("invalid token"),"true"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=11}valueFalse_(){const{s:e,bDone:i}=this.m_get(6);i&&t.throwInvalidArgumentException("invalid token"),"false"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=12}valueNan_(){const{s:e,bDone:i}=this.m_get(4);i&&t.throwInvalidArgumentException("invalid token"),"NaN"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=7}value_(){this.m_startToken=this.m_endToken;const e=this.m_peekChar();e===O?this.valueStartObject_():e===R?this.valueStartArray_():e===F?this.valueString_():e===X||e>=J&&e<=J+9?this.valueNumber_():e===W?this.valueNull_():e===$?this.valueTrue_():e===z?this.valueFalse_():e===Z?this.valueNan_():t.throwInvalidArgumentException("invalid token")}start_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.m_functionStack.push((()=>this.accept_()));const e=this.m_peekChar();e!==O&&e!==R&&t.throwInvalidArgumentException("invalid token"),this.value_()}accept_(){this.m_startToken=this.m_endToken,this.m_currentTokenType=0}}const ie=new class{constructor(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject=[]}reset(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject.length=0}startObject(){const e={};this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}startArray(){const e=[];this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}endObject(){this.m_acceptedObject=this.m_currentObject.at(-1),this.m_currentObject.pop()}endArray(){this.m_currentObject.pop()}addFieldName(e){this.m_pendingKey=e}addValue_(e){this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):this.m_currentObject.at(-1).push(e)}addString(e){this.addValue_(e)}addDouble(e,t){this.addValue_(e)}addInt64(e){t.geometryReleaseAssert(0)}addInt32(e){this.addValue_(e)}addBool(e){this.addValue_(e)}addNull(){this.addValue_(null)}getObject(){return this.m_acceptedObject}},ne=new class{getOperatorType(){return 10405}accelerateGeometry(e,t,i){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,i,s,r,o,a){!function(e,i,s,r){if(i||s){if(r.startObject(),null!==i)switch(i.getGeometryType()){case t.GeometryType.enumPolygon:w(!0,e,i,r);break;case t.GeometryType.enumPolyline:w(!1,e,i,r);break;case t.GeometryType.enumMultiPoint:!function(e,i,n){const s=i.getImpl(),r=s.hasAttribute(1)&&!(2&e),o=s.hasAttribute(2)&&!(4&e),a=s.hasAttribute(3)&&!(8&e);r&&(n.addFieldName("hasZ"),n.addBool(!0)),o&&(n.addFieldName("hasM"),n.addBool(!0)),n.addFieldName("points");const l=i.getPointCount();if(i.isEmpty())n.startArray(),n.endArray();else{const t=17-(31&e>>13);n.startArray();const i=s.getAttributeStreamRef(0);let a=null,c=null;r&&(a=s.getAttributeStreamRef(1)),o&&(c=s.getAttributeStreamRef(2));for(let e=0;e<l;e++){const s=i.read(2*e),l=i.read(2*e+1);let h=Number.NaN,u=Number.NaN;r&&(h=a.read(e)),o&&(u=c.read(e)),T(r,o,s,l,h,u,t,n)}n.endArray()}if(a){let e=null;s.isEmpty()||(e=s.getAttributeStreamRef(3)),t.geometryReleaseAssert(0===l||null!==e&&e.size()>=l),n.addFieldName("ids"),n.startArray();for(let t=0;t<l;t++)n.addInt32(e.read(t));n.endArray()}}(e,i,r);break;case t.GeometryType.enumPoint:!function(e,t,i){const n=t.hasAttribute(1)&&!(2&e),s=t.hasAttribute(2)&&!(4&e),r=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return i.addFieldName("x"),i.addNull(),i.addFieldName("y"),i.addNull(),n&&(i.addFieldName("z"),i.addNull()),s&&(i.addFieldName("m"),i.addNull()),void(r&&(i.addFieldName("id"),i.addInt32(0)));const o=17-(31&e>>13);i.addFieldName("x"),i.addDouble(t.getX(),o),i.addFieldName("y"),i.addDouble(t.getY(),o),n&&(i.addFieldName("z"),i.addDouble(t.getZ(),o)),s&&(i.addFieldName("m"),i.addDouble(t.getM(),o)),r&&(i.addFieldName("id"),i.addInt32(t.getID()))}(e,i,r);break;case t.GeometryType.enumEnvelope:!function(e,t,i){const n=t.hasAttribute(1)&&!(2&e),s=t.hasAttribute(2)&&!(4&e),r=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return i.addFieldName("xmin"),i.addNull(),i.addFieldName("ymin"),i.addNull(),i.addFieldName("xmax"),i.addNull(),i.addFieldName("ymax"),i.addNull(),n&&(i.addFieldName("zmin"),i.addNull(),i.addFieldName("zmax"),i.addNull()),s&&(i.addFieldName("mmin"),i.addNull(),i.addFieldName("mmax"),i.addNull()),void(r&&(i.addFieldName("idmin"),i.addInt32(0),i.addFieldName("idmax"),i.addInt32(0)));const o=17-(31&e>>13);if(i.addFieldName("xmin"),i.addDouble(t.getXMin(),o),i.addFieldName("ymin"),i.addDouble(t.getYMin(),o),i.addFieldName("xmax"),i.addDouble(t.getXMax(),o),i.addFieldName("ymax"),i.addDouble(t.getYMax(),o),n){const e=t.queryInterval(1,0);i.addFieldName("zmin"),i.addDouble(e.vmin,o),i.addFieldName("zmax"),i.addDouble(e.vmax,o)}if(s){const e=t.queryInterval(2,0);i.addFieldName("mmin"),i.addDouble(e.vmin,o),i.addFieldName("mmax"),i.addDouble(e.vmax,o)}if(r){const e=t.queryInterval(3,0);i.addFieldName("idmin"),i.addInt32(e.vmin),i.addFieldName("idmax"),i.addInt32(e.vmax)}}(e,i,r);break;case t.GeometryType.enumMultipatch:t.geometryReleaseAssert(0);break;default:t.throwInternalErrorException("exportToJSON")}null!==s&&(r.addFieldName("spatialReference"),function(e,i,s){s.startObject();let r=0;i.isCustomWkid()||(r=i.getOldID());let o=0;const a=i.getVCS();if(null!==a&&(a.isCustomWkid()||(o=a.getOldID()),o<=0&&(r=0)),r>0){s.addFieldName("wkid"),s.addInt32(r);const e=i.getLatestID();if(e>0&&e!==r&&(s.addFieldName("latestWkid"),s.addInt32(e)),o>0){s.addFieldName("vcsWkid"),s.addInt32(o);const e=i.getLatestVerticalID();e!==o&&(s.addFieldName("latestVcsWkid"),s.addInt32(e))}}if(0===i.getCoordinateSystemType())s.addFieldName("wkid"),s.addNull(),null!==i.getUnit()&&(s.addFieldName("unit"),function(e,i,n){n.startObject();const s=i.getID();s<=0&&t.throwInvalidArgumentException("cannot export unit that has no valid WKID"),n.addFieldName("uwkid"),n.addInt32(s),n.endObject()}(0,i.getUnit(),s));else if(r<=0||1&e){let t="";64&e&&(t=i.getText2(),s.addFieldName("wkt2"),s.addString(t));const n=i.getText();n!==t&&(s.addFieldName("wkt"),s.addString(n))}if(16&e){const e=new n.SpatialReferencePrecisionDescriptor;i.queryPrecisionDescriptor(e),s.addFieldName("xyTolerance"),s.addDouble(e.getTolerance(0)),s.addFieldName("zTolerance"),s.addDouble(e.getTolerance(1)),s.addFieldName("mTolerance"),s.addDouble(e.getTolerance(2)),s.addFieldName("falseX"),s.addDouble(e.getFalseX()),s.addFieldName("falseY"),s.addDouble(e.getFalseY()),s.addFieldName("xyUnits"),s.addDouble(e.getGridUnitsXY()),s.addFieldName("falseZ"),s.addDouble(e.getFalseZ()),s.addFieldName("zUnits"),s.addDouble(e.getGridUnitsZ()),s.addFieldName("falseM"),s.addDouble(e.getFalseM()),s.addFieldName("mUnits"),s.addDouble(e.getGridUnitsM())}s.endObject()}(e,s,r)),r.endObject()}}(e,i,s,r)}exportSpatialReference(e,i,n,s){t.geometryReleaseAssert(0)}exportProjectionTransformation(e,i,n,s){t.geometryReleaseAssert(0)}exportDatumTransformation(e,i,n,s){t.geometryReleaseAssert(0)}static geometryTypeToString(e){return t.geometryReleaseAssert(0),""}},se=new class{getOperatorType(){return 10404}accelerateGeometry(e,t,i){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,i,o,a,l,c,h){let u;"string"==typeof o?(u=new te({jsonString:o}),u.nextToken()):u=o,1!==u.currentToken()&&t.throwInvalidArgumentException("failed to import map geometry: start of object is expected");const y=function(e,i,n,o,a){let l=!1,c=!1,h=!1,u=!1,y=!1,x=!1,v=!1,P=!1,b=!1,E=!1,S=!1,C=!1,w=!1,T=!1,D=!1,I=!1,A=!1,M=!1,N=!1,R=!1,O=!1,G=!1,k=!1,V=!1,F=Number.NaN,L=Number.NaN,q=Number.NaN,H=Number.NaN,U=0,z=Number.NaN,Y=Number.NaN,B=Number.NaN,X=Number.NaN,j=Number.NaN,W=Number.NaN,Z=Number.NaN,Q=Number.NaN,$=0,K=0,J=!1,ee=!1,te=null,ie=null,ne=null,se=null,re=null;for(;3!==n.nextToken();){const i=n.currentString();if(n.nextToken(),"spatialReference"===i){if(a&&!l){l=!0,1===n.currentToken()?se=m(n):10!==n.currentToken()&&t.throwInvalidArgumentException("failed to parse spatial reference: object or null is expected");continue}}else if(o)if("hasZ"===i){if(!c){c=!0,J=11===n.currentToken();continue}}else if("hasM"===i){if(!h){h=!0,ee=11===n.currentToken();continue}}else if("rings"===i){if(!(y||x||e!==t.GeometryType.enumUnknown&&e!==t.GeometryType.enumPolygon)){y=!0,({geometry:re,as:te,bs:ie}=d(!0,!1,0,n));continue}}else if("curveRings"===i){if(!x&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPolygon)){x=!0,({geometry:re,as:te,bs:ie}=d(!0,!0,0,n));continue}}else if("paths"===i){if(!(v||P||e!==t.GeometryType.enumUnknown&&e!==t.GeometryType.enumPolyline)){v=!0,({geometry:re,as:te,bs:ie}=d(!1,!1,0,n));continue}}else if("curvePaths"===i){if(!P&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPolyline)){P=!0,({geometry:re,as:te,bs:ie}=d(!1,!0,0,n));continue}}else if("points"===i){if(!b&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumMultiPoint)){b=!0,({geometry:re,as:te,bs:ie}=p(0,n));continue}}else if("ids"===i){if(!u){u=!0,ne=g(0,n);continue}}else if("x"===i){if(!E&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){E=!0,F=_(n);continue}}else if("y"===i){if(!S&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){S=!0,L=_(n);continue}}else if("z"===i){if(!C&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){C=!0,q=_(n);continue}}else if("m"===i){if(!w&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){w=!0,H=_(n);continue}}else if("id"===i){if(!T&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){T=!0,U=f(n);continue}}else if("xmin"===i){if(!D&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){D=!0,z=_(n);continue}}else if("ymin"===i){if(!I&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){I=!0,Y=_(n);continue}}else if("mmin"===i){if(!O&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){O=!0,Z=_(n);continue}}else if("zmin"===i){if(!N&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){N=!0,j=_(n);continue}}else if("idmin"===i){if(!k&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){k=!0,$=f(n);continue}}else if("xmax"===i){if(!A&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){A=!0,B=_(n);continue}}else if("ymax"===i){if(!M&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){M=!0,X=_(n);continue}}else if("mmax"===i){if(!G&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){G=!0,Q=_(n);continue}}else if("zmax"===i){if(!R&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){R=!0,W=_(n);continue}}else if("idmax"===i){if(!V&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){V=!0,K=f(n);continue}}else"materials"===i&&t.geometryReleaseAssert(0);n.skipChildren()}if(y||x||v||P||b){let e=null,i=null;const n=re;J&&(re.addAttribute(1),e=te,e||(e=s.createDoubleStream(n.getPointCount(),Number.NaN))),ee&&(re.addAttribute(2),i=J?ie:te),null!=ne&&re.addAttribute(3),J&&null!=e&&n.setAttributeStreamRef(1,e),ee&&null!=i&&n.setAttributeStreamRef(2,i),null!=ne&&function(e,i){if(e.isEmpty())return;const n=s.createAttributeStream(2,0),o=e.getGeometryType();let a=0;o===r.MultiPoint.type?a=1:o===r.Polyline.type||o===r.Polygon.type?a=e.getPathCount():t.throwInternalErrorException("not implemented"),n.resize(e.getPointCount(),0);let l=0;for(let s=0;s<a;++s){const a=i.read(l);l++;const c=l+a;let h=0,u=0;o===r.MultiPoint.type?h=e.getPointCount():o===r.Polyline.type||o===r.Polygon.type?(h=e.getPathSize(s),u=e.getPathStart(s)):t.throwInternalErrorException("not implemented");for(let e=0,t=Math.min(a,h);e<t;++e)n.write(u,i.read(l)),l++,u++;l=c}e.getImpl().setAttributeStreamRef(3,n)}(n,ne)}else if(E||S||w||C||T){s.checkNanOrFinite(F,L)||t.throwInvalidArgumentException("failed to parse point: x and y must be finite or nan"),(Number.isNaN(L)||Number.isNaN(F))&&(F=Number.NaN,L=Number.NaN);const e=new s.Point({x:F,y:L});C&&e.setZ(q),w&&e.setM(H),T&&e.setID(U),re=e}else if(D||I||A||M||N||R||O||G||k||V){(Number.isNaN(Y)||Number.isNaN(B)||Number.isNaN(X))&&(z=Number.NaN);const e=new s.Envelope({xmin:z,ymin:Y,xmax:B,ymax:X});N&&R&&e.setInterval(1,0,j,W),O&&G&&e.setInterval(2,0,Z,Q),k&&V&&e.setInterval(3,0,$,K),re=e}return{...re?{geom:re}:{},...se?{sr:se}:{}}}(i,0,u,a,l);return new n.MapGeometry(y)}importSpatialReference(e){const i=m(e);return null===i&&t.throwInternalErrorException("failed to import spatial reference"),i}importProjectionTransformation(e,i){return t.geometryReleaseAssert(0),{}}importDatumTransformation(e,i){return t.geometryReleaseAssert(0),{}}static stringToGeometryType(e){return(e=e.toLowerCase()).startsWith("esrigeometry")||t.throwInvalidArgumentException("string_to_geometry_type"),e.endsWith("point")?t.GeometryType.enumPoint:e.endsWith("envelope")?t.GeometryType.enumEnvelope:e.endsWith("multipoint")?t.GeometryType.enumMultiPoint:e.endsWith("polyline")?t.GeometryType.enumPolyline:e.endsWith("polygon")?t.GeometryType.enumPolygon:void t.throwInvalidArgumentException("string_to_geometry_type")}};function re(e,i){const n=new c(e,{strict:!1});return n.nextToken(),se.execute(0,t.GeometryType.enumUnknown,n,!0,i)}function oe(e){return re(e,!0)}function ae(e){return re(e,!1).getGeometry()}e.fromGeometries=function(e){let t=null;return[e.map((e=>{if(null==t){const i=oe(e);return t=i.getSpatialReference(),i.getGeometry()}return ae(e)})),t]},e.fromGeometry=oe,e.fromGeometryToGXGeometry=ae,e.getSpatialReference=function(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference},e.toGeometry=function(e,t){return e instanceof n.MapGeometry&&(t=e.getSpatialReference(),e=e.getGeometry()),e?.isEmpty()?null:(ie.reset(),ne.execute(0,e,t,ie),ie.getObject())},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/simplifyOperator":function(){define(["exports","../geometry/operators/gx/operatorSimplify","../geometry/operators/support/apiConverter"],(function(e,t,i){"use strict";function n(e){const n=i.getSpatialReference(e);return i.toGeometry(t.execute(i.fromGeometry(e),i.fromSpatialReference(n),!1),n)}function s(e){const n=e.map(i.fromGeometry),s=i.getSpatialReference(e);return t.executeMany(n,i.fromSpatialReference(s),!1).map((e=>i.toGeometry(e,s)))}function r(e){return t.isSimpleAsFeature(i.fromGeometry(e),i.fromSpatialReference(i.getSpatialReference(e)),!1)}const o=t.supportsCurves(),a=Object.freeze(Object.defineProperty({__proto__:null,execute:n,executeMany:s,isSimple:r,supportsCurves:o},Symbol.toStringTag,{value:"Module"}));e.execute=n,e.executeMany=s,e.isSimple=r,e.simplifyOperator=a,e.supportsCurves=o}))},"esri/geometry/operators/gx/operatorSimplify":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry","../../../chunks/MultiPathImpl","../../../chunks/ProjectionTransformation","../../../chunks/Envelope"],(function(e,t,i,n,s,r){"use strict";const o=new s.OperatorSimplify;e.execute=function(e,t,i){return o.execute(e,t,i,null)},e.executeMany=function(e,i,n){const s=o.executeMany(new t.SimpleGeometryCursor(e),i,n,null);return Array.from(s)},e.isSimpleAsFeature=function(e,t,i){return o.isSimpleAsFeature(e,t,i,null,null)},e.supportsCurves=function(){return o.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/draw/support/surfaceCoordinateSystems":function(){define(["exports","../../../core/arrayUtils","../../../core/libs/gl-matrix-2/math/mat2d","../../../core/libs/gl-matrix-2/factories/mat2df64","../../../core/libs/gl-matrix-2/math/quat","../../../core/libs/gl-matrix-2/factories/quatf64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/Point","../../../geometry/support/Axis"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";function h(e,t,i=null){return null!=i?[e,t,i]:[e,t]}function u(e,t,i=null){return null!=i?{x:e,y:t,z:i}:{x:e,y:t}}class m{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map((e=>this.mapToLocal(e))).filter(t.isSome)}get doUnnormalization(){return!1}}class d extends m{constructor(e,t,s=null){super(t),this._defaultZ=s,this.transform=n.create(),this.transformInv=n.create(),this.transform=n.clone(e),i.invert(this.transformInv,this.transform)}makeMapPoint(e,t){return h(e,t,this._defaultZ)}mapToLocal(e){return u(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return h(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}}class p extends m{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=a.create(),this.tangentFrameUpWS=a.create(),this.tangentFrameRightWS=a.create(),this.tangentFrameForwardWS=a.create(),this.localFrameRightWS=a.create(),this.localFrameUpWS=a.create(),this.worldToLocalTransform=r.create(),this.localToWorldTransform=r.create(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,c.Axis.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,c.Axis.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,c.Axis.Z,this.tangentFrameForwardWS);const n=a.create();o.scale(n,this.tangentFrameForwardWS,o.dot(i,this.tangentFrameForwardWS)),o.subtract(this.localFrameRightWS,i,n),o.normalize(this.localFrameRightWS,this.localFrameRightWS),o.cross(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),s.rotationTo(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),s.invert(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return h(e,t,this.defaultZ)}mapToLocal(e){const t=a.create();this.view.renderCoordsHelper.toRenderCoords(new l({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),o.transformQuat(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new l({spatialReference:this.view.spatialReference}));return null!=i?u(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=a.create();this.view.renderCoordsHelper.toRenderCoords(new l({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),o.transformQuat(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new l({spatialReference:this.view.spatialReference}));return null!=i?h(i.x,i.y,this.defaultZ):null}}e.AffineCoordinateSystem=d,e.SceneViewCoordinateSystem=p,e.SurfaceCoordinateSystem=m,e.createViewAlignedCoordinateSystem=function(e,t){if("2d"===e.type)return new d(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const i=t.length>2?new l({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new l({x:t[0],y:t[1],spatialReference:e.spatialReference});return new p(e,i)}return null},e.makeMapPoint=h,e.makeSurfacePoint=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["exports","./common"],(function(e,t){"use strict";function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function s(e,t,i,n,s,r,o){return e[0]=t,e[1]=i,e[2]=n,e[3]=s,e[4]=r,e[5]=o,e}function r(e,t){const i=t[0],n=t[1],s=t[2],r=t[3],o=t[4],a=t[5];let l=i*r-n*s;return l?(l=1/l,e[0]=r*l,e[1]=-n*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-r*o)*l,e[5]=(n*o-i*a)*l,e):null}function o(e){return e[0]*e[3]-e[1]*e[2]}function a(e,t,i){const n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1],u=i[2],m=i[3],d=i[4],p=i[5];return e[0]=n*c+r*h,e[1]=s*c+o*h,e[2]=n*u+r*m,e[3]=s*u+o*m,e[4]=n*d+r*p+a,e[5]=s*d+o*p+l,e}function l(e,t,i){const n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=n*h+r*c,e[1]=s*h+o*c,e[2]=n*-c+r*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function c(e,t,i){const n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=n*c,e[1]=s*c,e[2]=r*h,e[3]=o*h,e[4]=a,e[5]=l,e}function h(e,t,i){const n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=n,e[1]=s,e[2]=r,e[3]=o,e[4]=n*c+r*h+a,e[5]=s*c+o*h+l,e}function u(e,t){const i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=-i,e[3]=n,e[4]=0,e[5]=0,e}function m(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function d(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function p(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function g(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function _(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e}function f(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}function y(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e}function x(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e[3]=t[3]+i[3]*n,e[4]=t[4]+i[4]*n,e[5]=t[5]+i[5]*n,e}function v(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function P(e,i){const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=i[0],h=i[1],u=i[2],m=i[3],d=i[4],p=i[5],g=t.getEpsilon();return Math.abs(n-c)<=g*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-h)<=g*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(r-u)<=g*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-m)<=g*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-d)<=g*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(l-p)<=g*Math.max(1,Math.abs(l),Math.abs(p))}const b=a,E=f,S=Object.freeze(Object.defineProperty({__proto__:null,add:_,copy:i,determinant:o,equals:P,exactEquals:v,frob:g,fromRotation:u,fromScaling:m,fromTranslation:d,identity:n,invert:r,mul:b,multiply:a,multiplyScalar:y,multiplyScalarAndAdd:x,rotate:l,scale:c,set:s,str:p,sub:E,subtract:f,translate:h},Symbol.toStringTag,{value:"Module"}));e.add=_,e.copy=i,e.determinant=o,e.equals=P,e.exactEquals=v,e.frob=g,e.fromRotation=u,e.fromScaling=m,e.fromTranslation=d,e.identity=n,e.invert=r,e.mat2d=S,e.mul=b,e.multiply=a,e.multiplyScalar=y,e.multiplyScalarAndAdd=x,e.rotate=l,e.scale=c,e.set=s,e.str=p,e.sub=E,e.subtract=f,e.translate=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/factories/mat2df64":function(){define(["exports"],(function(e){"use strict";function t(){return[1,0,0,1,0,0]}function i(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function n(e,t,i,n,s,r){return[e,t,i,n,s,r]}const s=[1,0,0,1,0,0],r=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:s,clone:i,create:t,fromValues:n},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=s,e.clone=i,e.create=t,e.fromValues=n,e.mat2df64=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/draw/support/tooltipUtils":function(){define(["exports","../../../core/quantityUtils","../../../core/unitUtils","../../../core/accessorSupport/ensureType","../../../geometry/Point","../../../support/elevationInfoUtils","./helpMessageUtils","./helpMessageUtils3d","../../interactive/sketch/constraintUtils","../../interactive/tooltip/tooltipCommonUtils","../../interactive/tooltip/infos/DrawCircleTooltipInfo","../../interactive/tooltip/infos/DrawMeshTooltipInfo","../../interactive/tooltip/infos/DrawMultipointTooltipInfo","../../interactive/tooltip/infos/DrawPointTooltipInfo","../../interactive/tooltip/infos/DrawPolygonTooltipInfo","../../interactive/tooltip/infos/DrawPolylineTooltipInfo","../../interactive/tooltip/infos/DrawRectangleTooltipInfo","../../support/angularMeasurementUtils","../../support/euclideanLengthMeasurementUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y){"use strict";function x({geometryType:e,graphic:t,tooltipInfos:i}){return t?.geometry?.type!==v[e]?"circle"===e||"rectangle"===e?i[e]:null:i[e]}const v={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function P(e,t,i){const{drawOperation:n,view:s,sketchOptions:r}=i,{cursorVertex:o}=n;e.sketchOptions=r,e.viewType=s.type;const a="multipoint"===t?.type?t.getPoint(t.points.length-1):t;if(e.setLocationFromPoint(a,I(i)),S(e.elevation,i),!o)return void(n.constraints=void 0);const l=o;n.constraints={context:M(l,i),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}}const b=n.ensureType(s);function E(e,i){const{drawOperation:n,sketchOptions:s,view:r,automaticLengthMeasurementUtils:o}=i,{cursorVertex:a,lastVertex:l,secondToLastVertex:c}=n,h=s.values.effectiveDirectionMode;e.sketchOptions=s,e.viewType=r.type;const u=l&&a?o.autoDistanceBetweenPoints2D(b(l),b(a))??t.zeroMeters:null;if(e.distance.actual=u,e.distance.readOnly=null==l,e.direction.actual=null,e.direction.readOnly=!0,l&&a&&("absolute"===h||c)){const i=f.directionForVertices(c,l,a,h);e.direction.actual=i??t.zeroDegreesGeographic,e.direction.readOnly=!1}e.setLocationFromPoint(a,I(i)),S(e.elevation,i);const m=function(e,{sketchOptions:t}){const i=t.tooltips.xyMode;return"auto"===i?e?"direction-distance":"coordinates":i}(l,i);e.xyMode=m,e.direction.visible="direction-distance"===m,e.distance.visible="direction-distance"===m,e.effectiveX.visible="coordinates"===m,e.effectiveY.visible="coordinates"===m;const d=a??l;n.constraints=d?{context:M(d,i),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function S(e,t){const{drawOperation:i}=t,n=i?.cursorVertex??i?.lastVertex;e.actual=y.elevationFromPoint(n)??A(t),e.visible=i.hasZ,e.readOnly=!1,e.showAsZ=!0}function C(e){const i=e.createOperationGeometry?.full;return"polygon"!==i?.type?t.zeroSquareMeters:e.automaticAreaMeasurementUtils.autoArea2D(i)??t.zeroSquareMeters}function w({createOperationGeometry:e,automaticLengthMeasurementUtils:i}){const n=e?.rectangle?.midpoints;return(null!=n?i.autoDistanceBetweenPoints2D(n.left,n.right):null)??t.zeroMeters}function T({createOperationGeometry:e,automaticLengthMeasurementUtils:i}){const n=e?.rectangle?.midpoints;return(null!=n?i.autoDistanceBetweenPoints2D(n.top,n.bottom):null)??t.zeroMeters}function D(e){return e.drawOperation.elevationInfo??r.absoluteHeightElevationInfo}function I(e){return e.drawOperation.coordinateHelper.spatialReference}function A(e){const n=i.getMetersPerVerticalUnitForSR(I(e));return t.createLength(e.defaultZ*n,"meters")}function M(e,t){return l.getConstraintContext(e,t.view,I(t),D(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}e.createTooltipInfos=function(e,t){return{point:new d.DrawPointTooltipInfo({sketchOptions:t,viewType:e}),multipoint:new m.DrawMultipointTooltipInfo({sketchOptions:t,viewType:e}),polyline:new g.DrawPolylineTooltipInfo({sketchOptions:t,viewType:e}),polygon:new p.DrawPolygonTooltipInfo({sketchOptions:t,viewType:e}),mesh:new u.DrawMeshTooltipInfo({sketchOptions:t,viewType:e}),rectangle:new _.DrawRectangleTooltipInfo({sketchOptions:t}),circle:new h.DrawCircleTooltipInfo({sketchOptions:t})}},e.getActiveTooltipInfo=x,e.getConstraintZ=function(e){const{geometryType:n,tooltipInfos:s}=e;switch(n){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const r=s[n].elevation.committed;if(!r)return;return t.valueInUnit(r,"meters")/i.getMetersPerVerticalUnitForSR(I(e))}default:return}},e.initializeConstraints=function(e){const{directionOptions:t,geometryType:i,sketchOptions:n,tooltipInfos:s}=e,r=t=>{const i=D(e).mode,n=s[t].elevation;"relative-to-ground"===i||"relative-to-scene"===i||"on-the-ground"===i?n.lock(A(e)):n.unlock()};switch(i){case"polygon":case"polyline":r(i),(e=>{if(t){const i=s[e].direction;i.committed=t.angle,i.unlockOnVertexPlacement=!1,n.values.directionMode=t.mode}})(i);break;case"point":case"mesh":r(i)}},e.lockElevationOnVertexAdd=function(e,t){const{drawOperation:i,view:n}=t,s=x(t),o=D(t);if("2d"===n.type||!e||"absolute-height"!==o.mode||1!==i?.numCommittedVertices||!s||"draw-polyline"!==s.type&&"draw-polygon"!==s.type||s.elevation.locked)return;const[a,l,c]=e,h=function(e,t,i,n,s){const{view:o,drawOperation:a}=s;if("3d"!==o.type||!a)return;i??=0;const l=I(s),c=D(s),h=r.getConvertedElevationFromXYZ(o,e,t,i,l,c,n);return y.elevationFromZ(h,l)??A(s)}(a,l,c,o,t);null!=h&&s.elevation.lock(h)},e.unlockConstraintsOnVertexAddOrRemove=function(e){x(e)?.allFields.forEach((e=>{e.unlockOnVertexPlacement&&e.unlock()}))},e.updateTooltipInfo=function(e,i){switch(e?.type){case"draw-point":!function(e,t){const i=t.graphic?.geometry;"point"===i?.type&&(P(e,i,t),e.helpMessage=o.getDrawHelpMessage("point",i,t.drawOperation.drawingMode))}(e,i);break;case"draw-multipoint":!function(e,t){const i=t.graphic?.geometry;"multipoint"===i?.type&&(P(e,i,t),e.helpMessage=o.getDrawHelpMessage("multipoint",i,t.drawOperation.drawingMode))}(e,i);break;case"draw-polyline":!function(e,i){const{createOperationGeometry:n,drawOperation:s,automaticLengthMeasurementUtils:r}=i,a=null!=n?n.full:null;a&&"polyline"!==a.type||(E(e,i),e.totalLength.actual=s.lastVertex?(a?r.autoLength2D(a):null)??t.zeroMeters:null,e.helpMessage=o.getDrawHelpMessage("polyline",a,i.drawOperation.drawingMode))}(e,i);break;case"draw-polygon":!function(e,i){const{createOperationGeometry:n,drawOperation:s}=i,r=null!=n?n.full:null;r&&"polygon"!==r.type||(E(e,i),e.area.actual=s.lastVertex?(r?i.automaticAreaMeasurementUtils.autoArea2D(r):null)??t.zeroSquareMeters:null,e.helpMessage=o.getDrawHelpMessage("polygon",r,i.drawOperation.drawingMode))}(e,i);break;case"draw-rectangle":!function(e,t){e.sketchOptions=t.sketchOptions,e.xSize=w(t),e.ySize=T(t),e.area=C(t),e.helpMessage=o.getDrawHelpMessage("rectangle",t.graphic?.geometry,t.drawOperation.drawingMode)}(e,i);break;case"draw-circle":!function(e,i){const{forceUniformSize:n,sketchOptions:s}=i;e.sketchOptions=s,e.radius=n?function({createOperationGeometry:e,automaticLengthMeasurementUtils:i}){return(null!=e?.circle?.center&&null!=e.circle.edge?i.autoDistanceBetweenPoints2D(e.circle.center,e.circle.edge):null)??t.zeroMeters}(i):null,e.xSize=n?null:w(i),e.ySize=n?null:T(i),e.area=C(i),e.helpMessage=o.getDrawHelpMessage("circle",i.graphic?.geometry,i.drawOperation.drawingMode)}(e,i);break;case"draw-mesh":!function(e,t){const{graphic:i,view:n}=t,s=i?.geometry;"3d"!==n.type||s&&"mesh"!==s.type||(P(e,s?.origin,t),s&&c.updateTooltipInfoFromMeshTransform(e,s),e.helpMessage=a.getDrawMeshHelpMessage(i,n))}(e,i)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/draw/support/helpMessageUtils":function(){define(["exports"],(function(e){"use strict";e.getDrawHelpMessage=function(e,t,i){if(null==e)return"noTool";switch(e){case"point":return"point";case"multipoint":return"multipoint";case"polyline":return function(e,t){const i=null!=e&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0;return"freehand"===t?i<2?"freehandStart":"freehandEnd":i<2?"polylineZeroVertices":"polylineOneVertex"}(t,i);case"polygon":return function(e,t){const i=null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;if(i<3)switch(t){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(i<4)return"freehand"===t?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}(t,i);case"rectangle":case"circle":return function(e,t){if((null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0)<3)switch(t){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(t){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}(t,i);default:return}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/draw/support/helpMessageUtils3d":function(){define(["exports","../../../core/unitUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../support/elevationInfoUtils"],(function(e,t,i,n,s){"use strict";const r=n.create();e.getDrawMeshHelpMessage=function(e,n){const o=e?.geometry;if(!e||"mesh"!==o?.type||!n)return;const{renderCoordsHelper:a,elevationProvider:l}=n,{camera:c}=n.state,{extent:h}=o,{center:u,spatialReference:m}=h,d=t.getMetersPerUnitForSR(m),p=t.getMetersPerVerticalUnitForSR(m),g=t.getMetersPerUnitForSR(a.spatialReference),_=h.width*d,f=h.height*p,y=(h.zmax??0)*p,x=y-(h.zmin??0)*p,v=Math.max(_,f,x)/g,{x:P,y:b}=u,E=u.z??0;i.set(r,P,b,E),a.toRenderCoords(r,m,r);const S=v/c.computeScreenPixelSizeAt(r);if(S>1*c.width)return"meshTooClose";if(S<20)return"meshTooFar";const C=s.getGraphicEffectiveElevationInfo(e),{absoluteZ:w}=s.zValueInAbsoluteHeightMode(P,b,y,m,n,C);return w<(l.getElevation(P,b,E,m,"ground")??0)*p+.1*x?"meshUnderground":"mesh"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/sketch/constraintUtils":function(){define(["exports","../../../core/quantityUtils","../../../core/unitUtils","../../../chunks/vec32","../../../geometry/SpatialReference","../../../geometry/projection/projectVectorToVector","../../../geometry/support/geodesicUtils","../../../layers/graphics/dehydratedPoint","../../../support/elevationInfoUtils","./constraints","./normalizedPoint","../../support/angularMeasurementUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";function m(e,n,s){if(null==n||null==e)return;const r=i.lengthUnitFromSpatialReference(s.measurementSR);if(null==r)return;const o=y(e,s);if(null==o)return;const a=t.valueInUnit(n,r);return new c.VerticalCylinderConstraint(o,a)}function d(e,i,n,s){if(null==n||null==e)return;const r=y(e,s);if(null==r)return;const o=u.getDegreesGeographic(n),a=e=>{if(null==e)return;const i=h.createWritable(),n=t.createAngle(e,"degrees","geographic");return u.pointFromDistanceAlongAzimuth(i,r,s.measurementSR,10,n,s.mode)?new c.VerticalHalfPlaneConstraint(r,i):void 0},l=()=>{if(null!=i&&null!=e)return u.getDegreesGeographic(u.directionBetweenPoints(i,e))};switch(s.directionMode){case u.DirectionMode.Absolute:return a(o);case u.DirectionMode.Relative:{const e=l();if(null==e)return;return a(e+o)}case u.DirectionMode.RelativeBilateral:{const e=l();if(null==e)return;return c.constraintOrSet([a(e+o),a(e-o)])}}}function p(e,t){const i=x(e,t);return null!=i?new c.HorizontalPlaneConstraint(i):void 0}function g(e,i,n){const{context:s,longitude:o,latitude:a,direction:l,distance:m,elevation:d}=n;if(null!=o||null!=a||null!=m||null!=d||null!=l){if(null!=o||null!=a){const e=u.getDegreesGeographic(o),t=u.getDegreesGeographic(a),i=x(d,s);return new c.CoordinateConstraint(e,t,i)}return function(e,i,{context:n,direction:s,distance:o,elevation:a}){if(null==i)return p(a,n);const{view:l,elevationInfo:m,measurementSR:d}=n,g=h.fromPoint(i,l,m);if(!d||!r.projectVectorToVector(g,i.spatialReference,v,d))return;const[_,f]=v,y=null!=o?t.valueInUnit(o,"meters"):void 0,P=u.getDegreesGeographic(s),b=x(a,n),E=e=>{const t=new c.GeodesicConstraint([_,f],d,y,b,e);return null==y||null==e||null==b&&n.hasZ?t:new c.PointConstraint(t.closestTo(g))};if(null==P)return E(void 0);const S=()=>{if(null!=e&&null!=i)return u.getDegreesGeographic(u.directionBetweenPoints(e,i))};switch(n.directionMode){case u.DirectionMode.Absolute:return E(P);case u.DirectionMode.Relative:{const e=S();if(null==e)return;return E(e+P)}case u.DirectionMode.RelativeBilateral:{const e=S();if(null==e)return;return c.constraintOrSet([E(e+P),E(e-P)])}}}(e,i,n)}}function _({x:e,y:t,elevation:i,context:n}){E.x=e?.value??0,E.y=t?.value??0,E.spatialReference=n.spatialReference;const s=y(E,n,P);return new c.CoordinateConstraint(null!=e&&null!=s?s[0]:void 0,null!=t&&null!=s?s[1]:void 0,x(i,n))}function f(e){let t;for(const i of e)i&&(t=t?.intersect(i)??i);return t}function y(e,t,i=h.createWritable()){const{view:s,elevationInfo:o,measurementSR:a,origin:l,mode:c}=t;if(h.fromPoint(e,s,o,i),r.projectVectorToVector(i,e.spatialReference,i,a))return"geodesic"!==c&&n.subtract(i,i,l),i}function x(e,n){return function(e,{view:n,origin:s,elevationInfo:r,hasZ:o,measurementSR:a}){if(null==e||!o)return;const c=i.verticalLengthUnitFromSpatialReference(a);if(null==c)return;const[h,u]=s,m=t.valueInUnit(e,c),d="3d"===n?.type?l.getConvertedElevationFromXYZ(n,h,u,m,a,r):m;return null!=d?t.createLength(d,c):void 0}(e,n)?.value??void 0}const v=h.createWritable(),P=h.createWritable(),b=h.createWritable(),E=a.makeDehydratedPoint(0,0,0,s.WGS84);e.constraintSpaceToPoint=function(e,t,i,s){const{view:o,measurementSR:a,spatialReference:l,origin:c,mode:u}=i;if("geodesic"===u?n.copy(b,e):n.add(b,e,c),r.projectVectorToVector(b,a,b,l))return h.toElevationAlignedDehydratedPoint(b,o,t,i,s)},e.getConstraintContext=function(e,t,i,n,s,a){let l="geodesic",c=o.geodesicCompatibleSpatialReference(i);const u=h.createWritable();return h.fromPoint(e,t,n,u),u[2]=0,c&&r.projectVectorToVector(u,i,u,c)||(l="euclidean",c=i),{mode:l,view:t,elevationInfo:n,hasZ:s,directionMode:a,spatialReference:e.spatialReference,measurementSR:c,origin:u}},e.getGeodesicConstraint=g,e.getPointConstraint=function(e){return"geodesic"===e.context.mode?g(null,null,e):_(e)},e.getPolylineOrPolygonConstraint=function(e,t,i){const{context:n,x:s,y:r,distance:o,direction:a,elevation:l}=i;return"geodesic"===n.mode?g(t,e,i):null!=s||null!=r?_(i):f([m(e,o,n),d(e,t,a,n),p(l,n)])},e.intersectAll=f,e.pointToConstraintSpace=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/sketch/constraints":function(){define(["exports","../../../core/arrayUtils","../../../core/mathUtils","../../../core/libs/gl-matrix-2/math/vec2","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../chunks/vec42","../../../core/libs/gl-matrix-2/factories/vec4f64","../../../geometry/support/geodesicConstants","../../../geometry/support/geodesicUtils","../../../geometry/support/plane","../../../chunks/sphere","../../3d/support/mathUtils","./normalizedPoint","../../support/geometry3dUtils","../../support/geometry2dUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_){"use strict";class f{intersect(e){return U(this,e)}closestPoints(e){return[this.closestTo(e)]}}class y extends f{constructor(e){super(),this.point=e}equals(e){return this===e||te(e)&&r.exactEquals(this.point,e.point)}closestTo(){return p.clone(this.point)}}class x extends f{constructor(e,t,i){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:i}}equals(e){return this===e||ie(e)&&this.lineLike.type===e.lineLike.type&&r.exactEquals(this.start,e.start)&&r.exactEquals(this.end,e.end)}closestTo(e){const t=p.createWritable();return g.projectPointToLineLike(e,this.lineLike,t),t}}class v extends x{constructor(e,t){super(e,t,_.LineType.LINE)}}class P extends x{constructor(e,t){super(e,t,_.LineType.RAY)}}class b extends f{constructor(e){super(),this.constraints=e}equals(e){return this===e||ee(e)&&t.equals(this.constraints,e.constraints,((e,t)=>e.equals(t)))}closestTo(e){let t,i=1/0;for(const n of this.constraints){const s=n.closestTo(e),o=r.squaredDistance(e,s);o<i&&(i=o,t=s)}return p.clone(t??e)}closestPoints(e){return this.constraints.flatMap((t=>t===this?[]:t.closestPoints(e)))}}class E extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||re(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=p.createWritable();return g.projectPointToVerticalCylinder(e,this.center,this.radius,t),t}}class S extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||oe(e)&&r.exactEquals(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=p.createWritable();return g.projectPointToVerticalCylinder(e,this.center,this.radius,t),t[2]=this.center[2],t}asCircle(){return new C(p.clone(this.center),this.radius,p.fromValues(0,0,1))}}class C extends f{constructor(e,t,i,n=void 0){super(),this.center=e,this.radius=t,this.normal=i,this.slicePlane=n}equals(e){return this===e||ae(e)&&r.exactEquals(this.center,e.center)&&r.exactEquals(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:i}=this;u.projectPoint(this.getPlane(T),e,w);const n=r.sub(w,w,t),s=r.squaredLength(n);if(g.isClose(s,0))return p.clone(e);const o=i/Math.sqrt(s),a=p.createWritable();r.scaleAndAdd(a,t,n,o);const{slicePlane:l}=this;if(l&&!g.isPointInsidePlane(l,a)){const t=Y(l,this);return t?.closestTo(e)??p.clone(e)}return a}getPlane(e=u.create()){return u.fromPositionAndNormal(this.center,this.normal,e)}}const w=o.create(),T=u.create();class D extends f{constructor(e){super(),this.z=e}equals(e){return this===e||ne(e)&&this.z===e.z}closestTo(e){return p.fromValues(e[0],e[1],this.z)}getPlane(e=u.create()){return r.set(I,0,0,this.z),u.fromPositionAndNormal(I,o.UNIT_Z,e)}}const I=o.create();class A extends f{constructor(e,t,i){super(),this.start=e,this.end=t,this.planeLike={start:p.asVec2(e),end:p.asVec2(t),type:i}}equals(e){return this===e||se(e)&&this.planeLike.type===e.planeLike.type&&r.exactEquals(this.start,e.start)&&r.exactEquals(this.end,e.end)}closestTo(e){const t=p.createWritable();return g.projectPointToVerticalPlane(e,this.planeLike,t),t}closestEndTo(e){const{start:t,end:i}=this.planeLike;return Math.sign(n.dot(n.subtract(M,i,t),n.subtract(N,p.asVec2(e),t)))>0?this.end:this.start}getPlane(e=u.create()){const t=r.copy(R,this.end);return t[2]+=1,u.fromPoints(this.start,this.end,t,e)}getSlicePlane(e=u.create()){const{start:t,end:i,type:n}=this.planeLike;if(n===g.VerticalPlaneType.PLANE)return;const s=r.set(R,t[0],t[1],0),o=r.set(O,i[0],i[1],0),a=r.subtract(O,o,s);return u.fromPositionAndNormal(s,a,e),e}}const M=s.create(),N=s.create(),R=o.create(),O=o.create();class G extends f{constructor(e,t){super(),this.sphere=m.fromCenterAndRadius(e,t)}equals(e){return this===e||le(e)&&m.exactEquals(this.sphere,e.sphere)}closestTo(e){const t=p.createWritable();return m.projectPoint(this.sphere,e,t),t}get center(){return m.getCenter(this.sphere)}get radius(){return this.sphere[3]}}class k extends f{constructor(e,t,i){super(),this.start=e,this.end=t,this.getZ=i,this.planeLike={start:p.asVec2(e),end:p.asVec2(t),type:g.VerticalPlaneType.PLANE}}equals(e){return this===e||ce(e)&&r.exactEquals(this.start,e.start)&&r.exactEquals(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){const i=p.createWritable();return g.projectPointToVerticalPlane(t,e.planeLike,i),i[2]=e.getZ(i[0],i[1])??he,i}(this,e)}addIfOnTheGround(e,t){for(const i of t){const t=this.getZ(i[0],i[1])??0;g.isClose(i[2],t)&&(i[2]=t,e.push(i))}}}class V extends f{constructor(e,t,i){super(),this._x=e,this._y=t,this._z=i}equals(e){return this===e||e instanceof V&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,t,i]){return p.create(this._x??e,this._y??t,this._z??i)}}class F extends f{constructor(e,t,i,n,s){super(),this._origin=e,this._spatialReference=t,this._distanceMeters=i,this._z=n,this._directionDegrees=s}equals(e){return this===e||e instanceof F&&n.exactEquals(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,t,i]){return n.set(L,e,t),n.exactEquals(L,this._origin)||this._applyDirectionAndDistance(L),p.create(L[0],L[1],this._z??i)}_applyDirectionAndDistance(e){if(null!=this._directionDegrees&&null!=this._distanceMeters)h.directGeodeticSolver(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(null!=this._directionDegrees)!function(e,t,i,n,s){let{azimuth:r,distance:o}=h.inverseGeodeticSolver(H,t,n,s);r??=0;let a=o*Math.cos((r-i)*c.toRadians);a=Math.max(0,a),h.directGeodeticSolver(e,t,i,a,s)}(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(null!=this._distanceMeters){const{azimuth:t}=h.inverseGeodeticSolver(q,this._origin,e,this._spatialReference);h.directGeodeticSolver(e,this._origin,t??0,this._distanceMeters,this._spatialReference)}}}const L=[0,0],q=new h.InverseGeodeticSolverResult,H=new h.InverseGeodeticSolverResult;function U(e,t){if(ee(e)){const i=[];for(const n of e.constraints){const e=n.intersect(t);e&&i.push(e)}return J(i)}if(ee(t))return U(t,e);if(ce(e))return Z(e,t);if(ce(t))return Z(t,e);if(te(e)){const{point:i}=e;if(te(t))return r.exactEquals(i,t.point)?e:void 0;const n=t.closestTo(i);return r.equals(n,i)?e:void 0}if(ie(e)){if(te(t))return U(t,e);if(ie(t))return $(g.intersectLineLikes(e.lineLike,t.lineLike));if(ne(t))return z(e,t);if(se(t))return $(g.intersectVerticalPlaneAndLineLike(t.planeLike,e.lineLike));if(re(t))return $(g.intersectLineLikeAndVerticalCylinder(e.lineLike,t.center,t.radius));if(ae(t))return $(g.intersectLineLikeAndCircle(e.lineLike,t));if(oe(t))return function({lineLike:e},{center:t,radius:i}){const n=t[2];return $(g.intersectLineLikeAndVerticalCylinder(e,t,i).filter((e=>g.isClose(e[2],n))))}(e,t);if(le(t))return function({lineLike:e},{sphere:t}){return $(m.intersectLine(t,e.start,e.end))}(e,t)}else if(ne(e)){if(te(t)||ie(t))return U(t,e);if(ne(t))return function(e,t){return g.isClose(e.z,t.z)?e:void 0}(e,t);if(se(t))return function({z:e},{planeLike:t}){const[i,n]=t.start,[s,r]=t.end,o=p.fromValues(i,n,e),a=p.fromValues(s,r,e);return t.type===g.VerticalPlaneType.PLANE?new v(o,a):new P(o,a)}(e,t);if(re(t))return function(e,t){const[i,n]=t.center;return new S(p.fromValues(i,n,e.z),t.radius)}(e,t);if(ae(t))return B(e,t);if(oe(t))return i=e,s=t,g.isClose(s.center[2],i.z)?s:void 0;if(le(t))return function(e,{center:t,radius:i}){const n=Math.abs(t[2]-e.z);if(n>i&&!g.isClose(n,i))return;const s=p.fromValues(t[0],t[1],e.z),r=Math.sqrt(i**2-n**2);return g.isClose(r,0)?void 0:new S(s,r)}(e,t)}else if(se(e)){if(te(t)||ie(t)||ne(t))return U(t,e);if(se(t))return Q(g.intersectVerticalPlanes(e.planeLike,t.planeLike));if(re(t))return Q(g.intersectVerticalPlaneAndVerticalCylinder(e.planeLike,t.center,t.radius));if(ae(t))return j(e,t);if(oe(t))return X(e,t);if(le(t))return W(e,t)}else if(re(e)){if(te(t)||ie(t)||ne(t)||se(t))return U(t,e);if(re(t))return Q(g.intersectVerticalCylinders(p.asVec2(e.center),e.radius,p.asVec2(t.center),t.radius));if(ae(t))return;if(oe(t))return function(e,t){const i=n.squaredDistance(p.asVec2(e.center),p.asVec2(t.center));return g.isClose(i,0)&&g.isClose(e.radius,t.radius)?t:K(g.intersectVerticalCylinders(p.asVec2(e.center),e.radius,p.asVec2(t.center),t.radius),t.center[2])}(e,t);if(le(t))return}else if(ae(e)){if(te(t)||ie(t)||ne(t)||se(t)||re(t))return U(t,e);if(ae(t))return;if(oe(t))return void t.asCircle();if(le(t))return}else if(oe(e)){if(te(t)||ie(t)||ne(t)||se(t)||re(t)||ae(t))return U(t,e);if(oe(t))return function(e,t){if(!g.vectorsHaveCloseZ(e.center,t.center))return;const i=n.squaredDistance(p.asVec2(e.center),p.asVec2(t.center));return g.isClose(i,0)&&g.isClose(e.radius,t.radius)?e:K(g.intersectVerticalCylinders(p.asVec2(e.center),e.radius,p.asVec2(t.center),t.radius),e.center[2])}(t,e);if(le(t))return}else if(le(e)){if(te(t)||ie(t)||ne(t)||se(t)||re(t)||oe(t))return U(t,e);if(le(t))return}var i,s}const z=(()=>{const e=u.create();return(t,i)=>{const{start:n,end:s}=t;if(g.vectorsHaveCloseZ(n,s)&&g.isClose(n[2],i.z))return t;const r=p.createWritable();return u.intersectLine(i.getPlane(e),n,s,r)?new y(r):void 0}})(),Y=(()=>{const e=l.create(),t=o.create(),n=o.create();return(s,l,c)=>{const{normal:h,center:m,radius:_}=l;d.tangentFrame(h,t,n);const f=u.getNormal(s),x=_*r.dot(f,t),v=_*r.dot(f,n);a.set(e,m[0],m[1],m[2],1);const P=a.dot(s,e),b=Math.hypot(x,v),E=g.isClose(b,0);if(g.isClose(u.distance(s,m),0)){if(E)return l;if(g.isClose(_,0))return!c||g.isPointInsidePlane(c,m)?new y(p.clone(m)):void 0;r.cross(t,f,h),r.normalize(t,t);const e=new Array,i=o.clone(m);r.scaleAndAdd(i,i,t,_),c&&!g.isPointInsidePlane(c,i)||e.push(i);const n=o.clone(m);return r.scaleAndAdd(n,n,t,-_),c&&!g.isPointInsidePlane(c,n)||e.push(n),$(e)}if(E)return;const S=-P/b;if(Math.abs(S)>1||g.isClose(S,1))return;const C=Math.atan(x/v),w=i.asinClamped(S)-C,T=Math.PI-w,D=new Array,I=o.create();r.scaleAndAdd(I,m,t,_*Math.cos(w)),r.scaleAndAdd(I,I,n,_*Math.sin(w)),D.push(I);const A=o.create();return r.scaleAndAdd(A,m,t,_*Math.cos(T)),r.scaleAndAdd(A,A,n,_*Math.sin(T)),D.push(A),$(c?g.pointsInsidePlane(c,D):D)}})(),B=(()=>{const e=u.create();return(t,i)=>Y(t.getPlane(e),i,i.slicePlane)})(),X=(()=>{const e=u.create();return(t,{center:i,radius:n})=>{const s=g.intersectVerticalPlaneAndVerticalCylinder(t.planeLike,i,n),r=i[2];t.getSlicePlane(e);const o=new Array;for(const[t,i]of s){const n=[t,i,r];g.isPointInsidePlane(e,n)&&o.push(n)}return $(o)}})(),j=(()=>{const e=u.create(),t=u.create();return(i,n)=>Y(i.getPlane(e),n,i.getSlicePlane(t))})(),W=(()=>{const e=u.create();return(t,{center:i,radius:n})=>{const s=t.getPlane(e),a=u.signedDistance(s,i),l=Math.abs(a);if(l>n&&!g.isClose(l,n))return;const c=Math.sqrt(n**2-a**2);if(g.isClose(c,0)){const e=p.createWritable();return u.projectPoint(s,i,e),new y(e)}const h=p.createWritable(),m=o.clone(u.getNormal(s));return r.scaleAndAdd(h,i,m,a),new C(h,c,m,t.getSlicePlane())}})();function Z(e,t){const{planeLike:i,getZ:n}=e,s=new Array;if(te(t))e.addIfOnTheGround(s,g.intersectVerticalPlaneAndPoint(i,t.point));else if(ie(t))e.addIfOnTheGround(s,g.intersectVerticalPlaneAndLineLike(i,t.lineLike));else if(re(t))for(const[e,r]of g.intersectVerticalPlaneAndVerticalCylinder(i,t.center,t.radius)){const t=n(e,r);null!=t&&s.push(o.fromValues(e,r,t))}else if(se(t)||ce(t))for(const[e,r]of g.intersectVerticalPlanes(i,t.planeLike)){const t=n(e,r)??he;s.push(o.fromValues(e,r,t))}return $(s)}function Q(e){return J(e.map((([e,t])=>{const i=p.fromValues(e,t,0),n=p.fromValues(e,t,1);return new v(i,n)})))}function $(e){return J(e.map((e=>e?new y(p.fromVec3(e)):void 0)))}function K(e,t){return $(e.map((([e,i])=>[e,i,t])))}function J(e){if(0!==e.length)return 1===e.length?e[0]??void 0:new b(e.filter(t.isSome))}function ee(e){return e instanceof b}function te(e){return e instanceof y}function ie(e){return e instanceof x}function ne(e){return e instanceof D}function se(e){return e instanceof A}function re(e){return e instanceof E}function oe(e){return e instanceof S}function ae(e){return e instanceof C}function le(e){return e instanceof G}function ce(e){return e instanceof k}const he=0;e.CircleConstraint=C,e.Constraint=f,e.CoordinateConstraint=V,e.DrapedLineConstraint=k,e.GeodesicConstraint=F,e.HorizontalCircleConstraint=S,e.HorizontalPlaneConstraint=D,e.LineConstraint=v,e.LineLikeConstraint=x,e.PointConstraint=y,e.RayConstraint=P,e.SetConstraint=b,e.SphereConstraint=G,e.VerticalCylinderConstraint=E,e.VerticalHalfPlaneConstraint=class extends A{constructor(e,t){super(e,t,g.VerticalPlaneType.HALF_PLANE)}},e.VerticalPlaneConstraint=class extends A{constructor(e,t){super(e,t,g.VerticalPlaneType.PLANE)}},e.VerticalPlaneLikeConstraint=A,e.constraintOrSet=J,e.isPoint=te,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/geometry3dUtils":function(){define(["exports","../../core/mathUtils","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../core/libs/gl-matrix-2/math/common","../../geometry/support/plane","../3d/support/mathUtils","./geometry2dUtils"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";function h(e,{start:t,end:i,type:n},o=r.create()){const a=s.sub(b,e,t),l=s.sub(E,i,t),h=s.dot(a,l)/s.dot(l,l);return s.scaleAndAdd(o,t,l,n===c.LineType.RAY?Math.max(h,0):h)}function u({start:e,end:t,type:i},n){const r=s.sub(b,n,e),a=s.sub(E,t,e);if(i===c.LineType.RAY&&s.dot(a,r)<-o.getEpsilon())return s.distance(e,n);const l=s.cross(S,a,r);return s.len(l)/s.len(a)}const m=(()=>{const e=r.create(),t=r.create(),o=r.create();return({start:h,end:u},{center:m,radius:d,normal:p,slicePlane:g})=>{const y=a.fromPositionAndNormal(m,p,I);if(_(a.distance(y,h),0)&&_(a.distance(y,u),0)){l.tangentFrame(p,e,t);const a=(n,r)=>(s.subtract(o,r,m),i.set(n,s.dot(o,e),s.dot(o,t)),n),_=c.intersectLineLikeAndCircle({start:a(v,h),end:a(P,u),type:c.LineType.LINE},n.ZEROS,d),y=[];for(const[i,n]of _){const o=s.copy(r.create(),m);s.scaleAndAdd(o,o,e,i),s.scaleAndAdd(o,o,t,n),g&&!f(g,o)||y.push(o)}return y}const x=r.create();return a.intersectLine(y,h,u,x)?!_(s.distance(x,m),d)||g&&!f(g,x)?[]:[x]:[]}})();function d(e,t){const i=e.start,n=e.end,a=t.start,l=t.end,h=s.sub(b,n,i),u=s.sub(E,l,a),m=s.sub(S,a,i),d=s.cross(C,h,u);if(!_(s.dot(m,d),0))return[];const p=s.sqrLen(d);if(_(p,0))return[];const g=s.cross(w,m,u),f=s.dot(g,d)/p,y=s.scaleAndAdd(T,i,h,f);if(e.type===c.LineType.RAY){const e=s.sub(D,y,i);if(s.dot(h,e)<-o.getEpsilon())return[]}if(t.type===c.LineType.RAY){const e=s.sub(D,y,a);if(s.dot(u,e)<-o.getEpsilon())return[]}return[r.clone(y)]}function p({start:e,end:t,type:i},n){const a=s.sub(b,n,e),l=s.sub(E,t,e),h=s.cross(S,l,a),u=s.sqrLen(h)/s.sqrLen(l),m=o.getEpsilon();if(u<m)switch(i){case c.LineType.LINE:return[r.clone(n)];case c.LineType.RAY:return s.dot(l,a)<-m?[]:[r.clone(n)]}return[]}function g(e,t,{start:i,end:n,type:r}){return s.set(e.start,i[0],i[1],t),s.set(e.end,n[0],n[1],t),e.type=x[r],e}function _(e,i){return t.floatEqualAbsolute(Math.abs(e-i),0,o.getEpsilon())}function f(e,t){return a.isPointInside(e,t)}var y;e.VerticalPlaneType=void 0,(y=e.VerticalPlaneType||(e.VerticalPlaneType={}))[y.PLANE=0]="PLANE",y[y.HALF_PLANE=1]="HALF_PLANE";const x={[e.VerticalPlaneType.PLANE]:c.LineType.LINE,[e.VerticalPlaneType.HALF_PLANE]:c.LineType.RAY},v=n.create(),P=n.create(),b=r.create(),E=r.create(),S=r.create(),C=r.create(),w=r.create(),T=r.create(),D=r.create(),I=a.create(),A={start:r.create(),end:r.create(),type:c.LineType.LINE},M={start:r.create(),end:r.create(),type:c.LineType.LINE};Object.defineProperty(e,"LineType",{enumerable:!0,get:()=>c.LineType}),e.intersectLineAndPoint=p,e.intersectLineLikeAndCircle=m,e.intersectLineLikeAndVerticalCylinder=function({start:e,end:t,type:n},o,a){const l=[],h=s.subtract(b,t,e),u=i.subtract(P,e,o),m=i.squaredLength(h),d=2*i.dot(h,u),p=d*d-4*m*(i.squaredLength(u)-a*a);if(0===p){const t=-d/(2*m);(n===c.LineType.LINE||t>=0)&&l.push(s.scaleAndAdd(r.create(),e,h,t))}else if(p>0){const t=Math.sqrt(p),i=(-d+t)/(2*m);(n===c.LineType.LINE||i>=0)&&l.push(s.scaleAndAdd(r.create(),e,h,i));const o=(-d-t)/(2*m);(n===c.LineType.LINE||o>=0)&&l.push(s.scaleAndAdd(r.create(),e,h,o))}return l},e.intersectLineLikes=d,e.intersectVerticalCylinderAndPoint=function(e,t,n){return _(i.squaredDistance(n,e),t*t)?[r.clone(n)]:[]},e.intersectVerticalCylinders=function(e,t,s,r){const[o,a]=e,[l,c]=s,h=l-o,u=c-a,m=h*h+u*u,d=Math.sqrt(m);if(d>t+r)return[];if(d<Math.abs(t-r))return[];if(_(d,0)&&_(t,r))return[];const p=(t*t-r*r+m)/(2*d),g=Math.sqrt(t*t-p*p),f=g*u/d,y=g*h/d,[x,P]=i.lerp(v,e,s,p/d);return _(f,y)?[n.fromValues(x,P)]:[n.fromValues(x+f,P-y),n.fromValues(x-f,P+y)]},e.intersectVerticalPlaneAndLineLike=function(t,n){const a=t.start,l=t.end,h=i.subtract(v,l,a),u=s.set(E,-h[1],h[0],0),m=n.start,d=n.end,p=s.sub(S,d,m),g=s.dot(p,u),_=s.set(C,a[0],a[1],0),f=s.sub(w,_,m),y=s.dot(f,u),x=o.getEpsilon();if(Math.abs(g)<x)return Math.abs(y),[];const b=y/g,I=s.scaleAndAdd(T,m,p,b);if(n.type===c.LineType.RAY){const e=s.sub(D,I,m);if(s.dot(e,p)<-x)return[]}if(t.type===e.VerticalPlaneType.HALF_PLANE){const e=i.sub(P,I,a);if(i.dot(e,h)<-x)return[]}return[r.clone(I)]},e.intersectVerticalPlaneAndPoint=function(e,t){return p(g(A,t[2],e),t)},e.intersectVerticalPlaneAndVerticalCylinder=function({start:t,end:s,type:r},o,a){const l=[],c=i.subtract(v,s,t),h=i.subtract(P,t,o),u=i.squaredLength(c),m=2*i.dot(c,h),d=m*m-4*u*(i.squaredLength(h)-a*a);if(0===d){const s=-m/(2*u);(r===e.VerticalPlaneType.PLANE||s>=0)&&l.push(i.scaleAndAdd(n.create(),t,c,s))}else if(d>0){const s=Math.sqrt(d),o=(-m+s)/(2*u);(r===e.VerticalPlaneType.PLANE||o>=0)&&l.push(i.scaleAndAdd(n.create(),t,c,o));const a=(-m-s)/(2*u);(r===e.VerticalPlaneType.PLANE||a>=0)&&l.push(i.scaleAndAdd(n.create(),t,c,a))}return l},e.intersectVerticalPlanes=function(e,t){return d(g(A,0,e),g(M,0,t)).map((([e,t])=>n.fromValues(e,t)))},e.isClose=_,e.isPointInsidePlane=f,e.pointToLineLikeDistance=u,e.pointToVerticalCylinderDistance=function(e,t,n){return i.distance(e,t)-n},e.pointToVerticalPlaneDistance=function(e,t){return u(g(A,e[2],t),e)},e.pointsInsidePlane=function(e,t){return t.filter((t=>f(e,t)))},e.projectPointToLineLike=h,e.projectPointToVerticalCylinder=function(e,t,n,s=r.create()){const o=i.subtract(v,e,t),a=i.length(o),l=0===a?1:n/a;return i.scaleAndAdd(s,t,o,l),s[2]=e[2],s},e.projectPointToVerticalPlane=function(e,t,i){return h(e,g(A,e[2],t),i)},e.vectorsHaveCloseZ=function(e,t){return _(e[2],t[2])},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/geometry2dUtils":function(){define(["exports","../../core/mathUtils","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64"],(function(e,t,i,n){"use strict";function s(e,t){return e[0]*t[1]-e[1]*t[0]}function r(e,t,n){const s=i.dot(n,t)/i.squaredLength(n);return i.scale(e,n,s)}function o(e,t,n,s,o=n){return i.subtract(c,s,n),i.subtract(u,t,o),r(m,u,c),i.add(e,o,m)}function a(e,t,n,s){i.subtract(c,t,n);const r=s/i.length(c);return i.scaleAndAdd(e,n,c,r)}var l;e.LineType=void 0,(l=e.LineType||(e.LineType={}))[l.RAY=0]="RAY",l[l.LINE=1]="LINE";const c=n.create(),h=n.create(),u=n.create(),m=n.create();e.cross=s,e.intersectCircleAndPoint=function(e,i,s){return a(u,s,e,i),t.floatEqualAbsolute(u[0],s[0])&&t.floatEqualAbsolute(u[1],s[1])?[n.clone(s)]:[]},e.intersectLineAndPoint=function(e,i){return o(u,i,e.start,e.end),t.floatEqualAbsolute(u[0],i[0])&&t.floatEqualAbsolute(u[1],i[1])?[n.clone(i)]:[]},e.intersectLineAndRay=function(t,n){const r=t.start,o=t.end,a=n.start,l=n.end,d=i.subtract(c,o,r),p=i.subtract(h,l,a),g=s(d,p);if(Math.abs(g)<=1e-6)return[];const _=i.subtract(u,r,a),f=s(p,_)/g,y=s(d,_)/g;if(f>=0){if(y>=0||n.type===e.LineType.LINE)return[i.scaleAndAdd(m,r,d,f)]}else if(t.type===e.LineType.LINE&&(y>=0||n.type===e.LineType.LINE))return[i.scaleAndAdd(m,r,d,f)];return[]},e.intersectLineLikeAndCircle=function(t,n,s){const r=[],o=i.subtract(c,t.end,t.start),a=i.subtract(h,t.start,n),l=i.squaredLength(o),d=2*i.dot(o,a),p=d*d-4*l*(i.squaredLength(a)-s*s);if(0===p){const n=-d/(2*l);(t.type===e.LineType.LINE||n>=0)&&r.push(i.scaleAndAdd(m,t.start,o,n))}else if(p>0){const n=Math.sqrt(p),s=(-d+n)/(2*l);(t.type===e.LineType.LINE||s>=0)&&r.push(i.scaleAndAdd(m,t.start,o,s));const a=(-d-n)/(2*l);(t.type===e.LineType.LINE||a>=0)&&r.push(i.scaleAndAdd(u,t.start,o,a))}return r},e.pointToLineDistance=function(e,t,n){const s=(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0]);return Math.abs(s)/i.distance(t,n)},e.projectPoint=r,e.projectPointToCircle=a,e.projectPointToLine=o,e.projectPointToRay=function(e,t,n,s){i.subtract(c,s,n),i.subtract(u,t,n);const r=i.dot(c,u)/i.squaredLength(c);return r>0?i.scaleAndAdd(e,n,c,r):i.copy(e,n)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/angularMeasurementUtils":function(){define(["exports","../../core/Cyclical","../../core/quantityUtils","../../core/unitUtils","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/projection/projectVectorToVector","../../geometry/support/geodesicUtils","../../geometry/support/spatialReferenceUtils"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";var u;function m(e,t){if(null==e||null==t)return;const n=d(e,t);return null!=n?i.createAngle(n,"radians","geographic"):void 0}e.DirectionMode=void 0,(u=e.DirectionMode||(e.DirectionMode={})).Absolute="absolute",u.Relative="relative",u.RelativeBilateral="relative-bilateral";const d=(()=>{const e=a.create(),t=a.create();return(i,n)=>(o.set(e,i.x,i.y,i.z??0),o.set(t,n.x,n.y,n.z??0),p(e,t,i.spatialReference,n.spatialReference))})(),p=(()=>{const e=r.create(),t=a.create(),i=a.create();return(a,u,m,d)=>{if(o.exactEquals(a,u))return;const p=c.geodesicCompatibleSpatialReference(m),g=c.geodesicCompatibleSpatialReference(d);if(p&&g&&h.equals(p,g)&&l.projectVectorToVector(a,m,t,p)&&l.projectVectorToVector(u,d,i,g)){const{azimuth:e}=c.inverseGeodeticSolver(P,t,i,p);return null!=e?n.convertUnit(e,"degrees","radians"):void 0}e[0]=u[0]-a[0],e[1]=u[1]-a[1];let _=s.angle(r.UNIT_Y,e);return e[0]<0&&(_=b-_),_}})();function g(e,t,n){if(!e||!t||!n)return;const s=d(e,t),r=d(t,n);return null!=s&&null!=r?i.createAngle(r-s,"radians","geographic"):void 0}function _(t,n){if(null!=t)switch(n){case e.DirectionMode.Absolute:return f(t);case e.DirectionMode.Relative:{const e=x(t);let n=S.normalize(e,0,!0);return-180===n&&(n=180),i.createAngle(n,"degrees","geographic")}case e.DirectionMode.RelativeBilateral:{const e=x(t),n=Math.abs(S.normalize(e,0,!0));return i.createAngle(n,"degrees","geographic")}}}function f(e){const t=x(e),n=E.normalize(t,0,!0);return i.createAngle(n,"degrees","geographic")}const y=(()=>{const e=a.create();return(t,s,r,a,h,u="geodesic")=>{o.copy(e,s);const m=x(h);if("geodesic"===u){const i=c.geodesicCompatibleSpatialReference(r);if(i&&l.projectVectorToVector(e,r,e,i))return c.directGeodeticSolver(t,e,m,a,i),t[2]=s[2],!!l.projectVectorToVector(t,i,t,r)}const d=i.convertRotationType(m,"geographic","arithmetic"),p=n.convertUnit(d,"degrees","radians"),g=s[0]+a*Math.cos(p),_=s[1]+a*Math.sin(p),f=s[2];return o.set(t,g,_,f),!0}})();function x(e){if(null!=e)return i.convertRotationType(v(e),e.rotationType,"geographic")}function v(e){return n.convertUnit(e.value,e.unit,"degrees")}const P=new c.InverseGeodeticSolverResult,b=2*Math.PI,E=t.cyclicalDegrees,S=new t.Cyclical(-180,180);e.convertAngle=function(e,t,s){let r=n.convertUnit(e.value,e.unit,"degrees");return r=i.convertRotationType(r,e.rotationType,s),r=n.convertUnit(r,"degrees",t),i.createAngle(r,t,s)},e.directionBetweenPoints=m,e.directionForVertices=function(t,i,n,s=e.DirectionMode.Absolute){if(i&&n)switch(s){case e.DirectionMode.Absolute:return m(i,n);case e.DirectionMode.Relative:return _(g(t,i,n),e.DirectionMode.Relative);case e.DirectionMode.RelativeBilateral:return _(g(t,i,n),e.DirectionMode.RelativeBilateral)}},e.getDegreesArithmetic=function(e){if(null!=e)return i.convertRotationType(v(e),e.rotationType,"arithmetic")},e.getDegreesGeographic=x,e.getNormalizedDirection=_,e.getNormalizedGeographicOrientation=f,e.pointFromDistanceAlongAzimuth=y,e.radiansGeographicBetweenVec=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/tooltipCommonUtils":function(){define(["exports","../../../core/asyncUtils","../../../core/handleUtils","../../../core/mathUtils","../../../core/quantityUtils","../../../core/reactiveUtils","../../../core/unitUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/coordinateFormatter","../../../geometry/support/MeshTransform","../../../geometry/support/meshVertexSpaceUtils","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils","../keybindings","../Tooltip","./fields/parsingAndFormattingUtils","../../support/angularMeasurementUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f){"use strict";const y=[0,0];function x(e){return a.equals(e,l.UNIT_Z)?1:a.equals(e,v)?-1:null}const v=a.negate(l.create(),l.UNIT_Z);function P(e){return e?Math.max(...e.scale):1}function b(e,t,i){if(!t||!("geographic"in t))return;const n=e.clipboardData?.getData("text");if(!n)return;const s=t=>{e.stopPropagation(),e.preventDefault(),i?.onBeforePaste(),t(),i?.onAfterPaste()};if(t.geographic){const e=_.parseLatitudeLongitude(n);e&&s((()=>{t.longitude.applyValue(e.longitude),t.latitude.applyValue(e.latitude)}))}else{const e=_.parseXY(n);e&&s((()=>{t.x.applyValue(e.x),t.y.applyValue(e.y)}))}}e.connectPasteEvent=function(e,n){let s=null;return i.handlesGroup([e.on("paste",(async i=>{s?.abort(),s=t.createTask((async()=>{c.isLoaded()||await c.load(),b(i,e.info,n)}))})),t.createTask((()=>c.load())),i.makeHandle((()=>s?.abort()))])},e.enterInputModeIfAvailable=function(e,t){return!("key-down"!==e.type||e.key!==p.tooltipKeys.enterInputMode||!t||!function(e){const t=e?.sketchOptions;if(!t)return!1;const{inputEnabled:i,visibleElements:n}=t.tooltips;return i&&!0===e.editableFields.some((({name:e})=>"x"===e||"y"===e?n.coordinates:n[e]))}(t.info)||(t.enterInputMode(),e.preventDefault(),e.stopPropagation(),0))},e.getXYZDeltasFromTooltipInfo=function(e,t){const{x:i,y:r,z:a}=t,{x:l,y:c,z:h}=function(e,t){let i,n;e.geographic?(i=f.getDegreesGeographic(e.longitude.actual),n=f.getDegreesGeographic(e.latitude.actual),m.isWebMercator(t)&&(null!=i&&null!=n?[i,n]=d.lngLatToXY(i,n,y):null!=i?i=d.lngLatToXY(i,0,y)[0]:null!=n&&(n=d.lngLatToXY(0,n,y)[1]))):(i=e.x.actual?.value,n=e.y.actual?.value);const r=e.elevation.actual,a=o.verticalLengthUnitFromSpatialReference(t);return{x:i,y:n,z:null!=a&&null!=r?s.valueInUnit(r,a):void 0}}(e,t.spatialReference);return{dx:null==l||n.floatEqualUlp(l,i)?0:l-i,dy:null==c||n.floatEqualUlp(c,r)?0:c-r,dz:null==h||null==a||n.floatEqualUlp(h,a)?0:h-a}},e.makeTooltip=function(e){const t=new g(e());return t.addHandles(r.watch((()=>e()),(({view:e,options:i,info:n})=>{t.view=e,void 0!==i&&(t.options=i),void 0!==n&&(t.info=n)}))),t},e.pasteLocation=b,e.updateMeshTransformFromTooltipInfo=function(e,t,i){if(!t||!u.isRelativeVertexSpace(t.vertexSpace))return;const n=t.transform??=new h;!function(e,t,i){const n=f.getDegreesArithmetic(e.orientation.actual),s=x(t.rotationAxis);if(null==n||null==s)return;const r=t.rotationAngle,o=n*s,a=(n-r)*s;r!==o&&(i?.onRotateStart(0),t.rotationAngle=o,i?.onRotate(a),i?.onRotateStop(a))}(e,n,i),function(e,t,i){const n=e.scale.actual?.value,s=P(t);if(null==n||n===s)return;const{scale:r}=t;let o;if(0===s)o=l.clone(l.ONES);else{const e=n/s;o=a.scale(l.create(),r,e)}i?.onScaleStart(r[0],r[1],r[2]),t.scale=o,i?.onScale(o[0],o[1],o[2]),i?.onScaleStop(o[0],o[1],o[2])}(e,n,i)},e.updateTooltipInfoFromMeshTransform=function(e,t){const i=u.isRelativeVertexSpace(t.vertexSpace),{scale:n,orientation:r}=e,{transform:o}=t,a=function(e){if(!e)return 0;const t=x(e.rotationAxis);return null!=t?t*e.rotationAngle:null}(o);i&&null!=a?(r.actual=s.createAngle(a,"degrees","arithmetic"),r.visible=!0):(r.actual=null,r.visible=!1),i?(n.actual=s.createScalar(P(o)),n.visible=!0):(n.actual=null,n.visible=!1)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/Tooltip":function(){define(["exports","../../chunks/tslib.es6","../../core/Evented","../../core/events","../../core/maybe","../../core/reactiveUtils","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../support/modeUtils","./tooltip/css","./tooltip/content/tooltipContentFactory","../../widgets/support/widgetUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g){"use strict";const _={base:`${d.base}`,ltr:`${d.base}--ltr`,rtl:`${d.base}--rtl`,debug:`${d.base}--debug`};e.default=class extends i.EventedAccessor{constructor(e){super(e),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:e}=this;this.addHandles([r.watch((()=>this.view.overlay?.surface),(t=>{e.remove(),t?.appendChild(e),this._rtl=g.isRTL(t)}),r.syncAndInitial),r.watch((()=>this.info),((t,i)=>{if(null!=this.content&&null!=t&&null!=i&&t.type===i.type)this.content.info=t;else{s.destroyMaybe(this.content);const i=p.tooltipContentFactory(this,t);i?(this.content=i,i.container&&e.appendChild(i.container),this.exitInputMode()):this.content=null}}),r.syncAndInitial),r.watch((()=>({container:this.outerContainer,style:this._outerContainerStyle})),(({container:e,style:t})=>{Object.assign(e.style,t)}),r.initial),r.watch((()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug})),(({outerContainer:e,placement:t,effectiveOffset:i,rtl:n,debug:s})=>{const{classList:r}=e;r.add(_.base),r.toggle(_.rtl,n),r.toggle(_.ltr,!n),r.toggle(_.debug,s),this.outerContainer.style.setProperty("--offset",`${i}px`),m.setCalciteModeClass(e),function({classList:e},t){f.forEach((t=>e.remove(t))),e.add(y(t))}(e,t)}),r.initial),r.when((()=>"feedback"===this.mode),(()=>{this.position=null,this._clearOverride("effectivePlacement")}),r.sync),n.on(this.outerContainer,"paste",(e=>{this.emit("paste",e)})),n.on(this.outerContainer,["focusin","focusout"],(()=>{this._focused=this.content?.container?.contains(document.activeElement)??!1}))])}destroy(){this.info=null,this.content=s.destroyMaybe(this.content),this.outerContainer.remove()}get mode(){return this.content?.mode??"feedback"}get focused(){return this._focused}get visible(){return"none"!==this._outerContainerStyle.display}get contentContainer(){return this.content?.container}get effectivePlacement(){const e=this.options?.placement;return"auto"===e?"bottom-end":e??"bottom-end"}get _screenPoint(){const{inputManager:e}=this.view;return e?.multiTouchActive?null:e?.latestPointerLocation}get _effectiveOffset(){return this.options?.offset??20}get _outerContainerStyle(){const e=this.position??this._screenPoint;return this._lastPosition=o.cloneScreenPoint(e),null!=e&&null!=this.content?{display:"block",transform:`translate(${Math.round(e.x)}px, ${Math.round(e.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(e){const t=this.position??this._lastPosition??this._screenPoint,i=this.position=o.cloneScreenPoint(t),{effectivePlacement:n}=this;this._override("effectivePlacement",n),await(this.content?.enterInputMode(e,(()=>{i&&(this.position=function(e,t,i,n){if(!e||!n.container)return t;const s=e.getBoundingClientRect(),{left:r,top:a}=n.container.getBoundingClientRect();let{x:l,y:c}=t;const h=s.left-r-i;h<0&&(l-=h);const u=s.right-r+i-n.width;u>0&&(l-=u);const m=s.top-a-i;m<0&&(c-=m);const d=s.bottom-a+i-n.height;return d>0&&(c-=d),o.createScreenPoint(l,c)}(this.contentContainer,i,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))})))}async exitInputMode(e){await(this.content?.exitInputMode(e))}onDragStart(e,t){this._prevXY=[e,t]}onDrag(e,t){const i=e-this._prevXY[0],n=t-this._prevXY[1];this._prevXY=[e,t];const{position:s}=this;if(s){const{view:r}=this,a=e-r.position[0],l=t-r.position[1];if(a<0||a>r.width||l<0||l>r.height-16)return;this.position=o.createScreenPoint(s.x+i,s.y+n)}}onDragEnd(){this._prevXY=[0,0]}},t.__decorate([a.property({nonNullable:!0})],e.default.prototype,"view",void 0),t.__decorate([a.property()],e.default.prototype,"info",void 0),t.__decorate([a.property()],e.default.prototype,"options",void 0),t.__decorate([a.property()],e.default.prototype,"position",void 0),t.__decorate([a.property()],e.default.prototype,"content",void 0),t.__decorate([a.property({readOnly:!0})],e.default.prototype,"mode",null),t.__decorate([a.property()],e.default.prototype,"_focused",void 0),t.__decorate([a.property({readOnly:!0})],e.default.prototype,"focused",null),t.__decorate([a.property({readOnly:!0})],e.default.prototype,"outerContainer",void 0),t.__decorate([a.property({readOnly:!0})],e.default.prototype,"contentContainer",null),t.__decorate([a.property({readOnly:!0})],e.default.prototype,"effectivePlacement",null),t.__decorate([a.property()],e.default.prototype,"debug",void 0),t.__decorate([a.property()],e.default.prototype,"_lastPosition",void 0),t.__decorate([a.property()],e.default.prototype,"_screenPoint",null),t.__decorate([a.property()],e.default.prototype,"_rtl",void 0),t.__decorate([a.property()],e.default.prototype,"_effectiveOffset",null),t.__decorate([a.property()],e.default.prototype,"_outerContainerStyle",null),e.default=t.__decorate([u.subclass("esri.views.interactive.Tooltip")],e.default);const f=["top","bottom","leading","trailing"].flatMap((e=>[y(`${e}-start`),y(e),y(`${e}-end`)]));function y(e){return`${_.base}--${e}`}return e.default}))},"esri/views/interactive/tooltip/css":function(){define(["exports"],(function(e){"use strict";const t="esri-tooltip",i=`${t}-content`,n=`${t}-content--input`,s=`${t}-content__header`,r=`${t}-content__header__spacer`,o=`${t}-content__header__actions`,a=`${t}-draw-header-actions`,l=`${t}-table`,c=`${t}-help-message`,h=`${t}-help-message__text`,u=`${t}-help-message__icon`;e.base=t,e.content=i,e.contentHeader=s,e.contentHeaderActions=o,e.contentHeaderSpacer=r,e.contentInputMode=n,e.drawContentHeaderActions=a,e.helpMessage=c,e.helpMessageIcon=u,e.helpMessageText=h,e.table=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/tooltipContentFactory":function(){define(["exports","./TooltipContentDrawCircle","./TooltipContentDrawMesh","./TooltipContentDrawPoint","./TooltipContentDrawPolygon","./TooltipContentDrawPolyline","./TooltipContentDrawRectangle","./TooltipContentExtentRotate","./TooltipContentExtentScale","./TooltipContentMovePoint","./TooltipContentReshapeEdgeOffset","./TooltipContentSelectedVertex","./TooltipContentTransformMesh","./TooltipContentTransformPoint","./TooltipContentTranslate","./TooltipContentTranslateVertex","./TooltipContentTranslateXY","./TooltipContentTranslateZ"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f){"use strict";e.tooltipContentFactory=function(e,y){if(null==y)return null;const x=document.createElement("div");switch(y.type){case"draw-point":case"draw-multipoint":return new n.TooltipContentDrawPoint({tooltip:e,info:y,container:x});case"draw-polygon":return new s.TooltipContentDrawPolygon({tooltip:e,info:y,container:x});case"draw-polyline":return new r.TooltipContentDrawPolyline({tooltip:e,info:y,container:x});case"draw-mesh":return new i.TooltipContentDrawMesh({tooltip:e,info:y,container:x});case"draw-rectangle":return new o.TooltipContentDrawRectangle({tooltip:e,info:y,container:x});case"draw-circle":return new t.TooltipContentDrawCircle({tooltip:e,info:y,container:x});case"extent-rotate":return new a.TooltipContentExtentRotate({tooltip:e,info:y,container:x});case"extent-scale":return new l.TooltipContentExtentScale({tooltip:e,info:y,container:x});case"move-point":return new c.TooltipContentMovePoint({tooltip:e,info:y,container:x});case"selected-vertex":return new u.TooltipContentSelectedVertex({tooltip:e,info:y,container:x});case"transform-point":return new d.TooltipContentTransformPoint({tooltip:e,info:y,container:x});case"transform-mesh":return new m.TooltipContentTransformMesh({tooltip:e,info:y,container:x});case"translate":return new p.TooltipContentTranslate({tooltip:e,info:y,container:x});case"translate-vertex":return new g.TooltipContentTranslateVertex({tooltip:e,info:y,container:x});case"translate-z":return new f.TooltipContentTranslateZ({tooltip:e,info:y,container:x});case"translate-xy":return new _.TooltipContentTranslateXY({tooltip:e,info:y,container:x});case"reshape-edge-offset":return new h.TooltipContentReshapeEdgeOffset({tooltip:e,info:y,container:x})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentDrawCircle":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","../components/TooltipField","../components/ValueByValue","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";e.TooltipContentDrawCircle=class extends c.TooltipContent{_renderContent(){const{area:e,radius:t,xSize:i,ySize:n,visibleElements:s}=this.info,r=this._messagesTooltip.sketch,o=this._formatters;return u.tsx(u.tsxFragment,null,s.radius&&null!=t?u.tsx(a.TooltipField,{title:r.radius,value:o.length(t)}):null,s.size&&null!=i&&null!=n?u.tsx(a.TooltipField,{title:r.size,value:u.tsx(l.ValueByValue,{left:o.length(i),right:o.length(n)})}):null,s.area?u.tsx(a.TooltipField,{title:r.area,value:o.area(e)}):null)}},e.TooltipContentDrawCircle=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],e.TooltipContentDrawCircle),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/components/TooltipField":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../css","../../../../widgets/Widget","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";const u=`${a.base}-field`,m={base:u,inputMode:`${u}--input`,title:`${u}__title`,value:`${u}__value`};e.TooltipField=class extends l{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return h.tsx("div",{class:this.classes({[m.base]:!0,[m.inputMode]:"input"===this.mode})},h.tsx("div",{class:m.title,key:"title"},this.title),h.tsx("div",{class:m.value,key:"value"},this.value))}},t.__decorate([i.property()],e.TooltipField.prototype,"hidden",void 0),t.__decorate([i.property()],e.TooltipField.prototype,"mode",void 0),t.__decorate([i.property()],e.TooltipField.prototype,"title",void 0),t.__decorate([i.property()],e.TooltipField.prototype,"value",void 0),e.TooltipField=t.__decorate([o.subclass("esri.views.interactive.tooltip.components.TooltipField")],e.TooltipField),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/components/ValueByValue":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../css","../../../../widgets/Widget","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";const u={base:`${a.base}-value-by-value`};e.ValueByValue=class extends l{constructor(){super(...arguments),this.divider=""}render(){return h.tsx("div",{class:u.base},h.tsx("span",null,this.left),h.tsx("span",null,this.divider),h.tsx("span",null,this.right))}},t.__decorate([i.property()],e.ValueByValue.prototype,"left",void 0),t.__decorate([i.property()],e.ValueByValue.prototype,"divider",void 0),t.__decorate([i.property()],e.ValueByValue.prototype,"right",void 0),e.ValueByValue=t.__decorate([o.subclass("esri.views.interactive.tooltip.components.ValueByValue")],e.ValueByValue),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContent":function(){define(["require","exports","../../../../chunks/tslib.es6","../../../../core/a11yUtils","../../../../core/events","../../../../core/has","../../../../core/memoize","../../../../core/promiseUtils","../../../../core/scheduling","../../../../core/unitFormatUtils","../../../../core/unitUtils","../../../../core/accessorSupport/decorators/property","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../support/getDefaultUnitForView","../../keybindings","../css","../fields/parsingAndFormattingUtils","../../../../widgets/Widget","../../../../chunks/componentsUtils","../../../../widgets/support/widgetUtils","../../../../widgets/support/decorators/messageBundle","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E){"use strict";const S=Symbol("dragHandles");async function C(e){await(e?.setFocus())}function w(e){return(Array.isArray(e)?e:[e]).flat(10).filter((e=>!!e))}t.TooltipContent=class extends x{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=o.memoize(y.getFormatters),this._onHeaderPointerDown=e=>{const t=e.target;t instanceof HTMLElement&&"calcite-button"!==t?.tagName?.toLowerCase()&&(this.removeHandles(S),e.preventDefault(),e.stopPropagation(),t.setPointerCapture(e.pointerId),this.tooltip.onDragStart(e.clientX,e.clientY),this.addHandles([s.on(t,"pointermove",(({clientX:e,clientY:t})=>{this.tooltip.onDrag(e,t)})),s.on(t,["pointerup","pointercancel"],(i=>{this.removeHandles(S),t.releasePointerCapture(e.pointerId),this.tooltip.onDragEnd()})),s.on(t,"touchstart",(e=>e.preventDefault()))],S))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(e,t)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:t}),"commit-and-exit"===t)return void this.exitInputMode();if("commit-on-blur"===t)return;const i=this._getFocusableElements(),n=i.length,s=i.indexOf(e);if(-1===s)return void this.exitInputMode();const r=((s+("commit-and-next"===t?1:-1))%n+n)%n;C(i.at(r))},this._onKeyDown=e=>{switch(e.code){case _.tooltipKeys.next:return this._onNextKey(e);case _.tooltipKeys.discard:return e.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:e}=this.info.sketchOptions.values,t=g.getDefaultUnitForView(this.tooltip.view);return{length:e.length??t,verticalLength:e.verticalLength??t,area:e.area??t}}get _inputUnitInfos(){const e=this._messagesUnits,t=t=>({unit:t,abbreviation:c.unitName(e,t,"abbr")}),{inputUnits:i}=this.info.sketchOptions.values,n=g.getDefaultUnitForView(this.tooltip.view),s=i.length??n,r=i.verticalLength??n,o=i.area??n;return{length:t(h.defaultLengthUnit(s)),verticalLength:t(h.defaultVerticalLengthUnit(r)),area:t(h.defaultAreaUnit(o)),angle:t("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:e}=this.info.sketchOptions.tooltips,t=this._renderedContent,i=this._renderedActions,n=this._renderedHelpMessage,s=t.length>0,r=s||!!n,o="input"===this.mode;return E.tsx("div",{class:P.classes(f.content,o&&f.contentInputMode),onkeydown:this._onKeyDown,tabIndex:-1},o&&r&&e.header?E.tsx("div",{class:f.contentHeader,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},E.tsx("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),i.length>0?E.tsx(E.tsxFragment,null,E.tsx("div",{class:f.contentHeaderSpacer,key:"spacer"}),E.tsx("div",{class:f.contentHeaderActions,key:"actions"},i)):null):null,s?E.tsx("div",{class:f.table,key:"content"},...t):null,n)}destroy(){this._focusAbortController.abort(),this._transitionInfo?.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return v.loadCalciteComponents({button:()=>new Promise(((t,i)=>e(["../../../../chunks/index2"],t,i))),icon:()=>new Promise(((t,i)=>e(["../../../../chunks/index7"],t,i))),input:()=>new Promise(((t,i)=>e(["../../../../chunks/index4"],t,i)))})}async enterInputMode(e,t){try{await this._transitionTo("input",t),await this._focusField(e)}catch(e){a.throwIfNotAbortError(e)}}async exitInputMode({focusOnView:e=!0}={}){try{const{container:t,info:i}=this;i.clearInputValues();const n=e?t?.closest(".esri-view")?.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),n instanceof HTMLElement&&n.focus()}catch(e){a.throwIfNotAbortError(e)}}_onNextKey(e){const t=this._getFocusableElements(),i=t.at(0),n=t.at(-1);i&&n&&(e.shiftKey?document.activeElement===i&&(e.preventDefault(),e.stopPropagation(),C(n)):document.activeElement===n&&(e.preventDefault(),e.stopPropagation(),C(i)))}get _renderedContent(){return w(this._renderContent())}get _renderedActions(){return w(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:e,visibleElements:t}=this.info;if(!t.helpMessage)return null;const i=e.tooltips.helpMessage??this._defaultHelpMessage;if(!i)return null;const n=e.tooltips.helpMessageIcon??"information";return E.tsx("div",{class:f.helpMessage,key:"help-message"},n?E.tsx("calcite-icon",{class:f.helpMessageIcon,icon:n,scale:"s"}):null,E.tsx("div",{class:f.helpMessageText},i))}get _defaultHelpMessage(){const{helpMessage:e,viewType:t}=this.info;if(null==e)return null;const i="3d"===t?"helpMessages3d":"helpMessages2d";return this._messagesTooltip?.sketch?.[i]?.[e]}async _focusField(e){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const{signal:t}=this._focusAbortController;await this._waitForInputs(),a.throwIfAborted(t);const i=this._getFocusableInputs(),n=e?i.find((t=>t.getAttribute("data-field-name")===e)):i.at(0);await C(n)}async _transitionTo(e,t){if(this._mode===e&&!this._transitionInfo)return;if(this._transitionInfo?.mode===e)return this._transitionInfo.transition.finished;this._transitionInfo?.transition.skipTransition();const i=async()=>{this.destroyed||(this._mode=e,await l.waitTick(),this.destroyed||(this.renderNow(),await l.waitTick(),this.destroyed||t?.()))};if(!this.domNode?.firstChild||!document.startViewTransition||n.prefersReducedMotion())return void await i();this.autoRenderingEnabled=!1;const s=this._transitionInfo={transition:document.startViewTransition((async()=>{this.destroyed||s!==this._transitionInfo||(this.autoRenderingEnabled=!0,await i())})),mode:e};try{await s.transition.finished}finally{s===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const e=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;0===e().length;)await a.after(T);await l.waitAnimationFrame()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const e=this.domNode?.querySelector(`.${f.drawContentHeaderActions}`);return[...Array.from(e?.querySelectorAll(`.${f.contentHeaderActions} calcite-button:not([disabled])`)??[]),...this._getFocusableInputs()]}},i.__decorate([b.messageBundle("esri/core/t9n/Units"),u.property()],t.TooltipContent.prototype,"_messagesUnits",void 0),i.__decorate([b.messageBundle("esri/views/interactive/tooltip/t9n/Tooltip"),u.property()],t.TooltipContent.prototype,"_messagesTooltip",void 0),i.__decorate([u.property()],t.TooltipContent.prototype,"info",void 0),i.__decorate([u.property()],t.TooltipContent.prototype,"tooltip",void 0),i.__decorate([u.property()],t.TooltipContent.prototype,"_mode",void 0),i.__decorate([u.property()],t.TooltipContent.prototype,"mode",null),i.__decorate([u.property()],t.TooltipContent.prototype,"_displayUnits",null),i.__decorate([u.property()],t.TooltipContent.prototype,"_inputUnitInfos",null),i.__decorate([u.property()],t.TooltipContent.prototype,"_formatters",null),i.__decorate([u.property()],t.TooltipContent.prototype,"fieldContext",null),i.__decorate([u.property()],t.TooltipContent.prototype,"_renderedContent",null),i.__decorate([u.property()],t.TooltipContent.prototype,"_renderedActions",null),i.__decorate([u.property()],t.TooltipContent.prototype,"_renderedHelpMessage",null),i.__decorate([u.property()],t.TooltipContent.prototype,"_defaultHelpMessage",null),t.TooltipContent=i.__decorate([p.subclass("esri.views.interactive.tooltip.content.TooltipContent")],t.TooltipContent);const T=20;Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/core/memoize":function(){define(["exports"],(function(e){"use strict";e.memoize=function(e){let t,i,n=[],s=!1;return function(...r){return s&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}(r,n)||(i=e.apply(this,r),t=this,n=r,s=!0),i}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/fields/parsingAndFormattingUtils":function(){define(["exports","../../../../core/Cyclical","../../../../core/quantityFormatUtils","../../../../core/quantityUtils","../../../../geometry/coordinateFormatter","../../../../intl/number","../../../support/angularMeasurementUtils"],(function(e,t,i,n,s,r,o){"use strict";function a(e){return r.formatNumber(e,{signDisplay:"exceptZero",...y(1)})}function l(e){return i.formatAngle(e,e.rotationType,1)}function c(e){const t=o.getDegreesGeographic(e);return r.formatNumber(t,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:t>0?"never":"exceptZero",...y(1)})}function h(e){return i.formatAngle(e,e.rotationType,1)}function u(e){return d(e,E)}function m(e){return d(e,S)}function d(e,t){return i.formatAngle(n.toUnit(e,"degrees"),"geographic",6,t,!1)}function p(e,t){const i=t.normalize(n.toUnit(e,"degrees").value,void 0,!1);return f(n.createScalar(i),6)}function g(e){return r.formatNumber(e.value,{style:"percent"})}function _(e){return r.formatNumber(e,{style:"percent",maximumFractionDigits:0})}function f(e,t){return r.formatNumber(e.value,y(t))}function y(e){return{minimumFractionDigits:e,maximumFractionDigits:e}}const x=e=>{let t=`[-+]?[0-9${e.thousands}]+`;return""!==e.decimal&&(t+=`${e.decimal}[0-9]+`),new RegExp(`^(${t}\\s*)${e.separator}(\\s*${t})$`,"i")},v=[];for(const e of[",","\\|","\\s+"])for(const t of["\\.",",",""])for(const i of["",",","\\.","","\\s+"])e!==t&&e!==i&&t!==i&&v.push({separator:e,decimal:t,thousands:i,pattern:x({decimal:t,thousands:i,separator:e})});function P(e,t,i){let n=e.replaceAll(/[\s+]/g,"");return""!==i&&(n=n.replaceAll(i,"")),""!==t&&(n=n.replaceAll(t,".")),n}function b(e){return null!=e?n.createAngle(e,"degrees","geographic"):null}const E=new t.Cyclical(-180,180),S=new t.Cyclical(-90,90);e.cleanNumber=P,e.createGeographicCoordinate=b,e.formatLatitudeDecimalDegreesForInputMode=function(e){return p(e,S)},e.formatLongitudeDecimalDegreesForInputMode=function(e){return p(e,E)},e.getFormatters=function(e,t){return{angleRelative:a,direction:l,directionRelative:c,directionRelativeBilateral:h,latitudeDecimalDegrees:m,longitudeDecimalDegrees:u,area:(n,s)=>i.formatArea(e,n,s??t.area),length:(n,s,r)=>i.formatLength(e,n,s??t.length,r),lengthRelative:(n,s)=>i.formatRelativeLength(e,n,s??t.length),totalLength:(n,s)=>i.formatLength(e,n,s??t.length),verticalLength:(n,s)=>i.formatVerticalLength(e,n,s??t.verticalLength),verticalLengthRelative:(n,s)=>i.formatRelativeVerticalLength(e,n,s??t.verticalLength),percentage:g,scalar:f,scale:_}},e.makeQuantityParser=function({createQuantity:e,sanitize:t}){return(i,n)=>{if(null==i)return null;t&&(i=t(i));const s=r.parseNumber(i);return null==s?null:e(s,n)}},e.parseLatitude=function(e){return b(s.fromLatitude(e))},e.parseLatitudeLongitude=function(e){if(!e||null!=r.parseNumber(e)||!s.isLoaded())return null;const t=s.fromLatitudeLongitude(e),i=b(t?.latitude),n=b(t?.longitude);return null!=n&&null!=i?{latitude:i,longitude:n}:null},e.parseLongitude=function(e){return b(s.fromLongitude(e))},e.parseXY=function(e){for(const{decimal:t,thousands:i,pattern:s}of v){s.lastIndex=0;const o=e.match(s);if(!o)continue;const a=r.parseNumber(P(o[1],t,i)),l=r.parseNumber(P(o[2],t,i));if(null!=a&&null!=l)return{x:n.createScalar(a),y:n.createScalar(l)}}return null},e.sanitizeAngle=function(e){return e.replaceAll(/[*^~]/g,"")},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentDrawMesh":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","./Fields","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentDrawMesh=class extends l.TooltipContent{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return h.tsx(a.Fields,{context:e,fields:[n.coordinates?t.effectiveX:void 0,n.coordinates?t.effectiveY:void 0,n.elevation?t.elevation:void 0,n.orientation?t.orientation:void 0,n.scale?t.scale:void 0],mode:i})}},e.TooltipContentDrawMesh=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],e.TooltipContentDrawMesh),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/Fields":function(){define(["exports","../components/TooltipEditableField","../../../../widgets/support/jsxFactory"],(function(e,t,i){"use strict";e.Fields=function(e){const n=e.fields.filter((e=>!0===e?.visible));return 0===n.length?null:i.tsx(i.tsxFragment,null,n.map((n=>i.tsx(t.TooltipEditableField,{context:e.context,field:n,key:n.id,mode:e.mode}))))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/components/TooltipEditableField":function(){define(["require","exports","../../../../chunks/tslib.es6","../../../../core/reactiveUtils","../../../../core/scheduling","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../keybindings","../css","../../../../widgets/Widget","../../../../chunks/componentsUtils","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g){"use strict";const _=`${u.base}-editable-field`,f={base:_,inputMode:`${_}--input`,feedbackMode:`${_}--feedback`,readOnly:`${_}--read-only`,locked:`${_}--locked`,title:`${_}__title`,value:`${_}__value`,valueContent:`${_}__value__content`,valueContentReadOnly:`${_}__value__content--read-only`,lockIcon:`${_}__lock-icon`,input:`${_}__input`,inputWrapper:`${_}__input-wrapper`,inputMessage:`${_}__input-message`,inputSuffix:`${_}__input-suffix`,button:`${_}__button`},y="lock";t.TooltipEditableField=class extends m{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=e=>{this._lock=e},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=e=>{e.key===h.tooltipKeys.discard&&"input"===this.mode&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=e=>{const t=this._input;if(t)switch(e.key){case h.tooltipKeys.commit:return this.field.onCommit("commit-and-exit",t,this.context);case h.tooltipKeys.next:{e.preventDefault(),e.stopPropagation();const i=e.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(i,t,this.context)}}},this._onInput=e=>{this.field.onInput(e.currentTarget.value)},this._onInputBlur=e=>{const t=this._input;t&&e.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",t,this.context)},this._selectText=()=>{const e=()=>{this._input===document.activeElement&&this._input?.selectText()};e(),s.waitAnimationFrame().then(e)},this._onAfterCreate=e=>{this._input=e,e.addEventListener("paste",this._onPaste),e.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=e=>{e.removeEventListener("paste",this._onPaste),e.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=e=>{const t=e.clipboardData?.getData("text");t&&null!=this.field.parse(t,this.context)&&(e.stopPropagation(),this.field.onInput(t))},this._onBeforeInput=e=>{("historyUndo"===e.inputType||"historyRedo"===e.inputType)&&!this.field.dirty&&e.preventDefault()}}initialize(){this.addHandles(n.watch((()=>this._rawDisplayValue),(()=>{const{committed:e,inputValue:t}=this.field;e||t||this._input!==document.activeElement||this._selectText()})))}loadDependencies(){return d.loadCalciteComponents({button:()=>new Promise(((t,i)=>e(["../../../../chunks/index2"],t,i))),icon:()=>new Promise(((t,i)=>e(["../../../../chunks/index7"],t,i))),input:()=>new Promise(((t,i)=>e(["../../../../chunks/index4"],t,i))),"input-message":()=>new Promise(((t,i)=>e(["../../../../chunks/index31"],t,i)))})}render(){const{field:e,mode:t}=this,i="input"===t,{locked:n,readOnly:s}=e;return g.tsx("div",{class:this.classes({[f.base]:!0,[f.feedbackMode]:"feedback"===t,[f.inputMode]:"input"===t,[f.locked]:n,[f.readOnly]:s})},g.tsx("div",{class:f.title,key:"title"},this._title),g.tsx("div",{class:f.value,key:"value",onkeydown:this._onKeyDown},i?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||x}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:e}=this.field;return"string"==typeof e?e:e(this.context)}get _messages(){return this.context?.messages.sketch??{}}_renderValueFeedbackMode(){return g.tsx(g.tsxFragment,null,g.tsx("div",{class:f.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&"input"!==this.mode?g.tsx("calcite-icon",{class:f.lockIcon,icon:y,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return g.tsx("div",{class:this.classes(f.valueContent,f.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:e}=this,t=this._messages,{name:i,invalid:n}=e;return g.tsx(g.tsxFragment,null,g.tsx("div",{class:f.inputWrapper,key:"value-input"},g.tsx("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:f.input,"data-field-name":i,"data-testid":`tooltip-field-${i}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:n?"invalid":"idle",type:"text",value:this._rawDisplayValue??x,onCalciteInputInput:this._onInput}),n?g.tsx("calcite-input-message",{class:f.inputMessage,scale:"s",status:"invalid"},t.invalidValue):null),g.tsx("div",{class:f.inputSuffix,key:"suffix"},this._suffix),this._renderedLockButton)}get _renderedLockButton(){const{name:e,locked:t,lockable:i}=this.field;if(!i)return g.tsx("div",{key:"no-lock-button"});const n=this._messages,s=t?n.unlockConstraint:n.lockConstraint;return g.tsx("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:f.button,"data-testid":`tooltip-field-${e}-lock`,iconStart:t?y:"unlock",key:"lock-button",kind:"neutral",label:s,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:s})}},i.__decorate([r.property()],t.TooltipEditableField.prototype,"field",void 0),i.__decorate([r.property()],t.TooltipEditableField.prototype,"context",void 0),i.__decorate([r.property()],t.TooltipEditableField.prototype,"mode",void 0),i.__decorate([r.property()],t.TooltipEditableField.prototype,"_input",void 0),i.__decorate([r.property()],t.TooltipEditableField.prototype,"_lock",void 0),i.__decorate([r.property()],t.TooltipEditableField.prototype,"_formattedValue",null),i.__decorate([r.property()],t.TooltipEditableField.prototype,"_rawDisplayValue",null),i.__decorate([r.property()],t.TooltipEditableField.prototype,"_suffix",null),i.__decorate([r.property()],t.TooltipEditableField.prototype,"_title",null),i.__decorate([r.property()],t.TooltipEditableField.prototype,"_messages",null),i.__decorate([r.property()],t.TooltipEditableField.prototype,"_renderedLockButton",null),t.TooltipEditableField=i.__decorate([c.subclass("esri.views.interactive.tooltip.components.TooltipEditableField")],t.TooltipEditableField);const x="";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentDrawPoint":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","./Fields","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentDrawPoint=class extends l.TooltipContent{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{elevation:n,visibleElements:s}=t;return h.tsx(a.Fields,{context:e,fields:[s.coordinates?t.effectiveX:void 0,s.coordinates?t.effectiveY:void 0,s.elevation?n:void 0],mode:i})}},e.TooltipContentDrawPoint=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],e.TooltipContentDrawPoint),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentDrawPolygon":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","../components/DrawHeaderActions","./Fields","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";e.TooltipContentDrawPolygon=class extends c.TooltipContent{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{xyMode:n,visibleElements:s}=t;return u.tsx(l.Fields,{context:e,fields:[..."direction-distance"===n?[s.direction?t.direction:void 0,s.distance?t.distance:void 0]:[s.coordinates?t.effectiveX:void 0,s.coordinates?t.effectiveY:void 0],s.elevation?t.elevation:void 0,s.area?t.area:void 0],mode:i})}_renderActions(){const{xyMode:e,sketchOptions:t}=this.info;return u.tsx(a.DrawHeaderActions,{sketchOptions:t,visibleElements:{direction:"direction-distance"===e}})}},e.TooltipContentDrawPolygon=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],e.TooltipContentDrawPolygon),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/components/DrawHeaderActions":function(){define(["require","exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../css","./directionModeIcons","../../../../widgets/Widget","../../../../chunks/componentsUtils","../../../../widgets/support/widgetUtils","../../../../widgets/support/decorators/messageBundle","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p){"use strict";function g(e){const{directionMode:t}=e.sketchOptions.values,i=e.messages?.sketch,n=i?.directionModeSelect?.title,s="absolute",r="relative";return p.tsx("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:t=>{const i=t.currentTarget.selectedItems?.[0]?.getAttribute("data-mode");e.sketchOptions.values.directionMode=i??"absolute"}},p.tsx("calcite-button",{alignment:"end",appearance:"transparent",iconStart:c.directionModeIcons[t],kind:"neutral",label:n,scale:"s",slot:"trigger",title:n}),p.tsx("calcite-dropdown-group",{selectionMode:"single"},p.tsx("calcite-dropdown-item",{"data-mode":r,"data-testid":"tooltip-direction-mode-relative",iconStart:c.directionModeIcons.relative,key:"relative",selected:t===r},i?.directionModeSelect?.relative),p.tsx("calcite-dropdown-item",{"data-mode":s,"data-testid":"tooltip-direction-mode-absolute",iconStart:c.directionModeIcons.absolute,key:"absolute",selected:t===s},i?.directionModeSelect?.absolute)))}t.DrawHeaderActions=class extends h{constructor(e){super(e),this.visibleElements={}}render(){return p.tsx("div",{class:l.drawContentHeaderActions},this._isElementVisible("direction")?p.tsx(g,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return u.loadCalciteComponents({button:()=>new Promise(((t,i)=>e(["../../../../chunks/index2"],t,i))),dropdown:()=>new Promise(((t,i)=>e(["../../../../chunks/index24"],t,i))),"dropdown-item":()=>new Promise(((t,i)=>e(["../../../../chunks/index26"],t,i))),"dropdown-group":()=>new Promise(((t,i)=>e(["../../../../chunks/index25"],t,i)))})}_isElementVisible(e){return this.visibleElements?.[e]??this.sketchOptions.tooltips.visibleElements[e]}},i.__decorate([d.messageBundle("esri/views/interactive/tooltip/t9n/Tooltip"),n.property()],t.DrawHeaderActions.prototype,"messages",void 0),i.__decorate([n.property()],t.DrawHeaderActions.prototype,"sketchOptions",void 0),i.__decorate([n.property()],t.DrawHeaderActions.prototype,"visibleElements",void 0),t.DrawHeaderActions=i.__decorate([a.subclass("esri.views.interactive.tooltip.components.DrawHeaderActions")],t.DrawHeaderActions),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/components/directionModeIcons":function(){define(["exports"],(function(e){"use strict";e.directionModeIcons={absolute:"absolute-direction",relative:"relative-direction"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentDrawPolyline":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","../components/DrawHeaderActions","./Fields","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";e.TooltipContentDrawPolyline=class extends c.TooltipContent{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{xyMode:n,visibleElements:s}=t;return u.tsx(l.Fields,{context:e,fields:[..."direction-distance"===n?[s.direction?t.direction:void 0,s.distance?t.distance:void 0]:[s.coordinates?t.effectiveX:void 0,s.coordinates?t.effectiveY:void 0],s.elevation?t.elevation:void 0,s.totalLength?t.totalLength:void 0],mode:i})}_renderActions(){const{xyMode:e,sketchOptions:t}=this.info;return u.tsx(a.DrawHeaderActions,{sketchOptions:t,visibleElements:{direction:"direction-distance"===e}})}},e.TooltipContentDrawPolyline=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],e.TooltipContentDrawPolyline),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentDrawRectangle":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","../components/TooltipField","../components/ValueByValue","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";e.TooltipContentDrawRectangle=class extends c.TooltipContent{_renderContent(){const{area:e,xSize:t,ySize:i,visibleElements:n}=this.info,s=this._messagesTooltip.sketch,r=this._formatters;return u.tsx(u.tsxFragment,null,n.size&&null!=t&&null!=i?u.tsx(a.TooltipField,{title:s.size,value:u.tsx(l.ValueByValue,{left:r.length(t),right:r.length(i)})}):null,n.area?u.tsx(a.TooltipField,{title:s.area,value:r.area(e)}):null)}},e.TooltipContentDrawRectangle=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],e.TooltipContentDrawRectangle),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentExtentRotate":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","../components/TooltipField","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentExtentRotate=class extends l.TooltipContent{_renderContent(){const{angle:e,visibleElements:t}=this.info,i=this._messagesTooltip.sketch;return h.tsx(h.tsxFragment,null,t.rotation?h.tsx(a.TooltipField,{title:i.rotation,value:this._formatters.angleRelative(e)}):null)}},e.TooltipContentExtentRotate=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],e.TooltipContentExtentRotate),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentExtentScale":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","../components/TooltipField","../components/ValueByValue","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";e.TooltipContentExtentScale=class extends c.TooltipContent{_renderContent(){const e=this.info,{visibleElements:t}=e,i=this._messagesTooltip.sketch,n=this._formatters;return u.tsx(u.tsxFragment,null,t.size?u.tsx(a.TooltipField,{title:i.size,value:u.tsx(l.ValueByValue,{left:n.length(e.xSize),right:n.length(e.ySize)})}):null,t.scale?u.tsx(a.TooltipField,{title:i.scale,value:u.tsx(l.ValueByValue,{left:n.scale(e.xScale),right:n.scale(e.yScale)})}):null)}},e.TooltipContentExtentScale=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],e.TooltipContentExtentScale),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentMovePoint":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","./Fields","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentMovePoint=class extends l.TooltipContent{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return h.tsx(a.Fields,{context:e,fields:[n.coordinates?t.effectiveX:void 0,n.coordinates?t.effectiveY:void 0,n.elevation?t.elevation:void 0],mode:i})}},e.TooltipContentMovePoint=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],e.TooltipContentMovePoint),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentReshapeEdgeOffset":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","./Fields","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentReshapeEdgeOffset=class extends l.TooltipContent{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return h.tsx(a.Fields,{context:e,fields:[n.distance?t.distance:void 0,n.area?t.area:void 0,n.totalLength?t.totalLength:void 0],mode:i})}},e.TooltipContentReshapeEdgeOffset=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],e.TooltipContentReshapeEdgeOffset),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentSelectedVertex":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","./Fields","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentSelectedVertex=class extends l.TooltipContent{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return h.tsx(a.Fields,{context:e,fields:[n.coordinates?t.effectiveX:void 0,n.coordinates?t.effectiveY:void 0,n.elevation?t.elevation:void 0,n.area&&"polygon"===t.geometryType?t.area:null,n.totalLength&&"polyline"===t.geometryType?t.totalLength:null],mode:i})}},e.TooltipContentSelectedVertex=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],e.TooltipContentSelectedVertex),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentTransformMesh":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","./Fields","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentTransformMesh=class extends l.TooltipContent{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return h.tsx(a.Fields,{context:e,fields:[n.coordinates?t.effectiveX:void 0,n.coordinates?t.effectiveY:void 0,n.elevation?t.elevation:void 0,n.orientation?t.orientation:void 0,n.scale?t.scale:void 0],mode:i})}},e.TooltipContentTransformMesh=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],e.TooltipContentTransformMesh),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentTransformPoint":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","./Fields","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentTransformPoint=class extends l.TooltipContent{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return h.tsx(a.Fields,{context:e,fields:[n.coordinates?t.effectiveX:void 0,n.coordinates?t.effectiveY:void 0,n.elevation?t.elevation:void 0,n.orientation?t.orientation:void 0,n.size?t.size:void 0],mode:i})}},e.TooltipContentTransformPoint=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],e.TooltipContentTransformPoint),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentTranslate":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","../components/TooltipField","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentTranslate=class extends l.TooltipContent{_renderContent(){const{info:e}=this,{visibleElements:t}=e,i=this._messagesTooltip.sketch,n=this._formatters;return h.tsx(h.tsxFragment,null,t.distance?h.tsx(a.TooltipField,{title:i.distance,value:n.length(e.distance)}):null)}},e.TooltipContentTranslate=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentTranslate")],e.TooltipContentTranslate),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentTranslateVertex":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","../components/TooltipField","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentTranslateVertex=class extends l.TooltipContent{_renderContent(){const{distance:e,elevation:t,area:i,totalLength:n,visibleElements:s}=this.info,r=this._messagesTooltip.sketch,o=this._formatters;return h.tsx(h.tsxFragment,null,s.distance?h.tsx(a.TooltipField,{title:r.distance,value:o.length(e)}):null,s.elevation&&null!=t?.actual?h.tsx(a.TooltipField,{title:r.elevation,value:o.verticalLength(t.actual)}):null,s.area&&null!=i?h.tsx(a.TooltipField,{title:r.area,value:o.area(i)}):null,s.totalLength&&null!=n?h.tsx(a.TooltipField,{title:r.totalLength,value:o.length(n)}):null)}},e.TooltipContentTranslateVertex=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],e.TooltipContentTranslateVertex),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentTranslateXY":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","../components/TooltipField","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentTranslateXY=class extends l.TooltipContent{_renderContent(){const{info:e}=this,{visibleElements:t}=e,i=this._messagesTooltip.sketch,n=this._formatters;return h.tsx(h.tsxFragment,null,t.distance?h.tsx(a.TooltipField,{title:i.distance,value:n.length(e.distance)}):null)}},e.TooltipContentTranslateXY=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],e.TooltipContentTranslateXY),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/content/TooltipContentTranslateZ":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass","../components/TooltipField","./TooltipContent","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.TooltipContentTranslateZ=class extends l.TooltipContent{_renderContent(){const{info:e}=this,{visibleElements:t}=e,i=this._messagesTooltip.sketch;return h.tsx(h.tsxFragment,null,t.distance?h.tsx(a.TooltipField,{title:i.distance,value:this._formatters.verticalLengthRelative(e.distance)}):null)}},e.TooltipContentTranslateZ=t.__decorate([o.subclass("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],e.TooltipContentTranslateZ),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/DrawCircleTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/quantityUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./SketchTooltipInfo"],(function(e,t,i,n,s,r,o,a,l){"use strict";e.DrawCircleTooltipInfo=class extends l.SketchTooltipInfo{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=i.zeroSquareMeters}get allFields(){return[]}},t.__decorate([n.property()],e.DrawCircleTooltipInfo.prototype,"type",void 0),t.__decorate([n.property()],e.DrawCircleTooltipInfo.prototype,"radius",void 0),t.__decorate([n.property()],e.DrawCircleTooltipInfo.prototype,"xSize",void 0),t.__decorate([n.property()],e.DrawCircleTooltipInfo.prototype,"ySize",void 0),t.__decorate([n.property()],e.DrawCircleTooltipInfo.prototype,"area",void 0),t.__decorate([n.property()],e.DrawCircleTooltipInfo.prototype,"helpMessage",void 0),t.__decorate([n.property()],e.DrawCircleTooltipInfo.prototype,"allFields",null),e.DrawCircleTooltipInfo=t.__decorate([a.subclass("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],e.DrawCircleTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/SketchTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass"],(function(e,t,i,n,s,r,o,a){"use strict";e.SketchTooltipInfo=class extends i{constructor(e){super(e),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter((e=>e.visible&&!e.readOnly))}clearInputValues(){this.allFields.forEach((e=>e.clearInputValue()))}},t.__decorate([n.property()],e.SketchTooltipInfo.prototype,"sketchOptions",void 0),t.__decorate([n.property()],e.SketchTooltipInfo.prototype,"visibleElements",null),t.__decorate([n.property()],e.SketchTooltipInfo.prototype,"helpMessage",void 0),t.__decorate([n.property()],e.SketchTooltipInfo.prototype,"viewType",void 0),t.__decorate([n.property()],e.SketchTooltipInfo.prototype,"allFields",null),t.__decorate([n.property()],e.SketchTooltipInfo.prototype,"editableFields",null),e.SketchTooltipInfo=t.__decorate([a.subclass("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],e.SketchTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/DrawMeshTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../fields/fields","./SketchTooltipInfo","./TooltipInfoWithCoordinates"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";e.DrawMeshTooltipInfo=class extends(c.TooltipInfoWithCoordinates(l.SketchTooltipInfo)){constructor(e){super(e),this.type="draw-mesh",this.orientation=a.makeOrientationField({lockable:!1}),this.scale=a.makeScaleField({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}},t.__decorate([i.property()],e.DrawMeshTooltipInfo.prototype,"helpMessage",void 0),t.__decorate([i.property()],e.DrawMeshTooltipInfo.prototype,"allFields",null),e.DrawMeshTooltipInfo=t.__decorate([o.subclass("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],e.DrawMeshTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/fields/fields":function(){define(["exports","../../../../core/quantityUtils","./parsingAndFormattingUtils","./TooltipField","./TooltipFieldElevation","./TooltipFieldOrientation","./TooltipFieldSize","../../../support/angularMeasurementUtils"],(function(e,t,i,n,s,r,o,a){"use strict";function l(e){const s=e=>e.inputUnitInfos.length.unit;return new n.TooltipField({name:"distance",actual:t.zeroMeters,parse:i.makeQuantityParser({createQuantity:(e,i)=>t.createLength(Math.max(e,0),s(i))}),format:(e,t)=>t.formatters.length(e),formatForInputMode:(e,i)=>i.formatters.scalar(t.toUnit(e,s(i))),suffix:e=>e.inputUnitInfos.length.abbreviation,title:e=>e.messages.sketch.distance,...e})}function c(e,s){return new n.TooltipField({actual:t.createScalar(0),parse:i.makeQuantityParser({createQuantity:e=>t.createScalar(e)}),format:(e,t)=>t.formatters.scalar(e),formatForInputMode:(e,t)=>t.formatters.scalar(e),title:t=>t.messages.sketch[e],...s})}e.makeAreaField=function(e){const s=e=>e.inputUnitInfos.area.unit;return new n.TooltipField({name:"area",actual:t.zeroSquareMeters,parse:i.makeQuantityParser({createQuantity:(e,i)=>t.createArea(e,s(i))}),format:(e,t)=>t.formatters.area(e),formatForInputMode:(e,i)=>i.formatters.scalar(t.toUnit(e,s(i))),suffix:e=>e.inputUnitInfos.area.abbreviation,title:e=>e.messages.sketch.area,readOnly:!0,...e})},e.makeDirectionField=function(e){const s=e=>e.inputUnitInfos.angle.unit,r=e=>e.sketchOptions.values.effectiveDirectionMode;return new n.TooltipField({name:"direction",actual:t.zeroDegrees,parse:i.makeQuantityParser({createQuantity:(e,i)=>t.createAngle(e,s(i),"geographic"),sanitize:i.sanitizeAngle}),format:(e,t)=>{const i=r(t),n=a.getNormalizedDirection(e,i);switch(i){case a.DirectionMode.Absolute:return t.formatters.direction(n);case a.DirectionMode.Relative:return t.formatters.directionRelative(n);case a.DirectionMode.RelativeBilateral:return t.formatters.directionRelativeBilateral(n)}},formatForInputMode:(e,i)=>{const n=a.getNormalizedDirection(e,r(i));return i.formatters.scalar(t.toUnit(n,s(i)))},suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>{const t=r(e),{absolute:i,relative:n}=e.messages.sketch.direction;switch(t){case a.DirectionMode.Absolute:return i;case a.DirectionMode.Relative:case a.DirectionMode.RelativeBilateral:return n}},...e})},e.makeDistanceField=function(e){return l({...e})},e.makeElevationField=function(e){return new s.TooltipFieldElevation(e)},e.makeLatitudeField=function(e){return new n.TooltipField({name:"y",actual:t.zeroDegrees,parse:i.parseLatitude,format:(e,t)=>t.formatters.latitudeDecimalDegrees(e),formatForInputMode:e=>i.formatLatitudeDecimalDegreesForInputMode(e),suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.latitude,...e})},e.makeLengthField=l,e.makeLongitudeField=function(e){return new n.TooltipField({name:"x",actual:t.zeroDegrees,parse:i.parseLongitude,format:(e,t)=>t.formatters.longitudeDecimalDegrees(e),formatForInputMode:e=>i.formatLongitudeDecimalDegreesForInputMode(e),suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.longitude,...e})},e.makeOrientationField=function(e){return new r.TooltipFieldOrientation(e)},e.makeRelativeDistanceField=function(e){return l({...e,parse:i.makeQuantityParser({createQuantity:(e,i)=>t.createLength(e,(e=>e.inputUnitInfos.length.unit)(i))}),format:(e,t)=>t.formatters.lengthRelative(e)})},e.makeScaleField=function(e){return c("scale",{name:"scale",actual:null,parse:i.makeQuantityParser({createQuantity:e=>t.createScalar(Math.abs(e))}),...e})},e.makeSizeField=function(e){return new o.TooltipFieldSize(e)},e.makeTotalLengthField=function(e){return l({format:(e,t)=>t.formatters.totalLength(e),title:e=>e.messages.sketch.totalLength,readOnly:!0,...e})},e.makeXField=function(e){return c("x",{name:"x",...e})},e.makeYField=function(e){return c("y",{name:"y",...e})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/fields/TooltipField":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/uuid","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass"],(function(e,t,i,n,s,r,o,a,l){"use strict";function c(e){return null!=e&&""===e.trim()}e.TooltipField=class extends i{constructor(e){super(e),this.actual=null,this.lockable=!0,this.id=n.generateUUID(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(e){this.lockable&&this._set("committed",e)}get dirty(){return null!=this.inputValue}get locked(){return this.lockable&&null!=this.committed}onInput(e){this.inputValue=e,this.invalid=!1}onCommit(e,t,i){this.lockable?this._onCommitLockable(e,i):this._onCommitNonLockable(i),this.invalid&&"commit-and-exit"===e||i.onCommit(t,e)}_onCommitLockable(e,t){const{inputValue:i,locked:n}=this;n&&c(i)?this.unlock():("commit-and-exit"===e&&!n||null!=i)&&this._parseInputAndLock(t)}_onCommitNonLockable(e){const{inputValue:t}=this;c(t)?this.lockable?this.setActual(null):this.clearInputValue():null!=t&&this._parseInputAndSetActual(e)}applyValue(e){this.lockable?this.lock(e):this.setActual(e)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(e){this.actual=e,this.clearInputValue()}lock(e){this.lockable&&(this.committed=e??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(e){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(e))}getSuffix(e){const{suffix:t}=this;return"function"==typeof t?t(e):t}getFormattedValue(e){const{actual:t,committed:i,format:n}=this;return null!=i?n(i,e):null!=t?n(t,e):null}getRawDisplayValue(e){const{actual:t,committed:i,inputValue:n}=this;return null!=n?n:this.lockable&&null!=i?this.formatForInputMode(i,e):null!=t?this.formatForInputMode(t,e):null}_parseInputAndSetActual(e){const{inputValue:t}=this;if(null==t||c(t))return this.setActual(null);const i=this.parse(t,e);null!=i?this.setActual(i):this.invalid=!0}_parseInputAndLock(e){const{inputValue:t,actual:i}=this;if(c(t))return this.unlock();if(null==t)return this.lock(i);const n=this.parse(t,e);null!=n?this.lock(n):this.invalid=!0}},t.__decorate([s.property()],e.TooltipField.prototype,"actual",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"committed",null),t.__decorate([s.property()],e.TooltipField.prototype,"dirty",null),t.__decorate([s.property()],e.TooltipField.prototype,"format",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"formatForInputMode",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"lockable",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"locked",null),t.__decorate([s.property()],e.TooltipField.prototype,"id",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"inputValue",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"name",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"parse",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"readOnly",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"suffix",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"title",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"visible",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"invalid",void 0),t.__decorate([s.property()],e.TooltipField.prototype,"unlockOnVertexPlacement",void 0),e.TooltipField=t.__decorate([l.subclass("esri.views.interactive.tooltip.fields.TooltipField")],e.TooltipField),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/fields/TooltipFieldElevation":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/quantityUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./parsingAndFormattingUtils","./TooltipField"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";e.TooltipFieldElevation=class extends c.TooltipField{constructor(e){super(e),this.showAsZ=!1}normalizeCtorArgs(e){const t=e=>e.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:i.zeroMeters,parse:l.makeQuantityParser({createQuantity:(e,n)=>i.createLength(e,t(n))}),format:(e,t)=>t.formatters.verticalLength(e),formatForInputMode:(e,n)=>n.formatters.scalar(i.toUnit(e,t(n))),suffix:e=>e.inputUnitInfos.verticalLength.abbreviation,title:e=>e.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...e}}},t.__decorate([n.property()],e.TooltipFieldElevation.prototype,"showAsZ",void 0),e.TooltipFieldElevation=t.__decorate([a.subclass("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],e.TooltipFieldElevation),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/fields/TooltipFieldOrientation":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/quantityFormatUtils","../../../../core/quantityUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./parsingAndFormattingUtils","./TooltipField","../../../support/angularMeasurementUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";e.TooltipFieldOrientation=class extends h.TooltipField{constructor(e){super(e),this.precision=1}normalizeCtorArgs(e){return{name:"orientation",actual:null,parse:c.makeQuantityParser({createQuantity:(e,t)=>n.createAngle(e,(e=>e.inputUnitInfos.angle.unit)(t),"geographic"),sanitize:c.sanitizeAngle}),format:e=>{const t=u.getNormalizedGeographicOrientation(e);return i.formatAngle(t,"geographic",this.precision)},formatForInputMode:(e,t)=>{const i=u.getNormalizedGeographicOrientation(e);return t.formatters.scalar(i)},suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.orientation,...e}}},t.__decorate([s.property()],e.TooltipFieldOrientation.prototype,"precision",void 0),e.TooltipFieldOrientation=t.__decorate([l.subclass("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],e.TooltipFieldOrientation),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/fields/TooltipFieldSize":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/quantityUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./parsingAndFormattingUtils","./TooltipField"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";e.TooltipFieldSize=class extends c.TooltipField{constructor(e){super(e),this.precision=null}normalizeCtorArgs(e){const t=e=>e.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:l.makeQuantityParser({createQuantity:(e,n)=>i.createLength(e,t(n))}),format:(e,t)=>t.formatters.length(e),formatForInputMode:(e,n)=>n.formatters.scalar(i.toUnit(e,t(n))),suffix:e=>e.inputUnitInfos.length.abbreviation,title:e=>e.messages.sketch.size,...e}}},t.__decorate([n.property()],e.TooltipFieldSize.prototype,"precision",void 0),e.TooltipFieldSize=t.__decorate([a.subclass("esri.views.interactive.tooltip.fields.TooltipFieldSize")],e.TooltipFieldSize),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/TooltipInfoWithCoordinates":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/quantityUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/support/pointUtils","../fields/fields","../fields/parsingAndFormattingUtils","../../../support/geodesicMeasurementUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";const m=[0,0];e.TooltipInfoWithCoordinates=e=>{let s=class extends e{constructor(){super(...arguments),this.longitude=c.makeLongitudeField(),this.latitude=c.makeLatitudeField(),this.x=c.makeXField(),this.y=c.makeYField(),this.elevation=c.makeElevationField(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(e,t=e?.spatialReference){if(this.geographic=!!t&&u.supportsGeodesicMeasurement(t),null==e)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const t=l.getLongitudeLatitude(e,m);this._setActualLonLat(h.createGeographicCoordinate(t?.[0]),h.createGeographicCoordinate(t?.[1]))}else this._setActualXY(i.createScalar(e.x),i.createScalar(e.y))}_setActualLonLat(e,t){this.longitude.actual=e,this.latitude.actual=t}_setActualXY(e,t){this.x.actual=e,this.y.actual=t}};return t.__decorate([n.property()],s.prototype,"geographic",void 0),t.__decorate([n.property()],s.prototype,"effectiveX",null),t.__decorate([n.property()],s.prototype,"effectiveY",null),t.__decorate([n.property()],s.prototype,"key",null),s=t.__decorate([a.subclass("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],s),s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/geodesicMeasurementUtils":function(){define(["exports","../../geometry/support/geodesicUtils","../../geometry/support/spatialReferenceUtils"],(function(e,t,i){"use strict";e.geodesicDistanceThreshold=1e5,e.geodesicMeasure=function(e,i,n,...s){return t.isSupported(e)?i.apply(void 0,s):e.isWebMercator?n.apply(void 0,s):null},e.supportsGeodesicMeasurement=function(e){return t.isSupported(e)||i.isWebMercator(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/DrawMultipointTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./SketchTooltipInfo","./TooltipInfoWithCoordinates"],(function(e,t,i,n,s,r,o,a,l){"use strict";e.DrawMultipointTooltipInfo=class extends(l.TooltipInfoWithCoordinates(a.SketchTooltipInfo)){constructor(e){super(e),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}},t.__decorate([i.property()],e.DrawMultipointTooltipInfo.prototype,"helpMessage",void 0),t.__decorate([i.property()],e.DrawMultipointTooltipInfo.prototype,"allFields",null),e.DrawMultipointTooltipInfo=t.__decorate([o.subclass("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],e.DrawMultipointTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/DrawPointTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./SketchTooltipInfo","./TooltipInfoWithCoordinates"],(function(e,t,i,n,s,r,o,a,l){"use strict";e.DrawPointTooltipInfo=class extends(l.TooltipInfoWithCoordinates(a.SketchTooltipInfo)){constructor(e){super(e),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}},t.__decorate([i.property()],e.DrawPointTooltipInfo.prototype,"helpMessage",void 0),t.__decorate([i.property()],e.DrawPointTooltipInfo.prototype,"allFields",null),e.DrawPointTooltipInfo=t.__decorate([o.subclass("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],e.DrawPointTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/DrawPolygonTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../fields/fields","./SketchTooltipInfo","./TooltipInfoWithCoordinates"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";e.DrawPolygonTooltipInfo=class extends(c.TooltipInfoWithCoordinates(l.SketchTooltipInfo)){constructor(e){super(e),this.type="draw-polygon",this.direction=a.makeDirectionField(),this.distance=a.makeDistanceField(),this.area=a.makeAreaField(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}},t.__decorate([i.property()],e.DrawPolygonTooltipInfo.prototype,"xyMode",void 0),t.__decorate([i.property()],e.DrawPolygonTooltipInfo.prototype,"helpMessage",void 0),t.__decorate([i.property()],e.DrawPolygonTooltipInfo.prototype,"allFields",null),e.DrawPolygonTooltipInfo=t.__decorate([o.subclass("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],e.DrawPolygonTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/DrawPolylineTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../fields/fields","./SketchTooltipInfo","./TooltipInfoWithCoordinates"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";e.DrawPolylineTooltipInfo=class extends(c.TooltipInfoWithCoordinates(l.SketchTooltipInfo)){constructor(e){super(e),this.type="draw-polyline",this.direction=a.makeDirectionField(),this.distance=a.makeDistanceField(),this.totalLength=a.makeTotalLengthField(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}},t.__decorate([i.property()],e.DrawPolylineTooltipInfo.prototype,"helpMessage",void 0),t.__decorate([i.property()],e.DrawPolylineTooltipInfo.prototype,"xyMode",void 0),t.__decorate([i.property()],e.DrawPolylineTooltipInfo.prototype,"allFields",null),e.DrawPolylineTooltipInfo=t.__decorate([o.subclass("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],e.DrawPolylineTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/DrawRectangleTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/quantityUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./SketchTooltipInfo"],(function(e,t,i,n,s,r,o,a,l){"use strict";e.DrawRectangleTooltipInfo=class extends l.SketchTooltipInfo{constructor(e){super(e),this.type="draw-rectangle",this.xSize=i.zeroMeters,this.ySize=i.zeroMeters,this.area=i.zeroSquareMeters}get allFields(){return[]}},t.__decorate([n.property()],e.DrawRectangleTooltipInfo.prototype,"type",void 0),t.__decorate([n.property()],e.DrawRectangleTooltipInfo.prototype,"xSize",void 0),t.__decorate([n.property()],e.DrawRectangleTooltipInfo.prototype,"ySize",void 0),t.__decorate([n.property()],e.DrawRectangleTooltipInfo.prototype,"area",void 0),t.__decorate([n.property()],e.DrawRectangleTooltipInfo.prototype,"helpMessage",void 0),t.__decorate([n.property()],e.DrawRectangleTooltipInfo.prototype,"allFields",null),e.DrawRectangleTooltipInfo=t.__decorate([a.subclass("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],e.DrawRectangleTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/euclideanLengthMeasurementUtils":function(){define(["exports","../../core/quantityUtils","../../core/unitUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/projection/projectVectorToVector","../../geometry/support/spatialReferenceUtils","./measurementUtils"],(function(e,t,i,n,s,r,o,a){"use strict";var l;function c(e,n){const{hasZ:s,spatialReference:r}=e,o=a.computeEuclideanMeasurementSR(r);let c=0;const h=i.lengthUnitFromSpatialReference(o);if(null==h)return null;const u=n===l.Direct?m:d;for(const t of e.paths){if(t.length<2)continue;const e=t.length-1;for(let i=0;i<e;++i){const e=t[i];_[0]=e[0],_[1]=e[1],_[2]=s?e[2]:0;const n=t[i+1];f[0]=n[0],f[1]=n[1],f[2]=s?n[2]:0;const o=u(_,f,r);if(null==o)return null;c+=o.value}}return t.createLength(c,h)}function h(e,n){const s=i.verticalLengthUnitFromSpatialReference(n);return null!=s?t.createLength(e??0,s):null}function u(e,i,n){const s=g(e,i,n);return null!=s?{direct:t.createLength(s.direct,s.unit),horizontal:t.createLength(s.horizontal,s.unit),vertical:t.createLength(s.vertical,s.unit)}:null}function m(e,i,n){const s=g(e,i,n,l.Direct);return null!=s?t.createLength(s.direct,s.unit):null}function d(e,i,n){const s=g(e,i,n,l.Horizontal);return null!=s?t.createLength(s.horizontal,s.unit):null}function p(e,i,n){const s=g(e,i,n,l.Vertical);return null!=s?t.createLength(s.verticalSigned,s.unit):null}function g(e,t,s,o){const c=a.computeEuclideanMeasurementSR(s),h=i.lengthUnitFromSpatialReference(c);if(null==h)return null;const u=t[2]-e[2];if(o===l.Vertical)return{verticalSigned:u,unit:h};if(!r.projectVectorToVector(e,s,y,c)||!r.projectVectorToVector(t,s,x,c))return null;if(o===l.Direct)return{direct:n.distance(x,y),unit:h};if(n.set(v,e[0],e[1],t[2]),!r.projectVectorToVector(v,s,v,c))return null;const m=n.distance(v,x);return o===l.Horizontal?{horizontal:m,unit:h}:{direct:n.distance(x,y),horizontal:m,vertical:Math.abs(u),unit:h}}!function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(l||(l={}));const _=s.create(),f=s.create(),y=s.create(),x=s.create(),v=s.create();e.elevationFromPoint=function(e){return null!=e?h(e.hasZ?e.z:0,e.spatialReference):null},e.elevationFromZ=h,e.euclideanDirectDistance=m,e.euclideanDirectDistanceBetweenPoints=function(e,t){const{spatialReference:i}=e;return o.equals(i,t.spatialReference)?(_[0]=e.x,_[1]=e.y,_[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,m(_,f,i)):null},e.euclideanDistance=u,e.euclideanDistanceBetweenPoints=function(e,t){const{spatialReference:i}=e;return o.equals(i,t.spatialReference)?(_[0]=e.x,_[1]=e.y,_[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,u(_,f,i)):null},e.euclideanHorizontalDistance=d,e.euclideanHorizontalDistanceBetweenPoints=function(e,t){const{spatialReference:i}=e;return o.equals(i,t.spatialReference)?(_[0]=e.x,_[1]=e.y,_[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,d(_,f,i)):null},e.euclideanHorizontalLength=function(e){return c(e,l.Horizontal)},e.euclideanLength=function(e){return c(e,l.Direct)},e.verticalDistance=function(e,i,n){const s=g(e,i,n,l.Vertical);return null!=s?t.createLength(Math.abs(s.verticalSigned),s.unit):null},e.verticalSignedDistance=p,e.verticalSignedDistanceBetweenPoints=function(e,t){const{spatialReference:i}=e;return o.equals(i,t.spatialReference)?(_[0]=e.x,_[1]=e.y,_[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,p(_,f,i)):null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/measurementUtils":function(){define(["exports","../../geometry/ellipsoidUtils","../../geometry/spatialReferenceEllipsoidUtils","../../geometry/support/spatialReferenceUtils"],(function(e,t,i,n){"use strict";e.computeEuclideanMeasurementSR=function(e){return n.isEarth(e)?n.isWGS84(e)||n.isWebMercator(e)||n.isCGCS2000(e)||t.isSphericalECEF(e)?i.WGS84ECEFSpatialReference:e:i.getSphericalPCPF(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/InteractiveToolBase":function(){define(["exports","../../chunks/tslib.es6","../../core/Evented","../../core/has","../../core/Logger","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./interfaces","./ManipulatorCollection"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.InteractiveToolBase=class extends i.EventedAccessor{constructor(e){super(e),this.manipulators=new h.ManipulatorCollection,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[c.EditableFlag.MANAGER,!0],[c.EditableFlag.USER,!0]]),this._creationFinishedResolver=r.createResolver()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(c.EditableFlag.USER)}set editable(e){this.setEditableFlag(c.EditableFlag.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}cancel(){this.emit("cancel")}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===c.EditableFlag.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){const e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach((({manipulator:i})=>{i.dragging&&(t=!0,i.events.emit("drag",{action:"end",start:e,screenPoint:e}))})),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(c.EditableFlag.USER)&&this.getEditableFlag(c.EditableFlag.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}},t.__decorate([o.property({constructOnly:!0})],e.InteractiveToolBase.prototype,"view",void 0),t.__decorate([o.property({readOnly:!0})],e.InteractiveToolBase.prototype,"active",null),t.__decorate([o.property({value:!0})],e.InteractiveToolBase.prototype,"visible",null),t.__decorate([o.property({value:!0})],e.InteractiveToolBase.prototype,"editable",null),t.__decorate([o.property({readOnly:!0})],e.InteractiveToolBase.prototype,"manipulators",void 0),t.__decorate([o.property({readOnly:!0})],e.InteractiveToolBase.prototype,"updating",null),t.__decorate([o.property()],e.InteractiveToolBase.prototype,"cursor",null),t.__decorate([o.property({readOnly:!0})],e.InteractiveToolBase.prototype,"automaticManipulatorSelection",void 0),t.__decorate([o.property()],e.InteractiveToolBase.prototype,"hasFocusedManipulators",null),t.__decorate([o.property()],e.InteractiveToolBase.prototype,"hasGrabbedManipulators",void 0),t.__decorate([o.property()],e.InteractiveToolBase.prototype,"hasHoveredManipulators",void 0),t.__decorate([o.property()],e.InteractiveToolBase.prototype,"firstGrabbedManipulator",void 0),t.__decorate([o.property({readOnly:!0})],e.InteractiveToolBase.prototype,"created",void 0),t.__decorate([o.property({readOnly:!0})],e.InteractiveToolBase.prototype,"removeIncompleteOnCancel",void 0),e.InteractiveToolBase=t.__decorate([l.subclass("esri.views.interactive.InteractiveToolBase")],e.InteractiveToolBase),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/ManipulatorCollection":function(){define(["exports","../../core/Collection"],(function(e,t){"use strict";var i;e.ManipulatorVisibilityPredicate=void 0,(i=e.ManipulatorVisibilityPredicate||(e.ManipulatorVisibilityPredicate={}))[i.WhenToolEditable=0]="WhenToolEditable",i[i.WhenToolNotEditable=1]="WhenToolNotEditable",i[i.Always=2]="Always",e.ManipulatorCollection=class{constructor(){this._isToolEditable=!0,this._manipulators=new t,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(t,i=e.ManipulatorVisibilityPredicate.WhenToolEditable){this.addMany([t],i)}addMany(t,i=e.ManipulatorVisibilityPredicate.WhenToolEditable){for(const e of t){const t={manipulator:e,visibilityPredicate:i,attached:!1};this._manipulators.add(t),this._attached&&this._updateManipulatorAttachment(t)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((({manipulator:e})=>e.destroy())),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let i=null,n=Number.MAX_VALUE;return this._manipulators.forEach((({manipulator:s,attached:r})=>{if(!r||!s.interactive)return;const o=s.intersectionDistance(e,t);null!=o&&o<n&&(n=o,i=s)})),i}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===e.ManipulatorVisibilityPredicate.Always||(this._isToolEditable?t.visibilityPredicate===e.ManipulatorVisibilityPredicate.WhenToolEditable:t.visibilityPredicate===e.ManipulatorVisibilityPredicate.WhenToolNotEditable)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/sketch/SketchOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./SketchLabelOptions","./SketchTooltipOptions","./SketchValueOptions"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";return e.default=class extends i{constructor(e){super(e),this.labels=new l,this.tooltips=new c,this.values=new h}},t.__decorate([n.property({nonNullable:!0,type:l})],e.default.prototype,"labels",void 0),t.__decorate([n.property({nonNullable:!0,type:c})],e.default.prototype,"tooltips",void 0),t.__decorate([n.property({nonNullable:!0,type:h})],e.default.prototype,"values",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchOptions")],e.default),e.default}))},"esri/views/interactive/sketch/SketchLabelOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,i,n,s,r,o,a){"use strict";return e.default=class extends i{constructor(e){super(e),this.enabled=!1}},t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"enabled",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchLabelOptions")],e.default),e.default}))},"esri/views/interactive/sketch/SketchTooltipOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./SketchTooltipElevationOptions","./SketchTooltipVisibleElements"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";return e.default=class extends i{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new l.SketchTooltipElevationOptions,this.placement="auto",this.offset=null,this.visibleElements=new c,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}},t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"enabled",void 0),t.__decorate([n.property()],e.default.prototype,"forceEnabled",void 0),t.__decorate([n.property()],e.default.prototype,"effectiveEnabled",null),t.__decorate([n.property()],e.default.prototype,"helpMessage",void 0),t.__decorate([n.property()],e.default.prototype,"helpMessageIcon",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"inputEnabled",void 0),t.__decorate([n.property({type:l.SketchTooltipElevationOptions,nonNullable:!0})],e.default.prototype,"elevation",void 0),t.__decorate([n.property()],e.default.prototype,"placement",void 0),t.__decorate([n.property()],e.default.prototype,"offset",void 0),t.__decorate([n.property({type:c,nonNullable:!0})],e.default.prototype,"visibleElements",void 0),t.__decorate([n.property()],e.default.prototype,"visualVariables",void 0),t.__decorate([n.property()],e.default.prototype,"xyMode",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchTooltipOptions")],e.default),e.default}))},"esri/views/interactive/sketch/SketchTooltipElevationOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,i,n,s,r,o,a){"use strict";e.SketchTooltipElevationOptions=class extends i{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}},t.__decorate([n.property({type:String,nonNullable:!0})],e.SketchTooltipElevationOptions.prototype,"mode",void 0),e.SketchTooltipElevationOptions=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchTooltipElevationOptions")],e.SketchTooltipElevationOptions),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/sketch/SketchTooltipVisibleElements":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,i,n,s,r,o,a){"use strict";return e.default=class extends i{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}},t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"area",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"coordinates",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"direction",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"distance",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"elevation",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"header",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"helpMessage",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"orientation",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"radius",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"rotation",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"scale",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"size",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"totalLength",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchTooltipVisibleElements")],e.default),e.default}))},"esri/views/interactive/sketch/SketchValueOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./Units","../../support/angularMeasurementUtils"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";return e.default=class extends i{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?c.DirectionMode.RelativeBilateral:c.DirectionMode.Relative;case"absolute":return c.DirectionMode.Absolute}}get displayUnits(){return this._get("displayUnits")??new l}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new l}set inputUnits(e){this._set("inputUnits",e)}},t.__decorate([n.property({type:String,nonNullable:!0})],e.default.prototype,"directionMode",void 0),t.__decorate([n.property({type:Boolean,nonNullable:!0})],e.default.prototype,"relativeDirectionIsBilateral",void 0),t.__decorate([n.property()],e.default.prototype,"effectiveDirectionMode",null),t.__decorate([n.property({type:l,nonNullable:!0})],e.default.prototype,"displayUnits",null),t.__decorate([n.property({type:l,nonNullable:!0})],e.default.prototype,"inputUnits",null),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchValueOptions")],e.default),e.default}))},"esri/views/interactive/sketch/Units":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,i,n,s,r,o,a){"use strict";return e.default=class extends i{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}},t.__decorate([n.property()],e.default.prototype,"length",void 0),t.__decorate([n.property()],e.default.prototype,"verticalLength",void 0),t.__decorate([n.property()],e.default.prototype,"area",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.Units")],e.default),e.default}))},"esri/views/draw/DrawOperation":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/Evented","../../core/lang","../../core/maybe","../../core/memoize","../../core/promiseUtils","../../core/ReactiveSet","../../core/reactiveUtils","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/diffUtils","../../core/support/UpdatingHandles","../../layers/graphics/dehydratedFeatureComparison","../../support/elevationInfoUtils","../ViewingMode","./DrawingMode","./DrawManipulator","../interactive/coordinateHelper","../interactive/dragEventPipeline","../interactive/editGeometry/EditGeometry","../interactive/editGeometry/EditGeometryOperations","../interactive/sketch/constraints","../interactive/sketch/constraintUtils","../interactive/sketch/SketchLabelOptions","../interactive/snapping/SnappingContext","../interactive/snapping/SnappingDragPipelineStep","../interactive/snapping/SnappingOperation","../interactive/snapping/snappingUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C,w,T,D,I,A,M,N){"use strict";const R="crosshair",O="progress",G=Symbol(),k=Symbol();e.DrawOperation=class extends(n.EventedMixin(i)){constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new l,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new _.UpdatingHandles,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=o.memoize(T.getPointConstraint),this._getPolylineOrPolygonConstraint=o.memoize(T.getPolylineOrPolygonConstraint),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new D,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,null==e.elevationInfo&&(this.elevationInfo=y.getEffectiveElevationInfo(!!e.hasZ))}initialize(){const{geometryType:e,view:t}=this,i=t.spatialReference,n="viewingMode"in t.state?t.state.viewingMode:x.ViewingMode.Local,s="segment"===e||"multipoint"===e?"polyline":e;this.coordinateHelper=b.createCoordinateHelper(this.hasZ,this.hasM,i),this._editGeometryOperations=new C.EditGeometryOperations(new S.EditGeometry(s,this.coordinateHelper),n),this._snappingOperation=new M.SnappingOperation({view:t}),this.addHandles([c.watch((()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint})),(({stagedPoint:e,constraint:t},i)=>{const{snappingOptions:n}=this;if(n&&(n.forceDisabled=null!=t&&w.isPoint(t)),null!=i&&e===i.stagedPoint&&t!==i.constraint)return this._onKeyboardBasedChange();this._processCursor(e??this._screenToMap(this._stagedScreenPoint))}),{equals:(e,t)=>e.stagedPoint===t.stagedPoint&&r.equalsMaybe(e.constraint,t.constraint)}),c.watch((()=>this.view.viewpoint),((e,t)=>{e&&t&&g.diff(e,t)&&this._onKeyboardBasedChange()}))]),this._activeComponent=new S.Component(i,n),this._editGeometryOperations.data.components.push(this._activeComponent);const o=this.segmentLabels;null!=o&&(o.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},this.addHandles(c.watch((()=>this.labelOptions.enabled),(e=>{o.visible=e}),c.syncAndInitial))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(e=>{const t=e.vertices.map((e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)}))),i=t.map((e=>e.coordinates)),n=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;f.pointEquals(n,this.firstVertex)||(this.firstVertex=n);const s=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;f.pointEquals(s,this.lastVertex)||(this.lastVertex=s);const r=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch(f.pointEquals(r,this.secondToLastVertex)||(this.secondToLastVertex=r),this._processCursor(this.cursorVertex),e.type){case"vertex-add":this.emit(e.type,{...e,added:i,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:i,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:i,vertices:t})}})));const l=this._manipulator=new P.DrawManipulator({consumesClicks:!1,grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size});this.manipulators.add(l),l.grabbable="point"!==e&&"multipoint"!==e,this.addHandles([l.events.on("immediate-click",(e=>this._onImmediateClick(e))),l.events.on("immediate-double-click",(e=>this._onImmediateDoubleClick(e))),c.watch((()=>this.drawingMode),(()=>{this.removeHandles(G),this.addHandles(this._createManipulatorDragPipeline(l),G)}),c.syncAndInitial),c.watch((()=>({effectiveCursor:this.effectiveCursor})),(({effectiveCursor:e})=>{l.cursor=e}),c.syncAndInitial)]),N.setupSnappingToggleHandles(this,(()=>{const e=this.view.inputManager.latestPointerType??"mouse",t=this._getSnappingContext(e);if(null!=this.snappingManager){const e=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,t);this._updatingHandles.addPromise(a.ignoreAbortErrors(e))}}))}destroy(){r.destroyMaybe(this.segmentLabels),r.destroyMaybe(this._snappingOperation),this._editGeometryOperations=r.destroyMaybe(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:e,_manipulator:t}=this;return null!=e&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return null!=this.snappingManager&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._updateAndGetEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((e=>this.coordinateHelper.vectorToArray(e.pos)))}get _constraint(){const{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case"point":case"multipoint":return this._getPointConstraint(e);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set("drawingMode",e??v.defaultDrawingMode)}get effectiveCursor(){return this.loading?O:this._hideDefaultCursor?null:this.cursor||R}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return null!=this.snappingManager?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return"mouse"===this._stagedPointerType?this.cursorVertex:null}get committableVertex(){const{cursorVertex:e,lastVertex:t,firstVertex:i,geometryType:n}=this;return"polygon"===n&&f.pointNear(e,i)||f.pointNear(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:e,committableVertex:t,coordinateHelper:i}=this,n=e.slice();return null!=t&&n.push(i.pointToArray(t)),n}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:e}=this;null!=e&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}complete(e){const t=e?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:i,numCommittedVertices:n}=this,s="multipoint"===i&&0===n||"polyline"===i&&n<2||"polygon"===i&&n<3;"segment"!==i&&"point"!==i||this.commitStagedVertex(),this._createOperationCompleted=!s,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map(((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e}))),aborted:t,type:"complete"}))}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){const t=s.clone(this.cursorVertex),i=s.clone(e),n=i&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(i)??i),r=this._snapToClosingVertex(n),o=this._applyConstraints(r);f.pointNear(t,o)||(this._set("cursorVertex",o),this.segmentLabels?.set("stagedVertex",null!=o?this.coordinateHelper.pointToVector(o):null),null==o||"mouse"!==this._stagedPointerType?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(o)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(e){if(null==e||this._isDragging||"polygon"!==this.geometryType||this.numCommittedVertices<=2)return e;const t=this._mapToScreen(e);if(!t)return e;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return E.createManipulatorDragEventPipeline(e,((e,t,i,n)=>{const s="touch"===n&&this._snappingEnabled;if(this.isCompleted||!s)return;const{snappingStep:r,cancelSnapping:o}=A.createSnapDragEventPipelineStep({predicate:()=>s,snappingManager:this.snappingManager,snappingContext:new I.SnappingContext({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:n,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});i=i.next((e=>(s&&null!=this.snappingManager&&this.snappingManager.doneSnapping(),e))).next(o),t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._processCursor(e.mapStart),("segment"===this.geometryType||s&&!this.numCommittedVertices)&&this.commitStagedVertex()),e))).next(E.sceneSnappingAtLocation(this.view,this.elevationInfo)).next(...r).next((e=>(s&&(this._processCursor(e.mapEnd),"end"===e.action&&this.commitStagedVertex()),e))).next((e=>("end"===e.action&&("mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e)))}))}_createManipulatorDragPipelineFreehand(e){return E.createManipulatorDragEventPipeline(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._snappingOperation.abort(),null==this.committableVertex&&this._processCursor(e.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this._processCursor(e.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e}))}))}_createManipulatorDragPipelineHybrid(e){return E.createManipulatorDragEventPipeline(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),k),this._processCursor(e.mapStart),this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this._processCursor(e.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),this.removeHandles(k),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e}))}))}get _drawAtFixedElevation(){const{constraintsEnabled:e,constraintZ:t,geometryType:i,numCommittedVertices:n}=this;return e?null!=t||"segment"===i&&n>0:("segment"===i||"polygon"===i)&&n>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:e,coordinateHelper:t,drawSurface:i,elevationDrawSurface:n,snapToSceneEnabled:s}=this;if(null==n)return i;if(!this.hasZ)return n.defaultZ=null,n;const r=this.elevationInfo?.mode;let o=this.defaultZ,a=e||"absolute-height"===r;return null!=s&&(a=s),"on-the-ground"===r&&(a=!1),this._drawAtFixedElevation&&(o=(e?this.constraintZ:null)??t.getZ(this._activeComponent.vertices[0].pos),a=!1),a?i:(n.defaultZ=o,n)}_mapToScreen(e){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!("mouse"===e.pointerType&&2===e.button||this._manipulator.dragging))try{const{drawingMode:t,geometryType:i}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;const n=this._screenToMap(e.screenPoint);if(null==n)return;if(null==n||"freehand"===t&&"point"!==i&&"multipoint"!==i)return;if(this._snappingEnabled&&null!=this.cursorVertex||this._processCursor(n),null==this.committableVertex)return void this.complete();this.commitStagedVertex(),"mouse"!==e.pointerType&&this._processCursor(null),("freehand"===t&&"multipoint"!==this.geometryType||"point"===i||"segment"===i&&2===this.numCommittedVertices||"segment"===i&&"hybrid"===t&&1===this.numCommittedVertices)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=h.createScreenPoint(e.x,e.y);this._stagedScreenPoint=t,this._stagedPointerType=e.pointerType,this._stagedPointerId=e.pointerId,this._isDragging?this._snappingOperation.abort():(e.stopPropagation(),this._processCursorMovementRelativeToSurface(t,e.pointerType))}_onKeyboardBasedChange(){"mouse"===this._stagedPointerType&&this._stagedScreenPoint&&null!=this._stagedPointerId&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){const i=this._snappingOperation,n=this._screenToMap(e),s=this._requiresScenePoint?this.drawSurface?.screenToMap(e):null;if(null==n)return this._hideDefaultCursor=!0,this._processCursor(null),void i.abort();this._hideDefaultCursor=!1;const r=this.snappingManager;if(null==r)return this._processCursor(n),void i.abort();const o=this._getSnappingContext(t);this._updatingHandles.addPromise(a.ignoreAbortErrors(i.snap({point:n,scenePoint:s},r,o)))}_applyConstraints(e){const{_constraint:t,constraints:i}=this;if(!e||!i||!t)return e;const{context:n}=i,s=T.pointToConstraintSpace(e,n),r=s?t.closestTo(s):void 0;if(!r)return e;const o=T.constraintSpaceToPoint(r,e,n),a="2d"===this.view.type||"absolute-height"!==n.elevationInfo.mode;return null!=o&&a&&null!=this.constraintZ&&this.hasZ&&(o.z=this.constraintZ),o}_screenToMap(e){return e?this._updateAndGetEffectiveDrawSurface()?.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),null==e)return null;const i=this._screenToMap(t.screenEnd);return null!=i?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return null!=i&&function(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n<=25}(i,t)}_getSnappingContext(e){const t=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new I.SnappingContext({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:null!=t?{value:t,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}},t.__decorate([u.property()],e.DrawOperation.prototype,"_hideDefaultCursor",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"_stagedPointerId",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"_isDragging",null),t.__decorate([u.property()],e.DrawOperation.prototype,"_snappingOperation",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"_snappingEnabled",null),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"graphic",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"constraintsEnabled",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"constraints",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"_constraint",null),t.__decorate([u.property()],e.DrawOperation.prototype,"constraintZ",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"defaultZ",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"isDraped",void 0),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"automaticLengthMeasurementUtils",void 0),t.__decorate([u.property({value:v.defaultDrawingMode})],e.DrawOperation.prototype,"drawingMode",null),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"elevationDrawSurface",void 0),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"elevationInfo",void 0),t.__decorate([u.property({constructOnly:!0,type:D})],e.DrawOperation.prototype,"labelOptions",void 0),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"geometryType",void 0),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"hasM",void 0),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"hasZ",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"cursor",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"effectiveCursor",null),t.__decorate([u.property()],e.DrawOperation.prototype,"loading",void 0),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"manipulators",void 0),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"drawSurface",void 0),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"segmentLabels",void 0),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"snappingManager",void 0),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"snappingVisualizer",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"snapToSceneEnabled",void 0),t.__decorate([u.property({readOnly:!0})],e.DrawOperation.prototype,"cursorVertex",null),t.__decorate([u.property({readOnly:!0})],e.DrawOperation.prototype,"visualizationCursorVertex",null),t.__decorate([u.property()],e.DrawOperation.prototype,"committableVertex",null),t.__decorate([u.property()],e.DrawOperation.prototype,"firstVertex",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"lastVertex",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"secondToLastVertex",void 0),t.__decorate([u.property()],e.DrawOperation.prototype,"updating",null),t.__decorate([u.property({constructOnly:!0})],e.DrawOperation.prototype,"view",void 0),e.DrawOperation=t.__decorate([p.subclass("esri.views.draw.DrawOperation")],e.DrawOperation),e.defaultCursor=R,e.defaultLoadingCursor=O,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/draw/DrawingMode":function(){define(["exports"],(function(e){"use strict";e.defaultDrawingMode="click",e.drawingModes=["freehand","hybrid","click"],Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/draw/DrawManipulator":function(){define(["exports","../../core/Evented"],(function(e,t){"use strict";e.DrawManipulator=class{constructor({consumesClicks:e,grabbableForEvent:i}){this.events=new t,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=i}destroy(){}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/coordinateHelper":function(){define(["exports","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../chunks/vec42","../../core/libs/gl-matrix-2/factories/vec4f64","../../geometry/Point"],(function(e,t,i,n,s,r,o,a){"use strict";var l;!function(e){e[e.Z=0]="Z",e[e.M=1]="M"}(l||(l={}));class c{constructor(e){this.spatialReference=e}createVector(){return this._tag(i.create())}pointToVector(e){return this._tag(i.fromValues(e.x,e.y))}arrayToVector(e){return this._tag(i.fromValues(e[0],e[1]))}vectorToArray(e){return[e[0],e[1]]}pointToArray(e){return[e.x,e.y]}vectorToPoint(e,t=new a){if(e)return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new a){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}lerp(e,i,n,s){return t.lerp(s,e,i,n)}addDelta(e,t,i){e[0]+=t,e[1]+=i}distance(e,i){return t.distance(e,i)}getZ(e,t=void 0){return t}hasZ(){return!1}getM(e,t=void 0){return t}hasM(){return!1}clone(e){return this._tag(i.fromArray(e))}copy(e,i){return t.copy(i,e)}fromXYZ(e){return this._tag(i.fromValues(e[0],e[1]))}toXYZ(e,t=s.create()){return n.set(t,e[0],e[1],0)}pointToXYZ(e,t=s.create()){return n.set(t,e.x,e.y,0)}equals(e,i){return t.equals(e,i)}_tag(e){return e}}class h{constructor(e,t){this._valueType=e,this.spatialReference=t}createVector(){return this._tag(s.create())}pointToVector(e){return this._tag(s.fromValues(e.x,e.y,this._valueType===l.Z?e.z:e.m))}arrayToVector(e){return this._tag(s.fromValues(e[0],e[1],e[2]||0))}vectorToArray(e){return[e[0],e[1],e[2]]}pointToArray(e){return this._valueType===l.Z?[e.x,e.y,e.z]:[e.x,e.y,e.m]}vectorToPoint(e,t=new a){if(e)return t.x=e[0],t.y=e[1],t.z=this._valueType===l.Z?e[2]:void 0,t.m=this._valueType===l.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new a){return t.x=e[0],t.y=e[1],t.z=this._valueType===l.Z?e[2]:void 0,t.m=this._valueType===l.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(!e)return;t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};const i=this._valueType===l.Z,n=this._valueType===l.M;return t.x=e[0],t.y=e[1],t.z=i?e[2]:void 0,t.m=n?e[2]:void 0,t.hasZ=i,t.hasM=n,t.spatialReference=this.spatialReference,t}lerp(e,t,i,s){return n.lerp(s,e,t,i)}addDelta(e,t,i,n){e[0]+=t,e[1]+=i,this._valueType===l.Z&&(e[2]+=n)}distance(e,i){return this._valueType===l.Z?n.distance(e,i):t.distance(e,i)}getZ(e,t=void 0){return this._valueType===l.Z?e[2]:t}hasZ(){return this._valueType===l.Z}getM(e,t=void 0){return this._valueType===l.M?e[2]:t}hasM(){return this._valueType===l.M}clone(e){return this._tag(s.fromArray(e))}copy(e,t){return n.copy(t,e)}fromXYZ(e,t=0,i=0){return this._tag(s.fromValues(e[0],e[1],this._valueType===l.Z?e.length>2?e[2]:t:i))}toXYZ(e,t=s.create()){return n.set(t,e[0],e[1],this._valueType===l.Z?e[2]:0)}pointToXYZ(e,t=s.create()){return n.set(t,e.x,e.y,this._valueType===l.Z?e.z??0:0)}equals(e,t){return n.equals(e,t)}_tag(e){return e}}class u{constructor(e){this.spatialReference=e}createVector(){return this._tag(o.create())}pointToVector(e){return this._tag(o.fromValues(e.x,e.y,e.z,e.m))}arrayToVector(e){return this._tag(o.fromValues(e[0],e[1],e[2]||0,e[3]||0))}vectorToArray(e){return[e[0],e[1],e[2],e[3]]}pointToArray(e){return[e.x,e.y,e.z,e.m]}vectorToPoint(e,t=new a){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new a){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}lerp(e,t,i,n){return r.lerp(n,e,t,i)}addDelta(e,t,i,n){e[0]+=t,e[1]+=i,e[2]+=n}distance(e,t){return n.distance(e,t)}getZ(e){return e[2]}hasZ(){return!0}getM(e){return e[3]}hasM(){return!0}clone(e){return this._tag(o.fromArray(e))}copy(e,t){return r.copy(t,e)}fromXYZ(e,t=0,i=0){return this._tag(o.fromValues(e[0],e[1],e.length>2?e[2]:t,i))}toXYZ(e,t=s.create()){return n.set(t,e[0],e[1],e[2])}pointToXYZ(e,t=s.create()){return n.set(t,e.x,e.y,e.z??0)}equals(e,t){return r.equals(e,t)}_tag(e){return e}}e.CoordinateHelper2D=c,e.CoordinateHelper3D=h,e.CoordinateHelper4D=u,e.createCoordinateHelper=function(e,t,i){return e&&t?new u(i):t?new h(l.M,i):e?new h(l.Z,i):new c(i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/dragEventPipeline":function(){define(["exports","../../core/arrayUtils","../../core/has","../../core/lang","../../core/mathUtils","../../core/screenUtils","../../geometry/projectionUtils","../../geometry/support/meshVertexSpaceUtils","../../layers/graphics/hydratedFeatures","../../support/elevationInfoUtils","./editGeometry/EditGeometryOperations"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";function u(e,t){let i=null,n=null;return s=>{if("cancel"===s.action)return void(null!=n&&(n.execute({action:"cancel"}),i=null,n=null));const r={action:s.action,screenStart:s.start,screenEnd:s.screenPoint};"start"===s.action&&null==i&&(i=new f,n=new f,t(e,i,n,s.pointerType,r)),null!=i&&i.execute(r),"end"===s.action&&null!=i&&(i=null,n=null)}}function m(e){let t=null;return i=>{if("start"===i.action&&(t=function(e,t){const i=e.operations;if(!i)return null;const n=i.data.geometry,s=l.hydratedSpatialReference(t);if(n.spatialReference.equals(s))return p(e,i,(()=>{}));if("mesh"!==n.type){const t=d(n,s);if(null==t)return null;const r=n.spatialReference;return p(e,h.EditGeometryOperations.fromGeometry(t,i.viewingMode),(()=>{const e=o.project(n,r);i.trySetGeometry(e)}))}if(a.isMeshWithRelativeVertexSpace(n)){const t=d(n.origin,s);if(!t)return null;const r=n.spatialReference,a=h.EditGeometryOperations.fromGeometry(t,i.viewingMode);return p(e,i,(()=>{const e=o.project(a.data.geometry,r),t=e.x-n.origin.x,s=e.y-n.origin.y,l=(e.z??0)-(n.origin.z??0);i.move(t,s,l)}))}return null}(e,i.mapStart.spatialReference)),null==t)return null;const n=i.mapEnd.x-i.mapStart.x,s=i.mapEnd.y-i.mapStart.y,r=(i.mapEnd.z??0)-(i.mapStart.z??0);return t.move(n,s,r,i.action),{...i,translationX:n,translationY:s,translationZ:r}}}function d(e,t){return null==e?null:e.spatialReference.equals(t)?e.clone():o.project(e,t)}function p(e,t,i){let n=0,s=0,r=0;return{move:(o,a,l,c)=>{"start"===c&&(n=0,s=0,r=0);const h=o-n,u=a-s,m=l-r;t.move(h,u,m),n+=h,s+=u,r+=m,i(),"end"===c&&e.endInteraction?.()}}}function g(e){const t=e.operations?.createResetState();return e=>(t?.remove(),e)}const _=()=>{};class f{constructor(){this.execute=_}next(e,t=new f){return null!=e&&(this.execute=i=>{const n=e(i);null!=n&&t.execute(n)}),t}}function y(e,t,i){const n=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,s=l.clonePoint(e);return s.z=n,s.hasZ=!0,s.z=c.getZForElevationMode(s,t,i),s}e.EventPipeline=f,e.addMapDelta=function(){let e=0,t=0,i=0;return n=>{"start"===n.action&&(e=n.mapStart.x,t=n.mapStart.y,i=n.mapStart.z);const s=n.mapEnd.x-e,r=n.mapEnd.y-t,o=n.mapEnd.z-i;return e=n.mapEnd.x,t=n.mapEnd.y,i=n.mapEnd.z,{...n,mapDeltaX:s,mapDeltaY:r,mapDeltaZ:o,mapDeltaSpatialReference:n.mapStart.spatialReference}}},e.addScreenDelta=function(){let e=0,t=0;return i=>{"start"===i.action&&(e=i.screenStart.x,t=i.screenStart.y);const n=i.screenEnd.x-e,s=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:n,screenDeltaY:s}}},e.constrainToMapAxis=function(e,t){const i=[e.x,e.y,e.z??0],n=t,s=[Math.cos(n),Math.sin(n)],r=Math.sqrt(s[0]*s[0]+s[1]*s[1]);if(0===r)return null;s[0]/=r,s[1]/=r;const o=e=>{const t=(e.x-i[0])*s[0]+(e.y-i[1])*s[1];e.x=i[0]+t*s[0],e.y=i[1]+t*s[1]};return e=>(o(e.mapStart),o(e.mapEnd),{...e,axis:s})},e.createDragEventPipelineCallback=u,e.createManipulatorDragEventPipeline=function(e,t){return e.events.on("drag",u(e,t))},e.dragAtLocation=function(e,t){let i=null,n=0,o=0;return a=>{if("start"===a.action&&(i=e.toScreen?.(t),null!=i&&(i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(n=a.screenStart.x-i.x,o=a.screenStart.y-i.y))),null==i)return null;const l=s.clamp(a.screenEnd.x-n,0,e.width),c=s.clamp(a.screenEnd.y-o,0,e.height),h=r.createScreenPoint(l,c);return a.screenStart=i,a.screenEnd=h,a}},e.dragManipulatedObject=m,e.dragManipulatedObjectMany=function(e){const i=e.map((e=>m(e))).filter(t.isSome);return e=>{const t=e.mapEnd.x-e.mapStart.x,n=e.mapEnd.y-e.mapStart.y,s=e.mapEnd.z-e.mapStart.z;return i.forEach((t=>t(e))),{...e,translationX:t,translationY:n,translationZ:s}}},e.resetManipulatedObject=g,e.resetManipulatedObjectMany=function(e){const t=e.map((e=>g(e))).filter((e=>null!=e));return e=>(t.forEach((t=>t(e))),e)},e.resetProperties=function(e,t){const i=new Map;for(const s of t)i.set(s,n.clone(e[s]));return t=>(i.forEach(((t,i)=>{e[i]=t})),t)},e.sceneSnappingAtLocation=function(e,t,i=[]){if("2d"===e.type)return e=>e;let n=null;return s=>{"start"===s.action&&(n=e.toMap(s.screenStart,{exclude:i}),null!=n&&(n.z=c.getZForElevationMode(n,e,t)));const r=e.toMap(s.screenEnd,{exclude:i});null!=r&&(r.z=c.getZForElevationMode(r,e,t));const o=null!=n&&null!=r?{sceneStart:n,sceneEnd:r}:null;return{...s,scenePoints:o}}},e.sceneSnappingAtProjectedLocation=function(e,t){if("2d"===e.type)return e=>e;let i=null;return n=>{"start"===n.action&&(i=y(n.mapStart,e,t));const s=y(n.mapEnd,e,t),r=null!=i&&null!=s?{sceneStart:i,sceneEnd:s}:null;return{...n,scenePoints:r}}},e.screenToMap=function(e,t=null,i){let n=null;const s=null==t||e.spatialReference?.equals(t)?e=>e:e=>null!=e?o.project(e,t):e,r={exclude:[],...i};return t=>{if("start"===t.action&&(n=s(e.toMap(t.screenStart,r))),null==n)return null;const i=s(e.toMap(t.screenEnd,r));return null!=i?{...t,mapStart:n,mapEnd:i}:null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/EditGeometryOperations":function(){define(["exports","../../../core/Evented","../../../core/handleUtils","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/support/coordsUtils","./EditGeometry","./interfaces","./operations/AppendVertex","./operations/UpdateVertices","./operations/RemoveVertices","./operations/SplitEdge","./operations/SetVertexPosition","./operations/CloseComponent","./operations/MoveMesh","./operations/MoveVertex","./operations/OffsetEdgeVertex","./operations/RotateVertex","./operations/ScaleVertex","./operations/SetAllVertexPositions","./operations/UndoGroup"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x){"use strict";class v extends t{constructor(e,t){super(),this.data=e,this.viewingMode=t,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",(e=>{e.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:e.addedVertices,operation:e.operation}),e.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:e.removedVertices,operation:e.operation}),e.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:e.updatedVertices,operation:e.operation})}))}destroy(){this._listener.remove()}splitEdge(e,t){return this._apply(new h.SplitEdge(this.data,e,t))}updateVertices(e,t,i=o.AccumulationBehavior.ACCUMULATE_STEPS){return this._apply(new l.UpdateVertices(this.data,e,t),i)}move(e,t,i,n=o.AccumulationBehavior.ACCUMULATE_STEPS){return r.isMeshEditGeometry(this.data)?this._apply(new d.MoveMesh(this.data,e,t,i),n):this.moveVertices(this.data.allVertices,e,t,i,n)}moveVertices(e,t,i,n,s=o.AccumulationBehavior.ACCUMULATE_STEPS){return r.isMeshEditGeometry(this.data)?this._apply(new d.MoveMesh(this.data,t,i,n),s):this.updateVertices(e,new p.MoveVertex(this.data.coordinateHelper,t,i,n),s)}scale(e,t,i,n,s=o.AccumulationBehavior.ACCUMULATE_STEPS,r=l.AccumulationType.CUMULATIVE){return this.scaleVertices(this.data.allVertices,e,t,i,n,s,r)}scaleVertices(e,t,i,n,s,r=o.AccumulationBehavior.ACCUMULATE_STEPS,a=l.AccumulationType.CUMULATIVE){return this.updateVertices(e,new f.ScaleVertex(t,i,n,s,a),r)}rotate(e,t,i=o.AccumulationBehavior.ACCUMULATE_STEPS,n=l.AccumulationType.CUMULATIVE){return this.rotateVertices(this.data.allVertices,e,t,i,n)}rotateVertices(e,t,i,n=o.AccumulationBehavior.ACCUMULATE_STEPS,s=l.AccumulationType.CUMULATIVE){return this.updateVertices(e,new _.RotateVertex(t,i,s),n)}removeVertices(e){return this._apply(new c.RemoveVertices(this.data,e,this._minNumVerticesPerType))}appendVertex(e){return 0===this.data.components.length?null:this._apply(new a.AppendVertex(this.data,this.data.components[0],e))}setVertexPosition(e,t){return this._apply(new u.SetVertexPosition(this.data,e,t))}offsetEdge(e,t,i,n=o.AccumulationBehavior.ACCUMULATE_STEPS){return this.updateVertices([t.leftVertex,t.rightVertex],new g.OffsetEdgeVertex(this.data.coordinateHelper,e,t,i),n)}trySetGeometry(e,t=o.AccumulationBehavior.ACCUMULATE_STEPS){const{data:i}=this,{coordinateHelper:n}=i;if(i.type!==e.type||!i.spatialReference.equals(e.spatialReference)||n.hasZ()!==e.hasZ||n.hasM()!==e.hasM||!s.hasCompatibleTopology(i.geometry,e)||r.isMeshEditGeometry(i))return;const a=Array.from(r.EditGeometry.fromGeometry(e,this.viewingMode).iterateVertices(),(e=>e.pos));return this.setVertexPositions(a,t)}setVertexPositions(e,t=o.AccumulationBehavior.ACCUMULATE_STEPS){return this._apply(new y.SetAllVertexPositions(this.data,e),t)}createResetState(){if(r.isMeshEditGeometry(this.data))return this._createResetStateMesh();const e=this.data.geometry.clone();return i.makeHandle((()=>this.trySetGeometry(e)))}closeComponent(e){return this.data.components.includes(e)?this._apply(new m.CloseComponent(this.data,e)):null}canRemoveVertex(e){return e.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const e=new x.UndoGroup;return this._apply(e),i.makeHandle((()=>e.close()))}undo(){if(this._undoStack.length>0){const e=this._undoStack.pop();return e.undo(),this._redoStack.push(e),e}return null}redo(){if(this._redoStack.length>0){const e=this._redoStack.pop();return e.apply(),this._undoStack.push(e),e}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(e,t=o.AccumulationBehavior.ACCUMULATE_STEPS){return t!==o.AccumulationBehavior.NEW_STEP&&null!=this.lastOperation&&this.lastOperation.accumulate(e)||(e.apply(),this._undoStack.push(e),this._redoStack=[]),e}_createResetStateMesh(){if(!r.isMeshEditGeometry(this.data))return i.makeHandle();const e=this.data.geometry,{vertexSpace:t}=e;if(t.origin){const s=n.clone(t.origin);return i.makeHandle((()=>{e.vertexSpace.origin=s}))}const s=e.vertexAttributes.clonePositional();return i.makeHandle((()=>{e.vertexAttributes=s,e.vertexAttributesChanged()}))}static fromGeometry(e,t){return new v(r.EditGeometry.fromGeometry(e,t),t)}}e.EditGeometryOperations=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/EditGeometry":function(){define(["exports","../../../core/arrayUtils","../../../core/compilerUtils","../../../core/Evented","../../../geometry/Polygon","../../../geometry/Polyline","../coordinateHelper","./unnormalizationHelper"],(function(e,t,i,n,s,r,o,a){"use strict";class l{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}}class c{constructor(e,t,i){this.component=e,this.leftVertex=t,this.rightVertex=i,this.type="edge",t.rightEdge=this,i.leftEdge=this}}class h{constructor(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||a.unnormalize(this.vertices,a.getUnnormalizationInfo(this._spatialReference,this._viewingMode))}updateVertexIndex(e,t){if(0===this.vertices.length)return;const i=this.vertices[0];let n=null,s=e,r=t;do{n=s,n.index=r++,s=n.rightEdge?n.rightEdge.rightVertex:null}while(null!=s&&s!==i);n.leftEdge&&n!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(n),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge}swapVertices(e,t){const i=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=i}iterateVertices(e){if(0===this.vertices.length)return;const t=this.vertices[0];let i=t;do{e(i,i.index),i=null!=i.rightEdge?i.rightEdge.rightVertex:null}while(i!==t&&null!=i)}}class u extends n{constructor(e,t){super(),this.type=e,this.coordinateHelper=t,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:i.neverReached(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const e of this.components)for(const t of e.vertices)yield t}notifyChanges(e){this._dirty=!0,this.emit("change",e)}_toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const e=[],t=this.coordinateHelper.vectorToArray;for(const i of this.components){if(i.vertices.length<1)continue;const n=[];let s=i.vertices.find((e=>null==e.leftEdge));const r=s;do{n.push(t(s.pos)),s=s.rightEdge?s.rightEdge.rightVertex:null}while(s&&s!==r);e.push(n)}return new r({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const e=[],t=this.coordinateHelper.vectorToArray;for(const i of this.components){if(i.vertices.length<1)continue;const n=[],s=i.vertices[0];let r=s;const o=r;do{n.push(t(r.pos)),r=null!=r.rightEdge?r.rightEdge.rightVertex:null}while(r&&r!==o);i.isClosed()&&n.push(t(s.pos)),e.push(n)}return new s({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,i){const n=e.spatialReference,s=o.createCoordinateHelper(e.hasZ,e.hasM,n),r=new u(e.type,s);switch(e.type){case"polygon":!function(e,i,n){const s=i.spatialReference,r=e.coordinateHelper,o=i.rings;for(let i=0;i<o.length;++i){const a=o[i],u=new h(s,n);u.index=i;const m=a.length>2&&t.equals(a[0],a[a.length-1]),d=m?a.length-1:a.length;for(let e=0;e<d;++e){const t=r.arrayToVector(a[e]),i=new l(u);u.vertices.push(i),i.pos=t,i.index=e}const p=u.vertices.length-1;for(let e=0;e<p;++e){const t=u.vertices[e],i=u.vertices[e+1],n=new c(u,t,i);u.edges.push(n)}if(m){const e=new c(u,u.vertices[u.vertices.length-1],u.vertices[0]);u.edges.push(e)}e.components.push(u)}}(r,e,i);break;case"polyline":!function(e,t,i){const n=t.spatialReference,s=e.coordinateHelper,r=t.paths;for(let t=0;t<r.length;++t){const o=r[t],a=new h(n,i);a.index=t;const u=o.length;for(let e=0;e<u;++e){const t=s.arrayToVector(o[e]),i=new l(a);a.vertices.push(i),i.pos=t,i.index=e}const m=a.vertices.length-1;for(let e=0;e<m;++e){const t=a.vertices[e],i=a.vertices[e+1],n=new c(a,t,i);a.edges.push(n)}e.components.push(a)}}(r,e,i);break;case"point":m(r,e,i);break;case"mesh":m(r,e.origin,i),r._geometry=e,r._dirty=!1}return r}}function m(e,t,i){const n=t.spatialReference,s=e.coordinateHelper,r=new h(n,i);r.index=0;const o=new l(r);o.index=0,o.pos=s.pointToVector(t),r.vertices.push(o),e.components.push(r)}e.Component=h,e.Edge=c,e.EditGeometry=u,e.Vertex=l,e.isMeshEditGeometry=function(e){return"mesh"===e.type},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/unnormalizationHelper":function(){define(["exports","../../../geometry/support/spatialReferenceUtils","../../ViewingMode"],(function(e,t,i){"use strict";e.getUnnormalizationInfo=function(e,n){const s=t.getInfo(e);return n===i.ViewingMode.Global&&s?{supported:!0,lowerBoundX:s.valid[0],upperBoundX:s.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}},e.unnormalize=function(e,t){if(!t.supported)return;let i=1/0,n=-1/0;const s=t.upperBoundX-t.lowerBoundX;e.forEach((e=>{let r=e.pos[0];for(;r<t.lowerBoundX;)r+=s;for(;r>t.upperBoundX;)r-=s;i=Math.min(i,r),n=Math.max(n,r),e.pos[0]=r}));const r=n-i;s-r<r&&e.forEach((e=>{e.pos[0]<0&&(e.pos[0]+=s)}))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/interfaces":function(){define(["exports"],(function(e){"use strict";var t;e.AccumulationBehavior=void 0,(t=e.AccumulationBehavior||(e.AccumulationBehavior={}))[t.NEW_STEP=0]="NEW_STEP",t[t.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/AppendVertex":function(){define(["exports","../EditGeometry"],(function(e,t){"use strict";e.AppendVertex=class{constructor(e,t,i){this._editGeometry=e,this._component=t,this._pos=i,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let e="redo";null==this._addedVertex&&(e="apply",this._addedVertex=new t.Vertex(this._component));const i=this._component.getLastVertex();if(null==i)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let e=null;i.rightEdge&&(this._originalEdge=i.rightEdge,e=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,null==this._left&&(this._left=new t.Edge(this._component,i,this._addedVertex)),this._component.edges.push(this._left),i.rightEdge=this._left,null!=this._originalEdge&&null!=e&&(null==this._right&&(this._right=new t.Edge(this._component,this._addedVertex,e)),this._component.edges.push(this._right),e.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,i.index+1)}this._editGeometry.notifyChanges({operation:e,addedVertices:[this._addedVertex]})}undo(){null!=this._addedVertex&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),null!=this._left&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),null!=this._right&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),null!=this._originalEdge&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),null!=this._left?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/UpdateVertices":function(){define(["exports"],(function(e){"use strict";class t{constructor(e,t,i){this._editGeometry=e,this._vertices=t,this.operation=i,this._undone=!1}_notifyChanges(e){this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:e,updatedVertices:this._vertices})}apply(){this._vertices.forEach((e=>this.operation.apply(e))),this._notifyChanges(this._undone?"redo":"apply")}undo(){this._vertices.forEach((e=>this.operation.undo(e))),this._undone=!0,this._notifyChanges("undo")}canAccumulate(e){if(this._undone||e._vertices.length!==this._vertices.length)return!1;for(let t=0;t<e._vertices.length;++t)if(e._vertices[t]!==this._vertices[t])return!1;return this.operation.canAccumulate(e.operation)}accumulate(e){return!!(e instanceof t&&this.canAccumulate(e))&&(this._vertices.forEach((t=>this.operation.accumulate(t,e.operation))),this.operation.accumulateParams(e.operation),this._notifyChanges("apply"),!0)}}var i;e.AccumulationType=void 0,(i=e.AccumulationType||(e.AccumulationType={}))[i.CUMULATIVE=0]="CUMULATIVE",i[i.REPLACE=1]="REPLACE",e.UpdateVertices=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/RemoveVertices":function(){define(["exports","../EditGeometry"],(function(e,t){"use strict";e.RemoveVertices=class{constructor(e,t,i=0){this._editGeometry=e,this._vertices=t,this._minNumberOfVertices=i,this.removedVertices=null}apply(){let e="redo";if(null==this.removedVertices){const t=this.removedVertices=[];this._vertices.forEach((e=>{const i=this._removeVertex(e);null!=i&&t.push(i)})),e="apply"}else this.removedVertices.forEach((e=>{this._removeVertex(e.removedVertex)}));this._editGeometry.notifyChanges({operation:e,removedVertices:this._vertices})}undo(){this.removedVertices?.forEach((e=>{this._undoRemoveVertex(e)})),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(e){const i=e.component;if(i.vertices.length<=this._minNumberOfVertices)return null;const n={removedVertex:e,createdEdge:null},s=e.leftEdge,r=e.rightEdge;return i.vertices.splice(i.vertices.indexOf(e),1),s&&(i.edges.splice(i.edges.indexOf(s),1),s.leftVertex.rightEdge=null),r&&(i.edges.splice(i.edges.indexOf(r),1),r.rightVertex.leftEdge=null),0===e.index&&r&&this._vertices.length>0&&i.swapVertices(i.vertices.indexOf(r.rightVertex),0),s&&r&&(n.createdEdge=new t.Edge(i,s.leftVertex,r.rightVertex),i.edges.push(n.createdEdge)),r&&i.updateVertexIndex(r.rightVertex,r.rightVertex.index-1),n}_undoRemoveVertex(e){const t=e.removedVertex,i=e.removedVertex.component,n=t.leftEdge,s=t.rightEdge;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),n&&(i.edges.push(n),n.leftVertex.rightEdge=n),s&&(i.edges.push(s),s.rightVertex.leftEdge=s),i.updateVertexIndex(t,t.index)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/SplitEdge":function(){define(["exports","../EditGeometry"],(function(e,t){"use strict";e.SplitEdge=class{constructor(e,t,i){this._editGeometry=e,this._edge=t,this._t=i,this.createdVertex=null,this._left=null,this._right=null}apply(){let e="redo";const i=this._edge,n=i.component,s=i.leftVertex,r=i.rightVertex;n.edges.splice(n.edges.indexOf(i),1),null==this.createdVertex&&(e="apply",this.createdVertex=new t.Vertex(i.component)),n.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(i.leftVertex.pos,i.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),null==this._left&&(this._left=new t.Edge(n,s,this.createdVertex)),this._left.leftVertex.leftEdge?n.edges.push(this._left):n.edges.unshift(this._left),s.rightEdge=this._left,null==this._right&&(this._right=new t.Edge(n,this.createdVertex,r)),n.edges.push(this._right),r.leftEdge=this._right,n.updateVertexIndex(this.createdVertex,s.index+1),this._editGeometry.notifyChanges({operation:e,addedVertices:[this.createdVertex]})}undo(){if(null==this.createdVertex||null==this._left||null==this._right)return null;const e=this._edge,t=e.component,i=this.createdVertex.leftEdge,n=this.createdVertex.rightEdge,s=i?.leftVertex,r=n?.rightVertex;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this._left),1),t.edges.splice(t.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?t.edges.push(this._edge):t.edges.unshift(this._edge),s&&(s.rightEdge=e),r&&(r.leftEdge=e),s&&t.updateVertexIndex(s,s.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/SetVertexPosition":function(){define(["exports"],(function(e){"use strict";class t{constructor(e,t,i){this._editGeometry=e,this._vertex=t,this._pos=i}apply(){const e=null==this._originalPosition;e&&(this._originalPosition=this._vertex.pos),this._apply(e?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(e){return e instanceof t&&e._vertex===this._vertex&&(this._pos=e._pos,this._apply("apply"),!0)}_apply(e){this._vertex.pos=this._pos,this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:e,updatedVertices:[this._vertex]})}}e.SetVertexPosition=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/CloseComponent":function(){define(["exports","../../../../core/arrayUtils","../EditGeometry"],(function(e,t,i){"use strict";e.CloseComponent=class{constructor(e,t){this._editGeometry=e,this._component=t,this._createdEdge=null}apply(){let e="redo";if(null==this._createdEdge){e="apply";const t=this._component.getFirstVertex(),n=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||null==t||null==n)return;this._createdEdge=new i.Edge(this._component,n,t)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:e})}undo(){null!=this._createdEdge&&(t.remove(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/MoveMesh":function(){define(["exports"],(function(e){"use strict";class t{constructor(e,t,i,n){this._editGeometry=e,this.dx=t,this.dy=i,this.dz=n,this._firstTime=!0}apply(){const e=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(e,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(e){const i=this._editGeometry.geometry;return e instanceof t&&e._editGeometry.geometry===i&&(this._apply("apply",e.dx,e.dy,e.dz),this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz,!0)}_apply(e,t,i,n){const s=this._editGeometry.geometry;s.offset(t,i,n);const r=this._editGeometry.components[0].getFirstVertex();if(!r)return;const o=this._editGeometry.coordinateHelper;r.pos=o.pointToVector(s.origin),this._editGeometry.notifyChanges({operation:e,updatedVertices:[r]})}}e.MoveMesh=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/MoveVertex":function(){define(["exports"],(function(e){"use strict";class t{constructor(e,t,i,n){this._helper=e,this.dx=t,this.dy=i,this.dz=n}_move(e,t,i,n){this._helper.addDelta(e.pos,t,i,n)}apply(e){this._move(e,this.dx,this.dy,this.dz)}undo(e){this._move(e,-this.dx,-this.dy,-this.dz)}canAccumulate(e){return e instanceof t}accumulate(e,t){this._move(e,t.dx,t.dy,t.dz)}accumulateParams(e){this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz}}e.MoveVertex=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/OffsetEdgeVertex":function(){define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/plane","../../../../geometry/support/vector","../../../support/geometry2dUtils"],(function(e,t,i,n,s,r,o,a,l){"use strict";class c{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(e,t,i,n=0,s=d.IMMEDIATE){this._helper=e,this._planeType=t,this._edge=i,this.distance=n,this._plane=o.create(),this._offsetPlane=o.create(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,s===d.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){const e=this._toXYZ(this._edge.leftVertex.pos),t=this._toXYZ(this._edge.leftVertex.leftEdge?.leftVertex?.pos),i=this._toXYZ(this._edge.rightVertex.pos),n=this._toXYZ(this._edge.rightVertex.rightEdge?.rightVertex?.pos);this._edgeDirection=s.direction(r.create(),e,i),t?(this._left=this._computeNeighbor(e,t,this._edgeDirection),this._right=this._computeNeighbor(i,n,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(i,n,this._edgeDirection),this._left=this._computeNeighbor(e,t,this._edgeDirection,this._right))}_toXYZ(e){return null!=e?this._helper.toXYZ(e):null}_pointToXYZ(e){return this._toXYZ(this._helper.pointToVector(e))}_computeNeighbor(e,t,i,n){const o=r.create();if(t){s.direction(o,e,t);const n=!this._passesBisectingAngleThreshold(o,i);return{start:e,end:t,direction:n?this._bisectVectorsPerpendicular(i,o):o,isOriginalDirection:!n}}return this._helper.hasZ()?n&&(s.cross(o,i,n.direction),s.cross(o,o,i),s.normalize(o,o),Math.sign(o[1])!==Math.sign(i[0])&&s.scale(o,o,-1)):s.set(o,-i[1],i[0],0),{start:e,end:t,direction:o,isOriginalDirection:!0}}_passesBisectingAngleThreshold(e,t){const i=Math.abs(a.angle(t,e));return i>=h&&i<=Math.PI-h}_bisectVectorsPerpendicular(e,t){const i=s.dot(e,t)<0?e:s.negate(r.create(),e),n=Math.abs(s.dot(i,t));if(!(n<u||n>1-u))return this._bisectDirection(i,t);const o=s.cross(r.create(),i,[0,0,1]);return s.normalize(o,o)}_bisectDirection(e,t){const i=s.add(r.create(),e,t);return s.normalize(i,i)}_initializePlane(){const e=this._computeNormalDirection(this._left),t=this._computeNormalDirection(this._right);s.dot(e,t)<0&&s.negate(t,t),o.fromPositionAndNormal(this._left.start,this._bisectDirection(e,t),this._plane)}_computeNormalDirection(t){const i=s.cross(r.create(),t.direction,this._edgeDirection);s.normalize(i,i);const n=s.cross(r.create(),this._edgeDirection,i);return this._planeType===e.PlaneType.XY&&(n[2]=0),s.normalize(n,n)}_initializeDistanceConstraints(){null==this._left.end||this.requiresSplitEdgeLeft||this._updateDistanceConstraint(o.signedDistance(this._plane,this._left.end)),null==this._right.end||this.requiresSplitEdgeRight||this._updateDistanceConstraint(o.signedDistance(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(e){e<=0&&(this._minDistance=Math.max(this._minDistance,e)),e>=0&&(this._maxDistance=Math.min(this._maxDistance,e))}_updateIntersectDistanceConstraint(e){const t=o.getNormal(e),a=this._edgeDirection,c=s.add(r.create(),this._left.start,this._left.direction),h=s.add(r.create(),this._right.start,this._right.direction),u=this._pointInBasis2D(n.create(),t,a,this._left.start),m=this._pointInBasis2D(n.create(),t,a,c),d=this._pointInBasis2D(n.create(),t,a,this._right.start),p=this._pointInBasis2D(n.create(),t,a,h),[g]=l.intersectLineAndRay({start:m,end:u,type:l.LineType.LINE},{start:p,end:d,type:l.LineType.LINE});if(!g)return;const _=i.subtract(n.create(),u,m);i.normalize(_,_);const f=i.subtract(n.create(),g,m),y=i.dot(_,f),x=s.add(r.create(),c,s.scale(r.create(),this._left.direction,-y)),v=o.signedDistance(e,x);this._updateDistanceConstraint(v)}_pointInBasis2D(e,t,i,n){return e[0]=a.projectPointSignedLength(t,n),e[1]=a.projectPointSignedLength(i,n),e}_offset(e,t){Number.isFinite(this._minDistance)&&(t=Math.max(this._minDistance,t)),Number.isFinite(this._maxDistance)&&(t=Math.min(this._maxDistance,t)),o.copy(this._offsetPlane,this._plane),this._offsetPlane[3]-=t;const i=(e,t,i)=>null!=t&&o.intersectLine(this._offsetPlane,e,s.add(r.create(),e,t),i),n=r.create();(e===this._edge.leftVertex?i(this._left.start,this._left.direction,n):i(this._right.start,this._right.direction,n))&&this._helper.copy(this._helper.fromXYZ(n,void 0,this._helper.getM(e.pos)),e.pos)}selectArrowFromStartPoint(e){this._selectedArrow=o.isPointInside(this.plane,this._pointToXYZ(e))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(e){return o.signedDistance(this.plane,this._pointToXYZ(e))}clampedStartAndEnd(e){const i=this._helper.toXYZ(this._helper.pointToVector(e)),n=o.projectPoint(this._plane,i,r.create()),a=o.signedDistance(this._plane,i),l=t.clamp(a,this._minDistance,this._maxDistance);return s.lerp(i,n,i,l/a),{start:n,end:i}}apply(e){this._offset(e,this.distance)}undo(e){this._offset(e,0)}canAccumulate(e){return e instanceof c&&this._edge.leftVertex.index===e._edge.leftVertex.index&&this._edge.rightVertex.index===e._edge.rightVertex.index&&this._edge.component===e._edge.component&&this._maybeEqualsVec3(this._left.direction,e._left.direction)&&this._maybeEqualsVec3(this._right.direction,e._right.direction)&&s.equals(o.getNormal(this._plane),o.getNormal(e._plane))}accumulate(e,t){const i=this._plane[3]-t._plane[3]+t.distance;this._offset(e,i)}accumulateParams(e){const t=e.distance-e._plane[3];this.distance=t+this._plane[3]}clone(){const e=new c(this._helper,this._planeType,this._edge,this.distance,d.DEFERRED);return o.copy(e._plane,this._plane),o.copy(e._offsetPlane,this._offsetPlane),e._maxDistance=this._maxDistance,e._minDistance=this._minDistance,e._left=this._cloneNeighbor(this._left),e._right=this._cloneNeighbor(this._right),e._edgeDirection=s.copy(r.create(),this._edgeDirection),e}_maybeEqualsVec3(e,t){return null==e&&null==t||null!=e&&null!=t&&s.equals(e,t)}_cloneNeighbor({start:e,end:t,direction:i,isOriginalDirection:n}){return{start:s.copy(r.create(),e),end:null!=t?s.copy(r.create(),t):null,direction:s.copy(r.create(),i),isOriginalDirection:n}}}const h=t.deg2rad(15),u=.001;var m,d;e.PlaneType=void 0,(m=e.PlaneType||(e.PlaneType={}))[m.XYZ=0]="XYZ",m[m.XY=1]="XY",function(e){e[e.IMMEDIATE=0]="IMMEDIATE",e[e.DEFERRED=1]="DEFERRED"}(d||(d={})),e.OffsetEdgeVertex=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/RotateVertex":function(){define(["exports","../../../../core/arrayUtils","../../../../core/libs/gl-matrix-2/math/vec2","./UpdateVertices"],(function(e,t,i,n){"use strict";class s{constructor(e,t,i=n.AccumulationType.CUMULATIVE){this.origin=e,this.angle=t,this._accumulationType=i}_rotate(e,t){i.rotate(e.pos,e.pos,this.origin,t)}apply(e){this._rotate(e,this.angle)}undo(e){this._rotate(e,-this.angle)}canAccumulate(e){return e instanceof s&&t.equals(this.origin,e.origin)}accumulate(e,t){const i=t._accumulationType===n.AccumulationType.REPLACE;this._rotate(e,i?t.angle-this.angle:t.angle)}accumulateParams(e){const t=e._accumulationType===n.AccumulationType.REPLACE;this.angle=t?e.angle:this.angle+e.angle}}e.RotateVertex=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/ScaleVertex":function(){define(["exports","../../../../core/arrayUtils","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/math/vec2","./UpdateVertices"],(function(e,t,i,n,s){"use strict";class r{constructor(e,t,n,r,o=s.AccumulationType.CUMULATIVE){this.origin=e,this.axis1=t,this.factor1=n,this.factor2=r,this._accumulationType=o,this.axis2=i.fromValues(t[1],-t[0])}_scale(e,t,i){n.projectAndScale(e.pos,e.pos,this.origin,this.axis1,t),n.projectAndScale(e.pos,e.pos,this.origin,this.axis2,i)}apply(e){this._scale(e,this.factor1,this.factor2)}undo(e){this._scale(e,1/this.factor1,1/this.factor2)}canAccumulate(e){return e instanceof r&&t.equals(this.origin,e.origin)&&t.equals(this.axis1,e.axis1)}accumulate(e,t){t._accumulationType===s.AccumulationType.REPLACE?this._scale(e,t.factor1/this.factor1,t.factor2/this.factor2):this._scale(e,t.factor1,t.factor2)}accumulateParams(e){const t=e._accumulationType===s.AccumulationType.REPLACE;this.factor1=t?e.factor1:this.factor1*e.factor1,this.factor2=t?e.factor2:this.factor2*e.factor2}}e.ScaleVertex=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/SetAllVertexPositions":function(){define(["exports"],(function(e){"use strict";class t{constructor(e,t){this._editGeometry=e,this._newPositions=t}apply(){const e=null==this._originalPositions?"apply":"redo";if(!this._originalPositions){const e=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map((t=>e.clone(t.pos)))}this._apply(e,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(e){return e instanceof t&&(this._newPositions=e._newPositions,this._apply("apply",this._newPositions),!0)}_apply(e,t){const i=this._editGeometry.coordinateHelper,n=this._editGeometry.allVertices;for(let e=0;e<n.length;e++)i.copy(t[e],n[e].pos);this._editGeometry.components.forEach((e=>e.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:e,updatedVertices:n})}}e.SetAllVertexPositions=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/operations/UndoGroup":function(){define(["exports"],(function(e){"use strict";var t;const i=Symbol();class n{static{t=i}constructor(e){this._operations=[],this._closed=!1,this[t]=!0,e&&(this._operations=e,this._closed=!0)}close(){this._closed=!0}apply(){for(const e of this._operations)e.apply()}undo(){for(let e=this._operations.length-1;e>=0;e--)this._operations[e].undo()}accumulate(e){if(this._closed)return!1;const t=this._operations.length?this._operations[this._operations.length-1]:null;return t&&t.accumulate(e)||(this._operations.push(e),e.apply()),!0}}e.UndoGroup=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/SnappingContext":function(){define(["exports"],(function(e){"use strict";e.SnappingContext=class{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/SnappingDragPipelineStep":function(){define(["exports","../../../core/maybe","../../../core/promiseUtils","../../../core/reactiveUtils","../../../layers/graphics/dehydratedFeatureComparison","../../../layers/graphics/hydratedFeatures","../../../support/elevationInfoUtils","../dragEventPipeline","./SnappingContext","../../support/Scheduler"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";function h(e,[t,i,n]){const s=r.clonePoint(e);return s.x+=t,s.y+=i,s.hasZ&&(s.z+=n),s}function u(e,t){const i=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,i]}function m(e,t,[i,n,s],r){e.x=t.x+i,e.y=t.y+n,r&&e.hasZ&&t.hasZ&&(e.z=t.z+s)}function d(e){return e}e.createSnapDragEventPipelineStep=function({predicate:e=()=>!0,snappingManager:r,snappingContext:p,updatingHandles:g,useZ:_=!0}){const f=new a.EventPipeline;if(null==r)return{snappingStep:[d,f],cancelSnapping:d};let y,x=null,v=null,P=null;const b=()=>{x=t.abortMaybe(x),r.doneSnapping(),v?.frameTask.remove(),v=null,y=t.removeMaybe(y),P=null},E=function(e,t,n){return i.debounce((async({frameTask:i,point:r,scenePoint:o,context:a,event:l,delta:c,getLastState:h},u)=>{const d=await i.schedule((()=>e.snap({point:r,scenePoint:o,context:a,signal:u})),u);if(d.valid){let o=await i.schedule((()=>d.apply()),u);const p=h();null!=p.point&&r!==p.point&&(o=e.update({point:p.point,scenePoint:p.scenePoint,context:a})),null!=p.updatePoint&&s.pointEquals(o,p.updatePoint)||(m(l.mapEnd,o,c,t),n.execute(l))}}))}(r,_,f);let S=null,C=null,w=null;return{snappingStep:[t=>{if(!e(t))return t;const{action:s}=t;if("start"===s){const{info:e}=t,i="3d"===(a=r.view).type?a.resourceController.scheduler.registerTask(c.TaskPriority.SNAPPING):c.ImmediateTask;if(v=function(e,t,i){return{context:new l.SnappingContext({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:i}}(p,t,i),v.context.selfSnappingZ=null,!_&&null!=e){const t=function(e,t){if(!e.hasZ())return null;const i=t.vertices;let n=null;for(const t of i){const i=e.getZ(t.pos);if(null!=n&&null!=i&&Math.abs(i-n)>1e-6)return null;null==n&&(n=i)}return n}(p.coordinateHelper,e.handle.component);null!=t&&(v.context.selfSnappingZ={value:t,elevationInfo:p.elevationInfo??o.absoluteHeightElevationInfo})}}var a;if(null!=v){const{context:e,originalScenePos:o,originalPos:a}=v,{mapEnd:l,mapStart:c,scenePoints:d}=t,p=h(a,u(l,c)),f=u(c,a),b={...t,action:"update"},T=v.context,D=function(e,t){return null==e||null==t?null:h(e,u(t.sceneEnd,t.sceneStart))}(o,d),I=r.update({point:p,scenePoint:D,context:e});if(w=I,m(l,I,f,_),S=p,C=D,"end"!==s){const{frameTask:e}=v;null==x&&(x=new AbortController),P=t=>{g.addPromise(i.ignoreAbortErrors(E({frameTask:e,event:b,context:T,point:p,scenePoint:D,delta:f,getLastState:()=>({point:S,scenePoint:C,updatePoint:t.forceUpdate?null:w})},x.signal)))},P({forceUpdate:!1}),null==y&&(y=n.watch((()=>r.options.effectiveEnabled),(()=>P?.({forceUpdate:!0}))))}}return"end"===s&&b(),t},f],cancelSnapping:e=>(b(),e)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/snapping/SnappingOperation":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/maybe","../../../core/promiseUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../support/Scheduler"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";e.SnappingOperation=class extends i{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=s.debounce((async(e,t,i,n)=>{const s=this._frameTask;if(null==s)return;const r=await s.schedule((()=>t.snap({...e,context:i,signal:n})),n);r.valid&&await s.schedule((()=>{this.stagedPoint=r.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:i}))}),n)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=e?e.registerTask(h.TaskPriority.SNAPPING):h.ImmediateTask}destroy(){this._abortController=n.abortMaybe(this._abortController),this._frameTask=n.removeMaybe(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:n,scenePoint:s}=e,r=t.update({point:n,scenePoint:s,context:i});return this.stagedPoint=r,r}async snap(e,t,i){const{point:n,scenePoint:s}=e;return this.stagedPoint=t.update({point:n,scenePoint:s,context:i}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=n.abortMaybe(this._abortController),this._snapPoints=null}},t.__decorate([r.property({constructOnly:!0})],e.SnappingOperation.prototype,"view",void 0),t.__decorate([r.property()],e.SnappingOperation.prototype,"stagedPoint",null),t.__decorate([r.property()],e.SnappingOperation.prototype,"constrainResult",void 0),t.__decorate([r.property()],e.SnappingOperation.prototype,"_stagedPoint",void 0),e.SnappingOperation=t.__decorate([c.subclass("esri.views.interactive.snapping.SnappingOperation")],e.SnappingOperation),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/draw/drawSurfaces":function(){define(["exports","../../core/screenUtils","../../geometry/Point","../../geometry/SpatialReference","../../layers/graphics/dehydratedPoint","../../layers/graphics/hydratedFeatures","../../support/elevationInfoUtils"],(function(e,t,i,n,s,r,o){"use strict";class a{screenToMap(e){const{x:t,y:n}=e;return new i({x:t,y:n,spatialReference:a.spatialReference})}mapToScreen(e){return t.createScreenPoint(e.x,e.y)}constrainZ(e){return e}static{this.spatialReference=new n}}e.ElevationDrawSurface=class{constructor(e,t,i,n=null){this._elevationInfo=e,this.defaultZ=t,this._view=i,this._excludeGraphics=n}screenToMap(e){const{defaultZ:i,_view:n}=this,s=n.sceneIntersectionHelper.intersectElevationFromScreen(t.createScreenPointArray(e.x,e.y),this._elevationInfo,i??0,this._excludeGraphics);return null==i&&null!=s&&(s.z=void 0),s}mapToScreen(e){const t=s.makeDehydratedPoint(e.x,e.y,o.getConvertedElevation(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){const{defaultZ:t}=this;return null!=t&&e.z!==t&&((e=r.clonePoint(e)).z=t),e}},e.MapDrawSurface=class{constructor(e,t=!1,i=0){this.view=e,this.hasZ=t,this.defaultZ=i,this.mapToScreen=t=>e.toScreen(t),this.screenToMap=t?t=>{const n=e.toMap(t);return n.z=i,n}:t=>e.toMap(t)}constrainZ(e){const{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=r.clonePoint(e)).z=t),e}},e.SceneDrawSurface=class{constructor(e,t,i=[]){this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude,excludeLabels:!0});return null!=t&&(t.z=o.getZForElevationMode(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return null!=this.elevationInfo&&(t=s.makeDehydratedPoint(e.x,e.y,o.getConvertedElevation(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}},e.ScreenDrawSurface=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/move/MoveTool3D":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/arrayUtils","../../../../../core/Collection","../../../../../core/Evented","../../../../../core/handleUtils","../../../../../core/maybe","../../../../../core/quantityUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/ensureType","../../../../../core/has","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/support/UpdatingHandles","../../../../../geometry/Point","../../../../../layers/graphics/dehydratedPoint","../../../../../support/elevationInfoUtils","../../SnappingVisualizer3D","../geometryUtils","../isSupportedObjectUtils","../manipulatedObjectUtils","../manipulatorUtils","../meshFastUpdateUtils","../tooltipUtils3D","../visualElementUtils","../manipulations/config","../manipulations/MoveManipulation","../manipulations/moveUtils","../manipulations/MoveXYObjectManipulation","./isSupportedObject","../../visualElements/OutlineVisualElement","../../../../interactive/dragEventPipeline","../../../../interactive/InteractiveToolBase","../../../../interactive/editGeometry/EditGeometryOperations","../../../../interactive/sketch/SketchOptions","../../../../interactive/snapping/SnappingContext","../../../../interactive/snapping/SnappingDragPipelineStep","../../../../interactive/tooltip/tooltipCommonUtils","../../../../interactive/tooltip/infos/MovePointTooltipInfo","../../../../interactive/tooltip/infos/TranslateTooltipInfo","../../../../interactive/tooltip/infos/TranslateXYTooltipInfo","../../../../interactive/tooltip/infos/TranslateZTooltipInfo","../../../../support/euclideanLengthMeasurementUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C,w,T,D,I,A,M,N,R,O,G,k,V,F,L,q,H,U){"use strict";class z{constructor(e){this.objects=e,this.type="move-start"}}class Y{constructor(e,t,i){this.dx=e,this.dy=t,this.objects=i,this.type="move"}}class B{constructor(e){this.objects=e,this.type="move-stop"}}const X=Symbol("manipulators"),j=Symbol("tooltips");e.MoveTool3D=class extends N.InteractiveToolBase{constructor(e){super(e),this._infos=new Map,this.events=new s,this.objects=new n,this.enableZ=!0,this.sketchOptions=new O,this.type="move-3d",this._latestTooltipInfo=null,this._translateTooltipInfo=null,this._translateXYTooltipInfo=null,this._translateZTooltipInfo=null,this._updatingHandles=new d.UpdatingHandles,this._moveManipulation=null}initialize(){const{view:e}=this;this.tooltip=V.makeTooltip((()=>({view:e,options:this.sketchOptions.tooltips}))),this.addHandles([this.objects.on("change",(e=>{e.removed.forEach((e=>this.removeHandles(e))),this._updateObjectInfos(e),this._setupFastTransformUpdates(e.added),this._refreshManipulators()})),this.objects.on("change",(()=>this._connectTooltips()))]);const t=this.objects.toArray();this._updateObjectInfos({added:t,removed:[]}),this._setupFastTransformUpdates(t),this._refreshManipulators(),this._connectTooltips(),this.finishToolCreation()}destroy(){this.tooltip=o.destroyMaybe(this.tooltip),this._moveManipulation=o.destroyMaybe(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}onInputEvent(e){if(!this.destroyed&&!V.enterInputModeIfAvailable(e,this.tooltip))return super.onInputEvent(e)}get updating(){return this._updatingHandles.updating}get _shouldShowMovePointTooltip(){const{objects:e}=this;if(1!==e.length)return!1;const t=v.manipulatedObjectGeometry(e.at(0))?.type;return"point"===t||"mesh"===t}get activeTooltipInfo(){return this._shouldShowMovePointTooltip?this._movePointTooltipInfo:this._latestTooltipInfo}reset(){}_updateObjectInfos({added:e,removed:t}){for(const t of e){if(I.isSupportedObject(t)!==x.SupportedObjectResult.SUPPORTED)continue;const e=new Z(t);this._infos.set(t,e)}for(const e of t)this._infos.delete(e)}_setupFastTransformUpdates(e){for(const t of e){const e=this._infos.get(t);this.addHandles(b.meshTransformFastUpdateHandles(e.object),t)}}_refreshManipulators(){if(this.removeHandles(X),this._moveManipulation=o.destroyMaybe(this._moveManipulation),this.manipulators.removeAll(),0===this._infos.size)return;const e=Array.from(this._infos.values());this._createManipulators(e),this._createVisualElements(e),this._updateMoveManipulation(e)}_createManipulators(e){for(const t of e){const i=t.object;t.manipulationXY=new D.MoveXYObjectManipulation({tool:this,view:this.view,object:i}),t.manipulationXY.forEachManipulator((e=>{this.addHandles([e.events.on("immediate-click",(e=>{this.events.emit("immediate-click",{...e,object:i}),e.stopPropagation()})),e.events.on("grab-changed",(({action:e})=>{"start"===e?this._showTooltip(w.ManipulationType.XY):this._hideTooltip()}))],X)})),this.addHandles(t.manipulationXY.createDragPipeline(((t,i,n,s)=>this._buildDragEventPipeline(e,w.ManipulationType.XY,t,i,n,s))),X)}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new w.MoveManipulation({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?w.MoveManipulation.radiusForSymbol(e[0].object.graphic?.symbol):C.discRadius});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this.addHandles(e.events.on("immediate-click",(i=>{const n=this.objects.at(0);!t.zManipulation.hasManipulator(e)&&1===this.objects.length&&n&&this.events.emit("immediate-click",{...i,object:n}),i.stopPropagation()})),X)}));const i=e=>t=>{this.addHandles([t.events.on("focus-changed",(({action:t})=>{"focus"===t?this._showTooltip(e):this._hideTooltip()})),t.events.on("grab-changed",(()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=a.zeroMeters)}))],X)};this._moveManipulation.xyManipulation.forEachManipulator(i(w.ManipulationType.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(w.ManipulationType.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(w.ManipulationType.Z));const n=()=>this._updateMoveManipulation(e);for(const t of e)this.addHandles([t.object.on("committed",n),l.watch((()=>t.object.visible),n)],X);const s=e[e.length-1];this.addHandles(s.object.on("committed",(()=>this._updateMoveManipulationAngle(s))),X);const{object:r}=s,{operations:o}=r;if(o){const i=r.graphic;this.addHandles(t.createDragPipeline(((t,i,n,s,r)=>this._buildDragEventPipeline(e,t,i,n,s,r)),r.elevationInfo,o.data.spatialReference,i),X)}this._updateMoveManipulationAngle(s)}_createVisualElements(e){for(const t of e){const i=t.object,n=S.createVisualElements({view:this.view,object:i,forEachManipulator:e=>{t.manipulationXY?.forEachManipulator(e),this._moveManipulation?.forEachManipulator(e)},onManipulatorsChanged:()=>r.makeHandle()});null!=n&&(t.geometryRepresentation=n.visualElement,t.geometryRepresentation instanceof A.OutlineVisualElement&&this.addHandles([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.object.isDraped||this._updateMoveManipulation(e)})),l.watch((()=>t.object.isDraped),(()=>this._updateMoveManipulation(e)))],X),this.addHandles(n,X))}}_updateMoveManipulationAngle(e){this._moveManipulation&&(this._moveManipulation.angle=y.orientation(v.manipulatedObjectGeometry(e.object)))}_updateMoveManipulation(e){const t=g.makeDehydratedPoint(0,0,0,this.view.spatialReference);let i=0,n=!1;const s=this._moveManipulation;if(s){for(const s of e){if(!s.object.visible)continue;this.enableZ&&P.canMoveZOperations(s.object.operations,s.object.elevationInfo)&&(n=!0);const e=s.geometryRepresentation instanceof A.OutlineVisualElement&&!s.object.isDraped?s.geometryRepresentation.attachmentOrigin:s.object.origin;if(null!=e){const{x:n,y:s,z:r}=e;t.x+=n,t.y+=s,r&&(t.z??=0,t.z+=r),i++}}i>0?(t.x/=i,t.y/=i,t.z??=0,t.z/=i,s.location=t,s.xyManipulation.available=!0,s.xyAxisManipulation.available=!0,s.zManipulation.available=n):s.available=!1}}_buildDragEventPipeline(e,t,i,n,s,r){const o=[],a=[];let l=null,c=null;const h=()=>{for(const e of o)e.dragging=!1;o.length=0,a.length=0,l=null,c=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(1===e.length&&t===w.ManipulationType.XY){const t=e[0].object;({steps:n,cancel:s}=this._buildSnappingPipelineSteps(t,t.elevationInfo,n,s,r))}return s=s.next((e=>c?.(e))).next((()=>(a.length&&this.events.emit("move-stop",new B(a)),this.destroyed||h(),null))),{steps:n=n.next((t=>{if("start"===t.action){o.length=0,a.length=0;for(const t of e)t.dragging||!t.manipulationXY?.hasManipulator(i)&&t.manipulationXY?.grabbing||(o.push(t),a.push(t.object),t.dragging=!0);if(0!==a.length&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),l=M.dragManipulatedObjectMany(a),c=M.resetManipulatedObjectMany(a),this._emitRecordUndo(),this.events.emit("move-start",new z(a)),this.destroyed))return null}return 0!==a.length?t:null})).next((e=>l?.(e))).next((e=>(this._updateMoveTooltip(t,e),e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd);if(!t||!i)return null;const n=i.x-t.x,s=i.y-t.y;if(this.events.emit("move",new Y(n,s,a)),this.destroyed)return null}break;case"end":if(this.events.emit("move-stop",new B(a)),this.destroyed)return null;h()}return null})),cancel:s}}_connectTooltips(){let e;if(this.removeHandles(j),this._shouldShowMovePointTooltip){const t=this.objects.at(0),{events:i}=this;this._movePointTooltipInfo??=new F.MovePointTooltipInfo({viewType:this.view.type,sketchOptions:this.sketchOptions});const n={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),i.emit("move-start",new z([t]))},onMove:()=>i.emit("move",new Y(0,0,[t])),onMoveStop:()=>i.emit("move-stop",new B([t])),onRotateStart:()=>{},onRotate:()=>{},onRotateStop:()=>{},onScaleStart:()=>{},onScale:()=>{},onScaleStop:()=>{}};e=E.connectTooltipToManipulatedObject(this.tooltip,t,(()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this._movePointTooltipInfo,callbacks:n})))}else e=l.watch((()=>this.sketchOptions.tooltips.effectiveEnabled?this._latestTooltipInfo:null),(e=>{this.tooltip.info=e}),l.syncAndInitial);this.addHandles(e,j)}_showTooltip(e){this._shouldShowMovePointTooltip||this._updateMoveTooltip(e)}_hideTooltip(){this._shouldShowMovePointTooltip||(this.tooltip?.clear(),this._latestTooltipInfo=null)}_updateMoveTooltip(e,t){if(this._shouldShowMovePointTooltip)return;const{sketchOptions:i,autoLengthMeasurementUtils:n}=this;switch(e){case w.ManipulationType.XY:this._latestTooltipInfo=this._translateTooltipInfo??=new L.TranslateTooltipInfo({sketchOptions:i}),Q(this._latestTooltipInfo,t,((e,t)=>n.autoDistanceBetweenPoints2D(W(e),W(t))));break;case w.ManipulationType.XY_AXIS:this._latestTooltipInfo=this._translateXYTooltipInfo??=new q.TranslateXYTooltipInfo({sketchOptions:i}),Q(this._latestTooltipInfo,t,((e,i)=>a.scale(n.autoDistanceBetweenPoints2D(W(e),W(i)),T.axisConstrainedDragSign(t))));break;case w.ManipulationType.Z:this._latestTooltipInfo=this._translateZTooltipInfo??=new H.TranslateZTooltipInfo({sketchOptions:i}),Q(this._latestTooltipInfo,t,U.verticalSignedDistanceBetweenPoints)}this._latestTooltipInfo.sketchOptions=i}_emitRecordUndo(){const e=this.objects.toArray().map((e=>e.createUndoRecord?.())).filter(i.isSome);e.length>0&&this.events.emit("record-undo",{updates:e})}_buildSnappingPipelineSteps(e,t,i,n,s){const r=v.manipulatedObjectGeometry(e);if(null==r||"point"!==r.type&&"mesh"!==r.type)return{steps:i,cancel:n};const o=("point"===r.type?r:r.origin).clone(),a=new G.SnappingContext({elevationInfo:t,pointer:s,editGeometryOperations:R.EditGeometryOperations.fromGeometry(o,this.view.state.viewingMode),visualizer:new f.SnappingVisualizer3D,excludeFeature:e.graphic}),l=this.snappingManager,{snappingStep:c,cancelSnapping:h}=k.createSnapDragEventPipelineStep({snappingContext:a,snappingManager:l,updatingHandles:this._updatingHandles});return n=n.next(h),{steps:i=i.next((t=>(o.z=_.getConvertedElevation(this.view,o,e.elevationInfo,{mode:"absolute-height",offset:0}),{...t,snapOrigin:a.coordinateHelper.pointToVector(o)}))).next(...c),cancel:n}}},t.__decorate([c.property({constructOnly:!0,nonNullable:!0})],e.MoveTool3D.prototype,"view",void 0),t.__decorate([c.property({constructOnly:!0})],e.MoveTool3D.prototype,"autoLengthMeasurementUtils",void 0),t.__decorate([c.property()],e.MoveTool3D.prototype,"objects",void 0),t.__decorate([c.property({constructOnly:!0,nonNullable:!0})],e.MoveTool3D.prototype,"enableZ",void 0),t.__decorate([c.property({constructOnly:!0,type:O})],e.MoveTool3D.prototype,"sketchOptions",void 0),t.__decorate([c.property({constructOnly:!0})],e.MoveTool3D.prototype,"snappingManager",void 0),t.__decorate([c.property()],e.MoveTool3D.prototype,"type",void 0),t.__decorate([c.property()],e.MoveTool3D.prototype,"updating",null),t.__decorate([c.property()],e.MoveTool3D.prototype,"_latestTooltipInfo",void 0),t.__decorate([c.property()],e.MoveTool3D.prototype,"_shouldShowMovePointTooltip",null),t.__decorate([c.property()],e.MoveTool3D.prototype,"activeTooltipInfo",null),e.MoveTool3D=t.__decorate([m.subclass("esri.views.3d.interactive.editingTools.move.MoveTool3D")],e.MoveTool3D);const W=h.ensureType(p);class Z{constructor(e){this.object=e,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1}}function Q(e,t,i){if(null==t||"end"===t.action)return void(e.distance=a.zeroMeters);const{mapStart:n,mapEnd:s}=t,r=i(n,s);e.distance=null!=r?r:a.zeroMeters}e.MoveEvent=Y,e.MoveStartEvent=z,e.MoveStopEvent=B,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/geometryUtils":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/math/common"],(function(e,t,i){"use strict";function n(e){if(null==e||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t="polyline"===e.type?e.paths:e.rings,n=i.getEpsilon();for(const e of t)for(let t=0;t<e.length-1;t++){const i=e[t],s=e[t+1],r=i[0]-s[0],o=i[1]-s[1];if(r*r+o*o>n)return Math.atan2(s[1]-i[1],s[0]-i[0])}return 0}e.mainAxis=function(e){const i=n(e);return t.fromValues(Math.cos(i),Math.sin(i))},e.orientation=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/isSupportedObjectUtils":function(){define(["exports","../../../../core/has"],(function(e,t){"use strict";var i;e.SupportedObjectResult=void 0,(i=e.SupportedObjectResult||(e.SupportedObjectResult={}))[i.SUPPORTED=0]="SUPPORTED",i[i.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",i[i.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",i[i.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",i[i.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",i[i.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED",e.isSupportedObjectResultMessage=function(t){switch(t){case e.SupportedObjectResult.SUPPORTED:break;case e.SupportedObjectResult.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case e.SupportedObjectResult.GEOMETRY_MISSING:return"no geometry";case e.SupportedObjectResult.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case e.SupportedObjectResult.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case e.SupportedObjectResult.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/manipulatedObjectUtils":function(){define(["exports"],(function(e){"use strict";e.manipulatedObjectGeometry=function(e){return e?.operations?.data.geometry},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/manipulatorUtils":function(){define(["exports","../../../../core/handleUtils","../../../../support/elevationInfoUtils"],(function(e,t,i){"use strict";e.canMoveZOperations=function(e,t){return function(e,t){return!!e&&"on-the-ground"!==t.mode&&!i.hasFeatureExpressionInfo(t)}(e?.data.coordinateHelper.hasZ(),t)},e.disableDisplayOnGrab=function(e,i){let n=null;const s=e.events.on("grab-changed",(t=>{null!=n&&(n.remove(),n=null),"start"===t.action?(n=e.disableDisplay(),i&&i(t)):i&&i(t)}));return t.makeHandle((()=>{n?.remove(),s.remove()}))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/tooltipUtils3D":function(){define(["exports","../../../../core/handleUtils","../../../../core/quantityUtils","../../../../core/reactiveUtils","./manipulatedObjectUtils","../../../interactive/editGeometry/interfaces","../../../interactive/tooltip/tooltipCommonUtils","../../../support/euclideanLengthMeasurementUtils"],(function(e,t,i,n,s,r,o,a){"use strict";function l(e,{activeTooltipInfo:t,callbacks:i}){if(!t)return;i.onBeforeUpdate();const n=s.manipulatedObjectGeometry(e);switch(n?.type){case"mesh":c(t,n.origin,e,i),"orientation"in t&&"scale"in t&&o.updateMeshTransformFromTooltipInfo(t,n,i);break;case"point":c(t,n,e,i)}}function c(e,t,i,n){const{dx:s,dy:a,dz:l}=o.getXYZDeltasFromTooltipInfo(e,t);0===s&&0===a&&0===l||(n.onMoveStart(),i.operations?.move(s,a,l,r.AccumulationBehavior.NEW_STEP),n.onMove(s,a,l),n.onMoveStop())}function h(e,t){const i=s.manipulatedObjectGeometry(t),n=i?.type;if(!e||!i||"mesh"!==n&&"point"!==n)return;const r="mesh"===n,a=r?i.origin:i;e.setLocationFromPoint(a),u(e,a,t),"transform-mesh"===e.type&&r&&o.updateTooltipInfoFromMeshTransform(e,i),e.clearInputValues()}function u(e,t,i){e.elevation.actual=a.elevationFromPoint(t),e.elevation.visible=!!i.operations?.data.coordinateHelper.hasZ(),e.elevation.readOnly=!1,e.elevation.showAsZ=!0}function m(e){switch(e){case"integer":case"long":return 0;default:return null}}e.connectTooltipToManipulatedObject=function(e,r,a){function c(){const e=a(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:t}}let u=!1;function d(e){u||(u=!0,e(),u=!1)}function p({activeTooltipInfo:t,sketchOptions:n,scaleRotateTransform:s}){d((()=>{t&&(t.sketchOptions=n,h(t,r),function(e,t){if("transform-point"!==e?.type)return;if(!t)return e.orientation.actual=void 0,e.size.actual=void 0,e.orientation.visible=!1,void(e.size.visible=!1);const n=t.mode,{size:s,orientationClockwise:r}=t.adapter,{visualVariables:o}=e.sketchOptions.tooltips,a=o?.rotation,l=null!=r&&(null==n||"rotate"===n);e.orientation.actual=l?i.createAngle(r,"radians","geographic"):void 0,e.orientation.precision=m(a?.valueType),e.orientation.visible=l;const c=o?.size,h=null!=s&&(null==n||"scale"===n);e.size.actual=h?i.createLength(s,c?.unit??"meters"):void 0,e.size.precision=m(c?.valueType),e.size.visible=h}(t,s)),e.info=t}))}return t.handlesGroup([n.watch(c,p,n.syncAndInitial),n.watch((()=>{const e=c(),{activeTooltipInfo:t}=e;if(t)return{context:e,activeTooltipInfo:t,key:t.key,geometry:s.manipulatedObjectGeometry(r)}}),((e,t)=>{e&&t&&t.key!==e.key&&d((()=>l(r,e.context)))}),n.sync),r.on("committed",(()=>{queueMicrotask((()=>p(c())))})),o.connectPasteEvent(e,{onBeforePaste:()=>{u=!0},onAfterPaste:()=>{l(r,c()),u=!1}})])},e.updateElevationFromPoint=u,e.updateTooltipInfoFromManipulatedObject=h,e.updateXYZFromTooltipInfo=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/visualElementUtils":function(){define(["exports","./lineObjectVisualElementUtils","./manipulatedObjectUtils","./originGeometryVisualElementUtils"],(function(e,t,i,n){"use strict";e.createVisualElements=function(e){switch(i.manipulatedObjectGeometry(e.object)?.type){case"point":case"mesh":return n.createVisualElements(e);case"polygon":case"polyline":return t.createVisualElements(e);default:return null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/lineObjectVisualElementUtils":function(){define(["exports","../../../../core/handleUtils","../../../../core/mathUtils","../../../../core/reactiveUtils","../../../../core/signal","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../Manipulator3D","./GrabbingState","./manipulatedObjectUtils","./ManipulatorState","./ManipulatorType","./settings","../visualElements/ExtendedLineVisualElement","../visualElements/LaserlineVisualElement","../visualElements/OutlineVisualElement","../../webgl-engine/lib/Material"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_){"use strict";function f(e){return null!=e&&("polygon"===e.type||"polyline"===e.type)}const y=o.create();e.createVisualElements=function(e){const{object:o}=e,x=function(e){const{view:i,object:s}=e,r=c.manipulatedObjectGeometry(s),o=new g.OutlineVisualElement({view:i,geometry:f(r)?r:null,elevationInfo:s.elevationInfo,attached:!1,isDecoration:!0}),a=new m.Settings({getTheme:()=>i.effectiveTheme}),l=()=>{o.attached=s.visible},h=t.handlesGroup([n.watch((()=>a.visualElements.lineObjects.outline),(e=>e.apply(o)),n.initial),n.watch((()=>a.visualElements.lineObjects.shadowStyle),(e=>e.apply(o)),n.initial),n.watch((()=>s.visible),l),n.watch((()=>s.isDraped),(e=>{o.isDraped=e}),n.initial),s.on("committed",(()=>{const e=c.manipulatedObjectGeometry(s);o.geometry=f(e)?e:null})),t.destroyHandle(o)]);return l(),{visualElement:o,remove:()=>h.remove()}}(e),v=function(e,o){const{object:g,view:x}=e,v=[],P=g.elevationInfo,b="on-the-ground"===P.mode||!P.offset&&"absolute-height"!==P.mode,E=new h.ManipulatorState,S=new m.Settings({getTheme:()=>x.effectiveTheme}),C=S.visualElements,w=new d.ExtendedLineVisualElement({view:x,extensionType:C.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:_.RenderOccludedFlag.OccludeAndTransparent,isDecoration:!0}),T=i.deg2rad(C.heightPlaneAngleCutoff),D=new p.LaserlineVisualElement({view:x,attached:!1,angleCutoff:T,isDecoration:!0}),I=s.signal(1);v.push(n.watch((()=>({lineShadowStyle:S.visualElements.lineObjects.shadowStyle,pointShadowStyle:S.visualElements.pointObjects.shadowStyle,alpha:I.value})),(({lineShadowStyle:e,pointShadowStyle:t,alpha:i})=>{e.apply(o,i),t.apply(w,i)}),n.initial));const A=s.signal(1);v.push(n.watch((()=>({heightPlane:S.visualElements.heightPlane,alpha:A.value})),(({heightPlane:e,alpha:t})=>e.apply(D,t)),n.initial));const M=()=>{E.update(e);const t=c.manipulatedObjectGeometry(g);if(!g.visible||b&&(g.isDraped||!f(t)||!t.hasZ))return o.laserlineEnabled=!1,w.attached=!1,void(D.attached=!1);o.laserlineEnabled=!0;const i=E.grabbingState&l.GrabbingState.XY?C.laserlineAlphaMultiplier:1;I.value=i;const n=E.grabbingState&l.GrabbingState.Z?C.laserlineAlphaMultiplier:1;A.value=n,function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&null!=t.firstGrabbedXY?t.firstGrabbedXY:null;null!=i?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}(w,E),function(e,t,i,n){if(n.numSelected>0){r.set(y,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{i===u.ManipulatorType.TRANSLATE_XY&&e.selected&&e instanceof a.Manipulator3D&&(r.add(y,y,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=r.scale(y,y,1/t),i.attached=!0):i.attached=!1}else{const n=t.attachmentOrigin;null!=n&&e.view.renderCoordsHelper.toRenderCoords(n,y)?(i.heightManifoldTarget=y,i.attached=!0):i.attached=!1}}(e,o,D,E)};v.push(n.watch((()=>S.visualElements.zVerticalLine),(e=>e.apply(w)),n.initial)),v.push(g.on("committed",M),n.watch((()=>g.visible),M),o.events.on("attachment-origin-changed",M),t.destroyHandle(w),t.destroyHandle(D));const N=[],R=()=>{t.removeHandles(N),N.length=0,e.forEachManipulator((e=>N.push(e.events.on("grab-changed",M)))),e.forEachManipulator((e=>N.push(e.events.on("select-changed",M)))),M()};return R(),v.push(e.onManipulatorsChanged(R),t.refHandle((()=>t.handlesGroup(N)))),t.handlesGroup(v)}(e,x.visualElement),P=[x,v];return o.maskOccludee&&P.push(o.maskOccludee()),{visualElement:x.visualElement,remove:()=>t.removeHandles(P)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/Manipulator3D":function(){define(["exports","../../../core/compilerUtils","../../../core/Evented","../../../core/handleUtils","../../../core/has","../../../core/mathUtils","../../../core/maybe","../../../core/screenUtils","../../../core/libs/gl-matrix-2/math/mat3","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../core/libs/gl-matrix-2/math/mat4","../../../core/libs/gl-matrix-2/factories/mat4f64","../../../core/libs/gl-matrix-2/math/vec2","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/ellipsoidUtils","../../../geometry/Point","../../../geometry/projectionUtils","../../../geometry/projection/localRotationUtils","../../../geometry/projection/projectors","../../../geometry/support/aaBoundingRect","../../../geometry/support/lineSegment","../../../geometry/support/plane","../../../geometry/support/ray","../../../geometry/support/vectorStacks","../../../layers/graphics/hydratedFeatures","../../../support/elevationInfoUtils","../support/ElevationProvider","../support/geometryUtils/ray","../webgl/RenderCamera","../webgl-engine/lib/Object3D","../webgl-engine/lib/UpdatePolicy","../webgl-engine/lib/WebGLLayer","../../interactive/interfaces"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C,w,T,D,I,A,M,N,R){"use strict";function O(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const G=a.createScreenPointArray(),k=P.create(),V=E.create(),F=c.create(),L=u.create(),q=u.create(),H=b.create(),U=p.create(),z=p.create(),Y=p.create(),B=p.create(),X=p.create(),j=p.create(),W=new _({x:0,y:0,z:0,spatialReference:null}),Z=()=>{};e.Manipulator3D=class{constructor(e){this.metadata=void 0,this._camera=new I,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=u.create(),this._worldFrame=null,this._renderLocation=p.create(),this._renderLocationDirty=!0,this._location=new _({x:0,y:0,z:0}),this._elevationAlignedLocation=new _,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=R.ManipulatorStateCustomFlags.None,this._focused=!1,this.events=new i.EventEmitter,this._screenLocation={screenPointArray:a.createScreenPointArray(),renderScreenPointArray:a.createRenderScreenPointArray3(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);const t=this.view.state?.camera;t&&this._camera.copyFrom(t)}destroy(){this._applyObjectTransform=Z,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?.stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),n.makeHandle((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){O(e)&&(this._screenLocationDirty=!0),h.copy(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=u.create()),function(e,t,i){switch(e.viewingMode){case"local":return h.identity(i),!0;case"global":{const n=g.getReferenceEllipsoid(e.renderCoordsHelper.spatialReference);x.sphericalPCPFtoLonLatElevation(t,0,U,0,n.radius),y.computeENUToPCPFLocalRotation(r.deg2rad(U[0]),r.deg2rad(U[1]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){C.clonePoint(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){C.clonePoint(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=null!=this._elevation.override?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=C.hydratedSpatialReference(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,O(this._modelTransform)){const t=this._calculateModelTransformOffset(j);e=d.add(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,i){if(!this.available)return null;const n=a.screenPointObjectToArray(e,G),s=this._getCollisionRadius(i),r=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(m.squaredDistance(this.screenLocation.screenPointArray,n)<s*s)return this.screenLocation.renderScreenPointArray[2]+r;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,q),o=s*this.screenLocation.pixelSize,l=D.fromScreen(this._camera,n,V);if(null==l)return null;for(const t of e){if(0===t.length)continue;const e=d.transformMat4(U,t[0],i);for(let n=1;n<t.length;n++){const s=d.transformMat4(z,t[n],i),c=P.closestRayDistance2(P.fromPoints(e,s,k),l);if(null!=c&&c<o*o){const t=d.add(S.sv3d.get(),e,s);d.scale(t,t,.5);const i=a.castRenderScreenPointArray(S.sv3d.get());return this._camera.projectToRenderScreen(t,i),i[2]+r}d.copy(e,s)}}break}case"disc":{const e=this.collisionType.direction,t=this.collisionType.offset??p.ZEROS,i=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(i,q),a=s*this.screenLocation.pixelSize,c=D.fromScreen(this._camera,n,V);if(null==c)return null;const h=l.fromMat4(F,o),u=d.transformMat3(B,e,h),m=d.transformMat4(X,t,o);b.fromPositionAndNormal(m,u,H);const g=Y;if(b.intersectRay(H,c,g)&&d.squaredDistance(g,m)<a*a)return this.screenLocation.renderScreenPointArray[2]+r;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,i=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(i,q),c=s*this._camera.computeScreenPixelSizeAt(this.renderLocation),h=D.fromScreen(this._camera,n,V);if(null==h)return null;const u=l.fromMat4(F,o),m=d.transformMat3(B,t,u),p=this._calculateModelTransformPosition(X);b.fromPositionAndNormal(p,m,H);const g=Y;if(!b.intersectRay(H,h,g))break;for(const t of e){if(0===t.length)continue;const e=d.transformMat4(U,t[0],o);for(let i=1;i<t.length;i++){const n=d.transformMat4(z,t[i],o),s=P.distance2(P.fromPoints(e,n,k),g);if(null!=s&&s<c*c){const t=d.add(S.sv3d.get(),e,n);d.scale(t,t,.5);const i=a.castRenderScreenPointArray(S.sv3d.get());return this._camera.projectToRenderScreen(t,i),i[2]+r}d.copy(e,n)}}break}default:t.neverReached(this.collisionType)}return null}attach(e={manipulator3D:{}}){const t=this._stage;if(!t)return;const i=e.manipulator3D;null==i.engineLayerId?(this._engineLayer=new N.WebGLLayer(t,{pickable:!1,updatePolicy:M.UpdatePolicy.SYNC}),i.engineLayerId=this._engineLayer.id):t?.getLayer&&(this._engineLayer=t.getLayer(i.engineLayerId)),i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),f.canProjectWithoutEngine(this._location.spatialReference,this.view.spatialReference)||(this.location=new _({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;this._removeResourcesFromStage(),i&&(t.engineLayerId=null,o.destroyMaybe(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){f.projectPoint(this.location,W,e.spatialReference)&&v.containsPointObject(e.extent,W)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(null==this.elevationInfo)return;let e=null,t=0;const i=w.getElevationOffset(this.elevationInfo,this.location.spatialReference??this.view.elevationProvider.spatialReference);switch(this.elevationInfo.mode){case"on-the-ground":e=T.getElevationAtPoint(this.view.elevationProvider,this.location,"ground")??0;break;case"relative-to-ground":t=(T.getElevationAtPoint(this.view.elevationProvider,this.location,"ground")??0)+i;break;case"relative-to-scene":t=(T.getElevationAtPoint(this.view.elevationProvider,this.location,"scene")??0)+i;break;case"absolute-height":t=i}return t!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=t,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=q;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),n=(this.focused?R.ManipulatorStateFlags.Focused:R.ManipulatorStateFlags.Unfocused)|(this.selected?R.ManipulatorStateFlags.Selected:R.ManipulatorStateFlags.Unselected),s=this._noDisplayCount>0;for(const{stateMask:e,objects:r}of i){if(s){for(const e of r)e.visible=!1;continue}const i=(e&R.ManipulatorStateFlags.All)!==R.ManipulatorStateFlags.None,o=(e&R.ManipulatorStateCustomFlags.All)!==R.ManipulatorStateCustomFlags.None,a=!i||(n&e)===(e&R.ManipulatorStateFlags.All),l=!o||(this.state&e)===(e&R.ManipulatorStateCustomFlags.All);if(a&&l)for(const e of r)e.visible=!0,e.transformation=t;else for(const e of r)e.visible=!1}}_ensureEngineResources(){if(null==this._engineResources){const e=this._engineLayer,t=[],i=new Set;this.renderObjects.forEach((({geometry:{material:e}})=>{i.has(e)||(t.push(e),i.add(e))}));const n=new Map;this._renderObjects.forEach((e=>{const t=new A.Object3D({castShadow:!1,geometries:[e.geometry]}),i=n.get(e.stateMask)||[];i.push(t),n.set(e.stateMask,i)}));const s=[];n.forEach(((e,t)=>s.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:s,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i}=this._engineResources;t.forEach((({objects:e})=>i.addMany(e))),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){const e=this._stage;if(!this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i}=this._engineResources;t.forEach((({objects:e})=>i.removeMany(e))),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,L);return d.set(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return d.subtract(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return h.set(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&h.multiply(t,t,this._worldFrame),h.multiply(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,null!=this._applyObjectTransform&&this._applyObjectTransform(t),t}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/GrabbingState":function(){define(["exports"],(function(e){"use strict";var t;e.GrabbingState=void 0,(t=e.GrabbingState||(e.GrabbingState={}))[t.NONE=0]="NONE",t[t.ANY=1]="ANY",t[t.Z=2]="Z",t[t.XY=4]="XY",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/ManipulatorState":function(){define(["exports","../Manipulator3D","./GrabbingState","./ManipulatorType"],(function(e,t,i,n){"use strict";e.ManipulatorState=class{constructor(){this.grabbingState=i.GrabbingState.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=i.GrabbingState.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,s)=>{if(s===n.ManipulatorType.TRANSLATE_Z&&(this.zManipulator=e),e instanceof t.Manipulator3D&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),null==this.firstGrabbedXY&&e.grabbing&&s===n.ManipulatorType.TRANSLATE_XY&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=i.GrabbingState.ANY,s){case n.ManipulatorType.TRANSLATE_Z:this.grabbingState|=i.GrabbingState.Z;break;case n.ManipulatorType.TRANSLATE_XY:this.grabbingState|=i.GrabbingState.XY}}))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/ManipulatorType":function(){define(["exports"],(function(e){"use strict";var t;e.ManipulatorType=void 0,(t=e.ManipulatorType||(e.ManipulatorType={}))[t.TRANSLATE_Z=0]="TRANSLATE_Z",t[t.TRANSLATE_XY=1]="TRANSLATE_XY",t[t.SCALE=2]="SCALE",t[t.ROTATE=3]="ROTATE",t[t.SCALE_ROTATE=4]="SCALE_ROTATE",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/originGeometryVisualElementUtils":function(){define(["exports","../../../../core/handleUtils","../../../../core/mathUtils","../../../../core/reactiveUtils","../../../../core/signal","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/projection/projectPointToVector","../../../../geometry/projection/projectVectorToVector","../../../../geometry/support/aaBoundingBox","../../../../geometry/support/aaBoundingRect","../../../../support/elevationInfoUtils","./GrabbingState","./manipulatedObjectUtils","./ManipulatorState","./settings","../visualElements/ExtendedLineVisualElement","../visualElements/LaserlineVisualElement","../visualElements/PointVisualElement","../../layers/graphics/elevationAlignmentUtils","../../layers/graphics/ElevationContext","../../webgl-engine/lib/Material"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P){"use strict";function b(e){return null==e?null:"point"===e.type?e:"mesh"===e.type?e.origin.clone():null}const E=o.create(),S=c.create();e.createVisualElements=function(e){const o=[],C=function(e,i){const{view:s,object:r}=e,o=new y.PointVisualElement({view:s,geometry:b(d.manipulatedObjectGeometry(r)),elevationInfo:r.elevationInfo,isDecoration:!0});return function(e,i,s){const{view:r,object:o}=e,l=new g.Settings({getTheme:()=>r.effectiveTheme});(function(e,i,n){const{view:s,object:r}=e;let o=null;const l=()=>{const e=b(d.manipulatedObjectGeometry(r));null!=e&&u.featureExpressionInfoIsZero(r.elevationInfo)&&(e.z=0),(e=>{null!=o&&(o.remove(),o=null),r.isDraped&&null!=e&&(o=function(t,n){const s=t.elevationProvider.spatialReference;a.projectPointToVector(n,E,s);const r=E[0],o=E[1];return t.elevationProvider.on("elevation-change",(t=>{h.containsXY(t.extent,r,o)&&(i.geometry=e)}))}(s,e))})(e),i.geometry=e};n.push(r.on("committed",l),t.refHandle((()=>o))),l()})(e,i,s),l.visualElements.pointObjects.outline.apply(i),s.push(n.watch((()=>o.visible),(()=>{i.attached=o.visible}),n.initial))}(e,o,i),i.push(t.destroyHandle(o)),o}(e,o);return function(e,o,a){const{view:h,object:y}=e,C=new g.Settings({getTheme:()=>h.effectiveTheme}),w=new _.ExtendedLineVisualElement({view:h,extensionType:C.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:P.RenderOccludedFlag.OccludeAndTransparent,isDecoration:!0});o.push(n.watch((()=>C.visualElements.zVerticalLine),(e=>e.apply(w)),n.initial));const T=new f.LaserlineVisualElement({view:h,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),D=i.deg2rad(C.visualElements.heightPlaneAngleCutoff),I=new f.LaserlineVisualElement({view:h,attached:!1,angleCutoff:D,isDecoration:!0}),A=y.elevationInfo,M=v.ElevationContext.fromElevationInfo(A),N="on-the-ground"===A.mode||!A.offset&&"absolute-height"!==A.mode,R=new p.ManipulatorState,O=s.signal(1);o.push(n.watch((()=>({heightPlane:C.visualElements.heightPlane,alpha:O.value})),(({heightPlane:e,alpha:t})=>e.apply(I,t)),n.initial));const G=s.signal(1);o.push(n.watch((()=>({shadowStyle:C.visualElements.pointObjects.shadowStyle,alpha:G.value})),(({shadowStyle:e,alpha:t})=>e.apply(T,t)),n.initial));const k=()=>{R.update(e);let t=b(d.manipulatedObjectGeometry(y));const i=N&&(y.isDraped||null==t||!t.hasZ);let n=!0;if(i||null==t)n=!1;else{u.featureExpressionInfoIsZero(y.elevationInfo)&&(t=t.clone(),t.z=0);const e=x.evaluateElevationAlignmentAtPoint(t,h.elevationProvider,M,h.renderCoordsHelper);r.set(E,t.x,t.y,e),l.projectVectorToVector(E,t.spatialReference,E,h.renderCoordsHelper.spatialReference),w.setStartEndFromWorldDownAtLocation(E),T.intersectsWorldUpAtLocation=E}const s=R.grabbingState&m.GrabbingState.Z?C.visualElements.laserlineAlphaMultiplier:1;O.value=s;const o=c.empty(S);!i&&y.visible&&a.calculateMapBounds(o)&&l.projectVectorToVector(c.getMin(o,E),h.spatialReference,E,h.renderCoordsHelper.spatialReference)?(I.heightManifoldTarget=E,I.attached=!0):I.attached=!1;const p=R.grabbingState&m.GrabbingState.XY?C.visualElements.laserlineAlphaMultiplier:1;G.value=p;const g=n&&y.visible&&!i;T.attached=g,w.attached=g};o.push(n.watch((()=>[y.visible,y.isDraped]),k),y.on("committed",k)),e.forEachManipulator((e=>{o.push(e.events.on("grab-changed",k))})),o.push(t.destroyHandle(T)),o.push(t.destroyHandle(w)),o.push(t.destroyHandle(I)),k()}(e,o,C),{visualElement:C,remove:()=>t.removeHandles(o)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/manipulations/config":function(){define(["exports"],(function(e){"use strict";const t=Math.ceil(70/3*2),i=5*Math.PI/12,n=1*Math.PI/3;e.alignArrowsScaleThreshold=1e6,e.discCollisionRadius=80,e.discHeight=.02,e.discRadius=70,e.discRadiusSmall=t,e.discTranslateArrowOffset=100,e.discTranslateArrowSize=54,e.dragThresholdPx=10,e.geometrySegments=128,e.indicatorThickness=9,e.innerIndicatorRadius=190,e.outerIndicatorRadius=213,e.ringHeight=.5,e.ringIndicatorDelayMs=200,e.ringRadius=160,e.ringResetAnimationSpeedFactor=3,e.ringThickness=24,e.rotateIndicatorArcLength=i,e.rotateIndicatorArrowPlacementPercentage=.2,e.rotateIndicatorArrowTipLength=60,e.rotateIndicatorArrowTipRadius=23,e.rotateIndicatorDirectionBuffer=.3,e.scaleIndicatorArcLength=n,e.scaleIndicatorDirectionBuffer=.2,e.scaleIndicatorOffset1=30,e.scaleIndicatorOffset2=53,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/manipulations/MoveManipulation":function(){define(["exports","../../../../../core/Handles","../../../../../core/handleUtils","../../../../../core/has","../../../../../core/reactiveUtils","../ManipulatorType","./config","./InteractiveManipulation","./MoveXYAxisManipulation","./MoveXYDiscManipulation","./MoveZManipulation"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";class u extends a.InteractiveManipulation{constructor(e){super(),this._handles=new t;const{tool:i,view:n,snapToScene:s,radius:r}=e;this._view=n,this.xyManipulation=new c.MoveXYDiscManipulation({tool:i,view:n,snapToScene:s,radius:r}),this.xyAxisManipulation=new l.MoveXYAxisManipulation({tool:i,view:n,radius:r}),this.zManipulation=new h.MoveZManipulation({tool:i,view:n,radius:r}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((e=>this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createManipulatedObjectDragPipeline(t,n,s){return i.handlesGroup([this.xyManipulation.createManipulatedObjectDragPipeline(((i,n,s,r,o)=>t(e.ManipulationType.XY,i,n,s,r,o)),n,s),this.xyAxisManipulation.createManipulatedObjectDragPipeline(((i,n,s,r,o)=>t(e.ManipulationType.XY_AXIS,i,n,s,r,o)),n,s),this.zManipulation.createManipulatedObjectDragPipeline(((i,n,s,r,o)=>t(e.ManipulationType.Z,i,n,s,r,o)),n,s)])}createDragPipeline(t,n,s,r){return i.handlesGroup([this.xyManipulation.createDragPipeline(((i,n,s,r,o)=>t(e.ManipulationType.XY,i,n,s,r,o)),n,s,r),this.xyAxisManipulation.createDragPipeline(((i,n,s,r,o)=>t(e.ManipulationType.XY_AXIS,i,n,s,r,o)),n,s,r),this.zManipulation.createDragPipeline(((i,n,s,r,o)=>t(e.ManipulationType.Z,i,n,s,r,o)),s)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,r.ManipulatorType.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((t=>e(t,r.ManipulatorType.TRANSLATE_XY))),this.zManipulation.forEachManipulator((t=>e(t,r.ManipulatorType.TRANSLATE_Z)))}get _xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(n("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const r=()=>{const t=[];this._xyAxisVisible||e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(m),this._handles.add(t,m)};for(const e of i)this._handles.add(e.events.on("focus-changed",r));this._view.inputManager&&this._handles.add(s.when((()=>this._view.inputManager?.latestPointerType),r)),r()}static radiusForSymbol(e){const t=null!=e&&"point-3d"===e.type&&e.symbolLayers;return t&&t.some((e=>"icon"===e.type))?o.discRadiusSmall:o.discRadius}}const m="disable-xy-axis-display";var d;e.ManipulationType=void 0,(d=e.ManipulationType||(e.ManipulationType={}))[d.XY=0]="XY",d[d.XY_AXIS=1]="XY_AXIS",d[d.Z=2]="Z",e.MoveManipulation=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/manipulations/InteractiveManipulation":function(){define(["exports","./Manipulation"],(function(e,t){"use strict";class i extends t.Manipulation{constructor(){super(...arguments),this._interactive=!0}get interactive(){return this._interactive}set interactive(e){this._interactive!==e&&(this._interactive=e),this._updateManipulatorInteractivity()}_updateManipulatorInteractivity(){const e=!this.grabbing&&this._interactive;this.forEachManipulator((t=>{t.interactive=e||t.grabbing}))}}e.InteractiveManipulation=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/manipulations/Manipulation":function(){define(["exports","../../Manipulator3D"],(function(e,t){"use strict";e.Manipulation=class{constructor(){this._available=!0}set location(e){this._forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this._forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this._forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this._forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}set renderLocation(e){this._forEachManipulator3D((t=>t.renderLocation=e))}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D((t=>t.available=e))}get hovering(){return this.someManipulator((e=>e.hovering))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}get selected(){return this.someManipulator((e=>e.selected))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}_forEachManipulator3D(e){this.forEachManipulator(((i,n)=>{i instanceof t.Manipulator3D&&e(i,n)}))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/manipulations/MoveXYAxisManipulation":function(){define(["exports","../../../../../Color","../../../../../core/Evented","../../../../../core/Handles","../../../../../core/handleUtils","../../../../../core/has","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../geometry/support/vectorStacks","../../Manipulator3D","../../RenderObject","../dragEventPipeline3D","../ManipulatorType","./config","./Manipulation","./moveUtils","../../../webgl-engine/lib/basicInterfaces","../../../webgl-engine/lib/GeometryUtil","../../../webgl-engine/lib/Material","../../../webgl-engine/materials/ColorMaterial","../../../../interactive/dragEventPipeline","../../../../interactive/interfaces"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C){"use strict";class w extends y.Manipulation{constructor(e){super(),this._handles=new n,this._arrowManipulatorInfos=new Array,this._angle=0,this._scale=1,this._radius=f.discRadius,this._updateAfterDrag=!1,this.events=new i,this._tool=e.tool,this._view=e.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e)}destroy(){this._handles=o.destroyMaybe(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,_.ManipulatorType.TRANSLATE_XY)}createManipulatedObjectDragPipeline(e,t,i){if(!t.operations)return s.makeHandle();const n=t.operations.data.spatialReference,r=t.graphic;return x.createManipulatedMoveDragPipeline(t,i,(i=>this.createDragPipeline(((t,n,s,r,o)=>(({steps:n,cancel:s}=e(t,n,s,r,o)),i(t,n,s))),t.elevationInfo,n,r)))}createDragPipeline(e,t,i,n){return s.handlesGroup(this._arrowManipulatorInfos.map((({manipulator:s},r)=>S.createManipulatorDragEventPipeline(s,((s,o,a,l,c)=>{const h=o.next((e=>({...e,manipulatorType:_.ManipulatorType.TRANSLATE_XY}))).next(S.dragAtLocation(this._view,s.elevationAlignedLocation)).next(g.screenToMapXYAtLocation(this._view,s.elevationAlignedLocation,t,i,n)).next(S.constrainToMapAxis(s.location,this.angle+(r+1)*Math.PI*.5)).next(S.addScreenDelta());e(s,h,a,l,c)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const n=this._radius/f.discRadius,s=f.discTranslateArrowSize*n,r=s*Math.sqrt(3)/2,o=P.createExtrudedTriangle(this._opaqueMaterial,r,s/2,s/2,f.discHeight);P.transformInPlace(o,l.fromTranslation(m.sm4d.get(),h.set(m.sv3d.get(),0,-r/3,0))),e.renderObjects=[new p.RenderObject(o,C.ManipulatorStateFlags.Focused),new p.RenderObject(o.instantiate({material:this._transparentMaterial}),C.ManipulatorStateFlags.Unfocused)],e.radius=r/3*2*1.2;const a=l.fromZRotation(m.sm4d.get(),i*Math.PI/2),c=l.fromTranslation(m.sm4d.get(),h.set(m.sv3d.get(),0,f.discTranslateArrowOffset*n,0));l.multiply(t,a,c)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=l.fromRotation(m.sm4d.get(),e,u.fromValues(0,0,1));if(null==t)return;const i=l.fromScaling(m.sm4d.get(),h.set(m.sv3d.get(),this.displayScale,this.displayScale,this.displayScale)),n=l.multiply(m.sm4d.get(),i,t);for(const e of this._arrowManipulatorInfos){const t=l.multiply(m.sm4d.get(),n,e.transform);e.manipulator.modelTransform=t}}_createArrowManipulator(e){const t=new d.Manipulator3D({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:u.fromValues(0,0,1)}}),i={manipulator:t,transform:c.create()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(e=1){const i=new E.ColorMaterial({cullFace:v.CullFaceOptions.Back,renderOccluded:b.RenderOccludedFlag.Transparent,isDecoration:!0});return this._handles.add(a.watch((()=>t.toUnitRGBA(this._view.effectiveTheme.accentColor)),(t=>{t[3]*=e,i.setParameters({color:t})}),a.initial)),i}get test(){}}e.MoveXYAxisManipulation=w,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/RenderObject":function(){define(["exports","../../interactive/interfaces"],(function(e,t){"use strict";e.RenderObject=class{constructor(e,i=t.ManipulatorStateFlags.None){this.geometry=e,this.stateMask=i}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/dragEventPipeline3D":function(){define(["exports","../../../../core/screenUtils","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/Point","../../../../geometry/projectionUtils","../../../../geometry/support/plane","../../../../geometry/support/ray","../../../../geometry/support/vector","../../../../geometry/support/vectorStacks","../../../../support/elevationInfoUtils","../../support/geometryUtils/ray","../../webgl-engine/lib/Intersector","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/IntersectorType","../../webgl-engine/lib/verticalOffsetUtils","../../../interactive/dragEventPipeline"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f){"use strict";function y(e,t){return x(e,(()=>t))}function x(e,i){const n=s.create(),r=s.create();let o=!1;return s=>{const l=i(s);if("start"===s.action){const i=t.screenPointObjectToArray(s.screenStart,t.castScreenPointArray(h.sv2d.get())),r=m.fromScreen(e.state.camera,i,T);null!=r&&(o=a.intersectRay(l,r,n))}if(!o)return null;const c=t.screenPointObjectToArray(s.screenEnd,t.castScreenPointArray(h.sv2d.get())),u=m.fromScreen(e.state.camera,c,T);return null==u?null:a.intersectRay(l,u,r)?{...s,renderStart:n,renderEnd:r,plane:l,ray:u}:null}}function v(e,i,n,s=null,r=null){return function(e,i,n=0,s=null,r=null){let a=null;return l=>{if("start"===l.action&&(a=e.sceneIntersectionHelper.intersectElevationFromScreen(t.createScreenPointArray(l.screenStart.x,l.screenStart.y),i,n,r),null!=a&&null!=s&&!o.projectPoint(a,a,s)))return null;if(null==a)return null;const c=e.sceneIntersectionHelper.intersectElevationFromScreen(t.createScreenPointArray(l.screenEnd.x,l.screenEnd.y),i,n,r);return null==c||null!=s&&!o.projectPoint(c,c,s)?null:{...l,mapStart:a,mapEnd:c}}}(e,n,u.getZForElevationMode(i,e,n),s,r)}function P(e,t){const i=s.create(),r=n.length(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const o=s.create(),a=s.create(),l=s=>(n.subtract(s,s,t),c.projectPoint(i,s,s),"global"===e.viewingMode&&n.length(s)*Math.sign(n.dot(i,s))<.001-r&&n.subtract(s,n.scale(s,i,.001),t),n.add(s,s,t),s);return e=>(e.renderStart=l(n.copy(o,e.renderStart)),e.renderEnd=l(n.copy(a,e.renderEnd)),e)}function b(e,t){const i=e.renderCoordsHelper;return e=>{const n=i.fromRenderCoords(e.renderStart,new r({spatialReference:t})),s=i.fromRenderCoords(e.renderEnd,new r({spatialReference:t}));return null!=n&&null!=s?{...e,mapStart:n,mapEnd:s}:null}}var E;e.SurfaceType=void 0,(E=e.SurfaceType||(e.SurfaceType={}))[E.GROUND=0]="GROUND",E[E.OTHER=1]="OTHER";const S=i.create(),C=s.create(),w=s.create(),T=l.create();e.convertToMapCoordinates=b,e.hideManipulatorWhileDragging=function(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":null!=t&&(t.remove(),t=null)}return i}},e.projectToWorldUp=P,e.screenToMap3D=function(i,n=null){const o=new d.Intersector(i.state.viewingMode);o.options.selectionMode=!0,o.options.store=p.StoreResults.MIN,o.options.hud=!1;const a=t.createScreenPointArray(),l={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},c=s.create(),h=n??i.spatialReference,u=n=>{i.map.ground&&i.map.ground.opacity<1?l.exclude.add(_.terrainId):l.exclude.delete(_.terrainId),i.sceneIntersectionHelper.intersectIntersectorScreen(t.screenPointObjectToArray(n,a),o,l);const s=o.results.min;let u;if(s.getIntersectionPoint(c))u=s.intersector===g.IntersectorType.TERRAIN?e.SurfaceType.GROUND:e.SurfaceType.OTHER;else{if(!o.results.ground.getIntersectionPoint(c))return null;u=e.SurfaceType.GROUND}return{location:i.renderCoordsHelper.fromRenderCoords(c,new r({spatialReference:h})),surfaceType:u}};let m;return e=>{if("start"===e.action){const t=u(e.screenStart);m=null!=t?t.location:null}if(null==m)return null;const t=u(e.screenEnd);return null!=t?.location?{...e,mapStart:m,mapEnd:t.location,surfaceType:t.surfaceType}:null}},e.screenToMapXYAtLocation=v,e.screenToMapXYForManipulatedObject=function(e,t,i,n){const s=i.toMap(e.screenStart);return null!=s?v(t,s,i.elevationInfo,n):null},e.screenToRenderPlane=y,e.screenToRenderPlaneFromEvent=function(e){return x(e,(e=>e.plane))},e.screenToRenderRay=function(e,i){const n=n=>{const s=t.screenPointObjectToArray(n,t.castScreenPointArray(S)),r=m.fromScreen(e.state.camera,s,T);if(null==r)return null;const o=l.closestPoints(i,r,C,w);return o?.[0]};return e=>{const t=n(e.screenStart);if(null==t)return null;const i=n(e.screenEnd);return null==i?null:{...e,renderStart:t,renderEnd:i}}},e.screenToZConstrained=function(e,t,i){let s=null;const r=new f.EventPipeline;return r.next(y(e,function(e,t){const i=C,s=w,r=a.create();e.renderCoordsHelper.worldUpAtPosition(t,i);const o=n.cross(a.getNormal(r),i,n.subtract(s,t,e.state.camera.eye));return n.cross(o,o,i),a.fromPositionAndNormal(t,o,r)}(e,t))).next(P(e,t)).next(b(e,i)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,s=e})),e=>(s=null,r.execute(e),s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/manipulations/moveUtils":function(){define(["exports","../../../../interactive/dragEventPipeline"],(function(e,t){"use strict";e.axisConstrainedDragSign=function(e){if(null==e?.axis)return 1;const{mapStart:t,mapEnd:i,axis:n}=e,s=[i.x-t.x,i.y-t.y];return s[0]*n[0]+s[1]*n[1]>0?1:-1},e.createManipulatedMoveDragPipeline=function(e,i,n){const s=(t,n)=>{i({action:t,object:e,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY})};return n(((i,n,r)=>(n.next((e=>("start"===e.action&&s("start",e),e))).next(t.dragManipulatedObject(e)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&s("update",e);break;case"end":s("end",e)}return e})),{steps:n,cancel:r=r.next(t.resetManipulatedObject(e)).next((e=>(s("end",{screenDeltaX:0,screenDeltaY:0}),e)))})))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/manipulations/MoveXYDiscManipulation":function(){define(["exports","../../../../../Color","../../../../../core/Handles","../../../../../core/handleUtils","../../../../../core/has","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../geometry/support/vectorStacks","../../Manipulator3D","../../RenderObject","../dragEventPipeline3D","../ManipulatorType","./config","./Manipulation","./moveUtils","../snapping/SnapToScene","../../../webgl-engine/lib/basicInterfaces","../../../webgl-engine/lib/GeometryUtil","../../../webgl-engine/lib/Material","../../../webgl-engine/materials/ColorMaterial","../../../../interactive/dragEventPipeline","../../../../interactive/interfaces"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C){"use strict";class w extends f.Manipulation{constructor(e){super(),this._handles=new i,this._snapToScene=new x.SnapToScene,this._scale=1,this._radius=_.discRadius,this._view=e.view,this._tool=e.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles=r.destroyMaybe(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,g.ManipulatorType.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}get discManipulator(){return this._manipulator}createManipulatedObjectDragPipeline(e,t,i){if(!t.operations)return n.makeHandle();const s=t.graphic,r=t.elevationInfo,o=t.operations.data.spatialReference;return y.createManipulatedMoveDragPipeline(t,i,(t=>this.createDragPipeline(((i,n,s,r,o)=>(({steps:n,cancel:s}=e(i,n,s,r,o)),t(i,n,s))),r,o,s)))}createDragPipeline(e,t,i,n){const s=this._view;return S.createManipulatorDragEventPipeline(this._manipulator,((r,o,a,l,c)=>{const h=o.next(S.dragAtLocation(s,r.elevationAlignedLocation)).next(p.screenToMapXYAtLocation(s,r.elevationAlignedLocation,t,i,n)).next(...this._snapToScene.createDragEventPipelineStep(s,t)).next((e=>({...e,manipulatorType:g.ManipulatorType.TRANSLATE_XY}))).next(S.addScreenDelta());e(r,h,a,l,c)}))}_updateManipulatorTransform(){const e=a.fromScaling(u.sm4d.get(),c.set(u.sv3d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new m.Manipulator3D({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:h.fromValues(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=P.createCylinderGeometry(this._discMaterial,_.discHeight,1,_.geometrySegments,h.fromValues(0,0,1),h.fromValues(0,0,0));e.transformation=a.fromScaling(l.create(),h.fromValues(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new d.RenderObject(e,C.ManipulatorStateFlags.Focused),new d.RenderObject(e.instantiate({material:this._discMaterialTransparent}),C.ManipulatorStateFlags.Unfocused)],this._manipulator.radius=_.discCollisionRadius*(this._radius/_.discRadius)}_createMaterial(e=1){const i=new E.ColorMaterial({cullFace:v.CullFaceOptions.Back,renderOccluded:b.RenderOccludedFlag.Transparent,isDecoration:!0});return this._handles.add(o.watch((()=>t.toUnitRGBA(this._view.effectiveTheme.accentColor)),(t=>{t[3]*=e,i.setParameters({color:t})}),o.initial)),i}get test(){}}e.MoveXYDiscManipulation=w,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/snapping/SnapToScene":function(){define(["exports","../../../../../support/elevationInfoUtils","../../../../interactive/dragEventPipeline"],(function(e,t,i){"use strict";e.SnapToScene=class{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t=this._lastDragEvent.mapEnd,i=this._snap(this._lastDragEvent.screenEnd);if(null!=i){const n={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(n)}}this._enabled=e}_snap(e){const i=null!=this._view?this._view.toMap(e,{exclude:[]}):null;return null!=i&&null!=this._view&&(i.z=t.getZForElevationMode(i,this._view,this._elevationInfo)),i}createDragEventPipelineStep(e,t){this._view=e,this._elevationInfo=t,this._lastDragEvent=null;const n=new i.EventPipeline;return this._next=n,[e=>{if(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this._snap(e.screenEnd);return null!=t?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}},n]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/manipulations/MoveZManipulation":function(){define(["exports","../../../../../Color","../../../../../core/colorUtils","../../../../../core/Evented","../../../../../core/handleUtils","../../../../../core/has","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../Manipulator3D","../../manipulatorUtils","../../RenderObject","../dragEventPipeline3D","../ManipulatorType","../settings","./config","./Manipulation","./moveUtils","../../../webgl-engine/lib/GeometryUtil","../../../webgl-engine/lib/Material","../../../../interactive/dragEventPipeline","../../../../interactive/interfaces"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C){"use strict";class w extends v.Manipulation{constructor(e){super(),this._radius=x.discRadius,this.events=new n,this._tool=e.tool,this._view=e.view;const t=new y.Settings({getTheme:()=>this._view.effectiveTheme});this._settings=t,null!=e.radius&&(this._radius=e.radius);const i=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:p.createManipulatorMaterial(T(i,1,.25),E.RenderOccludedFlag.Occlude),materialFocused:p.createManipulatorMaterial(T(i,1,0),E.RenderOccludedFlag.Occlude),materialOccludedUnfocused:p.createManipulatorMaterial(T(i,.7,0),t.zManipulator.renderOccluded),materialOccludedFocused:p.createManipulatorMaterial(T(i,.85,0),t.zManipulator.renderOccluded)},this._themeHandle=l.watch((()=>this._view.effectiveTheme.accentColor),(e=>{const t=T(e,1,.25),i=T(e,1,0),n=T(e,.7,0),s=T(e,.85,0),{materialUnfocused:r,materialFocused:o,materialOccludedUnfocused:a,materialOccludedFocused:l}=this._materials;r.setParameters({color:t}),o.setParameters({color:i}),a.setParameters({color:n}),l.setParameters({color:s})})),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._themeHandle=a.removeMaybe(this._themeHandle),this._manipulator.applyObjectTransform=M,this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,f.ManipulatorType.TRANSLATE_Z)}createManipulatedObjectDragPipeline(e,t,i){if(!t.operations)return s.makeHandle();const n=t.operations.data.spatialReference;return P.createManipulatedMoveDragPipeline(t,i,(t=>this.createDragPipeline(((i,n,s,r,o)=>(({steps:n,cancel:s}=e(i,n,s,r,o)),t(i,n,s))),n)))}createDragPipeline(e,t){const i=this._view;return S.createManipulatorDragEventPipeline(this._manipulator,((n,s,r,o,a)=>{const l=s.next((e=>({...e,manipulatorType:f.ManipulatorType.TRANSLATE_Z}))).next(_.screenToZConstrained(i,n.renderLocation,t)).next(S.addScreenDelta());e(n,l,r,o,a)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._settings,t=this._radius/x.discRadius,i=e.zManipulator.height*t,n=e.zManipulator.coneHeight*t,s=e.zManipulator.coneWidth*t,r=e.zManipulator.width*t,o=[m.fromValues(0,0,0),m.fromValues(0,0,i)],a=[m.fromValues(0,0,0),m.fromValues(0,0,i+n)],l=(()=>{const e=h.create();return c.translate(e,e,[0,0,i]),c.rotateX(e,e,Math.PI/2),e})(),{materialUnfocused:u,materialFocused:d,materialOccludedUnfocused:p,materialOccludedFocused:_}=this._materials,f=b.createTubeGeometry(u,o,r/2,16,!1),y=b.createConeGeometry(u,n,s/2,16,!1);y.transformation=l,this._manipulator.renderObjects=[new g.RenderObject(y,C.ManipulatorStateFlags.Unfocused),new g.RenderObject(f,C.ManipulatorStateFlags.Unfocused),new g.RenderObject(y.instantiate({material:d}),C.ManipulatorStateFlags.Focused),new g.RenderObject(f.instantiate({material:d}),C.ManipulatorStateFlags.Focused),new g.RenderObject(y.instantiate({material:p}),C.ManipulatorStateFlags.Unfocused),new g.RenderObject(f.instantiate({material:p}),C.ManipulatorStateFlags.Unfocused),new g.RenderObject(y.instantiate({material:_}),C.ManipulatorStateFlags.Focused),new g.RenderObject(f.instantiate({material:_}),C.ManipulatorStateFlags.Focused)],this._manipulator.radius=r/2+2,this._manipulator.collisionType={type:"line",paths:[a]}}_createManipulator(){const e=this._view,t=new d.Manipulator3D({view:e,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const i=e.state.camera,n=D;e.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,n);const s=u.dist(i.eye,n),r=i.computeRenderPixelSizeAtDist(s),a=u.subtract(I,n,i.eye);u.normalize(a,a);const l=A;e.renderCoordsHelper.worldUpAtPosition(D,l);const c=Math.abs(u.dot(a,l)),h=u.cross(I,a,l),m=u.cross(I,h,l),d=o.clamp(c,.01,1),p=1-Math.sqrt(1-d*d)/d/i.fullWidth,g=this._settings,_=this._radius/x.discRadius,f=g.zManipulator.width*_;u.scale(m,u.normalize(m,m),(1/p-1)*s+r*f),t[12]-=I[0],t[13]-=I[1],t[14]-=I[2]},this._manipulator=t,this._updateManipulator()}get test(){}}function T(e,n,s){const r=i.darken(e,s);return r.a*=n,t.toUnitRGBA(r)}const D=m.create(),I=m.create(),A=m.create(),M=()=>{};e.MoveZManipulation=w,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/manipulatorUtils":function(){define(["exports","../../../core/colorUtils","../../../core/libs/gl-matrix-2/math/mat4","../../../chunks/vec32","../../../geometry/support/vectorStacks","../../../layers/graphics/hydratedFeatures","./editingTools/manipulatedObjectUtils","../layers/graphics/graphicUtils","../webgl-engine/lib/basicInterfaces","../webgl-engine/lib/Material","../webgl-engine/materials/ColorMaterial","../webgl-engine/materials/ShadedColorMaterial"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";const m=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1}),d=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function p(e,t,i,r){const o=n.normalize(s.sv3d.get(),e),a=n.normalize(s.sv3d.get(),t),l=n.cross(s.sv3d.get(),o,a);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=0,r[4]=a[0],r[5]=a[1],r[6]=a[2],r[7]=0,r[8]=l[0],r[9]=l[1],r[10]=l[2],r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}e.calculateInputRotationTransform=function(e,t,r,o){const a=n.subtract(s.sv3d.get(),e,r),l=p(a,n.cross(s.sv3d.get(),o,a),r,s.sm4d.get());i.invert(l,l);const c=n.transformMat4(s.sv3d.get(),t,l);return Math.atan2(c[1],c[0])},e.calculateTranslateRotateFromBases=p,e.createManipulatorMaterial=function(e,i=c.RenderOccludedFlag.OccludeAndTransparent,n=!0){const s=t.colorVectorToColorAndOpacity(e),r=!(e[3]<1);return n?new u.ShadedColorMaterial({color:s,writeDepth:r,cullFace:l.CullFaceOptions.Back,renderOccluded:i,isDecoration:!0}):new h.ColorMaterial({color:s,writeDepth:r,cullFace:l.CullFaceOptions.Back,renderOccluded:i,isDecoration:!0})},e.createManipulatorOutlineMaterial=function(e,i=c.RenderOccludedFlag.OccludeAndTransparent){const n=t.colorVectorToColorAndOpacity(e);return new h.ColorMaterial({color:n,writeDepth:!0,cullFace:l.CullFaceOptions.Front,renderOccluded:i,isDecoration:!0})},e.getGraphicAttachmentOrigin=function(e,t){const i=e.getViewForGraphic(t);return null!=i&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null},e.placeAtObject=function(e,t){const i=t.origin;null==i?function(e,t){if(null==t)return;const i="mesh"===t.type?t.origin:a.computeCentroid(t);null!=i&&(e.location=r.hydrateGeometry(i))}(e,o.manipulatedObjectGeometry(t)):e.elevationAlignedLocation=i},e.rotateManipulatorDefaults=m,e.worldScaledManipulatorSettings=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/manipulations/MoveXYObjectManipulation":function(){define(["exports","../../../../../core/handleUtils","../dragEventPipeline3D","../ManipulatorType","./Manipulation","./moveUtils","../../../../interactive/dragEventPipeline"],(function(e,t,i,n,s,r,o){"use strict";class a extends s.Manipulation{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._object=e.object,this._manipulator=this._object.createManipulator?.({selectable:!0,cursor:"move"}),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){this._manipulator&&e(this._manipulator,n.ManipulatorType.TRANSLATE_XY)}createManipulatedObjectDragPipeline(e){return r.createManipulatedMoveDragPipeline(this._object,e,(e=>this.createDragPipeline(e)))}createDragPipeline(e){if(!this._manipulator)return t.makeHandle();const n=this._view;return o.createManipulatorDragEventPipeline(this._manipulator,((t,s,r,a,l)=>{const c=this._object.operations?.data.spatialReference,h=s.next((e=>c?e:null)).next(i.screenToMapXYForManipulatedObject(l,n,this._object,c)).next(o.addMapDelta()).next(o.addScreenDelta());e(t,h,r,a,l)}))}}e.MoveXYObjectManipulation=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/move/isSupportedObject":function(){define(["exports","../../../../../core/has","../../../../../support/elevationInfoUtils","../isSupportedObjectUtils"],(function(e,t,i,n){"use strict";e.isSupportedObject=function(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return n.SupportedObjectResult.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return n.SupportedObjectResult.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return n.SupportedObjectResult.GEOMETRY_TYPE_UNSUPPORTED}const s=e.elevationInfo;return i.hasEffectiveFeatureExpressionInfo(s)?n.SupportedObjectResult.ELEVATION_MODE_UNSUPPORTED:n.SupportedObjectResult.SUPPORTED},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/MovePointTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./SketchTooltipInfo","./TooltipInfoWithCoordinates"],(function(e,t,i,n,s,r,o,a,l){"use strict";e.MovePointTooltipInfo=class extends(l.TooltipInfoWithCoordinates(a.SketchTooltipInfo)){constructor(e){super(e),this.type="move-point",this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}},t.__decorate([i.property()],e.MovePointTooltipInfo.prototype,"allFields",null),e.MovePointTooltipInfo=t.__decorate([o.subclass("esri.views.interactive.tooltip.infos.MovePointTooltipInfo")],e.MovePointTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/TranslateTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/quantityUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./SketchTooltipInfo"],(function(e,t,i,n,s,r,o,a,l){"use strict";e.TranslateTooltipInfo=class extends l.SketchTooltipInfo{constructor(e){super(e),this.type="translate",this.distance=i.zeroMeters}clear(){this.distance=i.zeroMeters}},t.__decorate([n.property()],e.TranslateTooltipInfo.prototype,"type",void 0),t.__decorate([n.property()],e.TranslateTooltipInfo.prototype,"distance",void 0),e.TranslateTooltipInfo=t.__decorate([a.subclass("esri.views.interactive.tooltip.infos.TranslateTooltipInfo")],e.TranslateTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/TranslateXYTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/quantityUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./SketchTooltipInfo"],(function(e,t,i,n,s,r,o,a,l){"use strict";e.TranslateXYTooltipInfo=class extends l.SketchTooltipInfo{constructor(e){super(e),this.type="translate-xy",this.distance=i.zeroMeters}},t.__decorate([n.property()],e.TranslateXYTooltipInfo.prototype,"type",void 0),t.__decorate([n.property()],e.TranslateXYTooltipInfo.prototype,"distance",void 0),e.TranslateXYTooltipInfo=t.__decorate([a.subclass("esri.views.interactive.tooltip.infos.TranslateXYTooltipInfo")],e.TranslateXYTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/TranslateZTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/quantityUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./SketchTooltipInfo"],(function(e,t,i,n,s,r,o,a,l){"use strict";e.TranslateZTooltipInfo=class extends l.SketchTooltipInfo{constructor(e){super(e),this.type="translate-z",this.distance=i.zeroMeters}clear(){this.distance=i.zeroMeters}},t.__decorate([n.property()],e.TranslateZTooltipInfo.prototype,"type",void 0),t.__decorate([n.property()],e.TranslateZTooltipInfo.prototype,"distance",void 0),e.TranslateZTooltipInfo=t.__decorate([a.subclass("esri.views.interactive.tooltip.infos.TranslateZTooltipInfo")],e.TranslateZTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/reshape/ReshapeTool3D":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Evented","../../../../../core/maybe","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","./ReshapeOperation","../../../../interactive/InteractiveToolBase","../../../../interactive/keybindings","../../../../interactive/sketch/SketchOptions"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m){"use strict";e.ReshapeTool3D=class extends h.InteractiveToolBase{constructor(e){super(e),this._reshapeOperation=null,this.events=new i,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveObject=!0,this.enableDeleteVertices=!0,this.autoHideManipulators=!1,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.sketchOptions=new m,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new c.ReshapeOperation({tool:this});this.addHandles([e.events.on("reshape",(e=>this.events.emit("reshape",e))),e.events.on("move",(e=>this.events.emit("move",e))),e.events.on("vertex-add",(e=>this.events.emit("vertex-add",e))),e.events.on("vertex-remove",(e=>this.events.emit("vertex-remove",e))),e.events.on("immediate-click",(e=>this.events.emit("immediate-click",{...e,object:this.object}))),this.view.on("pointer-down",["Shift"],(e=>e.stopPropagation()))]),this.finishToolCreation()}destroy(){this._reshapeOperation=n.destroyMaybe(this._reshapeOperation)}get updating(){return((this.object.updating??!1)||this._reshapeOperation?.updating||this.snappingManager?.updating)??!1}get activeTooltipInfo(){return this._reshapeOperation?.activeTooltipInfo??null}get tooltip(){return this._reshapeOperation?.tooltip??null}onManipulatorSelectionChanged(){this._reshapeOperation?.onManipulatorSelectionChanged()}get canUndo(){return this._reshapeOperation?.canUndo??!1}undo(){this.snappingManager?.doneSnapping(),this._reshapeOperation?.undo()}get canRedo(){return this._reshapeOperation?.canRedo??!1}redo(){this.snappingManager?.doneSnapping(),this._reshapeOperation?.redo()}onInputEvent(e){const t=this._reshapeOperation;t&&!t.enterInputModeIfAvailable(e)&&this.enableDeleteVertices&&"key-down"===e.type&&u.sketchKeys.delete.includes(e.key)&&t.removeSelectedVertices()>0&&e.stopPropagation()}reset(){}},t.__decorate([s.property()],e.ReshapeTool3D.prototype,"_reshapeOperation",void 0),t.__decorate([s.property({constructOnly:!0})],e.ReshapeTool3D.prototype,"view",void 0),t.__decorate([s.property({constructOnly:!0})],e.ReshapeTool3D.prototype,"automaticAreaMeasurementUtils",void 0),t.__decorate([s.property({constructOnly:!0})],e.ReshapeTool3D.prototype,"automaticLengthMeasurementUtils",void 0),t.__decorate([s.property({constructOnly:!0})],e.ReshapeTool3D.prototype,"object",void 0),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"enableZShape",void 0),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"enableZVertex",void 0),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"enableMoveObject",void 0),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"enableDeleteVertices",void 0),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"autoHideManipulators",void 0),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"enableMidpoints",void 0),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"enableEdgeOffset",void 0),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"type",void 0),t.__decorate([s.property({type:m})],e.ReshapeTool3D.prototype,"sketchOptions",void 0),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"snappingManager",void 0),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"updating",null),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"activeTooltipInfo",null),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"tooltip",null),t.__decorate([s.property()],e.ReshapeTool3D.prototype,"automaticManipulatorSelection",void 0),e.ReshapeTool3D=t.__decorate([l.subclass("esri.views.3d.interactive.editingTools.reshape.ReshapeTool3D")],e.ReshapeTool3D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/reshape/ReshapeOperation":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/arrayUtils","../../../../../core/colorUtils","../../../../../core/has","../../../../../core/Evented","../../../../../core/Handles","../../../../../core/handleUtils","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/Logger","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../core/support/UpdatingHandles","../../../../../geometry/Point","../../../../../geometry/Polyline","../../../../../geometry/SpatialReference","../../../../../layers/graphics/dehydratedPoint","../../../../../symbols/support/utils","../../Manipulator3D","../../manipulatorUtils","../../RenderObject","../../SegmentLabels3D","../../SnappingVisualizer3D","../dragEventPipeline3D","../geometryUtils","../ManipulatorType","../manipulatorUtils","../settings","../visualElementUtils","../manipulations/config","../manipulations/MoveManipulation","../manipulations/MoveXYObjectManipulation","./edgeOffsetUtils","./reshapeTooltipUtils3D","../../visualElements/OutlineVisualElement","../../../webgl-engine/lib/GeometryUtil","../../../../input/IViewEvents","../../../../interactive/dragEventPipeline","../../../../interactive/interfaces","../../../../interactive/keybindings","../../../../interactive/editGeometry/interfaces","../../../../interactive/snapping/SnappingContext","../../../../interactive/snapping/SnappingDragPipelineStep","../../../../interactive/tooltip/tooltipCommonUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C,w,T,D,I,A,M,N,R,O,G,k,V,F,L,q,H,U,z,Y,B,X,j,W){"use strict";const Z=Symbol();function Q(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}function $(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function K(e){return new y({x:0,y:0,z:0,spatialReference:e})}function J(e){return"edge"===e.type&&"edgeManipulator"in e}e.ReshapeOperation=class extends i{get _operations(){return this.object.operations}constructor(e){super(e),this._selectedIndex=0,this._manipulatorHandles=new a,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=se.NONE,this._pendingEdgeOffsetInfo=null,this._updatingHandles=new f.UpdatingHandles,this._recreatingManipulators=!1,this._settings=new N.Settings({getTheme:()=>this.view.effectiveTheme}),this.events=new o,this.activeTooltipInfo=null,this._vertexLaserLineVisualElement=null,this._tooltipCallbacks={onBeforeReshape:()=>this.tool.endDrag(),onReshapeStart:()=>this._updateEventState(se.RESHAPING),onReshape:()=>this.events.emit("reshape",{type:"reshape",object:this.object}),onReshapeStop:()=>this._updateEventState(se.NONE,{forceEnd:!0}),onMoveStart:()=>this._updateEventState(se.MOVING),onMove:()=>this.events.emit("move",{type:"move",object:this.object,dx:0,dy:0}),onMoveStop:()=>this._updateEventState(se.NONE,{forceEnd:!0})}}initialize(){const{view:e}=this,t=this._settings.manipulators,i=t.vertex;this.tooltipInfos=F.createTooltipInfos(this._sketchOptions,e),this._vertexManipulatorMaterial=S.createManipulatorMaterial(s.unitRGBAFromColor(i.color),i.renderOccluded),this._vertexManipulatorOutlineMaterial=S.createManipulatorOutlineMaterial(s.unitRGBAFromColor(i.outlineColor),i.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=S.createManipulatorOutlineMaterial(s.unitRGBAFromColor(i.hoverOutlineColor),i.renderOccluded);const n=t.edge;this._edgeManipulatorMaterial=S.createManipulatorMaterial(s.unitRGBAFromColor(n.color),n.renderOccluded),this._edgeManipulatorOutlineMaterial=S.createManipulatorOutlineMaterial(s.unitRGBAFromColor(n.outlineColor),n.renderOccluded);const r=t.edgeOffset;this._edgeOffsetManipulatorMaterial=S.createManipulatorMaterial(s.unitRGBAFromColor(r.color),r.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=S.createManipulatorMaterial(s.unitRGBAFromColor(r.hoverColor),r.renderOccluded,!1);const o=t.selected;this._selectedManipulatorMaterial=S.createManipulatorMaterial(s.unitRGBAFromColor(o.color),o.renderOccluded),this._selectedManipulatorOutlineMaterial=S.createManipulatorOutlineMaterial(s.unitRGBAFromColor(o.outlineColor),o.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=S.createManipulatorOutlineMaterial(s.unitRGBAFromColor(o.hoverOutlineColor),o.renderOccluded),this.tooltip=W.makeTooltip((()=>({view:e,options:this._sketchOptions.tooltips}))),this.addHandles([h.watch((()=>{const e=this._settings.manipulators;return{vertexSettings:e.vertex,edgeSettings:e.edge,edgeOffsetSettings:e.edgeOffset,selectedSettings:e.selected}}),(({vertexSettings:e,edgeSettings:t,edgeOffsetSettings:i,selectedSettings:n})=>{e.applyColor(this._vertexManipulatorMaterial),e.applyOutline(this._vertexManipulatorOutlineMaterial),e.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),t.applyColor(this._edgeManipulatorMaterial),t.applyOutline(this._edgeManipulatorOutlineMaterial),i.applyColor(this._edgeOffsetManipulatorMaterial),i.applyHover(this._edgeOffsetManipulatorHoverMaterial),n.applyColor(this._selectedManipulatorMaterial),n.applyOutline(this._selectedManipulatorOutlineMaterial),n.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)})),h.watch((()=>this.object.visible),(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e,J(t)&&(t.edgeManipulator.available=e)})),h.watch((()=>this._numGrabbing+this._numDragging===0),(e=>this._toggleAutoHideManipulators(e))),h.watch((()=>({labels:this._segmentLabels,enabled:this._sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(({labels:e,enabled:t,edgeOffsetEnabled:i})=>{null!=e&&(e.visible=t,e.edgeDistance=i?"far":"default")}),h.initial),F.connectTooltipToManipulatedObject(this.tooltip,this.object,(()=>this._tooltipsContext)),h.watch((()=>this.tooltip.mode),((e,t)=>{"input"===t&&"input"!==e&&this._resetTooltip()})),h.on((()=>this._operations),"vertex-update",(e=>this._updateManipulatorPositions(e.vertices)),{onListenerAdd:()=>this._recreateManipulators()}),h.on((()=>this._operations?.data),"change",(e=>{"undo"!==e.operation&&"redo"!==e.operation||this._recreateManipulators()}))])}destroy(){this._removeManipulators(),this._updatingHandles.destroy(),this._segmentLabels=c.destroyMaybe(this._segmentLabels),this.tooltip=c.destroyMaybe(this.tooltip)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get automaticAreaMeasurementUtils(){return this.tool.automaticAreaMeasurementUtils}get automaticLengthMeasurementUtils(){return this.tool.automaticLengthMeasurementUtils}get object(){return this.tool.object}get enableZShape(){return this.tool.enableZShape}get enableDeleteVertices(){return this.tool.enableDeleteVertices}get enableZVertex(){return this.tool.enableZVertex}get autoHideManipulators(){return this.tool.autoHideManipulators}get enableMoveObject(){return this.tool.enableMoveObject}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}enterInputModeIfAvailable(e){return"key-down"===e.type&&e.key===Y.tooltipKeys.enterInputMode&&("reshape-edge-offset"===this.activeTooltipInfo?.type?this._enterInputModeDuringEdgeOffset(e):!!W.enterInputModeIfAvailable(e,this.tooltip)&&(this.tool.endDrag(),!0))}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.type));return this._removeVertices(e),e.length}onManipulatorSelectionChanged(){this.events.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=c.destroyMaybe(this._moveManipulation),this._objectMoveManipulation=c.destroyMaybe(this._objectMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if(null==this._operations)return;const t=this.object.elevationInfo;for(const i of this._operations.data.components){const n=e?.byComponentIndex.get(i.index);for(const e of i.vertices){const i=n?.has(e.index);this._createVertexOrEdgeManipulator(e,t,i)}for(const e of i.edges)this._createVertexOrEdgeManipulator(e,t)}this._createObjectMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return null!=this._operations&&this._operations.canRedo}get canUndo(){return null!=this._operations&&this._operations.canUndo}redo(){return this._operations?.redo()}undo(){return this.events.emit("undo"),this._operations?.undo()}_recreateManipulators(){if(!this._recreatingManipulators){if(this._recreatingManipulators=!0,this._removeManipulators(),this._resetTooltip(),this._operations&&this._segmentLabels?.context?.editGeometryOperations===this._operations||(this._segmentLabels=c.destroyMaybe(this._segmentLabels)),this._createManipulators(),!this._segmentLabels&&this._operations){const e=this._sketchOptions.labels;this._segmentLabels=new w.SegmentLabels3D({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:e,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},visible:e.enabled})}this._recreatingManipulators=!1}}_perObjectManipulatorDragAction(e,t){if("end"===t.action)return t;let i=0;const n=[],s=this._manipulatorInfos.some((e=>"vertex"===e.type&&e.manipulator.selected)),r=e===re.SELECTED_OR_ALL&&s;for(const e of this._manipulatorInfos)"vertex"===e.type&&(e.manipulator.grabbing||r&&!e.manipulator.selected||n.push(e),i++);if(this._moveVertices(n,t),n.length===i){if(this._updateEventState(se.MOVING),this.destroyed)return t;this.events.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,object:this.object})}else{if(this._updateEventState(se.RESHAPING),this.destroyed)return t;this.events.emit("reshape",{type:"reshape",object:this.object})}return t}_toggleAutoHideManipulators(e){this.autoHideManipulators&&(e?this.removeHandles(Z):this.tool.manipulators.forEach((({manipulator:e})=>{const t=e.disableDisplay?.();t&&this.addHandles(t,Z)})))}_isMultiVertexSelection(){return this._manipulatorInfos.reduce(((e,t)=>"vertex"===t.type&&t.manipulator.selected?e+1:e),0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(se.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:n}=e;if(!t&&!i&&!n)return;const s=[];for(const t of this._manipulatorInfos)"vertex"===t.type&&(t.manipulator.selected&&!t.manipulator.grabbing||t===e.info)&&s.push(t);this._moveVertices(s,e,B.AccumulationBehavior.ACCUMULATE_STEPS),this.events.emit("reshape",{type:"reshape",object:this.object})}_updateEventState(e,t={}){if(e===this._reshapeEventState)return!1;switch(e){case se.NONE:if(!t.forceEnd&&(0!==this._numGrabbing||0!==this._numDragging))return!1;switch(this._reshapeEventState){case se.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object});break;case se.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object})}break;case se.MOVING:switch(this._reshapeEventState){case se.NONE:this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object});break;case se.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object}),this.destroyed||this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object})}break;case se.RESHAPING:switch(this._reshapeEventState){case se.NONE:this.events.emit("reshape",{type:"reshape-start",object:this.object});break;case se.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit("reshape",{type:"reshape-start",object:this.object})}}if(this.destroyed)return!1;const i=this._reshapeEventState!==e;return this._reshapeEventState=e,i}_createObjectMoveManipulation(){const{tool:e,view:t,object:i,_operations:n}=this;if(n){if(this._objectMoveManipulation=new k.MoveXYObjectManipulation({tool:e,view:t,object:i}),this.enableMoveObject){let e=null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline(((t,i,s)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=n.createUndoGroup()),t))).next((e=>this._perObjectManipulatorDragAction(re.ALL,e))).next((e=>(this._updateTranslateObjectTooltip(G.ManipulationType.XY,e),e))).next((t=>{"end"===t.action&&(this._resetTooltip(),e=c.removeMaybe(e))})),s.next((()=>this._onDragCancel(!0,(()=>e=c.removeMaybe(e)))))}))),this._objectMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!1))))}else this._objectMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._objectMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.events.emit("immediate-click",{...e,object:this.object}),e.stopPropagation()})))))}}_createMoveManipulation(e){const{object:t,tool:i,view:n,_operations:s}=this;if(!s)return;this._moveManipulation=new G.MoveManipulation({tool:i,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&M.canMoveZOperations(t.operations,t.elevationInfo),snapToScene:!1,radius:G.MoveManipulation.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator((e=>this.addHandles([e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.events.emit("immediate-click",{...t,object:this.object}),t.stopPropagation()})),this._watchAndUpdateGrabState(e,!1)])));const r=e=>t=>{this.addHandles([t.events.on("focus-changed",(({action:t})=>{"focus"===t?this._updateTranslateTooltip(e):this._resetTooltip()}))])};this._moveManipulation.xyManipulation.forEachManipulator(r(G.ManipulationType.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(r(G.ManipulationType.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(r(G.ManipulationType.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const o=s.data.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline(((n,r,o,a,l)=>{const{snappingStep:c,cancelSnapping:h}=j.createSnapDragEventPipelineStep({predicate:e=>!!e.info,snappingManager:i.snappingManager,snappingContext:new X.SnappingContext({editGeometryOperations:s,elevationInfo:e,pointer:l,excludeFeature:t.graphic,visualizer:new T.SnappingVisualizer3D}),updatingHandles:this._updatingHandles,useZ:!1});return a=a.next((e=>(this._onDragCancel(),e))).next(h),{steps:o=o.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return e.manipulatorType===A.ManipulatorType.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:e})).next(U.sceneSnappingAtLocation(this.view,e,t.graphic??void 0)).next(...c).next(U.addMapDelta()).next((e=>this._perObjectManipulatorDragAction(re.SELECTED_OR_ALL,e))).next((e=>(this._updateTranslateTooltip(n,e),e))),cancel:a}}),e,o,t.graphic),h.watch((()=>t.visible),(()=>this._updateMoveManipulationPosition()),h.initial),t.on("committed",(()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()})),h.watch((()=>t.isDraped),(e=>{this._updateMoveManipulationPosition();const t="align-move-manipulation";e?this.addHandles(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),t):this.removeHandles(t)}),h.initial)])}_createVisualElements(){const{object:e,view:t}=this,i=R.createVisualElements({view:t,object:e,forEachManipulator:e=>{if(!this.destroyed&&!this._recreatingManipulators){this._objectMoveManipulation.forEachManipulator(e),this._moveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,A.ManipulatorType.TRANSLATE_XY)}},onManipulatorsChanged:e=>this.events.on("manipulators-changed",e)});null!=i&&(this._outlineVisualElement=i.visualElement instanceof L.OutlineVisualElement?i.visualElement:null);const n=this._outlineVisualElement;if(null!=n){const t=()=>{e.isDraped||this._updateMoveManipulationPosition()};this._manipulatorHandles.add(h.on((()=>n.events),"attachment-origin-changed",t,{onListenerAdd:t}))}this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=this.object.elevationInfo){const i=this.view,n=this._operations;if(e.component.vertices.length<=2||!n)return null;const s=n.data.spatialReference,r=this._settings.manipulators.edgeOffset,o=r.size/2,a=o+r.collisionPadding,c=o/a,h=c/2,u=c*Math.sqrt(3)/2,{height:m,offset:d}=r,p=this._edgeOffsetManipulatorMaterial;if(!this._edgeOffsetManipulatorGeometryInside){const e=q.createExtrudedTriangle(p,u,h,h,m,d);this._edgeOffsetManipulatorGeometryInside=e}if(!this._edgeOffsetManipulatorGeometryOutside){const e=q.createExtrudedTriangle(p,-u,h,h,m,-d);this._edgeOffsetManipulatorGeometryOutside=e}const g=[new C.RenderObject(this._edgeOffsetManipulatorGeometryInside.instantiate(),z.ManipulatorStateFlags.Unfocused),new C.RenderObject(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),z.ManipulatorStateFlags.Focused),new C.RenderObject(this._edgeOffsetManipulatorGeometryOutside.instantiate(),z.ManipulatorStateFlags.Unfocused),new C.RenderObject(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),z.ManipulatorStateFlags.Focused)],f=new E.Manipulator3D({view:i,renderObjects:g,elevationInfo:"on-the-ground"!==t.mode||b.isVolumetricSymbol(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:a,available:this.object.visible,collisionType:{type:"disc",direction:_.fromValues(0,0,1)},collisionPriority:1,metadata:{deleting:!1},location:K(s)}),y=new E.Manipulator3D({view:i,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?"move":"default",metadata:{deleting:!1},location:K(s)}),x={manipulator:f,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:y,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(x,r.minSquaredEdgeLength);const v=()=>this._updateEdgeOffsetManipulator(x);v(),x.locationUpdateHandle=l.handlesGroup([e.leftVertex,e.rightVertex].map((e=>{const t=this._getManipulatorInfoFromHandle(e);return t?.manipulator.events.on("location-update",v)})));const P=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.events.emit("immediate-click",{...e,object:this.object}),e.stopPropagation()};return this._manipulatorHandles.add([x.locationUpdateHandle,this._watchAndUpdateGrabState(f,!0),this._watchAndUpdateGrabState(y,!0),U.createManipulatorDragEventPipeline(f,this._createEdgeOffsetPipeline(x,t,n)),U.createManipulatorDragEventPipeline(y,this._createEdgePipeline(x,t,n)),y.events.on("immediate-click",P),f.events.on("immediate-click",P),f.events.on("focus-changed",(()=>this._resetTooltip())),f.events.on("grab-changed",(({screenPoint:e,action:t})=>{x.grabMapPoint="start"===t?V.getMapPointAtEdgeOffsetManipulatorElevation(e,this.view,this.object,x):null}))],f),this._manipulatorInfos.push(x),this.manipulators.addMany([f,y]),this.events.emit("manipulators-changed"),x}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,n=e.edgeManipulator,s=()=>{e.visibilityHandle=c.removeMaybe(e.visibilityHandle);const s=this._getManipulatorInfoFromHandle(e.handle.leftVertex),r=this._getManipulatorInfoFromHandle(e.handle.rightVertex),o=null!=s&&null!=r&&V.screenEdgeLengthSquared(s.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!n.focused||o)&&(i.grabbable=!o,n.grabbable=!o,e.visibilityHandle=l.handlesGroup([i.disableDisplay(),l.makeHandle((()=>{i.grabbable=!0,n.grabbable=this.enableMoveObject}))]))};this._manipulatorHandles.add([i.events.on("focus-changed",s),n.events.on("focus-changed",s),l.makeHandle((()=>{c.removeMaybe(e.visibilityHandle),n.metadata.deleting=!0,this.manipulators.remove(n)}))],i),s()}_updateEdgeOffsetManipulator(e){if(!this._operations)return;this._updateManipulatorPosition(e);const{coordinateHelper:t}=this._operations.data,i=V.createEdgeOffsetIntersectionPlane(this.view,e.manipulator.elevationAlignedLocation,V.createEdgeOffsetOperation(t,e.handle,e.manipulator.elevationInfo)),n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),s=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==n||null==s)return;const r=n.manipulator.renderLocation,o=s.manipulator.renderLocation,a=null!=i?V.edgeOffsetRotationMatrix(i,r,o):p.IDENTITY;e.manipulator.modelTransform=a,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=a;const l=g.length(g.subtract(te,r,o))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgePipeline(e,t,i){return(n,s,r,o)=>{if("touch"===o)this._createEdgeOffsetPipeline(e,t,i)(n,s,r);else if(this.enableMoveObject){const e=this.object.graphic,o=i.data.spatialReference,{elevationAlignedLocation:a}=n;s.next((e=>this._trackNumDragging(e))).next(U.dragAtLocation(this.view,a)).next(D.screenToMapXYAtLocation(this.view,a,t,o,e)).next(U.addScreenDelta()).next(U.addMapDelta()).next((e=>this._perObjectManipulatorDragAction(re.ALL,e))).next((e=>(this._updateTranslateObjectTooltip(G.ManipulationType.XY,e),e))).next((e=>{"end"===e.action&&this._resetTooltip()})),r.next((()=>this._onDragCancel(!n.metadata.deleting)))}}}_createEdgeOffsetPipeline(e,t,i){return(n,s,r)=>{const o=this._pendingEdgeOffsetInfo;if(o?.manipulatorInfo===e&&"drag"!==o.mode)return void r.execute({action:"cancel"});this._clearSelection();const{initializeStep:a,cleanup:l}=this._initializeEdgeOffset(e,t,i,r),c=this._applyEdgeOffsetStep(e);s.next((e=>this._trackNumDragging(e))).next(U.dragAtLocation(this.view,n.elevationAlignedLocation)).next(a).next(D.screenToRenderPlaneFromEvent(this.view)).next(D.convertToMapCoordinates(this.view,i.data.spatialReference)).next(U.addMapDelta()).next((e=>{const{operation:t,mapEnd:i}=e;return null==t||null==i?e:{...e,signedDistance:t.signedDistanceToPoint(i)}})).next((e=>this._pendingEdgeOffsetInfo?e:c(e))).next((e=>{"end"!==e.action||this._pendingEdgeOffsetInfo||l()})),r.next((()=>{this._exitEdgeOffsetInputMode(),n.metadata.deleting||(l(),this._onDragCancel())}))}}_initializeEdgeOffset(e,t,i,n){const{view:s,object:r}=this,o=V.createEdgeOffsetOperation(i.data.coordinateHelper,e.handle,t),a=i.createUndoGroup(),h=V.createEdgeOffsetIntersectionPlane(s,e.manipulator.elevationAlignedLocation,o);let u;this._splitEdgesBeforeEdgeOffset(e,o),this._selectEdgeOffsetArrow(e,o);const m=()=>{this._cleanEdgeOffsetCollapsedEdges(e,i),u=c.removeMaybe(u)},d=this.events.on("undo",m);return u=l.handlesGroup([this._initializeEdgeOffsetVisualElement(e,r,t,i),a,d,this._connectEdgeOffsetTooltip(e,o,i,(()=>{n.execute({action:"cancel"})}))]),{initializeStep:e=>null==o||null==h?(m(),null):{...e,operation:o,plane:h},cleanup:m}}_initializeEdgeOffsetVisualElement(e,t,i,n){const r=()=>new x({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:n.data.spatialReference}),o=new L.OutlineVisualElement({view:this.view,isDraped:t.isDraped,geometry:r(),elevationInfo:i,width:this._settings.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0}),a=l.handlesGroup([h.watch((()=>({color:this._accentColor,draped:t.isDraped})),(({color:e,draped:t})=>{o.color=s.unitRGBAFromColor(e),o.isDraped=t}),h.syncAndInitial),t.on("committed",(()=>{o.geometry=r()})),l.destroyHandle(o)]);return o.attached=!0,a}_applyEdgeOffsetStep(e){return t=>(this.destroyed||null==t.operation||!this._operations||(this._updateEventState(se.RESHAPING),null==t.signedDistance?this._resetTooltip():((t.mapDeltaX||t.mapDeltaY||t.mapDeltaZ)&&(this._offsetEdge(e,t.operation,t.signedDistance),this.events.emit("reshape",{type:"reshape",object:this.object})),this._updateEdgeOffsetTooltip(t))),t)}_cleanEdgeOffsetCollapsedEdges(e,t){const i=e.handle.leftVertex.leftEdge?.leftVertex,n=e.handle.leftVertex,s=e.handle.rightVertex.rightEdge?.rightVertex,r=e.handle.rightVertex,o=t.data.coordinateHelper,a=this.view.pixelSizeAt(o.vectorToDehydratedPoint(n.pos),o.spatialReference),l=[];if(i&&o.distance(i.pos,n.pos)<ie){const e=this._getManipulatorInfoFromHandle(n);null!=e&&l.push(e)}if(o.distance(n.pos,r.pos)<a||s&&o.distance(s.pos,r.pos)<ie){const e=this._getManipulatorInfoFromHandle(r);null!=e&&l.push(e)}l.length&&this._removeVertices(l)}_enterInputModeDuringEdgeOffset(e){const t=this._findActiveEdgeOffsetManipulatorInfo();return!(!t||!W.enterInputModeIfAvailable(e,this.tooltip)||(t.manipulator.dragging?(this._pendingEdgeOffsetInfo={manipulatorInfo:t,mode:"drag"},0):(this._clearSelection(),this._pendingEdgeOffsetInfo={manipulatorInfo:t,mode:"hover"},this._connectEdgeOffsetTooltipOnHover(t),0)))}_exitEdgeOffsetInputMode(){this.tooltip&&(this._pendingEdgeOffsetInfo=null,this._resetTooltip(),this.tooltip.exitInputMode())}_findActiveEdgeOffsetManipulatorInfo(){return this._manipulatorInfos.filter(J).find((({manipulator:e})=>e.hovering||e.grabbing||e.dragging))}_connectEdgeOffsetTooltipOnHover(e){const{_operations:t,object:i}=this;if(!t)return;const{elevationInfo:n}=i,s=V.createEdgeOffsetOperation(t.data.coordinateHelper,e.handle,n);this._selectEdgeOffsetArrow(e,s),this.addHandles([this._initializeEdgeOffsetVisualElement(e,i,n,t),this._connectEdgeOffsetTooltip(e,s,t,(()=>{this.removeHandles(s),this._exitEdgeOffsetInputMode()}))],s)}_splitEdgesBeforeEdgeOffset(e,t){if(t.requiresSplitEdgeLeft){const t=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);null!=t&&this._splitEdgeManipulator(t,1)}if(t.requiresSplitEdgeRight){const t=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);null!=t&&this._splitEdgeManipulator(t,0)}}_selectEdgeOffsetArrow(e,t){const i=e.grabMapPoint??V.getMapPointAtEdgeOffsetManipulatorElevation(this.view.inputManager?.latestPointerLocation,this.view,this.object,e);i&&t.selectArrowFromStartPoint(i)}_connectEdgeOffsetTooltip(e,t,i,n){const s=()=>this.tooltipInfos.edgeOffset.distance.actual,r=s=>{n(),queueMicrotask((()=>{this.view.focus();const n=i.createUndoGroup();this._tooltipCallbacks.onReshapeStart?.(),this._splitEdgesBeforeEdgeOffset(e,t),this._offsetEdge(e,t,V.getDistanceInGeometrySR(s,e.manipulator.location,t,i)),this._tooltipCallbacks.onReshape?.(),this._tooltipCallbacks.onReshapeStop?.(),this._cleanEdgeOffsetCollapsedEdges(e,i),n.remove()}))},o=()=>{const e=s();null!=e?r(e):n()};return l.handlesGroup([h.when((()=>this.tooltip&&!this.tooltip.focused),(()=>o()),h.sync),this.tooltip.on("discard",n),this.tooltip.on("commit",(e=>{"commit-and-exit"===e.type&&o()}))])}_createVertexOrEdgeManipulator(e,t=this.object.elevationInfo,i=!1){const n=this.view,s=this._operations,r=this._settings;if(!s)return null;const o=s.data.type,a=s.data.spatialReference;if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const{size:e,outlineSize:t}=Q(r.manipulators.vertex);this._vertexManipulatorGeometry=q.createSphereGeometry(this._vertexManipulatorMaterial,e,16,16),this._vertexManipulatorOutlineGeometry=q.createSphereGeometry(this._vertexManipulatorOutlineMaterial,t,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const{size:e,outlineSize:t}=Q(r.manipulators.edge);this._edgeManipulatorGeometry=q.createSphereGeometry(this._edgeManipulatorMaterial,e,16,16),this._edgeManipulatorOutlineGeometry=q.createSphereGeometry(this._edgeManipulatorOutlineMaterial,t,16,16)}const h="point"===o||"mesh"===o?[]:[new C.RenderObject(this._vertexManipulatorGeometry.instantiate(),ne.Vertex|z.ManipulatorStateFlags.Unselected),new C.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate(),ne.Vertex|z.ManipulatorStateFlags.Unfocused|z.ManipulatorStateFlags.Unselected),new C.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ne.Vertex|z.ManipulatorStateFlags.Focused|z.ManipulatorStateFlags.Unselected),new C.RenderObject(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),z.ManipulatorStateFlags.Selected),new C.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),z.ManipulatorStateFlags.Selected|z.ManipulatorStateFlags.Unfocused),new C.RenderObject(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),z.ManipulatorStateFlags.Selected|z.ManipulatorStateFlags.Focused)];this.enableMidpoints&&h.push(new C.RenderObject(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),ne.Edge|z.ManipulatorStateFlags.Focused|z.ManipulatorStateFlags.Unselected),new C.RenderObject(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ne.Edge|z.ManipulatorStateFlags.Focused|z.ManipulatorStateFlags.Unselected),new C.RenderObject(this._edgeManipulatorGeometry.instantiate(),ne.Edge|z.ManipulatorStateFlags.Unfocused|z.ManipulatorStateFlags.Unselected),new C.RenderObject(this._edgeManipulatorOutlineGeometry.instantiate(),ne.Edge|z.ManipulatorStateFlags.Unfocused|z.ManipulatorStateFlags.Unselected));const u=new E.Manipulator3D({view:n,renderObjects:h,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1},location:K(a)});u.selected=i,this._setTypeSpecificManipulatorSettings(u,e,t);const m="edge"===e.type?{manipulator:u,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:u,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(m),this.manipulators.add(u),this._updateManipulatorPosition(m),"edge"===m.type){const e=[];for(const t of[m.handle.leftVertex,m.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(t);null!=i&&e.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(m))))}m.locationUpdateHandle=l.handlesGroup(e),this._manipulatorHandles.add(m.locationUpdateHandle,u)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(u,!0),u);const d=U.createManipulatorDragEventPipeline(u,((e,i,r,o)=>{let l=null;const{snappingStep:h,cancelSnapping:u}=j.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new X.SnappingContext({editGeometryOperations:s,elevationInfo:t,pointer:o,excludeFeature:this.object.graphic,visualizer:new T.SnappingVisualizer3D}),updatingHandles:this._updatingHandles,useZ:!1});r=r.next((t=>(this._onDragCancel(!e.metadata.deleting,(()=>l=c.removeMaybe(l))),t))).next(u);const{elevationAlignedLocation:d}=e,p=this.object.graphic??void 0;i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&s&&(l=s.createUndoGroup()),"edge"===m.type){const t=this._splitEdgeManipulator(m);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:m,snapOrigin:m.handle.pos}})).next(U.dragAtLocation(n,d)).next(D.screenToMapXYAtLocation(n,d,t,a,p)).next(U.sceneSnappingAtLocation(n,t,p)).next(...h).next(U.addMapDelta()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(l=c.removeMaybe(l)),this._resetTooltip()}))}));return this._manipulatorHandles.add([d,u.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,m))),u.events.on("select-changed",(()=>{m.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition(),this._resetTooltip()})),u.events.on("focus-changed",(()=>{this._resetTooltip()}))],u),this.events.emit("manipulators-changed"),m}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&this.undo(),this.tool.snappingManager?.doneSnapping(),this._resetTooltip(),this._reshapeEventState){case se.NONE:break;case se.MOVING:this.events.emit("move",{type:"move",dx:0,dy:0,object:this.object});break;case se.RESHAPING:this.events.emit("reshape",{type:"reshape",object:this.object})}t?.(),this.destroyed||this._updateEventState(se.NONE)}_setTypeSpecificManipulatorSettings(e,t,i){const n=this._settings;switch(t.type){case"vertex":{e.state=ne.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2;const{size:t,collisionPadding:s}=n.manipulators.vertex;e.radius=t/2+s,e.elevationInfo=i;const r=this._operations?.data.type;e.interactive=null!=r&&"point"!==r&&"mesh"!==r;break}case"edge":{e.state=ne.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1;const{size:t,collisionPadding:s}=n.manipulators.edge;e.radius=t/2+s,e.elevationInfo="on-the-ground"!==i.mode||b.isVolumetricSymbol(this.object.graphic?.symbol)?{mode:"absolute-height",offset:0}:i;break}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>{this._onGrabStateChanged(e,t,i.action,i.pointerType)}))}_onGrabStateChanged(e,t,i,n="mouse"){if(!this._recreatingManipulators){if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(se.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==n||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{const{manipulator:t}=e,i=this._operations?.data.type;t.interactive=t.grabbing||!this._numGrabbing&&null!=i&&"point"!==i&&"mesh"!==i,J(e)&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)})),this._objectMoveManipulation.forEachManipulator((e=>{e.interactive=e.grabbing||!this._numGrabbing})))}}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1);this._pendingEdgeOffsetInfo=null}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.events.emit("manipulators-changed"))}_removeManipulator(e){null!=e&&(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),n.removeUnordered(this._manipulatorInfos,e),this.events.emit("manipulators-changed"),this._resetTooltip())}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPositions(e){for(const t of e)this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t))}_updateManipulatorPosition(e){const t=this._operations;if(null!=e&&t)if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,ee),e.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),n=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==i||null==n)return;const s=i.manipulator,r=n.manipulator;if("on-the-ground"===e.manipulator.elevationInfo?.mode){const i=s.location,n=r.location,o=.5,a=i.x+o*(n.x-i.x),l=i.y+o*(n.y-i.y),c=i.hasZ&&n.hasZ?0:void 0;e.manipulator.location=P.makeDehydratedPoint(a,l,c,t.data.spatialReference)}else g.lerp(te,s.renderLocation,r.renderLocation,.5),e.manipulator.renderLocation=te}}_splitEdgeManipulator(e,t=.5){const i=this._operations,n=i.splitEdge(e.handle,t).createdVertex;e.locationUpdateHandle=c.removeMaybe(e.locationUpdateHandle);const s=this.object.elevationInfo;let r;this.enableEdgeOffset?(this._removeManipulator(e),r=this._createVertexOrEdgeManipulator(n)):(r=e,r.handle=n,r.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,s)),n.leftEdge&&this._createVertexOrEdgeManipulator(n.leftEdge),n.rightEdge&&this._createVertexOrEdgeManipulator(n.rightEdge),this._updateManipulatorPosition(r),this.enableEdgeOffset||this._resetTooltip(),this._updateSelection(e.manipulator);const o=this._updateEventState(se.RESHAPING),a=i.data.coordinateHelper.vectorToArray(r.handle.pos),l=i.data.components.indexOf(n.component);return this.events.emit("vertex-add",{type:"vertex-add",object:this.object,vertices:[{coordinates:a,componentIndex:l,vertexIndex:n.index}],added:a}),o&&this._updateEventState(se.NONE),r}_updateMoveManipulationPosition(){const e=g.set(te,0,0,0);let t=0,i=!1,n=null,s=null;for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.selected?(t++,g.add(e,e,r.manipulator.renderLocation),null==n||r.selectedIndex>n.selectedIndex?(s=n,n=r):(null==s||r.selectedIndex>s.selectedIndex)&&(s=r)):i=!0);const r=this.object,o=this._operations?.data.geometry;if(0===t){const e=r.visible&&this.enableMoveObject;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&M.canMoveZOperations(this._operations,r.elevationInfo),this._moveManipulation.angle=I.orientation(o),this._moveManipulation.radius=G.MoveManipulation.radiusForSymbol(r.graphic?.symbol)}else{const e=r.visible;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&M.canMoveZOperations(this._operations,this.object.elevationInfo),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t;let i=0;if(null!=n){const e=n.handle.pos,t=null!=s?s.handle.pos:n.handle.leftEdge?.leftVertex?n.handle.leftEdge.leftVertex.pos:null,r=null==s&&n.handle.rightEdge?.rightVertex?n.handle.rightEdge.rightVertex.pos:null;t&&r?this._moveManipulation.xyAxisManipulation.available=!1:t?i=$(t,e):r&&(i=$(e,r))}this._moveManipulation.angle=i,this._moveManipulation.radius=O.discRadiusSmall}0!==t&&i?(g.scale(e,e,1/t),ee.spatialReference=this._operations.data.spatialReference,ee.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,ee),this._moveManipulation.elevationAlignedLocation=ee):null==this._outlineVisualElement||this.object.isDraped||null==this._outlineVisualElement.attachmentOrigin?S.placeAtObject(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(e){const t=new Array,i=this._operations;if(i){for(const n of e){const e=n.handle.component;if("vertex"===n.type&&i.canRemoveVertex(e)){t.push(n.handle),this._removeManipulator(n),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.rightEdge));const s=i.removeVertices([n.handle]),r=s.removedVertices?.[0].createdEdge;r?this._createVertexOrEdgeManipulator(r):this.enableEdgeOffset&&e.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(e.edges[0]))}}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e.index}})),n=this._updateEventState(se.RESHAPING);if(this.destroyed)return;if(this.events.emit("vertex-remove",{type:"vertex-remove",object:this.object,removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(n&&(this._updateEventState(se.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}}_moveVertices(e,t,i=("start"===t.action?B.AccumulationBehavior.NEW_STEP:B.AccumulationBehavior.ACCUMULATE_STEPS)){const n=this._operations;if(n){e.length>0&&n.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i);for(const t of e)this._updateManipulatorPosition(t)}}_offsetEdge(e,t,i){if(!this._operations)return;const n=t.clone();n.distance=i,this._operations.updateVertices([e.handle.leftVertex,e.handle.rightVertex],n),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,this.enableDeleteVertices&&e.button===H.MouseButton.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===H.MouseButton.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){null!=this._defaultTooltipInfo?this._resetTooltip():this._updateTranslateObjectTooltip(e,t)}_updateTranslateObjectTooltip(e,t){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=F.getUpdatedTranslateObjectTooltipInfo(e,t,this._tooltipsContext))}_updateEdgeOffsetTooltip(e){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=F.getUpdatedEdgeOffsetTooltipInfo(this.object,e,this._tooltipsContext))}_resetTooltip(){const e=this.activeTooltipInfo;if(this._pendingEdgeOffsetInfo&&"reshape-edge-offset"===e?.type)return;let t=null;t=this._pendingEdgeOffsetInfo||null!=this._findActiveEdgeOffsetManipulatorInfo()?F.getUpdatedEdgeOffsetTooltipInfo(this.object,null,this._tooltipsContext):this._defaultTooltipInfo,t!==e&&(null!=e&&null!=t&&"input"===this.tooltip.mode||(this.activeTooltipInfo=t))}get _defaultTooltipInfo(){const e=this._operations?.data.type;switch(e){case"polyline":case"polygon":return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case"point":case"mesh":return this.tooltipInfos.movePoint;default:return null}}get _selectedVertexManipulatorInfo(){const e=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return 1===e.length?e[0]:null}get _tooltipsContext(){const{tooltipInfos:e,activeTooltipInfo:t,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n}=this;return{sketchOptions:this._sketchOptions,tooltipInfos:e,activeTooltipInfo:t,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:this._tooltipCallbacks,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n}}get test(){}},t.__decorate([u.property()],e.ReshapeOperation.prototype,"_numGrabbing",void 0),t.__decorate([u.property()],e.ReshapeOperation.prototype,"_numDragging",void 0),t.__decorate([u.property()],e.ReshapeOperation.prototype,"_pendingEdgeOffsetInfo",void 0),t.__decorate([u.property()],e.ReshapeOperation.prototype,"_operations",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"_segmentLabels",void 0),t.__decorate([u.property({constructOnly:!0})],e.ReshapeOperation.prototype,"tool",void 0),t.__decorate([u.property()],e.ReshapeOperation.prototype,"tooltip",void 0),t.__decorate([u.property()],e.ReshapeOperation.prototype,"activeTooltipInfo",void 0),t.__decorate([u.property({readOnly:!0})],e.ReshapeOperation.prototype,"updating",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"manipulators",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"view",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"automaticAreaMeasurementUtils",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"automaticLengthMeasurementUtils",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"object",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"enableZShape",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"enableDeleteVertices",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"enableZVertex",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"autoHideManipulators",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"enableMoveObject",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"enableMidpoints",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"enableEdgeOffset",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"_sketchOptions",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"_accentColor",null),t.__decorate([u.property()],e.ReshapeOperation.prototype,"_tooltipsContext",null),e.ReshapeOperation=t.__decorate([d.subclass("esri.views.3d.interactive.editingTools.reshape.ReshapeOperation")],e.ReshapeOperation);const ee=P.makeDehydratedPoint(0,0,void 0,v.WGS84),te=_.create(),ie=1e-6;var ne,se,re;!function(e){e.Vertex=z.ManipulatorStateCustomFlags.Custom1,e.Edge=z.ManipulatorStateCustomFlags.Custom2}(ne||(ne={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(se||(se={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(re||(re={})),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/reshape/edgeOffsetUtils":function(){define(["exports","../../../../../core/quantityUtils","../../../../../core/screenUtils","../../../../../core/unitUtils","../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../geometry/projectionUtils","../../../../../geometry/projection/projectVectorToVector","../../../../../geometry/support/geodesicUtils","../../../../../geometry/support/plane","../../../../../layers/graphics/dehydratedPoint","../../../../../support/elevationInfoUtils","../../../../interactive/editGeometry/operations/OffsetEdgeVertex"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d){"use strict";function p(e,t,i){const n=u.makeDehydratedPoint(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),s=o.create(),a=o.create();return e.renderCoordsHelper.toRenderCoords(t,s)&&e.renderCoordsHelper.toRenderCoords(n,a)?r.direction(a,s,a):null}e.createEdgeOffsetIntersectionPlane=function(e,t,i){const n=o.create();if(!e.renderCoordsHelper.toRenderCoords(t,n))return null;const s=p(e,t,h.getNormal(i.plane)),a=p(e,t,i.edgeDirection);if(null==s||null==a)return null;const l=r.cross(o.create(),s,a);return h.fromPositionAndNormal(n,l,h.create())},e.createEdgeOffsetOperation=function(e,t,i){const n="on-the-ground"===i.mode?d.PlaneType.XY:d.PlaneType.XYZ;return new d.OffsetEdgeVertex(e,n,t,0)},e.edgeOffsetRotationMatrix=function(e,t,i){const n=h.getNormal(e),a=r.direction(o.create(),t,i),l=r.cross(o.create(),a,n),c=r.cross(o.create(),a,l);return s.fromValues(a[0],a[1],a[2],0,l[0],l[1],l[2],0,c[0],c[1],c[2],0,0,0,0,1)},e.getDistanceInGeometrySR=function(e,i,s,{data:{coordinateHelper:a,spatialReference:u}}){const m=t.valueInUnit(e,"meters"),d=n.getMetersPerUnitForSR(u),p=Math.sign(m*s.selectedArrow),g=c.geodesicCompatibleSpatialReference(u),_=h.getNormal(s.plane),f=a.pointToXYZ(i),y=o.create();r.scaleAndAdd(y,f,_,p*(10/d));const x=m*s.selectedArrow/d;if(!g||!l.projectVectorToVector(f,u,f,g)||!l.projectVectorToVector(y,u,y,g))return x;const v=new c.InverseGeodeticSolverResult;if(c.inverseGeodeticSolver(v,f,y,g),c.directGeodeticSolver(y,f,v.azimuth,m,g),!l.projectVectorToVector(y,g,y,u))return x;const P=y[0]-i.x,b=y[1]-i.y,E=Math.sqrt(P*P+b*b)*p,[S,C]=_,w=Math.sqrt(S*S+C*C);return 0===w?0:E/w},e.getMapPointAtEdgeOffsetManipulatorElevation=function(e,t,n,s){const{elevationInfo:r,operations:o}=n;if(!o||!e)return null;const l=s.manipulator.elevationAlignedLocation,c=m.getZForElevationMode(l,t,r),h=t.sceneIntersectionHelper.intersectElevationFromScreen(i.createScreenPointArray(e.x,e.y),r,c);return h&&a.projectPoint(h,h,o.data.spatialReference)?h:null},e.screenEdgeLengthSquared=function(e,t,n){const s=n.projectToRenderScreen(e,i.createRenderScreenPointArray3()),o=n.projectToRenderScreen(t,i.createRenderScreenPointArray3());return null!=s&&null!=o?r.squaredLength(r.subtract(s,s,o)):0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/reshape/reshapeTooltipUtils3D":function(){define(["exports","../../../../../core/handleUtils","../../../../../core/quantityUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/ensureType","../../../../../geometry/Point","../manipulatedObjectUtils","../tooltipUtils3D","../manipulations/MoveManipulation","../manipulations/moveUtils","../../../../interactive/editGeometry/interfaces","../../../../interactive/tooltip/tooltipCommonUtils","../../../../interactive/tooltip/infos/MovePointTooltipInfo","../../../../interactive/tooltip/infos/ReshapeEdgeOffsetTooltipInfo","../../../../interactive/tooltip/infos/SelectedVertexTooltipInfo","../../../../interactive/tooltip/infos/TranslateTooltipInfo","../../../../interactive/tooltip/infos/TranslateXYTooltipInfo","../../../../interactive/tooltip/infos/TranslateZTooltipInfo","../../../../support/euclideanLengthMeasurementUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y){"use strict";function x(e,{activeTooltipInfo:t,selectedVertexManipulatorInfo:i,callbacks:n}){if(!t)return;n.onBeforeReshape();const s=o.manipulatedObjectGeometry(e);switch(s?.type){case"mesh":"move-point"===t.type&&a.updateXYZFromTooltipInfo(t,s.origin,e,n);break;case"point":"move-point"===t.type&&a.updateXYZFromTooltipInfo(t,s,e,n);break;case"polyline":case"polygon":"selected-vertex"===t.type&&function(e,t,i,n){if(!t)return;const{dx:s,dy:r,dz:o}=u.getXYZDeltasFromTooltipInfo(e,t.manipulator.location);0===s&&0===r&&0===o||(n.onReshapeStart(),i.operations?.moveVertices([t.handle],s,r,o,h.AccumulationBehavior.NEW_STEP),n.onReshape(),n.onReshapeStop())}(t,i,e,n)}}const v=s.ensureType(r);function P(e,t,n){if(null!=t&&"end"!==t.action){const{mapStart:s,mapEnd:r}=t,o=n(s,r);e.distance=null!=o?o:i.zeroMeters}else e.distance=i.zeroMeters}e.connectTooltipToManipulatedObject=function(e,i,s){function r(){const e=s(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:t}}let l=!1;function c(e){l||(l=!0,e(),l=!1)}function h(t){c((()=>{!function(e,t){const{activeTooltipInfo:i,selectedVertexManipulatorInfo:n,sketchOptions:s}=t;if(i)switch(i.sketchOptions=s,i?.type){case"move-point":a.updateTooltipInfoFromManipulatedObject(i,e);break;case"selected-vertex":!function(e,t,i,{automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:s}){if(!e||"selected-vertex"!==e.type)return;const r=t?.manipulator.location;e.setLocationFromPoint(r),a.updateElevationFromPoint(e,r,i);const o=i.operations?.data.geometry;switch(o?.type){case"polygon":e.geometryType="polygon",e.totalLength.visible=!1,e.area.actual=n.autoArea2D(o);break;case"polyline":e.geometryType="polyline",e.totalLength.actual=s.autoLength2D(o),e.area.visible=!1}}(i,n,e,t)}}(i,t),e.info=t.activeTooltipInfo}))}return t.handlesGroup([n.watch(r,h,n.syncAndInitial),n.watch((()=>{const e=r(),{activeTooltipInfo:t}=e;if(t&&"key"in t)return{context:e,activeTooltipInfo:t,key:t.key,geometry:o.manipulatedObjectGeometry(i)}}),((e,t)=>{e&&t&&t.key!==e.key&&c((()=>x(i,e.context)))}),n.sync),i.on("committed",(()=>h(r()))),u.connectPasteEvent(e,{onBeforePaste:()=>{l=!0},onAfterPaste:()=>{x(i,r()),l=!1}})])},e.createTooltipInfos=function(e,t){const i=t?.type;return{edgeOffset:new d.ReshapeEdgeOffsetTooltipInfo({sketchOptions:e,viewType:i}),movePoint:new m.MovePointTooltipInfo({sketchOptions:e,viewType:i}),selectedVertex:new p.SelectedVertexTooltipInfo({sketchOptions:e,viewType:i}),translate:new g.TranslateTooltipInfo({sketchOptions:e,viewType:i}),translateXY:new _.TranslateXYTooltipInfo({sketchOptions:e,viewType:i}),translateZ:new f.TranslateZTooltipInfo({sketchOptions:e,viewType:i})}},e.getUpdatedEdgeOffsetTooltipInfo=function({operations:e},t,{sketchOptions:n,tooltipInfos:s,automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:o}){const a=s.edgeOffset;if(a.distance.committed=null,null!=t&&null!=t.signedDistance&&"end"!==t.action&&null!=e){const n=e.data.coordinateHelper,{start:s,end:r}=t.operation.clampedStartAndEnd(t.mapEnd),l=o.autoDistance2D(s,r,n.spatialReference),c=Math.sign(t.signedDistance*t.operation.selectedArrow);a.distance.actual=null!=l?i.scale(l,c):null}else a.distance.actual=i.zeroMeters;const l=e?.data.geometry;switch(a.area.actual=null,a.area.visible=!1,a.totalLength.actual=null,a.totalLength.visible=!1,l?.type){case"polygon":a.area.actual=r.autoArea2D(l),a.area.visible=!0;break;case"polyline":a.totalLength.actual=o.autoLength2D(l),a.totalLength.visible=!0}return a.sketchOptions=n,a},e.getUpdatedTranslateObjectTooltipInfo=function(e,t,{sketchOptions:n,tooltipInfos:s,automaticLengthMeasurementUtils:r}){let o=null;switch(e){case l.ManipulationType.XY:o=s.translate,P(o,t,((e,t)=>r.autoDistanceBetweenPoints2D(v(e),v(t))));break;case l.ManipulationType.XY_AXIS:o=s.translateXY,P(o,t,((e,n)=>i.scale(r.autoDistanceBetweenPoints2D(v(e),v(n)),c.axisConstrainedDragSign(t))));break;case l.ManipulationType.Z:o=s.translateZ,P(o,t,y.verticalSignedDistanceBetweenPoints)}return o.sketchOptions=n,o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/ReshapeEdgeOffsetTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../fields/fields","./SketchTooltipInfo"],(function(e,t,i,n,s,r,o,a,l){"use strict";e.ReshapeEdgeOffsetTooltipInfo=class extends l.SketchTooltipInfo{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=a.makeRelativeDistanceField({lockable:!1}),this.area=a.makeAreaField({visible:!1}),this.totalLength=a.makeTotalLengthField({visible:!1})}get allFields(){return[this.distance,this.area,this.totalLength]}},t.__decorate([i.property()],e.ReshapeEdgeOffsetTooltipInfo.prototype,"type",void 0),t.__decorate([i.property()],e.ReshapeEdgeOffsetTooltipInfo.prototype,"distance",void 0),t.__decorate([i.property()],e.ReshapeEdgeOffsetTooltipInfo.prototype,"area",void 0),t.__decorate([i.property()],e.ReshapeEdgeOffsetTooltipInfo.prototype,"totalLength",void 0),t.__decorate([i.property()],e.ReshapeEdgeOffsetTooltipInfo.prototype,"allFields",null),e.ReshapeEdgeOffsetTooltipInfo=t.__decorate([o.subclass("esri.views.interactive.tooltip.infos.ReshapeEdgeOffsetTooltipInfo")],e.ReshapeEdgeOffsetTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/SelectedVertexTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../fields/fields","./SketchTooltipInfo","./TooltipInfoWithCoordinates"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";e.SelectedVertexTooltipInfo=class extends(c.TooltipInfoWithCoordinates(l.SketchTooltipInfo)){constructor(e){super(e),this.type="selected-vertex",this.area=a.makeAreaField(),this.totalLength=a.makeTotalLengthField(),this.geometryType="polyline",this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,"polygon"===this.geometryType?this.area:this.totalLength]}},t.__decorate([i.property()],e.SelectedVertexTooltipInfo.prototype,"geometryType",void 0),t.__decorate([i.property()],e.SelectedVertexTooltipInfo.prototype,"allFields",null),e.SelectedVertexTooltipInfo=t.__decorate([o.subclass("esri.views.interactive.tooltip.infos.SelectedVertexTooltipInfo")],e.SelectedVertexTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/transform/TransformTool3D":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/arrayUtils","../../../../../core/Evented","../../../../../core/handleUtils","../../../../../core/has","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/Logger","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/support/UpdatingHandles","../../../../../geometry/Point","../../../../ViewingMode","../../Manipulator3D","../../manipulatorUtils","../../SnappingVisualizer3D","../manipulatedObjectUtils","../manipulatorUtils","../meshFastUpdateUtils","../tooltipUtils3D","../visualElementUtils","../manipulations/config","../manipulations/MoveManipulation","./ScaleRotateMeshAdapter","./ScaleRotateObjectSymbol3DAdapter","./ScaleRotateTransform","../../../../interactive/dragEventPipeline","../../../../interactive/InteractiveToolBase","../../../../interactive/editGeometry/EditGeometryOperations","../../../../interactive/sketch/SketchOptions","../../../../interactive/snapping/SnappingContext","../../../../interactive/snapping/SnappingDragPipelineStep","../../../../interactive/tooltip/tooltipCommonUtils","../../../../interactive/tooltip/infos/TransformMeshTooltipInfo","../../../../interactive/tooltip/infos/TransformPointTooltipInfo"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C,w,T,D,I,A,M,N,R,O,G){"use strict";e.TransformTool3D=class extends D.InteractiveToolBase{constructor(e){super(e),this.events=new n,this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new A,this.type="transform-3d",this._updatingHandles=new u.UpdatingHandles,this._scaleRotate=null}initialize(){const{events:e,object:t,view:n}=this;this.tooltip=R.makeTooltip((()=>({view:n,options:this.sketchOptions.tooltips}))),this._moveManipulation=new E.MoveManipulation({tool:this,view:n,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&y.canMoveZOperations(t.operations,t.elevationInfo),radius:E.MoveManipulation.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator((t=>this.addHandles(t.events.on("immediate-click",(t=>{e.emit("immediate-click",{...t,object:this.object}),t.stopPropagation()})))));const r=t.elevationInfo;if(this._moveManipulation.elevationInfo=r,this.addHandles(x.meshTransformFastUpdateHandles(t)),this._moveManipulation.createManipulatedObjectDragPipeline(((e,i,s,o,a)=>{if(e===E.ManipulationType.XY){const{snappingStep:e,cancelSnapping:i}=N.createSnapDragEventPipelineStep({snappingContext:new M.SnappingContext({elevationInfo:r,pointer:a,editGeometryOperations:I.EditGeometryOperations.fromGeometry(new m({spatialReference:t.operations?.data.spatialReference}),n.state.viewingMode),visualizer:new _.SnappingVisualizer3D,excludeFeature:t.graphic}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});o=o.next(i),s=s.next(T.sceneSnappingAtProjectedLocation(this.view,r)).next(...e)}return{steps:s,cancel:o}}),t,(t=>{const{action:i,object:n,dxScreen:s,dyScreen:r}=t,o={object:n,dxScreen:s,dyScreen:r};switch(i){case"start":this._emitRecordUndo(),e.emit("translate-start",o);break;case"update":e.emit("translate",o);break;case"end":e.emit("translate-stop",o)}})),this._moveManipulation.angle=null!=this._scaleRotate?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles(a.watch((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new w.ScaleRotateTransform({tool:this,mode:e,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions}),this.addHandles(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.addHandles([P.createVisualElements({view:this.view,object:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>s.makeHandle()}),t.on("committed",(()=>this._onGeometryChanged())),this._hideManipulatorsForObjectState(),a.watch((()=>n.scale),(()=>this._updateMoveAngle()))].filter(i.isSome)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((e=>{e instanceof p.Manipulator3D&&this.addHandles(e.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))}));const o=n?.type,{sketchOptions:l}=this;this._meshTooltipInfo=new O.TransformMeshTooltipInfo({viewType:o,sketchOptions:l}),this._pointTooltipInfo=new G.TransformPointTooltipInfo({viewType:o,sketchOptions:l});const c={object:t,dxScreen:0,dyScreen:0},h={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),e.emit("translate-start",{...c})},onMove:()=>e.emit("translate",{...c}),onMoveStop:()=>e.emit("translate-stop",{...c}),onRotateStart:i=>{this._emitRecordUndo(),e.emit("rotate-start",{object:t,angle:i})},onRotate:i=>e.emit("rotate",{object:t,angle:i}),onRotateStop:i=>e.emit("rotate-stop",{object:t,angle:i}),onScaleStart:(i,n)=>{this._emitRecordUndo(),e.emit("scale-start",{object:t,xScale:i,yScale:n})},onScale:(i,n)=>e.emit("scale",{object:t,xScale:i,yScale:n}),onScaleStop:(i,n)=>e.emit("scale-stop",{object:t,xScale:i,yScale:n})};this.addHandles(v.connectTooltipToManipulatedObject(this.tooltip,this.object,(()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this.activeTooltipInfo,callbacks:h,scaleRotateTransform:this._scaleRotate})))),this.finishToolCreation()}destroy(){this.tooltip.destroy(),this._moveManipulation.destroy(),this._scaleRotate=o.destroyMaybe(this._scaleRotate),this._scaleRotateAdapter=o.destroyMaybe(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("object",null)}onInputEvent(e){if(!this.destroyed&&!R.enterInputModeIfAvailable(e,this.tooltip))return super.onInputEvent(e)}_updateManipulatorsInteractive(){null!=this._scaleRotate&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){const e=f.manipulatedObjectGeometry(this.object);return"mesh"===e?.type?new S.ScaleRotateMeshAdapter({object:this.object,viewingMode:this.view.state.viewingMode}):new C.ScaleRotateObjectSymbol3DAdapter({graphic:this.object.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.object.graphic?.layer)),sizeAxis:this.sketchOptions?.tooltips?.visualVariables?.size?.axis??null})}_forEachManipulator(e){this._moveManipulation?.forEachManipulator(e),this._scaleRotate?.forEachManipulator(e)}_hideManipulatorsForObjectState(){return a.watch((()=>this.object.visible),(e=>{this._forEachManipulator((t=>t.available=e)),this._moveManipulation.zManipulation.available=e&&this.enableZ&&y.canMoveZOperations(this.object.operations,this.object.elevationInfo)}))}_emitRecordUndo(){this.events.emit("record-undo",{updates:[this.object.createUndoRecord()]})}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this._updatingHandles.updating||!!this._scaleRotate?.updating}get activeTooltipInfo(){return"mesh"===f.manipulatedObjectGeometry(this.object)?.type?this._meshTooltipInfo:this._pointTooltipInfo}set location(e){this._moveManipulation.location=e,this._scaleRotate&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){this._scaleRotate?.cancelActiveAnimation()}_onScaleChanged(){null!=this._scaleRotate&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){const{view:e}=this,t=e.state.viewingMode===d.ViewingMode.Local||e.scale<b.alignArrowsScaleThreshold;this._moveManipulation.angle=t?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){g.placeAtObject(this,this.object)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){}},t.__decorate([l.property({constructOnly:!0,nonNullable:!0})],e.TransformTool3D.prototype,"view",void 0),t.__decorate([l.property({constructOnly:!0,nonNullable:!0})],e.TransformTool3D.prototype,"object",void 0),t.__decorate([l.property({constructOnly:!0,nonNullable:!0})],e.TransformTool3D.prototype,"enableZ",void 0),t.__decorate([l.property()],e.TransformTool3D.prototype,"enableRotation",void 0),t.__decorate([l.property()],e.TransformTool3D.prototype,"enableScaling",void 0),t.__decorate([l.property({constructOnly:!0,type:A})],e.TransformTool3D.prototype,"sketchOptions",void 0),t.__decorate([l.property({value:!1})],e.TransformTool3D.prototype,"snapToScene",null),t.__decorate([l.property({constructOnly:!0})],e.TransformTool3D.prototype,"snappingManager",void 0),t.__decorate([l.property({readOnly:!0})],e.TransformTool3D.prototype,"type",void 0),t.__decorate([l.property({readOnly:!0})],e.TransformTool3D.prototype,"updating",null),t.__decorate([l.property()],e.TransformTool3D.prototype,"activeTooltipInfo",null),e.TransformTool3D=t.__decorate([h.subclass("esri.views.3d.interactive.editingTools.transform.TransformTool3D")],e.TransformTool3D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/transform/ScaleRotateMeshAdapter":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/mathUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../geometry/support/axisAngleDegrees","../manipulatedObjectUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";e.ScaleRotateMeshAdapter=class extends i{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([s.when((()=>{const e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null}),(({interactionState:e})=>{this._updateMeshRotation(e)}),s.sync),s.when((()=>{const e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null}),(({interactionState:e})=>{this._updateMeshSize(e)}),s.sync)])}get geometry(){const e=u.manipulatedObjectGeometry(this.object);return"mesh"===e?.type?e:null}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){const e=this.geometry?.transform;if(null==e)return this._interactionState?.angle??0;const t=h.axis(e.rotation)[2];return Math.abs(t)>.999999?n.deg2rad(h.angle(e.rotation))*Math.sign(t):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){const e=new m({angle:this.angle});this._interactionState=e;const t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return this.object.createUndoRecord()}_updateMeshRotation(e){const{geometry:t}=this;if(null==t)return;const{angle:i,previousAngle:s}=e;e.previousAngle=i;const r=n.rad2deg(i-s);t.rotate(0,0,r)}_updateMeshSize(e){const{geometry:t}=this;if(null==t)return;const{scale:i,previousScale:n}=e;e.previousScale=i;const s=i/n;t.scale(s)}},t.__decorate([r.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"object",void 0),t.__decorate([r.property()],e.ScaleRotateMeshAdapter.prototype,"geometry",null),t.__decorate([r.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"viewingMode",void 0),t.__decorate([r.property()],e.ScaleRotateMeshAdapter.prototype,"initialAngle",null),t.__decorate([r.property()],e.ScaleRotateMeshAdapter.prototype,"angle",null),t.__decorate([r.property()],e.ScaleRotateMeshAdapter.prototype,"angleClockwise",null),t.__decorate([r.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngle",null),t.__decorate([r.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngleClockwise",null),t.__decorate([r.property()],e.ScaleRotateMeshAdapter.prototype,"scale",null),t.__decorate([r.property()],e.ScaleRotateMeshAdapter.prototype,"_interactionState",void 0),e.ScaleRotateMeshAdapter=t.__decorate([c.subclass("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter")],e.ScaleRotateMeshAdapter);let m=class extends i{get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};t.__decorate([r.property()],m.prototype,"angle",void 0),t.__decorate([r.property()],m.prototype,"initialAngle",void 0),t.__decorate([r.property()],m.prototype,"previousAngle",void 0),t.__decorate([r.property()],m.prototype,"previousScale",void 0),t.__decorate([r.property()],m.prototype,"scale",void 0),t.__decorate([r.property()],m.prototype,"state",null),m=t.__decorate([c.subclass("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState")],m),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/transform/ScaleRotateObjectSymbol3DAdapter":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/mathUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";function h(e){return-n.deg2rad(e)}e.ScaleRotateObjectSymbol3DAdapter=class extends i{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(s.when((()=>null!=this._interactionState?this._interactionState.state:null),(e=>{this._updateSymbol(e)}),s.sync))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?h(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){const e=this._sizeReferenceSymbolLayer;if(null==e)return null;const t=this.findLayerView(),i=this._graphicSymbol;if(null==t||null==i||"point-3d"!==i.type)return null;const n=t.getSymbolLayerSize(i,e);if("size"in n&&null!=n.size)return n.size;const s=this.sizeAxis;return!("width"in n)||null==n.width||null!=s&&"width"!==s&&"all"!==s&&"width-and-depth"!==s?!("depth"in n)||null==e.depth||null!=s&&"depth"!==s&&"all"!==s&&"width-and-depth"!==s?!("height"in n)||null==e.height||null!=s&&"height"!==s&&"all"!==s?null:n.height:n.depth:n.width}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type))}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type&&null!=e.heading))}get _graphicSymbol(){return null!=this.graphic?.symbol&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if(null!=this._interactionState||null==e||null==t)return u;const i=e.symbolLayers.map((i=>"object"===i.type?t.getSymbolLayerSize(e,i):null)).toArray(),n=e.clone(),s=this.angle,r=new m({originalSymbol:n,angle:s,initialSizes:i});this._interactionState=r;const o=()=>{this._interactionState=null};return{state:r,done:o,cancel:()=>{this._graphicSymbol=n,o()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e},redo:i=>{e=i.symbol,i.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:i,initialSizes:s}){const r=this._graphicSymbol;if(null==r||"point-3d"!==r.type)return;const o=r.clone(),a=-n.rad2deg(t-this.initialAngle);let l=!1;this._forEachObjectSymbolLayerPair(i,o,((t,i,n)=>{const r=(t.heading??0)+a;i.heading!==r&&(i.heading=r,l=!0);const o=s[n];if(null!=o&&"width"in o){o.width=this.sizeFilter(o.width),o.height=this.sizeFilter(o.height),o.depth=this.sizeFilter(o.depth);const t=o.width*e;i.width!==t&&(i.width=t,l=!0);const n=o.depth*e;i.depth!==n&&(i.depth=n,l=!0);const s=o.height*e;i.height!==s&&(i.height=s,l=!0)}})),l&&(this._graphicSymbol=o)}_forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach(((e,n)=>{const s=t.symbolLayers.at(n);"object"===e.type&&"object"===s.type&&i(e,s,n)}))}},t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"initialAngle",null),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"angle",null),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"angleClockwise",null),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"orientation",null),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"orientationClockwise",null),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"relativeAngle",null),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"relativeAngleClockwise",null),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"scale",null),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"size",null),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"sizeAxis",void 0),t.__decorate([r.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"graphic",void 0),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_interactionState",void 0),t.__decorate([r.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"findLayerView",void 0),t.__decorate([r.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"sizeFilter",void 0),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_sizeReferenceSymbolLayer",null),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_orientationReferenceSymbolLayer",null),t.__decorate([r.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_graphicSymbol",null),e.ScaleRotateObjectSymbol3DAdapter=t.__decorate([c.subclass("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter")],e.ScaleRotateObjectSymbol3DAdapter);const u={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let m=class extends i{get state(){const{originalSymbol:e,angle:t,initialAngle:i,scale:n,initialSizes:s}=this;return{originalSymbol:e,angle:t,initialAngle:i,scale:n,initialSizes:s}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}};t.__decorate([r.property()],m.prototype,"originalSymbol",void 0),t.__decorate([r.property()],m.prototype,"angle",void 0),t.__decorate([r.property()],m.prototype,"initialAngle",void 0),t.__decorate([r.property()],m.prototype,"initialSizes",void 0),t.__decorate([r.property()],m.prototype,"scale",void 0),t.__decorate([r.property()],m.prototype,"state",null),m=t.__decorate([c.subclass("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter.InteractionState")],m),e.headingToAngle=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/transform/ScaleRotateTransform":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/colorUtils","../../../../../core/Cyclical","../../../../../core/Evented","../../../../../core/has","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/scheduling","../../../../../core/screenUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../geometry/support/plane","../../../../../geometry/support/ray","../../../../../geometry/support/vectorStacks","../../Manipulator3D","../../manipulatorUtils","../../RenderObject","../dragEventPipeline3D","../ManipulatorType","../manipulations/config","../../../webgl-engine/lib/basicInterfaces","../../../webgl-engine/lib/GeometryUtil","../../../webgl-engine/lib/Material","../../../webgl-engine/materials/ColorMaterial","../../../../interactive/dragEventPipeline","../../../../interactive/interfaces"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C,w,T,D,I,A,M,N,R,O){"use strict";var G,k;function V(e,t,i){return t.projectToScreen(e,L),y.set(i,L[0],L[1],0)}function F(e,t){let i=null,n=1;const s=()=>n;return{start:()=>{n=e.getScale(),i=e.getScale,e.getScale=s,t()},update:e=>(n+=((n+1)/2-n)*Math.min(e*D.ringResetAnimationSpeedFactor,1),t(),Math.abs(n-1)<.01?k.STOP:k.CONTINUE),destroy:()=>{i&&(e.getScale=i),t()}}}!function(e){e.ScaleIn=O.ManipulatorStateCustomFlags.Custom2,e.ScaleOut=O.ManipulatorStateCustomFlags.Custom3,e.RotateLeft=O.ManipulatorStateCustomFlags.Custom4,e.RotateRight=O.ManipulatorStateCustomFlags.Custom5,e.Unlocked=O.ManipulatorStateCustomFlags.Custom7,e.DelayedFocused=O.ManipulatorStateCustomFlags.Custom8,e.TouchInput=O.ManipulatorStateCustomFlags.Custom12}(G||(G={})),e.ScaleRotateTransform=class extends i{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}get updating(){return!!this._activeAnimation}constructor(e){super(e),this.mode=null,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=D.ringIndicatorDelayMs,this.events=new r,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>"scale"===this._scaleRotateDragData?.mode?this.adapter.scale:1}initialize(){this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([c.watch((()=>{const{adapter:e}=this;return[e.angle,e.scale]}),(()=>this._updateManipulatorTransform()))])}destroy(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=h.addFrameTask({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=l.destroyMaybe(this._activeAnimation)}forEachManipulator(e){e(this._ringManipulator,T.ManipulatorType.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.object,i=R.createManipulatorDragEventPipeline(e,((e,i,n)=>{this._scaleRotateDragData=null;const r=this.adapter.startInteraction(),o={mode:"none",origin:x.clone(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=o,this._updateDragState();const l=b.sv3d.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,l),i.next(w.screenToRenderPlane(this.tool.view,v.fromPositionAndNormal(e.renderLocation,l,v.create()))).next((e=>{const i=v.getNormal(e.plane),n=S.calculateInputRotationTransform(e.renderStart,e.renderEnd,o.origin,i),l=s.cyclicalPI.shortestSignedDiff(o.angle,n);o.angleDir=a.clamp(o.angleDir+l,-.3,D.rotateIndicatorDirectionBuffer),o.angle=n;const c=function(e,t){const i=y.subtract(b.sv3d.get(),t.renderStart,e.origin),n=y.subtract(b.sv3d.get(),t.renderEnd,e.origin),s=y.length(i),r=y.length(n);return 0===s?0:r/s}(o,e),h=c-this.adapter.scale;if(o.scaleDir=a.clamp(o.scaleDir+h,-.2,D.scaleIndicatorDirectionBuffer),this._onScaleChanged(),"none"===o.mode){const i=this.mode||function(e,t,i,n){const{renderStart:s,renderEnd:r}=e,o=V(s,n,b.sv3d.get()),a=V(r,n,b.sv3d.get());if(y.squaredDistance(o,a)<D.dragThresholdPx*D.dragThresholdPx)return null;const l=y.subtract(b.sv3d.get(),s,i),c=y.cross(b.sv3d.get(),l,v.getNormal(t)),h=s,u=y.add(b.sv3d.get(),h,c),m=V(i,n,b.sv3d.get()),d=o,p=V(u,n,b.sv3d.get()),g=y.subtract(b.sv3d.get(),p,d),_=y.subtract(b.sv3d.get(),o,m),f=P.wrap(d,g),x=P.wrap(m,_);return P.distance2(f,a)<P.distance2(x,a)?"rotate":"scale"}(e,e.plane,o.origin,this.tool.view.state.camera);if(null!=i){switch(i){case"rotate":this.tool.events.emit("rotate-start",{object:t,angle:0}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]});break;case"scale":this.tool.events.emit("scale-start",{object:t,xScale:1,yScale:1}),this.tool.events.emit("record-undo",{updates:[this.adapter.createUndoRecord()]})}o.mode=i}}switch(o.mode){case"rotate":r.state.angle=o.initialAngle+n;break;case"scale":r.state.scale=c,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(o.mode){case"rotate":this.tool.events.emit("rotate",{object:t,angle:a.rad2deg(o.angle)});break;case"scale":this.tool.events.emit("scale",{object:t,xScale:c,yScale:c})}break;case"end":switch(o.mode){case"rotate":this.tool.events.emit("rotate-stop",{object:t,angle:a.rad2deg(o.angle)});break;case"scale":this.tool.events.emit("scale-stop",{object:t,xScale:c,yScale:c})}}return"end"===e.action&&(this.startAnimation(F(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),r.done()),e})),n.next((()=>{if(r.cancel(),null!=this._scaleRotateDragData){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.events.emit("rotate-stop",{object:t,angle:0});break;case"scale":this.tool.events.emit("scale-stop",{object:t,xScale:1,yScale:1})}this.startAnimation(F(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}}))}));this.addHandles([i,e.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t,i){let n=0,s=null;const r=()=>!1;return{start:()=>{s=e.getFocused,e.getFocused=r,n=0,t()},update:e=>(n+=e,!s?.()||n>=i.delayMs?k.STOP:k.CONTINUE),destroy:()=>{s&&(e.getFocused=s),t()}}}(this,(()=>this._updateDelayedFocusedState()),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()})),e.events.on("immediate-click",(e=>{e.stopPropagation()})),c.watch((()=>this.tool.object.visible),(e=>this._ringManipulator.available=e),c.initial)])}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(G.DelayedFocused,this.getFocused())}_updateDragState(){if(this._ringManipulator.updateStateEnabled(G.Unlocked,!(null!=this._scaleRotateDragData&&"none"!==this._scaleRotateDragData?.mode)),null!=this._scaleRotateDragData)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(G.ScaleIn|G.ScaleOut,!1),this._ringManipulator.updateStateEnabled(G.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(G.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(G.RotateLeft|G.RotateRight,!1),this._ringManipulator.updateStateEnabled(G.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(G.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(G.ScaleIn|G.ScaleOut|G.RotateLeft|G.RotateRight,!1)}_updateManipulatorTransform(){const e=_.fromRotation(b.sm4d.get(),this.adapter.angle,x.fromValues(0,0,1));if(null==e)return;const t=this.getScale(),i=_.fromScaling(b.sm4d.get(),y.set(b.sv3d.get(),t,t,t));this._ringManipulator.modelTransform=_.multiply(b.sm4d.get(),i,e)}_createRingManipulator(){const e=(e,t,i)=>{const n=[],s=Math.ceil(D.geometrySegments*(t-e)/(2*Math.PI));for(let r=0;r<s+1;r++){const o=e+r*(t-e)/s;n.push(x.fromValues(i*Math.cos(o),i*Math.sin(o),0))}return n},t=t=>e(0,2*Math.PI,t),i=this._createMaterial(1),n=(e,t,n=i)=>A.createPathExtrusionGeometry(n,(e=>[[-e/2,0],[e/2,0],[e/2,D.ringHeight/2],[-e/2,D.ringHeight/2]])(t),e,[],[],!1),s=t(D.ringRadius),r=n(s,D.ringThickness),o={left:new Array,right:new Array},a=[];for(let t=0;t<2;t++){const s=t*Math.PI-Math.PI/4,r=Math.PI/2-D.rotateIndicatorArcLength,l=s+r,c=s+Math.PI/2-r,h=e(l,c,D.innerIndicatorRadius),u=n(h,D.indicatorThickness);a.push(h),a.push(e(l,c,D.outerIndicatorRadius-D.ringThickness/2)),o.left.push(u),o.right.push(u.instantiate());for(let e=0;e<2;e++){const t=0===e,n=f.create();if(t){_.scale(n,n,[1,-1,1]),_.rotate(n,n,-l,[0,0,1]);const e=Math.round(D.rotateIndicatorArrowPlacementPercentage*(h.length-1));n[12]=h[e][0],n[13]=h[e][1],n[14]=h[e][2]}else{_.rotate(n,n,c,[0,0,1]);const e=Math.round((1-D.rotateIndicatorArrowPlacementPercentage)*(h.length-1));n[12]=h[e][0],n[13]=h[e][1],n[14]=h[e][2]}const s=A.createExtrudedTriangle(i,D.rotateIndicatorArrowTipLength,0,D.rotateIndicatorArrowTipRadius,D.ringHeight);A.transformInPlace(s,n),(t?o.left:o.right).push(s)}}const l=[];for(let t=0;t<2;t++){const i=t*Math.PI-Math.PI/4,s=Math.PI/2-D.scaleIndicatorArcLength,r=i+s,o=i+Math.PI/2-s,a=e(r,o,D.outerIndicatorRadius);l.push(n(a,D.indicatorThickness))}const c=this._createMaterial(.66),h=this._createMaterial(.5),u=this._createMaterial(.33),m=t(D.ringRadius+D.scaleIndicatorOffset1),d=t(D.ringRadius+D.scaleIndicatorOffset2),p=n(m,D.indicatorThickness,c),g=n(d,D.indicatorThickness,u),y=t(D.ringRadius-D.scaleIndicatorOffset1),v=t(D.ringRadius-D.scaleIndicatorOffset2),P=n(y,D.indicatorThickness,c),b=n(v,D.indicatorThickness,u);let S=[new C.RenderObject(r,G.DelayedFocused),new C.RenderObject(r.instantiate({material:h}),O.ManipulatorStateFlags.None)];this.mode&&"scale"!==this.mode||(S=S.concat([...l.map((e=>new C.RenderObject(e,G.DelayedFocused|G.Unlocked))),new C.RenderObject(p,G.DelayedFocused|G.ScaleIn),new C.RenderObject(g,G.DelayedFocused|G.ScaleIn),new C.RenderObject(P,G.DelayedFocused|G.ScaleOut),new C.RenderObject(b,G.DelayedFocused|G.ScaleOut)])),this.mode&&"rotate"!==this.mode||(S=S.concat([...o.right.map((e=>new C.RenderObject(e.instantiate(),G.DelayedFocused|G.Unlocked))),...o.left.map((e=>new C.RenderObject(e,G.DelayedFocused|G.RotateLeft))),...o.right.map((e=>new C.RenderObject(e,G.DelayedFocused|G.RotateRight)))]));const w=[s,...a];return new E.Manipulator3D({view:this.tool.view,renderObjects:S,autoScaleRenderObjects:!1,worldOriented:!0,radius:D.ringThickness,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:this.tool.object.elevationInfo,collisionType:{type:"ribbon",paths:w,direction:x.fromValues(0,0,1)}})}_createMaterial(e){const t=new N.ColorMaterial({cullFace:I.CullFaceOptions.Back,renderOccluded:M.RenderOccludedFlag.Transparent,isDecoration:!0});return this.addHandles(c.watch((()=>n.multiplyOpacityToUnitRGBA(this.tool.view.effectiveTheme.accentColor,e)),(e=>t.setParameters({color:e})),c.initial)),t}get test(){}},t.__decorate([m.property({constructOnly:!0})],e.ScaleRotateTransform.prototype,"tool",void 0),t.__decorate([m.property({constructOnly:!0})],e.ScaleRotateTransform.prototype,"adapter",void 0),t.__decorate([m.property({constructOnly:!0})],e.ScaleRotateTransform.prototype,"sketchOptions",void 0),t.__decorate([m.property()],e.ScaleRotateTransform.prototype,"mode",void 0),t.__decorate([m.property()],e.ScaleRotateTransform.prototype,"_activeAnimation",void 0),t.__decorate([m.property()],e.ScaleRotateTransform.prototype,"updating",null),e.ScaleRotateTransform=t.__decorate([g.subclass("esri.views.3d.interactive.editingTools.transform.ScaleRotateTransform")],e.ScaleRotateTransform),function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(k||(k={}));const L=u.createScreenPointArray();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/TransformMeshTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../fields/fields","./SketchTooltipInfo","./TooltipInfoWithCoordinates"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";e.TransformMeshTooltipInfo=class extends(c.TooltipInfoWithCoordinates(l.SketchTooltipInfo)){constructor(e){super(e),this.type="transform-mesh",this.orientation=a.makeOrientationField(),this.scale=a.makeScaleField(),this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic,orientation:this.orientation.actual,scale:this.scale.actual}}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}},t.__decorate([i.property()],e.TransformMeshTooltipInfo.prototype,"key",null),t.__decorate([i.property()],e.TransformMeshTooltipInfo.prototype,"allFields",null),e.TransformMeshTooltipInfo=t.__decorate([o.subclass("esri.views.interactive.tooltip.infos.TransformMeshTooltipInfo")],e.TransformMeshTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/TransformPointTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../fields/fields","./SketchTooltipInfo","./TooltipInfoWithCoordinates"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";e.TransformPointTooltipInfo=class extends(c.TooltipInfoWithCoordinates(l.SketchTooltipInfo)){constructor(e){super(e),this.type="transform-point",this.orientation=a.makeOrientationField({readOnly:!0}),this.size=a.makeSizeField({readOnly:!0}),this.allFields.forEach((e=>{e.lockable=!1,e.setActual(null)}))}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.size]}},t.__decorate([i.property()],e.TransformPointTooltipInfo.prototype,"allFields",null),e.TransformPointTooltipInfo=t.__decorate([o.subclass("esri.views.interactive.tooltip.infos.TransformPointTooltipInfo")],e.TransformPointTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/transform/ExtentTransformTool":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Evented","../../../../../core/handleUtils","../../../../../core/has","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../geometry/support/aaBoundingRect","../../../../../geometry/support/vectorStacks","../../../analysis/Slice/sliceToolUtils","../../Manipulator3D","../manipulatedObjectUtils","../ManipulatorType","../manipulatorUtils","../visualElementUtils","./extentTransform/ExtentMove","./extentTransform/ExtentRotate","./extentTransform/ExtentScale","./extentTransform/extentUtils","./extentTransform/PreserveAspectRatio","./extentTransform/SnapRotation","../../visualElements/OutlineVisualElement","../../../../interactive/InteractiveToolBase","../../../../interactive/sketch/SketchOptions","../../../../interactive/tooltip/tooltipCommonUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C,w,T){"use strict";e.ExtentTransformTool=class extends C.InteractiveToolBase{get updating(){return!!this.object.updating}constructor(e){super(e),this.events=new i,this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new w,this._preserveAspectRatio=new b.PreserveAspectRatio,this._snapRotation=new E.SnapRotation,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){const{view:e,object:t}=this,i=this._bounds=new P.TransformBounds(this,(()=>this._updateManipulators()));this._extentMove=new y.ExtentMove(this,i,this.automaticLengthMeasurementUtils),this._extentScale=new v.ExtentScale(this,i,(()=>this._preserveAspectRatio.createDragEventPipelineStep())),this._extentRotate=new x.ExtentRotate(this,i,(()=>this._snapRotation.createDragEventPipelineStep())),this.addHandles([r.watch((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,g.ManipulatorType.TRANSLATE_Z))),r.watch((()=>this.enableScaling),(()=>this._extentScale.forEachManipulator((e=>this._updateManipulatorAvailability(e,g.ManipulatorType.SCALE))))),r.watch((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,g.ManipulatorType.ROTATE)))]),this._updateManipulators(),this._updateAllManipulatorAvailability();const s=f.createVisualElements({view:e,object:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>n.makeHandle()});if(null!=s){const{visualElement:e}=s;e instanceof S.OutlineVisualElement&&(this._outlineVisualElement=e,this.addHandles(e.events.on("attachment-origin-changed",(()=>this._bounds.updateDisplayBounds())))),this.addHandles(s)}this.addHandles([t.on("committed",(()=>this._onGeometryChanged())),r.watch((()=>this.object.visible),(()=>this._updateAllManipulatorAvailability())),r.watch((()=>this.object.isDraped),(()=>this._graphicDrapedChanged()),r.initial),r.watch((()=>e.pointsOfInterest?.centerOnSurfaceFrequent.location),(()=>i.updateDisplayBounds()))]),this._forEachManipulator((e=>{this.addHandles(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()})))})),this._forEachManipulator(((e,i)=>{this.addHandles(e.events.on("immediate-click",(e=>{i===g.ManipulatorType.TRANSLATE_XY&&this.events.emit("immediate-click",{...e,object:t}),e.stopPropagation()})))})),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this.tooltip.destroy(),this._set("view",null),this._set("object",null)}_initializeTooltip(){const{view:e}=this;this.tooltip=T.makeTooltip((()=>({view:e,options:this.sketchOptions.tooltips})));const t=()=>{this.tooltip.info=this._getUpdatedTooltipInfo()};this.addHandles([r.watch((()=>this.sketchOptions.tooltips.effectiveEnabled),t),r.watch((()=>this.preserveAspectRatio),t)]),this._forEachManipulator((e=>{this.addHandles([e.events.on(["focus-changed","grab-changed"],t),e.events.on("drag",(e=>{"cancel"===e.action?this.tooltip.clear():t()}))])}))}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(D),this._bounds.updateDisplayBounds(),this.object.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",(e=>{null!=this._attachmentOrigin&&h.containsXY(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()})),D)}_updateManipulators(){if(!this.visible)return;const e=this._bounds.displayBounds,t=m.calculateBoundedPlaneTranslateRotate(e,u.sm4d.get());this._extentMove.updateManipulators(t,e),this._extentScale.updateManipulators(t,e),this._extentRotate.updateManipulators(t,e)}_updateAllManipulatorAvailability(){this._forEachManipulator(((e,t)=>this._updateManipulatorAvailability(e,t)))}_updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof d.Manipulator3D){const n=this.object.visible,s=this.enableZ&&_.canMoveZOperations(this.object.operations,this.object.elevationInfo);switch(t){case g.ManipulatorType.ROTATE:e.available=n&&this.enableRotation;break;case g.ManipulatorType.SCALE:e.available=n&&(this.enableScaling||this.enableRotation||s),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?m.resizeNormal:m.resizeOutlineOnly;break;case g.ManipulatorType.TRANSLATE_Z:e.available=n&&s;break;default:e.available=n}}}_forEachManipulator(e){this._extentMove.forEachManipulator(e),this._extentScale.forEachManipulator(e),this._extentRotate.forEachManipulator(e)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get snapRotation(){return this._snapRotation.enabled}set snapRotation(e){this._snapRotation.enabled=e,this._set("snapRotation",e)}get attachmentOrigin(){const e=this.object.isDraped?null:this._outlineVisualElement?.attachmentOrigin;return this._attachmentOrigin=e??this.object.origin??p.manipulatedObjectGeometry(this.object)?.extent?.center,this._attachmentOrigin}reset(){}cancelDrag(){if(this.canUndo){const e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}this.inputState=null}get canUndo(){return!!this.object.operations?.canUndo}undo(){if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){const e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}}get canRedo(){return!!this.object.operations?.canRedo}redo(){if(this.canRedo){const e=this.object.operations?.redo();e&&this._bounds.updateMapBoundsFromOperation(e)}}get test(){}},t.__decorate([o.property()],e.ExtentTransformTool.prototype,"updating",null),t.__decorate([o.property({constructOnly:!0,nonNullable:!0})],e.ExtentTransformTool.prototype,"view",void 0),t.__decorate([o.property({constructOnly:!0})],e.ExtentTransformTool.prototype,"automaticLengthMeasurementUtils",void 0),t.__decorate([o.property({constructOnly:!0,nonNullable:!0})],e.ExtentTransformTool.prototype,"object",void 0),t.__decorate([o.property()],e.ExtentTransformTool.prototype,"enableZ",void 0),t.__decorate([o.property()],e.ExtentTransformTool.prototype,"enableScaling",void 0),t.__decorate([o.property()],e.ExtentTransformTool.prototype,"enableRotation",void 0),t.__decorate([o.property({constructOnly:!0,type:w})],e.ExtentTransformTool.prototype,"sketchOptions",void 0),t.__decorate([o.property()],e.ExtentTransformTool.prototype,"preserveAspectRatio",null),t.__decorate([o.property()],e.ExtentTransformTool.prototype,"snapRotation",null),t.__decorate([o.property()],e.ExtentTransformTool.prototype,"grabbing",void 0),t.__decorate([o.property()],e.ExtentTransformTool.prototype,"inputState",void 0),t.__decorate([o.property({readOnly:!0})],e.ExtentTransformTool.prototype,"type",void 0),t.__decorate([o.property()],e.ExtentTransformTool.prototype,"tooltip",void 0),e.ExtentTransformTool=t.__decorate([c.subclass("esri.views.3d.interactive.editingTools.transform.ExtentTransformTool")],e.ExtentTransformTool);const D="draped-elevation-changes";Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/analysis/Slice/sliceToolUtils":function(){define(["exports","../../../../analysis/SlicePlane","../../../../core/has","../../../../core/Logger","../../../../core/mathUtils","../../../../core/screenUtils","../../../../core/libs/gl-matrix-2/math/mat4","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/Extent","../../../../geometry/Point","../../../../geometry/projectionUtils","../../../../geometry/support/Axis","../../../../chunks/boundedPlane","../../../../geometry/support/plane","../../../../geometry/support/ray","../../../../geometry/support/vector","../../../../geometry/support/vectorStacks","./settings","./sliceToolConfig","../support/projectionUtils","../../interactive/manipulatorUtils","../../interactive/visualElements/LineVisualElement","../../interactive/visualElements/SlicePlaneVisualElement","../../support/RenderCoordsHelper","../../support/geometryUtils/ray","../../webgl-engine/lib/Material","../../../interactive/interfaces"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v,P,b,E,S,C,w,T){"use strict";function D(t,i,n,s,r,o){const l=a.dot(t,i),c=f.sv3d.get(),h=f.sv3d.get();switch(s===e.SliceOrientation.HORIZONTAL_OR_VERTICAL?Math.abs(l)>x.verticalDotThreshold?e.SliceOrientation.HORIZONTAL:e.SliceOrientation.VERTICAL:s){case e.SliceOrientation.VERTICAL:{const e=Math.abs(l)<=x.smallAngleDotThreshold?t:n.viewUp;a.cross(c,e,i),a.copy(h,i);break}case e.SliceOrientation.HORIZONTAL:a.cross(c,n.viewUp,i),a.cross(h,i,c);break;case e.SliceOrientation.TILTED:{const e=Math.abs(l)<=x.smallAngleDotThreshold?i:n.viewUp;a.cross(c,e,t),a.cross(h,t,c);break}}const u=a.cross(f.sv3d.get(),c,h);a.dot(u,n.viewForward)>0&&a.scale(h,h,-1),a.normalize(r,c),a.normalize(o,h)}function I(e,t,i){const n=t.worldUpAtPosition(e.origin,f.sv3d.get()),s=e.basis1,r=k(e,n),o=Math.round(r/Y)*Y;return d.rotate(e,o-r,s,i)}var A;function M(e,t){switch(t){case A.POSITIVE_X:return{basis:e.basis1,direction:1,position:a.add(f.sv3d.get(),e.origin,e.basis1),edge:t};case A.POSITIVE_Y:return{basis:e.basis2,direction:1,position:a.add(f.sv3d.get(),e.origin,e.basis2),edge:t};case A.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:a.subtract(f.sv3d.get(),e.origin,e.basis1),edge:t};case A.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:a.subtract(f.sv3d.get(),e.origin,e.basis2),edge:t}}}function N(e,t,i){const n=i.projectToRenderScreen(a.add(f.sv3d.get(),e,t),r.castRenderScreenPointArray3(f.sv3d.get())),s=i.projectToRenderScreen(a.subtract(f.sv3d.get(),e,t),r.castRenderScreenPointArray3(f.sv3d.get()));return a.squaredLength(a.subtract(n,n,s))}function R(e){const t=a.length(e.basis1),i=a.length(e.basis2);return x.resizeHandleEdgePaddingFrac*Math.min(t,i)}function O(e){return R(e)}function G(e){return 0!==e.direction[0]&&0!==e.direction[1]}function k(e,t){return _.angleAroundAxis(t,e.basis2,e.basis1)+Y}function V(e,t){if(null==e?.position)return null;const i=v.applyProjectionAndElevationAlignment(e.position,t.spatialReference,t.elevationProvider);if(null==i)return null;const n=S.RenderCoordsHelper.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),s=e.width*n,r=e.height*n;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:r}}function F(e,t,i,r=d.create()){if(null==e)return null;const o=function(e,t,i,r,o,l,c=d.create()){return l.toRenderCoords(e,c.origin)?(l.worldBasisAtPosition(c.origin,m.Axis.X,c.basis1),l.worldBasisAtPosition(c.origin,m.Axis.Y,c.basis2),p.fromVectorsAndPoint(c.basis2,c.basis1,c.origin,c.plane),d.rotate(c,-s.deg2rad(t),d.normal(c),c),d.rotate(c,s.deg2rad(i),c.basis1,c),a.scale(c.basis1,c.basis1,r/2),a.scale(c.basis2,c.basis2,o/2),d.updateUnboundedPlane(c),c):(n.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,r);return i.tiltEnabled||null==o||I(o,t.renderCoordsHelper,o),o}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(A||(A={}));const L=T.ManipulatorStateCustomFlags.Custom1;var q,H;e.RotationAxis=void 0,(q=e.RotationAxis||(e.RotationAxis={}))[q.HEADING=1]="HEADING",q[q.TILT=2]="TILT",e.SliceOrientation=void 0,(H=e.SliceOrientation||(e.SliceOrientation={}))[H.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",H[H.HORIZONTAL=1]="HORIZONTAL",H[H.VERTICAL=2]="VERTICAL",H[H.TILTED=3]="TILTED";const U=T.ManipulatorStateCustomFlags.Custom2,z=g.create(),Y=Math.PI/2,B=T.ManipulatorStateCustomFlags.Custom1,X=T.ManipulatorStateCustomFlags.Custom2;e.DidPointerMoveRecentlyFlag=L,e.IsShiftEdgeOnScreenFlag=U,e.calculateBoundedPlaneTranslateRotate=function(e,t){return P.calculateTranslateRotateFromBases(e.basis1,e.basis2,e.origin,t)},e.calculateDiagonalResizeHandleScale=O,e.calculatePlaneHalfSize=function(e,t){return x.initialPlaneHalfSizeViewProportion*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)},e.createGridVisualElement=function(e){return new E.SlicePlaneVisualElement({view:e,attached:!1,backgroundColor:y.planeColor,gridColor:y.getGridColor(e.effectiveTheme),gridWidth:4,renderOccluded:w.RenderOccludedFlag.OccludeAndTransparent,isDecoration:!0})},e.createOutlineVisualElement=function(e){return new b.LineVisualElement({view:e,attached:!1,color:y.getOutlineColor(e.effectiveTheme),width:x.planeOutlineWidth,renderOccluded:w.RenderOccludedFlag.OccludeAndTransparent,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]],isDecoration:!0})},e.createPlane=function(e,t,i,n,s,r,o,l){return D(t,o.worldUpAtPosition(e,f.sv3d.get()),s,r,l.basis1,l.basis2),a.scale(l.basis1,l.basis1,i),a.scale(l.basis2,l.basis2,n),a.copy(l.origin,e),p.fromVectorsAndPoint(l.basis2,l.basis1,l.origin,l.plane),l},e.createRotatePlane=function(t,i,n,s){const r=i.worldUpAtPosition(t.origin,f.sv3d.get()),o=f.sv3d.get();switch(n){case e.RotationAxis.HEADING:a.copy(o,r);break;case e.RotationAxis.TILT:a.copy(o,t.basis1)}return p.fromPositionAndNormal(t.origin,o,s)},e.createShiftPlane=function(e,t,i,n){const s=a.cross(f.sv3d.get(),t,i);return a.cross(s,s,t),p.fromPositionAndNormal(e,s,n)},e.forceHorizontalOrVertical=I,e.isDiagonalResizeHandle=G,e.isIBuildingSceneLayerView3D=function(e){return null!=("building-scene-3d"===e.type?e:null)},e.normalToBases=D,e.planeToExtent=function(e,t,i){if(null==e)return null;const n=e.origin,s=f.sv3d.get(),r=f.sv3d.get(),o=f.sv3d.get(),l=f.sv3d.get();let h,u,m,d,p,g;a.add(s,n,e.basis1),a.add(s,s,e.basis2),a.add(r,n,e.basis1),a.sub(r,r,e.basis2),a.sub(o,n,e.basis1),a.sub(o,o,e.basis2),a.sub(l,n,e.basis1),a.add(l,l,e.basis2);for(const e of[s,r,o,l]){const n=t.fromRenderCoords(e,e,i);if(null==n)return null;h=null==h?n[0]:Math.min(h,n[0]),u=null==u?n[0]:Math.max(u,n[0]),m=null==m?n[1]:Math.min(m,n[1]),d=null==d?n[1]:Math.max(d,n[1]),p=null==p?n[2]:Math.min(p,n[2]),g=null==g?n[2]:Math.max(g,n[2])}return new c({xmin:h,xmax:u,ymin:m,ymax:d,zmin:p,zmax:g,spatialReference:i})},e.planeToShape=function(e,i,n,r=new t){if(null==e)return null;const{renderCoordsHelper:o}=i,l=o.fromRenderCoords(e.origin,new h({spatialReference:i.spatialReference}));if(null==l)return null;const c=u.tryProjectWithZConversion(l,n);if(null==c)return null;r.position=c;const m=2*a.length(e.basis1),d=2*a.length(e.basis2),p=S.RenderCoordsHelper.renderUnitScaleFactor(i.spatialReference,n);r.width=m*p,r.height=d*p;const g=o.worldUpAtPosition(e.origin,f.sv3d.get());return r.tilt=s.rad2deg(k(e,g)),r.heading=o.headingAtPosition(e.origin,e.basis1)-90,r},e.projectAndElevationAlignShape=V,e.projectedShapeToPlane=F,e.resizeNormal=B,e.resizeOutlineOnly=X,e.resizePlane=function(e,t,i,n,s,r){const o=a.copy(f.sv3d.get(),s.origin);a.add(o,o,a.scale(f.sv3d.get(),s.basis1,e.direction[0]<0?1:-1)),a.add(o,o,a.scale(f.sv3d.get(),s.basis2,e.direction[1]<0?1:-1));const l=a.length(s.basis1),c=a.length(s.basis2),h=a.subtract(f.sv3d.get(),i,o),u=a.subtract(f.sv3d.get(),t,o);let m=0,p=0;if(G(e)){const t=O(s),i=O(r);m=l-.5*e.direction[0]*a.dot(s.basis1,u)/l,p=c-.5*e.direction[1]*a.dot(s.basis2,u)/c;const n=i/t;m*=n,p*=n}const g=m+.5*e.direction[0]*a.dot(s.basis1,h)/l,_=p+.5*e.direction[1]*a.dot(s.basis2,h)/c,y=a.scale(f.sv3d.get(),s.basis1,g/l),v=a.scale(f.sv3d.get(),s.basis2,_/c);(g<=0||N(r.origin,y,n)<=x.planeMinBasisScreenLen2)&&a.copy(y,r.basis1),(_<=0||N(r.origin,v,n)<=x.planeMinBasisScreenLen2)&&a.copy(v,r.basis2);const P=a.copy(f.sv3d.get(),o);return a.add(P,P,a.scale(f.sv3d.get(),y,e.direction[0]<0?-1:1)),a.add(P,P,a.scale(f.sv3d.get(),v,e.direction[1]<0?-1:1)),d.fromValues(P,y,v,r)},e.shapeToPlane=function(e,t,i,n=d.create()){const s=V(e,t);return null==s?null:F(s,t,i,n)},e.updateResizeHandle=function(e,t,i,n){const s=a.length(n.basis1),r=a.length(n.basis2),l=R(n),c=O(n),h=a.set(f.sv3d.get(),0,0,0);a.add(h,a.scale(f.sv3d.get(),n.basis1,t.direction[0]),a.scale(f.sv3d.get(),n.basis2,t.direction[1])),a.add(h,n.origin,h);let u=0,m=1;if(G(t))1===t.direction[0]&&-1===t.direction[1]?u=Y:1===t.direction[0]&&1===t.direction[1]?u=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(u=3*Math.PI/2),m=c;else{const e=0!==t.direction[0]?1:2;u=1===e?Y:0,m=(1===e?r:s)-l}const d=o.fromZRotation(f.sm4d.get(),u);o.scale(d,d,a.set(f.sv3d.get(),m,m,m)),o.multiply(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=h},e.updateRotateHeadingHandle=function(e,t,i,n){const s=n.worldUpAtPosition(i.origin,f.sv3d.get()),r=M(i,A.POSITIVE_X),a=o.fromZRotation(f.sm4d.get(),r.edge*Math.PI/2);o.rotateX(a,a,-k(i,s)),o.multiply(a,t,a),a[12]=0,a[13]=0,a[14]=0,e.modelTransform=a,e.renderLocation=r.position},e.updateRotateTiltHandle=function(e,t,i){const n=M(i,A.POSITIVE_Y),s=o.fromZRotation(f.sm4d.get(),n.edge*Math.PI/2);o.rotateX(s,s,Y),o.multiply(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=n.position},e.updateShiftRestartHandle=function(e,t,i,n){const s=M(i,A.NEGATIVE_X),c=f.sm4d.get();o.rotateZ(c,t,s.edge*Math.PI/2);const h=a.normalize(f.sv3d.get(),s.basis);let u=a.scale(f.sv3d.get(),h,s.direction*n.computeScreenPixelSizeAt(s.position)*x.shiftRestartOffsetDistance);a.add(u,u,s.position);const m=n.projectToRenderScreen(u,r.castRenderScreenPointArray3(f.sv3d.get())),p=function(e,t){const[i,n,s,r]=e.viewport,o=Math.min(s,r)/16;let a=!0;return t[0]<i+o?(t[0]=i+o,a=!1):t[0]>i+s-o&&(t[0]=i+s-o,a=!1),t[1]<n+o?(t[1]=n+o,a=!1):t[1]>n+r-o&&(t[1]=n+r-o,a=!1),a}(n,m);C.fromRender(n,m,z),a.normalize(z.direction,z.direction);const g=f.sv3d.get();!p&&d.intersectRay(i,z,g)&&(u=g),c[12]=0,c[13]=0,c[14]=0,e.modelTransform=c,e.renderLocation=l.clone(u),p?e.state|=U:e.state&=~U},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/analysis/SlicePlane":function(){define(["../chunks/tslib.es6","../core/Clonable","../core/Cyclical","../core/JSONSupport","../core/maybe","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../core/accessorSupport/ensureType","../geometry/Point"],(function(e,t,i,n,s,r,o,a,l,c,h,u){"use strict";let m=class extends(t.ClonableMixin(n)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&this.width===e.width&&this.height===e.height&&s.equalsMaybe(this.position,e.position)}};return e.__decorate([r.property({type:["plane"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],m.prototype,"type",void 0),e.__decorate([r.property({type:u,json:{write:{isRequired:!0}}})],m.prototype,"position",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),o.cast((e=>i.cyclicalDegrees.normalize(h.ensureNumber(e),0,!0)))],m.prototype,"heading",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),o.cast((e=>i.cyclicalDegrees.normalize(h.ensureNumber(e),0,!0)))],m.prototype,"tilt",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],m.prototype,"width",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],m.prototype,"height",void 0),m=e.__decorate([c.subclass("esri.analysis.SlicePlane")],m),m}))},"esri/views/3d/analysis/Slice/settings":function(){define(["exports","../../../../core/colorUtils","../../../../core/libs/gl-matrix-2/factories/vec4f64"],(function(e,t,i){"use strict";const n=i.fromValues(0,0,0,.04);e.getGridColor=function({accentColor:e}){return t.multiplyOpacityToUnitRGBA(e,.5)},e.getOutlineColor=function({accentColor:e}){return t.multiplyOpacityToUnitRGBA(e,.7)},e.planeColor=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/analysis/Slice/sliceToolConfig":function(){define(["exports","../../../../core/has","../../../../core/mathUtils"],(function(e,t,i){"use strict";const n=t("mac")?"Meta":"Control",s=Math.cos(i.deg2rad(45)),r=Math.cos(i.deg2rad(5));e.displayFocusMultiplier=2,e.forceHorizontalModifier=n,e.forceVerticalModifier="Shift",e.initialDepthOffsetFrac=.02,e.initialPlaneHalfSizeViewProportion=.4,e.planeMinBasisScreenLen2=1600,e.planeOutlineWidth=1,e.planePreviewOutlineWidth=2,e.pointerMoveTimerMs=2500,e.previewFadeDotThreshold=.95,e.previewFadeDurationSeconds=.3,e.resizeHandleCornerInputRadius=6,e.resizeHandleCornerWidth=4,e.resizeHandleEdgeInputRadius=4,e.resizeHandleEdgePaddingFrac=.3,e.resizeHandleEdgeWidth=1,e.shiftRestartArrowLength=48,e.shiftRestartArrowOutlineWidth=2.25,e.shiftRestartOffsetDistance=40,e.shiftRestartTipFocusMultiplier=1.15,e.shiftRestartTipLength=22.5,e.shiftRestartTipRadius=11,e.shiftRestartTubeFocusMultiplier=1.15,e.shiftRestartTubeRadius=3,e.smallAngleDotThreshold=r,e.verticalDotThreshold=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/analysis/support/projectionUtils":function(){define(["exports","../../../../geometry/projectionUtils","../../support/ElevationProvider"],(function(e,t,i){"use strict";e.applyProjectionAndElevationAlignment=function(e,n,s,r=!1){const o=t.tryProjectWithZConversion(e,n);return null==o?null:(o.hasZ&&!r||null==s||(o.z=i.getElevationAtPoint(s,o)??0),o)},e.logFailedGeometryProjectionError=function(e,t,i){i.warnOnce(`Failed to project analysis geometry (id: '${e.id}'), projection from spatial reference (wkid: '${t.wkid}') to view spatial reference is not supported. Projection may be possible after calling projection.load().`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/LineVisualElement":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","./Object3DVisualElement","../../support/engineContent/line","../../webgl-engine/lib/Material","../../webgl-engine/materials/RibbonLineMaterial"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";class h extends o.Object3DVisualElement{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._hasExternalMaterial=null!=t,this._material=t??new c.RibbonLineMaterial({width:1,color:r.fromValues(1,0,1,1),stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerWidth:1,hasPolygonOffset:!1,renderOccluded:l.RenderOccludedFlag.OccludeAndTransparent,isDecoration:!!e.isDecoration,writeDepth:!0}),this.applyProperties(e)}setGeometryFromPoint(e,t=1e3){const i=s.create();this.view.renderCoordsHelper.toRenderCoords(e,i)&&this.setGeometryFromRenderSpacePoint(i,t)}setGeometryFromRenderSpacePoint(e,t=1e3){this.geometry=[[[e[0]-t,e[1],e[2]],[e[0]+t,e[1],e[2]]],[[e[0],e[1]-t,e[2]],[e[0],e[1]+t,e[2]]],[[e[0],e[1],e[2]-t],[e[0],e[1],e[2]+t]]]}setGeometryFromExtent(e){const t=this.view.spatialReference,i=s.create(),r=s.create(),o=100,a=[];n.set(i,e[0],e[1],o),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),n.set(i,e[2],e[1],o),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),n.set(i,e[2],e[3],o),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),n.set(i,e[0],e[3],o),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),n.set(i,e[0],e[1],o),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),n.set(i,e[0],e[1],o),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),this.geometry=[a]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],i=e.origin,n=e.basis1,r=e.basis2,o=.5,a=s.create(),l=s.create(),c=s.create(),h=s.create();a[0]=i[0]-n[0]*o-r[0]*o,a[1]=i[1]-n[1]*o-r[1]*o,a[2]=i[2]-n[2]*o-r[2]*o,l[0]=i[0]-n[0]*o+r[0]*o,l[1]=i[1]-n[1]*o+r[1]*o,l[2]=i[2]-n[2]*o+r[2]*o,c[0]=i[0]+n[0]*o+r[0]*o,c[1]=i[1]+n[1]*o+r[1]*o,c[2]=i[2]+n[2]*o+r[2]*o,h[0]=i[0]+n[0]*o-r[0]*o,h[1]=i[1]+n[1]*o-r[1]*o,h[2]=i[2]+n[2]*o-r[2]*o,t.push([a[0],a[1],a[2]]),t.push([l[0],l[1],l[2]]),t.push([c[0],c[1],c[2]]),t.push([h[0],h[1],h[2]]),t.push([a[0],a[1],a[2]]),this.geometry=[t]}setGeometryFromSegment(e){const i=e.endRenderSpace;this.transform=t.fromTranslation(u,i);const{points:n}=e.createRenderGeometry(i,this.view.renderCoordsHelper);this.geometry=[n]}setGeometryFromSegments(e,i=s.ZEROS){this.transform=t.fromTranslation(u,i),this.geometry=e.map((e=>e.createRenderGeometry(i,this.view.renderCoordsHelper).points))}getTransformedGeometry(){return null==this._geometry?null:this._geometry.map((e=>e.map((e=>n.transformMat4(s.create(),e,this.transform)))))}get renderOccluded(){return this._material.parameters.renderOccluded}set renderOccluded(e){this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._material.parameters.width}set width(e){this._material.setParameters({width:e})}get color(){return this._material.parameters.color}set color(e){const t=1===e[3];this._material.setParameters({color:e,writeDepth:t})}get innerWidth(){return this._material.parameters.innerWidth}set innerWidth(e){this._material.setParameters({innerWidth:e})}get innerColor(){return this._material.parameters.innerColor}set innerColor(e){this._material.setParameters({innerColor:e})}get stipplePattern(){return this._material.parameters.stipplePattern}set stipplePattern(e){null!=this._material&&this._material.setParameters({stipplePattern:e})}get stippleOffColor(){return this._material.parameters.stippleOffColor}set stippleOffColor(e){this._material.setParameters({stippleOffColor:e})}get stipplePreferContinuous(){return this._material.parameters.stipplePreferContinuous}set stipplePreferContinuous(e){this._material.setParameters({stipplePreferContinuous:e})}get falloff(){return this._material.parameters.falloff}set falloff(e){this._material.setParameters({falloff:e})}get polygonOffset(){return this._material.parameters.hasPolygonOffset}set polygonOffset(e){this._material.setParameters({hasPolygonOffset:e})}createExternalResources(){}destroyExternalResources(){}createGeometries(e){for(const t of a.lineStripsToParameters(this.geometry)){const i=a.createGeometry(this._material,t);e.addGeometry(i)}}forEachMaterial(e){this._hasExternalMaterial||e(this._material)}}const u=i.create();e.LineVisualElement=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/visualElements/SlicePlaneVisualElement":function(){define(["exports","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","./Object3DVisualElement","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Material","../../webgl-engine/materials/SlicePlaneMaterial"],(function(e,t,i,n,s,r,o){"use strict";class a extends n.Object3DVisualElement{constructor(e){super(e),this._material=null,this._renderOccluded=r.RenderOccludedFlag.OccludeAndTransparent,this._gridWidth=1,this._gridColor=i.fromValues(1,0,0,1),this._backgroundColor=i.fromValues(1,0,0,1),this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(e){this._gridWidth!==e&&(this._gridWidth=e,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(e){t.copy(this._gridColor,e),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){t.copy(this._backgroundColor,e),this._updateMaterial()}createExternalResources(){this._material=new o.SlicePlaneMaterial(this._materialParameters)}destroyExternalResources(){this._material=null}forEachMaterial(e){e(this._material)}createGeometries(e){if(null!=this._material){const t=s.createSquareGeometry(this._material);e.addGeometry(t)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this._material?.setParameters(this._materialParameters)}}e.SlicePlaneVisualElement=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/SlicePlaneMaterial":function(){define(["exports","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/attributes/InstancedDoubleConfiguration","../lib/GLMaterial","../lib/Material","../lib/RenderSlot","./DefaultBufferWriter","./DefaultLayouts","./TriangleMaterial","../shaders/SlicePlaneMaterialTechnique"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";class h extends l.TriangleMaterial{constructor(e){super(e,m),this.produces=new Map([[r.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>t.isColorOrColorEmission(e)]]),this._configuration=new i.InstancedDoubleConfiguration}get visible(){return!0}createGLMaterial(e){return new u(e)}createBufferWriter(){return new o.DefaultBufferWriter(a.PositionUvLayout)}getConfiguration(){return this._configuration}}class u extends n{constructor(e){super(e)}beginSlot(e){return this.getTechnique(c.SlicePlaneMaterialTechnique,e)}}class m extends c.SlicePlaneMaterialPassParameters{constructor(){super(...arguments),this.renderOccluded=s.RenderOccludedFlag.Occlude,this.isDecoration=!1}}e.Parameters=m,e.SlicePlaneMaterial=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/DefaultLayouts":function(){define(["exports","../../support/buffer/InterleavedLayout","../lib/VertexAttribute"],(function(e,t,i){"use strict";const n=t.newLayout().vec3f(i.VertexAttribute.POSITION),s=t.newLayout().vec3f(i.VertexAttribute.POSITION).vec2f16(i.VertexAttribute.UV0),r=t.newLayout().vec3f(i.VertexAttribute.POSITION).vec4u8(i.VertexAttribute.COLOR),o=t.newLayout().vec3f(i.VertexAttribute.POSITION).vec2f16(i.VertexAttribute.UV0).vec4u8(i.VertexAttribute.OLIDCOLOR),a=t.newLayout().vec3f(i.VertexAttribute.POSITION).vec2f(i.VertexAttribute.UV0),l=t.newLayout().vec3f(i.VertexAttribute.POSITION).vec2f(i.VertexAttribute.UV0).vec4u8(i.VertexAttribute.OLIDCOLOR);e.PositionColorLayout=r,e.PositionLayout=n,e.PositionUvLayout=s,e.PositionUvOlidLayout=o,e.PositionUvf32Layout=a,e.PositionUvf32OlidLayout=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/SlicePlaneMaterialTechnique":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/factories/vec4f64","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../../../../chunks/SlicePlaneMaterial.glsl","../../../webgl/enums","../../../webgl/NoParameters","../../../webgl/renderState"],(function(e,t,i,n,s,r,o,a,l){"use strict";class c extends a.NoParameters{constructor(){super(...arguments),this.backgroundColor=i.fromValues(1,0,0,.5),this.gridColor=i.fromValues(0,1,0,.5),this.gridWidth=4}}class h extends s.ShaderTechnique{constructor(t,i){super(t,i,new n.ReloadableShaderModule(r.SlicePlaneMaterial,(()=>new Promise(((t,i)=>e(["./SlicePlaneMaterial.glsl"],t,i))))))}initializePipeline(){return l.makePipelineState({blending:l.premultipliedAlpha,depthTest:{func:o.CompareFunction.LESS},colorWrite:l.defaultColorWrite})}}t.SlicePlaneMaterialPassParameters=c,t.SlicePlaneMaterialTechnique=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/SlicePlaneMaterial.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl","../views/3d/webgl-engine/core/shaderModules/Float4PassUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/lib/VertexAttribute","../views/webgl/ShaderBuilder"],(function(e,t,i,n,s,r,o){"use strict";function a(e){const a=new o.ShaderBuilder,{vertex:l,fragment:c,attributes:h,varyings:u}=a;return t.addProjViewLocalOrigin(l,e),h.add(r.VertexAttribute.POSITION,"vec3"),h.add(r.VertexAttribute.UV0,"vec2"),u.add("vUV","vec2"),l.main.add(s.glsl`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),c.uniforms.add(new i.Float4PassUniform("backgroundColor",(e=>e.backgroundColor)),new i.Float4PassUniform("gridColor",(e=>e.gridColor)),new n.FloatPassUniform("gridWidth",(e=>e.gridWidth))).main.add(s.glsl`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),a}const l=Object.freeze(Object.defineProperty({__proto__:null,build:a},Symbol.toStringTag,{value:"Module"}));e.SlicePlaneMaterial=l,e.build=a}))},"esri/views/3d/interactive/editingTools/transform/extentTransform/ExtentMove":function(){define(["exports","../../../../../../core/handleUtils","../../../../../../core/quantityUtils","../../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../geometry/support/vectorStacks","../../../../analysis/Slice/ShiftManipulator","../../../../analysis/Slice/sliceToolUtils","../../dragEventPipeline3D","../../ManipulatorType","../../manipulations/MoveXYObjectManipulation","../../../../../interactive/dragEventPipeline","../../../../../interactive/editGeometry/interfaces","../../../../../interactive/tooltip/infos/TranslateTooltipInfo","../../../../../interactive/tooltip/infos/TranslateZTooltipInfo","../../../../../support/euclideanLengthMeasurementUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_){"use strict";e.ExtentMove=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,t,i){this._tool=e,this._bounds=t,this._automaticLengthMeasurementUtils=i,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;const n=this._tool,s=n.view;this.moveXYObjectManipulation=new u.MoveXYObjectManipulation({view:s,tool:n,object:this._object}),n.addHandles(this._createMoveXYObjectDragPipeline()),this.moveZManipulator=new a.ShiftManipulator(s,a.OffsetMode.CENTER_ON_CALLOUT),this.moveZManipulator.state|=l.IsShiftEdgeOnScreenFlag,n.manipulators.add(this.moveZManipulator),n.addHandles(this._createMoveZDragPipeline()),n.addHandles(n.events.on("translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null})))}destroy(){this.moveXYObjectManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(e){this.moveXYObjectManipulation.forEachManipulator(e),e(this.moveZManipulator,h.ManipulatorType.TRANSLATE_Z)}updateManipulators(e,t){const i=this.moveZManipulator,r=n.rotateZ(o.sm4d.get(),e,Math.PI);r[12]=0,r[13]=0,r[14]=0,i.modelTransform=r,i.renderLocation=s.subtract(o.sv3d.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){const e=this._tool,t=this._moveXYTooltipInfo??=new p.TranslateTooltipInfo({sketchOptions:e.sketchOptions});if(this.moveXYObjectManipulation.dragging){const i=this._bounds,n=i.mapBoundsStart.origin,s=i.mapBounds.origin,{renderSpatialReference:r}=e.view;if(!r)return null;const o=this._automaticLengthMeasurementUtils.autoDistance2D(n,s,r);if(null==o)return null;t.distance=o}else t.distance=i.zeroMeters;return t}_computeMoveZTooltipInfo(){const e=this._tool,t=this._moveZTooltipInfo??=new g.TranslateZTooltipInfo({sketchOptions:e.sketchOptions});if(this.moveZManipulator.dragging){const i=this._bounds,n=i.mapBoundsStart.origin,s=i.mapBounds.origin,{renderSpatialReference:r}=e.view;if(!r)return null;const o=_.verticalSignedDistance(n,s,r);if(null==o)return null;t.distance=o}else t.distance=i.zeroMeters;return t}_createMoveXYObjectDragPipeline(){return this.moveXYObjectManipulation.createDragPipeline(((e,t,i)=>this._buildMoveDragPipeline(t,i)))}_createMoveZDragPipeline(){if(!this._operations)return t.makeHandle();const e=this._operations.data.spatialReference;return m.createManipulatorDragEventPipeline(this.moveZManipulator,((t,i,n)=>{const s=r.clone(t.renderLocation),o=i.next(c.screenToZConstrained(this._tool.view,s,e)).next(m.addScreenDelta());this._buildMoveDragPipeline(o,n)}))}_buildMoveDragPipeline(e,t){const{_tool:i,_object:n}=this;e.next((e=>("start"===e.action&&(i.inputState={type:"move"},this._bounds.backupMapBounds(),i.events.emit("translate-start",{object:n,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next(m.addMapDelta()).next(this._updateGeometry()).next((e=>{const t={object:n,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||(e.mapEnd.z??0)-(e.mapStart.z??0))&&i.events.emit("translate",t);break;case"end":i.inputState=null,i.events.emit("translate-stop",t)}return e})),t.next((()=>{null!=i.inputState&&i.events.emit("translate-stop",{object:n,dxScreen:0,dyScreen:0}),i.cancelDrag()}))}_updateGeometry(){const e=this._tool;return t=>{if(null==e.inputState||"move"!==e.inputState.type)return t;const i="start"===t.action?d.AccumulationBehavior.NEW_STEP:d.AccumulationBehavior.ACCUMULATE_STEPS;if(this._operations){const e=this._operations.move(t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i);this._bounds.updateMapBoundsFromOperation(e)}return t}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/analysis/Slice/ShiftManipulator":function(){define(["exports","../../../../Color","../../../../core/colorUtils","../../../../core/reactiveUtils","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/math/quat","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/vectorStacks","./sliceToolConfig","./sliceToolUtils","../../interactive/Manipulator3D","../../interactive/RenderObject","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Material","../../webgl-engine/materials/ColorMaterial","../../webgl-engine/materials/RibbonLineMaterial","../../../interactive/interfaces"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x){"use strict";var v;e.OffsetMode=void 0,(v=e.OffsetMode||(e.OffsetMode={}))[v.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",v[v.CENTER_ON_ARROW=1]="CENTER_ON_ARROW";class P extends m.Manipulator3D{constructor(e,s){const r=new y.RibbonLineMaterial({width:1,renderOccluded:_.RenderOccludedFlag.OccludeAndTransparent,isDecoration:!0}),o=new f.ColorMaterial({cullFace:p.CullFaceOptions.Back,renderOccluded:_.RenderOccludedFlag.Opaque,isDecoration:!0}),a=new f.ColorMaterial({cullFace:p.CullFaceOptions.Back,renderOccluded:_.RenderOccludedFlag.Opaque,isDecoration:!0}),l=new f.ColorMaterial({cullFace:p.CullFaceOptions.Back,renderOccluded:_.RenderOccludedFlag.Opaque,isDecoration:!0}),c=new f.ColorMaterial({writeDepth:!1,cullFace:p.CullFaceOptions.Front,renderOccluded:_.RenderOccludedFlag.Transparent,isDecoration:!0});super({view:e,...b({offsetMode:s,tubeMaterial:o,tipMaterial:a,capMaterial:l,outlineMaterial:c,calloutMaterial:r})}),this._themeHandle=n.watch((()=>e.effectiveTheme.accentColor),(e=>{const n=i.getContrast(e),s=t.toUnitRGBA(e),h=t.toUnitRGBA(n),u=t.toUnitRGBA(t.blendColors(n,e,.4)),m=t.toUnitRGBA(t.blendColors(n,e,.14));r.setParameters({color:s}),o.setParameters({color:m}),a.setParameters({color:h}),l.setParameters({color:u}),c.setParameters({color:s})}),n.initial)}destroy(){this._themeHandle.remove(),super.destroy()}}function b({offsetMode:t,tubeMaterial:i,tipMaterial:n,capMaterial:s,outlineMaterial:r,calloutMaterial:o}){const c=t===e.OffsetMode.CENTER_ON_CALLOUT?h.shiftRestartOffsetDistance:0,m=[l.fromValues(c,0,-24),l.fromValues(c,0,h.shiftRestartArrowLength/2)],p=function(e){const t=a.subtract(l.create(),e[e.length-1],e[e.length-2]);a.normalize(t,t),a.scale(t,t,h.shiftRestartTipLength),a.add(t,t,e[e.length-1]);{const i=a.subtract(l.create(),e[0],e[1]);return a.normalize(i,i),a.scale(i,i,h.shiftRestartTipLength),a.add(i,i,e[0]),[i,...e,t]}}(m),_=E({vertices:m,padding:0,materials:{tube:i,tip:n,cap:s}}),f=E({vertices:m,padding:h.shiftRestartArrowOutlineWidth,materials:{tube:r,tip:r,cap:r}}),y=g.createPolylineGeometry(o,[[c,0,0],[c-h.shiftRestartOffsetDistance,0,0]]),v=g.createPolylineGeometry(o,[[c,0,0],[c-h.shiftRestartOffsetDistance,0,0]]);return{renderObjects:[..._.normal.map((e=>new d.RenderObject(e,x.ManipulatorStateFlags.Unfocused|u.DidPointerMoveRecentlyFlag))),...f.normal.map((e=>new d.RenderObject(e,x.ManipulatorStateFlags.Unfocused|u.DidPointerMoveRecentlyFlag))),new d.RenderObject(y,x.ManipulatorStateFlags.Unfocused|u.DidPointerMoveRecentlyFlag|u.IsShiftEdgeOnScreenFlag),..._.focused.map((e=>new d.RenderObject(e,x.ManipulatorStateFlags.Focused|u.DidPointerMoveRecentlyFlag))),...f.focused.map((e=>new d.RenderObject(e,x.ManipulatorStateFlags.Focused|u.DidPointerMoveRecentlyFlag))),new d.RenderObject(v,x.ManipulatorStateFlags.Focused|u.DidPointerMoveRecentlyFlag|u.IsShiftEdgeOnScreenFlag)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[p]},collisionPriority:1,radius:h.shiftRestartTipRadius,state:u.DidPointerMoveRecentlyFlag}}function E({vertices:e,padding:t,materials:i}){const n=n=>{const u=e.slice(),m=a.subtract(c.sv3d.get(),u[0],u[1]);a.normalize(m,m);const d=a.subtract(c.sv3d.get(),u[u.length-1],u[u.length-2]);if(a.normalize(d,d),t>0){const e=a.scale(l.create(),d,-t);u[u.length-1]=a.add(e,e,u[u.length-1]);const i=a.scale(l.create(),m,-t);u[0]=a.add(i,i,u[0])}const p=n?h.shiftRestartTipFocusMultiplier:1,_=h.shiftRestartTipLength*p,f=h.shiftRestartTipRadius*p,y=s.identity(c.sm4d.get());if(t>0){const e=_/4,i=a.set(c.sv3d.get(),0,e,0),n=1+t/e;s.translate(y,y,i),s.scale(y,y,a.set(c.sv3d.get(),n,n,n)),s.translate(y,y,a.scale(i,i,-1/n))}const x=s.identity(r.create()),v=l.fromValues(0,1,0),P=s.fromQuat(r.create(),o.rotationTo(c.sq4d.get(),v,d));P[12]=u[u.length-1][0],P[13]=u[u.length-1][1],P[14]=u[u.length-1][2],s.multiply(P,P,y);const b=i.tube,E=function(e,t,i){const n=[];for(let t=0;t<12;t++){const i=t/12*2*Math.PI;n.push([Math.cos(i)*e,Math.sin(i)*e])}return g.createPathExtrusionGeometry(i,n,t,[],[],!1)}(h.shiftRestartTubeRadius*(n?h.shiftRestartTubeFocusMultiplier:1)+t,u,b);E.transformation=x;const S=[E],C=i.tip,w=g.createConeGeometry(C,_,f,24,!1,!1,!0);w.transformation=P,S.push(w);const T=i.cap,D=g.createConeGeometry(T,_,f,24,!1,!0,!1);D.transformation=P,S.push(D);const I=s.fromQuat(r.create(),o.rotationTo(c.sq4d.get(),v,m));return I[12]=u[0][0],I[13]=u[0][1],I[14]=u[0][2],s.multiply(I,I,y),S.push(w.instantiate({transformation:I})),S.push(D.instantiate({transformation:I})),S};return{normal:n(!1),focused:n(!0)}}e.ShiftManipulator=P,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/transform/extentTransform/ExtentRotate":function(){define(["exports","../../../../../../core/mathUtils","../../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../chunks/boundedPlane","../../../../../../geometry/support/plane","../../../../../../geometry/support/vectorStacks","../../../../analysis/images/Factory","../../../../analysis/Slice/RotateManipulator","../../../../analysis/Slice/sliceToolUtils","../../../manipulatorUtils","../../dragEventPipeline3D","../../ManipulatorType","../../../../support/geometryUtils/ray","../../../../../interactive/dragEventPipeline","../../../../../interactive/editGeometry/interfaces","../../../../../interactive/editGeometry/operations/UpdateVertices","../../../../../interactive/tooltip/infos/ExtentRotateTooltipInfo"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y){"use strict";e.ExtentRotate=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,t,i){this._tool=e,this._bounds=t,this._snapRotation=i,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;const n=this._tool,s=n.view,r=!s.stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this.rotateManipulator=new c.RotateManipulator(s,((e,t)=>l.getRotateHeadingTexture(s.stage.textures,{accentColor:e,contrastColor:t,preMultiplyAlpha:r}))),n.addHandles([this.rotateManipulator.events.on("grab-changed",(e=>this._onGrabChanged(e))),this._createRotateDragPipeline(this.rotateManipulator)]),n.manipulators.add(this.rotateManipulator),n.addHandles([n.events.on("rotate-start",(e=>this._startAngle=e.angle)),n.events.on("rotate",(e=>this._endAngle=e.angle)),n.events.on("rotate-stop",(()=>{this._startAngle=0,this._endAngle=0}))])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(e){e(this.rotateManipulator,d.ManipulatorType.ROTATE)}updateManipulators(e,t){const s=this._bounds.mapBounds.plane[2]<0?Math.PI:0,r=i.rotateX(a.sm4d.get(),e,s);r[12]=0,r[13]=0,r[14]=0,this.rotateManipulator.modelTransform=r,this.rotateManipulator.renderLocation=n.add(a.sv3d.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){const e=this._rotateTooltipInfo??=new y.ExtentRotateTooltipInfo({sketchOptions:this._tool.sketchOptions});return e.angle=this._startAngle-this._endAngle,e}_onGrabChanged({action:e,screenPoint:t}){const i=this._tool,n=this._bounds;if("start"!==e||!t)return;const s=h.createRotatePlane(n.displayBounds,i.view.renderCoordsHelper,h.RotationAxis.HEADING,o.create()),r=p.fromScreenNormalized(i.view.state.camera,t);o.intersectRay(s,r,a.sv3d.get())&&(n.backupMapBounds(),i.inputState={type:"rotate",rotatePlane:s})}_createRotateDragPipeline(e){const{_tool:i,_object:n}=this;return g.createManipulatorDragEventPipeline(e,((e,s,r)=>{const o=i.inputState;null!=o&&(s.next((e=>("start"===e.action&&i.events.emit("rotate-start",{object:n,angle:0}),e))).next(m.screenToRenderPlane(i.view,o.rotatePlane)).next(this._renderPlaneToAngle()).next(...this._snapRotation()).next(this._updateGeometry()).next((e=>{const s={object:n,angle:t.rad2deg(e.rotateAngle)};switch(e.action){case"start":case"update":i.events.emit("rotate",s);break;case"end":i.inputState=null,i.events.emit("rotate-stop",s)}return e})),r.next((()=>{null!=i.inputState&&i.events.emit("rotate-stop",{object:n,angle:0}),i.cancelDrag()})))}))}_renderPlaneToAngle(){return e=>{const t=u.calculateInputRotationTransform(e.renderStart,e.renderEnd,this._bounds.displayBounds.origin,o.getNormal(e.plane));return{...e,rotateAngle:t}}}_updateGeometry(){const e=this._bounds;return t=>{const i=n.copy(s.create(),e.mapBoundsStart.origin),o="start"===t.action?_.AccumulationBehavior.NEW_STEP:_.AccumulationBehavior.ACCUMULATE_STEPS;if(this._operations){const n=this._operations.rotate(i,t.rotateAngle,o,f.AccumulationType.REPLACE);r.copy(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(n)}return t}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/analysis/images/Factory":function(){define(["exports","./generateTextures","./heading-rotate-svg","./tilt-rotate-svg","../../webgl-engine/lib/Texture"],(function(e,t,i,n,s){"use strict";e.getRotateHeadingTexture=function(e,n){const{accentColor:r,contrastColor:o,preMultiplyAlpha:a}=n;return e.fromData(`heading-rotate:[accent:${r},contrast:${o},size:64]`,(()=>new s.Texture(t.generateStyledTexture(i,{accentColor:r,contrastColor:o,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:a})))},e.getTiltRotateTexture=function(e,i){const{accentColor:r,contrastColor:o,preMultiplyAlpha:a}=i;return e.fromData(`tilt-rotate:[accent:${r},contrast:${o},size:64]`,(()=>new s.Texture(t.generateStyledTexture(n,{accentColor:r,contrastColor:o,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:a})))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/analysis/images/generateTextures":function(){define(["exports"],(function(e){"use strict";e.generateStyledTexture=function(e,t){return function(e,t){const i=new Image(t,t);return i.src=e,i}(function(e){const t=(new XMLSerializer).serializeToString(e);return`data:image/svg+xml;base64,${btoa(t)}`}(function(e,{accentColor:t,contrastColor:i}){const n=t.toHex(),s=t.a,r=i.toHex(),o=i.a,a=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem("theme-style");return a&&(a.innerHTML=`\n      .contrast-fill { fill: ${r}; fill-opacity: ${o}; }\n      .contrast-stroke { stroke: ${r}; stroke-opacity: ${o};  }\n      .accent-fill { fill: ${n}; fill-opacity: ${s}; }\n      .accent-stroke { stroke: ${n}; stroke-opacity:  ${s}; }`),e}(function(e){const t=e.split(",")[1],i=atob(t);return(new DOMParser).parseFromString(i,"image/svg+xml")}(e),t)),t.size)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/analysis/images/heading-rotate-svg":function(){define((function(){"use strict";return"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg=="}))},"esri/views/3d/analysis/images/tilt-rotate-svg":function(){define((function(){"use strict";return"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxjaXJjbGUgY3g9IjM5LjQ3OCIgY3k9IjMuMDc4IiByPSIyOCIgY2xhc3M9ImFjY2VudC1maWxsIiB0cmFuc2Zvcm09InJvdGF0ZSg0MC41NDIpIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI1IiBkPSJtNy4wNzQgMzAuMDUzIDI5LjM5NyAxMS45ODUtMy42NzMtMzMuNDkzIiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSIyLjk5NiIgZD0iTTI0LjUwNCAyMy4yMDdhMTEuOTggMTEuOTggMCAwIDAtOS44IDcuNTA3IiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIGNvbnRyYXN0LWZpbGwiLz48cGF0aCBkPSJtMjkuODE4IDIyLjgwOC02LjE4NCA0LjYtLjU0MS04LjM2NHoiIGNsYXNzPSJjb250cmFzdC1maWxsIi8+PC9zdmc+"}))},"esri/views/3d/analysis/Slice/RotateManipulator":function(){define(["exports","../../../../Color","../../../../core/colorUtils","../../../../core/maybe","../../../../core/reactiveUtils","./sliceToolUtils","../../interactive/Manipulator3D","../../interactive/manipulatorUtils","../../interactive/RenderObject","../../webgl-engine/lib/Attribute","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Material","../../webgl-engine/lib/VertexAttribute","../../webgl-engine/materials/ImageMaterial","../../webgl-engine/materials/RibbonLineMaterial","../../../interactive/interfaces"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_){"use strict";class f extends o.Manipulator3D{constructor(e,n){const r=i.multiplyOpacity(e.effectiveTheme.accentColor,.5),o=i.getContrast(e.effectiveTheme.accentColor),l=n(r,o),c=new p.ImageMaterial({draped:!1,texture:l.texture,writeDepth:!1,renderOccluded:m.RenderOccludedFlag.Opaque,isDecoration:!0}),h=a.rotateManipulatorDefaults.calloutWidth,u=new g.RibbonLineMaterial({width:h,renderOccluded:m.RenderOccludedFlag.OccludeAndTransparent,isDecoration:!0});super({view:e,...y({imageMaterial:c,calloutMaterial:u})}),this._material=c,this._textureHandle=l,this._themeHandle=s.watch((()=>e.effectiveTheme.accentColor),(e=>{const s=i.multiplyOpacity(e,.5),r=i.getContrast(e),o=this._textureHandle;this._textureHandle=n(s,r),c.setParameters({texture:this._textureHandle.texture}),o?.release(),u.setParameters({color:t.toUnitRGBA(e)})}),s.initial)}destroy(){this._textureHandle=n.releaseMaybe(this._textureHandle),this._themeHandle.remove(),this._material.dispose(),super.destroy()}}function y({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:i,calloutLength:n,discRadius:s}=a.rotateManipulatorDefaults,o=s*i,m=(e,t)=>{const i=[0,1,2,2,3,0];return new h.Geometry(t,[[d.VertexAttribute.POSITION,new c.Attribute([n-e,-e,0,n+e,-e,0,n+e,e,0,n-e,e,0],i,3,!0)],[d.VertexAttribute.UV0,new c.Attribute([0,0,1,0,1,1,0,1],i,2,!0)]])},p=u.createPolylineGeometry(t,[[0,0,0],[n-s,0,0]]),g=u.createPolylineGeometry(t,[[0,0,0],[n-o,0,0]]),f=r.DidPointerMoveRecentlyFlag;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[n,0,0]},focusMultiplier:i,radius:s,renderObjects:[new l.RenderObject(m(s,e),_.ManipulatorStateFlags.Unfocused|f),new l.RenderObject(p,_.ManipulatorStateFlags.Unfocused|f),new l.RenderObject(m(o,e),_.ManipulatorStateFlags.Focused|f),new l.RenderObject(g,_.ManipulatorStateFlags.Focused|f)],state:f}}e.RotateManipulator=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/ImageMaterial":function(){define(["exports","../../../../geometry/support/buffer/BufferView","../core/shaderLibrary/ShaderOutput","../lib/basicInterfaces","../lib/GLMaterial","../lib/ITexture","../lib/Material","../lib/OrderIndependentTransparency","../lib/RenderSlot","../lib/Util","../lib/VertexAttribute","./DefaultBufferWriter","./DefaultLayouts","./TriangleMaterial","./internal/bufferWriterUtils","../shaders/ImageMaterialTechnique","../shaders/ImageMaterialTechniqueConfiguration"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_){"use strict";class f extends d.TriangleMaterial{constructor(e){super(e,v),this.vertexAttributeLocations=g.vertexAttributeLocations,this.supportsEdges=!0,this.produces=new Map([[l.RenderSlot.OPAQUE_MATERIAL,e=>i.isHighlightOrOID(e)],[l.RenderSlot.TRANSPARENT_MATERIAL,e=>i.isColor(e)&&this.parameters.writeDepth],[l.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>i.isColor(e)&&!this.parameters.writeDepth],[l.RenderSlot.DRAPED_MATERIAL,e=>i.isColor(e)||i.isHighlightOrOID(e)]]),this._configuration=new _.ImageMaterialTechniqueConfiguration(e.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<a.OITPolygonOffsetLimit,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}get visible(){return!0}createGLMaterial(e){return new y(e)}createBufferWriter(){let e=m.PositionUvLayout;return this.parameters.perspectiveInterpolation&&(e=e.clone().f32(h.VertexAttribute.PERSPECTIVEDIVIDE)),new x(e)}}class y extends s{constructor(e){super({...e,...e.material.parameters}),this.parameters=e;const t=this._material.parameters.texture;r.isUpdatableTexture(t)&&e.textures.updater.add(t)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.texture)}beginSlot(e){return this.getTechnique(g.ImageMaterialTechnique,e)}}class x extends u.DefaultBufferWriter{write(e,i,n,s,r,o){for(const s of this.vertexBufferLayout.fields.keys()){const a=n.get(s);if(a)if(s===h.VertexAttribute.PERSPECTIVEDIVIDE){c.assert(1===a.size);const e=r.getField(s,t.BufferViewFloat);e&&p.writeBufferFloat(a,e,o)}else p.writeDefaultAttribute(s,a,e,i,r,o)}return null}}class v extends o.MaterialParameters{constructor(e,t){super(),this.texture=e,this.draped=t,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=n.CullFaceOptions.None,this.opacity=1,this.perspectiveInterpolation=!1}get glTexture(){return this.texture.glTexture}}e.ImageMaterial=f,e.Parameters=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/ImageMaterialTechnique":function(){define(["require","exports","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../lib/OITPass","../lib/OrderIndependentTransparency","../lib/StencilUtils","../lib/VertexAttribute","../../../../chunks/ImageMaterial.glsl","../../../webgl/renderState"],(function(e,t,i,n,s,r,o,a,l,c,h){"use strict";class u extends s.ShaderTechnique{constructor(t,i){super(t,i,new n.ReloadableShaderModule(c.ImageMaterial,(()=>new Promise(((t,i)=>e(["./ImageMaterial.glsl"],t,i))))),m)}_getPipelineState(e,t){const{oitPass:n,output:s,hasOccludees:l,cullFace:c}=e,u=n===r.OITPass.NONE;return h.makePipelineState({blending:i.isColorOrColorEmission(s)?u?h.premultipliedAlpha:o.oitBlending(n):null,culling:h.cullingParams(c),depthTest:{func:o.oitDepthTest(n)},depthWrite:o.depthWrite(e),drawBuffers:o.getDrawBuffers(n,s),colorWrite:h.defaultColorWrite,stencilWrite:l?a.stencilWriteMaskOn:null,stencilTest:l?t?a.stencilToolMaskBaseParams:a.stencilBaseAllZerosParams:null,polygonOffset:o.oitPolygonOffset(e)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipeline:super.getPipeline()}}const m=new Map([[l.VertexAttribute.POSITION,0],[l.VertexAttribute.UV0,2],[l.VertexAttribute.PERSPECTIVEDIVIDE,3]]);t.ImageMaterialTechnique=u,t.vertexAttributeLocations=m,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/ImageMaterial.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput","../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl","../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform","../views/3d/webgl-engine/lib/VertexAttribute","../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl","../views/webgl/NoParameters","../views/webgl/ShaderBuilder"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p){"use strict";class g extends d.NoParameters{}function _(e){const d=new p.ShaderBuilder,{vertex:g,fragment:_,varyings:f}=d,{output:y,perspectiveInterpolation:x}=e;return a.addProjViewLocalOrigin(g,e),d.include(n.Transform,e),d.include(r.terrainDepthTest,e),d.fragment.include(i.SliceDraw,e),d.include(s.ObjectAndLayerIdColor,e),d.include(m.outputColorHighlightOID,e),d.attributes.add(u.VertexAttribute.POSITION,"vec3"),d.attributes.add(u.VertexAttribute.UV0,"vec2"),x&&d.attributes.add(u.VertexAttribute.PERSPECTIVEDIVIDE,"float"),g.main.add(c.glsl`
    vpos = position;
    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    vTexCoord = uv0;
    gl_Position = transformPosition(proj, view, vpos);
    ${c.If(x,"gl_Position *= perspectiveDivide;")}`),f.add("vpos","vec3",{invariant:!0}),f.add("vTexCoord","vec2"),_.include(o.ColorConversion),_.uniforms.add(new l.FloatPassUniform("opacity",(e=>e.opacity)),new h.Texture2DPassUniform("tex",(e=>e.glTexture))).main.add(c.glsl`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${c.If(y===t.ShaderOutput.ObjectAndLayerIdColor,"fragColor = vec4(0, 0, 0, 1); return;")}
    vec4 finalColor = texture(tex, vTexCoord) * opacity;
    outputColorHighlightOID(finalColor, vpos, finalColor.rgb);`),d}const f=Object.freeze(Object.defineProperty({__proto__:null,ImageMaterialPassParameters:g,build:_},Symbol.toStringTag,{value:"Module"}));e.ImageMaterial=f,e.ImageMaterialPassParameters=g,e.build=_}))},"esri/views/3d/webgl-engine/shaders/ImageMaterialTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../core/shaderLibrary/output/Emissions.glsl","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/basicInterfaces","../materials/DefaultTechniqueConfiguration"],(function(e,t,i,n,s,r,o){"use strict";class a extends o.DefaultTechniqueConfiguration{constructor(e){super(),this.draped=e,this.cullFace=r.CullFaceOptions.None,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=i.TextureCoordinateType.None,this.emissionSource=n.EmissionSource.None,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1,this.snowCover=!1}}t.__decorate([s.parameter({count:r.CullFaceOptions.COUNT})],a.prototype,"cullFace",void 0),t.__decorate([s.parameter()],a.prototype,"enableOffset",void 0),t.__decorate([s.parameter()],a.prototype,"writeDepth",void 0),t.__decorate([s.parameter()],a.prototype,"hasOccludees",void 0),t.__decorate([s.parameter()],a.prototype,"terrainDepthTest",void 0),t.__decorate([s.parameter()],a.prototype,"cullAboveTerrain",void 0),t.__decorate([s.parameter()],a.prototype,"perspectiveInterpolation",void 0),e.ImageMaterialTechniqueConfiguration=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/ExtentRotateTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./SketchTooltipInfo"],(function(e,t,i,n,s,r,o,a){"use strict";e.ExtentRotateTooltipInfo=class extends a.SketchTooltipInfo{constructor(e){super(e),this.type="extent-rotate",this.angle=0}},t.__decorate([i.property()],e.ExtentRotateTooltipInfo.prototype,"type",void 0),t.__decorate([i.property()],e.ExtentRotateTooltipInfo.prototype,"angle",void 0),e.ExtentRotateTooltipInfo=t.__decorate([o.subclass("esri.views.interactive.tooltip.infos.ExtentRotateTooltipInfo")],e.ExtentRotateTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/transform/extentTransform/ExtentScale":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../chunks/boundedPlane","../../../../../../geometry/support/plane","../../../../../../geometry/support/vectorStacks","../../../../analysis/Slice/ResizeManipulator","../../../../analysis/Slice/sliceToolUtils","../../dragEventPipeline3D","../../ManipulatorType","./extentUtils","../../../../support/geometryUtils/ray","../../../../../interactive/dragEventPipeline","../../../../../interactive/editGeometry/interfaces","../../../../../interactive/editGeometry/operations/UpdateVertices","../../../../../interactive/tooltip/infos/ExtentScaleTooltipInfo"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f){"use strict";const y=1e-6;e.ExtentScale=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}get zMax(){if(!this._zMaxDirty||!this._operations)return this._zMax;const e=this._operations.data;if(e.geometry.hasZ){const t=e.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(const i of e.components)for(const e of i.vertices){const i=t.getZ(e.pos)??0;this._zMax=Math.max(i,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(e,t,i){this._tool=e,this._bounds=t,this._preserveAspectRatioStep=i,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._displayBoundsStart=r.create(),this._displayBoundsMarginStart=0,this._zMax=0,this._zMaxDirty=!0;const n=this._tool,s=n.view;this.resizeManipulators=this._resizeHandles.map((e=>{const t=new l.ResizeManipulator(s,e);return n.addHandles([t.events.on("grab-changed",(e=>this._onGrabChanged(e))),this._createResizeDragPipeline(t,e)]),t})),n.manipulators.addMany(this.resizeManipulators),this._operations&&n.addHandles(this._operations.data.on("change",(()=>{"resize"!==n.inputState?.type&&(this._zMaxDirty=!0)})))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){this.resizeManipulators.forEach((t=>e(t,u.ManipulatorType.SCALE)))}updateManipulators(e,t){this.resizeManipulators.forEach(((i,n)=>{c.updateResizeHandle(i,this._resizeHandles[n],e,t)}))}getUpdatedTooltipInfo(){if(!this.resizeManipulators.some((e=>e.focused)))return null;const e=this._tooltipInfo??=new f.ExtentScaleTooltipInfo({sketchOptions:this._tool.sketchOptions}),t=m.mapPlaneAutoSize2D(this._bounds.mapBounds,this.zMax,this._bounds.spatialReference,this._tool.automaticLengthMeasurementUtils);return t&&(e.xSize=t.xSize,e.ySize=t.ySize),this.resizeManipulators.some((e=>e.dragging))||(e.xScale=1,e.yScale=1),e}_onGrabChanged({action:e,screenPoint:t}){const i=this._tool,n=this._bounds;if("start"!==e||!t)return;const s=d.fromScreenNormalized(i.view.state.camera,t);o.intersectRay(n.displayBounds.plane,s,a.sv3d.get())&&(n.backupMapBounds(),r.copy(n.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=n.displayBoundsMargin,i.inputState={type:"resize"})}_createResizeDragPipeline(e,t){const{_tool:i,_object:n}=this;return p.createManipulatorDragEventPipeline(e,((e,s,r)=>{null!=i.inputState&&(s.next((e=>("start"===e.action&&i.events.emit("scale-start",{object:n,xScale:1,yScale:1}),{...e,handle:t}))).next(h.screenToRenderPlane(i.view,this._displayBoundsStart.plane)).next(this._renderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._updateGeometry()).next((e=>{const t=this._tooltipInfo;t&&(t.xScale=e.factor1,t.yScale=e.factor2);const s={object:n,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":i.events.emit("scale",s);break;case"end":i.inputState=null,i.events.emit("scale-stop",s)}return e})),r.next((()=>{null!=i.inputState&&i.events.emit("scale-stop",{object:n,xScale:1,yScale:1}),i.cancelDrag()})))}))}_renderPlaneToFactors(){const e=this._bounds;return t=>{const i=this._displayBoundsStart,s=t.handle.direction,r=e.displayBoundsMargin,o=this._displayBoundsMarginStart,l=n.copy(a.sv3d.get(),i.origin);n.scaleAndAdd(l,l,i.basis1,-s[0]),n.scaleAndAdd(l,l,i.basis2,-s[1]);const h=n.subtract(a.sv3d.get(),t.renderEnd,l),u=n.subtract(a.sv3d.get(),t.renderStart,l),m=c.isDiagonalResizeHandle(t.handle),d=c.calculateDiagonalResizeHandleScale(i),p=c.calculateDiagonalResizeHandleScale(e.displayBounds)/d,g=(e,t)=>{if(0===e)return 1;let i=n.length(t),s=.5*e*n.dot(t,h)/i;const a=s<0?-1:1;m&&(s+=(i-.5*e*n.dot(t,u)/i)*a*p);const l=i<1.5*o?1:y;return i=Math.max(i-o,y),a>0&&(s-=r),a*Math.max(a*(s/i),l)};return{...t,factor1:g(s[0],i.basis1),factor2:g(s[1],i.basis2)}}}_updateGeometry(){const e=this._bounds;return o=>{const a=n.copy(s.create(),e.mapBoundsStart.origin);n.scaleAndAdd(a,a,e.mapBoundsStart.basis1,-o.handle.direction[0]),n.scaleAndAdd(a,a,e.mapBoundsStart.basis2,-o.handle.direction[1]);const l=t.set(i.create(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);t.normalize(l,l);const c="start"===o.action?g.AccumulationBehavior.NEW_STEP:g.AccumulationBehavior.ACCUMULATE_STEPS;if(this._operations){const t=this._operations.scale(a,l,o.factor1,o.factor2,c,_.AccumulationType.REPLACE);r.copy(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(t)}return o}}},e.scaleEpsilon=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/analysis/Slice/ResizeManipulator":function(){define(["exports","../../../../Color","../../../../core/reactiveUtils","../../../../core/libs/gl-matrix-2/factories/vec3f64","./sliceToolConfig","./sliceToolUtils","../../interactive/Manipulator3D","../../interactive/manipulatorUtils","../../interactive/RenderObject","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Material","../../webgl-engine/materials/RibbonLineMaterial","../../../interactive/interfaces"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m){"use strict";class d extends o.Manipulator3D{constructor(e,n){const o=r.isDiagonalResizeHandle(n),l=o?s.resizeHandleCornerWidth:s.resizeHandleEdgeWidth,c=l*s.displayFocusMultiplier,m=s.resizeHandleEdgeWidth,d={renderOccluded:h.RenderOccludedFlag.OccludeAndTransparent,isDecoration:!0},g=new u.RibbonLineMaterial({...d,width:l}),_=new u.RibbonLineMaterial({...d,width:c}),f=new u.RibbonLineMaterial({...d,width:m});super({view:e,...a.worldScaledManipulatorSettings,...p({isCorner:o,unfocusedMaterial:g,focusedMaterial:_,outlineMaterial:f})}),this._themeHandle=i.watch((()=>e.effectiveTheme.accentColor),(e=>{const i=t.toUnitRGBA(e);g.setParameters({color:i}),_.setParameters({color:i}),f.setParameters({color:i})}),i.initial)}destroy(){this._themeHandle.remove(),super.destroy()}}function p({isCorner:e,unfocusedMaterial:t,focusedMaterial:i,outlineMaterial:o}){const a=e?[n.fromValues(1,0,0),n.fromValues(0,0,0),n.fromValues(0,1,0)]:[n.fromValues(1,0,0),n.fromValues(-1,0,0)];return{renderObjects:[new l.RenderObject(c.createPolylineGeometry(t,a),m.ManipulatorStateFlags.Unfocused|r.resizeNormal),new l.RenderObject(c.createPolylineGeometry(i,a),m.ManipulatorStateFlags.Focused|r.resizeNormal),new l.RenderObject(c.createPolylineGeometry(o,a),r.resizeOutlineOnly)],collisionType:{type:"line",paths:[a]},radius:e?s.resizeHandleCornerInputRadius:s.resizeHandleEdgeInputRadius,state:r.resizeNormal}}e.ResizeManipulator=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/transform/extentTransform/extentUtils":function(){define(["exports","../../../../../../core/reactiveUtils","../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../chunks/boundedPlane","../../../../../../geometry/support/plane","../../../../../../geometry/support/vectorStacks","../../geometryUtils","../../manipulatedObjectUtils","../../../../layers/graphics/elevationAlignmentUtils","../../../../layers/graphics/ElevationContext","../../../../../interactive/editGeometry/support/editPlaneUtils","../../../../../support/extentUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d){"use strict";const p=s.create(),g=s.create(),_=s.create(),f=s.create();e.TransformBounds=class{constructor(e,i){this._tool=e,this.mapBounds=r.create(),this.mapBoundsStart=r.create(),this.displayBounds=r.create(),e.addHandles(t.on((()=>e.object),"modified-externally",(()=>this._resetMapBounds()),{onListenerAdd:()=>this._resetMapBounds()})),this._onDisplayBoundsChanged=i}get displayBoundsMargin(){const{view:e,object:t}=this._tool,i=c.manipulatedObjectGeometry(t),n=e.pointsOfInterest?.centerOnSurfaceFrequent.location??i?.extent?.center;return n?10*e.pixelSizeAt(n):0}backupMapBounds(){r.copy(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged?.()}updateMapBoundsFromOperation(e){m.apply(e,this.mapBounds),this.updateDisplayBounds()}updateMapBoundsFromOperationInverse(e){m.applyInverse(e,this.mapBounds),this.updateDisplayBounds()}_resetMapBounds(){this._calculateMapBounds(),this.updateDisplayBounds()}_calculateMapBounds(){const{view:e,attachmentOrigin:t,object:n}=this._tool,s=n.operations?.data;if(!s)return;const r=s.geometry;this.spatialReference=r.spatialReference;const o=l.mainAxis(r);i.scale(o,o,-1);const a=80*(t?e.pixelSizeAt(t,r.spatialReference):0),c=s.coordinateHelper.hasZ()&&"on-the-ground"!==n.elevationInfo.mode;m.calculateOrientedBounds(o,s,a,this.mapBounds,c)}_calculateDisplayBounds(){const{view:e,attachmentOrigin:t}=this._tool,i=t?.z??h.evaluateElevationAlignmentAtPoint(this.mapBounds.origin,e.elevationProvider,u.ElevationContext.fromElevationInfo(this._tool.object.elevationInfo),e.renderCoordsHelper);!function(e,t,i,s,l=0,c){c||(c=r.create());const h=a.sv3d.get();n.add(h,e.origin,e.basis1),n.add(h,h,e.basis2),i.toRenderCoords(h,s,h);const u=a.sv3d.get();n.add(u,e.origin,e.basis1),n.subtract(u,u,e.basis2),i.toRenderCoords(u,s,u);const m=a.sv3d.get();n.subtract(m,e.origin,e.basis1),n.subtract(m,m,e.basis2),i.toRenderCoords(m,s,m);const d=a.sv3d.get();n.subtract(d,e.origin,e.basis1),n.add(d,d,e.basis2),i.toRenderCoords(d,s,d),n.add(c.origin,h,u),n.add(c.origin,c.origin,m),n.add(c.origin,c.origin,d),n.scale(c.origin,c.origin,.25),n.subtract(h,h,c.origin),n.subtract(u,u,c.origin),n.subtract(m,m,c.origin),n.subtract(d,d,c.origin);const p=n.lerp(a.sv3d.get(),h,u,.5),g=n.lerp(a.sv3d.get(),m,d,.5);n.scale(g,g,-1),n.lerp(c.basis1,p,g,.5);const _=n.lerp(a.sv3d.get(),h,d,.5),f=n.lerp(a.sv3d.get(),u,m,.5);n.scale(f,f,-1),n.lerp(c.basis2,_,f,.5);const y=n.cross(a.sv3d.get(),c.basis1,c.basis2);n.cross(c.basis2,y,c.basis1),n.normalize(c.basis1,c.basis1);const x=Math.max(Math.abs(n.dot(c.basis1,h)),Math.abs(n.dot(c.basis1,u)),Math.abs(n.dot(c.basis1,m)),Math.abs(n.dot(c.basis1,d)));n.normalize(c.basis2,c.basis2);const v=Math.max(Math.abs(n.dot(c.basis2,h)),Math.abs(n.dot(c.basis2,u)),Math.abs(n.dot(c.basis2,m)),Math.abs(n.dot(c.basis2,d)));n.scale(c.basis1,c.basis1,x+l),n.scale(c.basis2,c.basis2,v+l);const P=n.copy(a.sv3d.get(),e.origin);P[2]=t,i.toRenderCoords(P,s,P),o.fromPositionAndNormal(P,y,c.plane),o.projectPoint(c.plane,c.origin,c.origin),r.updateUnboundedPlane(c)}(this.mapBounds,i??0,e.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,this.displayBounds)}},e.mapPlaneAutoSize2D=function(e,t,i,s){return n.subtract(f,n.subtract(f,e.origin,e.basis1),e.basis2),n.scaleAndAdd(_,f,e.basis1,2),n.scaleAndAdd(g,_,e.basis2,2),n.scaleAndAdd(p,f,e.basis2,2),f[2]=_[2]=g[2]=p[2]=t,d.autoSize2D({topLeft:p,topRight:g,bottomRight:_,bottomLeft:f,spatialReference:i,automaticLengthMeasurementUtils:s})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/editGeometry/support/editPlaneUtils":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/boundedPlane","../../../../geometry/support/vectorStacks","../operations/MoveVertex","../operations/RotateVertex","../operations/ScaleVertex","../operations/UpdateVertices"],(function(e,t,i,n,s,r,o,a,l,c){"use strict";function h(e,r,h){if(e instanceof c.UpdateVertices){if(e.operation instanceof o.MoveVertex)return function(e,t,r=!1){const o=r?-1:1,a=n.fromValues(o*e.dx,o*e.dy,o*e.dz);i.add(t.origin,t.origin,a),s.updateUnboundedPlane(t)}(e.operation,r,h),!0;if(e.operation instanceof a.RotateVertex)return function(e,t,r=!1){const o=r?-e.angle:e.angle;i.rotateZ(t.basis1,t.basis1,n.ZEROS,o),i.rotateZ(t.basis2,t.basis2,n.ZEROS,o),s.updateUnboundedPlane(t)}(e.operation,r,h),!0;if(e.operation instanceof l.ScaleVertex)return function(e,n,r=!1){const o=r?1/e.factor1:e.factor1,a=r?1/e.factor2:e.factor2;i.scale(n.basis1,n.basis1,o),i.scale(n.basis2,n.basis2,a),t.projectAndScale(n.origin,n.origin,e.origin,e.axis1,o),t.projectAndScale(n.origin,n.origin,e.origin,e.axis2,a),s.updateUnboundedPlane(n)}(e.operation,r,h),!0}return!1}e.apply=function(e,t){return h(e,t,!1)},e.applyInverse=function(e,t){return h(e,t,!0)},e.calculateOrientedBounds=function(e,n,o,a,l=!1){a||(a=s.create());const c=t.set(r.sv2d.get(),e[1],-e[0]),h=t.set(r.sv2d.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),u=t.set(r.sv2d.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),m=r.sv2d.get(),d=n.allVertices;d.forEach((({pos:i})=>{t.set(m,t.dot(e,i),t.dot(c,i)),t.min(h,h,m),t.max(u,u,m)}));const p=1e-6,g=t.set(r.sv2d.get(),u[0]-h[0]<p?o/2:0,u[1]-h[1]<p?o/2:0);t.subtract(h,h,g),t.add(u,u,g);const _=l?d.reduce(((e,t)=>e+(t.pos[2]??0)),0)/d.length:0;return t.scale(a.basis1,e,(u[0]-h[0])/2),t.scale(a.basis2,c,(u[1]-h[1])/2),i.set(a.origin,h[0]*e[0]+h[1]*c[0],h[0]*e[1]+h[1]*c[1],_),i.add(a.origin,a.origin,a.basis1),i.add(a.origin,a.origin,a.basis2),s.updateUnboundedPlane(a),a},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/extentUtils":function(){define(["exports","../../core/quantityUtils"],(function(e,t){"use strict";e.autoSize2D=function({topLeft:e,topRight:i,bottomRight:n,bottomLeft:s,spatialReference:r,automaticLengthMeasurementUtils:{autoDistance2D:o}}){const a=t.max(o(s,n,r),o(e,i,r));if(null==a)return null;const l=t.max(o(n,i,r),o(s,e,r));return null==l?null:{xSize:a,ySize:l}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/tooltip/infos/ExtentScaleTooltipInfo":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/quantityUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./SketchTooltipInfo"],(function(e,t,i,n,s,r,o,a,l){"use strict";e.ExtentScaleTooltipInfo=class extends l.SketchTooltipInfo{constructor(e){super(e),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=i.zeroMeters,this.ySize=i.zeroMeters}},t.__decorate([n.property()],e.ExtentScaleTooltipInfo.prototype,"type",void 0),t.__decorate([n.property()],e.ExtentScaleTooltipInfo.prototype,"xScale",void 0),t.__decorate([n.property()],e.ExtentScaleTooltipInfo.prototype,"yScale",void 0),t.__decorate([n.property()],e.ExtentScaleTooltipInfo.prototype,"xSize",void 0),t.__decorate([n.property()],e.ExtentScaleTooltipInfo.prototype,"ySize",void 0),e.ExtentScaleTooltipInfo=t.__decorate([a.subclass("esri.views.interactive.tooltip.infos.ExtentScaleTooltipInfo")],e.ExtentScaleTooltipInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/transform/extentTransform/PreserveAspectRatio":function(){define(["exports","../../../../../../core/has","../../../../analysis/Slice/sliceToolUtils","../../../../../interactive/dragEventPipeline"],(function(e,t,i,n){"use strict";function s(e){const t=i.isDiagonalResizeHandle(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}e.PreserveAspectRatio=class{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t={...this._lastDragEvent,action:"update"};e&&s(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;const e=new n.EventPipeline;return this._next=e,[e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&s(e),e),e]}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/transform/extentTransform/SnapRotation":function(){define(["exports","../../../../../../core/mathUtils","../../../../../interactive/dragEventPipeline"],(function(e,t,i){"use strict";e.SnapRotation=class{constructor(){this._lastDragEvent=null,this._next=null,this.incrementRadians=t.deg2rad(5),this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t={...this._lastDragEvent,action:"update"};e&&this._adjustRotation(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;const e=new i.EventPipeline;return this._next=e,[e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustRotation(e),e),e]}_adjustRotation(e){e.rotateAngle=Math.round(e.rotateAngle/this.incrementRadians)*this.incrementRadians}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/ManipulatedObject3DGraphic":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Evented","../../../../core/maybe","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../core/support/UpdatingHandles","../../../../layers/graphics/sources/interfaces","../../../../support/elevationInfoUtils","../manipulatorUtils","./undoRecords","../../layers/graphics/GraphicState","../../../interactive/GraphicManipulator","../../../interactive/editGeometry/EditGeometryOperations"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f){"use strict";const y=Symbol();e.ManipulatedObject3DGraphic=class extends i.EventedAccessor{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}get elevationInfo(){return m.getGraphicEffectiveElevationInfo(this.graphic)}get visible(){return this._graphicState.displaying}get isDraped(){return this._graphicState.isDraped}get origin(){return d.getGraphicAttachmentOrigin(this.view,this.graphic)}constructor(e){super(e),this._updatingHandles=new h.UpdatingHandles}destroy(){this._operations=n.destroyMaybe(this._operations),this._updatingHandles.destroy()}initialize(){this._graphicState=new g.GraphicState({graphic:this.graphic}),this._graphicState.on("changed",(()=>this.emit("committed"))),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add((()=>this.graphic.geometry),(e=>{const t=this._operations?.data.geometry;if(e!==t){if(!e||"multipoint"===e?.type||"extent"===e?.type)return n.destroyMaybe(this._operations),this.removeHandles(y),void(this._operations=null);if(this._operations?.trySetGeometry(e))this.emit("modified-externally");else{n.destroyMaybe(this._operations),this.removeHandles(y);const t=f.EditGeometryOperations.fromGeometry(e,this.view.state.viewingMode);this._operations=t,this.addHandles(t.data.on("change",(()=>this.graphic.geometry=t.data.geometry)),y)}}}),s.syncAndInitial))}createManipulator(e){return new _.GraphicManipulator({view:this.view,graphic:this.graphic,...e})}maskOccludee(){return this.view.maskOccludee(this.graphic)}endInteraction(){const e=this.graphic.geometry;"mesh"===e?.type&&this.graphic.notifyMeshTransformChanged({action:u.MeshTransformUpdateAction.UpdateFastLocalOrigin})}toMap(e){return this.view.toMap(e,{include:[this.graphic]})}createUndoRecord(){const{graphic:{geometry:e}}=this;return p.createGraphicGeometryUndoRecord(e)}},t.__decorate([r.property({constructOnly:!0})],e.ManipulatedObject3DGraphic.prototype,"view",void 0),t.__decorate([r.property({constructOnly:!0})],e.ManipulatedObject3DGraphic.prototype,"graphic",void 0),t.__decorate([r.property()],e.ManipulatedObject3DGraphic.prototype,"_operations",void 0),t.__decorate([r.property()],e.ManipulatedObject3DGraphic.prototype,"operations",null),t.__decorate([r.property()],e.ManipulatedObject3DGraphic.prototype,"updating",null),e.ManipulatedObject3DGraphic=t.__decorate([c.subclass("esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic")],e.ManipulatedObject3DGraphic),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/interactive/editingTools/undoRecords":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/meshVertexSpaceUtils"],(function(e,t,i){"use strict";e.createGraphicGeometryUndoRecord=function(e){return null!=e&&"mesh"===e.type?function(e){return i.isRelativeVertexSpace(e.vertexSpace)?function(e,i,n){let s=i?.clone(),r=t.clone(n.origin),o=null,a=null;return{undo:()=>{o=e.transform?.clone(),a=t.clone(n.origin),e.transform=s,e.vertexSpace.origin=r},redo:()=>{s=e.transform?.clone(),r=t.clone(n.origin),e.transform=o,e.vertexSpace.origin=a}}}(e,e.transform,e.vertexSpace):function(e){let t,i=e.vertexAttributes.clonePositional();return{undo:()=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i},redo:()=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t}}}(e)}(e):function(e){let t=e,i=null;return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/GraphicManipulator":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/Evented","../../core/reactiveUtils","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/libs/gl-matrix-2/math/vec2","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/projectionUtils","../../geometry/projection/projectPointToVector","../../support/elevationInfoUtils","../../symbols/support/defaults","../../symbols/support/ElevationInfo","./support/utils","../support/drapedUtils"],(function(e,t,i,n,s,r,o,a,l,c,h,u,m,d,p,g,_,f,y,x,v){"use strict";e.GraphicManipulator=class extends i{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const{layer:e}=this.graphic,t=e&&"elevationInfo"in e?e.elevationInfo:null,i=_.getGraphicEffectiveElevationMode(this.graphic),n=t?t.offset:0;return new y({mode:i,offset:n})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new n.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if(null==i)return null;const n=this._get("focusedSymbol"),s=null!=n?n:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,s):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=s.watch((()=>this.graphic?.symbol),(e=>{null!=e&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&null!=this.focusedSymbol&&(this.graphic.symbol=this.focusedSymbol))}),s.sync)}detachSymbolChanged(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,n){if(null==(n=n||f.getDefaultSymbol2D(i)))return null;let s=this._circleCollisionCache;if("point"===i.type&&"cim"===n.type&&"CIMPointSymbol"===n.data.symbol?.type&&n.data.symbol.symbolLayers){const{offsetX:s,offsetY:o,size:a}=x.getSymbolInfo(n),l=r.screenPointObjectToArray(t,b),c=a/2,h=e.toScreen(i),m=h.x+s,d=h.y+o;return u.squaredDistance(l,[m,d])<c*c?1:null}if("point"!==i.type||"simple-marker"!==n.type)return v.intersectsDrapedGeometry(t,i,e)?1:null;if(null==s||!s.originalPoint.equals(i)){const t=i,o=e.spatialReference;if(p.canProjectWithoutEngine(t.spatialReference,o)){const e=p.project(t,o);s={originalPoint:t.clone(),mapPoint:e,radiusPx:r.pt2px(n.size)},this._circleCollisionCache=s}}if(null!=s){const i=r.screenPointObjectToArray(t,b),o=e.toScreen?.(s.mapPoint);if(!o)return null;const a=s.radiusPx,l=o.x+r.pt2px(n.xoffset),c=o.y-r.pt2px(n.yoffset);return u.squaredDistance(i,[l,c])<a*a?1:null}return null}_intersectDistance3D(e,t,i){const n=e.toMap(t,{include:[i]});return n&&g.projectPointToVector(n,P,e.renderSpatialReference)?m.distance(P,e.state.camera.eye):null}},t.__decorate([o.property({constructOnly:!0,nonNullable:!0})],e.GraphicManipulator.prototype,"graphic",null),t.__decorate([o.property()],e.GraphicManipulator.prototype,"elevationInfo",null),t.__decorate([o.property({constructOnly:!0,nonNullable:!0})],e.GraphicManipulator.prototype,"view",void 0),t.__decorate([o.property({value:null})],e.GraphicManipulator.prototype,"focusedSymbol",null),t.__decorate([o.property({constructOnly:!0})],e.GraphicManipulator.prototype,"layer",void 0),t.__decorate([o.property()],e.GraphicManipulator.prototype,"interactive",void 0),t.__decorate([o.property()],e.GraphicManipulator.prototype,"selectable",void 0),t.__decorate([o.property()],e.GraphicManipulator.prototype,"grabbable",void 0),t.__decorate([o.property({value:!1})],e.GraphicManipulator.prototype,"grabbing",null),t.__decorate([o.property()],e.GraphicManipulator.prototype,"dragging",void 0),t.__decorate([o.property()],e.GraphicManipulator.prototype,"hovering",null),t.__decorate([o.property({value:!1})],e.GraphicManipulator.prototype,"selected",null),t.__decorate([o.property()],e.GraphicManipulator.prototype,"cursor",void 0),e.GraphicManipulator=t.__decorate([h.subclass("esri.views.interactive.GraphicManipulator")],e.GraphicManipulator);const P=d.create(),b=r.createScreenPointArray();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/interactive/support/utils":function(){define(["exports","../../../core/screenUtils"],(function(e,t){"use strict";e.getSymbolInfo=function(e){let i=0,n=0,s=0;return e?("cim"===e.type&&e.data.symbol&&"symbolLayers"in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map((e=>{"CIMVectorMarker"===e.type&&e.anchorPoint&&(Math.abs(e.anchorPoint.x)>i&&(i=e.anchorPoint.x),Math.abs(e.anchorPoint.y)>n&&(n=e.anchorPoint.y),null!=e.size&&e.size>s&&(s=e.size))})),i=t.pt2px(i),n=t.pt2px(n),s=t.pt2px(s),{offsetX:i,offsetY:n,size:s}):{offsetX:i,offsetY:n,size:s}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/drapedUtils":function(){define(["exports","../../core/unitUtils","../../geometry/Extent","../../renderers/support/clickToleranceUtils"],(function(e,t,i,n){"use strict";function s(e,n,s,r=new i){let o=0;if("2d"===s.type)o=n*(s.resolution??0);else if("3d"===s.type){const i=s.overlayPixelSizeInMapUnits(e),r=s.basemapSpatialReference;o=null==r||r.equals(s.spatialReference)?n*i:t.getMetersPerUnitForSR(r)/t.getMetersPerUnitForSR(s.spatialReference)}const a=e.x-o,l=e.y-o,c=e.x+o,h=e.y+o,{spatialReference:u}=s;return r.xmin=Math.min(a,c),r.ymin=Math.min(l,h),r.xmax=Math.max(a,c),r.ymax=Math.max(l,h),r.spatialReference=u,r}const r=new i;e.createQueryGeometry=s,e.intersectsDrapedGeometry=function(e,t,i){const o=i.toMap(e);return null!=o&&s(o,n.calculateTolerance(),i,r).intersects(t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],(function(e){"use strict";function t(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function i(e,t){return"number"==typeof e?e:e?.stops?.length?function(e){let t=0,i=0;for(let n=0;n<e.length;n++){const s=e[n].size;"number"==typeof s&&(t+=s,i++)}return t/i}(e.stops):t}e.calculateTolerance=function(e){const n=e?.renderer,s=e?.pointerType,r="touch"===s?9:6;if(!n)return r;const o="visualVariables"in n?function(e,t){if(!t)return e;const n=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:n,minSize:s}=t;return(i(n,e)+i(s,e))/2}));let s=0;const r=n.length;if(0===r)return e;for(let e=0;e<r;e++)s+=n[e];const o=Math.floor(s/r);return Math.max(o,e)}(r,n.visualVariables):r;if("simple"===n.type)return t(o,n.symbol);if("unique-value"===n.type){let e=o;return n.uniqueValueInfos?.forEach((i=>{e=t(e,i.symbol)})),e}if("class-breaks"===n.type){let e=o;return n.classBreakInfos.forEach((i=>{e=t(e,i.symbol)})),e}return"dot-density"===n.type||n.type,o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"*noref":1}}),define(["exports","./editingTools/draw/DrawGraphicTool3D","./editingTools/move/MoveTool3D","./editingTools/reshape/ReshapeTool3D","./editingTools/transform/TransformTool3D","./editingTools/transform/ExtentTransformTool","./editingTools/ManipulatedObject3DGraphic"],(function(e,t,i,n,s,r,o){"use strict";Object.defineProperty(e,"DrawGraphicTool3D",{enumerable:!0,get:()=>t.DrawGraphicTool3D}),Object.defineProperty(e,"MoveTool3D",{enumerable:!0,get:()=>i.MoveTool3D}),Object.defineProperty(e,"ReshapeTool3D",{enumerable:!0,get:()=>n.ReshapeTool3D}),Object.defineProperty(e,"TransformTool3D",{enumerable:!0,get:()=>s.TransformTool3D}),Object.defineProperty(e,"ExtentTransformTool",{enumerable:!0,get:()=>r.ExtentTransformTool}),Object.defineProperty(e,"ManipulatedObject3DGraphic",{enumerable:!0,get:()=>o.ManipulatedObject3DGraphic}),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));