// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/handleUtils","../../../../core/quantityUtils","../../../../core/reactiveUtils","./manipulatedObjectUtils","../../../interactive/editGeometry/interfaces","../../../interactive/tooltip/tooltipCommonUtils","../../../support/euclideanLengthMeasurementUtils"],(function(t,e,o,n,i,a,r,c){"use strict";function s(t,{activeTooltipInfo:e,callbacks:o}){if(!e)return;o.onBeforeUpdate();const n=i.manipulatedObjectGeometry(t);switch(n?.type){case"mesh":l(e,n.origin,t,o),"orientation"in e&&"scale"in e&&r.updateMeshTransformFromTooltipInfo(e,n,o);break;case"point":l(e,n,t,o)}}function l(t,e,o,n){const{dx:i,dy:c,dz:s}=r.getXYZDeltasFromTooltipInfo(t,e);0===i&&0===c&&0===s||(n.onMoveStart(),o.operations?.move(i,c,s,a.AccumulationBehavior.NEW_STEP),n.onMove(i,c,s),n.onMoveStop())}function u(t,e){const o=i.manipulatedObjectGeometry(e),n=o?.type;if(!t||!o||"mesh"!==n&&"point"!==n)return;const a="mesh"===n,c=a?o.origin:o;t.setLocationFromPoint(c),p(t,c,e),"transform-mesh"===t.type&&a&&r.updateTooltipInfoFromMeshTransform(t,o),t.clearInputValues()}function p(t,e,o){t.elevation.actual=c.elevationFromPoint(e),t.elevation.visible=!!o.operations?.data.coordinateHelper.hasZ(),t.elevation.readOnly=!1,t.elevation.showAsZ=!0}function f(t){switch(t){case"integer":case"long":return 0;default:return null}}t.connectTooltipToManipulatedObject=function(t,a,c){function l(){const t=c(),e=t.sketchOptions.tooltips.effectiveEnabled?t.activeTooltipInfo:null;return{...t,activeTooltipInfo:e}}let p=!1;function d(t){p||(p=!0,t(),p=!1)}function m({activeTooltipInfo:e,sketchOptions:n,scaleRotateTransform:i}){d((()=>{e&&(e.sketchOptions=n,u(e,a),function(t,e){if("transform-point"!==t?.type)return;if(!e)return t.orientation.actual=void 0,t.size.actual=void 0,t.orientation.visible=!1,void(t.size.visible=!1);const n=e.mode,{size:i,orientationClockwise:a}=e.adapter,{visualVariables:r}=t.sketchOptions.tooltips,c=r?.rotation,s=null!=a&&(null==n||"rotate"===n);t.orientation.actual=s?o.createAngle(a,"radians","geographic"):void 0,t.orientation.precision=f(c?.valueType),t.orientation.visible=s;const l=r?.size,u=null!=i&&(null==n||"scale"===n);t.size.actual=u?o.createLength(i,l?.unit??"meters"):void 0,t.size.precision=f(l?.valueType),t.size.visible=u}(e,i)),t.info=e}))}return e.handlesGroup([n.watch(l,m,n.syncAndInitial),n.watch((()=>{const t=l(),{activeTooltipInfo:e}=t;if(e)return{context:t,activeTooltipInfo:e,key:e.key,geometry:i.manipulatedObjectGeometry(a)}}),((t,e)=>{t&&e&&e.key!==t.key&&d((()=>s(a,t.context)))}),n.sync),a.on("committed",(()=>{queueMicrotask((()=>m(l())))})),r.connectPasteEvent(t,{onBeforePaste:()=>{p=!0},onAfterPaste:()=>{s(a,l()),p=!1}})])},t.updateElevationFromPoint=p,t.updateTooltipInfoFromManipulatedObject=u,t.updateXYZFromTooltipInfo=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));