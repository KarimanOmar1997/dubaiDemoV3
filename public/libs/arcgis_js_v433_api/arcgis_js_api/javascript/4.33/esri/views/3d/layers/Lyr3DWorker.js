// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../layers/ILyr3DWasmPerSceneView","../../../libs/lyr3d/Lyr3DModule"],(function(s,t,e){"use strict";let r,n;function i(){return n?Promise.resolve():(r||(r=e.loadLyr3DWorkerWASM().then((s=>{n=s,n.initialize_lyr3d_worker_wasm(),r=null}))),r)}s.destroyWasm=function(){n&&(n.uninitialize_lyr3d_worker_wasm(),n=null)},s.initialize=i,s.process=async function(s){await i();const e={status:t.Lyr3DWasmWorkerOutputStatus.Failed,error:"",jobDescJson:"",data:new Uint8Array(0),missingInputUrls:[]};if(s.inputs.length<1)return{result:e,transferList:[]};const r={ptrs:[],sizes:[]};for(const t of s.inputs){const s=n._malloc(t.byteLength);new Uint8Array(n.HEAPU8.buffer,s,t.byteLength).set(new Uint8Array(t)),r.ptrs.push(s),r.sizes.push(t.byteLength)}const o=n.process(s.jobDescJson,s.id,r,s.isMissingResourceCase);e.status=o.status,e.missingInputUrls=o.missingInputUrls.slice();const u=o.status===t.Lyr3DWasmWorkerOutputStatus.Succeeded&&o.data,a=e.status===t.Lyr3DWasmWorkerOutputStatus.MissingInputs&&e.missingInputUrls.length>0;e.jobDescJson=o.jobDescJson.slice(),e.error=o.error.slice(),u?e.data=o.data.slice():a&&(e.originalInputs=s.inputs.slice());for(let s=0;s<r.ptrs.length;++s)n._free(r.ptrs[s]);const l=[];if(u)l.push(e.data.buffer);else if(a)for(const t of s.inputs)l.push(t);return{result:e,transferList:l}},Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})}));