// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/MeshGeoreferencedVertexSpace":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,n,o,i,a,s,c,l){"use strict";var u;return e.default=class extends(r.ClonableMixin(n)){static{u=this}constructor(e){super(e),this.type="georeferenced",this.origin=null}static{this.absolute=new u}},t.__decorate([c.enumeration({georeferenced:"georeferenced"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property({type:[Number],nonNullable:!1,json:{write:!0}})],e.default.prototype,"origin",void 0),e.default=u=t.__decorate([l.subclass("esri.geometry.support.MeshGeoreferencedVertexSpace")],e.default),e.default}))},"esri/geometry/support/MeshLocalVertexSpace":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../core/libs/gl-matrix-2/factories/vec3f64"],(function(e,t,r,n,o,i,a,s,c,l,u){"use strict";return e.default=class extends(r.ClonableMixin(n)){constructor(e){super(e),this.type="local",this.origin=u.create()}},t.__decorate([c.enumeration({local:"local"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property({type:[Number],nonNullable:!0,json:{write:!0}})],e.default.prototype,"origin",void 0),e.default=t.__decorate([l.subclass("esri.geometry.support.MeshLocalVertexSpace")],e.default),e.default}))},"esri/chunks/vec3":function(){define(["exports","../colorUtils","../core/has","../core/Logger"],(function(e,t,r,n){"use strict";function o(e,t,r){i(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function i(e,t,r,n=3,o=n){if(e.length/n!==Math.ceil(t.length/o))return e;const i=e.length/n,a=r[0],s=r[1],c=r[2],l=r[4],u=r[5],d=r[6],f=r[8],h=r[9],m=r[10],p=r[12],g=r[13],b=r[14];let y=0,M=0;for(let r=0;r<i;r++){const r=t[y],i=t[y+1],v=t[y+2];e[M]=a*r+l*i+f*v+p,e[M+1]=s*r+u*i+h*v+g,e[M+2]=c*r+d*i+m*v+b,y+=o,M+=n}return e}function a(e,t,r){s(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function s(e,t,r,n=3,o=n){if(e.length/n!==Math.ceil(t.length/o))return;const i=e.length/n,a=r[0],s=r[1],c=r[2],l=r[3],u=r[4],d=r[5],f=r[6],h=r[7],m=r[8];let p=0,g=0;for(let r=0;r<i;r++){const r=t[p],i=t[p+1],b=t[p+2];e[g]=a*r+l*i+f*b,e[g+1]=s*r+u*i+h*b,e[g+2]=c*r+d*i+m*b,p+=o,g+=n}}function c(e,t,r){l(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function l(e,t,r,n=3,o=n){const i=Math.min(e.length/n,t.length/o);let a=0,s=0;for(let c=0;c<i;c++)e[s]=r*t[a],e[s+1]=r*t[a+1],e[s+2]=r*t[a+2],a+=o,s+=n;return e}function u(e,t,r,n){d(e.typedBuffer,t.typedBuffer,r,n,e.typedBufferStride,t.typedBufferStride)}function d(e,r,n,o,i=3,a=i){const s=Math.min(e.length/i,r.length/a);let c=0,l=0;const u=1/t.colorGamma;for(let t=0;t<s;t++)e[l]=o*(n*r[c])**u,e[l+1]=o*(n*r[c+1])**u,e[l+2]=o*(n*r[c+2])**u,c+=a,l+=i}function f(e,t,r,n=3,o=n){const i=e.length/n;if(i!==Math.ceil(t.length/o))return e;let a=0,s=0;for(let c=0;c<i;c++)e[s]=t[a]+r[0],e[s+1]=t[a+1]+r[1],e[s+2]=t[a+2]+r[2],a+=o,s+=n;return e}function h(e,t){m(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function m(e,t,r=3,n=r){const o=Math.min(e.length/r,t.length/n);let i=0,a=0;for(let s=0;s<o;s++){const o=t[i],s=t[i+1],c=t[i+2],l=o*o+s*s+c*c;if(l>0){const t=1/Math.sqrt(l);e[a]=t*o,e[a+1]=t*s,e[a+2]=t*c}i+=n,a+=r}}function p(e,t,r){const n=Math.min(e.count,t.count),o=e.typedBuffer,i=e.typedBufferStride,a=t.typedBuffer,s=t.typedBufferStride;let c=0,l=0;for(let e=0;e<n;e++)o[l]=a[c]>>r,o[l+1]=a[c+1]>>r,o[l+2]=a[c+2]>>r,c+=s,l+=i}const g=Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:d,linearToSRGBView:u,normalize:m,normalizeView:h,scale:l,scaleView:c,shiftRight:p,transformMat3:s,transformMat3View:a,transformMat4:i,transformMat4View:o,translate:f},Symbol.toStringTag,{value:"Module"}));e.linearToSRGB=d,e.linearToSRGBView=u,e.normalize=m,e.normalizeView=h,e.scale=l,e.scaleView=c,e.shiftRight=p,e.transformMat3=s,e.transformMat3View=a,e.transformMat4=i,e.transformMat4View=o,e.translate=f,e.vec3=g}))},"esri/libs/i3s/enums":function(){define(["exports"],(function(e){"use strict";var t,r;e.IndexType=void 0,(t=e.IndexType||(e.IndexType={}))[t.None=0]="None",t[t.Int16=1]="Int16",t[t.Int32=2]="Int32",e.ModificationType=void 0,(r=e.ModificationType||(e.ModificationType={}))[r.Replace=0]="Replace",r[r.Outside=1]="Outside",r[r.Inside=2]="Inside",r[r.Finished=3]="Finished",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],(function(e,t,r){"use strict";function n(e){return r.getAssetUrl(`esri/libs/i3s/${e}`)}let o;t.get=function(){return o||(o=new Promise((t=>new Promise(((t,r)=>e(["../../chunks/i3s"],t,r))).then((e=>e.i3s)).then((({default:e})=>{const r=e({locateFile:n,onRuntimeInitialized:()=>t(r)});delete r.then})))).catch((e=>{throw e}))),o},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define(["exports","../../../core/Logger","../../../core/PooledArray","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../core/workers/WorkerHandle","../../../geometry/projectionUtils","../../../geometry/projection/projectVectorToVector","../../../libs/i3s/enums"],(function(e,t,r,n,o,i,a,s){"use strict";class c extends o.WorkerHandle{constructor(e){super("SceneLayerWorker","process",{process:e=>[e.geometryBuffer],project:e=>[e.positions.buffer],transformNormals:e=>[e.normals.buffer]},e,{hasInitialize:!0})}setModifications(e,t,r,n){const o={context:e,modifications:d(t,r,n),isGeodetic:n.isGeographic};this.broadcast(o,"setModifications")}setLegacySchema(e,t){const r=JSON.stringify(t);return this.broadcast({context:e,jsonSchema:r},"setLegacySchema")}destroyContext(e){return this.broadcast(e,"destroyContext")}project(e,t){return this.invokeMethod("project",e,t)}transformNormals(e,t){return this.invokeMethod("transformNormals",e,t)}}const l=new r({deallocator:null}),u=n.create();function d(e,r,n){l.clear();let o=1/0,c=1/0,d=-1/0,f=-1/0,h=!1;for(const e of r){const r="clip"===e.type?s.ModificationType.Inside:"mask"===e.type?s.ModificationType.Outside:s.ModificationType.Replace,m=e.geometry;let p=e=>e;if(m.spatialReference){if(!i.canProjectWithoutEngine(m.spatialReference,n)){t.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}p=e=>(a.projectVectorToVector(e,m.spatialReference,u,n),u)}else m.hasZ||(u[2]=0,p=e=>(u[0]=e[0],u[1]=e[1],u));h=h||r===s.ModificationType.Outside,l.push(r),l.push(m.rings.length);for(const e of m.rings){l.push(e.length);for(const t of e){const e=p(t);l.push(e[0]),l.push(e[1]),l.push(e[2]),o=Math.min(o,e[0]),c=Math.min(c,e[1]),d=Math.max(d,e[0]),f=Math.max(f,e[1])}}}if(null!=e)if(h){const t=1e-4;l.push(s.ModificationType.Inside),l.push(2),l.push(4),l.push(o-t),l.push(c-t),l.push(0),l.push(d+t),l.push(c-t),l.push(0),l.push(d+t),l.push(f+t),l.push(0),l.push(o-t),l.push(f+t),l.push(0),l.push(4),l.push(e[0]),l.push(e[1]),l.push(0),l.push(e[2]),l.push(e[1]),l.push(0),l.push(e[2]),l.push(e[3]),l.push(0),l.push(e[0]),l.push(e[3]),l.push(0)}else l.push(s.ModificationType.Outside),l.push(1),l.push(4),l.push(e[0]),l.push(e[1]),l.push(0),l.push(e[2]),l.push(e[1]),l.push(0),l.push(e[2]),l.push(e[3]),l.push(0),l.push(e[0]),l.push(e[3]),l.push(0);l.push(s.ModificationType.Finished);const m=new Float64Array(l.length);for(let e=0;e<l.length;++e)m[e]=l.at(e);return m}e.I3SMeshWorkerHandle=c,e.TransformedData=class{constructor(e,t,r,n,o,i,a){this.componentOffsets=e,this.featureIds=t,this.anchorIds=r,this.anchors=n,this.transformedGeometry=o,this.globalTrafo=i,this.obb=a}},e.TransformedGeometry=class{constructor(e,t,r,n,o,i){this.layout=e,this.interleavedVertexData=t,this.indices=r,this.hasColors=n,this.hasModifications=o,this.positionData=i}},e.toWasmModification=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/workers/WorkerHandle":function(){define(["exports","../arrayUtils","../handleUtils","../Logger","../promiseUtils","./workers"],(function(e,t,r,n,o,i){"use strict";e.WorkerHandle=class{constructor(e,t,r,o,a={}){this._mainMethod=t,this._transferLists=r,this._listeners=[],this._promise=i.open(e,{...a,schedule:o}).then((e=>{if(void 0===this._thread){this._thread=e,this._promise=null,a.hasInitialize&&this.broadcast({},"initialize");for(const e of this._listeners)this._connectListener(e)}else e.close()})),this._promise.catch((t=>n.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${t}`)))}on(e,n){const o={removed:!1,eventName:e,callback:n,threadHandle:null};return this._listeners.push(o),this._connectListener(o),r.makeHandle((()=>{o.removed=!0,t.remove(this._listeners,o),this._thread&&null!=o.threadHandle&&o.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t,r){return this.invokeMethod(this._mainMethod,e,t,r)}invokeMethod(e,t,r,n){if(this._thread){const o=this._transferLists[e],i=o?o(t):[];return this._thread.invoke(e,t,{transferList:i,signal:r,priority:n})}return this._promise?this._promise.then((()=>(o.throwIfAborted(r),this.invokeMethod(e,t,r)))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then((t=>{e.removed||(e.threadHandle=t)}))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/workers/workers":function(){define(["require","exports","../Error","../has","../promiseUtils","./Connection","./connectionRegistry","./RemoteClient","./WorkerOwner"],(function(e,t,r,n,o,i,a,s,c){"use strict";function l(e){if(e&&e.__esModule)return e;const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const r in e)if("default"!==r){const n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:()=>e[r]})}return t.default=e,Object.freeze(t)}const u=n("host-browser")?Math.min(navigator.hardwareConcurrency-1,n("workers-pool-size")??8):0;let d=n("esri-mobile")?Math.min(u,3):u;d||(d=n("safari")&&n("mac")?7:2);let f=0;const h=[];async function m(e,t){const r=new i,{registryTarget:n,...o}=t;return await r.open(e,o),n&&a.register(n,r),r}let p,g=null;async function b(){if(g)return g;p=new AbortController;const e=[];for(let t=0;t<d;t++){const r=c.create(t).then((e=>(h[t]=e,e)));e.push(r)}return g=Promise.all(e),g}t.Connection=i,t.RemoteClient=s,t.initialize=function(){b()},t.open=async function(t,i={}){if("string"!=typeof t)throw new r("workers:undefined-module","modulePath is missing");let a=i.strategy||"distributed";if(n("host-webworker")&&!n("esri-workers")&&(a="local"),"local"===a){let r=await s.loadWorker(t);r||(r=await new Promise(((r,n)=>e([t],(e=>r(l(e))),n)))),o.throwIfAborted(i.signal);const n=i.client||r;return m([s.connect(r,i.schedule)],{...i,client:n})}if(await b(),o.throwIfAborted(i.signal),"dedicated"===a){const e=f++%d;return m([await h[e].open(t,i)],i)}if(i.maxNumWorkers&&i.maxNumWorkers>0){const e=Math.min(i.maxNumWorkers,d);if(e<d){const r=new Array(e);for(let n=0;n<e;++n){const e=f++%d;r[n]=h[e].open(t,i)}return m(r,i)}}return m(h.map((e=>e.open(t,i))),i)},t.openWithPorts=function(e,t){return m(e,{client:t})},t.terminate=function(){g&&(p.abort(),g=null);for(let e=0;e<h.length;e++)h[e]&&h[e].terminate();h.length=0},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/core/workers/Connection":function(){define(["../handleUtils","../has","../promiseUtils","../Queue","./connectionRegistry","./InvokeHandler","./RemoteClient"],(function(e,t,r,n,o,i,a){"use strict";return class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new n,this._ongoingLowPriorityJobsQueue=new n}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,t){return new Promise(((n,o)=>{let i=!0;const s=e=>{r.throwIfAborted(t.signal),i&&(i=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let i=0;i<e.length;++i){const c=e[i];r.isPromiseLike(c)?this._clientPromises[i]=c.then((e=>(this._clients[i]=new a(e,t,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),s(n),this._clients[i])),(()=>(s(o),null))):(this._clients[i]=new a(c,t,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),this._clientPromises[i]=Promise.resolve(this._clients[i]),s(n))}}))}broadcast(e,t,r){const n=new Array(this._clientPromises.length);for(let o=0;o<this._clientPromises.length;++o){const i=this._clientPromises[o];n[o]=i.then((n=>n?.invoke(e,t,r)))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(r.createAbortError(`Worker closing, aborting job calling '${e.methodName}'`));for(;e=this._ongoingLowPriorityJobsQueue.pop();)e.resolver.reject(r.createAbortError(`Worker closing, aborting job calling '${e.methodName}'`));for(const e of this._clientPromises)e.then((e=>e?.close()));this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,o.unregister(this)}invoke(e,t,r){return this.apply(e,[t],r)}apply(e,t,n){const o=r.createResolver();("low"===n?.priority?this._ongoingLowPriorityJobsQueue:this._ongoingJobsQueue).push({methodName:e,data:t,invokeOptions:n,resolver:o});for(let e=0;e<this._clientPromises.length;e++){const t=this._clients[e];t?t.jobAdded():this._clientPromises[e].then((e=>e?.jobAdded()))}return o.promise}createInvokeProxy(e){return i.createInvokeProxy(this,e)}on(t,r){return Promise.all(this._clientPromises).then((()=>e.handlesGroup(this._clients.map((e=>e.on(t,r))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let r=t.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then((o=>{o&&(t[n]=o.openPort()),0===--r&&e(t)}))}))}get test(){}}}))},"esri/core/Queue":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],(function(e,t){"use strict";class r{constructor(e=e=>e.values().next().value){this._peeker=e,this._observable=new t.SimpleObservable,this._items=new Set}get length(){return e.trackAccess(this._observable),this._items.size}clear(){0!==this.length&&(this._items.clear(),this._observable.notify())}last(){if(0===this.length)return;let e;for(e of this._items);return e}peek(){if(0!==this.length)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(t){return e.trackAccess(this._observable),this._items.has(t)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(0===this.length)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const t=this.length;return this._items.forEach((t=>{e(t)||this._items.delete(t)})),t!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){e.trackAccess(this._observable),yield*this._items}}return r}))},"esri/core/workers/connectionRegistry":function(){define(["exports"],(function(e){"use strict";const t=new FinalizationRegistry((e=>{e.close()}));e.register=function(e,r){t.register(e,r,r)},e.unregister=function(e){t.unregister(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/workers/WorkerOwner":function(){define(["../Error","../Logger","../maybe","../promiseUtils","./staticWorkerMessages","./utils","./workerFactory"],(function(e,t,r,n,o,i,a){"use strict";const{ABORT:s,INVOKE:c,OPEN:l,OPENED:u,RESPONSE:d}=i.MessageType;class f{static async create(e){const t=await a.createWorker();return new f(t,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),t.getLogger("esri.core.workers.WorkerOwner").error(e)}))}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:r}=t,o=i.newJobId();return new Promise(((t,i)=>{const a={resolve:t,reject:i,abortHandle:n.onAbortOrThrow(r,(()=>{this._outJobs.delete(o),this._post({type:s,jobId:o})}))};this._outJobs.set(o,a),this._post({type:l,jobId:o,modulePath:e})}))}_onMessage(e){const t=i.receiveMessage(e);if(t)switch(t.type){case u:this._onOpenedMessage(t);break;case d:this._onResponseMessage(t);break;case s:this._onAbortMessage(t);break;case c:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,r=e.jobId,n=t.get(r);n&&(n.controller&&n.controller.abort(),t.delete(r))}_onInvokeMessage(e){const{methodName:t,jobId:r,data:a,abortable:s}=e,c=s?new AbortController:null,l=this._inJobs,u=o.staticWorkerMessages[t];let f;try{if("function"!=typeof u)throw new TypeError(`${t} is not a function`);f=u.call(null,a,{signal:c?c.signal:null})}catch(e){return void this._post({type:d,jobId:r,error:i.toInvokeError(e)})}n.isPromiseLike(f)?(l.set(r,{controller:c,promise:f}),f.then((e=>{l.has(r)&&(l.delete(r),this._post({type:d,jobId:r},e))}),(e=>{l.has(r)&&(l.delete(r),e||(e={message:"Error encountered at method"+t}),n.isAbortError(e)||this._post({type:d,jobId:r,error:i.toInvokeError(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:d,jobId:r},f)}_onOpenedMessage(e){const{jobId:t,data:n}=e,o=this._outJobs.get(t);o&&(this._outJobs.delete(t),r.removeMaybe(o.abortHandle),o.resolve(n))}_onResponseMessage(t){const{jobId:n,error:o,data:i}=t,a=this._outJobs.get(n);a&&(this._outJobs.delete(n),r.removeMaybe(a.abortHandle),o?a.reject(e.fromJSON(JSON.parse(o))):a.resolve(i))}_post(e,t,r){return i.postMessage(this.worker,e,t,r)}}return f}))},"esri/core/workers/staticWorkerMessages":function(){define(["exports","../../request","../urlUtils"],(function(e,t,r){"use strict";const n={async request(e,n){const o=e.options,i=o.responseType;o.signal=n?.signal,o.responseType="native"===i||"native-request-init"===i?"native-request-init":i&&["blob","json","text"].includes(i)&&r.getInterceptor(e.url)?.after?i:"array-buffer";const a=await t(e.url,o),s={data:a.data,httpStatus:a.httpStatus,ssl:a.ssl};switch(a.requestOptions?.responseType){case"native-request-init":return delete s.data.signal,s;case"blob":s.data=await s.data.arrayBuffer();break;case"json":s.data=(new TextEncoder).encode(JSON.stringify(s.data)).buffer;break;case"text":s.data=(new TextEncoder).encode(s.data).buffer}return{result:s,transferList:[s.data]}}};e.staticWorkerMessages=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/workers/workerFactory":function(){define(["exports","../../config","../../request","../Error","../Logger","../urlUtils","../../intl","../../kernel","../has","./loaderConfig","./utils","./WorkerFallback","../../intl/locale","../../support/revision"],(function(e,t,r,n,o,i,a,s,c,l,u,d,f,h){"use strict";const m=()=>o.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:p}=u.MessageType;let g,b;const y="Failed to create Worker. Fallback to execute module in main thread";async function M(e){return new Promise((t=>{function r(o){const i=u.receiveMessage(o);i&&i.type===p&&(e.removeEventListener("message",r),e.removeEventListener("error",n),t(e))}function n(t){t.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",n),m().warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new d).addEventListener("message",r),e.addEventListener("error",n)}e.addEventListener("message",r),e.addEventListener("error",n)}))}let v=0;e.createWorker=async function(){if(!c("esri-workers"))return M(new d);if(!g&&!b)try{const e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.split("{CONFIGURATION}").join(function(){let e;if(null!=t.default){const r={...t};delete r.default,e=JSON.parse(JSON.stringify(r))}else e=JSON.parse(JSON.stringify(t));e.assetsPath=i.makeAbsolute(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?i.makeAbsolute(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=f.getLocale(),e.has={"esri-csp-restrictions":c("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":c("esri-2d-update-debug"),"esri-2d-log-updating":c("esri-2d-log-updating"),"featurelayer-pbf":c("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":c("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":c("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":c("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":c("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":c("featurelayer-query-max-depth"),"featurelayer-query-tile-max-features":c("featurelayer-query-tile-max-features"),"featurelayer-query-tile-concurrency":c("featurelayer-query-tile-concurrency"),"featurelayer-query-pausing-enabled":c("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-concurrency":c("featurelayer-snapshot-concurrency"),"featurelayer-snapshot-enabled":c("featurelayer-snapshot-enabled"),"esri-atomics":c("esri-atomics"),"esri-shared-array-buffer":c("esri-shared-array-buffer"),"esri-tiles-debug":c("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":c("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":c("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl?e.workers.loaderUrl=i.makeAbsolute(e.workers.loaderUrl):l.defaultLoaderUrl&&(e.workers.loaderUrl=l.defaultLoaderUrl),e.workers.workerPath?e.workers.workerPath=i.makeAbsolute(e.workers.workerPath):e.workers.workerPath="esri/core/workers/RemoteClient",e.workers.useDynamicImport=!1;const r=t.workers.loaderConfig,n=l.loaderConfig({baseUrl:r?.baseUrl,locale:f.getLocale(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...r?.has},map:{...r?.map},paths:{...r?.paths},packages:r?.packages||[]}),o={buildDate:h.buildDate,fullVersion:s.fullVersion,revision:h.commitHash};return JSON.stringify({esriConfig:e,loaderConfig:n,kernelInfo:o})}());g=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){b=e||{}}let e;if(g)try{e=new Worker(g,{name:"esri-worker-"+v++})}catch(t){m().warn(y,b),e=new d}else m().warn(y,b),e=new d;return M(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/intl":function(){define(["exports","./intl/date","./intl/number","./intl/substitute","./intl/locale","./intl/messages","./intl/t9n","./assets"],(function(e,t,r,n,o,i,a,s){"use strict";i.registerMessageBundleLoader(a.createJSONLoader({pattern:"esri/",location:s.getAssetUrl})),e.convertDateFormatToIntlOptions=t.convertDateFormatToIntlOptions,e.formatDate=t.formatDate,e.formatDateOnly=t.formatDateOnly,e.formatTimeOnly=t.formatTimeOnly,e.formatTimestamp=t.formatTimestamp,e.convertNumberFormatToIntlOptions=r.convertNumberFormatToIntlOptions,e.formatNumber=r.formatNumber,e.substitute=n.substitute,e.getLocale=o.getLocale,e.onLocaleChange=o.onLocaleChange,e.prefersRTL=o.prefersRTL,e.setLocale=o.setLocale,e.fetchMessageBundle=i.fetchMessageBundle,e.normalizeMessageBundleLocale=i.normalizeMessageBundleLocale,e.registerMessageBundleLoader=i.registerMessageBundleLoader,e.createJSONLoader=a.createJSONLoader,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/intl/number":function(){define(["exports","./locale"],(function(e,t){"use strict";const r={ar:"ar-u-nu-latn",bs:"sr-Latn-CS",nn:"no-NN"};let n=new WeakMap,o={};function i(e){const i=e||o;if(!n.has(i)){const o=t.getLocale(),a=t.getLocaleParts(o)?.language,s=a&&r[a]||o;n.set(i,new Intl.NumberFormat(s,e))}return n.get(i)}t.beforeLocaleChange((()=>{n=new WeakMap,o={}}));const a=new Map;e.convertNumberFormatToIntlOptions=function(e={}){const t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t},e.formatNumber=function(e,t){return Object.is(e,-0)&&(e=0),i(t).format(e)},e.getFormatter=i,e.parseNumber=function(e,r=t.getLocale()){if(!e)return null;let n=a.get(r);if(!n){const e=i().formatToParts(12345.6),t=[...i({useGrouping:!1}).format(9876543210)].reverse(),o=new Map(t.map(((e,t)=>[e,t]))),s=new RegExp(`[${e.find((e=>"group"===e.type))?.value}]`,"g"),c=new RegExp(`[${e.find((e=>"decimal"===e.type))?.value}]`),l=new RegExp(`[${t.join("")}]`,"g"),u=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,d=/[-\u2212\u2013\u2014\u2015]/g;n=e=>{if(""===(e=e.trim().replaceAll(s,"").replace(c,".").replace(l,(e=>String(o.get(e)))).replaceAll(u,"").replaceAll(d,"-")))return null;const t=Number(e);return isNaN(t)?null:t},a.set(r,n)}return n(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/intl/substitute":function(){define(["exports","../core/Logger","../core/object","../core/string","./date","./number"],(function(e,t,r,n,o,i){"use strict";const a=()=>t.getLogger("esri.intl.substitute");function s(e){switch(typeof e){case"string":return e;case"number":return i.formatNumber(e);case"boolean":return""+e;default:return e instanceof Date?o.formatDate(e):""}}e.substitute=function(e,t,c={}){const{format:l={}}=c;return n.replace(e,(e=>function(e,t,n){let c,l;const u=e.indexOf(":");if(-1===u?c=e.trim():(c=e.slice(0,u).trim(),l=e.slice(u+1).trim()),!c)return"";const d=r.getDeepValue(c,t);if(null==d)return"";const f=(l?n?.[l]:null)??n?.[c];return f?function(e,t){switch(t.type){case"date":return o.formatDate(e,t.intlOptions);case"number":return i.formatNumber(e,t.intlOptions);default:return a().warn("missing format descriptor for key {key}"),s(e)}}(d,f):l?function(e,t){switch(t.toLowerCase()){case"dateformat":return o.formatDate(e);case"numberformat":return i.formatNumber(e);default:return a().warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?o.formatDate(e):/^numberformat/i.test(t)?i.formatNumber(e):s(e)}}(d,l):s(d)}(e,t,l)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/intl/messages":function(){define(["exports","../core/Error","../core/handleUtils","../core/promiseUtils","./locale"],(function(e,t,r,n,o){"use strict";const i={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,nn:"no",pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function a(e){if(function(e){return e in i}(e)){const t=i[e];return!0===t?e:t}return null}const s=[],c=new Map;function l(e){for(const t of c.keys())u(e.pattern,t)&&c.delete(t)}function u(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}o.beforeLocaleChange((()=>{c.clear()}));const d=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=n.createResolver())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}},f={cache:c,loaders:s};e.fetchMessageBundle=async function(e){const r=o.getLocale();c.has(e)||c.set(e,async function(e,r){const n=[];for(const t of s)if(u(t.pattern,e))try{return await t.fetchMessageBundle(e,r)}catch(e){n.push(e)}if(n.length)throw new t("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:n});throw new t("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,r));const n=c.get(e);return n&&await d.add(n),n},e.messageBundlesLocaleMap=i,e.normalizeMessageBundleLocale=function(e){const t=o.getLocaleParts(e);return t?a(e)??a(t.language):null},e.registerMessageBundleLoader=function(e){return s.includes(e)||(l(e),s.unshift(e)),r.makeHandle((()=>{const t=s.indexOf(e);t>-1&&(s.splice(t,1),l(e))}))},e.test=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/intl/t9n":function(){define(["exports","../request","../core/Error","./messages"],(function(e,t,r,n){"use strict";async function o(e){if(null!=a.fetchBundleAsset)return a.fetchBundleAsset(e);const r=await t(e,{responseType:"text"});return JSON.parse(r.data)}class i{constructor({base:e="",pattern:t,location:r=new URL(window.location.href)}){let n;n="string"==typeof r?e=>new URL(e,new URL(r,window.location.href)).href:r instanceof URL?e=>new URL(e,r).href:r,this.pattern="string"==typeof t?new RegExp(`^${t}`):t,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,t){return async function(e,t,i,a){const s=t.exec(i);if(!s)throw new r("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const c=s[1]?`${s[1]}/`:"",l=s[2],u=n.normalizeMessageBundleLocale(a),d=`${c}${l}.json`,f=u?`${c}${l}_${u}.json`:d;let h;try{h=await o(e(f))}catch(t){if(f===d)throw new r("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:t});try{h=await o(e(d))}catch(e){throw new r("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:e})}}return h}(this.getAssetUrl,this.matcher,e,t)}}const a={};e.JSONLoader=i,e.createJSONLoader=function(e){return new i(e)},e.test=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/workers/loaderConfig":function(){define(["exports","../../assets","../has","../urlUtils"],(function(e,t,r,n){"use strict";e.defaultLoaderUrl=null,e.defaultLoaderUrl=n.makeAbsolute(t.getAssetUrl("esri/core/workers/init.js"));const o={};o.baseUrl=n.makeAbsolute(t.getAssetUrl("dojo/")),o.packages=[{name:"esri",location:"../esri"}],e.loaderConfig=function(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages?.slice()||[],paths:{...o.paths,...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=o.baseUrl),o.packages?.forEach((e=>{!function(e,t){for(const r of e)if(r.name===t.name)return;e.push(t)}(t.packages??[],e)})),t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/workers/WorkerFallback":function(){define(["require","../nextTick","./RemoteClient","./utils"],(function(e,t,r,n){"use strict";function o(e){if(e&&e.__esModule)return e;const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const r in e)if("default"!==r){const n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:()=>e[r]})}return t.default=e,Object.freeze(t)}class i{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...r)=>e[t](...r)}))}}return class{constructor(){this._dispatcher=new i,this._workerPostMessage({type:n.MessageType.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){t.nextTick((()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,r){this._dispatcher.addEventListener(e,t,r)}removeEventListener(e,t,r){this._dispatcher.removeEventListener(e,t,r)}_workerPostMessage(e){t.nextTick((()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))}))}async _workerMessageHandler(t){const i=n.receiveMessage(t);if(i&&i.type===n.MessageType.OPEN){const{modulePath:t,jobId:a}=i;let s=await r.loadWorker(t);s||(s=await new Promise(((r,n)=>e([t],(e=>r(o(e))),n))));const c=r.connect(s);this._workerPostMessage({type:n.MessageType.OPENED,jobId:a,data:c})}}}}))},"esri/geometry/projection/projectVectorToVector":function(){define(["exports","../projectionUtils","../SpatialReference","./projectPointToVector","../../layers/graphics/dehydratedPoint"],(function(e,t,r,n,o){"use strict";function i(e,t,r,o,i){return!(null==t||null==o||e.length<2)&&(a.x=e[0],a.y=e[1],a.z=e[2],a.spatialReference=t,n.projectPointToVector(a,r,o,i))}const a=o.makeDehydratedPoint(0,0,0,r.WGS84);e.projectVectorToVector=i,e.projectVectorToVectorAsync=async function(e,r,n,o,a,s){return await t.initializeProjection(r,o,null,s),i(e,r,n,o,a)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/projection/projectPointToVector":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projectionUtils","./projectBuffer"],(function(e,t,r,n){"use strict";function o(e,t,o,a){if(r.canProjectWithoutEngine(e.spatialReference,o)){i[0]=e.x,i[1]=e.y;const r=e.z;return i[2]=r??a??0,n.projectBuffer(i,e.spatialReference,0,t,o,0)}const s=r.tryProjectWithZConversion(e,o);return!!s&&(t[0]=s?.x,t[1]=s?.y,t[2]=s?.z??a??0,!0)}const i=t.create();e.projectPointToVector=o,e.projectPointToVectorAsync=async function(e,t,n,i,a){return await r.initializeProjection(e.spatialReference,n,null,a),o(e,t,n,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/dehydratedPoint":function(){define(["exports"],(function(e){"use strict";e.makeDehydratedPoint=function(e,t,r,n){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:n,type:"point"}},e.setDehydratedPoint=function(e,t,r,n,o){e.x=t,e.y=r,e.z=n,e.hasZ=null!=n,e.spatialReference=o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../chunks/sphere","./I3SUtil","../../support/ElevationRange"],(function(e,t,r,n,o){"use strict";class i extends o.ElevationRange{constructor(e,t){super(NaN,NaN),this.id=e,this.serviceMbsInIndexSR=t,this.serviceMbsInRenderSR=r.fromValues(0,0,0,-1)}invalidateServiceBVsInRenderSR(){n.invalidateMbs(this.serviceMbsInRenderSR),this.serviceObbInRenderSR?.invalidate()}shareServiceBVsInRenderSRWith(e){this.serviceObbInRenderSR=e.serviceObbInRenderSR,this.serviceMbsInRenderSR=e.serviceMbsInRenderSR}}var a,s,c,l,u;e.NodeFilterImpact=void 0,(a=e.NodeFilterImpact||(e.NodeFilterImpact={}))[a.Unmodified=0]="Unmodified",a[a.Culled=1]="Culled",a[a.NotChecked=2]="NotChecked",e.NodeIMModificationImpact=void 0,(s=e.NodeIMModificationImpact||(e.NodeIMModificationImpact={}))[s.Unmodified=0]="Unmodified",s[s.PotentiallyModified=1]="PotentiallyModified",s[s.Culled=2]="Culled",s[s.Unknown=3]="Unknown",s[s.NotChecked=4]="NotChecked",e.CacheState=void 0,(c=e.CacheState||(e.CacheState={}))[c.Unknown=0]="Unknown",c[c.Uncached=1]="Uncached",c[c.Cached=2]="Cached",e.LodMetric=void 0,(l=e.LodMetric||(e.LodMetric={}))[l.None=0]="None",l[l.MaxScreenThreshold=1]="MaxScreenThreshold",l[l.ScreenSpaceRelative=2]="ScreenSpaceRelative",l[l.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",l[l.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera",e.NodeState=void 0,(u=e.NodeState||(e.NodeState={}))[u.Hole=0]="Hole",u[u.Leaf=1]="Leaf",e.Node=class extends i{constructor(r,n,o,i,a,s,c,l,u,d){super(r,o),this.index=n,this.childCount=i,this.level=a,this.resources=s,this.version=c,this.lodMetric=l,this.maxError=u,this.numFeatures=d,this.failed=!1,this.cacheState=e.CacheState.Unknown,this.vertexCount=0,this.memory=0,this.childrenLoaded=0,this.hasModifications=!1,this.imModificationImpact=e.NodeIMModificationImpact.NotChecked,this.elevationAgnosticBoundingVolume=t.fromValues(0,0,0,-1)}invalidateServiceBVsInRenderSR(){super.invalidateServiceBVsInRenderSR(),this.elevationAgnosticBoundingVolume[3]=-1}},e.NodeBase=i,e.NodeTraversalState=class{constructor(e,t,r,n){this.nodeHasLOD=e,this.isChosen=t,this.lodLevel=r,this.version=n}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/sphere":function(){define(["exports","../core/has","../core/Logger","../core/mathUtils","../core/libs/gl-matrix-2/math/mat4","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","./vec42","../core/libs/gl-matrix-2/factories/vec4f64","../core/libs/gl-matrix-2/math/common","../geometry/support/Axis","../geometry/support/ray","../geometry/support/sphereUtils","../geometry/support/vector","../geometry/support/vectorStacks"],(function(e,t,r,n,o,i,a,s,c,l,u,d,f,h,m){"use strict";const p=g();function g(){return c.create()}const b=s.equals,y=s.equals;function M(e,t){return s.copy(t,e)}function v(e,t){return c.fromValues(e[0],e[1],e[2],t)}function S(e){return e}function w(e){e[0]=e[1]=e[2]=e[3]=0}function x(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function T(e){return e[3]}function I(e){return e}function P(e,t,r,n){return c.fromValues(e,t,r,n)}function E(e,t,r){return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=e[3]+t,r}function O(e,t,r){return e!==r&&M(e,r),r}function A(e,t){return t}function C(e,t,r){if(null==t)return!1;if(!N(e,t,R))return!1;let{t0:n,t1:o}=R;if((n<0||o<n&&o>0)&&(n=o),n<0)return!1;if(r){const{origin:e,direction:o}=t;r[0]=e[0]+o[0]*n,r[1]=e[1]+o[1]*n,r[2]=e[2]+o[2]*n}return!0}function _(e,t,r){const n=d.fromPoints(t,r);if(!N(e,n,R))return[];const{origin:o,direction:s}=n,{t0:c,t1:u}=R,f=t=>{const r=a.create();return i.scaleAndAdd(r,o,s,t),V(e,r,r)};return Math.abs(c-u)<l.getEpsilon()?[f(c)]:[f(c),f(u)]}const R={t0:0,t1:0};function N(e,t,r){const{origin:n,direction:o}=t,i=U;i[0]=n[0]-e[0],i[1]=n[1]-e[1],i[2]=n[2]-e[2];const a=o[0]*o[0]+o[1]*o[1]+o[2]*o[2];if(0===a)return!1;const s=2*(o[0]*i[0]+o[1]*i[1]+o[2]*i[2]),c=s*s-4*a*(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]-e[3]*e[3]);if(c<0)return!1;const l=Math.sqrt(c);return r.t0=(-s-l)/(2*a),r.t1=(-s+l)/(2*a),!0}const U=a.create();function j(e,t){return C(e,t,null)}function L(e,t,r){if(C(e,t,r))return r;const n=k(e,t,m.sv3d.get());return i.add(r,t.origin,i.scale(m.sv3d.get(),t.direction,i.distance(t.origin,n)/i.length(t.direction))),r}function k(e,t,r){const n=m.sv3d.get(),a=m.sm4d.get();i.cross(n,t.origin,t.direction);const s=T(e);i.cross(r,n,t.origin),i.scale(r,r,1/i.length(r)*s);const c=q(e,t.origin),l=h.angle(t.origin,r);return o.fromRotation(a,l+c,n),i.transformMat4(r,r,a),r}function F(e,t,r,n){const o=T(e),i=o*o,a=t+.5*Math.PI,s=r*r+i-2*Math.cos(a)*r*o,c=Math.sqrt(s),l=s-i;if(l<=0)return.5;const u=Math.sqrt(l),d=Math.acos(u/c)-Math.asin(o/(c/Math.sin(a)));return Math.min(1,(d+.5*n)/n)}function D(e,t,r){return C(e,t,r)?r:(d.closestPoint(t,e,r),V(e,r,r))}function V(e,t,r){const n=i.subtract(m.sv3d.get(),t,e),o=i.scale(m.sv3d.get(),n,e[3]/i.length(n));return i.add(r,o,e)}function B(e,t){const r=i.subtract(m.sv3d.get(),t,e),n=i.squaredLength(r),o=e[3]*e[3];return Math.sqrt(Math.abs(n-o))}function q(e,t){const r=i.subtract(m.sv3d.get(),t,e),o=i.length(r),a=T(e),s=a+Math.abs(a-o);return n.acosClamped(a/s)}const z=a.create();function W(e,t,r,n){const o=i.subtract(z,t,e);switch(r){case u.Axis.X:{const e=f.cartesianToSpherical(o,z)[2];return i.set(n,-Math.sin(e),Math.cos(e),0)}case u.Axis.Y:{const e=f.cartesianToSpherical(o,z),t=e[1],r=e[2],a=Math.sin(t);return i.set(n,-a*Math.cos(r),-a*Math.sin(r),Math.cos(t))}case u.Axis.Z:return i.normalize(n,o);default:return}}function H(e,t){const r=i.subtract(Y,t,e);return i.length(r)-e[3]}function G(e,t,r,n){const o=H(e,t),a=W(e,t,u.Axis.Z,Y),s=i.scale(Y,a,r-o);return i.add(n,t,s)}function $(e,t){const r=i.squaredDistance(e,t),n=T(e);return r<=n*n}function Q(e,t,r=c.create()){const n=i.distance(e,t),o=e[3],a=t[3];return n+a<o?(s.copy(r,e),r):n+o<a?(s.copy(r,t),r):(i.lerp(r,e,t,(n+a-o)/(2*n)),r[3]=(n+o+a)/2,r)}const Y=a.create(),J=g(),X=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:p,altitudeAt:H,angleToSilhouette:q,axisAt:W,cameraFrustumCoverage:F,clear:w,closestPoint:D,closestPointOnSilhouette:k,containsPoint:$,copy:M,create:g,distanceToSilhouette:B,elevate:E,equals:y,exactEquals:b,fromCenterAndRadius:v,fromRadius:x,fromValues:P,getCenter:I,getExtent:A,getRadius:T,intersectLine:_,intersectRay:C,intersectRayClosestSilhouette:L,intersectsRay:j,projectPoint:V,setAltitudeAt:G,setExtent:O,tmpSphere:J,union:Q,wrap:S},Symbol.toStringTag,{value:"Module"}));e.NullSphere=p,e.altitudeAt=H,e.angleToSilhouette=q,e.axisAt=W,e.cameraFrustumCoverage=F,e.clear=w,e.closestPoint=D,e.closestPointOnSilhouette=k,e.containsPoint=$,e.copy=M,e.create=g,e.distanceToSilhouette=B,e.elevate=E,e.equals=y,e.exactEquals=b,e.fromCenterAndRadius=v,e.fromRadius=x,e.fromValues=P,e.getCenter=I,e.getExtent=A,e.getRadius=T,e.intersectLine=_,e.intersectRay=C,e.intersectRayClosestSilhouette=L,e.intersectsRay=j,e.projectPoint=V,e.setAltitudeAt=G,e.setExtent=O,e.sphere=X,e.tmpSphere=J,e.union=Q,e.wrap=S}))},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["exports","../factories/vec3f64","./common"],(function(e,t,r){"use strict";function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(e,t,r,n,o,i,a,s,c,l,u,d,f,h,m,p,g){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e[4]=i,e[5]=a,e[6]=s,e[7]=c,e[8]=l,e[9]=u,e[10]=d,e[11]=f,e[12]=h,e[13]=m,e[14]=p,e[15]=g,e}function i(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function a(e,t){if(e===t){const r=t[1],n=t[2],o=t[3],i=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=o,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function s(e,t){return c(e,t)||i(e),e}function c(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],f=t[10],h=t[11],m=t[12],p=t[13],g=t[14],b=t[15],y=r*s-n*a,M=r*c-o*a,v=r*l-i*a,S=n*c-o*s,w=n*l-i*s,x=o*l-i*c,T=u*p-d*m,I=u*g-f*m,P=u*b-h*m,E=d*g-f*p,O=d*b-h*p,A=f*b-h*g;let C=y*A-M*O+v*E+S*P-w*I+x*T;return C?(C=1/C,e[0]=(s*A-c*O+l*E)*C,e[1]=(o*O-n*A-i*E)*C,e[2]=(p*x-g*w+b*S)*C,e[3]=(f*w-d*x-h*S)*C,e[4]=(c*P-a*A-l*I)*C,e[5]=(r*A-o*P+i*I)*C,e[6]=(g*v-m*x-b*M)*C,e[7]=(u*x-f*v+h*M)*C,e[8]=(a*O-s*P+l*T)*C,e[9]=(n*P-r*O-i*T)*C,e[10]=(m*w-p*v+b*y)*C,e[11]=(d*v-u*w-h*y)*C,e[12]=(s*I-a*E-c*T)*C,e[13]=(r*E-n*I+o*T)*C,e[14]=(p*M-m*S-g*y)*C,e[15]=(u*S-d*M+f*y)*C,e):null}function l(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],f=t[10],h=t[11],m=t[12],p=t[13],g=t[14],b=t[15];return e[0]=s*(f*b-h*g)-d*(c*b-l*g)+p*(c*h-l*f),e[1]=-(n*(f*b-h*g)-d*(o*b-i*g)+p*(o*h-i*f)),e[2]=n*(c*b-l*g)-s*(o*b-i*g)+p*(o*l-i*c),e[3]=-(n*(c*h-l*f)-s*(o*h-i*f)+d*(o*l-i*c)),e[4]=-(a*(f*b-h*g)-u*(c*b-l*g)+m*(c*h-l*f)),e[5]=r*(f*b-h*g)-u*(o*b-i*g)+m*(o*h-i*f),e[6]=-(r*(c*b-l*g)-a*(o*b-i*g)+m*(o*l-i*c)),e[7]=r*(c*h-l*f)-a*(o*h-i*f)+u*(o*l-i*c),e[8]=a*(d*b-h*p)-u*(s*b-l*p)+m*(s*h-l*d),e[9]=-(r*(d*b-h*p)-u*(n*b-i*p)+m*(n*h-i*d)),e[10]=r*(s*b-l*p)-a*(n*b-i*p)+m*(n*l-i*s),e[11]=-(r*(s*h-l*d)-a*(n*h-i*d)+u*(n*l-i*s)),e[12]=-(a*(d*g-f*p)-u*(s*g-c*p)+m*(s*f-c*d)),e[13]=r*(d*g-f*p)-u*(n*g-o*p)+m*(n*f-o*d),e[14]=-(r*(s*g-c*p)-a*(n*g-o*p)+m*(n*c-o*s)),e[15]=r*(s*f-c*d)-a*(n*f-o*d)+u*(n*c-o*s),e}function u(e){const t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],a=e[5],s=e[6],c=e[7],l=e[8],u=e[9],d=e[10],f=e[11],h=e[12],m=e[13],p=e[14],g=e[15];return(t*a-r*i)*(d*g-f*p)-(t*s-n*i)*(u*g-f*m)+(t*c-o*i)*(u*p-d*m)+(r*s-n*a)*(l*g-f*h)-(r*c-o*a)*(l*p-d*h)+(n*c-o*s)*(l*m-u*h)}function d(e,t,r){const n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=t[9],h=t[10],m=t[11],p=t[12],g=t[13],b=t[14],y=t[15];let M=r[0],v=r[1],S=r[2],w=r[3];return e[0]=M*n+v*s+S*d+w*p,e[1]=M*o+v*c+S*f+w*g,e[2]=M*i+v*l+S*h+w*b,e[3]=M*a+v*u+S*m+w*y,M=r[4],v=r[5],S=r[6],w=r[7],e[4]=M*n+v*s+S*d+w*p,e[5]=M*o+v*c+S*f+w*g,e[6]=M*i+v*l+S*h+w*b,e[7]=M*a+v*u+S*m+w*y,M=r[8],v=r[9],S=r[10],w=r[11],e[8]=M*n+v*s+S*d+w*p,e[9]=M*o+v*c+S*f+w*g,e[10]=M*i+v*l+S*h+w*b,e[11]=M*a+v*u+S*m+w*y,M=r[12],v=r[13],S=r[14],w=r[15],e[12]=M*n+v*s+S*d+w*p,e[13]=M*o+v*c+S*f+w*g,e[14]=M*i+v*l+S*h+w*b,e[15]=M*a+v*u+S*m+w*y,e}function f(e,t,r){const n=r[0],o=r[1],i=r[2];if(t===e)e[12]=t[0]*n+t[4]*o+t[8]*i+t[12],e[13]=t[1]*n+t[5]*o+t[9]*i+t[13],e[14]=t[2]*n+t[6]*o+t[10]*i+t[14],e[15]=t[3]*n+t[7]*o+t[11]*i+t[15];else{const r=t[0],a=t[1],s=t[2],c=t[3],l=t[4],u=t[5],d=t[6],f=t[7],h=t[8],m=t[9],p=t[10],g=t[11];e[0]=r,e[1]=a,e[2]=s,e[3]=c,e[4]=l,e[5]=u,e[6]=d,e[7]=f,e[8]=h,e[9]=m,e[10]=p,e[11]=g,e[12]=r*n+l*o+h*i+t[12],e[13]=a*n+u*o+m*i+t[13],e[14]=s*n+d*o+p*i+t[14],e[15]=c*n+f*o+g*i+t[15]}return e}function h(e,t,r){const n=r[0],o=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function m(e,t,o,i){let a=i[0],s=i[1],c=i[2],l=Math.sqrt(a*a+s*s+c*c);if(l<=r.getEpsilon())return void n(e,t);l=1/l,a*=l,s*=l,c*=l;const u=Math.sin(o),d=Math.cos(o),f=1-d,h=t[0],m=t[1],p=t[2],g=t[3],b=t[4],y=t[5],M=t[6],v=t[7],S=t[8],w=t[9],x=t[10],T=t[11],I=a*a*f+d,P=s*a*f+c*u,E=c*a*f-s*u,O=a*s*f-c*u,A=s*s*f+d,C=c*s*f+a*u,_=a*c*f+s*u,R=s*c*f-a*u,N=c*c*f+d;e[0]=h*I+b*P+S*E,e[1]=m*I+y*P+w*E,e[2]=p*I+M*P+x*E,e[3]=g*I+v*P+T*E,e[4]=h*O+b*A+S*C,e[5]=m*O+y*A+w*C,e[6]=p*O+M*A+x*C,e[7]=g*O+v*A+T*C,e[8]=h*_+b*R+S*N,e[9]=m*_+y*R+w*N,e[10]=p*_+M*R+x*N,e[11]=g*_+v*R+T*N,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15])}function p(e,t,r){const n=Math.sin(r),o=Math.cos(r),i=t[4],a=t[5],s=t[6],c=t[7],l=t[8],u=t[9],d=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*o+l*n,e[5]=a*o+u*n,e[6]=s*o+d*n,e[7]=c*o+f*n,e[8]=l*o-i*n,e[9]=u*o-a*n,e[10]=d*o-s*n,e[11]=f*o-c*n,e}function g(e,t,r){const n=Math.sin(r),o=Math.cos(r),i=t[0],a=t[1],s=t[2],c=t[3],l=t[8],u=t[9],d=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*o-l*n,e[1]=a*o-u*n,e[2]=s*o-d*n,e[3]=c*o-f*n,e[8]=i*n+l*o,e[9]=a*n+u*o,e[10]=s*n+d*o,e[11]=c*n+f*o,e}function b(e,t,r){const n=Math.sin(r),o=Math.cos(r),i=t[0],a=t[1],s=t[2],c=t[3],l=t[4],u=t[5],d=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*o+l*n,e[1]=a*o+u*n,e[2]=s*o+d*n,e[3]=c*o+f*n,e[4]=l*o-i*n,e[5]=u*o-a*n,e[6]=d*o-s*n,e[7]=f*o-c*n,e}function y(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function M(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t,n){if(0===t)return i(e);let o=n[0],a=n[1],s=n[2],c=Math.sqrt(o*o+a*a+s*s);if(c<=r.getEpsilon())return null;c=1/c,o*=c,a*=c,s*=c;const l=Math.sin(t),u=Math.cos(t),d=1-u;return e[0]=o*o*d+u,e[1]=a*o*d+s*l,e[2]=s*o*d-a*l,e[3]=0,e[4]=o*a*d-s*l,e[5]=a*a*d+u,e[6]=s*a*d+o*l,e[7]=0,e[8]=o*s*d+a*l,e[9]=a*s*d-o*l,e[10]=s*s*d+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function S(e,t){const r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(e,t){const r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t){const r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t,r){const n=t[0],o=t[1],i=t[2],a=t[3],s=n+n,c=o+o,l=i+i,u=n*s,d=n*c,f=n*l,h=o*c,m=o*l,p=i*l,g=a*s,b=a*c,y=a*l;return e[0]=1-(h+p),e[1]=d+y,e[2]=f-b,e[3]=0,e[4]=d-y,e[5]=1-(u+p),e[6]=m+g,e[7]=0,e[8]=f+b,e[9]=m-g,e[10]=1-(u+h),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function I(e,t){const r=P,n=-t[0],o=-t[1],i=-t[2],a=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=n*n+o*o+i*i+a*a;return d>0?(r[0]=2*(s*a+u*n+c*i-l*o)/d,r[1]=2*(c*a+u*o+l*n-s*i)/d,r[2]=2*(l*a+u*i+s*o-c*n)/d):(r[0]=2*(s*a+u*n+c*i-l*o),r[1]=2*(c*a+u*o+l*n-s*i),r[2]=2*(l*a+u*i+s*o-c*n)),T(e,t,r),e}const P=t.create();function E(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function O(e,t){const r=t[0],n=t[1],o=t[2],i=t[4],a=t[5],s=t[6],c=t[8],l=t[9],u=t[10];return e[0]=Math.sqrt(r*r+n*n+o*o),e[1]=Math.sqrt(i*i+a*a+s*s),e[2]=Math.sqrt(c*c+l*l+u*u),e}function A(e,t){const r=t[0]+t[5]+t[10];let n=0;return r>0?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e}function C(e,t,r,n){const o=t[0],i=t[1],a=t[2],s=t[3],c=o+o,l=i+i,u=a+a,d=o*c,f=o*l,h=o*u,m=i*l,p=i*u,g=a*u,b=s*c,y=s*l,M=s*u,v=n[0],S=n[1],w=n[2];return e[0]=(1-(m+g))*v,e[1]=(f+M)*v,e[2]=(h-y)*v,e[3]=0,e[4]=(f-M)*S,e[5]=(1-(d+g))*S,e[6]=(p+b)*S,e[7]=0,e[8]=(h+y)*w,e[9]=(p-b)*w,e[10]=(1-(d+m))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function _(e,t,r,n,o){const i=t[0],a=t[1],s=t[2],c=t[3],l=i+i,u=a+a,d=s+s,f=i*l,h=i*u,m=i*d,p=a*u,g=a*d,b=s*d,y=c*l,M=c*u,v=c*d,S=n[0],w=n[1],x=n[2],T=o[0],I=o[1],P=o[2],E=(1-(p+b))*S,O=(h+v)*S,A=(m-M)*S,C=(h-v)*w,_=(1-(f+b))*w,R=(g+y)*w,N=(m+M)*x,U=(g-y)*x,j=(1-(f+p))*x;return e[0]=E,e[1]=O,e[2]=A,e[3]=0,e[4]=C,e[5]=_,e[6]=R,e[7]=0,e[8]=N,e[9]=U,e[10]=j,e[11]=0,e[12]=r[0]+T-(E*T+C*I+N*P),e[13]=r[1]+I-(O*T+_*I+U*P),e[14]=r[2]+P-(A*T+R*I+j*P),e[15]=1,e}function R(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],a=r+r,s=n+n,c=o+o,l=r*a,u=n*a,d=n*s,f=o*a,h=o*s,m=o*c,p=i*a,g=i*s,b=i*c;return e[0]=1-d-m,e[1]=u+b,e[2]=f-g,e[3]=0,e[4]=u-b,e[5]=1-l-m,e[6]=h+p,e[7]=0,e[8]=f+g,e[9]=h-p,e[10]=1-l-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,t,r,n,o,i,a){const s=1/(r-t),c=1/(o-n),l=1/(i-a);return e[0]=2*i*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*c,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(o+n)*c,e[10]=(a+i)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*i*2*l,e[15]=0,e}function U(e,t,r,n,o){const i=1/Math.tan(t/2);let a;return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=o&&o!==1/0?(a=1/(n-o),e[10]=(o+n)*a,e[14]=2*o*n*a):(e[10]=-1,e[14]=-2*n),e}function j(e,t,r,n){const o=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),c=2/(a+s),l=2/(o+i);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(a-s)*c*.5,e[9]=(o-i)*l*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function L(e,t,r,n,o,i,a){const s=1/(t-r),c=1/(n-o),l=1/(i-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*s,e[13]=(o+n)*c,e[14]=(a+i)*l,e[15]=1,e}function k(e,t,n,o){const a=t[0],s=t[1],c=t[2];let l=a-n[0],u=s-n[1],d=c-n[2];const f=r.getEpsilon();if(Math.abs(l)<f&&Math.abs(u)<f&&Math.abs(d)<f)return void i(e);let h=1/Math.sqrt(l*l+u*u+d*d);l*=h,u*=h,d*=h;const m=o[0],p=o[1],g=o[2];let b=p*d-g*u,y=g*l-m*d,M=m*u-p*l;h=Math.sqrt(b*b+y*y+M*M),h?(h=1/h,b*=h,y*=h,M*=h):(b=0,y=0,M=0);let v=u*M-d*y,S=d*b-l*M,w=l*y-u*b;h=Math.sqrt(v*v+S*S+w*w),h?(h=1/h,v*=h,S*=h,w*=h):(v=0,S=0,w=0),e[0]=b,e[1]=v,e[2]=l,e[3]=0,e[4]=y,e[5]=S,e[6]=u,e[7]=0,e[8]=M,e[9]=w,e[10]=d,e[11]=0,e[12]=-(b*a+y*s+M*c),e[13]=-(v*a+S*s+w*c),e[14]=-(l*a+u*s+d*c),e[15]=1}function F(e,t,r,n){const o=t[0],i=t[1],a=t[2],s=n[0],c=n[1],l=n[2];let u=o-r[0],d=i-r[1],f=a-r[2],h=u*u+d*d+f*f;h>0&&(h=1/Math.sqrt(h),u*=h,d*=h,f*=h);let m=c*f-l*d,p=l*u-s*f,g=s*d-c*u;return h=m*m+p*p+g*g,h>0&&(h=1/Math.sqrt(h),m*=h,p*=h,g*=h),e[0]=m,e[1]=p,e[2]=g,e[3]=0,e[4]=d*g-f*p,e[5]=f*m-u*g,e[6]=u*p-d*m,e[7]=0,e[8]=u,e[9]=d,e[10]=f,e[11]=0,e[12]=o,e[13]=i,e[14]=a,e[15]=1,e}function D(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function V(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function B(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function q(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function z(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function W(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function H(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function G(e,t){if(e===t)return!0;const n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],c=e[5],l=e[6],u=e[7],d=e[8],f=e[9],h=e[10],m=e[11],p=e[12],g=e[13],b=e[14],y=e[15],M=t[0],v=t[1],S=t[2],w=t[3],x=t[4],T=t[5],I=t[6],P=t[7],E=t[8],O=t[9],A=t[10],C=t[11],_=t[12],R=t[13],N=t[14],U=t[15],j=r.getEpsilon();return Math.abs(n-M)<=j*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(o-v)<=j*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(i-S)<=j*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(a-w)<=j*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-x)<=j*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(c-T)<=j*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(l-I)<=j*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(u-P)<=j*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(d-E)<=j*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(f-O)<=j*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(h-A)<=j*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(m-C)<=j*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(p-_)<=j*Math.max(1,Math.abs(p),Math.abs(_))&&Math.abs(g-R)<=j*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(b-N)<=j*Math.max(1,Math.abs(b),Math.abs(N))&&Math.abs(y-U)<=j*Math.max(1,Math.abs(y),Math.abs(U))}function $(e){const t=r.getEpsilon(),n=e[0],o=e[1],i=e[2],a=e[4],s=e[5],c=e[6],l=e[8],u=e[9],d=e[10];return Math.abs(1-(n*n+a*a+l*l))<=t&&Math.abs(1-(o*o+s*s+u*u))<=t&&Math.abs(1-(i*i+c*c+d*d))<=t}function Q(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[8]&&0===e[9]&&1===e[10]}const Y=d,J=q,X=Object.freeze(Object.defineProperty({__proto__:null,add:B,adjoint:l,copy:n,determinant:u,equals:G,exactEquals:H,frob:V,fromQuat:R,fromQuat2:I,fromRotation:v,fromRotationTranslation:T,fromRotationTranslationScale:C,fromRotationTranslationScaleOrigin:_,fromScaling:M,fromTranslation:y,fromXRotation:S,fromYRotation:w,fromZRotation:x,frustum:N,getRotation:A,getScale:O,getTranslation:E,hasIdentityRotation:Q,identity:i,invert:c,invertOrIdentity:s,isOrthoNormal:$,lookAt:k,mul:Y,multiply:d,multiplyScalar:z,multiplyScalarAndAdd:W,ortho:L,perspective:U,perspectiveFromFieldOfView:j,rotate:m,rotateX:p,rotateY:g,rotateZ:b,scale:h,set:o,str:D,sub:J,subtract:q,targetTo:F,translate:f,transpose:a},Symbol.toStringTag,{value:"Module"}));e.add=B,e.adjoint=l,e.copy=n,e.determinant=u,e.equals=G,e.exactEquals=H,e.frob=V,e.fromQuat=R,e.fromQuat2=I,e.fromRotation=v,e.fromRotationTranslation=T,e.fromRotationTranslationScale=C,e.fromRotationTranslationScaleOrigin=_,e.fromScaling=M,e.fromTranslation=y,e.fromXRotation=S,e.fromYRotation=w,e.fromZRotation=x,e.frustum=N,e.getRotation=A,e.getScale=O,e.getTranslation=E,e.hasIdentityRotation=Q,e.identity=i,e.invert=c,e.invertOrIdentity=s,e.isOrthoNormal=$,e.lookAt=k,e.mat4=X,e.mul=Y,e.multiply=d,e.multiplyScalar=z,e.multiplyScalarAndAdd=W,e.ortho=L,e.perspective=U,e.perspectiveFromFieldOfView=j,e.rotate=m,e.rotateX=p,e.rotateY=g,e.rotateZ=b,e.scale=h,e.set=o,e.str=D,e.sub=J,e.subtract=q,e.targetTo=F,e.translate=f,e.transpose=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/vec32":function(){define(["exports","../core/libs/gl-matrix-2/factories/vec3f64","../core/libs/gl-matrix-2/math/common"],(function(e,t,r){"use strict";function n(e){const t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function i(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function a(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function s(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function c(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function l(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function u(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function d(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function f(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function h(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function m(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function p(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function g(e,t=0,r=1){return e[0]=Math.min(Math.max(e[0],t),r),e[1]=Math.min(Math.max(e[1],t),r),e[2]=Math.min(Math.max(e[2],t),r),e}function b(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function y(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function M(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function v(e,t){const r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(r*r+n*n+o*o)}function S(e,t){const r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return r*r+n*n+o*o}function w(e){const t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function x(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function T(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function I(e,t){const r=t[0],n=t[1],o=t[2];let i=r*r+n*n+o*o;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i),e}function P(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function E(e,t,r){const n=t[0],o=t[1],i=t[2],a=r[0],s=r[1],c=r[2];return e[0]=o*c-i*s,e[1]=i*a-n*c,e[2]=n*s-o*a,e}function O(e,t,r){const n=t[0],o=t[1],i=t[2],a=r[0],s=r[1],c=r[2],l=o*c-i*s,u=i*a-n*c,d=n*s-o*a,f=Math.sqrt(l*l+u*u+d*d);return e[0]=l/f,e[1]=u/f,e[2]=d/f,e}function A(e,t,r,n){const o=t[0],i=t[1],a=t[2];return e[0]=o+n*(r[0]-o),e[1]=i+n*(r[1]-i),e[2]=a+n*(r[2]-a),e}function C(e,t,r,n,o,i){const a=i*i,s=a*(2*i-3)+1,c=a*(i-2)+i,l=a*(i-1),u=a*(3-2*i);return e[0]=t[0]*s+r[0]*c+n[0]*l+o[0]*u,e[1]=t[1]*s+r[1]*c+n[1]*l+o[1]*u,e[2]=t[2]*s+r[2]*c+n[2]*l+o[2]*u,e}function _(e,t,r,n,o,i){const a=1-i,s=a*a,c=i*i,l=s*a,u=3*i*s,d=3*c*a,f=c*i;return e[0]=t[0]*l+r[0]*u+n[0]*d+o[0]*f,e[1]=t[1]*l+r[1]*u+n[1]*d+o[1]*f,e[2]=t[2]*l+r[2]*u+n[2]*d+o[2]*f,e}function R(e,t=1){const n=r.RANDOM,o=2*n()*Math.PI,i=2*n()-1,a=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(o)*a,e[1]=Math.sin(o)*a,e[2]=i*t,e}function N(e,t,r){const n=t[0],o=t[1],i=t[2];return e[0]=r[0]*n+r[4]*o+r[8]*i+r[12],e[1]=r[1]*n+r[5]*o+r[9]*i+r[13],e[2]=r[2]*n+r[6]*o+r[10]*i+r[14],e}function U(e,t,r){const n=t[0],o=t[1],i=t[2];return e[0]=n*r[0]+o*r[3]+i*r[6],e[1]=n*r[1]+o*r[4]+i*r[7],e[2]=n*r[2]+o*r[5]+i*r[8],e}function j(e,t,r){const n=r[0],o=r[1],i=r[2],a=r[3],s=t[0],c=t[1],l=t[2],u=o*l-i*c,d=i*s-n*l,f=n*c-o*s,h=o*f-i*d,m=i*u-n*f,p=n*d-o*u,g=2*a;return e[0]=s+u*g+2*h,e[1]=c+d*g+2*m,e[2]=l+f*g+2*p,e}function L(e,t,r,n){const o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[0],i[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),i[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function k(e,t,r,n){const o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),i[1]=o[1],i[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function F(e,t,r,n){const o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),i[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),i[2]=o[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function D(e,t){I(V,e),I(B,t);const r=P(V,B);return r>1?0:r<-1?Math.PI:Math.acos(r)}const V=t.create(),B=t.create();function q(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function z(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function W(e,t){if(e===t)return!0;const n=e[0],o=e[1],i=e[2],a=t[0],s=t[1],c=t[2],l=r.getEpsilon();return Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(o-s)<=l*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(i-c)<=l*Math.max(1,Math.abs(i),Math.abs(c))}function H(e,t,r){const n=r[0]-t[0],o=r[1]-t[1],i=r[2]-t[2];let a=n*n+o*o+i*i;return a>0?(a=1/Math.sqrt(a),e[0]=n*a,e[1]=o*a,e[2]=i*a,e):(e[0]=0,e[1]=0,e[2]=0,e)}const G=s,$=c,Q=l,Y=v,J=S,X=n,Z=w,K=Object.freeze(Object.defineProperty({__proto__:null,abs:f,add:a,angle:D,bezier:_,ceil:u,clamp:g,copy:o,cross:E,crossAndNormalize:O,direction:H,dist:Y,distance:v,div:Q,divide:l,dot:P,equals:W,exactEquals:z,floor:d,hermite:C,inverse:T,len:X,length:n,lerp:A,max:p,min:m,mul:$,multiply:c,negate:x,normalize:I,random:R,rotateX:L,rotateY:k,rotateZ:F,round:b,scale:y,scaleAndAdd:M,set:i,sign:h,sqrDist:J,sqrLen:Z,squaredDistance:S,squaredLength:w,str:q,sub:G,subtract:s,transformMat3:U,transformMat4:N,transformQuat:j},Symbol.toStringTag,{value:"Module"}));e.abs=f,e.add=a,e.angle=D,e.bezier=_,e.ceil=u,e.clamp=g,e.copy=o,e.cross=E,e.crossAndNormalize=O,e.direction=H,e.dist=Y,e.distance=v,e.div=Q,e.divide=l,e.dot=P,e.equals=W,e.exactEquals=z,e.floor=d,e.hermite=C,e.inverse=T,e.len=X,e.length=n,e.lerp=A,e.max=p,e.min=m,e.mul=$,e.multiply=c,e.negate=x,e.normalize=I,e.random=R,e.rotateX=L,e.rotateY=k,e.rotateZ=F,e.round=b,e.scale=y,e.scaleAndAdd=M,e.set=i,e.sign=h,e.sqrDist=J,e.sqrLen=Z,e.squaredDistance=S,e.squaredLength=w,e.str=q,e.sub=G,e.subtract=s,e.transformMat3=U,e.transformMat4=N,e.transformQuat=j,e.vec3=K}))},"esri/geometry/support/ray":function(){define(["exports","../../core/arrayUtils","../../core/ObjectStack","../../core/libs/gl-matrix-2/math/mat3","../../core/libs/gl-matrix-2/factories/mat3f64","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./vectorStacks"],(function(e,t,r,n,o,i,a,s){"use strict";function c(e){return e?l(a.clone(e.origin),a.clone(e.direction)):l(a.create(),a.create())}function l(e,t){return{origin:e,direction:t}}function u(e,t,r=c()){return i.copy(r.origin,e),i.copy(r.direction,t),r}const d=new r.ObjectStack((()=>c())),f=a.create(),h=a.create(),m=a.create(),p=o.create();e.closestPoint=function(e,t,r){const n=i.dot(e.direction,i.subtract(r,t,e.origin));return i.add(r,e.origin,i.scale(r,e.direction,n)),r},e.closestPoints=function(e,t,r,o){const a=e.origin,s=t.origin,c=e.direction,l=t.direction,u=i.dot(i.normalize(h,c),i.normalize(m,l));if(Math.abs(u)>=1)return null;const d=i.cross(h,c,l),g=i.sub(f,s,a),b=n.set(p,c[0],c[1],c[2],-l[0],-l[1],-l[2],d[0],d[1],d[2]),y=n.invert(p,b);if(null==y)return[r,o];const M=i.dot(i.set(h,y[0],y[3],y[6]),g),v=i.dot(i.set(m,y[1],y[4],y[7]),g);return i.add(r,a,i.scale(f,c,M)),i.add(o,s,i.scale(f,l,v)),[r,o]},e.copy=function(e,t=c()){return u(e.origin,e.direction,t)},e.create=c,e.distance2=function(e,t){const r=i.cross(s.sv3d.get(),i.normalize(s.sv3d.get(),e.direction),i.subtract(s.sv3d.get(),t,e.origin));return i.dot(r,r)},e.equals=function(e,r){return t.equals(e.origin,r.origin)&&t.equals(e.direction,r.direction)},e.fromPoints=function(e,t,r=c()){return i.copy(r.origin,e),i.subtract(r.direction,t,e),r},e.fromValues=u,e.wrap=function(e,t){const r=d.get();return r.origin=e,r.direction=t,r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],(function(e,t){"use strict";e.ObjectStack=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&t.nextTick((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,1024));e++)this._items.push(this._allocator())}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["exports","./common"],(function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function o(e,t,r,n,o,i,a,s,c,l){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e[4]=i,e[5]=a,e[6]=s,e[7]=c,e[8]=l,e}function i(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function a(e,t){if(e===t){const r=t[1],n=t[2],o=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=o}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function s(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=u*a-s*l,f=-u*i+s*c,h=l*i-a*c;let m=r*d+n*f+o*h;return m?(m=1/m,e[0]=d*m,e[1]=(-u*n+o*l)*m,e[2]=(s*n-o*a)*m,e[3]=f*m,e[4]=(u*r-o*c)*m,e[5]=(-s*r+o*i)*m,e[6]=h*m,e[7]=(-l*r+n*c)*m,e[8]=(a*r-n*i)*m,e):null}function c(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],c=t[6],l=t[7],u=t[8];return e[0]=a*u-s*l,e[1]=o*l-n*u,e[2]=n*s-o*a,e[3]=s*c-i*u,e[4]=r*u-o*c,e[5]=o*i-r*s,e[6]=i*l-a*c,e[7]=n*c-r*l,e[8]=r*a-n*i,e}function l(e){const t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],a=e[5],s=e[6],c=e[7],l=e[8];return t*(l*i-a*c)+r*(-l*o+a*s)+n*(c*o-i*s)}function u(e,t,r){const n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=r[0],h=r[1],m=r[2],p=r[3],g=r[4],b=r[5],y=r[6],M=r[7],v=r[8];return e[0]=f*n+h*a+m*l,e[1]=f*o+h*s+m*u,e[2]=f*i+h*c+m*d,e[3]=p*n+g*a+b*l,e[4]=p*o+g*s+b*u,e[5]=p*i+g*c+b*d,e[6]=y*n+M*a+v*l,e[7]=y*o+M*s+v*u,e[8]=y*i+M*c+v*d,e}function d(e,t,r){const n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=r[0],h=r[1];return e[0]=n,e[1]=o,e[2]=i,e[3]=a,e[4]=s,e[5]=c,e[6]=f*n+h*a+l,e[7]=f*o+h*s+u,e[8]=f*i+h*c+d,e}function f(e,t,r){const n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],f=Math.sin(r),h=Math.cos(r);return e[0]=h*n+f*a,e[1]=h*o+f*s,e[2]=h*i+f*c,e[3]=h*a-f*n,e[4]=h*s-f*o,e[5]=h*c-f*i,e[6]=l,e[7]=u,e[8]=d,e}function h(e,t,r){const n=r[0],o=r[1],i=r[2];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=i*t[6],e[7]=i*t[7],e[8]=i*t[8],e}function m(e,t,r){const n=r[0],o=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e}function p(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function g(e,t){const r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function b(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function y(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function M(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],a=r+r,s=n+n,c=o+o,l=r*a,u=n*a,d=n*s,f=o*a,h=o*s,m=o*c,p=i*a,g=i*s,b=i*c;return e[0]=1-d-m,e[3]=u-b,e[6]=f+g,e[1]=u+b,e[4]=1-l-m,e[7]=h-p,e[2]=f-g,e[5]=h+p,e[8]=1-l-d,e}function v(e,t){const r=t[0],n=t[1],o=t[2],i=t[4],a=t[5],s=t[6],c=t[8],l=t[9],u=t[10],d=u*a-s*l,f=-u*i+s*c,h=l*i-a*c,m=r*d+n*f+o*h;if(!m)return null;const p=1/m;return e[0]=d*p,e[1]=(-u*n+o*l)*p,e[2]=(s*n-o*a)*p,e[3]=f*p,e[4]=(u*r-o*c)*p,e[5]=(-s*r+o*i)*p,e[6]=h*p,e[7]=(-l*r+n*c)*p,e[8]=(a*r-n*i)*p,e}function S(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],f=t[10],h=t[11],m=t[12],p=t[13],g=t[14],b=t[15],y=r*s-n*a,M=r*c-o*a,v=r*l-i*a,S=n*c-o*s,w=n*l-i*s,x=o*l-i*c,T=u*p-d*m,I=u*g-f*m,P=u*b-h*m,E=d*g-f*p,O=d*b-h*p,A=f*b-h*g;let C=y*A-M*O+v*E+S*P-w*I+x*T;return C?(C=1/C,e[0]=(s*A-c*O+l*E)*C,e[1]=(c*P-a*A-l*I)*C,e[2]=(a*O-s*P+l*T)*C,e[3]=(o*O-n*A-i*E)*C,e[4]=(r*A-o*P+i*I)*C,e[5]=(n*P-r*O-i*T)*C,e[6]=(p*x-g*w+b*S)*C,e[7]=(g*v-m*x-b*M)*C,e[8]=(m*w-p*v+b*y)*C,e):null}function w(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function x(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function T(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function I(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function P(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function E(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function O(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e}function A(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function C(e,r){const n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],c=e[5],l=e[6],u=e[7],d=e[8],f=r[0],h=r[1],m=r[2],p=r[3],g=r[4],b=r[5],y=r[6],M=r[7],v=r[8],S=t.getEpsilon();return Math.abs(n-f)<=S*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-h)<=S*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(i-m)<=S*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(a-p)<=S*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-g)<=S*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(c-b)<=S*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(l-y)<=S*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(u-M)<=S*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(d-v)<=S*Math.max(1,Math.abs(d),Math.abs(v))}function _(e){const r=t.getEpsilon(),n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],c=e[5],l=e[6],u=e[7],d=e[8];return Math.abs(1-(n*n+a*a+l*l))<=r&&Math.abs(1-(o*o+s*s+u*u))<=r&&Math.abs(1-(i*i+c*c+d*d))<=r}const R=u,N=P,U=Object.freeze(Object.defineProperty({__proto__:null,add:I,adjoint:c,copy:n,determinant:l,equals:C,exactEquals:A,frob:T,fromMat2d:y,fromMat4:r,fromQuat:M,fromRotation:g,fromScaling:b,fromTranslation:p,identity:i,invert:s,isOrthoNormal:_,mul:R,multiply:u,multiplyScalar:E,multiplyScalarAndAdd:O,normalFromMat4:S,normalFromMat4Legacy:v,projection:w,rotate:f,scale:h,scaleByVec2:m,set:o,str:x,sub:N,subtract:P,translate:d,transpose:a},Symbol.toStringTag,{value:"Module"}));e.add=I,e.adjoint=c,e.copy=n,e.determinant=l,e.equals=C,e.exactEquals=A,e.frob=T,e.fromMat2d=y,e.fromMat4=r,e.fromQuat=M,e.fromRotation=g,e.fromScaling=b,e.fromTranslation=p,e.identity=i,e.invert=s,e.isOrthoNormal=_,e.mat3=U,e.mul=R,e.multiply=u,e.multiplyScalar=E,e.multiplyScalarAndAdd=O,e.normalFromMat4=S,e.normalFromMat4Legacy=v,e.projection=w,e.rotate=f,e.scale=h,e.scaleByVec2=m,e.set=o,e.str=x,e.sub=N,e.subtract=P,e.translate=d,e.transpose=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["exports"],(function(e){"use strict";function t(){return[1,0,0,0,1,0,0,0,1]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function n(e,t,r,n,o,i,a,s,c){return[e,t,r,n,o,i,a,s,c]}const o=[1,0,0,0,1,0,0,0,1],i=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:t,fromValues:n},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=o,e.clone=r,e.create=t,e.fromValues=n,e.mat3f64=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],(function(e,t){"use strict";const r=t.VectorStack.createVec2f64(),n=t.VectorStack.createVec3f64(),o=t.VectorStack.createVec4f64(),i=t.VectorStack.createMat3f64(),a=t.VectorStack.createMat4f64(),s=t.VectorStack.createQuatf64();e.sm3d=i,e.sm4d=a,e.sq4d=s,e.sv2d=r,e.sv3d=n,e.sv4d=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/VectorStack":function(){define(["exports","./has","./nextTick","./libs/gl-matrix-2/factories/mat3f64","./libs/gl-matrix-2/factories/mat4f64","./libs/gl-matrix-2/factories/quatf64","./libs/gl-matrix-2/factories/vec2f64","./libs/gl-matrix-2/factories/vec3f64","./libs/gl-matrix-2/factories/vec4f64"],(function(e,t,r,n,o,i,a,s,c){"use strict";class l{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&r.nextTick((()=>this._reset())),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new l(a.create)}static createVec3f64(){return new l(s.create)}static createVec4f64(){return new l(c.create)}static createMat3f64(){return new l(n.create)}static createMat4f64(){return new l(o.create)}static createQuatf64(){return new l(i.create)}get test(){}}e.VectorStack=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["exports"],(function(e){"use strict";function t(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function n(e,t,r,n,o,i,a,s,c,l,u,d,f,h,m,p){return[e,t,r,n,o,i,a,s,c,l,u,d,f,h,m,p]}const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:t,fromValues:n},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=o,e.clone=r,e.create=t,e.fromValues=n,e.mat4f64=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["exports"],(function(e){"use strict";function t(){return[0,0,0,1]}function r(e){return[e[0],e[1],e[2],e[3]]}function n(e,t,r,n){return[e,t,r,n]}const o=[0,0,0,1],i=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:t,fromValues:n},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=o,e.clone=r,e.create=t,e.fromValues=n,e.quatf64=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],(function(e){"use strict";function t(){return[0,0]}function r(e){return[e[0],e[1]]}function n(e,t){return[e,t]}function o(e,t){return[e,t]}function i(e,t=[0,0]){const r=Math.min(2,e.length);for(let n=0;n<r;++n)t[n]=e[n];return t}function a(){return[0,0]}function s(){return n(1,1)}function c(){return n(1,0)}function l(){return n(0,1)}const u=[0,0],d=s(),f=c(),h=l(),m=Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:f,UNIT_Y:h,ZEROS:u,clone:r,create:t,freeze:o,fromArray:i,fromValues:n,ones:s,unitX:c,unitY:l,zeros:a},Symbol.toStringTag,{value:"Module"}));e.ONES=d,e.UNIT_X=f,e.UNIT_Y=h,e.ZEROS=u,e.clone=r,e.create=t,e.freeze=o,e.fromArray=i,e.fromValues=n,e.ones=s,e.unitX=c,e.unitY=l,e.vec2f64=m,e.zeros=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/sphereUtils":function(){define(["exports","../../core/mathUtils","../../chunks/vec32"],(function(e,t,r){"use strict";e.cartesianToSpherical=function(e,n){const o=r.length(e),i=t.asinClamped(e[2]/o),a=Math.atan2(e[1]/o,e[0]/o);return r.set(n,o,i,a),n},e.sphericalToCartesian=function(e,t){const n=e[0],o=e[1],i=e[2],a=Math.cos(o);r.set(t,n*a*Math.cos(i),n*a*Math.sin(i),n*Math.sin(o))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64"],(function(e,t,r,n){"use strict";const o=n.create(),i=n.create();e.angle=function(e,n){const o=r.dot(e,n)/(r.length(e)*r.length(n));return-t.acosClamped(o)},e.angleAroundAxis=function(e,n,a){r.normalize(o,e),r.normalize(i,n);const s=r.dot(o,i),c=t.acosClamped(s),l=r.cross(o,o,i);return r.dot(l,a)<0?2*Math.PI-c:c},e.projectPoint=function(e,t,n){const o=r.dot(e,t)/r.dot(e,e);return r.scale(n,e,o)},e.projectPointSignedLength=function(e,t){return r.dot(e,t)/r.length(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/i3s/I3SUtil":function(){define(["exports","../../../../request","../../../../core/arrayUtils","../../../../core/Error","../../../../core/has","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/projectionUtils","../../../../geometry/SpatialReference","../../../../geometry/projection/projectVectorToVector","../../../../geometry/support/aaBoundingRect","../../../../chunks/sphere","../../../../layers/support/featurePopupQueryUtils","../../../../rest/support/Query","./I3SBinaryReader","./I3SProjectionUtil","../support/edgeUtils","../support/symbolColorUtils","../../support/orientedBoundingBox","../../../support/layerViewUtils"],(function(e,t,r,n,o,i,a,s,c,l,u,d,f,h,m,p,g,b,y,M,v,S){"use strict";function w(e){return e?parseInt(e.slice(e.lastIndexOf("/")+1),10):void 0}const x=f.create();var T;function I(t,r){const n=r[0],o=r[1],i=r[3],a=t[0]-n,s=n-t[2],c=t[1]-o,l=o-t[3],u=Math.max(a,s,0),d=Math.max(c,l,0),f=u*u+d*d;return f>i*i?e.MbsIntersectResult.OUTSIDE:f>0?e.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(a,s,c,l)>i?e.MbsIntersectResult.INSIDE:e.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}function P(e,t,r){const n=[],o=r?.missingFields,i=r?.originalFields;let a=!1;for(const r of e){const e=t.get(r);e?(i?.push(r),n.push(e.name),r!==e.name&&(a=!0)):o?.push(r)}return r&&"hasMismatchedCasing"in r&&(r.hasMismatchedCasing=a),n}function E(e,t,r,n){if(null!=t&&"number"==typeof t)return e.featureIds.indexOf(t);if(null==n||null==r)return-1;const o=e.attributeInfo?.attributeData?.[r];return o?o.indexOf(n):-1}async function O(e,r,n,o,i,a,s,c){const l=[];for(const t of r)if(t&&i.includes(t.name)){const r=`${e}/nodes/${n}/attributes/${t.key}/0`;l.push({url:r,storageInfo:t})}const u=await Promise.allSettled(l.map((e=>t(e.url,{responseType:"array-buffer",query:{...s,token:a},signal:c?.signal}).then((t=>g.readBinaryAttribute(e.storageInfo,t.data)))))),d=[];for(const e of o){const t={};for(let r=0;r<u.length;r++){const n=u[r];if("fulfilled"===n.status){const o=n.value;t[l[r].storageInfo.name]=g.getCachedAttributeValue(o,e)}}d.push(t)}return d}function A(e){const t=e.store,r=t.indexCRS||t.geographicCRS,o=void 0===r?t.indexWKT:void 0;if(o){if(!e.spatialReference)throw new n("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indexWKT in the scene layer store but no layer spatial reference",{});if(o!==e.spatialReference.wkt)throw new n("layerview:store-spatial-reference-wkt-index-incompatible","The indexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const i=r?new u(w(r)):e.spatialReference;return i.equals(e.spatialReference)?e.spatialReference:i}function C(e){const t=e.store,r=t.vertexCRS||t.projectedCRS,o=void 0===r?t.vertexWKT:void 0;if(o){if(!e.spatialReference)throw new n("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(o!==e.spatialReference.wkt)throw new n("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const i=r?new u(w(r)):e.spatialReference;return i.equals(e.spatialReference)?e.spatialReference:i}function _(e,t,r){if(!l.canProjectWithoutEngine(e,t))throw S.spatialReferenceIncompatibleError("scene layer",e?.wkid,t?.wkid);if("local"===r&&!R(e,t))throw S.spatialReferenceIncompatibleError("scene layer",e?.wkid,t?.wkid)}function R(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function N(e,t,r){const n=A(e),o=C(e);_(n,t,r),_(o,t,r)}function U(e){return"mesh-3d"===e.type}e.MbsIntersectResult=void 0,(T=e.MbsIntersectResult||(e.MbsIntersectResult={}))[T.OUTSIDE=0]="OUTSIDE",T[T.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",T[T.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",T[T.INSIDE=3]="INSIDE";const j=y.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});class L{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}const k=[c.create(),c.create(),c.create(),c.create(),c.create(),c.create(),c.create(),c.create()],F=f.create(),D=f.create(),V=new v.Obb,B=c.create(),q={data:new Array(72),size:3,exclusive:!0,stride:3},z=a.create();e.SymbolInfo=L,e.addWraparound=function(e,t){return(0|e)+(0|t)|0},e.checkPointCloudLayerCompatibleWithView=function(e,t){_(e.spatialReference,t.spatialReference,t.viewingMode)},e.checkPointCloudLayerValid=function(e){if(null==e.store?.defaultGeometrySchema||null==(t=e.store.defaultGeometrySchema).geometryType||"points"!==t.geometryType||null!=t.topology&&"PerAttributeArray"!==t.topology||null!=t.encoding&&""!==t.encoding&&"lepcc-xyz"!==t.encoding||null==t.vertexAttributes?.position)throw new n("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});var t},e.checkRecyclable=function(e,t,r){if(e.serviceUpdateTimeStamp?.lastUpdate!==t.serviceUpdateTimeStamp?.lastUpdate||!r.isEmpty||e.associatedLayer?.url!==t.associatedLayer?.url)throw new n("layerview:recycle-failed","Could not recycle layerview")},e.checkSceneLayerCompatibleWithView=function(e,t){N(e,t.spatialReference,t.viewingMode)},e.checkSceneLayerValid=function(e){if(null==e.store?.defaultGeometrySchema||null!=(t=e.store.defaultGeometrySchema).geometryType&&"triangles"!==t.geometryType||null!=t.topology&&"PerAttributeArray"!==t.topology||null==t.vertexAttributes?.position)throw new n("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path});var t},e.checkSpatialReference=_,e.checkSpatialReferences=N,e.computeVisibilityObb=function(e,t,r,n,o,a,c){if(!a||0===a.length||null==t||!e.serviceMbsInIndexSR)return null;const l=b.computeGlobalTransformation(e.serviceMbsInIndexSR,o,"none",r,t);i.invert(z,l);let u=null,m=1/0,p=-1/0;if(a.forEach((i=>(i=>{if("replace"!==i.type)return;const a=i.geometry;if(!a?.hasZ)return;f.empty(F);const l=a.spatialReference||n,g=a.rings.reduce(((e,r)=>r.reduce(((e,r)=>(s.set(B,r[0],r[1],r[2]),d.projectVectorToVector(B,l,B,t),s.transformMat4(B,B,z),f.expandPointInPlace(F,B),Math.min(B[2],e))),e)),1/0);(()=>{if(!u)if(u=k,f.empty(D),null!=e.serviceObbInIndexSR){e.serviceObbInIndexSR.transform(V,r,t,o,c),V.getCorners(u);for(const e of u)s.transformMat4(e,e,z),f.expandPointInPlace(D,e)}else{const n=e.serviceMbsInIndexSR;if(!n)return;const i=n[3];d.projectVectorToVector(h.getCenter(n),r,B,t),s.transformMat4(B,B,z),B[2]+=o;for(let e=0;e<8;++e){const t=1&e?i:-i,r=2&e?i:-i,n=4&e?i:-i,o=u[e];s.copy(o,[B[0]+t,B[1]+r,B[2]+n]),f.expandPointInPlace(D,o)}}})(),f.intersects(D,F)&&(m=Math.min(m,g),p=Math.max(p,g))})(i))),m===1/0)return null;for(let e=0;e<8;++e)g=q.data,y=3*e,M=u[e],s.transformMat4(B,M,l),g[y]=B[0],g[y+1]=B[1],g[y+2]=B[2],y+=24,M[2]=m,s.transformMat4(B,M,l),g[y]=B[0],g[y+1]=B[1],g[y+2]=B[2],y+=24,M[2]=p,s.transformMat4(B,M,l),g[y]=B[0],g[y+1]=B[1],g[y+2]=B[2];var g,y,M;return v.compute(q)},e.containsDraco=function(e){if(o("disable-feature:i3s-draco")||!e)return!1;for(const t of e)for(const e of t.geometryBuffers)if("draco"===e.compressedAttributes?.encoding)return!0;return!1},e.extractWkid=w,e.filterInPlace=function(e,t,r){let n=0,o=0;for(let i=0;i<t.length&&n<e.length;i++)e[n]===t[i]&&(r(i)&&(e[o]=e[n],o++),n++);e.length=o},e.findFieldsCaseInsensitive=P,e.findIntersectingNodes=function(t,r,n,o){n.traverse(r,(r=>{const n=r.serviceMbsInIndexSR;return(null!=n&&I(t,n))!==e.MbsIntersectResult.OUTSIDE&&(o(r),!0)}))},e.getClipRect=function(e,t){if(0===t.rotationScale[1]&&0===t.rotationScale[2]&&0===t.rotationScale[3]&&0===t.rotationScale[5]&&0===t.rotationScale[6]&&0===t.rotationScale[7])return x[0]=(e[0]-t.position[0])/t.rotationScale[0],x[1]=(e[1]-t.position[1])/t.rotationScale[4],x[2]=(e[2]-t.position[0])/t.rotationScale[0],x[3]=(e[3]-t.position[1])/t.rotationScale[4],x},e.getIndexCrs=A,e.getSymbolInfo=function(e){const t=new L;let r=!1,n=!1;for(const o of e.symbolLayers.items)if("fill"===o.type&&o.enabled){const e=o.material,i=o.edges;if(null!=e&&!r){const n=e.color,i=M.parseColorMixMode(e.colorMixMode);t.material=null!=n?{color:[n.r/255,n.g/255,n.b/255],alpha:n.a,colorMixMode:i}:{color:[1,1,1],alpha:1,colorMixMode:M.ColorMixModeEnum.Multiply},t.castShadows=o.castShadows,r=!0}null==i||n||(t.edgeMaterial=y.createMaterialFromEdges(i,{}),n=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:M.ColorMixModeEnum.Multiply}),t},e.getVertexCrs=C,e.intersectBoundingRectWithMbs=I,e.invalidateMbs=function(e){null!=e&&(e[3]=-1)},e.isSupportedLocalModeProjection=R,e.isValidMbs=function(e){return e[3]>=0},e.objectIdFilter=function(e,t,n){let o=0,i=0;for(;o<n.length;)r.binaryIndexOf(e,n[o])>=0===t&&(n[i]=n[o],i++),o++;n.length=i},e.queryAttributesFromCachedAttributesId=O,e.rendererNeedsTextures=function(e){if(null==e||!function(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;const t=e.symbols;if(0===t.length)return!0;for(const e of t){if(!U(e)||0===e.symbolLayers.length)return!0;for(const t of e.symbolLayers.items)if("fill"!==t.type||null==t.material?.color||"replace"!==t.material.colorMixMode)return!0}return!1},e.transparentEdgeMaterial=j,e.whenGraphicAttributes=async function(e,t,r,o,i,a){if(0===t.length)return[];const s=e.attributeStorageInfo;if(null!=e.associatedLayer)try{return await async function(e,t,r,n){const o=[],i={hasMismatchedCasing:!1,originalFields:o},a=P(r,e.fieldsIndex,i),s=new p({outFields:[...a]});if(await m.fetchFeaturePopupFeatures(e,t,s,{updateSourceAttributes:!0,...n}),!i.hasMismatchedCasing)return t;for(let e=0;e<t.length;e++){const r=t[e];if(r.attributes)for(let e=0;e<o.length;e++){const t=o[e],n=a[e];n in r.attributes&&(r.attributes[t]=r.attributes[n],delete r.attributes[n])}}return t}(e.associatedLayer,t,o,a)}catch(t){if(e.associatedLayer.loaded)throw t}if(s){const n=function({globalIdField:e},t,r,n){const o=new Map,i=[],a=n();for(const n of t){const t=n.attributes?.[r],s=null==t?n.getGlobalId():void 0;for(let r=0;r<a.length;r++){const c=a[r],l=E(c,t,e,s);if(l<0)continue;let u=o.get(c.node);u||(u={node:c.node,indices:[],graphics:[]},i.push(u),o.set(c.node,u)),u.indices.push(l),u.graphics.push(n);for(let e=r;e>0;e--)a[e]=a[e-1];a[0]=c;break}}return i}(e,t,r,i),c=e.parsedUrl.path;return await Promise.allSettled(n.map((t=>function(e,t,r,n,o,i,a,s){return O(e,t,r.resources.attributes,n,o,i,a,s)}(c,s,t.node,t.indices,o,e.apiKey,e.customParameters,a).then((e=>{for(let r=0;r<t.graphics.length;r++){const n=t.graphics[r],o=e[r];if(n.attributes)for(const e in n.attributes)e in o||(o[e]=n.attributes[e]);n.attributes=o}}))))),t}throw new n("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/featurePopupQueryUtils":function(){define(["exports","../../core/promiseUtils","../../core/sql","./fieldUtils","../../support/loadArcade"],(function(e,t,r,n,o){"use strict";async function i(e){if(e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some((e=>"expression"===e.type)))return o.loadArcade()}e.fetchFeaturePopupFeatures=async function(e,o,a,s){const c=new Array(o.length),l=new Map,u=new Map,d=n.unpackFieldNames(e.fieldsIndex,a.outFields),f=s?.hasRequiredFields??n.featureHasFields;for(let e=0;e<o.length;e++){const r=o[e];if(r.isAggregate){c[e]=r;continue}let n=!1;if(s?.getPopupTemplate){const e=r.origin?.layer??r.sourceLayer??r.layer,o=s.getPopupTemplate(e);if(null==o)continue;const a=await i(o);t.throwIfAborted(s),n=a&&a.arcadeUtils.hasGeometryOperations(o)}if(n||!f(r,d)){const t=r.getObjectId();if(null!=t){l.set(t,{graphic:r,index:e});continue}const n=r.getGlobalId();if(null!=n){u.set(n,{graphic:r,index:e});continue}}c[e]=r}if(!e.queryFeatures||0===l.size&&0===u.size)return c.filter(Boolean);const h=[],m=(e,t)=>{t&&(e.outFields??=[],e.outFields.includes(t)||e.outFields.push(t))};if(l.size>0){const t=a.clone();m(t,e.objectIdField),"uniqueIdFields"in e&&e.uniqueIdFields?.length&&(t.outFields??=[],t.outFields.push(...e.uniqueIdFields)),t.objectIds=Array.from(l.keys()),h.push({type:"object-id",query:t,map:l})}const p="globalIdField"in e?e.globalIdField:null;if(null!=p&&u.size>0){const e=a.clone();m(e,p);const t=Array.from(u.keys());e.where=r.sqlAnd(a.where,`${p} IN (${t.map((e=>`'${e}'`)).join(",")})`),h.push({type:"global-id",query:e,map:u})}const g=s?.updateSourceAttributes??!1;for(const{type:t,query:r,map:n}of h)try{const o=await e.queryFeatures(r,s);for(const e of o.features){const r="object-id"===t?e.getObjectId():e.getGlobalId();if(null==r)continue;const o=n.get(r);if(!o)continue;const{graphic:i,index:a}=o;if(g&&e.attributes){i.attributes??={};for(const t of d)t in e.attributes&&(i.attributes[t]=e.attributes[t])}const{geometry:s,origin:l}=i;e.geometry||=s,e.origin=l,c[a]=e}}catch{}return c.filter(Boolean)},e.loadFeaturePopupArcadeModules=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define(["exports","../../../../core/Error","../../../../core/lang","../../../../core/Logger","../../../../core/typedArrayUtil","../../../../geometry/support/UCharArray","../../../../geometry/support/UShortArray","./LEPCC","../../webgl-engine/lib/VertexAttribute"],(function(e,t,r,n,o,i,a,s,c){"use strict";const l=()=>n.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function u(e,r,n){let o="",i=0;for(;i<n;){const a=e[r+i];if(a<128)o+=String.fromCharCode(a),i++;else if(a>=192&&a<224){if(i+1>=n)throw new t("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const s=(31&a)<<6|63&e[r+i+1];o+=String.fromCharCode(s),i+=2}else if(a>=224&&a<240){if(i+2>=n)throw new t("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const s=(15&a)<<12|(63&e[r+i+1])<<6|63&e[r+i+2];o+=String.fromCharCode(s),i+=3}else{if(!(a>=240&&a<248))throw new t("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(i+3>=n)throw new t("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const s=(7&a)<<18|(63&e[r+i+1])<<12|(63&e[r+i+2])<<6|63&e[r+i+3];if(s>=65536){const e=55296+(s-65536>>10),t=56320+(1023&s);o+=String.fromCharCode(e,t)}else o+=String.fromCharCode(s);i+=4}}}return o}function d(e,t){const r={byteOffset:0,byteCount:0,fields:Object.create(null)};let n=0;for(let o=0;o<t.length;o++){const i=t[o],a=i.valueType||i.type,s=T[a];r.fields[i.property]=s(e,n),n+=x[a].BYTES_PER_ELEMENT}return r.byteCount=n,r}function f(e,t,r){return h(e,t,r).map((e=>{const t=e?Date.parse(e):null;return null==t||Number.isNaN(t)?null:t}))}function h(e,r,n){const o=[];let i,a,s=0;for(a=0;a<e;a+=1){if(i=r[a],i>0){if(o.push(u(n,s,i-1)),0!==n[s+i-1])throw new t("string-array-error","Invalid string array: missing null termination.")}else o.push(null);s+=i}return o}function m(e,t){return new(0,x[t.valueType])(e,t.byteOffset,t.count*t.valuesPerElement)}function p(e,t){if(!e)return null;const r=e[t];return o.isInt16Array(e)?r===o.minInt16?null:r:o.isInt32Array(e)?r===o.minInt32?null:r:r!=r?null:r}function g(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function b(e,n,o){const i=null!=n.header?d(e,n.header):{byteOffset:0,byteCount:0,fields:{count:o}},a={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let s=i.byteCount;for(let e=0;e<n.ordering.length;e++){const o=n.ordering[e],c=r.clone(n[o]);if(c.count=i.fields.count??0,"String"===c.valueType){if(c.byteOffset=s,c.byteCount=i.fields[o+"ByteCount"],"UTF-8"!==c.encoding)throw new t("unsupported-encoding","Unsupported String encoding.",{encoding:c.encoding});if(c.timeEncoding&&"ECMA_ISO8601"!==c.timeEncoding)throw new t("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:c.timeEncoding})}else{if(!I(c.valueType))throw new t("unsupported-value-type","Unsupported binary valueType",{valueType:c.valueType});{const e=P(c.valueType);s+=s%e!==0?e-s%e:0,c.byteOffset=s,c.byteCount=e*c.valuesPerElement*c.count}}s+=c.byteCount??0,a.entries[o]=c}return a.byteCount=s-a.byteOffset,a}function y(e,r,n){if(r!==e&&l().error(`Invalid ${n} buffer size\n expected: ${e}, actual: ${r})`),r<e)throw new t("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:r})}function M(e){return{isDraco:!1,isLegacy:!1,color:null!=e.color,normal:null!=e.normal,uv0:null!=e.uv0,uvRegion:null!=e.uvRegion,featureIndex:null!=e.faceRange&&null!=e.featureId}}function v(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of e.ordering)if(e.vertexAttributes[r])switch(r){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function S(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of e)switch(r){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}const w={position:c.VertexAttribute.POSITION,normal:c.VertexAttribute.NORMAL,color:c.VertexAttribute.COLOR,uv0:c.VertexAttribute.UV0,region:c.VertexAttribute.UVREGION},x={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},T={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function I(e){return x.hasOwnProperty(e)}function P(e){return I(e)?x[e].BYTES_PER_ELEMENT:0}e.createAttributeDataIndex=b,e.createGeometryDescriptor=function(e,t){return e&&e.compressedAttributes&&"draco"===e.compressedAttributes.encoding?S(e.compressedAttributes.attributes):e?M(e):v(t)},e.createGeometryDescriptorForDraco=S,e.createGeometryDescriptorFromDefinition=M,e.createGeometryDescriptorFromSchema=v,e.createGeometryIndexFromSchema=function(e,t){const r=d(e,t&&t.header);let n=r.byteCount;const o={isDraco:!1,header:r,byteOffset:r.byteCount,byteCount:0,vertexAttributes:{}},i=r.fields,a=null!=i.vertexCount?i.vertexCount:i.count;for(const e of t.ordering){if(!t.vertexAttributes[e])continue;const r={...t.vertexAttributes[e],byteOffset:n,count:a},i=w[e]||"_"+e;o.vertexAttributes[i]=r,n+=P(r.valueType)*r.valuesPerElement*a}const s=i.faceCount;if(t.faces&&s){o.faces={};for(const e of t.ordering){if(!t.faces[e])continue;const r={...t.faces[e],byteOffset:n,count:s};o.faces[e]=r,n+=P(r.valueType)*r.valuesPerElement*s}}const c=i.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&c){o.featureAttributes={};for(const e of t.featureAttributeOrder){if(!t.featureAttributes[e])continue;const r={...t.featureAttributes[e],byteOffset:n,count:c};o.featureAttributes[e]=r,n+=("UInt64"===r.valueType?8:P(r.valueType))*r.valuesPerElement*c}}return y(n,e.byteLength,"geometry"),o.byteCount=n-o.byteOffset,o},e.createRawView=g,e.createTypedView=m,e.getBytesPerValue=P,e.getCachedAttributeValue=p,e.isValueType=I,e.readBinaryAttribute=function(e,r,n,c=!1){if("lepcc-rgb"===e.encoding)return c?s.decodeRGB(r):i.compactUCharArray(s.decodeRGB(r));if("lepcc-intensity"===e.encoding)return c?s.decodeIntensity(r):a.compactUShortArray(s.decodeIntensity(r));if(null!=e.encoding&&""!==e.encoding)throw new t("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(l().warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),"ObjectIds"===e.ordering[0]&&e.hasOwnProperty("objectIds")&&(l().warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const u=b(r,e,n);y(u.byteOffset+u.byteCount,r.byteLength,"attribute");const d=u.entries.attributeValues||u.entries.objectIds;if(d){if("String"===d.valueType){const e=u.entries.attributeByteCounts,t=m(r,e),n=g(r,d);return d.timeEncoding?f(e.count,t,n):h(e.count,t,n)}return c?m(r,d):function(e,t){const r=m(e,t);if(r.length>=o.nativeArrayMaxSize)return r;const n=new Array;return r.forEach(((e,t)=>n.push(p(r,t)))),n}(r,d)}throw new t("bad-attribute-storage-info","Bad attributeStorageInfo specification.")},e.readDateStringArray=f,e.readHeader=d,e.readStringArray=h,e.valueType2ArrayBufferReader=T,e.valueType2TypedArrayClassMap=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/UCharArray":function(){define(["exports","../../core/typedArrayUtil"],(function(e,t){"use strict";e.compactUCharArray=function(e){return Array.isArray(e)?e.length<t.nativeArrayMaxSize?e:new Uint8Array(e):e.length<t.nativeArrayMaxSize?Array.from(e):e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/UShortArray":function(){define(["exports","../../core/typedArrayUtil"],(function(e,t){"use strict";e.compactUShortArray=function(e){return Array.isArray(e)?e.length<t.nativeArrayMaxSize?e:new Uint16Array(e):e.length<t.nativeArrayMaxSize?Array.from(e):e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],(function(e,t){"use strict";const r=!0;function n(e,t,n){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,n+0,10)),version:t.getUint16(n+10,r),checksum:t.getUint32(n+12,r)}}function o(e,t,r){const n=[];t=i(e,t,n);const o=[];for(let a=0;a<n.length;a++){o.length=0,t=i(e,t,o);for(let e=0;e<o.length;e++)r.push(o[e]+n[a])}return t}function i(e,n,o){const i=new DataView(e,n),a=i.getUint8(0),s=31&a,c=!!(32&a),l=(192&a)>>6;let u=0;if(0===l)u=i.getUint32(1,r),n+=5;else if(1===l)u=i.getUint16(1,r),n+=3;else{if(2!==l)throw new t("lepcc-decode-error","Bad count type");u=i.getUint8(1),n+=2}if(c)throw new t("lepcc-decode-error","LUT not implemented");const d=Math.ceil(u*s/8),f=new Uint8Array(e,n,d);let h=0,m=0,p=0;const g=-1>>>32-s;for(let e=0;e<u;e++){for(;m<s;)h|=f[p]<<m,m+=8,p+=1;o[e]=h&g,h>>>=s,m-=s,m+s>32&&(h|=f[p-1]>>8-m)}return n+p}e.decodeIntensity=function(e){const o=new DataView(e,0);let a=0;const{identifier:s,version:c}=n(e,o,a);if(a+=16,"Intensity "!==s)throw new t("lepcc-decode-error","Bad identifier");if(c>1)throw new t("lepcc-decode-error","Unknown version");const l=function(e,t){return{sizeLo:e.getUint32(t+0,r),sizeHi:e.getUint32(t+4,r),count:e.getUint32(t+8,r),scaleFactor:e.getUint16(t+12,r),bitsPerPoint:e.getUint8(t+14),reserved:e.getUint8(t+15)}}(o,a);if(a+=16,l.sizeHi*2**32+l.sizeLo!==e.byteLength)throw new t("lepcc-decode-error","Bad size");const u=new Uint16Array(l.count);if(8===l.bitsPerPoint){if(l.count+a!==e.byteLength)throw new t("lepcc-decode-error","Bad size");const r=new Uint8Array(e,a,l.count);for(let e=0;e<l.count;e++)u[e]=r[e]*l.scaleFactor}else if(16===l.bitsPerPoint){if(2*l.count+a!==e.byteLength)throw new t("lepcc-decode-error","Bad size");const r=new Uint16Array(e,a,l.count);for(let e=0;e<l.count;e++)u[e]=r[e]*l.scaleFactor}else{const r=[];if(i(e,a,r)!==e.byteLength)throw new t("lepcc-decode-error","Bad size");for(let e=0;e<l.count;e++)u[e]=r[e]*l.scaleFactor}return u},e.decodeRGB=function(e){const o=new DataView(e,0);let i=0;const{identifier:a,version:s}=n(e,o,i);if(i+=16,"ClusterRGB"!==a)throw new t("lepcc-decode-error","Bad identifier");if(s>1)throw new t("lepcc-decode-error","Unknown version");const c=function(e,t){return{sizeLo:e.getUint32(t+0,r),sizeHi:e.getUint32(t+4,r),count:e.getUint32(t+8,r),colorMapCount:e.getUint16(t+12,r),lookupMethod:e.getUint8(t+14),compressionMethod:e.getUint8(t+15)}}(o,i);if(i+=16,c.sizeHi*2**32+c.sizeLo!==e.byteLength)throw new t("lepcc-decode-error","Bad size");if((2===c.lookupMethod||1===c.lookupMethod)&&0===c.compressionMethod){if(3*c.colorMapCount+c.count+i!==e.byteLength||c.colorMapCount>256)throw new t("lepcc-decode-error","Bad count");const r=new Uint8Array(e,i,3*c.colorMapCount),n=new Uint8Array(e,i+3*c.colorMapCount,c.count),o=new Uint8Array(3*c.count);for(let e=0;e<c.count;e++){const t=n[e];o[3*e]=r[3*t],o[3*e+1]=r[3*t+1],o[3*e+2]=r[3*t+2]}return o}if(0===c.lookupMethod&&0===c.compressionMethod){if(3*c.count+i!==e.byteLength||0!==c.colorMapCount)throw new t("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(c.lookupMethod<=2&&1===c.compressionMethod){if(i+3!==e.byteLength||1!==c.colorMapCount)throw new t("lepcc-decode-error","Bad count");const r=o.getUint8(i),n=o.getUint8(i+1),a=o.getUint8(i+2),s=new Uint8Array(3*c.count);for(let e=0;e<c.count;e++)s[3*e]=r,s[3*e+1]=n,s[3*e+2]=a;return s}throw new t("lepcc-decode-error","Bad method "+c.lookupMethod+","+c.compressionMethod)},e.decodeXYZ=function(e){const i=new DataView(e,0);let a=0;const{identifier:s,version:c}=n(e,i,a);if(a+=16,"LEPCC     "!==s)throw new t("lepcc-decode-error","Bad identifier");if(c>1)throw new t("lepcc-decode-error","Unknown version");const l=function(e,t){return{sizeLo:e.getUint32(t+0,r),sizeHi:e.getUint32(t+4,r),minX:e.getFloat64(t+8,r),minY:e.getFloat64(t+16,r),minZ:e.getFloat64(t+24,r),maxX:e.getFloat64(t+32,r),maxY:e.getFloat64(t+40,r),maxZ:e.getFloat64(t+48,r),errorX:e.getFloat64(t+56,r),errorY:e.getFloat64(t+64,r),errorZ:e.getFloat64(t+72,r),count:e.getUint32(t+80,r),reserved:e.getUint32(t+84,r)}}(i,a);if(a+=88,l.sizeHi*2**32+l.sizeLo!==e.byteLength)throw new t("lepcc-decode-error","Bad size");const u=new Float64Array(3*l.count),d=[],f=[],h=[],m=[];if(a=o(e,a,d),a=o(e,a,f),a=o(e,a,h),a=o(e,a,m),a!==e.byteLength)throw new t("lepcc-decode-error","Bad length");let p=0,g=0;for(let e=0;e<d.length;e++){g+=d[e];let t=0;for(let r=0;r<f[e];r++){t+=h[p];const e=m[p];u[3*p]=Math.min(l.maxX,l.minX+2*l.errorX*t),u[3*p+1]=Math.min(l.maxY,l.minY+2*l.errorY*g),u[3*p+2]=Math.min(l.maxZ,l.minZ+2*l.errorZ*e),p++}}return{errorX:l.errorX,errorY:l.errorY,errorZ:l.errorZ,result:u}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],(function(e){"use strict";var t;e.VertexAttribute=void 0,(t=e.VertexAttribute||(e.VertexAttribute={})).POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.UVI="uvi",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.ROTATION="rotation",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.NEXTDELTA="nextDelta",t.PREVIOUSDELTA="previousDelta",t.U0="u0",t.LINEPARAMETERS="lineParameters",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.PROFILEAUXDATA="profileAuxData",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.START_UP="startUp",t.END_UP="endUp",t.EXTRUDE="extrude",t.OLIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor",e.affectsGeometry=function(t){return t===e.VertexAttribute.POSITION},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/computeTranslationToOriginAndRotation"],(function(e,t,r,n,o){"use strict";function i(e,t,o){const i=r.create(),a=e[3],s=2**(4*Math.ceil(Math.log(a)*Math.LOG2E/4)+1);if(o.isGeographic){const t=s/n.getReferenceEllipsoid(o).radius*180/Math.PI,r=Math.round(e[1]/t),a=Math.max(-90,Math.min(90,r*t)),c=t/Math.cos((Math.abs(a)-t/2)/180*Math.PI),l=Math.round(e[0]/c)*c;i[0]=l,i[1]=a}else{const t=Math.round(e[0]/s),r=Math.round(e[1]/s);i[0]=t*s,i[1]=r*s}const c=e[2]+t,l=Math.round(c/s);return i[2]=l*s,i}e.computeGlobalTransformation=function(e,n,a,s,c){const l="east-north-up"===a?r.clone(e):i(e,n,s),u=t.create();return o.computeTranslationToOriginAndRotation(s,l,u,c),u},e.getLocalOrigin=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/projection/computeTranslationToOriginAndRotation":function(){define(["exports","../../core/mathUtils","../../core/libs/gl-matrix-2/math/mat4","../../core/libs/gl-matrix-2/factories/vec3f64","./localRotationUtils","./projectors","../support/spatialReferenceUtils"],(function(e,t,r,n,o,i,a){"use strict";function s(e){return e===i.ProjectionID.SPHERICAL_ECEF||e===i.ProjectionID.SPHERICAL_MARS_PCPF||e===i.ProjectionID.SPHERICAL_MOON_PCPF||e===i.ProjectionID.WGS84_ECEF}const c=t.deg2rad(1),l=n.create(),u=n.create();e.computeTranslationToOriginAndRotation=function(e,t,n,d){const f=i.getProjectorClassification(e,d);if(null==f)return!1;const h=f.source.spatialReferenceId,m=f.dest.spatialReferenceId;if(h===m&&!s(m)&&(h!==i.ProjectionID.UNKNOWN||a.equals(e,d)))return r.fromTranslation(n,t),!0;if(s(m)){const e=i.projectionTable[h][i.ProjectionID.LON_LAT],r=i.projectionTable[i.ProjectionID.LON_LAT][m];return null!=e&&null!=r&&(e(t,0,l,0),r(l,0,u,0),o.computeENUToPCPFLocalRotation(c*l[0],c*l[1],n),n[12]=u[0],n[13]=u[1],n[14]=u[2],!0)}const p=s(h);if((m===i.ProjectionID.WEB_MERCATOR||m===i.ProjectionID.PLATE_CARREE||m===i.ProjectionID.WGS84||m===i.ProjectionID.CGCS2000)&&(h===i.ProjectionID.WGS84||p||h===i.ProjectionID.WEB_MERCATOR||h===i.ProjectionID.CGCS2000)){const e=i.projectionTable[h][i.ProjectionID.LON_LAT],a=i.projectionTable[i.ProjectionID.LON_LAT][m];return null!=e&&null!=a&&(e(t,0,l,0),a(l,0,u,0),p?o.computePCPFToENULocalRotation(c*l[0],c*l[1],n):r.identity(n),n[12]=u[0],n[13]=u[1],n[14]=u[2],!0)}return!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/projection/localRotationUtils":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],(function(e,t){"use strict";function r(e,t,r){const n=Math.sin(e),o=Math.cos(e),i=Math.sin(t),a=Math.cos(t),s=r;return s[0]=-n,s[4]=-i*o,s[8]=a*o,s[12]=0,s[1]=o,s[5]=-i*n,s[9]=a*n,s[13]=0,s[2]=0,s[6]=a,s[10]=i,s[14]=0,s[3]=0,s[7]=0,s[11]=0,s[15]=1,s}e.computeENUToPCPFLocalRotation=r,e.computePCPFToENULocalRotation=function(e,n,o){return r(e,n,o),t.transpose(o,o),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/support/edgeUtils":function(){define(["exports","../../../../Color","../../../../core/has","../../../../core/screenUtils","../../../../core/libs/gl-matrix-2/factories/vec4f64","./layerUtils","../../webgl-engine/lib/edgeRendering/interfaces","../../webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl"],(function(e,t,r,n,o,i,a,s){"use strict";function c(e,r){if(null==e)return null;const i=null!=e.color?o.fromArray(t.toUnitRGBA(e.color)):o.fromValues(0,0,0,0),a=n.pt2px(e.size),c=n.pt2px(e.extensionLength);switch(e.type){case"solid":return l({color:i,size:a,extensionLength:c,...r});case"sketch":return function(e){return{...d,...e,type:s.EdgeType.Sketch}}({color:i,size:a,extensionLength:c,...r});default:return}}function l(e){return{...u,...e,type:s.EdgeType.Solid}}const u={color:o.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:a.Transparency.OPAQUE,hasSlicePlane:!1},d={color:o.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:a.Transparency.OPAQUE,hasSlicePlane:!1};e.createMaterial=function(e,t){return c(function(e){return e&&e.enabled&&e.edges||null}(e),t)},e.createMaterialFromEdges=c,e.createSolidEdgeMaterial=l,e.hasEdges=function(e){return e&&e.enabled&&(i.isExtrudeSymbol3DLayer(e)||i.isFillSymbol3DLayer(e))&&null!=e.edges},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/screenUtils":function(){define(["exports"],(function(e){"use strict";const t=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function r(e){return e?72*e/96:0}function n(e=0,t=0){return{x:e,y:t}}e.castRenderScreenPointArray=function(e){return e},e.castRenderScreenPointArray3=function(e){return e},e.castScreenPointArray=function(e){return e},e.cloneScreenPoint=function(e){return e?n(e.x,e.y):null},e.createRenderScreenPoint=function(e=0,t=0){return{x:e,y:t}},e.createRenderScreenPointArray=function(e=0,t=0){return[e,t]},e.createRenderScreenPointArray3=function(e=0,t=0,r=0){return[e,t,r]},e.createScreenPoint=n,e.createScreenPointArray=function(e=0,t=0){return[e,t]},e.pt2px=function(e){return e?e/72*96:0},e.px2pt=r,e.screenPointArrayToObject=function(e,t){return t?(t.x=e[0],t.y=e[1],t):{x:e[0],y:e[1]}},e.screenPointObjectToArray=function(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]},e.toPt=function(e){if("string"==typeof e){const n=e.match(t);if(n){const t=Number(n[1]),o=n[3]&&n[3].toLowerCase(),i="-"===e.charAt(0),a="px"===o?r(t):t;return i?-a:a}return console.warn("screenUtils.toPt: input not recognized!"),null}return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],(function(e){"use strict";e.isExtrudeSymbol3DLayer=function(e){return"extrude"===e.type},e.isFillSymbol3DLayer=function(e){return"fill"===e.type},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],(function(e){"use strict";var t;e.Transparency=void 0,(t=e.Transparency||(e.Transparency={}))[t.TRANSPARENT=0]="TRANSPARENT",t[t.OPAQUE=1]="OPAQUE",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define(["exports","../../../collections/Component/Material/shader/ComponentData.glsl","../../../core/shaderLibrary/attributes/NormalAttribute.glsl","../../../core/shaderLibrary/util/DoublePrecision.glsl","../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl","../../../core/shaderModules/Float3DrawUniform","../../../core/shaderModules/Float3PassUniform","../../../core/shaderModules/glsl","../../../core/shaderModules/Matrix3DrawUniform","../../../core/shaderModules/Matrix3PassUniform","../../../core/shaderModules/Matrix4BindUniform","../../../core/shaderModules/Texture2DDrawUniform","../../../lib/VertexAttribute"],(function(e,t,r,n,o,i,a,s,c,l,u,d,f){"use strict";var h,m;e.EdgeType=void 0,(h=e.EdgeType||(e.EdgeType={}))[h.Solid=0]="Solid",h[h.Sketch=1]="Sketch",h[h.Mixed=2]="Mixed",h[h.COUNT=3]="COUNT",e.EdgeSilhouette=void 0,(m=e.EdgeSilhouette||(e.EdgeSilhouette={}))[m.REGULAR=0]="REGULAR",m[m.SILHOUETTE=1]="SILHOUETTE",e.EdgeUtil=function(e,h){const{vertex:m}=e;m.include(o.RgbaFloatEncoding),e.include(r.NormalAttribute,h);const{silhouette:p,legacy:g,spherical:b}=h;m.uniforms.add(new d.Texture2DDrawUniform("componentDataTex",(e=>e.componentDataTexture))),e.attributes.add(f.VertexAttribute.COMPONENTINDEX,"float"),m.constants.add("lineWidthFractionFactor","float",8),m.constants.add("extensionLengthOffset","float",128),m.code.add(s.glsl`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = ${s.glsl.float(3)}  * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, ${s.glsl.float(0)});
      vec2 otherIndex = _componentTextureCoords(componentIndex, ${s.glsl.float(1)});
      vec2 verticalOffsetIndex = _componentTextureCoords(float(componentIndex), ${s.glsl.float(2)} );
      vec3 normal = normalModel();
      vec3 normal2 = ${p?s.glsl`decompressNormal(normal2Compressed)`:s.glsl`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = uninterpolatedRGBAToFloat(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) * ${s.glsl.float(t.maxElevationOffset)};

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / ${s.glsl.float(8)} ),
        otherValue.y * 255.0 - ${s.glsl.float(128)},
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),g?m.code.add(s.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(m.uniforms.add(new c.Matrix3DrawUniform("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel))),m.code.add(s.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),p?(e.attributes.add(f.VertexAttribute.NORMAL2COMPRESSED,"vec2"),m.code.add(s.glsl`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):m.code.add(s.glsl`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),g?m.code.add(s.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(m.include(n.DoublePrecision,h),m.uniforms.add(new l.Matrix3PassUniform("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new c.Matrix3DrawUniform("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new i.Float3DrawUniform("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL)),new i.Float3DrawUniform("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new a.Float3PassUniform("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new a.Float3PassUniform("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH))),m.code.add(s.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${b?"normalize(transformWorldFromModelTL + rotatedModelPosition);":"vec3(0.0, 0.0, 1.0);"}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),m.uniforms.add(new u.Matrix4BindUniform("transformProjFromView",(e=>e.camera.projectionMatrix))).code.add(s.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),m.code.add(s.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)},e.usesSketchLogic=function(t){return t===e.EdgeType.Sketch||t===e.EdgeType.Mixed},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define(["exports","../../../../../../../core/compilerUtils","../../../../../../../core/floatRGBA","./DecodeSymbolColor.glsl","../../../../core/shaderLibrary/ShaderOutput","../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl","../../../../core/shaderModules/Float4DrawUniform","../../../../core/shaderModules/glsl","../../../../core/shaderModules/IntegerDrawUniform","../../../../core/shaderModules/Texture2DDrawUniform","../../../../effects/geometry/olidUtils","../../../../lib/VertexAttribute"],(function(e,t,r,n,o,i,a,s,c,l,u,d){"use strict";var f;e.ComponentDataType=void 0,(f=e.ComponentDataType||(e.ComponentDataType={}))[f.Uniform=0]="Uniform",f[f.Varying=1]="Varying",f[f.COUNT=2]="COUNT";const h=429496.7296;e.ComponentData=function(r,f){switch(f.componentData){case e.ComponentDataType.Varying:return function(e,t){const{vertex:r,fragment:a}=e;r.include(i.RgbaFloatEncoding),r.uniforms.add(new l.Texture2DDrawUniform("componentColorTex",(e=>e.componentParameters.texture.texture))),e.attributes.add(d.VertexAttribute.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4");const c=t.output===o.ShaderOutput.ObjectAndLayerIdColor;c&&e.varyings.add("vObjectAndLayerIdColor","vec4"),e.include(n.DecodeSymbolColor),r.constants.add("stride","float",u.olidEnabled()?3:2),r.code.add(s.glsl`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(s.glsl`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);
    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

  float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);
    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return uninterpolatedRGBAToFloat(encodedElevation) * ${s.glsl.float(h)};
  }

  ${c?s.glsl`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);
            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:s.glsl`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),a.code.add(s.glsl`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${c?s.glsl`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}(r,f);case e.ComponentDataType.Uniform:return function(e,t){const{vertex:r,fragment:n}=e;e.varyings.add("vExternalColor","vec4"),r.uniforms.add(new a.Float4DrawUniform("externalColor",(e=>e.componentParameters.externalColor))).code.add(s.glsl`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const i=t.output===o.ShaderOutput.ObjectAndLayerIdColor;n.uniforms.add(new c.IntegerDrawUniform("externalColorMixMode",(e=>e.componentParameters.externalColorMixMode))).code.add(s.glsl`
    void readExternalColor(out vec4 color, out int colorMixMode) {
      color = vExternalColor;
      colorMixMode = externalColorMixMode;
    }

    void outputObjectAndLayerIdColor() {
      ${s.If(i,"fragColor = vec4(0, 0, 0, 0);")}
    }
  `)}(r,f);case e.ComponentDataType.COUNT:return;default:t.neverReached(f.componentData)}},e.encodeElevationOffset=function(e,t){r.packFloatRGBA(e/h*.5+.5,t)},e.maxElevationOffset=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],(function(e,t){"use strict";function r(e,t=0){let r=0;for(let n=0;n<4;n++)r+=e[t+n]*o[n];return r}const n=[1,256,65536,16777216],o=[1/256,1/65536,1/16777216,1/4294967296],i=r(new Uint8ClampedArray([255,255,255,255]));e.packFloatRGBA=function(e,r,o=0){const a=t.clamp(e,0,i);for(let e=0;e<4;e++)r[o+e]=Math.floor(256*((s=a*n[e])-Math.floor(s)));var s},e.unpackFloatRGBA=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/glsl"],(function(e,t,r){"use strict";e.DecodeSymbolColor=function(e){e.vertex.code.add(r.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${r.glsl.int(t.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${r.glsl.int(t.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${r.glsl.int(t.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${r.glsl.int(t.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils"],(function(e,t){"use strict";var r;e.ColorMixModeEnum=void 0,(r=e.ColorMixModeEnum||(e.ColorMixModeEnum={}))[r.Multiply=1]="Multiply",r[r.Ignore=2]="Ignore",r[r.Replace=3]="Replace",r[r.Tint=4]="Tint";const n=255;e.encodeSymbolColor=function(r,o,i){if(null==r||o===e.ColorMixModeEnum.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const a=t.clamp(Math.round(85*r[3]),0,85),s=0===a||o===e.ColorMixModeEnum.Tint?0:o===e.ColorMixModeEnum.Replace?85:170;i[0]=t.clamp(Math.round(r[0]*n),0,n),i[1]=t.clamp(Math.round(r[1]*n),0,n),i[2]=t.clamp(Math.round(r[2]*n),0,n),i[3]=a+s},e.parseColorMixMode=function(t){switch(t){case"multiply":default:return e.ColorMixModeEnum.Multiply;case"ignore":return e.ColorMixModeEnum.Ignore;case"replace":return e.ColorMixModeEnum.Replace;case"tint":return e.ColorMixModeEnum.Tint}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/glsl":function(){define(["exports"],(function(e){"use strict";function t(e,...t){let r="";for(let n=0;n<t.length;n++)r+=e[n]+t[n];return r+=e[e.length-1],r}!function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(t||(t={})),e.If=function(e,t,r=""){return e?t:r},e.glsl=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],(function(e){"use strict";var t;function r(t){return t===e.ShaderOutput.Highlight||t===e.ShaderOutput.ObjectAndLayerIdColor}function n(t){return t===e.ShaderOutput.Color}function o(e){return n(e)||d(e)}function i(t){return n(t)||t===e.ShaderOutput.Highlight}function a(e){return n(e)||r(e)}function s(e){return o(e)||r(e)}function c(e){return a(e)||u(e)}function l(e){return s(e)||u(e)}function u(t){return t===e.ShaderOutput.Depth}function d(t){return t===e.ShaderOutput.ColorEmission}e.ShaderOutput=void 0,(t=e.ShaderOutput||(e.ShaderOutput={}))[t.Color=0]="Color",t[t.ColorEmission=1]="ColorEmission",t[t.Depth=2]="Depth",t[t.Normal=3]="Normal",t[t.Shadow=4]="Shadow",t[t.ShadowHighlight=5]="ShadowHighlight",t[t.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",t[t.ViewshedShadow=7]="ViewshedShadow",t[t.Highlight=8]="Highlight",t[t.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",t[t.COUNT=10]="COUNT",e.is2DGeometryOutput=function(e){return n(e)||r(e)},e.is3DGeometryOutput=function(t){return c(t)||t===e.ShaderOutput.Normal},e.is3DGeometryOutputMRT=function(t){return l(t)||t===e.ShaderOutput.Normal},e.isColor=n,e.isColorEmission=d,e.isColorEmissionHighlightOIDOrDepth=l,e.isColorEmissionHighlightOrOID=s,e.isColorHighlightOIDOrDepth=c,e.isColorHighlightOrDepth=function(e){return i(e)||u(e)},e.isColorHighlightOrOID=a,e.isColorOrColorEmission=o,e.isColorOrColorEmissionOrOID=function(t){return o(t)||t===e.ShaderOutput.ObjectAndLayerIdColor},e.isColorOrHighlight=i,e.isColorOrOID=function(t){return n(t)||t===e.ShaderOutput.ObjectAndLayerIdColor},e.isDepth=u,e.isDepthOnlyOutput=function(t){switch(t){case e.ShaderOutput.Depth:case e.ShaderOutput.Shadow:case e.ShaderOutput.ShadowHighlight:case e.ShaderOutput.ShadowExcludeHighlight:case e.ShaderOutput.ViewshedShadow:return!0}return!1},e.isHighlightOrOID=r,e.isShadowRelatedOutput=function(t){return t===e.ShaderOutput.Shadow||t===e.ShaderOutput.ShadowHighlight||t===e.ShaderOutput.ShadowExcludeHighlight||t===e.ShaderOutput.ViewshedShadow},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/glsl"],(function(e,t){"use strict";e.RgbaFloatEncoding=function(e){e.code.add(t.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),e.code.add(t.glsl`const vec4 RGBA_TO_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgbaTofloat(vec4 rgba) {
return dot(rgba, RGBA_TO_FLOAT_FACTORS);
}`),e.code.add(t.glsl`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class n extends r.Uniform{constructor(e,r){super(e,"vec4",t.BindType.Draw,((t,n,o)=>t.setUniform4fv(e,r(n,o))))}}e.Float4DrawUniform=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/BindType":function(){define(["exports"],(function(e){"use strict";var t;e.BindType=void 0,(t=e.BindType||(e.BindType={}))[t.Bind=0]="Bind",t[t.Pass=1]="Pass",t[t.Draw=2]="Draw",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/Uniform":function(){define(["exports","../../core/has","./BindType"],(function(e,t,r){"use strict";e.Uniform=class{constructor(e,t,n,o,i=null){if(this.name=e,this.type=t,this.arraySize=i,this.bind={[r.BindType.Bind]:null,[r.BindType.Pass]:null,[r.BindType.Draw]:null},o)switch(n){case void 0:break;case r.BindType.Bind:this.bind[r.BindType.Bind]=o;break;case r.BindType.Pass:this.bind[r.BindType.Pass]=o;break;case r.BindType.Draw:this.bind[r.BindType.Draw]=o}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class n extends r.Uniform{constructor(e,r){super(e,"int",t.BindType.Draw,((t,n,o)=>t.setUniform1i(e,r(n,o))))}}e.IntegerDrawUniform=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class n extends r.Uniform{constructor(e,r){super(e,"sampler2D",t.BindType.Draw,((t,n,o)=>t.bindTexture(e,r(n,o))))}}e.Texture2DDrawUniform=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/geometry/olidUtils":function(){define(["exports","../../../../../core/has"],(function(e,t){"use strict";e.olidEnabled=function(){return!!t("enable-feature:objectAndLayerId-rendering")},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/glsl","../../../lib/VertexAttribute"],(function(e,t,r,n){"use strict";var o;e.NormalType=void 0,(o=e.NormalType||(e.NormalType={}))[o.Attribute=0]="Attribute",o[o.Compressed=1]="Compressed",o[o.ScreenDerivative=2]="ScreenDerivative",o[o.COUNT=3]="COUNT",e.NormalAttribute=function(o,i){switch(i.normalType){case e.NormalType.Compressed:o.attributes.add(n.VertexAttribute.NORMALCOMPRESSED,"vec2"),o.vertex.code.add(r.glsl`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case e.NormalType.Attribute:o.attributes.add(n.VertexAttribute.NORMAL,"vec3"),o.vertex.code.add(r.glsl`vec3 normalModel() {
return normal;
}`);break;case e.NormalType.ScreenDerivative:o.fragment.code.add(r.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:t.neverReached(i.normalType);case e.NormalType.COUNT:}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../shaderModules/FloatBindUniform","../../shaderModules/glsl"],(function(e,t,r){"use strict";e.DoublePrecision=function({code:e,uniforms:n},o){n.add(new t.FloatBindUniform("dpDummy",(()=>1))),e.add(r.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 hiD = hiA + hiB;
vec3 loD = loA + loB;
return  dpDummy * hiD + loD;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/FloatBindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class n extends r.Uniform{constructor(e,r){super(e,"float",t.BindType.Bind,((t,n)=>t.setUniform1f(e,r(n))))}}e.FloatBindUniform=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class n extends r.Uniform{constructor(e,r){super(e,"vec3",t.BindType.Draw,((t,n,o,i)=>t.setUniform3fv(e,r(n,o,i))))}}e.Float3DrawUniform=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class n extends r.Uniform{constructor(e,r){super(e,"vec3",t.BindType.Pass,((t,n,o)=>t.setUniform3fv(e,r(n,o))))}}e.Float3PassUniform=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class n extends r.Uniform{constructor(e,r){super(e,"mat3",t.BindType.Draw,((t,n,o)=>t.setUniformMatrix3fv(e,r(n,o))))}}e.Matrix3DrawUniform=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class n extends r.Uniform{constructor(e,r){super(e,"mat3",t.BindType.Pass,((t,n,o)=>t.setUniformMatrix3fv(e,r(n,o))))}}e.Matrix3PassUniform=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4BindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class n extends r.Uniform{constructor(e,r){super(e,"mat4",t.BindType.Bind,((t,n)=>t.setUniformMatrix4fv(e,r(n))))}}e.Matrix4BindUniform=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/orientedBoundingBox":function(){define(["exports","../../../core/libs/gl-matrix-2/math/mat3","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../core/libs/gl-matrix-2/factories/mat4f64","../../../core/libs/gl-matrix-2/math/quat","../../../core/libs/gl-matrix-2/factories/quatf64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../chunks/vec42","../../../core/libs/gl-matrix-2/factories/vec4f64","../../../geometry/ellipsoidUtils","../../../geometry/spatialReferenceEllipsoidUtils","../../../geometry/projection/computeTranslationToOriginAndRotation","../../../geometry/projection/projectBuffer","../../../geometry/projection/projectors","../../../geometry/support/plane","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/vectorStacks","../../ViewingMode","./dito","../webgl-engine/lib/Attribute"],(function(e,t,r,n,o,i,a,s,c,l,u,d,f,h,m,p,g,b,y,M,v){"use strict";class S{constructor(e=s.ZEROS,t=W,r=i.IDENTITY){this._data=[e[0],e[1],e[2],t[0],t[1],t[2],r[0],r[1],r[2],r[3]]}clone(){const e=new S;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const t=new S;return t._data=e.slice(),t}static fromJSON(e){return new S(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return a.set(b.sv3d.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,t,r){this._data[0]=e,this._data[1]=t,this._data[2]=r}get halfSize(){return a.set(b.sv3d.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return o.set(b.sq4d.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const t=w,r=this._data;t[0]=r[6],t[1]=r[7],t[2]=r[8],t[3]=r[9];for(let n=0;n<8;++n){const o=e[n];o[0]=(1&n?-1:1)*r[3],o[1]=(2&n?-1:1)*r[4],o[2]=(4&n?-1:1)*r[5],a.transformQuat(o,o,t),o[0]+=r[0],o[1]+=r[1],o[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],t=this._data[4],r=this._data[5];return Math.sqrt(e*e+t*t+r*r)}intersectSphere(e){I[0]=this._data[0]-e[0],I[1]=this._data[1]-e[1],I[2]=this._data[2]-e[2];const t=this.getQuaternion(x);return o.conjugate(w,t),a.transformQuat(I,I,w),a.abs(I,I),P[0]=Math.min(I[0],this._data[3]),P[1]=Math.min(I[1],this._data[4]),P[2]=Math.min(I[2],this._data[5]),a.sqrDist(P,I)<e[3]*e[3]}intersectSphereWithMBS(e,t=this.radius){const r=this._data;I[0]=r[0]-e[0],I[1]=r[1]-e[1],I[2]=r[2]-e[2];const n=e[3],o=n+t;return!(a.sqrLen(I)>o*o)&&(w[0]=-r[6],w[1]=-r[7],w[2]=-r[8],w[3]=r[9],a.transformQuat(I,I,w),a.abs(I,I),P[0]=Math.min(I[0],r[3]),P[1]=Math.min(I[1],r[4]),P[2]=Math.min(I[2],r[5]),a.sqrDist(P,I)<n*n)}intersectPlane(e){const t=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(p.getNormal(e));return t>r?1:t<-r?-1:0}intersectRay(e,t,r=0){const n=this._data,o=w;o[0]=-n[6],o[1]=-n[7],o[2]=-n[8],o[3]=n[9],I[0]=e[0]-n[0],I[1]=e[1]-n[1],I[2]=e[2]-n[2];const i=a.transformQuat(I,I,w),s=a.transformQuat(P,t,w);let c=-1/0,l=1/0;const u=this.getHalfSize(k);for(let e=0;e<3;e++){const t=i[e],n=s[e],o=u[e]+r;if(Math.abs(n)>1e-6){const e=(o-t)/n,r=(-o-t)/n;c=Math.max(c,Math.min(e,r)),l=Math.min(l,Math.max(e,r))}else if(t>o||t<-o)return!1}return c<=l}projectedArea(e,r,n,i){const s=this.getQuaternion(x);o.conjugate(w,s),I[0]=e[0]-this._data[0],I[1]=e[1]-this._data[1],I[2]=e[2]-this._data[2],a.transformQuat(I,I,w);const l=this.getHalfSize(k),u=I[0]<-l[0]?-1:I[0]>l[0]?1:0,d=I[1]<-l[1]?-1:I[1]>l[1]?1:0,f=I[2]<-l[2]?-1:I[2]>l[2]?1:0,h=Math.abs(u)+Math.abs(d)+Math.abs(f);if(0===h)return 1/0;const m=1===h?4:6,p=6*(u+3*d+9*f+13);t.fromQuat(F,s),t.scale(F,F,l);const g=this.getCenter(j);for(let e=0;e<m;e++){const t=C[p+e];a.set(I,((1&t)<<1)-1,(2&t)-1,((4&t)>>1)-1),a.transformMat3(I,I,F),a.add(E,g,I),E[3]=1,c.transformMat4(E,E,r);const n=1/Math.max(1e-6,E[3]);A[2*e]=E[0]*n,A[2*e+1]=E[1]*n}const b=2*m-2;let y=A[0]*(A[3]-A[b+1])+A[b]*(A[1]-A[b-1]);for(let e=2;e<b;e+=2)y+=A[e]*(A[e+3]-A[e-1]);return Math.abs(y)*n*i*.125}projectedRadius(e){const t=this.getQuaternion(x);return o.conjugate(w,t),a.transformQuat(I,e,w),Math.abs(I[0]*this._data[3])+Math.abs(I[1]*this._data[4])+Math.abs(I[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(p.getNormal(e))}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(p.getNormal(e))}toAaBoundingBox(e){const r=this.getQuaternion(x),n=t.fromQuat(F,r),o=this._data[3]*Math.abs(n[0])+this._data[4]*Math.abs(n[3])+this._data[5]*Math.abs(n[6]),i=this._data[3]*Math.abs(n[1])+this._data[4]*Math.abs(n[4])+this._data[5]*Math.abs(n[7]),a=this._data[3]*Math.abs(n[2])+this._data[4]*Math.abs(n[5])+this._data[5]*Math.abs(n[8]);e[0]=this._data[0]-o,e[1]=this._data[1]-i,e[2]=this._data[2]-a,e[3]=this._data[0]+o,e[4]=this._data[1]+i,e[5]=this._data[2]+a}transform(e,t,r,n=0,i=d.getSphericalPCPF(r),s=d.getSphericalPCPF(t),c=m.getProjector(t,s)){if(r===i)t.isGeographic?function(e,t,r,n,i=d.getSphericalPCPF(r)){const s=u.getReferenceEllipsoid(r),c=1+Math.max(0,n)/(s.radius+e.centerZ);e.getCenter(U),U[2]+=n,h.projectBuffer(U,r,0,U,i,0),t.center=U;const l=e.getQuaternion(x);t.quaternion=l,o.conjugate(w,l),a.set(B,0,0,1),a.transformQuat(B,B,w);const f=e.getHalfSize(k);a.set(B,f[0]*Math.abs(B[0]),f[1]*Math.abs(B[1]),f[2]*Math.abs(B[2])),a.scale(B,B,s.inverseFlattening),a.add(B,f,B),t.halfSize=a.scale(B,B,c)}(this,e,t,n,s):function(e,t,r,n,i=d.getSphericalPCPF(r),s=m.getProjector(r,i)){e.getCorners(V),e.getCenter(U),U[2]+=n,f.computeTranslationToOriginAndRotation(r,U,D,i),t.setCenter(D[12],D[13],D[14]);const c=2*Math.sqrt(1+D[0]+D[5]+D[10]);w[0]=(D[6]-D[9])/c,w[1]=(D[8]-D[2])/c,w[2]=(D[1]-D[4])/c,w[3]=.25*c;const l=e.getQuaternion(x);t.quaternion=o.multiply(w,w,l),o.conjugate(w,w),a.set(q,0,0,0);const u=t.getCenter(L);for(const e of V)e[2]+=n,s(e,0,e,0),a.sub(B,e,u),a.transformQuat(B,B,w),a.abs(B,B),a.max(q,q,B);t.halfSize=q}(this,e,t,n,s,c);else if(t.isWGS84&&(r.isWebMercator||g.isPlateCarree(r)))!function(e,t,r,n,o){t.getCenter(j),j[2]+=o;const i=d.getSphericalPCPF(r);h.projectBuffer(j,e,0,j,i,0),_(i,t,j,r,n)}(t,this,r,e,n);else if(t.isWebMercator&&g.isPlateCarree(r))!function(e,t,r,n,o){t.getCenter(j),j[2]+=o,_(e,t,j,r,n)}(t,this,r,e,n);else{const o=this.getCenter(j);o[2]+=n,h.projectBuffer(o,t,0,o,r,0),e.center=o,this!==e&&(e.quaternion=this.getQuaternion(x),e.halfSize=this.getHalfSize(k))}}}const w=i.create(),x=i.create(),T=i.create(),I=s.create(),P=s.create(),E=l.create();function O(e,t=new S){return M.computeOBB(e,t),t}const A=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],C=(()=>{const e=new Int8Array(162);let t=0;const r=r=>{for(let n=0;n<r.length;n++)e[t+n]=r[n];t+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),e})();function _(e,r,n,o,i){const a=r.getQuaternion(x),s=t.fromQuat(F,a),c=r.getHalfSize(k);for(let e=0;e<8;++e){for(let t=0;t<3;++t)U[t]=c[t]*(e&1<<t?-1:1);for(let t=0;t<3;++t){let r=n[t];for(let e=0;e<3;++e)r+=U[e]*s[3*e+t];R[3*e+t]=r}}h.projectBuffer(R,e,0,R,o,0,8),O(N,i)}const R=new Array(24),N=new v.Vertices(R,3),U=s.create(),j=s.create(),L=s.create(),k=s.create(),F=r.create(),D=n.create(),V=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],B=s.create(),q=s.create(),z=s.create(),W=s.freeze(-1,-1,-1);e.Obb=S,e.compute=O,e.computeOffsetObb=function(e,t,r,n,i){const c=e.getQuaternion(x);i.quaternion=c,o.conjugate(w,c);const l=e.getCenter(j),u=e.getHalfSize(k);if(n===y.ViewingMode.Global){a.transformQuat(B,l,w),a.abs(q,B),a.min(z,q,u),a.sub(z,q,z);const n=a.length(z);a.add(z,q,u);const o=a.length(z);if(n<r)i.center=l,a.set(B,r,r,r),i.halfSize=a.add(B,u,B);else{const s=o>0?1+t/o:1,c=n>0?1+r/n:1,l=(c+s)/2,d=(c-s)/2;a.scale(z,q,d),i.halfSize=a.scaleAndAdd(z,z,u,l),a.scale(z,q,l),a.scaleAndAdd(z,z,u,d),a.sign(B,B),a.multiply(B,z,B);const f=e.getQuaternion(T);i.center=a.transformQuat(B,B,f)}}else{i.center=a.scaleAndAdd(B,l,s.UNIT_Z,(r+t)/2);const e=a.transformQuat(B,s.UNIT_Z,w);a.abs(e,e),i.halfSize=a.scaleAndAdd(q,u,e,(r-t)/2)}return i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/math/quat":function(){define(["exports","../factories/mat3f64","../factories/quatf64","../factories/vec3f64","./common","../../../../chunks/vec32","../../../../chunks/vec42"],(function(e,t,r,n,o,i,a){"use strict";function s(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function c(e,t,r){r*=.5;const n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function l(e,t){const r=2*Math.acos(t[3]),n=Math.sin(r/2);return n>o.getEpsilon()?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r}function u(e,t,r){const n=t[0],o=t[1],i=t[2],a=t[3],s=r[0],c=r[1],l=r[2],u=r[3];return e[0]=n*u+a*s+o*l-i*c,e[1]=o*u+a*c+i*s-n*l,e[2]=i*u+a*l+n*c-o*s,e[3]=a*u-n*s-o*c-i*l,e}function d(e,t,r){r*=.5;const n=t[0],o=t[1],i=t[2],a=t[3],s=Math.sin(r),c=Math.cos(r);return e[0]=n*c+a*s,e[1]=o*c+i*s,e[2]=i*c-o*s,e[3]=a*c-n*s,e}function f(e,t,r){r*=.5;const n=t[0],o=t[1],i=t[2],a=t[3],s=Math.sin(r),c=Math.cos(r);return e[0]=n*c-i*s,e[1]=o*c+a*s,e[2]=i*c+n*s,e[3]=a*c-o*s,e}function h(e,t,r){r*=.5;const n=t[0],o=t[1],i=t[2],a=t[3],s=Math.sin(r),c=Math.cos(r);return e[0]=n*c+o*s,e[1]=o*c-n*s,e[2]=i*c+a*s,e[3]=a*c-i*s,e}function m(e,t){const r=t[0],n=t[1],o=t[2];return e[0]=r,e[1]=n,e[2]=o,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-o*o)),e}function p(e,t,r,n){const i=t[0],a=t[1],s=t[2],c=t[3];let l,u,d,f,h,m=r[0],p=r[1],g=r[2],b=r[3];return u=i*m+a*p+s*g+c*b,u<0&&(u=-u,m=-m,p=-p,g=-g,b=-b),1-u>o.getEpsilon()?(l=Math.acos(u),d=Math.sin(l),f=Math.sin((1-n)*l)/d,h=Math.sin(n*l)/d):(f=1-n,h=n),e[0]=f*i+h*m,e[1]=f*a+h*p,e[2]=f*s+h*g,e[3]=f*c+h*b,e}function g(e){const t=o.RANDOM,r=t(),n=t(),i=t(),a=Math.sqrt(1-r),s=Math.sqrt(r);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=s*Math.sin(2*Math.PI*i),e[3]=s*Math.cos(2*Math.PI*i),e}function b(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],a=r*r+n*n+o*o+i*i,s=a?1/a:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-o*s,e[3]=i*s,e}function y(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function M(e,t){const r=t[0]+t[4]+t[8];let n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const o=(r+1)%3,i=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*i+i]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*o+i]-t[3*i+o])*n,e[o]=(t[3*o+r]+t[3*r+o])*n,e[i]=(t[3*i+r]+t[3*r+i])*n}return e}function v(e,t,r,n){const o=.5*Math.PI/180;t*=o,r*=o,n*=o;const i=Math.sin(t),a=Math.cos(t),s=Math.sin(r),c=Math.cos(r),l=Math.sin(n),u=Math.cos(n);return e[0]=i*c*u-a*s*l,e[1]=a*s*u+i*c*l,e[2]=a*c*l-i*s*u,e[3]=a*c*u+i*s*l,e}function S(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const w=a.copy,x=a.set,T=a.add,I=u,P=a.scale,E=a.dot,O=a.lerp,A=a.length,C=A,_=a.squaredLength,R=_,N=a.normalize,U=a.exactEquals,j=a.equals;function L(e,t,r){const n=i.dot(t,r);return n<-.999999?(i.cross(k,F,t),i.len(k)<1e-6&&i.cross(k,D,t),i.normalize(k,k),c(e,k,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(i.cross(k,t,r),e[0]=k[0],e[1]=k[1],e[2]=k[2],e[3]=1+n,N(e,e))}const k=n.create(),F=n.fromValues(1,0,0),D=n.fromValues(0,1,0);function V(e,t,r,n,o,i){return p(B,t,o,i),p(q,r,n,i),p(e,B,q,2*i*(1-i)),e}const B=r.create(),q=r.create();function z(e,t,r,n){const o=W;return o[0]=r[0],o[3]=r[1],o[6]=r[2],o[1]=n[0],o[4]=n[1],o[7]=n[2],o[2]=-t[0],o[5]=-t[1],o[8]=-t[2],N(e,M(e,o))}const W=t.create(),H=Object.freeze(Object.defineProperty({__proto__:null,add:T,calculateW:m,conjugate:y,copy:w,dot:E,equals:j,exactEquals:U,fromEuler:v,fromMat3:M,getAxisAngle:l,identity:s,invert:b,len:C,length:A,lerp:O,mul:I,multiply:u,normalize:N,random:g,rotateX:d,rotateY:f,rotateZ:h,rotationTo:L,scale:P,set:x,setAxes:z,setAxisAngle:c,slerp:p,sqlerp:V,sqrLen:R,squaredLength:_,str:S},Symbol.toStringTag,{value:"Module"}));e.add=T,e.calculateW=m,e.conjugate=y,e.copy=w,e.dot=E,e.equals=j,e.exactEquals=U,e.fromEuler=v,e.fromMat3=M,e.getAxisAngle=l,e.identity=s,e.invert=b,e.len=C,e.length=A,e.lerp=O,e.mul=I,e.multiply=u,e.normalize=N,e.quat=H,e.random=g,e.rotateX=d,e.rotateY=f,e.rotateZ=h,e.rotationTo=L,e.scale=P,e.set=x,e.setAxes=z,e.setAxisAngle=c,e.slerp=p,e.sqlerp=V,e.sqrLen=R,e.squaredLength=_,e.str=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports","./ellipsoidUtils","./SpatialReference","./support/spatialReferenceUtils"],(function(e,t,r,n){"use strict";const o=new r(t.SphericalECEFSpatialReferenceLike),i=new r(t.SphericalPCPFMarsLike),a=new r(t.SphericalPCPFMoonLike),s=new r(t.WGS84ECEFSpatialReferenceLike),c=new Map,l=i.wkt.toUpperCase(),u=a.wkt.toUpperCase();e.SphericalECEFSpatialReference=o,e.SphericalPCPFMars=i,e.SphericalPCPFMoon=a,e.WGS84ECEFSpatialReference=s,e.getSphericalPCPF=function(e){const t=c.get(e);if(t)return t;let r=o;if(e)if(e===i)r=i;else if(e===a)r=a;else{const t=e.wkid,o=e.latestWkid;if(null!=t||null!=o)n.isWKIDFromMars(t)||n.isWKIDFromMars(o)?r=i:(n.isWKIDFromMoon(t)||n.isWKIDFromMoon(o))&&(r=a);else{const t=e.wkt2??e.wkt;if(t){const e=t.toUpperCase();e===l?r=i:e===u&&(r=a)}}}return c.set(e,r),r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/plane":function(){define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../chunks/vec42","./vector","./vectorStacks","../../views/3d/support/mathUtils"],(function(e,t,r,n,o,i,a,s){"use strict";function c(e=E){return[e[0],e[1],e[2],e[3]]}const l=o.exactEquals,u=o.equals;function d(e,t){return f(t[0],t[1],t[2],t[3],e)}function f(e,t,r,n,o=c()){return o[0]=e,o[1]=t,o[2]=r,o[3]=n,o}function h(e,t,r){const n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],o=Math.abs(n-1)>1e-5&&n>1e-12?1/Math.sqrt(n):1;return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function m(e,t,r,n=c()){const o=r[0]-t[0],i=r[1]-t[1],a=r[2]-t[2],s=e[0]-t[0],l=e[1]-t[1],u=e[2]-t[2],d=i*u-a*l,f=a*s-o*u,h=o*l-i*s,m=d*d+f*f+h*h,p=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return n[0]=d*p,n[1]=f*p,n[2]=h*p,n[3]=-(n[0]*e[0]+n[1]*e[1]+n[2]*e[2]),n}function p(e,t,n,o=0,i=Math.floor(n*(1/3)),a=Math.floor(n*(2/3))){if(n<3)return!1;t(b,o);let s=i,c=!1;for(;s<n-1&&!c;)t(y,s),s++,c=!r.exactEquals(b,y);if(!c)return!1;for(s=Math.max(s,a),c=!1;s<n&&!c;)t(M,s),s++,r.subtract(v,b,y),r.normalize(v,v),r.subtract(S,y,M),r.normalize(S,S),c=!r.exactEquals(b,M)&&!r.exactEquals(y,M)&&Math.abs(r.dot(v,S))<g;return c?(m(b,y,M,e),!0):(0!==o||1!==i||2!==a)&&p(e,t,n,0,1,2)}const g=.99619469809,b=n.create(),y=n.create(),M=n.create(),v=n.create(),S=n.create();function w(e,t,n){const o=r.scale(a.sv3d.get(),e,r.dot(e,t));return r.subtract(n,t,o),n}function x(e,t){return r.dot(e,t)+e[3]}var T;function I(t){return t===e.IntersectResult.INTERSECTS_INSIDE_OUT||t===e.IntersectResult.INTERSECTS_OUTSIDE_IN}function P(n,o,i,a,s){const c=r.dot(n,i),l=x(n,o);if(0===c)return l>=0?e.IntersectResult.INSIDE:e.IntersectResult.OUTSIDE;let u=-l/c;return a&e.IntersectFlags.CLAMP&&(u=t.clamp(u,0,1)),!(a&e.IntersectFlags.INFINITE_MIN)&&u<0||!(a&e.IntersectFlags.INFINITE_MAX)&&u>1?l>=0?e.IntersectResult.INSIDE:e.IntersectResult.OUTSIDE:(r.add(s,o,r.scale(s,i,u)),l>=0?e.IntersectResult.INTERSECTS_INSIDE_OUT:e.IntersectResult.INTERSECTS_OUTSIDE_IN)}e.IntersectResult=void 0,(T=e.IntersectResult||(e.IntersectResult={}))[T.INTERSECTS_INSIDE_OUT=0]="INTERSECTS_INSIDE_OUT",T[T.INTERSECTS_OUTSIDE_IN=1]="INTERSECTS_OUTSIDE_IN",T[T.INSIDE=2]="INSIDE",T[T.OUTSIDE=3]="OUTSIDE";const E=[0,0,1,0];var O;e.IntersectFlags=void 0,(O=e.IntersectFlags||(e.IntersectFlags={}))[O.NONE=0]="NONE",O[O.CLAMP=1]="CLAMP",O[O.INFINITE_MIN=4]="INFINITE_MIN",O[O.INFINITE_MAX=8]="INFINITE_MAX";const A=e.IntersectFlags.INFINITE_MIN|e.IntersectFlags.INFINITE_MAX,C=e.IntersectFlags.INFINITE_MAX;e.clip=function(e,t){const n=r.dot(e,t.ray.direction),o=-x(e,t.ray.origin);if(o<0&&n>=0)return!1;if(n>-1e-6&&n<1e-6)return o>0;if((o<0||n<0)&&!(o<0&&n<0))return!0;const i=o/n;return n>0?i<t.c1&&(t.c1=i):i>t.c0&&(t.c0=i),t.c0<=t.c1},e.clipInfinite=function(e,t){const n=r.dot(e,t.ray.direction),o=-x(e,t.ray.origin);if(n>-1e-6&&n<1e-6)return o>0;const i=o/n;return n>0?i<t.c1&&(t.c1=i):i>t.c0&&(t.c0=i),t.c0<=t.c1},e.copy=d,e.create=c,e.distance=function(e,t){return Math.abs(x(e,t))},e.equals=u,e.exactEquals=l,e.fromArray=function(e,t,n=!0){const o=t.length/3;return p(e,((e,n)=>r.set(e,t[3*n+0],t[3*n+1],t[3*n+2])),n?o-1:o)},e.fromManyPoints=p,e.fromNormalAndOffset=function(e,t,n){return r.copy(n,e),n[3]=t,n},e.fromPoints=m,e.fromPositionAndNormal=h,e.fromValues=f,e.fromVectorsAndPoint=function(e,t,n,o){return r.cross(M,t,e),h(n,M,o)},e.getNormal=function(e){return e},e.intersectLine=function(e,t,n,o){return I(P(e,t,r.subtract(a.sv3d.get(),n,t),A,o))},e.intersectLineOrRay=P,e.intersectLineSegment=function(t,r,n){return I(P(t,r.origin,r.vector,e.IntersectFlags.NONE,n))},e.intersectLineSegmentClamp=function(t,r,n){return I(P(t,r.origin,r.vector,e.IntersectFlags.CLAMP,n))},e.intersectRay=function(e,t,r){return null!=t&&I(P(e,t.origin,t.direction,C,r))},e.isPointInside=function(e,t){return x(e,t)>=0},e.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.projectPoint=function(e,t,n){const o=r.scale(a.sv3d.get(),e,-e[3]),i=w(e,r.subtract(a.sv3d.get(),t,o),a.sv3d.get());return r.add(n,i,o),n},e.projectPointLocal=function(e,t,n,o){const c=e,l=a.sv3d.get(),u=a.sv3d.get();s.tangentFrame(c,l,u);const d=r.subtract(a.sv3d.get(),n,t),f=i.projectPointSignedLength(l,d),h=i.projectPointSignedLength(u,d),m=i.projectPointSignedLength(c,d);return r.set(o,f,h,m)},e.projectVector=w,e.setOffsetFromPoint=function(e,t,n){return t!==e&&d(e,t),e[3]=-r.dot(e,n),e},e.signedDistance=x,e.up=E,e.wrap=function(e=E[0],t=E[1],r=E[2],n=E[3]){return f(e,t,r,n,a.sv4d.get())},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64"],(function(e,t,r,n){"use strict";const o=n.create(),i=n.create(),a=n.create(),s=n.create(),c=n.create();e.angle=function(e,n,o){e=r.normalize(s,e),n=r.normalize(c,n);const i=t.acosClamped(r.dot(e,n));if(o){const t=r.cross(a,e,n);if(r.dot(t,o)<0)return-i}return i},e.bilerp=function(e,t,r,n,o,i){const a=e+(t-e)*o;return a+(r+(n-r)*o-a)*i},e.cosCapped=function(e,t){return e>t?Math.cos(t):Math.cos(e)},e.fovx2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/t)},e.fovy2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/r)},e.makeOrthonormal=function(e,t,n){n=n||e;const o=r.dot(e,t);r.set(n,e[0]-o*t[0],e[1]-o*t[1],e[2]-o*t[2]),r.normalize(n,n)},e.makePiecewiseLinearFunction=function(e){const t=e.length;return r=>{if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];let n=1;for(;r>e[n][0];)n++;const o=e[n-1][0],i=e[n][0],a=(i-r)/(i-o);return a*e[n-1][1]+(1-a)*e[n][1]}},e.maxScale=function(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],n=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))},e.midpoint3d=function(e,t){if(r.set(t,0,0,0),e.length>0){for(let n=0;n<e.length;++n)r.add(t,t,e[n]);r.scale(t,t,1/e.length)}},e.planeFromPoints=function(e,t,n,a){r.subtract(o,t,e),r.subtract(i,n,e),r.cross(a,o,i),r.normalize(a,a),a[3]=-r.dot(e,a)},e.scaleFromMatrix=function(e,t){const n=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),o=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),i=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return r.set(e,n,o,i),e},e.slerp=function(e,t,o,i=n.create()){const a=r.length(e),l=r.length(t),u=r.dot(e,t)/(a*l);if(u<.9999999999999999){const n=Math.acos(u),d=((1-o)*a+o*l)/Math.sin(n),f=d/a*Math.sin((1-o)*n),h=d/l*Math.sin(o*n);return r.scale(s,e,f),r.scale(c,t,h),r.add(i,s,c)}return r.lerp(i,e,t,o)},e.slerpTangent=function(e,t,o,i=n.create(),a=n.create()){const l=r.length(e),u=r.length(t),d=r.dot(e,t)/(l*u);if(d<.9999999999999999){const n=Math.acos(d),f=Math.sin(n),h=Math.sin(o*n),m=Math.sin((1-o)*n),p=(1-o)*l+o*u;{const n=p/f,o=n/l*m,a=n/u*h;r.scale(s,e,o),r.scale(c,t,a),r.add(i,s,c)}{const i=1/l*(-Math.cos((1-o)*n)*n*p+m*(-l+u));r.scale(s,e,i);const d=1/u*(Math.cos(o*n)*n*p+h*(-l+u));r.scale(c,t,d),r.add(a,s,c),r.scale(a,a,1/f)}return a}return r.lerp(i,e,t,o),r.subtract(a,t,e),r.normalize(a,a),a},e.tangentFrame=function(e,t,n){Math.abs(e[0])>Math.abs(e[1])?r.set(t,0,1,0):r.set(t,1,0,0),r.cross(n,e,t),r.cross(t,n,e),r.normalize(n,n),r.normalize(t,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/ViewingMode":function(){define(["exports"],(function(e){"use strict";var t;e.ViewingMode=void 0,(t=e.ViewingMode||(e.ViewingMode={}))[t.Global=1]="Global",t[t.Local=2]="Local",e.stringFromViewingMode=function(t){return t===e.ViewingMode.Global?"global":"local"},e.viewingModeFromString=function(t){return"global"===t?e.ViewingMode.Global:e.ViewingMode.Local},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/dito":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../core/libs/gl-matrix-2/factories/quatf64","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../webgl-engine/lib/Attribute"],(function(e,t,r,n,o,i,a){"use strict";const s=1e-6,c=i.create(),l=i.create(),u=i.create(),d=i.create(),f=i.create(),h=i.create(),m=i.create(),p=i.create(),g=i.create(),b=i.create(),y=[0,0,0],M=n.create(),v=i.create(),S=i.create(),w=i.create(),x=i.create(),T=i.create(),I=i.create();function P(e,t,r,n,o,i){if(K(t)<s)return;X(v,r,t),X(S,n,t),X(w,o,t),O(e,t,M),T[1]=M[0],x[1]=M[1],I[1]=x[1]-T[1];const a=[r,n,o],c=[v,S,w];for(let r=0;r<3;++r){O(e,a[r],M),T[0]=M[0],x[0]=M[1],O(e,c[r],M),T[2]=M[0],x[2]=M[1],I[0]=x[0]-T[0],I[2]=x[2]-T[2];const n=G(I);n<i.quality&&(J(i.b0,a[r]),J(i.b1,t),J(i.b2,c[r]),i.quality=n)}}const E=i.create();function O(e,t,r){const{data:n,size:o}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<n.length;e+=o){const o=n[e]*t[0]+n[e+1]*t[1]+n[e+2]*t[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function A(e,t,n){n.center=e,n.halfSize=o.scale(t,t,.5),n.quaternion=r.IDENTITY}const C=i.create(),_=i.create(),R=i.create(),N=i.create(),U=i.create(),j=i.create();function L(e,t,r){J(C,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?C[0]=0:Math.abs(t[1])>Math.abs(t[2])?C[1]=0:C[2]=0,K(C)<s&&(C[0]=C[1]=C[2]=1),X(_,t,C),Z(_,_),X(R,t,_),Z(R,R),k(e,t,_,R,N,U),Q(j,U,N),z(t,_,R,N,U,j,r)}function k(e,t,r,n,o,i){O(e,t,M),o[0]=M[0],i[0]=M[1],O(e,r,M),o[1]=M[0],i[1]=M[1],O(e,n,M),o[2]=M[0],i[2]=M[1]}const F=i.create(),D=i.create(),V=i.create(),B=t.fromValues(1,0,0,0,1,0,0,0,1),q=r.create();function z(e,t,r,n,i,a,s){B[0]=e[0],B[1]=e[1],B[2]=e[2],B[3]=t[0],B[4]=t[1],B[5]=t[2],B[6]=r[0],B[7]=r[1],B[8]=r[2],s.quaternion=function(e,t){const r=t[0]+t[4]+t[8];if(r>0){let n=Math.sqrt(r+1);e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const n=(r+1)%3,o=(r+2)%3;let i=Math.sqrt(t[3*r+r]-t[3*n+n]-t[3*o+o]+1);e[r]=.5*i,i=.5/i,e[3]=(t[3*n+o]-t[3*o+n])*i,e[n]=(t[3*n+r]+t[3*r+n])*i,e[o]=(t[3*o+r]+t[3*r+o])*i}return e}(q,B),$(F,n,i),Y(F,F,.5),Y(D,e,F[0]),Y(V,t,F[1]),$(D,D,V),Y(V,r,F[2]),s.center=o.add(D,D,V),s.halfSize=o.scale(F,a,.5)}class W{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let e=0;e<7;++e)this.minVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.maxVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.minProj[e]=Number.POSITIVE_INFINITY,this.maxProj[e]=Number.NEGATIVE_INFINITY;const r=new Array(7),n=new Array(7),{data:o,size:i}=e;for(let e=0;e<o.length;e+=i){let t=o[e];t<this.minProj[0]&&(this.minProj[0]=t,r[0]=e),t>this.maxProj[0]&&(this.maxProj[0]=t,n[0]=e),t=o[e+1],t<this.minProj[1]&&(this.minProj[1]=t,r[1]=e),t>this.maxProj[1]&&(this.maxProj[1]=t,n[1]=e),t=o[e+2],t<this.minProj[2]&&(this.minProj[2]=t,r[2]=e),t>this.maxProj[2]&&(this.maxProj[2]=t,n[2]=e),t=o[e]+o[e+1]+o[e+2],t<this.minProj[3]&&(this.minProj[3]=t,r[3]=e),t>this.maxProj[3]&&(this.maxProj[3]=t,n[3]=e),t=o[e]+o[e+1]-o[e+2],t<this.minProj[4]&&(this.minProj[4]=t,r[4]=e),t>this.maxProj[4]&&(this.maxProj[4]=t,n[4]=e),t=o[e]-o[e+1]+o[e+2],t<this.minProj[5]&&(this.minProj[5]=t,r[5]=e),t>this.maxProj[5]&&(this.maxProj[5]=t,n[5]=e),t=o[e]-o[e+1]-o[e+2],t<this.minProj[6]&&(this.minProj[6]=t,r[6]=e),t>this.maxProj[6]&&(this.maxProj[6]=t,n[6]=e)}for(let e=0;e<7;++e){let t=r[e];J(this.minVert[e],o,t),t=n[e],J(this.maxVert[e],o,t)}}}class H{constructor(){this.b0=i.fromValues(1,0,0),this.b1=i.fromValues(0,1,0),this.b2=i.fromValues(0,0,1),this.quality=0}}function G(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function $(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function Q(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function Y(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function J(e,t,r=0){e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2]}function X(e,t,r){const n=t[0],o=t[1],i=t[2],a=r[0],s=r[1],c=r[2];e[0]=o*c-i*s,e[1]=i*a-n*c,e[2]=n*s-o*a}function Z(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const n=1/Math.sqrt(r);e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}}function K(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function ee(e,t){const r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return r*r+n*n+o*o}function te(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}e.computeOBB=function(e,t){const{data:r,size:n}=e,o=r.length/n;if(o<=0)return;const v=new W(e);$(c,v.minProj,v.maxProj),Y(c,c,.5),Q(l,v.maxProj,v.minProj);const S=G(l),w=new H;w.quality=S,o<14&&(e=new a.Vertices(new Float64Array(v.buffer,112,42),3));const x=i.create(),T=i.create(),I=i.create(),O=i.create(),C=i.create(),_=i.create(),R=i.create();switch(function(e,t,r,n,o,i,a,c,l,u){if(function(e,t,r){let n=ee(e.maxVert[0],e.minVert[0]),o=0;for(let t=1;t<7;++t){const r=ee(e.maxVert[t],e.minVert[t]);r>n&&(n=r,o=t)}J(t,e.minVert[o]),J(r,e.maxVert[o])}(e,n,o),ee(n,o)<s)return 1;Q(a,n,o),Z(a,a);const d=function(e,t,r,n){const{data:o,size:i}=e;let a=Number.NEGATIVE_INFINITY,s=0;for(let e=0;e<o.length;e+=i){y[0]=o[e]-t[0],y[1]=o[e+1]-t[1],y[2]=o[e+2]-t[2];const n=r[0]*y[0]+r[1]*y[1]+r[2]*y[2],i=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],c=y[0]*y[0]+y[1]*y[1]+y[2]*y[2]-n*n/i;c>a&&(a=c,s=e)}return J(n,o,s),a}(t,n,a,i);return d<s?2:(Q(c,o,i),Z(c,c),Q(l,i,n),Z(l,l),X(r,c,a),Z(r,r),P(t,r,a,c,l,u),0)}(v,e,R,x,T,I,O,C,_,w)){case 1:return void A(c,l,t);case 2:return void L(e,O,t)}!function(e,t,r,n,o,i,a,c,l){(function(e,t,r,n,o){!function(e,t,r,n,o){const{data:i,size:a}=e;J(n,i),J(o,n),r[0]=te(E,t),r[1]=r[0];for(let e=a;e<i.length;e+=a){const a=i[e]*t[0]+i[e+1]*t[1]+i[e+2]*t[2];a<r[0]&&(r[0]=a,J(n,i,e)),a>r[1]&&(r[1]=a,J(o,i,e))}}(e,t,M,o,n);const i=te(r,t);M[1]-s<=i&&(n[0]=void 0),M[0]+s>=i&&(o[0]=void 0)})(e,t,r,u,d),void 0!==u[0]&&(Q(f,u,r),Z(f,f),Q(h,u,n),Z(h,h),Q(m,u,o),Z(m,m),X(p,h,i),Z(p,p),X(g,m,a),Z(g,g),X(b,f,c),Z(b,b),P(e,p,i,h,f,l),P(e,g,a,m,h,l),P(e,b,c,f,m,l)),void 0!==d[0]&&(Q(f,d,r),Z(f,f),Q(h,d,n),Z(h,h),Q(m,d,o),Z(m,m),X(p,h,i),Z(p,p),X(g,m,a),Z(g,g),X(b,f,c),Z(b,b),P(e,p,i,h,f,l),P(e,g,a,m,h,l),P(e,b,c,f,m,l))}(e,R,x,T,I,O,C,_,w),k(e,w.b0,w.b1,w.b2,N,U);const j=i.create();Q(j,U,N),w.quality=G(j),w.quality<S?z(w.b0,w.b1,w.b2,N,U,j,t):A(c,l,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/Attribute":function(){define(["exports"],(function(e){"use strict";class t{constructor(e,t,r=t){this.data=e,this.size=t,this.stride=r}}e.Attribute=class extends t{constructor(e,t,r,n=!1,o=r){super(e,r,o),this.indices=t,this.exclusive=n}},e.Vertices=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/layerViewUtils":function(){define(["exports","../../core/Error","../../core/has"],(function(e,t,r){"use strict";function n(e,t,r){return null==e||e>=r&&(0===t||e<=t)}function o(e,t){return null!=e&&e>0||null!=t&&t>0}e.hasLayerBasedScaleVisibility=()=>!r("disable-feature:layer-based-scale-visibility"),e.highlightsSupported=function(e){return e&&"function"==typeof e.highlight},e.isInEffectiveScaleRange=function(e,t){if(t&&e){const{minScale:r,maxScale:i}=e;if(o(r,i))return n(t,r,i)}return!0},e.isScaleRangeActive=o,e.isSelectableLayerView2D=function(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatures"in e&&"layer"in e&&"view"in e},e.occludeesSupported=function(e){return e&&"function"==typeof e.maskOccludee},e.scaleBoundsPredicate=n,e.spatialReferenceIncompatibleError=function(e,r,n){return new t("layerview:spatial-reference-incompatible",`The spatial reference of this ${e}${r?`(wkid:${r})`:""} is incompatible with the spatial reference of the view${n?`(wkid:${n})`:""}.`,{})},e.validateScaleRange=function(e){return!e?.minScale||!e.maxScale||e.minScale>=e.maxScale},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/ElevationRange":function(){define(["exports"],(function(e){"use strict";e.ElevationRange=class{constructor(e=1/0,t=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=t}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,t){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,t)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"*noref":1}}),define(["require","exports","../../../core/mathUtils","../../../geometry/SpatialReference","../../../geometry/support/MeshGeoreferencedVertexSpace","../../../geometry/support/MeshLocalVertexSpace","../../../chunks/vec3","../../../libs/i3s/enums","../../../libs/i3s/I3SModule","./I3SMeshWorkerHandle","./i3s/I3SNode"],(function(e,t,r,n,o,i,a,s,c,l,u){"use strict";let d,f;function h(e){if(!f)return;const t=e.modifications,r=f._malloc(8*t.length),n=new Float64Array(f.HEAPU8.buffer,r,t.length);for(let e=0;e<t.length;++e)n[e]=t[e];f.setModifications(e.context,r,t.length,e.isGeodetic),f._free(r)}function m(e,t,r){const{context:n,globalTrafo:o,mbs:i,obbData:a,elevationOffset:c,geometryBuffer:u,geometryDescriptor:d,indexToVertexProjector:f,vertexToRenderProjector:h}=t,m=e._malloc(u.byteLength),p=e._malloc(33*Float64Array.BYTES_PER_ELEMENT),g=new Uint8Array(e.HEAPU8.buffer,m,u.byteLength);g.set(new Uint8Array(u));const y=new Float64Array(e.HEAPU8.buffer,p,33);b(y,[NaN,NaN,NaN]);let M=y.byteOffset+3*y.BYTES_PER_ELEMENT,v=new Float64Array(y.buffer,M);b(v,o),M+=16*y.BYTES_PER_ELEMENT,v=new Float64Array(y.buffer,M),b(v,i),M+=4*y.BYTES_PER_ELEMENT,a&&(v=new Float64Array(y.buffer,M),b(v,a));const S=d,w={isDraco:!1,isLegacy:!1,color:t.layouts.some((e=>e.some((e=>"color"===e.name)))),normal:t.needNormals&&t.layouts.some((e=>e.some((e=>"normalCompressed"===e.name)))),uv0:t.layouts.some((e=>e.some((e=>"uv0"===e.name)))),uvRegion:t.layouts.some((e=>e.some((e=>"uvRegion"===e.name)))),featureIndex:S.featureIndex},x=e.process(n,!!t.obbData,m,g.byteLength,S,w,p,c,f,h,t.normalReferenceFrame);if(e._free(p),e._free(m),x.error.length>0)throw new Error(`i3s.wasm: ${x.error}`);if(x.discarded)return null;const T=x.componentOffsets.length>0?x.componentOffsets.slice():null,I=x.featureIds.length>0?x.featureIds.slice():null,P=x.anchorIds.length>0?Array.from(x.anchorIds):null,E=x.anchors.length>0?Array.from(x.anchors):null,O=x.interleavedVertedData.slice().buffer,A=x.indicesType===s.IndexType.Int16?new Uint16Array(x.indices.buffer,x.indices.byteOffset,x.indices.byteLength/2).slice():new Uint32Array(x.indices.buffer,x.indices.byteOffset,x.indices.byteLength/4).slice(),C=x.positions.slice(),{buffer:_,byteOffset:R,byteLength:N}=x.positionIndices,U=x.positionIndicesType===s.IndexType.Int16?new Uint16Array(_,R,N/2).slice():new Uint32Array(_,R,N/4).slice(),j=new l.TransformedGeometry(t.layouts[0],O,A,x.hasColors,x.hasModifications,{data:C,indices:U});return I&&r.push(I.buffer),T&&r.push(T.buffer),r.push(O),r.push(A.buffer),r.push(C.buffer),r.push(U.buffer),new l.TransformedData(T,I,P,E,j,o,x.obb)}function p(e){if(!f)return;const{context:t,buffer:r}=e,n=f._malloc(r.byteLength),o=r.byteLength/Float64Array.BYTES_PER_ELEMENT,i=new Float64Array(f.HEAPU8.buffer,n,o),a=new Float64Array(r);i.set(a),f.filterOBBs(t,n,o),a.set(i),f._free(n)}function g(e){f&&0===f.destroy(e)&&(f=null)}function b(e,t){for(let r=0;r<t.length;++r)e[r]=t[r]}async function y(){return f||(f=await(d??=c.get())),f}const M={transform:(e,t)=>f&&m(f,e,t),destroy:g};t.destroyContext=function(e){g(e)},t.dracoDecompressPointCloudData=async function(e){f=await y();const t=[e.geometryBuffer],{geometryBuffer:r}=e,n=r.byteLength,o=f._malloc(n),i=new Uint8Array(f.HEAPU8.buffer,o,n);i.set(new Uint8Array(r));const a=f.dracoDecompressPointCloudData(o,i.byteLength);if(f._free(o),a.error.length>0)throw new Error(`i3s.wasm: ${a.error}`);const s=a.featureIds?.length>0?a.featureIds.slice():null,c=a.positions.slice();return s&&t.push(s.buffer),t.push(c.buffer),{result:{positions:c,featureIds:s},transferList:t}},t.filterObbsForModifications=async function(e){await y(),p(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}},t.filterObbsForModificationsSync=p,t.initialize=async function(){f||await y()},t.interpretObbModificationResults=function(e){return 0===e?u.NodeIMModificationImpact.Unmodified:1===e?u.NodeIMModificationImpact.PotentiallyModified:2===e?u.NodeIMModificationImpact.Culled:u.NodeIMModificationImpact.Unknown},t.process=async function(e){f=await y();const t=[e.geometryBuffer];return{result:m(f,e,t),transferList:t}},t.project=async function(t){const{localMatrix:r,origin:a,positions:s,vertexSpace:c}=t,l=n.fromJSON(t.inSpatialReference),u=n.fromJSON(t.outSpatialReference);let d;const[{projectBuffer:f},{initializeProjection:h}]=await Promise.all([new Promise(((t,r)=>e(["../../../geometry/projection/projectBuffer"],t,r))),new Promise(((t,r)=>e(["../../../geometry/projectionUtils"],t,r)))]);await h(l,u);const m=[0,0,0];if(!f(a,l,0,m,u,0))throw new Error("Failed to project");if("georeferenced"===c.type&&null==c.origin){if(d=new Float64Array(s.length),!f(s,l,0,d,u,0,d.length/3))throw new Error("Failed to project")}else{const t="georeferenced"===c.type?o.fromJSON(c):i.fromJSON(c),{projectMeshVertexPositions:n}=await new Promise(((t,r)=>e(["../../../geometry/support/meshUtils/projectMeshVertexPositions"],t,r))),a=n({vertexAttributes:{position:s},transform:r?{localMatrix:r}:void 0,vertexSpace:t,spatialReference:l},u);if(!a)throw new Error("Failed to project");d=a}const p=d.length,[g,b,y]=m;for(let e=0;e<p;e+=3)d[e]-=g,d[e+1]-=b,d[e+2]-=y;return{result:{projected:d,original:s,projectedOrigin:m},transferList:[d.buffer,s.buffer]}},t.setLegacySchema=async function(e){f=await y(),f.setLegacySchema(e.context,e.jsonSchema)},t.setModifications=async function(e){await y(),h(e)},t.setModificationsSync=h,t.test=M,t.transformNormals=async function({normalMatrix:e,normals:t}){const n=new Float32Array(t.length);return a.transformMat3(n,t,e),r.hasScaling(e)&&a.normalize(n,n),{result:{transformed:n,original:t},transferList:[n.buffer,t.buffer]}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));