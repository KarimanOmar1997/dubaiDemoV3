// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/Evented":function(){define(["../chunks/tslib.es6","./Accessor","./handleUtils","./accessorSupport/decorators/subclass"],(function(e,t,r,i){"use strict";class o{constructor(){this._emitter=new o.EventEmitter(this)}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}}return function(s){class n{constructor(e=null){this._target=e,this._listenersMap=null}clear(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clear()}emit(e,t){let r=this._listenersMap?.get(e);if(!r)return!1;const i=this._target||this;let o=!1;for(const e of r.slice()){const r="deref"in e?e.deref():e;r?r?.call(i,t):o=!0}return o&&(r=r.filter((e=>!("deref"in e)||null!=e.deref())),this._listenersMap.set(e,r)),r.length>0}on(e,t){if(Array.isArray(e)){const i=e.map((e=>this.on(e,t)));return r.handlesGroup(i)}if(e.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??=new Map;const i=this._listenersMap.get(e)||[];return i.push(t),this._listenersMap.set(e,i),r.makeHandle((()=>{const r=this._listenersMap?.get(e),i=r?.indexOf(t)??-1;i>=0&&r.splice(i,1)}))}once(e,t){const r=this.on(e,(e=>{r.remove();const i="deref"in t?t.deref():t;i?.call(null,e)}));return r}hasEventListener(e){const t=this._listenersMap?.get(e);return null!=t&&t.length>0}}s.EventEmitter=n,s.EventedMixin=t=>{let r=class extends t{constructor(){super(...arguments),this._emitter=new n}destroy(){this._emitter.clear()}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};return r=e.__decorate([i.subclass("esri.core.Evented")],r),r};let a=class extends t{constructor(){super(...arguments),this._emitter=new o.EventEmitter(this)}destroy(){this._emitter.clear()}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};a=e.__decorate([i.subclass("esri.core.Evented.EventedAccessor")],a),s.EventedAccessor=a}(o||(o={})),o}))},"esri/layers/graphics/data/QueryEngine":function(){define(["exports","../../../core/arrayUtils","../../../core/compilerUtils","../../../core/Error","../../../core/has","../../../core/lang","../../../core/maybe","../../../core/promiseUtils","../../../core/unitUtils","../../../core/support/jsonUtils","../../../geometry/projectionUtils","../../../geometry/support/aaBoundingBox","../../../geometry/support/aaBoundingRect","../../../geometry/support/boundsUtils","../../../geometry/support/jsonUtils","../../../geometry/support/spatialReferenceUtils","../featureConversionUtils","./attributeSupport","./geometryUtils","./projectionSupport","./QueryEngineCache","./QueryEngineCapabilities","./QueryEngineResult","./queryUtils","./queryValidationUtils","./spatialQuerySupport","./timeSupport","../../support/FieldsIndex","../../../views/support/Scheduler"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x,w,T,M,I,P,O){"use strict";function C(e){if(M.canQueryWithRBush(e)){if(f.isExtent(e))return[p.fromValues(Math.min(e.xmin,e.xmax),Math.min(e.ymin,e.ymax),Math.max(e.xmin,e.xmax),Math.max(e.ymin,e.ymax))];if(f.isPolygon(e))return e.rings.map((e=>p.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))))}return[h.getBoundsXY(p.create(),e)]}e.Feature=class{constructor(e,t=null,r,i,o){this.attributes=e,this.geometry=r,this.centroid=i,this.filterFlags=o,this.groupId=-1,this.displayId=t}},e.QueryEngine=class{constructor(e){this._changeHandle=null,this.capabilities={query:_.queryCapabilities},this.geometryType=e.geometryType,this.hasM=!!e.hasM,this.hasZ=!!e.hasZ,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._cache=e.cache??new S.QueryEngineCache,this.timeInfo=e.timeInfo,this.featureIdInfo=e.featureIdInfo,"object-id"===e.featureIdInfo.type&&(this.objectIdField=e.featureIdInfo.fieldName),this._changeHandle=this.featureStore.events.on("changed",(()=>this._clearCache())),this.fieldsIndex=c.isSerializable(e.fieldsIndex)?e.fieldsIndex:P.fromJSON(e.fieldsIndex),!e.availableFields||1===e.availableFields.length&&"*"===e.availableFields[0]?this.availableFields=new Set(this.fieldsIndex.fields.map((e=>e.name))):this.availableFields=new Set(e.availableFields.map((e=>this.fieldsIndex.get(e)?.name)).filter((e=>null!=e))),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._changeHandle=n.removeMaybe(this._changeHandle),this._frameTask=n.removeMaybe(this._frameTask),this._clearCache(),n.destroyMaybe(this._cache)}get featureAdapter(){return this.featureStore.featureAdapter}_clearCache(){this._cache.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}async executeQuery(e,t){const r=a.signalFromSignalOrOptions(t);try{const t=await this._executeQuery(e,{},r);return await t.createQueryResponse()}catch(t){if(t!==w.queryEngineEmptyResult)throw t;return new x.QueryEngineResult([],e,this).createQueryResponse()}}async executeQueryForCount(e={},t){const r=a.signalFromSignalOrOptions(t);try{return(await this._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},r)).createQueryResponseForCount()}catch(e){if(e!==w.queryEngineEmptyResult)throw e;return 0}}async executeQueryForExtent(e,t){const r=a.signalFromSignalOrOptions(t),i=e.outSR;try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),o=t.size;return o?{count:o,extent:await this._getBounds(t.items,t.spatialReference,i||this.spatialReference)}:{count:0,extent:null}}catch(e){if(e===w.queryEngineEmptyResult)return{count:0,extent:null};throw e}}async executeQueryForIds(e,t){return this.executeQueryForIdSet(e,t).then((e=>Array.from(e)))}async executeQueryForIdSet(e,t){const r=a.signalFromSignalOrOptions(t);try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),i=t.items,o=new Set;return await this.reschedule((()=>{for(const e of i)o.add(t.featureAdapter.getObjectId(e))}),r),o}catch(e){if(e===w.queryEngineEmptyResult)return new Set;throw e}}async executeQueryForLatestObservations(e,t){const r=a.signalFromSignalOrOptions(t);if(!this.timeInfo?.trackIdField)throw new i("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});try{const t=await this._executeQuery(e,{},r);return await this.reschedule((()=>this._filterLatest(t)),r),await t.createQueryResponse()}catch(t){if(t!==w.queryEngineEmptyResult)throw t;return new x.QueryEngineResult([],e,this).createQueryResponse()}}async executeAttributeBinsQuery(e,t){const r=a.signalFromSignalOrOptions(t);let i;e=s.clone(e);try{e=await this.schedule((()=>w.normalizeAttributeBinsQuery(e,this.definitionExpression,this.spatialReference)),r),e=await this.reschedule((()=>T.validateAttributeBinsQuery(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r);const t=await this.reschedule((()=>this._executeSceneFilterQuery(e,r)),r);i=await this.reschedule((()=>this._executeGeometryQuery(e,t,r)),r),await this.reschedule((()=>this._executeAggregateIdsQuery(i)),r),await this.reschedule((()=>this.executeObjectIdsQuery(i)),r),await this.reschedule((()=>this.executeTimeQuery(i)),r),await this.reschedule((()=>this.executeAttributesQuery(i)),r)}catch(t){if(t!==w.queryEngineEmptyResult)throw t;i=new x.QueryEngineResult([],e,this)}return i.createQueryBinsResponse(e)}async executeQueryForSummaryStatistics(e={},t,r){const i=a.signalFromSignalOrOptions(r),{field:o,normalizationField:s,valueExpression:n}=t;return(await this._executeQueryForStatistics(e,{field:o,normalizationField:s,valueExpression:n},i)).createSummaryStatisticsResponse(t)}async executeQueryForUniqueValues(e={},t,r){const i=a.signalFromSignalOrOptions(r),{field:o,field2:s,field3:n,valueExpression:l}=t;return(await this._executeQueryForStatistics(e,{field:o,field2:s,field3:n,valueExpression:l},i)).createUniqueValuesResponse(t)}async executeQueryForClassBreaks(e={},t,r){const i=a.signalFromSignalOrOptions(r),{field:o,normalizationField:s,valueExpression:n}=t;return(await this._executeQueryForStatistics(e,{field:o,normalizationField:s,valueExpression:n},i)).createClassBreaksResponse(t)}async executeQueryForHistogram(e={},t,r){const i=a.signalFromSignalOrOptions(r),{field:o,normalizationField:s,valueExpression:n}=t;return(await this._executeQueryForStatistics(e,{field:o,normalizationField:s,valueExpression:n},i)).createHistogramResponse(t)}async fetchRecomputedExtents(e){const t=a.signalFromSignalOrOptions(e);this._timeExtentPromise||=I.getTimeExtent(this.timeInfo,this.featureStore);const[r,i]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);return a.throwIfAborted(t),{fullExtent:r,timeExtent:i}}async _getBounds(e,t,r){const i=d.set(d.create(),d.negativeInfinity);await this.featureStore.forEachBounds(e,(e=>d.expandWithAABB(i,e)));const o={xmin:i[0],ymin:i[1],xmax:i[3],ymax:i[4],spatialReference:b.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(i[2])&&isFinite(i[5])&&(o.zmin=i[2],o.zmax=i[5],o.hasZ=!0);const s=v.project(o,t,r);if(s.spatialReference=b.cleanFromGeometryEngine(r),s.xmax-s.xmin===0){const e=l.getMetersPerUnitForSR(s.spatialReference);s.xmin-=e,s.xmax+=e}if(s.ymax-s.ymin===0){const e=l.getMetersPerUnitForSR(s.spatialReference);s.ymin-=e,s.ymax+=e}if(this.hasZ&&null!=s.zmin&&null!=s.zmax&&s.zmax-s.zmin===0){const e=l.getMetersPerUnitForSR(s.spatialReference);s.zmin-=e,s.zmax+=e}return s}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then((e=>this._getBounds(e,this.spatialReference,this.spatialReference))),this._fullExtentPromise}async schedule(e,t){return this._frameTask?.schedule(e,t)??e(O.noBudget)}async reschedule(e,t){return this._frameTask?.reschedule(e,t)??e(O.noBudget)}async _getAllFeaturesQueryEngineResult(e){return new x.QueryEngineResult(await this._getAllFeatures(),e,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const e=[];this._allFeaturesPromise=(async()=>await this.featureStore.forEach((t=>e.push(t))))().then((()=>r.toConst(e)))}const e=this._allFeaturesPromise,t=await e;return e===this._allFeaturesPromise?t.slice():this._getAllFeatures()}async _executeQuery(e,t,r){e=s.clone(e),e=await this.schedule((()=>w.normalizeQuery(e,this.definitionExpression,this.spatialReference)),r),e=await this.reschedule((()=>T.validateQuery(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r),e={...e,...t};const i=await this.reschedule((()=>this._executeSceneFilterQuery(e,r)),r),o=await this.reschedule((()=>this._executeGeometryQuery(e,i,r)),r);return await this.reschedule((()=>this._executeAggregateIdsQuery(o)),r),await this.reschedule((()=>this.executeObjectIdsQuery(o)),r),await this.reschedule((()=>this.executeTimeQuery(o)),r),await this.reschedule((()=>this.executeAttributesQuery(o)),r),o}async _executeSceneFilterQuery(e,t){if(null==e.sceneFilter)return null;const{outSR:r,returnGeometry:i,returnCentroid:o}=e,s=this.featureStore.featureSpatialReference,n=e.sceneFilter.geometry,a=null==s||m.equals(s,n.spatialReference)?n:v.project(n,s);if(!a)return null;const l=i||o,c=m.isValid(r)&&!m.equals(this.spatialReference,r)&&l?async e=>this._project(e,r):e=>e,u=this.featureAdapter,d=await this.reschedule((()=>this.searchFeatures(C(a))),t);if("disjoint"===e.sceneFilter.spatialRelationship){if(!d.length)return null;const r=new Set;for(const e of d)r.add(u.getObjectId(e));const i=await this.reschedule((()=>this._getAllFeatures()),t);return c(await this.reschedule((async()=>{const o=await M.getSpatialQueryOperator("esriSpatialRelDisjoint",a,this.geometryType,this.hasZ,this.hasM),s=await this.runSpatialFilter(i,(e=>!r.has(u.getObjectId(e))||o(u.getGeometry(e))),t);return new x.QueryEngineResult(s,e,this)}),t))}if(!d.length)return new x.QueryEngineResult([],e,this);if(this._canExecuteSinglePass(a,e))return c(new x.QueryEngineResult(d,e,this));const p=await M.getSpatialQueryOperator("esriSpatialRelContains",a,this.geometryType,this.hasZ,this.hasM),h=await this.runSpatialFilter(d,(e=>p(u.getGeometry(e))),t);return c(new x.QueryEngineResult(h,e,this))}async _executeGeometryQuery(e,r,i){if(null!=r&&0===r.items.length)return r;const{geometry:o,outSR:s,returnGeometry:n,returnCentroid:a}=e,l=r?null:this._getCacheKey(e),c=l?this._cache.get(l):null;if(c)return new x.QueryEngineResult(c,e,this);const u=m.isValid(s)&&!m.equals(this.spatialReference,s),d=n||a,p=async e=>(u&&d&&await this._project(e,s),l&&this._cache.put(l,e.items),e),h=this.featureStore.featureSpatialReference,f=!o||null==h||m.equals(h,o.spatialReference)?o:v.project(o,h);if(!f)return p(null!=r?r:await this._getAllFeaturesQueryEngineResult(e));const y=this.featureAdapter;let g=await this.reschedule((()=>this.searchFeatures(C(o))),i);const b=e.spatialRel??"esriSpatialRelIntersects";if("esriSpatialRelDisjoint"===b){if(!g.length)return p(null!=r?r:await this._getAllFeaturesQueryEngineResult(e));const t=new Set;for(const e of g)t.add(y.getObjectId(e));const o=null!=r?r.items:await this.reschedule((()=>this._getAllFeatures()),i);return p(await this.reschedule((async()=>{const r=await M.getSpatialQueryOperator(b,f,this.geometryType,this.hasZ,this.hasM),s=await this.runSpatialFilter(o,(e=>!t.has(y.getObjectId(e))||r(y.getGeometry(e))),i);return new x.QueryEngineResult(s,e,this)}),i))}if(null!=r){const e=new t.PositionHint;g=g.filter((i=>t.indexOf(r.items,i,r.items.length,e)>=0))}if(!g.length){const t=new x.QueryEngineResult([],e,this);return l&&this._cache.put(l,t.items),t}if(this._canExecuteSinglePass(f,e))return p(new x.QueryEngineResult(g,e,this));const S=await M.getSpatialQueryOperator(b,f,this.geometryType,this.hasZ,this.hasM),_=await this.runSpatialFilter(g,(e=>S(y.getGeometry(e))),i);return p(new x.QueryEngineResult(_,e,this))}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds?.length||null==this.aggregateAdapter)return;const t=new Set;for(const r of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach((e=>t.add(e)));const r=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(r(e))))}executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds?.length)return;const t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(r(e))))}executeTimeQuery(e){if(0===e.items.length)return;const t=I.getTimeOperator(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}executeAttributesQuery(e){if(0===e.items.length)return;const t=g.getWhereClause(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter((e=>t.testFeature(e,this.featureAdapter)))}}async runSpatialFilter(e,t,r){if(!t)return e;if(null==this._frameTask)return e.filter((e=>t(e)));let i=0;const o=new Array,s=async n=>{for(;i<e.length;){const a=e[i++];t(a)&&(o.push(a),n.madeProgress()),n.done&&await this.reschedule((e=>s(e)),r)}};return this.reschedule((e=>s(e)),r).then((()=>o))}_filterLatest(e){const{trackIdField:t,startTimeField:r,endTimeField:i}=this.timeInfo,o=i||r,s=new Map,n=this.featureAdapter.getAttribute;for(const r of e.items){const e=n(r,t),i=n(r,o),a=s.get(e);(!a||i>n(a,o))&&s.set(e,r)}e.items=Array.from(s.values())}_getCacheKey(e){const{geometry:t,spatialRel:r,returnGeometry:i,returnCentroid:o,outSR:s,resultType:n,cacheHint:a}=e;if("tile"!==n&&!a)return null;const l=i||o;return m.isValid(s)&&!m.equals(this.spatialReference,s)&&l?JSON.stringify([t,r,s]):JSON.stringify([t,r])}_canExecuteSinglePass(e,t){const{spatialRel:r}=t;return M.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}async _project(e,t){if(!t||m.equals(this.spatialReference,t))return e;const i=this.featureAdapter;let o;try{const e=await this._getFullExtent();o=u.getTransformation(this.spatialReference,t,e)}catch{}const s=await v.projectMany(e.items.map((e=>b.getGeometry(this.geometryType,this.hasZ,this.hasM,i.getGeometry(e)))),this.spatialReference,t,o);return e.items=r.toConst(s.map(((t,r)=>i.cloneWithGeometry(e.items[r],y.convertFromGeometry(t,this.hasZ,this.hasM))))),e}async searchFeatures(e){const t=new Set;await Promise.all(e.map((e=>this.featureStore.forEachInBounds(e,(e=>t.add(e))))));const r=Array.from(t.values());return t.clear(),r}async _executeQueryForStatistics(e,t,r){e=s.clone(e);try{e=await this.schedule((()=>w.normalizeQuery(e,this.definitionExpression,this.spatialReference)),r),e=await this.reschedule((()=>T.validateStatisticsQuery(e,t,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference})),r);const i=await this.reschedule((()=>this._executeSceneFilterQuery(e,r)),r),o=await this.reschedule((()=>this._executeGeometryQuery(e,i,r)),r);return await this.reschedule((()=>this._executeAggregateIdsQuery(o)),r),await this.reschedule((()=>this.executeObjectIdsQuery(o)),r),await this.reschedule((()=>this.executeTimeQuery(o)),r),await this.reschedule((()=>this.executeAttributesQuery(o)),r),o}catch(t){if(t!==w.queryEngineEmptyResult)throw t;return new x.QueryEngineResult([],e,this)}}get test(){}},e.getQueryBBoxes=C,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../Extent","./aaBoundingRect","./DoubleArray"],(function(e,t,r,i){"use strict";function o(e=m){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function s(e,t,r,i,s,n,a=o()){return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a[4]=s,a[5]=n,a}function n(e,t,r,i=o()){return p(i,f),a(i,e,t,r),i}function a(e,t,r=0,i=t.length/3){let o=e[0],s=e[1],n=e[2],a=e[3],l=e[4],c=e[5];for(let e=0;e<i;e++)o=Math.min(o,t[r+3*e]),s=Math.min(s,t[r+3*e+1]),n=Math.min(n,t[r+3*e+2]),a=Math.max(a,t[r+3*e]),l=Math.max(l,t[r+3*e+1]),c=Math.max(c,t[r+3*e+2]);e[0]=o,e[1]=s,e[2]=n,e[3]=a,e[4]=l,e[5]=c}function l(e){return e[0]>=e[3]?0:e[3]-e[0]}function c(e){return e[1]>=e[4]?0:e[4]-e[1]}function u(e){return e[2]>=e[5]?0:e[5]-e[2]}function d(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function p(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function h(e){return 6===e.length}const f=[1/0,1/0,1/0,-1/0,-1/0,-1/0],m=[0,0,0,0,0,0],y=o();e.allFinite=function(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0},e.center=function(e,t=[0,0,0]){return t[0]=e[0]+l(e)/2,t[1]=e[1]+c(e)/2,t[2]=e[2]+u(e)/2,t},e.contains=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]},e.containsPoint=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]},e.containsPointWithMargin=function(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[2]>=e[2]-r&&t[0]<=e[3]+r&&t[1]<=e[4]+r&&t[2]<=e[5]+r},e.create=o,e.depth=c,e.diameter=function(e){const t=l(e),r=u(e),i=c(e);return Math.sqrt(t*t+r*r+i*i)},e.empty=function(e){return e?p(e,f):o(f)},e.equals=function(e,t,r){if(null==e||null==t)return e===t;if(!h(e)||!h(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},e.expandWithAABB=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])},e.expandWithBuffer=a,e.expandWithNestedArray=function(e,t,r){const i=t.length;let o=e[0],s=e[1],n=e[2],a=e[3],l=e[4],c=e[5];if(r)for(let e=0;e<i;e++){const r=t[e];o=Math.min(o,r[0]),s=Math.min(s,r[1]),n=Math.min(n,r[2]),a=Math.max(a,r[0]),l=Math.max(l,r[1]),c=Math.max(c,r[2])}else for(let e=0;e<i;e++){const r=t[e];o=Math.min(o,r[0]),s=Math.min(s,r[1]),a=Math.max(a,r[0]),l=Math.max(l,r[1])}e[0]=o,e[1]=s,e[2]=n,e[3]=a,e[4]=l,e[5]=c},e.expandWithOffset=function(e,t,r,i){e[0]=Math.min(e[0],e[0]+t),e[3]=Math.max(e[3],e[3]+t),e[1]=Math.min(e[1],e[1]+r),e[4]=Math.max(e[4],e[4]+r),e[2]=Math.min(e[2],e[2]+i),e[5]=Math.max(e[5],e[5]+i)},e.expandWithRect=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])},e.expandWithVec3=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])},e.fromBuffer=function(e,t=o()){return n(e,0,e.length/3,t)},e.fromExtent=function(e,t=o()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.hasZ?e.zmin:-1/0,t[3]=e.xmax,t[4]=e.ymax,t[5]=e.hasZ?e.zmax:1/0,t},e.fromMinMax=function(e,t,r=o()){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=t[0],r[4]=t[1],r[5]=t[2],r},e.fromRect=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e},e.fromRectValues=function(e,t,r,i,o){return e[0]=t,e[1]=r,e[2]=Number.NEGATIVE_INFINITY,e[3]=i,e[4]=o,e[5]=Number.POSITIVE_INFINITY,e},e.fromSubBuffer=n,e.fromValues=s,e.getMax=function(e,t){return t[0]=e[3],t[1]=e[4],t[2]=e[5],t},e.getMin=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.height=u,e.intersects=d,e.intersectsClippingArea=function(e,t){return null==t||d(e,t)},e.intersectsSegment=function(e,t,r){let i=0,o=1;for(let s=0;s<3;++s){const n=e[s],a=e[s+3],l=t[s],c=r[s],u=c<l,d=u?c:l,p=u?l:c,h=Math.max(n,d),f=Math.min(a,p);if(h>f)return!1;if(p===d)break;const m=p-d,y=(h-d)/m,g=(f-d)/m;if(i=Math.max(i,u?1-g:y),o=Math.min(o,u?1-y:g),i>o)return!1}return!0},e.is=h,e.isPoint=function(e){return 0===l(e)&&0===c(e)&&0===u(e)},e.maximumDimension=function(e){return Math.max(l(e),u(e),c(e))},e.negativeInfinity=f,e.offset=function(e,t,r,i,o=e){return o[0]=e[0]+t,o[1]=e[1]+r,o[2]=e[2]+i,o[3]=e[3]+t,o[4]=e[4]+r,o[5]=e[5]+i,o},e.positiveInfinity=[-1/0,-1/0,-1/0,1/0,1/0,1/0],e.scale=function(e,t,r=e){const i=e[0]+l(e)/2,o=e[1]+c(e)/2,s=e[2]+u(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=o+(e[1]-o)*t,r[2]=s+(e[2]-s)*t,r[3]=i+(e[3]-i)*t,r[4]=o+(e[4]-o)*t,r[5]=s+(e[5]-s)*t,r},e.set=p,e.setMax=function(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e},e.setMin=function(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r},e.size=function(e,t=[0,0,0]){return t[0]=l(e),t[1]=c(e),t[2]=u(e),t},e.toCorners=function(e,t=i.newDoubleArray(24)){const[r,o,s,n,a,l]=e;return t[0]=r,t[1]=o,t[2]=s,t[3]=r,t[4]=o,t[5]=l,t[6]=r,t[7]=a,t[8]=s,t[9]=r,t[10]=a,t[11]=l,t[12]=n,t[13]=o,t[14]=s,t[15]=n,t[16]=o,t[17]=l,t[18]=n,t[19]=a,t[20]=s,t[21]=n,t[22]=a,t[23]=l,t},e.toExtent=function(e,r){const i=isFinite(e[2])||isFinite(e[5]);return new t(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:r}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:r})},e.toRect=function(e,t){return t||(t=r.create()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t},e.width=l,e.wrap=function(e,t,r,i,o,n){return s(e,t,r,i,o,n,y)},e.zero=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],(function(e,t){"use strict";e.copyInto=function(e,t){for(let r=0;r<t.length;++r)e[r]=t[r];return e},e.doubleArrayFrom=function(e){return(t.isTypedArray(e)?e.byteLength/8:e.length)<=t.nativeArrayMaxSize?Array.from(e):new Float64Array(e)},e.doubleSubArray=function(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)},e.newDoubleArray=function(e,r=!1){return e<=t.nativeArrayMaxSize?r?new Array(e).fill(0):new Array(e):new Float64Array(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/featureConversionUtils":function(){define(["exports","../../core/Error","../../core/Logger","../../core/maybe","../../geometry/support/aaBoundingBox","../../geometry/support/aaBoundingRect","../../geometry/support/jsonUtils","./OptimizedFeature","./OptimizedFeatureSet","./OptimizedGeometry","./data/createFeatureId"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";function d(e,t){return e?t?4:3:t?3:2}const p=()=>r.getLogger("esri.layers.graphics.featureConversionUtils"),h={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},f=(e,t,r,i,o,s)=>{e[r]=o,e[r+1]=s},m=(e,t,r,i,o,s)=>{e[r]=o,e[r+1]=s,e[r+2]=t[i+2]},y=(e,t,r,i,o,s)=>{e[r]=o,e[r+1]=s,e[r+2]=t[i+3]},g=(e,t,r,i,o,s)=>{e[r]=o,e[r+1]=s,e[r+2]=t[i+2],e[r+3]=t[i+3]};function b(e,t,r,i){if(e){if(r)return t&&i?g:m;if(t&&i)return y}else if(t&&i)return m;return f}function v({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function S({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function _({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function x({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function w({scale:e,translate:t},r,i){return r*e[i]+t[i]}function T(e){const t=e.coords;return{x:t[0],y:t[1]}}function M(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function I(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function P(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function O(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function C(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function A(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function E(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function R(e,t){return e&&t?E:e?P:t?C:M}function F(e,t,r,i,o){const s=R(r,i);for(const r of t){const t=null!=r.geometry?s(new c,r.geometry):null;e.push(new a.OptimizedFeature(t,r.attributes,null,u.createFeatureId(r,o)))}return e}function D(e,t,r=R(null!=t.z,null!=t.m)){return r(e,t)}function L(e,t,r,i){for(const{geometry:o,attributes:s}of t)e.push({attributes:s,geometry:null!=o?V(o,r,i):null});return e}function V(e,t,r){if(null==e)return null;const i=d(t,r),o=[];for(let t=0;t<e.coords.length;t+=i){const r=[];for(let o=0;o<i;o++)r.push(e.coords[t+o]);o.push(r)}return t?r?{points:o,hasZ:t,hasM:r}:{points:o,hasZ:t}:r?{points:o,hasM:r}:{points:o}}function N(e,t,r,i,o){const s=d(r,i);for(const r of t){const t=null!=r.geometry?B(new c,r.geometry,s):null;e.push(new a.OptimizedFeature(t,r.attributes,null,u.createFeatureId(r,o)))}return e}function B(e,t,r=d(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let o=0;for(const e of t.points)for(let t=0;t<r;t++)i[o++]=e[t];return e}function U(e,t,r){if(!e)return null;const i=d(t,r),{coords:o,lengths:s}=e,n=[];let a=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<i;t++)e.push(o[a++]);t.push(e)}n.push(t)}return t?r?{paths:n,hasZ:t,hasM:r}:{paths:n,hasZ:t}:r?{paths:n,hasM:r}:{paths:n}}function z(e,t,r,i,o){const s=d(r,i);for(const r of t){const t=null!=r.geometry?j(new c,r.geometry,s):null,i=null!=r.centroid?D(new c,r.centroid):null;e.push(new a.OptimizedFeature(t,r.attributes,i,u.createFeatureId(r,o)))}return e}function j(e,t,r=d(t.hasZ,t.hasM)){const{lengths:i,coords:o}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)o[s++]=t[e];i.push(e.length)}return e}function k(e,t,r){if(!e)return null;const i=d(t,r),{coords:o,lengths:s}=e,n=[];let a=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<i;t++)e.push(o[a++]);t.push(e)}n.push(t)}return t?r?{rings:n,hasZ:t,hasM:r}:{rings:n,hasZ:t}:r?{rings:n,hasM:r}:{rings:n}}function G(e,t,r=t.hasZ,i=t.hasM){return q(e,t.rings,r,i)}function q(e,t,r,i){const o=d(r,i),{lengths:s,coords:n}=e;let a=0;te(e);for(const e of t){for(const t of e)for(let e=0;e<o;e++)n[a++]=t[e];s.push(e.length)}return e}const H=[],W=[];function $(e,r,i,o,s,n){if(re(e),!i){for(const t of r){const r=u.createFeatureId(t,n);e.push(new a.OptimizedFeature(null,t.attributes,null,r))}return e}switch(i){case"esriGeometryPoint":return F(e,r,o,s,n);case"esriGeometryMultipoint":return N(e,r,o,s,n);case"esriGeometryPolyline":return z(e,r,o,s,n);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(e,t,r,i,o){for(const s of t){const t=null!=s.geometry?G(new c,s.geometry,r,i):null,n=u.createFeatureId(s,o);null!=s.centroid?e.push(new a.OptimizedFeature(t,s.attributes,M(new c,s.centroid),n)):e.push(new a.OptimizedFeature(t,s.attributes,null,n))}return e}(e,r,o,s,n);default:p().error("convertToFeatureSet:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${i}'`)),re(e)}return e}function J(e,r,i,o){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(r){case"esriGeometryPoint":{let e=T;return i&&o?e=A:i?e=I:o&&(e=O),e(s)}case"esriGeometryMultipoint":return V(s,i,o);case"esriGeometryPolyline":return U(s,i,o);case"esriGeometryPolygon":return k(s,i,o);default:return p().error("convertToGeometry:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${r}'`)),null}}function Y(e,r,i,o,s){if(re(e),null==i)return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,r);switch(i){case"esriGeometryPoint":return function(e,t,r,i){let o=T;r&&i?o=A:r?o=I:i&&(o=O);for(const r of t){const{geometry:t,attributes:i}=r,s=null!=t?o(t):null;e.push({attributes:i,geometry:s})}return e}(e,r,o,s);case"esriGeometryMultipoint":return L(e,r,o,s);case"esriGeometryPolyline":return function(e,t,r,i){for(const{geometry:o,attributes:s}of t)e.push({attributes:s,geometry:null!=o?U(o,r,i):null});return e}(e,r,o,s);case"esriGeometryPolygon":return function(e,t,r,i){for(const{geometry:o,attributes:s,centroid:n}of t){const t=null!=o?k(o,r,i):null;if(null!=n){const r=T(n);e.push({attributes:s,centroid:r,geometry:t})}else e.push({attributes:s,geometry:t})}return e}(e,r,o,s);default:p().error("convertToFeatureSet:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${i}'`))}return e}function Z(e,t,r,i,o,s,n=r,a=i){if(te(e),!t?.coords.length)return null;const l=h[o],{coords:c,lengths:u}=t,p=d(r,i),f=d(r&&n,i&&a),m=b(r,i,n,a);if(!u.length)return m(e.coords,c,0,0,v(s,c[0]),S(s,c[1])),te(e,p,0),e;let y,g,_,x,w=0,T=0,M=T;for(const t of u){if(t<l)continue;let r=0;T=M,_=y=v(s,c[w]),x=g=S(s,c[w+1]),m(e.coords,c,T,w,_,x),r++,w+=p,T+=f;for(let i=1;i<t;i++,w+=p)_=v(s,c[w]),x=S(s,c[w+1]),_===y&&x===g||(m(e.coords,c,T,w,_-y,x-g),T+=f,r++,y=_,g=x);r>=l&&(e.lengths.push(r),M=T)}return re(e.coords,M),e.coords.length?e:null}function Q(e,t,r,i){const o=e[t],s=e[t+1],n=e[r],a=e[r+1],l=e[i],c=e[i+1];let u=n,d=a,p=l-u,h=c-d;if(0!==p||0!==h){const e=((o-u)*p+(s-d)*h)/(p*p+h*h);e>1?(u=l,d=c):e>0&&(u+=p*e,d+=h*e)}return p=o-u,h=s-d,p*p+h*h}function X(e,t,r,i,o,s,n){let a,l=i,c=0;for(let e=s+r;e<n;e+=r)a=Q(t,e,s,n),a>l&&(c=e,l=a);l>i&&(c-s>r&&X(e,t,r,i,o,s,c),o(e,t,e.length,c,t[c],t[c+1]),n-c>r&&X(e,t,r,i,o,c,n))}function K(e,t,r,o,s){const{coords:n,lengths:a}=t,l=d(r,o);if(!n.length)return e!==t&&te(e),e;i.assertIsSome(s);const{originPosition:c,scale:u,translate:p}=s,h=ie;h.originPosition=c;const f=h.scale;f[0]=u[0]??1,f[1]=-(u[1]??1),f[2]=u[2]??1,f[3]=u[3]??1;const m=h.translate;if(m[0]=p[0]??0,m[1]=p[1]??0,m[2]=p[2]??0,m[3]=p[3]??0,!a.length){for(let t=0;t<l;++t)e.coords[t]=w(h,n[t],t);return e!==t&&te(e,l,0),e}let y=0;for(let t=0;t<a.length;t++){const r=a[t];e.lengths[t]=r;for(let t=0;t<l;++t)e.coords[y+t]=w(h,n[y+t],t);let i=e.coords[y],o=e.coords[y+1];y+=l;for(let t=1;t<r;t++,y+=l){i+=n[y]*f[0],o+=n[y+1]*f[1],e.coords[y]=i,e.coords[y+1]=o;for(let t=2;t<l;++t)e.coords[y+t]=w(h,n[y+t],t)}}return e!==t&&te(e,n.length,a.length),e}function ee(e,t,r,i){let o=0,s=e[i*t],n=e[i*(t+1)];for(let a=1;a<r;a++){const r=s+e[i*(t+a)],l=n+e[i*(t+a)+1],c=(r-s)*(l+n);s=r,n=l,o+=c}return.5*o}function te(e,t=0,r=0){re(e.lengths,r),re(e.coords,t)}function re(e,t=0){e.length!==t&&(e.length=t)}const ie={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};e.convertFromFeature=function(e,t,r,i,o){H[0]=e;const[s]=$(W,H,t,r,i,o);return re(H),re(W),s},e.convertFromFeatureSet=function(e,t){const r=new l,{hasM:i,hasZ:o,features:s,spatialReference:n,geometryType:a,exceededTransferLimit:c,transform:u,fields:d}=e;return d&&(r.fields=d),r.geometryType=a??null,r.spatialReference=n??null,s&&$(r.features,s,a,o,i,t),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),o&&(r.hasZ=o),u&&(r.transform=u),r},e.convertFromFeatures=$,e.convertFromGeometry=function(e,r,i){if(null==e)return null;const o=new c;return"hasZ"in e&&null==r&&(r=e.hasZ),"hasM"in e&&null==i&&(i=e.hasM),n.isPoint(e)?R(null!=r?r:null!=e.z,null!=i?i:null!=e.m)(o,e):n.isPolygon(e)?G(o,e,r,i):n.isPolyline(e)?j(o,e,d(r,i)):n.isMultipoint(e)?B(o,e,d(r,i)):void p().error("convertFromGeometry:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${e}'`))},e.convertFromMultipoint=B,e.convertFromMultipointFeatures=N,e.convertFromNestedArray=q,e.convertFromPoint=D,e.convertFromPointFeatures=F,e.convertFromPolygon=G,e.convertFromPolyline=j,e.convertFromPolylineFeatures=z,e.convertToFeature=function(e,t,r,i){W[0]=e,Y(H,W,t,r,i);const o=H[0];return re(H),re(W),o},e.convertToFeatureSet=function(e){const{spatialReference:t,transform:r,fields:i,hasM:o,hasZ:s,features:n,geometryType:a,exceededTransferLimit:l,queryGeometry:c,queryGeometryType:u}=e,d={features:Y([],n,a,s,o),fields:i,geometryType:a,spatialReference:t,queryGeometry:J(c,u,!1,!1)};return r&&(d.transform=r),l&&(d.exceededTransferLimit=l),o&&(d.hasM=o),s&&(d.hasZ=s),d},e.convertToFeatures=Y,e.convertToGeometry=J,e.convertToMultipoint=V,e.convertToMultipointFeatures=L,e.convertToPoint=function(e,t,r){return e?t?r?A(e):I(e):r?O(e):T(e):null},e.convertToPolygon=k,e.convertToPolyline=U,e.generalizeOptimizedGeometry=function(e,t,r,i,o,s,n=r,a=i){if(te(e),!t?.coords.length)return null;const l=h[o],{coords:c,lengths:u}=t,p=d(r,i),f=d(r&&n,i&&a),m=b(r,i,n,a);if(!u.length)return m(e.coords,c,0,0,c[0],c[1]),te(e,p,0),e;let y=0;const g=s*s;for(const t of u){if(t<l){y+=t*p;continue}const r=e.coords.length/f,i=y,o=y+(t-1)*p;m(e.coords,c,e.coords.length,i,c[i],c[i+1]),X(e.coords,c,p,g,m,i,o),m(e.coords,c,e.coords.length,o,c[o],c[o+1]);const s=e.coords.length/f-r;s>=l?e.lengths.push(s):re(e.coords,r*f),y+=t*p}return e.coords.length?e:null},e.getBoundsOptimizedGeometry=function(e,t,r,i){if(!t?.coords?.length)return null;const n=d(r,i);let a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=n){const r=e[t],i=e[t+1];a=Math.min(a,r),c=Math.max(c,r),l=Math.min(l,i),u=Math.max(u,i)}}return o.is(e)?o.fromRectValues(e,a,l,c,u):s.fromValues(a,l,c,u,e),e},e.getQuantizedArea=function(e,t){const{coords:r,lengths:i}=e;let o=0,s=0;for(let e=0;e<i.length;e++){const n=i[e];s+=ee(r,o,n,t),o+=n}return Math.abs(s)},e.getQuantizedBoundsOptimizedGeometry=function(e,t,r,i){const o=d(r,i),{lengths:s,coords:n}=t;let a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY,p=0;for(const e of s){let t=n[p],r=n[p+1];a=Math.min(t,a),l=Math.min(r,l),c=Math.max(t,c),u=Math.max(r,u),p+=o;for(let i=1;i<e;i++,p+=o){const e=n[p],i=n[p+1];t+=e,r+=i,e<0&&(a=Math.min(a,t)),e>0&&(c=Math.max(c,t)),i<0?l=Math.min(l,r):i>0&&(u=Math.max(u,r))}}return e[0]=a,e[1]=l,e[2]=c,e[3]=u,e},e.getSignedQuantizedRingArea=ee,e.quantizeForDisplay=function(e,t,r,i,o){const s=d(i,o);if(!e.lengths.length){if(e.coords.length<2)return null;const[r,i]=e.coords,o=_(t,r),s=x(t,i);return new c([],[o,s])}const n=new c([],[0,0]),a=h[r],l="esriGeometryPolygon"===r||"esriGeometryPolyline"===r;let u=0,p=0;for(let r=0;r<e.lengths.length;r++){const i=e.lengths[r],o=p;let c=_(t,e.coords[s*u]),d=x(t,e.coords[s*u+1]);n.coords[p++]=c,n.coords[p++]=d;let h=0,b=0,v=1;for(let r=1;r<i;r++){const i=_(t,e.coords[s*(r+u)]),o=x(t,e.coords[s*(r+u)+1]);if(i!==c||o!==d){const e=i-c,t=o-d;l&&0===(f=h)*(g=t)-(y=e)*(m=b)&&f*y+m*g>0?(n.coords[p-2]+=e,n.coords[p-1]+=t,c+=e,d+=t):(n.coords[p++]=i,n.coords[p++]=o,c=i,d=o,h=e,b=t,v+=1)}}v<a?p=o:n.lengths.push(v),u+=i}var f,m,y,g;return 0===n.lengths.length?null:n},e.quantizeOptimizedFeatureSet=function(e,t){const{geometryType:r,features:i,hasM:o,hasZ:s}=t;if(!e)return t;for(let t=0;t<i.length;t++){const n=i[t],a=n.weakClone();a.geometry=new c,Z(a.geometry,n.geometry,o,s,r,e),n.centroid&&(a.centroid=new c,Z(a.centroid,n.centroid,o,s,"esriGeometryPoint",e)),i[t]=a}return t.transform=e,t},e.quantizeOptimizedGeometry=Z,e.quantizeX=v,e.quantizeY=S,e.removeCollinearVertices=function(e,t,r,i,o){if(!t?.coords?.length)return null;const s=h[r],{coords:n,lengths:a}=t,l=b(i,o,i,o),c=d(i,o);let u=0,p=0,f=0,m=0;for(const t of a){p=m,l(e.coords,n,p,u,n[u],n[u+1]),u+=c;let r=n[u],i=n[u+1],o=r,a=i,d=i/r;p+=c,l(e.coords,n,p,u,o,a),u+=c;for(let s=2;s<t;s++){r=n[u],i=n[u+1];const t=i/r,s=d===t||!isFinite(d)&&!isFinite(t),h=s&&isFinite(t)?d>=0&&t>=0||d<=0&&t<=0:a>=0&&i>=0||a<=0&&i<=0;s&&h?(o+=r,a+=i):(o=r,a=i,p+=c),l(e.coords,n,p,u,o,a),u+=c,d=t}p+=c;const h=(p-m)/c;h>=s&&(e.lengths[f]=h,m=p,f++)}return e.coords.length>m&&(e.coords.length=m),e.lengths.length>f&&(e.lengths.length=f),e.coords.length&&e.lengths.length?e:null},e.removeZMValues=function(e,t,r,i,o,s){if(te(e),e.lengths.push(...t.lengths),r===o&&i===s)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{const n=d(r,i),a=b(r,i,o,s),l=t.coords;for(let t=0;t<l.length;t+=n)a(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e},e.unquantizeOptimizedFeatureSet=function(e){const{transform:t,features:r,hasM:i,hasZ:o}=e;if(!t)return e;for(const e of r)null!=e.geometry&&K(e.geometry,e.geometry,i,o,t),null!=e.centroid&&K(e.centroid,e.centroid,i,o,t);return e.transform=null,e},e.unquantizeOptimizedGeometry=K,e.unquantizeValue=w,e.unquantizeX=function(e,t){return w(e,t,0)},e.unquantizeY=function(e,t){return w(e,-t,1)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/OptimizedFeature":function(){define(["exports","../../core/memoryEstimations","./centroid","./OptimizedGeometry"],(function(e,t,r,i){"use strict";class o{constructor(e=null,t={},r,i,o=0){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=i,this.displayId=o}static fromJSON(e){const t=e.geometry?i.fromJSON(e.geometry):null,r=e.centroid?i.fromJSON(e.centroid):null,s=e.objectId;return new o(t,e.attributes,r,s)}weakClone(){const e=new o(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){const e=this.geometry?.clone(),t=new o(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t}ensureCentroid(e){return this.centroid??=r.getCentroidOptimizedGeometry(new i,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+t.estimateAttributesMemory(this.attributes)+(this.geometry?.usedMemory??0)}}e.OptimizedFeature=o,e.OptimizedFeatureWithGeometry=class extends o{},e.hasGeometry=function(e){return!!e.geometry?.coords?.length},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/centroid":function(){define(["exports"],(function(e){"use strict";function t(e,t){return e?t?4:3:t?3:2}function r(e,r,i,o,s,n){const a=t(s,n);let l=i,c=i+a,u=0,d=0,p=0,h=0,f=0;for(let t=0,i=o-1;t<i;t++,l+=a,c+=a){const t=r[l],i=r[l+1],o=r[l+2],n=r[c],a=r[c+1],m=r[c+2];let y=t*a-n*i;h+=y,u+=(t+n)*y,d+=(i+a)*y,s&&(y=t*m-n*o,p+=(o+m)*y,f+=y),t<e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),i<e[2]&&(e[2]=i),i>e[3]&&(e[3]=i),s&&(o<e[4]&&(e[4]=o),o>e[5]&&(e[5]=o))}if(h>0&&(h*=-1),f>0&&(f*=-1),!h)return null;const m=[u,d,.5*h];return s&&(m[3]=p,m[4]=.5*f),m}function i(e,r,i,l,c){const u=t(l,c);let d=r,p=r+u,h=0,f=0,m=0,y=0;for(let t=0,r=i-1;t<r;t++,d+=u,p+=u){const t=e[d],r=e[d+1],i=e[d+2],c=e[p],u=e[p+1],g=e[p+2],b=l?s(t,r,i,c,u,g):o(t,r,c,u);if(b)if(h+=b,l){const e=a(t,r,i,c,u,g);f+=b*e[0],m+=b*e[1],y+=b*e[2]}else{const e=n(t,r,c,u);f+=b*e[0],m+=b*e[1]}}return h>0?l?[f/h,m/h,y/h]:[f/h,m/h]:i>0?l?[e[r],e[r+1],e[r+2]]:[e[r],e[r+1]]:null}function o(e,t,r,i){const o=r-e,s=i-t;return Math.sqrt(o*o+s*s)}function s(e,t,r,i,o,s){const n=i-e,a=o-t,l=s-r;return Math.sqrt(n*n+a*a+l*l)}function n(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function a(e,t,r,i,o,s){return[e+.5*(i-e),t+.5*(o-t),r+.5*(s-r)]}e.getCentroidOptimizedGeometry=function(e,o,s,n){if(!o?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const a=e.coords,l=[],c=s?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:u,coords:d}=o,p=t(s,n);let h=0;for(const e of u){const t=r(c,d,h,e,s,n);t&&l.push(t),h+=e*p}if(l.sort(((e,t)=>{let r=e[2]-t[2];return 0===r&&s&&(r=e[4]-t[4]),r})),l.length){let e=6*l[0][2];a[0]=l[0][0]/e,a[1]=l[0][1]/e,s&&(e=6*l[0][4],a[2]=0!==e?l[0][3]/e:0),(a[0]<c[0]||a[0]>c[1]||a[1]<c[2]||a[1]>c[3]||s&&(a[2]<c[4]||a[2]>c[5]))&&(a.length=0)}if(!a.length){const e=o.lengths[0]?i(d,0,u[0],s,n):null;if(!e)return null;a[0]=e[0],a[1]=e[1],s&&e.length>2&&(a[2]=e[2])}return e},e.lineCentroid=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/OptimizedGeometry":function(){define(["../../core/memoryEstimations"],(function(e){"use strict";class t{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new t(e.lengths,e.coords)}static fromRect(e){const[r,i,o,s]=e,n=o-r,a=s-i;return new t([5],[r,i,n,0,0,a,-n,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce(((e,t)=>e+t))}get usedMemory(){return 64+e.estimateNumberArrayMemory(this.lengths,this.coords)}area(){let e=0,t=0;if(!this.lengths.length)return 0;for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];if(i<3)continue;let o=this.coords[2*t],s=this.coords[2*t+1];for(let r=1;r<i;r+=1){const i=this.coords[2*(r+t)],n=this.coords[2*(r+t)+1];e+=-.5*(i-o)*(n+s),o=i,s=n}t+=i}return e}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];for(let r=0;r<i;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=i}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let i=0;for(const e of r){for(let r=1;r<e;r++)t[2*(i+r)]+=t[2*(i+r)-2],t[2*(i+r)+1]+=t[2*(i+r)-1];i+=e}return e}clone(e){if(0===this.lengths.length)return new t([],[this.coords[0],this.coords[1]]);const r=2*(0===this.lengths.length?1:this.lengths.reduce(((e,t)=>e+t))),i=this.coords.slice(0,r);return e?(e.set(i),new t(this.lengths,e)):new t(Array.from(this.lengths),Array.from(i))}}return t}))},"esri/layers/graphics/OptimizedFeatureSet":function(){define((function(){"use strict";class e{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new e;return t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}return e}))},"esri/layers/graphics/data/createFeatureId":function(){define(["exports"],(function(e){"use strict";e.createFeatureId=function(e,t){switch(t.type){case"object-id":case"unique-id-simple":return e.attributes[t.fieldName];case"unique-id-composite":{const r=[];for(const i of t.fieldNames)r.push(e.attributes[i]??null);return JSON.stringify(r)}}},e.createFeatureIdFromLayer=function(e,t){if("uniqueIdFields"in t&&t.uniqueIdFields?.length){if(1===t.uniqueIdFields.length)return e.attributes?.[t.uniqueIdFields[0]];const r=t.uniqueIdFields.map((t=>e.attributes?.[t]));return JSON.stringify(r)}return"objectIdField"in t&&t.objectIdField?e.attributes?.[t.objectIdField]:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],(function(e,t,r,i){"use strict";const o=new r.WhereClauseCache(50,500),s="unsupported-query",n=" as ",a=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),l=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),c=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...a,...l]);function u(e,r,i={}){const n=d(r,e);if(!n){const i=o.getError(r,e);throw new t(s,"invalid SQL expression",{expression:r,error:i})}const a=i.expressionName||"expression";if(i.validateStandardized&&!n.isStandardized)throw new t(s,`${a} is not standard`,{expression:r});if(i.validateAggregate&&!n.isAggregate)throw new t(s,`${a} does not contain a valid aggregate function`,{expression:r});return n.fieldNames}function d(e,t){return e?o.get(e,t):null}function p(e){return/\((.*?)\)/.test(e)?e:e.split(n)[0]}function h(e,r,i,o={}){const n=new Map;if(function(e,t,r,i,o){const s=o.includes("*")?[...r,...o.filter((e=>"*"!==e))]:o;for(const o of s)if(t.get(o))f(e,t,r,i,o);else try{const s=u(t,p(o),{validateStandardized:!0});for(const o of s)f(e,t,r,i,o)}catch(t){e.set(o,{type:"expression-error",expression:o,error:t})}}(n,e,r,o.allowedFieldTypes??c,i),n.size){const e=o.expressionName??"expression";throw new t(s,`${e} contains invalid or missing fields`,{errors:Array.from(n.values()),query:o.query})}}function f(e,t,r,o,s){const n=t.get(s);n?r.has(n.name)?"all"!==o&&!1===o?.has(n.type)&&e.set(s,{type:"invalid-type",fieldName:n.name,fieldType:i.kebabDict.fromJSON(n.type),allowedFieldTypes:Array.from(o,(e=>i.kebabDict.fromJSON(e)))}):e.set(s,{type:"missing-field",fieldName:n.name}):e.set(s,{type:"invalid-field",fieldName:s})}e.allDateAndTimeFieldTypes=l,e.getAliasFromFieldName=function(e){return e.split(n)[1]},e.getExpressionFromFieldName=p,e.getWhereClause=d,e.numericFieldTypes=a,e.validateFields=h,e.validateHaving=function(e,r,i,o,n){if(!i)return!0;const a="having clause",l=u(e,i,{validateAggregate:!0,expressionName:a});h(e,r,l,{expressionName:a,query:n});const c=d(i,e),p=c?.getExpressions().every((t=>{const{aggregateType:r,field:i}=t,s=e.get(i)?.name;return o.some((t=>{const{onStatisticField:i,statisticType:o}=t,n=e.get(i)?.name;return n===s&&o.toLowerCase().trim()===r}))}));if(!p)throw new t(s,"expressions in having clause should also exist in outStatistics",{having:i});return!0},e.validateWhere=function(e,t,r,i){if(!r)return!0;const o="where clause";return h(e,t,u(e,r,{validateStandardized:!0,expressionName:o}),{expressionName:o,query:i}),!0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/sql/WhereClauseCache":function(){define(["exports","../LRUCache","./WhereClause"],(function(e,t,r){"use strict";e.WhereClauseCache=class{constructor(e,r){this._cache=new t.LRUCache(e),this._invalidCache=new t.LRUCache(r)}get(e,t){const i=`${t?.uid}:${e}`,o=this._cache.get(i);if(o)return o;if(null!=this._invalidCache.get(i))return null;try{const o=r.create(e,{fieldsIndex:t});return this._cache.put(i,o),o}catch(e){return this._invalidCache.put(i,e),null}}getError(e,t){const r=`${t?.uid}:${e}`;return this._invalidCache.get(r)??null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/LRUCache":function(){define(["exports","./MemCache"],(function(e,t){"use strict";e.LRUCache=class{constructor(e,r){this.removeFunc=r,this._storage=new t.MemCacheStorage,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/MemCache":function(){define(["exports"],(function(e){"use strict";var t;e.RemoveMode=void 0,(t=e.RemoveMode||(e.RemoveMode={}))[t.ALL=0]="ALL",t[t.SOME=1]="SOME";class r{constructor(e,t,r,o=0){this.name=e,this._storage=t,this.removeFunc=r,this._defaultPriority=o,this.id=`${i++}${s}`,this.size=0,this._hit=0,this._miss=0,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}set maxSize(e){this._storage.setMaxSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,r=this._defaultPriority){this._storage.put(this,e,t,t.cachedMemory,r)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t){this._storage.updateSize(this,e,t,t.cachedMemory)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}*[Symbol.iterator](){yield*this._storage.values(this)}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}let i=0;class o{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}const s=":";e.MemCache=r,e.MemCacheStorage=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear()}register(e){this._users.set(e.id.slice(0,-1),e)}deregister(e){this.clear(e),this._sizeLimits.delete(e),this._users.delete(e.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(t,r,i,s,n){r=t.id+r;const a=this._db.get(r);if(a&&(this._size-=a.size,t.size-=a.size,this._db.delete(r),a.entry!==i&&this._notifyRemove(r,a.entry,a.size,e.RemoveMode.ALL)),s>this._maxSize)return void this._notifyRemove(r,i,s,e.RemoveMode.ALL);if(void 0===i)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${r}`),void this._notifyRemove(r,i,0,e.RemoveMode.ALL);const l=1+Math.max(n,-4)- -3;this._db.set(r,new o(i,s,l)),this._size+=s,t.size+=s,this._checkSize()}updateSize(t,r,i,o){r=t.id+r;const s=this._db.get(r);if(s&&s.entry===i){for(this._size-=s.size,t.size-=s.size;o>this._maxSize;){const t=this._notifyRemove(r,i,o,e.RemoveMode.SOME);if(!(null!=t&&t>0))return void this._db.delete(r);o=t}s.size=o,this._size+=o,t.size+=o,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,i)=>{const o=e.lifetime;r[o]=(r[o]||0)+e.size,this._users.forEach((r=>{const{id:o,name:s}=r;if(i.startsWith(o)){const r=t[s]||0;t[s]=r+e.size}}))}));const i={};this._users.forEach((e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const o=t[r]||0;t[r]=o,i[r]=Math.round(100*e.hitRate)+"%"}else i[r]="0%"}));const o=Object.keys(t);o.sort(((e,r)=>t[r]-t[e])),o.forEach((r=>e[r]=Math.round(t[r]/2**20)+"MB / "+i[r]));for(let t=r.length-1;t>=0;--t){const i=r[t];i&&(e["Priority "+(t+-3-1)]=Math.round(i/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forEach((e=>e.resetHitRate()))}clear(t){const r=t.id;this._db.forEach(((t,i)=>{i.startsWith(r)&&(this._size-=t.size,this._db.delete(i),this._notifyRemove(i,t.entry,t.size,e.RemoveMode.ALL))})),t.size=0}clearAll(){this._db.forEach(((t,r)=>this._notifyRemove(r,t.entry,t.size,e.RemoveMode.ALL))),this._users.forEach((e=>e.size=0)),this._size=0,this._db.clear()}*values(e){for(const[t,r]of this._db)t.startsWith(e.id)&&(yield r.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,i){const o=this._users.get(e.split(s)[0])?.removeFunc,n=o?.(t,i,r);return"number"==typeof n?n:null}_checkSize(){this._sizeLimits.forEach(((e,t)=>this._checkSizeLimits(e,t))),this._checkSizeLimits(this.maxSize)}setMaxSize(e,t){null==t||t<=0?this._sizeLimits.delete(e):this._sizeLimits.set(e,t)}_checkSizeLimits(e,t){const r=t??this;if(r.size<=e)return;const i=t?.id;let o=!0;for(;o;){o=!1;for(const[n,a]of this._db)if(0===a.lifetime&&(!i||n.startsWith(i))){const i=t??this._users.get(n.split(s)[0]);if(this._purgeItem(n,a,i),r.size<=.9*e)return;o||=this._db.has(n)}}for(const[o,n]of this._db)if(!i||o.startsWith(i)){const i=t??this._users.get(o.split(s)[0]);if(this._purgeItem(o,n,i),r.size<=.9*e)return}}_purgeItem(t,r,i){if(this._db.delete(t),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const o=this._notifyRemove(t,r.entry,r.size,e.RemoveMode.SOME);null!=o&&o>0&&(this._size+=o,i&&(i.size+=o),r.lives=r.lifetime,r.size=o,this._db.set(t,r))}else--r.lives,this._db.set(t,r)}},e.MinPriority=-3,e.NoPriority=-4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],(function(e,t,r){"use strict";const i=new r,o=new r,s=new r,n={esriGeometryPoint:t.convertToPoint,esriGeometryPolyline:t.convertToPolyline,esriGeometryPolygon:t.convertToPolygon,esriGeometryMultipoint:t.convertToMultipoint},a="_geVersion",l=(e,t)=>e===a?void 0:t;e.cleanFromGeometryEngine=function(e){return e&&a in e?JSON.parse(JSON.stringify(e,l)):e},e.getGeometry=function(e,r,a,l,c,u,d=r,p=a){const h=r&&d,f=a&&p,m=null!=l?"coords"in l?l:l.geometry:null;if(null==m)return null;if(c){let i=t.generalizeOptimizedGeometry(o,m,r,a,e,c,d,p);return u&&(i=t.quantizeOptimizedGeometry(s,i,h,f,e,u)),n[e]?.(i,h,f)??null}if(u){const i=t.quantizeOptimizedGeometry(s,m,r,a,e,u,d,p);return n[e]?.(i,h,f)??null}return t.removeZMValues(i,m,r,a,d,p),n[e]?.(i,h,f)??null},e.transformCentroid=function(e,r,i,o=e.hasZ,n=e.hasM){if(null==r)return null;const a=e.hasZ&&o,l=e.hasM&&n;if(i){const c=t.quantizeOptimizedGeometry(s,r,e.hasZ,e.hasM,"esriGeometryPoint",i,o,n);return t.convertToPoint(c,a,l)}return t.convertToPoint(r,a,l)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/data/projectionSupport":function(){define(["exports","../../../core/arrayUtils","../../../core/promiseUtils","../../../geometry/projectionUtils","../../../geometry/geometryAdapters/json","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils"],(function(e,t,r,i,o,s,n){"use strict";const a=[0,0];function l(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,a),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,a),[r.xmax,r.ymax]=e(t.xmax,t.ymax,a),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:c(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:c(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:u(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function c(e,t){const r=[];for(const i of e)r.push(u(i,t));return r}function u(e,t){const r=[];for(const i of e){const e=t(i[0],i[1],[0,0]);r.push(e),i.length>2&&e.push(i[2]),i.length>3&&e.push(i[3])}return r}const d=l.bind(null,n.lngLatToXY),p=l.bind(null,n.xyToLngLat),h=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,i,o){if(!e?.length||!t||!i||s.equals(t,i))return e;const n={geometries:e,inSpatialReference:t,outSpatialReference:i,geographicTransformation:o,resolve:r.createResolver()};return this._jobs.push(n),this._timer??=setTimeout(this._process,10),n.resolve.promise}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:r,outSpatialReference:a,resolve:l,geographicTransformation:c}=e;n.canProject(r,a)?s.isWebMercator(a)?l(t.map(d)):l(t.map(p)):l(i.projectMany(o.jsonAdapter,t,r,a,c,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};e.checkProjectionSupport=async function(e,r){if(!e||!r)return;const o=Array.isArray(e)?e.map((e=>null!=e.geometry?e.geometry.spatialReference:null)).filter(t.isSome):[e];await i.initializeProjection(o.map((e=>({source:e,dest:r}))))},e.project=function(e,t,r,a){if(!e)return null;if(r||(r=t,t=e.spatialReference),!s.isValid(t)||!s.isValid(r)||s.equals(t,r))return e;if(n.canProject(t,r)){const t=s.isWebMercator(r)?d(e):p(e);return t.spatialReference=r,t}return i.projectMany(o.jsonAdapter,[e],t,r,null,a)[0]},e.projectMany=function(e,t,r,i){return h.push(e,t,r,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/geometryAdapters/json":function(){define(["exports"],(function(e){"use strict";const t={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,i){const o=new r(e.getPointX(t),e.getPointY(t),i),s=e.hasZ(t),n=e.hasM(t);return s&&(o.z=e.getPointZ(t)),n&&(o.m=e.getPointM(t)),o},exportPolygon:function(e,t,r){return new i(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new o(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new s(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){const i=e.hasZ(t),o=e.hasM(t),s=new n(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(i){const r=e.getZExtent(t);s.zmin=r.vmin,s.zmax=r.vmax}if(o){const r=e.getMExtent(t);s.mmin=r.vmin,s.mmax=r.vmax}return s}};class r{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class i{constructor(e,t,r,i){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class o{constructor(e,t,r,i){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class s{constructor(e,t,r,i){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class n{constructor(e,t,r,i,o){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=i,this.spatialReference=o,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}e.jsonAdapter=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/data/QueryEngineCache":function(){define(["exports","../../../core/has"],(function(e,t){"use strict";let r=0;class i{constructor(e){this.items=e,this.time=performance.now(),this.id=r++}}e.QueryEngineCache=class{constructor(){this._storage=new Map,this._purgeInterval=5,this._sweep=()=>{if(this._timer=void 0,!this._storage)return;const e=1e3*this._purgeInterval,t=performance.now()-e;for(const[r,i]of this._storage){if(!(i.time<t))return void(this._storage.size>0&&(this._timer=setTimeout(this._sweep,e)));this._storage.delete(r)}}}destroy(){this._storage?.clear(),this._storage=null,clearTimeout(this._timer)}put(e,t){this._storage?.set(e,new i(t)),this._scheduleSweep()}get(e){const t=this._storage?.get(e);if(t)return this._storage?.delete(e),t.time=performance.now(),this._storage?.set(e,t),t.items}clear(){this._storage?.clear()}_scheduleSweep(){this._storage&&(this._timer??=setTimeout(this._sweep,1e3*this._purgeInterval))}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["exports"],(function(e){"use strict";e.queryBinsCapabilities={supportsDate:!0,supportsFixedInterval:!0,supportsAutoInterval:!0,supportsFixedBoundaries:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!0,supportedStatistics:{count:!0,sum:!0,avg:!0,var:!0,stddev:!0,min:!0,max:!0,percentileContinuous:!0,percentileDiscrete:!0,envelope:!0,centroid:!0,convexHull:!0},supportedNormalizationTypes:{field:!0,log:!0,naturalLog:!0,percentOfTotal:!0,squareRoot:!0}},e.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsCurrentUser:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsPaginationOnAggregatedQueries:!1,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsReturnMesh:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,maxUniqueIDCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0,supportsTrueCurve:!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/data/QueryEngineResult":function(){define(["require","exports","../../../core/lang","../../../geometry/support/centroid","../../../geometry/support/extentUtils","../../../geometry/support/quantizationUtils","../../../geometry/support/spatialReferenceUtils","./AttributesBuilder","./geometryUtils","./projectionSupport","./queryUtils","./SnappingCandidate","../../support/fieldUtils","../../../rest/support/AutoIntervalBinParameters","../../../rest/support/DateBinParameters","../../../rest/support/DateBinUtils","../../../rest/support/FixedBoundariesBinParameters","../../../rest/support/FixedIntervalBinParameters","../../../statistics/utils","../../../time/constants","../../../chunks/datetime"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S){"use strict";const _="bin";function x(e,t,r,i){const o=i.x-r.x,s=i.y-r.y,n=t.x-r.x,a=t.y-r.y,l=o*o+s*s;if(0===l)return!1;const c=n*o+a*s,u=Math.min(1,Math.max(0,c/l));return e.x=r.x+o*u,e.y=r.y+s*u,!0}function w(e,t){return e?t?4:3:t?3:2}class T{constructor(e,t){this.coords=e,this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}const M=[1];t.QueryEngineResult=class{constructor(e,t,r){this.items=e,this.query=t,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new a(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:t,having:r,outStatistics:i}=this.query,o=t?.length;if(!o)return 1;const s=new Map,n=new Map,l=new Set;for(const o of i){const{statisticType:i}=o,a="exceedslimit"!==i?o.onStatisticField:void 0;if(!n.has(a)){const r=[];for(const i of t){const t=this._getAttributeValues(e,i,this.items,s);r.push(t)}n.set(a,this._calculateUniqueValues(r,this.items,e.returnDistinctValues))}const c=n.get(a);for(const t in c){const{data:i,items:o}=c[t],s=i.join(",");r&&!e.validateItems(o,r)||l.add(s)}}return l.size}async createQueryResponse(){let e;if(e=this.query.outStatistics?this.query.outStatistics.some((e=>"exceedslimit"===e.statisticType))?this._createExceedsLimitQueryResponse():await this._createStatisticsQueryResponse(this.query,this.items):this._createFeatureQueryResponse(this.query),this.query.returnQueryGeometry){const t=this.query.geometry;n.isValid(this.query.outSR)&&!n.equals(t.spatialReference,this.query.outSR)?e.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...c.project(t,t.spatialReference,this.query.outSR)}):e.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...t})}return e}createSnappingResponse(e,t,r){const i=this.featureAdapter,o=w(this.hasZ,this.hasM),{point:s,mode:n}=e,a="number"==typeof e.distance?e.distance:e.distance.x,l="number"==typeof e.distance?e.distance:e.distance.y,c={candidates:[]},u="esriGeometryPolygon"===this.geometryType,p="esriGeometryPolyline"===this.geometryType||"esriGeometryPoint"===this.geometryType,h=this._getPointCreator(n,t,this.spatialReference,r),f=new T(null,0),m=new T(null,0),y={x:0,y:0,z:0};for(const t of this.items){const r=i.getGeometry(t);if(null==r)continue;const{coords:n}=r,g=r.isPoint?M:r.lengths;if(f.coords=n,m.coords=n,e.returnEdge){let e=0;for(let r=0;r<g.length;r++){const n=g[r],p=e;for(let r=0;r<n;r++,e+=o){if(!u&&r===n-1)continue;const g=f;g.coordsIndex=e;const b=m;b.coordsIndex=r===n-1?p:e+o;const v=y;if(!x(y,s,g,b))continue;const S=(s.x-v.x)/a,_=(s.y-v.y)/l,w=S*S+_*_;w<=1&&c.candidates.push(d.makeEdgeCandidate(i.getObjectId(t),h(v),Math.sqrt(w),h(g),h(b)))}}}if("all"===e.vertexMode){let e=0;for(let r=0;r<g.length;r++){const n=g[r],p=e,y=m;y.coordsIndex=p;for(let r=0;r<n;r++,e+=o){const o=f;if(o.coordsIndex=e,u&&r===n-1&&o.x===y.x&&o.y===y.y)continue;const p=(s.x-o.x)/a,m=(s.y-o.y)/l,g=p*p+m*m;g<=1&&c.candidates.push(d.makeVertexCandidate(i.getObjectId(t),h(o),Math.sqrt(g)))}}}else if(p&&"ends"===e.vertexMode){let e=0;const r=[];for(let t=0;t<g.length;t++){r.push(e);const i=g[t];e+=i*o,!u&&i>1&&r.push(e-o)}for(const e of r){const r=f;r.coordsIndex=e;const o=(s.x-r.x)/a,n=(s.y-r.y)/l,u=o*o+n*n;u<=1&&c.candidates.push(d.makeVertexCandidate(i.getObjectId(t),h(r),Math.sqrt(u)))}}}return c.candidates.sort(((e,t)=>e.distance-t.distance)),c}_getPointCreator(e,t,r,i){const o=null==i||n.equals(r,i)?e=>e:e=>c.project(e,r,i),{hasZ:s}=this;return"3d"===e?s&&t?({x:e,y:t,z:r})=>o({x:e,y:t,z:r}):({x:e,y:t})=>o({x:e,y:t,z:0}):({x:e,y:t})=>o({x:e,y:t})}async createSummaryStatisticsResponse(e){const{field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,minValue:n,maxValue:a,scale:l,timeZone:c,outStatisticTypes:u}=e,d=this.fieldsIndex.get(t),h=p.isDateField(d)||p.isDateOnlyField(d)||p.isTimestampOffsetField(d),f=await this._getDataValues({field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,scale:l,timeZone:c},this.items),m=b.isNullCountSupported({normalizationType:o,normalizationField:i,minValue:n,maxValue:a}),y={value:.5,fieldType:d?.type},g=p.isStringField(d)?b.calculateStringStatistics({values:f,supportsNullCount:m,percentileParams:y,outStatisticTypes:u}):b.calculateStatistics({values:f,minValue:n,maxValue:a,useSampleStdDev:!o,supportsNullCount:m,percentileParams:y,outStatisticTypes:u});return b.processSummaryStatisticsResult(g,u,h)}async createUniqueValuesResponse(e){const{field:t,valueExpression:r,domains:i,returnAllCodedValues:o,scale:s,timeZone:n}=e,a=await this._getDataValues({field:t,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:r,scale:s,timeZone:n},this.items,!1),l=b.calculateUniqueValuesCount(a);return b.createUVResult(l,i,o,e.fieldDelimiter)}async createClassBreaksResponse(e){const{field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,classificationMethod:n,standardDeviationInterval:a,minValue:l,maxValue:c,numClasses:u,scale:d,timeZone:p}=e,h=await this._getDataValues({field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,scale:d,timeZone:p},this.items),f=b.calculateClassBreaks(h,{field:t,normalizationField:i,normalizationType:o,normalizationTotal:s,classificationMethod:n,standardDeviationInterval:a,minValue:l,maxValue:c,numClasses:u});return b.resolveCBResult(f,n)}async createHistogramResponse(e){const{field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,classificationMethod:n,standardDeviationInterval:a,minValue:l,maxValue:c,numBins:u,scale:d,timeZone:p}=e,h=await this._getDataValues({field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,scale:d,timeZone:p},this.items);return b.calculateHistogram(h,{field:t,normalizationField:i,normalizationType:o,normalizationTotal:s,classificationMethod:n,standardDeviationInterval:a,minValue:l,maxValue:c,numBins:u})}_sortFeatures(e,t,r){if(e.length>1&&t?.length)for(const i of t.slice().reverse()){const t=i.split(" "),o=t[0],s=this.fieldsIndex.get(o),n=!!t[1]&&"desc"===t[1].toLowerCase(),a=b.getAttributeComparator(s?.type,n);e.sort(((e,t)=>{const i=r(e,o,s),n=r(t,o,s);return a(i,n)}))}}_createFeatureQueryResponse(e){const{items:t,geometryType:r,hasM:i,hasZ:o,objectIdField:n,spatialReference:a}=this,{outFields:c,outSR:u,quantizationParameters:d,resultRecordCount:p,resultOffset:h,returnZ:f,returnM:m}=e,y=null!=p&&t.length>(h||0)+p,g=c&&(c.includes("*")?[...this.fieldsIndex.fields]:c.map((e=>this.fieldsIndex.get(e))));return{exceededTransferLimit:y,features:this._createFeatures(e,t),fields:g,geometryType:r,hasM:i&&m,hasZ:o&&f,objectIdFieldName:n,spatialReference:l.cleanFromGeometryEngine(u||a),transform:d&&s.toQuantizationTransform(d)||null}}_createFeatures(e,t){const r=new a(e,this.featureAdapter,this.fieldsIndex),{hasM:i,hasZ:o}=this,{orderByFields:n,quantizationParameters:c,returnGeometry:u,returnCentroid:d,maxAllowableOffset:p,resultOffset:h,resultRecordCount:f,returnZ:m=!1,returnM:y=!1}=e,g=o&&m,b=i&&y;let v=[],S=0;const _=[...t];if(this._sortFeatures(_,n,((e,t,i)=>r.getFieldValue(e,t,i))),this.geometryType&&(u||d)){const e=s.toQuantizationTransform(c)??void 0,t="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(u&&!d)for(const i of _){const o=this.featureAdapter.getGeometry(i),s={attributes:r.getAttributes(i),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,o,p,e,g,b),metadata:this.featureAdapter.getMetadata?.(i)};t&&o&&!s.geometry&&(s.centroid=l.transformCentroid(this,this.featureAdapter.getCentroid(i,this),e)),v[S++]=s}else if(!u&&d)for(const t of _)v[S++]={attributes:r.getAttributes(t),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of _)v[S++]={attributes:r.getAttributes(t),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(t,this),e),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),p,e,g,b),metadata:this.featureAdapter.getMetadata?.(t)}}else for(const e of _){const t=r.getAttributes(e);t&&(v[S++]={attributes:t})}const x=h||0;if(null!=f){const e=x+f;v=v.slice(x,Math.min(v.length,e))}return v}_createExceedsLimitQueryResponse(){let e=!1,t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY;for(const e of this.query.outStatistics??[])if("exceedslimit"===e.statisticType){t=null!=e.maxPointCount?e.maxPointCount:Number.POSITIVE_INFINITY,r=null!=e.maxRecordCount?e.maxRecordCount:Number.POSITIVE_INFINITY,i=null!=e.maxVertexCount?e.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)e=this.items.length>t;else if(this.items.length>r)e=!0;else{const t=w(this.hasZ,this.hasM),r=this.featureAdapter;e=this.items.reduce(((e,t)=>{const i=r.getGeometry(t);return e+(null!=i&&i.coords.length||0)}),0)/t>i}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(e)}}]}}async _createStatisticsQueryResponse(e,t,r={attributes:{}}){const i=[],o=new Map,s=new Map,n=new Map,l=new Map,c=new a(e,this.featureAdapter,this.fieldsIndex),u=e.outStatistics,{groupByFieldsForStatistics:d,having:h,orderByFields:f,resultRecordCount:m}=e,y=d?.length,g=!!y,b=g?d[0]:null,v=g&&!this.fieldsIndex.get(b);for(const e of u??[]){const{outStatisticFieldName:a,statisticType:u}=e,f=e,m="exceedslimit"!==u?e.onStatisticField:void 0,S="percentile_disc"===u||"percentile_cont"===u,_="EnvelopeAggregate"===u||"CentroidAggregate"===u||"ConvexHullAggregate"===u,x=g&&1===y&&(m===b||v)&&"count"===u;if(g){if(!n.has(m)){const e=[];for(const r of d){const i=this._getAttributeValues(c,r,t,o);e.push(i)}n.set(m,this._calculateUniqueValues(e,t,!_&&c.returnDistinctValues))}const e=n.get(m);if(!e)continue;const r=Object.keys(e);for(const i of r){const{count:r,data:s,items:n,itemPositions:u}=e[i],p=s.join(",");if(!h||c.validateItems(n,h)){const e=l.get(p)||{attributes:{}};if(_){e.aggregateGeometries||(e.aggregateGeometries={});const{aggregateGeometries:t,outStatisticFieldName:r}=await this._getAggregateGeometry(f,n);e.aggregateGeometries[r]=t}else{let i=null;if(x)i=r;else{const e=this._getAttributeValues(c,m,t,o),r=u.map((t=>e[t]));i=S&&"statisticParameters"in f?this._getPercentileValue(f,r):this._getStatisticValue(f,r,null,c.returnDistinctValues)}e.attributes[a]=i}let i=0;d.forEach(((t,r)=>e.attributes[this.fieldsIndex.get(t)?t:"EXPR_"+ ++i]=s[r])),l.set(p,e)}}}else if(_){r.aggregateGeometries||(r.aggregateGeometries={});const{aggregateGeometries:e,outStatisticFieldName:i}=await this._getAggregateGeometry(f,t);r.aggregateGeometries[i]=e}else{const e=this._getAttributeValues(c,m,t,o);r.attributes[a]=S&&"statisticParameters"in f?this._getPercentileValue(f,e):this._getStatisticValue(f,e,s,c.returnDistinctValues)}const w="min"!==u&&"max"!==u||!p.isStringField(this.fieldsIndex.get(m))&&!this._isAnyDateField(m)?null:this.fieldsIndex.get(m)?.type;i.push({name:a,alias:a,type:w||"esriFieldTypeDouble"})}const S=g?Array.from(l.values()):[r];return this._sortFeatures(S,f,((e,t)=>e.attributes[t])),m&&(S.length=Math.min(m,S.length)),{fields:i,features:S}}_isAnyDateField(e){const t=this.fieldsIndex.get(e);return p.isDateField(t)||p.isDateOnlyField(t)||p.isTimestampOffsetField(t)||p.isTimeOnlyField(t)}async _getAggregateGeometry(t,r){const{convexHull:s,union:n}=await new Promise(((t,r)=>e(["../../../geometry/geometryEngineJSON"],t,r))),{statisticType:a,outStatisticFieldName:c}=t,{featureAdapter:u,spatialReference:d,geometryType:p,hasZ:h,hasM:f}=this,m=r.map((e=>l.getGeometry(p,h,f,u.getGeometry(e)))),y=s(d,m,!0)[0],g={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===a){const e=y?o.getPolygonExtent(y):o.getGeometryExtent(n(d,m));g.aggregateGeometries={...e,spatialReference:d},g.outStatisticFieldName=c||"extent"}else if("CentroidAggregate"===a){const e=y?i.polygonCentroid(y):i.extentCentroid(o.getGeometryExtent(n(d,m)));g.aggregateGeometries={x:e[0],y:e[1],spatialReference:d},g.outStatisticFieldName=c||"centroid"}else"ConvexHullAggregate"===a&&(g.aggregateGeometries=y,g.outStatisticFieldName=c||"convexHull");return g}_getStatisticValue(e,t,r,i){const{onStatisticField:o,statisticType:s}=e;let n=null;return n=r?.has(o)?r.get(o):p.isStringField(this.fieldsIndex.get(o))||this._isAnyDateField(o)?b.calculateStringStatistics({values:t,returnDistinct:i}):b.calculateStatistics({values:i?[...new Set(t)]:t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(o,n),n["var"===s?"variance":s]}_getPercentileValue(e,t){const{onStatisticField:r,statisticParameters:i,statisticType:o}=e,{value:s,orderBy:n}=i,a=this.fieldsIndex.get(r),l={value:s,orderBy:n,fieldType:a?.type,isDiscrete:"percentile_disc"===o};return b.calculatePercentile(t,l)}_getAttributeValues(e,t,r,i){if(i.has(t))return i.get(t);const o=this.fieldsIndex.get(t),s=r.map((r=>e.getFieldValue(r,t,o)));return i.set(t,s),s}_calculateUniqueValues(e,t,r){const i={},o=t.length;for(let s=0;s<o;s++){const o=t[s],n=[];for(const t of e)n.push(t[s]);const a=n.join(",");null==i[a]?i[a]={count:1,data:n,items:[o],itemPositions:[s]}:(r||i[a].count++,i[a].items.push(o),i[a].itemPositions.push(s))}return i}async _getDataValues(e,t,i=!0){const o=new a(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:s,scale:n,timeZone:l}=e;return s?o.getExpressionValues(t,s,{viewingMode:"map",scale:n,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},l):o.getDataValues(t,r.clone(e),i)}async _calculateHistogramBins(e,t,r){if(null==t.min&&null==t.max)return[];const i=t.intervals,o=t.min??0,s=t.max??0,n=i.map((([e,t])=>({minValue:e,maxValue:t,count:0,items:[]})));for(let t=0;t<e.length;t++){const a=e[t],l=r[t];if(null!=a&&a>=o&&a<=s){const e=b.binIndex(i,a);e>-1&&(n[e].count++,n[e].items.push(l))}}return n}async createQueryBinsResponse(e){const t=e.bin?.splitBy;if(!t)return this._createBinsResponse(e);const{value:r,outAlias:i,valueType:o}=t,s=[],n=[{name:i??r,alias:i??r,type:o??"esriFieldTypeString"},{name:_,alias:_,type:"esriFieldTypeInteger"}],l=new a(e,this.featureAdapter,this.fieldsIndex),c=new Map,u=[...this.items];this._sortFeatures(u,[r],((e,t,r)=>l.getFieldValue(e,t,r)));const d=this._getAttributeValues(l,r,u,c),p=this._calculateUniqueValues([d],u,l.returnDistinctValues);for(const t in p){const{items:o}=p[t],a=await this._createBinsResponse(e,o);if(s.push(...a.features.map((e=>({...e,attributes:{...e.attributes,[i??r]:t}})))),a.fields)for(const e of a.fields)n.some((t=>t.name===e.name))||n.push(e)}return{fields:n,features:s}}async _createBinsResponse(e,t){const r=e.bin;switch(t=t??this.items,r.type){case"autoIntervalBin":return this._createAutoIntervalBinsResponse(h.fromJSON(r),e,t);case"dateBin":return this._createDateBinsResponse(f.fromJSON(r),e,t);case"fixedBoundariesBin":return this._createFixedBoundariesBinsResponse(y.fromJSON(r),e,t);case"fixedIntervalBin":return this._createFixedIntervalBinsResponse(g.fromJSON(r),e,t)}}async _createAutoIntervalBinsResponse(e,t,r){const{field:i,normalizationField:o,numBins:s,normalizationType:n,normalizationTotal:a,start:l,end:c}=e,d=await this._getDataValues({field:e.field,normalizationField:e.normalizationField,normalizationType:e.normalizationType,normalizationTotal:e.normalizationTotal,timeZone:t.outTimeReference?.ianaTimeZone},r),p=b.getBinParams(d,{field:i,normalizationField:o,normalizationType:n,normalizationTotal:a,numBins:s,minValue:u.getDateInNumber(l,!1),maxValue:u.getDateInNumber(c,!1)}),h=await this._calculateHistogramBins(d,p,r);return this._createFeaturesFromHistogramBins(h,t)}async _createDateBinsResponse(e,t,r){const{field:i,interval:o,start:s,end:n,snapToData:a,returnFullIntervalBin:l}=e,c=o.unit,d=await this._getDataValues({field:e.field,timeZone:t.outTimeReference?.ianaTimeZone},r),h=p.isTimeOnlyField(this.fieldsIndex.get(i)),f=m.unitsDict.toJSON(c),y=d.filter(Boolean).sort(((e,t)=>e-t)),g=null!=s?u.getDateInNumber(s,h):y[0],b=null!=n?u.getDateInNumber(n,h):y[y.length-1],_={zone:t.outTimeReference?.ianaTimeZone??v.utc},x=S.DateTime.fromMillis(g,_),w=S.DateTime.fromMillis(b,_),T=[];if("last"===a){let e=w;for(;e>x;){const t=e.minus({[f]:o.value});if(t<x){T.unshift([l?t.toMillis():x.toMillis(),e.toMillis()]);break}T.unshift([t.toMillis(),e.toMillis()]),e=t}}else{let e="first"===a?x:x.startOf(f);for(;e<=w;){const t=e.plus({[f]:o.value});if(t>w){T.push([e.toMillis(),l?t.toMillis():w.toMillis()]);break}T.push([e.toMillis(),t.toMillis()]),e=t}}const M=await this._calculateHistogramBins(d,{intervals:T,min:g,max:b},r);return this._createFeaturesFromHistogramBins(M,t)}async _createFixedBoundariesBinsResponse(e,t,r){const{field:i}=e,o=await this._getDataValues({field:i,timeZone:t.outTimeReference?.ianaTimeZone},r),s=p.isTimeOnlyField(this.fieldsIndex.get(i)),n=e.boundaries.map((e=>u.getDateInNumber(e,s))).sort(((e,t)=>e-t)),a=[];for(let e=0;e<n.length-1;e++)a.push([n[e],n[e+1]]);const l={intervals:a,min:n.at(0),max:n.at(-1)},c=await this._calculateHistogramBins(o,l,r);return this._createFeaturesFromHistogramBins(c,t)}async _createFixedIntervalBinsResponse(e,t,r){const{field:i,interval:o,start:s,end:n}=e,a=await this._getDataValues({field:e.field,normalizationField:e.normalizationField,normalizationType:e.normalizationType,normalizationTotal:e.normalizationTotal,timeZone:t.outTimeReference?.ianaTimeZone},r),l=p.isTimeOnlyField(this.fieldsIndex.get(i)),c=b.getBinParams(a,{field:i,classificationMethod:"defined-interval",definedInterval:o,minValue:u.getDateInNumber(s,l),maxValue:u.getDateInNumber(n,l)},!0),d=await this._calculateHistogramBins(a,c,r);return this._createFeaturesFromHistogramBins(d,t)}async _createFeaturesFromHistogramBins(e,t){const{upperBoundaryAlias:r,lowerBoundaryAlias:i}=t,o=i||"lowerBoundary",s=r||"upperBoundary",n=[],a=[{name:o,alias:o,type:"esriFieldTypeDouble"},{name:s,alias:s,type:"esriFieldTypeDouble"}],l=t.bin?.stackBy?.value,c=t.bin?.stackBy?.outAlias;l&&a.push({name:_,alias:_,type:"esriFieldTypeInteger"},{name:c??l,alias:c??l,type:"esriFieldTypeString"});let u=0;const d="dateBin"===t.bin.type,p=t.outTimeReference?.ianaTimeZone;for(const r of e){const{minValue:e,maxValue:i,items:h}=r,f={attributes:{}};let m;if(f.attributes[o]=d&&p&&null!=e?S.DateTime.fromMillis(e,{zone:p}).toISO():e,f.attributes[s]=d&&p&&null!=i?S.DateTime.fromMillis(i,{zone:p}).toISO():i,l?(m=await this._createStatisticsQueryResponse({...t,groupByFieldsForStatistics:[l],orderByFields:[l]},h),f.attributes[_]=++u,"flat"===t.bin.jsonStyle?n.push(...m.features.map((({attributes:{EXPR_1:e,...t},...r})=>({...r,attributes:c??e?{...t,[c??e]:e,...f.attributes}:{...t,...f.attributes}})))):(f.stackedAttributes=m.features.map((({attributes:{EXPR_1:e,...t}})=>c??e?{...t,[c??e]:e}:t)),n.push(f))):(t.bin?.splitBy&&(f.attributes[_]=++u),m=await this._createStatisticsQueryResponse(t,h,f),n.push(f)),m.fields)for(const e of m.fields)a.some((t=>t.name===e.name))||a.push(e)}return"desc"===t.binOrder&&n.reverse(),{fields:a,features:n}}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],(function(e,t){"use strict";function r(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:i}=e,o=r[0]??1,s=r[1]??1;return{originPosition:"lowerLeft",scale:[o,"lowerLeft"===t?s:-s,r[2]??1,r[3]??1],translate:[i[0]??0,i[1]??0,i[2]??0,i[3]??0]}}function i({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function o({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function s({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}function n({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}function a(e,t){return e&&t?d:e&&!t?c:!e&&t?u:l}const l=(e,t)=>{const r=[];if(!t.length)return null;const s=t[0];let n=i(e,s[0]),a=o(e,s[1]);r.push([n,a]);for(let s=1;s<t.length;s++){const[l,c]=t[s],u=i(e,l),d=o(e,c);u===n&&d===a||r.push([u-n,d-a]),n=u,a=d}return r},c=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let a=i(e,n[0]),l=o(e,n[1]),c=s(e,n[2]);r.push([a,l,c]);for(let n=1;n<t.length;n++){const[u,d,p]=t[n],h=i(e,u),f=o(e,d),m=s(e,p);h===a&&f===l&&m===c||r.push([h-a,f-l,m]),a=h,l=f,c=m}return r},u=(e,t)=>{const r=[];if(!t.length)return null;const s=t[0];let a=i(e,s[0]),l=o(e,s[1]),c=n(e,s[2]);r.push([a,l,c]);for(let s=1;s<t.length;s++){const[u,d,p]=t[s],h=i(e,u),f=o(e,d),m=n(e,p);h===a&&f===l&&m===c||r.push([h-a,f-l,m]),a=h,l=f,c=m}return r},d=(e,t)=>{const r=[];if(!t.length)return null;const a=t[0];let l=i(e,a[0]),c=o(e,a[1]),u=s(e,a[2]),d=n(e,a[3]);r.push([l,c,u,d]);for(let a=1;a<t.length;a++){const[p,h,f,m]=t[a],y=i(e,p),g=o(e,h),b=s(e,f),v=n(e,m);y===l&&g===c&&b===u&&v===d||r.push([y-l,g-c,b,v]),l=y,c=g,u=b,d=v}return r};function p({scale:e,translate:t},r){return r*e[0]+t[0]}function h({scale:e,translate:t},r){return r*e[1]+t[1]}function f({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function m({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function y(e,t){return e&&t?S:e&&!t?b:!e&&t?v:g}const g=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let o=p(e,i[0]),s=h(e,i[1]);r[0]=[o,s];const{scale:n,originPosition:a}=e,l=n[0],c="lowerLeft"===a?n[1]:-n[1];for(let e=1;e<t.length;e++){const[i,n]=t[e];o+=l*i,s+=c*n,r[e]=[o,s]}return r},b=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let o=p(e,i[0]),s=h(e,i[1]);r[0]=[o,s,f(e,i[2])];const{scale:n,originPosition:a}=e,l=n[0],c="lowerLeft"===a?n[1]:-n[1];for(let i=1;i<t.length;i++){const[n,a,u]=t[i];o+=l*n,s+=c*a,r[i]=[o,s,f(e,u)]}return r},v=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let o=p(e,i[0]),s=h(e,i[1]);r[0]=[o,s,m(e,i[2])];const{scale:n,originPosition:a}=e,l=n[0],c="lowerLeft"===a?n[1]:-n[1];for(let i=1;i<t.length;i++){const[n,a,u]=t[i];o+=l*n,s+=c*a,r[i]=[o,s,m(e,u)]}return r},S=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let o=p(e,i[0]),s=h(e,i[1]);r[0]=[o,s,f(e,i[2]),m(e,i[3])];const{scale:n,originPosition:a}=e,l=n[0],c="lowerLeft"===a?n[1]:-n[1];for(let i=1;i<t.length;i++){const[n,a,u,d]=t[i];o+=l*n,s+=c*a,r[i]=[o,s,f(e,u),m(e,d)]}return r};function _(e,t,r){const i=new Array(r.length);for(let o=0;o<r.length;o++)i[o]=t(e,r[o]);return i}function x(e,t,r){let[i,o]=r[0],s=Math.min(i,t[0]),n=Math.min(o,t[1]),a=Math.max(i,t[2]),l=Math.max(o,t[3]);for(let e=1;e<r.length;e++){const[t,c]=r[e];i+=t,o+=c,t<0&&(s=Math.min(s,i)),t>0&&(a=Math.max(a,i)),c<0?n=Math.min(n,o):c>0&&(l=Math.max(l,o))}return e[0]=s,e[1]=n,e[2]=a,e[3]=l,e}function w(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r++)x(e,e,t[r]);return e}function T(e,t,a){const l=r(e);return t.xmin=i(l,a.xmin),t.ymin=o(l,a.ymin),t.xmax=i(l,a.xmax),t.ymax=o(l,a.ymax),a.hasZ&&(t.zmin=s(l,a.zmin),t.zmax=s(l,a.zmax)),a.hasM&&(t.mmin=n(l,a.mmin),t.mmax=n(l,a.mmax)),t.hasZ=a.hasZ??!1,t.hasM=a.hasM??!1,t}function M(e,t,i){const o=r(e);return t.points=a(i.hasZ,i.hasM)(o,i.points)??[],t.hasZ=i.hasZ??!1,t.hasM=i.hasM??!1,t}function I(e,t,a){const l=r(e);return t.x=i(l,a.x),t.y=o(l,a.y),null!=a.z&&(t.z=s(l,a.z)),null!=a.m&&(t.m=n(l,a.m)),t}function P(e,t,i){const o=function(e,t,r,i){const o=[],s=a(r,i);for(let r=0;r<t.length;r++){const i=s(e,t[r]);i&&i.length>=3&&o.push(i)}return o.length?o:null}(r(e),i.rings,i.hasZ,i.hasM);return o?(t.rings=o,t.hasZ=i.hasZ??!1,t.hasM=i.hasM??!1,t):null}function O(e,t,i){const o=function(e,t,r,i){const o=[],s=a(r,i);for(let r=0;r<t.length;r++){const i=s(e,t[r]);i&&i.length>=2&&o.push(i)}return o.length?o:null}(r(e),i.paths,i.hasZ,i.hasM);return o?(t.paths=o,t.hasZ=i.hasZ??!1,t.hasM=i.hasM??!1,t):null}e.getQuantizedBoundsCoordsArray=x,e.getQuantizedBoundsCoordsArrayArray=w,e.getQuantizedBoundsPaths=function(e){return w([0,0,0,0],e)},e.getQuantizedBoundsPoints=function(e){const t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return x(t,t,e)},e.getQuantizedBoundsRings=function(e){return w([0,0,0,0],e)},e.normalizeTransform=r,e.quantizeBounds=function(e,t,s){const n=r(e);return t[0]=i(n,s[0]),t[3]=o(n,s[1]),t[2]=i(n,s[2]),t[1]=o(n,s[3]),t},e.quantizeCoordsArrayXY=l,e.quantizeCoordsArrayXYM=u,e.quantizeCoordsArrayXYZ=c,e.quantizeCoordsArrayXYZM=d,e.quantizeExtent=T,e.quantizeGeometry=function(e,r){return e&&r?t.isPoint(r)?I(e,{},r):t.isPolyline(r)?O(e,{},r):t.isPolygon(r)?P(e,{},r):t.isMultipoint(r)?M(e,{},r):t.isExtent(r)?T(e,{},r):null:null},e.quantizeM=n,e.quantizeMultipoint=M,e.quantizePoint=I,e.quantizePolygon=P,e.quantizePolyline=O,e.quantizeX=i,e.quantizeY=o,e.quantizeZ=s,e.toQuantizationTransform=function(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null},e.unquantizeBounds=function(e,t,i){const o=r(e);return i?(t[0]=p(o,i[0]),t[1]=h(o,i[3]),t[2]=p(o,i[2]),t[3]=h(o,i[1]),t):[p(o,t[0]),h(o,t[3]),p(o,t[2]),h(o,t[1])]},e.unquantizeCoordsArrayArray=_,e.unquantizeCoordsArrayXY=g,e.unquantizeCoordsArrayXYM=v,e.unquantizeCoordsArrayXYZ=b,e.unquantizeCoordsArrayXYZM=S,e.unquantizeExtent=function(e,t,i,o=i.hasZ??!1,s=i.hasM??!1){const n=r(e);return t.xmin=p(n,i.xmin),t.xmax=p(n,i.xmax),t.ymin=h(n,i.ymin),t.ymax=h(n,i.ymax),o&&(t.zmin=f(n,i.zmin),t.zmax=f(n,i.zmax)),s&&(t.mmin=m(n,i.mmin),t.mmax=m(n,i.mmax)),t.hasZ=o,t.hasM=s,t},e.unquantizeM=m,e.unquantizeMultipoint=function(e,t,i,o=i?.hasZ??!1,s=i?.hasM??!1){if(null!=i){const n=r(e);t.points=y(o,s)(n,i.points),t.hasZ=o,t.hasM=s}return t},e.unquantizePoint=function(e,t,i,o=null!=i?.z,s=null!=i?.m){if(null==i)return t;const n=r(e);return t.x=p(n,i.x),t.y=h(n,i.y),o&&(t.z=f(n,i.z)),s&&(t.m=m(n,i.m)),t},e.unquantizePolygon=function(e,t,i,o=i?.hasZ??!1,s=i?.hasM??!1){if(null!=i){const n=r(e);t.rings=_(n,y(o,s),i.rings),t.hasZ=o,t.hasM=s}return t},e.unquantizePolyline=function(e,t,i,o=i?.hasZ??!1,s=i?.hasM??!1){if(null!=i){const n=r(e);t.paths=_(n,y(o,s),i.paths),t.hasZ=o,t.hasM=s}return t},e.unquantizeX=p,e.unquantizeY=h,e.unquantizeZ=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/data/AttributesBuilder":function(){define(["./attributeSupport","./geometryUtils","../../support/fieldUtils","../../../smartMapping/statistics/support/utils","../../../statistics/utils","../../../support/loadArcade"],(function(e,t,r,i,o,s){"use strict";return class{constructor(t,r,i){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues??!1,this.fieldsIndex=i,this.featureAdapter=r;const o=t.outFields;if(o&&!o.includes("*")){this.outFields=o;let t=0;for(const r of o){const o=e.getExpressionFromFieldName(r),s=this.fieldsIndex.get(o),n=s?null:e.getWhereClause(o,i),a=s?s.name:e.getAliasFromFieldName(r)||"FIELD_EXP_"+t++;this._fieldDataCache.set(r,{alias:a,clause:n})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach((e=>this.getAttributes(e))),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(t,r,i){const o=i?i.name:r;let s=null;return this._fieldDataCache.has(o)?s=this._fieldDataCache.get(o)?.clause:i||(s=e.getWhereClause(r,this.fieldsIndex),this._fieldDataCache.set(o,{alias:o,clause:s})),i?this.featureAdapter.getAttribute(t,o):s?.calculateValue(t,this.featureAdapter)}getDataValues(e,t,s=!0){const n=t.normalizationType,a=t.normalizationTotal,l=this.fieldsIndex.get(t.field),c=r.isDateOnlyField(l)||r.isTimestampOffsetField(l),u=r.isTimeOnlyField(l);return e.map((e=>{let r=t.field&&this.getFieldValue(e,t.field,this.fieldsIndex.get(t.field));if(t.field2?(r=`${o.processNullValue(r)}${t.fieldDelimiter}${o.processNullValue(this.getFieldValue(e,t.field2,this.fieldsIndex.get(t.field2)))}`,t.field3&&(r=`${r}${t.fieldDelimiter}${o.processNullValue(this.getFieldValue(e,t.field3,this.fieldsIndex.get(t.field3)))}`)):"string"==typeof r&&s&&(c?r=r?new Date(r).getTime():null:u&&(r=r?i.timeOnlyToMilliseconds(r):null)),n&&Number.isFinite(r)){const i="field"===n&&t.normalizationField?this.getFieldValue(e,t.normalizationField,this.fieldsIndex.get(t.normalizationField)):null;r=o.getNormalizedValue(r,n,i,a)}return r}))}async getExpressionValues(e,r,i,o,n){const{arcadeUtils:a}=await s.loadArcade(),l=a.hasGeometryOperations(r);l&&await a.enableGeometryOperations();const c=a.createFunction(r),u=a.getViewInfo(i),d={fields:this.fieldsIndex.fields};return e.map((e=>{const r={attributes:this.featureAdapter.getAttributes(e),layer:d,geometry:l?{...t.getGeometry(o.geometryType,o.hasZ,o.hasM,this.featureAdapter.getGeometry(e)),spatialReference:i?.spatialReference}:null},s=a.createExecContext(r,u,n);return a.executeFunction(c,s)}))}validateItem(t,r){return this._fieldDataCache.has(r)||this._fieldDataCache.set(r,{alias:r,clause:e.getWhereClause(r,this.fieldsIndex)}),this._fieldDataCache.get(r)?.clause?.testFeature(t,this.featureAdapter)??!1}validateItems(t,r){return this._fieldDataCache.has(r)||this._fieldDataCache.set(r,{alias:r,clause:e.getWhereClause(r,this.fieldsIndex)}),this._fieldDataCache.get(r)?.clause?.testSet(t,this.featureAdapter)??!1}_processAttributesForOutFields(e){const t=this.outFields;if(!t?.length)return this.featureAdapter.getAttributes(e);const r={};for(const i of t){const{alias:t,clause:o}=this._fieldDataCache.get(i);r[t]=o?o.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return r}_processAttributesForDistinctValues(e){if(null==e||!this.returnDistinctValues)return e;const t=this.outFields,r=[];if(t)for(const i of t){const{alias:t}=this._fieldDataCache.get(i);r.push(e[t])}else for(const t in e)r.push(e[t]);const i=`${(t||["*"]).join(",")}=${r.join(",")}`;let o=this._returnDistinctMap.get(i)||0;return this._returnDistinctMap.set(i,++o),o>1?null:e}}}))},"esri/smartMapping/statistics/support/utils":function(){define(["exports","../../../core/Error","../../../core/screenUtils","../../../core/timeUtils","../../../geometry/Point","../../../geometry/SpatialReference","../../../geometry/support/quantizationUtils","../../../geometry/support/spatialReferenceUtils","../../../layers/support/fieldUtils","../../../renderers/support/heatmapUtils","../../support/utils","../../../statistics/utils","../../../support/loadArcade"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";let h=null;const f=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function m(e){const t=f.exec(e);if(!t)return null;const{hh:r,mm:o,ss:s,ms:n}=t.groups;return Number(r)*i.millisecondsPerTimeUnit.hours+Number(o)*i.millisecondsPerTimeUnit.minutes+Number(s)*i.millisecondsPerTimeUnit.seconds+Number(n||0)}function y(e,t){let r=null!=e?e:"";return null!=t&&t&&(r=r?"("+r+") AND ("+t+")":t),r}e.calculateHeatmapStats=function(e,t=18,i,o,s){const n=new Float64Array(o*s);t=Math.round(r.pt2px(t));let a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const u=c.createValueFunction(i);for(const{geometry:r,attributes:i}of e){const{x:e,y:d}=r,p=Math.max(0,e-t),h=Math.max(0,d-t),f=Math.min(s,d+t),m=Math.min(o,e+t),y=+u(i);for(let r=h;r<f;r++)for(let i=p;i<m;i++){const s=r*o+i,u=c.evaluateDensityKernel(i-e,r-d,t)*y,p=n[s]+=u;a=Math.min(a,p),l=Math.max(l,p)}}return{min:a,max:l}},e.getDataValues=async function(e,t,r=!0){if(!t)return[];const{field:i,field2:o,field3:n,fieldDelimiter:a,fieldInfos:c,timeZone:f}=e,y=i&&c?.find((e=>e.name.toLowerCase()===i.toLowerCase())),g=!!y&&l.isTimeOnlyField(y),b=!!y&&u.isAnyDateField(y),v=e.valueExpression,S=e.normalizationType,_=e.normalizationField,x=e.normalizationTotal,w=[],T=e.viewInfoParams;let M=null,I=null;if(v){if(!h){const{arcadeUtils:e}=await p.loadArcade();h=e}h.hasGeometryOperations(v)&&await h.enableGeometryOperations(),M=h.createFunction(v),I=T?h.getViewInfo({viewingMode:T.viewingMode,scale:T.scale,spatialReference:new s(T.spatialReference)}):null}const P=e.fieldInfos,O=t[0]&&"declaredClass"in t[0]&&"esri.Graphic"===t[0].declaredClass||!P?null:{fields:P};return t.forEach((e=>{const t=e.attributes;let s;if(v){const t=O?{...e,layer:O}:e,r=h.createExecContext(t,I,f);s=h.executeFunction(M,r)}else t&&(s=t[i],o?(s=`${d.processNullValue(s)}${a}${d.processNullValue(t[o])}`,n&&(s=`${s}${a}${d.processNullValue(t[n])}`)):"string"==typeof s&&r&&(b?s=s?new Date(s).getTime():null:g&&(s=s?m(s):null)));if(S&&"number"==typeof s&&isFinite(s)){const e=t&&parseFloat(t[_]);s=d.getNormalizedValue(s,S,e,x)}w.push(s)})),w},e.getRangeExpr=function(e,t,r){const i=null!=t?e+" >= "+t:"",o=null!=r?e+" <= "+r:"";let s="";return s=i&&o?y(i,o):i||o,s?"("+s+")":""},e.getSQLFilterForNormalization=function(e){const t=e.field,r=e.normalizationType,i=e.normalizationField;let o;return"field"===r?o="(NOT "+i+" = 0)":"log"!==r&&"natural-log"!==r&&"square-root"!==r||(o=`(${t} > 0)`),o},e.getSumOfAttributesExpr=function(e,t,r){const i=[],o=[],s=[],n=[],a=[];e.forEach(((e,t)=>{const l=e.field?"field":"expression",c=e.field||e.valueExpression;e.field?(a.push(c),o.push(`var ${l}${t} = Number($feature["${c}"]);`)):(i.push(`function getValueForExpr${t}() {\n  ${c} \n}`),o.push(`var ${l}${t} = Number(getValueForExpr${t}());`)),r||s.push(`${l}${t} = IIf(${l}${t} < 0, 0, ${l}${t});`),n.push(`${l}${t}`)}));const l=i.length?null:a.reduce(((e,t)=>`${e} + ${t}`));let c=null;return t||r?t?r||l&&(c=`(( ${l} ) >= 0)`):l&&(c=`(( ${l} ) <> 0)`):l&&(c=`(( ${l} ) > 0)`),{valueExpression:[i.length?i.join("\n"):"",o.join("\n"),s.join("\n"),`var total = ${n.join(" + ")};`,"return total;"].filter(Boolean).join("\n\n"),sqlExpression:l,sqlWhere:c}},e.mergeWhereClauses=y,e.quantizeFeatures=function(e,t,r,i){const s=a.isWrappable(r)?a.getInfo(r):null,l=s?Math.round((s.valid[1]-s.valid[0])/t.scale[0]):null;return e.map((e=>{const r=new o(e.geometry);return n.quantizePoint(t,r,r),e.geometry=s?function(e,t,r){return e.x<0?e.x+=t:e.x>r&&(e.x-=t),e}(r,l??0,i[0]):r,e}))},e.timeOnlyToMilliseconds=m,e.verifyBasicFieldValidity=function(e,r,i){const o=function(e){const t=e.layer;return e.fields.filter((e=>!t.getField(e)))}({layer:e,fields:r});if(o.length)return new t(i,"Unknown fields: "+o.join(", ")+". You can only use fields defined in the layer schema");const s=function(e){const t=e.layer;return e.fields.filter((e=>{const r=t.getFieldUsageInfo(e);return!r||!r.supportsStatistics}))}({layer:e,fields:r});return s.length?new t(i,"Unsupported fields: "+s.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true"):void 0},e.verifyFieldType=function(e,r,i,o){let s;return r?r.name!==e.objectIdField&&o.includes(r.type)||(s=new t(i,"'field' should be one of these types: "+o.join(","))):s=new t(i,"'field' is not defined in the layer schema"),s},e.verifyFilterValidity=function(e,r){if(e&&"intersects"!==e.spatialRelationship)return new t(r,"Only 'intersects' spatialRelationship is supported for featureFilter")},e.verifyNumericField=function(e,r,i){let o;return r?r.name!==e.objectIdField&&l.isNumericField(r)||(o=new t(i,"'field' should be one of these numeric types: "+l.numericTypes.join(","))):o=new t(i,"'field' is not defined in the layer schema"),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/screenUtils":function(){define(["exports"],(function(e){"use strict";const t=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function r(e){return e?72*e/96:0}function i(e=0,t=0){return{x:e,y:t}}e.castRenderScreenPointArray=function(e){return e},e.castRenderScreenPointArray3=function(e){return e},e.castScreenPointArray=function(e){return e},e.cloneScreenPoint=function(e){return e?i(e.x,e.y):null},e.createRenderScreenPoint=function(e=0,t=0){return{x:e,y:t}},e.createRenderScreenPointArray=function(e=0,t=0){return[e,t]},e.createRenderScreenPointArray3=function(e=0,t=0,r=0){return[e,t,r]},e.createScreenPoint=i,e.createScreenPointArray=function(e=0,t=0){return[e,t]},e.pt2px=function(e){return e?e/72*96:0},e.px2pt=r,e.screenPointArrayToObject=function(e,t){return t?(t.x=e[0],t.y=e[1],t):{x:e[0],y:e[1]}},e.screenPointObjectToArray=function(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]},e.toPt=function(e){if("string"==typeof e){const i=e.match(t);if(i){const t=Number(i[1]),o=i[3]&&i[3].toLowerCase(),s="-"===e.charAt(0),n="px"===o?r(t):t;return s?-n:n}return console.warn("screenUtils.toPt: input not recognized!"),null}return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/mathUtils","../../core/screenUtils","../../chunks/vec42","../../core/libs/gl-matrix-2/factories/vec4f64"],(function(e,t,r,i,o){"use strict";function s(e,r,o,s){let{color:n,ratio:a}=r,{color:l,ratio:c}=o;if(c===a){const e=1e-6;1===c?a-=e:c+=e}const u=t.clamp((s-a)/(c-a),0,1);i.lerp(e,n.toArray(),l.toArray(),u)}e.createValueFunction=function(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1},e.evaluateDensityKernel=function(e,t,r){const i=Math.sqrt(e**2+t**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2},e.gaussianBlurRadiusPxToKernelDensityRadiusPt=function(e){return r.px2pt(2.4*e)},e.generateGradient=function(e){const t=new Uint8ClampedArray(2048);if((e=e.filter((({ratio:e})=>e>=0&&e<=1)).sort(((e,t)=>e.ratio-t.ratio)).map((({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)})))).length<1)return t;let r=e[0],i=e[0],n=1;const a=o.create();for(let o=0;o<512;o++){const l=(o+.5)/512;for(;l>i.ratio&&n<e.length;)r=i,i=e[n++];s(a,r,i,l),t.set(a,4*o)}return t},e.kernelDensityRadiusPtToGaussianBlurRadiusPx=function(e){return r.pt2px(e)/2.4},e.magicKernelDensityRadiusInflationFactor=2.4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/smartMapping/support/utils":function(){define(["exports","../../intl/date","../../layers/support/fieldUtils","../../support/basemapUtils","../../support/loadArcade","../../time/constants","../../time/timeZoneUtils"],(function(e,t,r,i,o,s,n){"use strict";const a={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},l={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},c=new Set(["integer","small-integer"]);let u=null;function d(e){return String(e).padStart(2,"0")}function p(e,t,r){let i;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),i=`TIMESTAMP'${r?e.getFullYear():e.getUTCFullYear()}-${d((r?e.getMonth():e.getUTCMonth())+1)}-${d(r?e.getDate():e.getUTCDate())} ${d(r?e.getHours():e.getUTCHours())}:${d(r?e.getMinutes():e.getUTCMinutes())}:${d(r?e.getSeconds():e.getUTCSeconds())}'`):i=e,i}function h(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const i=e.getField(t);if("<now>"===t.toLowerCase())return;if(r.isDateField(i))return"field"}}e.castIntegerFieldToFloat=function(e){return`cast(${e} as float)`},e.dateTypes=["date","date-only","timestamp-offset"],e.defaultBasemapGroups=a,e.defaultStatisticTypes={exclude:["median"]},e.fieldDelimiter=",",e.formatAnyDate=function(e,r){const{format:i,timeZoneOptions:o,fieldType:a}=r??{};let l,c;if(o&&({timeZone:l,timeZoneName:c}=n.getTimeZoneFormattingOptions(o.layerTimeZone,o.datesInUnknownTimezone,o.viewTimeZone,t.convertDateFormatToIntlOptions(i||"short-date-short-time"),a)),"string"==typeof e&&isNaN(Date.parse("time-only"===a?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const r=t.convertDateFormatToIntlOptions(i||"short-date");return"string"==typeof e?t.formatDateOnly(e,{...r}):t.formatDate(e,{...r,timeZone:s.utc})}case"time-only":{const r=t.convertDateFormatToIntlOptions(i||"short-time");return"string"==typeof e?t.formatTimeOnly(e,r):t.formatDate(e,{...r,timeZone:s.utc})}case"timestamp-offset":{if(!l&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const r=i||o?t.convertDateFormatToIntlOptions(i||"short-date-short-time"):void 0,s=r?{...r,timeZone:l,timeZoneName:c}:void 0;return"string"==typeof e?t.formatTimestamp(e,s):t.formatDate(e,s)}default:{const r=i||o?t.convertDateFormatToIntlOptions(i||"short-date-short-time"):void 0;return t.formatDate("string"==typeof e?new Date(e):e,r?{...r,timeZone:l,timeZoneName:c}:void 0)}}},e.getBasemapGroup=function(e,t=a){for(const r in t)if(t[r].includes(e))return r},e.getBasemapId=function(e,t,r=!0){let o=null;return e&&("string"==typeof e?t.includes(e)&&(o=e):o=i.getWellKnownBasemapId(e)),r?o||"gray":o},e.getDateDiffSQL=function(e,t,r,i){const{hasQueryEngine:o}=e,s=`(${p(r,h(e,r),o)} - ${p(t,h(e,t),o)})`;let n=l[i],a="/";return n<1&&(n=1/n,a="*"),{sqlExpression:1===n?s:`(${s} ${a} ${n})`,sqlWhere:null}},e.getDateType=h,e.getFieldsList=async function(e){const{field:t,field2:r,field3:i,normalizationField:s,valueExpression:n}=e;let a=[];if(n){if(!u){const{arcadeUtils:e}=await o.loadArcade();u=e}a=u.extractFieldNames(n)}return t&&a.push(t),r&&a.push(r),i&&a.push(i),s&&a.push(s),a},e.getNormalizationType=function(e){let t=e.normalizationType;return t||(e.normalizationField?t="field":null!=e.normalizationTotal&&(t="percent-of-total")),t??void 0},e.isAnyDateField=function(e){return r.isDateField(e)||r.isDateOnlyField(e)||r.isTimestampOffsetField(e)},e.isIntegerField=function(e,t){const r=t&&e.getField(t);return!!r&&c.has(r.type)},e.unitValueInDays=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/basemapUtils":function(){define(["exports","../core/Collection","../core/maybe","../core/urlUtils","../layers/effects/utils","./basemapDefinitions"],(function(e,t,r,i,o,s){"use strict";let n;function a(e){if(n)return n(e);let t=null;const r=d(e),i=!r?.baseLayers.length;for(const e in s.esriBasemapDefinitions){const o=g(r,m(s.esriBasemapDefinitions[e]),{mustMatchReferences:i});if("equal"===o){t=e;break}"base-layers-equal"===o&&(t=e)}return t}function l(e){if(u(e.url))return!0;if("vector-tile"===e.type)for(const t in e.sourceNameToSource){const r=e.sourceNameToSource[t];if(u(r?.sourceUrl))return!0}return!1}const c=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function u(e){if(!e)return!1;const t=new i.Url(i.makeAbsolute(e));return!!t.authority&&c.test(t.authority)}function d(e){return e?!e.loaded&&e.resourceInfo?m(e.resourceInfo.data):{baseLayers:p(e.baseLayers),referenceLayers:p(e.referenceLayers)}:null}function p(e){return(t.isCollection(e)?e.toArray():e).map(h)}function h(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:S("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:"map-image"!==e.type&&"wms"!==e.type||null==e.sublayers?void 0:e.sublayers?.map((e=>({id:e.id,visible:e.visible}))),activeLayerId:"wmts"===e.type?e.activeLayer?.id:void 0}}function f(e){return e.isReference||"ArcGISSceneServiceLayer"===e.layerType}function m(e){return e?{baseLayers:y((e.baseMapLayers??[]).filter((e=>!f(e)))),referenceLayers:y((e.baseMapLayers??[]).filter((e=>f(e))))}:null}function y(e){return e.map((e=>function(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;case"ArcGISSceneServiceLayer":t="scene";break;default:t="unknown"}return{type:t,effect:e.effect,url:S(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}(e)))}function g(e,t,r){return null!=e!=(null!=t)?"not-equal":e&&t?b(e.baseLayers,t.baseLayers)?b(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function b(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!v(e[r],t[r]))return!1;return!0}function v(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(!o.effectEquals(e.effect,t.effect))return!1;if(null!=e.activeLayerId||null!=t.activeLayerId)return e.activeLayerId===t.activeLayerId;if(null!=e.sublayers||null!=t.sublayers){if(null==e.sublayers||null==t.sublayers||e.sublayers.length!==t.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const i=e.sublayers.at(r),o=t.sublayers.at(r);if(i?.id!==o?.id||i?.visible!==o?.visible)return!1}}return!0}function S(e){return e?i.normalize(e).replace(/^\s*https?:/i,"").toLowerCase():""}function _(e){return"portalItem"in e?e.portalItem?.thumbnailUrl:void 0}e.contentEquals=function(e,t){return e===t||null!=e?.portalItem?.id&&e.portalItem.id===t?.portalItem?.id||"equal"===g(d(e),d(t),{mustMatchReferences:!0})},e.findSpatialReference=function(e,t){if(null==t||null==e)return{spatialReference:null,updating:!1};if("not-loaded"===t.loadStatus)return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(0===t.baseLayers.length)return{spatialReference:null,updating:!1};const r=t.baseLayers.at(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const i=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?r.tileInfo?.spatialReference:r.spatialReference]).filter(Boolean),o=e.spatialReference;return o?{spatialReference:i.find((e=>o.equals(e)))??i[0]??null,updating:!1}:{spatialReference:i[0],updating:!1}},e.getBasemapThumbnailUrl=function(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const i=a(e);return i?s.esriBasemapDefinitions[i].thumbnailUrl:r.mappedFind(e.baseLayers,_)},e.getWellKnownBasemapId=a,e.hasDeveloperBasemapLayer=function(e){return!!e?.baseLayers.concat(e.referenceLayers).some(l)},e.isBasemap3D=function(e){return"Web Scene"===e.portalItem?.type||e.referenceLayers.some((e=>"scene"===e.type))},e.isBasemapInBeta=function(e){return!!e?.portalItem?.tags?.some((e=>"beta"===e.toLowerCase()))},e.isBasemapLayerView=function(e,t){const r=e.allLayerViews.find((e=>e.uid===t));return r?.layer.parent===e.map?.basemap},e.isDeveloperBasemapLayer=l,e.layerDefinitionEquals=v,e.layerToDefinition=h,e.overrideGetWellKnownBasemapId=function(e){n=e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/Collection":function(){define(["../chunks/tslib.es6","./ArrayPool","./Evented","./handleUtils","./lang","./ObjectPool","./ObservableChangesType","./scheduling","./accessorSupport/ensureType","./accessorSupport/tracking","./accessorSupport/decorators/property","./accessorSupport/decorators/shared","./accessorSupport/decorators/subclass","./accessorSupport/tracking/SimpleObservable","./support/jsonUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";var m;class y{constructor(e,t,r,i,o){this.target=e,this.added=t,this.removed=r,this.start=i,this.deleteCount=o}}const g=new s(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},void 0,(e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}));function b(e){e&&"object"==typeof e&&"destroy"in e&&"function"==typeof e.destroy&&e.destroy()}function v(e){return e?e instanceof O?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function S(e){if(e?.length)return e[0]}function _(e,t,r,i){const o=Math.min(e.length-r,t.length-i);let s=0;for(;s<o&&e[r+s]===t[i+s];)s++;return s}function x(e,t,r,i){t&&t.forEach(((t,o,s)=>{e.push(t),x(e,r.call(i,t,o,s),r,i)}))}const w=new Set,T=new Set,M=new Set,I=new Map;let P=0,O=class extends r.EventedAccessor{static{m=this}static{this.ofType=t=>{if(!t)return m;if(I.has(t))return I.get(t);let r=null;if("function"==typeof t)r=t.prototype.declaredClass;else if(t.base)r=t.base.prototype.declaredClass;else for(const e in t.typeMap){const i=t.typeMap[e].prototype.declaredClass;r?r+=` | ${i}`:r=i}let i=class extends m{};return e.__decorate([d.shared({Type:t,ensureType:"function"==typeof t?l.ensureType(t):l.ensureOneOfType(t)})],i.prototype,"itemType",void 0),i=e.__decorate([p.subclass(`esri.core.Collection<${r}>`)],i),I.set(t,i),i}}static isCollection(e){return null!=e&&e instanceof m}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new h.SimpleObservable,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:P++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof m?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),this._emitter.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return c.trackAccess(this._observable),this._items}set items(e){this._emitBeforeChanges(n.ObservableChangesType.ADD)||(this._splice(0,this.length,v(e)),this._emitAfterChanges(n.ObservableChangesType.ADD))}hasEventListener(e){return!this.destroyed&&("change"===e?this._chgListeners.length>0:this._emitter.hasEventListener(e))}on(e,t){if(this.destroyed)return i.makeHandle();if("change"===e){const e=this._chgListeners,r={removed:!1,callback:t};return e.push(r),this._notifications&&this._notifications.push({listeners:e.slice(),items:this._items.slice(),changes:[]}),i.makeHandle((()=>{r.removed=!0,e.splice(e.indexOf(r),1)}))}return this._emitter.on(e,t)}once(e,t){const r="deref"in t?()=>t.deref():()=>t,i=this.on(e,(e=>{r()?.call(null,e),i.remove()}));return i}add(e,t){if(c.trackAccess(this._observable),this._emitBeforeChanges(n.ObservableChangesType.ADD))return this;const r=this.getNextIndex(t??null);return this._splice(r,0,[e]),this._emitAfterChanges(n.ObservableChangesType.ADD),this}addMany(e,t=this._items.length){if(c.trackAccess(this._observable),!e?.length)return this;if(this._emitBeforeChanges(n.ObservableChangesType.ADD))return this;const r=this.getNextIndex(t);return this._splice(r,0,v(e)),this._emitAfterChanges(n.ObservableChangesType.ADD),this}at(e){if(c.trackAccess(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(c.trackAccess(this._observable),!this.length||this._emitBeforeChanges(n.ObservableChangesType.REMOVE))return[];const e=this._removeAllRaw();return this._emitAfterChanges(n.ObservableChangesType.REMOVE),e}_removeAllRaw(){return 0===this.length?[]:this._splice(0,this.length)||[]}clone(){return c.trackAccess(this._observable),this._createNewInstance({items:this._items.map(o.clone)})}concat(...e){c.trackAccess(this._observable);const t=e.map(v);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(c.trackAccess(this._observable),!this.length||this._emitBeforeChanges(n.ObservableChangesType.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let o=0;o<i;o++)e.call(t,r[o],o,r);this._emitAfterChanges(n.ObservableChangesType.REMOVE)}destroyAll(){this.drain(b)}destroyMany(e){const t=this.removeMany(e);return t.forEach(b),t}every(e,t){return c.trackAccess(this._observable),this._items.every(e,t)}filter(e,t){c.trackAccess(this._observable);const r=2===arguments.length?this._items.filter(e,t):this._items.filter(e);return this._createNewInstance({items:r})}find(e,t){return c.trackAccess(this._observable),this._items.find(e,t)}findIndex(e,t){return c.trackAccess(this._observable),this._items.findIndex(e,t)}flatten(e,t){c.trackAccess(this._observable);const r=[];return x(r,this,e,t),new m(r)}forEach(e,t){return c.trackAccess(this._observable),this._items.forEach(e,t)}getItemAt(e){return c.trackAccess(this._observable),this._items[e]}getNextIndex(e){c.trackAccess(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return c.trackAccess(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return c.trackAccess(this._observable),this._items.indexOf(e,t)}join(e=","){return c.trackAccess(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return c.trackAccess(this._observable),this._items.lastIndexOf(e,t)}map(e,t){c.trackAccess(this._observable);const r=this._items.map(e,t);return new m({items:r})}reorder(e,t=this.length-1){c.trackAccess(this._observable);const r=this.indexOf(e);if(-1!==r){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(n.ObservableChangesType.MOVE))return e;this._splice(r,1),this._splice(t,0,[e]),this._emitAfterChanges(n.ObservableChangesType.MOVE)}return e}}pop(){if(c.trackAccess(this._observable),!this.length||this._emitBeforeChanges(n.ObservableChangesType.REMOVE))return;const e=S(this._splice(this.length-1,1));return this._emitAfterChanges(n.ObservableChangesType.REMOVE),e}push(...e){return c.trackAccess(this._observable),this._emitBeforeChanges(n.ObservableChangesType.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(n.ObservableChangesType.ADD)),this.length}reduce(e,t){c.trackAccess(this._observable);const r=this._items;return 2===arguments.length?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){c.trackAccess(this._observable);const r=this._items;return 2===arguments.length?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return c.trackAccess(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(c.trackAccess(this._observable),e<0||e>=this.length||this._emitBeforeChanges(n.ObservableChangesType.REMOVE))return;const t=S(this._splice(e,1));return this._emitAfterChanges(n.ObservableChangesType.REMOVE),t}removeMany(e){if(c.trackAccess(this._observable),!e?.length||this._emitBeforeChanges(n.ObservableChangesType.REMOVE))return[];const t=e instanceof m?e.toArray():e,r=this._items,i=[],o=t.length;for(let e=0;e<o;e++){const o=t[e],s=r.indexOf(o);if(s>-1){const o=1+_(t,r,e+1,s+1),n=this._splice(s,o);n&&n.length>0&&i.push.apply(i,n),e+=o-1}}return this._emitAfterChanges(n.ObservableChangesType.REMOVE),i}reverse(){if(c.trackAccess(this._observable),this._emitBeforeChanges(n.ObservableChangesType.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(n.ObservableChangesType.MOVE),this}shift(){if(c.trackAccess(this._observable),!this.length||this._emitBeforeChanges(n.ObservableChangesType.REMOVE))return;const e=S(this._splice(0,1));return this._emitAfterChanges(n.ObservableChangesType.REMOVE),e}slice(e=0,t=this.length){return c.trackAccess(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return c.trackAccess(this._observable),this._items.some(e,t)}sort(e){if(c.trackAccess(this._observable),!this.length||this._emitBeforeChanges(n.ObservableChangesType.MOVE)||!this._requiresSort(e))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(n.ObservableChangesType.MOVE),this}_requiresSort(e=(e,t)=>e===t?0:e<t?-1:1){const t=this.length-1;for(let r=0;r<t;r++)if(e(this.items[r],this.items[r+1])>0)return!0;return!1}splice(e,t,...r){c.trackAccess(this._observable),1===arguments.length&&(t=this.length),t??=0;const i=(t?n.ObservableChangesType.REMOVE:0)|(r.length?n.ObservableChangesType.ADD:0);if(this._emitBeforeChanges(i))return[];const o=this._splice(e,t,r)||[];return this._emitAfterChanges(i),o}toArray(){return c.trackAccess(this._observable),this._items.slice()}toJSON(e){return c.trackAccess(this._observable),this.toArray().map((t=>f.isSerializable(t)?t.toJSON(e):t))}toLocaleString(){return c.trackAccess(this._observable),this._items.toLocaleString()}toString(){return c.trackAccess(this._observable),this._items.toString()}unshift(...e){return c.trackAccess(this._observable),!e.length||this._emitBeforeChanges(n.ObservableChangesType.ADD)||(this._splice(0,0,e),this._emitAfterChanges(n.ObservableChangesType.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,r){const i=this._items,o=this.itemType;let s,n;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=a.schedule((()=>this._dispatchChange()))),e<0&&(e+=this.length),t){if(n=i.splice(e,t),this.hasEventListener("before-remove")){const t=g.acquire();t.target=this,t.cancellable=!0;for(let r=0,o=n.length;r<o;r++)s=n[r],t.reset(s),this.emit("before-remove",t),t.defaultPrevented&&(n.splice(r,1),i.splice(e,0,s),e+=1,r-=1,o-=1);g.release(t)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const e=g.acquire();e.target=this,e.cancellable=!1;const t=n.length;for(let r=0;r<t;r++)e.reset(n[r]),this.emit("after-remove",e);g.release(e)}}if(r?.length){if(o){const e=[];for(const t of r){const r=o.ensureType(t);null==r&&null!=t||e.push(r)}r=e}const t=this.hasEventListener("before-add"),s=this.hasEventListener("after-add"),n=e===this.length;if(t||s){const o=g.acquire();o.target=this,o.cancellable=!0;const a=g.acquire();a.target=this,a.cancellable=!1;for(const l of r)t?(o.reset(l),this.emit("before-add",o),o.defaultPrevented||(n?i.push(l):i.splice(e++,0,l),this._set("length",i.length),s&&(a.reset(l),this.emit("after-add",a)))):(n?i.push(l):i.splice(e++,0,l),this._set("length",i.length),a.reset(l),this.emit("after-add",a));g.release(a),g.release(o)}else{if(n)for(const e of r)i.push(e);else i.splice(e,0,...r);this._set("length",i.length)}}if((r?.length||n?.length)&&this._notifyChangeEvent(r,n),this.hasEventListener("after-splice")){const i=new y(this,r,n,e,t);this.emit("after-splice",i)}return n}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=g.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,g.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=g.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),g.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const r of e){const e=r.changes;w.clear(),T.clear(),M.clear();for(const{added:t,removed:r}of e){if(t)if(0===M.size&&0===T.size)for(const e of t)w.add(e);else for(const e of t)T.has(e)?(M.add(e),T.delete(e)):M.has(e)||w.add(e);if(r)if(0===M.size&&0===w.size)for(const e of r)T.add(e);else for(const e of r)w.has(e)?w.delete(e):(M.delete(e),T.add(e))}const i=t.acquire();w.forEach((e=>{i.push(e)}));const o=t.acquire();T.forEach((e=>{o.push(e)}));const s=this._items,n=r.items,a=t.acquire();if(M.forEach((e=>{n.indexOf(e)!==s.indexOf(e)&&a.push(e)})),r.listeners&&(i.length||o.length||a.length)){const e={target:this,added:i,removed:o,moved:a},t=r.listeners.length;for(let i=0;i<t;i++){const t=r.listeners[i];t.removed||t.callback.call(this,e)}}t.release(i),t.release(o),t.release(a)}w.clear(),T.clear(),M.clear()}};return e.__decorate([u.property()],O.prototype,"_updating",void 0),e.__decorate([u.property()],O.prototype,"length",void 0),e.__decorate([u.property()],O.prototype,"items",null),e.__decorate([u.property({readOnly:!0})],O.prototype,"updating",null),O=m=e.__decorate([p.subclass("esri.core.Collection")],O),O}))},"esri/core/ObservableChangesType":function(){define(["exports"],(function(e){"use strict";var t;e.ObservableChangesType=void 0,(t=e.ObservableChangesType||(e.ObservableChangesType={}))[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/accessorSupport/decorators/shared":function(){define(["exports"],(function(e){"use strict";e.shared=function(e){return(t,r)=>{t[r]=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/effects/utils":function(){define(["exports","./effects"],(function(e,t){"use strict";e.canInterpolateEffects=function(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every(((e,t)=>e.type===r[t].type))},e.effectEquals=function(e,t){return JSON.stringify(e??null)===JSON.stringify(t??null)},e.isEffectFunctions=function(e){const t=e[0];return!!t&&"type"in t},e.normalizeEffects=function(e,r){const i=e.length>r.length?e:r,o=e.length>r.length?r:e;for(let e=o.length;e<i.length;e++)o.push(t.createEffectWithInitialValues(i[e]))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/effects/effects":function(){define(["exports","../../colorUtils","../../core/screenUtils","../../core/libs/gl-matrix-2/factories/mat4f32","./colorMatrixFunctions"],(function(e,t,r,i,o){"use strict";class s{constructor(e,t,r){this.strength=e,this.radius=t,this.threshold=r,this.type="bloom"}interpolate(e,t,r){this.strength=d(e.strength,t.strength,r),this.radius=d(e.radius,t.radius,r),this.threshold=d(e.threshold,t.threshold,r)}clone(){return new s(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:p(this.radius),strength:this.strength,threshold:this.threshold}}}class n{constructor(e){this.radius=e,this.type="blur"}interpolate(e,t,r){this.radius=Math.round(d(e.radius,t.radius,r))}clone(){return new n(this.radius)}toJSON(){return{type:"blur",radius:p(this.radius)}}}class a{constructor(e,t){this.type=e,this.amount=t,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.amount=d(e.amount,t.amount,r),this._updateMatrix()}clone(){return new a(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||i.create();switch(this.type){case"brightness":this._colorMatrix=o.brightness(e,this.amount);break;case"contrast":this._colorMatrix=o.contrast(e,this.amount);break;case"grayscale":this._colorMatrix=o.grayscale(e,this.amount);break;case"invert":this._colorMatrix=o.invert(e,this.amount);break;case"saturate":this._colorMatrix=o.saturate(e,this.amount);break;case"sepia":this._colorMatrix=o.sepia(e,this.amount)}}}class l{constructor(e,t,r,i){this.offsetX=e,this.offsetY=t,this.blurRadius=r,this.color=i,this.type="drop-shadow"}interpolate(e,t,r){this.offsetX=d(e.offsetX,t.offsetX,r),this.offsetY=d(e.offsetY,t.offsetY,r),this.blurRadius=d(e.blurRadius,t.blurRadius,r),this.color[0]=Math.round(d(e.color[0],t.color[0],r)),this.color[1]=Math.round(d(e.color[1],t.color[1],r)),this.color[2]=Math.round(d(e.color[2],t.color[2],r)),this.color[3]=d(e.color[3],t.color[3],r)}clone(){return new l(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:p(this.offsetX),yoffset:p(this.offsetY),blurRadius:p(this.blurRadius),color:e}}}class c{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.angle=d(e.angle,t.angle,r),this._updateMatrix()}clone(){return new c(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||i.create();this._colorMatrix=o.rotateHue(e,this.angle)}}class u{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,t,r){this.amount=d(e.amount,t.amount,r)}clone(){return new u(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function d(e,t,r){return e+(t-e)*r}function p(e){return Math.round(1e3*r.px2pt(e))/1e3}e.BloomEffect=s,e.BlurEffect=n,e.ColorMatrixEffect=a,e.DropShadowEffect=l,e.HueRotateEffect=c,e.OpacityEffect=u,e.createEffectWithInitialValues=function(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new a(e.type,0);case"saturate":case"brightness":case"contrast":return new a(e.type,1);case"opacity":return new u(1);case"hue-rotate":return new c(0);case"blur":return new n(0);case"drop-shadow":return new l(0,0,0,[...t.getNamedColor("transparent")]);case"bloom":return new s(0,0,1)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["exports"],(function(e){"use strict";function t(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function r(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function i(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){const y=new Float32Array(16);return y[0]=e,y[1]=t,y[2]=r,y[3]=i,y[4]=o,y[5]=s,y[6]=n,y[7]=a,y[8]=l,y[9]=c,y[10]=u,y[11]=d,y[12]=p,y[13]=h,y[14]=f,y[15]=m,y}const o=t(),s=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:t,fromValues:i},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=o,e.clone=r,e.create=t,e.fromValues=i,e.mat4f32=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/effects/colorMatrixFunctions":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],(function(e,t){"use strict";e.brightness=(e,r)=>{const i=t.set(e,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1);return t.transpose(i,i)},e.contrast=(e,r)=>{const i=t.set(e,r,0,0,.5-.5*r,0,r,0,.5-.5*r,0,0,r,.5-.5*r,0,0,0,1);return t.transpose(i,i)},e.grayscale=(e,r)=>{const i=1-r,o=t.set(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return t.transpose(o,o)},e.invert=(e,r)=>{const i=1-2*r,o=r,s=t.set(e,i,0,0,o,0,i,0,o,0,0,i,o,0,0,0,1);return t.transpose(s,s)},e.rotateHue=(e,r)=>{const i=Math.sin(r*Math.PI/180),o=Math.cos(r*Math.PI/180),s=t.set(e,.213+.787*o-.213*i,.715-.715*o-.715*i,.072-.072*o+.928*i,0,.213-.213*o+.143*i,.715+.285*o+.14*i,.072-.072*o-.283*i,0,.213-.213*o-.787*i,.715-.715*o+.715*i,.072+.928*o+.072*i,0,0,0,0,1);return t.transpose(s,s)},e.saturate=(e,r)=>{const i=r,o=t.set(e,.213+.787*i,.715-.715*i,.072-.072*i,0,.213-.213*i,.715+.285*i,.072-.072*i,0,.213-.213*i,.715-.715*i,.072+.928*i,0,0,0,0,1);return t.transpose(o,o)},e.sepia=(e,r)=>{const i=1-r,o=t.set(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return t.transpose(o,o)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["exports","../factories/vec3f64","./common"],(function(e,t,r){"use strict";function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e[4]=s,e[5]=n,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=d,e[11]=p,e[12]=h,e[13]=f,e[14]=m,e[15]=y,e}function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function n(e,t){if(e===t){const r=t[1],i=t[2],o=t[3],s=t[6],n=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=o,e[13]=n,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function a(e,t){return l(e,t)||s(e),e}function l(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],h=t[11],f=t[12],m=t[13],y=t[14],g=t[15],b=r*a-i*n,v=r*l-o*n,S=r*c-s*n,_=i*l-o*a,x=i*c-s*a,w=o*c-s*l,T=u*m-d*f,M=u*y-p*f,I=u*g-h*f,P=d*y-p*m,O=d*g-h*m,C=p*g-h*y;let A=b*C-v*O+S*P+_*I-x*M+w*T;return A?(A=1/A,e[0]=(a*C-l*O+c*P)*A,e[1]=(o*O-i*C-s*P)*A,e[2]=(m*w-y*x+g*_)*A,e[3]=(p*x-d*w-h*_)*A,e[4]=(l*I-n*C-c*M)*A,e[5]=(r*C-o*I+s*M)*A,e[6]=(y*S-f*w-g*v)*A,e[7]=(u*w-p*S+h*v)*A,e[8]=(n*O-a*I+c*T)*A,e[9]=(i*I-r*O-s*T)*A,e[10]=(f*x-m*S+g*b)*A,e[11]=(d*S-u*x-h*b)*A,e[12]=(a*M-n*P-l*T)*A,e[13]=(r*P-i*M+o*T)*A,e[14]=(m*v-f*_-y*b)*A,e[15]=(u*_-d*v+p*b)*A,e):null}function c(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],h=t[11],f=t[12],m=t[13],y=t[14],g=t[15];return e[0]=a*(p*g-h*y)-d*(l*g-c*y)+m*(l*h-c*p),e[1]=-(i*(p*g-h*y)-d*(o*g-s*y)+m*(o*h-s*p)),e[2]=i*(l*g-c*y)-a*(o*g-s*y)+m*(o*c-s*l),e[3]=-(i*(l*h-c*p)-a*(o*h-s*p)+d*(o*c-s*l)),e[4]=-(n*(p*g-h*y)-u*(l*g-c*y)+f*(l*h-c*p)),e[5]=r*(p*g-h*y)-u*(o*g-s*y)+f*(o*h-s*p),e[6]=-(r*(l*g-c*y)-n*(o*g-s*y)+f*(o*c-s*l)),e[7]=r*(l*h-c*p)-n*(o*h-s*p)+u*(o*c-s*l),e[8]=n*(d*g-h*m)-u*(a*g-c*m)+f*(a*h-c*d),e[9]=-(r*(d*g-h*m)-u*(i*g-s*m)+f*(i*h-s*d)),e[10]=r*(a*g-c*m)-n*(i*g-s*m)+f*(i*c-s*a),e[11]=-(r*(a*h-c*d)-n*(i*h-s*d)+u*(i*c-s*a)),e[12]=-(n*(d*y-p*m)-u*(a*y-l*m)+f*(a*p-l*d)),e[13]=r*(d*y-p*m)-u*(i*y-o*m)+f*(i*p-o*d),e[14]=-(r*(a*y-l*m)-n*(i*y-o*m)+f*(i*l-o*a)),e[15]=r*(a*p-l*d)-n*(i*p-o*d)+u*(i*l-o*a),e}function u(e){const t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],n=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],p=e[11],h=e[12],f=e[13],m=e[14],y=e[15];return(t*n-r*s)*(d*y-p*m)-(t*a-i*s)*(u*y-p*f)+(t*l-o*s)*(u*m-d*f)+(r*a-i*n)*(c*y-p*h)-(r*l-o*n)*(c*m-d*h)+(i*l-o*a)*(c*f-u*h)}function d(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=t[9],h=t[10],f=t[11],m=t[12],y=t[13],g=t[14],b=t[15];let v=r[0],S=r[1],_=r[2],x=r[3];return e[0]=v*i+S*a+_*d+x*m,e[1]=v*o+S*l+_*p+x*y,e[2]=v*s+S*c+_*h+x*g,e[3]=v*n+S*u+_*f+x*b,v=r[4],S=r[5],_=r[6],x=r[7],e[4]=v*i+S*a+_*d+x*m,e[5]=v*o+S*l+_*p+x*y,e[6]=v*s+S*c+_*h+x*g,e[7]=v*n+S*u+_*f+x*b,v=r[8],S=r[9],_=r[10],x=r[11],e[8]=v*i+S*a+_*d+x*m,e[9]=v*o+S*l+_*p+x*y,e[10]=v*s+S*c+_*h+x*g,e[11]=v*n+S*u+_*f+x*b,v=r[12],S=r[13],_=r[14],x=r[15],e[12]=v*i+S*a+_*d+x*m,e[13]=v*o+S*l+_*p+x*y,e[14]=v*s+S*c+_*h+x*g,e[15]=v*n+S*u+_*f+x*b,e}function p(e,t,r){const i=r[0],o=r[1],s=r[2];if(t===e)e[12]=t[0]*i+t[4]*o+t[8]*s+t[12],e[13]=t[1]*i+t[5]*o+t[9]*s+t[13],e[14]=t[2]*i+t[6]*o+t[10]*s+t[14],e[15]=t[3]*i+t[7]*o+t[11]*s+t[15];else{const r=t[0],n=t[1],a=t[2],l=t[3],c=t[4],u=t[5],d=t[6],p=t[7],h=t[8],f=t[9],m=t[10],y=t[11];e[0]=r,e[1]=n,e[2]=a,e[3]=l,e[4]=c,e[5]=u,e[6]=d,e[7]=p,e[8]=h,e[9]=f,e[10]=m,e[11]=y,e[12]=r*i+c*o+h*s+t[12],e[13]=n*i+u*o+f*s+t[13],e[14]=a*i+d*o+m*s+t[14],e[15]=l*i+p*o+y*s+t[15]}return e}function h(e,t,r){const i=r[0],o=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(e,t,o,s){let n=s[0],a=s[1],l=s[2],c=Math.sqrt(n*n+a*a+l*l);if(c<=r.getEpsilon())return void i(e,t);c=1/c,n*=c,a*=c,l*=c;const u=Math.sin(o),d=Math.cos(o),p=1-d,h=t[0],f=t[1],m=t[2],y=t[3],g=t[4],b=t[5],v=t[6],S=t[7],_=t[8],x=t[9],w=t[10],T=t[11],M=n*n*p+d,I=a*n*p+l*u,P=l*n*p-a*u,O=n*a*p-l*u,C=a*a*p+d,A=l*a*p+n*u,E=n*l*p+a*u,R=a*l*p-n*u,F=l*l*p+d;e[0]=h*M+g*I+_*P,e[1]=f*M+b*I+x*P,e[2]=m*M+v*I+w*P,e[3]=y*M+S*I+T*P,e[4]=h*O+g*C+_*A,e[5]=f*O+b*C+x*A,e[6]=m*O+v*C+w*A,e[7]=y*O+S*C+T*A,e[8]=h*E+g*R+_*F,e[9]=f*E+b*R+x*F,e[10]=m*E+v*R+w*F,e[11]=y*E+S*R+T*F,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15])}function m(e,t,r){const i=Math.sin(r),o=Math.cos(r),s=t[4],n=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*o+c*i,e[5]=n*o+u*i,e[6]=a*o+d*i,e[7]=l*o+p*i,e[8]=c*o-s*i,e[9]=u*o-n*i,e[10]=d*o-a*i,e[11]=p*o-l*i,e}function y(e,t,r){const i=Math.sin(r),o=Math.cos(r),s=t[0],n=t[1],a=t[2],l=t[3],c=t[8],u=t[9],d=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*o-c*i,e[1]=n*o-u*i,e[2]=a*o-d*i,e[3]=l*o-p*i,e[8]=s*i+c*o,e[9]=n*i+u*o,e[10]=a*i+d*o,e[11]=l*i+p*o,e}function g(e,t,r){const i=Math.sin(r),o=Math.cos(r),s=t[0],n=t[1],a=t[2],l=t[3],c=t[4],u=t[5],d=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*o+c*i,e[1]=n*o+u*i,e[2]=a*o+d*i,e[3]=l*o+p*i,e[4]=c*o-s*i,e[5]=u*o-n*i,e[6]=d*o-a*i,e[7]=p*o-l*i,e}function b(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function v(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function S(e,t,i){if(0===t)return s(e);let o=i[0],n=i[1],a=i[2],l=Math.sqrt(o*o+n*n+a*a);if(l<=r.getEpsilon())return null;l=1/l,o*=l,n*=l,a*=l;const c=Math.sin(t),u=Math.cos(t),d=1-u;return e[0]=o*o*d+u,e[1]=n*o*d+a*c,e[2]=a*o*d-n*c,e[3]=0,e[4]=o*n*d-a*c,e[5]=n*n*d+u,e[6]=a*n*d+o*c,e[7]=0,e[8]=o*a*d+n*c,e[9]=n*a*d-o*c,e[10]=a*a*d+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=i+i,l=o+o,c=s+s,u=i*a,d=i*l,p=i*c,h=o*l,f=o*c,m=s*c,y=n*a,g=n*l,b=n*c;return e[0]=1-(h+m),e[1]=d+b,e[2]=p-g,e[3]=0,e[4]=d-b,e[5]=1-(u+m),e[6]=f+y,e[7]=0,e[8]=p+g,e[9]=f-y,e[10]=1-(u+h),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function M(e,t){const r=I,i=-t[0],o=-t[1],s=-t[2],n=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=i*i+o*o+s*s+n*n;return d>0?(r[0]=2*(a*n+u*i+l*s-c*o)/d,r[1]=2*(l*n+u*o+c*i-a*s)/d,r[2]=2*(c*n+u*s+a*o-l*i)/d):(r[0]=2*(a*n+u*i+l*s-c*o),r[1]=2*(l*n+u*o+c*i-a*s),r[2]=2*(c*n+u*s+a*o-l*i)),T(e,t,r),e}const I=t.create();function P(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function O(e,t){const r=t[0],i=t[1],o=t[2],s=t[4],n=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+i*i+o*o),e[1]=Math.sqrt(s*s+n*n+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function C(e,t){const r=t[0]+t[5]+t[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e}function A(e,t,r,i){const o=t[0],s=t[1],n=t[2],a=t[3],l=o+o,c=s+s,u=n+n,d=o*l,p=o*c,h=o*u,f=s*c,m=s*u,y=n*u,g=a*l,b=a*c,v=a*u,S=i[0],_=i[1],x=i[2];return e[0]=(1-(f+y))*S,e[1]=(p+v)*S,e[2]=(h-b)*S,e[3]=0,e[4]=(p-v)*_,e[5]=(1-(d+y))*_,e[6]=(m+g)*_,e[7]=0,e[8]=(h+b)*x,e[9]=(m-g)*x,e[10]=(1-(d+f))*x,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function E(e,t,r,i,o){const s=t[0],n=t[1],a=t[2],l=t[3],c=s+s,u=n+n,d=a+a,p=s*c,h=s*u,f=s*d,m=n*u,y=n*d,g=a*d,b=l*c,v=l*u,S=l*d,_=i[0],x=i[1],w=i[2],T=o[0],M=o[1],I=o[2],P=(1-(m+g))*_,O=(h+S)*_,C=(f-v)*_,A=(h-S)*x,E=(1-(p+g))*x,R=(y+b)*x,F=(f+v)*w,D=(y-b)*w,L=(1-(p+m))*w;return e[0]=P,e[1]=O,e[2]=C,e[3]=0,e[4]=A,e[5]=E,e[6]=R,e[7]=0,e[8]=F,e[9]=D,e[10]=L,e[11]=0,e[12]=r[0]+T-(P*T+A*M+F*I),e[13]=r[1]+M-(O*T+E*M+D*I),e[14]=r[2]+I-(C*T+R*M+L*I),e[15]=1,e}function R(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=r+r,a=i+i,l=o+o,c=r*n,u=i*n,d=i*a,p=o*n,h=o*a,f=o*l,m=s*n,y=s*a,g=s*l;return e[0]=1-d-f,e[1]=u+g,e[2]=p-y,e[3]=0,e[4]=u-g,e[5]=1-c-f,e[6]=h+m,e[7]=0,e[8]=p+y,e[9]=h-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function F(e,t,r,i,o,s,n){const a=1/(r-t),l=1/(o-i),c=1/(s-n);return e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(o+i)*l,e[10]=(n+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=n*s*2*c,e[15]=0,e}function D(e,t,r,i,o){const s=1/Math.tan(t/2);let n;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=o&&o!==1/0?(n=1/(i-o),e[10]=(o+i)*n,e[14]=2*o*i*n):(e[10]=-1,e[14]=-2*i),e}function L(e,t,r,i){const o=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),n=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(n+a),c=2/(o+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(n-a)*l*.5,e[9]=(o-s)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function V(e,t,r,i,o,s,n){const a=1/(t-r),l=1/(i-o),c=1/(s-n);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(o+i)*l,e[14]=(n+s)*c,e[15]=1,e}function N(e,t,i,o){const n=t[0],a=t[1],l=t[2];let c=n-i[0],u=a-i[1],d=l-i[2];const p=r.getEpsilon();if(Math.abs(c)<p&&Math.abs(u)<p&&Math.abs(d)<p)return void s(e);let h=1/Math.sqrt(c*c+u*u+d*d);c*=h,u*=h,d*=h;const f=o[0],m=o[1],y=o[2];let g=m*d-y*u,b=y*c-f*d,v=f*u-m*c;h=Math.sqrt(g*g+b*b+v*v),h?(h=1/h,g*=h,b*=h,v*=h):(g=0,b=0,v=0);let S=u*v-d*b,_=d*g-c*v,x=c*b-u*g;h=Math.sqrt(S*S+_*_+x*x),h?(h=1/h,S*=h,_*=h,x*=h):(S=0,_=0,x=0),e[0]=g,e[1]=S,e[2]=c,e[3]=0,e[4]=b,e[5]=_,e[6]=u,e[7]=0,e[8]=v,e[9]=x,e[10]=d,e[11]=0,e[12]=-(g*n+b*a+v*l),e[13]=-(S*n+_*a+x*l),e[14]=-(c*n+u*a+d*l),e[15]=1}function B(e,t,r,i){const o=t[0],s=t[1],n=t[2],a=i[0],l=i[1],c=i[2];let u=o-r[0],d=s-r[1],p=n-r[2],h=u*u+d*d+p*p;h>0&&(h=1/Math.sqrt(h),u*=h,d*=h,p*=h);let f=l*p-c*d,m=c*u-a*p,y=a*d-l*u;return h=f*f+m*m+y*y,h>0&&(h=1/Math.sqrt(h),f*=h,m*=h,y*=h),e[0]=f,e[1]=m,e[2]=y,e[3]=0,e[4]=d*y-p*m,e[5]=p*f-u*y,e[6]=u*m-d*f,e[7]=0,e[8]=u,e[9]=d,e[10]=p,e[11]=0,e[12]=o,e[13]=s,e[14]=n,e[15]=1,e}function U(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function z(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function j(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function k(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function G(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function q(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function H(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function W(e,t){if(e===t)return!0;const i=e[0],o=e[1],s=e[2],n=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=e[9],h=e[10],f=e[11],m=e[12],y=e[13],g=e[14],b=e[15],v=t[0],S=t[1],_=t[2],x=t[3],w=t[4],T=t[5],M=t[6],I=t[7],P=t[8],O=t[9],C=t[10],A=t[11],E=t[12],R=t[13],F=t[14],D=t[15],L=r.getEpsilon();return Math.abs(i-v)<=L*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(o-S)<=L*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-_)<=L*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(n-x)<=L*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-w)<=L*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-T)<=L*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-M)<=L*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(u-I)<=L*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(d-P)<=L*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(p-O)<=L*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(h-C)<=L*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(f-A)<=L*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(m-E)<=L*Math.max(1,Math.abs(m),Math.abs(E))&&Math.abs(y-R)<=L*Math.max(1,Math.abs(y),Math.abs(R))&&Math.abs(g-F)<=L*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(b-D)<=L*Math.max(1,Math.abs(b),Math.abs(D))}function $(e){const t=r.getEpsilon(),i=e[0],o=e[1],s=e[2],n=e[4],a=e[5],l=e[6],c=e[8],u=e[9],d=e[10];return Math.abs(1-(i*i+n*n+c*c))<=t&&Math.abs(1-(o*o+a*a+u*u))<=t&&Math.abs(1-(s*s+l*l+d*d))<=t}function J(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[8]&&0===e[9]&&1===e[10]}const Y=d,Z=k,Q=Object.freeze(Object.defineProperty({__proto__:null,add:j,adjoint:c,copy:i,determinant:u,equals:W,exactEquals:H,frob:z,fromQuat:R,fromQuat2:M,fromRotation:S,fromRotationTranslation:T,fromRotationTranslationScale:A,fromRotationTranslationScaleOrigin:E,fromScaling:v,fromTranslation:b,fromXRotation:_,fromYRotation:x,fromZRotation:w,frustum:F,getRotation:C,getScale:O,getTranslation:P,hasIdentityRotation:J,identity:s,invert:l,invertOrIdentity:a,isOrthoNormal:$,lookAt:N,mul:Y,multiply:d,multiplyScalar:G,multiplyScalarAndAdd:q,ortho:V,perspective:D,perspectiveFromFieldOfView:L,rotate:f,rotateX:m,rotateY:y,rotateZ:g,scale:h,set:o,str:U,sub:Z,subtract:k,targetTo:B,translate:p,transpose:n},Symbol.toStringTag,{value:"Module"}));e.add=j,e.adjoint=c,e.copy=i,e.determinant=u,e.equals=W,e.exactEquals=H,e.frob=z,e.fromQuat=R,e.fromQuat2=M,e.fromRotation=S,e.fromRotationTranslation=T,e.fromRotationTranslationScale=A,e.fromRotationTranslationScaleOrigin=E,e.fromScaling=v,e.fromTranslation=b,e.fromXRotation=_,e.fromYRotation=x,e.fromZRotation=w,e.frustum=F,e.getRotation=C,e.getScale=O,e.getTranslation=P,e.hasIdentityRotation=J,e.identity=s,e.invert=l,e.invertOrIdentity=a,e.isOrthoNormal=$,e.lookAt=N,e.mat4=Q,e.mul=Y,e.multiply=d,e.multiplyScalar=G,e.multiplyScalarAndAdd=q,e.ortho=V,e.perspective=D,e.perspectiveFromFieldOfView=L,e.rotate=f,e.rotateX=m,e.rotateY=y,e.rotateZ=g,e.scale=h,e.set=o,e.str=U,e.sub=Z,e.subtract=k,e.targetTo=B,e.translate=p,e.transpose=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/basemapDefinitions":function(){define(["exports","../assets","../intl/messages"],(function(e,t,r){"use strict";const i={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]}};e.esriBasemapDefinitions=i,e.getBasemapTitle=async function(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,i=await r.fetchMessageBundle("esri/t9n/basemaps");return i[e]||i[t]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/intl/messages":function(){define(["exports","../core/Error","../core/handleUtils","../core/promiseUtils","./locale"],(function(e,t,r,i,o){"use strict";const s={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,nn:"no",pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function n(e){if(function(e){return e in s}(e)){const t=s[e];return!0===t?e:t}return null}const a=[],l=new Map;function c(e){for(const t of l.keys())u(e.pattern,t)&&l.delete(t)}function u(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}o.beforeLocaleChange((()=>{l.clear()}));const d=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=i.createResolver())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}},p={cache:l,loaders:a};e.fetchMessageBundle=async function(e){const r=o.getLocale();l.has(e)||l.set(e,async function(e,r){const i=[];for(const t of a)if(u(t.pattern,e))try{return await t.fetchMessageBundle(e,r)}catch(e){i.push(e)}if(i.length)throw new t("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i});throw new t("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,r));const i=l.get(e);return i&&await d.add(i),i},e.messageBundlesLocaleMap=s,e.normalizeMessageBundleLocale=function(e){const t=o.getLocaleParts(e);return t?n(e)??n(t.language):null},e.registerMessageBundleLoader=function(e){return a.includes(e)||(c(e),a.unshift(e)),r.makeHandle((()=>{const t=a.indexOf(e);t>-1&&(a.splice(t,1),c(e))}))},e.test=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],(function(e,t,r){"use strict";const i=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,o=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),s=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),n=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function a(e){return null==e||"string"==typeof e&&!e?"<Null>":e}function l(e){const t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,i=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!i}function c(e){const{values:t,useSampleStdDev:r,supportsNullCount:i,outStatisticTypes:o}=e;let s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,a=null,l=null,c=null,d=null,p=0;const h=null==e.minValue?-1/0:e.minValue,f=null==e.maxValue?1/0:e.maxValue;for(const e of t)Number.isFinite(e)?e>=h&&e<=f&&(a=null===a?e:a+e,s=Math.min(s,e),n=Math.max(n,e),p++):"string"==typeof e&&p++;if(p&&null!=a){l=a/p;let e=0;for(const r of t)Number.isFinite(r)&&r>=h&&r<=f&&(e+=(r-l)**2);d=r?p>1?e/(p-1):0:p>0?e/p:0,c=Math.sqrt(d)}else s=null,n=null;const m={avg:l,count:p,max:n,min:s,stddev:c,sum:a,variance:d};return i&&(m.nullcount=t.length-p),!e.percentileParams||o?.include?.length&&!o.include.includes("median")||o?.exclude?.length&&o.exclude.includes("median")||(m.median=u(t,e.percentileParams)),m}function u(e,t){const{fieldType:r,value:i,orderBy:o,isDiscrete:s}=t,n=d(r,"desc"===o);if(0===(e=[...e].filter((e=>null!=e)).sort(((e,t)=>n(e,t)))).length)return null;if(i<=0)return e[0];if(i>=1)return e[e.length-1];const a=(e.length-1)*i,l=Math.floor(a),c=l+1,u=a%1,p=e[l],h=e[c];return c>=e.length||s||"string"==typeof p||"string"==typeof h?p:p*(1-u)+h*u}function d(e,t){if(e){if(o.has(e))return x(t);if(s.has(e))return v(t,!1);if("esriFieldTypeTimestampOffset"===e)return function(e){return e?y:m}(t);const r=v(t,!0);if("esriFieldTypeString"===e)return r;if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e)return(e,t)=>r(w(e),w(t))}const r=t?1:-1,i=x(t),n=v(t,!0),a=f(t);return(e,t)=>"number"==typeof e&&"number"==typeof t?i(e,t):"string"==typeof e&&"string"==typeof t?n(e,t):a(e,t)??r}const p=(e,t)=>null==e?null==t?0:1:null==t?-1:null,h=(e,t)=>null==e?null==t?0:-1:null==t?1:null;function f(e){return e?p:h}const m=(e,t)=>h(e,t)??(e===t?0:new Date(e).getTime()-new Date(t).getTime()),y=(e,t)=>p(e,t)??(e===t?0:new Date(t).getTime()-new Date(e).getTime()),g=(e,t)=>h(e,t)??(e===t?0:e<t?-1:1),b=(e,t)=>p(e,t)??(e===t?0:e<t?1:-1);function v(e,t){if(!t)return e?b:g;const r=f(e);return e?(e,t)=>{const i=r(e,t);return null!=i?i:(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0}:(e,t)=>{const i=r(e,t);return null!=i?i:(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}}const S=(e,t)=>p(e,t)??t-e,_=(e,t)=>h(e,t)??e-t;function x(e){return e?S:_}function w(e){return e.slice(24,36)+e.slice(19,23)+e.slice(16,18)+e.slice(14,16)+e.slice(11,13)+e.slice(9,11)+e.slice(6,8)+e.slice(4,6)+e.slice(2,4)+e.slice(0,2)}function T(e){return"coded-value"!==e?.type?[]:e.codedValues.map((e=>e.code))}function M(e,t,i){const o=I({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,definedInterval:t.definedInterval,breakCount:t.numClasses||5});return e=function(e,t,r){const i=t??-1/0,o=r??1/0;return e.filter((e=>Number.isFinite(e)&&e>=i&&e<=o))}(e,t.minValue,t.maxValue),r.createGenerateRendererClassBreaks({definition:o,values:e,normalizationTotal:t.normalizationTotal},i)}function I(e){const{breakCount:r,field:i,normalizationField:o,normalizationType:s}=e,n=e.classificationMethod||"equal-interval",a="standard-deviation"===n?e.standardDeviationInterval||1:void 0,l="defined-interval"===n?e.definedInterval:void 0;return new t({breakCount:r,classificationField:i,classificationMethod:n,normalizationField:"field"===s?o:void 0,normalizationType:s,standardDeviationInterval:a,definedInterval:l})}function P(e,t,r=!1){const{field:i,classificationMethod:o,standardDeviationInterval:s,definedInterval:n,normalizationType:a,normalizationField:u,normalizationTotal:d,minValue:p,maxValue:h}=t,f=t.numBins||10;let m=null,y=null,g=null;if(o&&"equal-interval"!==o||a){const{classBreaks:t}=M(e,{field:i,normalizationType:a,normalizationField:u,normalizationTotal:d,classificationMethod:o,standardDeviationInterval:s,definedInterval:n,minValue:p,maxValue:h,numClasses:f},null!=p&&null!=h?[p,h]:void 0);m=t[0]?.minValue,y=t[t.length-1]?.maxValue,g=t.map((e=>[e.minValue,e.maxValue]))}else{if(null!=p&&null!=h)m=p,y=h;else{const t=c({values:e,minValue:p,maxValue:h,useSampleStdDev:!a,supportsNullCount:l({normalizationType:a,normalizationField:u,minValue:p,maxValue:h})});m=t.min??null,y=t.max??null}g=C(m??0,y??0,f)}if(r&&g.length){const e=g.at(-1)[1];g.push([e,e])}return{min:m,max:y,intervals:g}}function O(e,t){let r=-1;for(let i=e.length-1;i>=0;i--)if(t>=e[i][0]){r=i;break}return r}function C(e,t,r){const i=(t-e)/r,o=[];let s,n=e;for(let e=1;e<=r;e++)s=n+i,s=Number(s.toFixed(16)),o.push([n,e===r?t:s]),n=s;return o}e.binIndex=O,e.calculateClassBreaks=M,e.calculateHistogram=function(e,t){const r=P(e,t);if(null==r.min&&null==r.max)return{bins:[],minValue:r.min,maxValue:r.max,normalizationTotal:t.normalizationTotal};const i=r.intervals,o=r.min??0,s=r.max??0,n=i.map(((e,t)=>({minValue:i[t][0],maxValue:i[t][1],count:0})));for(const t of e)if(null!=t&&t>=o&&t<=s){const e=O(i,t);e>-1&&n[e].count++}return{bins:n,minValue:o,maxValue:s,normalizationTotal:t.normalizationTotal}},e.calculatePercentile=u,e.calculateStatistics=c,e.calculateStringStatistics=function(e){const{outStatisticTypes:t}=e,r=e.returnDistinct?[...new Set(e.values)]:e.values,i=r.filter((e=>null!=e)).sort(),o=i.length,s={count:o,min:i[0],max:i[o-1]};return e.supportsNullCount&&(s.nullcount=r.length-o),!e.percentileParams||t?.include?.length&&!t.include.includes("median")||t?.exclude?.length&&t.exclude.includes("median")||(s.median=u(r,e.percentileParams)),s},e.calculateUniqueValuesCount=function(e){const t={};for(let r of e)(null==r||"string"==typeof r&&""===r.trim())&&(r=null),null==t[r]?t[r]={count:1,data:r}:t[r].count++;return{count:t}},e.createClassBreaksDefinition=I,e.createUVResult=function(e,t,r,i){const o=e.count,s=[];if(r&&t){const e=[],r=T(t[0]);for(const o of r)if(t[1]){const r=T(t[1]);for(const s of r)if(t[2]){const r=T(t[2]);for(const t of r)e.push(`${a(o)}${i}${a(s)}${i}${a(t)}`)}else e.push(`${a(o)}${i}${a(s)}`)}else e.push(o);for(const t of e)o.hasOwnProperty(t)||(o[t]={data:t,count:0})}for(const e in o){const t=o[e];s.push({value:t.data,count:t.count,label:t.label})}return{uniqueValueInfos:s}},e.getAttributeComparator=d,e.getBinParams=P,e.getEqualIntervalBins=C,e.getNormalizedValue=function(e,t,r,i){let o=null;switch(t){case"log":0!==e&&(o=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(i)&&0!==i&&(o=e/i*100);break;case"field":Number.isFinite(r)&&0!==r&&(o=e/r);break;case"natural-log":e>0&&(o=Math.log(e));break;case"square-root":e>0&&(o=e**.5)}return o},e.isNullCountSupported=l,e.processNullValue=a,e.processSummaryStatisticsResult=function(e,t,r){let i;for(i in e)t?.include?.length&&!t.include.includes(i)||t?.exclude?.length&&t.exclude.includes(i)?delete e[i]:n.includes(i)&&(Number.isFinite(e[i])||(e[i]=null));return r?(["avg","stddev","variance"].forEach((t=>{null!=e[t]&&(e[t]=Math.ceil(e[t]??0))})),e):e},e.resolveCBResult=function(e,t){let r=e.classBreaks;const o=r.length,s=r[0]?.minValue,n=r[o-1]?.maxValue,a="standard-deviation"===t,l=i;return r=r.map((e=>{const t=e.label,r={minValue:e.minValue,maxValue:e.maxValue,label:t};if(a&&t){const e=t.match(l),i=e?.map((e=>+e.trim()))??[];2===i.length?(r.minStdDev=i[0],r.maxStdDev=i[1],i[0]<0&&i[1]>0&&(r.hasAvg=!0)):1===i.length&&(t.includes("<")?(r.minStdDev=null,r.maxStdDev=i[0]):t.includes(">")&&(r.minStdDev=i[0],r.maxStdDev=null))}return r})),{minValue:s,maxValue:n,classBreakInfos:r,normalizationTotal:e.normalizationTotal}},e.statisticTypes=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/support/ClassBreaksDefinition":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=new r.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),d=new r.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});return e.default=class extends i{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}},t.__decorate([l.enumeration({classBreaksDef:"class-breaks-definition"})],e.default.prototype,"type",void 0),t.__decorate([o.property({json:{write:!0}})],e.default.prototype,"breakCount",void 0),t.__decorate([o.property({json:{write:!0}})],e.default.prototype,"classificationField",void 0),t.__decorate([o.property({type:String,json:{read:u.read,write:u.write}})],e.default.prototype,"classificationMethod",void 0),t.__decorate([o.property({json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([o.property({json:{read:d.read,write:d.write}})],e.default.prototype,"normalizationType",void 0),t.__decorate([o.property({value:null,json:{write:!0}})],e.default.prototype,"standardDeviationInterval",null),t.__decorate([o.property({value:null,json:{write:!0}})],e.default.prototype,"definedInterval",null),e.default=t.__decorate([c.subclass("esri.rest.support.ClassBreaksDefinition")],e.default),e.default}))},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],(function(e,t){"use strict";function r(e,t){return Number(e.toFixed(t))}function i(e,t,r){let i=null;return i=e===t?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+t+"%":e+" - "+t,i}function o(e){const t=[],r=[];let i=Number.MIN_VALUE,o=1,s=-1;for(let n=0;n<e.length;n++){const a=e[n];a===i?(o++,r[s]=o):null!==a&&(t.push(a),i=a,o=1,r.push(o),s++)}return{uniqueValues:t,valueFrequency:r}}function s(e,t,r,i){let o=[],s=[],a=[],l=0;const c=[],u=[];for(let o=0;o<i;o++){const i=n(o,e,t,r);c.push(i.sbMean),u.push(i.sbSdcm),l+=u[o]}let d,p=l,h=!0;for(;h||l<p;){h=!1,o=[];for(let t=0;t<i;t++)o.push(e[t]);for(let r=0;r<i;r++)for(let o=e[r]+1;o<=e[r+1];o++)if(d=t[o],r>0&&o!==e[r+1]&&Math.abs(d-c[r])>Math.abs(d-c[r-1]))e[r]=o;else if(r<i-1&&e[r]!==o-1&&Math.abs(d-c[r])>Math.abs(d-c[r+1])){e[r+1]=o-1;break}p=l,l=0,s=[],a=[];for(let o=0;o<i;o++){s.push(c[o]),a.push(u[o]);const i=n(o,e,t,r);c[o]=i.sbMean,u[o]=i.sbSdcm,l+=u[o]}}if(l>p){for(let t=0;t<i;t++)e[t]=o[t],c[t]=s[t],u[t]=a[t];l=p}return{mean:c,sdcm:u}}function n(e,r,i,o){let s=0,n=0;for(let t=r[e]+1;t<=r[e+1];t++){const e=o[t];s+=i[t]*e,n+=e}n<=0&&t.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");const a=s/n;let l=0;for(let t=r[e]+1;t<=r[e+1];t++)l+=o[t]*(i[t]-a)**2;return{sbMean:a,sbSdcm:l}}e.createGenerateRendererClassBreaks=function(e,t){const{normalizationTotal:a}=e;return{classBreaks:function(e,t){const a=e.definition,{classificationMethod:l,normalizationType:c,definedInterval:u}=a,d=a.breakCount??1,p=[];let h=e.values;if(0===h.length)return[];h=h.sort(((e,t)=>e-t));const[f,m]=t??[h.at(0),h.at(-1)];if("equal-interval"===l)if(h.length>=d){const e=(m-f)/d;let t=f;for(let o=1;o<d;o++){const s=r(f+o*e,6);p.push({minValue:t,maxValue:s,label:i(t,s,c)}),t=s}p.push({minValue:t,maxValue:m,label:i(t,m,c)})}else h.forEach((e=>{p.push({minValue:e,maxValue:e,label:i(e,e,c)})}));else if("natural-breaks"===l){const t=o(h),a=e.valueFrequency||t.valueFrequency,l=function(e,t,r){const i=e.length,o=[];r>i&&(r=i);for(let e=0;e<r;e++)o.push(Math.round(e*i/r-1));o.push(i-1);let a=s(o,e,t,r);return function(e,t,r,i,o,s){let a=0,l=0,c=0,u=0,d=!0;for(let p=0;p<2&&d;p++){0===p&&(d=!1);for(let p=0;p<s-1;p++)for(;r[p+1]+1!==r[p+2];){r[p+1]=r[p+1]+1;const s=n(p,r,i,o);c=s.sbMean,a=s.sbSdcm;const h=n(p+1,r,i,o);if(u=h.sbMean,l=h.sbSdcm,!(a+l<t[p]+t[p+1])){r[p+1]=r[p+1]-1;break}t[p]=a,t[p+1]=l,e[p]=c,e[p+1]=u,d=!0}for(let p=s-1;p>0;p--)for(;r[p]!==r[p-1]+1;){r[p]=r[p]-1;const s=n(p-1,r,i,o);c=s.sbMean,a=s.sbSdcm;const h=n(p,r,i,o);if(u=h.sbMean,l=h.sbSdcm,!(a+l<t[p-1]+t[p])){r[p]=r[p]+1;break}t[p-1]=a,t[p]=l,e[p-1]=c,e[p]=u,d=!0}}return d}(a.mean,a.sdcm,o,e,t,r)&&(a=s(o,e,t,r)),o}(t.uniqueValues,a,d);let u=f;for(let e=1;e<d;e++)if(t.uniqueValues.length>e){const o=r(t.uniqueValues[l[e]],6);p.push({minValue:u,maxValue:o,label:i(u,o,c)}),u=o}p.push({minValue:u,maxValue:m,label:i(u,m,c)})}else if("quantile"===l)if(h.length>=d&&f!==m){let e=f,t=Math.ceil(h.length/d),r=0;for(let o=1;o<d;o++){let s=t+r-1;s>h.length&&(s=h.length-1),s<0&&(s=0),p.push({minValue:e,maxValue:h[s],label:i(e,h[s],c)}),e=h[s],r+=t,t=Math.ceil((h.length-r)/(d-o))}p.push({minValue:e,maxValue:m,label:i(e,m,c)})}else{let e=-1;for(let t=0;t<h.length;t++){const r=h[t];r!==e&&(e=r,p.push({minValue:e,maxValue:r,label:i(e,r,c)}),e=r)}}else if("standard-deviation"===l){const e=function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/=e.length,t}(h),t=function(e,t){let r=0;for(let i=0;i<e.length;i++){const o=e[i];r+=(o-t)*(o-t)}return r/=e.length,Math.sqrt(r)}(h,e);if(0===t)p.push({minValue:h[0],maxValue:h[0],label:i(h[0],h[0],c)});else{const o=function(e,t,r,i,o){let s=Math.max(i-e,t-i)/o/r;return s=s>=1?1:s>=.5?.5:.25,s}(f,m,d,e,t),s=o*t;let n=0,a=f;for(let t=d;t>=1;t--){const o=r(e-(t-.5)*s,6);p.push({minValue:a,maxValue:o,label:i(a,o,c)}),a=o,n++}let l=r(e+.5*s,6);p.push({minValue:a,maxValue:l,label:i(a,l,c)}),a=l,n++;for(let t=1;t<=d;t++)l=n===2*d?m:r(e+(t+.5)*s,6),p.push({minValue:a,maxValue:l,label:i(a,l,c)}),a=l,n++}}else if("defined-interval"===l){if(!u)return p;const[e,o]=t??[h.at(0),h.at(-1)],s=Math.ceil((o-e)/u);let n=e;for(let t=1;t<s;t++){const o=r(e+t*u,6);p.push({minValue:n,maxValue:o,label:i(n,o,c)}),n=o}p.push({minValue:n,maxValue:o,label:i(n,o,c)})}return p}(e,t),normalizationTotal:a}},e.createGenerateRendererUniqueValues=function(e){const t=o(e),r=[],i=t.uniqueValues.length;for(let e=0;e<i;e++){const i=t.uniqueValues[e],o=t.valueFrequency[e],s=i.toString();r.push({value:i,count:o,label:s})}return{uniqueValues:r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/data/queryUtils":function(){define(["require","exports","../../../core/Error","../../../core/jsonMap","../../../core/unitUtils","../../../geometry/projectionUtils","../../../geometry/support/extentUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","./projectionSupport"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";const d=new i.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),p=Object.freeze({});async function h(e,t,r){const{outFields:i,orderByFields:o,groupByFieldsForStatistics:s,outStatistics:n}=e;if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(o)for(let e=0;e<o.length;e++)o[e]=o[e].trim();if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(n)for(let e=0;e<n.length;e++)n[e].onStatisticField&&(n[e].onStatisticField=n[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),f(e,t,r)}async function f(t,i,s){if(!t)return null;let{where:h}=t;if(t.where=h=h?.trim(),(!h||/^1 *= *1$/.test(h)||i&&i===h)&&(t.where=null),!t.geometry)return t;let f=await async function(t){const{distance:i,units:s}=t,n=t.geometry;if(null==i||"vertexAttributes"in n)return n;const l=n.spatialReference,p=s?d.fromJSON(s):o.getUnitString(l),h=l&&(c.isGeographic(l)||c.isWebMercator(l))?n:await u.checkProjectionSupport(l,c.wgs84).then((()=>u.project(n,c.wgs84))),f=await new Promise(((t,r)=>e(["../../../geometry/operators/json/geodesicBufferOperator"],t,r)));await f.load();const m=f.execute(h,i||1,{unit:p})??void 0;if(!m||!a.isPolygon(m)||0===m.rings.length)throw new r("unsupported-query:invalid-parameters","Invalid parameters for query by distance");return m}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:e}=t.geometry;f=n.getGeometryExtent(f),f.spatialReference=e}if(f){await u.checkProjectionSupport(f.spatialReference,s),f=function(e,t){const r=e.spatialReference;return m(e,t)&&a.isExtent(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(f,s);const e=(await l.normalizeCentralMeridian(a.fromJSON(f)))[0];if(null==e)throw p;const r="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,i=r&&m(f,s)?{densificationStep:8*r}:void 0,o=e.toJSON(),n=u.project(o,o.spatialReference,s,i);if(!n)throw p;n.spatialReference=s,t.geometry=n}return t}function m(e,t){if(!e)return!1;const r=e.spatialReference;return(a.isExtent(e)||a.isPolygon(e)||a.isPolyline(e))&&!c.equals(r,t)&&!s.canProjectWithoutEngine(r,t)}t.getDateInNumber=function(e,t){return null==e?null:"string"==typeof e?t?new Date(`1970-01-01T${e}Z`).getTime():new Date(e).getTime():e instanceof Date?e.getTime():e},t.normalizeAttributeBinsQuery=async function(e,t,r){const i=e.bin;return i.onField&&(i.onField=i.onField.trim()),i.onExpression?.value&&(i.onExpression.value=i.onExpression.value.trim()),i.splitBy&&(i.splitBy.value&&(i.splitBy.value=i.splitBy.value.trim()),i.splitBy.outAlias&&(i.splitBy.outAlias=i.splitBy.outAlias.trim())),i.stackBy&&(i.stackBy.value&&(i.stackBy.value=i.stackBy.value.trim()),i.stackBy.outAlias&&(i.stackBy.outAlias=i.stackBy.outAlias.trim())),"normalizationField"in i.parameters&&i.parameters.normalizationField&&(i.parameters.normalizationField=i.parameters.normalizationField.trim()),e.outStatistics?.length||(e.outStatistics=[{statisticType:"count",onStatisticField:"1",outStatisticFieldName:"frequency"}]),h(e,t,r)},t.normalizeQuery=h,t.normalizeQueryLike=f,t.queryEngineEmptyResult=p,t.unitsKebabDict=d,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/normalizeUtils":function(){define(["exports","../../config","../../core/Error","../../core/Logger","../Polygon","../Polyline","./normalizeUtilsCommon","./spatialReferenceUtils","./webMercatorUtils","../../rest/geometryService/cut","../../rest/geometryService/simplify"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";const d=()=>i.getLogger("esri.geometry.support.normalizeUtils");function p(e){const t=[];let r=0,i=0;for(let o=0;o<e.length;o++){const s=e[o];let n=null;for(let e=0;e<s.length;e++)n=s[e],t.push(n),0===e?(r=n[0],i=r):(r=Math.min(r,n[0]),i=Math.max(i,n[0]));n&&t.push([(r+i)/2,0])}return t}function h(e,t){if(!(e instanceof s||e instanceof o)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw d().error(e),new r("internal:geometry",e)}const i=n.getGeometryParts(e),a=[];for(const e of i){const r=[];a.push(r),r.push([e[0][0],e[0][1]]);for(let i=0;i<e.length-1;i++){const o=e[i][0],s=e[i][1],n=e[i+1][0],a=e[i+1][1],l=Math.sqrt((n-o)*(n-o)+(a-s)*(a-s)),c=(a-s)/l,u=(n-o)/l,d=l/t;if(d>1){for(let e=1;e<=d-1;e++){const i=e*t,n=u*i+o,a=c*i+s;r.push([n,a])}const e=(l+Math.floor(d-1)*t)/2,i=u*e+o,n=c*e+s;r.push([i,n])}r.push([n,a])}}return function(e){return"polygon"===e.type}(e)?new o({rings:a,spatialReference:e.spatialReference}):new s({paths:a,spatialReference:e.spatialReference})}function f(e,t,r){if(t){const t=h(e,1e6);e=l.webMercatorToGeographic(t,!0)}return r&&(e=n.updatePolyGeometry(e,r)),e}function m(e,t,r){if(Array.isArray(e)){const i=e[0];if(i>t){const r=n.offsetMagnitude(i,t);e[0]=i+r*(-2*t)}else if(i<r){const t=n.offsetMagnitude(i,r);e[0]=i+t*(-2*r)}}else{const i=e.x;if(i>t){const r=n.offsetMagnitude(i,t);e=e.clone().offset(r*(-2*t),0)}else if(i<r){const t=n.offsetMagnitude(i,r);e=e.clone().offset(t*(-2*r),0)}}return e}e.getClosestDenormalizedXToReference=function(e,t,r){const i=a.getInfo(r);if(null==i)return e;const[o,s]=i.valid,n=2*s;let l=0,c=0;t>s?l=Math.ceil(Math.abs(t-s)/n):t<o&&(l=-Math.ceil(Math.abs(t-o)/n)),e>s?c=Math.ceil(Math.abs(e-s)/n):e<o&&(c=-Math.ceil(Math.abs(e-o)/n));let u=e+(l-c)*n;const d=u-t;return d>s?u-=n:d<o&&(u+=n),u},e.getDenormalizedExtent=function(e){if(!e)return null;const t=e.extent;if(!t)return null;const r=e.spatialReference&&a.getInfo(e.spatialReference);if(!r)return t;const[i,o]=r.valid,s=2*o,{width:n}=t;let l,{xmin:c,xmax:u}=t;if([c,u]=[u,c],"extent"===e.type||0===n||n<=o||n>s||c<i||u>o)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;l=p(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;l=p(e.paths);break;case"multipoint":l=e.points}const d=t.clone();for(let e=0;e<l.length;e++){let t=l[e][0];t<0?(t+=o,u=Math.max(t,u)):(t-=o,c=Math.min(t,c))}return d.xmin=c,d.xmax=u,d.width<n?(d.xmin-=o,d.xmax-=o,d):t},e.normalizeCentralMeridian=async function e(r,i,p){if(!Array.isArray(r))return e([r],i);i&&"string"!=typeof i&&d().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const h="string"==typeof i?i:i?.url??t.geometryServiceUrl;let y,g,b,v,S,_,x,w,T=0;const M=[],I=[];for(const e of r)if(null!=e)if(y||(y=e.spatialReference,g=a.getInfo(y),b=y.isWebMercator,_=b?102100:4326,v=n.cutParams[_].maxX,S=n.cutParams[_].minX,x=n.cutParams[_].plus180Line,w=n.cutParams[_].minus180Line),g)if("mesh"===e.type)I.push(e);else if("point"===e.type)I.push(m(e.clone(),v,S));else if("multipoint"===e.type){const t=e.clone();t.points=t.points.map((e=>m(e,v,S))),I.push(t)}else if("extent"===e.type){const t=e.clone()._normalize(!1,!1,g);I.push(t.rings?new o(t):t)}else if(e.extent){const t=e.extent,r=n.offsetMagnitude(t.xmin,S)*(2*v);let i=0===r?e.clone():n.updatePolyGeometry(e.clone(),r);t.offset(r,0);let{xmin:o,xmax:s}=t;o=Number(o.toFixed(9)),s=Number(s.toFixed(9)),t.intersects(x)&&s!==v?(T=s>T?s:T,i=f(i,b),M.push(i),I.push("cut")):t.intersects(w)&&o!==S?(T=s*(2*v)>T?s*(2*v):T,i=f(i,b,360),M.push(i),I.push("cut")):I.push(i)}else I.push(e.clone());else I.push(e);else I.push(e);let P=n.offsetMagnitude(T,v),O=-90;const C=P,A=new s;for(;P>0;){const e=360*P-180;A.addPath([[e,O],[e,-1*O]]),O*=-1,P--}if(M.length>0&&C>0){const e=function(e,t){let r=-1;for(let i=0;i<t.cutIndexes.length;i++){const o=t.cutIndexes[i],s=t.geometries[i],a=n.getGeometryParts(s);for(let e=0;e<a.length;e++){const t=a[e];t.some((r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const i=t[e][0];r=i>r?i:r}r=Number(r.toFixed(9));const i=-360*n.offsetMagnitude(r,180);for(let r=0;r<t.length;r++){const t=s.getPoint(e,r);s.setPoint(e,r,t.clone().offset(i,0))}return!0}}))}if(o===r){if("polygon"===e[0].type)for(const t of n.getGeometryParts(s))e[o]=e[o].addRing(t);else if("polyline"===e[0].type)for(const t of n.getGeometryParts(s))e[o]=e[o].addPath(t)}else r=o,e[o]=s}return e}(M,await c.cut(h,M,A,p)),t=[],i=[];for(let o=0;o<I.length;o++){const s=I[o];if("cut"!==s)i.push(s);else{const s=e.shift(),n=r[o];null!=n&&"polygon"===n.type&&n.rings&&n.rings.length>1&&s.rings.length>=n.rings.length?(t.push(s),i.push("simplify")):i.push(b?l.geographicToWebMercator(s):s)}}if(!t.length)return i;const o=await u.simplify(h,t,p),s=[];for(let e=0;e<i.length;e++){const t=i[e];"simplify"!==t?s.push(t):s.push(b?l.geographicToWebMercator(o.shift()):o.shift())}return s}const E=[];for(let e=0;e<I.length;e++){const t=I[e];if("cut"!==t)E.push(t);else{const e=M.shift();E.push(!0===b?l.geographicToWebMercator(e):e)}}return E},e.normalizeMapX=function(e,t){const r=a.getInfo(t);if(r){const[t,i]=r.valid,o=i-t;if(e<t)for(;e<t;)e+=o;if(e>i)for(;e>i;)e-=o}return e},e.straightLineDensify=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/normalizeUtilsCommon":function(){define(["exports","../Polyline","../SpatialReference","./jsonUtils"],(function(e,t,r,i){"use strict";const o={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new t({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:r.WebMercator}),minus180Line:new t({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:r.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new t({paths:[[[180,-180],[180,180]]],spatialReference:r.WGS84}),minus180Line:new t({paths:[[[-180,-180],[-180,180]]],spatialReference:r.WGS84})}};function s(e){return i.isPolygon(e)?e.rings:e.paths}e.cutParams=o,e.getGeometryParts=s,e.offsetMagnitude=function(e,t){return Math.ceil((e-t)/(2*t))},e.updatePolyGeometry=function(e,t){const r=s(e);for(const e of r)for(const r of e)r[0]+=t;return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/geometryService/cut":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","../utils"],(function(e,t,r,i,o){"use strict";e.cut=async function(e,s,n,a){const l=o.parseUrl(e),c=s[0].spatialReference,u={...a,responseType:"json",query:{...l.query,f:"json",sr:i.srToRESTValue(c),target:JSON.stringify({geometryType:r.getJsonType(s[0]),geometries:s}),cutter:JSON.stringify(n)}},d=await t(l.path+"/cut",u),{cutIndexes:p,geometries:h=[]}=d.data;return{cutIndexes:p,geometries:h.map((e=>{const t=r.fromJSON(e);return t.spatialReference=c,t}))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/utils":function(){define(["require","exports","../config","../kernel","../core/lang","../core/urlUtils","../support/apiKeyUtils"],(function(e,t,r,i,o,s,n){"use strict";const a=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));function l(e,t){return e?t&&n.supportsApiKey(e)?t:n.getApiKey(e)??i.id?.findCredential(e)?.token:null}t.asValidOptions=function(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}},t.encode=function e(t,r,i){const o={};for(const s in t){if("declaredClass"===s)continue;const n=t[s];if(null!=n&&"function"!=typeof n)if(Array.isArray(n))o[s]=n.map((t=>e(t)));else if("object"==typeof n)if(n.toJSON){const e=n.toJSON(i?.[s]);o[s]=r?e:JSON.stringify(e)}else o[s]=r?n:JSON.stringify(n);else o[s]=n}return o},t.findToken=l,t.getToken=async function(t,o,s){const n=l(t,o);if(n)return n;!i.id&&r.request.useIdentity&&await new Promise(((t,r)=>e(["../identity/IdentityManager"],(e=>t(a(e))),r)));const c=await i.id.getCredential(t,s);return c?.token},t.parseUrl=function(e){return"string"==typeof e?s.urlToObject(e):o.clone(e)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/geometryService/simplify":function(){define(["exports","../../request","../../core/urlUtils","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","./utils"],(function(e,t,r,i,o,s){"use strict";e.simplify=async function(e,n,a){const l="string"==typeof e?r.urlToObject(e):e,c=n[0].spatialReference,u=i.getJsonType(n[0]),d={...a,query:{...l.query,f:"json",sr:o.srToRESTValue(c),geometries:JSON.stringify(s.encodeGeometries(n))}},{data:p}=await t(l.path+"/simplify",d);return s.decodeGeometries(p.geometries,u,c)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/geometryService/utils":function(){define(["exports","../../geometry/support/jsonUtils"],(function(e,t){"use strict";e.decodeGeometries=function(e,r,i){const o=t.getGeometryType(r);return e.map((e=>{const t=o.fromJSON(e);return t.spatialReference=i,t}))},e.encodeGeometries=function(e){return{geometryType:t.getJsonType(e[0]),geometries:e.map((e=>e.toJSON()))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],(function(e){"use strict";e.makeEdgeCandidate=function(e,t,r,i,o,s=!1){return{objectId:e,target:t,distance:r,type:"edge",start:i,end:o,draped:s}},e.makeVertexCandidate=function(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/support/AutoIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";function d(e,t,i){r.setDeepValue(i,e instanceof Date?e.getTime():e,t)}return e.default=class extends(u.NormalizationBinParametersMixin(c)){constructor(e){super(e),this.numBins=null,this.end=null,this.start=null,this.type="auto-interval"}},t.__decorate([i.property({type:Number,json:{name:"parameters.numberOfBins",write:!0}})],e.default.prototype,"numBins",void 0),t.__decorate([i.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([a.enumeration({autoIntervalBin:"auto-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.AutoIntervalBinParameters")],e.default),e.default.from=o.ensureType(e.default),e.default}))},"esri/rest/support/BinParametersBase":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./AttributeBinsGrouping"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";const p=new i.JSONMap({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeDate:"date",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"}),h=new i.JSONMap({naturalLog:"natural-log",squareRoot:"square-root"});return e.default=class extends(r.ClonableMixin(o)){constructor(e){super(e),this.expression=null,this.expressionValueType=null,this.field=null,this.firstDayOfWeek=null,this.hideUpperBound=null,this.splitBy=null,this.stackBy=null,this.transformation=null}},t.__decorate([s.property({type:String,json:{name:"onExpression.value",write:!0}})],e.default.prototype,"expression",void 0),t.__decorate([c.enumeration(p,{name:"onExpression.valueType"})],e.default.prototype,"expressionValueType",void 0),t.__decorate([s.property({type:String,json:{name:"onField",write:!0}})],e.default.prototype,"field",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"firstDayOfWeek",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"hideUpperBound",void 0),t.__decorate([s.property({type:d,json:{write:{overridePolicy(){return{enabled:null!=this.splitBy?.value||null!=this.splitBy?.type}}}}})],e.default.prototype,"splitBy",void 0),t.__decorate([s.property({type:d,json:{write:{target:{stackBy:{type:d},jsonStyle:{type:String}},writer:(e,t)=>{e&&(t.stackBy=e.toJSON(),null!=e.responseType&&(t.jsonStyle=e.responseType))},overridePolicy(){return{enabled:null!=this.stackBy?.value||null!=this.stackBy?.type}}},read:{source:["stackBy","jsonStyle"],reader:(e,t)=>d.fromJSON({...t.stackBy,responseType:t.jsonStyle})}}})],e.default.prototype,"stackBy",void 0),t.__decorate([c.enumeration(h)],e.default.prototype,"transformation",void 0),e.default=t.__decorate([u.subclass("esri.rest.support.BinParametersBase")],e.default),e.default}))},"esri/rest/support/AttributeBinsGrouping":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=new r.JSONMap({esriFieldTypeInteger:"integer",esriFieldTypeString:"string"});let d=class extends(t.ClonableMixin(i)){constructor(e){super(e),this.alias=null,this.responseType=null,this.type=null,this.value=null,this.valueType=null}};e.__decorate([o.property({type:String,json:{name:"outAlias",write:!0}})],d.prototype,"alias",void 0),e.__decorate([o.property({type:String})],d.prototype,"responseType",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"type",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"value",void 0),e.__decorate([l.enumeration(u)],d.prototype,"valueType",void 0),d=e.__decorate([c.subclass("esri.rest.support.AttributeBinsGrouping")],d);const p=d;return d.from=s.ensureType(d),p}))},"esri/rest/support/NormalizationBinParametersMixin":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l){"use strict";const c=r.strict()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),u="percent-of-total",d="field";e.NormalizationBinParametersMixin=e=>{let r=class extends e{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t&&d||r&&u||null,t&&r&&i.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==d&&e!==u||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}};return t.__decorate([o.property({type:String,json:{name:"parameters.normalizationField",write:!0}})],r.prototype,"normalizationField",void 0),t.__decorate([o.property({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],r.prototype,"normalizationMaxValue",void 0),t.__decorate([o.property({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],r.prototype,"normalizationMinValue",void 0),t.__decorate([o.property({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],r.prototype,"normalizationTotal",void 0),t.__decorate([a.enumeration(c,{name:"parameters.normalizationType"})],r.prototype,"normalizationType",null),r=t.__decorate([l.subclass("esri.rest.support.NormalizationBinParametersMixin")],r),r},e.normalizationTypeJsonMap=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/support/DateBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./DateBinTimeInterval"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";function d(e,t,i){r.setDeepValue(i,"string"==typeof e?e:e?.getTime(),t)}function p(e,t){const r=e.parameters[t];return r?"string"==typeof r?r:new Date(r):null}return e.default=class extends c{constructor(e){super(e),this.end=null,this.interval=null,this.offset=null,this.returnFullIntervalBin=!1,this.start=null,this.snapToData=null,this.type="date"}},t.__decorate([i.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.end",read:{reader:(e,t)=>p(t,"end")},write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({type:u,json:{name:"parameters",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([i.property({type:u,json:{name:"parameters.offset",write:!0}})],e.default.prototype,"offset",void 0),t.__decorate([i.property({type:Boolean,json:{name:"parameters.returnFullIntervalBin",write:!0}})],e.default.prototype,"returnFullIntervalBin",void 0),t.__decorate([i.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.start",read:{reader:(e,t)=>p(t,"start")},write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([i.property({type:String,json:{name:"parameters.snapToData",write:!0}})],e.default.prototype,"snapToData",void 0),t.__decorate([a.enumeration({dateBin:"date"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.DateBinParameters")],e.default),e.default.from=o.ensureType(e.default),e.default}))},"esri/rest/support/DateBinTimeInterval":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./DateBinUtils"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";let u=class extends(t.ClonableMixin(r)){constructor(e){super(e),this.value=null,this.unit=null}};e.__decorate([i.property({type:Number,json:{name:"number",write:!0}})],u.prototype,"value",void 0),e.__decorate([a.enumeration(c.unitsDict)],u.prototype,"unit",void 0),u=e.__decorate([l.subclass("esri.rest.support.DateBinTimeInterval")],u);const d=u;return u.from=o.ensureType(u),d}))},"esri/rest/support/DateBinUtils":function(){define(["exports","../../core/jsonMap"],(function(e,t){"use strict";const r=t.strict()({year:"years",quarter:"quarters",month:"months",week:"weeks",day:"days",hour:"hours",minute:"minutes",second:"seconds"});e.unitsDict=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/support/FixedBoundariesBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";return e.default=class extends c{constructor(e){super(e),this.boundaries=[],this.type="fixed-boundaries"}},t.__decorate([i.property({json:{name:"parameters.boundaries",write:{writer:function(e,t,i){r.setDeepValue(i,e&&e[0]instanceof Date?e.map((e=>e.getTime())):e,t)}}}})],e.default.prototype,"boundaries",void 0),t.__decorate([a.enumeration({fixedBoundariesBin:"fixed-boundaries"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedBoundariesBinParameters")],e.default),e.default.from=o.ensureType(e.default),e.default}))},"esri/rest/support/FixedIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";function d(e,t,i){r.setDeepValue(i,e instanceof Date?e.getTime():e,t)}return e.default=class extends(u.NormalizationBinParametersMixin(c)){constructor(e){super(e),this.end=null,this.interval=null,this.start=null,this.type="fixed-interval"}},t.__decorate([i.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.interval",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([i.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([a.enumeration({fixedIntervalBin:"fixed-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedIntervalBinParameters")],e.default),e.default.from=o.ensureType(e.default),e.default}))},"esri/layers/graphics/data/queryValidationUtils":function(){define(["exports","../../../core/Error","./attributeSupport","./projectionSupport","./spatialQuerySupport","../../../support/loadArcade"],(function(e,t,r,i,o,s){"use strict";const n="unsupported-query";async function a(e,{fieldsIndex:s,geometryType:a,spatialReference:u,availableFields:d}){if(null!=e.geometryPrecision||e.multipatchOption&&"xyFootprint"!==e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new t(n,"Unsupported query options",{query:e});return l(s,d,e),function(e,i,o){const{outStatistics:s,groupByFieldsForStatistics:a,having:l}=o,u=a?.length,d=s?.length;if(l){if(!u||!d)throw new t(n,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:o});r.validateHaving(e,i,l,s,o)}if(d){if(!function(e){return null!=e&&e.every((e=>"exceedslimit"!==e.statisticType))}(s))return;const l=s.map((e=>e.onStatisticField)).filter(Boolean);r.validateFields(e,i,l,{expressionName:"onStatisticFields",query:o}),u&&r.validateFields(e,i,a,{expressionName:"groupByFieldsForStatistics",query:o});for(const a of s){const{onStatisticField:s,statisticType:l}=a;if("percentile_disc"!==l&&"percentile_cont"!==l||!("statisticParameters"in a))e.get(s)&&"count"!==l&&"min"!==l&&"max"!==l&&r.validateFields(e,i,[s],{expressionName:`outStatistics with '${l}' statistic type`,allowedFieldTypes:c,query:o});else{const{statisticParameters:e}=a;if(!e)throw new t(n,"statisticParameters should be set for percentile type",{definition:a,query:o})}}}}(s,d,e),Promise.all([o.checkSpatialQuerySupport(e,a,u),i.checkProjectionSupport(u,e.outSR)]).then((()=>e))}function l(e,i,o){const{returnDistinctValues:s,outStatistics:a}=o,l=a?a.map((e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase())).filter(Boolean):[];if("orderByFields"in o&&o.orderByFields&&o.orderByFields.length>0){const t=" asc",s=" desc",n=o.orderByFields.map((e=>{const r=e.toLowerCase();return r.includes(t)?r.split(t)[0]:r.includes(s)?r.split(s)[0]:e})).filter((e=>!l.includes(e)));r.validateFields(e,i,n,{expressionName:"orderByFields",query:o})}if("outFields"in o)if(o.outFields?.length)r.validateFields(e,i,o.outFields,{expressionName:"outFields",query:o,allowedFieldTypes:"all"});else if(s)throw new t(n,"outFields should be specified for returnDistinctValues",{query:o});r.validateWhere(e,i,o.where,o)}const c=new Set([...r.numericFieldTypes,...r.allDateAndTimeFieldTypes]);async function u(e,i,o,a){let l=[];if(o.valueExpression){const{arcadeUtils:e}=await s.loadArcade();l=e.extractFieldNames(o.valueExpression)}if(o.field&&l.push(o.field),o.field2&&l.push(o.field2),o.field3&&l.push(o.field3),o.normalizationField&&l.push(o.normalizationField),!l.length&&!o.valueExpression)throw new t(n,"field or valueExpression is required",{params:o});r.validateFields(e,i,l,{expressionName:"statistics",query:a})}e.validateAttributeBinsQuery=async function(e,r){const i=e.bin;if(!i.onField&&!i.onExpression?.value||"autoIntervalBin"===i.type&&null==i.parameters.numberOfBins||"dateBin"===i.type&&(null==i.parameters.number||null==i.parameters.unit)||"fixedBoundariesBin"===i.type&&null==i.parameters.boundaries||"fixedIntervalBin"===i.type&&null==i.parameters.interval)throw new t(n,"Unsupported query options",{query:e});return a(e,r)},e.validateQuery=a,e.validateStatisticsQuery=async function(e,r,{fieldsIndex:s,geometryType:a,spatialReference:c,availableFields:d}){if(null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new t(n,"Unsupported query options",{query:e});return l(s,d,e),Promise.all([u(s,d,r,e),o.checkSpatialQuerySupport(e,a,c),i.checkProjectionSupport(c,e.outSR)]).then((()=>e))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/data/spatialQuerySupport":function(){define(["require","exports","../../../core/Error","../../../geometry/support/contains","../../../geometry/support/intersects","../../../geometry/support/jsonUtils","../../../geometry/support/spatialReferenceUtils","../contains","../featureConversionUtils","../OptimizedGeometry","./geometryUtils","./projectionSupport"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";const p="unsupported-query",h={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},f={esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},m={esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1},y={esriSpatialRelIntersects:()=>new Promise(((t,r)=>e(["../../../geometry/operators/json/intersectsOperator"],t,r))),esriSpatialRelContains:()=>new Promise(((t,r)=>e(["../../../geometry/operators/json/containsOperator"],t,r))),esriSpatialRelCrosses:()=>new Promise(((t,r)=>e(["../../../geometry/operators/json/crossesOperator"],t,r))),esriSpatialRelDisjoint:()=>new Promise(((t,r)=>e(["../../../geometry/operators/json/disjointOperator"],t,r))),esriSpatialRelEnvelopeIntersects:null,esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:()=>new Promise(((t,r)=>e(["../../../geometry/operators/json/overlapsOperator"],t,r))),esriSpatialRelTouches:()=>new Promise(((t,r)=>e(["../../../geometry/operators/json/touchesOperator"],t,r))),esriSpatialRelWithin:()=>new Promise(((t,r)=>e(["../../../geometry/operators/json/withinOperator"],t,r))),esriSpatialRelRelation:null};t.canQueryWithRBush=function(e){if(s.isExtent(e))return!0;if(s.isPolygon(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1},t.checkSpatialQuerySupport=async function(e,t,i){const{spatialRel:o,geometry:a}=e;if(a){if(null==(l=o)||!0!==h[l])throw new r(p,"Unsupported query spatial relationship",{query:e});var l;if(n.isValid(a.spatialReference)&&n.isValid(i)){if(!function(e){return null!=e&&!0===f[s.getJsonType(e)]}(a))throw new r(p,"Unsupported query geometry type",{query:e});if(!function(e){return null!=e&&!0===m[e]}(t))throw new r(p,"Unsupported layer geometry type",{query:e});if(e.outSR)return d.checkProjectionSupport(e.geometry?.spatialReference,e.outSR)}}},t.getSpatialQueryOperator=async function(e,t,r,n,d){if(s.isPolygon(t)){if("esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=l.convertFromPolygon(new c,t,!1,!1);return t=>a.polygonContainsPoint(e,!1,!1,t)}if("esriGeometryMultipoint"===r){const r=l.convertFromPolygon(new c,t,!1,!1);if("esriSpatialRelContains"===e)return e=>a.polygonContainsMultipoint(r,!1,!1,e,n,d)}}if(s.isExtent(t)){if("esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return e=>i.extentContainsPoint(t,u.getGeometry(r,n,d,e));if("esriGeometryMultipoint"===r&&"esriSpatialRelContains"===e)return e=>i.extentContainsMultipoint(t,u.getGeometry(r,n,d,e));if("esriSpatialRelIntersects"===e){const e=o.getExtentIntersector(r);return i=>e(t,u.getGeometry(r,n,d,i))}}"esriSpatialRelEnvelopeIntersects"===e&&(e="esriSpatialRelIntersects");const p=await function(e){const t=y[e];if(null==t)throw new Error(`Cannot load unsupported spatial operator: ${e}`);return t()}(e);return e=>p.execute(t,u.getGeometry(r,n,d,e))},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],(function(e,t){"use strict";e.extentIntersectsExtent=t.extentIntersectsExtent,e.extentIntersectsMultipoint=t.extentIntersectsMultipoint,e.extentIntersectsPoint=t.extentIntersectsPoint,e.extentIntersectsPolygon=t.extentIntersectsPolygon,e.extentIntersectsPolyline=t.extentIntersectsPolyline,e.getFeatureExtentIntersector=t.getFeatureExtentIntersector,e.isSelfIntersecting=t.isSelfIntersecting,e.segmentIntersects=t.segmentIntersects,e.getExtentIntersector=function(e){return"mesh"===e?t.extentIntersectsExtent:t.getFeatureExtentIntersector(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/contains":function(){define(["exports"],(function(e){"use strict";function t(e,t){return e?t?4:3:t?3:2}function r(e,r,o,s,n){if(!e)return!1;const a=t(r,o),{coords:l,lengths:c}=e;let u=!1,d=0;for(const e of c)u=i(u,l,a,d,e,s,n),d+=e*a;return u}function i(e,t,r,i,o,s,n){let a=e,l=i;for(let e=i,c=i+o*r;e<c;e+=r){l=e+r,l===c&&(l=i);const o=t[e],u=t[e+1],d=t[l],p=t[l+1];(u<n&&p>=n||p<n&&u>=n)&&o+(n-u)/(p-u)*(d-o)<s&&(a=!a)}return a}e.polygonContainsCoords=r,e.polygonContainsMultipoint=function(e,i,o,s,n,a){const l=t(n,a),{coords:c,lengths:u}=s;if(!u)return!1;for(let t=0,s=0;t<u.length;t++,s+=l)if(!r(e,i,o,c[s],c[s+1]))return!1;return!0},e.polygonContainsPoint=function(e,t,i,o){return r(e,t,i,o.coords[0],o.coords[1])},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/data/timeSupport":function(){define(["exports","../../../core/compilerUtils"],(function(e,t){"use strict";e.getTimeExtent=async function(e,r){if(!e)return null;const i=r.featureAdapter,{startTimeField:o,endTimeField:s}=e;let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(o&&s)await r.forEach((e=>{const r=i.getAttribute(t.toConst(e),o),l=i.getAttribute(t.toConst(e),s);null==r||isNaN(r)||(n=Math.min(n,r)),null==l||isNaN(l)||(a=Math.max(a,l))}));else{const e=o||s;await r.forEach((r=>{const o=i.getAttribute(t.toConst(r),e);null==o||isNaN(o)||(n=Math.min(n,o),a=Math.max(a,o))}))}return{start:n,end:a}},e.getTimeOperator=function(e,t,r){if(!t||!e)return null;const{startTimeField:i,endTimeField:o}=e;if(!i&&!o)return null;const{start:s,end:n}=t;if(null===s&&null===n)return null;if(void 0===s&&void 0===n)return()=>!1;const a=r.getAttributeAsTimestamp?.bind(r)??r.getAttribute.bind(r);return i&&o?function(e,t,r,i,o){return null!=i&&null!=o?s=>{const n=e(s,t),a=e(s,r);return(null==n||n<=o)&&(null==a||a>=i)}:null!=i?t=>{const o=e(t,r);return null==o||o>=i}:null!=o?r=>{const i=e(r,t);return null==i||i<=o}:void 0}(a,i,o,s,n):function(e,t,r,i){return null!=r&&null!=i&&r===i?i=>e(i,t)===r:null!=r&&null!=i?o=>{const s=e(o,t);return null!=s&&s>=r&&s<=i}:null!=r?i=>{const o=e(i,t);return null!=o&&o>=r}:null!=i?r=>{const o=e(r,t);return null!=o&&o<=i}:void 0}(a,i||o,s,n)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/FieldsIndex":function(){define(["../../core/Error","../../core/Logger","../../core/MapUtils","../../core/sql/UnknownTimeZone","../../core/support/jsonUtils","./fieldUtils","../../time/constants","../../time/timeZoneUtils","../../chunks/datetime"],(function(e,t,r,i,o,s,n,a,l){"use strict";const c=new Map;class u{static fromJSON(e){return new u(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new u(e.fields??[],f(e))}static fromLayerJSON(e){return new u(e.fields??[],f(e))}constructor(e=[],t){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const e of this.fields){const t=e?.name,i=p(t);if(t&&i){const o=d(t);this._fieldsMap.set(t,e),this._fieldsMap.set(o,e),this._normalizedFieldsMap.set(i,e),r.push(`${o}:${e.type}:${this._timeZoneByFieldName?.get(t)}`),s.isDateField(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):s.isNumericField(e)&&(this._numericFieldsSet.add(e),this.numericFields.push(e)),s.isObjectIDField(e)||s.isGlobalIDField(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)s.isObjectIDField(e)||s.isGlobalIDField(e)||e.nullable||void 0!==s.getFieldDefaultValue(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(d(e))??this._normalizedFieldsMap.get(p(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(r){const i=this.get(r&&"string"!=typeof r?r.name:r);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):"date"===i.type||"esriFieldTypeDate"===i.type?(t.getLogger("esri.layers.support.FieldsIndex").errorOnce(new e("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),n.utc):h.has(i.type)?n.unknown:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===n.unknown?i.UnknownTimeZone.instance:t===n.utc?l.FixedOffsetZone.utcInstance:r.getOrCreateMapValue(c,t,(()=>l.IANAZone.create(t))):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return s.isTimeOnlyField(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map((e=>o.isSerializable(e)?e.toJSON():e)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function d(e){return e.trim().toLowerCase()}function p(e){return s.normalizeFieldName(e)?.toLowerCase()??""}const h=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function f(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:i,editFieldsInfo:o}=e,s=(i?"startField"in i?i.startField:i.startTimeField:"")??"",l=(i?"endField"in i?i.endField:i.endTimeField:"")??"",c="dateFieldsTimeZone"in e?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?a.fromTimeReference(e.dateFieldsTimeReference):null,u=o?"timeZone"in o?o.timeZone??c:o.dateFieldsTimeReference?a.fromTimeReference(o.dateFieldsTimeReference):c??n.utc:null,p=i?"timeZone"in i?i.timeZone??c:i.timeReference?a.fromTimeReference(i.timeReference):c:null,f=new Map([[d(o?.creationDateField??""),u],[d(o?.editDateField??""),u],[d(s),p],[d(l),p]]);for(const{name:i,type:o}of e.fields)if(h.has(o))t.set(i,n.unknown);else if("date"!==o&&"esriFieldTypeDate"!==o)t.set(i,null);else if(r)t.set(i,n.unknown);else{const e=f.get(d(i??""))??c;t.set(i,e)}return t}return u}))},"esri/views/support/Scheduler":function(){define(["exports","../../core/Handles","../../core/has","../../core/Logger","../../core/maybe","../../core/PerformanceSampler","../../core/PooledArray","../../core/promiseUtils","../../core/reactiveUtils","../../core/signal","../../core/time","../../layers/support/PromiseQueue","./debugFlags","./RenderState","./Yield"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";var m;e.TaskPriority=void 0,(m=e.TaskPriority||(e.TaskPriority={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",m.RESOURCE_CONTROLLER="schedule",m.SLIDE="slide",m.STREAM_DATA_LOADER="stream loader",m.ELEVATION_QUERY="elevation query",m.TERRAIN_SURFACE="terrain",m.SURFACE_GEOMETRY_UPDATES="surface geometry updates",m.LOD_RENDERER="LoD renderer",m.GRAPHICS_CORE="Graphics3D",m.I3S_CONTROLLER="I3S",m.POINT_CLOUD_LAYER="point cloud",m.FEATURE_TILE_FETCHER="feature fetcher",m.OVERLAY="overlay",m.OVERLAY_RENDERER="overlay renderer",m.STAGE="stage",m.GRAPHICS_DECONFLICTOR="graphics deconflictor",m.FILTER_VISIBILITY="Graphics3D filter visibility",m.SCALE_VISIBILITY="Graphics3D scale visibility",m.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",m.POINT_OF_INTEREST_FREQUENT="POI frequent",m.POINT_OF_INTEREST_INFREQUENT="POI infrequent",m.LABELER="labeler",m.FEATURE_QUERY_ENGINE="feature query",m.FEATURE_TILE_TREE="feature tile tree",m.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",m.ELEVATION_ALIGNMENT="elevation alignment",m.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",m.TEXT_TEXTURE_ATLAS="text texture atlas",m.TEXTURE_UNLOAD="texture unload",m.LINE_OF_SIGHT_TOOL="line of sight tool",m.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",m.ELEVATION_PROFILE="elevation profile",m.SNAPPING="snapping",m.SHADOW_ACCUMULATOR="shadow accumulator",m.CLOUDS_GENERATOR="clouds generator",m.MAPVIEW_FETCH_QUEUE="mapview fetch queue",m.MAPVIEW_LAYERVIEW_UPDATE="mapview layerview update",m.MAPVIEW_VECTOR_TILE_PARSING_QUEUE="mapview vector tile parsing queue",m[m.NONE=0]="NONE",m[m.TEST_PRIO=1]="TEST_PRIO";const y=new Map([[e.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE,0],[e.TaskPriority.RESOURCE_CONTROLLER,4],[e.TaskPriority.SLIDE,0],[e.TaskPriority.STREAM_DATA_LOADER,0],[e.TaskPriority.ELEVATION_QUERY,0],[e.TaskPriority.TERRAIN_SURFACE,1],[e.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[e.TaskPriority.LOD_RENDERER,2],[e.TaskPriority.GRAPHICS_CORE,2],[e.TaskPriority.I3S_CONTROLLER,2],[e.TaskPriority.POINT_CLOUD_LAYER,2],[e.TaskPriority.FEATURE_TILE_FETCHER,2],[e.TaskPriority.CLOUDS_GENERATOR,2],[e.TaskPriority.OVERLAY,4],[e.TaskPriority.OVERLAY_RENDERER,4],[e.TaskPriority.STAGE,4],[e.TaskPriority.GRAPHICS_DECONFLICTOR,4],[e.TaskPriority.FILTER_VISIBILITY,4],[e.TaskPriority.SCALE_VISIBILITY,4],[e.TaskPriority.FRUSTUM_VISIBILITY,4],[e.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[e.TaskPriority.POINT_OF_INTEREST_INFREQUENT,30],[e.TaskPriority.LABELER,8],[e.TaskPriority.FEATURE_QUERY_ENGINE,8],[e.TaskPriority.FEATURE_TILE_TREE,16],[e.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[e.TaskPriority.ELEVATION_ALIGNMENT,12],[e.TaskPriority.ELEVATION_ALIGNMENT_SCENE,14],[e.TaskPriority.TEXT_TEXTURE_ATLAS,12],[e.TaskPriority.TEXTURE_UNLOAD,12],[e.TaskPriority.LINE_OF_SIGHT_TOOL,16],[e.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[e.TaskPriority.SNAPPING,0],[e.TaskPriority.SHADOW_ACCUMULATOR,30],[e.TaskPriority.MAPVIEW_FETCH_QUEUE,0],[e.TaskPriority.MAPVIEW_LAYERVIEW_UPDATE,2],[e.TaskPriority.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function g(e){return y.has(e)?y.get(e):"number"==typeof e?e:1}const b=u.Milliseconds(6.5),v=u.Milliseconds(1),S=u.Milliseconds(30),_=u.Milliseconds(1e3/30),x=u.Milliseconds(100);var w,T;!function(r){r.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=c.signal(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new s("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new m,this._state=h.RenderState.INTERACTING,this._tasks=new n,this._runQueue=new n,this._load=0,this._idleStateCallbacks=new n,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=l.watch((()=>p.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),l.initial);for(const t of Object.keys(e.TaskPriority))this.performanceInfo.tasks.set(e.TaskPriority[t],new s(e.TaskPriority[t]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),o.removeMaybe(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())})))}registerTask(e,t){const r=new a(this,e,t);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new s(e)),r}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),this.state===h.RenderState.IDLE&&this._idleUpdatesStartFired&&r.idleBegin();const i=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){i._idleUpdatesStartFired&&(r.idleEnd(),i._state===h.RenderState.IDLE&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==h.RenderState.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}frame(e){this._startFrameTaskTimes();const t=this._updateBudget(e);if(t){const e=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-e)}else this._recordFrameTaskTimes(0);return t}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=b,r=e.frameDuration,i=v;switch(this.state){case h.RenderState.IDLE:t=u.Milliseconds(0),r=u.Milliseconds(Math.max(x,e.frameDuration)),i=S;break;case h.RenderState.INTERACTING:r=u.Milliseconds(Math.max(_,e.frameDuration));case h.RenderState.ANIMATING:}return r=u.Milliseconds(r-e.elapsedFrameTime-t),this.state!==h.RenderState.IDLE&&r<v&&!this._forceTask?(this._forceTask=!0,!1):(r=u.Milliseconds(Math.max(r,i)),this._budget.reset(r),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case h.RenderState.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case h.RenderState.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(u.Milliseconds(0)),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(t){if(this._runQueue.some((e=>e.name===t)))return e.TaskState.SCHEDULED;let r=e.TaskState.IDLE;return this._tasks.forAll((i=>{i.name===t&&i.needsUpdate&&(i.schedulePriority<=1?r=e.TaskState.READY:r!==e.TaskState.READY&&(r=e.TaskState.WAITING))})),r}_getRuntime(e){let t=0;return this._tasks.forAll((r=>{r.name===e&&(t+=r.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do{for(;this._runQueue.length>0;){const t=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)===f.Yield&&(r.blockFrame=this._frameNumber)}catch(e){i.getLogger("esri.views.support.Scheduler").error(`Exception in task "${r.name}"`,e),r.blockFrame=this._frameNumber}!this._budget.hasProgressed&&r.blockFrame!==this._frameNumber&&r.needsUpdate&&(r.name,e.TaskPriority.I3S_CONTROLLER,r.blockFrame=this._frameNumber),r.schedulePriority=r.basePriority;const o=this._budget.now()-t;if(r.runtime+=o,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+o),this._budget.remaining<=0)return void this._updatingChanged()}}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const t of Object.keys(e.TaskPriority))this._frameTaskTimes.set(e.TaskPriority[t],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).push(e))),this.performanceInfo.total.push(e)}get test(){return this._test}};class a{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,r,i){this._scheduler=e,this.name=r,this.blockFrame=0,this.runtime=0,this._queue=new d.PromiseQueue,this._handles=new t,this._basePriority=g(r),this.schedulePriority=this._basePriority,this._task=c.signal(null!=i?i:this._queue),this._handles.add(l.when((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(M),this._scheduler.removeTask(this),this.schedule=I.schedule,this.reschedule=I.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=g(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class m{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}r.Budget=m}(w||(w={})),e.TaskState=void 0,(T=e.TaskState||(e.TaskState={})).SCHEDULED="s",T.READY="r",T.WAITING="w",T.IDLE="i";const M=new w.Budget;M.enabled=!1;const I=new class{remove(){}processQueue(){}schedule(e,t,r){try{if(a.isAborted(t)){const e=a.createAbortError();return r?Promise.resolve(r(e)):Promise.reject(e)}return a.when(e(M))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}};e.ImmediateTask=I,e.getTaskPriority=g,e.makeBudget=function(e){const t=new w.Budget;return t.reset(e),t},e.newScheduler=function(){return new w.Scheduler},e.noBudget=M,e.taskPriorities=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/signal":function(){define(["exports","./lang","./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],(function(e,t,r,i){"use strict";class o{constructor(e,t){this._observable=new i.SimpleObservable,this._value=e,this._equalityFunction=t}get value(){return r.trackAccess(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}}e.signal=function(e,r=t.equalsShallow){return new o(e,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],(function(e,t,r,i){"use strict";class o{constructor(e,t,r,i=void 0,o=void 0){this.resolve=e,this.reject=t,this.callback=r,this.signal=i,this.abortCallback=o}}e.PromiseQueue=class{constructor(){this._tasks=new Array,this._numPendingTasks=r.signal(0),this._running=r.signal(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get running(){return this._running.value}_updateRunning(){this._running.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return i.Yield;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return new Promise(((i,s)=>{this._tasks.push(new o(i,s,e,t,r)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}unshift(e,t,r){return new Promise(((i,s)=>{this._tasks.unshift(new o(i,s,e,t,r)),++this._numPendingTasks.value,this._updateRunning()})).finally((()=>--this._numPendingTasks.value))}_process(e){if(0===this._tasks.length)return!1;const r=this._tasks.shift();this._updateRunning();try{const i=t.isAborted(r.signal);if(i&&!r.abortCallback)r.reject(t.createAbortError());else{const o=i?r.abortCallback?.(t.createAbortError()):r.callback(e);t.isPromiseLike(o)?o.then(r.resolve,r.reject):r.resolve(o)}}catch(e){r.reject(e)}return!0}cancelAll(){const e=t.createAbortError();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0,this._updateRunning()}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/Yield":function(){define(["exports"],(function(e){"use strict";const t=Symbol("Yield");e.Yield=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/support/debugFlags":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";let a=class extends t{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};return e.__decorate([r.property()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),e.__decorate([r.property()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=e.__decorate([n.subclass("esri.views.support.debugFlags")],a),new a}))},"esri/views/support/RenderState":function(){define(["exports"],(function(e){"use strict";var t;e.RenderState=void 0,(t=e.RenderState||(e.RenderState={}))[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/FeatureProcessingContext":function(){define(["exports","../../../../../renderers/support/jsonUtils","./PipelineCommand","./symbolization/factoryUtils","./symbolization/IconSymbolLayerRenderer","./symbolization/Point3DSymbolRenderer","./symbolization/SimpleFeatureRenderer","./symbolization/UniqueValueFeatureRenderer"],(function(e,t,r,i,o,s,n,a){"use strict";class l{constructor(e){this.context=e}createSymbolRendererFromJSON(e){const r=t.read(e??c)??void 0;if(!r)throw new Error("Failed to create renderer");const i=r.type;switch(i){case"simple":return new n.SimpleFeatureRenderer(r,this.context);case"unique-value":return new a.UniqueValueFeatureRenderer(r,this.context);default:return console.warn(`Unable to create symbolrenderer for renderer of ${i}`),this.createSymbolRendererFromJSON(c)}}createSymbolRendererFromSymbol(e){const t=e?.type;switch(t){case"point-3d":return new s.Point3DSymbolRenderer(e,this.context);case"picture-marker":case"simple-marker":return new o.IconSymbolLayerRenderer(i.createDefaultIconSymbolLayer(),this.context);default:return console.warn(`Unable to create symbolrenderer for symbol of ${t}`),null}}createSymbolRendererFromSymbolLayer(e){const t=e.type;return"icon"===t?new o.IconSymbolLayerRenderer(e,this.context):(console.warn(`Unable to create symbolrenderer for symbolLayer of ${t}`),null)}}const c={type:"simple"};e.FeatureProcessingContext=class{constructor(e,t,r,i,o,s,n){this.viewSpatialReference=e,this.renderSpatialReference=t,this.mainThreadDelegate=r,this.renderCoordsHelper=i,this.renderCommandContext=o,this.layerInfo=s,this.layerViewInfo=n,this.symbolRendererFactory=new l(this)}createPipelineCommand(e=this.renderCommandContext.createRenderCommandBuffer(),t=[]){return new r.PipelineCommand(this.renderCommandContext,e,t)}joinPipelineCommands(e){return 0===e.length?this.createPipelineCommand():e.filter((e=>null!=e)).reduce(((e,t)=>(e.append(t),e)))}},e.SymbolRendererFactory=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/support/jsonUtils":function(){define(["exports","../../core/Warning","../../core/accessorSupport/extensions/serializableProperty/reader","./typeUtils"],(function(e,t,r,i){"use strict";const o=r.createTypeReader({types:i.rendererTypes});function s(e,r,i){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(i?.messages&&i.messages.push(new t("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):o(e,r,i):null}e.fromJSON=function(e,t){return s(e,null,t)},e.read=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/support/typeUtils":function(){define(["exports","../../core/Logger","../ClassBreaksRenderer","../DictionaryRenderer","../DotDensityRenderer","../HeatmapRenderer","../PieChartRenderer","../Renderer","../SimpleRenderer","../UniqueValueRenderer"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";const u={key:"type",base:a,typeMap:{heatmap:s,simple:l,"unique-value":c,"class-breaks":r,"dot-density":o,dictionary:i,"pie-chart":n},errorContext:"renderer"},d={key:"type",base:a,typeMap:{simple:l,"unique-value":c,"class-breaks":r,heatmap:s},errorContext:"renderer",validate:function(e){switch(e.type){case"simple":return function(e){if(e.symbol)return e;t.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}(e);case"unique-value":return function(e){const r=e.uniqueValueInfos,i=r?.filter((({symbol:e,label:r},i)=>(e||t.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${i}] ${r}) without a symbol from web scene.`),!!e)));return i?.length!==r?.length&&(e.uniqueValueInfos=i),e}(e);case"class-breaks":return function(e){const r=e.classBreakInfos,i=r?.filter((({symbol:e,label:r},i)=>(e||t.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${i}] ${r}) without a symbol from web scene.`),!!e)));return i?.length!==r?.length&&(e.classBreakInfos=i),e}(e);case"heatmap":return e}}};e.isRenderer=function(e){return e instanceof a},e.rendererTypes=u,e.webSceneRendererTypes=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/ClassBreaksRenderer":function(){define(["exports","../chunks/tslib.es6","../core/jsonMap","../core/lang","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../core/accessorSupport/ensureType","../layers/support/fieldUtils","./Renderer","./mixins/VisualVariablesMixin","./support/ClassBreakInfo","./support/commonProperties","./support/RendererLegendOptions","../support/loadArcade","../symbols/support/typeUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v){"use strict";var S;const _="percent-of-total",x="field",w=new r.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:_,esriNormalizeByField:x}),T=d.ensureType(m);return e.default=S=class extends(f.VisualVariablesMixin(h)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,r){if(!Array.isArray(e))return;let i=t.minValue;return e.map((e=>{const t=new m;return t.read(e,r),null==t.minValue&&(t.minValue=i),null==t.maxValue&&(t.maxValue=t.minValue),i=t.maxValue,t}))}writeClassBreakInfos(e,t,r,i){const o=e.map((e=>e.write({},i)));this._areClassBreaksConsecutive()&&o.forEach((e=>delete e.classMinValue)),t[r]=o}castField(e){return null==e?e:"function"==typeof e?(o.getLogger(this).error(".field: field must be a string value"),null):d.ensureString(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t&&x||r&&_||null,t&&r&&o.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==x&&e!==_||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,r){let o=null;o="number"==typeof e?new m({minValue:e,maxValue:t,symbol:v.ensureType(r)}):T(i.clone(e)),this.classBreakInfos.push(o),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]===e&&r[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&null==t?.arcade&&o.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let r=t;this.valueExpression&&null==t?.arcade&&(r={...r,arcade:await b.loadArcade()});const i=this.getBreakIndex(e,r);return-1!==i?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void o.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&null==t?.arcade){const e=await b.loadArcade(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const i=this.getBreakIndex(e,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}get symbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new S({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:i.clone(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:i.clone(this.visualVariables),legendOptions:i.clone(this.legendOptions),authoringInfo:i.clone(this.authoringInfo)})}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.symbols.map((r=>r.collectRequiredFields(e,t))),p.collectArcadeFieldNames(e,t,this.valueExpression)];p.collectField(e,t,this.field),p.collectField(e,t,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:o,arcade:s,timeZone:n}=t??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=s.arcadeUtils;if(!l){const e=c.createSyntaxTree(a);l=c.createFunction(e),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const u=c.executeFunction(l,c.createExecContext(e,c.getViewInfo({viewingMode:r,scale:i,spatialReference:o}),n));return this._getBreakIndexfromInfos(u)}_getBreakIndexForField(e){const t=this.field,r=e.attributes,i=this.normalizationType;let o=parseFloat(r[t]);if(i){const e=this.normalizationTotal,t=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if("log"===i)o=Math.log(o)*Math.LOG10E;else if(i!==_||null==e||isNaN(e)){if(i===x&&!isNaN(t)){if(isNaN(o)||isNaN(t))return-1;o/=t}}else o=o/e*100}return this._getBreakIndexfromInfos(o)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return r}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let r=1;r<t;r++)if(e[r-1].maxValue!==e[r].minValue)return!1;return!0}},t.__decorate([s.property(y.rendererBackgroundFillSymbolProperty)],e.default.prototype,"backgroundFillSymbol",void 0),t.__decorate([s.property({type:[m],json:{write:{isRequired:!0}}})],e.default.prototype,"classBreakInfos",void 0),t.__decorate([l.reader("classBreakInfos")],e.default.prototype,"readClassBreakInfos",null),t.__decorate([u.writer("classBreakInfos")],e.default.prototype,"writeClassBreakInfos",null),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"defaultLabel",void 0),t.__decorate([s.property(y.rendererSymbolProperty)],e.default.prototype,"defaultSymbol",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"field",void 0),t.__decorate([n.cast("field")],e.default.prototype,"castField",null),t.__decorate([s.property({type:Boolean})],e.default.prototype,"isMaxInclusive",void 0),t.__decorate([s.property({type:g,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([s.property({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],e.default.prototype,"minValue",null),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"normalizationTotal",void 0),t.__decorate([s.property({type:w.apiValues,value:null,json:{type:w.jsonValues,read:w.read,write:w.write}})],e.default.prototype,"normalizationType",null),t.__decorate([a.enumeration({classBreaks:"class-breaks"})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpression",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpressionTitle",void 0),e.default=S=t.__decorate([c.subclass("esri.renderers.ClassBreaksRenderer")],e.default),e.default}))},"esri/renderers/Renderer":function(){define(["exports","../chunks/tslib.es6","../core/jsonMap","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./support/AuthoringInfo"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=new r.JSONMap({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});return e.default=class extends i{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}get symbols(){return[]}get arcadeRequired(){return!1}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}},t.__decorate([o.property({type:c,json:{write:!0}})],e.default.prototype,"authoringInfo",void 0),t.__decorate([o.property({type:u.apiValues,readOnly:!0,json:{type:u.jsonValues,read:!1,write:{writer:u.write,ignoreOrigin:!0,isRequired:!0}}})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.renderers.Renderer")],e.default),e.default}))},"esri/renderers/support/AuthoringInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","./AuthoringInfoFieldInfo","./AuthoringInfoVisualVariable","../../rest/support/colorRamps"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;const h=new r.JSONMap({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),f=new r.JSONMap({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),m=new r.JSONMap({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),y=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers"];return e.default=p=class extends i{constructor(e){super(e),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){return e?d.fromJSON(e):void 0}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new p({classificationMethod:this.classificationMethod,colorRamp:o.clone(this.colorRamp),fadeRatio:o.clone(this.fadeRatio),fields:this.fields?.slice(),field1:o.clone(this.field1),field2:o.clone(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((e=>e.clone())),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}},t.__decorate([s.property({type:h.apiValues,value:null,json:{type:h.jsonValues,read:h.read,write:h.write,origins:{"web-document":{default:"manual",type:h.jsonValues,read:h.read,write:h.write}}}})],e.default.prototype,"classificationMethod",null),t.__decorate([s.property({types:d.types,json:{write:!0}})],e.default.prototype,"colorRamp",void 0),t.__decorate([a.reader("colorRamp")],e.default.prototype,"readColorRamp",null),t.__decorate([s.property({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],e.default.prototype,"fadeRatio",void 0),t.__decorate([s.property({type:[String],value:null,json:{write:!0}})],e.default.prototype,"fields",null),t.__decorate([s.property({type:c.AuthoringInfoFieldInfo,value:null,json:{write:!0}})],e.default.prototype,"field1",null),t.__decorate([s.property({type:c.AuthoringInfoFieldInfo,value:null,json:{write:!0}})],e.default.prototype,"field2",null),t.__decorate([s.property({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"flowTheme",null),t.__decorate([s.property({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],e.default.prototype,"focus",null),t.__decorate([s.property({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"isAutoGenerated",void 0),t.__decorate([s.property({type:Number,value:null,json:{type:n.Integer,write:!0}})],e.default.prototype,"numClasses",null),t.__decorate([s.property({type:y,json:{type:y,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],e.default.prototype,"lengthUnit",void 0),t.__decorate([s.property({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],e.default.prototype,"maxSliderValue",void 0),t.__decorate([s.property({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],e.default.prototype,"minSliderValue",void 0),t.__decorate([s.property({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],e.default.prototype,"statistics",null),t.__decorate([s.property({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],e.default.prototype,"standardDeviationInterval",null),t.__decorate([s.property({type:f.apiValues,value:null,json:{type:f.jsonValues,read:f.read,write:f.write,origins:{"web-scene":{type:m.jsonValues,write:{writer:m.write,overridePolicy:e=>({enabled:"flow"!==e})}}}}})],e.default.prototype,"type",null),t.__decorate([s.property({type:[u],json:{write:!0}})],e.default.prototype,"visualVariables",void 0),t.__decorate([s.property({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"univariateSymbolStyle",null),t.__decorate([s.property({type:["high-to-low","above-and-below","above","below"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"univariateTheme",null),e.default=p=t.__decorate([l.subclass("esri.renderers.support.AuthoringInfo")],e.default),e.default}))},"esri/renderers/support/AuthoringInfoFieldInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./AuthoringInfoClassBreakInfo"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;e.AuthoringInfoFieldInfo=c=class extends r{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new c({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:i.clone(this.classBreakInfos)})}},t.__decorate([o.property({type:String,json:{write:!0}})],e.AuthoringInfoFieldInfo.prototype,"field",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.AuthoringInfoFieldInfo.prototype,"normalizationField",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.AuthoringInfoFieldInfo.prototype,"label",void 0),t.__decorate([o.property({type:[l.AuthoringInfoClassBreakInfo],json:{write:!0}})],e.AuthoringInfoFieldInfo.prototype,"classBreakInfos",void 0),e.AuthoringInfoFieldInfo=c=t.__decorate([a.subclass("esri.renderers.support.AuthoringInfoFieldInfo")],e.AuthoringInfoFieldInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/support/AuthoringInfoClassBreakInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";var l;e.AuthoringInfoClassBreakInfo=l=class extends r{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new l({minValue:this.minValue,maxValue:this.maxValue})}},t.__decorate([i.property({type:Number,json:{write:!0}})],e.AuthoringInfoClassBreakInfo.prototype,"minValue",void 0),t.__decorate([i.property({type:Number,json:{write:!0}})],e.AuthoringInfoClassBreakInfo.prototype,"maxValue",void 0),e.AuthoringInfoClassBreakInfo=l=t.__decorate([a.subclass("esri.renderers.support.AuthoringInfoClassBreakInfo")],e.AuthoringInfoClassBreakInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/support/AuthoringInfoVisualVariable":function(){define(["../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","./AuthoringInfoSizeStop"],(function(e,t,r,i,o,s,n,a){"use strict";var l;const c=new t.JSONMap({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),u=new t.JSONMap({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),d={key:e=>"number"==typeof e?"number":"string",typeMap:{number:Number,string:String},base:null},p=["high-to-low","above-and-below","centered-on","extremes"],h=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size","spike"])],f=["seconds","minutes","hours","days","months","years"];let m=l=class extends r{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return"string"==typeof e||"number"==typeof e?e:null}get normalizationField(){return"reference-size"===this.theme||"spike"===this.theme?this._get("normalizationField"):null}set normalizationField(e){this._set("normalizationField",e)}get referenceSizeScale(){return"reference-size"===this.theme?this._get("referenceSizeScale"):null}set referenceSizeScale(e){this._set("referenceSizeScale",e)}get referenceSizeSymbolStyle(){return"reference-size"===this.theme?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(e){this._set("referenceSizeSymbolStyle",e)}get spikeSymbolStyle(){return"spike"===this.theme?this._get("spikeSymbolStyle"):null}set spikeSymbolStyle(e){this._set("spikeSymbolStyle",e)}castStartTime(e){return"string"==typeof e||"number"==typeof e?e:null}get sizeStops(){return"reference-size"===this.theme||"spike"===this.theme?this._get("sizeStops"):null}set sizeStops(e){this._set("sizeStops",e)}get style(){return"color"===this.type?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new l({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,spikeSymbolStyle:this.spikeSymbolStyle,sizeStops:i.clone(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};return e.__decorate([o.property({types:d,json:{write:!0}})],m.prototype,"endTime",void 0),e.__decorate([s.cast("endTime")],m.prototype,"castEndTime",null),e.__decorate([o.property({type:String,json:{write:!0}})],m.prototype,"field",void 0),e.__decorate([o.property({type:Number,json:{write:!0}})],m.prototype,"maxSliderValue",void 0),e.__decorate([o.property({type:Number,json:{write:!0}})],m.prototype,"minSliderValue",void 0),e.__decorate([o.property({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],m.prototype,"normalizationField",null),e.__decorate([o.property({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],m.prototype,"referenceSizeScale",null),e.__decorate([o.property({type:["circle","diamond","hexagon-flat","hexagon-pointy","square"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],m.prototype,"referenceSizeSymbolStyle",null),e.__decorate([o.property({type:["triangle-closed-outline","triangle-gradient-fill-closed","triangle-gradient-fill-closed-outline","triangle-gradient-fill-open","triangle-gradient-fill-open-outline","triangle-open-outline","triangle-solid-fill-closed","triangle-solid-fill-closed-outline","triangle-solid-fill-open","triangle-solid-fill-open-outline"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],m.prototype,"spikeSymbolStyle",null),e.__decorate([o.property({types:d,json:{write:!0}})],m.prototype,"startTime",void 0),e.__decorate([s.cast("startTime")],m.prototype,"castStartTime",null),e.__decorate([o.property({type:[a],json:{origins:{"web-scene":{write:!1}},write:!0}})],m.prototype,"sizeStops",null),e.__decorate([o.property({type:c.apiValues,value:null,json:{type:c.jsonValues,read:c.read,write:c.write}})],m.prototype,"style",null),e.__decorate([o.property({type:h,value:null,json:{type:h,origins:{"web-scene":{type:p,write:{writer:(e,t)=>{p.includes(e)&&(t.theme=e)}}}},write:!0}})],m.prototype,"theme",null),e.__decorate([o.property({type:u.apiValues,json:{type:u.jsonValues,read:u.read,write:u.write}})],m.prototype,"type",void 0),e.__decorate([o.property({type:f,json:{type:f,write:!0}})],m.prototype,"units",void 0),m=l=e.__decorate([n.subclass("esri.renderers.support.AuthoringInfoVisualVariable")],m),m}))},"esri/renderers/support/AuthoringInfoSizeStop":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new a({label:this.label,value:this.value,size:this.size})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"label",void 0),e.__decorate([r.property({type:Number,json:{write:!0}})],l.prototype,"size",void 0),e.__decorate([r.property({type:Number,json:{write:!0}})],l.prototype,"value",void 0),l=a=e.__decorate([n.subclass("esri.renderers.support.AuthoringInfoSizeStop")],l),l}))},"esri/rest/support/colorRamps":function(){define(["exports","./AlgorithmicColorRamp","./ColorRamp","./MultipartColorRamp"],(function(e,t,r,i){"use strict";const o={key:"type",base:r,typeMap:{algorithmic:t,multipart:i}};e.fromJSON=function(e){return e?.type?"algorithmic"===e.type?t.fromJSON(e):"multipart"===e.type?i.fromJSON(e):null:null},e.types=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/support/AlgorithmicColorRamp":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/lang","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./ColorRamp"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends l{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new c({fromColor:i.clone(this.fromColor),toColor:i.clone(this.toColor),algorithm:this.algorithm})}},t.__decorate([n.enumeration({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],e.default.prototype,"algorithm",void 0),t.__decorate([o.property({type:r,json:{type:[s.Integer],write:!0}})],e.default.prototype,"fromColor",void 0),t.__decorate([o.property({type:r,json:{type:[s.Integer],write:!0}})],e.default.prototype,"toColor",void 0),t.__decorate([o.property({type:["algorithmic"]})],e.default.prototype,"type",void 0),e.default=c=t.__decorate([a.subclass("esri.rest.support.AlgorithmicColorRamp")],e.default),e.default}))},"esri/rest/support/ColorRamp":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";return e.default=class extends r{constructor(e){super(e),this.type=null}},t.__decorate([i.property({readOnly:!0,json:{read:!1,write:!0}})],e.default.prototype,"type",void 0),e.default=t.__decorate([a.subclass("esri.rest.support.ColorRamp")],e.default),e.default}))},"esri/rest/support/MultipartColorRamp":function(){define(["exports","../../chunks/tslib.es6","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./AlgorithmicColorRamp","./ColorRamp"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends l{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new c({colorRamps:r.clone(this.colorRamps)})}},t.__decorate([i.property({type:[a],json:{write:!0}})],e.default.prototype,"colorRamps",void 0),t.__decorate([i.property({type:["multipart"]})],e.default.prototype,"type",void 0),e.default=c=t.__decorate([n.subclass("esri.rest.support.MultipartColorRamp")],e.default),e.default}))},"esri/renderers/mixins/VisualVariablesMixin":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../layers/support/fieldUtils","../visualVariables/ColorVariable","../visualVariables/OpacityVariable","../visualVariables/RotationVariable","../visualVariables/SizeVariable","../visualVariables/VisualVariable","../visualVariables/VisualVariableFactory","../../support/arcadeExpressionUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";const g={base:f,key:"type",typeMap:{opacity:d,color:u,rotation:p,size:h}};function b(e,t,r){const i=y.matchRandomRotationExpression(e);return null!=i&&(c.collectField(t,r,i),!0)}e.VisualVariablesMixin=e=>{let i=class extends e{constructor(){super(...arguments),this._vvFactory=new m}set visualVariables(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(e,t,r){return this._vvFactory.readVariables(e,t,r)}writeVisualVariables(e,t,r,i){t[r]=this._vvFactory.writeVariables(e,i)}get arcadeRequiredForVisualVariables(){return this.visualVariables?.some((({arcadeRequired:e})=>e))??!1}hasVisualVariables(e,t){return e?this.getVisualVariablesForType(e,t).length>0:this.getVisualVariablesForType("size",t).length>0||this.getVisualVariablesForType("color",t).length>0||this.getVisualVariablesForType("opacity",t).length>0||this.getVisualVariablesForType("rotation",t).length>0}getVisualVariablesForType(e,t){return this.visualVariables?.filter((r=>r.type===e&&("string"==typeof t?r.target===t:!1!==t||!r.target)))??[]}async collectVVRequiredFields(e,t){let r=[];this.visualVariables&&(r=r.concat(this.visualVariables));for(const i of r)i&&(i.field&&c.collectField(e,t,i.field),i.normalizationField&&c.collectField(e,t,i.normalizationField),i.valueExpression&&(b(i.valueExpression,e,t)||await c.collectArcadeFieldNames(e,t,i.valueExpression)))}};return t.__decorate([r.property({types:[g],value:null,json:{write:!0}})],i.prototype,"visualVariables",null),t.__decorate([n.reader("visualVariables",["visualVariables","rotationType","rotationExpression"])],i.prototype,"readVisualVariables",null),t.__decorate([l.writer("visualVariables")],i.prototype,"writeVisualVariables",null),i=t.__decorate([a.subclass("esri.renderers.mixins.VisualVariablesMixin")],i),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/visualVariables/ColorVariable":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./VisualVariable","./support/ColorStop"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends a{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new c({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}},t.__decorate([r.property({readOnly:!0})],e.default.prototype,"cache",null),t.__decorate([r.property({type:["color"],json:{type:["colorInfo"]}})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:String,json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([r.property({type:[l],json:{write:!0}})],e.default.prototype,"stops",null),e.default=c=t.__decorate([n.subclass("esri.renderers.visualVariables.ColorVariable")],e.default),e.default}))},"esri/renderers/visualVariables/VisualVariable":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/ensureType","./support/VisualVariableLegendOptions"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=new r.JSONMap({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});return e.default=class extends i{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(o.getLogger(this).error(".field: field must be a string value"),null):l.ensureString(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}},t.__decorate([s.property()],e.default.prototype,"index",void 0),t.__decorate([s.property({type:u.apiValues,readOnly:!0,json:{read:u.read,write:{writer:u.write,isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"field",void 0),t.__decorate([n.cast("field")],e.default.prototype,"castField",null),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpression",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpressionTitle",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"arcadeRequired",null),t.__decorate([s.property({type:c,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),e.default=t.__decorate([a.subclass("esri.renderers.visualVariables.VisualVariable")],e.default),e.default}))},"esri/renderers/visualVariables/support/VisualVariableLegendOptions":function(){define(["../../../chunks/tslib.es6","../../../core/Clonable","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";let l=class extends(t.ClonableMixin(r)){constructor(){super(...arguments),this.showLegend=null,this.title=null}};return e.__decorate([i.property({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=e.__decorate([a.subclass("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l),l}))},"esri/renderers/visualVariables/support/ColorStop":function(){define(["../../../chunks/tslib.es6","../../../Color","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../core/accessorSupport/decorators/writer"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;let u=c=class extends r{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,r){t[r]=e??0}clone(){return new c({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};return e.__decorate([i.property({type:t,json:{type:[o.Integer],write:{isRequired:!0}}})],u.prototype,"color",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],u.prototype,"label",void 0),e.__decorate([i.property({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],u.prototype,"value",void 0),e.__decorate([l.writer("value")],u.prototype,"writeValue",null),u=c=e.__decorate([a.subclass("esri.renderers.visualVariables.support.ColorStop")],u),u}))},"esri/renderers/visualVariables/OpacityVariable":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./VisualVariable","./support/OpacityStop"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends a{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new c({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}},t.__decorate([r.property({readOnly:!0})],e.default.prototype,"cache",null),t.__decorate([r.property({type:["opacity"],json:{type:["transparencyInfo"]}})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:String,json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([r.property({type:[l],json:{write:!0}})],e.default.prototype,"stops",null),e.default=c=t.__decorate([n.subclass("esri.renderers.visualVariables.OpacityVariable")],e.default),e.default}))},"esri/renderers/visualVariables/support/OpacityStop":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/reader","../../../core/accessorSupport/decorators/subclass","../../../core/accessorSupport/decorators/writer","../../../webdoc/support/opacityUtils"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;let d=u=class extends t{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return c.transparencyToOpacity(t.transparency)}writeOpacity(e,t,r){t[r]=c.opacityToTransparency(e)}clone(){return new u({label:this.label,opacity:this.opacity,value:this.value})}};return e.__decorate([r.property({type:String,json:{write:!0}})],d.prototype,"label",void 0),e.__decorate([r.property({type:Number,json:{type:i.Integer,write:{target:"transparency",isRequired:!0}}})],d.prototype,"opacity",void 0),e.__decorate([n.reader("opacity",["transparency"])],d.prototype,"readOpacity",null),e.__decorate([l.writer("opacity")],d.prototype,"writeOpacity",null),e.__decorate([r.property({type:Number,json:{write:{isRequired:!0}}})],d.prototype,"value",void 0),d=u=e.__decorate([a.subclass("esri.renderers.visualVariables.support.OpacityStop")],d),d}))},"esri/webdoc/support/opacityUtils":function(){define(["exports","../../core/accessorSupport/ensureType"],(function(e,t){"use strict";e.opacityToTransparency=function(e){const r=t.ensureInteger(100*(1-e));return Math.max(0,Math.min(r,100))},e.transparencyToOpacity=function(e){const t=1-e/100;return Math.max(0,Math.min(t,1))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/visualVariables/RotationVariable":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./VisualVariable"],(function(e,t,r,i,o,s,n,a){"use strict";var l;return e.default=l=class extends a{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic"}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}clone(){return new l({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}},t.__decorate([r.property({readOnly:!0})],e.default.prototype,"cache",null),t.__decorate([r.property({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],e.default.prototype,"axis",void 0),t.__decorate([r.property({type:["rotation"],json:{type:["rotationInfo"]}})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],e.default.prototype,"rotationType",void 0),e.default=l=t.__decorate([n.subclass("esri.renderers.visualVariables.RotationVariable")],e.default),e.default}))},"esri/renderers/visualVariables/SizeVariable":function(){define(["exports","../../chunks/tslib.es6","../../core/Error","../../core/jsonMap","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","./VisualVariable","./support/castSizeVariable","./support/SizeStop","./support/SizeVariableLegendOptions","./support/sizeVariableUtils","./support/visualVariableUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;const g=new i.JSONMap({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),b=new i.JSONMap({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});function v(t){if(null!=t)return"string"==typeof t||"number"==typeof t?d.castSizeFromStringOrNumber(t):"size"===t.type?f.isSizeVariable(t)?t:(delete(t={...t}).type,new e.default(t)):void 0}function S(t,r,i){if("object"!=typeof t)return t;const o=new e.default;return o.read(t,i),o}return e.default=y=class extends u{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:null!=this.valueExpression&&m.viewScaleRE.test(this.valueExpression)}}set index(e){f.isSizeVariable(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),f.isSizeVariable(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return f.getInputValueType(this)}set maxDataValue(e){e&&this.stops&&(o.getLogger(this).warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(o.getLogger(this).warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return v(e)}readMaxSize(e,t,r){return S(e,0,r)}set minDataValue(e){e&&this.stops&&(o.getLogger(this).warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(o.getLogger(this).warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return v(e)}readMinSize(e,t,r){return S(e,0,r)}get arcadeRequired(){return!!this.valueExpression||null!=this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||null!=this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)):e&&(o.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return f.getTransformationType(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,o){if("$view.scale"===e){if(o?.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;o.messages.push(new r("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:o}))}}else t[i]=e}readValueUnit(e){return e?b.read(e):null}clone(){return new y({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:f.isSizeVariable(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:f.isSizeVariable(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if(this.transformationType===f.TransformationType.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===f.TransformationType.Stops){const e=this.stops;if(!e)return this;const t=e.map((e=>e.size)).reverse(),r=e.length;for(let i=0;i<r;i++)e[i].size=t[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map((e=>e.value||0))}},t.__decorate([s.property({readOnly:!0})],e.default.prototype,"cache",null),t.__decorate([s.property({type:g.apiValues,json:{type:g.jsonValues,origins:{"web-map":{read:!1}},read:g.read,write:g.write}})],e.default.prototype,"axis",void 0),t.__decorate([s.property()],e.default.prototype,"index",null),t.__decorate([s.property({type:String,readOnly:!0})],e.default.prototype,"inputValueType",null),t.__decorate([s.property({type:h,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([s.property({type:Number,value:null,json:{write:!0}})],e.default.prototype,"maxDataValue",null),t.__decorate([s.property({type:Number,value:null,json:{write:!0}})],e.default.prototype,"maxSize",null),t.__decorate([n.cast("maxSize")],e.default.prototype,"castMaxSize",null),t.__decorate([a.reader("maxSize")],e.default.prototype,"readMaxSize",null),t.__decorate([s.property({type:Number,value:null,json:{write:!0}})],e.default.prototype,"minDataValue",null),t.__decorate([s.property({type:Number,value:null,json:{write:!0}})],e.default.prototype,"minSize",null),t.__decorate([n.cast("minSize")],e.default.prototype,"castMinSize",null),t.__decorate([a.reader("minSize")],e.default.prototype,"readMinSize",null),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"arcadeRequired",null),t.__decorate([s.property({type:String})],e.default.prototype,"scaleBy",void 0),t.__decorate([s.property({type:[p],value:null,json:{write:!0}})],e.default.prototype,"stops",null),t.__decorate([s.property({type:["outline"],json:{write:!0}})],e.default.prototype,"target",void 0),t.__decorate([s.property({type:String,readOnly:!0})],e.default.prototype,"transformationType",null),t.__decorate([s.property({type:["size"],json:{type:["sizeInfo"]}})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],e.default.prototype,"useSymbolValue",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpression",void 0),t.__decorate([a.reader("valueExpression",["valueExpression","expression"])],e.default.prototype,"readValueExpression",null),t.__decorate([c.writer("web-scene","valueExpression")],e.default.prototype,"writeValueExpressionWebScene",null),t.__decorate([s.property({type:["radius","diameter","area","width","distance"],json:{write:!0}})],e.default.prototype,"valueRepresentation",void 0),t.__decorate([s.property({type:b.apiValues,json:{write:b.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],e.default.prototype,"valueUnit",void 0),t.__decorate([a.reader("valueUnit")],e.default.prototype,"readValueUnit",null),e.default=y=t.__decorate([l.subclass("esri.renderers.visualVariables.SizeVariable")],e.default),e.default}))},"esri/renderers/visualVariables/support/castSizeVariable":function(){define(["exports","../../../core/screenUtils"],(function(e,t){"use strict";e.castSizeFromStringOrNumber=function(e){return t.toPt(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/visualVariables/support/SizeStop":function(){define(["exports","../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/screenUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends r{constructor(e){super(e),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new c({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}},t.__decorate([o.property({type:String,json:{write:!0}})],e.default.prototype,"label",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:{isRequired:!0}}})],e.default.prototype,"size",void 0),t.__decorate([o.property({type:Number,json:{write:{isRequired:!0}}})],e.default.prototype,"value",void 0),t.__decorate([o.property({type:Boolean,json:{write:!1}})],e.default.prototype,"useMinValue",void 0),t.__decorate([o.property({type:Boolean,json:{write:!1}})],e.default.prototype,"useMaxValue",void 0),e.default=c=t.__decorate([l.subclass("esri.renderers.visualVariables.support.SizeStop")],e.default),e.default}))},"esri/renderers/visualVariables/support/SizeVariableLegendOptions":function(){define(["../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./VisualVariableLegendOptions"],(function(e,t,r,i,o,s,n){"use strict";let a=class extends n{constructor(){super(...arguments),this.customValues=null}};return e.__decorate([t.property({type:[Number],json:{write:!0}})],a.prototype,"customValues",void 0),a=e.__decorate([s.subclass("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],a),a}))},"esri/renderers/visualVariables/support/sizeVariableUtils":function(){define(["exports"],(function(e){"use strict";var t,r;function i(t){return t.valueExpression?e.InputValueType.Expression:t.field&&"string"==typeof t.field?e.InputValueType.Field:e.InputValueType.Unknown}e.InputValueType=void 0,(t=e.InputValueType||(e.InputValueType={})).Unknown="unknown",t.Expression="expression",t.Field="field",e.TransformationType=void 0,(r=e.TransformationType||(e.TransformationType={})).Unknown="unknown",r.Stops="stops",r.ClampedLinear="clamped-linear",r.Proportional="proportional",r.Additive="additive",r.Constant="constant",r.Identity="identity",r.RealWorldSize="real-world-size",e.getInputValueType=i,e.getTransformationType=function(t,r){const o=r||i(t),s=t.valueUnit||"unknown";return o===e.InputValueType.Unknown?e.TransformationType.Constant:t.stops?e.TransformationType.Stops:null!=t.minSize&&null!=t.maxSize&&null!=t.minDataValue&&null!=t.maxDataValue?e.TransformationType.ClampedLinear:"unknown"===s?null!=t.minSize&&null!=t.minDataValue?t.minSize&&t.minDataValue?e.TransformationType.Proportional:e.TransformationType.Additive:e.TransformationType.Identity:e.TransformationType.RealWorldSize},e.isSizeVariable=function(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass},e.isValidNumber=function(e){return null!=e&&!isNaN(e)&&isFinite(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/visualVariables/support/visualVariableUtils":function(){define(["exports","../../../Color","../../../Graphic","../../../core/compilerUtils","../../../core/Logger","../../support/lengthUtils","./sizeVariableUtils"],(function(e,t,r,i,o,s,n){"use strict";const a=()=>o.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),l=e=>a().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),c=()=>a().error("Use of arcade expressions requires an arcade context"),u=new r,d=Math.PI;function p(e,r,i){const o="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!o)return;if("esri.renderers.visualVariables.ColorVariable"!==o.declaredClass)return void l("ColorVariable");const s="number"==typeof r,a=s?null:r,u=a?.attributes;let d=s?r:null;const p=o.field,{ipData:h,hasExpression:f}=o.cache;let m=o.cache.compiledFunc;if(!p&&!f){const e=o.stops;return e&&e[0]&&e[0].color}if("number"!=typeof d)if(f){if(null==i?.arcade)return void c();const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,r=t.getViewInfo(e),s=t.createExecContext(a,r,i.timeZone);if(!m){const e=t.createSyntaxTree(o.valueExpression);m=t.createFunction(e),o.cache.compiledFunc=m}d=t.executeFunction(m,s)}else u&&(d=u[p]);const y=o.normalizationField,g=null!=u&&null!=y?parseFloat(u[y]):void 0;if(null!=d&&(!y||s||!isNaN(g)&&0!==g)){n.isValidNumber(g)&&!s&&(d/=g);const e=v(d,h);if(e){const r=e[0],s=e[1],n=r===s?o.stops[r].color:t.blendColors(o.stops[r].color,o.stops[s].color,e[2],null!=i?i.color:void 0);return new t(n)}}}function h(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.OpacityVariable"!==i.declaredClass)return void l("OpacityVariable");const o="number"==typeof t,s=o?null:t,a=s?.attributes;let u=o?t:null;const d=i.field,{ipData:p,hasExpression:h}=i.cache;let f=i.cache.compiledFunc;if(!d&&!h){const e=i.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof u)if(h){if(null==r?.arcade)return void c();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,o=t.getViewInfo(e),n=t.createExecContext(s,o,r.timeZone);if(!f){const e=t.createSyntaxTree(i.valueExpression);f=t.createFunction(e),i.cache.compiledFunc=f}u=t.executeFunction(f,n)}else a&&(u=a[d]);const m=i.normalizationField,y=null!=a&&null!=m?parseFloat(a[m]):void 0;if(null!=u&&(!m||o||!isNaN(y)&&0!==y)){n.isValidNumber(y)&&!o&&(u/=y);const e=v(u,p);if(e){const t=e[0],r=e[1];if(t===r)return i.stops[t].opacity;{const o=i.stops[t].opacity;return o+(i.stops[r].opacity-o)*e[2]}}}}function f(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.RotationVariable"!==i.declaredClass)return void l("RotationVariable");const o=i.axis||"heading",s="heading"===o&&"arithmetic"===i.rotationType?90:0,n="heading"===o&&"arithmetic"===i.rotationType?-1:1,a="number"==typeof t?null:t,u=a?.attributes,d=i.field,{hasExpression:p}=i.cache;let h=i.cache.compiledFunc,f=null;if(!d&&!p)return f;if(p){if(null==r?.arcade)return void c();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,o=t.getViewInfo(e),s=t.createExecContext(a,o,r.timeZone);if(!h){const e=t.createSyntaxTree(i.valueExpression);h=t.createFunction(e),i.cache.compiledFunc=h}f=t.executeFunction(h,s)}else u&&(f=u[d]);return f="number"!=typeof f||isNaN(f)?null:s+n*f,f}function m(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.SizeVariable"!==i.declaredClass)return void l("SizeVariable");const o=function(e,t,r){const i="number"==typeof t,o=i?null:t,s=o?.attributes;let a=i?t:null;const{isScaleDriven:l}=e.cache;let u=e.cache.compiledFunc;if(l){const t=null!=r?r.scale:void 0,i=null!=r?r.view:void 0;a=null==t||"3d"===i?function(e){let t=null,r=null;const i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):t}else if(!i)switch(e.inputValueType){case n.InputValueType.Expression:{if(null==r?.arcade)return void c();const t={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},i=r.arcade.arcadeUtils,s=i.getViewInfo(t),n=i.createExecContext(o,s,r.timeZone);if(!u){const t=i.createSyntaxTree(e.valueExpression);u=i.createFunction(t),e.cache.compiledFunc=u}a=i.executeFunction(u,n);break}case n.InputValueType.Field:s&&(a=s[e.field]);break;case n.InputValueType.Unknown:a=null}if(!n.isValidNumber(a))return null;if(i||!e.normalizationField)return a;const d=s?parseFloat(s[e.normalizationField]):null;return n.isValidNumber(d)&&0!==d?a/d:null}(i,t,r),s=b(o,i,t,r,i.cache.ipData);return null==s||isNaN(s)?void 0:s}function y(e,t,r){return null==e?null:n.isSizeVariable(e)?m(e,t,r):n.isValidNumber(e)?e:null}function g(e,t,r){return n.isValidNumber(r)&&e>r?r:n.isValidNumber(t)&&e<t?t:e}function b(e,t,r,i,o){switch(t.transformationType){case n.TransformationType.Additive:return function(e,t,r,i){const o=y(t.minSize,r,i)||t.minDataValue;return null==e&&null==o?null:(e??0)+(o??0)}(e,t,r,i);case n.TransformationType.Constant:return function(e,t,r){const i=e.stops;let o=i?.length&&i[0].size;return null==o&&(o=e.minSize),y(o,t,r)}(t,r,i);case n.TransformationType.ClampedLinear:return function(e,t,r,i){const o=y(t.minSize,r,i);if(null==e)return o;const{minDataValue:s,maxDataValue:n}=t;if(null==s||null==n)return null;const a=(e-s)/(n-s),l=y(t.maxSize,r,i),c=null!=i?i.shape:void 0;if(e<=s)return o;if(e>=n)return l;if(null==o||null==l)return null;if("area"===t.scaleBy&&c){const e="circle"===c,t=e?d*(o/2)**2:o*o,r=t+a*((e?d*(l/2)**2:l*l)-t);return e?2*Math.sqrt(r/d):Math.sqrt(r)}return o+a*(l-o)}(e,t,r,i);case n.TransformationType.Proportional:return function(e,t,r,i){const o=y(t.minSize,r,i);if(null==e||null==o)return o;const s=null!=i?i.shape:void 0,{minDataValue:n}=t;if(null==n)return null;const a=e/n,l=y(t.maxSize,r,i);let c=null;return c="circle"===s?2*Math.sqrt(a*(o/2)**2):"square"===s||"diamond"===s||"image"===s?Math.sqrt(a*o**2):a*o,g(c,o,l)}(e,t,r,i);case n.TransformationType.Stops:return function(e,t,r,i,o){if(null==e)return null;const[s,n,a]=v(e,o);if(s===n)return y(t.stops?.[s].size,r,i);{const e=y(t.stops?.[s].size,r,i),o=y(t.stops?.[n].size,r,i);return null==e||null==o?null:e+(o-e)*a}}(e,t,r,i,o);case n.TransformationType.RealWorldSize:return function(e,t,r,i){const o=(i?.resolution??1)*s.meterIn[t.valueUnit],n=y(t.minSize,r,i),a=y(t.maxSize,r,i),{valueRepresentation:l}=t;if(null==e)return n;let c=null;return c="area"===l?2*Math.sqrt(e/d)/o:"radius"===l||"distance"===l?2*e/o:e/o,g(c,n,a)}(e,t,r,i);case n.TransformationType.Identity:return e;case n.TransformationType.Unknown:return null}}function v(e,t){if(!t)return;let r=0,i=t.length-1;return t.some(((t,o)=>e<t?(i=o,!0):(r=o,!1))),[r,i,(e-t[r])/(t[i]-t[r])]}e.getAllSizes=function(e,t,r){const o=["proportional","proportional","proportional"];for(const s of e){const e=s.useSymbolValue?"symbol-value":m(s,t,r)??"proportional";switch(s.axis){case"width":o[0]=e;break;case"depth":o[1]=e;break;case"height":o[2]=e;break;case"width-and-depth":o[0]=e,o[1]=e;break;case"all":case void 0:case null:o[0]=e,o[1]=e,o[2]=e;break;default:i.neverReached(s.axis)}}return o},e.getColor=p,e.getOpacity=h,e.getRotationAngle=f,e.getSize=m,e.getSizeForValue=b,e.getSizeFromNumberOrVariable=y,e.getSizeRangeAtScale=function(e,t,r){const{isScaleDriven:i}=e.cache;if(!(i&&"3d"===r||t))return null;const o={scale:t,view:r};let s=y(e.minSize,u,o),n=y(e.maxSize,u,o);if(null!=s||null!=n){if(s>n){const e=n;n=s,s=e}return{minSize:s,maxSize:n}}},e.getVisualVariableValues=function(e,t,r){if(!e.visualVariables)return;const i=[],o=[],s=[],n=[],a=[];for(const t of e.visualVariables)switch(t.type){case"color":o.push(t);break;case"opacity":s.push(t);break;case"rotation":a.push(t);break;case"size":n.push(t)}return o.forEach((e=>{const o=p(e,t,r);i.push({variable:e,value:o})})),s.forEach((e=>{const o=h(e,t,r);i.push({variable:e,value:o})})),a.forEach((e=>{const o=f(e,t,r);i.push({variable:e,value:o})})),n.forEach((e=>{const o=m(e,t,r);i.push({variable:e,value:o})})),i},e.viewScaleRE=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/Graphic":function(){define(["exports","./chunks/tslib.es6","./PopupTemplate","./core/Clonable","./core/deprecate","./core/JSONSupport","./core/Logger","./core/reactiveUtils","./core/uid","./core/accessorSupport/decorators/property","./core/has","./core/RandomLCG","./core/accessorSupport/decorators/subclass","./core/support/jsonUtils","./geometry/support/jsonUtils","./geometry/support/typeUtils","./layers/graphics/data/createFeatureId","./symbols/support/typeUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g){"use strict";var b;function v(e){if(null==e)return null;const t={};for(const r in e){const i=e[r];i&&(t[r]=i.toJSON())}return 0!==Object.keys(t).length?t:null}return e.default=class extends(i.ClonableMixin(s)){static{b=this}constructor(e){super(e),this.isAggregate=!1,this.layer=null,this.origin=null,this.sourceLayer=null,this._version=0,Object.defineProperty(this,"uid",{value:l.generateUID(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&o.deprecatedConstructorSignature(n.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),"mesh"!==e?.type&&this._notifyLayer("geometry",t,e))}set popupTemplate(e){const t=this._get("popupTemplate");t!==e&&(this._set("popupTemplate",e),this._notifyLayer("popupTemplate",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}get version(){return this._version}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}cloneShallow(){return new b({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const r of[t,this.sourceLayer,this.layer])if(r){if("popupTemplate"in r&&r.popupTemplate)return r.popupTemplate;if(e&&"defaultPopupTemplate"in r&&null!=r.defaultPopupTemplate)return r.defaultPopupTemplate}return null}getAttribute(e){return this.attributes?.[e]}setAttribute(e,t){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",r,t,e)}else this.attributes={[e]:t}}getObjectId(){const e=this.sourceLayer??this.layer;return e?y.createFeatureIdFromLayer(this,e):null}getGlobalId(){const e=this.sourceLayer??this.layer;return e&&"globalIdField"in e&&e.globalIdField?this.getAttribute(e.globalIdField):null}toJSON(){return{aggregateGeometries:v(this.aggregateGeometries),geometry:null!=this.geometry?this.geometry.toJSON():null,symbol:null!=this.symbol?this.symbol.toJSON():null,attributes:h.isSerializable(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyMeshTransformChanged(e={}){const{geometry:t}=this;if("mesh"===t?.type){const r={origin:t.origin,transform:t.transform};this._notifyLayer("origin-transform",r,r,e.action)}}_notifyLayer(e,t,r,i){if(this._version++,!this.layer||!("graphicChanged"in this.layer))return;const o={graphic:this,property:e,oldValue:t,newValue:r};"origin-transform"===e&&(o.action=i),"attributes"===e&&(o.attributeName=i),this.layer.graphicChanged(o)}_watchMeshGeometryChanges(){this.addHandles([a.when((()=>"mesh"===this.geometry?.type&&this.geometry.vertexSpace.origin?{localMatrix:this.geometry.transform?.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0),(({localMatrix:e,origin:t})=>{this._lastMeshTransform.localMatrix===e&&this._lastMeshTransform.origin===t||(this._lastMeshTransform.localMatrix=e,this._lastMeshTransform.origin=t,this.notifyMeshTransformChanged())})),a.when((()=>"mesh"===this.geometry?.type?{vertexAttributes:this.geometry.vertexAttributes}:void 0),(()=>{const e=this.geometry;"mesh"===e?.type&&e.vertexSpace.origin?(this._lastMeshTransform.localMatrix=e.transform?.localMatrix,this._lastMeshTransform.origin=e.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)}),{equals:(e,t)=>e===t,sync:!0})])}},t.__decorate([c.property({value:null,json:{read:function(e){if(!e)return null;const t={};for(const r in e){const i=f.fromJSON(e[r]);i&&(t[r]=i)}return 0!==Object.keys(t).length?t:null}}})],e.default.prototype,"aggregateGeometries",null),t.__decorate([c.property({value:null})],e.default.prototype,"attributes",null),t.__decorate([c.property({value:null,types:m.geometryTypes,json:{read:f.fromJSON}})],e.default.prototype,"geometry",null),t.__decorate([c.property({type:Boolean})],e.default.prototype,"isAggregate",void 0),t.__decorate([c.property({clonable:!1})],e.default.prototype,"layer",void 0),t.__decorate([c.property({clonable:"reference"})],e.default.prototype,"origin",void 0),t.__decorate([c.property({type:r,value:null})],e.default.prototype,"popupTemplate",null),t.__decorate([c.property({clonable:"reference"})],e.default.prototype,"sourceLayer",void 0),t.__decorate([c.property({value:null,types:g.symbolTypes})],e.default.prototype,"symbol",null),t.__decorate([c.property({clonable:!1,json:{read:!1,write:!1}})],e.default.prototype,"_version",void 0),t.__decorate([c.property({type:Boolean,value:!0})],e.default.prototype,"visible",null),e.default=b=t.__decorate([p.subclass("esri.Graphic")],e.default),e.default}))},"esri/PopupTemplate":function(){define(["./chunks/tslib.es6","./core/Clonable","./core/Collection","./core/JSONSupport","./core/lang","./core/Logger","./core/promiseUtils","./core/accessorSupport/decorators/property","./core/accessorSupport/decorators/cast","./core/accessorSupport/decorators/reader","./core/accessorSupport/decorators/subclass","./core/accessorSupport/decorators/writer","./core/accessorSupport/ensureType","./layers/support/fieldUtils","./popup/content","./popup/ExpressionInfo","./popup/FieldInfo","./popup/LayerOptions","./popup/RelatedRecordsInfo","./popup/content/support/mediaInfoTypes","./support/actions/ActionBase","./support/actions/ActionButton","./support/actions/ActionToggle","./popup/content/UtilityNetworkAssociationsContent","./popup/content/RelationshipContent","./popup/content/ExpressionContent","./popup/content/FieldsContent","./popup/content/AttachmentsContent","./popup/content/TextContent","./popup/content/CustomContent","./popup/content/MediaContent","./popup/content/Content"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x,w,T,M,I,P,O,C,A,E){"use strict";const R="relationships/",F="expression/",D=r.ofType({key:"type",defaultKeyValue:"button",base:S,typeMap:{button:_,toggle:x}}),L={base:E,key:"type",typeMap:{media:A,custom:C,text:O,attachments:P,fields:I,expression:M,relationship:T,utilityNetworkAssociations:w}},V=new Set(["attachments","fields","media","text","expression","relationship"]),N=new Set([...V,"utility-network-associations"]);let B=class extends(t.ClonableMixin(i)){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map((e=>p.ensureOneOfType(L,e))):"string"==typeof e||"function"==typeof e||e instanceof HTMLElement||n.isPromiseLike(e)?e:(s.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:r}=t;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(t.description,t.mediaInfos,r):this._readPopupInfo(t)}writeWebSceneContent(e,t,r,i){this._writePopupTemplateContent(e,t,i)}writeWebMapContent(e,t,r,i){this._writePopupTemplateContent(e,t,i)}writeFieldInfos(e,t,r,i){const{content:o}=this,s=Array.isArray(o)?o:null;if(e){const r=s?s.filter((e=>"fields"===e.type)):[],o=r.length&&r.every((e=>e.fieldInfos?.length));t.fieldInfos=e.filter(Boolean).map((e=>{const t=e.toJSON(i);return o&&(t.visible=!1),t}))}if(s)for(const e of s)"fields"===e.type&&this._writeFieldsContent(e,t)}writeLayerOptions(e,t,r,i){t[r]=!e||null===e.showNoDataRecords&&null===e.returnTopmostRaster?null:e.toJSON(i)}writeTitle(e,t){t.title=e||""}async collectRequiredFields(e,t){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...r,...this._getContentExpressionInfos(this.content,r)]),h.collectFields(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writePopupTemplateContent(e,t,r){"string"!=typeof e?Array.isArray(e)&&(t.popupElements=e.filter((e=>"web-scene"===r?.origin?V.has(e.type):N.has(e.type))).map((e=>e?.toJSON(r))),t.popupElements.forEach((e=>{"attachments"===e.type?this._writeAttachmentContent(t):"media"===e.type?this._writeMediaContent(e,t):"text"===e.type?this._writeTextContent(e,t):"relationship"===e.type&&this._writeRelationshipContent(e,t)}))):t.description=e}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=o.clone(e.fieldInfos);Array.isArray(t.fieldInfos)?r.forEach((e=>{const r=t.fieldInfos.find((t=>t.fieldName?.toLowerCase()===e.fieldName?.toLowerCase()));r?r.visible=!0:t.fieldInfos.push(e)})):t.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,t){const r=e.orderByFields?.map((t=>this._toFieldOrderJSON(t,e.relationshipId)))||[],i=[...t.relatedRecordsInfo?.orderByFields||[],...r];t.relatedRecordsInfo={showRelatedRecords:!0,...i?.length&&{orderByFields:i}}}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=o.clone(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...r]:t.mediaInfos=r}_readPopupInfoElements(e,t,r){const i={description:!1,mediaInfos:!1};return r.map((r=>"media"===r.type?(r.mediaInfos||!t||i.mediaInfos||(r.mediaInfos=t,i.mediaInfos=!0),A.fromJSON(r)):"text"===r.type?(r.text||!e||i.description||(r.text=e,i.description=!0),O.fromJSON(r)):"attachments"===r.type?P.fromJSON(r):"fields"===r.type?I.fromJSON(r):"expression"===r.type?M.fromJSON(r):"relationship"===r.type?T.fromJSON(r):"utilityNetworkAssociations"===r.type?w.fromJSON(r):void 0)).filter(Boolean)}_toRelationshipContent(e){const{field:t,order:r}=e;if(!t?.startsWith(R))return null;const i=t.replace(R,"").split("/");if(2!==i.length)return null;const o=parseInt(i[0],10),s=i[1];return!Number.isNaN(o)&&s?T.fromJSON({relationshipId:o,orderByFields:[{field:s,order:r}]}):null}_toFieldOrderJSON(e,t){const{order:r,field:i}=e;return{field:`${R}${t}/${i}`,order:r}}_readPopupInfo({description:e,mediaInfos:t,showAttachments:r,relatedRecordsInfo:i={showRelatedRecords:!1}}){const o=[];e?o.push(new O({text:e})):o.push(new I),Array.isArray(t)&&t.length&&o.push(A.fromJSON({mediaInfos:t})),r&&o.push(P.fromJSON({displayType:"auto"}));const{showRelatedRecords:s,orderByFields:n}=i;return s&&n?.length&&n.forEach((e=>{const t=this._toRelationshipContent(e);t&&o.push(t)})),o.length?o:e}_getContentElementFields(e){const t=e?.type;if("attachments"===t)return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if("custom"===t)return e.outFields||[];if("fields"===t)return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if("media"===t){const t=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...t.reduce(((e,t)=>[...e,...this._getMediaInfoFields(t)]),[])]}return"text"===t?this._extractFieldNames(e.text):"relationship"===t||"utility-network-associations"===t?[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)]:[]}_getMediaInfoFields(e){const{caption:t,title:r,value:i}=e,o=i||{},{fields:s,normalizeField:n,tooltipField:a,sourceURL:l,linkURL:c}=o,u=[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...s??[]];return n&&u.push(n),a&&u.push(a),u}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce(((e,t)=>[...e,..."expression"===t.type&&t.expressionInfo?[t.expressionInfo]:[]]),t):[]}_getContentFields(e){return"string"==typeof e?this._extractFieldNames(e):Array.isArray(e)?e.reduce(((e,t)=>[...e,...this._getContentElementFields(t)]),[]):[]}async _collectExpressionInfoFields(e,t,r){r&&await Promise.all(r.map((r=>h.collectArcadeFieldNames(e,t,r.expression))))}_getFieldInfoFields(e){return e?e.filter((({fieldName:e,visible:t})=>!(void 0!==t&&!t||!e||e.startsWith(R)||e.startsWith(F)))).map((e=>e.fieldName)):[]}_getActionsFields(e){return e?e.toArray().reduce(((e,t)=>[...e,...this._getActionFields(t)]),[]):[]}_getActionFields(e){const{className:t,title:r,type:i}=e,o="button"===i||"toggle"===i?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(o)]}_getTitleFields(e){return"string"==typeof e?this._extractFieldNames(e):[]}_extractFieldNames(e){return h.extractSubstitutionTemplatesFromString(e).filter((e=>!(0===e.indexOf(R)||0===e.indexOf(F))))}};return e.__decorate([a.property({type:D})],B.prototype,"actions",void 0),e.__decorate([a.property()],B.prototype,"content",void 0),e.__decorate([l.cast("content")],B.prototype,"castContent",null),e.__decorate([c.reader("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],B.prototype,"readContent",null),e.__decorate([d.writer("web-scene","content",{popupElements:{type:r.ofType(f.persistableWebSceneTypes)},showAttachments:{type:Boolean},mediaInfos:{type:r.ofType(v.types)},description:{type:String},relatedRecordsInfo:{type:b}})],B.prototype,"writeWebSceneContent",null),e.__decorate([d.writer("content",{popupElements:{type:r.ofType(f.persistableTypes)},showAttachments:{type:Boolean},mediaInfos:{type:r.ofType(v.types)},description:{type:String},relatedRecordsInfo:{type:b}})],B.prototype,"writeWebMapContent",null),e.__decorate([a.property({type:[m],json:{write:!0}})],B.prototype,"expressionInfos",void 0),e.__decorate([a.property({type:[y]})],B.prototype,"fieldInfos",void 0),e.__decorate([d.writer("fieldInfos")],B.prototype,"writeFieldInfos",null),e.__decorate([a.property({type:g})],B.prototype,"layerOptions",void 0),e.__decorate([d.writer("layerOptions")],B.prototype,"writeLayerOptions",null),e.__decorate([a.property({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],B.prototype,"lastEditInfoEnabled",void 0),e.__decorate([a.property()],B.prototype,"outFields",void 0),e.__decorate([a.property()],B.prototype,"overwriteActions",void 0),e.__decorate([a.property()],B.prototype,"returnGeometry",void 0),e.__decorate([a.property({json:{type:String}})],B.prototype,"title",void 0),e.__decorate([d.writer("title")],B.prototype,"writeTitle",null),B=e.__decorate([u.subclass("esri.PopupTemplate")],B),B}))},"esri/popup/content":function(){define(["exports","./content/AttachmentsContent","./content/Content","./content/CustomContent","./content/ExpressionContent","./content/FieldsContent","./content/MediaContent","./content/RelationshipContent","./content/TextContent","./content/UtilityNetworkAssociationsContent"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";const u={base:null,key:"type",typeMap:{attachment:t,media:n,text:l,expression:o,field:s,relationship:a,utilityNetworkAssociations:c}},d={base:null,key:"type",typeMap:{attachment:t,media:n,text:l,expression:o,field:s,relationship:a}};e.AttachmentsContent=t,e.BaseContent=r,e.CustomContent=i,e.ExpressionContent=o,e.FieldsContent=s,e.MediaContent=n,e.RelationshipContent=a,e.TextContent=l,e.UtilityNetworkAssociationsContent=c,e.isContent=function(e){return e instanceof r},e.persistableTypes=u,e.persistableWebSceneTypes=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/popup/content/AttachmentsContent":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./Content","../support/AttachmentsOrderByInfo"],(function(e,t,r,i,o,s,n,a,l){"use strict";let c=class extends(t.ClonableMixin(a)){constructor(e){super(e),this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};return e.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"description",void 0),e.__decorate([r.property({type:["auto","preview","list"],json:{write:!0}})],c.prototype,"displayType",void 0),e.__decorate([r.property({type:[l],json:{write:!0}})],c.prototype,"orderByFields",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"title",void 0),e.__decorate([r.property({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],c.prototype,"type",void 0),c=e.__decorate([n.subclass("esri.popup.content.AttachmentsContent")],c),c}))},"esri/popup/content/Content":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";let a=class extends t{constructor(e){super(e),this.type=null}};return e.__decorate([r.property({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=e.__decorate([n.subclass("esri.popup.content.Content")],a),a}))},"esri/popup/support/AttachmentsOrderByInfo":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l){"use strict";const c=new r.JSONMap({asc:"ascending",desc:"descending"});let u=class extends(t.ClonableMixin(i)){constructor(e){super(e),this.field=null,this.order="ascending"}};return e.__decorate([o.property({type:String,json:{write:!0}})],u.prototype,"field",void 0),e.__decorate([o.property({type:c.apiValues,json:{type:c.jsonValues,read:c.read,write:c.write}})],u.prototype,"order",void 0),u=e.__decorate([l.subclass("esri.popup.support.AttachmentsOrderByInfo")],u),u}))},"esri/popup/content/CustomContent":function(){define(["../../chunks/tslib.es6","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./Content"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends n{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new a({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?t.clone(this.outFields):null})}};return e.__decorate([r.property()],l.prototype,"creator",void 0),e.__decorate([r.property()],l.prototype,"destroyer",void 0),e.__decorate([r.property()],l.prototype,"outFields",void 0),e.__decorate([r.property({type:["custom"],readOnly:!0})],l.prototype,"type",void 0),l=a=e.__decorate([s.subclass("esri.popup.content.CustomContent")],l),l}))},"esri/popup/content/ExpressionContent":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../ElementExpressionInfo","./Content"],(function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends a{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){return new l({expressionInfo:this.expressionInfo?.clone()})}};return e.__decorate([t.property({type:n,json:{write:!0}})],c.prototype,"expressionInfo",void 0),e.__decorate([t.property({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.ExpressionContent")],c),c}))},"esri/popup/ElementExpressionInfo":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new a({title:this.title,expression:this.expression})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"title",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"expression",void 0),e.__decorate([r.property({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"returnType",void 0),l=a=e.__decorate([n.subclass("esri.popup.ElementExpressionInfo")],l),l}))},"esri/popup/content/FieldsContent":function(){define(["../../chunks/tslib.es6","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../FieldInfo","./Content"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;let u=c=class extends l{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map((e=>e.toJSON()))}clone(){return new c(t.clone({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};return e.__decorate([r.property({type:Object,json:{write:!0}})],u.prototype,"attributes",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],u.prototype,"description",void 0),e.__decorate([r.property({type:[a]})],u.prototype,"fieldInfos",void 0),e.__decorate([n.writer("fieldInfos")],u.prototype,"writeFieldInfos",null),e.__decorate([r.property({type:String,json:{write:!0}})],u.prototype,"title",void 0),e.__decorate([r.property({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],u.prototype,"type",void 0),u=c=e.__decorate([s.subclass("esri.popup.content.FieldsContent")],u),u}))},"esri/popup/FieldInfo":function(){define(["../chunks/tslib.es6","../core/jsonMap","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./support/FieldInfoFormat"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;let d=u=class extends r{constructor(e){super(e),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new u({fieldName:this.fieldName,format:this.format?.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};return e.__decorate([i.property({type:String,json:{write:!0}})],d.prototype,"fieldName",void 0),e.__decorate([i.property({type:c,json:{write:!0}})],d.prototype,"format",void 0),e.__decorate([i.property({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],d.prototype,"isEditable",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],d.prototype,"label",void 0),e.__decorate([a.enumeration(new t.JSONMap({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],d.prototype,"stringFieldOption",void 0),e.__decorate([i.property({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],d.prototype,"statisticType",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],d.prototype,"tooltip",void 0),e.__decorate([i.property({type:Boolean,json:{write:!0}})],d.prototype,"visible",void 0),d=u=e.__decorate([l.subclass("esri.popup.FieldInfo")],d),d}))},"esri/popup/support/FieldInfoFormat":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../intl/date"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";let u=class extends(t.ClonableMixin(r)){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};return e.__decorate([a.enumeration(c.dateFormatJSONMap)],u.prototype,"dateFormat",void 0),e.__decorate([i.property({type:Boolean,json:{write:!0}})],u.prototype,"digitSeparator",void 0),e.__decorate([i.property({type:o.Integer,json:{write:!0}})],u.prototype,"places",void 0),u=e.__decorate([l.subclass("esri.popup.support.FieldInfoFormat")],u),u}))},"esri/popup/content/MediaContent":function(){define(["../../chunks/tslib.es6","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","./BarChartMediaInfo","./ColumnChartMediaInfo","./Content","./ImageMediaInfo","./LineChartMediaInfo","./PieChartMediaInfo","./support/mediaInfoTypes"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";var m;let y=m=class extends u{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map((e=>"image"===e.type?d.fromJSON(e):"barchart"===e.type?l.fromJSON(e):"columnchart"===e.type?c.fromJSON(e):"linechart"===e.type?p.fromJSON(e):"piechart"===e.type?h.fromJSON(e):void 0)).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map((e=>e.toJSON()))}clone(){return new m(t.clone({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};return e.__decorate([r.property()],y.prototype,"activeMediaInfoIndex",void 0),e.__decorate([r.property({type:Object,json:{write:!0}})],y.prototype,"attributes",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],y.prototype,"description",void 0),e.__decorate([r.property({types:[f.types]})],y.prototype,"mediaInfos",void 0),e.__decorate([s.reader("mediaInfos")],y.prototype,"readMediaInfos",null),e.__decorate([a.writer("mediaInfos")],y.prototype,"writeMediaInfos",null),e.__decorate([r.property({type:String,json:{write:!0}})],y.prototype,"title",void 0),e.__decorate([r.property({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],y.prototype,"type",void 0),y=m=e.__decorate([n.subclass("esri.popup.content.MediaContent")],y),y}))},"esri/popup/content/BarChartMediaInfo":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./mixins/ChartMediaInfo","./support/chartMediaInfoUtils"],(function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.type="bar-chart"}clone(){return new l({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};return e.__decorate([t.property({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:a.chartTypeKebabDict.write,isRequired:!0}}})],c.prototype,"type",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.BarChartMediaInfo")],c),c}))},"esri/popup/content/mixins/ChartMediaInfo":function(){define(["../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./MediaInfo","../support/ChartMediaInfoValue"],(function(e,t,r,i,o,s,n,a){"use strict";let l=class extends n{constructor(e){super(e),this.type=null,this.value=void 0}};return e.__decorate([t.property({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"type",void 0),e.__decorate([t.property({type:a,json:{write:{isRequired:!0}}})],l.prototype,"value",void 0),l=e.__decorate([s.subclass("esri.popup.content.mixins.ChartMediaInfo")],l),l}))},"esri/popup/content/mixins/MediaInfo":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";let a=class extends t{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};return e.__decorate([r.property({type:String,json:{write:!0}})],a.prototype,"altText",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],a.prototype,"caption",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],a.prototype,"title",void 0),e.__decorate([r.property({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=e.__decorate([n.subclass("esri.popup.content.mixins.MediaInfo")],a),a}))},"esri/popup/content/support/ChartMediaInfoValue":function(){define(["../../../chunks/tslib.es6","../../../Color","../../../core/JSONSupport","../../../core/lang","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","./ChartMediaInfoValueSeries"],(function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends r{constructor(e){super(e),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new l({colors:i.clone(this.colors),fields:i.clone(this.fields),normalizeField:this.normalizeField,series:i.clone(this.series),tooltipField:this.tooltipField})}};return e.__decorate([o.property({type:[t],json:{type:[[s.Integer]],write:!0}})],c.prototype,"colors",void 0),e.__decorate([o.property({type:[String],json:{write:{isRequired:!0}}})],c.prototype,"fields",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],c.prototype,"normalizeField",void 0),e.__decorate([o.property({type:[a],json:{read:!1}})],c.prototype,"series",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],c.prototype,"tooltipField",void 0),c=l=e.__decorate([n.subclass("esri.popup.content.support.ChartMediaInfoValue")],c),c}))},"esri/popup/content/support/ChartMediaInfoValueSeries":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t{constructor(e){super(e),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new a({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};return e.__decorate([r.property()],l.prototype,"color",void 0),e.__decorate([r.property()],l.prototype,"fieldName",void 0),e.__decorate([r.property()],l.prototype,"tooltip",void 0),e.__decorate([r.property()],l.prototype,"value",void 0),l=a=e.__decorate([n.subclass("esri.popup.content.support.ChartMediaInfoValueSeries")],l),l}))},"esri/popup/content/support/chartMediaInfoUtils":function(){define(["exports","../../../core/jsonMap"],(function(e,t){"use strict";const r=t.strict()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});e.chartTypeKebabDict=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/popup/content/ColumnChartMediaInfo":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./mixins/ChartMediaInfo","./support/chartMediaInfoUtils"],(function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.type="column-chart"}clone(){return new l({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};return e.__decorate([t.property({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:a.chartTypeKebabDict.write,isRequired:!0}}})],c.prototype,"type",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.ColumnChartMediaInfo")],c),c}))},"esri/popup/content/ImageMediaInfo":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./mixins/MediaInfo","./support/ImageMediaInfoValue"],(function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new l({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};return e.__decorate([t.property({type:Number,json:{write:!0}})],c.prototype,"refreshInterval",void 0),e.__decorate([t.property({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],c.prototype,"type",void 0),e.__decorate([t.property({type:a,json:{write:{isRequired:!0}}})],c.prototype,"value",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.ImageMediaInfo")],c),c}))},"esri/popup/content/support/ImageMediaInfoValue":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new a({linkURL:this.linkURL,sourceURL:this.sourceURL})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"linkURL",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],l.prototype,"sourceURL",void 0),l=a=e.__decorate([n.subclass("esri.popup.content.support.ImageMediaInfoValue")],l),l}))},"esri/popup/content/LineChartMediaInfo":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./mixins/ChartMediaInfo","./support/chartMediaInfoUtils"],(function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.type="line-chart"}clone(){return new l({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};return e.__decorate([t.property({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:a.chartTypeKebabDict.write,isRequired:!0}}})],c.prototype,"type",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.LineChartMediaInfo")],c),c}))},"esri/popup/content/PieChartMediaInfo":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./mixins/ChartMediaInfo","./support/chartMediaInfoUtils"],(function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.type="pie-chart"}clone(){return new l({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};return e.__decorate([t.property({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:a.chartTypeKebabDict.write,isRequired:!0}}})],c.prototype,"type",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.PieChartMediaInfo")],c),c}))},"esri/popup/content/support/mediaInfoTypes":function(){define(["exports","../BarChartMediaInfo","../ColumnChartMediaInfo","../ImageMediaInfo","../LineChartMediaInfo","../PieChartMediaInfo","../mixins/MediaInfo"],(function(e,t,r,i,o,s,n){"use strict";const a={base:n,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":t,"column-chart":r,"line-chart":o,"pie-chart":s,image:i}};e.types=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/popup/content/RelationshipContent":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./Content","../support/RelatedRecordsInfoFieldOrder"],(function(e,t,r,i,o,s,n,a,l){"use strict";let c=class extends(t.ClonableMixin(a)){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};return e.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"description",void 0),e.__decorate([r.property({type:Number,json:{type:i.Integer,write:!0}})],c.prototype,"displayCount",void 0),e.__decorate([r.property({type:["list"],json:{write:{isRequired:!0}}})],c.prototype,"displayType",void 0),e.__decorate([r.property({type:[l],json:{write:!0}})],c.prototype,"orderByFields",void 0),e.__decorate([r.property({type:Number,json:{type:i.Integer,write:{isRequired:!0}}})],c.prototype,"relationshipId",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"title",void 0),e.__decorate([r.property({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],c.prototype,"type",void 0),c=e.__decorate([n.subclass("esri.popup.content.RelationshipContent")],c),c}))},"esri/popup/support/RelatedRecordsInfoFieldOrder":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t{constructor(e){super(e),this.field=null,this.order=null}clone(){return new a({field:this.field,order:this.order})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"field",void 0),e.__decorate([r.property({type:["asc","desc"],json:{write:!0}})],l.prototype,"order",void 0),l=a=e.__decorate([n.subclass("esri.popup.support.RelatedRecordsInfoFieldOrder")],l),l}))},"esri/popup/content/TextContent":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./Content"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends n{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new a({text:this.text})}};return e.__decorate([t.property({type:String,json:{write:!0}})],l.prototype,"text",void 0),e.__decorate([t.property({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],l.prototype,"type",void 0),l=a=e.__decorate([s.subclass("esri.popup.content.TextContent")],l),l}))},"esri/popup/content/UtilityNetworkAssociationsContent":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./Content","../support/UtilityNetworkAssociationType"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";let u=class extends(t.ClonableMixin(l)){constructor(e){super(e),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};return e.__decorate([r.property({type:String,json:{write:!0}})],u.prototype,"description",void 0),e.__decorate([r.property({type:Number,json:{type:i.Integer,write:!0}})],u.prototype,"displayCount",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],u.prototype,"title",void 0),e.__decorate([r.property({type:[c],json:{write:!0}})],u.prototype,"associationTypes",void 0),e.__decorate([n.enumeration({utilityNetworkAssociations:"utility-network-associations"})],u.prototype,"type",void 0),u=e.__decorate([a.subclass("esri.popup.content.UtilityNetworkAssociationsContent")],u),u}))},"esri/popup/support/UtilityNetworkAssociationType":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";let l=class extends(t.ClonableMixin(r)){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};return e.__decorate([i.property({type:String,json:{write:!0}})],l.prototype,"title",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],l.prototype,"description",void 0),e.__decorate([i.property({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],l.prototype,"type",void 0),e.__decorate([i.property({type:Number,json:{type:o.Integer,write:!0}})],l.prototype,"associatedNetworkSourceId",void 0),e.__decorate([i.property({type:Number,json:{type:o.Integer,write:!0}})],l.prototype,"associatedAssetGroup",void 0),e.__decorate([i.property({type:Number,json:{type:o.Integer,write:!0}})],l.prototype,"associatedAssetType",void 0),l=e.__decorate([a.subclass("esri.popup.support.UtilityNetworkAssociationType")],l),l}))},"esri/popup/ExpressionInfo":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new a({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"name",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"title",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"expression",void 0),e.__decorate([r.property({type:["string","number"],json:{write:!0}})],l.prototype,"returnType",void 0),l=a=e.__decorate([n.subclass("esri.popup.ExpressionInfo")],l),l}))},"esri/popup/LayerOptions":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new a({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};return e.__decorate([r.property({type:Boolean,json:{write:!0}})],l.prototype,"returnTopmostRaster",void 0),e.__decorate([r.property({type:Boolean,json:{write:!0}})],l.prototype,"showNoDataRecords",void 0),l=a=e.__decorate([n.subclass("esri.popup.LayerOptions")],l),l}))},"esri/popup/RelatedRecordsInfo":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/subclass","./support/RelatedRecordsInfoFieldOrder"],(function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends t{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new l({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?r.clone(this.orderByFields):null})}};return e.__decorate([i.property({type:Boolean,json:{write:!0}})],c.prototype,"showRelatedRecords",void 0),e.__decorate([i.property({type:[a],json:{write:!0}})],c.prototype,"orderByFields",void 0),c=l=e.__decorate([n.subclass("esri.popup.RelatedRecordsInfo")],c),c}))},"esri/support/actions/ActionBase":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/Identifiable","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends(r.IdentifiableMixin(t)){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new l({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};return e.__decorate([i.property()],c.prototype,"active",void 0),e.__decorate([i.property()],c.prototype,"className",void 0),e.__decorate([i.property()],c.prototype,"disabled",void 0),e.__decorate([i.property()],c.prototype,"icon",void 0),e.__decorate([i.property()],c.prototype,"id",void 0),e.__decorate([i.property()],c.prototype,"indicator",void 0),e.__decorate([i.property()],c.prototype,"title",void 0),e.__decorate([i.property()],c.prototype,"type",void 0),e.__decorate([i.property()],c.prototype,"visible",void 0),c=l=e.__decorate([a.subclass("esri.support.actions.ActionBase")],c),c}))},"esri/core/Identifiable":function(){define(["../chunks/tslib.es6","./accessorSupport/decorators/subclass"],(function(e,t){"use strict";let r=0;const i=i=>{let o=class extends i{constructor(...e){super(...e),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+r++})}};return o=e.__decorate([t.subclass("esri.core.Identifiable")],o),o},o=i=>{let o=class extends i{constructor(...e){super(...e),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:r++})}};return o=e.__decorate([t.subclass("esri.core.Identifiable.NumericIdentifiable")],o),o};let s=class extends(i(class{})){};return s=e.__decorate([t.subclass("esri.core.Identifiable")],s),function(e){e.IdentifiableMixin=i,e.NumericIdentifiableMixin=o}(s||(s={})),s}))},"esri/support/actions/ActionButton":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./ActionBase"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends n{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new a({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};return e.__decorate([t.property()],l.prototype,"image",void 0),l=a=e.__decorate([s.subclass("esri.support.actions.ActionButton")],l),l}))},"esri/support/actions/ActionToggle":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./ActionBase"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends n{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new a({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};return e.__decorate([t.property()],l.prototype,"image",void 0),e.__decorate([t.property()],l.prototype,"value",void 0),l=a=e.__decorate([s.subclass("esri.support.actions.ActionToggle")],l),l}))},"esri/symbols/support/typeUtils":function(){define(["exports","../../core/accessorSupport/ensureType","../../core/accessorSupport/extensions/serializableProperty/reader","../CIMSymbol","../LabelSymbol3D","../LineSymbol3D","../MeshSymbol3D","../PictureFillSymbol","../PictureMarkerSymbol","../PointSymbol3D","../PolygonSymbol3D","../SimpleFillSymbol","../SimpleLineSymbol","../SimpleMarkerSymbol","../Symbol","../TextSymbol","../WebStyleSymbol"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";const g={base:f,key:"type",typeMap:{"simple-fill":d,"picture-fill":a,"picture-marker":l,"simple-line":p,"simple-marker":h,text:m,"label-3d":o,"line-3d":s,"mesh-3d":n,"point-3d":c,"polygon-3d":u,"web-style":y,cim:i},errorContext:"symbol"},b={base:f,key:"type",typeMap:{"simple-fill":d,cim:i},errorContext:"symbol"},v={base:f,key:"type",typeMap:{"picture-marker":l,"simple-marker":h,"point-3d":c,cim:i},errorContext:"symbol"},S={base:f,key:"type",typeMap:{"simple-line":p,"line-3d":s,cim:i},errorContext:"symbol"},_={base:f,key:"type",typeMap:{"simple-fill":d,"picture-fill":a,"polygon-3d":u,cim:i},errorContext:"symbol"},x={base:f,key:"type",typeMap:{"picture-marker":l,"simple-marker":h,text:m,"web-style":y,cim:i},errorContext:"symbol"},w=r.createTypeReader({types:g}),T={base:f,key:"type",typeMap:{"simple-fill":d,"picture-fill":a,"picture-marker":l,"simple-line":p,"simple-marker":h,text:m,"line-3d":s,"mesh-3d":n,"point-3d":c,"polygon-3d":u,"web-style":y,cim:i},errorContext:"symbol"},M={base:f,key:"type",typeMap:{text:m,"label-3d":o},errorContext:"symbol"},I={base:f,key:"type",typeMap:{"label-3d":o,"line-3d":s,"mesh-3d":n,"point-3d":c,"polygon-3d":u,"web-style":y},errorContext:"symbol"},P={base:f,key:"type",typeMap:{"line-3d":s,"mesh-3d":n,"point-3d":c,"polygon-3d":u,"web-style":y,cim:i},errorContext:"symbol"},O={base:f,key:"type",typeMap:{"label-3d":o},errorContext:"symbol"},C=t.ensureOneOfType(g);e.ensureType=C,e.isSymbol=function(e){return e instanceof f},e.isSymbol2D=function(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}},e.isSymbol3D=function(e){switch(e?.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}},e.lineSymbolTypes=S,e.pointSymbolTypes=v,e.polygonSymbolTypes=_,e.readSymbol=w,e.simpleFillAndCIMSymbolTypes=b,e.symbolTypes=g,e.symbolTypes3D=I,e.symbolTypesCluster=x,e.symbolTypesLabel=M,e.symbolTypesLabel3D=O,e.symbolTypesRenderer=T,e.symbolTypesRenderer3D=P,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/CIMSymbol":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/string","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../layers/support/fieldUtils","./Symbol"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;return e.default=h=class extends p{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){Object.assign(t,e)}async collectRequiredFields(e,t){if("CIMSymbolReference"===this.data?.type){const r=this.data.primitiveOverrides;if(r){const i=r.map((r=>{const i=r.valueExpressionInfo;return i?d.collectArcadeFieldNames(e,t,i.expression):null}));await Promise.all(i)}}}clone(){return new h({data:r.clone(this.data)})}hash(){return i.numericHash(JSON.stringify(this.data)).toString()}},t.__decorate([o.property({json:{write:!1}})],e.default.prototype,"color",void 0),t.__decorate([o.property({json:{write:!0}})],e.default.prototype,"data",void 0),t.__decorate([l.reader("data",["symbol"])],e.default.prototype,"readData",null),t.__decorate([u.writer("data",{})],e.default.prototype,"writeData",null),t.__decorate([a.enumeration({CIMSymbolReference:"cim"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=h=t.__decorate([c.subclass("esri.symbols.CIMSymbol")],e.default),e.default}))},"esri/symbols/Symbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/jsonMap","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";const d=new i.JSONMap({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let p=0;return e.default=class extends o{constructor(e){super(e),this.id="sym"+p++,this.type=null,this.color=new r([0,0,0,1])}readColor(e){return null!=e?.[0]?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}},t.__decorate([s.property({type:d.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:d.write,isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:r,json:{write:{allowNull:!0}}})],e.default.prototype,"color",void 0),t.__decorate([c.reader("color")],e.default.prototype,"readColor",null),e.default=t.__decorate([u.subclass("esri.symbols.Symbol")],e.default),e.default}))},"esri/symbols/LabelSymbol3D":function(){define(["exports","../chunks/tslib.es6","../core/Collection","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3D","./TextSymbol3DLayer","./callouts/calloutUtils","./support/Symbol3DVerticalOffset"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;const f=r.ofType({base:null,key:"type",typeMap:{text:u}});return e.default=h=class extends c{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new f,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return d.hasVisibleCallout(this)}hasVisibleVerticalOffset(){return d.hasVisibleVerticalOffset(this)}clone(){return new h({styleOrigin:i.clone(this.styleOrigin),symbolLayers:i.clone(this.symbolLayers),thumbnail:i.clone(this.thumbnail),callout:i.clone(this.callout),verticalOffset:i.clone(this.verticalOffset)})}static fromTextSymbol(e){return new h({symbolLayers:new r([u.fromTextSymbol(e)])})}},t.__decorate([o.property({type:p,json:{write:!0}})],e.default.prototype,"verticalOffset",void 0),t.__decorate([o.property(d.calloutProperty)],e.default.prototype,"callout",void 0),t.__decorate([o.property({json:{read:!1,write:!1}})],e.default.prototype,"styleOrigin",void 0),t.__decorate([o.property({type:f})],e.default.prototype,"symbolLayers",void 0),t.__decorate([a.enumeration({LabelSymbol3D:"label-3d"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=h=t.__decorate([l.subclass("esri.symbols.LabelSymbol3D")],e.default),e.default}))},"esri/symbols/Symbol3D":function(){define(["exports","../chunks/tslib.es6","../core/Collection","../core/collectionUtils","../core/Logger","../core/urlUtils","../core/Warning","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../portal/Portal","../chunks/persistableUrlUtils","./ExtrudeSymbol3DLayer","./FillSymbol3DLayer","./IconSymbol3DLayer","./LineSymbol3DLayer","./ObjectSymbol3DLayer","./PathSymbol3DLayer","./Symbol","./Symbol3DLayer","./TextSymbol3DLayer","./WaterSymbol3DLayer","./support/StyleOrigin","./support/Thumbnail"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x,w,T,M,I,P){"use strict";const O={icon:b,object:S,line:v,path:_,fill:g,extrude:y,text:T,water:M},C=r.ofType({base:w,key:"type",typeMap:O,errorContext:"symbol-layer"});return e.default=class extends x{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,i=t?.type,o=i||r;this._set("symbolLayers",new o)}get color(){return null}set color(e){this.constructed&&o.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){i.referenceSetter(e,this._get("symbolLayers"))}readStyleOrigin(e,t,r){if(e.styleUrl&&e.name){const t=m.fromJSON(e.styleUrl,r);return new I({styleUrl:t,name:e.name})}if(e.styleName&&e.name)return new I({portal:r?.portal||f.getDefault(),styleName:e.styleName,name:e.name});r?.messages&&r.messages.push(new n("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,t,r,i){if(e.styleUrl&&e.name){let r=m.toJSON(e.styleUrl,i);s.isAbsolute(r)&&(r=s.normalize(r)),t.styleOrigin={styleUrl:r,name:e.name}}else e.styleName&&e.name&&(e.portal&&i?.portal&&!s.hasSamePortal(e.portal.restUrl,i.portal.restUrl)?i?.messages&&i.messages.push(new n("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof w||e&&O[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}},t.__decorate([a.property({json:{read:!1,write:!1}})],e.default.prototype,"color",null),t.__decorate([a.property({type:C,nonNullable:!0,json:{write:!0}}),l.cast(i.castForReferenceSetter)],e.default.prototype,"symbolLayers",null),t.__decorate([a.property({type:I})],e.default.prototype,"styleOrigin",void 0),t.__decorate([d.reader("styleOrigin")],e.default.prototype,"readStyleOrigin",null),t.__decorate([h.writer("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],e.default.prototype,"writeStyleOrigin",null),t.__decorate([a.property({type:P.Thumbnail,json:{read:!1}})],e.default.prototype,"thumbnail",void 0),t.__decorate([a.property({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([p.subclass("esri.symbols.Symbol3D")],e.default),e.default}))},"esri/core/collectionUtils":function(){define(["exports","./Collection"],(function(e,t){"use strict";e.castForReferenceSetter=function(e){return e},e.referenceSetter=function(e,r,i=t){return r||(r=new i),r===e||(r.removeAll(),function(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}(e)?r.addMany(e):e&&r.add(e)),r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/portal/Portal":function(){define(["require","exports","../chunks/tslib.es6","../config","../kernel","../request","../core/Error","../core/JSONSupport","../core/Loadable","../core/maybe","../core/promiseUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../geometry/Extent","../intl/locale","./portalDefault","./PortalGroup","./PortalQueryParams","./PortalQueryResult","./PortalUser","../support/apiKeyUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x,w,T){"use strict";const M=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));var I;let P;const O={PortalGroup:()=>Promise.resolve({default:S}),PortalItem:()=>new Promise(((t,r)=>e(["./PortalItem"],(e=>t(M(e))),r))),PortalUser:()=>Promise.resolve({default:w})};t.default=class extends(a.JSONSupportMixin(l)){static{I=this}static{this.AUTH_MODE_ANONYMOUS="anonymous"}static{this.AUTH_MODE_AUTO="auto"}static{this.AUTH_MODE_IMMEDIATE="immediate"}static{this.AUTH_MODE_NO_PROMPT="no-prompt"}constructor(e){super(e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.default3DBasemapQuery=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.hasClassificationSchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=i.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useDefault3dBasemap=!1,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return"string"==typeof e?{url:e}:e}destroy(){C.unregister(this),this.defaultBasemap=c.destroyMaybe(this.defaultBasemap),this.defaultDevBasemap=c.destroyMaybe(this.defaultDevBasemap),this.defaultVectorBasemap=c.destroyMaybe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=c.removeMaybe(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)i.request.trustedServers.includes(t)||i.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=this.user?.orgId,t=!e||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get hasAPIKey(){return T.isApiKeyApplicable(this.restUrl)}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.slice(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e?e.toLowerCase():e}readUser(e){let t=null;return e&&(t=w.fromJSON(e),t.portal=this),t}load(t){const r=new Promise(((t,r)=>e(["../Basemap"],(e=>t(M(e))),r))).then((({default:e})=>{u.throwIfAborted(t),P=e})).then((()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t))).then((e=>{if(!this.hasAPIKey&&o.id){const e=o.id;this.credential=e.findCredential(this.restUrl),this.credential||this.authMode!==I.AUTH_MODE_AUTO&&this.authMode!==I.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=e.on("credential-create",function(e){const t=o.id;return()=>{const r=e.deref();r&&t.findCredential(r.restUrl)&&r.signIn().catch((()=>{}))}}(new WeakRef(this))),C.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(r),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),r=(await new Promise(((t,r)=>e(["../layers/ElevationLayer"],(e=>t(M(e))),r)))).default;return t?t.map((e=>new r({id:e.id,url:e.url}))):[]}async fetchBasemaps(e,t){const r=await this._fetchBasemaps(e,t);if(!0===t?.include3d&&!1!==this.use3dBasemaps){const i=await this._fetchBasemaps3D(e,t);r.unshift(...i)}return r}async fetchDefault3DBasemap(e){if(!this.useDefault3dBasemap||!this.default3DBasemapQuery||"none"===this.default3DBasemapQuery)return null;const t=new _;t.query=this.default3DBasemapQuery,t.disableExtraQuery=!0;const r=(await this.queryItems(t,e)).results.find((e=>"Web Scene"===e.type));return r?new P({portalItem:r}):null}fetchCategorySchema(e){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",e).then((e=>e.categorySchema)):u.isAborted(e)?Promise.reject(u.createAbortError()):Promise.resolve([])}async fetchClassificationSchema(e){return this.hasClassificationSchema?this.request(this.restUrl+"/portals/self/classification/classificationSchema",e).then((e=>e.classificationSchema)):null}fetchFeaturedGroups(e){const t=this.featuredGroups,r=new _({num:100,sortField:"title"});if(t?.length){const i=[];for(const e of t)i.push(`(title:"${e.title}" AND owner:${e.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,e).then((e=>e.results))}return u.isAborted(e)?Promise.reject(u.createAbortError()):Promise.resolve([])}fetchRegions(e){const t=this.user?.culture||this.culture||b.getLocale();return this.request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){const t=this.user?.culture||this.culture||b.getLocale();return this.request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return v.ensureDefaultPortalInstance((()=>new I))}queryGroups(e,t){return this.queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this.queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this.queryPortal("/community/users",e,"PortalUser",t)}fetchSelf(e=this.authMode,t=!1,r){const i=this.restUrl+"/portals/self",o={authMode:e,query:{culture:b.getLocale().toLowerCase()},withCredentials:!0,...r};return"auto"===o.authMode&&(o.authMode="no-prompt"),t&&(o.query.default=!0),this.request(i,o)}queryPortal(e,t,r,i){const o=p.ensureType(_,t),s=t=>this.request(this.restUrl+e,{...o.toRequestOptions(this),...i}).then((e=>{const r=o.clone();return r.start=e.nextStart,new x({nextQueryParams:r,queryParams:o,total:e.total,results:I._resultsToTypedArray(t,{portal:this},e,i)})})).then((e=>Promise.all(e.results.map((t=>"function"==typeof t.when?t.when():e))).then((()=>e),(t=>(u.throwIfAbortError(t),e)))));return r&&O[r]?O[r]().then((({default:e})=>(u.throwIfAborted(i),s(e)))):s()}signIn(){if(this.hasAPIKey)return this.load().then((()=>{if(!this.user)throw new n("portal:not-authenticated","Unable to authenticate user. Portal.user is missing")}));if(this.authMode===I.AUTH_MODE_ANONYMOUS||this.authMode===I.AUTH_MODE_NO_PROMPT&&!o.id)return Promise.reject(new n("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const e=e=>Promise.resolve().then((()=>"not-loaded"===this.loadStatus?(e||(this.authMode="immediate"),this.load().then((()=>null))):"loading"===this.loadStatus?this.load().then((()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate")))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate")))).then((e=>{e&&(this.sourceJSON=e,this.read(e))}));return o.id?o.id.getCredential(this.restUrl,{prompt:this.authMode!==I.AUTH_MODE_NO_PROMPT}).then((t=>e(t))):e(this.credential)}normalizeUrl(e){const t=this.credential?.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}requestToTypedArray(e,t,r){return this.request(e,t).then((e=>{const t=I._resultsToTypedArray(r,{portal:this},e);return Promise.all(t.map((t=>"function"==typeof t.when?t.when():e))).then((()=>t),(()=>t))}))}request(e,t={}){const r={f:"json",...t.query},{authMode:i=(this.authMode===I.AUTH_MODE_ANONYMOUS||this.authMode===I.AUTH_MODE_NO_PROMPT?this.authMode:"auto"),body:o=null,cacheBust:n=!1,method:a="auto",responseType:l="json",signal:c}=t,u={authMode:i,body:o,cacheBust:n,method:a,query:r,responseType:l,timeout:0,signal:c};return t.withCredentials&&(u.withCredentials=!0),s(this._normalizeSSL(e),u).then((e=>e.data))}toJSON(){throw new n("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new I({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new n("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}async _fetchBasemaps(e,t){const r=new _;r.query=e||(T.hasBasemapStylesApiKey()?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,t);if(!i.total)return[];const o=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=o.sortField||"name",r.sortOrder=o.sortOrder||"desc";const s=await o.queryItems(r,t);return s.total?s.results.filter((e=>"Web Map"===e.type)).map((e=>new P({portalItem:e}))):[]}async _fetchBasemaps3D(e,t){const r=e||this.basemapGalleryGroupQuery3D;if(!r)return[];if(T.hasBasemapStylesApiKey())return[];const i=new _({query:r,disableExtraQuery:!0}),o=await this.queryGroups(i,t);if(!o.total)return[];const s=o.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(i,t);return n.total?n.results.filter((e=>"Web Scene"===e.type)).map((e=>new P({portalItem:e}))):[]}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(e){if(e){const t=P.fromJSON(e);return t.portalItem={portal:this},t}return null}static _resultsToTypedArray(e,t,r,i){let o;if(r){const s=null!=i?i.signal:null;o=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||t)&&(o=o.map((r=>{const i=Object.assign(e?e.fromJSON(r):r,t);return"function"==typeof i.load&&i.load(s),i})))}else o=[];return o}},r.__decorate([d.property()],t.default.prototype,"access",void 0),r.__decorate([d.property()],t.default.prototype,"allSSL",void 0),r.__decorate([d.property()],t.default.prototype,"authMode",void 0),r.__decorate([d.property()],t.default.prototype,"authorizedCrossOriginDomains",void 0),r.__decorate([m.reader("authorizedCrossOriginDomains")],t.default.prototype,"readAuthorizedCrossOriginDomains",null),r.__decorate([d.property()],t.default.prototype,"basemapGalleryGroupQuery",void 0),r.__decorate([d.property({json:{name:"3DBasemapGalleryGroupQuery"}})],t.default.prototype,"basemapGalleryGroupQuery3D",void 0),r.__decorate([d.property()],t.default.prototype,"bingKey",void 0),r.__decorate([d.property()],t.default.prototype,"canListApps",void 0),r.__decorate([d.property()],t.default.prototype,"canListData",void 0),r.__decorate([d.property()],t.default.prototype,"canListPreProvisionedItems",void 0),r.__decorate([d.property()],t.default.prototype,"canProvisionDirectPurchase",void 0),r.__decorate([d.property()],t.default.prototype,"canSearchPublic",void 0),r.__decorate([d.property()],t.default.prototype,"canShareBingPublic",void 0),r.__decorate([d.property()],t.default.prototype,"canSharePublic",void 0),r.__decorate([d.property()],t.default.prototype,"canSignInArcGIS",void 0),r.__decorate([d.property()],t.default.prototype,"canSignInIDP",void 0),r.__decorate([d.property()],t.default.prototype,"colorSetsGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"commentsEnabled",void 0),r.__decorate([d.property({type:Date})],t.default.prototype,"created",void 0),r.__decorate([d.property()],t.default.prototype,"credential",void 0),r.__decorate([d.property()],t.default.prototype,"culture",void 0),r.__decorate([d.property()],t.default.prototype,"currentVersion",void 0),r.__decorate([d.property()],t.default.prototype,"customBaseUrl",void 0),r.__decorate([d.property()],t.default.prototype,"default3DBasemapQuery",void 0),r.__decorate([d.property()],t.default.prototype,"defaultBasemap",void 0),r.__decorate([m.reader("defaultBasemap")],t.default.prototype,"readDefaultBasemap",null),r.__decorate([d.property()],t.default.prototype,"defaultDevBasemap",void 0),r.__decorate([m.reader("defaultDevBasemap")],t.default.prototype,"readDefaultDevBasemap",null),r.__decorate([d.property({type:g})],t.default.prototype,"defaultExtent",void 0),r.__decorate([d.property()],t.default.prototype,"defaultVectorBasemap",void 0),r.__decorate([m.reader("defaultVectorBasemap")],t.default.prototype,"readDefaultVectorBasemap",null),r.__decorate([d.property()],t.default.prototype,"description",void 0),r.__decorate([d.property()],t.default.prototype,"devBasemapGalleryGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"eueiEnabled",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"extraQuery",null),r.__decorate([d.property()],t.default.prototype,"featuredGroups",void 0),r.__decorate([d.property()],t.default.prototype,"featuredItemsGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"galleryTemplatesGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"layoutGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"livingAtlasGroupQuery",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"hasAPIKey",null),r.__decorate([d.property()],t.default.prototype,"hasCategorySchema",void 0),r.__decorate([d.property()],t.default.prototype,"hasClassificationSchema",void 0),r.__decorate([d.property()],t.default.prototype,"helpBase",void 0),r.__decorate([d.property()],t.default.prototype,"helperServices",void 0),r.__decorate([d.property()],t.default.prototype,"helpMap",void 0),r.__decorate([d.property()],t.default.prototype,"homePageFeaturedContent",void 0),r.__decorate([d.property()],t.default.prototype,"homePageFeaturedContentCount",void 0),r.__decorate([d.property()],t.default.prototype,"httpPort",void 0),r.__decorate([d.property()],t.default.prototype,"httpsPort",void 0),r.__decorate([d.property()],t.default.prototype,"id",void 0),r.__decorate([d.property()],t.default.prototype,"ipCntryCode",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"isOrganization",null),r.__decorate([d.property()],t.default.prototype,"isPortal",void 0),r.__decorate([d.property()],t.default.prototype,"isReadOnly",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"itemPageUrl",null),r.__decorate([d.property()],t.default.prototype,"layerTemplatesGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"maxTokenExpirationMinutes",void 0),r.__decorate([d.property({type:Date})],t.default.prototype,"modified",void 0),r.__decorate([d.property()],t.default.prototype,"name",void 0),r.__decorate([d.property()],t.default.prototype,"portalHostname",void 0),r.__decorate([d.property()],t.default.prototype,"portalMode",void 0),r.__decorate([d.property()],t.default.prototype,"portalProperties",void 0),r.__decorate([d.property()],t.default.prototype,"region",void 0),r.__decorate([d.property()],t.default.prototype,"recycleBinEnabled",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"restUrl",null),r.__decorate([d.property()],t.default.prototype,"rotatorPanels",void 0),r.__decorate([d.property()],t.default.prototype,"showHomePageDescription",void 0),r.__decorate([d.property()],t.default.prototype,"sourceJSON",void 0),r.__decorate([d.property()],t.default.prototype,"staticImagesUrl",void 0),r.__decorate([d.property({json:{name:"2DStylesGroupQuery"}})],t.default.prototype,"stylesGroupQuery2d",void 0),r.__decorate([d.property({json:{name:"stylesGroupQuery"}})],t.default.prototype,"stylesGroupQuery3d",void 0),r.__decorate([d.property()],t.default.prototype,"supportsHostedServices",void 0),r.__decorate([d.property()],t.default.prototype,"symbolSetsGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"templatesGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"thumbnail",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"thumbnailUrl",null),r.__decorate([d.property()],t.default.prototype,"units",void 0),r.__decorate([d.property()],t.default.prototype,"url",void 0),r.__decorate([d.property()],t.default.prototype,"urlKey",void 0),r.__decorate([m.reader("urlKey")],t.default.prototype,"readUrlKey",null),r.__decorate([d.property()],t.default.prototype,"user",void 0),r.__decorate([m.reader("user")],t.default.prototype,"readUser",null),r.__decorate([d.property()],t.default.prototype,"use3dBasemaps",void 0),r.__decorate([d.property()],t.default.prototype,"useDefault3dBasemap",void 0),r.__decorate([d.property()],t.default.prototype,"useStandardizedQuery",void 0),r.__decorate([d.property()],t.default.prototype,"useVectorBasemaps",void 0),r.__decorate([d.property()],t.default.prototype,"vectorBasemapGalleryGroupQuery",void 0),t.default=I=r.__decorate([y.subclass("esri.portal.Portal")],t.default);const C=new FinalizationRegistry((e=>{e.remove()}));return t.default}))},"esri/core/Loadable":function(){define(["exports","../chunks/tslib.es6","./Error","./maybe","./Promise","./promiseUtils","./Warning","./accessorSupport/decorators/property","./accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l){"use strict";const c="loaded",u=e=>{let o=class extends e{constructor(...e){super(...e),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise((e=>{const t=this.load.bind(this);this.load=i=>{const o=new Promise(((e,t)=>{const o=s.onAbortOrThrow(i,t);this.destroyed&&t(new r("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(e,t).finally((()=>{o&&o.remove()}))}));if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const e=this._loadController=new AbortController;t({signal:e.signal})}return e(),o}}))),this.when((()=>{this._set("loadStatus",c),this._loadController=null}),(e=>{this._set("loadStatus","failed"),this._set("loadError",e),this._loadController=null}))}destroy(){this._loadController&&(this._loadController=i.abortMaybe(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===c}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new r("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return t.__decorate([a.property({readOnly:!0})],o.prototype,"loaded",null),t.__decorate([a.property({readOnly:!0})],o.prototype,"loadError",void 0),t.__decorate([a.property({clonable:!1})],o.prototype,"loadStatus",void 0),t.__decorate([a.property({type:[n],readOnly:!0})],o.prototype,"loadWarnings",null),o=t.__decorate([l.subclass("esri.core.Loadable")],o),o};var d;return e.default=class extends(u(o)){},e.default=t.__decorate([l.subclass("esri.core.Loadable")],e.default),(d=e.default||(e.default={})).LoadableMixin=u,d.isLoadable=function(e){return!(!e||!e.load)},e.default}))},"esri/core/Promise":function(){define(["exports","../chunks/tslib.es6","./Accessor","./promiseUtils","./accessorSupport/decorators/subclass"],(function(e,t,r,i,o){"use strict";var s;!function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"}(s||(s={}));class n{constructor(){this._resolver=i.createResolver(),this._status=s.PENDING,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=s.RESOLVED,this._cleanUp()}),(()=>{this._status=s.REJECTED,this._cleanUp()})),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===s.RESOLVED}isRejected(){return this._status===s.REJECTED}isFulfilled(){return this._status!==s.PENDING}abort(){this._resolver.reject(i.createAbortError())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=i.createResolver(),t=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(t);r.then((()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()}),(e=>{this.isFulfilled()||this._allPromise!==r||i.isAbortError(e)||this._resolver.reject(e)})),e.resolve()}}const a=e=>{let r=class extends e{constructor(...e){super(...e),this._promiseProps=new n,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(e,t){return this._promiseProps.promise.then((()=>this)).then(e,t)}catch(e){return this.when(null,e)}addResolvingPromise(e){e&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in e?e.when():e)}};return r=t.__decorate([o.subclass("esri.core.Promise")],r),r};return e.default=class extends(a(r)){},e.default=t.__decorate([o.subclass("esri.core.Promise")],e.default),(e.default||(e.default={})).EsriPromiseMixin=a,e.default}))},"esri/portal/portalDefault":function(){define(["exports"],(function(e){"use strict";let t;e.clearDefaultPortalInstance=function(){t=void 0},e.ensureDefaultPortalInstance=function(e){return t&&!t.destroyed||(t=e()),t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/portal/PortalGroup":function(){define(["exports","../chunks/tslib.es6","../core/Error","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./PortalQueryParams"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;return e.default=u=class extends i{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t&&this.portal?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.portal?.restUrl;return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal.request(this.url+"/categorySchema",e).then((t=>{const r=t.categorySchema||[];return r.some((e=>"contentCategorySetsGroupQuery.LivingAtlas"===e.source))?this._fetchCategorySchemaSet("LivingAtlas",e):r}))}fetchMembers(e){return this.portal.request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new r("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new u({sourceJSON:e});return t.read(e),t}queryItems(e,t){let r=s.ensureType(c,e);const i=this.portal;return parseFloat(i.currentVersion)>5?(r=r||new c,i.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",t)):(r=r?r.clone():new c,r.query="group:"+this.id+(r.query?" "+r.query:""),i.queryItems(r,t))}_fetchCategorySchemaSet(e,t){const i=this.portal;return i.fetchSelf(i.authMode,!0,t).then((e=>{const o=e.contentCategorySetsGroupQuery;if(o){const e=new c({disableExtraQuery:!0,num:1,query:o});return i.queryGroups(e,t)}throw new r("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")})).then((i=>{if(i.total){const r=i.results[0],o=new c({num:1,query:`typekeywords:"${e}"`});return r.queryItems(o,t)}throw new r("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")})).then((e=>e.total?e.results[0].fetchData("json",t).then((e=>{const t=e?.categorySchema;return t?.length?t:[]})):[]))}},t.__decorate([o.property()],e.default.prototype,"access",void 0),t.__decorate([o.property({type:Date})],e.default.prototype,"created",void 0),t.__decorate([o.property()],e.default.prototype,"description",void 0),t.__decorate([o.property()],e.default.prototype,"id",void 0),t.__decorate([o.property()],e.default.prototype,"isInvitationOnly",void 0),t.__decorate([o.property({type:Date})],e.default.prototype,"modified",void 0),t.__decorate([o.property()],e.default.prototype,"owner",void 0),t.__decorate([o.property()],e.default.prototype,"portal",void 0),t.__decorate([o.property()],e.default.prototype,"snippet",void 0),t.__decorate([o.property()],e.default.prototype,"sortField",void 0),t.__decorate([o.property()],e.default.prototype,"sortOrder",void 0),t.__decorate([o.property()],e.default.prototype,"sourceJSON",void 0),t.__decorate([o.property()],e.default.prototype,"tags",void 0),t.__decorate([o.property()],e.default.prototype,"thumbnail",void 0),t.__decorate([o.property({readOnly:!0})],e.default.prototype,"thumbnailUrl",null),t.__decorate([o.property()],e.default.prototype,"title",void 0),t.__decorate([o.property({readOnly:!0})],e.default.prototype,"url",null),e.default=u=t.__decorate([l.subclass("esri.portal.PortalGroup")],e.default),e.default}))},"esri/portal/PortalQueryParams":function(){define(["exports","../chunks/tslib.es6","../core/Accessor","../core/jsonMap","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/subclass","../geometry/Extent","../geometry/SpatialReference","../geometry/support/webMercatorUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;const h=new i.JSONMap({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});return e.default=p=class extends r{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){"asc"!==e&&"desc"!==e||this._set("sortOrder",e)}clone(){return new p({categories:this.categories?o.clone(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let r=[];this.categories&&(r=this.categories.map((e=>Array.isArray(e)?JSON.stringify(e):e)));let i="";if(this.extent){const e=d.project(this.extent,u.WGS84);null!=e&&(i=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`)}let o=this.query;!this.disableExtraQuery&&e.extraQuery&&(o="("+o+")"+e.extraQuery);const s={categories:r,bbox:i,q:o,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map((e=>h.toJSON(e.trim()))).join(","),s.sortOrder=this.sortOrder),{query:{...t,...s}}}},t.__decorate([s.property()],e.default.prototype,"categories",void 0),t.__decorate([s.property()],e.default.prototype,"disableExtraQuery",void 0),t.__decorate([s.property({type:c})],e.default.prototype,"extent",void 0),t.__decorate([s.property()],e.default.prototype,"filter",void 0),t.__decorate([s.property()],e.default.prototype,"num",void 0),t.__decorate([s.property()],e.default.prototype,"query",void 0),t.__decorate([s.property()],e.default.prototype,"sortField",void 0),t.__decorate([s.property()],e.default.prototype,"sortOrder",null),t.__decorate([s.property()],e.default.prototype,"start",void 0),e.default=p=t.__decorate([l.subclass("esri.portal.PortalQueryParams")],e.default),e.default}))},"esri/portal/PortalQueryResult":function(){define(["exports","../chunks/tslib.es6","../core/Accessor","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";return e.default=class extends r{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}},t.__decorate([i.property()],e.default.prototype,"nextQueryParams",void 0),t.__decorate([i.property()],e.default.prototype,"queryParams",void 0),t.__decorate([i.property()],e.default.prototype,"results",void 0),t.__decorate([i.property()],e.default.prototype,"total",void 0),e.default=t.__decorate([a.subclass("esri.portal.PortalQueryResult")],e.default),e.default}))},"esri/portal/PortalUser":function(){define(["require","exports","../chunks/tslib.es6","../core/Error","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./PortalFolder","./PortalGroup"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";const p=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));var h;return t.default=h=class extends o{constructor(e){super(e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.id=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal.normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.id}`:null}get url(){const e=this.portal?.restUrl;return e?`${e}/community/users/${this.id}`:null}addItem(e){const t=e&&e.item,r=e?.data,i=e?.folder,o={method:"post"};t&&(o.query=t.createPostQuery(),null!=r&&("string"==typeof r?o.query.text=r:"object"==typeof r&&(o.query.text=JSON.stringify(r))));let s=this.userContentUrl;return i&&(s+="/"+("string"==typeof i?i:i.id)),this.portal.request(s+"/addItem",o).then((e=>(t.id=e.id,t.portal=this.portal,t.loaded?t.reload():t.load())))}async deleteItem(e,t=!1){let r=this.userContentUrl;e.ownerFolder&&(r+="/"+e.ownerFolder);const i=t?{permanentDelete:!0}:{};await this.portal.request(r+`/items/${e.id}/delete`,{method:"post",query:i}),e.id=null,e.portal=null}async deleteItems(e,t=!1){e=e.slice();const r=this.userContentUrl+"/deleteItems",o=[],s=e.map((e=>e.id));if(s.length){const n={method:"post",query:{items:s.join(","),permanentDelete:t}},a=await this.portal.request(r,n);for(const t of a.results){const r=e.find((e=>t.itemId===e.id)),s=t.success;let n=null;s?(r.id=null,r.portal=null):t.error&&(n=new i("portal:delete-item-failed",t.error.message,t.error)),o.push({item:r,success:s,error:n})}}return o}fetchFolders(){return this.portal.request(this.userContentUrl??"",{query:{num:1}}).then((e=>{let t;return t=e&&e.folders?e.folders.map((e=>{const t=u.fromJSON(e);return t.portal=this.portal,t})):[],t}))}fetchGroups(){return this.portal.request(this.url??"").then((e=>{let t;return t=e&&e.groups?e.groups.map((e=>{const t=d.fromJSON(e);return t.portal=this.portal,t})):[],t}))}async fetchItems(t){t??={};let r=this.userContentUrl??"";t.folder&&(r+="/"+t.folder.id);const{default:i}=await new Promise(((t,r)=>e(["./PortalItem"],(e=>t(p(e))),r))),o={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},s=await this.portal.request(r,{query:o});let n;return s?.items?(n=s.items.map((e=>{const t=i.fromJSON(e);return t.portal=this.portal,t})),await Promise.all(n.map((e=>e.load()))),{items:n,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then((e=>e.tags))}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new d({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new i("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(e,t){const r=this.userContentUrl,i=t?{folderID:"string"==typeof t?t:t.id}:null;await this.portal.request(r+`/items/${e.id}/restore`,{method:"post",query:i})}toJSON(){throw new i("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new h({sourceJSON:e});return t.read(e),t}},r.__decorate([s.property()],t.default.prototype,"access",void 0),r.__decorate([s.property({type:Date})],t.default.prototype,"created",void 0),r.__decorate([s.property()],t.default.prototype,"culture",void 0),r.__decorate([s.property()],t.default.prototype,"description",void 0),r.__decorate([s.property()],t.default.prototype,"email",void 0),r.__decorate([s.property()],t.default.prototype,"favGroupId",void 0),r.__decorate([s.property()],t.default.prototype,"fullName",void 0),r.__decorate([s.property()],t.default.prototype,"id",void 0),r.__decorate([s.property({type:Date})],t.default.prototype,"modified",void 0),r.__decorate([s.property()],t.default.prototype,"orgId",void 0),r.__decorate([s.property()],t.default.prototype,"portal",void 0),r.__decorate([s.property()],t.default.prototype,"preferredView",void 0),r.__decorate([s.property()],t.default.prototype,"privileges",void 0),r.__decorate([s.property()],t.default.prototype,"region",void 0),r.__decorate([s.property()],t.default.prototype,"role",void 0),r.__decorate([s.property()],t.default.prototype,"roleId",void 0),r.__decorate([s.property()],t.default.prototype,"sourceJSON",void 0),r.__decorate([s.property()],t.default.prototype,"thumbnail",void 0),r.__decorate([s.property({readOnly:!0})],t.default.prototype,"thumbnailUrl",null),r.__decorate([s.property()],t.default.prototype,"units",void 0),r.__decorate([s.property({readOnly:!0})],t.default.prototype,"userContentUrl",null),r.__decorate([s.property({readOnly:!0})],t.default.prototype,"url",null),r.__decorate([s.property()],t.default.prototype,"username",void 0),r.__decorate([s.property()],t.default.prototype,"userLicenseTypeId",void 0),r.__decorate([s.property()],t.default.prototype,"userType",void 0),t.default=h=r.__decorate([c.subclass("esri.portal.PortalUser")],t.default),t.default}))},"esri/portal/PortalFolder":function(){define(["exports","../chunks/tslib.es6","../core/Error","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l){"use strict";return e.default=class extends i{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new r("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}},t.__decorate([o.property({type:Date})],e.default.prototype,"created",void 0),t.__decorate([o.property()],e.default.prototype,"id",void 0),t.__decorate([o.property()],e.default.prototype,"portal",void 0),t.__decorate([o.property()],e.default.prototype,"title",void 0),t.__decorate([o.property({readOnly:!0})],e.default.prototype,"url",null),t.__decorate([o.property()],e.default.prototype,"username",void 0),e.default=t.__decorate([l.subclass("esri.portal.PortalFolder")],e.default),e.default}))},"esri/symbols/ExtrudeSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3DLayer","./edges/utils","./support/Symbol3DMaterial"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;return e.default=class extends l{static{d=this}constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new d({edges:this.edges?.clone(),enabled:this.enabled,material:this.material?.clone(),castShadows:this.castShadows,size:this.size})}},t.__decorate([n.enumeration({Extrude:"extrude"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],e.default.prototype,"size",void 0),t.__decorate([r.property({type:u.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],e.default.prototype,"castShadows",void 0),t.__decorate([r.property(c.symbol3dEdgesProperty)],e.default.prototype,"edges",void 0),e.default=d=t.__decorate([a.subclass("esri.symbols.ExtrudeSymbol3DLayer")],e.default),e.default}))},"esri/symbols/Symbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer"],(function(e,t,r,i,o,s,n,a,l){"use strict";return e.default=class extends r{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,t,r){e||(t[r]=e)}},t.__decorate([i.property({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],e.default.prototype,"enabled",void 0),t.__decorate([l.writer("enabled")],e.default.prototype,"writeEnabled",null),t.__decorate([i.property({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0,json:{write:{isRequired:!0}}})],e.default.prototype,"type",void 0),e.default=t.__decorate([a.subclass("esri.symbols.Symbol3DLayer")],e.default),e.default}))},"esri/symbols/edges/utils":function(){define(["exports","./Edges3D","./SketchEdges3D","./SolidEdges3D"],(function(e,t,r,i){"use strict";const o={types:{key:"type",base:t,typeMap:{solid:i,sketch:r}},json:{write:!0}};e.symbol3dEdgesProperty=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/edges/Edges3D":function(){define(["../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/lang","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../support/materialUtils"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";let u=class extends r{constructor(e){super(e),this.color=new t([0,0,0,1]),this.extensionLength=0,this.size=o.px2pt(1)}clone(){}cloneProperties(){return{color:i.clone(this.color),size:this.size,extensionLength:this.extensionLength}}};return e.__decorate([s.property({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],u.prototype,"type",void 0),e.__decorate([s.property(c.colorAndTransparencyProperty({colorRequiredOnWrite:!0}))],u.prototype,"color",void 0),e.__decorate([s.property({...c.screenSizeProperty,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],u.prototype,"extensionLength",void 0),e.__decorate([s.property(c.screenSizeProperty)],u.prototype,"size",void 0),u=e.__decorate([l.subclass("esri.symbols.edges.Edges3D")],u),u}))},"esri/symbols/support/materialUtils":function(){define(["exports","../../Color","../../core/screenUtils","../../core/accessorSupport/ensureType","../../webdoc/support/opacityUtils"],(function(e,t,r,i,o){"use strict";function s(e,r){const i=null!=r.transparency?o.transparencyToOpacity(r.transparency):1,s=r.color;return s&&Array.isArray(s)?new t([s[0]||0,s[1]||0,s[2]||0,i]):null}function n(e,t){t.color=e.toJSON().slice(0,3);const r=o.opacityToTransparency(e.a);0!==r&&(t.transparency=r)}const a={type:Number,cast:r.toPt,json:{write:!0}};var l;e.EmissiveSourceMode=void 0,(l=e.EmissiveSourceMode||(e.EmissiveSourceMode={}))[l.Emissive=0]="Emissive",l[l.Color=1]="Color",e.colorAndTransparencyProperty=function(e){return{type:t,nonNullable:e?.nonNullable,json:{type:[i.Integer],default:null,read:{source:["color","transparency"],reader:s},write:{target:{color:{type:[i.Integer],isRequired:e?.colorRequiredOnWrite},transparency:{type:i.Integer}},writer:n}}}},e.getEmissiveMode=function(t){return"emissive"===t?e.EmissiveSourceMode.Emissive:e.EmissiveSourceMode.Color},e.screenSizeProperty=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/edges/SketchEdges3D":function(){define(["../../chunks/tslib.es6","../../core/Logger","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./Edges3D"],(function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends a{constructor(e){super(e),this.type="sketch"}clone(){return new l(this.cloneProperties())}};return e.__decorate([s.enumeration({sketch:"sketch"},{readOnly:!0})],c.prototype,"type",void 0),c=l=e.__decorate([n.subclass("esri.symbols.edges.SketchEdges3D")],c),c}))},"esri/symbols/edges/SolidEdges3D":function(){define(["../../chunks/tslib.es6","../../core/Logger","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./Edges3D"],(function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends a{constructor(e){super(e),this.type="solid"}clone(){return new l(this.cloneProperties())}};return e.__decorate([s.enumeration({solid:"solid"},{readOnly:!0})],c.prototype,"type",void 0),c=l=e.__decorate([n.subclass("esri.symbols.edges.SolidEdges3D")],c),c}))},"esri/symbols/support/Symbol3DMaterial":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./materialUtils","./Symbol3DEmissive"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;e.Symbol3DMaterial=u=class extends r{constructor(e){super(e),this.color=null,this.emissive=new c.Symbol3DEmissive({source:"emissive"})}clone(){const e={color:this.color?.clone()??null,emissive:this.emissive?.clone()??null};return new u(e)}},t.__decorate([i.property(l.colorAndTransparencyProperty())],e.Symbol3DMaterial.prototype,"color",void 0),t.__decorate([i.property({type:c.Symbol3DEmissive,json:{write:!1}})],e.Symbol3DMaterial.prototype,"emissive",void 0),e.Symbol3DMaterial=u=t.__decorate([a.subclass("esri.symbols.support.Symbol3DMaterial")],e.Symbol3DMaterial),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/Symbol3DEmissive":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";var l;e.Symbol3DEmissive=l=class extends r{constructor(){super(...arguments),this.strength=null,this.source="emissive"}clone(){const e={strength:this.strength,source:this.source};return new l(e)}},t.__decorate([i.property({json:{write:!1}})],e.Symbol3DEmissive.prototype,"strength",void 0),t.__decorate([i.property({json:{write:!1}})],e.Symbol3DEmissive.prototype,"source",void 0),e.Symbol3DEmissive=l=t.__decorate([a.subclass("esri.symbols.support.Symbol3DEmissive")],e.Symbol3DEmissive),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/FillSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3DLayer","./edges/utils","./patterns/LineStylePattern3D","./patterns/StylePattern3D","./patterns/utils","./support/colors","./support/Symbol3DFillMaterial","./support/Symbol3DOutline"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;return e.default=class extends l{static{y=this}constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:null!=this.edges?this.edges.clone():null,enabled:this.enabled,material:null!=this.material?this.material.clone():null,pattern:null!=this.pattern?this.pattern.clone():null,castShadows:this.castShadows,outline:null!=this.outline?this.outline.clone():null};return new y(e)}static fromSimpleFillSymbol(e){const t=e.outline&&e.outline.style&&"solid"!==e.outline.style?new u({style:e.outline.style}):null,r={size:e.outline?.width??0,color:(e.outline?.color??h.white).clone(),pattern:t};return t&&e.outline?.cap&&(r.patternCap=e.outline.cap),new y({material:new f.Symbol3DFillMaterial({color:(e.color??h.transparentWhite).clone()}),pattern:e.style&&"solid"!==e.style?new d({style:e.style}):null,outline:r})}},t.__decorate([n.enumeration({Fill:"fill"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:f.Symbol3DFillMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([r.property(p.symbol3dPatternProperty)],e.default.prototype,"pattern",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],e.default.prototype,"castShadows",void 0),t.__decorate([r.property({type:m.Symbol3DOutline,json:{write:!0}})],e.default.prototype,"outline",void 0),t.__decorate([r.property(c.symbol3dEdgesProperty)],e.default.prototype,"edges",void 0),e.default=y=t.__decorate([a.subclass("esri.symbols.FillSymbol3DLayer")],e.default),e.default}))},"esri/symbols/patterns/LineStylePattern3D":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./LinePattern3D","./lineStyles"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;const p=r.strict()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});return e.default=d=class extends c{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new d(e)}},t.__decorate([i.property({type:["style"],json:{write:{isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([a.enumeration(p),i.property({type:u.lineStyles,json:{write:{isRequired:!0}}})],e.default.prototype,"style",void 0),e.default=d=t.__decorate([l.subclass("esri.symbols.patterns.LineStylePattern3D")],e.default),e.default}))},"esri/symbols/patterns/LinePattern3D":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";return e.default=class extends r{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}},t.__decorate([i.property({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],e.default.prototype,"type",void 0),e.default=t.__decorate([a.subclass("esri.symbols.patterns.LinePattern3D")],e.default),e.default}))},"esri/symbols/patterns/lineStyles":function(){define(["exports"],(function(e){"use strict";e.lineStyles=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"],Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/patterns/StylePattern3D":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./Pattern3D","./styles"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends a{constructor(e){super(e),this.type="style",this.style="solid"}clone(){return new c({style:this.style})}},t.__decorate([r.property({type:["style"],json:{write:{isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:l,json:{read:!0,write:{isRequired:!0}}})],e.default.prototype,"style",void 0),e.default=c=t.__decorate([n.subclass("esri.symbols.patterns.StylePattern3D")],e.default),e.default}))},"esri/symbols/patterns/Pattern3D":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";return e.default=class extends r{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}},t.__decorate([i.property({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],e.default.prototype,"type",void 0),e.default=t.__decorate([a.subclass("esri.symbols.patterns.Pattern3D")],e.default),e.default}))},"esri/symbols/patterns/styles":function(){define((function(){"use strict";return["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"]}))},"esri/symbols/patterns/utils":function(){define(["exports","./LinePattern3D","./LineStylePattern3D","./Pattern3D","./StylePattern3D"],(function(e,t,r,i,o){"use strict";const s={types:{key:"type",base:i,typeMap:{style:o}},json:{write:!0}},n={types:{key:"type",base:t,typeMap:{style:r}},json:{write:!0}};e.symbol3dLinePatternProperty=n,e.symbol3dPatternProperty=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/colors":function(){define(["exports","../../Color"],(function(e,t){"use strict";const r=new t("white"),i=new t([255,255,255,0]);e.isBlack=function(e){return 0===e.r&&0===e.g&&0===e.b},e.transparentWhite=i,e.white=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/Symbol3DFillMaterial":function(){define(["exports","../../chunks/tslib.es6","../../core/Logger","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./Symbol3DMaterial"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;e.Symbol3DFillMaterial=c=class extends l.Symbol3DMaterial{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:this.color?.clone()??null,colorMixMode:this.colorMixMode,emissive:this.emissive?.clone()??null};return new c(e)}},t.__decorate([n.enumeration({multiply:"multiply",replace:"replace",tint:"tint"})],e.Symbol3DFillMaterial.prototype,"colorMixMode",void 0),e.Symbol3DFillMaterial=c=t.__decorate([a.subclass("esri.symbols.support.Symbol3DFillMaterial")],e.Symbol3DFillMaterial),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/Symbol3DOutline":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../patterns/utils","./materialUtils","./symbolLayerUtils3D"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;e.Symbol3DOutline=h=class extends i{constructor(e){super(e),this.color=new r([0,0,0,1]),this.size=o.px2pt(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:null!=this.color?this.color.clone():null,size:this.size,pattern:null!=this.pattern?this.pattern.clone():null,patternCap:this.patternCap};return new h(e)}},t.__decorate([s.property(d.colorAndTransparencyProperty({colorRequiredOnWrite:!0}))],e.Symbol3DOutline.prototype,"color",void 0),t.__decorate([s.property({...d.screenSizeProperty,json:{write:{isRequired:!0}}})],e.Symbol3DOutline.prototype,"size",void 0),t.__decorate([s.property(u.symbol3dLinePatternProperty)],e.Symbol3DOutline.prototype,"pattern",void 0),t.__decorate([s.property({type:p.lineCaps,json:{default:"butt",write:{overridePolicy(){return{enabled:null!=this.pattern}}}}})],e.Symbol3DOutline.prototype,"patternCap",void 0),e.Symbol3DOutline=h=t.__decorate([c.subclass("esri.symbols.support.Symbol3DOutline")],e.Symbol3DOutline),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/symbolLayerUtils3D":function(){define(["exports","../../core/has","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/support/aaBoundingBox"],(function(e,t,r,i){"use strict";const o=i.fromValues(-.5,-.5,-.5,.5,.5,.5),s=i.fromValues(-.5,-.5,0,.5,.5,1),n=i.fromValues(-.5,-.5,0,.5,.5,.5),a=["butt","square","round"],l=[...a,"none"];e.lineCaps=a,e.lineJoins=["miter","bevel","round"],e.objectSymbolLayerBoundingBoxTetrahedron=n,e.objectSymbolLayerBoundingBoxUnitCube=o,e.objectSymbolLayerBoundingBoxUnitCylinder=s,e.objectSymbolLayerPrimitiveBoundingBox=function(e){switch(e){case"sphere":case"cube":case"diamond":return o;case"cylinder":case"cone":case"inverted-cone":return s;case"tetrahedron":return n;default:return}},e.objectSymbolLayerSizeWithResourceSize=function(e,{isPrimitive:t,width:i,depth:o,height:s}){const n=t?10:1;if(null==i&&null==s&&null==o)return[n*e[0],n*e[1],n*e[2]];const a=r.fromValues(i,o,s);let l;for(let t=0;t<3;t++){const r=a[t];if(null!=r){l=r/e[t];break}}for(let t=0;t<3;t++)null==a[t]&&(a[t]=e[t]*l);return a},e.pathCaps=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/IconSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/Logger","../core/urlUtils","../core/accessorSupport/decorators/property","../core/has","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3DLayer","./support/colors","./support/IconSymbol3DLayerResource","./support/materialUtils","./support/Symbol3DAnchorPosition2D","./support/Symbol3DIconOutline","./support/Symbol3DMaterial"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;function g(e){const t="width"in e?e.width:e.size,r="height"in e?e.height:e.size,i=b(e.xoffset),o=b(e.yoffset);return(i||o)&&t&&r?{x:-i/t,y:o/r}:null}function b(e){return isFinite(e)?e:0}e.default=class extends c{static{y=this}constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null,this.angle=0}clone(){return new y({anchor:this.anchor,anchorPosition:r.clone(this.anchorPosition),enabled:this.enabled,material:r.clone(this.material),outline:r.clone(this.outline),resource:r.clone(this.resource),angle:this.angle,size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||u.white,r=g(e),o=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||u.white).clone()}:null;return new y({size:e.size,angle:e.angle,resource:{primitive:(s=()=>i.getLogger(this.prototype),n=e.style,v[n]||(s().warn(`${n} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle"))},material:{color:t},outline:o,anchor:r?"relative":void 0,anchorPosition:r});var s,n}static fromPictureMarkerSymbol(e){const t=!e.color||u.isBlack(e.color)?u.white:e.color,r=g(e);return new y({size:e.width<=e.height?e.height:e.width,angle:e.angle,resource:{href:e.url},material:{color:t.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(e){return new y({resource:{href:o.makeData({mediaType:"application/json",data:JSON.stringify(e.data)})}})}},t.__decorate([s.property({type:m.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([s.property({type:d.IconSymbol3DLayerResource,json:{write:!0}})],e.default.prototype,"resource",void 0),t.__decorate([a.enumeration({Icon:"icon"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([s.property({...p.screenSizeProperty,json:{write:{isRequired:!0}}})],e.default.prototype,"size",void 0),t.__decorate([a.enumeration({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"},{default:"center"})],e.default.prototype,"anchor",void 0),t.__decorate([s.property({type:h.Symbol3DAnchorPosition2D,json:{type:[Number],read:{reader:e=>new h.Symbol3DAnchorPosition2D({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],e.default.prototype,"anchorPosition",void 0),t.__decorate([s.property({type:f.Symbol3DIconOutline,json:{write:!0}})],e.default.prototype,"outline",void 0),t.__decorate([s.property({type:Number,json:{write:!0,default:0}})],e.default.prototype,"angle",void 0),e.default=y=t.__decorate([l.subclass("esri.symbols.IconSymbol3DLayer")],e.default);const v={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};return e.default}))},"esri/symbols/support/IconSymbol3DLayerResource":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/urlUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../chunks/persistableUrlUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";var f;const m=r.strict()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});e.IconSymbol3DLayerResource=f=class extends i{constructor(e){super(e)}readHref(e,t,r){return e?h.fromJSON(e,r):t.dataURI}writeHref(e,t,r,i){e&&(o.isDataProtocol(e)?t.dataURI=e:(t.href=h.toJSON(e,i),o.isAbsolute(t.href)&&(t.href=o.normalize(t.href))))}clone(){return new f({href:this.href,primitive:this.primitive})}},t.__decorate([s.property({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],e.IconSymbol3DLayerResource.prototype,"href",void 0),t.__decorate([u.reader("href")],e.IconSymbol3DLayerResource.prototype,"readHref",null),t.__decorate([p.writer("href",{href:{type:String},dataURI:{type:String}})],e.IconSymbol3DLayerResource.prototype,"writeHref",null),t.__decorate([c.enumeration(m)],e.IconSymbol3DLayerResource.prototype,"primitive",void 0),e.IconSymbol3DLayerResource=f=t.__decorate([d.subclass("esri.symbols.support.IconSymbol3DLayerResource")],e.IconSymbol3DLayerResource),e.defaultPrimitive="circle",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/Symbol3DAnchorPosition2D":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";var l;e.Symbol3DAnchorPosition2D=l=class extends r{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new l({x:this.x,y:this.y})}},t.__decorate([i.property({type:Number})],e.Symbol3DAnchorPosition2D.prototype,"x",void 0),t.__decorate([i.property({type:Number})],e.Symbol3DAnchorPosition2D.prototype,"y",void 0),e.Symbol3DAnchorPosition2D=l=t.__decorate([a.subclass("esri.symbols.support.Symbol3DAnchorPosition2D")],e.Symbol3DAnchorPosition2D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/Symbol3DIconOutline":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./materialUtils"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;e.Symbol3DIconOutline=d=class extends i{constructor(e){super(e),this.color=new r([0,0,0,1]),this.size=o.px2pt(1)}clone(){const e={color:null!=this.color?this.color.clone():null,size:this.size};return new d(e)}},t.__decorate([s.property(u.colorAndTransparencyProperty({colorRequiredOnWrite:!0}))],e.Symbol3DIconOutline.prototype,"color",void 0),t.__decorate([s.property({...u.screenSizeProperty,json:{write:{isRequired:!0}}})],e.Symbol3DIconOutline.prototype,"size",void 0),e.Symbol3DIconOutline=d=t.__decorate([c.subclass("esri.symbols.support.Symbol3DIconOutline")],e.Symbol3DIconOutline),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/LineSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./LineStyleMarker3D","./Symbol3DLayer","./patterns/LineStylePattern3D","./patterns/utils","./support/colors","./support/materialUtils","./support/Symbol3DMaterial","./support/symbolLayerUtils3D"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";var g;return e.default=class extends u{static{g=this}constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=r.px2pt(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:null!=this.material?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:null!=this.pattern?this.pattern.clone():null,marker:null!=this.marker?this.marker.clone():null};return new g(e)}static fromSimpleLineSymbol(e){const t={enabled:!0,size:e.width??r.px2pt(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style?new d({style:e.style}):null,material:new m.Symbol3DMaterial({color:(e.color||h.white).clone()}),marker:e.marker?new c({placement:e.marker.placement,style:e.marker.style,color:e.marker.color?.clone()??null}):null};return new g(t)}},t.__decorate([i.property({type:m.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([a.enumeration({Line:"line"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([i.property({type:y.lineJoins,json:{write:!0,default:"miter"}})],e.default.prototype,"join",void 0),t.__decorate([i.property({type:y.lineCaps,json:{write:!0,default:"butt"}})],e.default.prototype,"cap",void 0),t.__decorate([i.property({...f.screenSizeProperty,json:{write:{isRequired:!0}}})],e.default.prototype,"size",void 0),t.__decorate([i.property(p.symbol3dLinePatternProperty)],e.default.prototype,"pattern",void 0),t.__decorate([i.property({types:{key:"type",base:c,typeMap:{style:c}},json:{write:!0}})],e.default.prototype,"marker",void 0),e.default=g=t.__decorate([l.subclass("esri.symbols.LineSymbol3DLayer")],e.default),e.default}))},"esri/symbols/LineStyleMarker3D":function(){define(["exports","../chunks/tslib.es6","../Color","../core/Clonable","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./support/lineMarkers"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";return e.default=class extends(i.ClonableMixin(o)){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return null!=e&&e.placement===this.placement&&e.style===this.style&&(null==this.color&&null==e.color||null!=this.color&&null!=e.color&&this.color.toJSON()===e.color.toJSON())}},t.__decorate([s.property({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:u.lineMarkerPlacements,json:{default:"begin-end",write:!0}})],e.default.prototype,"placement",void 0),t.__decorate([s.property({type:u.lineMarkerStyles,json:{default:"arrow",write:!0}})],e.default.prototype,"style",void 0),t.__decorate([s.property({type:r,json:{type:[n.Integer],default:null,write:!0}})],e.default.prototype,"color",void 0),e.default=t.__decorate([c.subclass("esri.symbols.LineStyleMarker3D")],e.default),e.default}))},"esri/symbols/support/lineMarkers":function(){define(["exports"],(function(e){"use strict";e.lineMarkerPlacements=["begin","end","begin-end"],e.lineMarkerStyles=["arrow","circle","square","diamond","cross","x"],Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/ObjectSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3DLayer","./support/ObjectSymbol3DLayerResource","./support/Symbol3DAnchorPosition3D","./support/Symbol3DMaterial"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;return e.default=class extends l{static{p=this}constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new p({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||"string"!=typeof this.resource.href}},t.__decorate([r.property({type:d.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],e.default.prototype,"castShadows",void 0),t.__decorate([r.property({type:c.ObjectSymbol3DLayerResource,json:{write:!0}})],e.default.prototype,"resource",void 0),t.__decorate([n.enumeration({Object:"object"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"width",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"height",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"depth",void 0),t.__decorate([n.enumeration({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"},{default:"origin"})],e.default.prototype,"anchor",void 0),t.__decorate([r.property({type:u.Symbol3DAnchorPosition3D,json:{type:[Number],read:{reader:e=>new u.Symbol3DAnchorPosition3D({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],e.default.prototype,"anchorPosition",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"heading",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"tilt",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"roll",void 0),t.__decorate([r.property({readOnly:!0})],e.default.prototype,"isPrimitive",null),e.default=p=t.__decorate([a.subclass("esri.symbols.ObjectSymbol3DLayer")],e.default),e.default}))},"esri/symbols/support/ObjectSymbol3DLayerResource":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../chunks/persistableUrlUtils"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;const p=r.strict()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});e.ObjectSymbol3DLayerResource=d=class extends i{clone(){return new d({href:this.href,primitive:this.primitive})}},t.__decorate([o.property({type:String,json:{read:u.read,write:u.write}})],e.ObjectSymbol3DLayerResource.prototype,"href",void 0),t.__decorate([l.enumeration(p)],e.ObjectSymbol3DLayerResource.prototype,"primitive",void 0),e.ObjectSymbol3DLayerResource=d=t.__decorate([c.subclass("esri.symbols.support.ObjectSymbol3DLayerResource")],e.ObjectSymbol3DLayerResource),e.defaultPrimitive="sphere",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/Symbol3DAnchorPosition3D":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";var l;e.Symbol3DAnchorPosition3D=l=class extends r{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new l({x:this.x,y:this.y,z:this.z})}},t.__decorate([i.property({type:Number})],e.Symbol3DAnchorPosition3D.prototype,"x",void 0),t.__decorate([i.property({type:Number})],e.Symbol3DAnchorPosition3D.prototype,"y",void 0),t.__decorate([i.property({type:Number})],e.Symbol3DAnchorPosition3D.prototype,"z",void 0),e.Symbol3DAnchorPosition3D=l=t.__decorate([a.subclass("esri.symbols.support.Symbol3DAnchorPosition3D")],e.Symbol3DAnchorPosition3D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/PathSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","./Symbol3DLayer","./support/Symbol3DMaterial","./support/symbolLayerUtils3D"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;return e.default=class extends c{static{p=this}constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return null!=e?e:null==t.height&&null!=t.size?t.size:void 0}readHeight(e,t){return null!=e?e:null==t.width&&null!=t.size?t.size:void 0}clone(){return new p({enabled:this.enabled,material:null!=this.material?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}},t.__decorate([r.property({type:u.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],e.default.prototype,"castShadows",void 0),t.__decorate([n.enumeration({Path:"path"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:["circle","quad"],json:{write:!0,default:"circle"}})],e.default.prototype,"profile",void 0),t.__decorate([r.property({type:d.lineJoins,json:{write:!0,default:"miter"}})],e.default.prototype,"join",void 0),t.__decorate([r.property({type:d.pathCaps,json:{write:!0,default:"butt"}})],e.default.prototype,"cap",void 0),t.__decorate([r.property({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],e.default.prototype,"width",void 0),t.__decorate([a.reader("width",["width","size","height"])],e.default.prototype,"readWidth",null),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"height",void 0),t.__decorate([a.reader("height",["height","size","width"])],e.default.prototype,"readHeight",null),t.__decorate([r.property({type:["center","bottom","top"],json:{write:!0,default:"center"}})],e.default.prototype,"anchor",void 0),t.__decorate([r.property({type:["heading","all"],json:{write:!0,default:"all"}})],e.default.prototype,"profileRotation",void 0),e.default=p=t.__decorate([l.subclass("esri.symbols.PathSymbol3DLayer")],e.default),e.default}))},"esri/symbols/TextSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./Font","./Symbol3DLayer","./support/materialUtils","./support/Symbol3DHalo","./support/Symbol3DMaterial","./support/Symbol3DTextBackground","./support/textUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;return e.default=class extends u{static{y=this}constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){null!=e&&null!=this._userSize&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,r,i){const o={...i,textSymbol3D:!0};t.font=e.write({},o),delete t.font.size}get size(){return null!=this._userSize?this._userSize:null!=this.font?.size?this.font.size:9}set size(e){this._userSize=e,null!=this.font&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new y({enabled:this.enabled,font:this.font&&r.clone(this.font),halo:this.halo&&r.clone(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:null!=this.material?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:r.clone(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new y({font:null!=e.font?e.font.clone():new c,halo:(t=e.haloColor,i=e.haloSize,t&&null!=i&&i>0?new p.Symbol3DHalo({color:r.clone(t),size:i}):null),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new h.Symbol3DMaterial({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new f.Symbol3DTextBackground({color:e.backgroundColor.clone()}):null});var t,i}},t.__decorate([i.property({type:c,json:{write:!0}})],e.default.prototype,"font",null),t.__decorate([l.writer("font")],e.default.prototype,"writeFont",null),t.__decorate([i.property({type:p.Symbol3DHalo,json:{write:!0}})],e.default.prototype,"halo",void 0),t.__decorate([i.property({...m.horizontalAlignmentProperty,json:{default:"center",write:!0}})],e.default.prototype,"horizontalAlignment",void 0),t.__decorate([i.property({...m.lineHeightProperty,json:{default:1,write:!0}})],e.default.prototype,"lineHeight",void 0),t.__decorate([i.property({type:h.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([i.property({type:f.Symbol3DTextBackground,json:{write:!0}})],e.default.prototype,"background",void 0),t.__decorate([i.property(d.screenSizeProperty)],e.default.prototype,"size",null),t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"text",void 0),t.__decorate([n.enumeration({Text:"text"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([i.property({...m.verticalAlignmentProperty,json:{default:"baseline",write:!0}})],e.default.prototype,"verticalAlignment",void 0),e.default=y=t.__decorate([a.subclass("esri.symbols.TextSymbol3DLayer")],e.default),e.default}))},"esri/symbols/Font":function(){define(["exports","../chunks/tslib.es6","../core/JSONSupport","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./support/textUtils"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;return e.default=u=class extends r{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return i.toPt(e)}clone(){return new u({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}},t.__decorate([o.property({type:c.fontDecorations,json:{default:"none",write:!0}})],e.default.prototype,"decoration",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.default.prototype,"family",void 0),t.__decorate([o.property({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.textSymbol3D})}}})],e.default.prototype,"size",void 0),t.__decorate([s.cast("size")],e.default.prototype,"castSize",null),t.__decorate([o.property({type:c.fontStyles,json:{default:"normal",write:!0}})],e.default.prototype,"style",void 0),t.__decorate([o.property({type:c.fontWeights,json:{default:"normal",write:!0}})],e.default.prototype,"weight",void 0),e.default=u=t.__decorate([l.subclass("esri.symbols.Font")],e.default),e.default}))},"esri/symbols/support/textUtils":function(){define(["exports","../../core/mathUtils","../../core/accessorSupport/ensureType"],(function(e,t,r){"use strict";const i={type:Number,cast:e=>{const i=r.ensureNumber(e);return 0===i?1:t.clamp(i,.1,4)},nonNullable:!0},o=["left","right","center"],s=["baseline","top","middle","bottom"],n={type:o,nonNullable:!0},a={type:s,nonNullable:!0};e.backgroundPadding=8,e.fontDecorations=["none","underline","line-through"],e.fontStyles=["normal","italic","oblique"],e.fontWeights=["normal","lighter","bold","bolder"],e.horizontalAlignmentProperty=n,e.horizontalAlignments=o,e.lineHeightProperty=i,e.verticalAlignmentProperty=a,e.verticalAlignments=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/Symbol3DHalo":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./materialUtils"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;e.Symbol3DHalo=u=class extends i{constructor(){super(...arguments),this.color=new r([0,0,0,1]),this.size=0}clone(){const e={color:o.clone(this.color),size:this.size};return new u(e)}},t.__decorate([s.property(c.colorAndTransparencyProperty())],e.Symbol3DHalo.prototype,"color",void 0),t.__decorate([s.property(c.screenSizeProperty)],e.Symbol3DHalo.prototype,"size",void 0),e.Symbol3DHalo=u=t.__decorate([l.subclass("esri.symbols.support.Symbol3DHalo")],e.Symbol3DHalo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/Symbol3DTextBackground":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./materialUtils"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";e.Symbol3DTextBackground=class extends(r.ClonableMixin(i)){constructor(e){super(e),this.color=null}},t.__decorate([o.property(c.colorAndTransparencyProperty())],e.Symbol3DTextBackground.prototype,"color",void 0),e.Symbol3DTextBackground=t.__decorate([l.subclass("esri.symbols.support.Symbol3DTextBackground")],e.Symbol3DTextBackground),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/WaterSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../Color","../core/lang","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3DLayer"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;e.default=class extends l{static{c=this}constructor(e){super(e),this.color=u.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new c({color:i.clone(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}},t.__decorate([o.property({type:r,nonNullable:!0,json:{type:[s.Integer],write:(e,t,i)=>t[i]=e.toArray(r.AlphaMode.UNLESS_OPAQUE),default:()=>u.clone(),defaultEquals:e=>e.toCss(!0)===u.toCss(!0)}})],e.default.prototype,"color",void 0),t.__decorate([n.enumeration({Water:"water"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property({type:["small","medium","large"],json:{write:!0,default:"medium"}})],e.default.prototype,"waterbodySize",void 0),t.__decorate([o.property({type:Number,json:{write:!0,default:null}})],e.default.prototype,"waveDirection",void 0),t.__decorate([o.property({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],e.default.prototype,"waveStrength",void 0),e.default=c=t.__decorate([a.subclass("esri.symbols.WaterSymbol3DLayer")],e.default);const u=new r([0,119,190]);return e.default}))},"esri/symbols/support/StyleOrigin":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../portal/Portal"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends r{constructor(e){super(e),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new c({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}},t.__decorate([i.property({type:String})],e.default.prototype,"name",void 0),t.__decorate([i.property({type:String})],e.default.prototype,"styleUrl",void 0),t.__decorate([i.property({type:String})],e.default.prototype,"styleName",void 0),t.__decorate([i.property({type:l})],e.default.prototype,"portal",void 0),e.default=c=t.__decorate([a.subclass("esri.symbols.support.StyleOrigin")],e.default),e.default}))},"esri/symbols/support/Thumbnail":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";var l;e.Thumbnail=l=class extends r{constructor(){super(...arguments),this.url=""}clone(){return new l({url:this.url})}},t.__decorate([i.property({type:String})],e.Thumbnail.prototype,"url",void 0),e.Thumbnail=l=t.__decorate([a.subclass("esri.symbols.support.Thumbnail")],e.Thumbnail),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/callouts/calloutUtils":function(){define(["exports","./Callout3D","./LineCallout3D"],(function(e,t,r){"use strict";function i(e){if(!e)return!1;const t=e.verticalOffset;return!(!t||t.screenLength<=0||null!=t.maxWorldLength&&t.maxWorldLength<=0)}const o={types:{key:"type",base:t,typeMap:{line:r}},json:{write:!0}};e.calloutProperty=o,e.hasCalloutSupport=function(e){return"point-3d"===e.type||"label-3d"===e.type},e.hasVisibleCallout=function(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t?.visible&&!!i(e)},e.hasVisibleVerticalOffset=i,e.textSymbolLayerSupportsVerticalOffset=function(e){return"center"===e.horizontalAlignment},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/callouts/Callout3D":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";return e.default=class extends r{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}},t.__decorate([i.property({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([i.property({readOnly:!0})],e.default.prototype,"visible",void 0),e.default=t.__decorate([a.subclass("esri.symbols.callouts.Callout3D")],e.default),e.default}))},"esri/symbols/callouts/LineCallout3D":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/lang","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./Callout3D","./LineCallout3DBorder","../support/materialUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;return e.default=h=class extends u{constructor(e){super(e),this.type="line",this.color=new r([0,0,0,1]),this.size=o.px2pt(1),this.border=null}get visible(){return this.size>0&&null!=this.color&&this.color.a>0}clone(){return new h({color:i.clone(this.color),size:this.size,border:i.clone(this.border)})}},t.__decorate([l.enumeration({line:"line"})],e.default.prototype,"type",void 0),t.__decorate([s.property(p.colorAndTransparencyProperty({colorRequiredOnWrite:!0}))],e.default.prototype,"color",void 0),t.__decorate([s.property({...p.screenSizeProperty,json:{write:{isRequired:!0}}})],e.default.prototype,"size",void 0),t.__decorate([s.property({type:d,json:{write:!0}})],e.default.prototype,"border",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"visible",null),e.default=h=t.__decorate([c.subclass("esri.symbols.callouts.LineCallout3D")],e.default),e.default}))},"esri/symbols/callouts/LineCallout3DBorder":function(){define(["../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../support/materialUtils"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;let u=c=class extends r{constructor(e){super(e),this.color=new t("white")}clone(){return new c({color:i.clone(this.color)})}};return e.__decorate([o.property(l.colorAndTransparencyProperty({colorRequiredOnWrite:!0}))],u.prototype,"color",void 0),u=c=e.__decorate([a.subclass("esri.symbols.callouts.LineCallout3DBorder")],u),u}))},"esri/symbols/support/Symbol3DVerticalOffset":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./materialUtils"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends r{constructor(e){super(e),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new c({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}},t.__decorate([i.property({...l.screenSizeProperty,json:{write:{isRequired:!0}}})],e.default.prototype,"screenLength",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,json:{write:!0,default:0}})],e.default.prototype,"minWorldLength",void 0),t.__decorate([i.property({type:Number,json:{write:!0}})],e.default.prototype,"maxWorldLength",void 0),e.default=c=t.__decorate([a.subclass("esri.symbols.support.Symbol3DVerticalOffset")],e.default),e.default}))},"esri/symbols/LineSymbol3D":function(){define(["exports","../chunks/tslib.es6","../core/Collection","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./LineSymbol3DLayer","./PathSymbol3DLayer","./Symbol3D"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;const h=r.ofType({base:null,key:"type",typeMap:{line:c,path:u}}),f=r.ofType({base:null,key:"type",typeMap:{line:c,path:u}});return e.default=p=class extends d{constructor(e){super(e),this.symbolLayers=new h,this.type="line-3d"}clone(){return new p({styleOrigin:i.clone(this.styleOrigin),symbolLayers:i.clone(this.symbolLayers),thumbnail:i.clone(this.thumbnail)})}static fromSimpleLineSymbol(e){return new p({symbolLayers:new r([c.fromSimpleLineSymbol(e)])})}},t.__decorate([o.property({type:h,json:{type:f}})],e.default.prototype,"symbolLayers",void 0),t.__decorate([a.enumeration({LineSymbol3D:"line-3d"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=p=t.__decorate([l.subclass("esri.symbols.LineSymbol3D")],e.default),e.default}))},"esri/symbols/MeshSymbol3D":function(){define(["exports","../chunks/tslib.es6","../core/Collection","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./FillSymbol3DLayer","./Symbol3D"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;const p=r.ofType({base:null,key:"type",typeMap:{fill:c}});return e.default=d=class extends u{constructor(e){super(e),this.symbolLayers=new p,this.type="mesh-3d"}clone(){return new d({styleOrigin:i.clone(this.styleOrigin),symbolLayers:i.clone(this.symbolLayers),thumbnail:i.clone(this.thumbnail)})}static fromSimpleFillSymbol(e){return new d({symbolLayers:new r([c.fromSimpleFillSymbol(e)])})}},t.__decorate([o.property({type:p})],e.default.prototype,"symbolLayers",void 0),t.__decorate([a.enumeration({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=d=t.__decorate([l.subclass("esri.symbols.MeshSymbol3D")],e.default),e.default}))},"esri/symbols/PictureFillSymbol":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./FillSymbol","./support/urlUtils"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;return e.default=d=class extends c{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,r,o){if(e&&"string"!=typeof e&&null==e.imageData)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),null!=r&&(s.width=i.toPt(r)),null!=o&&(s.height=i.toPt(o)),s}clone(){const e=new d({color:r.clone(this.color),height:this.height,outline:r.clone(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",r.clone(this.source)),e}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}},t.__decorate([a.enumeration({esriPFS:"picture-fill"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property(u.urlPropertyDefinition)],e.default.prototype,"url",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"xscale",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"yscale",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"width",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"height",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"xoffset",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"yoffset",void 0),t.__decorate([o.property(u.sourcePropertyDefinition)],e.default.prototype,"source",void 0),e.default=d=t.__decorate([l.subclass("esri.symbols.PictureFillSymbol")],e.default),e.default}))},"esri/symbols/FillSymbol":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./SimpleLineSymbol","./Symbol"],(function(e,t,r,i,o,s,n,a,l){"use strict";return e.default=class extends l{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline?.hash()}`}},t.__decorate([r.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":a}},json:{default:null,write:!0}})],e.default.prototype,"outline",void 0),t.__decorate([r.property({type:["simple-fill","picture-fill"],readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([n.subclass("esri.symbols.FillSymbol")],e.default),e.default}))},"esri/symbols/SimpleLineSymbol":function(){define(["exports","../chunks/tslib.es6","../core/jsonMap","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./LineSymbol","./LineSymbolMarker"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;const h=new r.JSONMap({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});return e.default=p=class extends u{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,r,i,s,n){if(e&&"string"!=typeof e)return e;const a={};return null!=e&&(a.style=e),null!=t&&(a.color=t),null!=r&&(a.width=o.toPt(r)),null!=i&&(a.cap=i),null!=s&&(a.join=s),null!=n&&(a.miterLimit=o.toPt(n)),a}clone(){return new p({color:i.clone(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}},t.__decorate([l.enumeration({esriSLS:"simple-line"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:h.apiValues,json:{read:h.read,write:h.write}})],e.default.prototype,"style",void 0),t.__decorate([s.property({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,r)=>({enabled:"round"!==e&&null==r?.origin})}}})],e.default.prototype,"cap",void 0),t.__decorate([s.property({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,r)=>({enabled:"round"!==e&&null==r?.origin})}}})],e.default.prototype,"join",void 0),t.__decorate([s.property({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":d}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"marker",void 0),t.__decorate([s.property({type:Number,json:{read:!1,write:!1}})],e.default.prototype,"miterLimit",void 0),e.default=p=t.__decorate([c.subclass("esri.symbols.SimpleLineSymbol")],e.default),e.default}))},"esri/symbols/LineSymbol":function(){define(["exports","../chunks/tslib.es6","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";return e.default=class extends c{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}},t.__decorate([a.enumeration({esriSLS:"simple-line"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([i.property({type:Number,cast:r.toPt,json:{write:!0}})],e.default.prototype,"width",void 0),e.default=t.__decorate([l.subclass("esri.symbols.LineSymbol")],e.default),e.default}))},"esri/symbols/LineSymbolMarker":function(){define(["../chunks/tslib.es6","../Color","../core/JSONSupport","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./support/lineMarkers"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;let h=p=class extends r{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,r,i){t[r]="web-map"===i?.origin?"arrow":e}set color(e){this._set("color",e)}readColor(e){return null!=e?.[0]?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,r,i){"web-map"===i?.origin||(t[r]=e)}clone(){return new p({color:i.clone(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};return e.__decorate([o.property({type:["begin","end","begin-end"],json:{write:!0}})],h.prototype,"placement",void 0),e.__decorate([a.enumeration({"line-marker":"line-marker"},{readOnly:!0}),o.property({json:{origins:{"web-map":{write:!1}}}})],h.prototype,"type",void 0),e.__decorate([o.property({type:d.lineMarkerStyles})],h.prototype,"style",void 0),e.__decorate([u.writer("style")],h.prototype,"writeStyle",null),e.__decorate([o.property({type:t,value:null,json:{write:{allowNull:!0}}})],h.prototype,"color",null),e.__decorate([l.reader("color")],h.prototype,"readColor",null),e.__decorate([u.writer("color")],h.prototype,"writeColor",null),h=p=e.__decorate([c.subclass("esri.symbols.LineSymbolMarker")],h),h}))},"esri/symbols/support/urlUtils":function(){define(["exports","../../core/urlUtils","../../chunks/persistableUrlUtils"],(function(e,t,r){"use strict";function i(e,r,i){return r.imageData?t.makeData({mediaType:r.contentType||"image/png",isBase64:!0,data:r.imageData}):o(r.url,i)}function o(e,i){if(!t.isAbsolute(e)){const r=function(e){if(!e)return null;const{origin:t,layer:r}=e;if("service"!==t&&"portal-item"!==t)return null;const i=r?.type;return"feature"===i||"stream"===i?r.parsedUrl?.path:"map-image"===i||"tile"===i?e.url?.path:null}(i);if(r)return t.join(r,"images",e)}return r.fromJSON(e,i)}function s(e,i,o,s){if(t.isDataProtocol(e)){const n=t.dataComponents(e);if(!n)return;i.contentType=n.mediaType,i.imageData=n.data,o&&o.imageData===i.imageData&&o.url&&r.write(o.url,i,"url",s)}else r.write(e,i,"url",s)}const n={json:{read:{source:["imageData","url"],reader:i},write:{writer(e,t,r,i){s(e,t,this.source,i)}}}},a={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,r){const i={};return t.imageData&&(i.imageData=t.imageData),t.contentType&&(i.contentType=t.contentType),t.url&&(i.url=o(t.url,r)),i}}}};e.read=o,e.readImageDataOrUrl=i,e.sourcePropertyDefinition=a,e.urlPropertyDefinition=n,e.writeImageDataAndUrl=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/PictureMarkerSymbol":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","./MarkerSymbol","./support/urlUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;return e.default=p=class extends u{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e&&null==e.imageData)return e;const o={};return e&&(o.url=e),null!=t&&(o.width=i.toPt(t)),null!=r&&(o.height=i.toPt(r)),o}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new p({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",r.clone(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}},t.__decorate([o.property({json:{write:!1}})],e.default.prototype,"color",void 0),t.__decorate([a.enumeration({esriPMS:"picture-marker"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property(d.urlPropertyDefinition)],e.default.prototype,"url",void 0),t.__decorate([o.property(d.sourcePropertyDefinition)],e.default.prototype,"source",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"height",void 0),t.__decorate([l.reader("height",["height","size"])],e.default.prototype,"readHeight",null),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"width",void 0),t.__decorate([o.property({json:{write:!1}})],e.default.prototype,"size",void 0),e.default=p=t.__decorate([c.subclass("esri.symbols.PictureMarkerSymbol")],e.default),e.default}))},"esri/symbols/MarkerSymbol":function(){define(["exports","../chunks/tslib.es6","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Symbol"],(function(e,t,r,i,o,s,n,a,l){"use strict";return e.default=class extends l{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}},t.__decorate([i.property({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],e.default.prototype,"angle",void 0),t.__decorate([i.property({type:["simple-marker","picture-marker"],readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([i.property({type:Number,cast:r.toPt,json:{write:!0}})],e.default.prototype,"xoffset",void 0),t.__decorate([i.property({type:Number,cast:r.toPt,json:{write:!0}})],e.default.prototype,"yoffset",void 0),t.__decorate([i.property({cast:e=>"auto"===e?e:o.ensureNumber(r.toPt(e)),json:{write:!0}})],e.default.prototype,"size",void 0),e.default=t.__decorate([a.subclass("esri.symbols.MarkerSymbol")],e.default),e.default}))},"esri/symbols/PointSymbol3D":function(){define(["exports","../chunks/tslib.es6","../Color","../core/Collection","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./IconSymbol3DLayer","./ObjectSymbol3DLayer","./Symbol3D","./TextSymbol3DLayer","./callouts/calloutUtils","./callouts/LineCallout3D","./support/Symbol3DVerticalOffset"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";var g;const b=i.ofType({base:null,key:"type",typeMap:{icon:u,object:d,text:h}});return e.default=g=class extends p{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new b,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return f.hasVisibleCallout(this)}hasVisibleVerticalOffset(){return f.hasVisibleVerticalOffset(this)}clone(){return new g({verticalOffset:o.clone(this.verticalOffset),callout:o.clone(this.callout),styleOrigin:o.clone(this.styleOrigin),symbolLayers:o.clone(this.symbolLayers),thumbnail:o.clone(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new g({symbolLayers:new i([u.fromSimpleMarkerSymbol(e)])})}static fromPictureMarkerSymbol(e){return new g({symbolLayers:new i([u.fromPictureMarkerSymbol(e)])})}static fromCIMSymbol(e){const t=e.data?.symbol?.type;if("CIMPointSymbol"!==t)return null;const o=e.data.symbol;return new g(o?.callout?{symbolLayers:new i([u.fromCIMSymbol(e)]),callout:new m({size:.5,color:new r([0,0,0])}),verticalOffset:new y({screenLength:40})}:{symbolLayers:new i([u.fromCIMSymbol(e)])})}static fromTextSymbol(e){return new g({symbolLayers:new i([h.fromTextSymbol(e)])})}},t.__decorate([s.property({type:y,json:{write:!0}})],e.default.prototype,"verticalOffset",void 0),t.__decorate([s.property(f.calloutProperty)],e.default.prototype,"callout",void 0),t.__decorate([s.property({type:b,json:{origins:{"web-scene":{write:!0}}}})],e.default.prototype,"symbolLayers",void 0),t.__decorate([l.enumeration({PointSymbol3D:"point-3d"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=g=t.__decorate([c.subclass("esri.symbols.PointSymbol3D")],e.default),e.default}))},"esri/symbols/PolygonSymbol3D":function(){define(["exports","../chunks/tslib.es6","../core/Collection","../core/deprecate","../core/lang","../core/Logger","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./ExtrudeSymbol3DLayer","./FillSymbol3DLayer","./IconSymbol3DLayer","./LineSymbol3DLayer","./ObjectSymbol3DLayer","./Symbol3D","./TextSymbol3DLayer","./WaterSymbol3DLayer"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b){"use strict";var v;const S=r.ofType({base:null,key:"type",typeMap:{extrude:d,fill:p,icon:h,line:f,object:m,text:g,water:b}});return e.default=v=class extends y{constructor(e){super(e),this.symbolLayers=new S,this.type="polygon-3d"}initialize(){const e=e=>{"line"===e.type&&i.deprecated(s.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),"text"===e.type&&i.deprecated(s.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const t of this.symbolLayers)e(t);this.addHandles(n.on((()=>this.symbolLayers),"after-add",(({item:t})=>e(t)),n.sync))}clone(){return new v({styleOrigin:o.clone(this.styleOrigin),symbolLayers:o.clone(this.symbolLayers),thumbnail:o.clone(this.thumbnail)})}static fromJSON(e){const t=new v;if(t.read(e),2===t.symbolLayers.length&&"fill"===t.symbolLayers.at(0).type&&"line"===t.symbolLayers.at(1).type){const r=t.symbolLayers.at(0),i=t.symbolLayers.at(1);!i.enabled||e.symbolLayers?.[1]&&!1===e.symbolLayers[1].enable||(r.outline={size:i.size,color:null!=i.material?i.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new v({symbolLayers:new r([p.fromSimpleFillSymbol(e)])})}},t.__decorate([a.property({type:S,json:{write:!0}})],e.default.prototype,"symbolLayers",void 0),t.__decorate([c.enumeration({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=v=t.__decorate([u.subclass("esri.symbols.PolygonSymbol3D")],e.default),e.default}))},"esri/symbols/SimpleFillSymbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/jsonMap","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./FillSymbol","./SimpleLineSymbol"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;const h=new i.JSONMap({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});return e.default=p=class extends u{constructor(...e){super(...e),this.color=new r([0,0,0,.25]),this.outline=new d,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e)return e;const i={};return e&&(i.style=e),t&&(i.outline=t),r&&(i.color=r),i}clone(){return new p({color:o.clone(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}},t.__decorate([s.property()],e.default.prototype,"color",void 0),t.__decorate([s.property()],e.default.prototype,"outline",void 0),t.__decorate([l.enumeration({esriSFS:"simple-fill"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:h.apiValues,json:{read:h.read,write:h.write}})],e.default.prototype,"style",void 0),e.default=p=t.__decorate([c.subclass("esri.symbols.SimpleFillSymbol")],e.default),e.default}))},"esri/symbols/SimpleMarkerSymbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/jsonMap","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./MarkerSymbol","./SimpleLineSymbol"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";var f;const m=new i.JSONMap({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});return e.default=f=class extends p{constructor(...e){super(...e),this.color=new r([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new h}normalizeCtorArgs(e,t,r,i){if(e&&"string"!=typeof e)return e;const o={};return e&&(o.style=e),null!=t&&(o.size=s.toPt(t)),r&&(o.outline=r),i&&(o.color=i),o}writeColor(e,t){e&&"x"!==this.style&&"cross"!==this.style&&(t.color=e.toJSON()),null===e&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new f({angle:this.angle,color:o.clone(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}},t.__decorate([n.property()],e.default.prototype,"color",void 0),t.__decorate([d.writer("color")],e.default.prototype,"writeColor",null),t.__decorate([c.enumeration({esriSMS:"simple-marker"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([n.property()],e.default.prototype,"size",void 0),t.__decorate([n.property({type:m.apiValues,json:{read:m.read,write:m.write}})],e.default.prototype,"style",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"path",null),t.__decorate([n.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":h}},json:{default:null,write:!0}})],e.default.prototype,"outline",void 0),e.default=f=t.__decorate([u.subclass("esri.symbols.SimpleMarkerSymbol")],e.default),e.default}))},"esri/symbols/TextSymbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./Font","./Symbol","./support/textUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;return e.default=h=class extends d{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new u,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e)return e;const i={};return e&&(i.text=e),t&&(i.font=t),r&&(i.color=r),i}writeLineWidth(e,t,r,i){i&&"string"!=typeof i?i.origin:t[r]=e}castLineWidth(e){return o.toPt(e)}writeLineHeight(e,t,r,i){i&&"string"!=typeof i?i.origin:t[r]=e}clone(){return new h({angle:this.angle,backgroundColor:i.clone(this.backgroundColor),borderLineColor:i.clone(this.borderLineColor),borderLineSize:this.borderLineSize,color:i.clone(this.color),font:this.font&&this.font.clone(),haloColor:i.clone(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}},t.__decorate([s.property({type:r,json:{write:!0}})],e.default.prototype,"backgroundColor",void 0),t.__decorate([s.property({type:r,json:{write:!0}})],e.default.prototype,"borderLineColor",void 0),t.__decorate([s.property({type:Number,json:{write:!0},cast:o.toPt})],e.default.prototype,"borderLineSize",void 0),t.__decorate([s.property({type:u,json:{write:!0}})],e.default.prototype,"font",void 0),t.__decorate([s.property({...p.horizontalAlignmentProperty,json:{write:!0}})],e.default.prototype,"horizontalAlignment",void 0),t.__decorate([s.property({type:Boolean,json:{write:!0}})],e.default.prototype,"kerning",void 0),t.__decorate([s.property({type:r,json:{write:!0}})],e.default.prototype,"haloColor",void 0),t.__decorate([s.property({type:Number,cast:o.toPt,json:{write:!0}})],e.default.prototype,"haloSize",void 0),t.__decorate([s.property({type:Boolean,json:{write:!0}})],e.default.prototype,"rightToLeft",void 0),t.__decorate([s.property({type:Boolean,json:{write:!0}})],e.default.prototype,"rotated",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"text",void 0),t.__decorate([a.enumeration({esriTS:"text"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([s.property({...p.verticalAlignmentProperty,json:{write:!0}})],e.default.prototype,"verticalAlignment",void 0),t.__decorate([s.property({type:Number,cast:o.toPt,json:{write:!0}})],e.default.prototype,"xoffset",void 0),t.__decorate([s.property({type:Number,cast:o.toPt,json:{write:!0}})],e.default.prototype,"yoffset",void 0),t.__decorate([s.property({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],e.default.prototype,"angle",void 0),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"width",void 0),t.__decorate([s.property({type:Number})],e.default.prototype,"lineWidth",void 0),t.__decorate([c.writer("lineWidth")],e.default.prototype,"writeLineWidth",null),t.__decorate([n.cast("lineWidth")],e.default.prototype,"castLineWidth",null),t.__decorate([s.property(p.lineHeightProperty)],e.default.prototype,"lineHeight",void 0),t.__decorate([c.writer("lineHeight")],e.default.prototype,"writeLineHeight",null),e.default=h=t.__decorate([l.subclass("esri.symbols.TextSymbol")],e.default),e.default}))},"esri/symbols/WebStyleSymbol":function(){define(["require","exports","../chunks/tslib.es6","../core/deprecate","../core/Error","../core/Logger","../core/promiseUtils","../core/accessorSupport/decorators/property","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../portal/Portal","../chunks/persistableUrlUtils","./Symbol","./support/Thumbnail"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;return t.default=y=class extends f{constructor(e){super(e),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const e=null!=this.portal?this.portal:p.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?.portal,super.read(e,t)}clone(){return new y({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol(e)}async fetchCIMSymbol(e){i.deprecatedFunction(s.getLogger(this),"WebStyleSymbol.fetchCIMSymbol is deprecated in favour of WebStyleSymbol.fetchSymbol which now supports both web and cim symbology",{version:"4.33",replacement:"WebStyleSymbol.fetchSymbol",see:"https://arcg.is/0CXPTr#fetchSymbol",warnOnce:!0});const t=await this._fetchSymbol({...e,acceptedFormats:["cim"]});if("cim"!==t?.type)throw new o("webstylesymbol:fetchCIMSymbol","Resolved web style symbol is not of type 'cim'");return t}async _fetchSymbol(t){const r=null!=t?t.cache:null,i=r?this._fetchCacheKey:null;if(null!=r){const e=i&&r.get(i);if(e)return e.clone()}const{resolveWebStyleSymbol:o}=await new Promise(((t,r)=>e(["./support/webStyleSymbolUtils"],t,r)));n.throwIfAborted(t);const a=o(this,{portal:this.portal},t);a.catch((e=>{s.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",e)}));const l=await a;return null!=r&&r.set(i,l.clone()),l}},r.__decorate([a.property({json:{write:!1}})],t.default.prototype,"color",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.default.prototype,"styleName",void 0),r.__decorate([a.property({type:p,json:{write:!1}})],t.default.prototype,"portal",void 0),r.__decorate([a.property({type:String,json:{read:h.read,write:h.write}})],t.default.prototype,"styleUrl",void 0),r.__decorate([a.property({type:m.Thumbnail,json:{read:!1}})],t.default.prototype,"thumbnail",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.default.prototype,"name",void 0),r.__decorate([u.enumeration({styleSymbolReference:"web-style"},{readOnly:!0})],t.default.prototype,"type",void 0),r.__decorate([a.property()],t.default.prototype,"_fetchCacheKey",null),t.default=y=r.__decorate([d.subclass("esri.symbols.WebStyleSymbol")],t.default),t.default}))},"esri/renderers/support/lengthUtils":function(){define(["exports","../../core/unitUtils","../../geometry/support/Ellipsoid"],(function(e,t,r){"use strict";const i={unknown:1,inches:t.convertUnit(1,"meters","inches"),feet:t.convertUnit(1,"meters","feet"),"us-feet":t.convertUnit(1,"meters","us-feet"),yards:t.convertUnit(1,"meters","yards"),miles:t.convertUnit(1,"meters","miles"),"nautical-miles":t.convertUnit(1,"meters","nautical-miles"),millimeters:t.convertUnit(1,"meters","millimeters"),centimeters:t.convertUnit(1,"meters","centimeters"),decimeters:t.convertUnit(1,"meters","decimeters"),meters:t.convertUnit(1,"meters","meters"),kilometers:t.convertUnit(1,"meters","kilometers"),"decimal-degrees":1/t.lengthToDegrees(1,"meters",r.earth.radius)};e.meterIn=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/visualVariables/VisualVariableFactory":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/jsonMap","../../core/Logger","../../core/Warning","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./ColorVariable","./OpacityVariable","./RotationVariable","./SizeVariable"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";const f={color:u,size:h,opacity:d,rotation:p},m=new i.JSONMap({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),y=/^\[([^\]]+)\]$/i;return e.default=class extends r{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e?.filter((e=>!!e)),e?.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some((e=>!!e.target))&&e.sort(((e,t)=>{let r=null;return r=e.target===t.target?0:e.target?1:-1,r}));for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,r){const{rotationExpression:i,rotationType:n}=t,a=i?.match(y),l=a?.[1];if(l&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:l})),e)return e.map((e=>{const t=m.read(e.type),i=f[t];i||(o.getLogger(this).warn(`Unknown variable type: ${t}`),r?.messages&&r.messages.push(new s("visual-variable:unsupported",`visualVariable of type '${t}' is not supported`,{definition:e,context:r})));const n=new i;return n.read(e,r),n}))}writeVariables(e,t){const r=[];for(const i of e){const e=i.toJSON(t);e&&r.push(e)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}},t.__decorate([n.property()],e.default.prototype,"visualVariables",null),e.default=t.__decorate([c.subclass("esri.renderers.visualVariables.VisualVariableFactory")],e.default),e.default}))},"esri/renderers/support/ClassBreakInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./commonProperties"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends r{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new c({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}},t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"description",void 0),t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"label",void 0),t.__decorate([i.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],e.default.prototype,"minValue",void 0),t.__decorate([i.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],e.default.prototype,"maxValue",void 0),t.__decorate([i.property(l.requiredRendererSymbolProperty)],e.default.prototype,"symbol",void 0),e.default=c=t.__decorate([a.subclass("esri.renderers.support.ClassBreakInfo")],e.default),e.default}))},"esri/renderers/support/commonProperties":function(){define(["exports","../../core/object","../../core/accessorSupport/extensions/serializableProperty/reader","../../symbols/PolygonSymbol3D","../../symbols/Symbol","../../symbols/support/jsonUtils","../../symbols/support/typeUtils"],(function(e,t,r,i,o,s,n){"use strict";const a={types:n.symbolTypesRenderer,json:{write:{writer:s.write},origins:{"web-scene":{types:n.symbolTypesRenderer3D,write:{writer:s.write},read:{reader:r.createTypeReader({types:n.symbolTypesRenderer3D})}}}}},l=t.deepMerge({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},a),c={types:{base:o,key:"type",typeMap:{"simple-fill":n.symbolTypes.typeMap["simple-fill"],"picture-fill":n.symbolTypes.typeMap["picture-fill"],"polygon-3d":n.symbolTypes.typeMap["polygon-3d"],cim:n.symbolTypes.typeMap.cim}},json:{write:{writer:s.write},origins:{"web-scene":{type:i,write:{writer:s.write}}}}},u={cast:e=>null==e||"string"==typeof e||"number"==typeof e?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e?.toString()}}}};e.rendererBackgroundFillSymbolProperty=c,e.rendererSymbolProperty=a,e.requiredRendererSymbolProperty=l,e.uniqueValueProperty=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/jsonUtils":function(){define(["exports","../../core/Error","../../core/object","../../layers/support/layerUtils","../WebStyleSymbol","./symbolConversion","./typeUtils"],(function(e,t,r,i,o,s,n){"use strict";function a(e){return n.isSymbol3D(e)||e instanceof o}function l(e,r,o){if(null==e)return null;const{context:n,isLabelSymbol:l}=o,c=n?.origin,u=n?.messages;if("web-scene"===c&&!a(e)){const i=s.to3D(e,{retainCIM:!0,hasLabelingContext:l});return null!=i.symbol?i.symbol.write(r,n):(u?.push(new t("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:n,error:i.error})),null)}return i.isSceneServiceLayer(n?.layer)&&function(e){return"polygon-3d"===e?.type||"line-3d"===e?.type}(e)?(u?.push(new t("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported on layers of type '${n?.layer?.declaredClass}'.`,{symbol:e,context:n})),null):("web-map"===c||"portal-item"===c&&!i.isSceneServiceLayer(n?.layer))&&a(e)?(u?.push(new t("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:n})),null):e.write(r,n)}e.fromJSON=function(e,t){return n.readSymbol(e,null,t)},e.write=function(e,t,i,o){const s=l(e,{},{context:o,isLabelSymbol:!1});null!=s&&r.setDeepValue(i,s,t)},e.writeLabelSymbol=function(e,t,r,i){const o=l(e,{},{context:i,isLabelSymbol:!0});null!=o&&(t[r]=o)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/layerUtils":function(){define(["exports","../../kernel","../../request","../../core/Collection","../../core/urlUtils","../catalog/catalogUtils"],(function(e,t,r,i,o,s){"use strict";function n(e){return"scene"===e?.type}function a(e){return null!=e&&"object"==typeof e&&"type"in e&&"subtype-group"===e.type&&"sublayers"in e}function l(e){const t=e?.type;return"imagery-tile"===t||"tile"===t||"open-street-map"===t||"vector-tile"===t||"web-tile"===t||"wmts"===t}function c(e,t){return null!=e?.parent&&"declaredClass"in e.parent&&"esri.Basemap"===e.parent.declaredClass&&e.parent[t].includes(e)}function u(e){if(!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function d(e){return!e||"Feature Service"===e.type&&!e.sourceUrl}e.applyPreferredHostToPortalItem=function(e,t){if(!t||!d(e))return;const r=(e.url,null);r&&(e.url=r)},e.getEffectiveEditingEnabled=function(e){return!!function(e){if(!("editingEnabled"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}(e)&&("effectiveEditingEnabled"in e?e.effectiveEditingEnabled:e.editingEnabled)},e.getEffectiveLayerCapabilities=function(e){return u(e)?"effectiveCapabilities"in e?e.effectiveCapabilities:e.capabilities:null},e.getLayersWithChartSupport=function(e){const t=new i;for(const r of e.allLayers.concat(e.allTables))"csv"===r.type||s.isLayerFromCatalog(r)||("charts"in r&&t.push(r),"subtype-group"===r.type&&t.push(...r.sublayers));return t},e.getOwningPortalUrl=async function(e,i){const o=t.id?.findServerInfo(e);if(null!=o?.currentVersion)return o.owningSystemUrl||null;const s=e.toLowerCase().indexOf("/rest/services");if(-1===s)return null;const n=`${e.slice(0,s)}/rest/info`,a=null!=i?i.signal:null,{data:l}=await r(n,{query:{f:"json"},responseType:"json",signal:a});return l?.owningSystemUrl||null},e.getPreferredHost=function(e){return null},e.getPreferredUrl=function(e,t){return null},e.getSubtypesFromLayer=function(e){return e?("subtypes"in e?e.subtypes:a(e.parent)?e.parent.subtypes:[])??[]:[]},e.getTileMaxtrixSetFromActiveLayer=function(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const r=e.activeLayer.tileMatrixSets;if(r)return r}return null},e.isBaseLayer=function(e){return c(e,"baseLayers")},e.isBasemap3DSupportedLayer=function(e){return l(e)||n(e)},e.isBasemapSupportedTiledLayer=l,e.isFeatureCollectionLayer=function(e){return"feature"===e?.type&&!e.url&&"memory"===e.source?.type},e.isFeatureLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"feature"===e.type},e.isFeatureServiceLayer=function(e){return"feature"===e?.type&&"feature-layer"===e.source?.type},e.isGraphicsLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"graphics"===e.type},e.isGroupLayer=function(e){return null!=e&&"type"in e&&"group"===e.type},e.isImageryTileLayer=function(e){return"imagery-tile"===e?.type},e.isIntegratedMeshLayer=function(e){return"integrated-mesh"===e||"integrated-mesh-3dtiles"===e},e.isIntegratedMeshOperationalLayer=function(e){return"IntegratedMeshLayer"===e||"IntegratedMesh3DTilesLayer"===e},e.isKnowledgeGraphLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"knowledge-graph"===e.type&&"layers"in e},e.isKnowledgeGraphSublayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"knowledge-graph-sublayer"===e.type},e.isLayerWithFeatureCapabilities=u,e.isLayerWithFeatureLayerSource=function(e){const t=e?.type;return("feature"===t||"subtype-group"===t||"oriented-imagery"===t)&&"feature-layer"===e?.source?.type},e.isLayerWithFlowRenderer=function(e){return("imagery"===e.type||"imagery-tile"===e.type)&&"flow"===e.renderer?.type},e.isLinkChartLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"link-chart"===e.type&&"layers"in e},e.isMapImageLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"map-image"===e.type},e.isMapNotesLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"map-notes"===e.type&&"sublayers"in e},e.isPreferredUrlApplicable=d,e.isReferenceLayer=function(e){return c(e,"referenceLayers")},e.isSceneLayer=n,e.isSceneServiceLayer=function(e){const t=e?.type;return"building-scene"===t||"integrated-mesh"===t||"point-cloud"===t||"scene"===t},e.isSubtypeGroupLayer=a,e.isSubtypeSublayer=function(e){return"subtype-sublayer"===e?.type},e.isTable=function(e){return null!=e&&"object"==typeof e&&"isTable"in e&&!!e.isTable},e.isTiledLayer=function(e){const t=e?.type;return"base-tile"===t||"tile"===t||"elevation"===t||"imagery-tile"===t||"base-elevation"===t||"open-street-map"===t||"wcs"===t||"web-tile"===t||"wmts"===t||"vector-tile"===t},e.isVoxelLayer=function(e){return"voxel"===e?.type},e.sceneServiceLayerTypeToClassName={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"},e.serializeLayerDefinitions=function(e){const t=/[:;]/,r=[];let i=!1;if(e&&(e.forEach(((e,o)=>{r.push([o,e]),!i&&t.test(e)&&(i=!0)})),r.length>0)){let e;if(i){const t={};r.forEach((e=>{t[e[0]]=e[1]})),e=JSON.stringify(t)}else{const t=[];r.forEach((e=>{t.push(e[0]+":"+e[1])})),e=t.join(";")}return e}return null},e.serializeTimeOptions=function(e){if(!e)return;const t=[];return e.forEach(((e,r)=>{t.push('"'+r+'":'+JSON.stringify(e))})),t.length?"{"+t.join(",")+"}":void 0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/catalog/catalogUtils":function(){define(["exports","../../core/handleUtils","../../core/reactiveUtils"],(function(e,t,r){"use strict";const i=new WeakMap;e.getCatalogLayerForLayer=function(e){return e.parent&&"type"in e.parent&&"catalog-dynamic-group"===e.parent.type?e.parent.parent:null},e.isCatalogSublayer=function(e,t){const r=e.parent,i=e.layer;if("map-image"!==i?.type||!i.sourceJSON||!r)return!1;const o=i.sourceJSON.layers;if(!o)return!1;const s=o.find((t=>e.id===t.id)),n="footprints"===t?"Feature Layer":"Catalog Dynamic Group Layer";return s?.type===n&&"Catalog Layer"===o.find((e=>e.id===r.id))?.type},e.isLayerFromCatalog=function e(o){return!o.destroyed&&(i.has(o)||o.addHandles([r.watch((()=>{const t=o.parent;return!(!t||!("type"in t))&&("catalog-dynamic-group"===t.type||e(t))}),(e=>i.set(o,e)),r.syncAndInitial),t.makeHandle((()=>i.delete(o)))]),i.get(o))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/symbolConversion":function(){define(["exports","../../core/Error","../LabelSymbol3D","../LineSymbol3D","../MeshSymbol3D","../PictureMarkerSymbol","../PointSymbol3D","../PolygonSymbol3D","../SimpleFillSymbol","../SimpleLineSymbol","../SimpleMarkerSymbol","../TextSymbol","../WebStyleSymbol","./defaults3D","./typeUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";const m="#useCIMFallbackSymbology()",y={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};e.defaultTo3DOptions=y,e.to3D=function(e,g=y){if(!e)return{symbol:null};const{retainId:b=y.retainId,ignoreDrivers:v=y.ignoreDrivers,hasLabelingContext:S=y.hasLabelingContext,retainCIM:_=y.retainCIM,cimFallbackEnabled:x=y.cimFallbackEnabled}=g;let w=null;if(f.isSymbol3D(e)||e instanceof p)w=e.clone();else if("cim"===e.type){const r=e.data?.symbol?.type;switch(r){case"CIMPointSymbol":w=_?e.clone():n.fromCIMSymbol(e);break;case"CIMLineSymbol":x&&(w=h.defaultRendererPolylineSymbol3D.clone(),g?.logWarning?.(m,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":x&&(w=h.defaultRendererPolygonSymbol3D.clone(),g?.logWarning?.(m,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!w)return{error:new t("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${r||"unknown"}' is unsupported in 3D`,{symbol:e})}}else if(e instanceof c)w=i.fromSimpleLineSymbol(e);else if(e instanceof u)w=n.fromSimpleMarkerSymbol(e);else if(e instanceof s)w=n.fromPictureMarkerSymbol(e);else if(e instanceof l)w=g.geometryType&&"mesh"===g.geometryType?o.fromSimpleFillSymbol(e):a.fromSimpleFillSymbol(e);else{if(!(e instanceof d))return{error:new t("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};w=S?r.fromTextSymbol(e):n.fromTextSymbol(e)}return b&&w&&"cim"!==w.type&&(w.id=e.id),!v||"cim"===w.type||w instanceof p||w.symbolLayers.forEach((e=>e.ignoreDrivers=!0)),{symbol:w}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/defaults3D":function(){define(["exports","../../Color","../../core/Collection","../../core/has","../../core/screenUtils","../FillSymbol3DLayer","../LineSymbol3D","../LineSymbol3DLayer","../MeshSymbol3D","../PointSymbol3D","../PolygonSymbol3D","../edges/SolidEdges3D","./defaults","./defaultsJSON"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";const f=c.fromSimpleMarkerSymbol(p.defaultPointSymbol2D),m=n.fromSimpleLineSymbol(p.defaultPolylineSymbol2D),y=u.fromSimpleFillSymbol(p.defaultPolygonSymbol2D),g=new l({symbolLayers:new r([new s({material:{color:h.defaultColor},edges:new d({size:o.px2pt(1),color:new t(h.defaultOutlineColor)})})])}),b=new n({symbolLayers:new r([new a({material:{color:new t([0,0,0])},size:o.px2pt(1)})])}),v=new u({symbolLayers:new r([new s({outline:{color:new t([0,0,0]),size:o.px2pt(1)}})])});e.defaultRendererPolygonSymbol3D=v,e.defaultRendererPolylineSymbol3D=b,e.getDefaultSymbol3D=function(e){if(null==e)return null;switch(e.type){case"mesh":return g;case"point":case"multipoint":return f;case"polyline":return m;case"polygon":case"extent":return y}return null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/defaults":function(){define(["exports","../../core/has","../SimpleFillSymbol","../SimpleLineSymbol","../SimpleMarkerSymbol","../TextSymbol","./defaultsJSON"],(function(e,t,r,i,o,s,n){"use strict";const a=o.fromJSON(n.defaultPointSymbolJSON),l=i.fromJSON(n.defaultPolylineSymbolJSON),c=r.fromJSON(n.defaultPolygonSymbolJSON),u=s.fromJSON(n.defaultTextSymbolJSON),d=o.fromJSON(n.errorPointSymbolJSON),p=i.fromJSON(n.errorPolylineSymbolJSON),h=r.fromJSON(n.errorPolygonSymbolJSON);e.defaultPointSymbol2D=a,e.defaultPolygonSymbol2D=c,e.defaultPolylineSymbol2D=l,e.defaultTextSymbol2D=u,e.errorPointSymbol2D=d,e.errorPolygonSymbol2D=h,e.errorPolylineSymbol2D=p,e.getDefaultSymbol2D=function(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return a;case"polyline":return l;case"polygon":case"extent":return c}return null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/defaultsJSON":function(){define(["exports"],(function(e){"use strict";const t=[252,146,31,255],r={type:"esriSMS",style:"esriSMSCircle",size:6,color:t,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},i={type:"esriSLS",style:"esriSLSSolid",width:.75,color:t};e.defaultColor=t,e.defaultOutlineColor=[153,153,153,255],e.defaultPointSymbolJSON=r,e.defaultPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},e.defaultPolylineSymbolJSON=i,e.defaultTextSymbolJSON={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},e.errorPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},e.errorPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},e.errorPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/support/RendererLegendOptions":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;const d=r.strict()({ascendingValues:"ascending-values",descendingValues:"descending-values"});let p=u=class extends(t.ClonableMixin(i)){static from(e){return s.ensureClass(u,e)}constructor(e){super(e),this.title=null,this.order=null}};return e.__decorate([o.property({type:String,json:{write:!0}})],p.prototype,"title",void 0),e.__decorate([l.enumeration(d)],p.prototype,"order",void 0),p=u=e.__decorate([c.subclass("esri.renderers.support.RendererLegendOptions")],p),p}))},"esri/renderers/DictionaryRenderer":function(){define(["exports","../chunks/tslib.es6","../request","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../layers/support/fieldUtils","./Renderer","./mixins/VisualVariablesMixin","./support/DictionaryLoader"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;return e.default=h=class extends(d.VisualVariablesMixin(u)){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){const e=this.getDictionaryInfo();return new p.DictionaryLoader(this.url,this.config,this.fieldMap??{},e)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,i){i?.origin||super.writeVisualVariables(e,t,r,i)}clone(){return new h({config:i.clone(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:i.clone(this.fieldMap),url:i.clone(this.url),visualVariables:i.clone(this.visualVariables)})}async getSymbolAsync(e,t,r=!0){return this._loader.getSymbolAsync(e,t,r)}async getSymbolForControlString(e,t,r){return this._loader.getSymbolForControlString(e,t,r)}getDictionaryInfo(){return this._dictionaryInfoPromise||(this._dictionaryInfoPromise=this._fetchDictionaryInfo()),this._dictionaryInfoPromise}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await c.collectArcadeFieldNames(e,t,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];t.has(i)&&e.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}get symbols(){return[]}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}async _fetchDictionaryInfo(){const{data:e}=await r(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"}});return e}},t.__decorate([o.property({type:p.DictionaryLoader})],e.default.prototype,"_loader",null),t.__decorate([o.property({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],e.default.prototype,"config",void 0),t.__decorate([o.property({type:Object,json:{write:!0}})],e.default.prototype,"fieldMap",void 0),t.__decorate([o.property({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],e.default.prototype,"scaleExpression",void 0),t.__decorate([l.writer("scaleExpression")],e.default.prototype,"writeData",null),t.__decorate([o.property({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],e.default.prototype,"scaleExpressionTitle",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.default.prototype,"url",void 0),t.__decorate([l.writer("visualVariables")],e.default.prototype,"writeVisualVariables",null),e.default=h=t.__decorate([a.subclass("esri.renderers.DictionaryRenderer")],e.default),e.default}))},"esri/renderers/support/DictionaryLoader":function(){define(["require","exports","../../request","../../core/lang","../../core/LRUCache","../../geometry/support/jsonUtils","./DictionaryControlString","./DictionaryScriptEvaluator","../../support/ArcadeExpression","../../symbols/CIMSymbol","../../symbols/cim/utils"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";const d={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};function p(e,t,r){if(!e||0===e.length)return null;const i={...e[0]};if(e.length>1){i.effects=null,i.symbolLayers=[];for(const t of e){const e=t;if(null!=e.effects)for(const t of e.symbolLayers)null==t.effects?t.effects=e.effects:t.effects.unshift(...e.effects);i.symbolLayers.unshift(...e.symbolLayers)}}return r&&(i.callout=d),{type:"CIMSymbolReference",symbol:i,primitiveOverrides:t}}t.DictionaryLoader=class{constructor(e,t,r,i){this.url=e,this.fieldMap=r,this.dictionaryInfo=i,this._symbolPartCache=new o.LRUCache(100),this._evaluator=(async()=>a.DictionaryScriptEvaluator.from(await i,t,r))()}async getSymbolAsync(e,t,r=!0){const i=await this._evaluator,o=t?.fields??l.deriveFields(e.attributes),a=i.createDictionaryFieldsIndex(o),c=i.evaluate(e,t?.scale??0,a,t?.spatialReference);if(null==c)return null;const u=s.getJsonType(e.geometry),d=n.DictionaryControlString.parse(c,i.itemNames,u),p="esriGeometryPoint"===u&&!e.geometry?.hasZ;return await this._cimPartsToCIMSymbol(e,d.partNames,d.overrides,p,t,r,a)}async getSymbolForControlString(e,t,r){const i=await this._evaluator,o=n.DictionaryControlString.parse(e,i.itemNames,t),s="esriGeometryPoint"===t&&!r,a=p(await Promise.all(o.partNames.map((e=>this._getSymbolPart(e)))),o.overrides,s);return new c({data:a})}async _cimPartsToCIMSymbol(t,r,o,s,n,a,l){const d=r.map((e=>this._getSymbolPart(e,n)));let h=await Promise.all(d);if(a&&this.fieldMap&&h.length>0){const{OverrideHelper:r}=await new Promise(((t,r)=>e(["../../symbols/cim/OverrideHelper"],t,r)));h=i.clone(h);for(const e of h)r.applyDictionaryTextOverrides(e,t,this.fieldMap,l,u.getTextCasing(e))}const f=p(h,o,s);return new c({data:f})}async _fetchSymbolPart(e,t){const i=await this.dictionaryInfo,o=(this.url+"/"+i.cimRefTemplateUrl).replaceAll(/\{itemName\}/gi,e),{data:s}=await r(o,{responseType:"json",query:{f:"json"},...t});return s}async _getSymbolPart(e,t){let r=this._symbolPartCache.get(e);return r||(r=this._fetchSymbolPart(e,t),this._symbolPartCache.put(e,r)),r}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/support/DictionaryControlString":function(){define(["exports","../../Color"],(function(e,t){"use strict";class r{static parse(e,t,s){const n=[],a=[],l=e.split(";");for(let e=0;e<l.length;e++){const r=l[e];if(r)if(r.includes("po:")){const e=r.slice(3).split("|");if(3===e.length){const[t,r,o]=e,s=i(t,r,o);s&&a.push(s)}}else if(r.includes("|")){for(const e of r.split("|"))if(t.has(e)){n.push(e);break}}else if(t.has(r))n.push(r);else if(0===e){n.length=0,n.push(o(s));break}}return new r(n,a)}constructor(e,t){this.partNames=e,this.overrides=t}}function i(e,r,i){const o=function(e,r){if("DashTemplate"===e)return r.split(" ").map((e=>Number(e)));if("Color"===e){const e=new t(r).toRgba();return[e[0],e[1],e[2],255*e[3]]}return Number(r)}(r,i);return{primitiveName:e,propertyName:r,value:o,defaultValue:null}}function o(e){switch(e){case"esriGeometryPolyline":return"Invalid_L";case"esriGeometryPolygon":return"Invalid_A";default:return"Invalid_P"}}e.DictionaryControlString=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/support/DictionaryScriptEvaluator":function(){define(["exports","../../core/Error","../../core/Logger","../../core/Version","../../layers/support/FieldsIndex","../../support/ArcadeExpression"],(function(e,t,r,i,o,s){"use strict";class n{static async from(e,o,l){const c=e.dictionary_version?i.Version.parse(e.dictionary_version):null,u=new Set(e.itemsNames),d={};if(o)for(const e in o)d[e]=o[e];if(e.authoringInfo.configuration)for(const t of e.authoringInfo.configuration)d.hasOwnProperty(t.name)||(d[t.name]=t.value);const p=new Set(e.authoringInfo.symbol);for(const e of Object.keys(l))p.delete(e);p.size&&r.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("missing-fields: fieldMap entries for the following symbol fields are missing",{symbolFields:p});const h=await s.createDictionaryExpression(e.expression,null,d);if(!h)throw new t("dictionary-renderer:expression-error","Unable to create dictionary renderer expression");const f=!c||!c.greaterEqual(4,0);f&&r.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("Dictionary script does not support native field types. Applying fallback",{version:c});const m=new a(l,f);return new n(f,u,h,m)}constructor(e,t,r,i){this._requiresFieldCoercionToString=e,this._itemNames=t,this._compiled=r,this._reader=i}get itemNames(){return this._itemNames}evaluate(e,t,i,o){try{return this._reader.bind(e,i,o),this._compiled.evaluate(this._reader,{$view:{scale:t}})}catch(e){r.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("arcade: dictionary script evaluation failed",{error:e})}return null}createDictionaryFieldsIndex(e){if(!this._requiresFieldCoercionToString)return new o(e);const t=e.map((e=>({...e,type:"esriFieldTypeString"})));return new o(t)}}class a extends s.ArcadeFeatureReader{constructor(e,t){super(),this._fieldMap=e,this._requiresFieldCoercionToString=t}_getField(e){const t=this._fieldMap[e]??e;return this._boundSchema.fieldsIndex.get(t)}field(e){if(!this._requiresFieldCoercionToString)return super.field(e,!1);const t=this._getField(e);return null==t||null==this._boundTarget.attributes[t.name]?"":""+this._boundTarget.attributes[t.name]}}e.DictionaryScriptEvaluator=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/Version":function(){define(["exports","./Error"],(function(e,t){"use strict";e.Version=class e{constructor(e,t,r=""){this.major=e,this.minor=t,this._context=r}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}greaterEqual(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new t(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new e(this.major,this.minor,this._context)}static parse(r,i=""){const[o,s]=r.split("."),n=/^\s*\d+\s*$/;if(!o?.match||!n.test(o))throw new t((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:r});if(!s?.match||!n.test(s))throw new t((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:r});const a=parseInt(o,10),l=parseInt(s,10);return new e(a,l,i)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/ArcadeExpression":function(){define(["exports","../arcade/ArcadeDate","../core/Error","../core/has","../core/sql/DateOnly","../core/sql/TimeOnly","../geometry/support/jsonUtils","../layers/support/FieldsIndex","./loadArcade","../time/constants"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=["geometry","scale","timeProperties"];class d{static async create(e,t,i,o){const{arcade:s,Dictionary:n}=await l.loadArcade();let a;try{a=s.parseScript(e)}catch(t){throw new r("arcade-bad-expression","Failed to parse arcade script",{script:e,error:t})}const c=s.scriptUsesGeometryEngine(a);c&&await s.enableGeometrySupport(),await s.loadDependentModules(new Set,a,null,!1,c);const u={vars:o.reduce(((e,t)=>({...e,[t]:null})),{}),spatialReference:t,useAsync:!1},p=s.compileScript(a,u);let h=null;null!=i&&(h=new n(i),h.immutable=!0);const f=new n;return f.immutable=!1,f.setField("scale",0),new d(e,s,a,p,t,f,h,n)}constructor(e,t,r,i,o,s,n,a){this.script=e,this._arcade=t,this._syntaxTree=r,this._compiled=i,this._spatialReference=o,this._viewDict=s,this._configDict=n,this._dictionaryCtor=a,this._dependencies=new Map,this._featureReader=new p,this._dependencies.set("geometry",t.scriptTouchesGeometry(this._syntaxTree)),this._dependencies.set("scale",this._arcade.referencesMember(this._syntaxTree,"scale")),this._dependencies.set("timeProperties",this._arcade.scriptUsesViewProperties(this._syntaxTree,["timeProperties"]))}evaluate(e,r){const i=r.$view?.timeZone;if(r.$view){let e;if(this._viewDict.setField("scale",r.$view.scale),null!=r.$view.timeProperties){const{currentStart:o,currentEnd:s}=r.$view.timeProperties;e=new this._dictionaryCtor({currentStart:null!=o?null!=i?t.ArcadeDate.epochToArcadeDate(o,i):t.ArcadeDate.unknownEpochToArcadeDate(o):void 0,currentEnd:null!=s?null!=i?t.ArcadeDate.epochToArcadeDate(s,i):t.ArcadeDate.unknownEpochToArcadeDate(s):void 0,startIncluded:!0,endIncluded:!0})}this._viewDict.setField("timeProperties",e)}return this._compiled({vars:{$view:this._viewDict,$config:this._configDict,$feature:e},spatialReference:this._spatialReference,timeZone:i})}repurposeFeature(e,t){return this._featureReader.bind(e,t,this._spatialReference),this._featureReader}references(e){return this._dependencies.get(e)??!1}}class p{constructor(){this._boundTarget=null,this._boundSchema={fields:null,fieldsIndex:null,spatialReference:null,get geometryType(){return null},get objectIdField(){return null}},this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}bind(e,t,r){const i=t??new a(h(e.attributes));this._boundTarget=e,this._boundSchema.fields=i.fields,this._boundSchema.fieldsIndex=i,this._boundSchema.spatialReference=r}_getField(e){return this._boundSchema.fieldsIndex.get(e)}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(e){this._contextTimeZone=e}readArcadeFeature(){return this}hasField(e){return this._boundSchema.fieldsIndex.has(e)}geometry(){if("fromJSON"in this._boundTarget)return this._boundTarget.geometry;const e=n.fromJSON(this._boundTarget.geometry);if(e){if(!this._boundSchema.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");e.spatialReference=this._boundSchema.spatialReference}return e}isUnknownDateTimeField(e){return this._boundSchema.fieldsIndex.getTimeZone(e)===c.unknown}field(e,r=!0){const i=this._getField(e);if(i){const r=this._boundTarget.attributes[i.name];if(null==r)return null;switch(i.type){case"date-only":case"esriFieldTypeDateOnly":return o.DateOnly.fromReader(r);case"time-only":case"esriFieldTypeTimeOnly":return s.TimeOnly.fromReader(r);case"esriFieldTypeTimestampOffset":case"timestamp-offset":return t.ArcadeDate.fromReaderAsTimeStampOffset(r);case"date":case"esriFieldTypeDate":return this.isUnknownDateTimeField(e)?t.ArcadeDate.unknownEpochToArcadeDate(r):t.ArcadeDate.epochToArcadeDate(r,this.contextTimeZone??c.system);default:return r}}if(r)throw new Error(`Field ${e} does not exist`);return null}setField(e,t){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this._boundSchema.fieldsIndex.fields.map((e=>e.name))}castToText(e=!1){return JSON.stringify(this._boundTarget)}gdbVersion(){return null}fullSchema(){return this._boundSchema}castAsJson(e=null){return{attributes:this._boundTarget.attributes,geometry:!0===e?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(e=null,t=null){return Promise.resolve(this.castAsJson(t))}}function h(e){const t=[];for(const r in e)t.push({name:r,alias:r,type:"string"==typeof e[r]?"esriFieldTypeString":"esriFieldTypeDouble"});return t}e.ArcadeExpression=d,e.ArcadeFeatureReader=p,e.collectExpressionDependencies=function(e,t){if(null!=t)for(const r of u)t.hasArcadeDependency(r)&&e.add(r);return e},e.createDictionaryExpression=function(e,t,r){return d.create(e,t,r,["$feature","$view","$config"])},e.createLabelExpression=function(e,t){return d.create(e,t,null,["$feature","$view"])},e.createRendererExpression=function(e,t){return d.create(e,t,null,["$feature","$view"])},e.deriveFields=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/cim/utils":function(){define(["require","exports","./defaultCIMValues"],(function(e,t,r){"use strict";function i(e){return"function"==typeof e}function o(e){let t=e.length;for(;t--;)if(!" /-,\n".includes(e.charAt(t)))return!1;return!0}function s(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function n(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function a(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}function l(e){return e?e.charAt(0).toLowerCase()+e.slice(1):e}function c(e,t){if("color"===t||"outlinecolor"===t||"backgroundcolor"===t||"borderlinecolor"===t||"tintcolor"===t)return[...r.defaultCIMColor[t]];const i=r.defaultCIMValues[e];if(!i)throw new Error(`InternalError: default value for type ${e}.`);return i[t]}function u(e){return e.split(" ").map((e=>Number(e)))}function d(e){return"string"==typeof e?u(e):e}function p(e,t){if(null!==t){const r=t.get(e);return r?r.name:e}return e}function h(e,t,r,i,o){const s=r*Math.PI/180;if(s){const r=Math.cos(s);return(Math.sin(s)*e+r*t)*i+o}return t*i+o}function f(e,t,r,i,o){const s=r*Math.PI/180;return s?(Math.cos(s)*e-Math.sin(s)*t)*i+o:e*i+o}function m(e,t,r){return t?r-e:r+e}t.adjustTextCase=s,t.analyzeTextParts=function(e,t){const r=[];let i=0,s=-1;do{if(s=e.indexOf("[",i),s>=i){if(s>i){const t=e.slice(i,s);r.push([t,null,o(t)])}if(i=s+1,s=e.indexOf("]",i),s>=i){if(s>i){const o=t[e.slice(i,s)];o&&r.push([null,o,!1])}i=s+1}}}while(-1!==s);if(i<e.length){const t=e.slice(i);r.push([t,null,o(t)])}return r},t.applyParentTransform=function(e,t,r,i,o,s,n=!0){const{infos:a}=s;let l=1,c=0,u=0,d=0,p=1;for(const{absoluteAnchorPoint:e,offsetX:t,offsetY:r,rotation:i,size:o,frameHeight:s,rotateClockWise:y,scaleSymbolsProportionally:g}of a)p=e?1:l,u=f(t,r,c,p,u),d=h(t,r,c,p,d),s&&(g||n)&&(l*=o/s),c=m(i,y,c);const y=f(i,o,c,p,u),g=h(i,o,c,p,d);return{size:e*l,rotation:m(t,r,c),offsetX:y,offsetY:g}},t.assignTextValuesFromFeature=function(e,t,r,i){let o="",n=null;for(const i of t){const[t,s,a]=i;if(null!=t&&""!==t)a?n=t:(null!=n&&(o+=n,n=null),o+=t);else{let t=s;null!=r&&(t=p(s,r));const i=e.attributes[t];null!=i&&""!==i&&(null!=n&&(o+=n,n=null),o+=i)}}return s(o,i)},t.attributesToFields=function(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))},t.colorToArray=function(e){return[e.r,e.g,e.b,e.a]},t.evaluateValueOrFunction=function(e,t,r,o){return i(e)?e(t,r,o):e},t.fromCIMFontDecoration=function(e){return e.underline?"underline":e.strikethrough?"line-through":"none"},t.fromCIMFontStyle=function(e){let t="normal",r="normal";if(e){const i=e.toLowerCase();i.includes("italic")?t="italic":i.includes("oblique")&&(t="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:t,weight:r}},t.fromCIMHorizontalAlignment=function(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}},t.fromCIMVerticalAlignment=function(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}},t.getDefaultCIMValue=c,t.getEnum=(e,t)=>e??t,t.getFieldName=p,t.getFillColor=function e(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const r of t.symbolLayers){const t=e(r);if(null!=t)return t}break;case"CIMTextSymbol":return e(t.symbol);case"CIMSolidFill":return t.color}return null},t.getFontStyle=function(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}},t.getFontWeight=function(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}},t.getNumericValue=(e,t=0)=>null==e||isNaN(e)?t:e,t.getProcessParam=function(e,t,r){const i="Color"===r||"TintColor"===r||"ToColor"===r,o="Rotation"===r||"Angle"===r||"ToRotation"===r;let s=t[l(r)];if(null!=s&&(i?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:o&&(s*=Math.PI/180)),null==s&&(s=c(t.type,r.toLowerCase()),null!=s&&(i?s=[s[0]/255,s[1]/255,s[2]/255,s[3]]:o&&(s*=Math.PI/180))),null!=t.primitiveName){const n=e[t.primitiveName];if(null!=n){const e=n[r];null==e||("string"==typeof e||"number"==typeof e||Array.isArray(e)?(s=e,null!=s&&(i?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:o&&(s*=Math.PI/180))):(s={valueExpressionInfo:e,defaultValue:s},null!=s&&(i?s={type:"Process",op:"ArcadeColor",value:s}:o&&(s={type:"Process",op:"Divide",left:s,right:180/Math.PI}))))}}if(null==s)throw new Error(`Failed to derive a value or an expression for "${r}".`);return s},t.getRelativeGradientSize=function(e,t){return Math.max(Math.min((e??t)/100,1),0)},t.getSize=function(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const i of e.symbolLayers)if(i)switch(i.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=i.size??r.defaultCIMValues.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const i of e.symbolLayers)if(i)switch(i.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=i.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(i.markerPlacement&&a(i.markerPlacement)){const e=i.size??r.defaultCIMValues.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=i.height;null!=e&&e>t&&(t=e)}}return t}}},t.getStrokeColor=function e(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const r=t.symbolLayers;if(r)for(const t of r){const r=e(t);if(null!=r)return r}break}case"CIMTextSymbol":return e(t.symbol);case"CIMSolidStroke":return t.color}},t.getStrokeWidth=function e(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const r of t.symbolLayers){const t=e(r);if(void 0!==t)return t}break;case"CIMTextSymbol":return e(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}},t.getTextCasing=function e(t){if(null==t)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=t.symbolLayers;if(!r)return"Normal";for(const t of r)if("CIMVectorMarker"===t.type)return e(t)}break;case"CIMVectorMarker":{const r=t.markerGraphics;if(!r)return"Normal";for(const t of r)if(t.symbol)return e(t.symbol)}}return"Normal"},t.getTextValuesFromFeatureHandle=function(e,t,r){let i="",o=null;for(const r of t){const[t,s,n]=r;if(null!=t&&""!==t)n?o=t:(null!=o&&(i+=o,o=null),i+=t);else{const t=e.readAttribute(s);null!=t&&""!==t&&(null!==o&&(i+=o,o=null),i+=t)}}return s(i,r)},t.getTintColor=e=>e.tintColor?n(e.tintColor):[255,255,255,1],t.getValue=(e,t)=>null!=e?e:t,t.hasProcessParam=function(e,t,r){if(null!=t[l(r)])return!0;if(null!=t.primitiveName){const i=e[t.primitiveName];if(null!=i&&null!=i[r])return!0}return!1},t.hasStrokeLayer=function(e){for(const t of e)if(t.enable)switch(t.type){case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return!0}return!1},t.importGeometryEngine=function(){return new Promise(((t,r)=>e(["../../geometry/geometryEngineJSON"],t,r)))},t.isCIMFill=function(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)},t.isCIMMarker=function(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type},t.isCIMMarkerStrokePlacement=a,t.isCIMStroke=function(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type},t.isFeatureValueFn=i,t.isGeometryEngineRequired=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectDonut":case"CIMGeometricEffectOffset":case"CIMGeometricEffectTaperedPolygon":case"CIMGeometricEffectEnclosingPolygon":return!0}return!1},t.isSVGImage=e=>e.includes("data:image/svg+xml"),t.isValidCIMValue=function e(t){if(null==t)return!1;if(Array.isArray(t))return t.every((t=>e(t)));switch(typeof t){case"string":return!!t;case"number":return!isNaN(t)}},t.mapCIMSymbolToGeometryType=function(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}},t.normalizeAlpha=n,t.normalizeDashEffectTemplate=function(e){return e?.dashTemplate&&(e.dashTemplate=d(e.dashTemplate)),e},t.normalizeDashTemplate=d,t.normalizePrimitiveOverrideProps=function(e){return e.map((e=>({...e,propertyName:l(e.propertyName)})))},t.parseDashTemplate=u,t.resampleHermite=function(e,t,r,i,o,s,n=!0){const a=t/o,l=r/s,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let r=0;r<s;r++)for(let d=0;d<o;d++){const p=4*(d+(n?s-r-1:r)*o);let h=0,f=0,m=0,y=0,g=0,b=0,v=0;const S=(r+.5)*l;for(let i=Math.floor(r*l);i<(r+1)*l;i++){const r=Math.abs(S-(i+.5))/u,o=(d+.5)*a,s=r*r;for(let r=Math.floor(d*a);r<(d+1)*a;r++){let n=Math.abs(o-(r+.5))/c;const a=Math.sqrt(s+n*n);a>=-1&&a<=1&&(h=2*a*a*a-3*a*a+1,h>0&&(n=4*(r+i*t),v+=h*e[n+3],m+=h,e[n+3]<255&&(h=h*e[n+3]/250),y+=h*e[n],g+=h*e[n+1],b+=h*e[n+2],f+=h))}}i[p]=y/f,i[p+1]=g/f,i[p+2]=b/f,i[p+3]=v/m}},t.toCIMSymbolJSON=function(e){return e.data?.symbol??null},t.toLowerCaseProps=function(e){const t={};for(const r in e){const i=e[r];t[l(r)]=i}return t},t.uncapitalize=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/cim/defaultCIMValues":function(){define(["exports","./enums"],(function(e,t){"use strict";const r={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1,gradientMethod:"AcrossLine",gradientSize:75,gradientSizeUnits:t.SymbolUnits.Relative,gradientType:"Discrete",interval:5},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGradientFill:{enable:!0,angle:90,gradientMethod:"Linear",gradientSize:75,gradientSizeUnits:t.SymbolUnits.Relative,gradientType:"Discrete",interval:5},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRadial:{angle:0,length:5},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:t.AnimatedSymbolRepeatType.Loop,repeatdelay:0,easing:t.AnimatedSymbolEasingType.Linear},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0,rotateclockwise:!1},CIMSymbolAnimationOffset:{offsetx:0,offsety:0},CIMSymbolAnimationMoveAlongLine:{speed:30,distanceAlong:100}};e.defaultCIMColor={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},e.defaultCIMValues=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/DotDensityRenderer":function(){define(["exports","../chunks/tslib.es6","../Color","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","./Renderer","./mixins/VisualVariablesMixin","./support/AttributeColorInfo","./support/DotDensityLegendOptions","../symbols/SimpleFillSymbol","../symbols/SimpleLineSymbol"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;return e.default=y=class extends(d.VisualVariablesMixin(u)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new r([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new m,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new f({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new y({attributes:i.clone(this.attributes),backgroundColor:i.clone(this.backgroundColor),dotBlendingEnabled:i.clone(this.dotBlendingEnabled),dotShape:i.clone(this.dotShape),dotSize:i.clone(this.dotSize),dotValue:i.clone(this.dotValue),legendOptions:i.clone(this.legendOptions),outline:i.clone(this.outline),referenceScale:i.clone(this.referenceScale),seed:i.clone(this.seed),visualVariables:i.clone(this.visualVariables),authoringInfo:i.clone(this.authoringInfo)})}getControllerHash(){const e=this.attributes?.map((e=>e.field||e.valueExpression||""));return`${e}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes??[])r.valueExpression&&await c.collectArcadeFieldNames(e,t,r.valueExpression),r.field&&e.add(r.field)}},t.__decorate([o.property({type:[p],json:{write:!0}})],e.default.prototype,"attributes",void 0),t.__decorate([o.property({type:r,json:{write:!0}})],e.default.prototype,"backgroundColor",void 0),t.__decorate([o.property({type:Boolean,json:{write:!0}})],e.default.prototype,"dotBlendingEnabled",void 0),t.__decorate([o.property({type:String,json:{write:!1}})],e.default.prototype,"dotShape",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"dotSize",void 0),t.__decorate([o.property({type:h,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([o.property({type:m,json:{default:null,write:!0}})],e.default.prototype,"outline",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"dotValue",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"referenceScale",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"seed",void 0),t.__decorate([a.enumeration({dotDensity:"dot-density"})],e.default.prototype,"type",void 0),e.default=y=t.__decorate([l.subclass("esri.renderers.DotDensityRenderer")],e.default),e.default}))},"esri/renderers/support/AttributeColorInfo":function(){define(["../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/ensureType"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;let d=u=class extends r{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?(i.getLogger(this).error(".field: field must be a string value"),null):c.ensureString(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new u({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};return e.__decorate([o.property({type:t,json:{type:[Number],write:!0}})],d.prototype,"color",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"field",void 0),e.__decorate([s.cast("field")],d.prototype,"castField",null),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"label",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"valueExpression",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"valueExpressionTitle",void 0),d=u=e.__decorate([l.subclass("esri.renderers.support.AttributeColorInfo")],d),d}))},"esri/renderers/support/DotDensityLegendOptions":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t{constructor(){super(...arguments),this.unit=null}clone(){return new a({unit:this.unit})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"unit",void 0),l=a=e.__decorate([n.subclass("esri.renderers.support.DotDensityLegendOptions")],l),l}))},"esri/renderers/HeatmapRenderer":function(){define(["exports","../chunks/tslib.es6","../Color","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","./Renderer","./support/AuthoringInfo","./support/HeatmapColorStop","./support/HeatmapLegendOptions","./support/heatmapUtils","../symbols/SimpleMarkerSymbol"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";var g;function b(e){if(null!=e){const{maxDensity:t,minDensity:r,radius:i}=e;if(null!=t||null!=r||null!=i){const{blurRadius:t,maxPixelIntensity:r,minPixelIntensity:i,...o}=e;return o}}return e}return e.default=g=class extends d{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new h({ratio:0,color:new r("rgba(255, 140, 0, 0)")}),new h({ratio:.75,color:new r("rgba(255, 140, 0, 1)")}),new h({ratio:.9,color:new r("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(e){return b(e)}get blurRadius(){return m.kernelDensityRadiusPtToGaussianBlurRadiusPx(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",m.gaussianBlurRadiusPxToKernelDensityRadiusPt(e)),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(m.magicKernelDensityRadiusInflationFactor**2*this.blurRadius**4)}read(e,t){e=b(e),super.read(e,t)}getSymbol(){return new y}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const r=this.field,i=this.valueExpression;r&&"string"==typeof r&&u.collectField(e,t,r),i&&"string"==typeof i&&await u.collectArcadeFieldNames(e,t,i)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new g({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:i.clone(this.colorStops),field:this.field,legendOptions:i.clone(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}},t.__decorate([s.property({type:p,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],e.default.prototype,"authoringInfo",void 0),t.__decorate([s.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],e.default.prototype,"blurRadius",null),t.__decorate([s.property({type:[h],json:{write:{isRequired:!0}}})],e.default.prototype,"colorStops",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"field",void 0),t.__decorate([s.property({type:f.HeatmapLegendOptions,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"maxDensity",void 0),t.__decorate([s.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],e.default.prototype,"maxPixelIntensity",null),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"minDensity",void 0),t.__decorate([s.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],e.default.prototype,"minPixelIntensity",null),t.__decorate([s.property({type:Number,cast:o.toPt,json:{write:!0}})],e.default.prototype,"radius",void 0),t.__decorate([s.property({type:Number,range:{min:0},json:{default:0,write:!0}})],e.default.prototype,"referenceScale",void 0),t.__decorate([l.enumeration({heatmap:"heatmap"})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],e.default.prototype,"valueExpression",void 0),t.__decorate([s.property({type:String})],e.default.prototype,"valueExpressionTitle",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"_pixelIntensityToDensity",null),e.default=g=t.__decorate([c.subclass("esri.renderers.HeatmapRenderer")],e.default),e.default}))},"esri/renderers/support/HeatmapColorStop":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends i{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new c({color:this.color&&this.color.clone(),ratio:this.ratio})}},t.__decorate([o.property({type:r,json:{type:[s.Integer],default:null,write:{isRequired:!0}}})],e.default.prototype,"color",void 0),t.__decorate([o.property({type:Number,json:{write:{isRequired:!0}}})],e.default.prototype,"ratio",void 0),e.default=c=t.__decorate([l.subclass("esri.renderers.support.HeatmapColorStop")],e.default),e.default}))},"esri/renderers/support/HeatmapLegendOptions":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l){"use strict";e.HeatmapLegendOptions=class extends(r.ClonableMixin(i)){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}},t.__decorate([o.property({type:String,json:{write:!0}})],e.HeatmapLegendOptions.prototype,"minLabel",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.HeatmapLegendOptions.prototype,"maxLabel",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.HeatmapLegendOptions.prototype,"title",void 0),e.HeatmapLegendOptions=t.__decorate([l.subclass("esri.renderers.support.HeatmapLegendOptions")],e.HeatmapLegendOptions),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/PieChartRenderer":function(){define(["exports","../chunks/tslib.es6","../Color","../core/arrayUtils","../core/Clonable","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","./Renderer","./mixins/VisualVariablesMixin","./support/AttributeColorInfo","./support/commonProperties","./support/OthersCategory","./support/RendererLegendOptions","./visualVariables/OpacityVariable","./visualVariables/SizeVariable","./visualVariables/VisualVariable","../symbols/SimpleLineSymbol","../symbols/SimpleMarkerSymbol"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x){"use strict";const w={base:S,key:"type",typeMap:{size:v,opacity:b}};return e.default=class extends(h.VisualVariablesMixin(o.ClonableMixin(p))){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new r([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new y.OthersCategory,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){return new x({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(i.isSome)}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return this.symbols.reduce(((e,t)=>e+JSON.stringify(t)),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await d.collectArcadeFieldNames(e,t,r.valueExpression),r.field&&e.add(r.field)}},t.__decorate([n.property({type:[f],json:{write:!0}})],e.default.prototype,"attributes",void 0),t.__decorate([n.property(m.rendererBackgroundFillSymbolProperty)],e.default.prototype,"backgroundFillSymbol",void 0),t.__decorate([n.property({type:r,json:{write:!0}})],e.default.prototype,"defaultColor",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"defaultLabel",void 0),t.__decorate([n.property({type:Number,range:{min:0,max:1},json:{write:!0}})],e.default.prototype,"holePercentage",void 0),t.__decorate([n.property({type:y.OthersCategory,json:{write:!0}})],e.default.prototype,"othersCategory",void 0),t.__decorate([n.property({type:g,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([n.property({type:_,json:{default:null,write:!0}})],e.default.prototype,"outline",void 0),t.__decorate([n.property({type:Number,cast:s.toPt,json:{write:!0}})],e.default.prototype,"size",void 0),t.__decorate([c.enumeration({pieChart:"pie-chart"})],e.default.prototype,"type",void 0),t.__decorate([n.property({types:[w]})],e.default.prototype,"visualVariables",void 0),e.default=t.__decorate([u.subclass("esri.renderers.PieChartRenderer")],e.default),e.default}))},"esri/renderers/support/OthersCategory":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";e.OthersCategory=class extends(i.ClonableMixin(o)){constructor(){super(...arguments),this.color=new r([0,0,0,0]),this.label=null,this.threshold=0}},t.__decorate([s.property({type:r,json:{write:!0}})],e.OthersCategory.prototype,"color",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.OthersCategory.prototype,"label",void 0),t.__decorate([s.property({type:Number,range:{min:0,max:1},json:{write:!0}})],e.OthersCategory.prototype,"threshold",void 0),e.OthersCategory=t.__decorate([c.subclass("esri.renderers.support.OthersCategory")],e.OthersCategory),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/SimpleRenderer":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Renderer","./mixins/VisualVariablesMixin","./support/commonProperties"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;return e.default=d=class extends(c.VisualVariablesMixin(l)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.symbols.map((r=>r.collectRequiredFields(e,t))))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}get symbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){return this.symbols.reduce(((e,t)=>e+JSON.stringify(t)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new d({description:this.description,label:this.label,symbol:r.clone(this.symbol),visualVariables:r.clone(this.visualVariables),authoringInfo:r.clone(this.authoringInfo)})}},t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"description",void 0),t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"label",void 0),t.__decorate([i.property(u.requiredRendererSymbolProperty)],e.default.prototype,"symbol",void 0),t.__decorate([n.enumeration({simple:"simple"})],e.default.prototype,"type",void 0),e.default=d=t.__decorate([a.subclass("esri.renderers.SimpleRenderer")],e.default),e.default}))},"esri/renderers/UniqueValueRenderer":function(){define(["exports","../chunks/tslib.es6","../core/Error","../core/lang","../core/Logger","../core/object","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../core/accessorSupport/diffUtils","../core/accessorSupport/ensureType","../layers/support/fieldUtils","../portal/Portal","./Renderer","./mixins/VisualVariablesMixin","./support/commonProperties","./support/RendererLegendOptions","./support/UniqueValue","./support/UniqueValueClass","./support/UniqueValueGroup","./support/UniqueValueInfo","../support/loadArcade","../chunks/persistableUrlUtils","../symbols/WebStyleSymbol","../symbols/support/styleUtils","../symbols/support/typeUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x,w,T,M,I,P,O,C){"use strict";var A;const E="uvInfos-watcher",R="uvGroups-watcher",F=f.ensureType(T);function D(e){return null!=e&&""!==e&&("string"!=typeof e||""!==e.trim()&&"<null>"!==e.toLowerCase())||(e=null),e+""}return e.default=A=class extends(b.VisualVariablesMixin(g)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let r=!1;const i={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let o=0;o<t.length;o++){const s=e.find((e=>e.value===t[o].value));s?h.diff(s,t[o])?(i.changed.push({type:"complete",oldValue:s,newValue:t[o]}),r=!0):i.unchanged.push({oldValue:s,newValue:t[o]}):(i.added.push(t[o]),r=!0)}for(let o=0;o<e.length;o++)t.find((t=>t.value===e[o].value))||(i.removed.push(e[o]),r=!0);return r?i:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return null==e||"function"==typeof e?e:f.ensureString(e)}writeField(e,t,i,s){"string"==typeof e?t[i]=e:s?.messages?s.messages.push(new r("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):o.getLogger(this).error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,r){return r.portal||y.getDefault()}readStyleOrigin(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=I.fromJSON(t.styleUrl,r);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,r,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=I.toJSON(e.styleUrl,i))}set uniqueValueGroups(e){this.styleOrigin?o.getLogger(this).error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?o.getLogger(this).error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void o.getLogger(this).error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r="object"==typeof e?F(e):new T({value:e,symbol:C.ensureType(t)}),this.uniqueValueInfos?.push(r),this._valueInfoMap[D(r.value)]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void o.getLogger(this).error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const t=this.uniqueValueInfos;if(t)for(let r=0;r<t.length;r++){const i=t[r];if(String(i.value)===String(e)){delete this._valueInfoMap[D(e)],t.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let r=t;return this.valueExpression&&null==t?.arcade&&(r={...r,arcade:await M.loadArcade()}),this._getUniqueValueInfo(e,r)}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void o.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(e,t);return r?.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&null==r?.arcade){const e=await M.loadArcade(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const i=this._getUniqueValueInfo(e,r);return i?.symbol||this.defaultSymbol}get symbols(){const e=[];for(const t of this.uniqueValueInfos??[])t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce(((e,t)=>e+t.getAttributeHash()),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=this.uniqueValueInfos?.reduce(((e,t)=>e+t.getMeshHash()),"");return`${e}.${t}.${r}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new A({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:i.clone(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:i.clone(this.visualVariables),legendOptions:i.clone(this.legendOptions),authoringInfo:i.clone(this.authoringInfo),backgroundFillSymbol:i.clone(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=i.clone(this.uniqueValueInfos),r=i.clone(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(i.clone(this.styleOrigin))),Object.freeze(t),Object.freeze(r)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",r),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.symbols.map((r=>r.collectRequiredFields(e,t))),m.collectArcadeFieldNames(e,t,this.valueExpression)];m.collectField(e,t,this.field),m.collectField(e,t,this.field2),m.collectField(e,t,this.field3),await Promise.all(r)}populateFromStyle(){return O.fetchStyle(this.styleOrigin,{portal:this.portal}).then((e=>{const t=[];return this._valueInfoMap={},e?.data&&Array.isArray(e.data.items)&&e.data.items.forEach((r=>{const i=new P({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==e.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const o=new T({value:r.name,symbol:i});t.push(o),this._valueInfoMap[D(r.name)]=o})),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",",")}_updateUniqueValues(){null!=this._isInfosSource&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const t of e)this._valueInfoMap[D(t.value)]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(E);const{uniqueValueInfos:e}=this;if(e){const t=[];for(const r of e)t.push(n.watch((()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description})),((e,t)=>{e!==t&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)}),{sync:!0}));this.addHandles(t,E)}}_watchUniqueValueGroups(){this.removeHandles(R);const{uniqueValueGroups:e}=this;if(e){const t=[];for(const r of e){t.push(n.watch((()=>({classes:r.classes})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}));for(const e of r.classes??[])t.push(n.watch((()=>({symbol:e.symbol,values:e.values,label:e.label,description:e.description})),((e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)}),{sync:!0}))}this.addHandles(t,R)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:t,field2:r,field3:i,fieldDelimiter:o,uniqueValueGroups:s,valueExpression:n}=this;if(!t&&!n)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!t||!r);for(const t of s)for(const s of t.classes??[]){const{symbol:t,label:n,values:l,description:c}=s;for(const s of l??[]){const{value:l,value2:u,value3:d}=s,p=[l];r&&p.push(u),i&&p.push(d);const h=a?p.join(o||""):p[0]??void 0;e.push(new T({symbol:t,label:n,value:h,description:c}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:t,field2:r,valueExpression:i,fieldDelimiter:o,uniqueValueInfos:s}=this;if(!t&&!i||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const n=!(!t||!r),a=s.map((e=>{const{symbol:t,label:r,value:i,description:s}=e,[a,l,c]=n?i?.toString()?.split(o||"")||[]:[i];return new x({symbol:t,label:r,description:s,values:[new _({value:a,value2:l,value3:c})]})})),l=[new w({classes:a})];e&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:o,arcade:s,timeZone:n}=t??{};let a=this._cache.compiledFunc;const l=s.arcadeUtils;if(!a){const e=l.createSyntaxTree(this.valueExpression);a=l.createFunction(e),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:r,scale:i,spatialReference:o}),n));return this._valueInfoMap[D(c)]}_getUnqiueValueInfoForFields(e){const t=this.field,r=e.attributes;let i;if(this.field2){const e=this.field2,o=this.field3,s=[];t&&s.push(r[t]),e&&s.push(r[e]),o&&s.push(r[o]),i=s.join(this.fieldDelimiter||"")}else t&&(i=r[t]);return this._valueInfoMap[D(i)]}static fromPortalStyle(e,t){const r=new A(t?.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t?.portal||y.getDefault());const i=r.populateFromStyle();return i.catch((t=>{o.getLogger(this.prototype).error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)})),i}static fromStyleUrl(e,t){const r=new A(t?.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));const i=r.populateFromStyle();return i.catch((t=>{o.getLogger(this.prototype).error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)})),i}},t.__decorate([a.property({readOnly:!0})],e.default.prototype,"_cache",null),t.__decorate([c.enumeration({uniqueValue:"unique-value"})],e.default.prototype,"type",void 0),t.__decorate([a.property(v.rendererBackgroundFillSymbolProperty)],e.default.prototype,"backgroundFillSymbol",void 0),t.__decorate([a.property({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],e.default.prototype,"field",null),t.__decorate([l.cast("field")],e.default.prototype,"castField",null),t.__decorate([p.writer("field")],e.default.prototype,"writeField",null),t.__decorate([a.property({type:String,value:null,json:{write:!0}})],e.default.prototype,"field2",null),t.__decorate([a.property({type:String,value:null,json:{write:!0}})],e.default.prototype,"field3",null),t.__decorate([a.property({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"orderByClassesEnabled",void 0),t.__decorate([a.property({type:String,value:null,json:{write:!0}})],e.default.prototype,"valueExpression",null),t.__decorate([a.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpressionTitle",void 0),t.__decorate([a.property({type:S,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([a.property({type:String,json:{write:!0}})],e.default.prototype,"defaultLabel",void 0),t.__decorate([a.property(s.deepMerge({...v.rendererSymbolProperty},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],e.default.prototype,"defaultSymbol",null),t.__decorate([a.property({type:String,value:null,json:{write:!0}})],e.default.prototype,"fieldDelimiter",null),t.__decorate([a.property({type:y,readOnly:!0})],e.default.prototype,"portal",void 0),t.__decorate([u.reader("portal",["styleName"])],e.default.prototype,"readPortal",null),t.__decorate([a.property({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],e.default.prototype,"styleOrigin",void 0),t.__decorate([u.reader("styleOrigin",["styleName","styleUrl"])],e.default.prototype,"readStyleOrigin",null),t.__decorate([p.writer("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],e.default.prototype,"writeStyleOrigin",null),t.__decorate([a.property({type:[w],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,r)=>{const i=t.uniqueValueGroups||function(e){const{field1:t,field2:r,field3:i,fieldDelimiter:o,uniqueValueInfos:s,valueExpression:n}=e,a=!(!t||!r);return[{classes:(s??[]).map((e=>{const{symbol:s,label:l,value:c,description:u}=e,[d,p,h]=a?c?.toString()?.split(o||"")||[]:[c],f=[];return(t||n)&&f.push(d),r&&f.push(p),i&&f.push(h),{symbol:s,label:l,values:[f],description:u}}))}]}(t);return i.map((e=>w.fromJSON(e,r)))}},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],e.default.prototype,"uniqueValueGroups",null),t.__decorate([a.property({type:[T],json:{read:!1,write:{isRequired:!0,overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0,isRequired:!0}}}}})],e.default.prototype,"uniqueValueInfos",null),e.default=A=t.__decorate([d.subclass("esri.renderers.UniqueValueRenderer")],e.default),e.default}))},"esri/core/accessorSupport/diffUtils":function(){define(["exports","../Accessor","../Collection","./utils"],(function(e,t,r,i){"use strict";const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function s(e){return e instanceof t}function n(e){return e instanceof r?Object.keys(e.items):s(e)?i.getProperties(e).keys():e?Object.keys(e):[]}function a(e,t){return e instanceof r?e.items[t]:e[t]}function l(e){return e?e.declaredClass:null}function c(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const i=n(e),u=n(t);if(0===i.length&&0===u.length)return;if(!i.length||!u.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const d=u.filter((e=>!i.includes(e))),p=i.filter((e=>!u.includes(e))),h=i.filter((r=>u.includes(r)&&a(e,r)!==a(t,r))).concat(d,p).sort(),f=l(e);if(f&&o.has(f)&&h.length)return{type:"complete",oldValue:e,newValue:t};let m;const y=s(e)&&s(t);for(const i of h){const o=a(e,i),s=a(t,i);let n;if((y||"function"!=typeof o&&"function"!=typeof s)&&o!==s&&(null!=o||null!=s)){if(r&&r[i]&&"function"==typeof r[i])n=r[i]?.(o,s);else if(o instanceof Date&&s instanceof Date){if(o.getTime()===s.getTime())continue;n={type:"complete",oldValue:o,newValue:s}}else n="object"==typeof o&&"object"==typeof s&&l(o)===l(s)?c(o,s):{type:"complete",oldValue:o,newValue:s};null!=n&&(null!=m?m.diff[i]=n:m={type:"partial",diff:{[i]:n}})}}return m}function u(e,t){if(null==e)return!1;const r=t.split(".");let i=e;for(const e of r){if("complete"===i.type)return!0;if("partial"!==i.type)return!1;{const t=i.diff[e];if(!t)return!1;i=t}}return!0}e.diff=function(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&l(e)!==l(t)?{type:"complete",oldValue:e,newValue:t}:c(e,t)},e.hasDiff=u,e.hasRootDiff=function(e,t){return u(e,t)},e.hasRootDiffOnly=function(e,t){if(!e)return!1;if("partial"===e.type){const r=Object.keys(e.diff);return 1===r.length&&r[0]===t}return!1},e.isEmpty=function e(t){if(null==t)return!0;switch(t.type){case"complete":return!1;case"collection":{const r=t;for(const t of r.added)if(!e(t))return!1;for(const t of r.removed)if(!e(t))return!1;for(const t of r.changed)if(!e(t))return!1;return!0}case"partial":for(const r in t.diff)if(!e(t.diff[r]))return!1;return!0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/renderers/support/UniqueValue":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./commonProperties"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";return e.default=class extends(r.ClonableMixin(i)){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}},t.__decorate([o.property(c.uniqueValueProperty)],e.default.prototype,"value",void 0),t.__decorate([o.property(c.uniqueValueProperty)],e.default.prototype,"value2",void 0),t.__decorate([o.property(c.uniqueValueProperty)],e.default.prototype,"value3",void 0),e.default=t.__decorate([l.subclass("esri.renderers.support.UniqueValue")],e.default),e.default}))},"esri/renderers/support/UniqueValueClass":function(){define(["exports","../../chunks/tslib.es6","../../core/arrayUtils","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/accessorSupport/decorators/subclass","./commonProperties","./UniqueValue"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";return e.default=class extends(i.ClonableMixin(o)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(null==e)return null;const t=typeof(e=Array.isArray(e)?e:[e])[0];return"string"===t||"number"===t?e.map((e=>new u({value:e}))):"object"===t?e[0]instanceof u?e:e.map((e=>new u(e))):null}},t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"description",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"label",void 0),t.__decorate([s.property(c.rendererSymbolProperty)],e.default.prototype,"symbol",void 0),t.__decorate([s.property({type:[u],json:{type:[[String]],read:{reader:e=>e?e.map((e=>new u({value:e[0],value2:e[1],value3:e[2]}))):null},write:{writer:(e,t)=>{const i=[];for(const t of e){const e=[t.value,t.value2,t.value3].filter(r.isSome).map((e=>e.toString()));i.push(e)}t.values=i}}}})],e.default.prototype,"values",void 0),t.__decorate([n.cast("values")],e.default.prototype,"castValues",null),e.default=t.__decorate([l.subclass("esri.renderers.support.UniqueValueClass")],e.default),e.default}))},"esri/renderers/support/UniqueValueGroup":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./UniqueValueClass"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";return e.default=class extends(r.ClonableMixin(i)){constructor(e){super(e),this.heading=null,this.classes=null}},t.__decorate([o.property({type:String,json:{write:!0}})],e.default.prototype,"heading",void 0),t.__decorate([o.property({type:[c],json:{write:{isRequired:!0}}})],e.default.prototype,"classes",void 0),e.default=t.__decorate([l.subclass("esri.renderers.support.UniqueValueGroup")],e.default),e.default}))},"esri/renderers/support/UniqueValueInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./commonProperties"],(function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends r{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new c({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${e}`}},t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"description",void 0),t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"label",void 0),t.__decorate([i.property(l.requiredRendererSymbolProperty)],e.default.prototype,"symbol",void 0),t.__decorate([i.property(l.uniqueValueProperty)],e.default.prototype,"value",void 0),e.default=c=t.__decorate([a.subclass("esri.renderers.support.UniqueValueInfo")],e.default),e.default}))},"esri/symbols/support/styleUtils":function(){define(["exports","../../request","../../core/Error","../../core/has","../../core/promiseUtils","../../core/urlUtils","../../portal/Portal","../../portal/PortalQueryParams","./styleCache"],(function(e,t,r,i,o,s,n,a,l){"use strict";function c(e,t){if(!i("enable-feature:force-wosr"))return e.formatInfos?.find((e=>e.type===t))?.href}function u(e,r){const i={responseType:"json",query:{f:"json"},...r};return t(s.normalize(e),i)}const d="esri_en",p="Style";e.Style2DUrlTemplate="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",e.fetchStyle=function(e,t,i){return null!=e?.styleUrl?async function(e,t){try{return{data:(await u(e,t)).data,baseUrl:s.removeFile(e),styleUrl:e}}catch(e){return o.throwIfAbortError(e),null}}(e.styleUrl,i):null!=e?.styleName?function(e,t,i){const o=null!=t.portal?t.portal:n.getDefault();let s;const c=`${o.url} - ${o.user?.username} - ${e}`,u=l.cachedStyles.get(c);if(u)return u;const h=function(e,t,i){return t.load(i).then((()=>{const r=new a({disableExtraQuery:!0,query:`owner:${d} AND type:${p} AND typekeywords:"${e}"`});return t.queryItems(r,i)})).then((({results:t})=>{let o=null;const s=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t){const t=e.typeKeywords?.some((e=>e.toLowerCase()===s));if(t&&e.type===p&&e.owner===d){o=e;break}}if(!o)throw new r("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return o.load(i)}))}(e,o,i).then((e=>(s=e,e.fetchData()))).then((t=>({data:t,baseUrl:s.itemUrl??"",styleName:e})));return l.cachedStyles.set(c,h),h}(e.styleName,t,i):Promise.reject(new r("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))},e.makeCIMSymbolRef=function(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}},e.requestJSON=u,e.symbolUrlFromStyleItem=function(e,t){for(const r of t)switch(r){case"cim":if(e.cimRef)return{format:r,url:encodeURI(e.cimRef)};break;case"web-gltf-basisu":{const t=c(e,"gltf_basisu");if(t)return{format:r,url:t};break}case"web-gltf":{const t=c(e,"gltf");if(t)return{format:r,url:t};break}case"web":{const t=c(e,"gltf");if(t)return{format:"web-gltf",url:t};if(e.webRef)return{format:r,url:encodeURI(e.webRef)};break}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/symbols/support/styleCache":function(){define(["exports"],(function(e){"use strict";const t=new Map;e.cachedStyles=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/PipelineCommand":function(){define(["exports"],(function(e){"use strict";class t{constructor(e,t,r){this.renderCommandContext=e,this.renderCommandBuffer=t,this.pipelineStateCommands=r}append(e){this.appendRenderCommands(e.renderCommandBuffer),this.appendPipelineStateCommands(e.pipelineStateCommands)}appendRenderCommands(e){this.renderCommandBuffer.commands.push(...e.commands),this.renderCommandBuffer.transferList.push(...e.transferList)}appendPipelineStateCommand(e){this.pipelineStateCommands.push(e)}appendPipelineStateCommands(e){for(const t of e)this.appendPipelineStateCommand(t)}async execute(){for(const e of this.pipelineStateCommands)e();await this.renderCommandContext.dispatchRenderCommands(this.renderCommandBuffer)}static create(e,r=[]){return new t(e,e.createRenderCommandBuffer(),r)}}e.PipelineCommand=t,e.joinCommands=function(e){return 0===e.length?null:e.reduce(((e,t)=>(e.append(t),e)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/symbolization/factoryUtils":function(){define(["exports","../../../../../../Color","../../../../../../symbols/IconSymbol3DLayer","../../../../../../symbols/ObjectSymbol3DLayer","../../../../../../symbols/support/Symbol3DMaterial"],(function(e,t,r,i,o){"use strict";e.createDefaultIconSymbolLayer=function(){return new r({material:new o.Symbol3DMaterial({color:new t("red")})})},e.createDefaultObjectSymbolLayer=function(){return new i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/symbolization/IconSymbolLayerRenderer":function(){define(["exports","../../../../../../Color","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../../../symbols/support/IconSymbol3DLayerResource","../../graphicUtils","../../placementUtils","../PipelineCommand","../featureData/processingUtils","./symbolizationUtils","../../../../support/engineContent/sdfPrimitives","../../../../webgl-engine/lib/Attribute","../../../../webgl-engine/lib/VertexAttribute"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";function f(e){return null!=e&&("cross"===e||"x"===e)}function m(e){return e.resource?.href?null:e.resource?.primitive??s.defaultPrimitive}const y={hasIntrinsicColor:!1},g=o.ZEROS;e.IconSymbolLayerRenderer=class{constructor(e,t){this._context=null,this._symbolLayer=null,this._draped=!1,this._loaded=!1,this._loadingPromise=null,this._iconTextureID=null,this._materialId=null,this._context=t,this._symbolLayer=e}get loaded(){return this._loaded}load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}_destroy(){this._iconTextureID=null}async _load(){const e=this._context.renderCommandContext,t=await e.createTexture((()=>d.createTextureInfo("circle")));this._iconTextureID=t;const r={anchorPosition:a.namedAnchorToHUDMaterialAnchorPos.center,occlusionTest:!0,hasSlicePlane:!1,color:this._getFillColor(),outlineColor:this._getOutlineColor(),outlineSize:1,distanceFieldBoundingBox:d.defaultBoundingBox,textureId:t,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:d.requiresHalfTexelOffset("circle")};this._materialId=await e.createMaterial({type:"hud",parameters:r}),await e.createDirectRenderer(this._materialId),this._loaded=!0}async createAddCommand(e){const{_materialId:t,_context:r}=this,{renderCommandContext:i}=r;if(null==t)throw new Error("expected material not to be null");const o=await this._createGeometry(e);if(null==o)return r.createPipelineCommand();const s=c.computeTileCenterRenderCoordinates(e,r);return r.createPipelineCommand(i.addDirectRendererGeometry(e.id,o,s))}async _createGeometry(e){const{_materialId:t,_context:i}=this,{mainThreadDelegate:o}=i,{featureCount:s}=e;if(0===s||null==t)return null;const n=c.readObjectIds(e),a=c.readMapCoordinates(e),l=await o.applyElevationAlignmentTo(a),d=c.projectToRenderCoordinates(l,i),f=new Float64Array([0,0,1]),m=new Float64Array([255,255,255,255]),y=new Float64Array([24,24]),g=new Float64Array([0,0,0,1]),b=new Float64Array([0,0]),v=new Float64Array([0]),S=new Uint32Array(s);for(let e=0;e<s;++e)S[e]=e;const _=new Uint32Array(s);for(let e=0;e<s;++e)_[e]=0;const x=new p.Attribute(d,S,3,!0),w=new p.Attribute(f,_,3,!0),T=new p.Attribute(b,_,2,!0),M=new p.Attribute(m,_,4,!0),I=new p.Attribute(v,_,1,!0),P=new p.Attribute(y,_,2,!0),O=new p.Attribute(g,_,4,!0),C=[[h.VertexAttribute.POSITION,x],[h.VertexAttribute.NORMAL,w],[h.VertexAttribute.UV0,T],[h.VertexAttribute.COLOR,M],[h.VertexAttribute.ROTATION,I],[h.VertexAttribute.SIZE,P],[h.VertexAttribute.CENTEROFFSETANDDISTANCE,O]],A=new Uint8Array(s);return e.getVisibilityArray(A),{attributes:u.inputAttributesToAttributesMap(C),objectAndLayerIdColor:void 0,transformation:r.create(),materialId:t,objectIds:n,visibilities:A}}async createRemoveCommand(e){const{_materialId:t,_context:r}=this,i=r.renderCommandContext;return null==t?r.createPipelineCommand():r.createPipelineCommand(i.removeDirectRendererGeometryBuffer(t,e))}async createUpdateVisibilityCommand(e){const{_materialId:t,_context:r}=this,i=r.renderCommandContext;if(null==t)return r.createPipelineCommand();const o=new Uint8Array(e.featureCount);return e.getVisibilityArray(o),r.createPipelineCommand(i.updateVisibility(t,e.id,o))}async createUpdateLayerViewOpacityCommand(e){const{_context:t,_materialId:r}=this,i=t.renderCommandContext;return null==r?t.createPipelineCommand():t.createPipelineCommand(i.updateMaterial({type:"hud",materialId:r,parameters:{color:this._getFillColor(),outlineColor:this._getOutlineColor()}}))}async createUpdateElevationCommand(e){const{_materialId:t,_context:r}=this,{renderCommandContext:i}=r,{featureCount:o,id:s}=e;if(null==t||0===o)return r.createPipelineCommand();const n=await this._createGeometry(e);if(null==n)return r.createPipelineCommand();const a=c.computeTileCenterRenderCoordinates(e,r);return r.createPipelineCommand(i.updateDirectRendererGeometry(s,n,a))}async createDestroyCommand(){const{_iconTextureID:e,_context:t}=this,r=t.renderCommandContext;let i;return i=null!=e?await r.releaseTexture(e):l.PipelineCommand.create(r),i.appendPipelineStateCommand((()=>this._destroy())),i}_getOutlineColor(){const e=this._getLayerOpacity(),r=this._symbolLayer,i=r?.outline?.color;if(null!=i){const r=t.toUnitRGB(i),o=i.a*e;return[r[0],r[1],r[2],o]}return[0,0,0,0]}_getFillColor(){if(f(this._getPrimitive()))return g;const e=null==this._getPrimitive(),t=this._symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_getLayerOpacity(){return this._context.layerViewInfo.fullOpacity}_getCombinedOpacity(e,t=y){const r=this._draped?1:this._getLayerOpacity();return e?r*e.a:t.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e,r=y){const o=this._getCombinedOpacity(e,r),s=null!=e?t.toUnitRGB(e):i.ONES;return n.mixinColorAndOpacity(s,o)}_getPrimitive(){return m(this._symbolLayer)}},e.defaultMaterialOptions=y,e.getPrimitive=m,e.isOutlineOnly=f,e.transparentUnit=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["exports"],(function(e){"use strict";function t(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function i(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){return[e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m]}const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:t,fromValues:i},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=o,e.clone=r,e.create=t,e.fromValues=i,e.mat4f64=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/graphicUtils":function(){define(["exports","../../../../core/unitUtils","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/projectionUtils","../../../../geometry/support/aaBoundingBox","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/centroid","../../../../geometry/support/coordsUtils","../../../../geometry/support/meshVertexSpaceUtils","../../../../layers/graphics/dehydratedPoint","../../../../layers/graphics/hydratedFeatures"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";function m(e){const t=e.paths[0];if(!t||0===t.length)return null;const r=d.getPointOnPath(t,d.getPathLength(t)/2);return h.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}function y(e,t,r){const i=r?e:f.clonePoint(e);return t&&e?a.projectPoint(e,i,t)?i:null:i}function g(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}e.computeCentroid=function(e,t){if("point"===e.type)return y(e,t,!1);if(f.isHydratedGeometry(e))switch(e.type){case"extent":return y(e.center,t,!1);case"polygon":return y(e.centroid,t,!1);case"polyline":return y(m(e),t,!0);case"mesh":return y(p.vertexSpaceOriginToPoint(e.vertexSpace,e.spatialReference)??e.extent.center,t,!1);case"multipoint":return}else switch(e.type){case"extent":return y(function(e){return h.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return y(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const r=u.ringsCentroid(e.rings,!!e.hasZ);return h.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return y(m(e),t,!0);case"multipoint":return}},e.computeMaxZ=function(e){if(!e)return 0;switch(e.type){case"point":return e.z;case"extent":return e.zmax;case"polygon":return e.hasZ?e.rings.reduce(((e,t)=>t.reduce(((e,t)=>Math.max(e,t[2])),e)),-1/0):void 0;case"polyline":return e.hasZ?e.paths.reduce(((e,t)=>t.reduce(((e,t)=>Math.max(e,t[2])),e)),-1/0):void 0;case"mesh":return e.extent.zmax;case"multipoint":return}},e.computeObjectRotation=function(e,t,o,s=i.create()){return e&&r.rotateZ(s,s,-e/180*Math.PI),t&&r.rotateX(s,s,t/180*Math.PI),o&&r.rotateY(s,s,o/180*Math.PI),s},e.computeObjectScale=function(e=o.ONES,t,r,i=1){const s=new Array(3);if(null==t||null==r)s[0]=1,s[1]=1,s[2]=1;else{let i,o=0;for(let n=2;n>=0;n--){const a=e[n],l=null!=a,c=0===n&&!i&&!l,u=r[n];let d;"symbol-value"===a||c?d=0!==u?t[n]/u:1:l&&"proportional"!==a&&isFinite(a)&&(d=0!==u?a/u:1),null!=d&&(s[n]=d,i=d,o=Math.max(o,Math.abs(d)))}for(let e=2;e>=0;e--)null==s[e]?s[e]=i:0===s[e]&&(s[e]=.001*o)}for(let e=2;e>=0;e--)s[e]/=i;return o.fromArray(s)},e.demResolutionForBoundingBox=function(e,r,i){if(null!=i.minDemResolution)return i.minDemResolution;const o=t.getMetersPerUnitForSR(r),s=l.width(e)*o,n=l.depth(e)*o,a=l.height(e)*(r.isGeographic?1:o);return 0===s&&0===n&&0===a?i.minDemResolutionForPoints:.01*Math.max(s,n,a)},e.enlargeExtent=function(e,t,r,i=0){if(e){t||(t=c.create());const o=e;let n=.5*o.width*(r-1),a=.5*o.height*(r-1);return o.width<1e-7*o.height?n+=a/20:o.height<1e-7*o.width&&(a+=n/20),s.set(t,o.xmin-n-i,o.ymin-a-i,o.xmax+n+i,o.ymax+a+i),t}return null},e.isValidSize=g,e.mixinColorAndOpacity=function(e,t,r=null){const i=n.clone(n.ONES);return null!=e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),null!=t?i[3]=t:null!=e&&e.length>3&&(i[3]=e[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i},e.overrideColor=function(e,t,r,i,o,s){for(let t=0;t<3;++t)s[t]=null!=e?.[t]?e[t]:null!=r?.[t]?r[t]:o[t];return s[3]=null!=t?t:null!=i?i:o[3],s},e.validateSymbolLayerSize=function(e){return g(null!=e.isPrimitive?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/meshVertexSpaceUtils":function(){define(["exports","../../chunks/vec32","../Point","./MeshGeoreferencedVertexSpace","./MeshLocalVertexSpace"],(function(e,t,r,i,o){"use strict";function s(e){return null!=e.origin}e.isAbsoluteVertexSpace=function(e){return null==e.origin},e.isMeshWithRelativeVertexSpace=function(e){return s(e.vertexSpace)},e.isRelativeVertexSpace=s,e.selectVertexSpace=function(e,t){const{x:r,y:s,z:n,spatialReference:a}=e,l=[r,s,n??0];return"local"===(t?.vertexSpace??function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(a))?new o({origin:l}):new i({origin:l})},e.vertexSpaceEquals=function(e,r){return e.type===r.type&&(e.origin===r.origin||null!=e.origin&&null!=r.origin&&t.exactEquals(e.origin,r.origin))},e.vertexSpaceOriginToPoint=function(e,t){if(!s(e))return null;const[i,o,n]=e.origin;return new r({x:i,y:o,z:n,spatialReference:t})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/vec32":function(){define(["exports","../core/libs/gl-matrix-2/factories/vec3f64","../core/libs/gl-matrix-2/math/common"],(function(e,t,r){"use strict";function i(e){const t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function s(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function n(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function l(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function c(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function u(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function d(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function p(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function h(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function f(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function m(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function y(e,t=0,r=1){return e[0]=Math.min(Math.max(e[0],t),r),e[1]=Math.min(Math.max(e[1],t),r),e[2]=Math.min(Math.max(e[2],t),r),e}function g(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function b(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function v(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function S(e,t){const r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(r*r+i*i+o*o)}function _(e,t){const r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return r*r+i*i+o*o}function x(e){const t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function w(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function T(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function M(e,t){const r=t[0],i=t[1],o=t[2];let s=r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function I(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function P(e,t,r){const i=t[0],o=t[1],s=t[2],n=r[0],a=r[1],l=r[2];return e[0]=o*l-s*a,e[1]=s*n-i*l,e[2]=i*a-o*n,e}function O(e,t,r){const i=t[0],o=t[1],s=t[2],n=r[0],a=r[1],l=r[2],c=o*l-s*a,u=s*n-i*l,d=i*a-o*n,p=Math.sqrt(c*c+u*u+d*d);return e[0]=c/p,e[1]=u/p,e[2]=d/p,e}function C(e,t,r,i){const o=t[0],s=t[1],n=t[2];return e[0]=o+i*(r[0]-o),e[1]=s+i*(r[1]-s),e[2]=n+i*(r[2]-n),e}function A(e,t,r,i,o,s){const n=s*s,a=n*(2*s-3)+1,l=n*(s-2)+s,c=n*(s-1),u=n*(3-2*s);return e[0]=t[0]*a+r[0]*l+i[0]*c+o[0]*u,e[1]=t[1]*a+r[1]*l+i[1]*c+o[1]*u,e[2]=t[2]*a+r[2]*l+i[2]*c+o[2]*u,e}function E(e,t,r,i,o,s){const n=1-s,a=n*n,l=s*s,c=a*n,u=3*s*a,d=3*l*n,p=l*s;return e[0]=t[0]*c+r[0]*u+i[0]*d+o[0]*p,e[1]=t[1]*c+r[1]*u+i[1]*d+o[1]*p,e[2]=t[2]*c+r[2]*u+i[2]*d+o[2]*p,e}function R(e,t=1){const i=r.RANDOM,o=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(o)*n,e[1]=Math.sin(o)*n,e[2]=s*t,e}function F(e,t,r){const i=t[0],o=t[1],s=t[2];return e[0]=r[0]*i+r[4]*o+r[8]*s+r[12],e[1]=r[1]*i+r[5]*o+r[9]*s+r[13],e[2]=r[2]*i+r[6]*o+r[10]*s+r[14],e}function D(e,t,r){const i=t[0],o=t[1],s=t[2];return e[0]=i*r[0]+o*r[3]+s*r[6],e[1]=i*r[1]+o*r[4]+s*r[7],e[2]=i*r[2]+o*r[5]+s*r[8],e}function L(e,t,r){const i=r[0],o=r[1],s=r[2],n=r[3],a=t[0],l=t[1],c=t[2],u=o*c-s*l,d=s*a-i*c,p=i*l-o*a,h=o*p-s*d,f=s*u-i*p,m=i*d-o*u,y=2*n;return e[0]=a+u*y+2*h,e[1]=l+d*y+2*f,e[2]=c+p*y+2*m,e}function V(e,t,r,i){const o=[],s=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],s[0]=o[0],s[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),s[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function N(e,t,r,i){const o=[],s=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],s[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),s[1]=o[1],s[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function B(e,t,r,i){const o=[],s=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],s[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),s[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),s[2]=o[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function U(e,t){M(z,e),M(j,t);const r=I(z,j);return r>1?0:r<-1?Math.PI:Math.acos(r)}const z=t.create(),j=t.create();function k(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function G(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function q(e,t){if(e===t)return!0;const i=e[0],o=e[1],s=e[2],n=t[0],a=t[1],l=t[2],c=r.getEpsilon();return Math.abs(i-n)<=c*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(o-a)<=c*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(s-l)<=c*Math.max(1,Math.abs(s),Math.abs(l))}function H(e,t,r){const i=r[0]-t[0],o=r[1]-t[1],s=r[2]-t[2];let n=i*i+o*o+s*s;return n>0?(n=1/Math.sqrt(n),e[0]=i*n,e[1]=o*n,e[2]=s*n,e):(e[0]=0,e[1]=0,e[2]=0,e)}const W=a,$=l,J=c,Y=S,Z=_,Q=i,X=x,K=Object.freeze(Object.defineProperty({__proto__:null,abs:p,add:n,angle:U,bezier:E,ceil:u,clamp:y,copy:o,cross:P,crossAndNormalize:O,direction:H,dist:Y,distance:S,div:J,divide:c,dot:I,equals:q,exactEquals:G,floor:d,hermite:A,inverse:T,len:Q,length:i,lerp:C,max:m,min:f,mul:$,multiply:l,negate:w,normalize:M,random:R,rotateX:V,rotateY:N,rotateZ:B,round:g,scale:b,scaleAndAdd:v,set:s,sign:h,sqrDist:Z,sqrLen:X,squaredDistance:_,squaredLength:x,str:k,sub:W,subtract:a,transformMat3:D,transformMat4:F,transformQuat:L},Symbol.toStringTag,{value:"Module"}));e.abs=p,e.add=n,e.angle=U,e.bezier=E,e.ceil=u,e.clamp=y,e.copy=o,e.cross=P,e.crossAndNormalize=O,e.direction=H,e.dist=Y,e.distance=S,e.div=J,e.divide=c,e.dot=I,e.equals=q,e.exactEquals=G,e.floor=d,e.hermite=A,e.inverse=T,e.len=Q,e.length=i,e.lerp=C,e.max=m,e.min=f,e.mul=$,e.multiply=l,e.negate=w,e.normalize=M,e.random=R,e.rotateX=V,e.rotateY=N,e.rotateZ=B,e.round=g,e.scale=b,e.scaleAndAdd=v,e.set=s,e.sign=h,e.sqrDist=Z,e.sqrLen=X,e.squaredDistance=_,e.squaredLength=x,e.str=k,e.sub=W,e.subtract=a,e.transformMat3=D,e.transformMat4=F,e.transformQuat=L,e.vec3=K}))},"esri/geometry/support/MeshGeoreferencedVertexSpace":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;return e.default=class extends(r.ClonableMixin(i)){static{u=this}constructor(e){super(e),this.type="georeferenced",this.origin=null}static{this.absolute=new u}},t.__decorate([l.enumeration({georeferenced:"georeferenced"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property({type:[Number],nonNullable:!1,json:{write:!0}})],e.default.prototype,"origin",void 0),e.default=u=t.__decorate([c.subclass("esri.geometry.support.MeshGeoreferencedVertexSpace")],e.default),e.default}))},"esri/geometry/support/MeshLocalVertexSpace":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../core/libs/gl-matrix-2/factories/vec3f64"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";return e.default=class extends(r.ClonableMixin(i)){constructor(e){super(e),this.type="local",this.origin=u.create()}},t.__decorate([l.enumeration({local:"local"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property({type:[Number],nonNullable:!0,json:{write:!0}})],e.default.prototype,"origin",void 0),e.default=t.__decorate([c.subclass("esri.geometry.support.MeshLocalVertexSpace")],e.default),e.default}))},"esri/layers/graphics/dehydratedPoint":function(){define(["exports"],(function(e){"use strict";e.makeDehydratedPoint=function(e,t,r,i){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:i,type:"point"}},e.setDehydratedPoint=function(e,t,r,i,o){e.x=t,e.y=r,e.z=i,e.hasZ=null!=i,e.spatialReference=o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/hydratedFeatures":function(){define(["exports","../../Graphic","../../core/has","../../core/lang","../../core/typedArrayUtil","../../geometry/SpatialReference","../../geometry/support/jsonUtils","./dehydratedPoint"],(function(e,t,r,i,o,s,n,a){"use strict";function l(e){return"declaredClass"in e}function c(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function d(e){return null==e?null:l(e)?e:n.fromJSON(function(e){const{wkid:t,wkt:r,wkt2:i,latestWkid:o}=e.spatialReference,s={wkid:t,wkt:r,wkt2:i,latestWkid:o};switch(e.type){case"point":{const{x:t,y:r,z:i,m:o}=e;return{x:t,y:r,z:i,m:o,spatialReference:s}}case"polygon":{const{rings:t,hasZ:r,hasM:i}=e;return{rings:p(t),hasZ:r,hasM:i,spatialReference:s}}case"polyline":{const{paths:t,hasZ:r,hasM:i}=e;return{paths:p(t),hasZ:r,hasM:i,spatialReference:s}}case"extent":{const{xmin:t,xmax:r,ymin:i,ymax:o,zmin:n,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:d}=e;return{xmin:t,xmax:r,ymin:i,ymax:o,zmin:n,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:d,spatialReference:s}}case"multipoint":{const{points:t,hasZ:r,hasM:i}=e;return{points:f(t)?h(t):t,hasZ:r,hasM:i,spatialReference:s}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return f(t);return!1}(e)?e.map((e=>h(e))):e}function h(e){return e.map((e=>Array.from(e)))}function f(e){return e.length>0&&(o.isFloat32Array(e[0])||o.isFloat64Array(e[0]))}e.clonePoint=function(e,t){if(!e)return null;let r;if(c(e)){if(null==t)return e.clone();if(c(t))return t.copy(e)}return null!=t?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=void 0,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=a.makeDehydratedPoint(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r},e.hydrateGeometry=d,e.hydrateGraphic=function(e,r){return e?u(e)?e:new t({layer:r,sourceLayer:r,visible:e.visible,symbol:i.clone(e.symbol),attributes:i.clone(e.attributes),geometry:d(e.geometry)}):null},e.hydratedSpatialReference=function(e){const{wkid:t,wkt:r,wkt2:i,latestWkid:o}=e,n={wkid:t,wkt:r,wkt2:i,latestWkid:o};return s.fromJSON(n)},e.isHydratedGeometry=l,e.isHydratedGraphic=u,e.isHydratedPoint=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../webgl-engine/lib/TextRenderer"],(function(e,t,r,i){"use strict";const o=Object.freeze({left:0,center:.5,right:1}),s=Object.freeze({"bottom-left":r.fromValues(0,0),bottom:r.fromValues(.5,0),"bottom-right":r.fromValues(1,0),left:r.fromValues(0,.5),center:r.fromValues(.5,.5),right:r.fromValues(1,.5),"top-left":r.fromValues(0,1),top:r.fromValues(.5,1),"top-right":r.fromValues(1,1)});e.anchorFromPlacements=function(e,t){switch(t){case"bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case"center":return e;case"top":return"left"===e?"top-left":"right"===e?"top-right":"top"}},e.horizontalPlacementFromAnchor=function(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}},e.horizontalPlacementToAnchorX=o,e.namedAnchorToHUDMaterialAnchorPos=s,e.textRenderAlignmentFromHorizontalPlacement=function(e){switch(e){case"left":return i.TextRenderAlignment.Left;case"right":return i.TextRenderAlignment.Right;default:return i.TextRenderAlignment.Center}},e.verticalPlacementFromAlignment=function(e){return"middle"===e?"center":e},e.verticalPlacementFromAnchor=function(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}},e.verticalScreenOffsetFromAlignment=function(e,o){switch(e){case"top":return t.set(o,0,i.textVerticalPaddingPx);case"bottom":return t.set(o,0,-1);default:return t.copy(o,r.ZEROS)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],(function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e}function i(e,t,r){return e[0]=t,e[1]=r,e}function o(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function s(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function n(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function a(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function l(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function c(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function u(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function d(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function p(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function h(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function f(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function m(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function y(e,t){const r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function g(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function b(e){const t=e[0],r=e[1];return t*t+r*r}function v(e,t){return e[0]=-t[0],e[1]=-t[1],e}function S(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function _(e,t){const r=t[0],i=t[1];let o=r*r+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o),e}function x(e,t){return e[0]*t[0]+e[1]*t[1]}function w(e,t,r){const i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function T(e,t,r,i){const o=t[0],s=t[1];return e[0]=o+i*(r[0]-o),e[1]=s+i*(r[1]-s),e}function M(e,r=1){const i=2*t.RANDOM()*Math.PI;return e[0]=Math.cos(i)*r,e[1]=Math.sin(i)*r,e}function I(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[2]*o,e[1]=r[1]*i+r[3]*o,e}function P(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[2]*o+r[4],e[1]=r[1]*i+r[3]*o+r[5],e}function O(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[3]*o+r[6],e[1]=r[1]*i+r[4]*o+r[7],e}function C(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[4]*o+r[12],e[1]=r[1]*i+r[5]*o+r[13],e}function A(e,t,r,i){const o=t[0]-r[0],s=t[1]-r[1],n=Math.sin(i),a=Math.cos(i);return e[0]=o*a-s*n+r[0],e[1]=o*n+s*a+r[1],e}function E(e,t){const r=e[0],i=e[1],o=t[0],s=t[1];let n=r*r+i*i;n>0&&(n=1/Math.sqrt(n));let a=o*o+s*s;a>0&&(a=1/Math.sqrt(a));const l=(r*o+i*s)*n*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function R(e){return"vec2("+e[0]+", "+e[1]+")"}function F(e,t){return e[0]===t[0]&&e[1]===t[1]}function D(e,r){const i=e[0],o=e[1],s=r[0],n=r[1],a=t.getEpsilon();return Math.abs(i-s)<=a*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-n)<=a*Math.max(1,Math.abs(o),Math.abs(n))}function L(e,t,r,i,o){let s=t[0]-r[0],n=t[1]-r[1];const a=(i[0]*s+i[1]*n)*(o-1);return s=i[0]*a,n=i[1]*a,e[0]=t[0]+s,e[1]=t[1]+n,e}const V=g,N=s,B=n,U=a,z=m,j=y,k=b,G=Object.freeze(Object.defineProperty({__proto__:null,add:o,angle:E,ceil:l,copy:r,cross:w,dist:z,distance:m,div:U,divide:a,dot:x,equals:D,exactEquals:F,floor:c,inverse:S,len:V,length:g,lerp:T,max:d,min:u,mul:B,multiply:n,negate:v,normalize:_,projectAndScale:L,random:M,rotate:A,round:p,scale:h,scaleAndAdd:f,set:i,sqrDist:j,sqrLen:k,squaredDistance:y,squaredLength:b,str:R,sub:N,subtract:s,transformMat2:I,transformMat2d:P,transformMat3:O,transformMat4:C},Symbol.toStringTag,{value:"Module"}));e.add=o,e.angle=E,e.ceil=l,e.copy=r,e.cross=w,e.dist=z,e.distance=m,e.div=U,e.divide=a,e.dot=x,e.equals=D,e.exactEquals=F,e.floor=c,e.inverse=S,e.len=V,e.length=g,e.lerp=T,e.max=d,e.min=u,e.mul=B,e.multiply=n,e.negate=v,e.normalize=_,e.projectAndScale=L,e.random=M,e.rotate=A,e.round=p,e.scale=h,e.scaleAndAdd=f,e.set=i,e.sqrDist=j,e.sqrLen=k,e.squaredDistance=y,e.squaredLength=b,e.str=R,e.sub=N,e.subtract=s,e.transformMat2=I,e.transformMat2d=P,e.transformMat3=O,e.transformMat4=C,e.vec2=G,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],(function(e){"use strict";function t(){return[0,0]}function r(e){return[e[0],e[1]]}function i(e,t){return[e,t]}function o(e,t){return[e,t]}function s(e,t=[0,0]){const r=Math.min(2,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function n(){return[0,0]}function a(){return i(1,1)}function l(){return i(1,0)}function c(){return i(0,1)}const u=[0,0],d=a(),p=l(),h=c(),f=Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:p,UNIT_Y:h,ZEROS:u,clone:r,create:t,freeze:o,fromArray:s,fromValues:i,ones:a,unitX:l,unitY:c,zeros:n},Symbol.toStringTag,{value:"Module"}));e.ONES=d,e.UNIT_X=p,e.UNIT_Y=h,e.ZEROS=u,e.clone=r,e.create=t,e.freeze=o,e.fromArray=s,e.fromValues=i,e.ones=a,e.unitX=l,e.unitY=c,e.vec2f64=f,e.zeros=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../core/mathUtils","../../support/debugFlags","./FontMetrics","./TextHelperCanvas"],(function(e,t,r,i,o){"use strict";const s=[];{const e=16;for(let t=0;t<360;t+=360/e)s.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var n;e.TextRenderAlignment=void 0,(n=e.TextRenderAlignment||(e.TextRenderAlignment={}))[n.Left=0]="Left",n[n.Center=1]="Center",n[n.Right=2]="Right";const a={canvas:null},l=512,c="rgb(255, 0, 255, 0.5)";class u{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,t,r,i,o){this.firstLineAscent=e,this.lastLineDescent=t,this.maxLineAscent=r,this.maxLineDescent=i,this.displayWidth=o}}e.TextRenderer=class{constructor(e,t,r,i){this.text=e,this._alignment=t,this._parameters=r,this._maxSize=i,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${e}--${this._parameters.key}-${this._alignment}`,this._lines=e.replaceAll(" ","").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let t=0;t<this._lines.length-1;t++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const e=o.getTextHelperCanvas(a,l,l).getContext("2d"),t=this._parameters.definition.pixelRatio,r=this._fontSize*t;this._parameters.setFontProperties(e,r);let s=2*this._haloSize;const n=this._parameters.definition.font;"italic"!==n.style&&"oblique"!==n.style&&"bold"!==n.weight&&"bolder"!==n.weight||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let c=0,d=0,p=0,h=0,f=0;this._lines.forEach(((r,i)=>{const o=e.measureText(r),n=o.width/t,a=n+s;this._textWidths.push(n),this._lineWidths.push(a),c=Math.max(c,a),h=Math.max(h,o.actualBoundingBoxAscent/t),f=Math.max(f,o.actualBoundingBoxDescent/t),0===i&&(d=o.actualBoundingBoxAscent/t),i===this._lines.length-1&&(p=o.actualBoundingBoxDescent/t)}));const m=i.getFontMetrics(this._parameters),y=Math.max(h,m.maxAscent),g=Math.max(f,m.maxDescent),b=d,v="underline"===this._parameters.definition.font.decoration?g:p,S=c;this._metricsCached=new u(b,v,y,g,S)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return.2*this._midLineHeight}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,1)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(null==this._renderPixelRatio){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case e.TextRenderAlignment.Left:return this._horizontalPadding;case e.TextRenderAlignment.Center:return(this.displayWidth-this._lineWidths[t])/2;case e.TextRenderAlignment.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[t]}}render(e,t,i){e.save();const o=t/=this.renderPixelRatio,s=i/=this.renderPixelRatio,n=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;t+=n,i+=a;const l=this._haloSize>0;l&&this._renderHalo(e,o,s,n,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let r=0;r<this._lines.length;++r){const o=this._lines[r],s=this._getLineXOffset(r);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,o,t+s,i),this._renderLineDecoration(e,t+s,i,this._textWidths[r])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,o,t+this._getLineXOffset(r),i),this._renderLineDecoration(e,t+s,i,this._textWidths[r]),i+=this._lineSpacing}if(r.debugFlags.TEXT_SHOW_BASELINE){e.strokeStyle=c,e.setLineDash([2,2]),e.lineWidth=1;let t=s+a;for(let r=0;r<this._lines.length;++r)this._drawLine(e,[o,t],[o+this.displayWidth,t]),t+=this._lineSpacing}if(r.debugFlags.TEXT_SHOW_BORDER&&(e.strokeStyle=c,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[o,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const t=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,o,s,t),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,t,r,i,o=!1){if("none"===this._parameters.definition.font.decoration||0===i)return;const s=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":r+=2*s;break;case"line-through":r-=.33*this._midLineAscent}const n=o?this._haloSize:0;e.strokeStyle=o?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(s+2*n),e.beginPath(),e.moveTo(this._toRenderUnit(t-n),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(t+i+n),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,r,i,o){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const s=this.renderedWidth,n=this.renderedHeight;0!==o?(o=t.clamp(o,0,Math.floor(n/2)),e.beginPath(),e.moveTo(r,i+o),e.arcTo(r,i,r+o,i,o),e.lineTo(r+s-o,i),e.arcTo(r+s,i,r+s,i+o,o),e.lineTo(r+s,i+n-o),e.arcTo(r+s,i+n,r+s-o,i+n,o),e.lineTo(r+o,i+n),e.arcTo(r,i+n,r,i+n-o,o),e.closePath()):e.rect(r,i,s,n)}_renderHalo(e,t,r,i,s){const n=this.renderedWidth,c=this.renderedHeight,u=o.getTextHelperCanvas(a,Math.max(n,l),Math.max(c,l)),d=u.getContext("2d");d.clearRect(0,0,n,c),this._parameters.setFontProperties(d,this._renderedFontSize),d.fillStyle=this._parameters.haloStyle,d.strokeStyle=this._parameters.haloStyle;const p=this._renderedHaloSize<3;d.lineJoin=p?"miter":"round",p?this._renderHaloEmulated(d,i,s):this._renderHaloNative(d,i,s);let h=s;for(let e=0;e<this._lines.length;++e){const t=this._getLineXOffset(e);this._renderLineDecoration(d,i+t,h,this._textWidths[e],!0),h+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(u,0,0,n,c,this._toRenderUnit(t),this._toRenderUnit(r),n,c),e.globalAlpha=1}_renderHaloEmulated(e,t,r){for(let i=0;i<this._lines.length;++i){const o=this._lines[i],n=this._getLineXOffset(i);for(const[i,a]of s)this._fillText(e,o,t+n+this._haloSize*i,r+this._haloSize*a);r+=this._lineSpacing}}_renderHaloNative(e,t,r){const i=2*this._haloSize;for(let o=0;o<this._lines.length;++o){const s=this._lines[o],n=this._getLineXOffset(o),a=5,l=.1;for(let o=0;o<a;o++){const c=1-(a-1)*l+o*l;e.lineWidth=this._toRenderUnit(c*i),this._strokeText(e,s,t+n,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,t,r,i){e.fillText(t,this._toRenderUnit(r),this._toRenderUnit(i))}_strokeText(e,t,r,i){e.strokeText(t,this._toRenderUnit(r),this._toRenderUnit(i))}_drawLine(e,t,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,t,r){const i=this._toRenderUnit(t[0]),o=this._toRenderUnit(t[1]),s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),a=Math.floor(i)+.5,l=Math.ceil(i+s)-.5,c=Math.floor(o)+.5,u=Math.ceil(o+n)-.5;e.beginPath(),e.moveTo(a,c),e.lineTo(l,c),e.lineTo(l,u),e.lineTo(a,u),e.lineTo(a,c),e.stroke()}},e.textVerticalPaddingPx=1,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/debugFlags":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n,a){"use strict";let l=class extends r{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};t.__decorate([i.property()],l.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),t.__decorate([i.property()],l.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),t.__decorate([i.property()],l.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),t.__decorate([i.property()],l.prototype,"DECONFLICTOR_SHOW_GRID",void 0),t.__decorate([i.property()],l.prototype,"LABELS_SHOW_BORDER",void 0),t.__decorate([i.property()],l.prototype,"TEXT_SHOW_BASELINE",void 0),t.__decorate([i.property()],l.prototype,"TEXT_SHOW_BORDER",void 0),t.__decorate([i.property()],l.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),t.__decorate([i.property()],l.prototype,"OVERLAY_SHOW_CENTER",void 0),t.__decorate([i.property()],l.prototype,"SHOW_POI",void 0),t.__decorate([i.property()],l.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),t.__decorate([i.property()],l.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),t.__decorate([i.property()],l.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),t.__decorate([i.property()],l.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),t.__decorate([i.property()],l.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),t.__decorate([i.property()],l.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),t.__decorate([i.property()],l.prototype,"I3S_TREE_SHOW_TILES",void 0),t.__decorate([i.property()],l.prototype,"I3S_SHOW_MODIFICATIONS",void 0),t.__decorate([i.property()],l.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),t.__decorate([i.property()],l.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),t.__decorate([i.property()],l.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),t.__decorate([i.property()],l.prototype,"LINE_WIREFRAMES",void 0),l=t.__decorate([a.subclass("esri.views.3d.support.debugFlags")],l);const c=new l;e.debugFlags=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/FontMetrics":function(){define(["exports","./TextHelperCanvas"],(function(e,t){"use strict";const r=new Map;class i{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,t){this.maxAscent=e,this.maxDescent=t}}const o={canvas:null},s=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})();e.getFontMetrics=function(e){const{size:n}=e.definition,a=e.fontString(n);let l=r.get(a);if(!l){const c=t.getTextHelperCanvas(o,0,0).getContext("2d");e.setFontProperties(c,n);const u=c.measureText(s);l=new i(u.actualBoundingBoxAscent,u.actualBoundingBoxDescent),r.set(a,l)}return l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/TextHelperCanvas":function(){define(["exports"],(function(e){"use strict";e.getTextHelperCanvas=function(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/featureData/processingUtils":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../geometry/projection/projectBuffer","../../../../../../geometry/projection/projectVectorToVector","../../../../../../geometry/support/aaBoundingRect"],(function(e,t,r,i,o){"use strict";function s(e){const{featureCount:t}=e;if(0===t)return new Float64Array;const r=new Float64Array(3*t);return e.getCoordinatesArray(r),r}function n(e,t){const i=e.length/3,o=t.viewSpatialReference,s=t.renderSpatialReference,n=new Float64Array(3*i);if(!r.projectBuffer(e,o,0,n,s,0,i))throw new Error("Failed to project coordinates");return n}e.computeRenderCoordinates=function(e,t){const{featureCount:r}=e;return 0===r?new Float64Array:n(s(e),t)},e.computeTileCenterRenderCoordinates=function(e,r){const s=r.viewSpatialReference,n=r.renderSpatialReference,{extent:a}=e,l=o.center(a),c=t.create();return i.projectVectorToVector([l[0],l[1],0],s,c,n),c},e.projectToRenderCoordinates=n,e.readMapCoordinates=s,e.readObjectIds=function(e){const{featureCount:t}=e;if(0===t)return new Uint32Array;const r=new Uint32Array(t);return e.getObjectIdsArray(r),r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/projection/projectVectorToVector":function(){define(["exports","../projectionUtils","../SpatialReference","./projectPointToVector","../../layers/graphics/dehydratedPoint"],(function(e,t,r,i,o){"use strict";function s(e,t,r,o,s){return!(null==t||null==o||e.length<2)&&(n.x=e[0],n.y=e[1],n.z=e[2],n.spatialReference=t,i.projectPointToVector(n,r,o,s))}const n=o.makeDehydratedPoint(0,0,0,r.WGS84);e.projectVectorToVector=s,e.projectVectorToVectorAsync=async function(e,r,i,o,n,a){return await t.initializeProjection(r,o,null,a),s(e,r,i,o,n)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/projection/projectPointToVector":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projectionUtils","./projectBuffer"],(function(e,t,r,i){"use strict";function o(e,t,o,n){if(r.canProjectWithoutEngine(e.spatialReference,o)){s[0]=e.x,s[1]=e.y;const r=e.z;return s[2]=r??n??0,i.projectBuffer(s,e.spatialReference,0,t,o,0)}const a=r.tryProjectWithZConversion(e,o);return!!a&&(t[0]=a?.x,t[1]=a?.y,t[2]=a?.z??n??0,!0)}const s=t.create();e.projectPointToVector=o,e.projectPointToVectorAsync=async function(e,t,i,s,n){return await r.initializeProjection(e.spatialReference,i,null,n),o(e,t,i,s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/symbolization/symbolizationUtils":function(){define(["exports","../../../../../../geometry/support/Indices"],(function(e,t){"use strict";e.inputAttributesToAttributesMap=function(e){const r=new Map;for(const[i,o]of e)r.set(i,{...o,indices:t.compactIndices(o.indices)});return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/Indices":function(){define(["exports","../../core/typedArrayUtil"],(function(e,t){"use strict";function r(e,r){if(Array.isArray(e)){if(e.length<t.nativeArrayMaxSize)return e}else if(e.length<t.nativeArrayMaxSize)return Array.from(e);let i=!0,o=!0;return e.some(((e,t)=>(i=i&&0===e,o=o&&e===t,!i&&!o))),i?c(e.length):o?n(e.length):t.isTypedArray(e)&&e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?e:function(e,r){for(const i of e){if(i>=65536)return t.isTypedArray(e)?e:new Uint32Array(e);i>=256&&(r=!1)}return r?new Uint8Array(e):new Uint16Array(e)}(e,!r)}let i=a(131072);const o=[0],s=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function n(e){return 1===e?o:e<t.nativeArrayMaxSize?Array.from(new Uint16Array(s.buffer,0,e)):e<s.length?new Uint16Array(s.buffer,0,e):(e>i.length&&(i=a(Math.max(2*i.length,e))),new Uint32Array(i.buffer,0,e))}function a(e){const t=new Uint32Array(e);for(let e=0;e<t.length;e++)t[e]=e;return t}let l=new Uint8Array(65536);function c(e){if(1===e)return o;if(e<t.nativeArrayMaxSize)return new Array(e).fill(0);if(e>l.length){const t=Math.max(2*l.length,e);l=new Uint8Array(t)}return new Uint8Array(l.buffer,0,e)}e.compactIndices=r,e.compactMeshIndices=function(e){return r(e,!0)},e.getContinuousIndexArray=n,e.getZeroIndexArray=c,e.newIndexArray=function(e){return e<=t.nativeArrayMaxSize?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)},e.newIntArray=function(e){return e<=t.nativeArrayMaxSize?new Array(e):new Uint32Array(e)},e.pruneIndexArrays=function(){i=a(131072),l=new Uint8Array(65536)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/engineContent/sdfPrimitives":function(){define(["exports","../../../../core/has","../../../../core/floatRGBA","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../webgl-engine/lib/Texture","../../../webgl/enums"],(function(e,t,r,i,o,s){"use strict";const n=.5,a=i.freeze(.25,.25,.75,.75);function l(e,t=128,r=t*n,i=0){return{data:c(e,t,r,i),parameters:{mipmap:!1,wrap:{s:s.TextureWrapMode.CLAMP_TO_EDGE,t:s.TextureWrapMode.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0}}}function c(e,t=128,r=t*n,i=0){switch(e){case"circle":default:return u(t,r);case"square":return d(t,r);case"cross":return h(t,r,i);case"x":return f(t,r,i);case"kite":return p(t,r);case"triangle":return m(t,r);case"arrow":return y(t,r)}}function u(e,t){const r=e/2-.5;return _(e,v(r,r,t/2))}function d(e,t){return g(e,t,!1)}function p(e,t){return g(e,t,!0)}function h(e,t,r=0){return b(e,t,!1,r)}function f(e,t,r=0){return b(e,t,!0,r)}function m(e,t){return _(e,S(e/2,t,t/2))}function y(e,t){const r=t,i=t/2,o=e/2,s=.8*r,n=v(o,(e-t)/2-s,Math.sqrt(s*s+i*i)),a=S(o,r,i);return _(e,((e,t)=>Math.max(a(e,t),-n(e,t))))}function g(e,t,r){return r&&(t/=Math.SQRT2),_(e,((i,o)=>{let s=i-.5*e+.25,n=.5*e-o-.75;if(r){const e=(s+n)/Math.SQRT2;n=(n-s)/Math.SQRT2,s=e}return Math.max(Math.abs(s),Math.abs(n))-.5*t}))}function b(e,t,r,i=0){t-=i,r&&(t*=Math.SQRT2);const o=.5*t;return _(e,((t,s)=>{let n,a=t-.5*e,l=.5*e-s-1;if(r){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),n=a>l?a>o?Math.sqrt((a-o)*(a-o)+l*l):l:l>o?Math.sqrt(a*a+(l-o)*(l-o)):a,n-=i/2,n}))}function v(e,t,r){return(i,o)=>{const s=i-e,n=o-t;return Math.sqrt(s*s+n*n)-r}}function S(e,t,r){const i=Math.sqrt(t*t+r*r);return(o,s)=>{const n=Math.abs(o-e)-r,a=s-e+t/2+.75,l=(t*n+r*a)/i,c=-a;return Math.max(l,c)}}function _(e,t){const i=new Uint8Array(4*e*e);for(let o=0;o<e;o++)for(let s=0;s<e;s++){const n=s+e*o;let a=t(s,o);a=a/e+.5,r.packFloatRGBA(a,i,4*n)}return i}e.createArrow=y,e.createCircle=u,e.createCross=h,e.createKite=p,e.createPrimitive=c,e.createSquare=d,e.createTexture=function(e,t=128,r=t*n,i=0){const{data:s,parameters:a}=l(e,t,r,i);return new o.Texture(s,a)},e.createTextureInfo=l,e.createTriangle=m,e.createX=f,e.defaultBoundingBox=a,e.defaultSymbolSizeRatio=n,e.defaultTexSize=128,e.requiresHalfTexelOffset=function(e){return"cross"===e||"x"===e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],(function(e,t){"use strict";function r(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*o[i];return r}const i=[1,256,65536,16777216],o=[1/256,1/65536,1/16777216,1/4294967296],s=r(new Uint8ClampedArray([255,255,255,255]));e.packFloatRGBA=function(e,r,o=0){const n=t.clamp(e,0,s);for(let e=0;e<4;e++)r[o+e]=Math.floor(256*((a=n*i[e])-Math.floor(a)));var a},e.unpackFloatRGBA=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/Texture":function(){define(["exports","../../../../core/has","../../../../core/Error","../../../../core/Evented","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/typedArrayUtil","../../../../core/uid","../../../../core/urlUtils","../../../../layers/support/videoUtils","../../../../support/requestImageUtils","../../../../support/requestUtils","./basicInterfaces","./BasisUtil","./DDSUtil","./textureUtils","./Util","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v){"use strict";function S(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}const _={wrap:{s:g.TextureWrapMode.REPEAT,t:g.TextureWrapMode.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1};e.Texture=class{constructor(e,t){this._data=e,this.id=a.generateUID(),this.events=new i,this._parameters={..._,...t},this._startPreload(e)}dispose(){this.unload(),this._data=this.update=void 0}_startPreload(e){e instanceof HTMLVideoElement?(this.update=t=>this._update(e,t),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e)}_startPreloadVideoElement(e){if(!(l.isBlobProtocol(e.src)||"auto"===e.preload&&e.crossOrigin)&&(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src,e.paused&&e.autoplay)){const t=[];c.whenVideoPlayable(e,(e=>t.push(e))).then((()=>{e.play()})).finally((()=>t.forEach((e=>e.remove()))))}}_startPreloadImageElement(e){l.isDataProtocol(e.src)||l.isBlobProtocol(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const t=new v.TextureDescriptor;return t.wrapMode=this._parameters.wrap??g.TextureWrapMode.REPEAT,t.flipped=!this._parameters.noUnpackFlip,t.samplingMode=this._parameters.mipmap?g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:g.TextureSamplingMode.LINEAR,t.hasMipmap=!!this._parameters.mipmap,t.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,t.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),t}get glTexture(){return this._glTexture??this._emptyTexture}get loaded(){return null!=this._glTexture}get usedMemory(){return this._glTexture?.usedMemory||function(e,t){if(null==e)return 0;if(n.isArrayBuffer(e)||n.isUint8Array(e))return t.encoding===p.TextureEncodingMimeType.KTX2_ENCODING?h.estimateMemoryKTX2(e,!!t.mipmap):t.encoding===p.TextureEncodingMimeType.BASIS_ENCODING?h.estimateMemoryBasis(e,!!t.mipmap):e.byteLength;const{width:r,height:i}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?S(e):t;return(t.mipmap?4/3:1)*r*i*(t.components||4)||0}(this._data,this._parameters)}load(e){if(this._loadingPromise)return this._loadingPromise;if(this._glTexture)return this._glTexture;const t=this._data;return null==t?(this._glTexture=new b.Texture(e,this._createDescriptor(e),null),this._glTexture):(this._emptyTexture=e.emptyTexture,this._parameters.reloadable||(this._data=void 0),"string"==typeof t?this._loadFromURL(e,t):t instanceof Image?this._loadFromImageElement(e,t):t instanceof HTMLVideoElement?this._loadFromVideoElement(e,t):t instanceof ImageData||t instanceof HTMLCanvasElement?this._loadFromImage(e,t):n.isUint8Array(t)&&this._parameters.encoding===p.TextureEncodingMimeType.DDS_ENCODING?this._loadFromDDSData(e,t):n.isArrayBuffer(t)&&this._parameters.encoding===p.TextureEncodingMimeType.DDS_ENCODING?this._loadFromDDSData(e,new Uint8Array(t)):(n.isArrayBuffer(t)||n.isUint8Array(t))&&this._parameters.encoding===p.TextureEncodingMimeType.KTX2_ENCODING?this._loadFromKTX2(e,t):(n.isArrayBuffer(t)||n.isUint8Array(t))&&this._parameters.encoding===p.TextureEncodingMimeType.BASIS_ENCODING?this._loadFromBasis(e,t):n.isUint8Array(t)?this._loadFromPixelData(e,t):n.isArrayBuffer(t)?this._loadFromPixelData(e,new Uint8Array(t)):null)}_update(e,t){return null==this._glTexture||e.readyState<HTMLMediaElement.HAVE_CURRENT_DATA||t===e.currentTime?t:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,t){return this._glTexture=f.createDDSTexture(e,this._createDescriptor(e),t),this._emptyTexture=null,this._glTexture}_loadFromKTX2(e,t){return this._loadAsync((()=>h.createTextureKTX2(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromBasis(e,t){return this._loadAsync((()=>h.createTextureBasis(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromPixelData(e,t){y.assert(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=1===this._parameters.components?g.PixelFormat.LUMINANCE:3===this._parameters.components?g.PixelFormat.RGB:g.PixelFormat.RGBA,r.pixelFormat!==g.PixelFormat.RGB&&r.pixelFormat!==g.PixelFormat.RGBA||(r.compress=this._parameters.compressionOptions),r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new b.Texture(e,r,t),this._glTexture}_loadFromURL(e,t){return this._loadAsync((async r=>{const i=await u.requestImage(t,{signal:r});return s.throwIfAborted(r),this._loadFromImage(e,i)}))}_loadFromImageElement(e,t){return t.complete?this._loadFromImage(e,t):this._loadAsync((async r=>{const i=await d.loadImageAsync(t,t.src,!1,r);return s.throwIfAborted(r),this._loadFromImage(e,i)}))}_loadFromVideoElement(e,t){return t.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?this._loadFromImage(e,t):this._loadFromVideoElementAsync(e,t)}_loadFromVideoElementAsync(e,t){return this._loadAsync((i=>new Promise(((n,a)=>{const l=()=>{t.removeEventListener("loadeddata",c),t.removeEventListener("error",u),o.removeMaybe(d)},c=()=>{t.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA&&(l(),n(this._loadFromImage(e,t)))},u=e=>{l(),a(e||new r("texture:load-error","Failed to load video"))};t.addEventListener("loadeddata",c),t.addEventListener("error",u);const d=s.onAbort(i,(()=>u(s.createAbortError())))}))))}_loadFromImage(e,t){let r=t;r instanceof HTMLVideoElement||(r=m.ensureImageMaxSize(r,e.parameters));const i=S(r);this._parameters.width=i.width,this._parameters.height=i.height;const o=this._createDescriptor(e);return o.pixelFormat=3===this._parameters.components?g.PixelFormat.RGB:g.PixelFormat.RGBA,o.width=i.width,o.height=i.height,o.compress=this._parameters.compressionOptions,this._glTexture=new b.Texture(e,o,r),this._emptyTexture=null,this.events.emit("loaded"),this._glTexture}_loadAsync(e){const t=new AbortController;this._loadingController=t;const r=e(t.signal);this._loadingPromise=r;const i=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null),this._emptyTexture=null};return r.then(i,i),r}unload(){if(this._glTexture=o.disposeMaybe(this._glTexture),this._emptyTexture=null,null!=this._loadingController){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}get parameters(){return this._parameters}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/support/videoUtils":function(){define(["exports","../../core/events"],(function(e,t){"use strict";e.whenVideoPlayable=function(e,r){return new Promise(((i,o)=>{e.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?i():(r(t.once(e,"canplay",i)),r(t.once(e,"error",o)))}))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/support/requestImageUtils":function(){define(["exports","../request"],(function(e,t){"use strict";e.requestImage=async function(e,r){const{data:i}=await t(e,{responseType:"image",...r});return i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],(function(e){"use strict";var t,r,i,o,s,n,a,l;e.CullFaceOptions=void 0,(t=e.CullFaceOptions||(e.CullFaceOptions={}))[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT",e.DepthTestFunction=void 0,(r=e.DepthTestFunction||(e.DepthTestFunction={}))[r.Less=0]="Less",r[r.Lequal=1]="Lequal",r[r.COUNT=2]="COUNT",e.RenderRequestType=void 0,(i=e.RenderRequestType||(e.RenderRequestType={}))[i.BACKGROUND=0]="BACKGROUND",i[i.UPDATE=1]="UPDATE",e.ResourceState=void 0,(o=e.ResourceState||(e.ResourceState={}))[o.NOT_LOADED=0]="NOT_LOADED",o[o.LOADING=1]="LOADING",o[o.LOADED=2]="LOADED",e.StencilBits=void 0,(s=e.StencilBits||(e.StencilBits={}))[s.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",s[s.OutlineVisualElementMask=2]="OutlineVisualElementMask",e.Object3DState=void 0,(n=e.Object3DState||(e.Object3DState={}))[n.Highlight=0]="Highlight",n[n.MaskOccludee=1]="MaskOccludee",e.AlphaDiscardMode=void 0,(a=e.AlphaDiscardMode||(e.AlphaDiscardMode={}))[a.Blend=0]="Blend",a[a.Opaque=1]="Opaque",a[a.Mask=2]="Mask",a[a.MaskBlend=3]="MaskBlend",a[a.COUNT=4]="COUNT",e.TextureEncodingMimeType=void 0,(l=e.TextureEncodingMimeType||(e.TextureEncodingMimeType={})).DDS_ENCODING="image/vnd-ms.dds",l.KTX2_ENCODING="image/ktx2",l.BASIS_ENCODING="image/x.basis",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define(["exports","../../../../libs/basisu/BasisUTranscoder","../../../../libs/basisu/TextureFormat","../../../webgl/enums","../../../webgl/Texture","../../../webgl/Util"],(function(e,t,r,i,o,s){"use strict";let n=null,a=null;async function l(){return null==a&&(a=t.getBasisTranscoder(),n=await a),a}function c(e,t,r,o,n){const a=s.getBytesPerElementFormat(t?i.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:i.CompressedTextureFormat.COMPRESSED_RGB8_ETC2),l=n&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*o*a*l)}function u(e){return e.getNumImages()>=1&&!e.isUASTC()}function d(e){return e.getFaces()>=1&&e.isETC1S()}function p(e,t,s,n,a,l,c,u){const{compressedTextureETC:d,compressedTextureS3TC:p}=e.capabilities,[h,f]=d?n?[r.TextureFormat.ETC2_RGBA,i.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[r.TextureFormat.ETC1_RGB,i.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:p?n?[r.TextureFormat.BC3_RGBA,i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[r.TextureFormat.BC1_RGB,i.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[r.TextureFormat.RGBA32,i.PixelFormat.RGBA],m=t.hasMipmap?s:Math.min(1,s),y=[];for(let e=0;e<m;e++)y.push(new Uint8Array(c(e,h))),u(e,h,y[e]);return t.internalFormat=f,t.hasMipmap=y.length>1,t.samplingMode=t.hasMipmap?i.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:i.TextureSamplingMode.LINEAR,t.width=a,t.height=l,new o.Texture(e,t,{type:"compressed",levels:y})}e.checkKTX2=d,e.createTextureBasis=async function(e,t,r){null==n&&(n=await l());const i=new n.BasisFile(new Uint8Array(r));if(!u(i))return null;i.startTranscoding();const o=p(e,t,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),((e,t)=>i.getImageTranscodedSizeInBytes(0,e,t)),((e,t,r)=>i.transcodeImage(r,0,e,t,0,0)));return i.close(),i.delete(),o},e.createTextureKTX2=async function(e,t,r){null==n&&(n=await l());const i=new n.KTX2File(new Uint8Array(r));if(!d(i))return null;i.startTranscoding();const o=p(e,t,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),((e,t)=>i.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,r)=>i.transcodeImage(r,e,0,0,t,0,-1,-1)));return i.close(),i.delete(),o},e.estimateMemoryBasis=function(e,t){if(null==n)return e.byteLength;const r=new n.BasisFile(new Uint8Array(e)),i=u(r)?c(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),i},e.estimateMemoryKTX2=function(e,t){if(null==n)return e.byteLength;const r=new n.KTX2File(new Uint8Array(e)),i=d(r)?c(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),i},e.loadBasisTranscoder=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/libs/basisu/BasisUTranscoder":function(){define(["require","exports","../../assets"],(function(e,t,r){"use strict";let i;t.getBasisTranscoder=function(){return i??=(async()=>{const t=await new Promise(((t,r)=>e(["../../chunks/basis_transcoder"],t,r))),i=await t.default({locateFile:e=>r.getAssetUrl(`esri/libs/basisu/${e}`)});return i.initializeBasis(),i})(),i},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/libs/basisu/TextureFormat":function(){define(["exports"],(function(e){"use strict";var t;e.TextureFormat=void 0,(t=e.TextureFormat||(e.TextureFormat={}))[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/Texture":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger","../../core/maybe","../../core/promiseUtils","./checkWebGLError","./enums","./FBOAttachmentType","./TextureDescriptor","./textureUtils","./ValidatedTextureDescriptor"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";const p=()=>i.getLogger("esri/views/webgl/Texture");let h=class e{static{this.TEXTURE_UNIT_FOR_UPDATES=0}static{this.compressionWorkerHandle=null}constructor(e,r=null,i=null){if(this.type=l.FBOAttachmentType.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._shadowFilterDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const i=d.ValidatedTextureDescriptor.validate(e,r);if(!i)throw new t("texture:invalid-descriptor","Texture descriptor invalid");this._descriptor=i}this._descriptor.target===a.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return c.estimateMemory(this._descriptor)}get cachedMemory(){return this.usedMemory}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty||this._shadowFilterDirty}get hasWebGLTextureObject(){return!!this._glName}dispose(){this.abortCompression(),this._descriptor.context.gl&&this.hasWebGLTextureObject&&(this._descriptor.context.instanceCounter.decrement(a.ResourceType.Texture,this),this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new t("texture:immutable-resize","Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===a.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.compress=e}disableCompression(){this._descriptor.compress=void 0}setData(e){this.abortCompression(),!u.isCompressedData(e)&&this._descriptor.internalFormat&&this._descriptor.internalFormat in a.CompressedTextureFormat&&(this._descriptor.internalFormat=void 0),this._setData(e),!u.isCompressedData(e)&&this._descriptor.compress&&this._compressOnWorker(e)}updateData(r,i,o,s,n,a,l=0){a||p().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||p().error("An attempt to update uninitialized texture!");const c=this._descriptor;c.internalFormat=u.deriveInternalFormat(c);const{context:d,pixelFormat:h,dataType:f,target:m,isImmutable:y}=c;if(y&&!this._wasImmutablyAllocated)throw new t("texture:uninitialized","Cannot update immutable texture before allocation!");const g=d.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||o<0||i+s>c.width||o+n>c.height)&&p().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=d;l&&(s&&n||p().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),b.pixelStorei(b.UNPACK_SKIP_ROWS,l)),u.isTexImageSource(a)?b.texSubImage2D(m,r,i,o,s,n,h,f,a):u.isCompressedData(a)?b.compressedTexSubImage2D(m,r,i,o,s,n,c.internalFormat,a.levels[r]):b.texSubImage2D(m,r,i,o,s,n,h,f,a),l&&b.pixelStorei(b.UNPACK_SKIP_ROWS,0),d.bindTexture(g,e.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(r,i,o,s,n,a,l,c){c||p().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||p().error("An attempt to update an uninitialized texture!");const d=this._descriptor;d.internalFormat=u.deriveInternalFormat(d);const{context:h,pixelFormat:f,dataType:m,isImmutable:y,target:g}=d;if(y&&!this._wasImmutablyAllocated)throw new t("texture:uninitialized","Cannot update immutable texture before allocation!");u.is3DTarget(g)||p().warn("Attempting to set 3D texture data on a non-3D texture");const b=h.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),(i<0||o<0||s<0||i+n>d.width||o+a>d.height||s+l>d.depth)&&p().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=h;if(u.isCompressedData(c))c=c.levels[r],v.compressedTexSubImage3D(g,r,i,o,s,n,a,l,d.internalFormat,c);else{const e=c;v.texSubImage3D(g,r,i,o,s,n,a,l,f,m,e)}h.bindTexture(b,e.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const r=this._descriptor;if(0===r.width||0===r.height)return;if(!r.hasMipmap){if(this._wasImmutablyAllocated)throw new t("texture:immutable-change","Cannot add mipmaps to immutable texture after allocation");r.hasMipmap=!0,this._samplingModeDirty=!0,u.validateTexture(r)}r.samplingMode===a.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,r.samplingMode=a.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):r.samplingMode===a.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,r.samplingMode=a.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(r.target),this._descriptor.context.bindTexture(i,e.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new t("texture:immutable-change","Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,u.validateTexture(e)}e.samplingMode===a.TextureSamplingMode.LINEAR_MIPMAP_NEAREST?(this._samplingModeDirty=!0,e.samplingMode=a.TextureSamplingMode.LINEAR):e.samplingMode===a.TextureSamplingMode.NEAREST_MIPMAP_NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=a.TextureSamplingMode.NEAREST)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,u.validateTexture(this._descriptor),this._wrapModeDirty=!0)}setShadowFiltering(e){e!==this._descriptor.linearFilterDepth&&(this._descriptor.linearFilterDepth=this._descriptor.compareEnabled=e,this.setSamplingMode(e?a.TextureSamplingMode.LINEAR:a.TextureSamplingMode.NEAREST),u.validateTexture(this._descriptor),this._shadowFilterDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1),this._shadowFilterDirty&&(this._applyShadowMode(),this._shadowFilterDirty=!1)}abortCompression(){this._compressionAbortController=o.abortMaybe(this._compressionAbortController)}_setData(r,i){const o=this._descriptor,s=o.context?.gl;if(!s)return;n.checkWebGLError(s),this.hasWebGLTextureObject||(this._glName=s.createTexture(),o.context.instanceCounter.increment(a.ResourceType.Texture,this)),u.validateTexture(o);const l=o.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);o.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),n.checkWebGLError(s);const c=i??o.target,d=u.is3DTarget(c);if(u.isTexImageSource(r))this._setDataFromTexImageSource(r,c);else{const{width:e,height:i,depth:a}=o;if(null==e||null==i)throw new t("texture:missing-size","Width and height must be specified!");if(d&&null==a)throw new t("texture:missing-depth","Depth must be specified!");if(o.internalFormat=u.deriveInternalFormat(o),o.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(c,o.internalFormat,o.hasMipmap,e,i,a),u.isCompressedData(r)){if(!u.isCompressedFormat(o.internalFormat))throw new t("texture:format-mismatch","Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(r,o.internalFormat,c)}else this._texImage(c,0,o.internalFormat,e,i,a,r),n.checkWebGLError(s),o.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),this._applyShadowMode(),n.checkWebGLError(s),o.context.bindTexture(l,e.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let t=a.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;t<=a.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;t++)this._setData(e,t)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:i}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0)}_setDataFromTexImageSource(e,t){const{gl:r}=this._descriptor.context,i=this._descriptor;i.internalFormat=u.deriveInternalFormat(i);const o=u.is3DTarget(t),{width:s,height:a,depth:l}=u.getDimensions(e);i.width&&i.height,i.width||(i.width=s),i.height||(i.height=a),o&&i.depth,o&&(i.depth=l),i.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(t,i.internalFormat,i.hasMipmap,s,a,l),this._texImage(t,0,i.internalFormat,s,a,l,e),n.checkWebGLError(r),i.hasMipmap&&(this.generateMipmap(),n.checkWebGLError(r))}_setDataFromCompressedSource(e,t,r){const i=this._descriptor,{width:o,height:s,depth:n}=i,l=e.levels,c=u.calcMipmapLevels(r,o,s,n),d=Math.min(c,l.length)-1;this._descriptor.context.gl.texParameteri(i.target,a.TextureConstants.MAX_LEVEL,d),this._forEachMipmapLevel(((e,i,o,s)=>{const n=l[Math.min(e,l.length-1)];this._compressedTexImage(r,e,t,i,o,s,n)}),d)}_texStorage(e,r,i,o,s,n){const{gl:a}=this._descriptor.context;if(!u.isSizedPixelFormat(r)&&!u.isSizedDepthFormat(r)&&!u.isSizedDepthStencilFormat(r))throw new t("texture:missing-format","Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?u.calcMipmapLevels(e,o,s,n):1;if(u.is3DTarget(e)){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,o,s,n)}else a.texStorage2D(e,l,r,o,s);this._wasImmutablyAllocated=!0}_texImage(e,r,i,o,s,n,a){const l=this._descriptor.context.gl,c=u.is3DTarget(e),{isImmutable:d,pixelFormat:p,dataType:h}=this._descriptor;if(d){if(null!=a){const i=a;if(c){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");l.texSubImage3D(e,r,0,0,0,o,s,n,p,h,i)}else l.texSubImage2D(e,r,0,0,o,s,p,h,i)}}else{const u=a;if(c){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");l.texImage3D(e,r,i,o,s,n,0,p,h,u)}else l.texImage2D(e,r,i,o,s,0,p,h,u)}}_compressedTexImage(e,r,i,o,s,n,a){const l=this._descriptor.context.gl,c=u.is3DTarget(e);if(this._descriptor.isImmutable){if(null!=a)if(c){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,r,0,0,0,o,s,n,i,a)}else l.compressedTexSubImage2D(e,r,0,0,o,s,i,a)}else if(c){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,r,i,o,s,n,0,a)}else l.compressedTexImage2D(e,r,i,o,s,0,a)}async _compressOnWorker(t){const{width:r,height:i,context:o,flipped:n,preMultiplyAlpha:l,hasMipmap:c}=this._descriptor,u=this._descriptor.compress?.compressionTracker,d=this._descriptor.compress?.compressionCallback,{compressedTextureETC:h,compressedTextureS3TC:f}=o.capabilities;if(!e.compressionWorkerHandle?.isCompressible(t,this._descriptor)||!h&&!f)return;this.abortCompression();const m=new AbortController;this._compressionAbortController=m,u?.increment();try{let o;t instanceof Uint8Array?o=t.buffer:(o=await createImageBitmap(t,{imageOrientation:n?"flipY":"none"}),s.throwIfAborted(m));const u={data:o,width:r,height:i,needsFlip:t instanceof Uint8Array&&this.descriptor.flipped,components:this._descriptor.pixelFormat===a.PixelFormat.RGBA?4:3,preMultiplyAlpha:l,hasMipmap:c,hasETC:!!h,hasS3TC:!!f},p=await e.compressionWorkerHandle.invoke(u,m.signal,"low");if(s.throwIfAborted(m),p.compressedTexture&&this.hasWebGLTextureObject){const e=this.usedMemory;this._descriptor.internalFormat=p.internalFormat,this._setData(p.compressedTexture),d?.(e-this.usedMemory)}}catch(e){s.isAbortError(e)||p().error("Texture compression failed!")}finally{u?.decrement(),this._compressionAbortController?.signal.aborted&&(this._compressionAbortController=null)}}_forEachMipmapLevel(e,r=1/0){let{width:i,height:o,depth:s,hasMipmap:n,target:l}=this._descriptor;const c=l===a.TextureType.TEXTURE_3D;if(null==i||null==o||c&&null==s)throw new t("texture:missing-size","Missing texture dimensions for mipmap calculation");for(let t=0;e(t,i,o,s),n&&(1!==i||1!==o||c&&1!==s)&&!(t>=r);++t)i=Math.max(1,i>>1),o=Math.max(1,o>>1),c&&(s=Math.max(1,s>>1))}_applySamplingMode(){const e=this._descriptor,t=e.context?.gl;let r=e.samplingMode,i=e.samplingMode;r===a.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||r===a.TextureSamplingMode.LINEAR_MIPMAP_LINEAR?(r=a.TextureSamplingMode.LINEAR,e.hasMipmap||(i=a.TextureSamplingMode.LINEAR)):r!==a.TextureSamplingMode.NEAREST_MIPMAP_NEAREST&&r!==a.TextureSamplingMode.NEAREST_MIPMAP_LINEAR||(r=a.TextureSamplingMode.NEAREST,e.hasMipmap||(i=a.TextureSamplingMode.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}_applyWrapMode(){const e=this._descriptor,t=e.context?.gl;"number"==typeof e.wrapMode?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}_applyShadowMode(){const e=this._descriptor,t=e.context?.gl,r=e.compareEnabled?t.COMPARE_REF_TO_TEXTURE:t.NONE;t.texParameteri(e.target,t.TEXTURE_COMPARE_MODE,r),e.compareEnabled&&t.texParameteri(e.target,t.TEXTURE_COMPARE_FUNC,t.GREATER),n.checkWebGLError(t)}_applyAnisotropicFilteringParameters(){const e=this._descriptor,t=e.context.capabilities.textureFilterAnisotropic;t&&e.context.gl.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}};e.Texture=h,e.tracer=null,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger","./enums"],(function(e,t,r,i,o){"use strict";function s(e){switch(e){case o.ErrorConstant.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case o.ErrorConstant.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case o.ErrorConstant.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case o.ErrorConstant.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case o.ErrorConstant.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case o.ErrorConstant.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const n=!!r("enable-feature:webgl-debug");function a(){return n}e.checkWebGLError=function(e,r=a()){if(r){const r=e.getError();if(r){const e=s(r),o=(new Error).stack;i.getLogger("esri.views.webgl.checkWebGLError").error(new t("webgl-error","WebGL error occurred",{message:e,stack:o}))}}},e.getErrorMessage=s,e.hasFeatureFlagWebGLDebug=n,e.webglDebugEnabled=a,e.webglValidateShadersEnabled=function(){return n},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/FBOAttachmentType":function(){define(["exports"],(function(e){"use strict";var t;e.FBOAttachmentType=void 0,(t=e.FBOAttachmentType||(e.FBOAttachmentType={}))[t.TextureDescriptor=0]="TextureDescriptor",t[t.Texture=1]="Texture",t[t.Renderbuffer=2]="Renderbuffer",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./FBOAttachmentType","./Util"],(function(e,t,r,i){"use strict";e.TextureDescriptor=class{constructor(e=0,i=e){this.width=e,this.height=i,this.type=r.FBOAttachmentType.TextureDescriptor,this.target=t.TextureType.TEXTURE_2D,this.pixelFormat=t.PixelFormat.RGBA,this.dataType=t.PixelType.UNSIGNED_BYTE,this.samplingMode=t.TextureSamplingMode.LINEAR,this.wrapMode=t.TextureWrapMode.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.compareEnabled=!1,this.linearFilterDepth=!1,this.depth=1,this.isImmutable=!1}},e.estimateMemory=function(e){return e.width<=0||e.height<=0||e.depth<=0?0:Math.round(e.width*e.height*e.depth*(e.hasMipmap?4/3:1)*(null==e.internalFormat?4:i.getBytesPerElementFormat(e.internalFormat))*(e.target===t.TextureType.TEXTURE_CUBE_MAP?6:1))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/Util":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./getDataTypeBytes"],(function(e,t,r,i,o){"use strict";function s(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function n(e){return e[0].stride}e.bindVertexBufferLayout=function(e,t,i,n,a=0){const l=e.gl;e.bindBuffer(i);for(const i of n){const n=t.get(i.name);if(null==n){console.warn(`There is no location for vertex attribute '${i.name}' defined.`);continue}const c=a*i.stride;if(i.count<=4)l.vertexAttribPointer(n,i.count,i.type,i.normalized,i.stride,i.offset+c),l.enableVertexAttribArray(n),i.divisor>0&&e.gl.vertexAttribDivisor(n,i.divisor);else if(9===i.count)for(let t=0;t<3;t++)l.vertexAttribPointer(n+t,3,i.type,i.normalized,i.stride,i.offset+12*t+c),l.enableVertexAttribArray(n+t),i.divisor>0&&e.gl.vertexAttribDivisor(n+t,i.divisor);else if(16===i.count)for(let t=0;t<4;t++)l.vertexAttribPointer(n+t,4,i.type,i.normalized,i.stride,i.offset+16*t+c),l.enableVertexAttribArray(n+t),i.divisor>0&&e.gl?.vertexAttribDivisor(n+t,i.divisor);else console.error("Unsupported vertex attribute element count: "+i.count);if(r.webglDebugEnabled()){const t=s(e),r=o.getDataTypeBytes(i.type),n=i.offset,a=Math.round(r/n)!==r/n?`. Offset not a multiple of stride. DataType requires ${r} bytes, but descriptor has an offset of ${n}`:"";t&&console.error(`Unable to bind vertex attribute "${i.name}" with baseInstanceOffset ${c}${a}:`,t,i)}}},e.getBytesPerElementFormat=function(e){switch(e){case i.PixelFormat.ALPHA:case i.PixelFormat.LUMINANCE:case i.PixelFormat.RED:case i.PixelFormat.RED_INTEGER:case i.SizedPixelFormat.R8:case i.SizedPixelFormat.R8I:case i.SizedPixelFormat.R8UI:case i.SizedPixelFormat.R8_SNORM:case i.SizedStencilFormat.STENCIL_INDEX8:return 1;case i.PixelFormat.LUMINANCE_ALPHA:case i.PixelFormat.RG:case i.PixelFormat.RG_INTEGER:case i.SizedPixelFormat.RGBA4:case i.SizedPixelFormat.R16F:case i.SizedPixelFormat.R16I:case i.SizedPixelFormat.R16UI:case i.SizedPixelFormat.RG8:case i.SizedPixelFormat.RG8I:case i.SizedPixelFormat.RG8UI:case i.SizedPixelFormat.RG8_SNORM:case i.SizedPixelFormat.RGB565:case i.SizedPixelFormat.RGB5_A1:case i.SizedDepthFormat.DEPTH_COMPONENT16:return 2;case i.PixelFormat.RGB:case i.PixelFormat.RGB_INTEGER:case i.SizedPixelFormat.RGB8:case i.SizedPixelFormat.RGB8I:case i.SizedPixelFormat.RGB8UI:case i.SizedPixelFormat.RGB8_SNORM:case i.SizedPixelFormat.SRGB8:case i.SizedDepthFormat.DEPTH_COMPONENT24:return 3;case i.PixelFormat.RGBA:case i.PixelFormat.RGBA_INTEGER:case i.SizedPixelFormat.RGBA8:case i.SizedPixelFormat.R32F:case i.SizedPixelFormat.R11F_G11F_B10F:case i.SizedPixelFormat.RG16F:case i.SizedPixelFormat.R32I:case i.SizedPixelFormat.R32UI:case i.SizedPixelFormat.RG16I:case i.SizedPixelFormat.RG16UI:case i.SizedPixelFormat.RGBA8I:case i.SizedPixelFormat.RGBA8UI:case i.SizedPixelFormat.RGBA8_SNORM:case i.SizedPixelFormat.SRGB8_ALPHA8:case i.SizedPixelFormat.RGB9_E5:case i.SizedPixelFormat.RGB10_A2UI:case i.SizedPixelFormat.RGB10_A2:case i.SizedDepthFormat.DEPTH_COMPONENT32F:case i.SizedDepthStencilFormat.DEPTH24_STENCIL8:return 4;case i.SizedDepthStencilFormat.DEPTH32F_STENCIL8:return 5;case i.SizedPixelFormat.RGB16F:case i.SizedPixelFormat.RGB16I:case i.SizedPixelFormat.RGB16UI:return 6;case i.SizedPixelFormat.RG32F:case i.SizedPixelFormat.RG32I:case i.SizedPixelFormat.RG32UI:case i.SizedPixelFormat.RGBA16F:case i.SizedPixelFormat.RGBA16I:case i.SizedPixelFormat.RGBA16UI:return 8;case i.SizedPixelFormat.RGB32F:case i.SizedPixelFormat.RGB32I:case i.SizedPixelFormat.RGB32UI:return 12;case i.SizedPixelFormat.RGBA32F:case i.SizedPixelFormat.RGBA32I:case i.SizedPixelFormat.RGBA32UI:return 16;case i.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case i.CompressedTextureFormat.COMPRESSED_R11_EAC:case i.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case i.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case i.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case i.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case i.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case i.CompressedTextureFormat.COMPRESSED_RG11_EAC:case i.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case i.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case i.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0},e.getErrorString=s,e.getStride=n,e.unbindVertexBufferLayout=function(e,t,r,o){const s=e.gl;e.bindBuffer(r);for(const r of o){const i=t.get(r.name);if(r.count<=4)s.disableVertexAttribArray(i),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i,0);else if(9===r.count)for(let t=0;t<3;t++)s.disableVertexAttribArray(i+t),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else if(16===r.count)for(let t=0;t<4;t++)s.disableVertexAttribArray(i+t),r.divisor&&r.divisor>0&&e.gl?.vertexAttribDivisor(i+t,0);else console.error("Unsupported vertex attribute element count: "+r.count)}e.unbindBuffer(i.BufferType.ARRAY_BUFFER)},e.vertexCount=function(e,t){return(e.vertexBuffers.get(t)?.usedMemory??0)/n(e.layout.get(t))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/getDataTypeBytes":function(){define(["exports","./enums"],(function(e,t){"use strict";e.getDataTypeBytes=function(e){switch(e){case t.DataType.BYTE:case t.DataType.UNSIGNED_BYTE:return 1;case t.DataType.SHORT:case t.DataType.UNSIGNED_SHORT:case t.DataType.HALF_FLOAT:return 2;case t.DataType.FLOAT:case t.DataType.INT:case t.DataType.UNSIGNED_INT:return 4}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/textureUtils":function(){define(["exports","../../core/Error","../../core/Logger","./enums"],(function(e,t,r,i){"use strict";const o=()=>r.getLogger("esri/views/webgl/textureUtils");function s(e){return e in i.SizedDepthFormat}function n(e){return e in i.SizedDepthStencilFormat}function a(e){return null!=e&&e in i.CompressedTextureFormat}function l(e){return null!=e&&"type"in e&&"compressed"===e.type}function c(e){return null!=e&&"byteLength"in e}e.calcMipmapLevels=function(e,t,r,o=1){let s=Math.max(t,r);return e===i.TextureType.TEXTURE_3D&&(s=Math.max(s,o)),Math.floor(Math.log2(s))+1},e.deriveInternalFormat=function(e){if(null!=e.internalFormat)return e.internalFormat;switch(e.dataType){case i.PixelType.FLOAT:switch(e.pixelFormat){case i.PixelFormat.RGBA:return i.SizedPixelFormat.RGBA32F;case i.PixelFormat.RGB:return i.SizedPixelFormat.RGB32F;default:throw new t("texture:unknown-format","Unable to derive format")}case i.PixelType.UNSIGNED_BYTE:switch(e.pixelFormat){case i.PixelFormat.RGBA:return i.SizedPixelFormat.RGBA8;case i.PixelFormat.RGB:return i.SizedPixelFormat.RGB8}}const{pixelFormat:r}=e;return e.internalFormat=r===i.UnsizedDepthFormat.DEPTH_STENCIL?i.SizedDepthStencilFormat.DEPTH24_STENCIL8:r===i.UnsizedDepthFormat.DEPTH_COMPONENT?i.SizedDepthFormat.DEPTH_COMPONENT24:r,e.internalFormat},e.getDimensions=function(e){let t="width"in e?e.width:e.codedWidth,r="height"in e?e.height:e.codedHeight;return e instanceof HTMLVideoElement&&(t=e.videoWidth,r=e.videoHeight),{width:t,height:r,depth:1}},e.is3DTarget=function(e){return e===i.TextureType.TEXTURE_3D||e===i.TextureType.TEXTURE_2D_ARRAY},e.isArrayBufferView=c,e.isCompressedData=l,e.isCompressedFormat=a,e.isCompressedTexture=function(e){return a(e.descriptor.internalFormat)},e.isSizedDepthFormat=s,e.isSizedDepthStencilFormat=n,e.isSizedPixelFormat=function(e){return e in i.SizedPixelFormat},e.isTexImageSource=function(e){return null!=e&&!l(e)&&!c(e)},e.validateTexture=function(e){const{width:t,height:r,depth:a}=e;(null!=t&&t<0||null!=r&&r<0||null!=a&&a<0)&&o().error("Negative dimension parameters are not allowed!");const{internalFormat:l}=e;if(l&&(s(l)||n(l))){const{linearFilterDepth:t,compareEnabled:r,samplingMode:s,hasMipmap:n}=e;n&&o().error("Depth textures cannot have mipmaps"),t?s!==i.TextureSamplingMode.LINEAR&&s!==i.TextureSamplingMode.NEAREST&&o().error("Depth textures cannot sample mipmaps"):(s!==i.TextureSamplingMode.NEAREST&&o().error("Depth textures without filtering must use NEAREST filtering"),r&&o().error("Depth textures without filtering cannot use compare function"))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],(function(e,t,r){"use strict";class i extends r.TextureDescriptor{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case t.SizedPixelFormat.R16F:case t.SizedPixelFormat.R32F:case t.SizedPixelFormat.R8_SNORM:case t.SizedPixelFormat.R8:this.pixelFormat=t.PixelFormat.RED;break;case t.SizedPixelFormat.R8I:case t.SizedPixelFormat.R8UI:case t.SizedPixelFormat.R16I:case t.SizedPixelFormat.R16UI:case t.SizedPixelFormat.R32I:case t.SizedPixelFormat.R32UI:this.pixelFormat=t.PixelFormat.RED_INTEGER}}static validate(e,t){return new i(e,t)}}e.ValidatedTextureDescriptor=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports","../../../../core/Logger","../../../webgl/enums","../../../webgl/Texture"],(function(e,t,r,i){"use strict";const o=()=>t.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function s(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const n=s("DXT1"),a=s("DXT3"),l=s("DXT5");function c(e,t){const i=new Int32Array(e.buffer,e.byteOffset,31);if(542327876!==i[0])return o().error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return o().error("Unsupported format, must contain a FourCC code"),null;const s=i[21];let c,u;switch(s){case n:c=8,u=r.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case a:c=16,u=r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case l:c=16,u=r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return o().error("Unsupported FourCC code:",(d=s,String.fromCharCode(255&d,d>>8&255,d>>16&255,d>>24&255))),null}var d;let p=1,h=i[4],f=i[3];(3&h||3&f)&&(o().warn("Rounding up compressed texture size to nearest multiple of 4."),h=h+3&-4,f=f+3&-4);const m=h,y=f;let g,b;131072&i[2]&&!1!==t&&(p=Math.max(1,i[7]));let v=e.byteOffset+i[1]+4;const S=[];for(let t=0;t<p;++t)b=(h+3>>2)*(f+3>>2)*c,g=new Uint8Array(e.buffer,v,b),S.push(g),v+=b,h=Math.max(1,h>>1),f=Math.max(1,f>>1);return{textureData:{type:"compressed",levels:S},internalFormat:u,width:m,height:y}}e.createDDSTexture=function(e,t,o){const s=c(o,t.hasMipmap??!1);if(null==s)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:a,width:l,height:u}=s;return t.samplingMode=n.levels.length>1?r.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:r.TextureSamplingMode.LINEAR,t.hasMipmap=n.levels.length>1,t.internalFormat=a,t.width=l,t.height=u,new i.Texture(e,t,n)},e.createDDSTextureData=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/textureUtils":function(){define(["exports","../../../../core/Error"],(function(e,t){"use strict";const r=16;function i(e,t){return t=Math.floor(t/r)*r,Math.min(Math.round(e/r)*r,t)}function o({width:e,height:t},{maxPreferredTexturePixels:r,maxTextureSize:o}){const s=Math.max(e,t),n=e*t;if(s<=o&&n<=r)return[e,t];const a=Math.min(Math.sqrt(r/n),o/s);return[i(Math.round(e*a),o),i(Math.round(t*a),o)]}function s(e,r,i){if(e instanceof ImageData)return s(function(e){const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const i=r.getContext("2d");if(null==i)throw new t("texture:context-failed","Failed to create 2d context from HTMLCanvasElement");return i.putImageData(e,0,0),r}(e),r,i);const o=document.createElement("canvas");return o.width=r,o.height=i,o.getContext("2d").drawImage(e,0,0,o.width,o.height),o}e.applyTextureResizeModulo=i,e.applyTextureResizeModuloCeil=function(e,t){return t=Math.floor(t/r)*r,Math.min(Math.ceil(e/r)*r,t)},e.ensureImageMaxSize=function(e,t){const[r,i]=o(e,t);return e.width===r&&e.height===i?e:s(e,r,i)},e.ensureTextureSize=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64"],(function(e,t,r,i){"use strict";const o=i.create();class s{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function n(e,t="Assertion"){if(!e){const e=new Error(t).stack;throw new s(`${t} at ${e}`)}}e.assert=n,e.isTranslationMatrix=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]},e.logWithBase=function(e,t){return Math.log(e)/Math.log(t)},e.project=function(e,t,i,s,a){o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=1,r.transformMat4(o,o,t),a.length>2&&(a[2]=-o[2]),r.transformMat4(o,o,i),n(0!==o[3]),a[0]=o[0]/o[3],a[1]=o[1]/o[3],a[2]=o[2]/o[3],a[0]=(.5*a[0]+.5)*s[2]+s[0],a[1]=(.5*a[1]+.5)*s[3]+s[1]},e.rayBoxTest=function(e,t,r,i){let o,s=(r[0]-e[0])/t[0],n=(i[0]-e[0])/t[0];s>n&&(o=s,s=n,n=o);let a=(r[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(a>l&&(o=a,a=l,l=o),s>l||a>n)return!1;a>s&&(s=a),l<n&&(n=l);let c=(r[2]-e[2])/t[2],u=(i[2]-e[2])/t[2];return c>u&&(o=c,c=u,u=o),!(s>u||c>n||(u<n&&(n=u),n<0))},e.rayRay2D=function(e,r,i,o,s,n=t.create()){const a=(o[s]-i[s])*(r[0]-e[0])-(o[0]-i[0])*(r[s]-e[s]),l=(o[0]-i[0])*(e[s]-i[s])-(o[s]-i[s])*(e[0]-i[0]);if(0===a)return!1;const c=l/a;return n[0]=e[0]+c*(r[0]-e[0]),n[1]=e[s]+c*(r[s]-e[s]),!0},e.setMatrixTranslation3=function(e,t,r,i){e[12]=t,e[13]=r,e[14]=i},e.verify=function(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/Attribute":function(){define(["exports"],(function(e){"use strict";class t{constructor(e,t,r=t){this.data=e,this.size=t,this.stride=r}}e.Attribute=class extends t{constructor(e,t,r,i=!1,o=r){super(e,r,o),this.indices=t,this.exclusive=i}},e.Vertices=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],(function(e){"use strict";var t;e.VertexAttribute=void 0,(t=e.VertexAttribute||(e.VertexAttribute={})).POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.UVI="uvi",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.ROTATION="rotation",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.NEXTDELTA="nextDelta",t.PREVIOUSDELTA="previousDelta",t.U0="u0",t.LINEPARAMETERS="lineParameters",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.PROFILEAUXDATA="profileAuxData",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.START_UP="startUp",t.END_UP="endUp",t.EXTRUDE="extrude",t.OLIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor",e.affectsGeometry=function(t){return t===e.VertexAttribute.POSITION},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/symbolization/Point3DSymbolRenderer":function(){define(["exports"],(function(e){"use strict";e.Point3DSymbolRenderer=class{constructor(e,t){this._loaded=!1,this._loadingPromise=null,this._context=null,this._symbol=null,this._symbolLayerRenderers=[],this._context=t,this._symbol=e}_destroy(){}get loaded(){return this._loaded}load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}async _load(){const{_context:e,_symbol:t,_symbolLayerRenderers:r}=this,i=[];for(const o of t.symbolLayers){const t=e.symbolRendererFactory.createSymbolRendererFromSymbolLayer(o);null!=t&&(i.push(t.load()),r.push(t))}await Promise.all(i),this._loaded=!0}async createDestroyCommand(){const{_context:e,_symbolLayerRenderers:t}=this,r=[];for(const e of t)r.push(e.createDestroyCommand());const i=e.joinPipelineCommands(await Promise.all(r));return i.appendPipelineStateCommand((()=>this._destroy())),i}async createAddCommand(e){const{_context:t,_symbolLayerRenderers:r}=this,i=[];for(const t of r)i.push(t.createAddCommand(e));return t.joinPipelineCommands(await Promise.all(i))}async createRemoveCommand(e){const{_context:t,_symbolLayerRenderers:r}=this,i=[];for(const t of r)i.push(t.createRemoveCommand(e));return t.joinPipelineCommands(await Promise.all(i))}async createUpdateVisibilityCommand(e){const{_context:t,_symbolLayerRenderers:r}=this,i=[];for(const t of r)i.push(t.createUpdateVisibilityCommand(e));return t.joinPipelineCommands(await Promise.all(i))}async createUpdateLayerViewOpacityCommand(e){const{_context:t,_symbolLayerRenderers:r}=this,i=[];for(const t of r)i.push(t.createUpdateLayerViewOpacityCommand(e));return t.joinPipelineCommands(await Promise.all(i))}async createUpdateElevationCommand(e){const{_context:t,_symbolLayerRenderers:r}=this,i=[];for(const t of r)i.push(t.createUpdateElevationCommand(e));return t.joinPipelineCommands(await Promise.all(i))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/symbolization/SimpleFeatureRenderer":function(){define(["exports"],(function(e){"use strict";e.SimpleFeatureRenderer=class{constructor(e,t){this._symbol=null,this._featureData=new Map,this._loaded=!1,this._loadingPromise=null,this._renderer=null,this._context=t,this._renderer=e}async load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}async _load(){const{_renderer:e,_context:t}=this;this._symbol=t.symbolRendererFactory.createSymbolRendererFromSymbol(e.symbol),this._loaded=!0}get loaded(){return this._loaded}async createAddCommand(e){const t=this._context,r=await this._provisionSymbol(),i=null==r?t.createPipelineCommand():await r.createAddCommand(e);return i.appendPipelineStateCommand((()=>this._featureData.set(e.id,e))),i}async createRemoveCommand(e){const t=this._context,r=await this._provisionSymbol(),i=null==r?t.createPipelineCommand():await r.createRemoveCommand(e);return i.appendPipelineStateCommand((()=>this._featureData.delete(e))),i}async createUpdateVisibilityCommand(e){const t=this._context,r=await this._provisionSymbol();return null==r?t.createPipelineCommand():await r.createUpdateVisibilityCommand(e)}async createUpdateLayerViewOpacityCommand(e){const t=this._context,r=await this._provisionSymbol();return null==r?t.createPipelineCommand():await r.createUpdateLayerViewOpacityCommand(e)}async createUpdateElevationCommand(){const{_featureData:e,_context:t}=this,r=await this._provisionSymbol();if(null==r)return t.createPipelineCommand();const i=[];for(const t of e.values())i.push(r.createUpdateElevationCommand(t));const o=await Promise.all(i);return t.joinPipelineCommands(o)}async createDestroyCommand(){const{_symbol:e,_context:t,_featureData:r}=this;if(!e)return t.createPipelineCommand();const i=[];for(const e of r.keys())i.push(this.createRemoveCommand(e));i.push(e.createDestroyCommand());const o=await Promise.all(i);return t.joinPipelineCommands(o)}async _provisionSymbol(){const e=this._symbol;return e?(e.loaded||await e.load(),e):null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/symbolization/UniqueValueFeatureRenderer":function(){define(["exports","../PipelineCommand","../featureData/processingUtils","./factoryUtils","./IconSymbolLayerRenderer","./ObjectSymbolLayerRenderer"],(function(e,t,r,i,o,s){"use strict";class n{constructor(e,t){this.index=e,this.features=t}}e.UniqueValueFeatureRenderer=class{constructor(e,t){this._symbols=new Array,this._featureDataPartitioning=new Map,this._loaded=!1,this._loadingPromise=null,this._renderer=null,this._context=t,this._renderer=e}async load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}async _load(){this._symbols[0]=new o.IconSymbolLayerRenderer(i.createDefaultIconSymbolLayer(),this._context),this._symbols[1]=new s.ObjectSymbolLayerRenderer(i.createDefaultObjectSymbolLayer(),this._context),this._loaded=!0}get loaded(){return this._loaded}async createAddCommand(e){const t=this._context,r=this._partition(e),i=await Promise.all(r.map((async({index:e,features:t})=>{const r=await this._provisionSymbol(e);return await(r?.createAddCommand(t))}))),o=t.joinPipelineCommands(i);return o.appendPipelineStateCommand((()=>this._featureDataPartitioning.set(e.id,r))),o}async createRemoveCommand(e){const{_featureDataPartitioning:r,_context:i}=this,o=i.renderCommandContext,s=r.get(e);if(null==s)return new t.PipelineCommand(o,o.createRenderCommandBuffer(),[]);const n=await Promise.all(s.map((async({index:e,features:t})=>{const r=this._getLoadedSymbol(e);return await(r?.createRemoveCommand(t.id))}))),a=i.joinPipelineCommands(n);return a.appendPipelineStateCommand((()=>r.delete(e))),a}async createUpdateVisibilityCommand(e){const{_featureDataPartitioning:r,_context:i}=this,o=i.renderCommandContext,s=r.get(e.id);if(null==s)return new t.PipelineCommand(o,o.createRenderCommandBuffer(),[]);const n=await Promise.all(s.map((async({index:e,features:t})=>{const r=this._getLoadedSymbol(e);return await(r?.createUpdateVisibilityCommand(t))})));return i.joinPipelineCommands(n)}async createUpdateLayerViewOpacityCommand(e){const t=this._context,r=[];for(let t=0;t<this._symbols.length;++t){const i=this._symbols[t];null!=i&&i.loaded&&r.push(i.createUpdateLayerViewOpacityCommand(e))}const i=await Promise.all(r);return t.joinPipelineCommands(i)}async createUpdateElevationCommand(){const{_featureDataPartitioning:e,_context:t}=this,r=[];for(const t of e.values()){const e=t.map((async({index:e,features:t})=>{const r=this._getLoadedSymbol(e);return await(r?.createUpdateElevationCommand(t))}));r.push(...e)}const i=await Promise.all(r);return t.joinPipelineCommands(i)}async createDestroyCommand(){const{_featureDataPartitioning:e,_context:t}=this,r=[];for(const t of e.keys())r.push(this.createRemoveCommand(t));for(const e of this._symbols)r.push(e.createDestroyCommand());const i=await Promise.all(r);return t.joinPipelineCommands(i)}async _provisionSymbol(e){if(null==e)return null;const t=this._symbols[e];return t?(t.loaded||await t.load(),t):null}_getLoadedSymbol(e){if(null==e)return null;const t=this._symbols[e];return null!=t&&t.loaded?t:null}_partition(e){const t=r.readObjectIds(e);if(null==t)throw new Error("unable to fetch objectIds");const{featureCount:i}=e,o=[[],[]];for(let e=0;e<i;++e)o[t[e]%2].push(e);return o.map(((t,r)=>new n(r,e.subset(new Uint32Array(t))))).filter((e=>e.features.featureCount>0))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/symbolization/ObjectSymbolLayerRenderer":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../../../geometry/projection/computeTranslationToOriginAndRotation","../../../../../../geometry/support/aaBoundingBox","../../../../../../symbols/support/ObjectSymbol3DLayerResource","../../../../../../symbols/support/symbolLayerUtils3D","../../graphicUtils","../../primitiveObjectSymbolUtils","../PipelineCommand","../featureData/processingUtils","./primitiveObjectUtils","../../../../webgl-engine/lib/basicInterfaces","../../../../webgl-engine/materials/DefaultMaterial","../../../../webgl-engine/materials/pbrUtils"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";function g(e){return e?f.CullFaceOptions.None:f.CullFaceOptions.Back}const b=i.create(),v=r.create(),S=r.create();e.ObjectSymbolLayerRenderer=class{constructor(e,t){this._loaded=!1,this._loadingPromise=null,this._primitiveMaterialId=null,this._lodRendererId=null,this._context=null,this._symbolLayer=null,this._primitive=null,this._context=t,this._symbolLayer=e}_destroy(){this._lodRendererId=null,this._primitiveMaterialId=null}get loaded(){return this._loaded}get _isPrimitive(){return null!=this._primitive}load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}async _load(){const e=this._context.renderCommandContext,t=this._getLayerOpacity();let r={usePBR:!0,isSchematic:!0,mrrFactors:y.schematicMRRFactors,ambient:i.ONES,diffuse:i.ONES,hasSlicePlane:!1,castShadows:!0,layerOpacity:t,offsetTransparentBackfaces:!1,screenSizePerspective:{}};if(r.externalColor=o.ONES,r.isInstanced=!0,this._isPrimitive){const e=new m.DefaultMaterialParameters;e.layerOpacity=t,r={...r,cullFace:g(m.isTransparent(e))}}const s=await e.createMaterial({type:"default",parameters:r}),n=this._symbolLayer.resource;this._primitive=n&&u.isValidPrimitive(n?.primitive)?n.primitive:a.defaultPrimitive;const l=h.createPrimitiveGeometry(this._primitive,s);this._lodRendererId=await e.createLodRenderer(l),this._primitiveMaterialId=s,this._loaded=!0}async createDestroyCommand(){const{_lodRendererId:e,_primitiveMaterialId:t,_context:r}=this,i=r.renderCommandContext,o=[];return null!=e&&o.push(i.destroyLodRenderer(e)),null!=t&&o.push(i.destroyMaterial(t)),new d.PipelineCommand(i,i.mergeRenderCommandBuffers(o),[()=>this._destroy()])}async createAddCommand(e){const t=this._context,{renderCommandContext:r,mainThreadDelegate:o}=t;if(null==this._lodRendererId)throw new Error("expected lod renderer id to not be null");const{featureCount:s}=e;if(0===s)return t.createPipelineCommand();const c=this._isPrimitive,u=this._primitive||a.defaultPrimitive,d=n.create(l.objectSymbolLayerPrimitiveBoundingBox(u)),h=i.fromArray(n.size(d)),f={isPrimitive:c,width:100,depth:null,height:null},m=i.fromArray(l.objectSymbolLayerSizeWithResourceSize(h,f)),y=new Float64Array(16*s),g=new Float64Array(16*s),b=p.readMapCoordinates(e),_=await o.applyElevationAlignmentTo(b);for(let e=0;e<s;++e){const t=e,r=_[3*e+0],i=_[3*e+1],o=_[3*e+2],s=this._computeGlobalTransform(r,i,o,this._context.viewSpatialReference,S),n=this._computeLocalTransform(m,h,v);this._writeMatrixToTypedBuffer(y,t,n),this._writeMatrixToTypedBuffer(g,t,s)}const x=p.readObjectIds(e),w=new Uint8Array(s);e.getVisibilityArray(w);const T={featureIds:new Uint32Array(x),visibility:w,localTransforms:y,globalTransforms:g};return t.createPipelineCommand(r.addLodInstances(this._lodRendererId,e.id,T))}async createRemoveCommand(e){const{_context:t,_lodRendererId:r}=this,i=t.renderCommandContext;return null==r?t.createPipelineCommand():t.createPipelineCommand(i.removeLodInstances(r,e))}async createUpdateVisibilityCommand(e){const{_lodRendererId:t,_context:r}=this,i=r.renderCommandContext;if(null==t)return r.createPipelineCommand();const o=new Uint8Array(e.featureCount);return e.getVisibilityArray(o),r.createPipelineCommand(i.updateVisibility(t,e.id,o))}async createUpdateLayerViewOpacityCommand(e){const{_context:t}=this,r=t.renderCommandContext,i=this._primitiveMaterialId;if(null==i)return t.createPipelineCommand();const o=this._getLayerOpacity();let s={layerOpacity:o};if(this._isPrimitive){const e=new m.DefaultMaterialParameters;e.layerOpacity=o,s={...s,cullFace:g(m.isTransparent(e))}}return t.createPipelineCommand(r.updateMaterial({type:"default",materialId:i,parameters:s}))}async createUpdateElevationCommand(e){const{_context:t,_lodRendererId:r}=this,{renderCommandContext:i,mainThreadDelegate:o}=t,{featureCount:s,id:n}=e;if(null==r||0===s)return t.createPipelineCommand();const a=new Float64Array(16*s),l=p.readMapCoordinates(e),c=await o.applyElevationAlignmentTo(l);for(let e=0;e<s;++e){const t=e,r=c[3*e+0],i=c[3*e+1],o=c[3*e+2],s=this._computeGlobalTransform(r,i,o,this._context.viewSpatialReference,S);this._writeMatrixToTypedBuffer(a,t,s)}return t.createPipelineCommand(i.updateLodInstancesData(r,n,a))}_writeMatrixToTypedBuffer(e,t,r){let i=16*t;for(let t=0;t<16;t++)e[i++]=r[t]}_computeGlobalTransform(e,t,r,i,o){return b[0]=e,b[1]=t,b[2]=r,s.computeTranslationToOriginAndRotation(i,b,o,this._context.renderSpatialReference),o}_computeLocalTransform(e,r,i){return t.identity(i),this._applyObjectScale(e,r,i),i}_applyObjectScale(e,r,i){const o=e,s=c.computeObjectScale(o,e,r,this._context.renderCoordsHelper.unitInMeters);1===s[0]&&1===s[1]&&1===s[2]||t.scale(i,i,s)}_getLayerOpacity(){return this._context.layerViewInfo.fullOpacity}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/projection/computeTranslationToOriginAndRotation":function(){define(["exports","../../core/mathUtils","../../core/libs/gl-matrix-2/math/mat4","../../core/libs/gl-matrix-2/factories/vec3f64","./localRotationUtils","./projectors","../support/spatialReferenceUtils"],(function(e,t,r,i,o,s,n){"use strict";function a(e){return e===s.ProjectionID.SPHERICAL_ECEF||e===s.ProjectionID.SPHERICAL_MARS_PCPF||e===s.ProjectionID.SPHERICAL_MOON_PCPF||e===s.ProjectionID.WGS84_ECEF}const l=t.deg2rad(1),c=i.create(),u=i.create();e.computeTranslationToOriginAndRotation=function(e,t,i,d){const p=s.getProjectorClassification(e,d);if(null==p)return!1;const h=p.source.spatialReferenceId,f=p.dest.spatialReferenceId;if(h===f&&!a(f)&&(h!==s.ProjectionID.UNKNOWN||n.equals(e,d)))return r.fromTranslation(i,t),!0;if(a(f)){const e=s.projectionTable[h][s.ProjectionID.LON_LAT],r=s.projectionTable[s.ProjectionID.LON_LAT][f];return null!=e&&null!=r&&(e(t,0,c,0),r(c,0,u,0),o.computeENUToPCPFLocalRotation(l*c[0],l*c[1],i),i[12]=u[0],i[13]=u[1],i[14]=u[2],!0)}const m=a(h);if((f===s.ProjectionID.WEB_MERCATOR||f===s.ProjectionID.PLATE_CARREE||f===s.ProjectionID.WGS84||f===s.ProjectionID.CGCS2000)&&(h===s.ProjectionID.WGS84||m||h===s.ProjectionID.WEB_MERCATOR||h===s.ProjectionID.CGCS2000)){const e=s.projectionTable[h][s.ProjectionID.LON_LAT],n=s.projectionTable[s.ProjectionID.LON_LAT][f];return null!=e&&null!=n&&(e(t,0,c,0),n(c,0,u,0),m?o.computePCPFToENULocalRotation(l*c[0],l*c[1],i):r.identity(i),i[12]=u[0],i[13]=u[1],i[14]=u[2],!0)}return!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/projection/localRotationUtils":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],(function(e,t){"use strict";function r(e,t,r){const i=Math.sin(e),o=Math.cos(e),s=Math.sin(t),n=Math.cos(t),a=r;return a[0]=-i,a[4]=-s*o,a[8]=n*o,a[12]=0,a[1]=o,a[5]=-s*i,a[9]=n*i,a[13]=0,a[2]=0,a[6]=n,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}e.computeENUToPCPFLocalRotation=r,e.computePCPFToENULocalRotation=function(e,i,o){return r(e,i,o),t.transpose(o,o),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/lodRendering/LodResources"],(function(e,t,r,i){"use strict";const o=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];e.isValidPrimitive=function(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1},e.primitiveLodResources=function(e,t){const s=(e,t,o=!1)=>new i.LodResources(e.map((e=>{const s=t(e.tesselation);return o&&r.cgToGIS(s),new i.LodLevelResources([new i.LodComponentResources(new i.LodComponentEngineGeometry(s))],e.minScreenSpaceRadius)})));switch(e){case"sphere":return s([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(e=>r.createPolySphereGeometry(t,.5,e,!0)));case"cube":return s([{tesselation:0,minScreenSpaceRadius:0}],(()=>r.createBoxGeometry(t,1)));case"cone":return s(o,(e=>r.createConeGeometry(t,1,.5,e,!1)),!0);case"inverted-cone":return s(o,(e=>r.createConeGeometry(t,1,.5,e,!0)),!0);case"cylinder":return s(o,(e=>r.createCylinderGeometry(t,1,.5,e,[0,0,1],[0,0,.5])));case"tetrahedron":return s([{tesselation:0,minScreenSpaceRadius:0}],(()=>r.createTetrahedronGeometry(t,1)),!0);case"diamond":return s([{tesselation:0,minScreenSpaceRadius:0}],(()=>r.createDiamondGeometry(t,1)),!0);default:return}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/DoubleArray","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices","../../../../geometry/support/plane","../../../../geometry/support/ray","./Attribute","./BufferVectorMath","./Geometry","./Util","./VertexAttribute","./IntersectableGeometry"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";const m=u.Vec3Compact,y=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],g=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],b=[0,0,1,0,1,1,0,1],v=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],S=new Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)S[6*e+t]=e;const _=new Array(36);for(let e=0;e<6;e++)_[6*e]=0,_[6*e+1]=1,_[6*e+2]=2,_[6*e+3]=2,_[6*e+4]=3,_[6*e+5]=0;const x=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],w=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],T=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],M=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7],I=r.fromValues(-.5,0,-.5),P=r.fromValues(.5,0,-.5),O=r.fromValues(0,0,.5),C=r.fromValues(0,.5,0),A=r.create(),E=r.create(),R=r.create(),F=r.create(),D=r.create();t.subtract(A,I,C),t.subtract(E,I,P),t.cross(R,A,E),t.normalize(R,R),t.subtract(A,P,C),t.subtract(E,P,O),t.cross(F,A,E),t.normalize(F,F),t.subtract(A,O,C),t.subtract(E,O,I),t.cross(D,A,E),t.normalize(D,D);const L=[I,P,O,C],V=[0,-1,0,R[0],R[1],R[2],F[0],F[1],F[2],D[0],D[1],D[2]],N=[0,1,2,3,1,0,3,2,1,3,0,2],B=[0,0,0,1,1,1,2,2,2,3,3,3];function U(e,t,r){const i=e;let o,n;if(r)o=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=i*(1+Math.sqrt(5))/2;o=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let t=0;t<o.length;t+=3)m.scale(o,t,e/m.length(o,t));let a={};function l(t,r){t>r&&([t,r]=[r,t]);const i=t.toString()+"."+r.toString();if(a[i])return a[i];let s=o.length;return o.length+=3,m.add(o,3*t,o,3*r,o,s),m.scale(o,s,e/m.length(o,s)),s/=3,a[i]=s,s}for(let e=0;e<t;e++){const e=n.length,t=new Array(4*e);for(let r=0;r<e;r+=3){const e=n[r],i=n[r+1],o=n[r+2],s=l(e,i),a=l(i,o),c=l(o,e),u=4*r;t[u]=e,t[u+1]=s,t[u+2]=c,t[u+3]=i,t[u+4]=a,t[u+5]=s,t[u+6]=o,t[u+7]=c,t[u+8]=a,t[u+9]=s,t[u+10]=a,t[u+11]=c}n=t,a={}}const u=s.floatArrayFrom(o);for(let e=0;e<u.length;e+=3)m.normalize(u,e);return[[h.VertexAttribute.POSITION,new c.Attribute(s.floatArrayFrom(o),n,3,!0)],[h.VertexAttribute.NORMAL,new c.Attribute(u,n,3,!0)]]}const z=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function j(e,t,i,o,n=!0,a=!0){let l=0;const u=t,d=e;let p=r.fromValues(0,l,0),f=r.fromValues(0,l+d,0),m=r.fromValues(0,-1,0),y=r.fromValues(0,1,0);o&&(l=d,f=r.fromValues(0,0,0),p=r.fromValues(0,l,0),m=r.fromValues(0,1,0),y=r.fromValues(0,-1,0));const g=[f,p],b=[m,y],v=i+2,S=Math.sqrt(d*d+u*u);if(o)for(let e=i-1;e>=0;e--){const t=e*(2*Math.PI/i),o=r.fromValues(Math.cos(t)*u,l,Math.sin(t)*u);g.push(o);const s=r.fromValues(d*Math.cos(t)/S,-u/S,d*Math.sin(t)/S);b.push(s)}else for(let e=0;e<i;e++){const t=e*(2*Math.PI/i),o=r.fromValues(Math.cos(t)*u,l,Math.sin(t)*u);g.push(o);const s=r.fromValues(d*Math.cos(t)/S,u/S,d*Math.sin(t)/S);b.push(s)}const _=new Array,x=new Array;if(n){for(let e=3;e<g.length;e++)_.push(1),_.push(e-1),_.push(e),x.push(0),x.push(0),x.push(0);_.push(g.length-1),_.push(2),_.push(1),x.push(0),x.push(0),x.push(0)}if(a){for(let e=3;e<g.length;e++)_.push(e),_.push(e-1),_.push(0),x.push(e),x.push(e-1),x.push(1);_.push(0),_.push(2),_.push(g.length-1),x.push(1),x.push(2),x.push(b.length-1)}const w=s.newFloatArray(3*v);for(let e=0;e<v;e++)w[3*e]=g[e][0],w[3*e+1]=g[e][1],w[3*e+2]=g[e][2];const T=s.newFloatArray(3*v);for(let e=0;e<v;e++)T[3*e]=b[e][0],T[3*e+1]=b[e][1],T[3*e+2]=b[e][2];return[[h.VertexAttribute.POSITION,new c.Attribute(w,_,3,!0)],[h.VertexAttribute.NORMAL,new c.Attribute(T,x,3,!0)]]}function k(e,o,n,u,p,f,m=r.fromValues(0,0,0)){const y=o.length,g=s.newFloatArray(n.length*y*3+(6*u.length||0)),b=s.newFloatArray(n.length*y*3+(u?6:0)),v=new Array,S=new Array;let _=0,x=0;const w=i.create(),T=i.create(),M=i.create(),I=i.create(),P=i.create(),O=i.create(),C=i.create(),A=i.create(),E=i.create(),R=i.create(),F=i.create(),D=i.create(),L=i.create(),V=a.create();t.set(E,0,1,0),t.subtract(T,n[1],n[0]),t.normalize(T,T),f?(t.add(A,n[0],m),t.normalize(M,A)):t.set(M,0,0,1),q(T,M,E,E,P,M,H),t.copy(I,M),t.copy(D,P);for(let e=0;e<u.length;e++)t.scale(O,P,u[e][0]),t.scale(A,M,u[e][2]),t.add(O,O,A),t.add(O,O,n[0]),g[_++]=O[0],g[_++]=O[1],g[_++]=O[2];b[x++]=-T[0],b[x++]=-T[1],b[x++]=-T[2];for(let e=0;e<p.length;e++)v.push(p[e][0]>0?p[e][0]:-p[e][0]-1+u.length),v.push(p[e][1]>0?p[e][1]:-p[e][1]-1+u.length),v.push(p[e][2]>0?p[e][2]:-p[e][2]-1+u.length),S.push(0),S.push(0),S.push(0);let N=u.length;const B=u.length-1;for(let e=0;e<n.length;e++){let r=!1;e>0&&(t.copy(w,T),e<n.length-1?(t.subtract(T,n[e+1],n[e]),t.normalize(T,T)):r=!0,t.add(R,w,T),t.normalize(R,R),t.add(F,n[e-1],I),a.fromPositionAndNormal(n[e],R,V),a.intersectRay(V,l.wrap(F,w),A)?(t.subtract(A,A,n[e]),t.normalize(M,A),t.cross(P,R,M),t.normalize(P,P)):q(R,I,D,E,P,M,H),t.copy(I,M),t.copy(D,P)),f&&(t.add(A,n[e],m),t.normalize(L,A));for(let i=0;i<y;i++)if(t.scale(O,P,o[i][0]),t.scale(A,M,o[i][1]),t.add(O,O,A),t.normalize(C,O),b[x++]=C[0],b[x++]=C[1],b[x++]=C[2],t.add(O,O,n[e]),g[_++]=O[0],g[_++]=O[1],g[_++]=O[2],!r){const e=(i+1)%y;v.push(N+i),v.push(N+y+i),v.push(N+e),v.push(N+e),v.push(N+y+i),v.push(N+y+e);for(let e=0;e<6;e++){const t=v.length-6;S.push(v[t+e]-B)}}N+=y}const U=n[n.length-1];for(let e=0;e<u.length;e++)t.scale(O,P,u[e][0]),t.scale(A,M,u[e][1]),t.add(O,O,A),t.add(O,O,U),g[_++]=O[0],g[_++]=O[1],g[_++]=O[2];const z=x/3;b[x++]=T[0],b[x++]=T[1],b[x++]=T[2];const j=N-y;for(let e=0;e<p.length;e++)v.push(p[e][0]>=0?N+p[e][0]:-p[e][0]-1+j),v.push(p[e][2]>=0?N+p[e][2]:-p[e][2]-1+j),v.push(p[e][1]>=0?N+p[e][1]:-p[e][1]-1+j),S.push(z),S.push(z),S.push(z);const k=[[h.VertexAttribute.POSITION,new c.Attribute(g,v,3,!0)],[h.VertexAttribute.NORMAL,new c.Attribute(b,S,3,!0)]];return new d.Geometry(e,k)}function G(e,r,i,o,s){return!(Math.abs(t.dot(r,e))>s||(t.cross(i,e,r),t.normalize(i,i),t.cross(o,i,e),t.normalize(o,o),0))}function q(e,t,r,i,o,s,n){return G(e,t,o,s,n)||G(e,r,o,s,n)||G(e,i,o,s,n)}const H=.99619469809,W=i.create();e.cgToGIS=function(e,t=e){const r=e.attributes,i=r.get(h.VertexAttribute.POSITION).data,o=r.get(h.VertexAttribute.NORMAL).data;if(o){const e=t.getMutableAttribute(h.VertexAttribute.NORMAL).data;for(let t=0;t<o.length;t+=3){const r=o[t+1];e[t+1]=-o[t+2],e[t+2]=r}}if(i){const e=t.getMutableAttribute(h.VertexAttribute.POSITION).data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}},e.createBoxGeometry=function(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(24);for(let e=0;e<8;e++)r[3*e]=y[e][0]*t[0],r[3*e+1]=y[e][1]*t[1],r[3*e+2]=y[e][2]*t[2];return new d.Geometry(e,[[h.VertexAttribute.POSITION,new c.Attribute(r,v,3,!0)],[h.VertexAttribute.NORMAL,new c.Attribute(g,S,3)],[h.VertexAttribute.UV0,new c.Attribute(b,_,2)]])},e.createConeGeometry=function(e,t,r,i,o,s=!0,n=!0){return new d.Geometry(e,j(t,r,i,o,s,n))},e.createConeGeometryData=j,e.createCylinderGeometry=function(e,i,o,n,a,l,u){const p=a?r.clone(a):r.fromValues(1,0,0),f=l?r.clone(l):r.fromValues(0,0,0);u??=!0;const m=r.create();t.normalize(m,p);const y=r.create();t.scale(y,m,Math.abs(i));const g=r.create();t.scale(g,y,-.5),t.add(g,g,f);const b=r.fromValues(0,1,0);Math.abs(1-t.dot(m,b))<.2&&t.set(b,0,0,1);const v=r.create();t.cross(v,m,b),t.normalize(v,v),t.cross(b,v,m);const S=2*n+(u?2:0),_=n+(u?2:0),x=s.newFloatArray(3*S),w=s.newFloatArray(3*_),T=s.newFloatArray(2*S),M=new Array(3*n*(u?4:2)),I=new Array(3*n*(u?4:2));u&&(x[3*(S-2)]=g[0],x[3*(S-2)+1]=g[1],x[3*(S-2)+2]=g[2],T[2*(S-2)]=0,T[2*(S-2)+1]=0,x[3*(S-1)]=x[3*(S-2)]+y[0],x[3*(S-1)+1]=x[3*(S-2)+1]+y[1],x[3*(S-1)+2]=x[3*(S-2)+2]+y[2],T[2*(S-1)]=1,T[2*(S-1)+1]=1,w[3*(_-2)]=-m[0],w[3*(_-2)+1]=-m[1],w[3*(_-2)+2]=-m[2],w[3*(_-1)]=m[0],w[3*(_-1)+1]=m[1],w[3*(_-1)+2]=m[2]);const P=(e,t,r)=>{M[e]=t,I[e]=r};let O=0;const C=r.create(),A=r.create();for(let e=0;e<n;e++){const r=e*(2*Math.PI/n);t.scale(C,b,Math.sin(r)),t.scale(A,v,Math.cos(r)),t.add(C,C,A),w[3*e]=C[0],w[3*e+1]=C[1],w[3*e+2]=C[2],t.scale(C,C,o),t.add(C,C,g),x[3*e]=C[0],x[3*e+1]=C[1],x[3*e+2]=C[2],T[2*e]=e/n,T[2*e+1]=0,x[3*(e+n)]=x[3*e]+y[0],x[3*(e+n)+1]=x[3*e+1]+y[1],x[3*(e+n)+2]=x[3*e+2]+y[2],T[2*(e+n)]=e/n,T[2*e+1]=1;const i=(e+1)%n;P(O++,e,e),P(O++,e+n,e),P(O++,i,i),P(O++,i,i),P(O++,e+n,e),P(O++,i+n,i)}if(u){for(let e=0;e<n;e++){const t=(e+1)%n;P(O++,S-2,_-2),P(O++,e,_-2),P(O++,t,_-2)}for(let e=0;e<n;e++){const t=(e+1)%n;P(O++,e+n,_-1),P(O++,S-1,_-1),P(O++,t+n,_-1)}}const E=[[h.VertexAttribute.POSITION,new c.Attribute(x,M,3,!0)],[h.VertexAttribute.NORMAL,new c.Attribute(w,I,3,!0)],[h.VertexAttribute.UV0,new c.Attribute(T,M,2,!0)]];return new d.Geometry(e,E)},e.createDiamondGeometry=function(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(18);for(let e=0;e<6;e++)r[3*e]=x[e][0]*t[0],r[3*e+1]=x[e][1]*t[1],r[3*e+2]=x[e][2]*t[2];return new d.Geometry(e,[[h.VertexAttribute.POSITION,new c.Attribute(r,T,3,!0)],[h.VertexAttribute.NORMAL,new c.Attribute(w,M,3)]])},e.createExtrudedTriangle=function(e,t,r,i,o,s=0){const n=new Array(18),a=[[-r,s,o/2],[i,s,o/2],[0,t+s,o/2],[-r,s,-o/2],[i,s,-o/2],[0,t+s,-o/2]];for(let e=0;e<6;e++)n[3*e]=a[e][0],n[3*e+1]=a[e][1],n[3*e+2]=a[e][2];return new d.Geometry(e,[[h.VertexAttribute.POSITION,new c.Attribute(n,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])},e.createPathExtrusionGeometry=k,e.createPointGeometry=function(e,{normal:t,position:r,color:o,rotation:s,size:a,centerOffsetAndDistance:l,uvi:u,featureAttribute:p,objectAndLayerIdColor:m=null}={}){const y=r?i.clone(r):i.create(),g=t?i.clone(t):i.fromValues(0,0,1),b=o?[255*o[0],255*o[1],255*o[2],o.length>3?255*o[3]:255]:[255,255,255,255],v=null!=a&&2===a.length?a:[1,1],S=null!=s?[s]:[0],_=n.getZeroIndexArray(1),x=[[h.VertexAttribute.POSITION,new c.Attribute(y,_,3,!0)],[h.VertexAttribute.NORMAL,new c.Attribute(g,_,3,!0)],[h.VertexAttribute.COLOR,new c.Attribute(b,_,4,!0)],[h.VertexAttribute.SIZE,new c.Attribute(v,_,2)],[h.VertexAttribute.ROTATION,new c.Attribute(S,_,1,!0)]];if(u&&x.push([h.VertexAttribute.UVI,new c.Attribute(u,_,u.length)]),null!=l){const e=[l[0],l[1],l[2],l[3]];x.push([h.VertexAttribute.CENTEROFFSETANDDISTANCE,new c.Attribute(e,_,4)])}if(p){const e=[p[0],p[1],p[2],p[3]];x.push([h.VertexAttribute.FEATUREATTRIBUTE,new c.Attribute(e,_,4)])}return new d.Geometry(e,x,null,f.GeometryType.Point,m)},e.createPolySphereData=U,e.createPolySphereGeometry=function(e,t,r,i){const o=U(t,r,i);return new d.Geometry(e,o)},e.createPolylineGeometry=function(e,t,r,i){p.assert(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),p.assert(3===t[0].length,"createPolylineGeometry(): malformed vertex"),p.assert(null==r||r.length===t.length,"createPolylineGeometry: need same number of points and normals"),p.assert(null==r||3===r[0].length,"createPolylineGeometry(): malformed normal");const a=o.newDoubleArray(3*t.length),l=new Array(2*(t.length-1));let u=0,m=0;for(let e=0;e<t.length;e++){for(let r=0;r<3;r++)a[u++]=t[e][r];e>0&&(l[m++]=e-1,l[m++]=e)}const y=[[h.VertexAttribute.POSITION,new c.Attribute(a,l,3,!0)]];if(r){const e=s.newFloatArray(3*r.length);let i=0;for(let o=0;o<t.length;o++)for(let t=0;t<3;t++)e[i++]=r[o][t];y.push([h.VertexAttribute.NORMAL,new c.Attribute(e,l,3,!0)])}return i&&y.push([h.VertexAttribute.COLOR,new c.Attribute(i,n.getContinuousIndexArray(i.length/4),4)]),new d.Geometry(e,y,null,f.GeometryType.Line)},e.createSphereGeometry=function(e,t,r,i,o={uv:!0}){const a=-Math.PI,l=2*Math.PI,u=-Math.PI/2,p=Math.PI,f=Math.max(3,Math.floor(r)),m=Math.max(2,Math.floor(i)),y=(f+1)*(m+1),g=s.newFloatArray(3*y),b=s.newFloatArray(3*y),v=s.newFloatArray(2*y),S=[];let _=0;for(let e=0;e<=m;e++){const r=[],i=e/m,o=u+i*p,s=Math.cos(o);for(let e=0;e<=f;e++){const n=e/f,c=a+n*l,u=Math.cos(c)*s,d=Math.sin(o),p=-Math.sin(c)*s;g[3*_]=u*t,g[3*_+1]=d*t,g[3*_+2]=p*t,b[3*_]=u,b[3*_+1]=d,b[3*_+2]=p,v[2*_]=n,v[2*_+1]=i,r.push(_),++_}S.push(r)}const x=new Array;for(let e=0;e<m;e++)for(let t=0;t<f;t++){const r=S[e][t],i=S[e][t+1],o=S[e+1][t+1],s=S[e+1][t];0===e?(x.push(r),x.push(o),x.push(s)):e===m-1?(x.push(r),x.push(i),x.push(o)):(x.push(r),x.push(i),x.push(o),x.push(o),x.push(s),x.push(r))}const w=[[h.VertexAttribute.POSITION,new c.Attribute(g,x,3,!0)],[h.VertexAttribute.NORMAL,new c.Attribute(b,x,3,!0)]];return o.uv&&w.push([h.VertexAttribute.UV0,new c.Attribute(v,x,2,!0)]),o.offset&&(w[0][0]=h.VertexAttribute.OFFSET,w.push([h.VertexAttribute.POSITION,new c.Attribute(Float64Array.from(o.offset),n.getZeroIndexArray(x.length),3,!0)])),new d.Geometry(e,w)},e.createSquareGeometry=function(e,t=z){const r=new Array(12);for(let e=0;e<4;e++)for(let i=0;i<3;i++)r[3*e+i]=t[e][i];const i=[0,1,2,2,3,0],o=[0,0,0,0,0,0],s=[[h.VertexAttribute.POSITION,new c.Attribute(r,i,3,!0)],[h.VertexAttribute.NORMAL,new c.Attribute([0,0,1],o,3,!0)],[h.VertexAttribute.UV0,new c.Attribute([0,0,1,0,1,1,0,1],i,2,!0)],[h.VertexAttribute.COLOR,new c.Attribute([255,255,255,255],o,4,!0)]];return new d.Geometry(e,s)},e.createTetrahedronGeometry=function(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(12);for(let e=0;e<4;e++)r[3*e]=L[e][0]*t[0],r[3*e+1]=L[e][1]*t[1],r[3*e+2]=L[e][2]*t[2];return new d.Geometry(e,[[h.VertexAttribute.POSITION,new c.Attribute(r,N,3,!0)],[h.VertexAttribute.NORMAL,new c.Attribute(V,B,3)]])},e.createTubeGeometry=function(e,t,r,i,o,s){i=i||10,o=null==o||o,p.assert(t.length>1);const n=[],a=[];for(let e=0;e<i;e++){n.push([0,-e-1,-(e+1)%i-1]);const t=e/i*2*Math.PI;a.push([Math.cos(t)*r,Math.sin(t)*r])}return k(e,a,t,[[0,0,0]],n,o,s)},e.makeOrthoBasisDirUpFallback=q,e.transformInPlace=function(e,r){const i=e.getMutableAttribute(h.VertexAttribute.POSITION).data;for(let e=0;e<i.length;e+=3){const o=i[e],s=i[e+1],n=i[e+2];t.set(W,o,s,n),t.transformMat4(W,W,r),i[e]=W[0],i[e+1]=W[1],i[e+2]=W[2]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["exports"],(function(e){"use strict";function t(){return new Float32Array(3)}function r(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function i(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function o(){return t()}function s(){return i(1,1,1)}function n(){return i(1,0,0)}function a(){return i(0,1,0)}function l(){return i(0,0,1)}const c=o(),u=s(),d=n(),p=a(),h=l(),f=Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:d,UNIT_Y:p,UNIT_Z:h,ZEROS:c,clone:r,create:t,fromValues:i,ones:s,unitX:n,unitY:a,unitZ:l,zeros:o},Symbol.toStringTag,{value:"Module"}));e.ONES=u,e.UNIT_X=d,e.UNIT_Y=p,e.UNIT_Z=h,e.ZEROS=c,e.clone=r,e.create=t,e.fromValues=i,e.ones=s,e.unitX=n,e.unitY=a,e.unitZ=l,e.vec3f32=f,e.zeros=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/FloatArray":function(){define(["exports","../../core/typedArrayUtil"],(function(e,t){"use strict";e.compactFloatArray=function(e){return Array.isArray(e)?e.length<t.nativeArrayMaxSize?e:new Float32Array(e):e.length<t.nativeArrayMaxSize?Array.from(e):e},e.floatArrayFrom=function(e){return(Array.isArray(e)?e.length:e.byteLength/8)<=t.nativeArrayMaxSize?Array.from(e):new Float32Array(e)},e.floatSubArray=function(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)},e.newFloatArray=function(e,r=!1){return e<=t.nativeArrayMaxSize?r?new Array(e).fill(0):new Array(e):new Float32Array(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/plane":function(){define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../chunks/vec42","./vector","./vectorStacks","../../views/3d/support/mathUtils"],(function(e,t,r,i,o,s,n,a){"use strict";function l(e=P){return[e[0],e[1],e[2],e[3]]}const c=o.exactEquals,u=o.equals;function d(e,t){return p(t[0],t[1],t[2],t[3],e)}function p(e,t,r,i,o=l()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o}function h(e,t,r){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],o=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function f(e,t,r,i=l()){const o=r[0]-t[0],s=r[1]-t[1],n=r[2]-t[2],a=e[0]-t[0],c=e[1]-t[1],u=e[2]-t[2],d=s*u-n*c,p=n*a-o*u,h=o*c-s*a,f=d*d+p*p+h*h,m=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;return i[0]=d*m,i[1]=p*m,i[2]=h*m,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function m(e,t,i,o=0,s=Math.floor(i*(1/3)),n=Math.floor(i*(2/3))){if(i<3)return!1;t(g,o);let a=s,l=!1;for(;a<i-1&&!l;)t(b,a),a++,l=!r.exactEquals(g,b);if(!l)return!1;for(a=Math.max(a,n),l=!1;a<i&&!l;)t(v,a),a++,r.subtract(S,g,b),r.normalize(S,S),r.subtract(_,b,v),r.normalize(_,_),l=!r.exactEquals(g,v)&&!r.exactEquals(b,v)&&Math.abs(r.dot(S,_))<y;return l?(f(g,b,v,e),!0):(0!==o||1!==s||2!==n)&&m(e,t,i,0,1,2)}const y=.99619469809,g=i.create(),b=i.create(),v=i.create(),S=i.create(),_=i.create();function x(e,t,i){const o=r.scale(n.sv3d.get(),e,r.dot(e,t));return r.subtract(i,t,o),i}function w(e,t){return r.dot(e,t)+e[3]}var T;function M(t){return t===e.IntersectResult.INTERSECTS_INSIDE_OUT||t===e.IntersectResult.INTERSECTS_OUTSIDE_IN}function I(i,o,s,n,a){const l=r.dot(i,s),c=w(i,o);if(0===l)return c>=0?e.IntersectResult.INSIDE:e.IntersectResult.OUTSIDE;let u=-c/l;return n&e.IntersectFlags.CLAMP&&(u=t.clamp(u,0,1)),!(n&e.IntersectFlags.INFINITE_MIN)&&u<0||!(n&e.IntersectFlags.INFINITE_MAX)&&u>1?c>=0?e.IntersectResult.INSIDE:e.IntersectResult.OUTSIDE:(r.add(a,o,r.scale(a,s,u)),c>=0?e.IntersectResult.INTERSECTS_INSIDE_OUT:e.IntersectResult.INTERSECTS_OUTSIDE_IN)}e.IntersectResult=void 0,(T=e.IntersectResult||(e.IntersectResult={}))[T.INTERSECTS_INSIDE_OUT=0]="INTERSECTS_INSIDE_OUT",T[T.INTERSECTS_OUTSIDE_IN=1]="INTERSECTS_OUTSIDE_IN",T[T.INSIDE=2]="INSIDE",T[T.OUTSIDE=3]="OUTSIDE";const P=[0,0,1,0];var O;e.IntersectFlags=void 0,(O=e.IntersectFlags||(e.IntersectFlags={}))[O.NONE=0]="NONE",O[O.CLAMP=1]="CLAMP",O[O.INFINITE_MIN=4]="INFINITE_MIN",O[O.INFINITE_MAX=8]="INFINITE_MAX";const C=e.IntersectFlags.INFINITE_MIN|e.IntersectFlags.INFINITE_MAX,A=e.IntersectFlags.INFINITE_MAX;e.clip=function(e,t){const i=r.dot(e,t.ray.direction),o=-w(e,t.ray.origin);if(o<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return o>0;if((o<0||i<0)&&!(o<0&&i<0))return!0;const s=o/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1},e.clipInfinite=function(e,t){const i=r.dot(e,t.ray.direction),o=-w(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return o>0;const s=o/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1},e.copy=d,e.create=l,e.distance=function(e,t){return Math.abs(w(e,t))},e.equals=u,e.exactEquals=c,e.fromArray=function(e,t,i=!0){const o=t.length/3;return m(e,((e,i)=>r.set(e,t[3*i+0],t[3*i+1],t[3*i+2])),i?o-1:o)},e.fromManyPoints=m,e.fromNormalAndOffset=function(e,t,i){return r.copy(i,e),i[3]=t,i},e.fromPoints=f,e.fromPositionAndNormal=h,e.fromValues=p,e.fromVectorsAndPoint=function(e,t,i,o){return r.cross(v,t,e),h(i,v,o)},e.getNormal=function(e){return e},e.intersectLine=function(e,t,i,o){return M(I(e,t,r.subtract(n.sv3d.get(),i,t),C,o))},e.intersectLineOrRay=I,e.intersectLineSegment=function(t,r,i){return M(I(t,r.origin,r.vector,e.IntersectFlags.NONE,i))},e.intersectLineSegmentClamp=function(t,r,i){return M(I(t,r.origin,r.vector,e.IntersectFlags.CLAMP,i))},e.intersectRay=function(e,t,r){return null!=t&&M(I(e,t.origin,t.direction,A,r))},e.isPointInside=function(e,t){return w(e,t)>=0},e.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.projectPoint=function(e,t,i){const o=r.scale(n.sv3d.get(),e,-e[3]),s=x(e,r.subtract(n.sv3d.get(),t,o),n.sv3d.get());return r.add(i,s,o),i},e.projectPointLocal=function(e,t,i,o){const l=e,c=n.sv3d.get(),u=n.sv3d.get();a.tangentFrame(l,c,u);const d=r.subtract(n.sv3d.get(),i,t),p=s.projectPointSignedLength(c,d),h=s.projectPointSignedLength(u,d),f=s.projectPointSignedLength(l,d);return r.set(o,p,h,f)},e.projectVector=x,e.setOffsetFromPoint=function(e,t,i){return t!==e&&d(e,t),e[3]=-r.dot(e,i),e},e.signedDistance=w,e.up=P,e.wrap=function(e=P[0],t=P[1],r=P[2],i=P[3]){return p(e,t,r,i,n.sv4d.get())},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64"],(function(e,t,r,i){"use strict";const o=i.create(),s=i.create();e.angle=function(e,i){const o=r.dot(e,i)/(r.length(e)*r.length(i));return-t.acosClamped(o)},e.angleAroundAxis=function(e,i,n){r.normalize(o,e),r.normalize(s,i);const a=r.dot(o,s),l=t.acosClamped(a),c=r.cross(o,o,s);return r.dot(c,n)<0?2*Math.PI-l:l},e.projectPoint=function(e,t,i){const o=r.dot(e,t)/r.dot(e,e);return r.scale(i,e,o)},e.projectPointSignedLength=function(e,t){return r.dot(e,t)/r.length(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],(function(e,t){"use strict";const r=t.VectorStack.createVec2f64(),i=t.VectorStack.createVec3f64(),o=t.VectorStack.createVec4f64(),s=t.VectorStack.createMat3f64(),n=t.VectorStack.createMat4f64(),a=t.VectorStack.createQuatf64();e.sm3d=s,e.sm4d=n,e.sq4d=a,e.sv2d=r,e.sv3d=i,e.sv4d=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/VectorStack":function(){define(["exports","./has","./nextTick","./libs/gl-matrix-2/factories/mat3f64","./libs/gl-matrix-2/factories/mat4f64","./libs/gl-matrix-2/factories/quatf64","./libs/gl-matrix-2/factories/vec2f64","./libs/gl-matrix-2/factories/vec3f64","./libs/gl-matrix-2/factories/vec4f64"],(function(e,t,r,i,o,s,n,a,l){"use strict";class c{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&r.nextTick((()=>this._reset())),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new c(n.create)}static createVec3f64(){return new c(a.create)}static createVec4f64(){return new c(l.create)}static createMat3f64(){return new c(i.create)}static createMat4f64(){return new c(o.create)}static createQuatf64(){return new c(s.create)}get test(){}}e.VectorStack=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["exports"],(function(e){"use strict";function t(){return[1,0,0,0,1,0,0,0,1]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function i(e,t,r,i,o,s,n,a,l){return[e,t,r,i,o,s,n,a,l]}const o=[1,0,0,0,1,0,0,0,1],s=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:t,fromValues:i},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=o,e.clone=r,e.create=t,e.fromValues=i,e.mat3f64=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["exports"],(function(e){"use strict";function t(){return[0,0,0,1]}function r(e){return[e[0],e[1],e[2],e[3]]}function i(e,t,r,i){return[e,t,r,i]}const o=[0,0,0,1],s=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:t,fromValues:i},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=o,e.clone=r,e.create=t,e.fromValues=i,e.quatf64=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64"],(function(e,t,r,i){"use strict";const o=i.create(),s=i.create(),n=i.create(),a=i.create(),l=i.create();e.angle=function(e,i,o){e=r.normalize(a,e),i=r.normalize(l,i);const s=t.acosClamped(r.dot(e,i));if(o){const t=r.cross(n,e,i);if(r.dot(t,o)<0)return-s}return s},e.bilerp=function(e,t,r,i,o,s){const n=e+(t-e)*o;return n+(r+(i-r)*o-n)*s},e.cosCapped=function(e,t){return e>t?Math.cos(t):Math.cos(e)},e.fovx2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/t)},e.fovy2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/r)},e.makeOrthonormal=function(e,t,i){i=i||e;const o=r.dot(e,t);r.set(i,e[0]-o*t[0],e[1]-o*t[1],e[2]-o*t[2]),r.normalize(i,i)},e.makePiecewiseLinearFunction=function(e){const t=e.length;return r=>{if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];let i=1;for(;r>e[i][0];)i++;const o=e[i-1][0],s=e[i][0],n=(s-r)/(s-o);return n*e[i-1][1]+(1-n)*e[i][1]}},e.maxScale=function(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],i=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},e.midpoint3d=function(e,t){if(r.set(t,0,0,0),e.length>0){for(let i=0;i<e.length;++i)r.add(t,t,e[i]);r.scale(t,t,1/e.length)}},e.planeFromPoints=function(e,t,i,n){r.subtract(o,t,e),r.subtract(s,i,e),r.cross(n,o,s),r.normalize(n,n),n[3]=-r.dot(e,n)},e.scaleFromMatrix=function(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),o=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return r.set(e,i,o,s),e},e.slerp=function(e,t,o,s=i.create()){const n=r.length(e),c=r.length(t),u=r.dot(e,t)/(n*c);if(u<.9999999999999999){const i=Math.acos(u),d=((1-o)*n+o*c)/Math.sin(i),p=d/n*Math.sin((1-o)*i),h=d/c*Math.sin(o*i);return r.scale(a,e,p),r.scale(l,t,h),r.add(s,a,l)}return r.lerp(s,e,t,o)},e.slerpTangent=function(e,t,o,s=i.create(),n=i.create()){const c=r.length(e),u=r.length(t),d=r.dot(e,t)/(c*u);if(d<.9999999999999999){const i=Math.acos(d),p=Math.sin(i),h=Math.sin(o*i),f=Math.sin((1-o)*i),m=(1-o)*c+o*u;{const i=m/p,o=i/c*f,n=i/u*h;r.scale(a,e,o),r.scale(l,t,n),r.add(s,a,l)}{const s=1/c*(-Math.cos((1-o)*i)*i*m+f*(-c+u));r.scale(a,e,s);const d=1/u*(Math.cos(o*i)*i*m+h*(-c+u));r.scale(l,t,d),r.add(n,a,l),r.scale(n,n,1/p)}return n}return r.lerp(s,e,t,o),r.subtract(n,t,e),r.normalize(n,n),n},e.tangentFrame=function(e,t,i){Math.abs(e[0])>Math.abs(e[1])?r.set(t,0,1,0):r.set(t,1,0,0),r.cross(i,e,t),r.cross(t,i,e),r.normalize(i,i),r.normalize(t,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/ray":function(){define(["exports","../../core/arrayUtils","../../core/ObjectStack","../../core/libs/gl-matrix-2/math/mat3","../../core/libs/gl-matrix-2/factories/mat3f64","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./vectorStacks"],(function(e,t,r,i,o,s,n,a){"use strict";function l(e){return e?c(n.clone(e.origin),n.clone(e.direction)):c(n.create(),n.create())}function c(e,t){return{origin:e,direction:t}}function u(e,t,r=l()){return s.copy(r.origin,e),s.copy(r.direction,t),r}const d=new r.ObjectStack((()=>l())),p=n.create(),h=n.create(),f=n.create(),m=o.create();e.closestPoint=function(e,t,r){const i=s.dot(e.direction,s.subtract(r,t,e.origin));return s.add(r,e.origin,s.scale(r,e.direction,i)),r},e.closestPoints=function(e,t,r,o){const n=e.origin,a=t.origin,l=e.direction,c=t.direction,u=s.dot(s.normalize(h,l),s.normalize(f,c));if(Math.abs(u)>=1)return null;const d=s.cross(h,l,c),y=s.sub(p,a,n),g=i.set(m,l[0],l[1],l[2],-c[0],-c[1],-c[2],d[0],d[1],d[2]),b=i.invert(m,g);if(null==b)return[r,o];const v=s.dot(s.set(h,b[0],b[3],b[6]),y),S=s.dot(s.set(f,b[1],b[4],b[7]),y);return s.add(r,n,s.scale(p,l,v)),s.add(o,a,s.scale(p,c,S)),[r,o]},e.copy=function(e,t=l()){return u(e.origin,e.direction,t)},e.create=l,e.distance2=function(e,t){const r=s.cross(a.sv3d.get(),s.normalize(a.sv3d.get(),e.direction),s.subtract(a.sv3d.get(),t,e.origin));return s.dot(r,r)},e.equals=function(e,r){return t.equals(e.origin,r.origin)&&t.equals(e.direction,r.direction)},e.fromPoints=function(e,t,r=l()){return s.copy(r.origin,e),s.subtract(r.direction,t,e),r},e.fromValues=u,e.wrap=function(e,t){const r=d.get();return r.origin=e,r.direction=t,r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],(function(e,t){"use strict";e.ObjectStack=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&t.nextTick((()=>this._reset())),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,1024));e++)this._items.push(this._allocator())}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["exports","./common"],(function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function o(e,t,r,i,o,s,n,a,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e[4]=s,e[5]=n,e[6]=a,e[7]=l,e[8]=c,e}function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function n(e,t){if(e===t){const r=t[1],i=t[2],o=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=o}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function a(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=u*n-a*c,p=-u*s+a*l,h=c*s-n*l;let f=r*d+i*p+o*h;return f?(f=1/f,e[0]=d*f,e[1]=(-u*i+o*c)*f,e[2]=(a*i-o*n)*f,e[3]=p*f,e[4]=(u*r-o*l)*f,e[5]=(-a*r+o*s)*f,e[6]=h*f,e[7]=(-c*r+i*l)*f,e[8]=(n*r-i*s)*f,e):null}function l(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=n*u-a*c,e[1]=o*c-i*u,e[2]=i*a-o*n,e[3]=a*l-s*u,e[4]=r*u-o*l,e[5]=o*s-r*a,e[6]=s*c-n*l,e[7]=i*l-r*c,e[8]=r*n-i*s,e}function c(e){const t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],n=e[5],a=e[6],l=e[7],c=e[8];return t*(c*s-n*l)+r*(-c*o+n*a)+i*(l*o-s*a)}function u(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=r[0],h=r[1],f=r[2],m=r[3],y=r[4],g=r[5],b=r[6],v=r[7],S=r[8];return e[0]=p*i+h*n+f*c,e[1]=p*o+h*a+f*u,e[2]=p*s+h*l+f*d,e[3]=m*i+y*n+g*c,e[4]=m*o+y*a+g*u,e[5]=m*s+y*l+g*d,e[6]=b*i+v*n+S*c,e[7]=b*o+v*a+S*u,e[8]=b*s+v*l+S*d,e}function d(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=r[0],h=r[1];return e[0]=i,e[1]=o,e[2]=s,e[3]=n,e[4]=a,e[5]=l,e[6]=p*i+h*n+c,e[7]=p*o+h*a+u,e[8]=p*s+h*l+d,e}function p(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=Math.sin(r),h=Math.cos(r);return e[0]=h*i+p*n,e[1]=h*o+p*a,e[2]=h*s+p*l,e[3]=h*n-p*i,e[4]=h*a-p*o,e[5]=h*l-p*s,e[6]=c,e[7]=u,e[8]=d,e}function h(e,t,r){const i=r[0],o=r[1],s=r[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=s*t[6],e[7]=s*t[7],e[8]=s*t[8],e}function f(e,t,r){const i=r[0],o=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e}function m(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function y(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function g(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function b(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function v(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=r+r,a=i+i,l=o+o,c=r*n,u=i*n,d=i*a,p=o*n,h=o*a,f=o*l,m=s*n,y=s*a,g=s*l;return e[0]=1-d-f,e[3]=u-g,e[6]=p+y,e[1]=u+g,e[4]=1-c-f,e[7]=h-m,e[2]=p-y,e[5]=h+m,e[8]=1-c-d,e}function S(e,t){const r=t[0],i=t[1],o=t[2],s=t[4],n=t[5],a=t[6],l=t[8],c=t[9],u=t[10],d=u*n-a*c,p=-u*s+a*l,h=c*s-n*l,f=r*d+i*p+o*h;if(!f)return null;const m=1/f;return e[0]=d*m,e[1]=(-u*i+o*c)*m,e[2]=(a*i-o*n)*m,e[3]=p*m,e[4]=(u*r-o*l)*m,e[5]=(-a*r+o*s)*m,e[6]=h*m,e[7]=(-c*r+i*l)*m,e[8]=(n*r-i*s)*m,e}function _(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],h=t[11],f=t[12],m=t[13],y=t[14],g=t[15],b=r*a-i*n,v=r*l-o*n,S=r*c-s*n,_=i*l-o*a,x=i*c-s*a,w=o*c-s*l,T=u*m-d*f,M=u*y-p*f,I=u*g-h*f,P=d*y-p*m,O=d*g-h*m,C=p*g-h*y;let A=b*C-v*O+S*P+_*I-x*M+w*T;return A?(A=1/A,e[0]=(a*C-l*O+c*P)*A,e[1]=(l*I-n*C-c*M)*A,e[2]=(n*O-a*I+c*T)*A,e[3]=(o*O-i*C-s*P)*A,e[4]=(r*C-o*I+s*M)*A,e[5]=(i*I-r*O-s*T)*A,e[6]=(m*w-y*x+g*_)*A,e[7]=(y*S-f*w-g*v)*A,e[8]=(f*x-m*S+g*b)*A,e):null}function x(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function w(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function T(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function M(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function I(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function P(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function O(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function C(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function A(e,r){const i=e[0],o=e[1],s=e[2],n=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=r[0],h=r[1],f=r[2],m=r[3],y=r[4],g=r[5],b=r[6],v=r[7],S=r[8],_=t.getEpsilon();return Math.abs(i-p)<=_*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-h)<=_*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-f)<=_*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(n-m)<=_*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-y)<=_*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(l-g)<=_*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-b)<=_*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(u-v)<=_*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(d-S)<=_*Math.max(1,Math.abs(d),Math.abs(S))}function E(e){const r=t.getEpsilon(),i=e[0],o=e[1],s=e[2],n=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8];return Math.abs(1-(i*i+n*n+c*c))<=r&&Math.abs(1-(o*o+a*a+u*u))<=r&&Math.abs(1-(s*s+l*l+d*d))<=r}const R=u,F=I,D=Object.freeze(Object.defineProperty({__proto__:null,add:M,adjoint:l,copy:i,determinant:c,equals:A,exactEquals:C,frob:T,fromMat2d:b,fromMat4:r,fromQuat:v,fromRotation:y,fromScaling:g,fromTranslation:m,identity:s,invert:a,isOrthoNormal:E,mul:R,multiply:u,multiplyScalar:P,multiplyScalarAndAdd:O,normalFromMat4:_,normalFromMat4Legacy:S,projection:x,rotate:p,scale:h,scaleByVec2:f,set:o,str:w,sub:F,subtract:I,translate:d,transpose:n},Symbol.toStringTag,{value:"Module"}));e.add=M,e.adjoint=l,e.copy=i,e.determinant=c,e.equals=A,e.exactEquals=C,e.frob=T,e.fromMat2d=b,e.fromMat4=r,e.fromQuat=v,e.fromRotation=y,e.fromScaling=g,e.fromTranslation=m,e.identity=s,e.invert=a,e.isOrthoNormal=E,e.mat3=D,e.mul=R,e.multiply=u,e.multiplyScalar=P,e.multiplyScalarAndAdd=O,e.normalFromMat4=_,e.normalFromMat4Legacy=S,e.projection=x,e.rotate=p,e.scale=h,e.scaleByVec2=f,e.set=o,e.str=w,e.sub=F,e.subtract=I,e.translate=d,e.transpose=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],(function(e){"use strict";var t;e.Vec3Compact=void 0,(t=e.Vec3Compact||(e.Vec3Compact={})).length=function(e,t){const r=e[t],i=e[t+1],o=e[t+2];return Math.sqrt(r*r+i*i+o*o)},t.normalize=function(e,t){const r=e[t],i=e[t+1],o=e[t+2],s=1/Math.sqrt(r*r+i*i+o*o);e[t]*=s,e[t+1]*=s,e[t+2]*=s},t.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},t.add=function(e,t,r,i,o,s=t){(o=o||e)[s]=e[t]+r[i],o[s+1]=e[t+1]+r[i+1],o[s+2]=e[t+2]+r[i+2]},t.subtract=function(e,t,r,i,o,s=t){(o=o||e)[s]=e[t]-r[i],o[s+1]=e[t+1]-r[i+1],o[s+2]=e[t+2]-r[i+2]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/Geometry":function(){define(["exports","../../../../core/uid","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../chunks/vec32","../../../../geometry/support/Indices","./AttributeArray","./BoundingInfo","./geometryDataUtils","./IntersectableGeometry","./Object3DStateID","./Util","./VertexAttribute","../../../webgl/checkWebGLError"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";class h{constructor(e,r,i=null,s=l.GeometryType.Mesh,n=null,a=-1){this.material=e,this.mapPositions=i,this.type=s,this.objectAndLayerIdColor=n,this.edgeIndicesLength=a,this.highlights=new Set,this._highlightOptionsCounts=new Map,this.id=t.generateUID(),this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[e,t]of r)this._attributes.set(e,{...t,indices:o.compactIndices(t.indices)}),e===d.VertexAttribute.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(e).indices.length:this.edgeIndicesLength)}instantiate(e={}){const t=new h(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach(((e,r)=>{e.exclusive=!1,t._attributes.set(r,e)})),t._boundingInfo=this._boundingInfo,t.transformation=e.transformation||this.transformation,t}get attributes(){return this._attributes}getMutableAttribute(e){let t=this._attributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:s.cloneAttributeData(t.data)},this._attributes.set(e,t)),t}setAttributeData(e,t){const r=this._attributes.get(e);r?this._attributes.set(e,{...r,exclusive:!0,data:t}):p.webglDebugEnabled()&&console.warn(`Setting undefined attribute ${e} data`)}get indexCount(){const e=this._attributes.values().next().value?.indices;return e?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo??=this._calculateBoundingInfo(),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===l.GeometryType.Mesh?this._computeAttachmentOriginTriangles(e):this.type===l.GeometryType.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(null!=this._transformation&&i.transformMat4(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const t=this.attributes.get(d.VertexAttribute.POSITION);return a.computeAttachmentOriginTriangles(t,e)}_computeAttachmentOriginLines(e){const t=this.attributes.get(d.VertexAttribute.POSITION);return a.computeAttachmentOriginLines(t,function(e,t){return!(!("isClosed"in e)||!e.isClosed)&&t.indices.length>2}(this.material.parameters,t),e)}_computeAttachmentOriginPoints(e){const t=this.attributes.get(d.VertexAttribute.POSITION);return a.computeAttachmentOriginPoints(t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(d.VertexAttribute.POSITION);if(!e||0===e.indices.length)return null;const t=this.type===l.GeometryType.Mesh?3:1;u.assert(e.indices.length%t===0,"Indexing error: "+e.indices.length+" not divisible by "+t);const r=o.getContinuousIndexArray(e.indices.length/t);return new n.BoundingInfo(r,t,e)}get transformation(){return this._transformation??r.IDENTITY}set transformation(e){this._transformation=e&&e!==r.IDENTITY?r.clone(e):null}get highlightNames(){return this._highlightOptionsCounts}get hasHighlights(){return this._highlightOptionsCounts.size>0}foreachHighlightOptions(e){this._highlightOptionsCounts.forEach(((t,r)=>e(r)))}allocateIdAndHighlight(e){const t=new c.Object3DHighlightStateID(e);return this.addHighlight(t)}addHighlight(e){this.highlights.add(e);const{highlightName:t}=e,r=(this._highlightOptionsCounts.get(t)??0)+1;return this._highlightOptionsCounts.set(t,r),e}removeHighlight(e){if(this.highlights.delete(e)){const{highlightName:t}=e,r=this._highlightOptionsCounts.get(t)??0;r<=1?this._highlightOptionsCounts.delete(t):this._highlightOptionsCounts.set(t,r-1)}}}Object.defineProperty(e,"GeometryType",{enumerable:!0,get:()=>l.GeometryType}),e.Geometry=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/AttributeArray":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/float16"],(function(e,t,r){"use strict";e.cloneAttributeData=function(e){if(e.length<t.nativeArrayMaxSize)return Array.from(e);if(Array.isArray(e))return Float64Array.from(e);if(!("BYTES_PER_ELEMENT"in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return t.isFloat16Array(e)?r.getFloat16ArrayConstructor().from(e):t.isUint16Array(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/float16":function(){define(["exports"],(function(e){"use strict";let t=globalThis.Float16Array;e.hasNativeFloat16Array=!!t,e.disableNativeF16Array=function(){t=null,e.hasNativeFloat16Array=!1},e.getFloat16ArrayConstructor=function(){return t},e.makeFloat16Array=function(...e){return new(t??Float32Array)(...e)},e.resetNativeF16Array=function(){t=globalThis.Float16Array,e.hasNativeFloat16Array=!!t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./Util"],(function(e,t,r,i,o){"use strict";class s{constructor(e,t,s){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.position=s,this._children=void 0,o.assert(e.length>=1),o.assert(3===s.size||4===s.size);const{data:a,size:l,indices:c}=s;o.assert(c.length%this._numIndexPerPrimitive===0),o.assert(c.length>=e.length*this._numIndexPerPrimitive);const u=e.length;let d=l*c[this._numIndexPerPrimitive*e[0]];n.clear(),n.push(d);const p=i.fromValues(a[d],a[d+1],a[d+2]),h=i.clone(p);for(let t=0;t<u;++t){const r=this._numIndexPerPrimitive*e[t];for(let e=0;e<this._numIndexPerPrimitive;++e){d=l*c[r+e],n.push(d);let t=a[d];p[0]=Math.min(t,p[0]),h[0]=Math.max(t,h[0]),t=a[d+1],p[1]=Math.min(t,p[1]),h[1]=Math.max(t,h[1]),t=a[d+2],p[2]=Math.min(t,p[2]),h[2]=Math.max(t,h[2])}}this.bbMin=p,this.bbMax=h;const f=r.lerp(i.create(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(h[0]-p[0],h[1]-p[1]),h[2]-p[2]);let m=this.radius*this.radius;for(let e=0;e<n.length;++e){d=n.at(e);const t=a[d]-f[0],r=a[d+1]-f[1],i=a[d+2]-f[2],o=t*t+r*r+i*i;if(o<=m)continue;const s=Math.sqrt(o),l=.5*(s-this.radius);this.radius=this.radius+l,m=this.radius*this.radius;const c=l/s;f[0]+=t*c,f[1]+=r*c,f[2]+=i*c}this.center=f,n.clear()}getChildren(){if(this._children||r.squaredDistance(this.bbMin,this.bbMax)<=1)return this._children;const e=r.lerp(i.create(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,o=new Uint8Array(t),n=new Array(8);for(let e=0;e<8;++e)n[e]=0;const{data:a,size:l,indices:c}=this.position;for(let r=0;r<t;++r){let t=0;const i=this._numIndexPerPrimitive*this.primitiveIndices[r];let s=l*c[i],u=a[s],d=a[s+1],p=a[s+2];for(let e=1;e<this._numIndexPerPrimitive;++e){s=l*c[i+e];const t=a[s],r=a[s+1],o=a[s+2];t<u&&(u=t),r<d&&(d=r),o<p&&(p=o)}u<e[0]&&(t|=1),d<e[1]&&(t|=2),p<e[2]&&(t|=4),o[r]=t,++n[t]}let u=0;for(let e=0;e<8;++e)n[e]>0&&++u;if(u<2)return;const d=new Array(8);for(let e=0;e<8;++e)d[e]=n[e]>0?new Uint32Array(n[e]):void 0;for(let e=0;e<8;++e)n[e]=0;for(let e=0;e<t;++e){const t=o[e];d[t][n[t]++]=this.primitiveIndices[e]}this._children=new Array;for(let e=0;e<8;++e)void 0!==d[e]&&this._children.push(new s(d[e],this._numIndexPerPrimitive,this.position));return this._children}static prune(){n.prune()}}const n=new t({deallocator:null});e.BoundingInfo=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/triangle"],(function(e,t,r,i){"use strict";const o=r.create(),s=r.create(),n=r.create(),a=r.create();e.computeAttachmentOriginLines=function(e,r,i){if(!e)return!1;t.set(i,0,0,0),t.set(a,0,0,0);let n=0,l=0;const{size:c,data:u,indices:d}=e,p=d.length-1,h=p+(r?2:0);for(let e=0;e<h;e+=2){const r=e<p?e+1:0,h=d[e<p?e:p]*c,f=d[r]*c;o[0]=u[h],o[1]=u[h+1],o[2]=u[h+2],s[0]=u[f],s[1]=u[f+1],s[2]=u[f+2],t.scale(o,t.add(o,o,s),.5);const m=t.dist(o,s);m>0?(t.add(i,i,t.scale(o,o,m)),n+=m):0===n&&(t.add(a,a,o),l++)}return 0!==n?(t.scale(i,i,1/n),!0):0!==l&&(t.scale(i,a,1/l),!0)},e.computeAttachmentOriginPoints=function(e,r){if(!e)return!1;const{size:i,data:o,indices:s}=e;t.set(r,0,0,0);let n=-1,a=0;for(let e=0;e<s.length;e++){const t=s[e]*i;n!==t&&(r[0]+=o[t],r[1]+=o[t+1],r[2]+=o[t+2],a++),n=t}return a>1&&t.scale(r,r,1/a),a>0},e.computeAttachmentOriginTriangles=function(e,r){if(!e)return!1;const{size:l,data:c,indices:u}=e;t.set(r,0,0,0),t.set(a,0,0,0);let d=0,p=0;for(let e=0;e<u.length-2;e+=3){const h=u[e]*l,f=u[e+1]*l,m=u[e+2]*l;t.set(o,c[h],c[h+1],c[h+2]),t.set(s,c[f],c[f+1],c[f+2]),t.set(n,c[m],c[m+1],c[m+2]);const y=i.areaPoints3d(o,s,n);y?(t.add(o,o,s),t.add(o,o,n),t.scale(o,o,1/3*y),t.add(r,r,o),d+=y):(t.add(a,a,o),t.add(a,a,s),t.add(a,a,n),p+=3)}return!(0===p&&0===d||(0!==d?(t.scale(r,r,1/d),0):0===p||(t.scale(r,a,1/p),0)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/triangle":function(){define(["exports","../../core/ObjectStack","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./lineSegment","./vectorStacks"],(function(e,t,r,i,o,s){"use strict";function n(e){return e?{p0:i.clone(e.p0),p1:i.clone(e.p1),p2:i.clone(e.p2)}:{p0:i.create(),p1:i.create(),p2:i.create()}}function a(e,t,i,o=n()){return r.copy(o.p0,e),r.copy(o.p1,t),r.copy(o.p2,i),o}const l=new t.ObjectStack(o.create),c=new t.ObjectStack((()=>n())),u=i.create(),d=i.create();e.areaPoints2d=function(e,t,r){const i=t[0]-e[0],o=t[1]-e[1],s=r[0]-e[0],n=r[1]-e[1];return.5*Math.abs(i*n-o*s)},e.areaPoints3d=function(e,t,i){return r.subtract(u,t,e),r.subtract(d,i,e),.5*r.length(r.cross(u,u,d))},e.copy=function(e,t=n()){return a(e.p0,e.p1,e.p2,t)},e.create=n,e.distance2=function(e,t){const i=e.p0,n=e.p1,a=e.p2,c=r.subtract(s.sv3d.get(),n,i),u=r.subtract(s.sv3d.get(),a,n),d=r.subtract(s.sv3d.get(),i,a),p=r.subtract(s.sv3d.get(),t,i),h=r.subtract(s.sv3d.get(),t,n),f=r.subtract(s.sv3d.get(),t,a),m=r.cross(c,c,d),y=r.dot(r.cross(s.sv3d.get(),c,m),p),g=r.dot(r.cross(s.sv3d.get(),u,m),h),b=r.dot(r.cross(s.sv3d.get(),d,m),f);if(y>0&&g>0&&b>0){const e=r.dot(m,p);return e*e/r.dot(m,m)}const v=o.distance2(o.fromValues(i,c,l.get()),t),S=o.distance2(o.fromValues(n,u,l.get()),t),_=o.distance2(o.fromValues(a,d,l.get()),t);return Math.min(v,S,_)},e.fromValues=a,e.intersectRay=function(e,t,i){const{direction:o,origin:s}=t,{p0:n,p1:a,p2:l}=e,c=a[0]-n[0],u=a[1]-n[1],d=a[2]-n[2],p=l[0]-n[0],h=l[1]-n[1],f=l[2]-n[2],m=o[1]*f-h*o[2],y=o[2]*p-f*o[0],g=o[0]*h-p*o[1],b=c*m+u*y+d*g;if(b>-1e-5&&b<1e-5)return!1;const v=1/b,S=s[0]-n[0],_=s[1]-n[1],x=s[2]-n[2],w=v*(S*m+_*y+x*g);if(w<0||w>1)return!1;const T=_*d-u*x,M=x*c-d*S,I=S*u-c*_,P=v*(o[0]*T+o[1]*M+o[2]*I);if(P<0||w+P>1)return!1;if(i){const e=v*(p*T+h*M+f*I);r.scale(i,o,e),r.add(i,s,i)}return!0},e.wrap=function(e,t,r){const i=c.get();return i.p0=e,i.p1=t,i.p2=r,i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/lineSegment":function(){define(["exports","../../core/mathUtils","../../core/ObjectStack","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./vectorStacks"],(function(e,t,r,i,o,s){"use strict";function n(e){return e?{origin:o.clone(e.origin),vector:o.clone(e.vector)}:{origin:o.create(),vector:o.create()}}function a(e,t){const r=p.get();return r.origin=e,r.vector=t,r}function l(e,t,r=n()){return i.copy(r.origin,e),i.copy(r.vector,t),r}function c(e,r,o,n,a){const{vector:l,origin:c}=e,u=i.subtract(s.sv3d.get(),r,c),d=i.dot(l,u)/i.squaredLength(l);return i.scale(a,l,t.clamp(d,o,n)),i.add(a,a,e.origin)}function u(e,r,o,n){const a=1e-6,l=e.origin,c=i.add(s.sv3d.get(),l,e.vector),u=r.origin,d=i.add(s.sv3d.get(),u,r.vector),p=s.sv3d.get(),h=s.sv3d.get();if(p[0]=l[0]-u[0],p[1]=l[1]-u[1],p[2]=l[2]-u[2],h[0]=d[0]-u[0],h[1]=d[1]-u[1],h[2]=d[2]-u[2],Math.abs(h[0])<a&&Math.abs(h[1])<a&&Math.abs(h[2])<a)return!1;const f=s.sv3d.get();if(f[0]=c[0]-l[0],f[1]=c[1]-l[1],f[2]=c[2]-l[2],Math.abs(f[0])<a&&Math.abs(f[1])<a&&Math.abs(f[2])<a)return!1;const m=p[0]*h[0]+p[1]*h[1]+p[2]*h[2],y=h[0]*f[0]+h[1]*f[1]+h[2]*f[2],g=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],b=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],v=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*b-y*y;if(Math.abs(v)<a)return!1;let S=(m*y-g*b)/v,_=(m+y*S)/b;o&&(S=t.clamp(S,0,1),_=t.clamp(_,0,1));const x=s.sv3d.get(),w=s.sv3d.get();return x[0]=l[0]+S*f[0],x[1]=l[1]+S*f[1],x[2]=l[2]+S*f[2],w[0]=u[0]+_*h[0],w[1]=u[1]+_*h[1],w[2]=u[2]+_*h[2],n.tA=S,n.tB=_,n.pA=x,n.pB=w,n.distance2=i.squaredDistance(x,w),!0}const d={tA:0,tB:0,pA:o.create(),pB:o.create(),distance2:0},p=new r.ObjectStack((()=>n()));e.closestLineSegmentPoint=function(e,t,r){return!!u(e,t,!0,d)&&(i.copy(r,d.pA),!0)},e.closestRayDistance2=function(e,t){if(u(e,a(t.origin,t.direction),!1,d)){const{tA:t,pB:r,distance2:o}=d;if(t>=0&&t<=1)return o;if(t<0)return i.squaredDistance(e.origin,r);if(t>1)return i.squaredDistance(i.add(s.sv3d.get(),e.origin,e.vector),r)}return null},e.copy=function(e,t=n()){return l(e.origin,e.vector,t)},e.create=n,e.distance2=function(e,r){const o=i.subtract(s.sv3d.get(),r,e.origin),n=i.dot(e.vector,o),a=i.dot(e.vector,e.vector),l=t.clamp(n/a,0,1),c=i.subtract(s.sv3d.get(),i.scale(s.sv3d.get(),e.vector,l),o);return i.dot(c,c)},e.fromPoints=function(e,t,r=n()){return i.copy(r.origin,e),i.subtract(r.vector,t,e),r},e.fromValues=l,e.pointAt=function(e,t,r){return i.add(r,e.origin,i.scale(r,e.vector,t))},e.projectPoint=function(e,t,r){return c(e,t,0,1,r)},e.projectPointClamp=c,e.wrap=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/IntersectableGeometry":function(){define(["exports"],(function(e){"use strict";var t;e.GeometryType=void 0,(t=e.GeometryType||(e.GeometryType={}))[t.Mesh=0]="Mesh",t[t.Point=1]="Point",t[t.Line=2]="Line",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid","./basicInterfaces"],(function(e,t,r){"use strict";class i{constructor(){this.uid=t.generateUID()}}e.Object3DHighlightStateID=class extends i{constructor(e){super(),this.highlightName=e,this.channel=r.Object3DState.Highlight}},e.Object3DOccludeeStateID=class extends i{constructor(){super(...arguments),this.channel=r.Object3DState.MaskOccludee}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/memoryEstimations","../IntersectorInterfaces","../IntersectorResult","../IntersectorType","../VertexAttribute","./Intersector"],(function(e,t,r,i,o,s,n,a){"use strict";class l{constructor(e,t,r,i){this.material=e,this.bufferWriter=e.createBufferWriter(),this.vertexBufferLayout=this.bufferWriter.vertexBufferLayout,this.buffer=t,this.elementCount=r,this.boundingInfo=i}get numTriangles(){return this.elementCount/3}get numVertices(){return this.elementCount}computeUsedMemory(){return this.buffer.byteLength+r.baseTypedArrayMemory}getRenderGeometry(){return this}intersect(e,t,r,i,o,s,n,a){const l=this.bufferWriter,u=this.buffer;l.intersect(u,this.material.parameters,null,e,r,i,((r,i,l)=>c(r,i,l,e,t,s,n,o,a)))}}function c(e,t,r,n,l,c,u,d,p){if(e<0)return;if(l&&!l(n.rayBegin,n.rayEnd,e))return;const h=new a.LodTarget(c.layerViewUid,c.graphicUid(d),r,u,p);if((null==n.results.min.distance||e<n.results.min.distance)&&n.results.min.set(s.IntersectorType.LOD,h,e,t,n.transform.transform),(null==n.results.max.distance||e>n.results.max.distance)&&n.results.max.set(s.IntersectorType.LOD,h,e,t,n.transform.transform),n.options.store===i.StoreResults.ALL){const r=new o.IntersectorResult(n.results.min.ray);r.set(s.IntersectorType.LOD,h,e,t,n.transform.transform),n.results.all.push(r)}}e.LodComponentEngineGeometry=class{constructor(e){this.engineGeometry=e}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.attributes.get(n.VertexAttribute.POSITION).indices.length}get numTriangles(){return this.engineGeometry.indexCount/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce(((e,t)=>e+r.estimateNumberArrayMemory(t.data,t.indices)),0)}getRenderGeometry(){const e=this.material,t=this.engineGeometry,r=t.attributes,i=t.boundingInfo,o=e.createBufferWriter(),s=o.vertexBufferLayout,n=o.elementCount(r),a=s.createBuffer(n);return o.write(null,null,r,null,a,0),new l(e,a.buffer,n,i)}intersect(e,t,r,i,o,s,n,a){const l=this.engineGeometry;this.material.intersect(l,e.transform.transform,e,r,i,((r,i,l)=>c(r,i,l,e,t,s,n,o,a)))}},e.LodComponentRenderGeometry=l,e.LodComponentResources=class{constructor(e,t=null){this.geometry=e,this.textures=t}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}},e.LodLevelResources=class{constructor(e,r,i){this.components=e,this.minScreenSpaceRadius=r,this.pivotOffset=i;const o=t.unique(this.components.map((e=>e.geometry)));this.numVertices=o.reduce(((e,t)=>e+t.numVertices),0)}},e.LodResources=class{constructor(e){this.levels=e,this.levels.sort(((e,t)=>e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius))}getMaterials(){const e=[];return this.levels.forEach((t=>t.components.forEach((t=>e.push(t.geometry.material))))),t.unique(e)}getTextures(){const e=new Array;return this.levels.forEach((t=>t.components.forEach((t=>{null!=t.textures&&e.push(...t.textures)})))),t.unique(e)}getGeometries(){const e=new Array;return this.levels.forEach((t=>t.components.forEach((t=>{e.push(t.geometry)})))),t.unique(e)}getEngineGeometries(){return this.getGeometries().map((e=>e.engineGeometry)).filter((e=>null!=e))}computeUsedMemory(){const e=this.getGeometries(),t=this.getTextures(),r=e.reduce(((e,t)=>e+t.computeUsedMemory()),0);return t.reduce(((e,t)=>e+t.usedMemory),0)+r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],(function(e){"use strict";var t;e.StoreResults=void 0,(t=e.StoreResults||(e.StoreResults={}))[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL",e.IntersectorOptions=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerViewUids=[],this.store=e.StoreResults.ALL,this.normalRequired=!0,this.excludeLabels=!1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/IntersectorResult":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/support/ray","./IntersectorType"],(function(e,t,r,i,o,s,n,a,l){"use strict";function c(e){return null!=e?.distance}const u=o.create(),d=n.create();e.IntersectorResult=class{get ray(){return this._ray}get distanceInRenderSpace(){return null==this.distance?null:(i.scale(u,this.ray.direction,this.distance),i.length(u))}withinDistance(e){return!!c(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!c(this)&&(i.scale(u,this.ray.direction,this.distance),i.add(e,this.ray.origin,u),!0)}getTransformedNormal(e){return i.copy(d,this.normal),d[3]=0,s.transformMat4(d,d,this.transformation),i.copy(e,d),i.normalize(e,e)}constructor(e){this.intersector=l.IntersectorType.OBJECT,this.normal=o.create(),this.transformation=r.create(),this._ray=a.create(),this.init(e)}init(e){this.distance=this.target=this.drapedLayerOrder=this.renderPriority=null,this.intersector=l.IntersectorType.OBJECT,a.copy(e,this._ray)}set(e,s,n,a,l,c,u){this.intersector=e,this.distance=n,i.copy(this.normal,a??o.UNIT_Z),t.copy(this.transformation,l??r.IDENTITY),this.target=s,this.drapedLayerOrder=c,this.renderPriority=u}copy(e){a.copy(e.ray,this._ray),this.intersector=e.intersector,this.distance=e.distance,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.renderPriority=e.renderPriority,i.copy(this.normal,e.normal),t.copy(this.transformation,e.transformation)}},e.isValidIntersectorResult=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/IntersectorType":function(){define(["exports"],(function(e){"use strict";var t;e.IntersectorType=void 0,(t=e.IntersectorType||(e.IntersectorType={}))[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../IntersectorResult","../IntersectorTarget","../IntersectorType"],(function(e,t,r,i){"use strict";class o extends r.Graphic3DTarget{constructor(e,t,r,i,o){super(e,t),this.layerViewUid=e,this.graphicUid=t,this.triangleNr=r,this.baseBoundingSphere=i,this.numLodLevels=o}}e.LodTarget=o,e.isLodIntersectorResult=function(e){return t.isValidIntersectorResult(e)&&e.intersector===i.IntersectorType.LOD&&!!e.target},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/IntersectorTarget":function(){define(["exports"],(function(e){"use strict";class t{constructor(e){this.layerViewUid=e}}e.Graphic3DTarget=class extends t{constructor(e,t){super(e),this.graphicUid=t}},e.LayerTarget=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/symbolization/primitiveObjectUtils":function(){define(["exports","../../../../../../core/has","./symbolizationUtils","../../../../webgl-engine/lib/AttributeArray","../../../../webgl-engine/lib/GeometryUtil","../../../../webgl-engine/lib/VertexAttribute"],(function(e,t,r,i,o,s){"use strict";function n(e,t){let r=e.get(t);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:i.cloneAttributeData(r.data)},e.set(t,r)),r}const a=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];e.createPrimitiveGeometry=function(e,t){const i=(e,i,o=!1)=>({levels:e.map((e=>{const a=r.inputAttributesToAttributesMap(i(e.tesselation));return o&&function(e){const t=e,r=t.get(s.VertexAttribute.POSITION).data,i=t.get(s.VertexAttribute.NORMAL).data;if(i){const t=n(e,s.VertexAttribute.NORMAL).data;for(let e=0;e<i.length;e+=3){const r=i[e+1];t[e+1]=-i[e+2],t[e+2]=r}}if(r){const t=n(e,s.VertexAttribute.POSITION).data;for(let e=0;e<r.length;e+=3){const i=r[e+1];t[e+1]=-r[e+2],t[e+2]=i}}}(a),{components:[{attributes:a,objectAndLayerIdColor:void 0,transformation:null,materialId:t,visibilities:new Uint8Array([1]),objectIds:new Uint32Array([-1])}],minScreenSpaceRadius:e.minScreenSpaceRadius}}))});switch(e){case"cone":return i(a,(e=>o.createConeGeometryData(1,.5,e,!1)),!0);case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(e=>o.createPolySphereData(.5,e,!0)));case"cube":case"inverted-cone":case"cylinder":case"tetrahedron":case"diamond":throw new Error("not implemented");default:return}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../symbols/support/materialUtils","../../../ViewingMode","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/attributes/NormalAttribute.glsl","../core/shaderLibrary/output/Emissions.glsl","../core/shaderLibrary/shading/Normals.glsl","../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl","../effects/geometry/olidUtils","../lib/basicInterfaces","../lib/GLTextureMaterial","../lib/Material","../lib/OrderIndependentTransparency","../lib/RayIntersections","../lib/RenderSlot","../lib/VertexAttribute","../lib/verticalOffsetUtils","./DefaultBufferWriter","./internal/MaterialUtil","../shaders/DefaultMaterialTechnique","../shaders/DefaultMaterialTechniqueConfiguration","../shaders/RealisticTreeTechnique","../../../../webscene/support/AlphaCutoff"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x,w,T,M){"use strict";class I extends f.Material{constructor(e,t){super(e,O),this.materialType="default",this.supportsEdges=!0,this.intersectDraped=void 0,this.produces=new Map([[g.RenderSlot.OPAQUE_MATERIAL,e=>(n.is3DGeometryOutputMRT(e)||n.isShadowRelatedOutput(e))&&!this.transparent],[g.RenderSlot.TRANSPARENT_MATERIAL,e=>(n.is3DGeometryOutputMRT(e)||n.isShadowRelatedOutput(e))&&this.transparent&&this.parameters.writeDepth],[g.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>(n.is3DGeometryOutput(e)||n.isShadowRelatedOutput(e))&&this.transparent&&!this.parameters.writeDepth]]),this._vertexBufferLayout=function(e){const t=s.newLayout().vec3f(b.VertexAttribute.POSITION);return e.normalType===a.NormalType.Compressed?t.vec2i16(b.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}):t.vec3f(b.VertexAttribute.NORMAL),e.hasVertexTangents&&t.vec4f(b.VertexAttribute.TANGENT),(e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId)&&t.vec2f16(b.VertexAttribute.UV0),e.hasVertexColors&&t.vec4u8(b.VertexAttribute.COLOR),e.hasSymbolColors&&t.vec4u8(b.VertexAttribute.SYMBOLCOLOR),d.olidEnabled()&&t.vec4u8(b.VertexAttribute.OLIDCOLOR),t}(this.parameters),this._configuration=new w.DefaultMaterialTechniqueConfiguration(t.spherical)}isVisibleForOutput(e){return e!==n.ShaderOutput.Shadow&&e!==n.ShaderOutput.ShadowExcludeHighlight&&e!==n.ShaderOutput.ShadowHighlight||this.parameters.castShadows}get visible(){const{layerOpacity:e,colorMixMode:t,opacity:r,externalColor:i}=this.parameters;return e*("replace"===t?1:r)*("ignore"===t?1:i[3])>=M.alphaCutoff}get _hasEmissiveBase(){return!!this.parameters.emissiveTextureId||!t.exactEquals(this.parameters.emissiveBaseColor,r.ZEROS)}get hasEmissions(){return this.parameters.emissiveStrength>0&&(this.parameters.emissiveSource===i.EmissiveSourceMode.Emissive&&this._hasEmissiveBase||this.parameters.emissiveSource===i.EmissiveSourceMode.Color)}getConfiguration(e,t){const{parameters:r,_configuration:o}=this,{treeRendering:s,doubleSided:d,doubleSidedType:h}=r;return super.getConfiguration(e,t,this._configuration),o.hasNormalTexture=!s&&!!r.normalTextureId,o.hasColorTexture=!!r.textureId,o.hasVertexTangents=!s&&r.hasVertexTangents,o.instanced=r.isInstanced,o.instancedDoublePrecision=r.instancedDoublePrecision,o.vvSize=!!r.vvSize,o.hasVerticalOffset=null!=r.verticalOffset,o.hasScreenSizePerspective=null!=r.screenSizePerspective,o.hasSlicePlane=r.hasSlicePlane,o.alphaDiscardMode=r.textureAlphaMode,o.normalType=s?a.NormalType.Attribute:r.normalType,o.transparent=this.transparent,o.writeDepth=r.writeDepth,o.customDepthTest=r.customDepthTest??p.DepthTestFunction.Less,o.hasOccludees=t.hasOccludees,o.cullFace=r.hasSlicePlane?p.CullFaceOptions.None:r.cullFace,o.cullAboveTerrain=t.cullAboveTerrain,o.hasModelTransformation=!s&&null!=r.modelTransformation,o.hasVertexColors=r.hasVertexColors,o.hasSymbolColors=r.hasSymbolColors,o.doubleSidedMode=s?c.NormalsDoubleSidedMode.WindingOrder:d&&"normal"===h?c.NormalsDoubleSidedMode.View:d&&"winding-order"===h?c.NormalsDoubleSidedMode.WindingOrder:c.NormalsDoubleSidedMode.None,o.instancedColor=r.hasInstancedColor,n.isColorOrColorEmission(e)?(o.terrainDepthTest=t.terrainDepthTest,o.receiveShadows=r.receiveShadows,o.receiveAmbientOcclusion=r.receiveAmbientOcclusion&&null!=t.ssao):(o.terrainDepthTest=!1,o.receiveShadows=o.receiveAmbientOcclusion=!1),o.vvColor=!!r.vvColor,o.textureAlphaPremultiplied=!!r.textureAlphaPremultiplied,o.pbrMode=r.usePBR?r.isSchematic?u.PBRMode.Schematic:u.PBRMode.Normal:u.PBRMode.Disabled,o.hasMetallicRoughnessTexture=!s&&!!r.metallicRoughnessTextureId,o.emissionSource=s?l.EmissionSource.None:null!=r.emissiveTextureId&&r.emissiveSource===i.EmissiveSourceMode.Emissive?l.EmissionSource.Texture:r.usePBR?r.emissiveSource===i.EmissiveSourceMode.Emissive?l.EmissionSource.EmissiveColor:l.EmissionSource.SymbolColor:l.EmissionSource.None,o.hasOcclusionTexture=!s&&!!r.occlusionTextureId,o.offsetBackfaces=!(!this.transparent||!r.offsetTransparentBackfaces),o.oitPass=t.oitPass,o.enableOffset=t.camera.relativeElevation<m.OITPolygonOffsetLimit,o.snowCover=t.snowCover,o.hasBloom=n.isColorEmission(e),o.hasColorTextureTransform=!!r.colorTextureTransformMatrix,o.hasNormalTextureTransform=!!r.normalTextureTransformMatrix,o.hasEmissionTextureTransform=!!r.emissiveTextureTransformMatrix,o.hasOcclusionTextureTransform=!!r.occlusionTextureTransformMatrix,o.hasMetallicRoughnessTextureTransform=!!r.metallicRoughnessTextureTransformMatrix,o}intersect(e,r,i,s,n,a){if(null!=this.parameters.verticalOffset){const e=i.camera;t.set(L,r[12],r[13],r[14]);let a=null;switch(i.viewingMode){case o.ViewingMode.Global:a=t.normalize(F,L);break;case o.ViewingMode.Local:a=t.copy(F,R)}let l=0;const c=t.subtract(V,L,e.eye),u=t.length(c),d=t.scale(c,c,1/u);let p=null;this.parameters.screenSizePerspective&&(p=t.dot(a,d)),l+=_.verticalOffsetAtDistance(e,u,this.parameters.verticalOffset,p??0,this.parameters.screenSizePerspective),t.scale(a,a,l),t.transformMat3(D,a,i.transform.inverseRotation),s=t.subtract(A,s,D),n=t.subtract(E,n,D)}y.intersectTriangleGeometry(e,i,s,n,v.getVerticalOffsetObject3D(i.verticalOffset),a)}createGLMaterial(e){return new P(e)}createBufferWriter(){return new S.DefaultBufferWriter(this._vertexBufferLayout)}get transparent(){return C(this.parameters)}}class P extends h.GLTextureMaterial{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){this._material.setParameters({receiveShadows:e.shadowMap.enabled});const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return t.set(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.getTechnique(r.treeRendering?T.RealisticTreeTechnique:x.DefaultMaterialTechnique,e)}}class O extends x.DefaultMaterialPassParameters{constructor(){super(...arguments),this.treeRendering=!1,this.hasVertexTangents=!1}}function C(e){const{drivenOpacity:t,opacity:r,externalColor:[i,o,s,n],layerOpacity:a,texture:l,textureId:c,textureAlphaMode:u,colorMixMode:d}=e;return t||r<1&&"replace"!==d||n<1&&"ignore"!==d||a<1||(null!=l||null!=c)&&u!==p.AlphaDiscardMode.Opaque&&u!==p.AlphaDiscardMode.Mask&&"replace"!==d}const A=r.create(),E=r.create(),R=r.fromValues(0,0,1),F=r.create(),D=r.create(),L=r.create(),V=r.create();e.DefaultGLMaterial=P,e.DefaultMaterial=I,e.DefaultMaterialParameters=O,e.isTransparent=C,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/ViewingMode":function(){define(["exports"],(function(e){"use strict";var t;e.ViewingMode=void 0,(t=e.ViewingMode||(e.ViewingMode={}))[t.Global=1]="Global",t[t.Local=2]="Local",e.stringFromViewingMode=function(t){return t===e.ViewingMode.Global?"global":"local"},e.viewingModeFromString=function(t){return"global"===t?e.ViewingMode.Global:e.ViewingMode.Local},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../geometry/support/float16","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types","../../webgl-engine/lib/Util"],(function(e,t,r,i,o){"use strict";class s{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const t of e.fields.keys()){const r=e.fields.get(t);this[t]=new r.constructor(this.buffer,r.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const r=this[e];return r&&r.elementCount===t.ElementCount&&r.elementType===t.ElementType?r:null}slice(e,t){return new s(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t=0,r=0,i=e.count){const o=this.stride;if(o%4==0){const s=new Uint32Array(e.buffer,t*o,i*o/4);new Uint32Array(this.buffer,r*o,i*o/4).set(s)}else{const s=new Uint8Array(e.buffer,t*o,i*o);new Uint8Array(this.buffer,r*o,i*o).set(s)}return this}get cachedMemory(){return this.byteLength}dispose(){}}class n{constructor(e){this._stride=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach((e=>{return this._fields.set(e[0],{...e[1],constructor:(t=e[1].constructor,c.get(t))});var t})))}freeze(){return this}vec2f16(e,i){return this._appendField(e,t.hasNativeFloat16Array?r.BufferViewVec2f16:r.BufferViewVec2f,i),this}vec2f(e,t){return this._appendField(e,r.BufferViewVec2f,t),this}vec2f64(e,t){return this._appendField(e,r.BufferViewVec2f64,t),this}vec3f16(e,i){return this._appendField(e,t.hasNativeFloat16Array?r.BufferViewVec3f16:r.BufferViewVec3f,i),this}vec3f(e,t){return this._appendField(e,r.BufferViewVec3f,t),this}vec3f64(e,t){return this._appendField(e,r.BufferViewVec3f64,t),this}vec4f16(e,i){return this._appendField(e,t.hasNativeFloat16Array?r.BufferViewVec4f16:r.BufferViewVec4f,i),this}vec4f(e,t){return this._appendField(e,r.BufferViewVec4f,t),this}vec4f64(e,t){return this._appendField(e,r.BufferViewVec4f64,t),this}mat3f(e,t){return this._appendField(e,r.BufferViewMat3f,t),this}mat3f64(e,t){return this._appendField(e,r.BufferViewMat3f64,t),this}mat4f(e,t){return this._appendField(e,r.BufferViewMat4f,t),this}mat4f64(e,t){return this._appendField(e,r.BufferViewMat4f64,t),this}vec4u8(e,t){return this._appendField(e,r.BufferViewVec4u8,t),this}f16(e,i){return this._appendField(e,t.hasNativeFloat16Array?r.BufferViewFloat16:r.BufferViewFloat,i),this}f32(e,t){return this._appendField(e,r.BufferViewFloat,t),this}f64(e,t){return this._appendField(e,r.BufferViewFloat64,t),this}u8(e,t){return this._appendField(e,r.BufferViewUint8,t),this}u16(e,t){return this._appendField(e,r.BufferViewUint16,t),this}i8(e,t){return this._appendField(e,r.BufferViewInt8,t),this}vec2i8(e,t){return this._appendField(e,r.BufferViewVec2i8,t),this}vec2i16(e,t){return this._appendField(e,r.BufferViewVec2i16,t),this}vec2u8(e,t){return this._appendField(e,r.BufferViewVec2u8,t),this}vec2u16(e,t){return this._appendField(e,r.BufferViewVec2u16,t),this}vec4u16(e,t){return this._appendField(e,r.BufferViewVec4u16,t),this}u32(e,t){return this._appendField(e,r.BufferViewUint32,t),this}_appendField(e,t,r){this._fields.has(e)&&o.assert(!1,`${e} already added to vertex buffer layout`);const s=t.ElementCount*i.elementTypeSize(t.ElementType),n=this._stride;this._fields.set(e,{constructor:t,size:s,offset:n,optional:r}),this._alignFields()}_alignFields(){let e=0,t=1;this._fields.forEach((r=>{const o=i.elementTypeSize(r.constructor.ElementType);e=Math.floor((e+o-1)/o)*o,r.offset=e,e+=r.size,t=Math.max(t,o)})),e=Math.floor((e+t-1)/t)*t,this._stride=e}createBuffer(e){return new s(this,e)}createView(e){return new s(this,e)}clone(){const e=new n;return e._stride=this._stride,e._fields=new Map,this._fields.forEach(((t,r)=>e._fields.set(r,t))),e.BufferType=this.BufferType,e}get stride(){return this._stride}get fields(){return this._fields}}const a=[r.BufferViewFloat,r.BufferViewVec2f,r.BufferViewVec3f,r.BufferViewVec4f,r.BufferViewMat3f,r.BufferViewMat4f,r.BufferViewFloat64,r.BufferViewVec2f64,r.BufferViewVec3f64,r.BufferViewVec4f64,r.BufferViewMat3f64,r.BufferViewMat4f64,r.BufferViewUint8,r.BufferViewVec2u8,r.BufferViewVec3u8,r.BufferViewVec4u8,r.BufferViewUint16,r.BufferViewVec2u16,r.BufferViewVec3u16,r.BufferViewVec4u16,r.BufferViewUint32,r.BufferViewVec2u32,r.BufferViewVec3u32,r.BufferViewVec4u32,r.BufferViewInt8,r.BufferViewVec2i8,r.BufferViewVec3i8,r.BufferViewVec4i8,r.BufferViewInt16,r.BufferViewVec2i16,r.BufferViewVec3i16,r.BufferViewVec4i16,r.BufferViewInt32,r.BufferViewVec2i32,r.BufferViewVec3i32,r.BufferViewVec4i32];function l(e){return`${e.ElementType}_${e.ElementCount}`}const c=new Map;a.forEach((e=>c.set(l(e),e))),e.InterleavedBuffer=s,e.InterleavedLayout=n,e.PackedLayout=class{constructor(e){this.fields=new Array,e.fields.forEach(((e,t)=>{const r={...e,constructor:l(e.constructor)};this.fields.push([t,r])})),this.stride=e.stride}},e.newLayout=function(){return new n},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/buffer/BufferView":function(){define(["exports","../float16","./internals/Mat3","./internals/Mat4","./internals/Scalar","./internals/Vec2","./internals/Vec3","./internals/Vec4","../../../views/3d/webgl-engine/lib/Util"],(function(e,t,r,i,o,s,n,a,l){"use strict";class c extends o.BufferViewScalarImpl{constructor(e,r=0,i,o){l.assert(t.hasNativeFloat16Array),super(t.getFloat16ArrayConstructor(),e,r,i,o),this.elementType="f16"}static{this.ElementType="f16"}}class u extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}static{this.ElementType="f32"}}class d extends s.BufferViewVec2Impl{constructor(e,r=0,i,o){l.assert(t.hasNativeFloat16Array),super(t.getFloat16ArrayConstructor(),e,r,i,o),this.elementType="f16"}slice(e,t){return this.sliceBuffer(d,e,t)}static{this.ElementType="f16"}}class p extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static{this.ElementType="f32"}}class h extends n.BufferViewVec3Impl{constructor(e,r=0,i,o){l.assert(t.hasNativeFloat16Array),super(t.getFloat16ArrayConstructor(),e,r,i,o),this.elementType="f16"}slice(e,t){return this.sliceBuffer(h,e,t)}static{this.ElementType="f16"}}class f extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}static{this.ElementType="f32"}}class m extends a.BufferViewVec4Impl{constructor(e,r=0,i,o){l.assert(t.hasNativeFloat16Array),super(t.getFloat16ArrayConstructor(),e,r,i,o),this.elementType="f16"}slice(e,t){return this.sliceBuffer(m,e,t)}static{this.ElementType="f16"}}class y extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(y,e,t)}static{this.ElementType="f32"}}class g extends r.BufferViewMat3Impl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(g,e,t)}static{this.ElementType="f32"}}class b extends r.BufferViewMat3Impl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(b,e,t)}static{this.ElementType="f64"}}class v extends i.BufferViewMat4Impl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(v,e,t)}static{this.ElementType="f32"}}class S extends i.BufferViewMat4Impl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(S,e,t)}static{this.ElementType="f64"}}class _ extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(_,e,t)}static{this.ElementType="f64"}}class x extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(x,e,t)}static{this.ElementType="f64"}}class w extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}static{this.ElementType="f64"}}class T extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(T,e,t)}static{this.ElementType="f64"}}class M extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(M,e,t)}static{this.ElementType="u8"}}class I extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(I,e,t)}static{this.ElementType="u8"}}class P extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}static{this.ElementType="u8"}}class O extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(O,e,t)}static{this.ElementType="u8"}}class C extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(C,e,t)}static{this.ElementType="u16"}}class A extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(A,e,t)}static{this.ElementType="u16"}}class E extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(E,e,t)}static{this.ElementType="u16"}}class R extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(R,e,t)}static{this.ElementType="u16"}}class F extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(F,e,t)}static{this.ElementType="u32"}}class D extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static{this.ElementType="u32"}}class L extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(L,e,t)}static{this.ElementType="u32"}}class V extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(V,e,t)}static{this.ElementType="u32"}}class N extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(N,e,t)}static{this.ElementType="i8"}}class B extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(B,e,t)}static{this.ElementType="i8"}}class U extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(U,e,t)}static{this.ElementType="i8"}}class z extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(z,e,t)}static{this.ElementType="i8"}}class j extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(j,e,t)}static{this.ElementType="i16"}}class k extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(k,e,t)}static{this.ElementType="i16"}}class G extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(G,e,t)}static{this.ElementType="i16"}}class q extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(q,e,t)}static{this.ElementType="i16"}}class H extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(H,e,t)}static{this.ElementType="i32"}}class W extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static{this.ElementType="i32"}}class $ extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer($,e,t)}static{this.ElementType="i32"}}class J extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(J,e,t)}static{this.ElementType="i32"}}e.BufferViewFloat=u,e.BufferViewFloat16=c,e.BufferViewFloat64=_,e.BufferViewInt16=j,e.BufferViewInt32=H,e.BufferViewInt8=N,e.BufferViewMat3f=g,e.BufferViewMat3f64=b,e.BufferViewMat4f=v,e.BufferViewMat4f64=S,e.BufferViewUint16=C,e.BufferViewUint32=F,e.BufferViewUint8=M,e.BufferViewVec2f=p,e.BufferViewVec2f16=d,e.BufferViewVec2f64=x,e.BufferViewVec2i16=k,e.BufferViewVec2i32=W,e.BufferViewVec2i8=B,e.BufferViewVec2u16=A,e.BufferViewVec2u32=D,e.BufferViewVec2u8=I,e.BufferViewVec3f=f,e.BufferViewVec3f16=h,e.BufferViewVec3f64=w,e.BufferViewVec3i16=G,e.BufferViewVec3i32=$,e.BufferViewVec3i8=U,e.BufferViewVec3u16=E,e.BufferViewVec3u32=L,e.BufferViewVec3u8=P,e.BufferViewVec4f=y,e.BufferViewVec4f16=m,e.BufferViewVec4f64=T,e.BufferViewVec4i16=q,e.BufferViewVec4i32=J,e.BufferViewVec4i8=z,e.BufferViewVec4u16=R,e.BufferViewVec4u32=V,e.BufferViewVec4u8=O,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports"],(function(e){"use strict";class t{static{this.ElementCount=9}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.elementCount=9;const s=this.TypedArrayConstructor;void 0===i&&(i=9*s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<9;e++)t[e]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<9;e++)this.typedBuffer[r++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){const i=this.typedBuffer,o=t.typedBuffer;let s=e*this.typedBufferStride,n=r*t.typedBufferStride;for(let e=0;e<9;++e)i[s++]=o[n++]}get buffer(){return this.typedBuffer.buffer}}e.BufferViewMat3Impl=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports"],(function(e){"use strict";class t{static{this.ElementCount=16}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.elementCount=16;const s=this.TypedArrayConstructor;void 0===i&&(i=16*s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<16;e++)t[e]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<16;e++)this.typedBuffer[r++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){this.copyFromTypedBuffer(e,t.typedBuffer,r*t.typedBufferStride)}copyFromTypedBuffer(e,t,r){const i=this.typedBuffer;let o=e*this.typedBufferStride;for(let e=0;e<16;++e)i[o++]=t[r++]}get buffer(){return this.typedBuffer.buffer}}e.BufferViewMat4Impl=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports"],(function(e){"use strict";class t{static{this.ElementCount=1}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.elementCount=1;const s=this.TypedArrayConstructor;void 0===i&&(i=s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.stride=i,this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}e.BufferViewScalarImpl=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2"],(function(e,t){"use strict";class r{static{this.ElementCount=2}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.start=r,this.elementCount=2;const s=this.TypedArrayConstructor;void 0===i&&(i=2*s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,r){return e*=this.typedBufferStride,t.set(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=r}copyFrom(e,t,r){const i=this.typedBuffer,o=t.typedBuffer;let s=e*this.typedBufferStride,n=r*t.typedBufferStride;i[s++]=o[n++],i[s]=o[n]}get buffer(){return this.typedBuffer.buffer}}e.BufferViewVec2Impl=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/vec32"],(function(e,t){"use strict";class r{static{this.ElementCount=3}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.elementCount=3;const s=this.TypedArrayConstructor;void 0===i&&(i=3*s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,r){return e*=this.typedBufferStride,t.set(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,t,r){const i=this.typedBuffer,o=t.typedBuffer;let s=e*this.typedBufferStride,n=r*t.typedBufferStride;i[s++]=o[n++],i[s++]=o[n++],i[s]=o[n]}get buffer(){return this.typedBuffer.buffer}}e.BufferViewVec3Impl=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/vec42"],(function(e,t){"use strict";class r{static{this.ElementCount=4}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const s=this.TypedArrayConstructor;void 0===i&&(i=4*s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,r){return e*=this.typedBufferStride,t.set(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i,o){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=o}copyFrom(e,t,r){const i=this.typedBuffer,o=t.typedBuffer;let s=e*this.typedBufferStride,n=r*t.typedBufferStride;i[s++]=o[n++],i[s++]=o[n++],i[s++]=o[n++],i[s]=o[n]}get buffer(){return this.typedBuffer.buffer}}e.BufferViewVec4Impl=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/buffer/types":function(){define(["exports"],(function(e){"use strict";e.elementTypeSize=function(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":case"f16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}},e.isInteger=function(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f16":case"f32":case"f64":return!1}},e.isSigned=function(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f16":case"f32":case"f64":return!0}},e.maximumValue=function(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f16":return 65504;case"f32":return 3402823e32;case"f64":return 179769e303}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],(function(e){"use strict";var t;function r(t){return t===e.ShaderOutput.Highlight||t===e.ShaderOutput.ObjectAndLayerIdColor}function i(t){return t===e.ShaderOutput.Color}function o(e){return i(e)||d(e)}function s(t){return i(t)||t===e.ShaderOutput.Highlight}function n(e){return i(e)||r(e)}function a(e){return o(e)||r(e)}function l(e){return n(e)||u(e)}function c(e){return a(e)||u(e)}function u(t){return t===e.ShaderOutput.Depth}function d(t){return t===e.ShaderOutput.ColorEmission}e.ShaderOutput=void 0,(t=e.ShaderOutput||(e.ShaderOutput={}))[t.Color=0]="Color",t[t.ColorEmission=1]="ColorEmission",t[t.Depth=2]="Depth",t[t.Normal=3]="Normal",t[t.Shadow=4]="Shadow",t[t.ShadowHighlight=5]="ShadowHighlight",t[t.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",t[t.ViewshedShadow=7]="ViewshedShadow",t[t.Highlight=8]="Highlight",t[t.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",t[t.COUNT=10]="COUNT",e.is2DGeometryOutput=function(e){return i(e)||r(e)},e.is3DGeometryOutput=function(t){return l(t)||t===e.ShaderOutput.Normal},e.is3DGeometryOutputMRT=function(t){return c(t)||t===e.ShaderOutput.Normal},e.isColor=i,e.isColorEmission=d,e.isColorEmissionHighlightOIDOrDepth=c,e.isColorEmissionHighlightOrOID=a,e.isColorHighlightOIDOrDepth=l,e.isColorHighlightOrDepth=function(e){return s(e)||u(e)},e.isColorHighlightOrOID=n,e.isColorOrColorEmission=o,e.isColorOrColorEmissionOrOID=function(t){return o(t)||t===e.ShaderOutput.ObjectAndLayerIdColor},e.isColorOrHighlight=s,e.isColorOrOID=function(t){return i(t)||t===e.ShaderOutput.ObjectAndLayerIdColor},e.isDepth=u,e.isDepthOnlyOutput=function(t){switch(t){case e.ShaderOutput.Depth:case e.ShaderOutput.Shadow:case e.ShaderOutput.ShadowHighlight:case e.ShaderOutput.ShadowExcludeHighlight:case e.ShaderOutput.ViewshedShadow:return!0}return!1},e.isHighlightOrOID=r,e.isShadowRelatedOutput=function(t){return t===e.ShaderOutput.Shadow||t===e.ShaderOutput.ShadowHighlight||t===e.ShaderOutput.ShadowExcludeHighlight||t===e.ShaderOutput.ViewshedShadow},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/glsl","../../../lib/VertexAttribute"],(function(e,t,r,i){"use strict";var o;e.NormalType=void 0,(o=e.NormalType||(e.NormalType={}))[o.Attribute=0]="Attribute",o[o.Compressed=1]="Compressed",o[o.ScreenDerivative=2]="ScreenDerivative",o[o.COUNT=3]="COUNT",e.NormalAttribute=function(o,s){switch(s.normalType){case e.NormalType.Compressed:o.attributes.add(i.VertexAttribute.NORMALCOMPRESSED,"vec2"),o.vertex.code.add(r.glsl`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case e.NormalType.Attribute:o.attributes.add(i.VertexAttribute.NORMAL,"vec3"),o.vertex.code.add(r.glsl`vec3 normalModel() {
return normal;
}`);break;case e.NormalType.ScreenDerivative:o.fragment.code.add(r.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:t.neverReached(s.normalType);case e.NormalType.COUNT:}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/glsl":function(){define(["exports"],(function(e){"use strict";function t(e,...t){let r="";for(let i=0;i<t.length;i++)r+=e[i]+t[i];return r+=e[e.length-1],r}!function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(t||(t={})),e.If=function(e,t,r=""){return e?t:r},e.glsl=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/output/Emissions.glsl":function(){define(["exports","../ShaderOutput","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/Float3DrawUniform","../../shaderModules/Float3PassUniform","../../shaderModules/FloatDrawUniform","../../shaderModules/FloatPassUniform","../../shaderModules/glsl","../../shaderModules/Texture2DDrawUniform","../../shaderModules/Texture2DPassUniform","../../../lib/GLTextureMaterial","../../../../../webgl/BindType"],(function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;e.EmissionSource=void 0,(p=e.EmissionSource||(e.EmissionSource={}))[p.None=0]="None",p[p.SymbolColor=1]="SymbolColor",p[p.EmissiveColor=2]="EmissiveColor",p[p.Texture=3]="Texture",p[p.COUNT=4]="COUNT";class h extends u.GLEmissiveTexturePassParameters{}e.Emissions=function(u,p){if(!t.isColorOrColorEmission(p.output))return;const{emissionSource:h,hasEmissiveTextureTransform:f,bindType:m}=p,y=h===e.EmissionSource.Texture;y&&(u.include(r.VertexTextureCoordinates,p),u.fragment.uniforms.add(m===d.BindType.Pass?new c.Texture2DPassUniform("texEmission",(e=>e.textureEmissive)):new l.Texture2DDrawUniform("texEmission",(e=>e.textureEmissive))));const g=h===e.EmissionSource.EmissiveColor||y;g&&u.fragment.uniforms.add(m===d.BindType.Pass?new o.Float3PassUniform("emissiveBaseColor",(e=>e.emissiveBaseColor)):new i.Float3DrawUniform("emissiveBaseColor",(e=>e.emissiveBaseColor)));const b=h!==e.EmissionSource.None;b&&u.fragment.uniforms.add(m===d.BindType.Pass?new n.FloatPassUniform("emissiveStrength",(e=>e.emissiveStrength)):new s.FloatDrawUniform("emissiveStrength",(e=>e.emissiveStrength)));const v=h===e.EmissionSource.SymbolColor;u.fragment.code.add(a.glsl`
    vec4 getEmissions(vec3 symbolColor) {
      vec4 emissions = ${g?"vec4(emissiveBaseColor, 1.0)":v?"vec4(symbolColor, 1.0)":"vec4(0.0)"};
      ${a.If(y,`emissions *= textureLookup(texEmission, ${f?"emissiveUV":"vuv0"});\n         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)}
      ${a.If(b,"emissions.rgb *= emissiveStrength;")}
      return emissions;
    }
  `)},e.EmissionsParameters=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/glsl"],(function(e,t,r,i){"use strict";e.VertexTextureCoordinates=function(e,o){const{textureCoordinateType:s}=o;if(s===t.TextureCoordinateType.None||s===t.TextureCoordinateType.COUNT)return;e.include(t.TextureCoordinateAttribute,o);const n=s===t.TextureCoordinateType.Atlas;n&&e.include(r.TextureAtlasLookup),e.fragment.code.add(i.glsl`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${n?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/glsl","../../../lib/VertexAttribute"],(function(e,t,r,i){"use strict";var o;e.TextureCoordinateType=void 0,(o=e.TextureCoordinateType||(e.TextureCoordinateType={}))[o.None=0]="None",o[o.Default=1]="Default",o[o.Atlas=2]="Atlas",o[o.COUNT=3]="COUNT",e.TextureCoordinateAttribute=function(o,s){switch(s.textureCoordinateType){case e.TextureCoordinateType.Default:return o.attributes.add(i.VertexAttribute.UV0,"vec2"),o.varyings.add("vuv0","vec2"),void o.vertex.code.add(r.glsl`void forwardTextureCoordinates() { vuv0 = uv0; }`);case e.TextureCoordinateType.Atlas:return o.attributes.add(i.VertexAttribute.UV0,"vec2"),o.attributes.add(i.VertexAttribute.UVREGION,"vec4"),o.varyings.add("vuv0","vec2"),o.varyings.add("vuvRegion","vec4"),void o.vertex.code.add(r.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:t.neverReached(s.textureCoordinateType);case e.TextureCoordinateType.None:return void o.vertex.code.add(r.glsl`void forwardTextureCoordinates() {}`);case e.TextureCoordinateType.COUNT:return}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/glsl"],(function(e,t){"use strict";e.TextureAtlasLookup=function(e){e.fragment.code.add(t.glsl`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"vec3",t.BindType.Draw,((t,i,o,s)=>t.setUniform3fv(e,r(i,o,s))))}}e.Float3DrawUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/BindType":function(){define(["exports"],(function(e){"use strict";var t;e.BindType=void 0,(t=e.BindType||(e.BindType={}))[t.Bind=0]="Bind",t[t.Pass=1]="Pass",t[t.Draw=2]="Draw",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/Uniform":function(){define(["exports","../../core/has","./BindType"],(function(e,t,r){"use strict";e.Uniform=class{constructor(e,t,i,o,s=null){if(this.name=e,this.type=t,this.arraySize=s,this.bind={[r.BindType.Bind]:null,[r.BindType.Pass]:null,[r.BindType.Draw]:null},o)switch(i){case void 0:break;case r.BindType.Bind:this.bind[r.BindType.Bind]=o;break;case r.BindType.Pass:this.bind[r.BindType.Pass]=o;break;case r.BindType.Draw:this.bind[r.BindType.Draw]=o}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"vec3",t.BindType.Pass,((t,i,o)=>t.setUniform3fv(e,r(i,o))))}}e.Float3PassUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"float",t.BindType.Draw,((t,i,o)=>t.setUniform1f(e,r(i,o))))}}e.FloatDrawUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"float",t.BindType.Pass,((t,i,o)=>t.setUniform1f(e,r(i,o))))}}e.FloatPassUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"sampler2D",t.BindType.Draw,((t,i,o)=>t.bindTexture(e,r(i,o))))}}e.Texture2DDrawUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"sampler2D",t.BindType.Pass,((t,i,o)=>t.bindTexture(e,r(i,o))))}}e.Texture2DPassUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define(["exports","../../../../core/maybe","../../../../core/promiseUtils","./basicInterfaces","./GLMaterial","../../../webgl/NoParameters"],(function(e,t,r,i,o,s){"use strict";class n extends s.NoParameters{constructor(e=null){super(),this.textureEmissive=e}}class a extends n{constructor(e,t,r,i,o,s,n){super(r),this.texture=e,this.textureNormal=t,this.textureOcclusion=i,this.textureMetallicRoughness=o,this.scale=s,this.normalTextureTransformMatrix=n}}e.GLEmissiveTexturePassParameters=n,e.GLTextureMaterial=class extends o{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this.updateTexture(e.textureId),this._acquire(e.normalTextureId,(e=>this._textureNormal=e)),this._acquire(e.emissiveTextureId,(e=>this._textureEmissive=e)),this._acquire(e.occlusionTextureId,(e=>this._textureOcclusion=e)),this._acquire(e.metallicRoughnessTextureId,(e=>this._textureMetallicRoughness=e))}dispose(){super.dispose(),this._texture=t.releaseMaybe(this._texture),this._textureNormal=t.releaseMaybe(this._textureNormal),this._textureEmissive=t.releaseMaybe(this._textureEmissive),this._textureOcclusion=t.releaseMaybe(this._textureOcclusion),this._textureMetallicRoughness=t.releaseMaybe(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?i.ResourceState.LOADED:i.ResourceState.LOADING}get textureBindParameters(){return new a(this._texture?.glTexture??null,this._textureNormal?.glTexture??null,this._textureEmissive?.glTexture??null,this._textureOcclusion?.glTexture??null,this._textureMetallicRoughness?.glTexture??null)}updateTexture(e){null!=this._texture&&e===this._texture.id||(this._texture=t.releaseMaybe(this._texture),this._acquire(e,(e=>this._texture=e)))}_acquire(e,i){if(null==e)return void i(null);const o=this._textures.acquire(e);if(r.isPromiseLike(o))return++this._numLoading,void o.then((e=>{if(this._disposed)return t.releaseMaybe(e),void i(null);i(e)})).finally((()=>--this._numLoading));i(o)}},e.GLTextureMaterialBindParameters=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["./basicInterfaces"],(function(e){"use strict";return class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context.stippleTextures}get _markerTextures(){return this._techniques.context.markerTextures}getTechnique(e,t){return this._techniques.get(e,this._material.getConfiguration(this._output,t))}ensureResources(t){return e.ResourceState.LOADED}}}))},"esri/views/webgl/NoParameters":function(){define(["exports"],(function(e){"use strict";const t=class{},r=new t;e.NoParameters=t,e.noParameters=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/glsl"],(function(e,t,r){"use strict";var i;e.NormalsDoubleSidedMode=void 0,(i=e.NormalsDoubleSidedMode||(e.NormalsDoubleSidedMode={}))[i.None=0]="None",i[i.View=1]="View",i[i.WindingOrder=2]="WindingOrder",i[i.COUNT=3]="COUNT",e.Normals=function(i,o){const s=i.fragment;switch(s.code.add(r.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),o.doubleSidedMode){case e.NormalsDoubleSidedMode.None:s.code.add(r.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case e.NormalsDoubleSidedMode.View:s.code.add(r.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case e.NormalsDoubleSidedMode.WindingOrder:s.code.add(r.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.neverReached(o.doubleSidedMode);case e.NormalsDoubleSidedMode.COUNT:}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define(["exports","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/Float3DrawUniform","../../shaderModules/Float3PassUniform","../../shaderModules/glsl","../../shaderModules/Texture2DDrawUniform","../../shaderModules/Texture2DPassUniform","../../../materials/pbrUtils","../../../../../webgl/BindType","../../../../../webgl/NoParameters"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;e.PBRMode=void 0,(u=e.PBRMode||(e.PBRMode={}))[u.Disabled=0]="Disabled",u[u.Normal=1]="Normal",u[u.Schematic=2]="Schematic",u[u.Water=3]="Water",u[u.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",u[u.Simplified=5]="Simplified",u[u.TerrainWithWater=6]="TerrainWithWater",u[u.COUNT=7]="COUNT";class d extends c.NoParameters{constructor(e,t){super(),this.textureOcclusion=e,this.textureMetallicRoughness=t,this.mrrFactors=a.schematicMRRFactors}}e.PBRRenderingParameters=d,e.PhysicallyBasedRenderingParameters=function(a,c){const u=c.pbrMode,d=a.fragment;if(u!==e.PBRMode.Schematic&&u!==e.PBRMode.Disabled&&u!==e.PBRMode.Normal)return void d.code.add(o.glsl`void applyPBRFactors() {}`);if(u===e.PBRMode.Disabled)return void d.code.add(o.glsl`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);if(u===e.PBRMode.Schematic)return void d.code.add(o.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);const{hasMetallicRoughnessTexture:p,hasMetallicRoughnessTextureTransform:h,hasOcclusionTexture:f,hasOcclusionTextureTransform:m,bindType:y}=c;(p||f)&&a.include(t.VertexTextureCoordinates,c),d.code.add(o.glsl`vec3 mrr;
float occlusion;`),p&&d.uniforms.add(y===l.BindType.Pass?new n.Texture2DPassUniform("texMetallicRoughness",(e=>e.textureMetallicRoughness)):new s.Texture2DDrawUniform("texMetallicRoughness",(e=>e.textureMetallicRoughness))),f&&d.uniforms.add(y===l.BindType.Pass?new n.Texture2DPassUniform("texOcclusion",(e=>e.textureOcclusion)):new s.Texture2DDrawUniform("texOcclusion",(e=>e.textureOcclusion))),d.uniforms.add(y===l.BindType.Pass?new i.Float3PassUniform("mrrFactors",(e=>e.mrrFactors)):new r.Float3DrawUniform("mrrFactors",(e=>e.mrrFactors))),d.code.add(o.glsl`
    ${o.If(p,o.glsl`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${o.If(f,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${f?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${o.If(p,`applyMetallicRoughness(${h?"metallicRoughnessUV":"vuv0"});`)}
      ${o.If(f,`applyOcclusion(${m?"occlusionUV":"vuv0"});`)}
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/pbrUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64"],(function(e,t,r){"use strict";const i=r.freeze(1,1,.5),o=r.freeze(0,.6,.2),s=r.freeze(0,1,.2);e.advancedMRRFactors=i,e.esriSymbologyMRRFactors=s,e.schematicMRRFactors=o,e.useSchematicPBR=function({normalTexture:e,metallicRoughnessTexture:i,metallicFactor:o,roughnessFactor:s,emissiveTexture:n,emissiveFactor:a,occlusionTexture:l}){return null==e&&null==i&&null==n&&(null==a||t.exactEquals(a,r.ZEROS))&&null==l&&(null==s||1===s)&&(null==o||1===o)},e.useSchematicPBRI3S=function({normalTexture:e,metallicRoughnessTexture:i,metallicFactor:o,roughnessFactor:s,emissiveTexture:n,emissiveFactor:a,occlusionTexture:l}){return null==e&&null==i&&null==n&&(null==a||t.exactEquals(a,r.ZEROS))&&null==l&&(null==s||1===s)&&(null==o||1===o||0===o)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/geometry/olidUtils":function(){define(["exports","../../../../../core/has"],(function(e,t){"use strict";e.olidEnabled=function(){return!!t("enable-feature:objectAndLayerId-rendering")},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/Material":function(){define(["exports","../../../../core/uid","../core/shaderLibrary/ShaderOutput","./DefaultVertexAttributeLocations","../materials/DefaultTechniqueConfiguration","../materials/internal/MaterialUtil","../../../webgl/NoParameters"],(function(e,t,r,i,o,s,n){"use strict";var a;e.RenderOccludedFlag=void 0,(a=e.RenderOccludedFlag||(e.RenderOccludedFlag={}))[a.None=0]="None",a[a.Occlude=1]="Occlude",a[a.Transparent=2]="Transparent",a[a.OccludeAndTransparent=4]="OccludeAndTransparent",a[a.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",a[a.Opaque=16]="Opaque";class l extends n.NoParameters{constructor(){super(...arguments),this.renderOccluded=e.RenderOccludedFlag.Occlude,this.isDecoration=!1}}e.Material=class{constructor(e,r){this.id=t.generateUID(),this.supportsEdges=!1,this.vertexAttributeLocations=i.Default3D,this._renderPriority=0,this._parameters=new r,s.updateParameters(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){s.updateParameters(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&0!==(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}get renderOccludedFlags(){return this.visible?this.parameters.renderOccluded:e.RenderOccludedFlag.None}get hasEmissions(){return!1}getConfiguration(e,t,i=new o.DefaultTechniqueConfiguration){return i.output=e,i.hasHighlightMixTexture=e===r.ShaderOutput.Highlight&&null!=t.highlightMixTexture,i}},e.MaterialParameters=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports","./VertexAttribute"],(function(e,t){"use strict";const r=new Map([[t.VertexAttribute.POSITION,0],[t.VertexAttribute.NORMAL,1],[t.VertexAttribute.NORMALCOMPRESSED,1],[t.VertexAttribute.UV0,2],[t.VertexAttribute.UVI,2],[t.VertexAttribute.COLOR,3],[t.VertexAttribute.COLORFEATUREATTRIBUTE,3],[t.VertexAttribute.SIZE,4],[t.VertexAttribute.TANGENT,4],[t.VertexAttribute.CENTEROFFSETANDDISTANCE,5],[t.VertexAttribute.SYMBOLCOLOR,5],[t.VertexAttribute.FEATUREATTRIBUTE,6],[t.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[t.VertexAttribute.OLIDCOLOR,6],[t.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,6],[t.VertexAttribute.INSTANCECOLOR,7],[t.VertexAttribute.ROTATION,8],[t.VertexAttribute.INSTANCEMODEL,8],[t.VertexAttribute.INSTANCEMODELNORMAL,12],[t.VertexAttribute.INSTANCEMODELORIGINHI,11],[t.VertexAttribute.INSTANCEMODELORIGINLO,15]]);e.Default3D=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/attributes/InstancedDoubleConfiguration","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/OITPass","../../../webgl/BindType"],(function(e,t,r,i,o,s,n){"use strict";class a extends i.InstancedDoubleConfiguration{constructor(){super(...arguments),this.output=r.ShaderOutput.Color,this.oitPass=s.OITPass.NONE,this.hasSlicePlane=!1,this.hasHighlightMixTexture=!1,this.bindType=n.BindType.Pass,this.writeDepth=!0}}t.__decorate([o.parameter({count:r.ShaderOutput.COUNT})],a.prototype,"output",void 0),t.__decorate([o.parameter({count:s.OITPass.COUNT})],a.prototype,"oitPass",void 0),t.__decorate([o.parameter()],a.prototype,"hasSlicePlane",void 0),t.__decorate([o.parameter()],a.prototype,"hasHighlightMixTexture",void 0),e.DefaultTechniqueConfiguration=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoubleConfiguration":function(){define(["exports","../../shaderTechnique/ShaderTechniqueConfiguration"],(function(e,t){"use strict";class r extends t.ShaderTechniqueConfiguration{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}e.InstancedDoubleConfiguration=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../core/Error","./ShaderTechniqueConfigurationKey","../../../../webgl/NoParameters"],(function(e,t,r,i){"use strict";class o extends i.NoParameters{constructor(){super(),this._parameterBits=this._parameterBits?.map((()=>0))??[],this._parameterNames??=[]}get key(){return this._key??=new r.ShaderTechniqueConfigurationKey(this._parameterBits),this._key}decode(e=this.key){const t=this._parameterBits;this._parameterBits=[...e.bits];const r=this._parameterNames.map((e=>`    ${e}: ${this[e]}`)).join("\n");return this._parameterBits=t,r}}e.ShaderTechniqueConfiguration=o,e.parameter=function(e={}){return(r,i)=>{r.hasOwnProperty("_parameterNames")||Object.defineProperty(r,"_parameterNames",{value:r._parameterNames?.slice()??[],configurable:!0,writable:!0}),r.hasOwnProperty("_parameterBits")||Object.defineProperty(r,"_parameterBits",{value:r._parameterBits?.slice()??[0],configurable:!0,writable:!0}),r._parameterNames.push(i);const o=e.count||2,s=Math.ceil(Math.log2(o)),n=r._parameterBits;let a=0;for(;n[a]+s>16;)a++,a>=n.length&&n.push(0);const l=n[a],c=(1<<s)-1<<l;n[a]+=s,e.count?Object.defineProperty(r,i,{get(){return(this._parameterBits[a]&c)>>l},set(r){if(this[i]!==r){if(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~c|+r<<l&c,"number"!=typeof r)throw new t("internal:invalid-shader-configuration",`Configuration value for ${i} must be a number, got ${typeof r}`);if(null==e.count)throw new t("internal:invalid-shader-configuration",`Configuration value for ${i} must provide a count option`)}}}):Object.defineProperty(r,i,{get(){return!!((this._parameterBits[a]&c)>>l)},set(e){if(this[i]!==e&&(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~c|+e<<l&c,"boolean"!=typeof e))throw new t("internal:invalid-shader-configuration",`Configuration value for ${i} must be boolean, got ${typeof e}`)}})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfigurationKey":function(){define(["exports","../../../../../core/arrayUtils"],(function(e,t){"use strict";e.ShaderTechniqueConfigurationKey=class{constructor(e){this._bits=[...e]}equals(e){return t.equals(this._bits,e.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/OITPass":function(){define(["exports"],(function(e){"use strict";var t;e.OITPass=void 0,(t=e.OITPass||(e.OITPass={}))[t.NONE=0]="NONE",t[t.ColorAlpha=1]="ColorAlpha",t[t.FrontFace=2]="FrontFace",t[t.COUNT=3]="COUNT",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../lib/screenSizePerspectiveUtils"],(function(e,t,r,i){"use strict";e.colorMixModes={multiply:1,ignore:2,replace:3,tint:4},e.updateParameters=function(e,r){let i=!1;for(const o in r){const s=r[o];void 0!==s&&(Array.isArray(s)?Array.isArray(e[o])&&t.equals(s,e[o])||(e[o]=s.slice(),i=!0):e[o]!==s&&(i=!0,e[o]=s))}return i},e.verticalOffsetAtDistance=function(e,t,o,s,n){let a=(o.screenLength||0)*e.pixelRatio;null!=n&&(a=i.scale(a,s,t,n));const l=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return r.clamp(l*t,o.minWorldLength||0,null!=o.maxWorldLength?o.maxWorldLength:1/0)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/boundedPlane","../../../../chunks/sphere","../../../ViewingMode"],(function(e,t,r,i,o){"use strict";function s(e,t,r){const i=r.parameters;return d.scale=Math.min(i.divisor/(t-i.offset),1),d.factor=function(e){return Math.abs(e*e*e)}(e),d}function n(e,r){return t.lerp(e*Math.max(r.scale,r.minScaleFactor),e,r.factor)}class a{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,t,r,i={camera:{distance:0,fovY:0},divisor:0,offset:0},s){this._viewingMode=e,this._description=t,this._ellipsoidRadius=r,this.parameters=i,this._fontHeight=s,this._viewingMode===o.ViewingMode.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),0))}overrideFontHeight(e){return e!==this._fontHeight?new a(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,t,r){const{scaleStart:i,scaleFallOffRange:o}=this._description,{fovY:s,distance:n}=e,a=this._calculateCurvatureDependentParameters(e,t),l=this._coverageCompensation(e,t,a),{tiltAngle:c,scaleFallOffFactor:u}=a,d=Math.sin(c)*n,p=.5*Math.PI-c-s*(.5-i*l),h=d/Math.cos(p),f=p+s*o*l,m=(h-u*(d/Math.cos(f)))/(1-u);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=m,r.divisor=h-m,r}_calculateCurvatureDependentParametersLocal(e,t,r=p){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,r,i=p){const o=this._description.curvatureDependent,s=1+e.distance/r,n=Math.sqrt(s*s-1),[a,l]=[o.min.curvature,o.max.curvature],c=t.clamp((n-a)/(l-a),0,1),[u,d]=[o.min,o.max];return i.tiltAngle=t.lerp(u.tiltAngle,d.tiltAngle,c),i.scaleFallOffFactor=t.lerp(u.scaleFallOffFactor,d.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,t,i){return r.cameraFrustumCoverage(i.tiltAngle,e.fovY)}_surfaceCoverageCompensationGlobal(e,t,r){return i.fromRadius(h,t),i.cameraFrustumCoverage(h,r.tiltAngle,e.distance,e.fovY)}}const l={curvatureDependent:{min:{curvature:t.deg2rad(10),tiltAngle:t.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:t.deg2rad(70),tiltAngle:t.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},c={scaleFallOffFactor:.7},u={scaleFallOffFactor:.95},d={scale:0,factor:0,minScaleFactor:0},p={tiltAngle:0,scaleFallOffFactor:0},h=i.create();e.applyPrecomputedScaleFactor=function(e,t,r=[0,0]){const i=Math.min(Math.max(t.scale,t.minScaleFactor),1);return r[0]=e[0]*i,r[1]=e[1]*i,r},e.applyScaleFactor=n,e.getLabelSettings=function(e,t){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:o}=l;return new a(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:c.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:u.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:o,minPixelSize:14},t)},e.getSettings=function(e,t){return new a(e,l,t)},e.precomputeScaleFactor=function(e,t,r,i){i.scale=function(e,t,r){const i=s(e,t,r);return i.minScaleFactor=0,n(1,i)}(e,t,r),i.factor=0,i.minScaleFactor=r.minScaleFactor},e.scale=function(e,t,r,i){return n(e,s(t,r,i))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/boundedPlane":function(){define(["exports","../core/has","../core/Logger","../core/mathUtils","../core/ObjectStack","../core/libs/gl-matrix-2/math/mat4","../core/libs/gl-matrix-2/factories/mat4f64","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","../geometry/support/aaBoundingRect","../geometry/support/Axis","../geometry/support/lineSegment","../geometry/support/plane","../geometry/support/ray","../geometry/support/vector","../geometry/support/vectorStacks"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";const y=()=>r.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),g=class{constructor(){this.plane=p.create(),this.origin=l.create(),this.basis1=l.create(),this.basis2=l.create()}};function b(e=Z){return{plane:p.create(e.plane),origin:l.clone(e.origin),basis1:l.clone(e.basis1),basis2:l.clone(e.basis2)}}function v(e,t,r){const i=ee.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=p.wrap(0,0,0,0),w(i),i}function S(e,t=b()){return x(e.origin,e.basis1,e.basis2,t)}function _(e,t){a.copy(t.origin,e.origin),a.copy(t.basis1,e.basis1),a.copy(t.basis2,e.basis2),p.copy(t.plane,e.plane)}function x(e,t,r,i=b()){return a.copy(i.origin,e),a.copy(i.basis1,t),a.copy(i.basis2,r),w(i),o=i,s="fromValues()",Math.abs(a.dot(o.basis1,o.basis2)/(a.length(o.basis1)*a.length(o.basis2)))>1e-6&&y().warn(s,"Provided basis vectors are not perpendicular"),Math.abs(a.dot(o.basis1,H(o)))>1e-6&&y().warn(s,"Basis vectors and plane normal are not perpendicular"),Math.abs(-a.dot(H(o),o.origin)-o.plane[3])>1e-6&&y().warn(s,"Plane offset is not consistent with plane origin"),i;var o,s}function w(e){p.fromVectorsAndPoint(e.basis2,e.basis1,e.origin,e.plane)}function T(e,t,r){e!==r&&S(e,r);const i=a.scale(m.sv3d.get(),H(e),t);return a.add(r.origin,r.origin,i),r.plane[3]-=t,r}function M(e,t,r){return P(t,r),T(r,z(e,e.origin),r),r}function I(e,t){const r=e.basis1[0],i=e.basis2[1],[o,s]=e.origin;return c.fromValues(o-r,s-i,o+r,s+i,t)}function P(e,t=b()){const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return a.set(t.origin,e[0]+r,e[1]+i,0),a.set(t.basis1,r,0,0),a.set(t.basis2,0,i,0),p.fromValues(0,0,1,0,t.plane),t}function O(e,t,r){return!!p.intersectRay(e.plane,t,r)&&W(e,r)}function C(e,t,r){if(O(e,t,r))return r;const i=A(e,t,m.sv3d.get());return a.add(r,t.origin,a.scale(m.sv3d.get(),t.direction,a.distance(t.origin,i)/a.length(t.direction))),r}function A(e,t,r){const o=Q.get();Y(e,t,o,Q.get());let s=Number.POSITIVE_INFINITY;for(const n of te){const l=J(e,n,X.get()),c=m.sv3d.get();if(p.intersectLineSegment(o,l,c)){const e=a.direction(m.sv3d.get(),t.origin,c),o=Math.abs(i.acosClamped(a.dot(t.direction,e)));o<s&&(s=o,a.copy(r,c))}}return s===Number.POSITIVE_INFINITY?R(e,t,r):r}function E(e,t){return(t-e)/t}function R(e,t,r){if(O(e,t,r))return r;const i=Q.get(),o=Q.get();Y(e,t,i,o);let s=Number.POSITIVE_INFINITY;for(const n of te){const l=J(e,n,X.get()),c=m.sv3d.get();if(p.intersectLineSegmentClamp(i,l,c)){const e=h.distance2(t,c);if(!p.isPointInside(o,c))continue;e<s&&(s=e,a.copy(r,c))}}return L(e,t.origin)<s&&F(e,t.origin,r),r}function F(e,t,r){const i=p.projectPoint(e.plane,t,m.sv3d.get()),o=d.projectPointClamp($(e,e.basis1),i,-1,1,m.sv3d.get()),s=d.projectPointClamp($(e,e.basis2),i,-1,1,m.sv3d.get());return a.subtract(r,a.add(m.sv3d.get(),o,s),e.origin),r}function D(e,t,r){const{origin:i,basis1:o,basis2:s}=e,n=a.subtract(m.sv3d.get(),t,i),l=f.projectPointSignedLength(o,n),c=f.projectPointSignedLength(s,n),u=f.projectPointSignedLength(H(e),n);return a.set(r,l,c,u)}function L(e,t){const r=D(e,t,m.sv3d.get()),{basis1:i,basis2:o}=e,s=a.length(i),n=a.length(o),l=Math.max(Math.abs(r[0])-s,0),c=Math.max(Math.abs(r[1])-n,0),u=r[2];return l*l+c*c+u*u}function V(e,t){return Math.sqrt(L(e,t))}function N(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of te){const o=J(e,i,X.get()),s=d.distance2(o,t);s>r&&(r=s)}return Math.sqrt(r)}function B(e,t){return p.isPointInside(e.plane,t)&&W(e,t)}function U(e,t,r,i){return function(e,t,r){switch(t){case u.Axis.X:a.copy(r,e.basis1),a.normalize(r,r);break;case u.Axis.Y:a.copy(r,e.basis2),a.normalize(r,r);break;case u.Axis.Z:a.copy(r,H(e))}return r}(e,r,i)}function z(e,t){const r=-e.plane[3];return f.projectPointSignedLength(H(e),t)-r}function j(e,t,r,i){const o=z(e,t),s=a.scale(K,H(e),r-o);return a.add(i,t,s),i}function k(e,t){return a.exactEquals(e.basis1,t.basis1)&&a.exactEquals(e.basis2,t.basis2)&&a.exactEquals(e.origin,t.origin)}function G(e,t,r){return e!==r&&S(e,r),s.invert(re,t),s.transpose(re,re),a.transformMat4(r.basis1,e.basis1,re),a.transformMat4(r.basis2,e.basis2,re),a.transformMat4(p.getNormal(r.plane),p.getNormal(e.plane),re),a.transformMat4(r.origin,e.origin,t),p.setOffsetFromPoint(r.plane,r.plane,r.origin),r}function q(e,t,r,i){return e!==i&&S(e,i),s.fromRotation(ie,t,r),a.transformMat4(i.basis1,e.basis1,ie),a.transformMat4(i.basis2,e.basis2,ie),w(i),i}function H(e){return p.getNormal(e.plane)}function W(e,t){const r=a.subtract(m.sv3d.get(),t,e.origin),i=a.squaredLength(e.basis1),o=a.squaredLength(e.basis2),s=a.dot(e.basis1,r),n=a.dot(e.basis2,r);return-s-i<0&&s-i<0&&-n-o<0&&n-o<0}function $(e,t){const r=X.get();return a.copy(r.origin,e.origin),a.copy(r.vector,t),r}function J(e,t,r){const{basis1:i,basis2:o,origin:s}=e,n=a.scale(m.sv3d.get(),i,t.origin[0]),l=a.scale(m.sv3d.get(),o,t.origin[1]);a.add(r.origin,n,l),a.add(r.origin,r.origin,s);const c=a.scale(m.sv3d.get(),i,t.direction[0]),u=a.scale(m.sv3d.get(),o,t.direction[1]);return a.scale(r.vector,a.add(c,c,u),2),r}function Y(e,t,r,i){const o=H(e);p.fromVectorsAndPoint(o,t.direction,t.origin,r),p.fromVectorsAndPoint(p.getNormal(r),o,t.origin,i)}const Z={plane:p.create(),origin:l.fromValues(0,0,0),basis1:l.fromValues(1,0,0),basis2:l.fromValues(0,1,0)},Q=new o.ObjectStack(p.create),X=new o.ObjectStack(d.create),K=l.create(),ee=new o.ObjectStack((()=>b())),te=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],re=n.create(),ie=n.create(),oe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:g,altitudeAt:z,axisAt:U,cameraFrustumCoverage:E,closestPoint:R,closestPointOnSilhouette:A,copy:S,copyWithoutVerify:_,create:b,distance:V,distance2:L,distanceToSilhouette:N,elevate:T,equals:k,extrusionContainsPoint:B,fromAABoundingRect:P,fromValues:x,getExtent:I,intersectRay:O,intersectRayClosestSilhouette:C,normal:H,projectPoint:F,projectPointLocal:D,rotate:q,setAltitudeAt:j,setExtent:M,transform:G,up:Z,updateUnboundedPlane:w,wrap:v},Symbol.toStringTag,{value:"Module"}));e.BoundedPlaneClass=g,e.altitudeAt=z,e.axisAt=U,e.boundedPlane=oe,e.cameraFrustumCoverage=E,e.closestPoint=R,e.closestPointOnSilhouette=A,e.copy=S,e.copyWithoutVerify=_,e.create=b,e.distance=V,e.distance2=L,e.distanceToSilhouette=N,e.elevate=T,e.equals=k,e.extrusionContainsPoint=B,e.fromAABoundingRect=P,e.fromValues=x,e.getExtent=I,e.intersectRay=O,e.intersectRayClosestSilhouette=C,e.normal=H,e.projectPoint=F,e.projectPointLocal=D,e.rotate=q,e.setAltitudeAt=j,e.setExtent=M,e.transform=G,e.up=Z,e.updateUnboundedPlane=w,e.wrap=v}))},"esri/chunks/sphere":function(){define(["exports","../core/has","../core/Logger","../core/mathUtils","../core/libs/gl-matrix-2/math/mat4","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","./vec42","../core/libs/gl-matrix-2/factories/vec4f64","../core/libs/gl-matrix-2/math/common","../geometry/support/Axis","../geometry/support/ray","../geometry/support/sphereUtils","../geometry/support/vector","../geometry/support/vectorStacks"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";const m=y();function y(){return l.create()}const g=a.equals,b=a.equals;function v(e,t){return a.copy(t,e)}function S(e,t){return l.fromValues(e[0],e[1],e[2],t)}function _(e){return e}function x(e){e[0]=e[1]=e[2]=e[3]=0}function w(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function T(e){return e[3]}function M(e){return e}function I(e,t,r,i){return l.fromValues(e,t,r,i)}function P(e,t,r){return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=e[3]+t,r}function O(e,t,r){return e!==r&&v(e,r),r}function C(e,t){return t}function A(e,t,r){if(null==t)return!1;if(!F(e,t,R))return!1;let{t0:i,t1:o}=R;if((i<0||o<i&&o>0)&&(i=o),i<0)return!1;if(r){const{origin:e,direction:o}=t;r[0]=e[0]+o[0]*i,r[1]=e[1]+o[1]*i,r[2]=e[2]+o[2]*i}return!0}function E(e,t,r){const i=d.fromPoints(t,r);if(!F(e,i,R))return[];const{origin:o,direction:a}=i,{t0:l,t1:u}=R,p=t=>{const r=n.create();return s.scaleAndAdd(r,o,a,t),z(e,r,r)};return Math.abs(l-u)<c.getEpsilon()?[p(l)]:[p(l),p(u)]}const R={t0:0,t1:0};function F(e,t,r){const{origin:i,direction:o}=t,s=D;s[0]=i[0]-e[0],s[1]=i[1]-e[1],s[2]=i[2]-e[2];const n=o[0]*o[0]+o[1]*o[1]+o[2]*o[2];if(0===n)return!1;const a=2*(o[0]*s[0]+o[1]*s[1]+o[2]*s[2]),l=a*a-4*n*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);return r.t0=(-a-c)/(2*n),r.t1=(-a+c)/(2*n),!0}const D=n.create();function L(e,t){return A(e,t,null)}function V(e,t,r){if(A(e,t,r))return r;const i=N(e,t,f.sv3d.get());return s.add(r,t.origin,s.scale(f.sv3d.get(),t.direction,s.distance(t.origin,i)/s.length(t.direction))),r}function N(e,t,r){const i=f.sv3d.get(),n=f.sm4d.get();s.cross(i,t.origin,t.direction);const a=T(e);s.cross(r,i,t.origin),s.scale(r,r,1/s.length(r)*a);const l=k(e,t.origin),c=h.angle(t.origin,r);return o.fromRotation(n,c+l,i),s.transformMat4(r,r,n),r}function B(e,t,r,i){const o=T(e),s=o*o,n=t+.5*Math.PI,a=r*r+s-2*Math.cos(n)*r*o,l=Math.sqrt(a),c=a-s;if(c<=0)return.5;const u=Math.sqrt(c),d=Math.acos(u/l)-Math.asin(o/(l/Math.sin(n)));return Math.min(1,(d+.5*i)/i)}function U(e,t,r){return A(e,t,r)?r:(d.closestPoint(t,e,r),z(e,r,r))}function z(e,t,r){const i=s.subtract(f.sv3d.get(),t,e),o=s.scale(f.sv3d.get(),i,e[3]/s.length(i));return s.add(r,o,e)}function j(e,t){const r=s.subtract(f.sv3d.get(),t,e),i=s.squaredLength(r),o=e[3]*e[3];return Math.sqrt(Math.abs(i-o))}function k(e,t){const r=s.subtract(f.sv3d.get(),t,e),o=s.length(r),n=T(e),a=n+Math.abs(n-o);return i.acosClamped(n/a)}const G=n.create();function q(e,t,r,i){const o=s.subtract(G,t,e);switch(r){case u.Axis.X:{const e=p.cartesianToSpherical(o,G)[2];return s.set(i,-Math.sin(e),Math.cos(e),0)}case u.Axis.Y:{const e=p.cartesianToSpherical(o,G),t=e[1],r=e[2],n=Math.sin(t);return s.set(i,-n*Math.cos(r),-n*Math.sin(r),Math.cos(t))}case u.Axis.Z:return s.normalize(i,o);default:return}}function H(e,t){const r=s.subtract(Y,t,e);return s.length(r)-e[3]}function W(e,t,r,i){const o=H(e,t),n=q(e,t,u.Axis.Z,Y),a=s.scale(Y,n,r-o);return s.add(i,t,a)}function $(e,t){const r=s.squaredDistance(e,t),i=T(e);return r<=i*i}function J(e,t,r=l.create()){const i=s.distance(e,t),o=e[3],n=t[3];return i+n<o?(a.copy(r,e),r):i+o<n?(a.copy(r,t),r):(s.lerp(r,e,t,(i+n-o)/(2*i)),r[3]=(i+o+n)/2,r)}const Y=n.create(),Z=y(),Q=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:m,altitudeAt:H,angleToSilhouette:k,axisAt:q,cameraFrustumCoverage:B,clear:x,closestPoint:U,closestPointOnSilhouette:N,containsPoint:$,copy:v,create:y,distanceToSilhouette:j,elevate:P,equals:b,exactEquals:g,fromCenterAndRadius:S,fromRadius:w,fromValues:I,getCenter:M,getExtent:C,getRadius:T,intersectLine:E,intersectRay:A,intersectRayClosestSilhouette:V,intersectsRay:L,projectPoint:z,setAltitudeAt:W,setExtent:O,tmpSphere:Z,union:J,wrap:_},Symbol.toStringTag,{value:"Module"}));e.NullSphere=m,e.altitudeAt=H,e.angleToSilhouette=k,e.axisAt=q,e.cameraFrustumCoverage=B,e.clear=x,e.closestPoint=U,e.closestPointOnSilhouette=N,e.containsPoint=$,e.copy=v,e.create=y,e.distanceToSilhouette=j,e.elevate=P,e.equals=b,e.exactEquals=g,e.fromCenterAndRadius=S,e.fromRadius=w,e.fromValues=I,e.getCenter=M,e.getExtent=C,e.getRadius=T,e.intersectLine=E,e.intersectRay=A,e.intersectRayClosestSilhouette=V,e.intersectsRay=L,e.projectPoint=z,e.setAltitudeAt=W,e.setExtent=O,e.sphere=Q,e.tmpSphere=Z,e.union=J,e.wrap=_}))},"esri/geometry/support/sphereUtils":function(){define(["exports","../../core/mathUtils","../../chunks/vec32"],(function(e,t,r){"use strict";e.cartesianToSpherical=function(e,i){const o=r.length(e),s=t.asinClamped(e[2]/o),n=Math.atan2(e[1]/o,e[0]/o);return r.set(i,o,s,n),i},e.sphericalToCartesian=function(e,t){const i=e[0],o=e[1],s=e[2],n=Math.cos(o);r.set(t,i*n*Math.cos(s),i*n*Math.sin(s),i*Math.sin(o))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","../core/shaderLibrary/ShaderOutput","./OITPass","../../../webgl/enums","../../../webgl/renderState"],(function(e,t,r,i,o){"use strict";const s=o.separateBlendingParams(i.BlendFactor.ONE,i.BlendFactor.ZERO,i.BlendFactor.ONE,i.BlendFactor.ONE_MINUS_SRC_ALPHA),n={factor:-1,units:-2};e.OITPolygonOffset=n,e.OITPolygonOffsetLimit=5e5,e.blending=function(e){switch(e){case r.OITPass.NONE:return o.unpremultipliedAlphaToPremultipliedAlpha;case r.OITPass.ColorAlpha:return s;case r.OITPass.FrontFace:case r.OITPass.COUNT:return null}},e.blendingColorAlpha=s,e.depthWrite=function(e){if(e.draped)return null;switch(e.oitPass){case r.OITPass.NONE:case r.OITPass.FrontFace:return e.writeDepth?o.defaultDepthWrite:null;case r.OITPass.ColorAlpha:case r.OITPass.COUNT:return null}},e.getDrawBuffers=function(e,o){const s=t.isColorEmission(o);return e===r.OITPass.ColorAlpha?s?{buffers:[i.ColorAttachment0,i.ColorAttachment1,i.ColorAttachment2]}:{buffers:[i.ColorAttachment0,i.ColorAttachment1]}:s?{buffers:[i.ColorAttachment0,i.ColorAttachment1]}:null},e.oitBlending=function(e){return e===r.OITPass.FrontFace?null:s},e.oitDepthTest=function(e,t=i.CompareFunction.LESS){return e===r.OITPass.NONE||e===r.OITPass.FrontFace?t:i.CompareFunction.LEQUAL},e.oitPolygonOffset=function({oitPass:e,enableOffset:t}){return t&&e===r.OITPass.ColorAlpha?n:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/renderState":function(){define(["exports","../3d/webgl-engine/lib/basicInterfaces","./enums"],(function(e,t,r){"use strict";function i(e,t,i=r.BlendOperation.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}function o(e,t,i,o,s=r.BlendOperation.ADD,n=r.BlendOperation.ADD,a=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:o,opRgb:s,opAlpha:n,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const s=i(r.BlendFactor.ZERO,r.BlendFactor.ONE_MINUS_SRC_ALPHA),n=i(r.BlendFactor.ONE,r.BlendFactor.ZERO),a=i(r.BlendFactor.ONE,r.BlendFactor.ONE),l=i(r.BlendFactor.ONE,r.BlendFactor.ONE_MINUS_SRC_ALPHA),c=o(r.BlendFactor.SRC_ALPHA,r.BlendFactor.ONE,r.BlendFactor.ONE_MINUS_SRC_ALPHA,r.BlendFactor.ONE_MINUS_SRC_ALPHA),u={face:r.Face.BACK,mode:r.CullMode.CCW},d={face:r.Face.FRONT,mode:r.CullMode.CCW};function p(e){return w.intern(e)}function h(e){return M.intern(e)}function f(e){return P.intern(e)}function m(e){return C.intern(e)}function y(e){return E.intern(e)}function g(e){return F.intern(e)}function b(e){return L.intern(e)}function v(e){return N.intern(e)}function S(e){return U.intern(e)}class _{constructor(e,t){this._makeKey=e,this._makeRef=t,this._interns=new Map}intern(e){if(!e)return null;const t=this._makeKey(e),r=this._interns;return r.has(t)||r.set(t,this._makeRef(e)),r.get(t)??null}}function x(e){return"["+e.join(",")+"]"}const w=new _(T,(e=>({__tag:"Blending",...e})));function T(e){return e?x([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const M=new _(I,(e=>({__tag:"Culling",...e})));function I(e){return e?x([e.face,e.mode]):null}const P=new _(O,(e=>({__tag:"PolygonOffset",...e})));function O(e){return e?x([e.factor,e.units]):null}const C=new _(A,(e=>({__tag:"DepthTest",...e})));function A(e){return e?x([e.func]):null}const E=new _(R,(e=>({__tag:"StencilTest",...e})));function R(e){return e?x([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const F=new _(D,(e=>({__tag:"DepthWrite",...e})));function D(e){return e?x([e.zNear,e.zFar]):null}const L=new _(V,(e=>({__tag:"ColorWrite",...e})));function V(e){return e?x([e.r,e.g,e.b,e.a]):null}const N=new _(B,(e=>({__tag:"StencilWrite",...e})));function B(e){return e?x([e.mask]):null}const U=new _(z,(e=>({__tag:"DrawBuffers",...e})));function z(e){return e?x(e.buffers):null}const j=new _((function(e){return e?x([T(e.blending),I(e.culling),O(e.polygonOffset),A(e.depthTest),R(e.stencilTest),D(e.depthWrite),V(e.colorWrite),B(e.stencilWrite),z(e.drawBuffers)]):null}),(e=>({blending:p(e.blending),culling:h(e.culling),polygonOffset:f(e.polygonOffset),depthTest:m(e.depthTest),stencilTest:y(e.stencilTest),depthWrite:g(e.depthWrite),colorWrite:b(e.colorWrite),stencilWrite:v(e.stencilWrite),drawBuffers:S(e.drawBuffers)})));e.StateTracker=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,t,r,i){return(r||e!==t)&&(i(e),this._pipelineInvalid=!0),e}},e.add=a,e.backFaceCullingParams=u,e.copySource=n,e.cullingParams=e=>e===t.CullFaceOptions.Back?u:e===t.CullFaceOptions.Front?d:null,e.defaultColorWrite={r:!0,g:!0,b:!0,a:!0},e.defaultDepthWrite={zNear:0,zFar:1},e.destinationTimesOneMinusSourceAlpha=s,e.frontFaceCullingParams=d,e.makeBlending=p,e.makeColorWrite=b,e.makeCulling=h,e.makeDepthTest=m,e.makeDepthWrite=g,e.makeDrawBuffers=S,e.makePipelineState=function(e){return j.intern(e)},e.makePolygonOffset=f,e.makeStencilTest=y,e.makeStencilWrite=v,e.premultipliedAlpha=l,e.separateBlendingParams=o,e.simpleBlendingParams=i,e.unpremultipliedAlphaToPremultipliedAlpha=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/RayIntersections":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/aaBoundingBox","./IntersectableGeometry","./Util","./VertexAttribute"],(function(e,t,r,i,o,s,n){"use strict";class a{constructor(e=!1,t=!0){this.isVerticalRay=e,this.normalRequired=t}}const l=i.create(),c=r.create();function u(e,t,r,o,s,n,a){if(null==e)return;const p=S(r,c);if(i.setMin(l,e.bbMin),i.setMax(l,e.bbMax),null!=s&&s.applyToAabb(l),_(l,t,p,o)){const{primitiveIndices:i,position:l}=e,c=i?i.length:l.indices.length/3;if(c>w){const i=e.getChildren();if(void 0!==i){for(const e of i)u(e,t,r,o,s,n,a);return}}!function(e,t,r,i,o,s,n,a,l,c,u){const p=e[0],h=e[1],f=e[2],m=t[0],g=t[1],b=t[2],{normalRequired:v}=c;for(let e=0;e<i;++e){const t=a[e],r=3*t,i=n*o[r];let c=s[i],S=s[i+1],_=s[i+2];const x=n*o[r+1];let w=s[x],M=s[x+1],I=s[x+2];const P=n*o[r+2];let O=s[P],C=s[P+1],A=s[P+2];null!=l&&([c,S,_]=l.applyToVertex(c,S,_,e),[w,M,I]=l.applyToVertex(w,M,I,e),[O,C,A]=l.applyToVertex(O,C,A,e));const E=w-c,R=M-S,F=I-_,D=O-c,L=C-S,V=A-_,N=g*V-L*b,B=b*D-V*m,U=m*L-D*g,z=E*N+R*B+F*U;if(Math.abs(z)<=T)continue;const j=p-c,k=h-S,G=f-_,q=j*N+k*B+G*U;if(z>0){if(q<0||q>z)continue}else if(q>0||q<z)continue;const H=k*F-R*G,W=G*E-F*j,$=j*R-E*k,J=m*H+g*W+b*$;if(z>0){if(J<0||q+J>z)continue}else if(J>0||q+J<z)continue;const Y=(D*H+L*W+V*$)/z;Y>=0&&u(Y,t,v?y(E,R,F,D,L,V,d):null)}}(t,r,0,c,l.indices,l.data,l.stride,i,s,n,a)}}const d=r.create();function p(e,r,i,o,s,n,a,l,c,u){const d=r,p=I,y=Math.abs(d[0]),b=Math.abs(d[1]),v=Math.abs(d[2]),S=y>=b?y>=v?0:2:b>=v?1:2,_=S,x=d[_]<0?2:1,w=(S+x)%3,T=(S+(3-x))%3,M=d[w]/d[_],P=d[T]/d[_],O=1/d[_],C=h,A=f,E=m,{normalRequired:R}=c;for(let r=i;r<o;++r){const i=3*r,o=a*s[i];t.set(p[0],n[o+0],n[o+1],n[o+2]);const c=a*s[i+1];t.set(p[1],n[c+0],n[c+1],n[c+2]);const d=a*s[i+2];t.set(p[2],n[d+0],n[d+1],n[d+2]),l&&(t.copy(p[0],l.applyToVertex(p[0][0],p[0][1],p[0][2],r)),t.copy(p[1],l.applyToVertex(p[1][0],p[1][1],p[1][2],r)),t.copy(p[2],l.applyToVertex(p[2][0],p[2][1],p[2][2],r))),t.sub(C,p[0],e),t.sub(A,p[1],e),t.sub(E,p[2],e);const h=C[w]-M*C[_],f=C[T]-P*C[_],m=A[w]-M*A[_],y=A[T]-P*A[_],b=E[w]-M*E[_],v=E[T]-P*E[_],S=b*y-v*m,x=h*v-f*b,I=m*f-y*h;if((S<0||x<0||I<0)&&(S>0||x>0||I>0))continue;const F=S+x+I;if(0===F)continue;const D=S*(O*C[_])+x*(O*A[_])+I*(O*E[_]);if(D*Math.sign(F)<0)continue;const L=D/F;L>=0&&u(L,r,R?g(p):null)}}const h=r.create(),f=r.create(),m=r.create();function y(e,r,i,o,s,n,a){return t.set(b,e,r,i),t.set(v,o,s,n),t.cross(a,b,v),t.normalize(a,a),a}function g(e){return t.sub(b,e[1],e[0]),t.sub(v,e[2],e[0]),t.cross(d,b,v),t.normalize(d,d),d}const b=r.create(),v=r.create();function S(e,r){return t.set(r,1/e[0],1/e[1],1/e[2])}function _(e,t,r,i){return x(e,t,r,i,1/0)}function x(e,t,r,i,o){const s=(e[0]-i-t[0])*r[0],n=(e[3]+i-t[0])*r[0];let a=Math.min(s,n),l=Math.max(s,n);const c=(e[1]-i-t[1])*r[1],u=(e[4]+i-t[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0)return!1;if(a=Math.max(a,Math.min(c,u)),a>l)return!1;const d=(e[2]-i-t[2])*r[2],p=(e[5]+i-t[2])*r[2];return l=Math.min(l,Math.max(d,p)),!(l<0)&&(a=Math.max(a,Math.min(d,p)),!(a>l)&&a<o)}const w=1e3,T=1e-7,M=r.create(),I=[r.create(),r.create(),r.create()];e.MeshIntersectionOptions=a,e.computeInvDir=function(e,r,i){return t.set(i,1/(r[0]-e[0]),1/(r[1]-e[1]),1/(r[2]-e[2]))},e.computeInvDirFromDirection=S,e.computeNormalFromBarycentric=y,e.intersectAabbInvDir=_,e.intersectAabbInvDirBefore=x,e.intersectRayTriangles=function(e,t,r,i,o,s,n,a,l,c=null,u=0){const p=e[0],h=e[1],f=e[2],m=t[0],g=t[1],b=t[2];for(let e=r;e<i;++e){const t=u+(c?c[e]:e),r=3*t,i=n*o[r],v=s[i],S=s[i+1],_=s[i+2],x=n*o[r+1],w=s[x],M=s[x+1],I=s[x+2],P=n*o[r+2],O=w-v,C=M-S,A=I-_,E=s[P]-v,R=s[P+1]-S,F=s[P+2]-_,D=g*F-R*b,L=b*E-F*m,V=m*R-E*g,N=O*D+C*L+A*V;if(Math.abs(N)<=T)continue;const B=p-v,U=h-S,z=f-_,j=B*D+U*L+z*V;if(N>0){if(j<0||j>N)continue}else if(j>0||j<N)continue;const k=U*A-C*z,G=z*O-A*B,q=B*C-O*U,H=m*k+g*G+b*q;if(N>0){if(H<0||j+H>N)continue}else if(H>0||j+H<N)continue;const W=(E*k+R*G+F*q)/N;W>=0&&l(W,t,a?y(O,C,A,E,R,F,d):null)}},e.intersectRayTrianglesWithDisplacementWatertight=p,e.intersectRayTrianglesWithVerticalOffsetENUGlobal=function(e,t,r,i,o,s,n,a,l,c,u,p=null,h=0){const f=e[0],m=e[1],g=e[2],b=t[0],v=t[1],S=t[2];for(let e=r;e<i;++e){const t=h+(p?p[e]:e),r=3*t,i=n*o[r],_=s[i],x=s[i+1],w=s[i+2],M=n*o[r+1],I=s[M],P=s[M+1],O=s[M+2],C=n*o[r+2],A=s[C],E=s[C+1],R=s[C+2],F=w-l,D=a/Math.sqrt(_*_+x*x+F*F),L=_+_*D,V=x+x*D,N=w+F*D,B=O-l,U=a/Math.sqrt(I*I+P*P+B*B),z=I+I*U,j=P+P*U,k=O+B*U,G=R-l,q=a/Math.sqrt(A*A+E*E+G*G),H=z-L,W=j-V,$=k-N,J=A+A*q-L,Y=E+E*q-V,Z=R+G*q-N,Q=v*Z-Y*S,X=S*J-Z*b,K=b*Y-J*v,ee=H*Q+W*X+$*K;if(Math.abs(ee)<=T)continue;const te=f-L,re=m-V,ie=g-N,oe=te*Q+re*X+ie*K;if(ee>0){if(oe<0||oe>ee)continue}else if(oe>0||oe<ee)continue;const se=re*$-W*ie,ne=ie*H-$*te,ae=te*W-H*re,le=b*se+v*ne+S*ae;if(ee>0){if(le<0||oe+le>ee)continue}else if(le>0||oe+le<ee)continue;const ce=(J*se+Y*ne+Z*ae)/ee;ce>=0&&u(ce,t,c?y(H,W,$,J,Y,Z,d):null)}},e.intersectRenderGeometryTriangles=function(e,t,r,i,o,s,n,a){const l=e[0],c=e[1],u=e[2],p=t[0],h=t[1],f=t[2];for(let e=r;e<i;++e){const t=3*e,r=t+1,i=t+2,m=s*t,g=o[m],b=o[m+1],v=o[m+2],S=s*r,_=s*i,x=o[S]-g,w=o[S+1]-b,M=o[S+2]-v,I=o[_]-g,P=o[_+1]-b,O=o[_+2]-v,C=h*O-P*f,A=f*I-O*p,E=p*P-I*h,R=x*C+w*A+M*E;if(Math.abs(R)<=T)continue;const F=l-g,D=c-b,L=u-v,V=F*C+D*A+L*E;if(R>0){if(V<0||V>R)continue}else if(V>0||V<R)continue;const N=D*M-w*L,B=L*x-M*F,U=F*w-x*D,z=p*N+h*B+f*U;if(R>0){if(z<0||V+z>R)continue}else if(z>0||V+z<R)continue;const j=(I*N+P*B+O*U)/R;j>=0&&a(j,e,n?y(x,w,M,I,P,O,d):null)}},e.intersectTriangleGeometry=function(e,r,i,l,c,d){if(!e.visible)return;const h=t.sub(M,l,i),f=(e,t,r)=>{d(e,r,t)},m=new a(!1,r.options.normalRequired);if(e.boundingInfo){s.assert(e.type===o.GeometryType.Mesh);const t=r.tolerance;u(e.boundingInfo,i,h,t,c,m,f)}else{const t=e.attributes.get(n.VertexAttribute.POSITION),r=t.indices;p(i,h,0,r.length/3,r,t.data,t.stride,c,m,f)}},e.intersectTriangles=function(e,r,i,o,s,n,a,l,c){const{data:u,stride:d}=n;p(e,t.sub(M,r,e),i,o,s,u,d,a,l,c)},e.triangleRayParallelTolerance=T,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],(function(e){"use strict";var t;e.RenderSlot=void 0,(t=e.RenderSlot||(e.RenderSlot={}))[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_MATERIAL_WITHOUT_NORMALS=3]="OPAQUE_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_MATERIAL_WITHOUT_NORMALS=5]="TRANSPARENT_MATERIAL_WITHOUT_NORMALS",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_MATERIAL_WITHOUT_DEPTH=7]="TRANSPARENT_MATERIAL_WITHOUT_DEPTH",t[t.OCCLUDED_GROUND=8]="OCCLUDED_GROUND",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.HUD_MATERIAL=12]="HUD_MATERIAL",t[t.LABEL_MATERIAL=13]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=14]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH",t[t.OVERLAY=16]="OVERLAY",t[t.DRAPED_MATERIAL=17]="DRAPED_MATERIAL",t[t.DRAPED_WATER=18]="DRAPED_WATER",t[t.VOXEL=19]="VOXEL",t[t.MAX_SLOTS=20]="MAX_SLOTS",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/sphere","../../../ViewingMode","../../support/orientedBoundingBox"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";class u{constructor(e,t,r){this._original=e,this._update=t,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}class d{constructor(e=0){this.offset=e,this.tmpVertex=n.create()}applyToVertex(e,t,r){const i=s.set(g,e,t,r),o=s.add(b,i,this.localOrigin),n=this.offset/s.length(o);return s.scaleAndAdd(this.tmpVertex,i,o,n),this.tmpVertex}applyToAabb(e){const t=v,r=S,i=_;for(let o=0;o<3;++o)t[o]=e[0+o]+this.localOrigin[o],r[o]=e[3+o]+this.localOrigin[o],i[o]=t[o];const o=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=o[t],e[t+3]=o[t];const s=t=>{const r=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=Math.min(e[t],r[t]),e[t+3]=Math.max(e[t+3],r[t])};for(let e=1;e<8;++e){for(let o=0;o<3;++o)i[o]=e&1<<o?r[o]:t[o];s(i)}let n=0;for(let e=0;e<3;++e)t[e]*r[e]<0&&(n|=1<<e);if(0!==n&&7!==n)for(let e=0;e<8;++e)if(0===(n&e)){for(let o=0;o<3;++o)i[o]=n&1<<o?0:e&1<<o?t[o]:r[o];s(i)}for(let t=0;t<3;++t)e[t]-=this.localOrigin[t],e[t+3]-=this.localOrigin[t];return e}}class p{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=n.create(),this._tmpMbs=a.create(),this._tmpObb=new c.Obb,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=s.length(e)}applyToVertex(e,t,r){const i=s.set(g,e,t,r),o=s.set(b,e,t,r+this.componentLocalOriginLength),n=this._totalOffset/s.length(o);return s.scaleAndAdd(this._tmpVertex,i,o,n),this._tmpVertex}applyToAabb(e){const t=this.componentLocalOriginLength,r=e[0],i=e[1],o=e[2]+t,s=e[3],n=e[4],a=e[5]+t,l=Math.abs(r),c=Math.abs(i),u=Math.abs(o),d=Math.abs(s),p=Math.abs(n),h=Math.abs(a),f=.5*(1+Math.sign(r*s))*Math.min(l,d),m=.5*(1+Math.sign(i*n))*Math.min(c,p),y=.5*(1+Math.sign(o*a))*Math.min(u,h),g=Math.max(l,d),b=Math.max(c,p),v=Math.max(u,h),S=Math.sqrt(f*f+m*m+y*y),_=Math.sign(l+r),x=Math.sign(c+i),w=Math.sign(u+o),T=Math.sign(d+s),M=Math.sign(p+n),I=Math.sign(h+a),P=this._totalOffset;if(S<P)return e[0]-=(1-_)*P,e[1]-=(1-x)*P,e[2]-=(1-w)*P,e[3]+=T*P,e[4]+=M*P,e[5]+=I*P,e;const O=P/Math.sqrt(g*g+b*b+v*v),C=P/S,A=C-O,E=-A;return e[0]+=r*(_*E+C),e[1]+=i*(x*E+C),e[2]+=o*(w*E+C),e[3]+=s*(T*A+O),e[4]+=n*(M*A+O),e[5]+=a*(I*A+O),e}applyToMbs(e){const t=s.length(a.getCenter(e)),r=this._totalOffset/t;return s.scaleAndAdd(a.getCenter(this._tmpMbs),a.getCenter(e),a.getCenter(e),r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/t,this._tmpMbs}applyToObb(e){return c.computeOffsetObb(e,this._totalOffset,this._totalOffset,l.ViewingMode.Global,this._tmpObb),this._tmpObb}}class h{constructor(e=0){this.offset=e,this.sphere=a.create(),this.tmpVertex=n.create()}applyToVertex(e,t,r){const i=this.objectTransform.transform,o=s.set(g,e,t,r),n=s.transformMat4(o,o,i),a=this.offset/s.length(n);s.scaleAndAdd(n,n,n,a);const l=this.objectTransform.inverse;return s.transformMat4(this.tmpVertex,n,l),this.tmpVertex}applyToMinMax(e,t){const r=this.offset/s.length(e);s.scaleAndAdd(e,e,e,r);const i=this.offset/s.length(t);s.scaleAndAdd(t,t,t,i)}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const t=s.length(a.getCenter(e)),r=this.offset/t;return s.scaleAndAdd(a.getCenter(this.sphere),a.getCenter(e),a.getCenter(e),r),this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}const f=new h,m=new p,y=new d,g=n.create(),b=n.create(),v=n.create(),S=n.create(),_=n.create();e.I3SVerticalOffsetGlobalViewingMode=p,e.IntersectorTransform=class{constructor(){this._transform=o.create(),this._transformInverse=new u({value:this._transform},i.invert,o.create),this._transformInverseTranspose=new u(this._transformInverse,i.transpose,o.create),this._transformTranspose=new u({value:this._transform},i.transpose,o.create),this._transformInverseRotation=new u({value:this._transform},t.normalFromMat4Legacy,r.create)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){i.copy(this._transform,e)}multiplyTransform(e){i.multiply(this._transform,this._transform,e)}set(e){i.copy(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}},e.Object3DVerticalOffsetGlobalViewingMode=h,e.TerrainVerticalOffsetGlobalViewingMode=d,e.getVerticalOffsetI3S=function(e){return null!=e?(m.offset=e,m):null},e.getVerticalOffsetObject3D=function(e){return null!=e?(f.offset=e,f):null},e.getVerticalOffsetTerrain=function(e){return null!=e?(y.offset=e,y):null},e.terrainId="terrain",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/orientedBoundingBox":function(){define(["exports","../../../core/libs/gl-matrix-2/math/mat3","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../core/libs/gl-matrix-2/factories/mat4f64","../../../core/libs/gl-matrix-2/math/quat","../../../core/libs/gl-matrix-2/factories/quatf64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../chunks/vec42","../../../core/libs/gl-matrix-2/factories/vec4f64","../../../geometry/ellipsoidUtils","../../../geometry/spatialReferenceEllipsoidUtils","../../../geometry/projection/computeTranslationToOriginAndRotation","../../../geometry/projection/projectBuffer","../../../geometry/projection/projectors","../../../geometry/support/plane","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/vectorStacks","../../ViewingMode","./dito","../webgl-engine/lib/Attribute"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S){"use strict";class _{constructor(e=a.ZEROS,t=q,r=s.IDENTITY){this._data=[e[0],e[1],e[2],t[0],t[1],t[2],r[0],r[1],r[2],r[3]]}clone(){const e=new _;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const t=new _;return t._data=e.slice(),t}static fromJSON(e){return new _(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return n.set(g.sv3d.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,t,r){this._data[0]=e,this._data[1]=t,this._data[2]=r}get halfSize(){return n.set(g.sv3d.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return o.set(g.sq4d.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const t=x,r=this._data;t[0]=r[6],t[1]=r[7],t[2]=r[8],t[3]=r[9];for(let i=0;i<8;++i){const o=e[i];o[0]=(1&i?-1:1)*r[3],o[1]=(2&i?-1:1)*r[4],o[2]=(4&i?-1:1)*r[5],n.transformQuat(o,o,t),o[0]+=r[0],o[1]+=r[1],o[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],t=this._data[4],r=this._data[5];return Math.sqrt(e*e+t*t+r*r)}intersectSphere(e){M[0]=this._data[0]-e[0],M[1]=this._data[1]-e[1],M[2]=this._data[2]-e[2];const t=this.getQuaternion(w);return o.conjugate(x,t),n.transformQuat(M,M,x),n.abs(M,M),I[0]=Math.min(M[0],this._data[3]),I[1]=Math.min(M[1],this._data[4]),I[2]=Math.min(M[2],this._data[5]),n.sqrDist(I,M)<e[3]*e[3]}intersectSphereWithMBS(e,t=this.radius){const r=this._data;M[0]=r[0]-e[0],M[1]=r[1]-e[1],M[2]=r[2]-e[2];const i=e[3],o=i+t;return!(n.sqrLen(M)>o*o)&&(x[0]=-r[6],x[1]=-r[7],x[2]=-r[8],x[3]=r[9],n.transformQuat(M,M,x),n.abs(M,M),I[0]=Math.min(M[0],r[3]),I[1]=Math.min(M[1],r[4]),I[2]=Math.min(M[2],r[5]),n.sqrDist(I,M)<i*i)}intersectPlane(e){const t=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(m.getNormal(e));return t>r?1:t<-r?-1:0}intersectRay(e,t,r=0){const i=this._data,o=x;o[0]=-i[6],o[1]=-i[7],o[2]=-i[8],o[3]=i[9],M[0]=e[0]-i[0],M[1]=e[1]-i[1],M[2]=e[2]-i[2];const s=n.transformQuat(M,M,x),a=n.transformQuat(I,t,x);let l=-1/0,c=1/0;const u=this.getHalfSize(N);for(let e=0;e<3;e++){const t=s[e],i=a[e],o=u[e]+r;if(Math.abs(i)>1e-6){const e=(o-t)/i,r=(-o-t)/i;l=Math.max(l,Math.min(e,r)),c=Math.min(c,Math.max(e,r))}else if(t>o||t<-o)return!1}return l<=c}projectedArea(e,r,i,s){const a=this.getQuaternion(w);o.conjugate(x,a),M[0]=e[0]-this._data[0],M[1]=e[1]-this._data[1],M[2]=e[2]-this._data[2],n.transformQuat(M,M,x);const c=this.getHalfSize(N),u=M[0]<-c[0]?-1:M[0]>c[0]?1:0,d=M[1]<-c[1]?-1:M[1]>c[1]?1:0,p=M[2]<-c[2]?-1:M[2]>c[2]?1:0,h=Math.abs(u)+Math.abs(d)+Math.abs(p);if(0===h)return 1/0;const f=1===h?4:6,m=6*(u+3*d+9*p+13);t.fromQuat(B,a),t.scale(B,B,c);const y=this.getCenter(L);for(let e=0;e<f;e++){const t=A[m+e];n.set(M,((1&t)<<1)-1,(2&t)-1,((4&t)>>1)-1),n.transformMat3(M,M,B),n.add(P,y,M),P[3]=1,l.transformMat4(P,P,r);const i=1/Math.max(1e-6,P[3]);C[2*e]=P[0]*i,C[2*e+1]=P[1]*i}const g=2*f-2;let b=C[0]*(C[3]-C[g+1])+C[g]*(C[1]-C[g-1]);for(let e=2;e<g;e+=2)b+=C[e]*(C[e+3]-C[e-1]);return Math.abs(b)*i*s*.125}projectedRadius(e){const t=this.getQuaternion(w);return o.conjugate(x,t),n.transformQuat(M,e,x),Math.abs(M[0]*this._data[3])+Math.abs(M[1]*this._data[4])+Math.abs(M[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(m.getNormal(e))}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(m.getNormal(e))}toAaBoundingBox(e){const r=this.getQuaternion(w),i=t.fromQuat(B,r),o=this._data[3]*Math.abs(i[0])+this._data[4]*Math.abs(i[3])+this._data[5]*Math.abs(i[6]),s=this._data[3]*Math.abs(i[1])+this._data[4]*Math.abs(i[4])+this._data[5]*Math.abs(i[7]),n=this._data[3]*Math.abs(i[2])+this._data[4]*Math.abs(i[5])+this._data[5]*Math.abs(i[8]);e[0]=this._data[0]-o,e[1]=this._data[1]-s,e[2]=this._data[2]-n,e[3]=this._data[0]+o,e[4]=this._data[1]+s,e[5]=this._data[2]+n}transform(e,t,r,i=0,s=d.getSphericalPCPF(r),a=d.getSphericalPCPF(t),l=f.getProjector(t,a)){if(r===s)t.isGeographic?function(e,t,r,i,s=d.getSphericalPCPF(r)){const a=u.getReferenceEllipsoid(r),l=1+Math.max(0,i)/(a.radius+e.centerZ);e.getCenter(D),D[2]+=i,h.projectBuffer(D,r,0,D,s,0),t.center=D;const c=e.getQuaternion(w);t.quaternion=c,o.conjugate(x,c),n.set(j,0,0,1),n.transformQuat(j,j,x);const p=e.getHalfSize(N);n.set(j,p[0]*Math.abs(j[0]),p[1]*Math.abs(j[1]),p[2]*Math.abs(j[2])),n.scale(j,j,a.inverseFlattening),n.add(j,p,j),t.halfSize=n.scale(j,j,l)}(this,e,t,i,a):function(e,t,r,i,s=d.getSphericalPCPF(r),a=f.getProjector(r,s)){e.getCorners(z),e.getCenter(D),D[2]+=i,p.computeTranslationToOriginAndRotation(r,D,U,s),t.setCenter(U[12],U[13],U[14]);const l=2*Math.sqrt(1+U[0]+U[5]+U[10]);x[0]=(U[6]-U[9])/l,x[1]=(U[8]-U[2])/l,x[2]=(U[1]-U[4])/l,x[3]=.25*l;const c=e.getQuaternion(w);t.quaternion=o.multiply(x,x,c),o.conjugate(x,x),n.set(k,0,0,0);const u=t.getCenter(V);for(const e of z)e[2]+=i,a(e,0,e,0),n.sub(j,e,u),n.transformQuat(j,j,x),n.abs(j,j),n.max(k,k,j);t.halfSize=k}(this,e,t,i,a,l);else if(t.isWGS84&&(r.isWebMercator||y.isPlateCarree(r)))!function(e,t,r,i,o){t.getCenter(L),L[2]+=o;const s=d.getSphericalPCPF(r);h.projectBuffer(L,e,0,L,s,0),E(s,t,L,r,i)}(t,this,r,e,i);else if(t.isWebMercator&&y.isPlateCarree(r))!function(e,t,r,i,o){t.getCenter(L),L[2]+=o,E(e,t,L,r,i)}(t,this,r,e,i);else{const o=this.getCenter(L);o[2]+=i,h.projectBuffer(o,t,0,o,r,0),e.center=o,this!==e&&(e.quaternion=this.getQuaternion(w),e.halfSize=this.getHalfSize(N))}}}const x=s.create(),w=s.create(),T=s.create(),M=a.create(),I=a.create(),P=c.create();function O(e,t=new _){return v.computeOBB(e,t),t}const C=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],A=(()=>{const e=new Int8Array(162);let t=0;const r=r=>{for(let i=0;i<r.length;i++)e[t+i]=r[i];t+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),e})();function E(e,r,i,o,s){const n=r.getQuaternion(w),a=t.fromQuat(B,n),l=r.getHalfSize(N);for(let e=0;e<8;++e){for(let t=0;t<3;++t)D[t]=l[t]*(e&1<<t?-1:1);for(let t=0;t<3;++t){let r=i[t];for(let e=0;e<3;++e)r+=D[e]*a[3*e+t];R[3*e+t]=r}}h.projectBuffer(R,e,0,R,o,0,8),O(F,s)}const R=new Array(24),F=new S.Vertices(R,3),D=a.create(),L=a.create(),V=a.create(),N=a.create(),B=r.create(),U=i.create(),z=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],j=a.create(),k=a.create(),G=a.create(),q=a.freeze(-1,-1,-1);e.Obb=_,e.compute=O,e.computeOffsetObb=function(e,t,r,i,s){const l=e.getQuaternion(w);s.quaternion=l,o.conjugate(x,l);const c=e.getCenter(L),u=e.getHalfSize(N);if(i===b.ViewingMode.Global){n.transformQuat(j,c,x),n.abs(k,j),n.min(G,k,u),n.sub(G,k,G);const i=n.length(G);n.add(G,k,u);const o=n.length(G);if(i<r)s.center=c,n.set(j,r,r,r),s.halfSize=n.add(j,u,j);else{const a=o>0?1+t/o:1,l=i>0?1+r/i:1,c=(l+a)/2,d=(l-a)/2;n.scale(G,k,d),s.halfSize=n.scaleAndAdd(G,G,u,c),n.scale(G,k,c),n.scaleAndAdd(G,G,u,d),n.sign(j,j),n.multiply(j,G,j);const p=e.getQuaternion(T);s.center=n.transformQuat(j,j,p)}}else{s.center=n.scaleAndAdd(j,c,a.UNIT_Z,(r+t)/2);const e=n.transformQuat(j,a.UNIT_Z,x);n.abs(e,e),s.halfSize=n.scaleAndAdd(k,u,e,(r-t)/2)}return s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/math/quat":function(){define(["exports","../factories/mat3f64","../factories/quatf64","../factories/vec3f64","./common","../../../../chunks/vec32","../../../../chunks/vec42"],(function(e,t,r,i,o,s,n){"use strict";function a(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function l(e,t,r){r*=.5;const i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function c(e,t){const r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>o.getEpsilon()?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function u(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+n*a+o*c-s*l,e[1]=o*u+n*l+s*a-i*c,e[2]=s*u+n*c+i*l-o*a,e[3]=n*u-i*a-o*l-s*c,e}function d(e,t,r){r*=.5;const i=t[0],o=t[1],s=t[2],n=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=o*l+s*a,e[2]=s*l-o*a,e[3]=n*l-i*a,e}function p(e,t,r){r*=.5;const i=t[0],o=t[1],s=t[2],n=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-s*a,e[1]=o*l+n*a,e[2]=s*l+i*a,e[3]=n*l-o*a,e}function h(e,t,r){r*=.5;const i=t[0],o=t[1],s=t[2],n=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*a,e[1]=o*l-i*a,e[2]=s*l+n*a,e[3]=n*l-s*a,e}function f(e,t){const r=t[0],i=t[1],o=t[2];return e[0]=r,e[1]=i,e[2]=o,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-o*o)),e}function m(e,t,r,i){const s=t[0],n=t[1],a=t[2],l=t[3];let c,u,d,p,h,f=r[0],m=r[1],y=r[2],g=r[3];return u=s*f+n*m+a*y+l*g,u<0&&(u=-u,f=-f,m=-m,y=-y,g=-g),1-u>o.getEpsilon()?(c=Math.acos(u),d=Math.sin(c),p=Math.sin((1-i)*c)/d,h=Math.sin(i*c)/d):(p=1-i,h=i),e[0]=p*s+h*f,e[1]=p*n+h*m,e[2]=p*a+h*y,e[3]=p*l+h*g,e}function y(e){const t=o.RANDOM,r=t(),i=t(),s=t(),n=Math.sqrt(1-r),a=Math.sqrt(r);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*s),e[3]=a*Math.cos(2*Math.PI*s),e}function g(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=r*r+i*i+o*o+s*s,a=n?1/n:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-o*a,e[3]=s*a,e}function b(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function v(e,t){const r=t[0]+t[4]+t[8];let i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const o=(r+1)%3,s=(r+2)%3;i=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*s+s]+1),e[r]=.5*i,i=.5/i,e[3]=(t[3*o+s]-t[3*s+o])*i,e[o]=(t[3*o+r]+t[3*r+o])*i,e[s]=(t[3*s+r]+t[3*r+s])*i}return e}function S(e,t,r,i){const o=.5*Math.PI/180;t*=o,r*=o,i*=o;const s=Math.sin(t),n=Math.cos(t),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return e[0]=s*l*u-n*a*c,e[1]=n*a*u+s*l*c,e[2]=n*l*c-s*a*u,e[3]=n*l*u+s*a*c,e}function _(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const x=n.copy,w=n.set,T=n.add,M=u,I=n.scale,P=n.dot,O=n.lerp,C=n.length,A=C,E=n.squaredLength,R=E,F=n.normalize,D=n.exactEquals,L=n.equals;function V(e,t,r){const i=s.dot(t,r);return i<-.999999?(s.cross(N,B,t),s.len(N)<1e-6&&s.cross(N,U,t),s.normalize(N,N),l(e,N,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(s.cross(N,t,r),e[0]=N[0],e[1]=N[1],e[2]=N[2],e[3]=1+i,F(e,e))}const N=i.create(),B=i.fromValues(1,0,0),U=i.fromValues(0,1,0);function z(e,t,r,i,o,s){return m(j,t,o,s),m(k,r,i,s),m(e,j,k,2*s*(1-s)),e}const j=r.create(),k=r.create();function G(e,t,r,i){const o=q;return o[0]=r[0],o[3]=r[1],o[6]=r[2],o[1]=i[0],o[4]=i[1],o[7]=i[2],o[2]=-t[0],o[5]=-t[1],o[8]=-t[2],F(e,v(e,o))}const q=t.create(),H=Object.freeze(Object.defineProperty({__proto__:null,add:T,calculateW:f,conjugate:b,copy:x,dot:P,equals:L,exactEquals:D,fromEuler:S,fromMat3:v,getAxisAngle:c,identity:a,invert:g,len:A,length:C,lerp:O,mul:M,multiply:u,normalize:F,random:y,rotateX:d,rotateY:p,rotateZ:h,rotationTo:V,scale:I,set:w,setAxes:G,setAxisAngle:l,slerp:m,sqlerp:z,sqrLen:R,squaredLength:E,str:_},Symbol.toStringTag,{value:"Module"}));e.add=T,e.calculateW=f,e.conjugate=b,e.copy=x,e.dot=P,e.equals=L,e.exactEquals=D,e.fromEuler=S,e.fromMat3=v,e.getAxisAngle=c,e.identity=a,e.invert=g,e.len=A,e.length=C,e.lerp=O,e.mul=M,e.multiply=u,e.normalize=F,e.quat=H,e.random=y,e.rotateX=d,e.rotateY=p,e.rotateZ=h,e.rotationTo=V,e.scale=I,e.set=w,e.setAxes=G,e.setAxisAngle=l,e.slerp=m,e.sqlerp=z,e.sqrLen=R,e.squaredLength=E,e.str=_,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports","./ellipsoidUtils","./SpatialReference","./support/spatialReferenceUtils"],(function(e,t,r,i){"use strict";const o=new r(t.SphericalECEFSpatialReferenceLike),s=new r(t.SphericalPCPFMarsLike),n=new r(t.SphericalPCPFMoonLike),a=new r(t.WGS84ECEFSpatialReferenceLike),l=new Map,c=s.wkt.toUpperCase(),u=n.wkt.toUpperCase();e.SphericalECEFSpatialReference=o,e.SphericalPCPFMars=s,e.SphericalPCPFMoon=n,e.WGS84ECEFSpatialReference=a,e.getSphericalPCPF=function(e){const t=l.get(e);if(t)return t;let r=o;if(e)if(e===s)r=s;else if(e===n)r=n;else{const t=e.wkid,o=e.latestWkid;if(null!=t||null!=o)i.isWKIDFromMars(t)||i.isWKIDFromMars(o)?r=s:(i.isWKIDFromMoon(t)||i.isWKIDFromMoon(o))&&(r=n);else{const t=e.wkt2??e.wkt;if(t){const e=t.toUpperCase();e===c?r=s:e===u&&(r=n)}}}return l.set(e,r),r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/dito":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../core/libs/gl-matrix-2/factories/quatf64","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../webgl-engine/lib/Attribute"],(function(e,t,r,i,o,s,n){"use strict";const a=1e-6,l=s.create(),c=s.create(),u=s.create(),d=s.create(),p=s.create(),h=s.create(),f=s.create(),m=s.create(),y=s.create(),g=s.create(),b=[0,0,0],v=i.create(),S=s.create(),_=s.create(),x=s.create(),w=s.create(),T=s.create(),M=s.create();function I(e,t,r,i,o,s){if(K(t)<a)return;Q(S,r,t),Q(_,i,t),Q(x,o,t),O(e,t,v),T[1]=v[0],w[1]=v[1],M[1]=w[1]-T[1];const n=[r,i,o],l=[S,_,x];for(let r=0;r<3;++r){O(e,n[r],v),T[0]=v[0],w[0]=v[1],O(e,l[r],v),T[2]=v[0],w[2]=v[1],M[0]=w[0]-T[0],M[2]=w[2]-T[2];const i=W(M);i<s.quality&&(Z(s.b0,n[r]),Z(s.b1,t),Z(s.b2,l[r]),s.quality=i)}}const P=s.create();function O(e,t,r){const{data:i,size:o}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<i.length;e+=o){const o=i[e]*t[0]+i[e+1]*t[1]+i[e+2]*t[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function C(e,t,i){i.center=e,i.halfSize=o.scale(t,t,.5),i.quaternion=r.IDENTITY}const A=s.create(),E=s.create(),R=s.create(),F=s.create(),D=s.create(),L=s.create();function V(e,t,r){Z(A,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?A[0]=0:Math.abs(t[1])>Math.abs(t[2])?A[1]=0:A[2]=0,K(A)<a&&(A[0]=A[1]=A[2]=1),Q(E,t,A),X(E,E),Q(R,t,E),X(R,R),N(e,t,E,R,F,D),J(L,D,F),G(t,E,R,F,D,L,r)}function N(e,t,r,i,o,s){O(e,t,v),o[0]=v[0],s[0]=v[1],O(e,r,v),o[1]=v[0],s[1]=v[1],O(e,i,v),o[2]=v[0],s[2]=v[1]}const B=s.create(),U=s.create(),z=s.create(),j=t.fromValues(1,0,0,0,1,0,0,0,1),k=r.create();function G(e,t,r,i,s,n,a){j[0]=e[0],j[1]=e[1],j[2]=e[2],j[3]=t[0],j[4]=t[1],j[5]=t[2],j[6]=r[0],j[7]=r[1],j[8]=r[2],a.quaternion=function(e,t){const r=t[0]+t[4]+t[8];if(r>0){let i=Math.sqrt(r+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const i=(r+1)%3,o=(r+2)%3;let s=Math.sqrt(t[3*r+r]-t[3*i+i]-t[3*o+o]+1);e[r]=.5*s,s=.5/s,e[3]=(t[3*i+o]-t[3*o+i])*s,e[i]=(t[3*i+r]+t[3*r+i])*s,e[o]=(t[3*o+r]+t[3*r+o])*s}return e}(k,j),$(B,i,s),Y(B,B,.5),Y(U,e,B[0]),Y(z,t,B[1]),$(U,U,z),Y(z,r,B[2]),a.center=o.add(U,U,z),a.halfSize=o.scale(B,n,.5)}class q{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let e=0;e<7;++e)this.minVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.maxVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.minProj[e]=Number.POSITIVE_INFINITY,this.maxProj[e]=Number.NEGATIVE_INFINITY;const r=new Array(7),i=new Array(7),{data:o,size:s}=e;for(let e=0;e<o.length;e+=s){let t=o[e];t<this.minProj[0]&&(this.minProj[0]=t,r[0]=e),t>this.maxProj[0]&&(this.maxProj[0]=t,i[0]=e),t=o[e+1],t<this.minProj[1]&&(this.minProj[1]=t,r[1]=e),t>this.maxProj[1]&&(this.maxProj[1]=t,i[1]=e),t=o[e+2],t<this.minProj[2]&&(this.minProj[2]=t,r[2]=e),t>this.maxProj[2]&&(this.maxProj[2]=t,i[2]=e),t=o[e]+o[e+1]+o[e+2],t<this.minProj[3]&&(this.minProj[3]=t,r[3]=e),t>this.maxProj[3]&&(this.maxProj[3]=t,i[3]=e),t=o[e]+o[e+1]-o[e+2],t<this.minProj[4]&&(this.minProj[4]=t,r[4]=e),t>this.maxProj[4]&&(this.maxProj[4]=t,i[4]=e),t=o[e]-o[e+1]+o[e+2],t<this.minProj[5]&&(this.minProj[5]=t,r[5]=e),t>this.maxProj[5]&&(this.maxProj[5]=t,i[5]=e),t=o[e]-o[e+1]-o[e+2],t<this.minProj[6]&&(this.minProj[6]=t,r[6]=e),t>this.maxProj[6]&&(this.maxProj[6]=t,i[6]=e)}for(let e=0;e<7;++e){let t=r[e];Z(this.minVert[e],o,t),t=i[e],Z(this.maxVert[e],o,t)}}}class H{constructor(){this.b0=s.fromValues(1,0,0),this.b1=s.fromValues(0,1,0),this.b2=s.fromValues(0,0,1),this.quality=0}}function W(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function $(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function J(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function Y(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function Z(e,t,r=0){e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2]}function Q(e,t,r){const i=t[0],o=t[1],s=t[2],n=r[0],a=r[1],l=r[2];e[0]=o*l-s*a,e[1]=s*n-i*l,e[2]=i*a-o*n}function X(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function K(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function ee(e,t){const r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return r*r+i*i+o*o}function te(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}e.computeOBB=function(e,t){const{data:r,size:i}=e,o=r.length/i;if(o<=0)return;const S=new q(e);$(l,S.minProj,S.maxProj),Y(l,l,.5),J(c,S.maxProj,S.minProj);const _=W(c),x=new H;x.quality=_,o<14&&(e=new n.Vertices(new Float64Array(S.buffer,112,42),3));const w=s.create(),T=s.create(),M=s.create(),O=s.create(),A=s.create(),E=s.create(),R=s.create();switch(function(e,t,r,i,o,s,n,l,c,u){if(function(e,t,r){let i=ee(e.maxVert[0],e.minVert[0]),o=0;for(let t=1;t<7;++t){const r=ee(e.maxVert[t],e.minVert[t]);r>i&&(i=r,o=t)}Z(t,e.minVert[o]),Z(r,e.maxVert[o])}(e,i,o),ee(i,o)<a)return 1;J(n,i,o),X(n,n);const d=function(e,t,r,i){const{data:o,size:s}=e;let n=Number.NEGATIVE_INFINITY,a=0;for(let e=0;e<o.length;e+=s){b[0]=o[e]-t[0],b[1]=o[e+1]-t[1],b[2]=o[e+2]-t[2];const i=r[0]*b[0]+r[1]*b[1]+r[2]*b[2],s=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=b[0]*b[0]+b[1]*b[1]+b[2]*b[2]-i*i/s;l>n&&(n=l,a=e)}return Z(i,o,a),n}(t,i,n,s);return d<a?2:(J(l,o,s),X(l,l),J(c,s,i),X(c,c),Q(r,l,n),X(r,r),I(t,r,n,l,c,u),0)}(S,e,R,w,T,M,O,A,E,x)){case 1:return void C(l,c,t);case 2:return void V(e,O,t)}!function(e,t,r,i,o,s,n,l,c){(function(e,t,r,i,o){!function(e,t,r,i,o){const{data:s,size:n}=e;Z(i,s),Z(o,i),r[0]=te(P,t),r[1]=r[0];for(let e=n;e<s.length;e+=n){const n=s[e]*t[0]+s[e+1]*t[1]+s[e+2]*t[2];n<r[0]&&(r[0]=n,Z(i,s,e)),n>r[1]&&(r[1]=n,Z(o,s,e))}}(e,t,v,o,i);const s=te(r,t);v[1]-a<=s&&(i[0]=void 0),v[0]+a>=s&&(o[0]=void 0)})(e,t,r,u,d),void 0!==u[0]&&(J(p,u,r),X(p,p),J(h,u,i),X(h,h),J(f,u,o),X(f,f),Q(m,h,s),X(m,m),Q(y,f,n),X(y,y),Q(g,p,l),X(g,g),I(e,m,s,h,p,c),I(e,y,n,f,h,c),I(e,g,l,p,f,c)),void 0!==d[0]&&(J(p,d,r),X(p,p),J(h,d,i),X(h,h),J(f,d,o),X(f,f),Q(m,h,s),X(m,m),Q(y,f,n),X(y,y),Q(g,p,l),X(g,g),I(e,m,s,h,p,c),I(e,y,n,f,h,c),I(e,g,l,p,f,c))}(e,R,w,T,M,O,A,E,x),N(e,x.b0,x.b1,x.b2,F,D);const L=s.create();J(L,D,F),x.quality=W(L),x.quality<_?G(x.b0,x.b1,x.b2,F,D,L,t):C(l,c,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/DefaultBufferWriter":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/buffer/BufferView","../lib/RayIntersections","../lib/VertexAttribute","./internal/bufferWriterUtils"],(function(e,t,r,i,o,s,n){"use strict";const a=r.create();e.DefaultBufferWriter=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.get(s.VertexAttribute.POSITION).indices.length}write(e,t,r,i,o,s){return n.writeDefaultAttributes(r,i,this.vertexBufferLayout,e,t,o,s)}intersect(e,r,n,l,c,u,d){const p=this.vertexBufferLayout.createView(e).getField(s.VertexAttribute.POSITION,i.BufferViewVec3f);if(null==p)return;const h=t.sub(a,u,c),f=p.count/3,m=l.options.normalRequired;o.intersectRenderGeometryTriangles(c,h,0,f,p.typedBuffer,p.typedBufferStride,m,((e,t,r)=>{d(e,r,t)}))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],(function(e,t,r,i,o,s,n){"use strict";function a(e,t,r){const{data:i,indices:o}=e,s=t.typedBuffer,n=t.typedBufferStride,a=o.length;r*=n;for(let e=0;e<a;++e){const t=2*o[e];s[r]=i[t],s[r+1]=i[t+1],r+=n}}function l(e,t,r,i=1){const{data:o,indices:s}=e,n=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,1===i)for(let e=0;e<l;++e){const t=3*s[e];n[r]=o[t],n[r+1]=o[t+1],n[r+2]=o[t+2],r+=a}else for(let e=0;e<l;++e){const t=3*s[e];for(let e=0;e<i;++e)n[r]=o[t],n[r+1]=o[t+1],n[r+2]=o[t+2],r+=a}}function c(e,t,r,i=1){const{data:o,indices:s}=e,n=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,1===i)for(let e=0;e<l;++e){const t=4*s[e];n[r]=o[t],n[r+1]=o[t+1],n[r+2]=o[t+2],n[r+3]=o[t+3],r+=a}else for(let e=0;e<l;++e){const t=4*s[e];for(let e=0;e<i;++e)n[r]=o[t],n[r+1]=o[t+1],n[r+2]=o[t+2],n[r+3]=o[t+3],r+=a}}function u(e,t,r,o,s=1){if(!t)return void l(e,r,o,s);const{data:n,indices:a}=e,c=r.typedBuffer,u=r.typedBufferStride,d=a.length,p=t[0],h=t[1],f=t[2],m=t[4],y=t[5],g=t[6],b=t[8],v=t[9],S=t[10],_=t[12],x=t[13],w=t[14];o*=u;let T=0,M=0,I=0;const P=i.hasIdentityRotation(t)?e=>{T=n[e]+_,M=n[e+1]+x,I=n[e+2]+w}:e=>{const t=n[e],r=n[e+1],i=n[e+2];T=p*t+m*r+b*i+_,M=h*t+y*r+v*i+x,I=f*t+g*r+S*i+w};if(1===s)for(let e=0;e<d;++e)P(3*a[e]),c[o]=T,c[o+1]=M,c[o+2]=I,o+=u;else for(let e=0;e<d;++e){P(3*a[e]);for(let e=0;e<s;++e)c[o]=T,c[o+1]=M,c[o+2]=I,o+=u}}function d(e,t,r,o,s=1){if(!t)return void l(e,r,o,s);const{data:n,indices:a}=e,c=t,u=r.typedBuffer,d=r.typedBufferStride,p=a.length,h=c[0],f=c[1],m=c[2],y=c[4],g=c[5],b=c[6],v=c[8],S=c[9],_=c[10],x=!i.isOrthoNormal(c),w=1e-6,T=.999999;o*=d;let M=0,I=0,P=0;const O=i.hasIdentityRotation(c)?e=>{M=n[e],I=n[e+1],P=n[e+2]}:e=>{const t=n[e],r=n[e+1],i=n[e+2];M=h*t+y*r+v*i,I=f*t+g*r+S*i,P=m*t+b*r+_*i};if(1===s)if(x)for(let e=0;e<p;++e){O(3*a[e]);const t=M*M+I*I+P*P;if(t<T&&t>w){const e=1/Math.sqrt(t);u[o]=M*e,u[o+1]=I*e,u[o+2]=P*e}else u[o]=M,u[o+1]=I,u[o+2]=P;o+=d}else for(let e=0;e<p;++e)O(3*a[e]),u[o]=M,u[o+1]=I,u[o+2]=P,o+=d;else for(let e=0;e<p;++e){if(O(3*a[e]),x){const e=M*M+I*I+P*P;if(e<T&&e>w){const t=1/Math.sqrt(e);M*=t,I*=t,P*=t}}for(let e=0;e<s;++e)u[o]=M,u[o+1]=I,u[o+2]=P,o+=d}}function p(e,t,r,o,s=1){if(!t)return void c(e,r,o,s);const{data:n,indices:a}=e,l=t,u=r.typedBuffer,d=r.typedBufferStride,p=a.length,h=l[0],f=l[1],m=l[2],y=l[4],g=l[5],b=l[6],v=l[8],S=l[9],_=l[10],x=!i.isOrthoNormal(l),w=1e-6,T=.999999;if(o*=d,1===s)for(let e=0;e<p;++e){const t=4*a[e],r=n[t],i=n[t+1],s=n[t+2],l=n[t+3];let c=h*r+y*i+v*s,p=f*r+g*i+S*s,M=m*r+b*i+_*s;if(x){const e=c*c+p*p+M*M;if(e<T&&e>w){const t=1/Math.sqrt(e);c*=t,p*=t,M*=t}}u[o]=c,u[o+1]=p,u[o+2]=M,u[o+3]=l,o+=d}else for(let e=0;e<p;++e){const t=4*a[e],r=n[t],i=n[t+1],l=n[t+2],c=n[t+3];let p=h*r+y*i+v*l,M=f*r+g*i+S*l,I=m*r+b*i+_*l;if(x){const e=p*p+M*M+I*I;if(e<T&&e>w){const t=1/Math.sqrt(e);p*=t,M*=t,I*=t}}for(let e=0;e<s;++e)u[o]=p,u[o+1]=M,u[o+2]=I,u[o+3]=c,o+=d}}function h(e,t,r,i,o=1){const{data:s,indices:n}=e,a=r.typedBuffer,l=r.typedBufferStride,c=n.length;if(i*=l,t!==s.length||4!==t)if(1!==o)if(4!==t)for(let e=0;e<c;++e){const t=3*n[e];for(let e=0;e<o;++e)a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=255,i+=l}else for(let e=0;e<c;++e){const t=4*n[e];for(let e=0;e<o;++e)a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=s[t+3],i+=l}else{if(4===t){for(let e=0;e<c;++e){const t=4*n[e];a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=s[t+3],i+=l}return}for(let e=0;e<c;++e){const t=3*n[e];a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=255,i+=l}}else{a[i]=s[0],a[i+1]=s[1],a[i+2]=s[2],a[i+3]=s[3];const e=new Uint32Array(r.typedBuffer.buffer,r.start),t=l/4,n=e[i/=4];i+=t;const u=c*o;for(let r=1;r<u;++r)e[i]=n,i+=t}}function f(e,t,r){const{data:i,indices:o}=e,s=t.typedBuffer,n=t.typedBufferStride,a=o.length,l=i[0];r*=n;for(let e=0;e<a;++e)s[r]=l,r+=n}const m=r.create();function y(e,t,r,i,o=1){const s=t.typedBuffer,n=t.typedBufferStride;if(i*=n,1===o)for(let t=0;t<r;++t)s[i]=e[0],s[i+1]=e[1],s[i+2]=e[2],s[i+3]=e[3],i+=n;else for(let t=0;t<r;++t)for(let t=0;t<o;++t)s[i]=e[0],s[i+1]=e[1],s[i+2]=e[2],s[i+3]=e[3],i+=n}function g(e,t,r,i,m,y){switch(e){case n.VertexAttribute.POSITION:{s.assert(3===t.size);const i=m.getField(e,o.BufferViewVec3f);s.assert(!!i,`No buffer view for ${e}`),u(t,r,i,y);break}case n.VertexAttribute.NORMAL:{s.assert(3===t.size);const r=m.getField(e,o.BufferViewVec3f);s.assert(!!r,`No buffer view for ${e}`),d(t,i,r,y);break}case n.VertexAttribute.NORMALCOMPRESSED:case n.VertexAttribute.PROFILERIGHT:case n.VertexAttribute.PROFILEUP:{s.assert(2===t.size);const r=m.getField(e,o.BufferViewVec2i16);s.assert(!!r,`No buffer view for ${e}`),a(t,r,y);break}case n.VertexAttribute.UV0:{s.assert(2===t.size);const r=m.getField(e,o.BufferViewVec2f16)??m.getField(e,o.BufferViewVec2f);s.assert(!!r,`No buffer view for ${e}`),a(t,r,y);break}case n.VertexAttribute.UVI:{s.assert(2===t.size);const r=m.getField(e,o.BufferViewVec2i16);s.assert(!!r,`No buffer view for ${e}`),a(t,r,y);break}case n.VertexAttribute.COLOR:case n.VertexAttribute.SYMBOLCOLOR:{const r=m.getField(e,o.BufferViewVec4u8);s.assert(!!r,`No buffer view for ${e}`),s.assert(3===t.size||4===t.size),h(t,t.size,r,y);break}case n.VertexAttribute.COLORFEATUREATTRIBUTE:case n.VertexAttribute.OPACITYFEATUREATTRIBUTE:case n.VertexAttribute.SIZEFEATUREATTRIBUTE:{const r=m.getField(e,o.BufferViewFloat)??m.getField(e,o.BufferViewFloat);s.assert(!!r,`No buffer view for ${e}`),s.assert(1===t.size),f(t,r,y);break}case n.VertexAttribute.TANGENT:{s.assert(4===t.size);const i=m.getField(e,o.BufferViewVec4f);s.assert(!!i,`No buffer view for ${e}`),p(t,r,i,y);break}case n.VertexAttribute.PROFILEVERTEXANDNORMAL:{s.assert(4===t.size);const r=m.getField(e,o.BufferViewVec4f16)??m.getField(e,o.BufferViewVec4f);s.assert(!!r,`No buffer view for ${e}`),c(t,r,y);break}case n.VertexAttribute.PROFILEAUXDATA:{s.assert(3===t.size);const r=m.getField(e,o.BufferViewVec3f16)??m.getField(e,o.BufferViewVec3f);s.assert(!!r,`No buffer view for ${e}`),l(t,r,y);break}}}e.writeBufferFloat=function(e,t,r,i=1){const{data:o,indices:s}=e,n=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,1===i)for(let e=0;e<l;++e)n[r]=o[s[e]],r+=a;else for(let e=0;e<l;++e){const t=o[s[e]];for(let e=0;e<i;e++)n[r]=t,r+=a}},e.writeBufferMat3f=function(e,t,r){const{data:i,indices:o}=e,s=t.typedBuffer,n=t.typedBufferStride,a=o.length;r*=n;for(let e=0;e<a;++e){const t=9*o[e];for(let e=0;e<9;++e)s[r+e]=i[t+e];r+=n}},e.writeBufferMat4f=function(e,t,r){const{data:i,indices:o}=e,s=t.typedBuffer,n=t.typedBufferStride,a=o.length;r*=n;for(let e=0;e<a;++e){const t=16*o[e];for(let e=0;e<16;++e)s[r+e]=i[t+e];r+=n}},e.writeBufferVec2=a,e.writeBufferVec3=l,e.writeBufferVec4=c,e.writeBufferVec4Zeros=function(e,t,r){const i=e.typedBuffer,o=e.typedBufferStride;t*=o;for(let e=0;e<r;++e)i[t]=0,i[t+1]=0,i[t+2]=0,i[t+3]=0,t+=o},e.writeColor=h,e.writeDefaultAttribute=g,e.writeDefaultAttributes=function(e,t,r,i,s,a,l){let c={numItems:0,numVerticesPerItem:0};for(const u of r.fields.keys()){const r=e.get(u),d=r?.indices;if(r&&d)u===n.VertexAttribute.POSITION&&(c={numItems:1,numVerticesPerItem:d.length}),g(u,r,i,s,a,l);else if(u===n.VertexAttribute.OLIDCOLOR&&null!=t){const r=e.get(n.VertexAttribute.POSITION)?.indices;if(r){const e=r.length;y(t,a.getField(u,o.BufferViewVec4u8),e,l)}}}return c},e.writeDeltaF16Vector=function(e,r,i,o){t.subtract(m,e,r);const s=Math.max(Math.sqrt(t.length(m)),1e-4);t.scale(m,m,1/s),i[o++]=m[0],i[o++]=m[1],i[o++]=m[2],i[o++]=s},e.writeNormal=d,e.writeOlidColor=y,e.writePosition=u,e.writeTangent=p,e.writeVVFeatureAttribute=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../symbols/support/materialUtils","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/attributes/NormalAttribute.glsl","../core/shaderLibrary/attributes/VertexNormal.glsl","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../lib/basicInterfaces","../lib/Material","../lib/OrderIndependentTransparency","../lib/StencilUtils","../materials/pbrUtils","../../../../chunks/DefaultMaterial.glsl","../../../webgl/enums","../../../webgl/renderState","../../../../webscene/support/AlphaCutoff"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b){"use strict";class v extends a.VertexNormalPassParameters{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=f.advancedMRRFactors,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=u.CullFaceOptions.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveStrength=0,this.emissiveSource=o.EmissiveSourceMode.Color,this.emissiveBaseColor=r.ZEROS,this.instancedDoublePrecision=!1,this.normalType=n.NormalType.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=r.freeze(.2,.2,.2),this.diffuse=r.freeze(.8,.8,.8),this.externalColor=i.fromValues(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=r.create(),this.hasSlicePlane=!1,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.drivenOpacity=!1,this.writeDepth=!0,this.customDepthTest=u.DepthTestFunction.Less,this.textureAlphaMode=u.AlphaDiscardMode.Blend,this.textureAlphaCutoff=b.alphaCutoff,this.textureAlphaPremultiplied=!1,this.renderOccluded=d.RenderOccludedFlag.Occlude,this.isDecoration=!1}}class S extends a.VertexNormalDrawParameters{constructor(){super(...arguments),this.origin=r.create(),this.slicePlaneLocalOrigin=this.origin}}class _ extends c.ShaderTechnique{constructor(t,r,i=new l.ReloadableShaderModule(m.DefaultMaterial,(()=>new Promise(((t,r)=>e(["./DefaultMaterial.glsl"],t,r)))))){super(t,r,i),this.type="DefaultMaterialTechnique"}_makePipeline(e,t){const{oitPass:r,output:i,transparent:o,cullFace:n,customDepthTest:a,hasOccludees:l}=e;return g.makePipelineState({blending:s.isColorOrColorEmission(i)&&o?p.blending(r):null,culling:(d=e,d.cullFace===u.CullFaceOptions.None&&(d.hasSlicePlane||d.transparent||d.doubleSidedMode)?null:g.cullingParams(n)),depthTest:{func:p.oitDepthTest(r,(f=a,f===u.DepthTestFunction.Lequal?y.CompareFunction.LEQUAL:y.CompareFunction.LESS))},depthWrite:p.depthWrite(e),drawBuffers:c.depthOnlyOutputBuffersOr(i,p.getDrawBuffers(r,i)),colorWrite:g.defaultColorWrite,stencilWrite:l?h.stencilWriteMaskOn:null,stencilTest:l?t?h.stencilToolMaskBaseParams:h.stencilBaseAllZerosParams:null,polygonOffset:p.oitPolygonOffset(e)});var d,f}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}t.DefaultMaterialDrawParameters=S,t.DefaultMaterialPassParameters=v,t.DefaultMaterialTechnique=_,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","./NormalAttribute.glsl","./VertexPosition.glsl","../../shaderModules/glsl","../../shaderModules/Matrix3DrawUniform","../../shaderModules/Matrix3PassUniform"],(function(e,t,r,i,o,s,n,a,l){"use strict";class c extends s.VertexPositionPassParameters{constructor(){super(...arguments),this.transformNormalViewFromGlobal=r.create()}}class u extends s.VertexPositionDrawParameters{constructor(){super(...arguments),this.transformNormalGlobalFromModel=r.create(),this.toMapSpace=i.create()}}e.VertexNormal=function(e,r){switch(r.normalType){case o.NormalType.Attribute:case o.NormalType.Compressed:e.include(o.NormalAttribute,r),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add(new a.Matrix3DrawUniform("transformNormalGlobalFromModel",(e=>e.transformNormalGlobalFromModel)),new l.Matrix3PassUniform("transformNormalViewFromGlobal",(e=>e.transformNormalViewFromGlobal))),e.vertex.code.add(n.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case o.NormalType.ScreenDerivative:e.vertex.code.add(n.glsl`void forwardNormal() {}`);break;default:t.neverReached(r.normalType);case o.NormalType.COUNT:}},e.VertexNormalDrawParameters=u,e.VertexNormalPassParameters=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../util/DoublePrecision.glsl","../../shaderModules/Float3DrawUniform","../../shaderModules/Float3PassUniform","../../shaderModules/glsl","../../shaderModules/Matrix3DrawUniform","../../shaderModules/Matrix3PassUniform","../../shaderModules/Matrix4PassUniform","../../../lib/VertexAttribute","../../../../../webgl/NoParameters"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";class h extends p.NoParameters{constructor(){super(...arguments),this.transformWorldFromViewTH=i.create(),this.transformWorldFromViewTL=i.create(),this.transformViewFromCameraRelativeRS=t.create(),this.transformProjFromView=r.create()}}class f extends p.NoParameters{constructor(){super(...arguments),this.transformWorldFromModelRS=t.create(),this.transformWorldFromModelTH=i.create(),this.transformWorldFromModelTL=i.create()}}e.VertexPosition=function(e,t){const{attributes:r,vertex:i,varyings:p,fragment:h}=e;i.include(o.DoublePrecision,t),r.add(d.VertexAttribute.POSITION,"vec3"),p.add("vPositionWorldCameraRelative","vec3"),p.add("vPosition_view","vec3",{invariant:!0}),i.uniforms.add(new n.Float3PassUniform("transformWorldFromViewTH",(e=>e.transformWorldFromViewTH)),new n.Float3PassUniform("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL)),new c.Matrix3PassUniform("transformViewFromCameraRelativeRS",(e=>e.transformViewFromCameraRelativeRS)),new u.Matrix4PassUniform("transformProjFromView",(e=>e.transformProjFromView)),new l.Matrix3DrawUniform("transformWorldFromModelRS",(e=>e.transformWorldFromModelRS)),new s.Float3DrawUniform("transformWorldFromModelTH",(e=>e.transformWorldFromModelTH)),new s.Float3DrawUniform("transformWorldFromModelTL",(e=>e.transformWorldFromModelTL))),i.code.add(a.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(a.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?a.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:a.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),h.uniforms.add(new n.Float3PassUniform("transformWorldFromViewTL",(e=>e.transformWorldFromViewTL))),i.code.add(a.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),h.code.add(a.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)},e.VertexPositionDrawParameters=f,e.VertexPositionPassParameters=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../shaderModules/FloatBindUniform","../../shaderModules/glsl"],(function(e,t,r){"use strict";e.DoublePrecision=function({code:e,uniforms:i},o){i.add(new t.FloatBindUniform("dpDummy",(()=>1))),e.add(r.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 hiD = hiA + hiB;
vec3 loD = loA + loB;
return  dpDummy * hiD + loD;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/FloatBindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"float",t.BindType.Bind,((t,i)=>t.setUniform1f(e,r(i))))}}e.FloatBindUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"mat3",t.BindType.Draw,((t,i,o)=>t.setUniformMatrix3fv(e,r(i,o))))}}e.Matrix3DrawUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"mat3",t.BindType.Pass,((t,i,o)=>t.setUniformMatrix3fv(e,r(i,o))))}}e.Matrix3PassUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"mat4",t.BindType.Pass,((t,i,o)=>t.setUniformMatrix4fv(e,r(i,o))))}}e.Matrix4PassUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports"],(function(e){"use strict";e.ReloadableShaderModule=class{constructor(e,t){this._module=e,this._load=t}get(){return this._module}async reload(){return this._module=await this._load(),this._module}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../core/Logger","../../../../../core/maybe","../shaderLibrary/ShaderOutput","../../lib/DefaultVertexAttributeLocations","../../lib/Program","../../../../webgl/enums","../../../../webgl/renderState"],(function(e,t,r,i,o,s,n,a){"use strict";e.ShaderTechnique=class{constructor(e,i,a,l=o.Default3D){this.locations=l,this.primitiveType=n.PrimitiveType.TRIANGLES,this.key=i.key,this._program=new s.Program(e.rctx,a.get().build(i),l),this._pipeline=this.initializePipeline(i),this.reload=async o=>{o&&await a.reload(),this.key.equals(i.key)||t.getLogger("esri.views.3d.webgl.ShaderTechnique").warn("Configuration was changed after construction, cannot reload shader.",a),r.disposeMaybe(this._program),this._program=new s.Program(e.rctx,a.get().build(i),l),this._pipeline=this.initializePipeline(i)}}destroy(){this._program=r.disposeMaybe(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,t){return this._pipeline}initializePipeline(e){return a.makePipelineState({blending:a.premultipliedAlpha,colorWrite:a.defaultColorWrite})}},e.depthOnlyOutputBuffersOr=function(e,t){return i.isDepthOnlyOutput(e)?{buffers:[n.SpecialDrawBuffers.NONE]}:t??null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/Program":function(){define(["exports","../../../../core/has","../../../webgl/checkWebGLError"],(function(e,t,r){"use strict";e.Program=class{constructor(e,t,r){this._context=e,this._locations=r,this._textures=new Map,this._glProgram=e.programCache.acquire(t.generate("vertex",!0),t.generate("fragment",!0),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bind=t.generateBind(this),this.bindPass=t.generateBindPass(this),this.bindDraw=t.generateBindDraw(this)}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform2iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear()}bindTexture(e,t){t?.glName||(r.webglDebugEnabled()&&console.error(`Texture sampler ${e} has no given Texture in ${(new Error).stack} `),t=this._context.emptyTexture);const i=this._ensureTextureUnit(e,t);this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(t,i.unit)}_ensureTextureUnit(e,t){let r=this._textures.get(e);return null==r?(r={texture:t,unit:this._textures.size},this._textures.set(e,r)):r.texture=t,r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],(function(e,t,r){"use strict";const i={func:r.CompareFunction.LESS},o={func:r.CompareFunction.ALWAYS},s={function:{func:r.CompareFunction.ALWAYS,ref:t.StencilBits.OutlineVisualElementMask,mask:t.StencilBits.OutlineVisualElementMask},operation:{fail:r.StencilOperation.KEEP,zFail:r.StencilOperation.KEEP,zPass:r.StencilOperation.ZERO}},n={function:{func:r.CompareFunction.ALWAYS,ref:t.StencilBits.OutlineVisualElementMask,mask:t.StencilBits.OutlineVisualElementMask},operation:{fail:r.StencilOperation.KEEP,zFail:r.StencilOperation.KEEP,zPass:r.StencilOperation.REPLACE}},a={function:{func:r.CompareFunction.EQUAL,ref:t.StencilBits.OutlineVisualElementMask,mask:t.StencilBits.OutlineVisualElementMask},operation:{fail:r.StencilOperation.KEEP,zFail:r.StencilOperation.KEEP,zPass:r.StencilOperation.KEEP}},l={function:{func:r.CompareFunction.NOTEQUAL,ref:t.StencilBits.OutlineVisualElementMask,mask:t.StencilBits.OutlineVisualElementMask},operation:{fail:r.StencilOperation.KEEP,zFail:r.StencilOperation.KEEP,zPass:r.StencilOperation.KEEP}};e.depthCompareAlways=o,e.depthCompareLess=i,e.renderWhenBitIsNotSet=e=>({function:{func:r.CompareFunction.NOTEQUAL,ref:e,mask:e},operation:{fail:r.StencilOperation.KEEP,zFail:r.StencilOperation.KEEP,zPass:r.StencilOperation.KEEP}}),e.replaceBitWhenDepthTestPasses=e=>({function:{func:r.CompareFunction.ALWAYS,ref:e,mask:e},operation:{fail:r.StencilOperation.KEEP,zFail:r.StencilOperation.KEEP,zPass:r.StencilOperation.REPLACE}}),e.stencilBaseAllZerosParams=s,e.stencilToolMaskBaseParams=n,e.stencilToolMaskOccluderParams=a,e.stencilToolTransparentOccluderParams=l,e.stencilWriteMaskOff={mask:0},e.stencilWriteMaskOn={mask:255},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/DefaultMaterial.glsl":function(){define(["exports","../core/libs/gl-matrix-2/factories/vec4f64","../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl","../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl","../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput","../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl","../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl","../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlpha.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl","../views/3d/webgl-engine/core/shaderModules/Float3PassUniform","../views/3d/webgl-engine/core/shaderModules/Float4PassUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform","../views/3d/webgl-engine/effects/weather/SnowCover.glsl","../views/3d/webgl-engine/lib/VertexAttribute","../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl","../views/webgl/ShaderBuilder","../webscene/support/AlphaCutoff"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x,w,T,M,I,P,O,C,A,E,R,F,D,L,V,N,B){"use strict";function U(e){const U=new N.ShaderBuilder,{attributes:z,vertex:j,fragment:k,varyings:G}=U,{output:q,normalType:H,offsetBackfaces:W,instancedColor:$,spherical:J,receiveShadows:Y,snowCover:Z,pbrMode:Q,textureAlphaPremultiplied:X,instancedDoublePrecision:K,hasVertexColors:ee,hasVertexTangents:te,hasColorTexture:re,hasNormalTexture:ie,hasNormalTextureTransform:oe,hasColorTextureTransform:se,hasBloom:ne}=e;if(O.addProjViewLocalOrigin(j,e),z.add(L.VertexAttribute.POSITION,"vec3"),G.add("vpos","vec3",{invariant:!0}),U.include(M.VisualVariables,e),U.include(a.InstancedDoublePrecision,e),U.include(h.VerticalOffset,e),U.include(T.colorTextureUV,e),!o.isColorOrColorEmission(q))return U.include(f.DefaultMaterialAuxiliaryPasses,e),U;U.include(T.normalTextureUV,e),U.include(T.emissiveTextureUV,e),U.include(T.occlusionTextureUV,e),U.include(T.metallicRoughnessTextureUV,e),O.addCameraPosition(j,e),U.include(l.NormalAttribute,e),U.include(n.Transform,e);const ae=H===l.NormalType.Attribute||H===l.NormalType.Compressed;return ae&&W&&U.include(i.Offset),U.include(m.ComputeNormalTexture,e),U.include(p.VertexNormal,e),$&&U.attributes.add(L.VertexAttribute.INSTANCECOLOR,"vec4"),G.add("vPositionLocal","vec3"),U.include(u.TextureCoordinateAttribute,e),U.include(r.ForwardLinearDepth,e),U.include(c.SymbolColor,e),U.include(d.VertexColor,e),j.uniforms.add(new A.Float4PassUniform("externalColor",(e=>"ignore"===e.colorMixMode?t.ONES:e.externalColor))),G.add("vcolorExt","vec4"),U.include(w.terrainDepthTest,e),j.main.add(R.glsl`
    forwardNormalizedVertexColor();
    vcolorExt = externalColor;
    ${R.If($,"vcolorExt *= instanceColor * 0.003921568627451;")}
    vcolorExt *= vvColor();
    vcolorExt *= getSymbolColor();
    forwardColorMixMode();

    vpos = getVertexInLocalOriginSpace();
    vPositionLocal = vpos - view[3].xyz;
    vpos = subtractOrigin(vpos);
    ${R.If(ae,"vNormalWorld = dpNormal(vvLocalNormal(normalModel()));")}
    vpos = addVerticalOffset(vpos, localOrigin);
    ${R.If(te,"vTangent = dpTransformVertexTangent(tangent);")}
    gl_Position = transformPosition(proj, view, vpos);
    ${R.If(ae&&W,"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}

    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    forwardLinearDepth();
    forwardTextureCoordinates();
    forwardColorUV();
    forwardNormalUV();
    forwardEmissiveUV();
    forwardOcclusionUV();
    forwardMetallicRoughnessUV();

    if (vcolorExt.a < ${R.glsl.float(B.alphaCutoff)}) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
    }
  `),U.include(g.EvaluateSceneLighting,e),k.include(y.EvaluateAmbientOcclusion,e),U.include(I.DiscardOrAdjustAlphaPass,e),U.include(K?x.ReadShadowMapPass:x.ReadShadowMapDraw,e),k.include(s.SliceDraw,e),U.include(V.outputColorHighlightOID,e),O.addCameraPosition(k,e),k.uniforms.add(j.uniforms.get("localOrigin"),new C.Float3PassUniform("ambient",(e=>e.ambient)),new C.Float3PassUniform("diffuse",(e=>e.diffuse)),new E.FloatPassUniform("opacity",(e=>e.opacity)),new E.FloatPassUniform("layerOpacity",(e=>e.layerOpacity))),re&&k.uniforms.add(new F.Texture2DPassUniform("tex",(e=>e.texture))),U.include(_.PhysicallyBasedRenderingParameters,e),k.include(S.PhysicallyBasedRendering,e),k.include(P.MixExternalColor),U.include(v.Normals,e),k.include(D.SnowCover,e),g.addAmbientBoostFactor(k),g.addLightingGlobalFactor(k),b.addMainLightIntensity(k),k.main.add(R.glsl`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${re?R.glsl`
            vec4 texColor = texture(tex, ${se?"colorUV":"vuv0"});
            ${R.If(X,"texColor.rgb /= texColor.a;")}
            discardOrAdjustAlpha(texColor);`:R.glsl`vec4 texColor = vec4(1.0);`}
    shadingParams.viewDirection = normalize(vpos - cameraPosition);
    ${H===l.NormalType.ScreenDerivative?R.glsl`vec3 normal = screenDerivativeNormal(vPositionLocal);`:R.glsl`shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
    applyPBRFactors();
    float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

    vec3 posWorld = vpos + localOrigin;

      float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
      float shadow = ${Y?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":R.If(J,"lightingGlobalFactor * (1.0 - additionalAmbientScale)","0.0")};

    vec3 matColor = max(ambient, diffuse);
    vec3 albedo = mixExternalColor(${R.If(ee,"vColor.rgb *")} matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
    float opacity_ = layerOpacity * mixExternalOpacity(${R.If(ee,"vColor.a * ")} opacity, texColor.a, vcolorExt.a, int(colorMixMode));
    ${ie?`mat3 tangentSpace = computeTangentSpace(${te?"normal":"normal, vpos, vuv0"});\n            vec3 shadingNormal = computeTextureNormal(tangentSpace, ${oe?"normalUV":"vuv0"});`:"vec3 shadingNormal = normal;"}
    vec3 normalGround = ${J?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

    ${R.If(Z,R.glsl`
          float snow = getSnow(normal, normalGround);
          albedo = mix(albedo, vec3(1), snow);
          shadingNormal = mix(shadingNormal, normal, snow);
          ssao = mix(ssao, 1.0, snow);`)}

    vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

    ${Q===_.PBRMode.Normal||Q===_.PBRMode.Schematic?R.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
            vec4 emission = ${ne?"vec4(0.0)":"getEmissions(albedo)"};
            ${R.If(Z,"mrr = applySnowToMRR(mrr, snow);\n                 emission = snowCoverForEmissions(emission, snow);")}
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:R.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
    vec4 finalColor = vec4(shadedColor, opacity_);
    outputColorHighlightOID(finalColor, vpos, albedo ${R.If(Z,", snow")});
  `),U}const z=Object.freeze(Object.defineProperty({__proto__:null,build:U},Symbol.toStringTag,{value:"Module"}));e.DefaultMaterial=z,e.build=U}))},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutput","./attributes/VertexPosition.glsl","../shaderModules/Float2BindUniform","../shaderModules/glsl"],(function(e,t,r,i,o){"use strict";function s(e){e.varyings.add("linearDepth","float",{invariant:!0})}function n(e){e.vertex.uniforms.add(new i.Float2BindUniform("nearFar",(e=>e.camera.nearFar)))}function a(e){e.vertex.code.add(o.glsl`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}e.ForwardLinearDepth=function(e,i){const{vertex:l}=e;switch(i.output){case t.ShaderOutput.Color:case t.ShaderOutput.ColorEmission:if(i.receiveShadows)return s(e),void l.code.add(o.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case t.ShaderOutput.Shadow:case t.ShaderOutput.ShadowHighlight:case t.ShaderOutput.ShadowExcludeHighlight:case t.ShaderOutput.ViewshedShadow:return e.include(r.VertexPosition,i),s(e),n(e),a(e),void l.code.add(o.glsl`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}l.code.add(o.glsl`void forwardLinearDepth() {}`)},e.addCalculateLinearDepth=a,e.addLinearDepth=s,e.addNearFar=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float2BindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"vec2",t.BindType.Bind,((t,i)=>t.setUniform2fv(e,r(i))))}}e.Float2BindUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/glsl"],(function(e,t){"use strict";e.Offset=function(e){e.vertex.code.add(t.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define(["exports","../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../shaderModules/Float3DrawUniform","../shaderModules/Float3PassUniform","../shaderModules/glsl","../../../../webgl/NoParameters"],(function(e,t,r,i,o,s,n,a,l){"use strict";class c extends l.NoParameters{constructor(e){super(),this.slicePlaneLocalOrigin=e}}const u=a.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
bool rejectBySlice(vec3 pos) {
return sliceByPlane(pos);
}`;function d(e,t,...r){t.hasSlicePlane?(e.uniforms.add(...r),e.code.add(u)):e.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function p(e,t,...r){d(e,t,...r),t.hasSlicePlane?e.code.add("\n    void discardBySlice(vec3 pos) {\n      if (sliceByPlane(pos)) {\n        discard;\n      }\n    }\n\n    vec4 applySliceOutline(vec4 color, vec3 pos) {\n      SliceFactors factors = calculateSliceFactors(pos);\n\n      factors.front /= 2.0 * fwidth(factors.front);\n      factors.side0 /= 2.0 * fwidth(factors.side0);\n      factors.side1 /= 2.0 * fwidth(factors.side1);\n      factors.side2 /= 2.0 * fwidth(factors.side2);\n      factors.side3 /= 2.0 * fwidth(factors.side3);\n\n      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth\n      if (sliceByFactors(factors)) {\n        return color;\n      }\n\n      float outlineFactor = (1.0 - step(0.5, factors.front))\n        * (1.0 - step(0.5, factors.side0))\n        * (1.0 - step(0.5, factors.side1))\n        * (1.0 - step(0.5, factors.side2))\n        * (1.0 - step(0.5, factors.side3));\n\n      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);\n    }\n\n    vec4 applySlice(vec4 color, vec3 pos) {\n      return sliceEnabled() ? applySliceOutline(color, pos) : color;\n    }\n  "):e.code.add(a.glsl`void discardBySlice(vec3 pos) { }
vec4 applySlice(vec4 color, vec3 pos) { return color; }`)}function h(e,t,r){return e.instancedDoublePrecision?i.set(b,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function f(e,t){return null!=e?i.subtract(v,t.origin,e):t.origin}function m(e,r,i){return e.hasSliceTranslatedView?null!=r?t.translate(_,i.camera.viewMatrix,r):i.camera.viewMatrix:null}function y(e,t,r){if(null==r.slicePlane)return o.ZEROS;const s=h(e,t,r),n=f(s,r.slicePlane),a=m(e,s,r);return null!=a?i.transformMat4(v,n,a):n}function g(e,t,r,s){if(null==s||null==r.slicePlane)return o.ZEROS;const n=h(e,t,r),a=f(n,r.slicePlane),l=m(e,n,r);return null!=l?(i.add(S,s,a),i.transformMat4(v,a,l),i.transformMat4(S,S,l),i.subtract(S,S,v)):s}const b=o.create(),v=o.create(),S=o.create(),_=r.create();e.RejectBySlice=function(e,t){d(e,t,new s.Float3DrawUniform("slicePlaneOrigin",((e,r)=>y(t,e,r))),new s.Float3DrawUniform("slicePlaneBasis1",((e,r)=>g(t,e,r,r.slicePlane?.basis1))),new s.Float3DrawUniform("slicePlaneBasis2",((e,r)=>g(t,e,r,r.slicePlane?.basis2))))},e.SliceDraw=function(e,t){p(e,t,new s.Float3DrawUniform("slicePlaneOrigin",((e,r)=>y(t,e,r))),new s.Float3DrawUniform("slicePlaneBasis1",((e,r)=>g(t,e,r,r.slicePlane?.basis1))),new s.Float3DrawUniform("slicePlaneBasis2",((e,r)=>g(t,e,r,r.slicePlane?.basis2))))},e.SlicePass=function(e,t){p(e,t,new n.Float3PassUniform("slicePlaneOrigin",((e,r)=>y(t,e,r))),new n.Float3PassUniform("slicePlaneBasis1",((e,r)=>g(t,e,r,r.slicePlane?.basis1))),new n.Float3PassUniform("slicePlaneBasis2",((e,r)=>g(t,e,r,r.slicePlane?.basis2))))},e.SlicePlaneParameters=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","./ForwardLinearDepth.glsl","../shaderModules/glsl"],(function(e,t,r){"use strict";e.Transform=function(e){t.addCalculateLinearDepth(e),e.vertex.code.add(r.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(r.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/mat3","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../ShaderOutput","../util/DoublePrecision.glsl","../util/View.glsl","../../shaderModules/Float3BindUniform","../../shaderModules/glsl","../../shaderModules/Matrix3PassUniform","../../shaderModules/Matrix4PassUniform","../../../lib/VertexAttribute","../../../../../webgl/doublePrecisionUtils","../../../../../webgl/NoParameters"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";class y extends m.NoParameters{constructor(){super(...arguments),this.modelTransformation=null}}const g=r.create(),b=s.create();e.InstancedDoublePassParameters=y,e.InstancedDoublePrecision=function(e,r){const{hasModelTransformation:s,instancedDoublePrecision:m,instanced:y,output:v,hasVertexTangents:S}=r;s&&(e.vertex.uniforms.add(new p.Matrix4PassUniform("model",(e=>e.modelTransformation??i.IDENTITY))),e.vertex.uniforms.add(new d.Matrix3PassUniform("normalLocalOriginFromModel",(e=>(t.normalFromMat4(g,e.modelTransformation??i.IDENTITY),g))))),y&&m&&(e.attributes.add(h.VertexAttribute.INSTANCEMODELORIGINHI,"vec3"),e.attributes.add(h.VertexAttribute.INSTANCEMODELORIGINLO,"vec3"),e.attributes.add(h.VertexAttribute.INSTANCEMODEL,"mat3"),e.attributes.add(h.VertexAttribute.INSTANCEMODELNORMAL,"mat3"));const _=e.vertex;m&&(_.include(a.DoublePrecision,r),_.uniforms.add(new c.Float3BindUniform("viewOriginHi",(e=>f.encodeDoubleHi(o.set(b,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]),b))),new c.Float3BindUniform("viewOriginLo",(e=>f.encodeDoubleLo(o.set(b,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]),b))))),_.code.add(u.glsl`
    vec3 getVertexInLocalOriginSpace() {
      return ${s?m?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":m?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${m?u.glsl`
          // Issue: (should be resolved now with invariant position) https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -instanceModelOriginHi, -instanceModelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),_.code.add(u.glsl`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${s?m?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":m?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),v===n.ShaderOutput.Normal&&(l.addViewNormal(_),_.code.add(u.glsl`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${s?m?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":m?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),S&&_.code.add(u.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${s?m?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":m?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../shaderModules/Float3BindUniform","../../shaderModules/Float3DrawUniform","../../shaderModules/FloatBindUniform","../../shaderModules/Matrix4BindUniform","../../shaderModules/Matrix4DrawUniform"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=r.create(),d=o.create();e.addCameraPosition=function(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",o.ZEROS):e.uniforms.add(new n.Float3DrawUniform("cameraPosition",((e,t)=>i.set(d,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2]))))},e.addPixelRatio=function(e){e.uniforms.add(new a.FloatBindUniform("pixelRatio",(e=>e.camera.pixelRatio/e.overlayStretch)))},e.addProjViewLocalOrigin=function(e,r){if(!r.instancedDoublePrecision)return void e.uniforms.add(new l.Matrix4BindUniform("proj",(e=>e.camera.projectionMatrix)),new c.Matrix4DrawUniform("view",((e,r)=>t.translate(u,r.camera.viewMatrix,e.origin))),new n.Float3DrawUniform("localOrigin",(e=>e.origin)));const o=({camera:e})=>i.set(d,e.viewInverseTransposeMatrix[3],e.viewInverseTransposeMatrix[7],e.viewInverseTransposeMatrix[11]);e.uniforms.add(new l.Matrix4BindUniform("proj",(e=>e.camera.projectionMatrix)),new l.Matrix4BindUniform("view",(e=>t.translate(u,e.camera.viewMatrix,o(e)))),new s.Float3BindUniform("localOrigin",(e=>o(e))))},e.addViewNormal=function(e){e.uniforms.add(new l.Matrix4BindUniform("viewNormal",(e=>e.camera.viewInverseTransposeMatrix)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float3BindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"vec3",t.BindType.Bind,((t,i)=>t.setUniform3fv(e,r(i))))}}e.Float3BindUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4BindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"mat4",t.BindType.Bind,((t,i)=>t.setUniformMatrix4fv(e,r(i))))}}e.Matrix4BindUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"mat4",t.BindType.Draw,((t,i,o)=>t.setUniformMatrix4fv(e,r(i,o))))}}e.Matrix4DrawUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],(function(e){"use strict";const t=new Float32Array(2);e.decodeDoubleArray=function(e,t,r){for(let i=0;i<r;++i)t[i]=e[2*i]+e[2*i+1]},e.encodeDoubleArray=function(e,t,r){for(let i=0;i<r;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]},e.encodeDoubleHi=function(e,r){const i=e.length;for(let o=0;o<i;++o)t[0]=e[o],r[o]=t[0];return r},e.encodeDoubleLo=function(e,r){const i=e.length;for(let o=0;o<i;++o)t[0]=e[o],t[1]=e[o]-t[0],r[o]=t[1];return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["exports","../../../collections/Component/Material/shader/DecodeSymbolColor.glsl","../../shaderModules/glsl","../../shaderModules/IntegerPassUniform","../../../lib/VertexAttribute","../../../materials/internal/MaterialUtil"],(function(e,t,r,i,o,s){"use strict";e.SymbolColor=function(e,n){n.hasSymbolColors?(e.include(t.DecodeSymbolColor),e.attributes.add(o.VertexAttribute.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(r.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new i.IntegerPassUniform("colorMixMode",(e=>s.colorMixModes[e.colorMixMode]))),e.vertex.code.add(r.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/glsl"],(function(e,t,r){"use strict";e.DecodeSymbolColor=function(e){e.vertex.code.add(r.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${r.glsl.int(t.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${r.glsl.int(t.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${r.glsl.int(t.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${r.glsl.int(t.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils"],(function(e,t){"use strict";var r;e.ColorMixModeEnum=void 0,(r=e.ColorMixModeEnum||(e.ColorMixModeEnum={}))[r.Multiply=1]="Multiply",r[r.Ignore=2]="Ignore",r[r.Replace=3]="Replace",r[r.Tint=4]="Tint";const i=255;e.encodeSymbolColor=function(r,o,s){if(null==r||o===e.ColorMixModeEnum.Ignore)return s[0]=255,s[1]=255,s[2]=255,void(s[3]=255);const n=t.clamp(Math.round(85*r[3]),0,85),a=0===n||o===e.ColorMixModeEnum.Tint?0:o===e.ColorMixModeEnum.Replace?85:170;s[0]=t.clamp(Math.round(r[0]*i),0,i),s[1]=t.clamp(Math.round(r[1]*i),0,i),s[2]=t.clamp(Math.round(r[2]*i),0,i),s[3]=n+a},e.parseColorMixMode=function(t){switch(t){case"multiply":default:return e.ColorMixModeEnum.Multiply;case"ignore":return e.ColorMixModeEnum.Ignore;case"replace":return e.ColorMixModeEnum.Replace;case"tint":return e.ColorMixModeEnum.Tint}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"int",t.BindType.Pass,((t,i,o)=>t.setUniform1i(e,r(i,o))))}}e.IntegerPassUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/glsl","../../../lib/VertexAttribute"],(function(e,t,r){"use strict";e.VertexColor=function(e,i){i.hasVertexColors?(e.attributes.add(r.VertexAttribute.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(t.glsl`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(t.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(t.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["exports","../../../../../../chunks/vec42","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","../util/ScreenSizePerspective.glsl","../util/View.glsl","../../shaderModules/Float4PassUniform","../../shaderModules/glsl"],(function(e,t,r,i,o,s,n){"use strict";const a=r.create();function l(e){e.uniforms.add(new s.Float4PassUniform("verticalOffset",((e,r)=>{const{minWorldLength:i,maxWorldLength:o,screenLength:s}=e.verticalOffset,n=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),l=r.camera.pixelRatio||1;return t.set(a,s*l,n,i,o)})))}e.VerticalOffset=function(e,t){const r=e.vertex;t.hasVerticalOffset?(l(r),t.hasScreenSizePerspective&&(e.include(i.ScreenSizePerspective),i.addScreenSizePerspectiveAlignment(r),o.addCameraPosition(e.vertex,t)),r.code.add(n.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?n.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:n.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?n.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:n.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(n.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)},e.addVerticalOffset=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../shaderModules/Float3PassUniform","../../shaderModules/glsl"],(function(e,t,r,i,o){"use strict";function s(e){return t.set(n,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const n=r.create();e.ScreenSizePerspective=function(e){e.vertex.code.add(o.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(o.glsl`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(o.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(o.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)},e.addScreenSizePerspective=function(e){e.uniforms.add(new i.Float3PassUniform("screenSizePerspective",(e=>s(e.screenSizePerspective))))},e.addScreenSizePerspectiveAlignment=function(e){e.uniforms.add(new i.Float3PassUniform("screenSizePerspectiveAlignment",(e=>s(e.screenSizePerspectiveAlignment||e.screenSizePerspective))))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"vec4",t.BindType.Pass,((t,i,o)=>t.setUniform4fv(e,r(i,o))))}}e.Float4PassUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define(["exports","../ForwardLinearDepth.glsl","../ShaderOutput","../Slice.glsl","../Transform.glsl","../attributes/NormalAttribute.glsl","../attributes/ObjectAndLayerIdColor.glsl","../attributes/TextureCoordinateAttribute.glsl","../attributes/VertexNormal.glsl","../output/OutputDepth.glsl","../output/OutputHighlight.glsl","../shading/VisualVariables.glsl","../util/DiscardOrAdjustAlpha.glsl","../util/View.glsl","../../shaderModules/glsl","../../shaderModules/Texture2DPassUniform","../../../lib/basicInterfaces"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";e.DefaultMaterialAuxiliaryPasses=function(e,g){const{vertex:b,fragment:v,varyings:S}=e,{hasColorTexture:_,alphaDiscardMode:x}=g,w=_&&x!==y.AlphaDiscardMode.Opaque,{output:T,normalType:M,hasColorTextureTransform:I}=g;switch(T){case r.ShaderOutput.Depth:h.addProjViewLocalOrigin(b,g),e.include(o.Transform,g),v.include(i.SliceDraw,g),e.include(a.TextureCoordinateAttribute,g),w&&v.uniforms.add(new m.Texture2DPassUniform("tex",(e=>e.texture))),b.main.add(f.glsl`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),e.include(p.DiscardOrAdjustAlphaPass,g),v.main.add(f.glsl`
        discardBySlice(vpos);
        ${f.If(w,f.glsl`vec4 texColor = texture(tex, ${I?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}`);break;case r.ShaderOutput.Shadow:case r.ShaderOutput.ShadowHighlight:case r.ShaderOutput.ShadowExcludeHighlight:case r.ShaderOutput.ViewshedShadow:case r.ShaderOutput.ObjectAndLayerIdColor:h.addProjViewLocalOrigin(b,g),e.include(o.Transform,g),e.include(a.TextureCoordinateAttribute,g),e.include(d.VisualVariables,g),e.include(c.OutputDepth,g),v.include(i.SliceDraw,g),e.include(n.ObjectAndLayerIdColor,g),t.addNearFar(e),S.add("depth","float",{invariant:!0}),w&&v.uniforms.add(new m.Texture2DPassUniform("tex",(e=>e.texture))),b.main.add(f.glsl`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();`),e.include(p.DiscardOrAdjustAlphaPass,g),v.main.add(f.glsl`
        discardBySlice(vpos);
        ${f.If(w,f.glsl`vec4 texColor = texture(tex, ${I?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}
        ${T===r.ShaderOutput.ObjectAndLayerIdColor?f.glsl`outputObjectAndLayerIdColor();`:f.glsl`outputDepth(depth);`}`);break;case r.ShaderOutput.Normal:{h.addProjViewLocalOrigin(b,g),e.include(o.Transform,g),e.include(s.NormalAttribute,g),e.include(l.VertexNormal,g),e.include(a.TextureCoordinateAttribute,g),e.include(d.VisualVariables,g),w&&v.uniforms.add(new m.Texture2DPassUniform("tex",(e=>e.texture))),M===s.NormalType.ScreenDerivative&&S.add("vPositionView","vec3",{invariant:!0});const t=M===s.NormalType.Attribute||M===s.NormalType.Compressed;b.main.add(f.glsl`
        vpos = getVertexInLocalOriginSpace();
        ${t?f.glsl`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:f.glsl`vPositionView = (view * vec4(vpos, 1.0)).xyz;`}
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();`),v.include(i.SliceDraw,g),e.include(p.DiscardOrAdjustAlphaPass,g),v.main.add(f.glsl`
        discardBySlice(vpos);
        ${f.If(w,f.glsl`vec4 texColor = texture(tex, ${I?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}

        ${M===s.NormalType.ScreenDerivative?f.glsl`vec3 normal = screenDerivativeNormal(vPositionView);`:f.glsl`vec3 normal = normalize(vNormalWorld);
                    if (gl_FrontFacing == false){
                      normal = -normal;
                    }`}
        fragColor = vec4(0.5 + 0.5 * normal, 1.0);`);break}case r.ShaderOutput.Highlight:h.addProjViewLocalOrigin(b,g),e.include(o.Transform,g),e.include(a.TextureCoordinateAttribute,g),e.include(d.VisualVariables,g),w&&v.uniforms.add(new m.Texture2DPassUniform("tex",(e=>e.texture))),b.main.add(f.glsl`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),v.include(i.SliceDraw,g),e.include(p.DiscardOrAdjustAlphaPass,g),e.include(u.OutputHighlight,g),v.main.add(f.glsl`
        discardBySlice(vpos);
        ${f.If(w,f.glsl`vec4 texColor = texture(tex, ${I?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}
        calculateOcclusionAndOutputHighlight();`)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl":function(){define(["exports","../ShaderOutput","../../shaderModules/glsl","../../../lib/VertexAttribute"],(function(e,t,r,i){"use strict";e.ObjectAndLayerIdColor=function(e,o){if(o.output!==t.ShaderOutput.ObjectAndLayerIdColor)return e.vertex.code.add(r.glsl`void forwardObjectAndLayerIdColor() {}`),void e.fragment.code.add(r.glsl`void outputObjectAndLayerIdColor() {}`);const s=o.objectAndLayerIdColorInstanced;e.varyings.add("objectAndLayerIdColorVarying","vec4"),e.attributes.add(s?i.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR:i.VertexAttribute.OLIDCOLOR,"vec4"),e.vertex.code.add(r.glsl`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${s?"instanceObjectAndLayerIdColor":"objectAndLayerIdColor"} * 0.003921568627451;
    }`),e.fragment.code.add(r.glsl`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutput","../../shaderModules/glsl"],(function(e,t,r){"use strict";e.OutputDepth=function(e,i){switch(i.output){case t.ShaderOutput.Shadow:case t.ShaderOutput.ShadowHighlight:case t.ShaderOutput.ShadowExcludeHighlight:case t.ShaderOutput.ViewshedShadow:e.fragment.code.add(r.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth){
float fragDepth = _calculateFragDepth(_linearDepth);
gl_FragDepth = fragDepth;
}`)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../HighlightReadBitmap.glsl","../ShaderOutput","../../shaderModules/glsl","../../shaderModules/Integer2BindUniform","../../shaderModules/IntegerBindUniform","../../shaderModules/Texture2DBindUniform","../../shaderModules/Texture2DUintBindUniform"],(function(e,t,r,i,o,s,n,a){"use strict";e.OutputHighlight=function(e,l){const{fragment:c}=e,{output:u,draped:d,hasHighlightMixTexture:p}=l;u===r.ShaderOutput.Highlight?(c.uniforms.add(new s.IntegerBindUniform("highlightLevel",(e=>e.highlightLevel??0)),new o.Integer2BindUniform("highlightMixOrigin",(e=>e.highlightMixOrigin))),e.outputs.add("fragHighlight","uvec2",0),e.include(t.HighlightReadBitmap),p?c.uniforms.add(new a.Texture2DUintBindUniform("highlightMixTexture",(e=>e.highlightMixTexture))).code.add(i.glsl`uvec2 getAccumulatedHighlight() {
return texelFetch(highlightMixTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = uvec2(bits, 0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
uvec2 combinedHighlight = getAccumulatedHighlight();
combinedHighlight[li] |= bits;
fragHighlight = combinedHighlight;
}
}`):c.code.add(i.glsl`void outputHighlight(bool occluded) {
uint bits = occluded ? 3u : 1u;
fragHighlight = uvec2(bits, 0);
}`),d?c.code.add(i.glsl`bool isHighlightOccluded() {
return false;
}`):c.uniforms.add(new n.Texture2DBindUniform("depthTexture",(e=>e.mainDepth))).code.add(i.glsl`bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}`),c.code.add(i.glsl`void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`)):c.code.add(i.glsl`void calculateOcclusionAndOutputHighlight() {}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/HighlightReadBitmap.glsl":function(){define(["exports","../shaderModules/glsl"],(function(e,t){"use strict";e.HighlightReadBitmap=function(e){const{fragment:r}=e;r.code.add(t.glsl`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(uvec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return texel[lic];
}
uint readLevelBits(uvec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Integer2BindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"ivec2",t.BindType.Bind,((t,i)=>t.setUniform2iv(e,r(i))))}}e.Integer2BindUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/IntegerBindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"int",t.BindType.Bind,((t,i)=>t.setUniform1i(e,r(i))))}}e.IntegerBindUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DBindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"sampler2D",t.BindType.Bind,((t,i)=>t.bindTexture(e,r(i))))}}e.Texture2DBindUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DUintBindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"usampler2D",t.BindType.Bind,((t,i)=>t.bindTexture(e,r(i))))}}e.Texture2DUintBindUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/Float4PassUniform","../../shaderModules/Float4sPassUniform","../../shaderModules/FloatsPassUniform","../../shaderModules/glsl","../../shaderModules/Matrix3PassUniform","../../../lib/VertexAttribute","../../../materials/VisualVariablePassParameters"],(function(e,t,r,i,o,s,n,a,l){"use strict";e.VisualVariables=function(e,c){const{vertex:u,attributes:d}=e;c.hasVvInstancing&&(c.vvSize||c.vvColor)&&d.add(a.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4"),c.vvSize?(u.uniforms.add(new t.Float3PassUniform("vvSizeMinSize",(e=>e.vvSize.minSize))),u.uniforms.add(new t.Float3PassUniform("vvSizeMaxSize",(e=>e.vvSize.maxSize))),u.uniforms.add(new t.Float3PassUniform("vvSizeOffset",(e=>e.vvSize.offset))),u.uniforms.add(new t.Float3PassUniform("vvSizeFactor",(e=>e.vvSize.factor))),u.uniforms.add(new t.Float3PassUniform("vvSizeFallback",(e=>e.vvSize.fallback))),u.uniforms.add(new n.Matrix3PassUniform("vvSymbolRotationMatrix",(e=>e.vvSymbolRotationMatrix))),u.uniforms.add(new t.Float3PassUniform("vvSymbolAnchor",(e=>e.vvSymbolAnchor))),u.code.add(s.glsl`vec3 vvScale(vec4 _featureAttribute) {
if (isnan(_featureAttribute.x)) {
return vvSizeFallback;
}
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),u.code.add(s.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 scale = max(vvScale(_featureAttribute), eps);
        return vec4(vvSymbolRotationMatrix * _normal / scale, 1.0);
      }

      ${c.hasVvInstancing?s.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):u.code.add(s.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),c.vvColor?(u.constants.add("vvColorNumber","int",l.vvColorNumber),u.uniforms.add(new o.FloatsPassUniform("vvColorValues",(e=>e.vvColor.values),l.vvColorNumber),new i.Float4sPassUniform("vvColorColors",(e=>e.vvColor.colors),l.vvColorNumber),new r.Float4PassUniform("vvColorFallback",(e=>e.vvColor.fallback))),u.code.add(s.glsl`
      vec4 interpolateVVColor(float value) {
        if (isnan(value)) {
          return vvColorFallback;
        }

        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${c.hasVvInstancing?s.glsl`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):u.code.add(s.glsl`vec4 vvColor() { return vec4(1.0); }`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r,i){super(e,"vec4",t.BindType.Pass,((t,i,o)=>t.setUniform4fv(e,r(i,o))),i)}}e.Float4sPassUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r,i){super(e,"float",t.BindType.Pass,((t,i,o)=>t.setUniform1fv(e,r(i,o))),i)}}e.FloatsPassUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../layers/support/FastSymbolUpdates","../lib/Material"],(function(e,t,r){"use strict";class i extends t.VisualVariablesParameters{constructor(){super(...arguments),this.renderOccluded=r.RenderOccludedFlag.Occlude,this.isDecoration=!1}}e.VisualVariablePassParameters=i,e.vvColorNumber=8,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["exports","../../../../core/has","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../renderers/support/lengthUtils","../../../../support/guards","../../support/debugFlags","../../webgl-engine/effects/geometry/olidUtils","../../../webgl/NoParameters"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y,g;e.FastSizeType=void 0,(y=e.FastSizeType||(e.FastSizeType={}))[y.Undefined=0]="Undefined",y[y.DefinedSize=1]="DefinedSize",y[y.DefinedScale=2]="DefinedScale",e.FastRotationType=void 0,(g=e.FastRotationType||(e.FastRotationType={}))[g.Undefined=0]="Undefined",g[g.DefinedAngle=1]="DefinedAngle";class b{constructor(e){this.field=e}}class v extends b{constructor(t){super(t),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[e.FastSizeType.Undefined,e.FastSizeType.Undefined,e.FastSizeType.Undefined],this.fallback=[0,0,0]}}class S extends b{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0],this.fallback=[0,0,0,0]}}class _ extends b{constructor(e,t=0){super(e),this.fallback=t,this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class x{}function w(e){return null!=e}function T(e,t){e&&e.push(t)}function M(t,r,i,o,s){const n=t.minSize,a=t.maxSize;if(t.useSymbolValue){const t=o.symbolSize[i];return r.minSize[i]=t,r.maxSize[i]=t,r.offset[i]=r.minSize[i],r.factor[i]=0,r.type[i]=e.FastSizeType.DefinedSize,!0}if(w(t.field))return w(t.stops)?2===t.stops.length&&p.isNumber(t.stops[0].size)&&p.isNumber(t.stops[1].size)?(I(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,r,i),r.type[i]=e.FastSizeType.DefinedSize,!0):(T(s,"Could not convert size info: stops only supported with 2 elements"),!1):p.isNumber(n)&&p.isNumber(a)&&w(t.minDataValue)&&w(t.maxDataValue)?(I(n,a,t.minDataValue,t.maxDataValue,r,i),r.type[i]=e.FastSizeType.DefinedSize,!0):"unknown"===t.valueUnit?(T(s,"Could not convert size info: proportional size not supported"),!1):null!=d.meterIn[t.valueUnit]?(r.minSize[i]=-1/0,r.maxSize[i]=1/0,r.offset[i]=0,r.factor[i]=1/d.meterIn[t.valueUnit],r.type[i]=e.FastSizeType.DefinedSize,!0):(T(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!w(t.field)){if(t.stops?.[0]&&p.isNumber(t.stops[0].size))return r.minSize[i]=t.stops[0].size,r.maxSize[i]=t.stops[0].size,r.offset[i]=r.minSize[i],r.factor[i]=0,r.type[i]=e.FastSizeType.DefinedSize,!0;if(p.isNumber(n))return r.minSize[i]=n,r.maxSize[i]=n,r.offset[i]=n,r.factor[i]=0,r.type[i]=e.FastSizeType.DefinedSize,!0}return T(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function I(e,t,r,i,o,s){const n=Math.abs(i-r)>0?(t-e)/(i-r):0;o.minSize[s]=n>0?e:t,o.maxSize[s]=n>0?t:e,o.offset[s]=e-r*n,o.factor[s]=n}function P(e,t,r){e[4*t]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function O(e,t,r){const i=2===r&&"arithmetic"===e.rotationType;t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function C(t,r,i){if(!t)return null;const o=t.reduce(((e,t)=>{if(!e)return e;if(t.valueExpression)return T(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(t.type){case"size":return r.supports.size?function(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return T(i,"Could not convert size info: unsupported property"),null;if(!p.isStringOrNull(e.field))return T(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return T(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size=new v(e.field),a.copy(t.size.fallback,r.fallbackSize);let o;switch(e.axis){case"width":return o=M(e,t.size,0,r,i),o?t:null;case"height":return o=M(e,t.size,2,r,i),o?t:null;case"depth":return o=M(e,t.size,1,r,i),o?t:null;case"width-and-depth":return o=M(e,t.size,0,r,i),o&&M(e,t.size,1,r,i),o?t:null;case null:case void 0:case"all":return o=M(e,t.size,0,r,i),o=o&&M(e,t.size,1,r,i),o=o&&M(e,t.size,2,r,i),o?t:null;default:return T(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}(t,e,r,i):e;case"color":return r.supports.color?function(e,t,r,i){if(e.normalizationField)return T(i,"Could not convert color info: unsupported property"),null;if(p.isString(e.field)){if(!e.stops)return T(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return T(i,"Could not convert color info: too many color stops"),null;t.color=new S(e.field);const o=e.stops;for(let e=0;e<8;++e){const r=o[Math.min(e,o.length-1)];t.color.values[e]=r.value,P(t.color.colors,e,r.color)}c.copy(t.color.fallback,r.fallbackColor)}}else{if(!(e.stops&&e.stops.length>=0))return T(i,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color=new S(null);for(let e=0;e<8;e++)t.color.values[e]=1/0,P(t.color.colors,e,i);c.copy(t.color.fallback,r.fallbackColor)}}return t}(t,e,r,i):e;case"opacity":return r.supports.opacity?function(e,t,r,i){if(e.normalizationField)return T(i,"Could not convert opacity info: unsupported property"),null;if(p.isString(e.field)){if(!e.stops)return T(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return T(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity=new _(e.field,r.fallbackColor[3]);const o=e.stops;for(let e=0;e<8;++e){const r=o[Math.min(e,o.length-1)];t.opacity.values[e]=r.value,t.opacity.opacityValues[e]=r.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return T(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0],fallback:r.fallbackColor[3]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=i}}return t}(t,e,r,i):null;case"rotation":return r.supports.rotation?function(e,t,r){if(!p.isString(e.field))return T(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return T(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return O(e,t.rotation,0),t;case"roll":return O(e,t.rotation,1),t;case null:case void 0:case"heading":return O(e,t.rotation,2),t;default:return T(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(t,e,i):e;default:return null}}),new x);return!(t.length>0&&o)||o.size||o.color||o.opacity||o.rotation?o?.size&&!function(t,r,i){for(let i=0;i<3;++i){let o=r.unitInMeters;t.type[i]===e.FastSizeType.DefinedSize&&(o*=r.modelSize[i],t.type[i]=e.FastSizeType.DefinedScale),t.minSize[i]=t.minSize[i]/o,t.maxSize[i]=t.maxSize[i]/o,t.offset[i]=t.offset[i]/o,t.factor[i]=t.factor[i]/o}let o;if(t.type[0]!==e.FastSizeType.Undefined)o=0;else if(t.type[1]!==e.FastSizeType.Undefined)o=1;else{if(t.type[2]===e.FastSizeType.Undefined)return T(i,"No size axis contains a valid size or scale"),!1;o=2}for(let r=0;r<3;++r)t.type[r]===e.FastSizeType.Undefined&&(t.minSize[r]=t.minSize[o],t.maxSize[r]=t.maxSize[o],t.offset[r]=t.offset[o],t.factor[r]=t.factor[o],t.type[r]=t.type[o]);return!0}(o.size,r,i)?null:o:null}class A{constructor(e,t,r){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=r}}function E(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t?.field)return!1;if(e&&"rotation"===r){const r=e,i=t;for(let e=0;e<3;e++)if(r.type[e]!==i.type[e]||r.offset[e]!==i.offset[e]||r.factor[e]!==i.factor[e])return!1}return!0}class R extends m.NoParameters{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}}function F(e,t){const r=new R(e);return r.vvSize&&(r.vvSymbolAnchor=t.anchor,s.identity(N),function(e,t,r,i=n.create()){const o=e||0,a=t||0,l=r||0;0!==o&&s.rotateZ(i,i,-o/180*Math.PI),0!==a&&s.rotateX(i,i,a/180*Math.PI),0!==l&&s.rotateY(i,i,l/180*Math.PI)}(t.rotation[2],t.rotation[0],t.rotation[1],N),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||o.create(),i.fromMat4(r.vvSymbolRotationMatrix,N)),r}function D(e,t,i){if(!t.vvSize)return a.set(e,1,1,1),e;if(Number.isNaN(i[0]))return a.copy(e,t.vvSize.fallback);for(let o=0;o<3;++o){const s=t.vvSize.offset[o]+i[0]*t.vvSize.factor[o];e[o]=r.clamp(s,t.vvSize.minSize[o],t.vvSize.maxSize[o])}return e}const L=n.create(),V=l.create(),N=n.create();e.ConvertOptions=class{constructor({supports:e,modelSize:t,symbolSize:r,unitInMeters:i,anchor:o,scale:s,rotation:n,fallbackColor:a,fallbackSize:c}){this.supports=e,this.modelSize=t??l.ones(),this.symbolSize=r??l.ones(),this.unitInMeters=i??1,this.anchor=o??l.zeros(),this.scale=s??l.ones(),this.rotation=n??l.zeros(),this.fallbackColor=a??u.ones(),this.fallbackSize=c??l.ones()}},e.FastColorInfo=S,e.FastOpacityInfo=_,e.FastRotationInfo=class extends b{constructor(e){super(e),this.offset=[0,0,0],this.factor=[1,1,1],this.type=[0,0,0]}},e.FastSizeInfo=v,e.FastSymbolUpdatesState=A,e.FastVisualVariables=x,e.VisualVariablesParameters=R,e.convertVisualVariables=C,e.evaluateModelTransform=function(e,t,r){if(!e.vvSize)return r;s.copy(L,r);const i=e.vvSymbolRotationMatrix;return s.set(N,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),s.multiply(L,L,N),D(V,e,t),s.scale(L,L,V),s.translate(L,L,e.vvSymbolAnchor),L},e.evaluateModelTransformScale=D,e.getAttributeValue=function(e,t){const r=null==e?0:t.attributes[e];return"number"==typeof r&&isFinite(r)?r:NaN},e.getMaterialParameters=F,e.initFastSymbolUpdatesState=function(e,t){if(!e)return null;if(f.olidEnabled())return null;if(h.debugFlags.TESTS_DISABLE_FAST_UPDATES)return null;const r=C(e.visualVariables,t);return r?new A(r,F(r,t),!!r.size):null},e.updateFastSymbolUpdatesState=function(e,t,r){if(!t||!e)return!1;const i=e.visualVariables,o=C(t.visualVariables,r);return!!o&&!!(E(i.size,o.size,"size")&&E(i.color,o.color,"color")&&E(i.rotation,o.rotation,"rotation")&&E(i.opacity,o.opacity,"opacity"))&&(e.visualVariables=o,e.materialParameters=F(o,r),e.requiresShaderTransformation=!!o.size,!0)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlpha.glsl":function(){define(["exports","../../shaderModules/FloatDrawUniform","../../shaderModules/FloatPassUniform","../../shaderModules/glsl","../../../lib/basicInterfaces","../../../../../../webscene/support/AlphaCutoff"],(function(e,t,r,i,o,s){"use strict";function n(e,t,r){const n=e.fragment,a=t.alphaDiscardMode,l=a===o.AlphaDiscardMode.Blend;a!==o.AlphaDiscardMode.Mask&&a!==o.AlphaDiscardMode.MaskBlend||n.uniforms.add(r),n.code.add(i.glsl`
    void discardOrAdjustAlpha(inout vec4 color) {
      ${a===o.AlphaDiscardMode.Opaque?"color.a = 1.0;":`if (color.a < ${l?i.glsl.float(s.alphaCutoff):"textureAlphaCutoff"}) {\n              discard;\n             } ${i.If(a===o.AlphaDiscardMode.Mask,"else { color.a = 1.0; }")}`}
    }
  `)}e.DiscardOrAdjustAlphaDraw=function(e,r){n(e,r,new t.FloatDrawUniform("textureAlphaCutoff",(e=>e.textureAlphaCutoff)))},e.DiscardOrAdjustAlphaPass=function(e,t){n(e,t,new r.FloatPassUniform("textureAlphaCutoff",(e=>e.textureAlphaCutoff)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/webscene/support/AlphaCutoff":function(){define(["exports"],(function(e){"use strict";e.alphaCutoff=1/255.5,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../../../core/libs/gl-matrix-2/factories/vec2f64","../attributes/TextureCoordinateAttribute.glsl","../attributes/VertexTextureCoordinates.glsl","./Normals.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/glsl","../../shaderModules/Matrix3PassUniform","../../shaderModules/Texture2DDrawUniform","../../shaderModules/Texture2DPassUniform","../../../lib/VertexAttribute","../../../../../webgl/BindType"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";e.ComputeNormalTexture=function(e,h){const f=e.fragment,{hasVertexTangents:m,doubleSidedMode:y,hasNormalTexture:g,textureCoordinateType:b,bindType:v,hasNormalTextureTransform:S}=h;m?(e.attributes.add(d.VertexAttribute.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),y===s.NormalsDoubleSidedMode.WindingOrder?f.code.add(a.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):f.code.add(a.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):f.code.add(a.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),g&&b!==i.TextureCoordinateType.None&&(e.include(o.VertexTextureCoordinates,h),f.uniforms.add(v===p.BindType.Pass?new u.Texture2DPassUniform("normalTexture",(e=>e.textureNormal)):new c.Texture2DDrawUniform("normalTexture",(e=>e.textureNormal))),S&&(f.uniforms.add(new n.Float2PassUniform("scale",(e=>e.scale??r.ONES))),f.uniforms.add(new l.Matrix3PassUniform("normalTextureTransformMatrix",(e=>e.normalTextureTransformMatrix??t.IDENTITY)))),f.code.add(a.glsl`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),S&&f.code.add(a.glsl`mat3 normalRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),f.code.add(a.glsl`return tangentSpace * rawNormal;
}`))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"vec2",t.BindType.Pass,((t,i,o)=>t.setUniform2fv(e,r(i,o))))}}e.Float2PassUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/glsl","../../shaderModules/Texture2DBindUniform","../../../effects/ssao/SSAO"],(function(e,t,r,i){"use strict";e.EvaluateAmbientOcclusion=function(e,o){o.receiveAmbientOcclusion?(e.uniforms.add(new r.Texture2DBindUniform("ssaoTex",(e=>e.ssao?.getTexture()))),e.constants.add("blurSizePixelsInverse","float",1/i.blurSizePixels),e.code.add(t.glsl`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):e.code.add(t.glsl`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/ssao/SSAO":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/time","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/libs/gl-matrix-2/math/vec2","../../../webgl","../../../webgl/RenderNode","../../core/FBOCacheFormats","../../core/shaderLibrary/shading/ScreenSpaceConstants","./SSAOBlurTechnique","./SSAONoiseData","./SSAOParameters","./SSAOTechnique","../../lib/basicInterfaces","../../../../../chunks/SSAO.glsl","../../../../webgl/enums","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x,w,T){"use strict";e.SSAO=class extends h{constructor(e){super(e),this.consumes={required:["normals"]},this.produces=p.InternalRenderCategory.SSAO,this.isEnabled=()=>!1,this._enableTime=s.Milliseconds(0),this._passParameters=new b.SSAOPassParameters,this._drawParameters=new b.BlurDrawParameters}initialize(){const e=Uint8Array.from(atob(g.noiseData),(e=>e.charCodeAt(0))),t=new T.TextureDescriptor;t.wrapMode=x.TextureWrapMode.CLAMP_TO_EDGE,t.pixelFormat=x.PixelFormat.RGB,t.wrapMode=x.TextureWrapMode.REPEAT,t.hasMipmap=!0,t.width=32,t.height=32,this._passParameters.noiseTexture=new w.Texture(this.renderingContext,t,e),this.techniques.precompile(v.SSAOTechnique),this.techniques.precompile(y.SSAOBlurTechnique),this.addHandles(o.watch((()=>this.isEnabled()),(()=>this._enableTime=s.Milliseconds(0))))}destroy(){this._passParameters.noiseTexture=i.disposeMaybe(this._passParameters.noiseTexture)}render(e){const t=e.find((({name:e})=>"normals"===e)),i=t?.getTexture(),o=t?.getTexture(x.DepthStencilAttachment);if(!i||!o)return;const n=this.techniques.get(v.SSAOTechnique),a=this.techniques.get(y.SSAOBlurTechnique);if(!n.compiled||!a.compiled)return this._enableTime=s.Milliseconds(performance.now()),void this.requestRender(S.RenderRequestType.UPDATE);0===this._enableTime&&(this._enableTime=s.Milliseconds(performance.now()));const l=this.renderingContext,c=this.view.qualitySettings.fadeDuration,u=this.bindParameters,h=u.camera,g=h.relativeElevation,b=r.clamp((m.distanceFadeEnd-g)/(m.distanceFadeEnd-m.distanceFadeStart),0,1),w=c>0?Math.min(c,performance.now()-this._enableTime)/c:1,T=w*b;this._passParameters.normalTexture=i,this._passParameters.depthTexture=o,this._passParameters.projScale=1/h.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*M/_.getRadius(h)**6*T;const I=h.fullViewport[2],P=h.fullViewport[3],O=this.fboCache.acquire(I,P,"ssao input",f.ColorFormat.RG8UNORM);l.bindFramebuffer(O.fbo),l.setViewport(0,0,I,P),l.bindTechnique(n,u,this._passParameters,this._drawParameters),l.screen.draw();const C=Math.round(I/2),A=Math.round(P/2),E=this.fboCache.acquire(C,A,"ssao blur",f.ColorFormat.R8UNORM);l.bindFramebuffer(E.fbo),this._drawParameters.colorTexture=O.getTexture(),d.set(this._drawParameters.blurSize,0,2/P),l.bindTechnique(a,u,this._passParameters,this._drawParameters),l.setViewport(0,0,C,A),l.screen.draw(),O.release();const R=this.fboCache.acquire(C,A,p.InternalRenderCategory.SSAO,f.ColorFormat.R8UNORM);return l.bindFramebuffer(R.fbo),l.setViewport(0,0,I,P),l.setClearColor(1,1,1,0),l.clear(x.FramebufferBit.COLOR),this._drawParameters.colorTexture=E.getTexture(),d.set(this._drawParameters.blurSize,2/I,0),l.bindTechnique(a,u,this._passParameters,this._drawParameters),l.setViewport(0,0,C,A),l.screen.draw(),l.setViewport4fv(h.fullViewport),E.release(),w<1&&this.requestRender(S.RenderRequestType.UPDATE),R}},t.__decorate([n.property()],e.SSAO.prototype,"consumes",void 0),t.__decorate([n.property()],e.SSAO.prototype,"produces",void 0),t.__decorate([n.property({constructOnly:!0})],e.SSAO.prototype,"isEnabled",void 0),e.SSAO=t.__decorate([u.subclass("esri.views.3d.webgl-engine.effects.ssao.SSAO")],e.SSAO);const M=.5;e.blurSizePixels=2,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl":function(){define(["exports","../../core/libs/gl-matrix-2/factories/mat4f64","../../geometry/projection/computeTranslationToOriginAndRotation","../../geometry/projection/projectBuffer"],(function(e,t,r,i){"use strict";var o,s;e.RenderCategory=void 0,(o=e.RenderCategory||(e.RenderCategory={})).OPAQUE="opaque-color",o.TRANSPARENT="transparent-color",o.COMPOSITE="composite-color",o.FINAL="final-color",e.InternalRenderCategory=void 0,(s=e.InternalRenderCategory||(e.InternalRenderCategory={})).SSAO="ssao",s.LASERLINES="laserline-color",s.ANTIALIASING="aa-color",s.HIGHLIGHTS="highlight-color",s.MAGNIFIER="magnifier-color",s.OCCLUDED="occluded-color",s.VIEWSHED="viewshed-color",s.OPAQUE_TERRAIN="opaque-terrain-color",s.OPAQUE_ENVIRONMENT="opaque-environment-color",s.TRANSPARENT_ENVIRONMENT="transparent-environment-color",s.FOCUSAREA="focusarea",s.FOCUSAREA_COLOR="focusarea-color",e.fromRenderCoordinates=function(e,t,r,o,s,n,a){return n=n||e.spatialReference,i.projectBuffer(t,e.renderCoordsHelper.spatialReference,r,o,n,s,a)?o:null},e.renderCoordinateTransformAt=function(e,i,o,s){return s||(s=t.create()),o=o||e.spatialReference,r.computeTranslationToOriginAndRotation(o,i,s,e.renderCoordsHelper.spatialReference)?s:null},e.toRenderCoordinates=function(e,t,r,o,s,n,a){return o=o||e.spatialReference,i.projectBuffer(t,o,r,s,e.renderCoordsHelper.spatialReference,n,a)?s:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl/RenderNode":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Error","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../webgl","../webgl-engine/lib/basicInterfaces"],(function(e,t,r,i,o,s,n,a,l){"use strict";return e.default=class extends r{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=a.RenderCategory.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([o.watch((()=>this.view.ready),(e=>{e&&this.view.stage?.renderer.addRenderNode(this)}),o.initial)])}destroy(){this.view.stage?.renderer?.removeRenderNode(this)}precompile(){}render(){throw new i("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view.stage.renderView.renderingContext.gl}get techniques(){return this.view.stage.renderView.techniques}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,t=this.view.stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return t.fbo?.initializeAndBind(),t}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){e===l.RenderRequestType.UPDATE&&this.view.stage?.renderView.requestRender(e),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view.stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view.stage.renderView.renderingContext}get renderContext(){return this.view.stage?.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find((({name:e})=>e===this.produces));try{return this.render(e)}finally{this._frameBuffer=null}}},t.__decorate([s.property({constructOnly:!0})],e.default.prototype,"view",void 0),t.__decorate([s.property({constructOnly:!0})],e.default.prototype,"consumes",void 0),t.__decorate([s.property()],e.default.prototype,"produces",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"techniques",null),e.default=t.__decorate([n.subclass("esri.views.3d.webgl.RenderNode")],e.default),e.default}))},"esri/views/3d/webgl-engine/core/FBOCacheFormats":function(){define(["exports","../../../webgl/enums","../../../webgl/TextureDescriptor","../../../webgl/textureUtils"],(function(e,t,r,i){"use strict";var o,s;e.ColorFormat=void 0,(o=e.ColorFormat||(e.ColorFormat={}))[o.R8UNORM=0]="R8UNORM",o[o.R8UINT=1]="R8UINT",o[o.RG8UNORM=2]="RG8UNORM",o[o.RG8UINT=3]="RG8UINT",o[o.RGBA4UNORM=4]="RGBA4UNORM",o[o.RGBA8UNORM=5]="RGBA8UNORM",o[o.RGBA8UNORM_MIPMAP=6]="RGBA8UNORM_MIPMAP",o[o.R16FLOAT=7]="R16FLOAT",o[o.RGBA16FLOAT=8]="RGBA16FLOAT",o[o.R32FLOAT=9]="R32FLOAT",o[o.COUNT=10]="COUNT",e.DepthFormat=void 0,(s=e.DepthFormat||(e.DepthFormat={}))[s.DEPTH16=10]="DEPTH16",s[s.DEPTH24_STENCIL8=11]="DEPTH24_STENCIL8";const n={[e.ColorFormat.R8UNORM]:"R8",[e.ColorFormat.R8UINT]:"R8UI",[e.ColorFormat.R16FLOAT]:"R16F",[e.ColorFormat.R32FLOAT]:"R32F",[e.ColorFormat.RG8UNORM]:"RG8",[e.ColorFormat.RG8UINT]:"RG8UI",[e.ColorFormat.RGBA8UNORM]:"RGBA8",[e.ColorFormat.RGBA4UNORM]:"RGBA4",[e.ColorFormat.RGBA8UNORM_MIPMAP]:"RGBA8_MM",[e.ColorFormat.RGBA16FLOAT]:"RGBA16F",[e.DepthFormat.DEPTH16]:"D16",[e.DepthFormat.DEPTH24_STENCIL8]:"D24S8"},a=new r.TextureDescriptor;a.pixelFormat=t.PixelFormat.RED,a.internalFormat=t.SizedPixelFormat.R8,a.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE;const l=new r.TextureDescriptor;l.pixelFormat=t.PixelFormat.RED_INTEGER,l.internalFormat=t.SizedPixelFormat.R8UI,l.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE,l.samplingMode=t.TextureSamplingMode.NEAREST;const c=new r.TextureDescriptor;c.pixelFormat=t.PixelFormat.RG,c.internalFormat=t.SizedPixelFormat.RG8,c.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE;const u=new r.TextureDescriptor;u.pixelFormat=t.PixelFormat.RG_INTEGER,u.internalFormat=t.SizedPixelFormat.RG8UI,u.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE,u.samplingMode=t.TextureSamplingMode.NEAREST;const d=new r.TextureDescriptor;d.internalFormat=t.SizedPixelFormat.RGBA4,d.dataType=t.PixelType.UNSIGNED_SHORT_4_4_4_4,d.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE;const p=new r.TextureDescriptor;p.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE;const h=new r.TextureDescriptor;h.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE,h.samplingMode=t.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,h.hasMipmap=!0,h.maxAnisotropy=8;const f=new r.TextureDescriptor;f.pixelFormat=t.PixelFormat.RED,f.dataType=t.PixelType.HALF_FLOAT,f.internalFormat=t.SizedPixelFormat.R16F,f.samplingMode=t.TextureSamplingMode.NEAREST;const m=new r.TextureDescriptor;m.dataType=t.PixelType.HALF_FLOAT,m.internalFormat=t.SizedPixelFormat.RGBA16F,m.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE;const y=new r.TextureDescriptor;y.pixelFormat=t.PixelFormat.RED,y.dataType=t.PixelType.FLOAT,y.internalFormat=t.SizedPixelFormat.R32F,y.samplingMode=t.TextureSamplingMode.NEAREST;const g={[e.ColorFormat.R8UNORM]:a,[e.ColorFormat.R8UINT]:l,[e.ColorFormat.RG8UNORM]:c,[e.ColorFormat.RG8UINT]:u,[e.ColorFormat.RGBA4UNORM]:d,[e.ColorFormat.RGBA8UNORM]:p,[e.ColorFormat.RGBA8UNORM_MIPMAP]:h,[e.ColorFormat.R16FLOAT]:f,[e.ColorFormat.RGBA16FLOAT]:m,[e.ColorFormat.R32FLOAT]:y,[e.ColorFormat.COUNT]:null},b={[t.SizedDepthFormat.DEPTH_COMPONENT16]:t.PixelType.UNSIGNED_SHORT,[t.SizedDepthFormat.DEPTH_COMPONENT24]:t.PixelType.UNSIGNED_INT,[t.SizedDepthFormat.DEPTH_COMPONENT32F]:t.PixelType.FLOAT,[t.SizedDepthStencilFormat.DEPTH24_STENCIL8]:t.PixelType.UNSIGNED_INT_24_8,[t.SizedDepthStencilFormat.DEPTH32F_STENCIL8]:t.PixelType.FLOAT_32_UNSIGNED_INT_24_8_REV},v={[e.DepthFormat.DEPTH24_STENCIL8]:S(t.SizedDepthStencilFormat.DEPTH24_STENCIL8),[e.DepthFormat.DEPTH16]:S(t.SizedDepthFormat.DEPTH_COMPONENT16)};function S(e){const o=new r.TextureDescriptor;return o.pixelFormat=i.isSizedDepthFormat(e)?t.UnsizedDepthFormat.DEPTH_COMPONENT:t.UnsizedDepthFormat.DEPTH_STENCIL,o.dataType=b[e],o.samplingMode=t.TextureSamplingMode.NEAREST,o.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE,o.internalFormat=e,o.hasMipmap=!1,o.isImmutable=!0,o}e.ColorFormats=g,e.DepthTextureFormats=v,e.format2String=n,e.isDepthFormat=function(t){return t>=e.ColorFormat.COUNT},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceConstants":function(){define(["exports"],(function(e){"use strict";e.distanceFadeEnd=5e5,e.distanceFadeStart=3e5,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/ssao/SSAOBlurTechnique":function(){define(["require","exports","../../core/shaderTechnique/ReloadableShaderModule","../../core/shaderTechnique/ShaderTechnique","../../../../../chunks/SSAOBlur.glsl","../../../../webgl/renderState"],(function(e,t,r,i,o,s){"use strict";class n extends i.ShaderTechnique{constructor(t,i){super(t,i,new r.ReloadableShaderModule(o.SSAOBlur,(()=>new Promise(((t,r)=>e(["../../shaders/SSAOBlur.glsl"],t,r))))))}initializePipeline(){return s.makePipelineState({colorWrite:s.defaultColorWrite})}}t.SSAOBlurTechnique=n,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/SSAOBlur.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl","../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform","../views/webgl/ShaderBuilder"],(function(e,t,r,i,o,s,n,a,l){"use strict";function c(){const e=new l.ShaderBuilder,c=e.fragment;return e.include(t.ScreenSpacePass),c.include(r.ReadDepth),c.uniforms.add(new a.Texture2DPassUniform("depthMap",(e=>e.depthTexture)),new n.Texture2DDrawUniform("tex",(e=>e.colorTexture)),new i.Float2DrawUniform("blurSize",(e=>e.blurSize)),new o.FloatPassUniform("projScale",((e,t)=>{const r=t.camera.distance;return r>5e4?Math.max(0,e.projScale-(r-5e4)):e.projScale}))),c.code.add(s.glsl`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${s.glsl.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.outputs.add("fragBlur","float"),c.main.add(s.glsl`
    float b = 0.0;
    float w_total = 0.0;

    float center_d = linearDepthFromTexture(depthMap, uv);

    float sharpness = -0.05 * projScale / center_d;
    for (int r = -${s.glsl.int(4)}; r <= ${s.glsl.int(4)}; ++r) {
      float rf = float(r);
      vec2 uvOffset = uv + rf * blurSize;
      blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
    }
    fragBlur = b / w_total;`),e}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}));e.SSAOBlur=u,e.build=c}))},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl":function(){define(["exports","../shaderModules/glsl","../../lib/VertexAttribute"],(function(e,t,r){"use strict";e.ScreenSpacePass=function(e,i=!0){e.attributes.add(r.VertexAttribute.POSITION,"vec2"),i&&e.varyings.add("uv","vec2"),e.vertex.main.add(t.glsl`
      gl_Position = vec4(position, 0.0, 1.0);
      ${i?t.glsl`uv = position * 0.5 + vec2(0.5);`:""}
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../shaderModules/Float2BindUniform","../../shaderModules/glsl"],(function(e,t,r,i,o){"use strict";const s=r.create();e.ReadDepth=function(e){e.uniforms.add(new i.Float2BindUniform("zProjectionMap",(e=>function(e){const r=e.projectionMatrix;return t.set(s,r[14],r[10])}(e.camera)))),e.code.add(o.glsl`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),e.code.add(o.glsl`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),e.code.add(o.glsl`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"vec2",t.BindType.Draw,((t,i,o,s)=>t.setUniform2fv(e,r(i,o,s))))}}e.Float2DrawUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/webgl/ShaderBuilder":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger","./BindType"],(function(e,t,r,i,o){"use strict";const s=()=>i.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class n{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class a{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const t of e)this._add(t);return this._stage}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new t("shaderbuilder:duplicate-uniform",`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else s().error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((({name:e,arraySize:t,type:r})=>null!=t?`uniform ${r} ${e}[${t}];`:`uniform ${r} ${e};`))}get entries(){return Array.from(this._entries.values())}}class l{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(e){if(this._bodies.length>0)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];if(e)throw new t("shaderbuilder:missing-main","Shader does not contain main function body.");return[]}}class c{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}}class u extends n{constructor(){super(...arguments),this.uniforms=new a(this),this.main=new l(this),this.code=new c(this),this.constants=new m(this)}get builder(){return this}}class d{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`in ${e[1]} ${e[0]};`))}}class p{constructor(){this._entries=new Map}add(e,t,r){this._entries.has(e)?s().warn(`Ignoring duplicate varying ${t} ${e}`):this._entries.set(e,{type:t,invariant:r?.invariant??!1})}generateSource(e){const t=new Array;return this._entries.forEach(((r,i)=>t.push((r.invariant&&"vertex"===e?"invariant ":"")+("vertex"===e?"out":"in")+` ${r.type} ${i};`))),t}}class h{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?h.ALLOWLIST_VERTEX:h.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}static{this.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"]}static{this.ALLOWLIST_VERTEX=[]}}class f{constructor(){this._entries=new Map}add(e,t,r=0){const i=this._entries.get(r);i?.name!==e||i?.type!==t?this._entries.set(r,{name:e,type:t}):s().warn(`Fragment shader output location ${r} occupied`)}static{this.DEFAULT_TYPE="vec4"}static{this.DEFAULT_NAME="fragColor"}generateSource(e){if("vertex"===e)return[];0===this._entries.size&&this._entries.set(0,{name:f.DEFAULT_NAME,type:f.DEFAULT_TYPE});const t=new Array;return this._entries.forEach(((e,r)=>t.push(`layout(location = ${r}) out ${e.type} ${e.name};`))),t}}class m{constructor(e){this._stage=e,this._entries=new Set}add(e,t,r){let i="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":i=m._numberToFloatStr(r);break;case"int":i=m._numberToIntStr(r);break;case"bool":i=r.toString();break;case"vec2":i=`vec2(${m._numberToFloatStr(r[0])},                            ${m._numberToFloatStr(r[1])})`;break;case"vec3":i=`vec3(${m._numberToFloatStr(r[0])},                            ${m._numberToFloatStr(r[1])},                            ${m._numberToFloatStr(r[2])})`;break;case"vec4":i=`vec4(${m._numberToFloatStr(r[0])},                            ${m._numberToFloatStr(r[1])},                            ${m._numberToFloatStr(r[2])},                            ${m._numberToFloatStr(r[3])})`;break;case"ivec2":i=`ivec2(${m._numberToIntStr(r[0])},                             ${m._numberToIntStr(r[1])})`;break;case"ivec3":i=`ivec3(${m._numberToIntStr(r[0])},                             ${m._numberToIntStr(r[1])},                             ${m._numberToIntStr(r[2])})`;break;case"ivec4":i=`ivec4(${m._numberToIntStr(r[0])},                             ${m._numberToIntStr(r[1])},                             ${m._numberToIntStr(r[2])},                             ${m._numberToIntStr(r[3])})`;break;case"uvec2":i=`uvec2(${m._numberToIntStr(r[0])},                             ${m._numberToIntStr(r[1])})`;break;case"uvec3":i=`uvec3(${m._numberToIntStr(r[0])},                             ${m._numberToIntStr(r[1])},                             ${m._numberToIntStr(r[2])})`;break;case"uvec4":i=`uvec4(${m._numberToIntStr(r[0])},                             ${m._numberToIntStr(r[1])},                             ${m._numberToIntStr(r[2])},                             ${m._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${t}(${Array.prototype.map.call(r,(e=>m._numberToFloatStr(e))).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${i};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}e.Code=c,e.Includes=n,e.Main=l,e.ShaderBuilder=class extends n{constructor(){super(...arguments),this.vertex=new u,this.fragment=new u,this.attributes=new d,this.varyings=new p,this.extensions=new h,this.outputs=new f}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e,t=!1){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),o=this.varyings.generateSource(e),s="vertex"===e?this.vertex:this.fragment,n=s.uniforms.generateSource(),a=s.code.generateSource(),l=s.main.generateSource(t),c="vertex"===e?"precision highp float;\n precision highp sampler2D;\n precision highp usampler2D;\n precision highp sampler2DArray;\n precision highp sampler2DShadow;\n\n\n invariant gl_Position;\n ":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n  precision highp sampler2D;\n  precision highp usampler2D;\n  precision highp sampler2DArray;\n  precision highp sampler2DShadow;\n#else\n  precision mediump float;\n  precision mediump int;\n  precision mediump sampler2D;\n  precision mediump usampler2D;\n  precision mediump sampler2DArray;\n  precision mediump sampler2DShadow;\n#endif",u=s.constants.generateSource(),d=this.outputs.generateSource(e);return`#version 300 es\n${r.join("\n")}\n${c}\n${u.join("\n")}\n${n.join("\n")}\n${i.join("\n")}\n${o.join("\n")}\n${d.join("\n")}\n${a.join("\n")}\n${l.join("\n")}`}generateBind(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[o.BindType.Bind];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[o.BindType.Bind];r&&t.set(e.name,r)}));const r=Array.from(t.values()),i=r.length;return t=>{for(let o=0;o<i;++o)r[o](e,t)}}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[o.BindType.Pass];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[o.BindType.Pass];r&&t.set(e.name,r)}));const r=Array.from(t.values()),i=r.length;return(t,o)=>{for(let s=0;s<i;++s)r[s](e,t,o)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach((e=>{const r=e.bind[o.BindType.Draw];r&&t.set(e.name,r)})),this.fragment.uniforms.entries.forEach((e=>{const r=e.bind[o.BindType.Draw];r&&t.set(e.name,r)}));const r=Array.from(t.values()),i=r.length;return(t,o,s)=>{for(let n=0;n<i;++n)r[n](e,s,t,o)}}},e.Stage=u,e.Uniforms=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/ssao/SSAONoiseData":function(){define(["exports"],(function(e){"use strict";e.noiseData="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/ssao/SSAOParameters":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../webgl/NoParameters"],(function(e,t,r){"use strict";class i extends r.NoParameters{constructor(){super(...arguments),this.projScale=1}}class o extends r.NoParameters{}e.BlurDrawParameters=class extends o{constructor(){super(...arguments),this.blurSize=t.create()}},e.BlurPassParameters=i,e.SSAODrawParameters=o,e.SSAOPassParameters=class extends i{constructor(){super(...arguments),this.intensity=1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/ssao/SSAOTechnique":function(){define(["require","exports","../../core/shaderTechnique/ReloadableShaderModule","../../core/shaderTechnique/ShaderTechnique","../../../../../chunks/SSAO.glsl","../../../../webgl/renderState"],(function(e,t,r,i,o,s){"use strict";class n extends i.ShaderTechnique{constructor(t,i){super(t,i,new r.ReloadableShaderModule(o.SSAO,(()=>new Promise(((t,r)=>e(["../../shaders/SSAO.glsl"],t,r))))))}initializePipeline(){return s.makePipelineState({colorWrite:s.defaultColorWrite})}}t.SSAOTechnique=n,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/SSAO.glsl":function(){define(["exports","../core/libs/gl-matrix-2/math/vec2","../core/libs/gl-matrix-2/factories/vec2f64","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl","../views/3d/webgl-engine/core/shaderModules/Float2BindUniform","../views/3d/webgl-engine/core/shaderModules/Float2PassUniform","../views/3d/webgl-engine/core/shaderModules/FloatBindUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform","../views/webgl/ShaderBuilder"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";function h(){const e=new p.ShaderBuilder,r=e.fragment;return e.include(i.ScreenSpacePass),e.include(s.CameraSpace),r.include(o.ReadDepth),r.uniforms.add(new l.FloatBindUniform("radius",(e=>f(e.camera)))).code.add(u.glsl`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),r.code.add(u.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.outputs.add("fragOcclusion","float"),r.uniforms.add(new d.Texture2DPassUniform("normalMap",(e=>e.normalTexture)),new d.Texture2DPassUniform("depthMap",(e=>e.depthTexture)),new c.FloatPassUniform("projScale",(e=>e.projScale)),new d.Texture2DPassUniform("rnm",(e=>e.noiseTexture)),new a.Float2PassUniform("rnmScale",((e,r)=>t.set(m,r.camera.fullWidth/e.noiseTexture.descriptor.width,r.camera.fullHeight/e.noiseTexture.descriptor.height))),new c.FloatPassUniform("intensity",(e=>e.intensity)),new n.Float2BindUniform("screenSize",(e=>t.set(m,e.camera.fullWidth,e.camera.fullHeight)))).main.add(u.glsl`
    float depth = depthFromTexture(depthMap, uv);

    // Early out if depth is out of range, such as in the sky
    if (depth >= 1.0 || depth <= 0.0) {
      fragOcclusion = 1.0;
      return;
    }

    // get the normal of current fragment
    ivec2 iuv = ivec2(uv * vec2(textureSize(normalMap, 0)));
    vec4 norm4 = texelFetch(normalMap, iuv, 0);
    if(norm4.a != 1.0) {
      fragOcclusion = 1.0;
      return;
    }
    vec3 norm = normalize(norm4.xyz * 2.0 - 1.0);

    float currentPixelDepth = linearizeDepth(depth);
    vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

    float sum = 0.0;
    vec3 tapPixelPos;

    vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

    // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
    // bug or deviation from CE somewhere else?
    float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

    for(int i = 0; i < ${u.glsl.int(16)}; ++i) {
      vec2 unitOffset = reflect(sphere[i], fres).xy;
      vec2 offset = vec2(-unitOffset * radius * ps);

      // don't use current or very nearby samples
      if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
        continue;
      }

      vec2 tc = vec2(gl_FragCoord.xy + offset);
      if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
      vec2 tcTap = tc / screenSize;
      float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

      tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

      sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
    }

    // output the result
    float A = max(1.0 - sum * intensity / float(${u.glsl.int(16)}), 0.0);

    // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
    A = (pow(A, 0.2) + 1.2 * A * A * A * A) / 2.2;

    fragOcclusion = A;
  `),e}function f(e){return Math.max(10,20*e.computeScreenPixelSizeAtDist(Math.abs(4*e.relativeElevation)))}const m=r.create(),y=Object.freeze(Object.defineProperty({__proto__:null,build:h,getRadius:f},Symbol.toStringTag,{value:"Module"}));e.SSAO=y,e.build=h,e.getRadius=f}))},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../../../chunks/vec42","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../shaderModules/Float2BindUniform","../../shaderModules/Float4BindUniform","../../shaderModules/glsl"],(function(e,t,r,i,o,s,n,a){"use strict";function l(e){const t=e.projectionMatrix;return 0===t[11]?i.set(c,2/(e.fullWidth*t[0]),2/(e.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):i.set(c,-2/(e.fullWidth*t[0]),-2/(e.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const c=o.create();function u(e){return 0===e.projectionMatrix[11]?t.set(d,0,1):t.set(d,1,0)}const d=r.create();e.CameraSpace=function(e){e.fragment.uniforms.add(new n.Float4BindUniform("projInfo",(e=>l(e.camera)))),e.fragment.uniforms.add(new s.Float2BindUniform("zScale",(e=>u(e.camera)))),e.fragment.code.add(a.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)},e.getProjectionInfo=l,e.getZScale=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float4BindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"vec4",t.BindType.Bind,((t,i)=>t.setUniform4fv(e,r(i))))}}e.Float4BindUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define(["exports","../../../../../../colorUtils","../../../../../../core/has","./EvaluateAmbientLighting.glsl","./EvaluateAmbientOcclusion.glsl","./MainLighting.glsl","./PhysicallyBasedRendering.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/BooleanBindUniform","../../shaderModules/FloatBindUniform","../../shaderModules/glsl","../../../lighting/SceneLighting","../../../shaders/BlackLevelLightSoftCompression.glsl","../../../shaders/ToneMapping.glsl"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";function m(e){e.constants.add("ambientBoostFactor","float",p.ambientBoost)}function y(e){e.uniforms.add(new u.FloatBindUniform("lightingGlobalFactor",(e=>e.lighting.globalFactor)))}e.EvaluateSceneLighting=function(e,r){const p=e.fragment,{pbrMode:g,spherical:b,hasColorTexture:v}=r;p.include(o.EvaluateAmbientOcclusion,r),g!==a.PBRMode.Disabled&&p.include(n.PhysicallyBasedRendering,r),e.include(i.EvaluateAmbientLighting,r),p.include(l.PiUtils),p.include(f.ToneMapping,r);const S=!(g===a.PBRMode.Schematic&&!v);switch(S&&p.include(h.BlackLevelLightSoftCompression),p.code.add(d.glsl`
    const float GAMMA_SRGB = ${d.glsl.float(t.colorGamma)};
    const float INV_GAMMA_SRGB = 0.4761904;
    ${d.If(g!==a.PBRMode.Disabled,"const float GROUND_REFLECTANCE = 0.2;")}
  `),m(p),y(p),s.addMainLightDirection(p),p.code.add(d.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${b?d.glsl`normalize(vPosWorld)`:d.glsl`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),s.addMainLightIntensity(p),p.code.add(d.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),g){case a.PBRMode.Disabled:case a.PBRMode.WaterOnIntegratedMesh:case a.PBRMode.Water:e.include(s.applyShading),p.code.add(d.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
vec3 mainLighting = applyShading(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case a.PBRMode.Normal:case a.PBRMode.Schematic:p.code.add(d.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight,
vec3 viewDir, vec3 groundNormal, vec3 mrr, vec4 _emission,
float additionalAmbientIrradiance) {
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotNG = clamp(dot(normal, groundNormal), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, groundNormal), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),p.code.add(d.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),r.useFillLights?p.uniforms.add(new c.BooleanBindUniform("hasFillLights",(e=>e.enableFillLights))):p.constants.add("hasFillLights","bool",!1),p.code.add(d.glsl`vec3 ambientDir = vec3(5.0 * groundNormal[1] - groundNormal[0] * groundNormal[2], - 5.0 * groundNormal[0] - groundNormal[2] * groundNormal[1], groundNormal[1] * groundNormal[1] + groundNormal[0] * groundNormal[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
float NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
vec3 mainLightIrradianceComponent = NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),p.uniforms.add(new u.FloatBindUniform("lightingSpecularStrength",(e=>e.lighting.mainLight.specularStrength)),new u.FloatBindUniform("lightingEnvironmentStrength",(e=>e.lighting.mainLight.environmentStrength))).code.add(d.glsl`vec3 horizonRingDir = inputs.RdotNG * groundNormal - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
float NdotH = clamp(dot(normal, h), 0.0, 1.0);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE);`),p.code.add(d.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission.rgb == vec3(0.0) ? _emission.rgb : tonemapACES(pow(_emission.rgb, vec3(GAMMA_SRGB)));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${S?d.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:d.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case a.PBRMode.Simplified:case a.PBRMode.TerrainWithWater:s.addMainLightDirection(p),s.addMainLightIntensity(p),p.code.add(d.glsl`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);default:case a.PBRMode.COUNT:}},e.addAmbientBoostFactor=m,e.addLightingGlobalFactor=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["exports","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../chunks/vec42","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","./PhysicallyBasedRenderingParameters.glsl","../../shaderModules/Float3BindUniform","../../shaderModules/Float4BindUniform","../../shaderModules/glsl"],(function(e,t,r,i,o,s,n,a,l){"use strict";const c=r.create(),u=o.create();e.EvaluateAmbientLighting=function(e,r){const o=e.fragment,d=void 0!==r.lightingSphericalHarmonicsOrder?r.lightingSphericalHarmonicsOrder:2;0===d?(o.uniforms.add(new n.Float3BindUniform("lightingAmbientSH0",(({lighting:e})=>t.set(c,e.sh.r[0],e.sh.g[0],e.sh.b[0])))),o.code.add(l.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===d?(o.uniforms.add(new a.Float4BindUniform("lightingAmbientSH_R",(({lighting:e})=>i.set(u,e.sh.r[0],e.sh.r[1],e.sh.r[2],e.sh.r[3]))),new a.Float4BindUniform("lightingAmbientSH_G",(({lighting:e})=>i.set(u,e.sh.g[0],e.sh.g[1],e.sh.g[2],e.sh.g[3]))),new a.Float4BindUniform("lightingAmbientSH_B",(({lighting:e})=>i.set(u,e.sh.b[0],e.sh.b[1],e.sh.b[2],e.sh.b[3])))),o.code.add(l.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===d&&(o.uniforms.add(new n.Float3BindUniform("lightingAmbientSH0",(({lighting:e})=>t.set(c,e.sh.r[0],e.sh.g[0],e.sh.b[0]))),new a.Float4BindUniform("lightingAmbientSH_R1",(({lighting:e})=>i.set(u,e.sh.r[1],e.sh.r[2],e.sh.r[3],e.sh.r[4]))),new a.Float4BindUniform("lightingAmbientSH_G1",(({lighting:e})=>i.set(u,e.sh.g[1],e.sh.g[2],e.sh.g[3],e.sh.g[4]))),new a.Float4BindUniform("lightingAmbientSH_B1",(({lighting:e})=>i.set(u,e.sh.b[1],e.sh.b[2],e.sh.b[3],e.sh.b[4]))),new a.Float4BindUniform("lightingAmbientSH_R2",(({lighting:e})=>i.set(u,e.sh.r[5],e.sh.r[6],e.sh.r[7],e.sh.r[8]))),new a.Float4BindUniform("lightingAmbientSH_G2",(({lighting:e})=>i.set(u,e.sh.g[5],e.sh.g[6],e.sh.g[7],e.sh.g[8]))),new a.Float4BindUniform("lightingAmbientSH_B2",(({lighting:e})=>i.set(u,e.sh.b[5],e.sh.b[6],e.sh.b[7],e.sh.b[8])))),o.code.add(l.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),r.pbrMode!==s.PBRMode.Normal&&r.pbrMode!==s.PBRMode.Schematic||o.code.add(l.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3BindUniform","../../shaderModules/glsl"],(function(e,t,r){"use strict";function i(e){e.uniforms.add(new t.Float3BindUniform("mainLightDirection",(e=>e.lighting.mainLight.direction)))}function o(e){e.uniforms.add(new t.Float3BindUniform("mainLightIntensity",(e=>e.lighting.mainLight.intensity)))}e.addMainLightDirection=i,e.addMainLightIntensity=o,e.applyShading=function(e){i(e.fragment),o(e.fragment),e.fragment.code.add(r.glsl`vec3 applyShading(vec3 shadingNormal, float shadow) {
float dotVal = clamp(dot(shadingNormal, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/glsl"],(function(e,t,r,i,o){"use strict";e.PhysicallyBasedRendering=function(e,s){e.include(i.PiUtils),s.pbrMode!==r.PBRMode.Normal&&s.pbrMode!==r.PBRMode.Schematic&&s.pbrMode!==r.PBRMode.Simplified&&s.pbrMode!==r.PBRMode.TerrainWithWater||(e.code.add(o.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),e.code.add(o.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),s.pbrMode!==r.PBRMode.Normal&&s.pbrMode!==r.PBRMode.Schematic||(e.include(t.AnalyticalSkyModel),e.code.add(o.glsl`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),e.code.add(o.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`))},e.PhysicallyBasedRenderingWater=function(e,t){e.include(i.PiUtils),e.code.add(o.glsl`
  struct PBRShadingWater {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),e.code.add(o.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),e.code.add(o.glsl`float normalDistributionWater(float NdotH, float roughness) {
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),e.code.add(o.glsl`float geometricOcclusionKelemen(float LoH) {
return 0.25 / (LoH * LoH);
}`),e.code.add(o.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max) {
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/glsl"],(function(e,t){"use strict";e.AnalyticalSkyModel=function(e){e.code.add(t.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG) {
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.code.add(t.glsl`float integratedRadiance(float cosTheta2, float roughness) {
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.code.add(t.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness) {
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports"],(function(e){"use strict";e.PiUtils=function(e){const t=.3183098861837907;e.constants.add("PI","float",3.141592653589793),e.constants.add("LIGHT_NORMALIZATION","float",t),e.constants.add("INV_PI","float",t),e.constants.add("HALF_PI","float",1.570796326794897),e.constants.add("TWO_PI","float",6.28318530717958)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/BooleanBindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"bool",t.BindType.Bind,((t,i)=>t.setUniform1b(e,r(i))))}}e.BooleanBindUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./Lightsources","./SphericalHarmonics"],(function(e,t,r,i,o,s){"use strict";class n{constructor(){this.color=i.create(),this.intensity=1}}class a{constructor(){this.direction=i.create(),this.ambient=new n,this.diffuse=new n}}const l=i.create();e.SceneLighting=class{constructor(){this._shOrder=2,this._legacy=new a,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new o.SphericalHarmonicsAmbientLight,this._mainLight=new o.MainLight(i.create(),i.fromValues(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){s.combineLights(e,this._shOrder,this._mainLight,this._sphericalHarmonics),r.copy(this._legacy.direction,this._mainLight.direction);const t=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,r.scale(this._legacy.diffuse.color,this._mainLight.intensity,t),r.copy(l,this._legacy.diffuse.color),r.scale(l,l,.4*this.globalFactor),r.add(this._legacy.ambient.color,this._legacy.ambient.color,l)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),r.copy(this._mainLight.direction,e.mainLight.direction),r.copy(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,o){if(r.lerp(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,o),this._mainLight.environmentStrength=t.lerp(e.mainLight.environmentStrength,i.mainLight.environmentStrength,o),this._mainLight.specularStrength=t.lerp(e.mainLight.specularStrength,i.mainLight.specularStrength,o),r.copy(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=t.lerp(e.globalFactor,i.globalFactor,o),this.noonFactor=t.lerp(e.noonFactor,i.noonFactor,o),e.sh.r.length===i.sh.r.length)for(let r=0;r<i.sh.r.length;r++)this._sphericalHarmonics.r[r]=t.lerp(e.sh.r[r],i.sh.r[r],o),this._sphericalHarmonics.g[r]=t.lerp(e.sh.g[r],i.sh.g[r],o),this._sphericalHarmonics.b[r]=t.lerp(e.sh.b[r],i.sh.b[r],o);else for(let e=0;e<i.sh.r.length;e++)this._sphericalHarmonics.r[e]=i.sh.r[e],this._sphericalHarmonics.g[e]=i.sh.g[e],this._sphericalHarmonics.b[e]=i.sh.b[e]}},e.SunLight=a,e.ambientBoost=.4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64"],(function(e,t){"use strict";e.AmbientLight=class{constructor(e=t.zeros()){this.intensity=e}},e.FillLight=class{constructor(e=t.zeros(),r=t.fromValues(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},e.MainLight=class{constructor(e=t.zeros(),r=t.fromValues(.57735,.57735,.57735),i=!0,o=1,s=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=o,this.environmentStrength=s}},e.SphericalHarmonicsAmbientLight=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../lib/LongVectorMath","./Lightsources"],(function(e,t,r,i,o,s){"use strict";function n(e){return(e+1)*(e+1)}function a(e){return t.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function l(e,t,r){const i=e[0],o=e[1],s=e[2],a=r||[];return a.length=n(t),t>=0&&(a[0]=.28209479177),t>=1&&(a[1]=.4886025119*i,a[2]=.4886025119*s,a[3]=.4886025119*o),t>=2&&(a[4]=1.09254843059*i*o,a[5]=1.09254843059*o*s,a[6]=.31539156525*(3*s*s-1),a[7]=1.09254843059*i*s,a[8]=.54627421529*(i*i-o*o)),a}function c(e,t){const r=n(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let e=0;e<r;e++)i.r[e]=i.g[e]=i.b[e]=0;return i}function u(e,t){const i=a(t.r.length);for(const s of e)r.negate(g,s.direction),l(g,i,m),o.elementwiseProduct(m,b),o.scalarProduct(m,s.intensity[0],y),o.add(t.r,y),o.scalarProduct(m,s.intensity[1],y),o.add(t.g,y),o.scalarProduct(m,s.intensity[2],y),o.add(t.b,y);return t}function d(e,t){l(g,0,m);for(const r of e)t.r[0]+=m[0]*b[0]*r.intensity[0]*4*Math.PI,t.g[0]+=m[0]*b[0]*r.intensity[1]*4*Math.PI,t.b[0]+=m[0]*b[0]*r.intensity[2]*4*Math.PI;return t}const p=[],h=[],f=[],m=[0],y=[0],g=i.create(),b=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];e.combineLights=function(e,t,i,n){c(t,n),r.set(i.intensity,0,0,0);let a=!1;const l=p,m=h,y=f;l.length=0,m.length=0,y.length=0;for(const t of e)t instanceof s.MainLight&&!a?(r.copy(i.direction,t.direction),r.copy(i.intensity,t.intensity),i.specularStrength=t.specularStrength,i.environmentStrength=t.environmentStrength,i.castShadows=t.castShadows,a=!0):t instanceof s.MainLight||t instanceof s.FillLight?l.push(t):t instanceof s.AmbientLight?m.push(t):t instanceof s.SphericalHarmonicsAmbientLight&&y.push(t);u(l,n),d(m,n);for(const e of y)o.add(n.r,e.r),o.add(n.g,e.g),o.add(n.b,e.b)},e.computeCoefficients=l,e.initSHCoefficients=c,e.numberOfCoefficients=n,e.orderFromNumberOfCoefficients=a,e.projectAmbientLights=d,e.projectFillLights=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],(function(e){"use strict";e.add=function(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r},e.dotProduct=function(e,t){let r=0;for(let i=0;i<e.length;i++)r+=e[i]*t[i];return r},e.elementwiseProduct=function(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r},e.scalarProduct=function(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/BlackLevelLightSoftCompression.glsl":function(){define(["exports","../core/shaderModules/glsl"],(function(e,t){"use strict";e.BlackLevelLightSoftCompression=function(e){e.code.add(t.glsl`float mapChannel(float x, vec2 p) {
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),e.code.add(t.glsl`vec3 blackLevelSoftCompression(vec3 color, float averageAmbientRadiance) {
vec2 p = vec2(0.02, 0.0075) * averageAmbientRadiance;
return vec3(mapChannel(color.x, p), mapChannel(color.y, p), mapChannel(color.z, p));
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/ToneMapping.glsl":function(){define(["exports","../core/shaderModules/glsl"],(function(e,t){"use strict";e.ToneMapping=function(e){e.code.add(t.glsl`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","./calculateUVZShadow.glsl","./ShadowmapFiltering.glsl","../../shaderModules/glsl","../../shaderModules/Texture2DShadowBindUniform","../../../../../webgl/NoParameters"],(function(e,t,r,i,o,s,n){"use strict";class a extends r.ReadShadowMapOrigin{}class l extends n.NoParameters{constructor(){super(...arguments),this.origin=t.create()}}function c(e){e.include(i.ShadowmapFiltering);const{fragment:t}=e;t.uniforms.add(new s.Texture2DShadowBindUniform("shadowMap",(e=>e.shadowMap.depthTexture))),t.code.add(o.glsl`float readShadowMap(const in vec3 _worldPos, float _linearDepth) {
vec3 uvzShadow = calculateUVZShadow(_worldPos, _linearDepth, textureSize(shadowMap,0));
if (uvzShadow.z < 0.0) {
return 0.0;
}
return readShadowMapUVZ(uvzShadow, shadowMap);
}`)}e.ReadShadowMapDraw=function(e,t){t.receiveShadows&&(e.include(r.calculateUVZShadowDraw),c(e))},e.ReadShadowMapDrawParameters=a,e.ReadShadowMapPass=function(e,t){t.receiveShadows&&(e.include(r.calculateUVZShadowPass),c(e))},e.ReadShadowMapPassParameters=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/calculateUVZShadow.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../shaderModules/Float4BindUniform","../../shaderModules/glsl","../../shaderModules/IntegerBindUniform","../../shaderModules/Matrix4sDrawUniform","../../shaderModules/Matrix4sPassUniform","../../../../../webgl/NoParameters"],(function(e,t,r,i,o,s,n,a){"use strict";class l extends a.NoParameters{constructor(){super(...arguments),this.origin=t.create()}}function c(e){const{fragment:t}=e;t.uniforms.add(new r.Float4BindUniform("cascadeDistances",(e=>e.shadowMap.cascadeDistances)),new o.IntegerBindUniform("numCascades",(e=>e.shadowMap.numCascades))),t.code.add(i.glsl`const vec3 invalidShadowmapUVZ = vec3(0.0, 0.0, -1.0);
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
vec3 calculateUVZShadow(in vec3 _worldPos, in float _linearDepth, in ivec2 shadowMapSize) {
int i = _linearDepth < cascadeDistances[1] ? 0 : _linearDepth < cascadeDistances[2] ? 1 : _linearDepth < cascadeDistances[3] ? 2 : 3;
if (i >= numCascades) {
return invalidShadowmapUVZ;
}
mat4 shadowMatrix = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
vec3 lvpos = lightSpacePosition(_worldPos, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
return invalidShadowmapUVZ;
}
vec2 uvShadow = cascadeCoordinates(i, shadowMapSize, lvpos);
return vec3(uvShadow, lvpos.z);
}`)}e.ReadShadowMapOrigin=l,e.calculateUVZShadowDraw=function(e){e.fragment.uniforms.add(new s.Matrix4sDrawUniform("shadowMapMatrix",((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),c(e)},e.calculateUVZShadowPass=function(e){e.fragment.uniforms.add(new n.Matrix4sPassUniform("shadowMapMatrix",((e,t)=>t.shadowMap.getShadowMapMatrices(e.origin)),4)),c(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r,i){super(e,"mat4",t.BindType.Draw,((t,i,o,s)=>t.setUniformMatrix4fv(e,r(i,o,s))),i)}}e.Matrix4sDrawUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r,i){super(e,"mat4",t.BindType.Pass,((t,i,o)=>t.setUniformMatrix4fv(e,r(i,o))),i)}}e.Matrix4sPassUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ShadowmapFiltering.glsl":function(){define(["exports","./calculateUVZShadow.glsl","../../shaderModules/glsl"],(function(e,t,r){"use strict";class i extends t.ReadShadowMapOrigin{}e.ReadShadowMapDrawParameters=i,e.ShadowmapFiltering=function(e){e.fragment.code.add(r.glsl`float readShadowMapUVZ(vec3 uvzShadow, sampler2DShadow _shadowMap) {
return texture(_shadowMap, uvzShadow);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DShadowBindUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"sampler2DShadow",t.BindType.Bind,((t,i)=>t.bindTexture(e,r(i))))}}e.Texture2DShadowBindUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl":function(){define(["exports","../output/ReadDepth.glsl","../../shaderModules/glsl","../../shaderModules/Texture2DBindUniform"],(function(e,t,r,i){"use strict";e.terrainDepthTest=function(e,{occlusionPass:o,terrainDepthTest:s,cullAboveTerrain:n}){const{vertex:a,fragment:l,varyings:c}=e;if(!s)return a.code.add("void forwardViewPosDepth(vec3 pos) {}"),void l.code.add(`${o?"bool":"void"} discardByTerrainDepth() { ${r.If(o,"return false;")}}`);c.add("viewPosDepth","float",{invariant:!0}),a.code.add("void forwardViewPosDepth(vec3 pos) {\n    viewPosDepth = pos.z;\n  }"),l.include(t.ReadDepth),l.uniforms.add(new i.Texture2DBindUniform("terrainDepthTexture",(e=>e.terrainDepth?.attachment))).code.add(r.glsl`
    ${o?"bool":"void"} discardByTerrainDepth() {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${o?"return viewPosDepth < linearDepth && depth < 1.0;":`if(viewPosDepth ${n?">":"<="} linearDepth) discard;`}
    }`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../attributes/TextureCoordinateAttribute.glsl","../../shaderModules/glsl","../../shaderModules/Matrix3PassUniform"],(function(e,t,r,i,o){"use strict";e.colorTextureUV=function(e,r){r.hasColorTextureTransform?(e.varyings.add("colorUV","vec2"),e.vertex.uniforms.add(new o.Matrix3PassUniform("colorTextureTransformMatrix",(e=>e.colorTextureTransformMatrix??t.IDENTITY))).code.add(i.glsl`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(i.glsl`void forwardColorUV(){}`)},e.emissiveTextureUV=function(e,s){s.hasEmissionTextureTransform&&s.textureCoordinateType!==r.TextureCoordinateType.None?(e.varyings.add("emissiveUV","vec2"),e.vertex.uniforms.add(new o.Matrix3PassUniform("emissiveTextureTransformMatrix",(e=>e.emissiveTextureTransformMatrix??t.IDENTITY))).code.add(i.glsl`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(i.glsl`void forwardEmissiveUV(){}`)},e.metallicRoughnessTextureUV=function(e,s){s.hasMetallicRoughnessTextureTransform&&s.textureCoordinateType!==r.TextureCoordinateType.None?(e.varyings.add("metallicRoughnessUV","vec2"),e.vertex.uniforms.add(new o.Matrix3PassUniform("metallicRoughnessTextureTransformMatrix",(e=>e.metallicRoughnessTextureTransformMatrix??t.IDENTITY))).code.add(i.glsl`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(i.glsl`void forwardMetallicRoughnessUV(){}`)},e.normalTextureUV=function(e,s){s.hasNormalTextureTransform&&s.textureCoordinateType!==r.TextureCoordinateType.None?(e.varyings.add("normalUV","vec2"),e.vertex.uniforms.add(new o.Matrix3PassUniform("normalTextureTransformMatrix",(e=>e.normalTextureTransformMatrix??t.IDENTITY))).code.add(i.glsl`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(i.glsl`void forwardNormalUV(){}`)},e.occlusionTextureUV=function(e,s){s.hasOcclusionTextureTransform&&s.textureCoordinateType!==r.TextureCoordinateType.None?(e.varyings.add("occlusionUV","vec2"),e.vertex.uniforms.add(new o.Matrix3PassUniform("occlusionTextureTransformMatrix",(e=>e.occlusionTextureTransformMatrix??t.IDENTITY))).code.add(i.glsl`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(i.glsl`void forwardOcclusionUV(){}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/glsl"],(function(e,t,r,i){"use strict";e.MixExternalColor=function(e){e.include(r.ColorConversion),e.code.add(i.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${i.glsl.int(t.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${i.glsl.int(t.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${i.glsl.int(t.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${i.glsl.int(t.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${i.glsl.int(t.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/glsl"],(function(e,t){"use strict";e.ColorConversion=function(e){e.code.add(t.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/effects/weather/SnowCover.glsl":function(){define(["exports","../../core/shaderModules/glsl"],(function(e,t){"use strict";e.SnowCover=function(e,r){r.snowCover&&(e.code.add(t.glsl`float getSnow(vec3 normal, vec3 normalGround) {
return smoothstep(0.5, 0.55, dot(normal, normalGround));
}`),e.code.add(t.glsl`vec3 applySnowToMRR(vec3 mrr, float snow) {
return mix(mrr, vec3(0.0, 1.0, 0.04), snow);
}
vec4 snowCoverForEmissions(vec4 emission, float snow) {
return mix(emission, vec4(0.0), snow);
}`))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl":function(){define(["exports","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/output/Emissions.glsl","../core/shaderLibrary/output/OutputHighlight.glsl","../core/shaderLibrary/util/ColorConversion.glsl","../core/shaderModules/glsl","../lib/OITPass","../../../../webscene/support/AlphaCutoff"],(function(e,t,r,i,o,s,n,a){"use strict";e.outputColorHighlightOID=function(e,l){e.include(i.OutputHighlight,l),e.include(r.Emissions,l),e.fragment.include(o.ColorConversion);const{output:c,oitPass:u,discardInvisibleFragments:d,snowCover:p}=l,h=c===t.ShaderOutput.ObjectAndLayerIdColor,f=t.isColorEmission(c),m=t.isColorOrColorEmission(c)&&u===n.OITPass.ColorAlpha,y=t.isColorOrColorEmission(c)&&u!==n.OITPass.ColorAlpha;let g=0;(y||f||m)&&e.outputs.add("fragColor","vec4",g++),f&&e.outputs.add("fragEmission","vec4",g++),m&&e.outputs.add("fragAlpha","float",g++),e.fragment.code.add(s.glsl`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition, vec3 emissiveBaseColor ${s.If(p,", float snow")}) {
      ${s.If(h,"finalColor.a = 1.0;")}

      ${s.If(d,`if (finalColor.a < ${s.glsl.float(a.alphaCutoff)}) { discard; }`)}

      finalColor = applySlice(finalColor, vWorldPosition);
      ${s.If(m,s.glsl`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${s.If(y,"fragColor = finalColor;")}
      ${s.If(f,`fragEmission = ${s.If(p,"mix(finalColor.a * getEmissions(emissiveBaseColor), vec4(0.0), snow);","finalColor.a * getEmissions(emissiveBaseColor);")}`)}
      calculateOcclusionAndOutputHighlight();
      ${s.If(h,"outputObjectAndLayerIdColor();")}
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/attributes/NormalAttribute.glsl","../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../core/shaderLibrary/output/Emissions.glsl","../core/shaderLibrary/shading/Normals.glsl","../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/basicInterfaces","../materials/DefaultTechniqueConfiguration"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";class u extends c.DefaultTechniqueConfiguration{constructor(e){super(),this.spherical=e,this.alphaDiscardMode=l.AlphaDiscardMode.Opaque,this.doubleSidedMode=s.NormalsDoubleSidedMode.None,this.pbrMode=n.PBRMode.Disabled,this.cullFace=l.CullFaceOptions.None,this.normalType=r.NormalType.Attribute,this.customDepthTest=l.DepthTestFunction.Less,this.emissionSource=o.EmissionSource.None,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasBloom=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.hasVvInstancing=!0,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0,this.draped=!1}get textureCoordinateType(){return this.hasColorTexture||this.hasMetallicRoughnessTexture||this.emissionSource===o.EmissionSource.Texture||this.hasOcclusionTexture||this.hasNormalTexture?i.TextureCoordinateType.Default:i.TextureCoordinateType.None}get objectAndLayerIdColorInstanced(){return this.instanced}get discardInvisibleFragments(){return this.transparent}}t.__decorate([a.parameter({count:l.AlphaDiscardMode.COUNT})],u.prototype,"alphaDiscardMode",void 0),t.__decorate([a.parameter({count:s.NormalsDoubleSidedMode.COUNT})],u.prototype,"doubleSidedMode",void 0),t.__decorate([a.parameter({count:n.PBRMode.COUNT})],u.prototype,"pbrMode",void 0),t.__decorate([a.parameter({count:l.CullFaceOptions.COUNT})],u.prototype,"cullFace",void 0),t.__decorate([a.parameter({count:r.NormalType.COUNT})],u.prototype,"normalType",void 0),t.__decorate([a.parameter({count:l.DepthTestFunction.COUNT})],u.prototype,"customDepthTest",void 0),t.__decorate([a.parameter({count:o.EmissionSource.COUNT})],u.prototype,"emissionSource",void 0),t.__decorate([a.parameter()],u.prototype,"hasVertexColors",void 0),t.__decorate([a.parameter()],u.prototype,"hasSymbolColors",void 0),t.__decorate([a.parameter()],u.prototype,"hasVerticalOffset",void 0),t.__decorate([a.parameter()],u.prototype,"hasColorTexture",void 0),t.__decorate([a.parameter()],u.prototype,"hasMetallicRoughnessTexture",void 0),t.__decorate([a.parameter()],u.prototype,"hasOcclusionTexture",void 0),t.__decorate([a.parameter()],u.prototype,"hasNormalTexture",void 0),t.__decorate([a.parameter()],u.prototype,"hasScreenSizePerspective",void 0),t.__decorate([a.parameter()],u.prototype,"hasVertexTangents",void 0),t.__decorate([a.parameter()],u.prototype,"hasOccludees",void 0),t.__decorate([a.parameter()],u.prototype,"instancedDoublePrecision",void 0),t.__decorate([a.parameter()],u.prototype,"hasModelTransformation",void 0),t.__decorate([a.parameter()],u.prototype,"offsetBackfaces",void 0),t.__decorate([a.parameter()],u.prototype,"vvSize",void 0),t.__decorate([a.parameter()],u.prototype,"vvColor",void 0),t.__decorate([a.parameter()],u.prototype,"receiveShadows",void 0),t.__decorate([a.parameter()],u.prototype,"receiveAmbientOcclusion",void 0),t.__decorate([a.parameter()],u.prototype,"textureAlphaPremultiplied",void 0),t.__decorate([a.parameter()],u.prototype,"instanced",void 0),t.__decorate([a.parameter()],u.prototype,"instancedColor",void 0),t.__decorate([a.parameter()],u.prototype,"writeDepth",void 0),t.__decorate([a.parameter()],u.prototype,"transparent",void 0),t.__decorate([a.parameter()],u.prototype,"enableOffset",void 0),t.__decorate([a.parameter()],u.prototype,"terrainDepthTest",void 0),t.__decorate([a.parameter()],u.prototype,"cullAboveTerrain",void 0),t.__decorate([a.parameter()],u.prototype,"snowCover",void 0),t.__decorate([a.parameter()],u.prototype,"hasBloom",void 0),t.__decorate([a.parameter()],u.prototype,"hasColorTextureTransform",void 0),t.__decorate([a.parameter()],u.prototype,"hasEmissionTextureTransform",void 0),t.__decorate([a.parameter()],u.prototype,"hasNormalTextureTransform",void 0),t.__decorate([a.parameter()],u.prototype,"hasOcclusionTextureTransform",void 0),t.__decorate([a.parameter()],u.prototype,"hasMetallicRoughnessTextureTransform",void 0),e.DefaultMaterialTechniqueConfiguration=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define(["require","exports","../core/shaderTechnique/ReloadableShaderModule","./DefaultMaterialTechnique","../../../../chunks/RealisticTree.glsl"],(function(e,t,r,i,o){"use strict";class s extends i.DefaultMaterialTechnique{constructor(t,i){super(t,i,new r.ReloadableShaderModule(o.RealisticTree,(()=>new Promise(((t,r)=>e(["./RealisticTree.glsl"],t,r)))))),this.type="RealisticTreeTechnique"}}t.RealisticTreeTechnique=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/RealisticTree.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl","../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl","../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput","../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl","../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl","../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlpha.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl","../views/3d/webgl-engine/core/shaderModules/Float3PassUniform","../views/3d/webgl-engine/core/shaderModules/Float4PassUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform","../views/3d/webgl-engine/lib/VertexAttribute","../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl","../views/webgl/ShaderBuilder","../webscene/support/AlphaCutoff"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x,w,T,M,I,P,O,C,A,E,R){"use strict";function F(e){const F=new E.ShaderBuilder,{attributes:D,vertex:L,fragment:V,varyings:N}=F,{output:B,offsetBackfaces:U,instancedColor:z,pbrMode:j,snowCover:k,spherical:G,hasBloom:q}=e,H=j===g.PBRMode.Normal||j===g.PBRMode.Schematic;if(w.addProjViewLocalOrigin(L,e),D.add(C.VertexAttribute.POSITION,"vec3"),N.add("vpos","vec3",{invariant:!0}),F.include(S.VisualVariables,e),F.include(n.InstancedDoublePrecision,e),F.include(d.VerticalOffset,e),F.include(v.terrainDepthTest,e),i.isColorOrColorEmission(B)&&(w.addCameraPosition(F.vertex,e),F.include(a.NormalAttribute,e),F.include(s.Transform,e),U&&F.include(r.Offset),z&&F.attributes.add(C.VertexAttribute.INSTANCECOLOR,"vec4"),N.add("vNormalWorld","vec3"),N.add("localvpos","vec3",{invariant:!0}),F.include(c.TextureCoordinateAttribute,e),F.include(t.ForwardLinearDepth,e),F.include(l.SymbolColor,e),F.include(u.VertexColor,e),L.uniforms.add(new M.Float4PassUniform("externalColor",(e=>e.externalColor))),N.add("vcolorExt","vec4"),L.main.add(P.glsl`
      forwardNormalizedVertexColor();
      vcolorExt = externalColor;
      ${P.If(z,"vcolorExt *= instanceColor * 0.003921568627451;")}
      vcolorExt *= vvColor();
      vcolorExt *= getSymbolColor();
      forwardColorMixMode();

      bool alphaCut = vcolorExt.a < ${P.glsl.float(R.alphaCutoff)};
      vpos = getVertexInLocalOriginSpace();
      localvpos = vpos - view[3].xyz;
      vpos = subtractOrigin(vpos);
      vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
      vpos = addVerticalOffset(vpos, localOrigin);
      vec4 basePosition = transformPosition(proj, view, vpos);

      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      forwardLinearDepth();
      forwardTextureCoordinates();

      gl_Position = alphaCut ? vec4(1e38, 1e38, 1e38, 1.0) :
      ${P.If(U,"offsetBackfacingClipPosition(basePosition, vpos, vNormalWorld, cameraPosition);","basePosition;")}
    `)),i.isColorOrColorEmission(B)){const{hasColorTexture:t,hasColorTextureTransform:r,receiveShadows:i}=e;F.include(f.EvaluateSceneLighting,e),V.include(h.EvaluateAmbientOcclusion,e),F.include(_.DiscardOrAdjustAlphaPass,e),F.include(e.instancedDoublePrecision?b.ReadShadowMapPass:b.ReadShadowMapDraw,e),V.include(o.SliceDraw,e),F.include(A.outputColorHighlightOID,e),w.addCameraPosition(V,e),m.addMainLightDirection(V),f.addAmbientBoostFactor(V),f.addLightingGlobalFactor(V),V.uniforms.add(L.uniforms.get("localOrigin"),L.uniforms.get("view"),new T.Float3PassUniform("ambient",(e=>e.ambient)),new T.Float3PassUniform("diffuse",(e=>e.diffuse)),new I.FloatPassUniform("opacity",(e=>e.opacity)),new I.FloatPassUniform("layerOpacity",(e=>e.layerOpacity))),t&&V.uniforms.add(new O.Texture2DPassUniform("tex",(e=>e.texture))),F.include(g.PhysicallyBasedRenderingParameters,e),V.include(y.PhysicallyBasedRendering,e),V.include(x.MixExternalColor),m.addMainLightIntensity(V),V.main.add(P.glsl`
      discardBySlice(vpos);
      discardByTerrainDepth();
      vec4 texColor = ${t?`texture(tex, ${r?"colorUV":"vuv0"})`:" vec4(1.0)"};
      ${P.If(t,`${P.If(e.textureAlphaPremultiplied,"texColor.rgb /= texColor.a;")}\n        discardOrAdjustAlpha(texColor);`)}
      vec3 viewDirection = normalize(vpos - cameraPosition);
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse();
      ssao *= getBakedOcclusion();

      float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
      float shadow = ${i?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":G?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};
      vec3 matColor = max(ambient, diffuse);
      ${e.hasVertexColors?P.glsl`vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:P.glsl`vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
             float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
      ${P.If(k,"albedo = mix(albedo, vec3(1), 0.9);")}
      ${P.glsl`vec3 shadingNormal = normalize(vNormalWorld);
             albedo *= 1.2;
             vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
             float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
             float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
             float treeRadialFalloff = vColor.r;
             float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
             additionalLight += backLightFactor * mainLightIntensity;`}
      ${P.If(H,`vec3 normalGround = ${G?"normalize(vpos + localOrigin)":"vec3(0.0, 0.0, 1.0)"};`)}
      ${H?P.glsl`float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                 ${P.If(k,P.glsl`mrr = applySnowToMRR(mrr, 1.0)`)}
            vec4 emission = ${k||q?"vec4(0.0)":"getEmissions(albedo)"};
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:P.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos, albedo ${P.If(k,", 1.0")});`)}return F.include(p.DefaultMaterialAuxiliaryPasses,e),F}const D=Object.freeze(Object.defineProperty({__proto__:null,build:F},Symbol.toStringTag,{value:"Module"}));e.RealisticTree=D,e.build=F}))},"esri/views/3d/layers/graphics/pipeline/Tile3DManager":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/arrayUtils","../../../../../core/asyncUtils","../../../../../core/has","../../../../../core/promiseUtils","../../../../../core/ReactiveMap","../../../../../core/reactiveUtils","../../../../../core/scheduling","../../../../../core/accessorSupport/decorators/property","../../../../../core/Logger","../../../../../core/accessorSupport/decorators/subclass","../../../../../geometry/support/aaBoundingRect","./PipelineCommand","./featureData/FeatureData"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";function y({lij:[e,t,r]},{lij:[i,o,s]}){const n=i-e;return n>=0&&t===o>>n&&r===s>>n}e.Tile3DManager=class extends r{constructor(e){super(e),this.extent=null,this._tileHandles=new a,this._wanted=new a,this._updateRequested=!1,this._synchronizationTask=null,this._requestedTiles=new Array}destroy(){this._tileHandles.clear(),this._wanted.clear()}get updating(){return this._updateRequested||!(this._synchronizationTask?.finished??1)}get _boundingRect(){const{extent:e}=this;return null==e?null:h.fromExtent(e)}get _missingTiles(){const e=new Array,t=this._wanted,r=this._tileHandles;for(const i of t.values())null==r.get(i.id)?.featureData&&e.push(i);return e}onTileTreeChange({tiles:e}){this._requestedTiles=e,this._scheduleTilesSync()}_scheduleTilesSync(){if(this._updateRequested)return;this._updateRequested=!0;const e=this._synchronizationTask,t=o.createTask((async()=>{try{await l.whenOnce((()=>e?.finished??!0)),await c.waitTick(),this._updateRequested=!1,await this._synchronizeTiles()}finally{this._synchronizationTask===t&&(this._synchronizationTask=null)}}));this._synchronizationTask=t}async _synchronizeTiles(){const e=this._requestedTiles,t=this._tileHandles,r=new Array;for(const i of e)t.has(i.id)||r.push(i);const i=new Array;for(const r of t.values()){const{id:t}=r;e.every((e=>e.id!==t))&&i.push(r.descriptor)}const o=this._tileHandles,{_boundingRect:s}=this,n=null!=s?r.filter((e=>h.intersects(s,e.extent))):r,a=this._wanted,l=new Array;for(const{id:e}of i)a.delete(e);for(const e of n)a.set(e.id,e);const c=this._missingTiles;for(const e of i){const{id:t}=e;if(c.some((t=>y(t,e)||y(e,t))))continue;const r=o.get(t);null!=r&&l.push(this._removeTile(r))}for(const e of n)l.push(this._addTile(e));const u=await Promise.allSettled(l);for(const e of u)"rejected"===e.status&&console.error(e.reason)}forEachTile(e){for(const t of this._tileHandles.values()){const r=t.featureData;null!=r&&e(r)}}*loadedTiles(){for(const e of this._tileHandles.values()){const t=e.featureData;null!=t&&(yield t)}}async _removeTile(e){e.loadTask.abort(),this._tileHandles.delete(e.id),this._validate();const{featureData:r}=e;if(null!=r){const e={stack:[],error:void 0,hasError:!1};try{t.__addDisposableResource(e,await this.tileLocks.lock([r.tileId]),!1);const i=await this.createRemoveCommand(r.id);await(i?.execute())}catch(t){e.error=t,e.hasError=!0}finally{t.__disposeResources(e)}}}async _addTile(e){const{_tileHandles:t}=this,r=t.get(e.id);if(null!=r){if(!b(r)||r.featureData.isFullyEnabled)return;return r.featureData.enableAll(),void await this._onTileLoad(r)}const i=new g(e,o.createTask((async t=>{const r=await this.loadTile(e,t);return n.throwIfAborted(t),new m.FeatureData(r)})));this._tileHandles.set(i.id,i);try{await i.loadTask.promise}catch(e){return void n.throwIfNotAbortError(e)}!function(e){if(!b(e))throw new Error}(i),await this._onTileLoad(i)}async _onTileLoad(e){const r={stack:[],error:void 0,hasError:!1};try{const{_wanted:o,_tileHandles:s,_missingTiles:n}=this,a=e.descriptor,l=new Array,c=new Array,u=new Array,d=new Set;for(const t of s.values()){if(t===e)continue;const{descriptor:r,id:i}=t;if(o.has(i)||n.some((e=>y(e,r)||y(r,e)))){if(b(t)){if(y(a,r)){const e=t.featureData;for(const t of e.objectIds())d.add(t)}if(y(r,a)){const{featureData:e}=t;c.push(e)}}}else{s.delete(i),t.loadTask.abort();const{featureData:e}=t;null!=e&&l.push(e)}}d.size>0&&(e.featureData.disableObjectIds(d),this._validateRemoval(e.featureData,d)),this._validate(),u.push(e.featureData);const p=[...u,...l,...c].map((e=>e.tileId));if(t.__addDisposableResource(r,await this.tileLocks.lock(p),!1),0!==c.length){const t=e.featureData,r=new Set(t.objectIds());for(const e of c)e.disableObjectIds(r),this._validateRemoval(e,r)}const h=l.map((e=>this.createRemoveCommand(e.id))),m=u.map((e=>this.createAddCommand(e))),g=c.map((e=>this.createUpdateCommand(e))),v=await Promise.all([...h,...m,...g]),S=f.joinCommands(v.filter(i.isSome));await(S?.execute())}catch(e){r.error=e,r.hasError=!0}finally{t.__disposeResources(r)}}_validate(){if(!s("feature-pipeline-3d-test-validation"))return;const e=new Array;for(const t of this._tileHandles.values()){if(!b(t))continue;const{featureData:r}=t;e.push({featureData:r,objectIds:new Set(r.enabledObjectIds())})}for(let t=0;t<e.length;++t){const{featureData:r,objectIds:i}=e[t];for(let o=t+1;o<e.length;++o){const{featureData:t,objectIds:s}=e[o];for(const e of s)if(i.has(e))throw new Error(`${r.id} and ${t.id} both contain ${e}.`)}}}_validateRemoval(e,t){if(s("feature-pipeline-3d-test-validation"))for(const r of e.enabledObjectIds())if(t.has(r))throw new Error(`Failed to remove ${r} from ${e.id}!`)}},t.__decorate([u.property()],e.Tile3DManager.prototype,"updating",null),t.__decorate([u.property({constructOnly:!0})],e.Tile3DManager.prototype,"loadTile",void 0),t.__decorate([u.property({constructOnly:!0})],e.Tile3DManager.prototype,"createAddCommand",void 0),t.__decorate([u.property({constructOnly:!0})],e.Tile3DManager.prototype,"createRemoveCommand",void 0),t.__decorate([u.property({constructOnly:!0})],e.Tile3DManager.prototype,"createUpdateCommand",void 0),t.__decorate([u.property({constructOnly:!0})],e.Tile3DManager.prototype,"tileLocks",void 0),t.__decorate([u.property()],e.Tile3DManager.prototype,"extent",void 0),t.__decorate([u.property()],e.Tile3DManager.prototype,"_boundingRect",null),t.__decorate([u.property()],e.Tile3DManager.prototype,"_missingTiles",null),t.__decorate([u.property()],e.Tile3DManager.prototype,"_updateRequested",void 0),t.__decorate([u.property()],e.Tile3DManager.prototype,"_synchronizationTask",void 0),e.Tile3DManager=t.__decorate([p.subclass("esri.views.3d.layers.graphics.pipeline.Tile3DManager")],e.Tile3DManager);class g{constructor(e,t){this.descriptor=e,this.loadTask=t}get id(){return this.descriptor.id}get featureData(){return this.loadTask.value}}function b(e){return null!=e.featureData}Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/asyncUtils":function(){define(["exports","../chunks/tslib.es6","./Accessor","./maybe","./promiseUtils","./accessorSupport/decorators/property","./accessorSupport/decorators/subclass"],(function(e,t,r,i,o,s,n){"use strict";function a(e){return{ok:!0,value:e}}function l(e){return{ok:!1,error:e}}function c(e){return null!=e&&!0===e.ok?e.value:null}function u(e){return null!=e&&!1===e.ok?e.error:null}let d=class extends r{get value(){return c(this._result)}get error(){return u(this._result)}get finished(){return null!=this._result}constructor(e,t){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=i.abortMaybe(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then((e=>{this._result=a(e),this._cleanup()}),(e=>{this._result=l(e),this._cleanup()})),this._abortHandle=o.onAbort(t,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=i.removeMaybe(this._abortHandle),this._abortController=null}};t.__decorate([s.property()],d.prototype,"value",null),t.__decorate([s.property()],d.prototype,"error",null),t.__decorate([s.property()],d.prototype,"finished",null),t.__decorate([s.property()],d.prototype,"promise",void 0),t.__decorate([s.property()],d.prototype,"_result",void 0),d=t.__decorate([n.subclass("esri.core.asyncUtils.ReactiveTask")],d),e.assertResult=function(e){if(!0===e.ok)return e.value;throw e.error},e.createTask=function(e,t){return new d(e,t)},e.forEach=function(e,t,r){return o.eachAlways(e.map(((e,i)=>t.apply(r,[e,i]))))},e.makeResultError=l,e.makeResultOk=a,e.map=async function(e,t,r){return(await o.eachAlways(e.map(((e,i)=>t.apply(r,[e,i]))))).map((e=>e.value))},e.result=async function(e){if(null==e)return{ok:!1,error:new Error("no promise provided")};try{return a(await e)}catch(e){return l(e)}},e.resultError=u,e.resultOrAbort=async function(e){try{return a(await e)}catch(e){return o.throwIfAbortError(e),l(e)}},e.resultValue=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/ReactiveMap":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],(function(e,t){"use strict";class r{constructor(e){this._observable=new t.SimpleObservable,this._map=new Map(e)}get size(){return e.trackAccess(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const t=this._map.delete(e);return t&&this._observable.notify(),t}entries(){return e.trackAccess(this._observable),this._map.entries()}forEach(t,r){e.trackAccess(this._observable),this._map.forEach(((e,i)=>t.call(r,e,i,this)),r)}get(t){return e.trackAccess(this._observable),this._map.get(t)}has(t){return e.trackAccess(this._observable),this._map.has(t)}keys(){return e.trackAccess(this._observable),this._map.keys()}set(e,t){return this._map.set(e,t),this._observable.notify(),this}values(){return e.trackAccess(this._observable),this._map.values()}[Symbol.iterator](){return e.trackAccess(this._observable),this._map[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}return r}))},"esri/views/3d/layers/graphics/pipeline/featureData/FeatureData":function(){define(["exports","../../../../../../core/memoryEstimations","../utils","./FeatureDataSubset"],(function(e,t,r,i){"use strict";e.FeatureData=class{constructor(e){this._tile=e,this.id=r.generateId(`featureData-${e.id}-`),this._enabled=new Array(e.featureCount).fill(!0)}get tileId(){return this._tile.id}get featureCount(){return this._tile.featureCount}get usedMemory(){return t.baseObjectMemory+t.estimateStringMemory(this.id)}get extent(){return this._tile.descriptor.extent}get isFullyEnabled(){return this._enabled.every((e=>e))}getObjectId(e){return this._tile.getObjectId(e)}getAttribute(e,t){return this._tile.getAttribute(e,t)}getAttributeAsTimestamp(e,t){return this._tile.getAttribute(e,t)}getAttributes(e){return this._tile.getAttributes(e)}getCoordinates(e,t,r){return this._tile.getCoordinates(e,t,r)}getOptimizedGeometry(e){return this._tile.getOptimizedGeometry(e)}getCentroid(e,t){return this._tile.getCentroid(e,t)}getBounds(e){return this._tile.getBounds(e)}getBoundingBox(e){return this._tile.getBoundingBox(e)}getObjectIdsArray(e,t,r){return this._tile.getObjectIdsArray(e,t,r)}getCoordinatesArray(e,t,r){return this._tile.getCoordinatesArray(e,t,r)}objectIds(e){return this._tile.objectIds(e)}subset(e){return new i.FeatureDataSubset(this,e)}disableObjectIds(e){if(0===e.size)return;const{_enabled:t}=this,r=new Array;for(const i of this._allFeatureIndices())t[i]&&e.has(this.getObjectId(i))&&r.push(i);if(0!==r.length)for(const e of r)t[e]=!1}setEnabled(e,t){this._enabled[e]=t}getEnabled(e){return this._enabled[e]}enableAll(){this._enabled.fill(!0)}getVisibilityArray(e,t=this._allFeatureIndices(),r=0){const{_enabled:i}=this;for(const o of t)e[r++]=Number(i[o]);return r}*enabledObjectIds(e=this._allFeatureIndices()){const{_enabled:t}=this;for(const r of e)t[r]&&(yield this.getObjectId(r))}*_allFeatureIndices(){const{featureCount:e}=this;for(let t=0;t<e;++t)yield t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/utils":function(){define(["exports","../../../../../core/uid","../../../../../geometry/projection/projectors"],(function(e,t,r){"use strict";const i=new Float64Array(3);e.applyElevationAlignment=function(e,t,o,s,n){const a=s.spatialReference,l=r.getProjector(t,a);if(null==l)return e;let c=t=>[e[t],e[t+1],e[t+2]];l!==r.copy3&&(c=t=>(l(e,t,i,0),[i[0],i[1],i[2]]));const u=e.length/3,d=o.mode;switch(o.mode){case"on-the-ground":for(let t=0;t<u;++t){const r=3*t,[i,o]=c(r);e[r+2]=s.getElevation(i,o,0,s.spatialReference,"ground")??0}break;case"relative-to-ground":case"relative-to-scene":{const t="relative-to-ground"===d?"ground":"scene";for(let r=0;r<u;++r){const i=3*r,[a,l,u]=c(i),d=o.calculateOffsetRenderUnits(n),p=s.getElevation(a,l,0,s.spatialReference,t)??0;e[i+2]=u+d+p}}break;case"absolute-height":for(let t=0;t<u;++t){const r=3*t,i=e[r+2],s=o.calculateOffsetRenderUnits(n);e[r+2]=i+s}}return e},e.generateId=function(e=""){return`${e}${t.generateUID()}`},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/featureData/FeatureDataSubset":function(){define(["exports","../../../../../../core/memoryEstimations","../utils"],(function(e,t,r){"use strict";class i{constructor(e,t){this._parent=e,this._subsetIndices=t,this.id=r.generateId(`featureDataSubset-${e.id}-`)}get tileId(){return this._parent.tileId}get extent(){return this._parent.extent}get featureCount(){return this._subsetIndices.length}get usedMemory(){return this._parent.usedMemory+t.baseObjectMemory+this._subsetIndices.byteLength}get isFullyEnabled(){for(const e of this._subsetIndices)if(!this._parent.getEnabled(e))return!1;return!0}getObjectId(e){return this._parent.getObjectId(this._subsetIndices[e])}getAttribute(e,t){return this._parent.getAttribute(this._subsetIndices[e],t)}getAttributeAsTimestamp(e,t){return this._parent.getAttribute(this._subsetIndices[e],t)}getAttributes(e){return this._parent.getAttributes(this._subsetIndices[e])}getCoordinates(e,t,r){return this._parent.getCoordinates(this._subsetIndices[e],t,r)}getOptimizedGeometry(e){return this._parent.getOptimizedGeometry(this._subsetIndices[e])}getCentroid(e,t){return this._parent.getCentroid(this._subsetIndices[e],t)}getBounds(e){return this._parent.getBounds(this._subsetIndices[e])}getBoundingBox(e){return this._parent.getBoundingBox(this._subsetIndices[e])}getObjectIdsArray(e,t,r){return this._parent.getObjectIdsArray(e,this._translatedIndices(t),r)}getCoordinatesArray(e,t,r){return this._parent.getCoordinatesArray(e,this._translatedIndices(t),r)}objectIds(e){return this._parent.objectIds(this._translatedIndices(e))}subset(e){const{_subsetIndices:t}=this,r=new Uint32Array(e.length);for(let i=0;i<r.length;++i)r[i]=t[e[i]];return new i(this._parent,r)}disableObjectIds(e){if(0===e.size)return;const{featureCount:t}=this,r=new Array;for(let i=0;i<t;++i)this.getEnabled(i)&&e.has(this.getObjectId(i))&&r.push(i);if(0!==r.length)for(const e of r)this.setEnabled(e,!1)}setEnabled(e,t){this._parent.setEnabled(this._subsetIndices[e],t)}getEnabled(e){return this._parent.getEnabled(this._subsetIndices[e])}enableAll(){const{_subsetIndices:e,_parent:t}=this;for(const r of e)t.setEnabled(r,!0)}getVisibilityArray(e,t,r){return this._parent.getVisibilityArray(e,this._translatedIndices(t),r)}enabledObjectIds(e){return this._parent.enabledObjectIds(this._translatedIndices(e))}*_translatedIndices(e){const{_subsetIndices:t}=this;if(null!=e)for(const r of e)yield t[r];else yield*t}}e.FeatureDataSubset=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/TileLocks":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/handleUtils","../../../../../core/promiseUtils"],(function(e,t,r,i){"use strict";e.TileLocks=class{constructor(){this._previousActions=new Map}async lock(e){const{_previousActions:o}=this,s=e.map((e=>o.get(e))).filter(t.isSome),n=Promise.allSettled(s),a=i.createResolver(),l=r.makeHandle((()=>a.resolve())),c=a.promise.finally((()=>{for(const t of e)o.get(t)===c&&o.delete(t)}));for(const t of e)o.set(t,c);return await n,r.disposable(l)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/featureSet/TiledFeatureStore":function(){define(["exports","../../../../../../core/Evented","../../../../../../core/memoryEstimations","../../../../../../core/libs/rbush/PooledRBush","../../../../../../layers/graphics/centroid","../../../../../../layers/graphics/OptimizedGeometry"],(function(e,t,r,i,o,s){"use strict";class n{constructor(e,t){this._index=e,this._view=t}get usedMemory(){return r.baseObjectMemory+r.estimateNumberMemory}getObjectId(){return this._view.getObjectId(this._index)}getAttribute(e){return this._view.getAttribute(this._index,e)}getAttributeAsTimestamp(e){return this._view.getAttributeAsTimestamp(this._index,e)}getAttributes(){return this._view.getAttributes(this._index)}getOptimizedGeometry(){return this._view.getOptimizedGeometry(this._index)}getCentroid(e){return this._view.getCentroid(this._index,e)}getBounds(){return this._view.getBounds(this._index)}getBoundingBox(){return this._view.getBoundingBox(this._index)}cloneWithGeometry(e){return new a(this._index,this._view,e)}}class a extends n{constructor(e,t,r){super(e,t),this._geometryOverride=r}getOptimizedGeometry(){return this._geometryOverride}getCentroid(e){return o.getCentroidOptimizedGeometry(new s,this._geometryOverride,e.hasZ,e.hasM)}}class l{constructor(e,t){this.featureData=e,this.bounds=t}}class c{static{this.shared=new c}getObjectId(e){return e.getObjectId()}getAttribute(e,t){return e.getAttribute(t)}getAttributeAsTimestamp(e,t){return e.getAttributeAsTimestamp(t)}getAttributes(e){return e.getAttributes()}getGeometry(e){return e.getOptimizedGeometry()}getCentroid(e,t){return e.getCentroid(t)}cloneWithGeometry(e,t){return e.cloneWithGeometry(t)}}const u=new i.BBox;e.FeatureHandle=n,e.TiledFeatureStore=class{constructor(){this._tileBounds=new Map,this.events=new t,this.featureAdapter=c.shared}get usedMemory(){return r.baseObjectMemory+r.baseObjectMemory*this._tileBounds.size}addTile(e){const{featureCount:t}=e;if(0===t)return;const r=new i.PooledRBush(9,(t=>e.getBounds(t))),o=new Array;for(let e=0;e<t;++e)o[e]=e;r.load(o),this._tileBounds.set(e.id,new l(e,r)),this.events.emit("changed")}removeTile(e){this._tileBounds.delete(e),this.events.emit("changed")}clear(){this._tileBounds.clear(),this.events.emit("changed")}forEach(e){for(const{featureData:t,bounds:r}of this._tileBounds.values())r.all((r=>{t.getEnabled(r)&&e(new n(r,t))}))}forEachInBounds(e,t){u.minX=e[0],u.minY=e[1],u.maxX=e[2],u.maxY=e[3];for(const{featureData:e,bounds:r}of this._tileBounds.values())r.search(u,(r=>{e.getEnabled(r)&&t(new n(r,e))}))}forEachBounds(e,t){for(const r of e)t(r.getBoundingBox())}getFullExtent(e){let t=1/0,r=1/0,i=-1/0,o=-1/0;for(const{bounds:e}of this._tileBounds.values()){const{minX:s,minY:n,maxX:a,maxY:l}=e.toJSON();t=Math.min(t,s),r=Math.min(r,n),i=Math.min(i,a),o=Math.min(o,l)}return{xmin:t,ymin:r,xmax:i,ymax:o,spatialReference:e}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../compilerUtils","../../has","../../PooledArray","../../../chunks/quickselect"],(function(e,t,r,i,o,s){"use strict";function n(e,t){let i=e;for(v.clear();i;){if(!0===i.leaf)for(const e of i.children)t(r.toConst(e));else v.pushArray(i.children);i=v.pop()??null}}function a(e,t){l(e,0,e.children.length,t,e)}function l(e,t,r,i,o){o||(o=new T([])),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let s,n=t;n<r;n++)s=e.children[n],c(o,e.leaf?i(s):s);return o}function c(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function u(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function h(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){const r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),o=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,o-r)*Math.max(0,s-i)}function m(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function y(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e,t,r,i,o){const n=[t,r];for(;n.length;){const t=n.pop(),r=n.pop();if(t-r<=i)continue;const a=r+Math.ceil((t-r)/i/2)*i;s.quickselect(e,a,r,t,o),n.push(r,a,a,t)}}const b=new o,v=new o,S=new o,_=new o({deallocator:void 0});class x{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class w extends x{constructor(){super(...arguments),this.height=1,this.indexHint=new t.PositionHint}}class T extends w{constructor(e){super(),this.children=e,this.leaf=!0}}class M extends w{constructor(e){super(),this.children=e,this.leaf=!1}}e.BBox=x,e.PooledRBush=class{constructor(e=9,t){this._compareMinX=u,this._compareMinY=d,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),v.prune(),S.prune(),_.prune()}all(e){n(this._data,e)}search(e,t){let r=this._data;const i=this._toBBox;if(y(e,r))for(b.clear();r;){for(let o=0,s=r.children.length;o<s;o++){const s=r.children[o],a=r.leaf?i(s):s;y(e,a)&&(r.leaf?t(s):m(e,a)?n(s,t):b.push(s))}r=b.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!y(e,t))return!1;for(b.clear();t;){for(let i=0,o=t.children.length;i<o;i++){const o=t.children[i],s=t.leaf?r(o):o;if(y(e,s)){if(t.leaf||m(e,s))return!0;b.push(o)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new T([]),this}remove(e){if(!e)return this;let i,o=this._data,s=null,n=0,a=!1;const l=this._toBBox(e);for(S.clear(),_.clear();o||S.length>0;){if(o||(o=S.pop(),s=S.data[S.length-1],n=_.pop()??0,a=!0),o.leaf&&(i=t.indexOf(o.children,r.toConst(e),o.children.length,o.indexHint),-1!==i))return o.children.splice(i,1),S.push(o),this._condense(S),this;a||o.leaf||!m(o,l)?s?(n++,o=s.children[n],a=!1):o=null:(S.push(o),_.push(n),n=0,s=o,o=o.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,i){const o=r-t+1;let s=this._maxEntries;if(o<=s){const i=new T(e.slice(t,r+1));return a(i,this._toBBox),i}i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/s**(i-1)));const n=new M([]);n.height=i;const l=Math.ceil(o/s),c=l*Math.ceil(Math.sqrt(s));g(e,t,r,c,this._compareMinX);for(let o=t;o<=r;o+=c){const t=Math.min(o+c-1,r);g(e,o,t,l,this._compareMinY);for(let r=o;r<=t;r+=l){const o=Math.min(r+l-1,t);n.children.push(this._build(e,r,o,i-1))}}return a(n,this._toBBox),n}_insert(e,t,r){const i=this._toBBox,o=r?e:i(e);S.clear();const s=function(e,t,r,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==r;){let r,i=1/0,n=1/0;for(let a=0,l=t.children.length;a<l;a++){const l=t.children[a],c=p(l),u=(o=e,s=l,(Math.max(s.maxX,o.maxX)-Math.min(s.minX,o.minX))*(Math.max(s.maxY,o.maxY)-Math.min(s.minY,o.minY))-c);u<n?(n=u,i=c<i?c:i,r=l):u===n&&c<i&&(i=c,r=l)}t=r||t.children[0]}var o,s;return t}(o,this._data,t,S);for(s.children.push(e),c(s,o);t>=0&&S.data[t].children.length>this._maxEntries;)this._split(S,t),t--;!function(e,t,r){for(let i=r;i>=0;i--)c(t.data[i],e)}(o,S,t)}_split(e,t){const r=e.data[t],i=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,i);const s=this._chooseSplitIndex(r,o,i);if(!s)return;const n=r.children.splice(s,r.children.length-s),l=r.leaf?new T(n):new M(n);l.height=r.height,a(r,this._toBBox),a(l,this._toBBox),t?e.data[t-1].children.push(l):this._splitRoot(r,l)}_splitRoot(e,t){this._data=new M([e,t]),this._data.height=e.height+1,a(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let i,o,s;i=o=1/0;for(let n=t;n<=r-t;n++){const t=l(e,0,n,this._toBBox),a=l(e,n,r,this._toBBox),c=f(t,a),u=p(t)+p(a);c<i?(i=c,s=n,o=u<o?u:o):c===i&&u<o&&(o=u,s=n)}return s}_chooseSplitAxis(e,t,r){const i=e.leaf?this._compareMinX:u,o=e.leaf?this._compareMinY:d;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,o)&&e.children.sort(i)}_allDistMargin(e,t,r,i){e.children.sort(i);const o=this._toBBox,s=l(e,0,t,o),n=l(e,r-t,r,o);let a=h(s)+h(n);for(let i=t;i<r-t;i++){const t=e.children[i];c(s,e.leaf?o(t):t),a+=h(s)}for(let i=r-t-1;i>=t;i--){const t=e.children[i];c(n,e.leaf?o(t):t),a+=h(n)}return a}_condense(e){for(let r=e.length-1;r>=0;r--){const i=e.data[r];if(0===i.children.length)if(r>0){const o=e.data[r-1],s=o.children;s.splice(t.indexOf(s,i,s.length,o.indexHint),1)}else this.clear();else a(i,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/quickselect":function(){define(["exports"],(function(e){"use strict";function t(e,i,o,s,n){for(;s>o;){if(s-o>600){var a=s-o+1,l=i-o+1,c=Math.log(a),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(e,i,Math.max(o,Math.floor(i-l*u/a+d)),Math.min(s,Math.floor(i+(a-l)*u/a+d)),n)}var p=e[i],h=o,f=s;for(r(e,o,i),n(e[s],p)>0&&r(e,o,s);h<f;){for(r(e,h,f),h++,f--;n(e[h],p)<0;)h++;for(;n(e[f],p)>0;)f--}0===n(e[o],p)?r(e,o,f):r(e,++f,s),f<=i&&(o=f+1),i<=f&&(s=f-1)}}function r(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function i(e,t){return e<t?-1:e>t?1:0}e.quickselect=function(e,r,o,s,n){t(e,r,o||0,s||e.length-1,n||i)}}))},"esri/views/3d/layers/graphics/pipeline/fetching/Tile3DFetcher":function(){define(["exports","../../../../../../core/promiseUtils","../../../../../../geometry/support/aaBoundingRect","../../../../../../rest/query/operations/query","../Tile","../featureSet/PBFPointFeatureSetView"],(function(e,t,r,i,o,s){"use strict";e.Tile3DFetcher=class{constructor(e,t,r,i,o){this.spatialReference=e,this.url=r,this.objectIdField=i,this.capabilities=o;const{supportsMaxRecordCountFactor:s,maxRecordCount:n}=this.capabilities.query,a=s?4:1,l=(n??8e3)*a;this._pageSize=Math.min(8e3,l);const c=t.clone();c.cacheHint=!0,c.resultType="tile",c.outSpatialReference=e,c.returnGeometry=!0,c.returnZ=!0,c.maxRecordCountFactor=a,c.num=this._pageSize,c.outFields=[i],this._baseQuery=c}async fetch(e,i){const{spatialReference:s,_pageSize:n}=this,a=r.toExtent(e.extent,s),l=this._baseQuery.clone();l.geometry=a;const c=new Array;let u=0,d=!1,p=1;for(;!d;){const e=[];for(let t=0;t<p;++t)e.push(this._fetchPage(l,u++,i));const r=await Promise.all(e);t.throwIfAborted(i);for(const e of r){const t=0!==e.featureCount;d||=!e.exceededTransferLimit||!t,t&&c.push(e)}p=Math.min(p+1,4)}return new o.Tile(e,c,n)}async _fetchPage(e,r,o){const n=e.clone();n.start=r*this._pageSize;const a=(await i.executeQueryPBFBuffer(this.url,n,{signal:o})).data;return t.throwIfAborted(o),new s.PBFPointFeatureSetView(a)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/query/operations/query":function(){define(["exports","../../../request","../../../core/urlUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","../../operations/urlUtils","./pbfQueryUtils","./queryZScale"],(function(e,t,r,i,o,s,n,a,l){"use strict";const c="Layer does not support extent calculation.";function u(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function d(e,t,r){const o=e.geometry,n=e.toJSON();delete n.compactGeometryEnabled,delete n.defaultSpatialReferenceEnabled;const a=n;let l,c,d;if(o&&(c=o.spatialReference,d=s.srToRESTValue(c),a.geometryType=i.getJsonType(o),a.geometry=u(o,e.compactGeometryEnabled),a.inSR=d),n.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds)switch(r?.uniqueIdFields?.length){case void 0:a.objectIds=n.objectIds.join(",");break;case 1:a.uniqueIds=JSON.stringify(n.objectIds),delete a.objectIds;break;default:a.uniqueIds=JSON.stringify(n.objectIds.map((e=>JSON.parse(e)))),delete a.objectIds}if(n.orderByFields&&(a.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete a.outFields:n.outFields.includes("*")?a.outFields="*":a.outFields=n.outFields.join(","),n.outSR?(a.outSR=s.srToRESTValue(n.outSR),l=e.outSpatialReference):o&&(n.returnGeometry||n.returnCentroid)&&(a.outSR=a.inSR,l=c),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(a.outStatistics=JSON.stringify(n.outStatistics)),n.fullText&&(a.fullText=JSON.stringify(n.fullText)),n.pixelSize&&(a.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=c&&null!=e.quantizationParameters?.extent&&c.equals(e.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,a.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(a.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(a.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(a.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){const e=n.timeExtent,{start:t,end:r}=e;null==t&&null==r||(a.time=t===r?t:`${t??"null"},${r??"null"}`),delete n.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=c&&null!=l&&c.equals(l)&&(a.defaultSR=a.inSR,delete a.inSR,delete a.outSR),a}function p(e,t,r,i){return f(e,t,"pbf",r,void 0,i)}function h(e,t){if(!e.returnIdsOnly||!t.uniqueIdFields)return e;const r={...e,returnUniqueIdsOnly:!0};return delete r.returnIdsOnly,r}async function f(e,i,s,a={},l={},c={}){const u="string"==typeof e?r.urlToObject(e):e,p=i.geometry?[i.geometry]:[],f=await o.normalizeCentralMeridian(p,null,{signal:a.signal}),m=f?.[0];null!=m&&((i=i.clone()).geometry=m);const y=n.mapParameters({...u.query,f:s,...h(l,c),...d(i,l,c)});return t(r.join(u.path,function(e,t){return null!=e.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}(i,l)?"query3d":"query"),{...a,responseType:"pbf"===s?"array-buffer":"json",query:{...y,...a.query}})}e.encodeGeometry=u,e.executeQuery=async function(e,t,r,i,o){const s=t.timeExtent?.isEmpty?{data:{features:[]}}:await f(e,t,"json",i,void 0,o);return l.applyFeatureSetZUnitScaling(t,r,s.data),s},e.executeQueryForCount=function(e,t,r,i){return t.timeExtent?.isEmpty?Promise.resolve({data:{count:0}}):f(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0},i)},e.executeQueryForExtent=async function(e,t,r){if(t.timeExtent?.isEmpty)return{data:{count:0,extent:null}};const i=await f(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}),o=i.data;if(o.hasOwnProperty("extent"))return i;if(o.features)throw new Error(c);if(o.hasOwnProperty("count"))throw new Error(c);return i},e.executeQueryForIds=function(e,t,r,i){return t.timeExtent?.isEmpty?Promise.resolve({data:{objectIds:[]}}):f(e,t,"json",r,{returnIdsOnly:!0},i)},e.executeQueryPBF=async function(e,t,r,i,o){if(t.timeExtent?.isEmpty)return{data:r.createFeatureResult()};const s=await p(e,t,i,o),n=s;return n.data=a.parsePBFFeatureQuery(s.data,r),n},e.executeQueryPBFBuffer=p,e.queryToQueryStringParameters=d,e.runQuery=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/operations/urlUtils":function(){define(["exports"],(function(e){"use strict";e.mapParameters=function e(t){const r={};for(const i in t){if("declaredClass"===i)continue;const o=t[i];if(null!=o&&"function"!=typeof o)if(Array.isArray(o)){r[i]=[];for(let t=0;t<o.length;t++)r[i][t]=e(o[t])}else"object"==typeof o?o.toJSON&&(r[i]=JSON.stringify(o)):r[i]=o}return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/query/operations/pbfQueryUtils":function(){define(["exports","./pbfFeatureServiceParser"],(function(e,t){"use strict";e.parsePBFFeatureQuery=function(e,r){const i=t.parseFeatureQuery(e,r),o=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(o&&o.features&&o.features.length&&o.objectIdFieldName){const e=o.objectIdFieldName;for(const t of o.features)t.attributes&&(t.objectId=t.attributes[e])}return o&&(o.queryGeometry=s,o.queryGeometryType=n),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/query/operations/pbfFeatureServiceParser":function(){define(["exports","../../../core/Error","../../../core/pbf","../../../layers/graphics/OptimizedGeometry","./pbfOptimizedFeatureSet"],(function(e,t,r,i,o){"use strict";const s=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],n=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],a=["upperLeft","lowerLeft"];function l(e){return e>=s.length?null:s[e]}function c(e){return e>=a.length?null:a[e]}function u(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function d(e,t,r){const i=e.asUnsafe(),o=t.createPointGeometry(r);for(;i.next();)switch(i.tag()){case 3:{const e=i.getUInt32(),r=i.pos()+e;let s=0;for(;i.pos()<r;)t.addCoordinatePoint(o,i.getSInt64(),s++);break}default:i.skip()}return o}function p(e,t,r){const i=e.asUnsafe(),o=t.createGeometry(r),s=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;i.next();)switch(i.tag()){case 2:{const e=i.getUInt32(),r=i.pos()+e;let s=0;for(;i.pos()<r;)t.addLength(o,i.getUInt32(),s++);break}case 3:{const e=i.getUInt32(),r=i.pos()+e;let n=0;for(t.allocateCoordinates(o);i.pos()<r;)t.addCoordinate(o,i.getSInt64(),n),n++,n===s&&(n=0);break}default:i.skip()}return o}function h(e){const t=e.asUnsafe(),r=new i;let s="esriGeometryPoint";for(;t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),i=t.pos()+e;for(;t.pos()<i;)r.lengths.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),i=t.pos()+e;for(;t.pos()<i;)r.coords.push(t.getSInt64());break}case 1:s=o.optimizedGeometryTypes[t.getEnum()];break;default:t.skip()}return{queryGeometry:r,queryGeometryType:s}}function f(e){const t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function m(e){const t=e.asUnsafe(),r={type:l(0)};for(;t.next();)switch(t.tag()){case 1:r.name=t.getString();break;case 2:r.type=l(t.getEnum());break;case 3:r.alias=t.getString();break;case 4:r.sqlType=(i=t.getEnum())>=n.length?null:n[i];break;case 5:default:t.skip();break;case 6:r.defaultValue=t.getString()}var i;return r}function y(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.name=r.getString();break;case 2:t.isSystemMaintained=r.getBool();break;default:r.skip()}return t}function g(e,t,r,i){const o=t.createFeature(r);let s=0;for(;e.next();)switch(e.tag()){case 1:{const t=i[s++].name;o.attributes[t]=e.processMessage(f);break}case 2:o.geometry=e.processMessageWithArgs(p,t,r);break;case 4:o.centroid=e.processMessageWithArgs(d,t,r);break;default:e.skip()}return o}function b(e){const t=[1,1,1,1],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function v(e){const t=[0,0,0,0],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function S(e){const t={originPosition:c(0)},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.originPosition=c(r.getEnum());break;case 2:t.scale=r.processMessage(b);break;case 3:t.translate=r.processMessage(v);break;default:r.skip()}return t}function _(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.shapeAreaFieldName=r.getString();break;case 2:t.shapeLengthFieldName=r.getString();break;case 3:t.units=r.getString();break;default:r.skip()}return t}function x(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function w(e,t){const r=t.createFeatureResult(),i=e.asUnsafe();r.geometryType=u(t,0);let o=!1;for(;i.next();)switch(i.tag()){case 1:r.objectIdFieldName=i.getString();break;case 3:r.globalIdFieldName=i.getString();break;case 4:r.geohashFieldName=i.getString();break;case 5:r.geometryProperties=i.processMessage(_);break;case 7:r.geometryType=u(t,i.getEnum());break;case 8:r.spatialReference=i.processMessageWithArgs(x,t);break;case 10:r.hasZ=i.getBool();break;case 11:r.hasM=i.getBool();break;case 12:r.transform=i.processMessage(S);break;case 9:r.exceededTransferLimit=i.getBool();break;case 13:t.addField(r,i.processMessage(m));break;case 15:o||(t.prepareFeatures(r),o=!0),t.addFeature(r,i.processMessageWithArgs(g,t,r,r.fields));break;case 2:r.uniqueIdField=i.processMessage(y);break;default:i.skip()}return t.finishFeatureResult(r),r}function T(e,t){const r={};let i=null;for(;e.next();)switch(e.tag()){case 4:i=e.processMessageWithArgs(h);break;case 1:r.featureResult=e.processMessageWithArgs(w,t);break;default:e.skip()}return null!=i&&r.featureResult&&t.addQueryGeometry(r,i),r}e.parseFeatureQuery=function(e,i){try{const t=2,o=new r(new Uint8Array(e),new DataView(e)),s={};for(;o.next();)o.tag()===t?s.queryResult=o.processMessageWithArgs(T,i):o.skip();return s}catch(e){throw new t("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e})}},e.parseField=m,e.parseFieldType=l,e.parseTransform=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/query/operations/pbfOptimizedFeatureSet":function(){define(["exports","../../../core/unitUtils","../../../geometry/support/spatialReferenceUtils","../../../layers/graphics/OptimizedFeature","../../../layers/graphics/OptimizedFeatureSet","../../../layers/graphics/OptimizedGeometry"],(function(e,t,r,i,o,s){"use strict";const n=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];e.OptimizedFeatureSetParserContext=class{constructor(e){this._options=e,this.geometryTypes=n,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new o}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||r.equals(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const o=t.getMetersPerVerticalUnitForSR(this._options.sourceSpatialReference)/t.getMetersPerVerticalUnitForSR(e.spatialReference);if(1!==o)for(const t of e.features){if(!i.hasGeometry(t))continue;const e=t.geometry.coords;for(let t=2;t<e.length;t+=3)e[t]*=o}}addFeature(e,t){e.features.push(t)}createFeature(){return new i.OptimizedFeature(null,{},null,0)}createSpatialReference(){return{wkid:0}}createGeometry(){return new s}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new s}},e.optimizedGeometryTypes=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/rest/query/operations/queryZScale":function(){define(["exports","../../../geometry/support/zscale"],(function(e,t){"use strict";e.applyFeatureSetZUnitScaling=function(e,r,i){if(!i?.features||!i.hasZ)return;const o=t.getGeometryZScaler(i.geometryType,r,e.outSpatialReference);if(null!=o)for(const e of i.features)o(e.geometry)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/Tile":function(){define(["exports","../../../../../core/memoryEstimations"],(function(e,t){"use strict";e.Tile=class{constructor(e,r,i){this.descriptor=e,this._pages=r,this._pageSize=i;const o=t.baseArrayMemory+r.reduce(((e,{usedMemory:t})=>e+t),0),s=3*t.estimateNumberMemory;this.usedMemory=t.baseObjectMemory+o+s,this.featureCount=r.reduce(((e,t)=>e+t.featureCount),0)}get id(){return this.descriptor.id}getObjectId(e){const{pageIndex:t,featurePageIndex:r}=this._translateIndex(e);return this._pages[t].getObjectId(r)}getAttribute(e,t){const{pageIndex:r,featurePageIndex:i}=this._translateIndex(e);return this._pages[r].getAttribute(i,t)}getAttributeAsTimestamp(e,t){const{pageIndex:r,featurePageIndex:i}=this._translateIndex(e);return this._pages[r].getAttributeAsTimestamp(i,t)}getAttributes(e){const{pageIndex:t,featurePageIndex:r}=this._translateIndex(e);return this._pages[t].getAttributes(r)}getCoordinates(e,t,r){const{pageIndex:i,featurePageIndex:o}=this._translateIndex(e);this._pages[i].getCoordinates(o,t,r)}getOptimizedGeometry(e){const{pageIndex:t,featurePageIndex:r}=this._translateIndex(e);return this._pages[t].getOptimizedGeometry(r)}getCentroid(e,t){const{pageIndex:r,featurePageIndex:i}=this._translateIndex(e);return this._pages[r].getCentroid(i,t)}getBounds(e){const{pageIndex:t,featurePageIndex:r}=this._translateIndex(e);return this._pages[t].getBounds(r)}getBoundingBox(e){const{pageIndex:t,featurePageIndex:r}=this._translateIndex(e);return this._pages[t].getBoundingBox(r)}getObjectIdsArray(e,t=this._allFeatureIndices(),r=0){let i=r;for(const{page:r,indices:o}of this._batchPageIndices(t))i=r.getObjectIdsArray(e,o,i);return i}getCoordinatesArray(e,t=this._allFeatureIndices(),r=0){let i=r;for(const{page:r,indices:o}of this._batchPageIndices(t))i=r.getCoordinatesArray(e,o,i);return i}*objectIds(e=this._allFeatureIndices()){for(const{page:t,indices:r}of this._batchPageIndices(e))for(const e of t.objectIds(r))yield e}*_allFeatureIndices(){const{featureCount:e}=this;for(let t=0;t<e;++t)yield t}_translateIndex(e){const{_pageSize:t}=this;return{pageIndex:Math.floor(e/t),featurePageIndex:e%t}}*_batchPageIndices(e){const t=new Array;{let r=0,i=new Array;for(const o of e){const{pageIndex:e,featurePageIndex:s}=this._translateIndex(o);r!==e&&(0!==i.length&&t.push({pageIndex:r,indices:i}),r=e,i=[]),i.push(s)}0!==i.length&&t.push({pageIndex:r,indices:i})}const{_pages:r}=this;for(const{pageIndex:e,indices:i}of t)yield{page:r[e],indices:i}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/featureSet/PBFPointFeatureSetView":function(){define(["exports","../../../../../../core/Error","../../../../../../core/pbf","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../core/libs/rbush/PooledRBush","../../../../../../geometry/support/aaBoundingBox","../../../../../../geometry/support/quantizationUtils","../../../../../../layers/graphics/OptimizedGeometry","../../../../../../layers/support/FieldsIndex","../../../../../../rest/query/operations/pbfFeatureServiceParser"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";function u(e){for(;e.next();){if(1===e.tag())return d(e.getMessage());e.skip()}p()}function d(e){let t,r,i=!1,o=!1,s=0;const a=new Array,u=new Array,d=new Array;for(;e.next();)switch(e.tag()){case 1:r=e.getString();break;case 7:0!==e.getEnum()&&p();break;case 9:i=e.getBool()??!1;break;case 12:t=n.normalizeTransform(e.processMessage(c.parseTransform));break;case 13:{const t=e.processMessage(c.parseField);t.index=s++,a.push(t);break}case 15:{u.push(e.pos());const t=e.getUInt32(),r=e.pos()+t;for(;e.pos()<r&&e.next();)1===e.tag()?(d.push(e.pos()),e.skip()):e.skip();break}case 10:o=e.getBool()??!1;break;default:e.skip()}const h=new l(a);return null!=t&&o&&null!=r&&h.has(r)||p(),{transform:t,exceededTransferLimit:i,fieldsIndex:h,objectIdFieldName:r,featureIndices:u,attributeIndices:d}}function p(){const e=new t("pbf-parsing-failed","Error while parsing PBF",new Error);throw console.error(e),e}function h(e){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}const f=i.create();e.PBFPointFeatureSetView=class{constructor(e){this._reader=new r(new Uint8Array(e),new DataView(e)),this._index=function(e){for(;e.next();){if(2===e.tag())return u(e.getMessage());e.skip()}p()}(this._reader)}get featureCount(){return this._index.featureIndices.length}get exceededTransferLimit(){return this._index.exceededTransferLimit}get usedMemory(){return this._reader.usedMemory}getObjectId(e){return this.getAttribute(e,this._index.objectIdFieldName)}getAttribute(e,t){const{_index:{fieldsIndex:r,attributeIndices:i}}=this,o=r.get(t)?.index;if(null==o)return;const s=i[e*r.fields.length+o],n=this._reader;return n.move(s),h(n)}getAttributeAsTimestamp(e,t){const r=this.getAttribute(e,t);return"string"==typeof r?new Date(r).getTime():"number"==typeof r||null==r?r:null}getAttributes(e){const{_index:{fieldsIndex:t,attributeIndices:r}}=this,i=e*t.fields.length,o=this._reader,s={};for(const e of t.fields){const t=r[i+e.index];o.move(t),s[e.name]=h(o)}return s}getCoordinates(e,t,r=0){const i=this._reader,{transform:o,featureIndices:s}=this._index,{scale:n,translate:a}=o;i.move(s[e]),this._readCoordinates(n,a,t,r)}getOptimizedGeometry(e){const t=i.create();return this.getCoordinates(e,t),new a([],t)}getCentroid(e,{hasZ:t,hasM:r}){this.getCoordinates(e,f);const[i,o,s]=f,n=[i,o];return t&&(n[3]=s),r&&(n[t?4:3]=0),new a([],n)}getBounds(e){this.getCoordinates(e,f);const[t,r]=f,i=new o.BBox;return i.minX=t,i.minY=r,i.maxX=t,i.maxY=r,i}getBoundingBox(e){this.getCoordinates(e,f);const[t,r,i]=f;return s.fromValues(t,r,i,t,r,i)}getObjectIdsArray(e,t=this._allFeatureIndices(),r=0){const i=this._reader,{objectIdFieldName:o,attributeIndices:s,fieldsIndex:n}=this._index,a=n.get(o).index,l=n.fields.length;for(const o of t){const t=s[o*l+a];i.move(t),e[r++]=h(i)}return r}getCoordinatesArray(e,t=this._allFeatureIndices(),r=0){const i=this._reader,{transform:o,featureIndices:s}=this._index,{scale:n,translate:a}=o;for(const o of t){const t=s[o];i.move(t),r=this._readCoordinates(n,a,e,r)}return r}*objectIds(e=this._allFeatureIndices()){const t=this._reader,{objectIdFieldName:r,attributeIndices:i,fieldsIndex:o}=this._index,s=o.get(r).index,n=o.fields.length;for(const r of e){const e=i[r*n+s];t.move(e),yield h(t)}}*_allFeatureIndices(){const{featureCount:e}=this;for(let t=0;t<e;++t)yield t}_readCoordinates([e,t,r],[i,o,s],n,a){const l=this._reader,c=l.getLength(),u=l.pos()+c;for(;l.pos()<u&&l.next();)switch(l.tag()){case 2:{const c=l.getLength(),u=l.pos()+c;for(;l.pos()<u&&l.next();)3===l.tag()?(l.getUInt32(),n[a++]=i+e*l.getSInt64(),n[a++]=o+t*l.getSInt64(),n[a++]=s+r*l.getSInt64()):l.skip();break}default:l.skip()}return a}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/layers/graphics/pipeline/rendering/RenderCommandContext":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../geometry/support/Indices","../../../../../ViewingMode","../PipelineCommand","../utils","../../../../webgl-engine/lib/BoundingInfo","../../../../webgl-engine/lib/VertexAttribute","../../../../webgl-engine/materials/DefaultMaterial","../../../../webgl-engine/materials/HUDMaterial"],(function(e,t,r,i,o,s,n,a,l,c,u){"use strict";const d=r.create(),p=r.create();e.RenderCommandContext=class{constructor(e,t){this._mainThreadDelegate=t,this._bufferWriters=new Map,this.globalViewingMode=e===o.ViewingMode.Global}createRenderCommandBuffer(e=[],t=[]){return{commands:e,transferList:t}}mergeRenderCommandBuffers(e){const t=this.createRenderCommandBuffer();for(const r of e)null!=r&&(t.commands.push(...r.commands),t.transferList.push(...r.transferList));return t}async createTexture(e){const{data:t,parameters:r}=e();return await this._mainThreadDelegate.createTexture(t,r)}async releaseTexture(e){const t=this._destroyTexture(e);return new s.PipelineCommand(this,t,[])}_destroyTexture(e){return{commands:[{id:"destroy-texture",textureId:e}],transferList:[]}}async createMaterial(e){const{type:t,parameters:r}=e,i=n.generateId("material");let o,s;switch(t){case"default":o=new c.DefaultMaterial(e.parameters,{spherical:this.globalViewingMode}),s={type:t,materialId:i,parameters:e.parameters};break;case"hud":o=new u.HUDMaterial(r,this.globalViewingMode),s={type:t,materialId:i,parameters:e.parameters}}return this._bufferWriters.set(i,o.createBufferWriter()),await this._mainThreadDelegate.createMaterial(s),i}destroyMaterial(e){return{commands:[{id:"destroy-material",materialId:e}],transferList:[]}}updateMaterial(e){return{commands:[{...e,id:"update-material"}],transferList:[]}}async createDirectRenderer(e){return await this._mainThreadDelegate.createDirectRenderer(e),e}async destroyDirectRenderer(e){await this._mainThreadDelegate.destroyDirectRenderer(e)}addDirectRendererGeometry(e,t,r){const{materialId:i}=t;if(null==this._bufferWriters.get(i))throw new Error(`no bufferwriter found for material ${i}`);const{renderGeometryBuffer:o,renderGeometryBufferItems:s}=this.createRenderGeometryBuffer(t,r);return this.addDirectRendererGeometryBuffer(i,e,o,s,r)}updateDirectRendererGeometry(e,t,r){const{materialId:i}=t;if(null==this._bufferWriters.get(i))throw new Error(`no bufferwriter found for material ${i}`);const{renderGeometryBuffer:o,renderGeometryBufferItems:s}=this.createRenderGeometryBuffer(t,r);return this.updateDirectRendererGeometryBuffer(i,e,o,s,r)}addDirectRendererGeometryBuffer(e,t,r,i,o){const{objectIds:s,visibilities:n}=i;return{commands:[{id:"add-direct-renderer-geometry-buffer",rendererId:e,groupId:t,renderGeometryBuffer:r,renderGeometryBufferItems:i,localOrigin:o}],transferList:[r.data,s.buffer,n.buffer]}}updateDirectRendererGeometryBuffer(e,t,r,i,o){const{objectIds:s,visibilities:n}=i;return{commands:[{id:"update-direct-renderer-geometry-buffer",rendererId:e,groupId:t,renderGeometryBuffer:r,renderGeometryBufferItems:i,localOrigin:o}],transferList:[r.data,s.buffer,n.buffer]}}removeDirectRendererGeometryBuffer(e,t){return{commands:[{id:"remove-direct-renderer-geometry-buffer",rendererId:e,groupId:t}],transferList:[]}}async createLodRenderer(e){const t=n.generateId("lod-renderer"),r=new Set,o={levels:e.levels.map((e=>({components:e.components.map((e=>{const t=e.attributes.get(l.VertexAttribute.POSITION);if(!t||0===t.indices.length)throw new Error("positions attribute expected");const o=i.getContinuousIndexArray(t.indices.length/3),s=new a.BoundingInfo(o,3,t);if(null==this._bufferWriters.get(e.materialId))throw new Error("writer not found");const{renderGeometryBuffer:n}=this.createRenderGeometryBuffer(e,null);return r.add(n.data),{materialId:e.materialId,renderGeometryBuffer:n,boundingInfo:{bbMax:s.bbMax,bbMin:s.bbMin}}})),minScreenSpaceRadius:e.minScreenSpaceRadius})))};return await this._mainThreadDelegate.createLodRenderer(t,o,Array.from(r)),t}destroyLodRenderer(e){return{commands:[{id:"destroy-lod-renderer",rendererId:e}],transferList:[]}}addLodInstances(e,t,r){return{commands:[{id:"add-lod-instances",rendererId:e,groupId:t,data:r}],transferList:[r.featureIds.buffer,r.globalTransforms.buffer,r.localTransforms.buffer,r.visibility.buffer]}}removeLodInstances(e,t){return{commands:[{id:"remove-lod-instances",rendererId:e,groupId:t}],transferList:[]}}updateLodInstancesData(e,t,r){return{commands:[{id:"update-lod-instance-data",rendererId:e,groupId:t,globalTransforms:r}],transferList:[r.buffer]}}updateVisibility(e,t,r){return{commands:[{id:"update-visibility",rendererId:e,groupId:t,visibility:r}],transferList:[r.buffer]}}async dispatchRenderCommands(e){0!==e.commands.length&&await this._mainThreadDelegate.executeRenderCommands(e)}createRenderGeometryBuffer(e,r){const{materialId:i,visibilities:o,objectIds:s}=e,n=this._bufferWriters.get(i);if(null==n)throw new Error("no registered bufferWriter for material found");let a=null;if(e.transformation&&r)t.copy(d,e.transformation),d[12]-=r[0],d[13]-=r[1],d[14]-=r[2],a=d;else{if(r)throw new Error("not implemented");e.transformation&&(a=e.transformation)}let l=null;a&&(t.invert(p,d),t.transpose(p,p),l=p);const c=e.attributes,u=n.elementCount(c),h=n.vertexBufferLayout.stride/4;u>Math.floor(4194304/h)&&console.warn("geometry with very large number of elements encountered");const f=n.vertexBufferLayout.createBuffer(u),m=n.write(a,l,c,e.objectAndLayerIdColor,f,0);if(null==m)throw new Error("Bufferwriter.write does not provide item information.");if(o.length!==m.numItems||s.length!==m.numItems)throw new Error("Unexpected mismatch between number of RenderGeometryBufferItems and provided objectIds/visibility flags.");return{renderGeometryBuffer:{data:f.buffer,elementCount:u},renderGeometryBufferItems:{objectIds:s,visibilities:o,ranges:{numVertices:m.numVerticesPerItem,numItems:m.numItems}}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../core/libs/gl-matrix-2/types/mat4","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/buffer/BufferView","../../layers/support/FastSymbolUpdates","../../support/debugFlags","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/hud/HUD.glsl","../effects/geometry/olidUtils","../lib/GLTextureMaterial","../lib/Material","../lib/RenderSlot","../lib/screenSizePerspectiveUtils","../lib/Util","../lib/VertexAttribute","./ScaleInfo","./internal/bufferWriterUtils","./internal/MaterialUtil","../../../../chunks/HUDMaterial.glsl","../shaders/HUDMaterialTechnique","../shaders/HUDMaterialTechniqueConfiguration","../../../../webscene/support/AlphaCutoff"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x,w,T,M,I,P,O,C,A,E,R){"use strict";class F extends _.Material{constructor(e,t){super(e,ie),this.produces=new Map([[x.RenderSlot.HUD_MATERIAL,e=>g.isColorEmissionHighlightOrOID(e)&&!this.parameters.drawAsLabel],[x.RenderSlot.LABEL_MATERIAL,e=>g.isColorEmissionHighlightOrOID(e)&&this.parameters.drawAsLabel],[x.RenderSlot.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[x.RenderSlot.DRAPED_MATERIAL,e=>this.parameters.draped&&g.isColorEmissionHighlightOrOID(e)]]),this._visible=!0,this._configuration=new E.HUDMaterialTechniqueConfiguration(t)}getConfiguration(e,t){const r=this.parameters.draped;return super.getConfiguration(e,t,this._configuration),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=r,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===x.RenderSlot.OCCLUSION_PIXELS,this._configuration.occludedFragmentFade=!r&&this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.isFocused=this.parameters.isFocused,this._configuration.depthTestEnabled=this.parameters.depthEnabled||t.slot===x.RenderSlot.OCCLUSION_PIXELS,g.isColorOrColorEmission(e)&&(this._configuration.debugDrawLabelBorder=!!m.debugFlags.LABELS_SHOW_BORDER),this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}intersect(e,t,i,s,n,a){const{options:{selectionMode:d,hud:p,excludeLabels:h},point:f,camera:m}=i,{parameters:y}=this;if(!d||!p||h&&y.isLabel||!e.visible||!f||!m)return;const g=e.attributes.get(M.VertexAttribute.FEATUREATTRIBUTE),b=null==g?null:u.fromArray(g.data,Q),{scaleX:v,scaleY:S}=ae(b,y,m.pixelRatio);r.fromMat4(H,t),e.attributes.has(M.VertexAttribute.FEATUREATTRIBUTE)&&function(e){const t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],n=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+i*i),d=1/Math.sqrt(o*o+s*s+n*n),p=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*u,e[1]=r*u,e[2]=i*u,e[3]=o*d,e[4]=s*d,e[5]=n*d,e[6]=a*p,e[7]=l*p,e[8]=c*p}(H);const _=e.attributes.get(M.VertexAttribute.POSITION),x=e.attributes.get(M.VertexAttribute.SIZE),I=e.attributes.get(M.VertexAttribute.NORMAL),P=e.attributes.get(M.VertexAttribute.ROTATION),O=e.attributes.get(M.VertexAttribute.CENTEROFFSETANDDISTANCE);T.assert(_.size>=3);const A=C.calculateAnchorPosition(y),E="screen"===this.parameters.centerOffsetUnits;for(let e=0;e<_.data.length/_.size;e++){const r=e*_.size;l.set(B,_.data[r],_.data[r+1],_.data[r+2]),l.transformMat4(B,B,t),l.transformMat4(B,B,m.viewMatrix);const s=e*O.size;if(l.set(Y,O.data[s],O.data[s+1],O.data[s+2]),!E&&(B[0]+=Y[0],B[1]+=Y[1],0!==Y[2])){const e=Y[2];l.normalize(Y,B),l.subtract(B,B,l.scale(Y,Y,e))}const n=e*I.size;if(l.set(U,I.data[n],I.data[n+1],I.data[n+2]),L(U,H,m,X),le(this.parameters,B,X,m,N),m.applyProjection(B,z),z[0]>-1){E&&(Y[0]||Y[1])&&(z[0]+=Y[0]*m.pixelRatio,0!==Y[1]&&(z[1]+=w.applyScaleFactor(Y[1],N.factorAlignment)*m.pixelRatio),m.unapplyProjection(z,B)),z[0]+=this.parameters.screenOffset[0]*m.pixelRatio,z[1]+=this.parameters.screenOffset[1]*m.pixelRatio,z[0]=Math.floor(z[0]),z[1]=Math.floor(z[1]);const t=e*x.size;te[0]=x.data[t],te[1]=x.data[t+1],w.applyPrecomputedScaleFactor(te,N.factor,te);const r=K*m.pixelRatio;let s=0;y.textureIsSignedDistanceField&&(s=Math.min(y.outlineSize,.5*te[0])*m.pixelRatio/2),te[0]*=v,te[1]*=S;const n=e*P.size,u=y.rotation+P.data[n];if(V(f,z[0],z[1],te,r,s,u,y,A)){const e=i.ray;if(l.transformMat4(k,B,o.invert($,m.viewMatrix)),z[0]=f[0],z[1]=f[1],m.unprojectFromRenderScreen(z,B)){const t=c.create();l.copy(t,e.direction);const r=1/l.length(t);l.scale(t,t,r),a(l.distance(e.origin,B)*r,t,-1,k)}}}}}intersectDraped(e,t,r,i,o){const s=e.attributes.get(M.VertexAttribute.POSITION),n=e.attributes.get(M.VertexAttribute.SIZE),a=e.attributes.get(M.VertexAttribute.ROTATION),l=this.parameters,c=C.calculateAnchorPosition(l),d=e.attributes.get(M.VertexAttribute.FEATUREATTRIBUTE),p=null==d?null:u.fromArray(d.data,Q),{scaleX:h,scaleY:f}=ae(p,l,e.screenToWorldRatio),m=ee*e.screenToWorldRatio;for(let t=0;t<s.data.length/s.size;t++){const u=t*s.size,d=s.data[u],p=s.data[u+1],y=t*n.size;te[0]=n.data[y],te[1]=n.data[y+1];let g=0;l.textureIsSignedDistanceField&&(g=Math.min(l.outlineSize,.5*te[0])*e.screenToWorldRatio/2),te[0]*=h,te[1]*=f;const b=t*a.size,v=l.rotation+a.data[b];V(r,d,p,te,m,g,v,l,c)&&i(o.distance,o.normal,-1)}}createBufferWriter(){return new ne}applyShaderOffsetsView(e,t,r,i,o,s,n){const a=L(t,r,o,X);return this._applyVerticalGroundOffsetView(e,a,o,n),le(this.parameters,n,a,o,s),this._applyPolygonOffsetView(n,a,i[3],o,n),this._applyCenterOffsetView(n,i,n),n}applyShaderOffsetsNDC(e,t,r,i,o){return this._applyCenterOffsetNDC(e,t,r,i),null!=o&&l.copy(o,i),this._applyPolygonOffsetNDC(i,t,r,i),i}_applyPolygonOffsetView(e,r,i,o,s){const n=o.aboveGround?1:-1;let a=Math.sign(i);0===a&&(a=n);const c=n*a;if(this.parameters.shaderPolygonOffset<=0)return l.copy(s,e);const u=t.clamp(Math.abs(r.cosAngle),.01,1),d=1-Math.sqrt(1-u*u)/u/o.viewport[2];return c>0?l.scale(s,e,d):l.scale(s,e,1/d),s}_applyVerticalGroundOffsetView(e,t,r,i){const o=l.length(e),s=r.aboveGround?1:-1,n=r.computeRenderPixelSizeAtDist(o)*b.HUDVerticalPixelOffset,a=l.scale(B,t.normal,s*n);return l.add(i,e,a),i}_applyCenterOffsetView(e,t,r){const i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&l.copy(r,e),i&&(r[0]+=t[0],r[1]+=t[1],t[2]&&(l.normalize(U,r),l.sub(r,r,l.scale(U,U,t[2])))),r}_applyCenterOffsetNDC(e,t,r,i){const o="screen"!==this.parameters.centerOffsetUnits;return i!==e&&l.copy(i,e),o||(i[0]+=t[0]/r.fullWidth*2,i[1]+=t[1]/r.fullHeight*2),i}_applyPolygonOffsetNDC(e,t,r,i){const o=this.parameters.shaderPolygonOffset;if(e!==i&&l.copy(i,e),o){const e=r.aboveGround?1:-1,s=e*Math.sign(t[3]);i[2]-=(s||e)*o}return i}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:t,outlineColor:r}=this.parameters,i=e[3]>=R.alphaCutoff||t>=R.alphaCutoff&&r[3]>=R.alphaCutoff;return this._visible&&i}createGLMaterial(e){return new D(e)}calculateRelativeScreenBounds(e,t,r=p.create()){return function(e,t,r,i){i[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*r,i[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*r}(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}}class D extends S.GLTextureMaterial{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(A.HUDMaterialTechnique,e)}}function L(e,t,i,o){return d.isMat4(t)&&(t=r.fromMat4(W,t)),l.transformMat3(o.normal,e,t),l.transformMat4(o.normal,o.normal,i.viewInverseTransposeMatrix),o.cosAngle=l.dot(j,re),o}function V(e,r,i,o,s,a,l,c,u){let d=r-s-o[0]*u[0],p=d+o[0]+2*s,h=i-s-o[1]*u[1],f=h+o[1]+2*s;const m=c.distanceFieldBoundingBox;return c.textureIsSignedDistanceField&&null!=m&&(d+=o[0]*m[0],h+=o[1]*m[1],p-=o[0]*(1-m[2]),f-=o[1]*(1-m[3]),d-=a,p+=a,h-=a,f+=a),n.set(q,r,i),n.rotate(G,e,q,t.deg2rad(l)),G[0]>d&&G[0]<p&&G[1]>h&&G[1]<f}const N=new I.ScaleInfo,B=c.create(),U=c.create(),z=u.create(),j=c.create(),k=c.create(),G=a.create(),q=a.create(),H=i.create(),W=i.create(),$=s.create(),J=u.create(),Y=c.create(),Z=c.create(),Q=u.create(),X={normal:j,cosAngle:0},K=1,ee=2,te=a.fromValues(0,0),re=c.fromValues(0,0,1);class ie extends S.GLTextureMaterialBindParameters{constructor(){super(...arguments),this.renderOccluded=_.RenderOccludedFlag.Occlude,this.isDecoration=!1,this.color=u.freeze(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=a.fromValues(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=u.freeze(1,1,1,1),this.outlineSize=0,this.distanceFieldBoundingBox=u.create(),this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawAsLabel=!1,this.depthEnabled=!0,this.isFocused=!0,this.focusStyle="bright",this.draped=!1,this.isLabel=!1}}const oe=y.newLayout().vec3f(M.VertexAttribute.POSITION).vec3f(M.VertexAttribute.NORMAL).vec2i16(M.VertexAttribute.UVI).vec4u8(M.VertexAttribute.COLOR).vec2f(M.VertexAttribute.SIZE).f32(M.VertexAttribute.ROTATION).vec4f(M.VertexAttribute.CENTEROFFSETANDDISTANCE).vec4f(M.VertexAttribute.FEATUREATTRIBUTE),se=oe.clone().vec4u8(M.VertexAttribute.OLIDCOLOR);class ne{constructor(){this.vertexBufferLayout=v.olidEnabled()?se:oe}elementCount(e){return 6*e.get(M.VertexAttribute.POSITION).indices.length}write(e,t,r,i,o,s){const{position:n,normal:a,uvi:l,color:c,size:u,rotation:d,centerOffsetAndDistance:p,featureAttribute:f}=o;P.writePosition(r.get(M.VertexAttribute.POSITION),e,n,s,6),P.writeNormal(r.get(M.VertexAttribute.NORMAL),t,a,s,6);const m=r.get(M.VertexAttribute.UVI)?.data;let y=0,g=0,b=-1-C.fullUV,v=-1-C.fullUV;m&&m.length>=4&&(y=m[0],g=m[1],b=-1-m[2],v=-1-m[3]);let S=r.get(M.VertexAttribute.POSITION).indices.length,_=s;for(let e=0;e<S;++e)l.set(_,0,y),l.set(_,1,g),_++,l.set(_,0,b),l.set(_,1,g),_++,l.set(_,0,b),l.set(_,1,v),_++,l.set(_,0,b),l.set(_,1,v),_++,l.set(_,0,y),l.set(_,1,v),_++,l.set(_,0,y),l.set(_,1,g),_++;P.writeColor(r.get(M.VertexAttribute.COLOR),4,c,s,6);const{data:x,indices:w}=r.get(M.VertexAttribute.SIZE);S=w.length,_=s;for(let e=0;e<S;++e){const t=x[2*w[e]],r=x[2*w[e]+1];for(let e=0;e<6;++e)u.set(_,0,t),u.set(_,1,r),_++}if(P.writeBufferFloat(r.get(M.VertexAttribute.ROTATION),d,s,6),r.get(M.VertexAttribute.CENTEROFFSETANDDISTANCE)?P.writeBufferVec4(r.get(M.VertexAttribute.CENTEROFFSETANDDISTANCE),p,s,6):P.writeBufferVec4Zeros(p,s,6*S),r.get(M.VertexAttribute.FEATUREATTRIBUTE)?P.writeBufferVec4(r.get(M.VertexAttribute.FEATUREATTRIBUTE),f,s,6):P.writeBufferVec4Zeros(f,s,6*S),null!=i){const e=r.get(M.VertexAttribute.POSITION)?.indices;if(e){const t=e.length,r=o.getField(M.VertexAttribute.OLIDCOLOR,h.BufferViewVec4u8);P.writeOlidColor(i,r,t,s,6)}}return{numVerticesPerItem:6,numItems:S}}intersect(e,t,r,i,s,n,a){const{options:{selectionMode:u,hud:d,excludeLabels:p},point:f,camera:m}=i;if(!u||!d||p&&t.isLabel||!f)return;const y=this.vertexBufferLayout.createView(e),g=y.getField(M.VertexAttribute.POSITION,h.BufferViewVec3f),b=y.getField(M.VertexAttribute.NORMAL,h.BufferViewVec3f),v=y.getField(M.VertexAttribute.ROTATION,h.BufferViewFloat),S=y.getField(M.VertexAttribute.SIZE,h.BufferViewVec2f),_=y.getField(M.VertexAttribute.FEATUREATTRIBUTE,h.BufferViewVec4f),x=y.getField(M.VertexAttribute.CENTEROFFSETANDDISTANCE,h.BufferViewVec4f),T="screen"===t.centerOffsetUnits,I=C.calculateAnchorPosition(t);if(null==g||null==b||null==v||null==S||null==x||null==m)return;const P=null==_?null:_.getVec(0,Q),{scaleX:O,scaleY:A}=ae(P,t,m.pixelRatio),E=g.count/6;for(let e=0;e<E;e++){const s=6*e;if(g.getVec(s,B),null!=r&&l.add(B,B,r),l.transformMat4(B,B,m.viewMatrix),x.getVec(s,J),l.set(Y,J[0],J[1],J[2]),!T&&(B[0]+=Y[0],B[1]+=Y[1],0!==Y[2])){const e=Y[2];l.normalize(Y,B),l.subtract(B,B,l.scale(Y,Y,e))}if(b.getVec(s,U),L(U,H,m,X),le(t,B,X,m,N),m.applyProjection(B,z),z[0]>-1){T&&(Y[0]||Y[1])&&(z[0]+=Y[0]*m.pixelRatio,0!==Y[1]&&(z[1]+=w.applyScaleFactor(Y[1],N.factorAlignment)*m.pixelRatio),m.unapplyProjection(z,B)),z[0]+=t.screenOffset[0]*m.pixelRatio,z[1]+=t.screenOffset[1]*m.pixelRatio,z[0]=Math.floor(z[0]),z[1]=Math.floor(z[1]),S.getVec(s,te),w.applyPrecomputedScaleFactor(te,N.factor,te);const r=K*m.pixelRatio;let n=0;t.textureIsSignedDistanceField&&(n=Math.min(t.outlineSize,.5*te[0])*m.pixelRatio/2),te[0]*=O,te[1]*=A;const u=v.get(s),d=t.rotation+u;if(V(f,z[0],z[1],te,r,n,d,t,I)){const t=i.ray;if(l.transformMat4(k,B,o.invert($,m.viewMatrix)),z[0]=f[0],z[1]=f[1],m.unprojectFromRenderScreen(z,B)){const r=c.create();l.copy(r,t.direction);const i=1/l.length(r);l.scale(r,r,i),a(l.distance(t.origin,B)*i,r,e,k)}}}}}}function ae(e,t,r){return null==e||null==t.vvSize?{scaleX:r,scaleY:r}:(f.evaluateModelTransformScale(Z,t,e),{scaleX:Z[0]*r,scaleY:Z[1]*r})}function le(e,t,r,i,o){if(!e.verticalOffset?.screenLength)return e.screenSizePerspective||e.screenSizePerspectiveAlignment?ce(e,o,l.length(t),r.cosAngle):(o.factor.scale=1,o.factorAlignment.scale=1),t;const s=l.length(t),n=e.screenSizePerspectiveAlignment??e.screenSizePerspective,a=O.verticalOffsetAtDistance(i,s,e.verticalOffset,r.cosAngle,n);return ce(e,o,s,r.cosAngle),l.scale(r.normal,r.normal,a),l.add(t,t,r.normal)}function ce(e,t,r,i){null!=e.screenSizePerspective?w.precomputeScaleFactor(i,r,e.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minScaleFactor=0),null!=e.screenSizePerspectiveAlignment?w.precomputeScaleFactor(i,r,e.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minScaleFactor=t.factor.minScaleFactor)}e.HUDMaterial=F,e.Parameters=ie,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],(function(e){"use strict";function t(e){return e instanceof Float32Array&&e.length>=16}function r(e){return Array.isArray(e)&&e.length>=16}e.isMat4=function(e){return t(e)||r(e)},e.isMat4f32=t,e.isMat4f64=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["exports","../attributes/VerticalOffset.glsl","../util/ScreenSizePerspective.glsl","../util/View.glsl","../../shaderModules/Float4BindUniform","../../shaderModules/FloatBindUniform","../../shaderModules/FloatPassUniform","../../shaderModules/glsl","../../../lib/VertexAttribute"],(function(e,t,r,i,o,s,n,a,l){"use strict";e.HUD=function(e,c){e.include(r.ScreenSizePerspective),e.attributes.add(l.VertexAttribute.POSITION,"vec3"),e.attributes.add(l.VertexAttribute.NORMAL,"vec3"),e.attributes.add(l.VertexAttribute.CENTEROFFSETANDDISTANCE,"vec4");const u=e.vertex;i.addProjViewLocalOrigin(u,c),i.addCameraPosition(u,c),u.uniforms.add(new o.Float4BindUniform("viewport",(e=>e.camera.fullViewport)),new n.FloatPassUniform("polygonOffset",(e=>e.shaderPolygonOffset)),new s.FloatBindUniform("cameraGroundRelative",(e=>e.camera.aboveGround?1:-1))),c.hasVerticalOffset&&t.addVerticalOffset(u),u.code.add(a.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),u.code.add(a.glsl`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${c.terrainDepthTest?a.glsl.float(0):a.glsl`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),c.draped&&!c.hasVerticalOffset||i.addViewNormal(u),c.draped||(u.uniforms.add(new s.FloatBindUniform("perDistancePixelRatio",(e=>Math.tan(e.camera.fovY/2)/(e.camera.fullViewport[2]/2)))),u.code.add(a.glsl`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${a.glsl.float(.5)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),c.screenCenterOffsetUnitsEnabled&&i.addPixelRatio(u),c.hasScreenSizePerspective&&r.addScreenSizePerspectiveAlignment(u),u.code.add(a.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${c.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${c.hasScreenSizePerspective&&(c.hasVerticalOffset||c.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${c.hasVerticalOffset?c.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${c.hasVerticalOffset?a.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${c.screenCenterOffsetUnitsEnabled?"":a.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${c.screenCenterOffsetUnitsEnabled?c.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${c.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)},e.HUDVerticalPixelOffset=.5,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/materials/ScaleInfo":function(){define(["exports"],(function(e){"use strict";class t{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}e.ScaleFactor=t,e.ScaleInfo=class{constructor(){this.factor=new t,this.factorAlignment=new t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/chunks/HUDMaterial.glsl":function(){define(["exports","../core/libs/gl-matrix-2/math/vec2","../core/libs/gl-matrix-2/factories/vec2f64","../core/libs/gl-matrix-2/factories/vec4f64","../geometry/support/Ellipsoid","../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput","../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl","../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl","../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl","../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl","../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl","../views/3d/webgl-engine/core/shaderModules/Float2PassUniform","../views/3d/webgl-engine/core/shaderModules/Float4BindUniform","../views/3d/webgl-engine/core/shaderModules/Float4DrawUniform","../views/3d/webgl-engine/core/shaderModules/Float4PassUniform","../views/3d/webgl-engine/core/shaderModules/FloatBindUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Texture2DBindUniform","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform","../views/3d/webgl-engine/lib/OITPass","../views/3d/webgl-engine/lib/VertexAttribute","../views/webgl/ShaderBuilder","../webscene/support/AlphaCutoff"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_,x,w,T,M,I,P,O,C,A){"use strict";function E(e){const r=new C.ShaderBuilder,{signedDistanceFieldEnabled:E,occlusionTestEnabled:L,horizonCullingEnabled:N,pixelSnappingEnabled:B,hasScreenSizePerspective:U,debugDrawLabelBorder:z,vvSize:j,vvColor:k,hasRotation:G,occludedFragmentFade:q,sampleSignedDistanceFieldTexelCenter:H}=e;r.include(c.HUD,e),r.vertex.include(n.RejectBySlice,e);const{occlusionPass:W,output:$,oitPass:J}=e;if(W)return r.include(u.HUDOcclusionPass,e),r;const{vertex:Y,fragment:Z}=r;r.include(y.ScreenSizePerspective),r.include(h.VisualVariables,e),r.include(a.ObjectAndLayerIdColor,e),L&&r.include(d.HUDVisibility),Z.include(m.RgbaFloatEncoding),Z.include(f.ColorConversion),r.varyings.add("vcolor","vec4"),r.varyings.add("vtc","vec2"),r.varyings.add("vsize","vec2");const Q=$===s.ShaderOutput.Highlight,X=Q&&L;X&&r.varyings.add("voccluded","float"),Y.uniforms.add(new v.Float4BindUniform("viewport",(e=>e.camera.fullViewport)),new b.Float2PassUniform("screenOffset",((e,r)=>t.set(D,2*e.screenOffset[0]*r.camera.pixelRatio,2*e.screenOffset[1]*r.camera.pixelRatio))),new b.Float2PassUniform("anchorPosition",(e=>F(e))),new _.Float4PassUniform("materialColor",(e=>e.color)),new w.FloatPassUniform("materialRotation",(e=>e.rotation)),new I.Texture2DPassUniform("tex",(e=>e.texture))),g.addPixelRatio(Y),E&&(Y.uniforms.add(new _.Float4PassUniform("outlineColor",(e=>e.outlineColor))),Z.uniforms.add(new _.Float4PassUniform("outlineColor",(e=>R(e)?e.outlineColor:i.ZEROS)),new w.FloatPassUniform("outlineSize",(e=>R(e)?e.outlineSize:0)))),N&&Y.uniforms.add(new S.Float4DrawUniform("pointDistanceSphere",((e,t)=>{const r=t.camera.eye,s=e.origin;return i.fromValues(s[0]-r[0],s[1]-r[1],s[2]-r[2],o.earth.radius)}))),B&&Y.include(l.AlignPixel),U&&(y.addScreenSizePerspective(Y),y.addScreenSizePerspectiveAlignment(Y)),z&&r.varyings.add("debugBorderCoords","vec4"),r.attributes.add(O.VertexAttribute.UVI,"vec2"),r.attributes.add(O.VertexAttribute.COLOR,"vec4"),r.attributes.add(O.VertexAttribute.SIZE,"vec2"),r.attributes.add(O.VertexAttribute.ROTATION,"float"),(j||k)&&r.attributes.add(O.VertexAttribute.FEATUREATTRIBUTE,"vec4"),Y.code.add(N?T.glsl`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return b > 0.0 && b < a && b * b  > a * c;
}`:T.glsl`bool behindHorizon(vec3 posModel) { return false; }`),Y.main.add(T.glsl`
    ProjectHUDAux projectAux;
    vec4 posProj = projectPositionHUD(projectAux);
    forwardObjectAndLayerIdColor();

    if (rejectBySlice(projectAux.posModel)) {
      // Project outside of clip plane
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      return;
    }

    if (behindHorizon(projectAux.posModel)) {
      // Project outside of clip plane
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      return;
    }

    vec2 inputSize;
    ${T.If(U,T.glsl`
        inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
        vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,T.glsl`
        inputSize = size;
        vec2 screenOffsetScaled = screenOffset;`)}
    ${T.If(j,T.glsl`inputSize *= vvScale(featureAttribute).xx;`)}

    vec2 combinedSize = inputSize * pixelRatio;
    vec4 quadOffset = vec4(0.0);

    ${T.If(L,T.glsl`
    bool visible = testHUDVisibility(posProj);
    if (!visible) {
      vtc = vec2(0.0);
      ${T.If(z,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
      return;
    }`)}
    ${T.If(X,T.glsl`voccluded = visible ? 0.0 : 1.0;`)}
  `);const K=T.glsl`
      vec2 uvi1 = vec2(uvi.x < 0.0 ? 1.0 : 0.0, uvi.y < 0.0 ? 1.0 : 0.0);
      vec2 uv = abs(uvi + uvi1);
      vec2 texSize = vec2(textureSize(tex, 0));
      uv.x = uv.x >= ${V} ? 1.0 : uv.x / texSize.x;
      uv.y = uv.y >= ${V} ? 1.0 : uv.y / texSize.y;
      quadOffset.xy = (uvi1 - anchorPosition) * 2.0 * combinedSize;

      ${T.If(G,T.glsl`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,ee=B?E?T.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:T.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:T.glsl`posProj += quadOffset;`;Y.main.add(T.glsl`
    ${K}
    ${k?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${T.If($===s.ShaderOutput.ObjectAndLayerIdColor,T.glsl`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${T.glsl.float(A.alphaCutoff)};
    ${T.If(E,`alphaDiscard = alphaDiscard && outlineColor.a < ${T.glsl.float(A.alphaCutoff)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${ee}
      gl_Position = posProj;
    }

    vtc = uv;

    ${T.If(z,T.glsl`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),Z.uniforms.add(new I.Texture2DPassUniform("tex",(e=>e.texture))),q&&!Q&&Z.uniforms.add(new M.Texture2DBindUniform("depthMap",(e=>e.mainDepth)),new x.FloatBindUniform("occludedOpacity",(e=>e.hudOccludedFragmentOpacity)));const te=z?T.glsl`(isBorder > 0.0 ? 0.0 : ${T.glsl.float(A.alphaCutoff)})`:T.glsl.float(A.alphaCutoff),re=T.glsl`
    ${T.If(z,T.glsl`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    vec2 samplePos = vtc;

    ${T.If(H,T.glsl`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      samplePos += (vec2(1.0, -1.0) * texelSize) * scaleFactor;`)}

    ${E?T.glsl`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgbaTofloat(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${te} ||
          fillPixelColor.a + outlinePixelColor.a < ${T.glsl.float(A.alphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${T.If(!Q,T.glsl`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${te}) {
          discard;
        }

        ${T.If(!Q,T.glsl`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:T.glsl`
          vec4 texColor = texture(tex, samplePos, -0.5);
          if (texColor.a < ${te}) {
            discard;
          }
          ${T.If(!Q,T.glsl`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${T.If(q&&!Q,T.glsl`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= occludedOpacity;
        }
        `)}

    ${T.If(!Q&&z,T.glsl`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch($){case s.ShaderOutput.Color:case s.ShaderOutput.ColorEmission:r.outputs.add("fragColor","vec4",0),$===s.ShaderOutput.ColorEmission&&r.outputs.add("fragEmission","vec4",1),J===P.OITPass.ColorAlpha&&r.outputs.add("fragAlpha","float",$===s.ShaderOutput.ColorEmission?2:1),Z.main.add(T.glsl`
        ${re}
        ${T.If(J===P.OITPass.FrontFace,T.glsl`fragColor.rgb /= fragColor.a;`)}
        ${T.If($===s.ShaderOutput.ColorEmission,T.glsl`fragEmission = vec4(0.0);`)}
        ${T.If(J===P.OITPass.ColorAlpha,T.glsl`fragAlpha = fragColor.a;`)}`);break;case s.ShaderOutput.ObjectAndLayerIdColor:Z.main.add(T.glsl`
        ${re}
        outputObjectAndLayerIdColor();`);break;case s.ShaderOutput.Highlight:r.include(p.OutputHighlight,e),Z.main.add(T.glsl`
        ${re}
        outputHighlight(${T.If(X,T.glsl`voccluded == 1.0`,T.glsl`false`)});`)}return r}function R(e){return e.outlineColor[3]>0&&e.outlineSize>0}function F(e){var r,i,o;return e.textureIsSignedDistanceField?(r=e.anchorPosition,i=e.distanceFieldBoundingBox,o=D,t.set(o,r[0]*(i[2]-i[0])+i[0],r[1]*(i[3]-i[1])+i[1])):t.copy(D,e.anchorPosition),D}const D=r.create(),L=32e3,V=T.glsl.float(L),N=Object.freeze(Object.defineProperty({__proto__:null,build:E,calculateAnchorPosition:F,fullUV:L},Symbol.toStringTag,{value:"Module"}));e.HUDMaterial=N,e.build=E,e.calculateAnchorPosition=F,e.fullUV=L}))},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/BooleanBindUniform","../../shaderModules/glsl"],(function(e,t,r){"use strict";e.AlignPixel=function(e){e.uniforms.add(new t.BooleanBindUniform("alignPixelEnabled",(e=>e.alignPixelEnabled))),e.code.add(r.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(r.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","./AlignPixel.glsl","../shading/TerrainDepthTest.glsl","../../shaderModules/glsl"],(function(e,t,r,i){"use strict";e.HUDOcclusionPass=function(e,o){const{vertex:s,fragment:n}=e;e.include(r.terrainDepthTest,o),s.include(t.AlignPixel),s.main.add(i.glsl`vec4 posProjCenter;
if (dot(position, position) > 0.0) {
ProjectHUDAux projectAux;
vec4 posProj = projectPositionHUD(projectAux);
posProjCenter = alignToPixelCenter(posProj, viewport.zw);
forwardViewPosDepth(projectAux.posView);
vec3 vpos = projectAux.posModel;
if (rejectBySlice(vpos)) {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
} else {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
gl_Position = posProjCenter;
gl_PointSize = 1.0;`),n.main.add(i.glsl`fragColor = vec4(1);
if(discardByTerrainDepth()) {
fragColor.g = 0.5;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl":function(){define(["exports","./AlignPixel.glsl","./HUDRenderStyle","../../shaderModules/Float4BindUniform","../../shaderModules/FloatBindUniform","../../shaderModules/glsl","../../shaderModules/Texture2DBindUniform"],(function(e,t,r,i,o,s,n){"use strict";e.HUDVisibility=function(e){e.vertex.uniforms.add(new o.FloatBindUniform("renderTransparentlyOccludedHUD",(e=>e.hudRenderStyle===r.HUDRenderStyle.Occluded?1:e.hudRenderStyle===r.HUDRenderStyle.NotOccluded?0:.75)),new i.Float4BindUniform("viewport",(e=>e.camera.fullViewport)),new n.Texture2DBindUniform("hudVisibilityTexture",(e=>e.hudVisibility?.getTexture()))),e.vertex.include(t.AlignPixel),e.vertex.code.add(s.glsl`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDRenderStyle":function(){define(["exports"],(function(e){"use strict";var t;e.HUDRenderStyle=void 0,(t=e.HUDRenderStyle||(e.HUDRenderStyle={}))[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/glsl"],(function(e,t){"use strict";e.RgbaFloatEncoding=function(e){e.code.add(t.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),e.code.add(t.glsl`const vec4 RGBA_TO_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgbaTofloat(vec4 rgba) {
return dot(rgba, RGBA_TO_FLOAT_FACTORS);
}`),e.code.add(t.glsl`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","../../../../webgl/BindType","../../../../webgl/Uniform"],(function(e,t,r){"use strict";class i extends r.Uniform{constructor(e,r){super(e,"vec4",t.BindType.Draw,((t,i,o)=>t.setUniform4fv(e,r(i,o))))}}e.Float4DrawUniform=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define(["require","exports","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../lib/OITPass","../lib/OrderIndependentTransparency","../../../../chunks/HUDMaterial.glsl","../../../webgl/enums","../../../webgl/renderState"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";class u extends o.ShaderTechnique{constructor(t,r){super(t,r,new i.ReloadableShaderModule(a.HUDMaterial,(()=>new Promise(((t,r)=>e(["./HUDMaterial.glsl"],t,r)))))),this.primitiveType=r.occlusionPass?l.PrimitiveType.POINTS:l.PrimitiveType.TRIANGLES}initializePipeline(e){const{oitPass:t,hasPolygonOffset:i,draped:o,output:a,depthTestEnabled:u,occlusionPass:p}=e,h=t===s.OITPass.NONE,f=t===s.OITPass.ColorAlpha,m=a===r.ShaderOutput.Highlight,y=u&&!o&&!f&&!p&&!m;return c.makePipelineState({blending:r.isColorOrColorEmission(a)?h?c.premultipliedAlpha:n.oitBlending(t):null,depthTest:u&&!o?{func:l.CompareFunction.LEQUAL}:null,depthWrite:y?c.defaultDepthWrite:null,drawBuffers:n.getDrawBuffers(t,a),colorWrite:c.defaultColorWrite,polygonOffset:i?d:null})}}const d={factor:0,units:-4};t.HUDMaterialTechnique=u,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../core/shaderLibrary/output/Emissions.glsl","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],(function(e,t,r,i,o,s){"use strict";class n extends s.DefaultTechniqueConfiguration{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.objectAndLayerIdColorInstanced=!1,this.horizonCullingEnabled=!0,this.isFocused=!0,this.textureCoordinateType=r.TextureCoordinateType.None,this.emissionSource=i.EmissionSource.None,this.discardInvisibleFragments=!0,this.hasVvInstancing=!1,this.snowCover=!1}}t.__decorate([o.parameter()],n.prototype,"screenCenterOffsetUnitsEnabled",void 0),t.__decorate([o.parameter()],n.prototype,"occlusionTestEnabled",void 0),t.__decorate([o.parameter()],n.prototype,"signedDistanceFieldEnabled",void 0),t.__decorate([o.parameter()],n.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),t.__decorate([o.parameter()],n.prototype,"vvSize",void 0),t.__decorate([o.parameter()],n.prototype,"vvColor",void 0),t.__decorate([o.parameter()],n.prototype,"hasVerticalOffset",void 0),t.__decorate([o.parameter()],n.prototype,"hasScreenSizePerspective",void 0),t.__decorate([o.parameter()],n.prototype,"hasRotation",void 0),t.__decorate([o.parameter()],n.prototype,"debugDrawLabelBorder",void 0),t.__decorate([o.parameter()],n.prototype,"hasPolygonOffset",void 0),t.__decorate([o.parameter()],n.prototype,"depthTestEnabled",void 0),t.__decorate([o.parameter()],n.prototype,"pixelSnappingEnabled",void 0),t.__decorate([o.parameter()],n.prototype,"draped",void 0),t.__decorate([o.parameter()],n.prototype,"terrainDepthTest",void 0),t.__decorate([o.parameter()],n.prototype,"cullAboveTerrain",void 0),t.__decorate([o.parameter()],n.prototype,"occlusionPass",void 0),t.__decorate([o.parameter()],n.prototype,"occludedFragmentFade",void 0),t.__decorate([o.parameter()],n.prototype,"objectAndLayerIdColorInstanced",void 0),t.__decorate([o.parameter()],n.prototype,"horizonCullingEnabled",void 0),t.__decorate([o.parameter()],n.prototype,"isFocused",void 0),e.HUDMaterialTechniqueConfiguration=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/views/3d/support/RenderCoordsHelper":function(){define(["exports","../../../core/mathUtils","../../../core/unitUtils","../../../core/libs/gl-matrix-2/math/mat4","../../../chunks/vec32","../../../geometry/ellipsoidUtils","../../../geometry/spatialReferenceEllipsoidUtils","../../../geometry/projection/projectPointToVector","../../../geometry/projection/projectVectorToPoint","../../../geometry/projection/projectVectorToVector","../../../geometry/support/aaBoundingRect","../../../geometry/support/Axis","../../../geometry/support/coordinateSystem","../../../geometry/support/plane","../../../geometry/support/vector","../../../geometry/support/vectorStacks","../../../layers/graphics/dehydratedFeatureUtils","../../ViewingMode"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g){"use strict";class b{constructor(e,t,r,i){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=r,this._coordinateSystem=i,this._tmpCoordinateSystem=p.create(i),this.referenceEllipsoid=s.getReferenceEllipsoid(t),this.sphericalPCPF=n.getSphericalPCPF(t)}set extent(e){e&&p.setExtent(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return p.getExtent(this._coordinateSystem,u.create())}getAltitude(e){return p.altitudeAt(this._coordinateSystem,e)}setAltitude(e,t,r=e){return p.setAltitudeAt(this._coordinateSystem,r,t,e)}setAltitudeOfTransformation(e,t){p.setAltitudeOfTransformation(this._coordinateSystem,t,e,t)}worldUpAtPosition(e,t){return p.normalAt(this._coordinateSystem,e,t)}worldBasisAtPosition(e,t,r){return p.axisAt(this._coordinateSystem,e,t,r)}basisMatrixAtPosition(e,t){const r=this.worldBasisAtPosition(e,d.Axis.X,m.sv3d.get()),o=this.worldBasisAtPosition(e,d.Axis.Y,m.sv3d.get()),s=this.worldBasisAtPosition(e,d.Axis.Z,m.sv3d.get());return i.set(t,r[0],r[1],r[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,0,0,0,1),t}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,m.sv3d.get()),o=this.worldBasisAtPosition(e,d.Axis.Y,m.sv3d.get()),s=f.angleAroundAxis(r,o,i);return t.rad2deg(s)}intersectManifoldClosestSilhouette(e,t,r){return p.elevate(this._coordinateSystem,t,this._tmpCoordinateSystem),p.intersectRayClosestSilhouette(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,t,r){p.elevate(this._coordinateSystem,t,this._tmpCoordinateSystem);const i=m.sv3d.get();return p.intersectRay(this._tmpCoordinateSystem,e,i)?o.copy(r,i):null}intersectInfiniteManifold(e,t,r){if(this.viewingMode===g.ViewingMode.Global)return this.intersectManifold(e,t,r);p.elevate(this._coordinateSystem,t,this._tmpCoordinateSystem);const i=this._tmpCoordinateSystem.value,s=m.sv3d.get();return h.intersectRay(i.plane,e,s)?o.copy(r,s):null}toRenderCoords(e,t,r){return y.isDehydratedPoint(e)?a.projectPointToVector(e,t,this.spatialReference):c.projectVectorToVector(e,t,r,this.spatialReference)}fromRenderCoords(e,t,r=null){return y.isDehydratedPoint(t)?(null!=r&&(t.spatialReference=r),l.projectVectorToPoint(e,this.spatialReference,t)?t:null):c.projectVectorToVector(e,this.spatialReference,t,r)?t:null}static create(e,t){switch(e){case g.ViewingMode.Local:return new b(g.ViewingMode.Local,t,r.getMetersPerUnitForSR(t),p.createLocal());case g.ViewingMode.Global:return new b(g.ViewingMode.Global,t,1,p.createGlobal(t))}}static renderUnitScaleFactor(e,t){return r.getMetersPerCartesianUnitForSR(e)/r.getMetersPerCartesianUnitForSR(t)}}e.RenderCoordsHelper=b,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/projection/projectVectorToPoint":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projectionUtils","./projectVectorToVector"],(function(e,t,r,i){"use strict";function o(e,t,r){return!!i.projectVectorToVector(e,t,s,r.spatialReference)&&(r.x=s[0],r.y=s[1],r.z=s[2],!0)}const s=t.create();e.projectVectorToPoint=o,e.projectVectorToPointAsync=async function(e,t,i,s){return await r.initializeProjection(t,i.spatialReference,null,s),o(e,t,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/geometry/support/coordinateSystem":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../ellipsoidUtils","../SpatialReference","../spatialReferenceEllipsoidUtils","./Axis","../../chunks/boundedPlane","../../chunks/sphere"],(function(e,t,r,i,o,s,n,a,l,c){"use strict";function u(e){return{operations:e,value:e.create()}}function d(e,t,r=u(e)){return r.operations=e,e.copy(t,r.value),r}const p=2**50;function h(e,t,r,i){return e.operations.setAltitudeAt(e.value,t,r,i)}const f=i.create(),m=i.create();e.altitudeAt=function(e,t){return e.operations.altitudeAt(e.value,t)},e.axisAt=function(e,t,r,i){return e.operations.axisAt(e.value,t,r,i)},e.closestPoint=function(e,t,r){return e.operations.closestPoint(e.value,t,r)},e.closestPointOnSilhouette=function(e,t,r){return e.operations.closestPointOnSilhouette(e.value,t,r)},e.coordinateSystemFromOneAxisAndNormalVector=function(e,t,i,o,s){r.copy(i,e),r.copy(m,t),r.normalize(m,m),r.cross(o,m,i),r.cross(s,o,i)},e.create=function(e){const{value:t,operations:r}=e;return{operations:r,value:r.create(t)}},e.createFromOperations=u,e.createGlobal=function(e){return d(c.sphere,c.fromValues(0,0,0,o.getReferenceEllipsoid(e).radius))},e.createLocal=function(){return d(l.boundedPlane,l.fromValues([0,0,0],[p,0,0],[0,p,0]))},e.distanceToSilhouette=function(e,t){return e.operations.distanceToSilhouette(e.value,t)},e.elevate=function(e,t,r){return e.operations.elevate(e.value,t,r.value)},e.fromValues=d,e.getExtent=function(e,t){return e.operations.getExtent(e.value,t),t},e.intersectRay=function(e,t,r){return e.operations.intersectRay(e.value,t,r)},e.intersectRayClosestSilhouette=function(e,t,r){return e.operations.intersectRayClosestSilhouette(e.value,t,r)},e.normalAt=function(e,t,r){return e.operations.axisAt(e.value,t,a.Axis.Z,r)},e.renderSRFromViewSR=function(e,t){return e?n.getSphericalPCPF(t):t.isGeographic?s.PlateCarree:t},e.setAltitudeAt=h,e.setAltitudeOfTransformation=function(e,i,o,s){return i!==s&&t.copy(s,i),r.set(f,s[12],s[13],s[14]),h(e,f,o,f),s[12]=f[0],s[13]=f[1],s[14]=f[2],s},e.setExtent=function(e,t,r){return e.operations.setExtent(e.value,t,r.value),r},e.vectorCoordinates=function(e,t,i,o,s){return s[0]=r.dot(e,t),s[1]=r.dot(e,i),s[2]=r.dot(e,o),s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],(function(e){"use strict";e.isDehydratedPoint=function(e){return"point"===e.type},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}))},"*noref":1}}),define(["../../../../../chunks/tslib.es6","../../../../../core/Evented","../../../../../core/promiseUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../geometry/Extent","../../../../../geometry/projectionUtils","../../../../../geometry/SpatialReference","../../../../../layers/graphics/data/QueryEngine","../../../../../rest/support/Query","./FeatureProcessingContext","./PipelineCommand","./Tile3DManager","./TileLocks","./featureSet/TiledFeatureStore","./fetching/Tile3DFetcher","./rendering/RenderCommandContext","../../../support/RenderCoordsHelper"],(function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,v,S,_){"use strict";let x=class extends t.EventedAccessor{constructor(){super(...arguments),this.remoteClient=null,this._featureStore=new b.TiledFeatureStore,this._tileLocks=new g.TileLocks,this._tileManager=null,this._renderer=null,this._fetcher=null,this._queryEngine=null,this._defaultQueryJSON=null,this._mainThreadDelegate=null,this._viewSpatialReference=null,this._renderCommandContext=null,this._context=null}get updating(){return this._tileManager.updating}destroy(){this._featureStore.clear(),this._tileManager?.destroy()}async setup({viewSpatialReference:e,renderSpatialReference:t,viewingMode:r,layerInfo:o,layerViewInfo:s}){const n=d.fromJSON(e);this._viewSpatialReference=n;const a=d.fromJSON(t);this._fetcher=new v.Tile3DFetcher(this._viewSpatialReference,h.fromJSON(o.baseQuery),o.url,o.objectIdField,o.capabilities),this._queryEngine=new p.QueryEngine({hasZ:!0,hasM:!1,geometryType:"esriGeometryPoint",featureIdInfo:{type:"object-id",fieldName:o.objectIdField},fieldsIndex:o.fieldIndex,availableFields:[o.objectIdField],spatialReference:e,featureStore:this._featureStore,timeInfo:o.timeInfo}),this._mainThreadDelegate={createTexture:async(e,t)=>{const r={data:e,parameters:t};return await this.remoteClient.invoke("createTexture",r,{transferList:[e.buffer]})},releaseTexture:async e=>{const t={uid:e};await this.remoteClient.invoke("releaseTexture",t)},createMaterial:async e=>{const t={materialJSON:e};await this.remoteClient.invoke("createMaterial",t)},destroyMaterial:async e=>{const t={materialId:e};await this.remoteClient.invoke("destroyMaterial",t)},createDirectRenderer:async e=>{const t={materialId:e};await this.remoteClient.invoke("createDirectRenderer",t)},destroyDirectRenderer:async e=>{const t={materialId:e};await this.remoteClient.invoke("destroyDirectRenderer",t)},createLodRenderer:async(e,t,r)=>{const i={rendererId:e,lodRenderGeometry:t};await this.remoteClient.invoke("createLoDRenderer",i,{transferList:r})},destroyLodRenderer:async e=>{const t={rendererId:e};await this.remoteClient.invoke("destroyLoDRenderer",t)},executeRenderCommands:async e=>{const t={commands:e.commands};await this.remoteClient.invoke("dispatchRenderCommands",t,{transferList:e.transferList})},applyElevationAlignmentTo:async e=>{const t={mapPoints:e};return await this.remoteClient.invoke("applyElevationAlignment",t,{transferList:[e.buffer]})}};const l=_.RenderCoordsHelper.create(r,a),m=new S.RenderCommandContext(r,this._mainThreadDelegate);this._renderCommandContext=m;const g=new f.FeatureProcessingContext(n,a,this._mainThreadDelegate,l,m,o,s);this._context=g,this._renderer=g.symbolRendererFactory.createSymbolRendererFromJSON(o.renderer),this._defaultQueryJSON=new h({outSpatialReference:n}).toJSON();let b=null;if(null!=o.fullExtent){const e=c.fromJSON(o.fullExtent);await u.initializeProjection(e.spatialReference,n),b=u.project(e,n)}return this._tileManager=new y.Tile3DManager({loadTile:(e,t)=>this._fetcher.fetch(e,t),createAddCommand:(e,t)=>this._createAddFeatureDataCommand(e,t),createRemoveCommand:e=>this._createRemoveFeatureDataCommand(e),createUpdateCommand:(e,t)=>this._createUpdateFeatureDataVisibilityCommand(e,t),tileLocks:this._tileLocks,extent:b}),this.addHandles(i.watch((()=>this.updating),(e=>{this.emit("notify-updating",{updating:e})})),i.initial),null!=this._renderer&&await this._renderer.load(),w}async executeQuery(e,t){return{result:await this._queryEngine.executeQuery(this._ensureQuery(e),t)}}async executeQueryForIds(e,t){const r=await this._queryEngine.executeQueryForIdSet(this._ensureQuery(e),t);return{result:Array.from(r)}}async executeQueryForCount(e,t){return{result:await this._queryEngine.executeQueryForCount(this._ensureQuery(e),t)}}async executeQueryForExtent(e,t){return{result:await this._queryEngine.executeQueryForExtent(this._ensureQuery(e),t)}}async executeQueryForLatestObservations(e,t){return{result:await this._queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),t)}}onTileTreeChange(e){return this._tileManager.onTileTreeChange(e),Promise.resolve(w)}async onElevationChange(e){return w}async onLayerViewOpacityChange(e){const{_context:t,_renderer:r}=this;if(t.layerViewInfo.fullOpacity=e,null==r)return w;const i=await r.createUpdateLayerViewOpacityCommand(e);return await i.execute(),w}async onRendererChange(t){const{_context:r}=this,i=r.symbolRendererFactory.createSymbolRendererFromJSON(t);await i.load();const o=this._renderer;this._renderer=i;const s=[...this._tileManager.loadedTiles()],n=s.map((e=>e.tileId));{const t={stack:[],error:void 0,hasError:!1};try{e.__addDisposableResource(t,await this._tileLocks.lock(n),!1);const a=s.flatMap((e=>[o.createRemoveCommand(e.id),i.createAddCommand(e)])),l=await Promise.all(a),c=r.joinPipelineCommands(l);await c.execute()}catch(e){t.error=e,t.hasError=!0}finally{e.__disposeResources(t)}}const a=await o.createDestroyCommand();return await a.execute(),w}async _createAddFeatureDataCommand(e,t){const i=this._featureStore,o=this._renderer;let s;return s=null!=o?await o.createAddCommand(e):m.PipelineCommand.create(this._renderCommandContext),r.throwIfAborted(t),s.appendPipelineStateCommand((()=>{i.addTile(e)})),s}async _createRemoveFeatureDataCommand(e){const t=this._featureStore,r=this._renderer;let i;return i=null!=r?await r.createRemoveCommand(e):m.PipelineCommand.create(this._renderCommandContext),i.appendPipelineStateCommand((()=>{t.removeTile(e)})),i}async _createUpdateFeatureDataVisibilityCommand(e,t){const i=this._renderer;let o;return o=null!=i?await i.createUpdateVisibilityCommand(e):m.PipelineCommand.create(this._renderCommandContext),r.throwIfAborted(t),o}_ensureQuery(e){return e??this._defaultQueryJSON}};e.__decorate([o.property()],x.prototype,"updating",null),x=e.__decorate([l.subclass("esri.views.3d.layers.graphics.pipeline.Feature3DPipelineWorker")],x);const w={result:void 0};return x}));