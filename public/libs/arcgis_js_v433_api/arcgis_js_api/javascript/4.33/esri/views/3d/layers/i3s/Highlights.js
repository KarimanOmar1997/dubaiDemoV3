// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["../../../../core/arrayUtils","../../../../core/handleUtils","../../../../core/MapUtils","../II3SMeshView3D"],(function(e,t,i,s){"use strict";class h{constructor(e){this.highlightName=e,this.ids=new Set}}return class{constructor({collection:e,forAllFeatures:t,forAllFeaturesOfNode:i}){this._highlights=new Map,this._collection=e,this._forAllFeatures=t,this._forAllFeaturesOfNode=i}destroy(){this._highlights.forEach((e=>e.forEach((e=>this._releaseSet(e))))),this._highlights=null}acquireSet(s){const l=new h(s);i.getOrCreateMapValue(this._highlights,s,(()=>[])).push(l);const o=t.makeHandle((()=>{const t=this._highlights?.get(s);t&&(this._releaseSet(l),e.removeUnordered(t,l))}));return{set:l,handle:o}}setFeatureIds(e,t){t.forEach((t=>e.ids.add(t))),this._initializeSet(e)}_initializeSet(e){this._forAllFeatures(((t,i,h)=>(e.ids.has(t)&&this._collection.addComponentHighlight(h.objectHandle,i,e.highlightName),s.ForAllFeaturesReturnType.CONTINUE)))}_releaseSet(e){this._forAllFeatures(((t,i,h)=>(e.ids.has(t)&&this._collection.removeComponentHighlight(h.objectHandle,i,e.highlightName),s.ForAllFeaturesReturnType.CONTINUE)))}objectCreated(e){this._highlights.forEach(((t,i)=>{t.forEach((t=>{this._forAllFeaturesOfNode(e,((h,l)=>(t.ids.has(h)&&this._collection.addComponentHighlight(e.objectHandle,l,i),s.ForAllFeaturesReturnType.CONTINUE)))}))}))}objectDeleted(e){this._collection.clearHighlights(e.objectHandle)}}}));