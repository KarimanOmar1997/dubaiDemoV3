// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../Color","../../../../core/Error","../../../../support/requestUtils","../../glTF/internal/resourceUtils","./enums","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/materials/pbrUtils","../../../../webscene/support/AlphaCutoff"],(function(e,t,a,o,r,n,s,u,l){"use strict";async function i(e,t,s,u){if(null==e)return-1;const l=s.length,i=e.data,c=e.url;if(null!=i){if(i instanceof HTMLImageElement||i instanceof HTMLCanvasElement)return s.push({id:l,usage:u,data:i,encoding:n.TextureEncoding.PNG}),t.push({id:l,usage:u,encodings:[{name:void 0,encoding:n.TextureEncoding.PNG}]}),l;if(i instanceof HTMLVideoElement)return-1;if(i instanceof ImageData)throw new a("scenelayer","ImageData textures not supported yet for client side I3S nodes");if(i instanceof r.EncodedMeshTexture)return s.push({id:l,usage:u,data:i.data,encoding:n.TextureEncoding.KTX2}),t.push({id:l,usage:u,encodings:[{name:void 0,encoding:n.TextureEncoding.KTX2}]}),l}else if(null!=c){const e=new Image;e.src=c;const a=await o.loadImageAsync(e,e.src,!1,void 0);return s.push({id:l,usage:u,data:a,encoding:n.TextureEncoding.PNG}),t.push({id:l,usage:u,encodings:[{name:void 0,encoding:n.TextureEncoding.PNG}]}),l}return-1}e.convertMeshMaterialToPBRMaterial=async function(e){const a=[],o=[];if(null==e)return{material:{alphaMode:"opaque",alphaCutoff:l.alphaCutoff,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[1,1,1,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6000000238418579},wrapTextures:!1,hasParametersFromSource:!0},requiredTextures:a,textureData:o};const r=function(e){return e.hasOwnProperty("metallicRoughnessTexture")}(e);"auto"===e.alphaMode&&console.warn('alphaMode "auto" not supported by I3S PBRMaterial - defaulting to "blend".');const c=u.useSchematicPBR({normalTexture:e.normalTexture,emissiveTexture:r?e.emissiveTexture:null,emissiveFactor:r?t.toUnitRGB(e.emissiveColor):null,occlusionTexture:r?e.occlusionTexture:null,metallicRoughnessTexture:r?e.metallicRoughnessTexture:null,metallicFactor:r?e.metallic:null,roughnessFactor:r?e.roughness:null}),d=c?u.schematicMRRFactors[0]:r?e.metallic:0,g=c?u.schematicMRRFactors[1]:r?e.roughness:0;return{material:{alphaMode:"auto"===e.alphaMode?"blend":e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,cullFace:e.doubleSided?s.CullFaceOptions.None:s.CullFaceOptions.Back,normalTextureId:await i(e.normalTexture,a,o,n.TextureUsage.Normal),emissiveTextureId:r?await i(e.emissiveTexture,a,o,n.TextureUsage.Emissive):-1,occlusionTextureId:r?await i(e.occlusionTexture,a,o,n.TextureUsage.Occlusion):-1,emissiveFactor:r&&null!=e.emissiveColor?t.toUnitRGB(e.emissiveColor):[0,0,0],metallicRoughness:{baseColorFactor:null!=e.color?t.toUnitRGBA(e.color):[1,1,1,1],baseColorTextureId:await i(e.colorTexture,a,o,n.TextureUsage.Color),metallicRoughnessTextureId:r?await i(e.metallicRoughnessTexture,a,o,n.TextureUsage.MetallicRoughness):-1,metallicFactor:d,roughnessFactor:g},wrapTextures:!0,hasParametersFromSource:c},requiredTextures:a,textureData:o}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));