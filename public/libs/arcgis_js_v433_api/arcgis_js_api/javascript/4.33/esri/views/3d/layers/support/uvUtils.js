// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/projectors","../../../../geometry/support/DoubleArray","../../../../geometry/support/plane","../../../ViewingMode"],(function(e,t,o,r,a,c,s,n,l,i,m){"use strict";const d=c.create(),I=c.create(),f=i.create(),g=c.create(),u=c.create(),b=c.create(),N=r.create(),h=r.create(),p=c.create(),M=c.create(),T=c.create(),y=t.create(),A=c.create(),V=c.create(),E=c.create(),x=c.create();function S(e,t,o,r,c,s,n){a.set(e,t*c[0]+o*s[0]+r*n[0],t*c[1]+o*s[1]+r*n[1],t*c[2]+o*s[2]+r*n[2])}e.createMapSpaceUVCoords=function(e,t,r,c,s=1){a.set(g,1,0,0),a.set(u,0,1,0),a.set(b,0,0,1),function(e,t){a.set(x,0,0,0);for(let e=0;e<t.length-3;e+=3)x[0]+=t[e],x[1]+=t[e+1],x[2]+=t[e+2];a.scale(e,x,1/(t.length/3-1))}(d,r),i.fromArray(f,r)&&function(e,t,o,r,c,s){null!=c?(c.basisMatrixAtPosition(s,y),a.set(A,y[0],y[1],y[2]),a.set(V,y[4],y[5],y[6]),a.set(E,y[8],y[9],y[10])):(a.set(A,1,0,0),a.set(V,0,1,0),a.set(E,0,0,1));const n=i.getNormal(e);a.dot(n,E)<0&&a.scale(n,n,-1),a.copy(r,n);const l=a.dot(n,V),m=a.dot(n,A);Math.abs(l)>Math.abs(m)?(a.scaleAndAdd(t,A,n,-m),a.normalize(t,t),a.cross(o,t,n),a.normalize(o,o),a.scale(o,o,-1)):(a.scaleAndAdd(o,V,n,-l),a.normalize(o,o),a.cross(t,o,n),a.normalize(t,t))}(f,g,u,b,c,d),o.set(N,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o.set(h,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let e=0;e<r.length;e+=3){a.set(I,r[e],r[e+1],r[e+2]);const t=a.dot(g,I),o=a.dot(u,I);N[0]=Math.min(N[0],t),N[1]=Math.min(N[1],o),h[0]=Math.max(h[0],t),h[1]=Math.max(h[1],o)}const n=a.dot(b,d);S(p,N[0],N[1],n,g,u,b),S(M,h[0],N[1],n,g,u,b),S(T,N[0],h[1],n,g,u,b),a.subtract(M,M,p),a.scale(M,M,.5),a.subtract(T,T,p),a.scale(T,T,.5),a.add(p,p,M),a.add(p,p,T);const l=N[0]%s,m=N[1]%s,F=N[0]-l,P=N[1]-m;for(let o=0;o<r.length;o+=3){a.set(I,r[o],r[o+1],r[o+2]);const c=o/3,n=4*c;e[n]=(a.dot(g,I)-F)/s,e[n+1]=(a.dot(u,I)-P)/s,e[n+2]=F/s,e[n+3]=P/s;const l=9*c;for(let e=0;e<3;e++)t[l+e]=p[e],t[l+e+3]=M[e],t[l+e+6]=T[e]}},e.createMapSpaceUVCoordsDraped=function(e,t,r,a,c=1){if(r.isGeographic&&a===m.ViewingMode.Global){const e=l.newDoubleArray(t.length),o=t.length,a=s.getReferenceEllipsoid(r);for(let r=0;r<o;r+=3)n.lonLatToWebMercatorComparable(t,r,e,r,a);t=e}o.set(N,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let e=0;e<t.length;e+=3)N[0]=Math.min(N[0],t[e]),N[1]=Math.min(N[1],t[e+1]);const i=N[0]%c,d=N[1]%c,I=N[0]-i,f=N[1]-d;for(let o=0;o<t.length;o+=3){const r=o/3*4;e[r]=(t[o]-I)/c,e[r+1]=(t[o+1]-f)/c,e[r+2]=I/c,e[r+3]=f/c}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));