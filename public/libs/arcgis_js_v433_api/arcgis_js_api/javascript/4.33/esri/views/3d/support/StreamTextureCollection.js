// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/promiseUtils","../../../core/urlUtils","./TextureCollection","../webgl-engine/lib/Texture","../../webgl/enums"],(function(e,t,r,i,s,n){"use strict";class o extends i.TextureCollection{constructor(e,t,r){super(t,r),this._streamDataRequester=e}async fromUrl(e,r,s){t.throwIfAborted(s);const n=s?.signal,o=this.makeUid(e,r);let l=this._textureRequests.get(o);if(!l){const t=new AbortController,s=this._streamDataRequester.request(e,"image",{uid:o,signal:t.signal});l=new i.TextureRequest,l.abortController=t;const n=l;this._textureRequests.set(o,l),l.textureAsync=s.then((async t=>{const s=this._createTexture(e,t,r);return n.texture=s,n.abortController=null,await s.load(this._stage.renderView.renderingContext),this._stage.addTexture(s),new i.TextureHandle(o,s,(()=>this._release(o)))}),(e=>{throw n.abortController=null,e}))}l.referenceCount++;try{return await t.whenOrAbort(l.textureAsync,n)}catch(e){throw this._release(o),e}}_createTexture(e,t,i){const o={width:t.width,height:t.height,wrap:{s:n.TextureWrapMode.CLAMP_TO_EDGE,t:n.TextureWrapMode.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(r.isSVG(e)){if(i||0===t.width&&0===t.height){const e=t.width?t.height/t.width:1;i=i||64,e>1?(t.width=Math.round(i/e),t.height=i):(t.width=i,t.height=Math.round(i*e))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(o.preMultiplyAlpha=!1)}return new s.Texture(t,o)}}e.StreamTextureCollection=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));