// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/projectors","../../../../geometry/support/DoubleArray","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices","../../../ViewingMode","../../webgl-engine/lib/Attribute","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/VertexAttribute","../../webgl-engine/lib/IntersectableGeometry"],(function(t,e,r,n,i,o,a,u,l,c,s,b,p,A){"use strict";const f=r.create(),g=r.create();t.createGeometry=function(t,r,y=null){const m=[],T=r.mapPositions;!function(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:n}=t,i=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(r)&&n,o=r.length/3-(i?1:0),a=new Array(2*(o-1)),u=i?r.slice(0,-3):r;let l=0;for(let t=0;t<o-1;t++)a[l++]=t,a[l++]=t+1;e.push([p.VertexAttribute.POSITION,new s.Attribute(u,a,3,i)])}(r,m);const h=m[0][1].data,w=m[0][1].indices.length,D=l.getZeroIndexArray(w);return function(t,e,r){if(null!=t.attributeData.colorFeature)return;const i=t.attributeData.color;e.push([p.VertexAttribute.COLOR,new s.Attribute(i??n.ONES,r,4)])}(r,m,D),function(t,e,r){null==t.attributeData.sizeFeature&&e.push([p.VertexAttribute.SIZE,new s.Attribute([t.attributeData.size??1],r,1,!0)])}(r,m,D),function(t,e,r){t.attributeData.normal&&e.push([p.VertexAttribute.NORMAL,new s.Attribute(t.attributeData.normal,r,3)])}(r,m,D),function(t,e,r){null!=t.attributeData.colorFeature&&e.push([p.VertexAttribute.COLORFEATUREATTRIBUTE,new s.Attribute([t.attributeData.colorFeature],r,1,!0)])}(r,m,D),function(t,e,r){null!=t.attributeData.sizeFeature&&e.push([p.VertexAttribute.SIZEFEATUREATTRIBUTE,new s.Attribute([t.attributeData.sizeFeature],r,1,!0)])}(r,m,D),function(t,e,r){null!=t.attributeData.opacityFeature&&e.push([p.VertexAttribute.OPACITYFEATUREATTRIBUTE,new s.Attribute([t.attributeData.opacityFeature],r,1,!0)])}(r,m,D),function(t,r,n){if(null==t.overlayInfo||t.overlayInfo.renderCoordsHelper.viewingMode!==c.ViewingMode.Global||!t.overlayInfo.spatialReference.isGeographic)return;const l=a.newDoubleArray(n.length),b=i.getReferenceEllipsoid(t.overlayInfo.spatialReference);for(let t=0;t<l.length;t+=3)o.lonLatToWebMercatorComparable(n,t,l,t,b);const A=n.length/3,y=u.newFloatArray(A+1);let m=f,T=g,h=0,w=0;e.set(m,l[w++],l[w++]),w++,y[0]=0;for(let t=1;t<A+1;++t)t===A&&(w=0),e.set(T,l[w++],l[w++]),w++,h+=e.dist(m,T),y[t]=h,[m,T]=[T,m];r.push([p.VertexAttribute.DISTANCETOSTART,new s.Attribute(y,r[0][1].indices,1,!0)])}(r,m,h),new b.Geometry(t,m,T,A.GeometryType.Line,y)},t.lineStripsToParameters=function(t,e){if(null==t||0===t.length)return[];const r=[];return t.forEach((t=>{const n=t.length,i=a.newDoubleArray(3*n);t.forEach(((t,e)=>{i[3*e]=t[0],i[3*e+1]=t[1],i[3*e+2]=t[2]}));const o={attributeData:{position:i,normal:e},removeDuplicateStartEnd:!1};r.push(o)})),r},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));