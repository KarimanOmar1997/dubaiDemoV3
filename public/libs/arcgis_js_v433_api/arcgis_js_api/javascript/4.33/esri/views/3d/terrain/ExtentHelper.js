// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/projectionUtils","../../../geometry/support/aaBoundingRect","../../../layers/support/layerUtils","../../ViewingMode","./TerrainConst","./terrainUtils"],(function(e,t,r,n,l,a,i,o,s,c,p,d,u,y){"use strict";e.ExtentHelper=class extends r{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",(()=>this.notifyChange("stencilEnabledExtents")))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach((t=>{const r=t.layer;if("operationalLayerType"in r&&p.isIntegratedMeshOperationalLayer(r.operationalLayerType)&&null!=this.viewSpatialReference){const t=f(r.fullExtent,this.viewSpatialReference);null!=t&&e.push(c.fromExtent(t))}})),e}},t.__decorate([n.property({readOnly:!0})],e.ExtentHelper.prototype,"layerViewsExtent",null),t.__decorate([n.property({readOnly:!0})],e.ExtentHelper.prototype,"tiledLayersExtent",null),t.__decorate([n.property({readOnly:!0})],e.ExtentHelper.prototype,"stencilEnabledExtents",null),t.__decorate([n.property()],e.ExtentHelper.prototype,"viewSpatialReference",void 0),t.__decorate([n.property()],e.ExtentHelper.prototype,"tilingScheme",void 0),t.__decorate([n.property()],e.ExtentHelper.prototype,"defaultTiledLayersExtent",void 0),t.__decorate([n.property({constructOnly:!0})],e.ExtentHelper.prototype,"layers",void 0),t.__decorate([n.property({constructOnly:!0})],e.ExtentHelper.prototype,"layerViews",void 0),e.ExtentHelper=t.__decorate([o.subclass("esri.views.3d.terrain.ExtentHelper")],e.ExtentHelper);let E=class extends e.ExtentHelper{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?u.webMercatorWorldExtent:u.geographicWorldExtent}};E=t.__decorate([o.subclass("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],E);let x=class extends e.ExtentHelper{_computeLayerViewsExtent(){const e=c.empty(),t=this.viewSpatialReference;this.layerViews.forEach((r=>{const n=r.layer;if(r.isResolved()&&("graphics"!==n.type||!n.internal)){const n=f("fullExtentInLocalViewSpatialReference"in r&&r.fullExtentInLocalViewSpatialReference||r.layer.fullExtent,t);c.expand(e,n,e)}}));const r=c.allFinite(e)?e:null,n=this._get("layerViewsExtent");return c.equals(r,n)?n:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=c.empty();this.layers.forEach((n=>{if(n.loaded&&p.isTiledLayer(n)){const l=y.getTiledLayerInfo(n,t,d.ViewingMode.Local);if(null==l)return;const{tileInfo:a,fullExtent:i}=l,o="tilemapCache"in n?n.tilemapCache?.effectiveMaxLOD:void 0;null!=a&&null!=i&&(y.isProjectableRasterLayer(n)||e.compatibleWith(a,o)&&i.spatialReference.equals(e.spatialReference))&&c.expand(r,i,r)}})),c.expand(r,this.defaultTiledLayersExtent,r);const n=c.allFinite(r)?r:null,l=this._get("tiledLayersExtent");return c.equals(n,l)?l:n}};function f(e,t){return null==e||e.spatialReference.equals(t)?e:s.projectWithoutEngine(e,e.spatialReference,t)}x=t.__decorate([o.subclass("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],x),e.create=function(e,t){return e===d.ViewingMode.Global?new E(t):new x(t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));