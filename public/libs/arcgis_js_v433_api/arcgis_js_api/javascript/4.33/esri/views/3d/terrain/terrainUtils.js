// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/Collection","../../../geometry/support/spatialReferenceUtils","../../../layers/support/layerUtils","../../ViewingMode","./NeighborIndex","./TerrainData","../../../chunks/terrainUtilsPlanar","../../../chunks/terrainUtilsSpherical"],(function(e,n,r,t,i,o,l,a,u){"use strict";const s={[i.ViewingMode.Global]:u.terrainUtilsSpherical,[i.ViewingMode.Local]:a.terrainUtilsPlanar};function T(e){return"imagery-tile"===e?.type||"wcs"===e?.type}function c(e){return"imagery-tile-3d"===e?.type}function f(e){return"tile-3d"===e?.type}function I(e){return"vector-tile-3d"===e?.type}function d(e){return"wmts-3d"===e?.type}function h(e){return"elevation-3d"===e?.type}function g(e){return e&&(f(e)||c(e)||I(e)||d(e))}function b(e){return l.isVectorTile(e?.data)}function S(e,n,r,t,i){return s[t].checkIfTileInfoSupportedForViewSR(e,r,n,i)}function N(e,r,i){const o=t.getTileMaxtrixSetFromActiveLayer(e);if(null!=o){if(!n.isCollection(o))return{tileInfo:o.tileInfo,fullExtent:o.fullExtent};{const e=o.find((e=>null==S(e.tileInfo,e.fullExtent,r,i)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}function x(e){return e.isWGS84||e.isWebMercator||r.isCGCS2000(e)||!r.isEarth(e)}e.enableTerrainInternalChecks=!1,e.enableWaterproofTests=!1;const E={force512VTL:!1},p=[o.NeighborIndex.NORTH,o.NeighborIndex.EAST,o.NeighborIndex.SOUTH,o.NeighborIndex.WEST],y=[o.NeighborIndex.NORTH_EAST,o.NeighborIndex.SOUTH_EAST,o.NeighborIndex.SOUTH_WEST,o.NeighborIndex.NORTH_WEST],O=1e-5;e.almostEquals=function(e,n,r=O){return Math.abs(e-n)<r},e.checkIfTileInfoSupportedForView=S,e.enableInternalTerrainChecks=function(n){e.enableTerrainInternalChecks=n},e.enableTerrainWaterproofChecks=function(n){e.enableWaterproofTests=n,e.enableTerrainInternalChecks=e.enableTerrainInternalChecks||n},e.eps=O,e.getTileInfoAndExtentFromWMTSLayer=N,e.getTiledLayerInfo=function(e,n,r){let t=null,o=null;if("wmts"===e?.type){const i=N(e,n,r);t=i.tileInfo,o=i.fullExtent}else{o=T(e)?e.getCompatibleFullExtent(n):e.fullExtent;const l=r===i.ViewingMode.Local;t=T(e)?e.getCompatibleTileInfo(n,o,l):"vector-tile"===e?.type?l&&!x(n)||E.force512VTL?e.tileInfo:e.tileInfo.getCompatibleForVTL(256):e.tileInfo}const l="tilemapCache"in e?e.tilemapCache?.effectiveMaxLOD:void 0;return null!=t&&null!=o&&null==S(t,o,n,r,l)?{tileInfo:t,fullExtent:o}:null},e.internalAssert=function(n,r){if(e.enableTerrainInternalChecks&&!n){const e=(new Error).stack?.slice(5);throw console.warn("Terrain internal: "+(r??"")+" at "+e),new Error("Assertion failed"+(r?": "+r:""))}},e.isBlendableLayerView=function(e){return e&&(f(e)||d(e)||c(e)||I(e))},e.isEast=function(e){return e===o.NeighborIndex.NORTH_EAST||e===o.NeighborIndex.EAST||e===o.NeighborIndex.SOUTH_EAST},e.isElevationLayer=function(e){return"elevation"===e?.type},e.isElevationLayerView=h,e.isGroupLayerView=function(e){return"group"===e?.type},e.isImageSourceRenderInfo=function(e){const n=e?.sourceLayerInfo?.data;return l.isImageWithType(n)||n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof ImageData},e.isImageryTileLayerView=c,e.isImageryTileRenderInfo=function(e){return l.isRasterTile(e?.sourceLayerInfo?.data)},e.isMapTileLayerView=g,e.isNorth=function(e){return e===o.NeighborIndex.NORTH_EAST||e===o.NeighborIndex.NORTH||e===o.NeighborIndex.NORTH_WEST},e.isNorthCorner=function(e){return e===o.NeighborIndex.NORTH_WEST||e===o.NeighborIndex.NORTH_EAST},e.isProjectableRasterLayer=T,e.isSouth=function(e){return e===o.NeighborIndex.SOUTH_EAST||e===o.NeighborIndex.SOUTH||e===o.NeighborIndex.SOUTH_WEST},e.isSurfaceLayerView=function(e){return g(e)||h(e)},e.isTextureTileRenderInfo=function(e){return l.isTileTexture(e?.sourceLayerInfo?.data)},e.isTileLayerView=f,e.isVectorTileLayerView=I,e.isVectorTilePerLayerInfo=b,e.isVectorTileRenderInfo=function(e){return b(e?.sourceLayerInfo)||!!e?.isVTLBackground},e.isWMTSLayerView=d,e.isWest=function(e){return e===o.NeighborIndex.NORTH_WEST||e===o.NeighborIndex.WEST||e===o.NeighborIndex.SOUTH_WEST},e.isWestCorner=function(e){return e===o.NeighborIndex.NORTH_WEST||e===o.NeighborIndex.SOUTH_WEST},e.lij2s=function(e){return"["+e[0]+","+e[1]+","+e[2]+"]"},e.neighborCornerIndices=y,e.neighborEdgeIndices=p,e.oppositeCorner=function(e){return e===o.NeighborIndex.NORTH_EAST?o.NeighborIndex.SOUTH_WEST:e===o.NeighborIndex.NORTH_WEST?o.NeighborIndex.SOUTH_EAST:e===o.NeighborIndex.SOUTH_WEST?o.NeighborIndex.NORTH_EAST:o.NeighborIndex.NORTH_WEST},e.oppositeEdge=function(e){return e===o.NeighborIndex.NORTH?o.NeighborIndex.SOUTH:e===o.NeighborIndex.EAST?o.NeighborIndex.WEST:e===o.NeighborIndex.SOUTH?o.NeighborIndex.NORTH:o.NeighborIndex.EAST},e.releaseTerrainData=function(e){return null!=e&&"release"in e&&e.release(),null},e.test=E,e.useFetchTileForLayer=function(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile},e.v32s=function(e){return"("+e[0]+","+e[1]+","+e[2]+")"},e.vtlAssumes256PixelSizeAsDefault=x,e.weakAssert=function(e,n){e||console.warn("Terrain: "+n)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));