// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/PooledArray","./RenderOrder","./terrainUtils"],(function(e,t,r,n){"use strict";function i(e,t,r=()=>!0){if(t(e),!e.leaf&&r(e))for(const r of e.children)i(r,t)}function l(e,t){const r=e.lij,n=t.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function s(e,t){const r=t.screenDepth-e.screenDepth;if(0!==r)return r;const n=e.lij,i=t.lij;return n[0]-i[0]||n[1]-i[1]||n[2]-i[2]}function o(e,t){const r=e.screenDepth-t.screenDepth;if(0!==r)return r;const n=e.lij,i=t.lij;return n[0]-i[0]||n[1]-i[1]||n[2]-i[2]}function u(e,t,r){const n=e.screenDepth,i=t.screenDepth;return n<i?-r:n>i?r:l(e,t)}function a(e,t,r,n){return c(e,n)===c(t,n)?u(e,t,r):e?r:-r}function c(e,t){for(const r of t)if(e.intersectsExtent(r))return!0;return!1}function f(e,t){const r=e.distanceToPOI-t.distanceToPOI;if(0!==r)return r;const n=e.lij,i=t.lij;return n[0]-i[0]||n[1]-i[1]||n[2]-i[2]}e.IteratorPostorder=class{constructor(){this._q=new t}get done(){return 0===this._q.length}reset(e){if(this._q.clear(),null!=e){this._q.pushArray(e);for(let e=0;e<this._q.length;++e){const t=this._q.data[e];t.leaf||this._q.pushArray(t.children)}}}next(){return this._q.pop()}},e.IteratorPreorder=class{constructor(){this._queue=new t,this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.leaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),null!=e&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},e.compareTiles=u,e.compareTilesByLij=l,e.compareTilesWithStencil=a,e.computeUpsampleInfo=function(e,t,r){let n=1,i=0,l=0;for(;e!==t;)if(n*=.5,i*=.5,l*=.5,1&e.lij[2]&&(i+=.5),1&e.lij[1]||(l+=.5),null==(e=e.parent))throw new Error("tile was not a descendant of upsampleTile");r.init(t,i,l,n)},e.fallsWithinLayerView=function(e,t){if(null==t)return!1;const r=(i=t,n.isImageryTileLayerView(i)?{fullExtent:i.fullExtent,minScale:i.layer.minScale,maxScale:i.layer.maxScale}:i.layer);var i;if(null==r?.fullExtent)return!1;const l=r.fullExtent,s=e.extent;if(l.xmin>s[2]||l.ymin>s[3]||l.xmax<s[0]||l.ymax<s[1])return!1;const o=e.surface.tilingScheme.levels[e.level].scale,u=r.minScale;if(u>0&&o>1.00000001*u)return!1;const a=r.maxScale;return!(a>0&&o<.99999999*a)},e.getTileMapCache=function(e){return!n.isImageryTileLayerView(e)&&e.layer&&"tilemapCache"in e.layer?e.layer.tilemapCache:null},e.hasLoadableSiblings=function(e){for(let t=0;t<e.length;t++){const r=e[t],n=r.parent;if(n)for(let e=0;e<4;e++){const t=n.children[e];if(t&&t!==r)return!0}}return!1},e.sortTiles=function(e,t,n=null){null==n||0===n.length?e===r.RenderOrder.BACK_TO_FRONT?t.sort(s):t.sort(o):t.sort(((t,r)=>a(t,r,e,n)))},e.sortTilesByPOI=function(e,t){const r=e.length;for(let n=0;n<r;++n)e.at(n).updateDistanceToPOI(t);e.sort(f)},e.tilesAreRelated=function(e,t){if(!e||!t||e[0]===t[0])return!1;const r=e[0]<t[0],n=r?e:t,i=r?t:e,l=1<<i[0]-n[0];return Math.floor(i[1]/l)===n[1]&&Math.floor(i[2]/l)===n[2]},e.traverseTilesPreorder=function(e,t,r=()=>!0){if(Array.isArray(e))for(let n=0;n<e.length;n++)i(e[n],t,r);else i(e,t,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));