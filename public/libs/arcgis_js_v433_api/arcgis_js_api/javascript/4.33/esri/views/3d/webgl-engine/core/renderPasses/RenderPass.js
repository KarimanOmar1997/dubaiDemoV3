// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/PooledArray","./RenderPassIdentifier","../../lib/OITPass","../../../../webgl/enums"],(function(e,t,r,s,i){"use strict";var n;e.RenderPassSorting=void 0,(n=e.RenderPassSorting||(e.RenderPassSorting={}))[n.FrontToBack=0]="FrontToBack",n[n.BackToFront=1]="BackToFront";const a=new Map;a.set(i.DataType.UNSIGNED_BYTE,1),a.set(i.DataType.UNSIGNED_SHORT,2),a.set(i.DataType.UNSIGNED_INT,4),e.RenderPass=class{constructor(r,s,i=e.RenderPassSorting.FrontToBack){this._rctx=r,this._techniques=s,this._sorting=i,this._draws=new t({allocator:e=>e??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,t,r,s,i){const n=this._draws.pushNew();n.geometry=t,n.geometryRanges=r,n.material=e,n.depthSquaredHint=s,n.indexType=(t.indexed?t.vao.indexBuffer.indexType:null)??0,n.highlightName=i}acquire(e,t){return this._draws.map((r=>r.material.acquireTechnique(this._techniques,e,t,r.geometry.parameters)))}dispatch(e,t,i){const n=this._rctx;this._previouslyBoundDraw.clear();let o=null;const d=this._draws.length,h=t.highlight?.name;for(let l=0;l<d;l++){const d=this._draws.data[l];if(e.identifier===r.RenderPassIdentifier.Highlight){const e=d.highlightName;if(e){if(e!==h)continue}else if(!h||!t.overlay?.hasHighlight(h))continue}const u=i[l];u===o&&t.oitPass===s.OITPass.NONE||(n.bindTechnique(u,t,e),o=u);const{geometryRanges:c,indexType:g,geometry:m,material:p}=d;n.bindVAO(m.vao),this._previouslyBoundDraw.get(u)!==p&&(u.program.bindDraw(t,e,p),this._previouslyBoundDraw.set(u,p));const y=c.length,{primitiveType:w}=m;for(let e=0;e<y;e+=2){const t=c[e],r=c[e+1];if(0!==g){const e=a.get(g);n.drawElements(w,r,g,t*e)}else n.drawArrays(w,t,r)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===e.RenderPassSorting.FrontToBack?1:-1;this._draws.sort(((e,r)=>t*(e.depthSquaredHint-r.depthSquaredHint)||e.geometry.vao.usedMemory-r.geometry.vao.usedMemory))}get count(){return this._draws.length}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));