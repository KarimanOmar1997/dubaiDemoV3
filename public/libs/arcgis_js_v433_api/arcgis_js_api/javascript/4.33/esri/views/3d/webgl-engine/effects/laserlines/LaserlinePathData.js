// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../geometry/support/DoubleArray","../../../../ViewingMode","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","./LaserlinePathTechnique","../../lib/VertexArrayObject","../../lib/VertexAttribute","../../../../webgl/BufferObject","../../../../webgl/enums"],(function(e,t,r,s,i,o,u,n,a,f,l,c){"use strict";function h(e){return 2*(e.length/3-1)*3}const _=r.create(),d=r.create(),b=u.newLayout().vec3f(f.VertexAttribute.START).vec3f(f.VertexAttribute.END).vec2f(f.VertexAttribute.EXTRUDE).vec3f(f.VertexAttribute.START_UP).vec3f(f.VertexAttribute.END_UP),V=u.newLayout().vec3f(f.VertexAttribute.START).vec3f(f.VertexAttribute.END).vec2f(f.VertexAttribute.EXTRUDE);e.LaserlinePathData=class{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=r.create(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=s.newDoubleArray(3*e.length);let r=0;for(const s of e)t[r++]=s[0],t[r++]=s[1],t[r++]=s[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],r=3*Math.floor(e.length/3/2);t.set(this._origin,e[r],e[r+1],e[r+2])}else t.set(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);null!=t&&(e.bindVAO(t),e.drawArrays(c.PrimitiveType.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}get _layout(){return this._renderCoordsHelper.viewingMode===i.ViewingMode.Global?b:V}_ensureVAO(e){return null==this._buffers?null:(this._vao??=this._createVAO(e,this._buffers),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const r=this._createDataBuffer(t);return this._dirty=!1,new a.VertexArrayObject(e,n.vertexAttributeLocations,new Map([["data",o.glLayout(this._layout)]]),new Map([["data",l.BufferObject.createVertex(e,c.Usage.STATIC_DRAW,r)]]))}_ensureVertexData(e,t){if(!this._dirty)return;const r=this._createDataBuffer(t);e.vertexBuffers.get("data")?.setData(r),this._dirty=!1}_createDataBuffer(e){const r=e.reduce(((e,t)=>e+h(t)),0);this._count=r;const s=this._layout.createBuffer(r),i=this._origin;let o=0,u=0;const n="startUp"in s?this._setUpVectors.bind(this,s):void 0;for(const r of e){for(let e=0;e<r.length;e+=3){const a=t.set(d,r[e],r[e+1],r[e+2]);0===e?u=this._renderCoordsHelper.getAltitude(a):this._renderCoordsHelper.setAltitude(a,u);const f=o+2*e;n?.(e,f,r,a);const l=t.subtract(d,a,i);if(e<r.length-3){for(let e=0;e<6;e++)s.start.setVec(f+e,l);s.extrude.setValues(f,0,-1),s.extrude.setValues(f+1,1,-1),s.extrude.setValues(f+2,1,1),s.extrude.setValues(f+3,0,-1),s.extrude.setValues(f+4,1,1),s.extrude.setValues(f+5,0,1)}if(e>0)for(let e=-6;e<0;e++)s.end.setVec(f+e,l)}o+=h(r)}return s.buffer}_setUpVectors(e,t,r,s,i){const o=this._renderCoordsHelper.worldUpAtPosition(i,_);if(t<s.length-3)for(let t=0;t<6;t++)e.startUp.setVec(r+t,o);if(t>0)for(let t=-6;t<0;t++)e.endUp.setVec(r+t,o)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));