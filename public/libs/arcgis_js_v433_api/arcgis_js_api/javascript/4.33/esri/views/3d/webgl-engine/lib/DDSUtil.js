// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/Logger","../../../webgl/enums","../../../webgl/Texture"],(function(e,t,r,n){"use strict";const a=()=>t.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function o(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const u=o("DXT1"),s=o("DXT3"),i=o("DXT5");function l(e,t){const n=new Int32Array(e.buffer,e.byteOffset,31);if(542327876!==n[0])return a().error("Invalid magic number in DDS header"),null;if(!(4&n[20]))return a().error("Unsupported format, must contain a FourCC code"),null;const o=n[21];let l,c;switch(o){case u:l=8,c=r.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case s:l=16,c=r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case i:l=16,c=r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return a().error("Unsupported FourCC code:",(d=o,String.fromCharCode(255&d,d>>8&255,d>>16&255,d>>24&255))),null}var d;let m=1,h=n[4],f=n[3];(3&h||3&f)&&(a().warn("Rounding up compressed texture size to nearest multiple of 4."),h=h+3&-4,f=f+3&-4);const g=h,p=f;let D,T;131072&n[2]&&!1!==t&&(m=Math.max(1,n[7]));let C=e.byteOffset+n[1]+4;const S=[];for(let t=0;t<m;++t)T=(h+3>>2)*(f+3>>2)*l,D=new Uint8Array(e.buffer,C,T),S.push(D),C+=T,h=Math.max(1,h>>1),f=Math.max(1,f>>1);return{textureData:{type:"compressed",levels:S},internalFormat:c,width:g,height:p}}e.createDDSTexture=function(e,t,a){const o=l(a,t.hasMipmap??!1);if(null==o)throw new Error("DDS texture data is null");const{textureData:u,internalFormat:s,width:i,height:c}=o;return t.samplingMode=u.levels.length>1?r.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:r.TextureSamplingMode.LINEAR,t.hasMipmap=u.levels.length>1,t.internalFormat=s,t.width=i,t.height=c,new n.Texture(e,t,u)},e.createDDSTextureData=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));