// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/has","../../../../core/NestedMap","../effects/ScreenSpaceGeometry","./glUtil3D","../materials/renderers/VaoCache","../../../webgl/AppleAmdDriverHelper","../../../webgl/RenderingContext"],(function(e,r,s,t,i,a,n,o){"use strict";class h extends o.RenderingContext{constructor(e,r){super(e,r),this.emptyTexture=i.createEmptyTexture(this),this._vaoCaches=new s.NestedMap,this._appleAmdDriverHelper=null,this._refCount=1,this._newCache=r.newCache,this.screen=new t.ScreenSpaceGeometry(this)}configure(e){super.configure(e),this._newCache=e.newCache}destroy(){this._vaoCaches?.forAll((e=>e.dispose())),this._vaoCaches?.clear(),--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){this.emptyTexture.dispose(),this.screen.destroy(),super.dispose(),this._appleAmdDriverHelper?.dispose(),this._vaoCaches.forAll((e=>e.dispose())),this._vaoCaches.clear()}get newCache(){return this._newCache}getVaoCache(e,r){const s=Array.from(e).join("."),t=JSON.stringify(r),i=this._vaoCaches.get(s,t);if(i)return i;const n=new a.VaoCache(this,e,r);return this._vaoCaches.set(s,t,n),n}bindTechnique(e,r,s,t){return this.useProgram(e.program),this.setPipelineState(e.getPipeline()),e.program.bind(r),s&&(e.program.bindPass(s,r),t&&e.program.bindDraw(r,s,t)),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??=new n.AppleAmdDriverHelper(this),this._appleAmdDriverHelper.run())}get isAssumedMetalDriver(){if(null==this._isAssumedMetalDriver&&(this._isAssumedMetalDriver=!!r("ios")||!!r("safari"),!this._isAssumedMetalDriver&&r("mac")&&r("chrome"))){const e=this.capabilities.rendererInfo?.getUnmaskedRenderer().toLowerCase(),r=e?.includes("apple")&&e?.includes("angle")&&e?.includes("metal");this._isAssumedMetalDriver=r??!0}return this._isAssumedMetalDriver}get test(){}}e.RenderingContext=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));