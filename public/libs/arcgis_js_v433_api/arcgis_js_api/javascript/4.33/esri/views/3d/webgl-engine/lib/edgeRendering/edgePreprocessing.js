// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/mathUtils","../../../../../core/PooledArray","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","./Edge"],(function(e,t,a,o,n,s){"use strict";class c{constructor(){this.index=0,this.length=0}}const r=new a({allocator:e=>e||new c,deallocator:null}),l=new a({deallocator:null}),d=new a({deallocator:null}),i=new s.Edge,g=n.create(),h=n.create(),u=n.create(),p=n.create(),f=n.create(),m=t.deg2rad(4),A=Math.cos(m),w=t.deg2rad(35),v=Math.cos(w);e.extractEdges=function(e,a,n){const s=e.vertices.position,c=e.vertices.componentIndex,w=i.position0,y=i.position1,x=i.faceNormal0,V=i.faceNormal1,{edges:b,normals:I}=function(e){const t=e.faces.length/3,a=e.faces,n=e.neighbors,s=e.vertices.position;l.length=d.length=0;for(let e=0;e<t;e++){const t=3*e,c=n[t],r=n[t+1],i=n[t+2],g=a[t],h=a[t+1],m=a[t+2];s.getVec(g,u),s.getVec(h,p),s.getVec(m,f),o.subtract(p,p,u),o.subtract(f,f,u),o.cross(u,p,f),o.normalize(u,u),d.pushArray(u),(-1===c||g<h)&&(l.push(g),l.push(h),l.push(e),l.push(c)),(-1===r||h<m)&&(l.push(h),l.push(m),l.push(e),l.push(r)),(-1===i||m<g)&&(l.push(m),l.push(g),l.push(e),l.push(i))}return{edges:l,normals:d}}(e),N=b.length/4,E=a.allocate(N);let M=0;const D=N,F=n?.allocate(D);let P=0,S=0,j=0;r.length=0;for(let e=0;e<N;++e){const t=4*e;s.getVec(b.data[t],w),s.getVec(b.data[t+1],y);const a=r.pushNew();a.index=4*e,a.length=o.distance(w,y)}r.sort(((e,t)=>t.length-e.length));const k=new Array,z=new Array;r.forAll((({length:e,index:r})=>{const l=b.data[r],d=b.data[r+1],u=b.data[r+2],p=b.data[r+3],f=-1===p;if(s.getVec(l,w),s.getVec(d,y),f){const e=3*u;o.set(x,I.data[e],I.data[e+1],I.data[e+2]),o.copy(V,x),i.componentIndex=c.get(l),i.cosAngle=o.dot(x,V)}else{let e=3*u;if(o.set(x,I.data[e],I.data[e+1],I.data[e+2]),e=3*p,o.set(V,I.data[e],I.data[e+1],I.data[e+2]),i.componentIndex=c.get(l),i.cosAngle=o.dot(x,V),N=A,i.cosAngle>N)return;i.cosAngle<-.9999&&o.copy(V,x)}var N,D;S+=e,j++,f||(D=v,i.cosAngle<D)?(a.write(E,M++,i),k.push(e)):function(e,a){const n=t.acosClamped(e.cosAngle);return o.direction(h,e.position1,e.position0),n*(o.dot(o.cross(g,e.faceNormal0,e.faceNormal1),h)>0?-1:1)>a}(i,m)&&(F&&n&&n.write(F,P++,i),z.push(e))}));const C=new Float32Array(k.reverse()),L=new Float32Array(z.reverse()),O=F&&n?{instancesData:F.slice(0,P),lodInfo:{lengths:L}}:void 0;return{regular:{instancesData:E.slice(0,M),lodInfo:{lengths:C}},silhouette:O,averageEdgeLength:S/j}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));