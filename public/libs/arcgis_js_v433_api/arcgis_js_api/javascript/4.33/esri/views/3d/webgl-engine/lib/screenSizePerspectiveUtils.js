// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/mathUtils","../../../../chunks/boundedPlane","../../../../chunks/sphere","../../../ViewingMode"],(function(e,t,a,r,c){"use strict";function n(e,t,a){const r=a.parameters;return f.scale=Math.min(r.divisor/(t-r.offset),1),f.factor=function(e){return Math.abs(e*e*e)}(e),f}function l(e,a){return t.lerp(e*Math.max(a.scale,a.minScaleFactor),e,a.factor)}class i{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,t,a,r={camera:{distance:0,fovY:0},divisor:0,offset:0},n){this._viewingMode=e,this._description=t,this._ellipsoidRadius=a,this.parameters=r,this._fontHeight=n,this._viewingMode===c.ViewingMode.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),0))}overrideFontHeight(e){return e!==this._fontHeight?new i(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,t,a){const{scaleStart:r,scaleFallOffRange:c}=this._description,{fovY:n,distance:l}=e,i=this._calculateCurvatureDependentParameters(e,t),s=this._coverageCompensation(e,t,i),{tiltAngle:o,scaleFallOffFactor:u}=i,f=Math.sin(o)*l,m=.5*Math.PI-o-n*(.5-r*s),d=f/Math.cos(m),h=m+n*c*s,p=(d-u*(f/Math.cos(h)))/(1-u);return a.camera.fovY=e.fovY,a.camera.distance=e.distance,a.offset=p,a.divisor=d-p,a}_calculateCurvatureDependentParametersLocal(e,t,a=m){return a.tiltAngle=this._description.curvatureDependent.min.tiltAngle,a.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,a}_calculateCurvatureDependentParametersGlobal(e,a,r=m){const c=this._description.curvatureDependent,n=1+e.distance/a,l=Math.sqrt(n*n-1),[i,s]=[c.min.curvature,c.max.curvature],o=t.clamp((l-i)/(s-i),0,1),[u,f]=[c.min,c.max];return r.tiltAngle=t.lerp(u.tiltAngle,f.tiltAngle,o),r.scaleFallOffFactor=t.lerp(u.scaleFallOffFactor,f.scaleFallOffFactor,o),r}_surfaceCoverageCompensationLocal(e,t,r){return a.cameraFrustumCoverage(r.tiltAngle,e.fovY)}_surfaceCoverageCompensationGlobal(e,t,a){return r.fromRadius(d,t),r.cameraFrustumCoverage(d,a.tiltAngle,e.distance,e.fovY)}}const s={curvatureDependent:{min:{curvature:t.deg2rad(10),tiltAngle:t.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:t.deg2rad(70),tiltAngle:t.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},o={scaleFallOffFactor:.7},u={scaleFallOffFactor:.95},f={scale:0,factor:0,minScaleFactor:0},m={tiltAngle:0,scaleFallOffFactor:0},d=r.create();e.applyPrecomputedScaleFactor=function(e,t,a=[0,0]){const r=Math.min(Math.max(t.scale,t.minScaleFactor),1);return a[0]=e[0]*r,a[1]=e[1]*r,a},e.applyScaleFactor=l,e.getLabelSettings=function(e,t){const{curvatureDependent:a,scaleStart:r,scaleFallOffRange:c}=s;return new i(e,{curvatureDependent:{min:{curvature:a.min.curvature,tiltAngle:a.min.tiltAngle,scaleFallOffFactor:o.scaleFallOffFactor},max:{curvature:a.max.curvature,tiltAngle:a.max.tiltAngle,scaleFallOffFactor:u.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:c,minPixelSize:14},t)},e.getSettings=function(e,t){return new i(e,s,t)},e.precomputeScaleFactor=function(e,t,a,r){r.scale=function(e,t,a){const r=n(e,t,a);return r.minScaleFactor=0,l(1,r)}(e,t,a),r.factor=0,r.minScaleFactor=a.minScaleFactor},e.scale=function(e,t,a,r){return l(e,n(t,a,r))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));