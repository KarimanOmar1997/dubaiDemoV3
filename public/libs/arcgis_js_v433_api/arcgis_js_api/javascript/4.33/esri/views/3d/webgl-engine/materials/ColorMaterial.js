// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../effects/geometry/olidUtils","../lib/basicInterfaces","../lib/GLMaterial","../lib/OrderIndependentTransparency","../lib/RenderSlot","../lib/VertexAttribute","./DefaultBufferWriter","./TriangleMaterial","./VisualVariablePassParameters","../shaders/ColorMaterialTechnique","../shaders/ColorMaterialTechniqueConfiguration","../../../../webscene/support/AlphaCutoff"],(function(e,t,r,i,s,a,o,n,l,h,u,p,c,f,O,_){"use strict";class d extends p.TriangleMaterial{constructor(e){super(e,T),this._configuration=new O.ColorMaterialTechniqueConfiguration,this.supportsEdges=!0,this.produces=new Map([[l.RenderSlot.OPAQUE_MATERIAL,e=>this._isOpaqueMaterialPass(e)],[l.RenderSlot.OPAQUE_MATERIAL_WITHOUT_NORMALS,e=>this._isOpaqueNoSSAODepthPass(e)],[l.RenderSlot.TRANSPARENT_MATERIAL,e=>i.isColorOrColorEmissionOrOID(e)&&this._transparent&&this.parameters.writeDepth],[l.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_NORMALS,e=>i.isDepth(e)&&this._transparent&&this.parameters.writeDepth],[l.RenderSlot.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,e=>i.isColorOrColorEmissionOrOID(e)&&this._transparent&&!this.parameters.writeDepth],[l.RenderSlot.DRAPED_MATERIAL,e=>i.is2DGeometryOutput(e)]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<n.OITPolygonOffsetLimit,this._configuration.terrainDepthTest=t.terrainDepthTest&&i.isColorOrColorEmission(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=_.alphaCutoff}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return e===i.ShaderOutput.Highlight||i.isColorOrColorEmissionOrOID(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return i.isDepth(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new g(e)}createBufferWriter(){const e=r.newLayout().vec3f(h.VertexAttribute.POSITION);return s.olidEnabled()&&e.vec4u8(h.VertexAttribute.OLIDCOLOR),this.parameters.vvColor?e.f32(h.VertexAttribute.COLORFEATUREATTRIBUTE):e.vec4u8(h.VertexAttribute.COLOR),new u.DefaultBufferWriter(e)}}class g extends o{beginSlot(e){return this.getTechnique(f.ColorMaterialTechnique,e)}}class T extends c.VisualVariablePassParameters{constructor(){super(...arguments),this.color=t.ZEROS,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=a.CullFaceOptions.None,this.draped=!1,this.discardInvisibleFragments=!1}}e.ColorMaterial=d,e.Parameters=T,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));