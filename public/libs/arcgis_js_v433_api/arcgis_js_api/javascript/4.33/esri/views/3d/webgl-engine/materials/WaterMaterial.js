// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/has","../../../../core/time","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../core/shaderLibrary/ShaderOutput","../effects/geometry/olidUtils","../lib/Material","../lib/OrderIndependentTransparency","../lib/RenderSlot","./DefaultBufferWriter","./DefaultLayouts","./TriangleMaterial","./WaterGLMaterial","./WaterTechniqueConfiguration"],(function(e,t,r,i,a,s,o,n,l,h,c,u,f,d,p,g){"use strict";class m extends d.TriangleMaterial{constructor(e,t){super(e,O),this.produces=new Map([[c.RenderSlot.OPAQUE_MATERIAL,e=>o.isColorOrColorEmission(e)&&!this.parameters.transparent||o.isHighlightOrOID(e)],[c.RenderSlot.TRANSPARENT_MATERIAL,e=>o.isColorOrColorEmission(e)&&this.parameters.transparent||o.isHighlightOrOID(e)],[c.RenderSlot.DRAPED_MATERIAL,e=>this.parameters.draped&&o.isColorOrColorEmission(e)||e===o.ShaderOutput.Normal||o.isHighlightOrOID(e)],[c.RenderSlot.DRAPED_WATER,e=>e===o.ShaderOutput.Normal]]),this._configuration=new g.WaterTechniqueConfiguration(t.spherical)}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.writeDepth=!0,this._configuration.receiveShadows=t.shadowMap.enabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.screenSpaceReflections=null!=t.ssr.lastFrameColor,this._configuration.cloudReflections=null!=t.clouds.data,this._configuration.draped=this.parameters.draped,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<h.OITPolygonOffsetLimit,this._configuration.terrainDepthTest=t.terrainDepthTest&&o.isColorOrColorEmission(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}get visible(){return!0}update(e){return this.setParameters({timeElapsed:r.secondsFromMilliseconds(e.time)*this.parameters.animationSpeed},!1),this._animationEnabled(e.camera)&&e.dt>0}_animationEnabled(e){const t=Math.min(e.relativeElevation,e.distance);return Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<S}createGLMaterial(e){return new p.WaterGLMaterial(e)}createBufferWriter(){return new u.DefaultBufferWriter(n.olidEnabled()?f.PositionUvf32OlidLayout:f.PositionUvf32Layout)}get test(){}}class O extends l.MaterialParameters{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=i.fromValues(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=s.fromValues(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.origin=a.create(),this.modelTransformation=null}}const S=35e3;e.Parameters=O,e.WaterMaterial=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));