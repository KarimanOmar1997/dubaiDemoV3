// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/tslib.es6","../../core/Evented","../../core/events","../../core/maybe","../../core/reactiveUtils","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../support/modeUtils","./tooltip/css","./tooltip/content/tooltipContentFactory","../../widgets/support/widgetUtils"],(function(t,e,o,n,i,r,s,a,c,l,p,d,u,h,f,y){"use strict";const _={base:`${h.base}`,ltr:`${h.base}--ltr`,rtl:`${h.base}--rtl`,debug:`${h.base}--debug`};t.default=class extends o.EventedAccessor{constructor(t){super(t),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:t}=this;this.addHandles([r.watch((()=>this.view.overlay?.surface),(e=>{t.remove(),e?.appendChild(t),this._rtl=y.isRTL(e)}),r.syncAndInitial),r.watch((()=>this.info),((e,o)=>{if(null!=this.content&&null!=e&&null!=o&&e.type===o.type)this.content.info=e;else{i.destroyMaybe(this.content);const o=f.tooltipContentFactory(this,e);o?(this.content=o,o.container&&t.appendChild(o.container),this.exitInputMode()):this.content=null}}),r.syncAndInitial),r.watch((()=>({container:this.outerContainer,style:this._outerContainerStyle})),(({container:t,style:e})=>{Object.assign(t.style,e)}),r.initial),r.watch((()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug})),(({outerContainer:t,placement:e,effectiveOffset:o,rtl:n,debug:i})=>{const{classList:r}=t;r.add(_.base),r.toggle(_.rtl,n),r.toggle(_.ltr,!n),r.toggle(_.debug,i),this.outerContainer.style.setProperty("--offset",`${o}px`),u.setCalciteModeClass(t),function({classList:t},e){v.forEach((e=>t.remove(e))),t.add(g(e))}(t,e)}),r.initial),r.when((()=>"feedback"===this.mode),(()=>{this.position=null,this._clearOverride("effectivePlacement")}),r.sync),n.on(this.outerContainer,"paste",(t=>{this.emit("paste",t)})),n.on(this.outerContainer,["focusin","focusout"],(()=>{this._focused=this.content?.container?.contains(document.activeElement)??!1}))])}destroy(){this.info=null,this.content=i.destroyMaybe(this.content),this.outerContainer.remove()}get mode(){return this.content?.mode??"feedback"}get focused(){return this._focused}get visible(){return"none"!==this._outerContainerStyle.display}get contentContainer(){return this.content?.container}get effectivePlacement(){const t=this.options?.placement;return"auto"===t?"bottom-end":t??"bottom-end"}get _screenPoint(){const{inputManager:t}=this.view;return t?.multiTouchActive?null:t?.latestPointerLocation}get _effectiveOffset(){return this.options?.offset??20}get _outerContainerStyle(){const t=this.position??this._screenPoint;return this._lastPosition=s.cloneScreenPoint(t),null!=t&&null!=this.content?{display:"block",transform:`translate(${Math.round(t.x)}px, ${Math.round(t.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(t){const e=this.position??this._lastPosition??this._screenPoint,o=this.position=s.cloneScreenPoint(e),{effectivePlacement:n}=this;this._override("effectivePlacement",n),await(this.content?.enterInputMode(t,(()=>{o&&(this.position=function(t,e,o,n){if(!t||!n.container)return e;const i=t.getBoundingClientRect(),{left:r,top:a}=n.container.getBoundingClientRect();let{x:c,y:l}=e;const p=i.left-r-o;p<0&&(c-=p);const d=i.right-r+o-n.width;d>0&&(c-=d);const u=i.top-a-o;u<0&&(l-=u);const h=i.bottom-a+o-n.height;return h>0&&(l-=h),s.createScreenPoint(c,l)}(this.contentContainer,o,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))})))}async exitInputMode(t){await(this.content?.exitInputMode(t))}onDragStart(t,e){this._prevXY=[t,e]}onDrag(t,e){const o=t-this._prevXY[0],n=e-this._prevXY[1];this._prevXY=[t,e];const{position:i}=this;if(i){const{view:r}=this,a=t-r.position[0],c=e-r.position[1];if(a<0||a>r.width||c<0||c>r.height-16)return;this.position=s.createScreenPoint(i.x+o,i.y+n)}}onDragEnd(){this._prevXY=[0,0]}},e.__decorate([a.property({nonNullable:!0})],t.default.prototype,"view",void 0),e.__decorate([a.property()],t.default.prototype,"info",void 0),e.__decorate([a.property()],t.default.prototype,"options",void 0),e.__decorate([a.property()],t.default.prototype,"position",void 0),e.__decorate([a.property()],t.default.prototype,"content",void 0),e.__decorate([a.property({readOnly:!0})],t.default.prototype,"mode",null),e.__decorate([a.property()],t.default.prototype,"_focused",void 0),e.__decorate([a.property({readOnly:!0})],t.default.prototype,"focused",null),e.__decorate([a.property({readOnly:!0})],t.default.prototype,"outerContainer",void 0),e.__decorate([a.property({readOnly:!0})],t.default.prototype,"contentContainer",null),e.__decorate([a.property({readOnly:!0})],t.default.prototype,"effectivePlacement",null),e.__decorate([a.property()],t.default.prototype,"debug",void 0),e.__decorate([a.property()],t.default.prototype,"_lastPosition",void 0),e.__decorate([a.property()],t.default.prototype,"_screenPoint",null),e.__decorate([a.property()],t.default.prototype,"_rtl",void 0),e.__decorate([a.property()],t.default.prototype,"_effectiveOffset",null),e.__decorate([a.property()],t.default.prototype,"_outerContainerStyle",null),t.default=e.__decorate([d.subclass("esri.views.interactive.Tooltip")],t.default);const v=["top","bottom","leading","trailing"].flatMap((t=>[g(`${t}-start`),g(t),g(`${t}-end`)]));function g(t){return`${_.base}--${t}`}return t.default}));