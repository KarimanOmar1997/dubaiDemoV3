// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/arrayUtils","../../../core/compilerUtils","../../../core/Evented","../../../geometry/Polygon","../../../geometry/Polyline","../coordinateHelper","./unnormalizationHelper"],(function(e,t,s,i,r,n,o,c){"use strict";class h{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}}class l{constructor(e,t,s){this.component=e,this.leftVertex=t,this.rightVertex=s,this.type="edge",t.rightEdge=this,s.leftEdge=this}}class a{constructor(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||c.unnormalize(this.vertices,c.getUnnormalizationInfo(this._spatialReference,this._viewingMode))}updateVertexIndex(e,t){if(0===this.vertices.length)return;const s=this.vertices[0];let i=null,r=e,n=t;do{i=r,i.index=n++,r=i.rightEdge?i.rightEdge.rightVertex:null}while(null!=r&&r!==s);i.leftEdge&&i!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(i),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge}swapVertices(e,t){const s=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=s}iterateVertices(e){if(0===this.vertices.length)return;const t=this.vertices[0];let s=t;do{e(s,s.index),s=null!=s.rightEdge?s.rightEdge.rightVertex:null}while(s!==t&&null!=s)}}class p extends i{constructor(e,t){super(),this.type=e,this.coordinateHelper=t,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:s.neverReached(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const e of this.components)for(const t of e.vertices)yield t}notifyChanges(e){this._dirty=!0,this.emit("change",e)}_toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const e=[],t=this.coordinateHelper.vectorToArray;for(const s of this.components){if(s.vertices.length<1)continue;const i=[];let r=s.vertices.find((e=>null==e.leftEdge));const n=r;do{i.push(t(r.pos)),r=r.rightEdge?r.rightEdge.rightVertex:null}while(r&&r!==n);e.push(i)}return new n({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const e=[],t=this.coordinateHelper.vectorToArray;for(const s of this.components){if(s.vertices.length<1)continue;const i=[],r=s.vertices[0];let n=r;const o=n;do{i.push(t(n.pos)),n=null!=n.rightEdge?n.rightEdge.rightVertex:null}while(n&&n!==o);s.isClosed()&&i.push(t(r.pos)),e.push(i)}return new r({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,s){const i=e.spatialReference,r=o.createCoordinateHelper(e.hasZ,e.hasM,i),n=new p(e.type,r);switch(e.type){case"polygon":!function(e,s,i){const r=s.spatialReference,n=e.coordinateHelper,o=s.rings;for(let s=0;s<o.length;++s){const c=o[s],p=new a(r,i);p.index=s;const g=c.length>2&&t.equals(c[0],c[c.length-1]),d=g?c.length-1:c.length;for(let e=0;e<d;++e){const t=n.arrayToVector(c[e]),s=new h(p);p.vertices.push(s),s.pos=t,s.index=e}const u=p.vertices.length-1;for(let e=0;e<u;++e){const t=p.vertices[e],s=p.vertices[e+1],i=new l(p,t,s);p.edges.push(i)}if(g){const e=new l(p,p.vertices[p.vertices.length-1],p.vertices[0]);p.edges.push(e)}e.components.push(p)}}(n,e,s);break;case"polyline":!function(e,t,s){const i=t.spatialReference,r=e.coordinateHelper,n=t.paths;for(let t=0;t<n.length;++t){const o=n[t],c=new a(i,s);c.index=t;const p=o.length;for(let e=0;e<p;++e){const t=r.arrayToVector(o[e]),s=new h(c);c.vertices.push(s),s.pos=t,s.index=e}const g=c.vertices.length-1;for(let e=0;e<g;++e){const t=c.vertices[e],s=c.vertices[e+1],i=new l(c,t,s);c.edges.push(i)}e.components.push(c)}}(n,e,s);break;case"point":g(n,e,s);break;case"mesh":g(n,e.origin,s),n._geometry=e,n._dirty=!1}return n}}function g(e,t,s){const i=t.spatialReference,r=e.coordinateHelper,n=new a(i,s);n.index=0;const o=new h(n);o.index=0,o.pos=r.pointToVector(t),n.vertices.push(o),e.components.push(n)}e.Component=a,e.Edge=l,e.EditGeometry=p,e.Vertex=h,e.isMeshEditGeometry=function(e){return"mesh"===e.type},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));