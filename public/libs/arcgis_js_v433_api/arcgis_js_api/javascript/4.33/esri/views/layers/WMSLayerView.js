// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["../../chunks/tslib.es6","../../core/Error","../../core/maybe","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../layers/support/ExportWMSImageParameters","../../layers/support/timeSupport"],(function(e,t,r,o,a,s,p,i,n,c,u){"use strict";return s=>{let p=class extends s{initialize(){this.exportImageParameters=new c.ExportWMSImageParameters({layer:this.layer})}destroy(){this.exportImageParameters=r.destroyMaybe(this.exportImageParameters)}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}get timeExtent(){return u.combineTimeExtent(this.layer,this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(e,r){const{layer:a}=this;if(!e)throw new t("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:a});const{popupEnabled:s}=a;if(!s)throw new t("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:s});const p=this.createFetchPopupFeaturesQuery(e);if(!p)return[];const{extent:i,width:n,height:c,x:u,y:h}=p;if(!(i&&n&&c))throw new t("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:i,width:n,height:c});const m=await a.fetchFeatureInfo(i,n,c,u,h);return o.throwIfAborted(r),m}};return e.__decorate([a.property()],p.prototype,"exportImageParameters",void 0),e.__decorate([a.property({readOnly:!0})],p.prototype,"exportImageVersion",null),e.__decorate([a.property()],p.prototype,"layer",void 0),e.__decorate([a.property({readOnly:!0})],p.prototype,"timeExtent",null),p=e.__decorate([n.subclass("esri.views.layers.WMSLayerView")],p),p}}));