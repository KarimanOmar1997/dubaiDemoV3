// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.33/esri/copyright.txt for details.
//>>built
define(["require","../chunks/tslib.es6","../intl","../core/has","../core/MapUtils","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","../support/guards","./Widget","./BatchAttributeForm/batchAttributeFormUtils","./BatchAttributeForm/BatchAttributeFormViewModel","./BatchAttributeForm/css","./BatchAttributeForm/VisibleElements","./BatchAttributeForm/inputs/support/inputUtils","../chunks/componentsUtils","./support/dateUtils","./support/globalCss","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","./support/forms/formUtils","../intl/substitute"],(function(e,t,n,i,s,a,o,r,l,d,u,p,c,m,h,v,f,b,_,g,C,y,F,x,I,w,V){"use strict";const k="data-element-id";let M=class extends c{constructor(e,t){super(e,t),this.headingLevel=2,this.messagesCommon=null,this.messages=null,this.featureFormMessages=null,this.viewModel=new h,this.visibleElements=new f.VisibleElements,this.groupDisplay="all",this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._touchedInputs=new Set,this._focusedFieldInput=null,this._batchSwitchInputInitialValues=new Map,this._saveInput=this._saveInput.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([a.watch((()=>this.features),(()=>{this._dateComponentMap.clear()})),a.watch((()=>this.viewModel.activeForm),(()=>{this._batchSwitchInputInitialValues.clear()})),a.on((()=>this.viewModel),"submit",(()=>{this.valid||this.goToClosestError()}))])}loadDependencies(){return _.loadCalciteComponents({input:()=>new Promise(((t,n)=>e(["../chunks/index4"],t,n))),block:()=>new Promise(((t,n)=>e(["../chunks/index13"],t,n))),button:()=>new Promise(((t,n)=>e(["../chunks/index2"],t,n))),combobox:()=>new Promise(((t,n)=>e(["../chunks/index21"],t,n))),"combobox-item":()=>new Promise(((t,n)=>e(["../chunks/index22"],t,n))),"combobox-item-group":()=>new Promise(((t,n)=>e(["../chunks/index23"],t,n))),dropdown:()=>new Promise(((t,n)=>e(["../chunks/index24"],t,n))),"dropdown-group":()=>new Promise(((t,n)=>e(["../chunks/index25"],t,n))),"dropdown-item":()=>new Promise(((t,n)=>e(["../chunks/index26"],t,n))),"input-date-picker":()=>new Promise(((t,n)=>e(["../chunks/index27"],t,n))),"input-number":()=>new Promise(((t,n)=>e(["../chunks/index28"],t,n))),"input-time-picker":()=>new Promise(((t,n)=>e(["../chunks/index29"],t,n))),"input-time-zone":()=>new Promise(((t,n)=>e(["../chunks/index30"],t,n))),label:()=>new Promise(((t,n)=>e(["../chunks/index5"],t,n))),"input-message":()=>new Promise(((t,n)=>e(["../chunks/index31"],t,n))),loader:()=>new Promise(((t,n)=>e(["../chunks/index32"],t,n))),notice:()=>new Promise(((t,n)=>e(["../chunks/index6"],t,n))),switch:()=>new Promise(((t,n)=>e(["../chunks/index33"],t,n))),"text-area":()=>new Promise(((t,n)=>e(["../chunks/index34"],t,n))),"radio-button":()=>new Promise(((t,n)=>e(["../chunks/index35"],t,n))),"radio-button-group":()=>new Promise(((t,n)=>e(["../chunks/index36"],t,n)))})}get activeFeatureIndex(){return this.viewModel.activeFeatureIndex}set activeFeatureIndex(e){this.viewModel.activeFeatureIndex=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get _effectiveDisabled(){return this.disabled||this.viewModel.updating}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get icon(){return"edit-attributes"}set icon(e){this._overrideIfSome("icon",e)}get readOnly(){return this.viewModel.readOnly}set readOnly(e){this.viewModel.readOnly=e}get valid(){return this.viewModel.valid}goToClosestError(){const e=this.viewModel.getFirstVisibleInvalidFieldInput();if(!e)return;const{groupInput:t}=e;t&&(t.open||(t.open=!0)),this._focusedFieldInput=e.input,this._attemptFocusOnNextRender=!0,this.scheduleRender()}render(){const{status:e}=this.viewModel;return"failed"===e?this.viewModel.hasTooManyComplexFeatures?this._renderErrorNotice(V.substitute(this.messages.formFailedToLoadTooManyComplexFeatures,{num:this.viewModel.maximumFeatureCountWithComplexForms})):this.viewModel.hasTooManyFeatures?this._renderErrorNotice(V.substitute(this.messages.formFailedToLoadTooManyFeatures,{num:this.viewModel.maximumFeatureCount})):this._renderErrorNotice(this.messages.formFailedToLoad):this.viewModel.expressionEvaluationFailed?this._renderErrorNotice(this.messages.expressionEvaluationFailed):this.viewModel.hasLayersWithContingentValues?this._renderErrorNotice(this.messages.unsupportedContingentValues):I.tsx("div",{class:this.classes(v.css.base,C.globalCss.widget,C.globalCss.panel)},"loaded"===e?this._renderForm():"loading"===e&&this.visibleElements.loadingIndicator?I.tsx("calcite-loader",{key:"loader",label:this.messagesCommon?.loading}):null)}submit(){this.viewModel.submit()}_setDateTimeTimeZoneMap(e){const{datePart:t,elementId:n}=e.dataset,i=s.getOrCreateMapValue(this._dateComponentMap,`${n}`,(()=>({})));switch(t){case"date":i.date=e;break;case"time":i.time=e;break;case"timeZone":i.timeZone=e}}_renderErrorNotice(e){return I.tsx("div",{class:this.classes(v.css.base,C.globalCss.widget,C.globalCss.panel)},I.tsx("calcite-notice",{class:v.css.noticeError,icon:!0,kind:"warning",open:!0},I.tsx("div",{slot:"message"},e)))}_renderForm(){return I.tsx("form",{onsubmit:this._onFormSubmit},this._renderInvisibleFieldsError(),this._renderContent())}_renderInvisibleFieldsError(){const{viewModel:e}=this,{hasNonActiveInvalidFeatures:t,activeForm:n}=e;let i;if(!e.submitHasBeenAttempted)return null;if(n.invalidHiddenInputs.length>0)if(i=m.getHiddenFieldsValidationErrorMessage(n,e.mode,this.messages),"batch"===this.viewModel.mode){const e=n.invalidHiddenInputs.filter((e=>e.effectiveVisibilityCode===b.InputVisibilityCode.HIDDEN_GROUP_VISIBILITY_EXPRESSION_ALL||e.visibilityCode===b.InputVisibilityCode.HIDDEN_VISIBILITY_EXPRESSION_ALL));e.length>0?i+=` (${e.map((e=>e.label)).join(", ")})`:i=null}else i+=` (${n.invalidHiddenInputs.map((e=>e.label)).join(", ")})`;else if(t)return null;return i?I.tsx("calcite-notice",{class:v.css.noticeError,icon:!0,kind:"danger",open:!0},I.tsx("div",{slot:"message"},i)):null}_renderContent(){if(!this.viewModel.hasVisibleInputs)return[I.tsx("calcite-notice",{class:v.css.noticeError,icon:!0,kind:"warning",open:!0},I.tsx("div",{slot:"message"},this.messages.noVisibleFields[this.viewModel.noVisibleElementsReason]))];const{inputs:e}=this.viewModel.activeForm;return e.filter((e=>e.visible)).map((e=>this._renderInput(e)))}_renderInput(e){return b.isGroupInput(e)?this._renderGroupInput(e):b.isFieldInput(e)?this._renderLabeledField(e):void 0}_renderGroupInput(e){const{inputs:t,template:n,open:i}=e,s=t.filter((e=>e.visible)),a=n.label??"";return I.tsx("calcite-block",{class:this.classes(v.css.group,"sequential"===this.groupDisplay?v.css.groupSequential:null,this.disabled?v.css.inputDisabled:null),collapsible:!0,description:n.description??void 0,disabled:this._effectiveDisabled,expanded:i,heading:a,headingLevel:this.headingLevel,key:`{${n.elementId}-key}`,label:a,onCalciteBlockClose:()=>{e.open=!1},onCalciteBlockOpen:()=>{e.open=!0}},s.map((e=>this._renderInput(e))))}_renderLabeledField(e){const{label:t,elementId:n}=e.template,{required:i,dataType:s}=e,a=i?V.substitute(this.messages.requiredFieldLabel,{name:t}):t;return I.tsx("calcite-label",{"aria-label":a,class:v.css.label,key:`field--${n}`},I.tsx("div",{class:v.css.labelTextContent,key:"labelTextContainer"},t,i?I.tsx("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==s?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e))}_renderFieldInput(e){const t=this.getCommonInputProps(e),{dataType:n}=e;return"date"===n?this._renderDateComponents(e,t):"coded-value"===e.domain?.type?this._renderCodedInputs({input:e,props:t}):"number"===n?this._renderNumberComponent(e,t):this._renderStringComponent(e,t)}_renderAuxiliaryText(e){const{compositeError:t,description:n,submittable:i}=e,s=!i&&t&&(this.viewModel.submitHasBeenAttempted||this._touchedInputs.has(e.template.elementId))?m.getVisibleFieldInputValidationErrorMessage(e,t,this.messages):null;return s?I.tsx("calcite-input-message",{icon:!0,status:"invalid"},s):n?I.tsx("calcite-input-message",{class:v.css.description,icon:!1,status:"idle"},n):null}_renderCodedInputs({input:e,props:t}){const n=e.template.input?.type??null,i=e.codedValueOptions;switch(n){case"switch":return this._renderSwitchField({input:e,props:t});case"radio-buttons":return this._renderRadioButtonGroupComponent({input:e,options:i.flat(),props:t});default:return this._renderComboBoxComponent({options:i,props:t,input:e})}}_renderSwitchField({input:e,props:t}){if((this._batchSwitchInputInitialValues.get(e)===b.differentValuesString||e.value===b.differentValuesString)&&"batch"===this.viewModel.mode){const n={dropdown:{afterCreate:this._afterComponentCreateOrUpdate,afterUpdate:this._afterComponentCreateOrUpdate,disabled:t.readOnly,open:!1,[k]:t[k]},trigger:{appearance:"transparent",iconEnd:"chevron-down",kind:"neutral",slot:"trigger",label:t.label},group:{mode:"single"}};return this._renderDropdownComponent({buttonValue:e.value,dropdownProps:n,options:[{name:this.messages.differentValuesPlaceholder,value:b.differentValuesString,disabled:!0},...e.codedValueDomainOptions]})}return this._renderSwitchComponent({input:e,props:t})}_renderSwitchComponent({input:e,props:t}){return I.tsx("calcite-switch",{...t,checked:!!m.isElementTemplateWithInputType(e.template,"switch")&&e.value===e.template.input.onValue,class:v.css.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldInput=null},onCalciteSwitchChange:({currentTarget:e})=>this._saveInput(e)})}_renderDropdownComponent({buttonValue:e,options:t,dropdownProps:n}){const{trigger:i,dropdown:s,group:a}=n;return I.tsx("calcite-dropdown",{...s,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,onCalciteDropdownSelect:({currentTarget:e})=>this._saveInput(e)},I.tsx("calcite-button",{...i},e===b.differentValuesString?this.messages.differentValuesPlaceholder:e),I.tsx("calcite-dropdown-group",{selectionMode:a.mode},t.map((t=>I.tsx("calcite-dropdown-item",{disabled:t.disabled,label:String(t.name),selected:e===t.value},t.name)))))}_renderComboBoxComponent({input:e,options:t,props:n}){const i="INSERT"===this.viewModel.editType,s=this._touchedInputs.has(e?.template?.elementId),a=i&&e.showNoValueOptionEnabled&&!s?()=>{}:n.onblur,o={...n,onblur:a};return I.tsx("calcite-combobox",{...o,selectionMode:"single",value:n.placeholder===this.messages.differentValuesPlaceholder?b.differentValuesString:String(n.value),onCalciteComboboxChange:({currentTarget:e})=>{e.value!==b.differentValuesString&&this._saveInput(e)}},this.renderComboboxOptionsList({input:e,options:t,props:n}))}renderComboboxOptionsList({input:e,options:t,props:n}){const[i,s]=t.map((e=>e.map((({name:e,value:t})=>I.tsx("calcite-combobox-item",{key:`#${t}`,selected:n.value===t,textLabel:e,value:`${t}`}))))),a=[...i];s.length>0&&a.push(I.tsx("calcite-combobox-item-group",{key:"unsupported",label:this.featureFormMessages.subtypes.unsupportedDomainGroupTitle},s));const o=n.placeholder===this.messages.differentValuesPlaceholder,r=!o&&w.isEmptyValue(n.value);return e.showNoValueOptionEnabled&&a.unshift(I.tsx("calcite-combobox-item",{key:"empty-option",selected:r,textLabel:e.showNoValueLabel||this.messages.empty,value:""})),o&&a.unshift(I.tsx("calcite-combobox-item",{key:b.differentValuesString,selected:!0,textLabel:this.messages.differentValuesPlaceholder,value:b.differentValuesString})),a}_renderRadioButtonGroupComponent({input:e,options:t,props:n}){const i=t.map((({name:t,value:i})=>this._renderRadioButtons({label:t,value:i,selected:i===e.value,props:n})));if(e.showNoValueOptionEnabled){const t="",s=e.showNoValueLabel||this.messages.empty,a=w.isEmptyValue(e.value);i.unshift(this._renderRadioButtons({label:s,value:t,selected:a,props:n}))}return I.tsx("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:v.css.inputRadioGroup,disabled:n.readOnly,key:`${n.key}-radio-group`,layout:"vertical",name:n.name,required:n.required},i,n.placeholder===this.messages.differentValuesPlaceholder?I.tsx("calcite-label",{class:v.css.placeholderRadio,key:n.label,layout:"inline"},I.tsx("calcite-radio-button",{checked:!0,class:v.css.inputRadio,disabled:!0,name:n.placeholder,value:n.placeholder}),n.placeholder):null)}_renderRadioButtons({value:e,selected:t,label:n,props:i}){return I.tsx("calcite-label",{class:v.css.inputRadioLabel,key:i.label,layout:"inline"},I.tsx("calcite-radio-button",{...i,afterCreate:void 0,afterUpdate:void 0,checked:t,class:v.css.inputRadio,disabled:i.readOnly,name:i.label,onblur:()=>{this._focusedFieldInput=null},value:e,onCalciteRadioButtonChange:({currentTarget:e})=>{e.checked&&this._saveInput(e)}}),n)}_renderStringComponent(e,t){const{template:n}=e;return!n.field.editable||this.readOnly?this._renderReadOnlyComponent(e):n.input&&"text-area"===n.input.type?I.tsx("calcite-text-area",{...t,class:this.classes(v.css.individualElement),resize:"vertical",value:t.value?String(t.value):"",onCalciteTextAreaInput:({currentTarget:e})=>this._saveInput(e)}):I.tsx("calcite-input",{...t,class:this.classes(v.css.individualElement),type:"text",value:t.value?String(t.value):"",onCalciteInputInput:({currentTarget:e})=>this._saveInput(e)})}_renderNumberComponent(e,t){const n=u.isIntegerField(e.field);return I.tsx("calcite-input-number",{...t,integer:n,type:"number",value:n&&""!==t.value?Math.round(parseFloat(String(t.value))).toString():String(t.value),onCalciteInputNumberInput:({currentTarget:e})=>this._saveInput(e)})}_renderReadOnlyComponent(e,t){const n=this.getCommonInputProps(e);return I.tsx("calcite-input",{...n,class:this.classes(v.css.fieldInput,v.css.inputDisabled,v.css.individualElement),readOnly:!0,type:"text",value:String(t??n.value??"")})}_renderDateComponents(e,t){const{field:n}=e;let i;switch(n.type){case"date":i=this._renderDateFieldComponents(e,t);break;case"date-only":i=this._renderDateOnlyFieldComponent(e,t);break;case"time-only":i=this._renderTimeOnlyFieldComponent(e,t);break;case"timestamp-offset":i=this._renderTimestampOffsetFieldComponents(e,t);break;default:i=this._renderReadOnlyComponent(e,g.getLabelForDateFieldValue(n,t.value,{timeZone:e.effectiveTimeZone,...g.getIntlOptionsForField(e.template.field)}))}return e.value===b.differentValuesString?[i,I.tsx("calcite-input-message",{icon:"information",key:"diff-values-message",status:"idle"},this.messages.differentValues)]:i}_renderDateOnlyFieldComponent(e,t){const{class:n,key:i,readOnly:s}=t,{rawMax:a,rawMin:o}=e.range;return I.tsx("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,class:n,"data-date-part":"date","data-element-id":t[k],key:`${i}-date-input`,max:p.isString(a)?a:void 0,min:p.isString(o)?o:void 0,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:s,value:e.value===b.differentValuesString?"":e.value?String(e.value):"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.currentTarget)})}_renderTimeOnlyFieldComponent(e,t){const{class:n,key:i,readOnly:s}=t;return I.tsx("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,class:n,"data-date-part":"time","data-element-id":t[k],key:`${i}-time-input`,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:s,value:e.value===b.differentValuesString?"":e.value?String(e.value):"",onCalciteInputTimePickerChange:t=>this._saveValueFromDateComponent(e,t.currentTarget)})}_renderTimestampOffsetFieldComponents(e,t){const{class:n,key:i,readOnly:s}=t,{rawMax:a,rawMin:o}=e.range,r=g.prepareISOFieldValueForDateComponents(a),l=g.prepareISOFieldValueForDateComponents(o),d=g.prepareISOFieldValueForDateComponents(e.value===b.differentValuesString?"":e.value),u=e.includeTimeOffset,p={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,overlayPositioning:"fixed",readOnly:s,[k]:t[k],onfocus:this._onComponentFocus};return I.tsx("div",{class:v.css.dateInputContainer,key:`${i}-date-time-container`},I.tsx("calcite-input-date-picker",{...p,class:n,"data-date-part":"date",key:`${i}-date-input`,max:r?.date??void 0,min:l?.date??void 0,onblur:()=>{this._focusedFieldInput=null},value:d.date??"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),I.tsx("calcite-input-time-picker",{...p,class:n,"data-date-part":"time",key:`${i}-time-input`,onblur:()=>{this._focusedFieldInput=null},value:d.time??"",onCalciteInputTimePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),u?I.tsx("calcite-input-time-zone",{...p,class:n,clearable:e.value===b.differentValuesString||null==e.value,"data-date-part":"timeZone",key:`${i}-timezone-input`,onblur:()=>{this._focusedFieldInput=null},value:d.timeZoneOffset||"",onCalciteInputTimeZoneChange:t=>this._saveValueFromDateComponent(e,t.target)}):null)}_renderDateFieldComponents(e,t){const{class:n,key:i,readOnly:s,min:a,max:o}=t,r=e.effectiveTimeZone,l=g.prepareUnixFieldValueForDateComponents(e.value===b.differentValuesString?"":e.value,r),d=g.prepareUnixFieldValueForDateComponents(o,r),u=g.prepareUnixFieldValueForDateComponents(a,r),p=e.includeTime,c={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,overlayPositioning:"fixed",readOnly:s,[k]:t[k],onfocus:this._onComponentFocus};return I.tsx("div",{class:v.css.dateInputContainer,key:`${i}-date-time-container`},I.tsx("calcite-input-date-picker",{...c,class:n,"data-date-part":"date",key:`${i}-date-input`,max:d?.date??void 0,min:u?.date??void 0,onblur:()=>{this._focusedFieldInput=null},value:l.date??"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),p?I.tsx("calcite-input-time-picker",{...c,"data-date-part":"time",key:`${i}-time-input`,onblur:()=>{this._focusedFieldInput=null},step:1,value:l.time??"",onCalciteInputTimePickerChange:t=>{this._saveValueFromDateComponent(e,t.target)}}):null)}getCommonInputProps(e){const{template:t,valid:n,value:i,minLength:s,maxLength:a,required:o,fieldName:r,editable:l,userHasChangedValue:d,range:{max:u,min:p}}=e,c=!l||this.readOnly,m=!c&&this._effectiveDisabled;let h=t.hint??void 0,f=!1;return i===b.differentValuesString&&(h=this.messages.differentValuesPlaceholder,f=!0),{afterCreate:this._afterComponentCreateOrUpdate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":n?"false":"true",class:this.classes(v.css.fieldInput,c?v.css.inputDisabled:null),status:!d&&!this.viewModel.submitHasBeenAttempted||n?"idle":"invalid",maxLength:a&&a>-1?a:void 0,minLength:s&&s>-1?s:void 0,key:t.elementId,label:r,name:r,max:null!=u?u:void 0,min:null!=p?p:void 0,disabled:m,readOnly:c,onblur:this._onComponentBlur,required:o,placeholder:h,value:f?"":i??"",[k]:t.elementId,onfocus:this._onComponentFocus}}_onFormSubmit(e){e.preventDefault()}_getFieldInputFromHTMLElement(e){return this.viewModel.findFieldInput(e.getAttribute(k))}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,n=e.querySelector("calcite-radio-button"),i=t||n;i&&this._afterComponentCreateOrUpdate(i)}_onComponentFocus(e){const t=e.target,n=this._getFieldInputFromHTMLElement(t);this._touchedInputs.add(n.template.elementId),this._focusedFieldInput=n}_afterComponentCreateOrUpdate(e){const t=this._getFieldInputFromHTMLElement(e),n=this._focusedFieldInput;this._attemptFocusOnNextRender&&n===t&&(this._attemptFocusOnNextRender=!1,y.setFocus(e))}_onComponentBlur(){this._focusedFieldInput=null}_parseValue(e,t){if(m.isElementTemplateWithInputType(t.template,"switch")){if("calcite-dropdown"===e.localName&&t.domain)for(const n of t.domain.codedValues)if(n.name===e.selectedItems[0].textContent)return n.code;return e.checked?t.template.input.onValue:t.template.input.offValue}const n=e.value;return null==n||""===n?null:"number"===t.dataType?"-0"===n||"-0."===n||"-0,"===n?n:parseFloat(n):"date"===t.field.type?parseFloat(n):n}_saveInput(e){const t=this._getFieldInputFromHTMLElement(e),{elementId:n}=t.template;if(!t)return;const i=t?.value;if(m.isElementTemplateWithInputType(t.template,"switch")&&"single"!==this.viewModel.mode){const e=s.getOrCreateMapValue(this._batchSwitchInputInitialValues,t,(()=>t.value));this._batchSwitchInputInitialValues.set(t,null===e?i:e)}const a=this._parseValue(e,t);a!==i&&this.viewModel.setValue(n,a)}async _afterDateComponentCreate(e){this._setDateTimeTimeZoneMap(e),this._afterComponentCreateOrUpdate(e)}_saveValueFromDateComponent(e,t){const{elementId:n}=e.template,i=e.field.type,s=this._dateComponentMap.get(`${n}`);if(!s)return;const a=e.effectiveTimeZone;let o=e.value===b.differentValuesString?void 0:e.value,r=null;"date-only"===i?r=Array.isArray(t.value)?t.value[0]:t.value:"time-only"===i?(o=g.normalizeTimeOnlyString(o),r=g.normalizeTimeOnlyString(t.value)):r="timestamp-offset"===i?null!=t.value?g.getISOFieldValueFromDateComponents({dateComponent:s.date,timeComponent:s.time,oldValue:o,timeZoneComponent:s.timeZone,defaultTimeZone:a}):null:null!=t.value?g.getUnixFieldValueFromDateComponents({oldValue:o,dateComponent:s.date,timeZone:a,timeComponent:s.time?.value===b.differentValuesString?void 0:s.time}):null,o!==r&&(null!==r&&t.value?this.viewModel.setValue(`${n}`,r):this.viewModel.setValue(`${n}`,null))}};return t.__decorate([o.property()],M.prototype,"activeFeatureIndex",null),t.__decorate([o.property()],M.prototype,"disabled",null),t.__decorate([o.property()],M.prototype,"_effectiveDisabled",null),t.__decorate([o.property()],M.prototype,"features",null),t.__decorate([o.property()],M.prototype,"map",null),t.__decorate([o.property()],M.prototype,"spatialReference",null),t.__decorate([o.property()],M.prototype,"timeZone",null),t.__decorate([o.property()],M.prototype,"headingLevel",void 0),t.__decorate([o.property()],M.prototype,"icon",null),t.__decorate([o.property(),F.messageBundle("esri/t9n/common")],M.prototype,"messagesCommon",void 0),t.__decorate([o.property(),F.messageBundle("esri/widgets/BatchAttributeForm/t9n/BatchAttributeForm")],M.prototype,"messages",void 0),t.__decorate([o.property(),F.messageBundle("esri/widgets/FeatureForm/t9n/FeatureForm")],M.prototype,"featureFormMessages",void 0),t.__decorate([o.property()],M.prototype,"readOnly",null),t.__decorate([o.property()],M.prototype,"valid",null),t.__decorate([o.property(),x.vmEvent(["value-change","submit"])],M.prototype,"viewModel",void 0),t.__decorate([o.property({type:f.VisibleElements,nonNullable:!0})],M.prototype,"visibleElements",void 0),t.__decorate([o.property()],M.prototype,"groupDisplay",void 0),M=t.__decorate([d.subclass("esri.widgets.BatchAttributeForm")],M),M}));